import{$t as e,Ct as t,Dt as n,Et as r,Ht as i,I as a,K as o,Mt as s,N as c,Nt as l,Ot as u,Qt as d,Rt as f,Tt as p,Vt as m,W as h,Wt as g,Xt as _,Zt as v,a as y,cn as b,dn as ee,en as te,fn as x,jt as S,kt as C,n as ne,nt as re,on as w,qt as ie,rn as ae}from"../entry.CUq7HivD.js";import{t as oe}from"./nuxt-link.hV4hwteT.js";import{t as se}from"./SelectGroup.Df2Mb_va.js";import{d as ce,i as T,n as E,r as le,t as D}from"./current.DC8NWKuj.js";import{r as ue}from"./ui.ej5T_Dcm.js";var O=l({__name:`Framegraph`,props:{graph:{}},setup(e){let t=e,n=_(`el`);return d(()=>n.value?.append(t.graph.el)),(e,t)=>(i(),C(`div`,{ref_key:`el`,ref:n},null,512))}}),de=Object.assign(O,{__name:`ChartFramegraph`}),k={flex:`~ gap-1 items-center wrap`},A={key:0,"i-ph-arrow-right-bold":``,"text-sm":``,"op-fade":``},j=[`onClick`],M={key:1},N=l({__name:`NavBreadcrumb`,props:{selected:{},options:{}},emits:[`select`],setup(e,{emit:a}){let o=e,s=a,c=p(()=>{let e=[],t=o.selected;for(;t;)e.unshift(t),t=t.parent;return e});return(e,a)=>{let o=E;return i(),C(`div`,k,[(i(!0),C(t,null,g(c.value,(e,a)=>(i(),C(t,{key:e.id},[a>0?(i(),C(`div`,A)):u(``,!0),r(`button`,{hover:`bg-active`,rounded:``,px1:``,onClick:t=>s(`select`,e)},[e.meta?(i(),n(o,{key:0,pkg:e.meta},null,8,[`pkg`])):(i(),C(`span`,M,x(e.text||e.id),1))],8,j)],64))),128))])}}}),P=Object.assign(N,{__name:`ChartNavBreadcrumb`}),fe=l({__name:`Treemap`,props:{graph:{},selected:{}},emits:[`select`],setup(e,{emit:t}){let n=e,a=t,o=_(`el`);return d(()=>o.value?.append(n.graph.el)),(t,n)=>{let c=P;return i(),C(`div`,null,[s(c,{border:`b base`,py2:``,"min-h-10":``,selected:e.selected,options:e.graph.options,onSelect:n[0]||=e=>a(`select`,e)},null,8,[`selected`,`options`]),r(`div`,{ref_key:`el`,ref:o},null,512)])}}}),pe=Object.assign(fe,{__name:`ChartTreemap`});function me(e,t=1,n=1){let r=(.6+.4*Math.max(0,Math.cos(e)))*t,i=(.5+.2*Math.max(0,Math.cos(e+Math.PI*2/3)))*n;return`hsl(${e*180/Math.PI}deg, ${Math.round(100*r)}%, ${Math.round(100*i)}%)`}var he,ge,_e,F,I,L=1,R;function ve(e,t,n,r,i){if(!Array.isArray(e))return e;let a=window.devicePixelRatio||1;if(he!==t||ge!==a||_e!==i){let n=Math.round(64*a)/64;L=i,L=Math.log2(L),L-=Math.floor(L);let r=L,o=Math.min(1,8*r);L=2**L;let s=8*Math.SQRT2/L;he=t,ge=a,_e=i,F||=document.createElement(`canvas`),I||=F.getContext(`2d`),F.width=F.height=Math.round(64*n),I.scale(n,n),I.fillStyle=e[0],I.fillRect(0,0,64,64),I.globalAlpha=.25,I.fillStyle=e[1],I.fillRect(0,0,64,64),I.globalAlpha=.67,I.strokeStyle=e[1],I.beginPath();for(let e=0;e<=64;e+=16)I.moveTo(e-32,e+32),I.lineTo(e+32,e-32);if(I.lineWidth=s*(1-(o-r)/2),I.stroke(),o+r>0){I.beginPath();for(let e=8;e<64;e+=16)I.moveTo(e-32,e+32),I.lineTo(e+32,e-32);I.lineWidth=s*(o+r)/2,I.stroke()}R=t.createPattern(F,`repeat`),L/=n}return n/=64*L*a,n-=Math.floor(n),n*=64*L*a,R.setTransform(new DOMMatrix([L,0,0,L,n,r])),R}function ye(e){return Array.isArray(e)?`url('data:image/svg+xml,<svg width="26" height="26" xmlns="http://www.w3.org/2000/svg"><rect width="26" height="26" fill="${e[0]}"/><rect width="26" height="26" fill="${e[1]}" fill-opacity="25%"/><path d="M22.5 -3.5L-3.5 22.5M35.5 9.5L9.5 35.5" stroke="${e[1]}" stroke-opacity="67%" stroke-width="9.19239"/></svg>')`:e}function be(e){return t=>t.id&&e[t.id]||t.color}function xe(e,t=1,n=1){let r={};return Se(r,e,0,Math.PI*2,t,n),be(r)}function Se(e,t,n,r,i=1,a=1){let o=t.size;e[t.id]=me(n+r/2,i,a);for(let s of t.children){let t=s.size/o*r;Se(e,s,n,t,i,a),n+=t}}function Ce(e){return e.children.length===0?1:Math.max(...e.children.map(e=>Ce(e)))+1}var we=/\bFirefox\//.test(navigator.userAgent),z;function Te(e){return z?z.format(e):`${e}`}function B(){return(window.performance||Date).now()}function V(e){let t=e.toFixed(1).split(`.`,2);return`${Te(+t[0])}.${t[1]}`}function Ee(e){return e===1?`1 byte`:e<1024?`${Te(e)} bytes`:e<1024*1024?`${V(e/1024)} kb`:e<1024*1024*1024?`${V(e/(1024*1024))} mb`:`${V(e/(1024*1024*1024))} gb`}function De(e,t,n,r,i,a){if(we){let o=e.lineWidth,s=o/2;e.fillStyle=t,e.fillRect(n-s,r-s,i+o,o),e.fillRect(n-s,r+s,o,a-o),e.fillRect(n-s,r+a-s,i+o,o),e.fillRect(n+i-s,r+s,o,a-o);return}e.strokeStyle=t,e.strokeRect(n,r,i,a)}function H(e){return window.addEventListener(`wheel`,e,{passive:!1}),()=>window.removeEventListener(`wheel`,e)}function U(e){return window.addEventListener(`resize`,e),()=>window.removeEventListener(`resize`,e)}try{z=new Intl.NumberFormat}catch{}var Oe=()=>({emit(e,...t){for(let n=this.events[e]||[],r=0,i=n.length;r<i;r++)n[r](...t)},events:{},on(e,t){return(this.events[e]||=[]).push(t),()=>{this.events[e]=this.events[e]?.filter(e=>t!==e)}}}),W={getText:e=>e.text,getSubtext:e=>e.subtext,animate:!0,animateDuration:350},ke={fallback:`#CCC`,stroke:`#0008`,text:`#222`,hover:`#fff5`,shadow:`#0008`,fg:`#fff`,bg:`#222`},Ae=46,G=`14px sans-serif`,je=`bold ${G}`,K=class{el;canvas;c;width=0;height=0;ratio=1;root;maxDepth;events;options;palette;disposables;getColor;getText;getSubtext;_animationFrame=null;constructor(e,t){this.options={...W,...t};let{getColor:n=xe(e),getText:r=()=>void 0,getSubtext:i=()=>void 0}=this.options;this.palette={...ke,...t.palette},this.el=document.createElement(`div`),this.canvas=document.createElement(`canvas`),this.c=this.canvas.getContext(`2d`),this.root=e,this.maxDepth=Ce(e),this.disposables=[],this.events=Oe(),this.getColor=n,this.getText=r,this.getSubtext=i,this.setFont(G),t.onClick&&this.events.on(`click`,t.onClick),t.onHover&&this.events.on(`hover`,t.onHover),t.onLeave&&this.events.on(`leave`,t.onLeave),t.onSelect&&this.events.on(`select`,t.onSelect),this.el.addEventListener(`mouseleave`,()=>{this.events.emit(`leave`)})}invalidate(){this._animationFrame===null&&(this._animationFrame=requestAnimationFrame(()=>{this._animationFrame=null,this.tick()}))}tick(){this.draw()}draw(){}resize(){this.ratio=window.devicePixelRatio||1,this.canvas.style.width=`${this.width}px`,this.canvas.style.height=`${this.height}px`,this.canvas.width=Math.round(this.width*this.ratio),this.canvas.height=Math.round(this.height*this.ratio),this.c.scale(this.ratio,this.ratio),this.draw()}select(e,t){this.events.emit(`select`,e)}dispose(){this.disposables.forEach(e=>e()),this.disposables.length=0,this.el.remove()}[Symbol.dispose](){this.dispose()}_font=`14px sans-serif`;_fontWidthCache=new Map;ellipsisWidth=0;getFontCache(){return this._fontWidthCache.has(this._font)||this._fontWidthCache.set(this._font,{}),this._fontWidthCache.get(this._font)}setFont(e){this._font=e,this.c.font=e,this.c.textBaseline=`middle`,this.ellipsisWidth=3*this.charCodeWidth(Ae)}charCodeWidth(e){let t=this.getFontCache(),n=t[e];return n===void 0&&(n=this.c.measureText(String.fromCharCode(e)).width,t[e]=n),n}textOverflowEllipsis(e,t){if(t<this.ellipsisWidth)return[``,0];let n=0,r=e.length,i=0;for(;i<r;){let r=this.charCodeWidth(e.charCodeAt(i));if(t<n+this.ellipsisWidth+r)return[`${e.slice(0,i)}...`,n+this.ellipsisWidth];n+=r,i++}return[e,n]}},q=24,Me=5,Ne=.01,Pe=1e3,Fe=class extends K{mainEl=document.createElement(`div`);totalBytes;viewportMin;viewportMax;zoomedOutMin=0;zoomedOutWidth=0;prevWheelTime=0;prevWheelWasZoom=!1;stripeScaleAdjust=1;hoveredNode=null;selectedNode=null;nodeStartBytes=new Map;animationFromMin=0;animationFromMax=0;animationToMin=0;animationToMax=0;animationStart=0;constructor(e,t={}){super(e,t),this.totalBytes=e.size,this.viewportMin=this.animationFromMin=this.animationToMin=0,this.viewportMax=this.animationFromMax=this.animationToMax=this.totalBytes,Object.assign(this.mainEl.style,{position:`relative`}),Object.assign(this.canvas.style,{position:`absolute`,left:`0`,top:`0`});let n=!1;this.canvas.onmousedown=e=>{if(n=!1,e.button!==2){let t=e.pageX,r=e=>{let r=e.pageX-t;!n&&Math.abs(r)<3||(n=!0,this.modifyViewport(-r,0,null),t=e.pageX)},i=()=>{document.removeEventListener(`mousemove`,r),document.removeEventListener(`mouseup`,i)};e.preventDefault(),document.addEventListener(`mousemove`,r),document.addEventListener(`mouseup`,i)}},this.canvas.onmousemove=e=>{this.updateHover(e)},this.canvas.onmouseout=()=>{this.changeHoveredNode(null)},this.canvas.onclick=e=>{if(n)return;let t=this.hitTestNode(e);this.changeHoveredNode(t),this.changeSelectedNode(t),t&&this.events.emit(`click`,t,e)},this.disposables.push(H(e=>{let t=e.deltaX,n=e.deltaY,r=B(),i=r-this.prevWheelTime<50?this.prevWheelWasZoom:e.ctrlKey||e.metaKey;this.prevWheelTime=r,this.prevWheelWasZoom=i,(i||Math.abs(t)>=Math.abs(n))&&e.preventDefault(),this.modifyViewport(t,n,i?e.pageX:null),this.updateHover(e)})),this.resize(),Promise.resolve().then(()=>this.resize()),this.disposables.push(U(()=>this.resize())),this.mainEl.append(this.canvas),this.el.append(this.mainEl)}tick(){let e=(B()-this.animationStart)/(this.options.animateDuration??W.animateDuration);e<0||e>1?(e=1,this.viewportMin=this.animationToMin,this.viewportMax=this.animationToMax):(e<.5?e*=4*e*e:(e=1-e,e*=4*e*e,e=1-e),this.viewportMin=this.animationFromMin+(this.animationToMin-this.animationFromMin)*e,this.viewportMax=this.animationFromMax+(this.animationToMax-this.animationFromMax)*e,this.invalidate()),this.draw()}draw(){this.c.clearRect(0,0,this.width,this.height),this.drawNode(this.root,0,0,-1/0,1)}changeSelectedNode(e,t=this.options.animate??W.animate){if(this.selectedNode!==e&&(this.selectedNode=e,this.events.emit(`select`,e),e&&this.nodeStartBytes.has(e.id))){let n=this.nodeStartBytes.get(e.id),r=n+e.size;n=Math.max(0,n-e.size*Ne),r=Math.min(this.totalBytes,r+e.size*Ne),this.setViewport(n,r,t)}}select(e,t=this.options.animate??W.animate){this.changeSelectedNode(e,t)}resize(){this.width=this.el.clientWidth,this.height=this.maxDepth*q+1,this.zoomedOutMin=this.width-Pe>>1,this.zoomedOutWidth=this.zoomedOutMin+Pe,this.zoomedOutMin<0&&(this.zoomedOutMin=0),this.zoomedOutWidth>this.width&&(this.zoomedOutWidth=this.width),this.zoomedOutWidth-=this.zoomedOutMin,this.stripeScaleAdjust=this.totalBytes/this.zoomedOutWidth,this.mainEl.style.height=`${this.height}px`,super.resize()}drawNode(e,t,n,r,i){this.nodeStartBytes.set(e.id,n);let a=this.zoomedOutWidth/(this.viewportMax-this.viewportMin),o=this.zoomedOutMin+(n-this.viewportMin)*a,s=e.size*a,c=o+s;if(c<r+1.5)return r;if(o+s<0||o>this.width)return c;let l=s<2?2:s,u=(o>0?o:0)+Me,d=t+q/2,f=this.getText(e)||``,p=this.getSubtext(e)||``,m,h=0,g=s+o-u,_=ve(this.getColor(e)||this.palette.fallback,this.c,this.zoomedOutMin-this.viewportMin*a,q,a*this.stripeScaleAdjust),v=this.palette.text,y=-1/0;i&1?(v=this.palette.fg,this.setFont(je)):(this.c.fillStyle=_,this.c.fillRect(o,t,l,q),(i&2||this.hoveredNode&&e.id===this.hoveredNode.id)&&(this.c.fillStyle=this.palette.hover,this.c.fillRect(o,t,l,q),i|=2)),this.ellipsisWidth<g&&(m=this.c.measureText(f).width,m<=g?h+=m:(f=this.textOverflowEllipsis(f,g)[0],h=g),this.c.fillStyle=v,this.c.fillText(f,u,d)),i&1&&this.setFont(G),h+this.ellipsisWidth<g&&(p&&f&&(p=` - ${p}`),m=this.c.measureText(p).width,h+m>g&&(p=this.textOverflowEllipsis(p,g-h)[0]),this.c.globalAlpha=.5,this.c.fillText(p,u+h,d),this.c.globalAlpha=1);for(let r of e.children)y=this.drawNode(r,t+q,n,y,i&-2),n+=r.size;return i&1||De(this.c,this.palette.stroke,o+.5,t+.5,l,q),c}changeHoveredNode(e){this.hoveredNode!==e&&(this.hoveredNode=e,this.canvas.style.cursor=e&&!e.children.length?`pointer`:`auto`,this.invalidate())}hitTestNode(e){let t=this.canvas.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top,i=this.viewportMin+(this.viewportMax-this.viewportMin)/this.zoomedOutWidth*(n-this.zoomedOutMin),a=(e,t,n)=>{if(i>=n&&i<n+e.size){if(r>=t&&r<t+q&&e.id)return e;if(r>=t+q)for(let r of e.children){let e=a(r,t+q,n);if(e)return e;n+=r.size}}return null};return a(this.root,0,0)}modifyViewport(e,t,n){let r=this.viewportMin,i=this.viewportMax,a=0;if(n!==null){let e=r+(i-r)/this.zoomedOutWidth*(n-this.zoomedOutMin),a=1.01**t;r=e+(r-e)*a,i=e+(i-e)*a}else a=e*(i-r)/this.zoomedOutWidth;r+a<0?a=-r:i+a>this.totalBytes&&(a=this.totalBytes-i),r+=a,i+=a,r<0&&(r=0),i>this.totalBytes&&(i=this.totalBytes),this.setViewport(r,i,!1)}setViewport(e,t,n){this.animationFromMin=this.viewportMin,this.animationFromMax=this.viewportMax,this.animationToMin=e,this.animationToMax=t,n?this.animationStart=B():this.animationStart=0,this.invalidate()}updateHover(e){let t=this.hitTestNode(e);this.changeHoveredNode(t),this.events.emit(`hover`,t,e)}};function Ie(e,t){for(;t;){if(t===e)return!0;t=t.parent}return!1}function J(e,t,n){if(e===t)return;let r=t.parent,i=r.size||1,a=0;J(e,r,n);for(let e of r.children){if(e===t){n.startAngle_+=n.sweepAngle_*a/i,n.sweepAngle_=e.size/i*n.sweepAngle_;break}a+=e.size}n.depth_+=1}var Y={};function Le(e){return Y[e]||(Y[e]=400*Math.log(1+Math.log(1+e/8))),Y[e]}var X=-Math.PI/2,Re=class extends K{currentNode;hoveredNode;centerX=0;centerY=0;animationStart=0;radiusScale=1;sourceDepth=0;sourceStartAngle=X;sourceSweepAngle=Math.PI*2;targetNode;targetDepth=this.sourceDepth;targetStartAngle=this.sourceStartAngle;targetSweepAngle=this.sourceSweepAngle;animatedNode;animatedDepth=this.sourceDepth;animatedStartAngle=this.sourceStartAngle;animatedSweepAngle=this.sourceSweepAngle;previousHoveredNode;historyStack=[];constructor(e,t={}){for(;e.children.length===1;)e=e.children[0];super(e,t),this.currentNode=e,this.targetNode=this.currentNode,this.animatedNode=this.currentNode,this.canvas.onmousemove=e=>{this.handleMouseMove(e)},this.canvas.onmouseout=e=>{this.changeHoveredNode(void 0),this.events.emit(`hover`,null,e)},this.canvas.onclick=e=>{let t=this.hitTestNode(e);if(!t)return;this.events.emit(`click`,t,e);let n=[];t===this.animatedNode.parent?this.historyStack.length>0&&(t=this.historyStack.pop(),n=this.historyStack.slice()):n=this.historyStack.concat(this.currentNode),this.events.emit(`click`,t,e),t.children.length>0?(this.select(t),this.historyStack=n):e.preventDefault()},this.el.append(this.canvas),this.resize(),Promise.resolve().then(()=>this.resize()),this.disposables.push(U(()=>this.resize())),this.disposables.push(H(e=>this.handleMouseMove(e)))}select(e,t){(this.currentNode!==e||this.root)&&(this.currentNode=e||this.root,this.updateSunburst(t),this.events.emit(`select`,e))}resize(){this.width=this.el.clientWidth,this.height=this.width,this.centerX=this.width>>1,this.centerY=this.height>>1;let e=2*Math.ceil(Le(this.maxDepth));this.radiusScale=this.width/e,super.resize()}draw(){this.c.clearRect(0,0,this.width,this.height),this.drawNode(this.animatedNode,this.animatedDepth,this.computeRadius(this.animatedDepth),this.animatedStartAngle,this.animatedSweepAngle,3,-1/0),this.c.strokeStyle=this.palette.stroke,this.c.beginPath(),this.drawNode(this.animatedNode,this.animatedDepth,this.computeRadius(this.animatedDepth),this.animatedStartAngle,this.animatedSweepAngle,1,-1/0),this.c.stroke(),this.animatedDepth===0&&(this.c.fillStyle=this.palette.stroke,this.setFont(je),this.c.textAlign=`center`,this.c.fillText(this.getSubtext(this.targetNode)??Ee(this.targetNode.size),this.centerX,this.centerY))}drawNode(e,t,n,r,i,a,o){let s=this.computeRadius(t+1);if(s>this.centerY)return o;e===this.hoveredNode&&(a|=8);let c=(n+s)/2,l=r+i;if(l-o<1.5/c)return o;let u=2/c;if(i>u&&(u=i),a&2)this.c.fillStyle=ve(this.getColor(e)||this.palette.fallback,this.c,this.centerX,this.centerY,1),this.c.beginPath(),this.c.arc(this.centerX,this.centerY,n,r,r+u,!1),this.c.arc(this.centerX,this.centerY,s,r+u,r,!0),this.c.fill(),this.hoveredNode&&(a&8||e.parent===this.hoveredNode)&&(this.c.fillStyle=this.palette.hover,this.c.fill());else{let e=u===Math.PI*2,t=a&4||e?s:n;a&1&&n>0&&this.c.arc(this.centerX,this.centerY,n,r+u,r,!0),this.c.moveTo(this.centerX+t*Math.cos(r),this.centerY+t*Math.sin(r)),this.c.arc(this.centerX,this.centerY,s,r,r+u,!1),e||this.c.lineTo(this.centerX+n*Math.cos(r+u),this.centerY+n*Math.sin(r+u))}let d=e.size,f=a&10,p=0,m=-1/0;for(let n of e.children)m=this.drawNode(n,t+1,s,r+i*p/d,n.size/d*i,f,m),p+=n.size,f|=4;return l}changeHoveredNode(e,t){this.hoveredNode!==e&&(this.hoveredNode=e,this.updateSunburst(t))}hitTestNode(e){let t=this.canvas.getBoundingClientRect(),n=e.clientX-t.left-this.centerX,r=e.clientY-t.top-this.centerY,i=Math.sqrt(n*n+r*r),a=Math.atan2(r,n),o=(e,t,n,r,s)=>{let c=this.computeRadius(t+1);if(c>this.centerY)return;if(i>=n&&i<c){let t=a-r;if(t/=Math.PI*2,t-=Math.floor(t),t*=Math.PI*2,t<s)return e===this.animatedNode?e.parent:e}let l=e.size,u=0;for(let n of e.children){let e=o(n,t+1,c,r+s*u/l,n.size/l*s);if(e)return e;u+=n.size}};return o(this.animatedNode,this.animatedDepth,this.computeRadius(this.animatedDepth),this.animatedStartAngle,this.animatedSweepAngle)}tick(){let e=(B()-this.animationStart)/(this.options.animateDuration??W.animateDuration);e<0||e>1?(e=1,this.animatedNode=this.targetNode,this.targetDepth=0,this.targetStartAngle=X,this.targetSweepAngle=Math.PI*2):(e<.5?e*=4*e*e:(e=1-e,e*=4*e*e,e=1-e),this.invalidate()),this.animatedDepth=this.sourceDepth+(this.targetDepth-this.sourceDepth)*e,this.animatedStartAngle=this.sourceStartAngle+(this.targetStartAngle-this.sourceStartAngle)*e,this.animatedSweepAngle=this.sourceSweepAngle+(this.targetSweepAngle-this.sourceSweepAngle)*e,this.draw()}handleMouseMove(e){let t=this.hitTestNode(e);this.changeHoveredNode(t),t&&t!==this.animatedNode.parent?(this.events.emit(`hover`,t,e),this.canvas.style.cursor=`pointer`):this.events.emit(`hover`,null,e)}computeRadius(e){return Le(e)*this.radiusScale}updateSunburst(e=this.options.animate??!0){if(this.previousHoveredNode!==this.hoveredNode&&(this.previousHoveredNode=this.hoveredNode,this.hoveredNode||(this.canvas.style.cursor=`auto`,this.events.emit(`hover`,null)),this.invalidate()),this.targetNode!==this.currentNode){if(this.historyStack.length=0,this.invalidate(),e&&(this.animationStart=B()),Ie(this.animatedNode,this.currentNode)){let e={depth_:this.animatedDepth,startAngle_:this.animatedStartAngle,sweepAngle_:this.animatedSweepAngle};J(this.animatedNode,this.currentNode,e),this.animatedDepth=e.depth_,this.animatedStartAngle=e.startAngle_,this.animatedSweepAngle=e.sweepAngle_,this.targetDepth=0,this.targetStartAngle=X,this.targetSweepAngle=Math.PI*2,this.animatedNode=this.currentNode}else if(Ie(this.currentNode,this.animatedNode)){let e={depth_:0,startAngle_:X,sweepAngle_:Math.PI*2};J(this.currentNode,this.animatedNode,e),this.targetDepth=e.depth_,this.targetStartAngle=e.startAngle_,this.targetSweepAngle=e.sweepAngle_}else this.animationStart=-1/0,this.animatedNode=this.currentNode;this.sourceDepth=this.animatedDepth,this.sourceStartAngle=this.animatedStartAngle,this.sourceSweepAngle=this.animatedSweepAngle,this.targetNode=this.currentNode,this.events.emit(`select`,this.currentNode)}}},Z=4,Q=20,ze=2*Z,$=Q+Z;function Be(e,t,n,r,i){let a=[],o=(t,n,r,i,a)=>{let o=e[t].size*a,s=e[n].size*a;return Math.max(r*r*o/(i*i),i*i/(r*r*s))};return((t,n,r,i,s)=>{for(;t<e.length;){let c=0;for(let n=t;n<e.length;n++)c+=e[n].size;let l=Math.min(i,s),u=i*s/c,d=t,f=0,p=0;for(;d<e.length;){let n=e[d].size*u,r=o(t,d,l,f+n,u);if(d>t&&p<r)break;f+=n,p=r,d++}let m=Math.round(f/l),h=0;for(let o=t;o<d;o++){let t=e[o],c=t.size*u,d=Math.round(l*h/f),p=Math.round(l*(h+c)/f),[g,_,v,y]=i>=s?[n,r+d,m,p-d]:[n+d,r,p-d,m];a.push({node:t,box:[g,_,v,y],children:v>ze&&y>$?Be(t.children,g+Z,_+Q,v-ze,y-$):[]}),h+=c}t=d,i>=s?(n+=m,i-=m):(r+=m,s-=m)}})(0,t,n,r,i),a}var Ve=class extends K{hoveredNode=null;currentNode=null;bgOriginX=0;bgOriginY=0;layers={base:null};baseLayoutCache;currentOriginX=0;currentOriginY=0;animationStart=0;animationBlend=1;animationSource=null;animationTarget=null;constructor(e,t={}){super(e,t),this.canvas.addEventListener(`mousemove`,e=>{this.updateHover(e)}),this.canvas.addEventListener(`mouseout`,e=>{this.changeHoveredNode(null),this.events.emit(`hover`,null,e)}),this.el.addEventListener(`click`,e=>{let t=this.hitTestNode(e);if(t){let n=t.node;this.events.emit(`click`,n,e),n.children.length?t===this.layers.current?this.updateHover(e):(this.changeCurrentLayout(t),this.changeHoveredNode(null)):this.updateHover(e)}else this.currentNode&&(this.changeCurrentLayout(null),this.updateHover(e))}),this.el.append(this.canvas),this.resize(),Promise.resolve().then(()=>this.resize()),this.disposables.push(H(e=>this.updateHover(e))),this.disposables.push(U(()=>this.resize()))}select(e,t){let n=null;e===this.root&&(e=null),n=e?this.searchFor([this.layers.current,this.layers.base],e):null,this.changeCurrentLayout(n,t)}drawBaseLayout(){!this.width||!this.height||(this.c.clearRect(0,0,this.width,this.height),this.bgOriginX=this.bgOriginY=0,this.baseLayoutCache?this.c.putImageData(this.baseLayoutCache,0,0):(this.drawLayout(this.layers.base,0,[]),this.baseLayoutCache=this.c.getImageData(0,0,this.width*this.ratio,this.height*this.ratio)))}draw(){this.drawBaseLayout(),this.layers.current||this.drawHoverHighlight(this.layers.base);let e=this.layers.current?this.animationSource?this.animationTarget?1:1-this.animationBlend:this.animationBlend:0;if(this.layers.current){let[t,n,r,i]=this.layers.base.box;this.c.globalAlpha=.6*(!this.layers.current||!this.animationSource?1:e),this.c.fillStyle=this.palette.bg,this.c.fillRect(t,n,r,i),this.c.globalAlpha=1}if(this.layers.previous&&this.drawLayout(this.layers.previous,1,[this.layers.current]),this.layers.current){let[t,n,r,i]=this.layers.current.box,a=this.c.getTransform(),o=Math.sqrt(a.a*a.d);this.c.save(),this.c.shadowColor=this.palette.shadow,this.c.shadowBlur=o*(30*e),this.c.shadowOffsetX=o*(2*this.width),this.c.shadowOffsetY=o*(2*this.height+15*e),this.c.fillRect(t-2*this.width,n-2*this.height,r,i),this.c.restore(),this.bgOriginX=this.currentOriginX,this.bgOriginY=this.currentOriginY,this.drawLayout(this.layers.current,0,[]),this.drawHoverHighlight(this.layers.current)}}tick(){let e=this.animationBlend,t=this.currentNode;this.animationBlend=(B()-this.animationStart)/(this.options.animateDuration??W.animateDuration),this.animationBlend<0||this.animationBlend>1?(this.currentNode=this.animationTarget,this.layers.previous=void 0,this.animationBlend=1):(this.animationBlend=1-this.animationBlend,this.animationBlend*=this.animationBlend*this.animationBlend,this.animationBlend=1-this.animationBlend,this.invalidate()),(this.animationBlend!==e||this.currentNode!==t)&&this.updateCurrentLayout(),this.draw()}resize(){this.baseLayoutCache=void 0;let e=this.width,t=this.height;this.width=Math.min(this.el.clientWidth,1600),this.height=Math.max(Math.round(this.width/2),innerHeight-200),(this.width!==e||this.height!==t||!this.layers.base)&&(this.layers.base=Be([this.root],0,0,this.width-1,this.height-1)[0],this.updateCurrentLayout()),super.resize()}*iterateNodeToDraw(e,t,n){let r=e.node,[i,a,o,s]=e.box,c=(r===this.hoveredNode?1:0)|(e===this.animationTarget?2:0);if(t===1)for(let e of n){if(!e)continue;let[n,r,c,l]=e.box;if(i>=n&&a>=r&&i+o<=n+c&&a+s<=r+l){t=2;break}}for(let r of e.children)c|=yield*this.iterateNodeToDraw(r,t,n);return t!==2&&(yield e),c}drawHoverHighlight(e){let t=this.iterateNodeToDraw(e,0,[]),n=this.c.globalCompositeOperation;for(;;){let e=t.next();if(e.done){this.c.globalCompositeOperation=n;return}let r=e.value.node;if(this.hoveredNode===r){this.c.globalCompositeOperation=`overlay`;let[t,n,r,i]=e.value.box;this.c.fillStyle=this.palette.hover,this.c.fillRect(t,n,r,i)}}}drawNodeBackground(e,t,n){let r=this.iterateNodeToDraw(e,t,n);for(;;){let e=r.next();if(e.done)return e.value;let[t,n,i,a]=e.value.box;this.c.fillStyle=ve(this.getColor(e.value.node)||this.palette.fallback,this.c,this.bgOriginX,this.bgOriginY,1),e.value.children.length?(this.c.fillRect(t,n,i,Q),this.c.fillRect(t,n+a-Z,i,Z),this.c.fillRect(t,n+Q,Z,a-$),this.c.fillRect(t+i-Z,n+Q,Z,a-$)):this.c.fillRect(t,n,i,a)}}drawLayout(e,t,n){this.drawNodeBackground(e,t,n),this.drawNodeForeground(e,t,n)}drawNodeForeground(e,t,n){let r=this.iterateNodeToDraw(e,t,n);for(;;){let e=r.next();if(e.done)return;let t=e.value.node,[n,i,a,o]=e.value.box;if(De(this.c,this.palette.stroke,n+.5,i+.5,a,o),o>=Q){this.c.fillStyle=this.palette.text;let e=a-ze,r=i+Math.round($/2),[s,c]=this.textOverflowEllipsis(this.getText(t)||``,e),l=n+Math.round((a-c)/2),u=this.getText(t),d=this.getSubtext(t);if(s===u&&t.children.length){let t=d||``;t&&u&&(t=` - ${t}`);let[i,o]=this.textOverflowEllipsis(t,e-c);l=n+Math.round((a-c-o)/2),this.c.globalAlpha=.5,this.c.fillText(i,l+c,r),this.c.globalAlpha=1}if(this.c.fillText(s,l,r),o>$+16&&!t.children.length){let[t,r]=this.textOverflowEllipsis(d||``,e);this.c.globalAlpha=.5;let s=u?Q:Q/2+Z;this.c.fillText(t,n+Math.round((a-r)/2),i+s+Math.round(o-$)/2),this.c.globalAlpha=1}}}}updateCurrentLayout(){let e=this.options.selectedPaddingRatio??.2;if(this.currentNode){let[t,n,r,i]=this.currentNode.box,a=t+r,o=n+i,s=Math.round(this.width*e/2),c=Math.round(this.height*e/2),l=this.width-s-1,u=this.height-c-1,d=this.animationTarget?this.animationBlend:1-this.animationBlend,f=Math.round(t+(s-t)*d),p=Math.round(n+(c-n)*d),m=Math.round(a+(l-a)*d),h=Math.round(o+(u-o)*d),g=e=>e-Math.floor(e/64-.5)*64;this.layers.current=Be([this.currentNode.node],f,p,m-f,h-p)[0],this.currentOriginX=g(-(t+a)/2)*(1-d)+(f+m)/2,this.currentOriginY=g(-(n+o)/2)*(1-d)+(p+h)/2}else this.layers.current=void 0,this.currentOriginX=0,this.currentOriginY=0}hitTestNode(e){let t=this.canvas.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top,i=(e,t)=>{for(let a of e){let[e,o,s,c]=a.box;if(n>=e&&r>=o&&n<e+s&&r<o+c)return i(a.children,!1)||(t?null:a)}return null};return this.layers.current?i([this.layers.current],!1):i([this.layers.base],!0)}updateHover(e){let t=this.hitTestNode(e);this.changeHoveredNode(t&&t.node),this.events.emit(`hover`,t?.node||null,e)}changeHoveredNode(e){this.hoveredNode!==e&&(this.hoveredNode=e,this.canvas.style.cursor=e&&!e.children.length?`pointer`:`auto`,this.invalidate())}searchFor(e,t){for(let n of e){if(!n)continue;let e=n.node===t?n:this.searchFor(n.children,t);if(e)return e}return null}changeCurrentLayout(e,t=this.options.animate){this.animationTarget!==e&&(this.events.emit(`select`,e?.node||null),this.layers.previous=e?this.layers.current:void 0,t&&(this.animationBlend=0,this.animationStart=B(),this.animationSource=this.currentNode),this.animationTarget=e,this.currentNode=e||this.searchFor([this.layers.base],this.currentNode.node),this.updateCurrentLayout(),this.invalidate())}},He={flex:`~ col gap-4`},Ue={key:0,grid:`~ cols-[250px_1fr] gap-1`},We=[`onClick`],Ge={key:0,"text-primary":``},Ke={key:2},qe=[`onClick`],Je=[`title`],Ye=l({__name:`SunburstSide`,props:{selected:{},options:{}},emits:[`select`],setup(e,{emit:a}){let o=a;return(a,c)=>{let l=P,d=E,f=le,p=ie(`tooltip`);return i(),C(`div`,He,[s(l,{border:`b base`,py2:``,selected:e.selected,options:e.options,onSelect:c[0]||=e=>o(`select`,e)},null,8,[`selected`,`options`]),e.selected?(i(),C(`div`,Ue,[(i(!0),C(t,null,g(e.selected.children,a=>(i(),C(t,{key:a.id},[r(`button`,{"ws-nowrap":``,"text-nowrap":``,"text-left":``,"overflow-hidden":``,"text-ellipsis":``,"text-sm":``,hover:`bg-active`,rounded:``,px2:``,onClick:e=>o(`select`,a)},[a.meta&&a.meta===e.selected?.meta?(i(),C(`span`,Ge,`(self)`)):a.meta?(i(),n(d,{key:1,pkg:a.meta},null,8,[`pkg`])):(i(),C(`span`,Ke,x(a.id),1))],8,We),r(`button`,{relative:``,flex:`~ gap-1 items-center`,hover:`bg-active`,rounded:``,onClick:e=>o(`select`,a)},[r(`div`,{"h-5":``,rounded:``,shadow:``,border:`~ base`,style:ee({background:b(ye)(e.options.getColor?.(a)||`#000`),width:`${a.size/e.selected.size*100}%`})},null,4),s(f,{"text-xs":``,bytes:a.size,total:e.selected.size,"percent-ratio":3},null,8,[`bytes`,`total`]),a.children.length>0?te((i(),C(`div`,{key:0,title:`${a.children.length} dependencies`,"text-xs":``,"op-fade":``},[S(` (`+x(a.children.length)+`) `,1)],8,Je)),[[p,`${a.children.length} dependencies`]]):u(``,!0)],8,qe)],64))),128))])):u(``,!0)])}}}),Xe=Object.assign(Ye,{__name:`ChartSunburstSide`}),Ze={grid:`~ cols-[max-content_1fr]`},Qe=l({__name:`Sunburst`,props:{graph:{},selected:{}},emits:[`select`],setup(e,{emit:t}){let n=e,a=t,o=_(`el`);return d(()=>o.value?.append(n.graph.el)),(t,n)=>{let c=Xe;return i(),C(`div`,Ze,[r(`div`,{ref_key:`el`,ref:o,"w-500px":``},null,512),s(c,{options:e.graph.options,selected:e.selected,onSelect:n[0]||=e=>a(`select`,e)},null,8,[`options`,`selected`])])}}}),$e=Object.assign(Qe,{__name:`ChartSunburst`}),et={flex:`~ gap-2 items-center wrap`},tt={mt5:``},nt={flex:`~ gap-1 items-center`},rt={flex:`~ gap-1 items-center`},it=l({__name:`[...chart]`,setup(l){let d=ae(h()),g=re().params,_=p(()=>g.chart?.[0]||`treemap`),x=w(void 0),O=w(void 0),k=window.location,A=p(()=>{let e=ce.filtered.packages,t=Math.min(...e.map(e=>e.depth)),n=new Map,r=0,i={id:`~root`,text:`Project`,size:0,sizeSelf:0,children:[]},a=[],s=[];s.unshift(()=>{i.size+=i.children.reduce((e,t)=>e+t.size,0),i.subtext=T(i.size).join(` `),i.children.sort((e,t)=>t.size-e.size||e.id.localeCompare(t.id))});function c(e,t,i){if(n.has(e))return;i>r&&(r=i);let l={id:e.spec,text:e.name,sizeSelf:e.resolved.installSize?.bytes||0,size:e.resolved.installSize?.bytes||0,children:[],meta:e,parent:t};n.set(e,l);let[u,d]=o(ce.filtered.dependencies(e).filter(e=>!n.has(e)),t=>t.shallowestDependent?.has(e.spec));return a.unshift(()=>{l.children.push(...u.map(e=>c(e,l,i+1)).filter(e=>!!e))}),a.push(()=>{l.children.push(...d.map(e=>c(e,l,i+1)).filter(e=>!!e))}),s.unshift(()=>{let e=l.size;l.size+=l.children.reduce((e,t)=>e+t.size,0),l.subtext=T(l.size).join(` `),l.children.length&&e/l.size>.1&&l.children.push({id:`${l.id}-self`,text:``,size:e,sizeSelf:e,subtext:T(e).join(` `),children:[],meta:l.meta,parent:l}),l.children.sort((e,t)=>t.size-e.size||e.id.localeCompare(t.id))}),l}i.children=e.filter(e=>e.depth===t).map(e=>c(e,i,1)).filter(e=>!!e);function l(){let e=[...a];a.length=0,e.forEach(e=>e()),a.length&&l()}return l(),s.forEach(e=>e()),{map:n,root:i,maxDepth:r}}),j,M=p(()=>({onClick(e){e&&(x.value=e),e.meta&&(D.value=e.meta)},onHover(e){e&&(x.value=e)},onLeave(){x.value=void 0},onSelect(e){O.value=e||void 0,D.value=e?.meta},animate:a.value.chartAnimation,palette:{stroke:y.value?`#222`:`#555`,fg:y.value?`#fff`:`#000`,bg:y.value?`#111`:`#fff`},getColor:a.value.chartColoringMode===`module`?e=>{if(e.meta)switch(c(e.meta?.resolved.module)){case`esm`:return`#4ade80`;case`cjs`:return`#facc15`;case`dual`:return`#2dd4bf`;case`faux`:return`#a3e635`;case`dts`:return`#888888`}}:xe(A.value.root,y.value?.8:.9,y.value?1:1.1),getSubtext:e=>e.meta&&a.value.chartColoringMode===`module`?c(e.meta?.resolved.module).toUpperCase():e.subtext})),N=w(void 0);function P(e,t){D.value=e?.meta,e?.children.length||(e=e?.parent||null),N.value?.select(e,t)}return v(()=>[_.value,A.value,M.value],()=>{switch(j?.(),O.value=A.value.root,_.value){case`sunburst`:N.value=new Re(A.value.root,M.value);break;case`frame`:N.value=new Fe(A.value.root,M.value);break;default:N.value=new Ve(A.value.root,{...M.value,selectedPaddingRatio:0})}f(()=>{let e=D.value&&A.value.map.get(D.value)||null;e&&P(e,!1)}),j=()=>{N.value?.dispose(),N.value=void 0}},{deep:!0,immediate:!0}),v(()=>a.value.chartColoringMode,()=>{N.value?.draw()}),v(()=>ue.value,()=>{let e=Date.now(),t=()=>{N.value?.resize(),N.value&&Date.now()-e<3e3&&requestAnimationFrame(t)};requestAnimationFrame(t)},{immediate:!0}),m(()=>{j?.()}),(o,c)=>{let l=oe,f=se,p=de,m=pe,h=$e,g=E,v=ne,y=le,re=ie(`tooltip`);return i(),C(t,null,[r(`div`,et,[s(l,{"btn-action":``,as:`button`,to:{path:`/chart/treemap`,hash:b(k).hash},"active-class":`text-primary bg-primary:5`},{default:e(()=>[...c[4]||=[r(`div`,{"i-ph-checkerboard-duotone":``},null,-1),S(` Treemap `,-1)]]),_:1},8,[`to`]),s(l,{"btn-action":``,as:`button`,to:{path:`/chart/sunburst`,hash:b(k).hash},"active-class":`text-primary bg-primary:5`},{default:e(()=>[...c[5]||=[r(`div`,{"i-ph-chart-donut-duotone":``},null,-1),S(` Sunburst `,-1)]]),_:1},8,[`to`]),s(l,{"btn-action":``,as:`button`,to:{path:`/chart/frame`,hash:b(k).hash},"active-class":`text-primary bg-primary:5`},{default:e(()=>[...c[6]||=[r(`div`,{"i-ph-chart-bar-horizontal-duotone":``},null,-1),S(` Framegraph `,-1)]]),_:1},8,[`to`]),c[7]||=r(`div`,{"flex-auto":``},null,-1),te(s(f,{modelValue:b(a).chartColoringMode,"onUpdate:modelValue":c[0]||=e=>b(a).chartColoringMode=e,options:[`spectrum`,`module`],titles:[`Spectrum`,`Module`]},null,8,[`modelValue`]),[[re,`Color Mode`]])]),r(`div`,tt,[_.value===`frame`&&N.value?(i(),n(p,{key:0,graph:N.value,selected:O.value,onSelect:c[1]||=e=>P(e)},null,8,[`graph`,`selected`])):u(``,!0),_.value===`treemap`&&N.value?(i(),n(m,{key:1,graph:N.value,selected:O.value,onSelect:c[2]||=e=>P(e)},null,8,[`graph`,`selected`])):u(``,!0),_.value===`sunburst`&&N.value?(i(),n(h,{key:2,graph:N.value,selected:O.value,onSelect:c[3]||=e=>P(e)},null,8,[`graph`,`selected`])):u(``,!0)]),x.value?.meta?(i(),C(`div`,{key:0,"bg-glass":``,fixed:``,"z-panel-nav":``,border:`~ base rounded`,p2:``,"text-sm":``,flex:`~ col gap-2`,style:ee({left:`${d.x+10}px`,top:`${d.y+10}px`})},[r(`div`,nt,[s(g,{pkg:x.value.meta,"text-base":``},null,8,[`pkg`]),s(v,{pkg:x.value.meta},null,8,[`pkg`])]),r(`div`,rt,[s(y,{bytes:x.value.meta.resolved.installSize?.bytes,percent:!1},null,8,[`bytes`]),x.value.meta.resolved.installSize?.bytes===x.value.size?u(``,!0):(i(),C(t,{key:0},[c[8]||=r(`span`,{"op-fade":``},`/`,-1),s(y,{bytes:x.value.size,percent:!1},null,8,[`bytes`])],64))])],4)):u(``,!0)],64)}}});export{it as default};