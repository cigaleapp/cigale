function e(e,t){return e[13]=1,e[14]=t>>8,e[15]=t&255,e[16]=t>>8,e[17]=t&255,e}var t=112,n=72,r=89,i=115,a;function o(){let e=new Int32Array(256);for(let t=0;t<256;t++){let n=t;for(let e=0;e<8;e++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e}function s(e){let t=-1;a||=o();for(let n=0;n<e.length;n++)t=a[(t^e[n])&255]^t>>>8;return t^-1}function c(e){let a=e.length-1;for(let o=a;o>=4;o--)if(e[o-4]===9&&e[o-3]===t&&e[o-2]===n&&e[o-1]===r&&e[o]===i)return o-3;return 0}function l(e,a,o=!1){let l=new Uint8Array(13);a*=39.3701,l[0]=t,l[1]=n,l[2]=r,l[3]=i,l[4]=a>>>24,l[5]=a>>>16,l[6]=a>>>8,l[7]=a&255,l[8]=l[4],l[9]=l[5],l[10]=l[6],l[11]=l[7],l[12]=1;let u=s(l),d=new Uint8Array(4);if(d[0]=u>>>24,d[1]=u>>>16,d[2]=u>>>8,d[3]=u&255,o){let t=c(e);return e.set(l,t),e.set(d,t+13),e}else{let t=new Uint8Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=9;let n=new Uint8Array(54);return n.set(e,0),n.set(t,33),n.set(l,37),n.set(d,50),n}}var u=`AAlwSFlz`,d=`AAAJcEhZ`,f=`AAAACXBI`;function p(e){let t=e.indexOf(u);return t===-1&&(t=e.indexOf(d)),t===-1&&(t=e.indexOf(f)),t}var m=`[modern-screenshot]`,h=typeof window<`u`,g=h&&`Worker`in window,_=h&&`atob`in window,v=h&&`btoa`in window,y=h?window.navigator?.userAgent:``,b=y.includes(`Chrome`),x=y.includes(`AppleWebKit`)&&!b,S=y.includes(`Firefox`),ee=e=>e&&`__CONTEXT__`in e,te=e=>e.constructor.name===`CSSFontFaceRule`,ne=e=>e.constructor.name===`CSSImportRule`,C=e=>e.nodeType===1,w=e=>typeof e.className==`object`,T=e=>e.tagName===`image`,re=e=>e.tagName===`use`,E=e=>C(e)&&e.style!==void 0&&!w(e),ie=e=>e.nodeType===8,ae=e=>e.nodeType===3,D=e=>e.tagName===`IMG`,O=e=>e.tagName===`VIDEO`,oe=e=>e.tagName===`CANVAS`,se=e=>e.tagName===`TEXTAREA`,ce=e=>e.tagName===`INPUT`,le=e=>e.tagName===`STYLE`,ue=e=>e.tagName===`SCRIPT`,de=e=>e.tagName===`SELECT`,fe=e=>e.tagName===`SLOT`,pe=e=>e.tagName===`IFRAME`,me=(...e)=>console.warn(m,...e);function he(e){let t=e?.createElement?.(`canvas`);return t&&(t.height=t.width=1),!!t&&`toDataURL`in t&&!!t.toDataURL(`image/webp`).includes(`image/webp`)}var k=e=>e.startsWith(`data:`);function A(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(h&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!h)return e;let n=j().implementation.createHTMLDocument(),r=n.createElement(`base`),i=n.createElement(`a`);return n.head.appendChild(r),n.body.appendChild(i),t&&(r.href=t),i.href=e,i.href}function j(e){return(e&&C(e)?e?.ownerDocument:e)??window.document}var M=`http://www.w3.org/2000/svg`;function ge(e,t,n){let r=j(n).createElementNS(M,`svg`);return r.setAttributeNS(null,`width`,e.toString()),r.setAttributeNS(null,`height`,t.toString()),r.setAttributeNS(null,`viewBox`,`0 0 ${e} ${t}`),r}function _e(e,t){let n=new XMLSerializer().serializeToString(e);return t&&(n=n.replace(/[\u0000-\u0008\v\f\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/gu,``)),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(n)}`}function ve(e,t){return new Promise((n,r)=>{let i=new FileReader;i.onload=()=>n(i.result),i.onerror=()=>r(i.error),i.onabort=()=>r(Error(`Failed read blob to ${t}`)),t===`dataUrl`?i.readAsDataURL(e):t===`arrayBuffer`&&i.readAsArrayBuffer(e)})}var ye=e=>ve(e,`dataUrl`);function N(e,t){let n=j(t).createElement(`img`);return n.decoding=`sync`,n.loading=`eager`,n.src=e,n}function P(e,t){return new Promise(n=>{let{timeout:r,ownerDocument:i,onError:a,onWarn:o}=t??{},s=typeof e==`string`?N(e,j(i)):e,c=null,l=null;function u(){n(s),c&&clearTimeout(c),l?.()}if(r&&(c=setTimeout(u,r)),O(s)){let e=s.currentSrc||s.src;if(!e)return s.poster?P(s.poster,t).then(n):u();if(s.readyState>=2)return u();let r=u,i=t=>{o?.(`Failed video load`,e,t),a?.(t),u()};l=()=>{s.removeEventListener(`loadeddata`,r),s.removeEventListener(`error`,i)},s.addEventListener(`loadeddata`,r,{once:!0}),s.addEventListener(`error`,i,{once:!0})}else{let e=T(s)?s.href.baseVal:s.currentSrc||s.src;if(!e)return u();let t=async()=>{if(D(s)&&`decode`in s)try{await s.decode()}catch(t){o?.(`Failed to decode image, trying to render anyway`,s.dataset.originalSrc||e,t)}u()},n=t=>{o?.(`Failed image load`,s.dataset.originalSrc||e,t),u()};if(D(s)&&s.complete)return t();l=()=>{s.removeEventListener(`load`,t),s.removeEventListener(`error`,n)},s.addEventListener(`load`,t,{once:!0}),s.addEventListener(`error`,n,{once:!0})}})}async function F(e,t){E(e)&&(D(e)||O(e)?await P(e,t):await Promise.all([`img`,`video`].flatMap(n=>Array.from(e.querySelectorAll(n)).map(e=>P(e,t)))))}var I=function(){let e=0,t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)}();function L(e){return e?.split(`,`).map(e=>e.trim().replace(/"|'/g,``).toLowerCase()).filter(Boolean)}var R=0;function be(e){let t=`${m}[#${R}]`;return R++,{time:n=>e&&console.time(`${t} ${n}`),timeEnd:n=>e&&console.timeEnd(`${t} ${n}`),warn:(...t)=>e&&me(...t)}}function xe(e){return{cache:e?`no-cache`:`force-cache`}}async function z(e,t){return ee(e)?e:B(e,{...t,autoDestruct:!0})}async function B(e,t){let{scale:n=1,workerUrl:r,workerNumber:i=1}=t||{},a=!!t?.debug,o=t?.features??!0,s=e.ownerDocument??(h?window.document:void 0),c=e.ownerDocument?.defaultView??(h?window:void 0),l=new Map,u={width:0,height:0,quality:1,type:`image/png`,scale:n,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:a,fetch:{requestInit:xe(t?.fetch?.bypassingCache),placeholderImage:`data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7`,bypassingCache:!1,...t?.fetch},fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:i,onCloneEachNode:null,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1,...t,__CONTEXT__:!0,log:be(a),node:e,ownerDocument:s,ownerWindow:c,dpi:n===1?null:96*n,svgStyleElement:V(s),svgDefsElement:s?.createElementNS(M,`defs`),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...Array.from({length:g&&r&&i?i:0})].map(()=>{try{let e=new Worker(r);return e.onmessage=async e=>{let{url:t,result:n}=e.data;n?l.get(t)?.resolve?.(n):l.get(t)?.reject?.(Error(`Error receiving message from worker: ${t}`))},e.onmessageerror=e=>{let{url:t}=e.data;l.get(t)?.reject?.(Error(`Error receiving message from worker: ${t}`))},e}catch(e){return u.log.warn(`Failed to new Worker`,e),null}}).filter(Boolean),fontFamilies:new Map,fontCssTexts:new Map,acceptOfImage:`${[he(s)&&`image/webp`,`image/svg+xml`,`image/*`,`*/*`].filter(Boolean).join(`,`)};q=0.8`,requests:l,drawImageCount:0,tasks:[],features:o,isEnable:e=>e===`restoreScrollPosition`?typeof o==`boolean`?!1:o[e]??!1:typeof o==`boolean`?o:o[e]??!0,shadowRoots:[]};u.log.time(`wait until load`),await F(e,{timeout:u.timeout,onWarn:u.log.warn}),u.log.timeEnd(`wait until load`);let{width:d,height:f}=Se(e,u);return u.width=d,u.height=f,u}function V(e){if(!e)return;let t=e.createElement(`style`),n=t.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return t.appendChild(n),t}function Se(e,t){let{width:n,height:r}=t;if(C(e)&&(!n||!r)){let t=e.getBoundingClientRect();n=n||t.width||Number(e.getAttribute(`width`))||0,r=r||t.height||Number(e.getAttribute(`height`))||0}return{width:n,height:r}}async function Ce(e,t){let{log:n,timeout:r,drawImageCount:i,drawImageInterval:a}=t;n.time(`image to canvas`);let o=await P(e,{timeout:r,onWarn:t.log.warn}),{canvas:s,context2d:c}=we(e.ownerDocument,t),l=()=>{try{c?.drawImage(o,0,0,s.width,s.height)}catch(e){t.log.warn(`Failed to drawImage`,e)}};if(l(),t.isEnable(`fixSvgXmlDecode`))for(let e=0;e<i;e++)await new Promise(t=>{setTimeout(()=>{c?.clearRect(0,0,s.width,s.height),l(),t()},e+a)});return t.drawImageCount=0,n.timeEnd(`image to canvas`),s}function we(e,t){let{width:n,height:r,scale:i,backgroundColor:a,maximumCanvasSize:o}=t,s=e.createElement(`canvas`);s.width=Math.floor(n*i),s.height=Math.floor(r*i),s.style.width=`${n}px`,s.style.height=`${r}px`,o&&(s.width>o||s.height>o)&&(s.width>o&&s.height>o?s.width>s.height?(s.height*=o/s.width,s.width=o):(s.width*=o/s.height,s.height=o):s.width>o?(s.height*=o/s.width,s.width=o):(s.width*=o/s.height,s.height=o));let c=s.getContext(`2d`);return c&&a&&(c.fillStyle=a,c.fillRect(0,0,s.width,s.height)),{canvas:s,context2d:c}}function H(e,t){if(e.ownerDocument)try{let t=e.toDataURL();if(t!==`data:,`)return N(t,e.ownerDocument)}catch(e){t.log.warn(`Failed to clone canvas`,e)}let n=e.cloneNode(!1),r=e.getContext(`2d`),i=n.getContext(`2d`);try{return r&&i&&i.putImageData(r.getImageData(0,0,e.width,e.height),0,0),n}catch(e){t.log.warn(`Failed to clone canvas`,e)}return n}function Te(e,t){try{if(e?.contentDocument?.body)return J(e.contentDocument.body,t)}catch(e){t.log.warn(`Failed to clone iframe`,e)}return e.cloneNode(!1)}function Ee(e){let t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=``),t.loading===`lazy`&&(t.loading=`eager`),t}async function De(e,t){if(e.ownerDocument&&!e.currentSrc&&e.poster)return N(e.poster,e.ownerDocument);let n=e.cloneNode(!1);n.crossOrigin=`anonymous`,e.currentSrc&&e.currentSrc!==e.src&&(n.src=e.currentSrc);let r=n.ownerDocument;if(r){let i=!0;if(await P(n,{onError:()=>i=!1,onWarn:t.log.warn}),!i)return e.poster?N(e.poster,e.ownerDocument):n;n.currentTime=e.currentTime,await new Promise(e=>{n.addEventListener(`seeked`,e,{once:!0})});let a=r.createElement(`canvas`);a.width=e.offsetWidth,a.height=e.offsetHeight;try{let e=a.getContext(`2d`);e&&e.drawImage(n,0,0,a.width,a.height)}catch(r){return t.log.warn(`Failed to clone video`,r),e.poster?N(e.poster,e.ownerDocument):n}return H(a,t)}return n}function Oe(e,t){return oe(e)?H(e,t):pe(e)?Te(e,t):D(e)?Ee(e):O(e)?De(e,t):e.cloneNode(!1)}function ke(e){let t=e.sandbox;if(!t){let{ownerDocument:n}=e;try{n&&(t=n.createElement(`iframe`),t.id=`__SANDBOX__${I()}`,t.width=`0`,t.height=`0`,t.style.visibility=`hidden`,t.style.position=`fixed`,n.body.appendChild(t),t.srcdoc=`<!DOCTYPE html><meta charset="UTF-8"><title></title><body>`,e.sandbox=t)}catch(t){e.log.warn(`Failed to getSandBox`,t)}}return t}var Ae=[`width`,`height`,`-webkit-text-fill-color`],je=[`stroke`,`fill`];function U(e,t,n){let{defaultComputedStyles:r}=n,i=e.nodeName.toLowerCase(),a=w(e)&&i!==`svg`,o=a?je.map(t=>[t,e.getAttribute(t)]).filter(([,e])=>e!==null):[],s=[a&&`svg`,i,o.map((e,t)=>`${e}=${t}`).join(`,`),t].filter(Boolean).join(`:`);if(r.has(s))return r.get(s);let c=ke(n)?.contentWindow;if(!c)return new Map;let l=c?.document,u,d;a?(u=l.createElementNS(M,`svg`),d=u.ownerDocument.createElementNS(u.namespaceURI,i),o.forEach(([e,t])=>{d.setAttributeNS(null,e,t)}),u.appendChild(d)):u=d=l.createElement(i),d.textContent=` `,l.body.appendChild(u);let f=c.getComputedStyle(d,t),p=new Map;for(let e=f.length,t=0;t<e;t++){let e=f.item(t);Ae.includes(e)||p.set(e,f.getPropertyValue(e))}return l.body.removeChild(u),r.set(s,p),p}function W(e,t,n){let r=new Map,i=[],a=new Map;if(n)for(let e of n)o(e);else for(let t=e.length,n=0;n<t;n++)o(e.item(n));for(let e=i.length,t=0;t<e;t++)a.get(i[t])?.forEach((e,t)=>r.set(t,e));function o(n){let o=e.getPropertyValue(n),s=e.getPropertyPriority(n),c=n.lastIndexOf(`-`),l=c>-1?n.substring(0,c):void 0;if(l){let e=a.get(l);e||(e=new Map,a.set(l,e)),e.set(n,[o,s])}t.get(n)===o&&!s||(l?i.push(l):r.set(n,[o,s]))}return r}function Me(e,t,n,r){let{ownerWindow:i,includeStyleProperties:a,currentParentNodeStyle:o}=r,s=t.style,c=i.getComputedStyle(e),l=U(e,null,r);o?.forEach((e,t)=>{l.delete(t)});let u=W(c,l,a);u.delete(`transition-property`),u.delete(`all`),u.delete(`d`),u.delete(`content`),n&&(u.delete(`margin-top`),u.delete(`margin-right`),u.delete(`margin-bottom`),u.delete(`margin-left`),u.delete(`margin-block-start`),u.delete(`margin-block-end`),u.delete(`margin-inline-start`),u.delete(`margin-inline-end`),u.set(`box-sizing`,[`border-box`,``])),u.get(`background-clip`)?.[0]===`text`&&t.classList.add(`______background-clip--text`),b&&(u.has(`font-kerning`)||u.set(`font-kerning`,[`normal`,``]),(u.get(`overflow-x`)?.[0]===`hidden`||u.get(`overflow-y`)?.[0]===`hidden`)&&u.get(`text-overflow`)?.[0]===`ellipsis`&&e.scrollWidth===e.clientWidth&&u.set(`text-overflow`,[`clip`,``]));for(let e=s.length,t=0;t<e;t++)s.removeProperty(s.item(t));return u.forEach(([e,t],n)=>{s.setProperty(n,e,t)}),u}function Ne(e,t){(se(e)||ce(e)||de(e))&&t.setAttribute(`value`,e.value)}var Pe=[`:before`,`:after`],Fe=[`:-webkit-scrollbar`,`:-webkit-scrollbar-button`,`:-webkit-scrollbar-thumb`,`:-webkit-scrollbar-track`,`:-webkit-scrollbar-track-piece`,`:-webkit-scrollbar-corner`,`:-webkit-resizer`];function Ie(e,t,n,r,i){let{ownerWindow:a,svgStyleElement:o,svgStyles:s,currentNodeStyle:c}=r;if(!o||!a)return;function l(n){let o=a.getComputedStyle(e,n),l=o.getPropertyValue(`content`);if(!l||l===`none`)return;i?.(l),l=l.replace(/(')|(")|(counter\(.+\))/g,``);let u=[I()],d=U(e,n,r);c?.forEach((e,t)=>{d.delete(t)});let f=W(o,d,r.includeStyleProperties);f.delete(`content`),f.delete(`-webkit-locale`),f.get(`background-clip`)?.[0]===`text`&&t.classList.add(`______background-clip--text`);let p=[`content: '${l}';`];if(f.forEach(([e,t],n)=>{p.push(`${n}: ${e}${t?` !important`:``};`)}),p.length===1)return;try{t.className=[t.className,...u].join(` `)}catch(e){r.log.warn(`Failed to copyPseudoClass`,e);return}let m=p.join(`
  `),h=s.get(m);h||(h=[],s.set(m,h)),h.push(`.${u[0]}:${n}`)}Pe.forEach(l),n&&Fe.forEach(l)}var G=new Set([`symbol`]);async function K(e,t,n,r,i){if(C(n)&&(le(n)||ue(n))||r.filter&&!r.filter(n))return;G.has(t.nodeName)||G.has(n.nodeName)?r.currentParentNodeStyle=void 0:r.currentParentNodeStyle=r.currentNodeStyle;let a=await J(n,r,!1,i);r.isEnable(`restoreScrollPosition`)&&Le(e,a),t.appendChild(a)}async function q(e,t,n,r){let i=e.firstChild;C(e)&&e.shadowRoot&&(i=e.shadowRoot?.firstChild,n.shadowRoots.push(e.shadowRoot));for(let a=i;a;a=a.nextSibling)if(!ie(a))if(C(a)&&fe(a)&&typeof a.assignedNodes==`function`){let i=a.assignedNodes();for(let a=0;a<i.length;a++)await K(e,t,i[a],n,r)}else await K(e,t,a,n,r)}function Le(e,t){if(!E(e)||!E(t))return;let{scrollTop:n,scrollLeft:r}=e;if(!n&&!r)return;let{transform:i}=t.style,a=new DOMMatrix(i),{a:o,b:s,c,d:l}=a;a.a=1,a.b=0,a.c=0,a.d=1,a.translateSelf(-r,-n),a.a=o,a.b=s,a.c=c,a.d=l,t.style.transform=a.toString()}function Re(e,t){let{backgroundColor:n,width:r,height:i,style:a}=t,o=e.style;if(n&&o.setProperty(`background-color`,n,`important`),r&&o.setProperty(`width`,`${r}px`,`important`),i&&o.setProperty(`height`,`${i}px`,`important`),a)for(let e in a)o[e]=a[e]}var ze=/^[\w-:]+$/;async function J(e,t,n=!1,r){let{ownerDocument:i,ownerWindow:a,fontFamilies:o,onCloneEachNode:s}=t;if(i&&ae(e))return r&&/\S/.test(e.data)&&r(e.data),i.createTextNode(e.data);if(i&&a&&C(e)&&(E(e)||w(e))){let r=await Oe(e,t);if(t.isEnable(`removeAbnormalAttributes`)){let e=r.getAttributeNames();for(let t=e.length,n=0;n<t;n++){let t=e[n];ze.test(t)||r.removeAttribute(t)}}let i=t.currentNodeStyle=Me(e,r,n,t);n&&Re(r,t);let a=!1;if(t.isEnable(`copyScrollbar`)){let t=[i.get(`overflow-x`)?.[0],i.get(`overflow-y`)?.[0]];a=t.includes(`scroll`)||(t.includes(`auto`)||t.includes(`overlay`))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)}let c=i.get(`text-transform`)?.[0],l=L(i.get(`font-family`)?.[0]),u=l?e=>{c===`uppercase`?e=e.toUpperCase():c===`lowercase`?e=e.toLowerCase():c===`capitalize`&&(e=e[0].toUpperCase()+e.substring(1)),l.forEach(t=>{let n=o.get(t);n||o.set(t,n=new Set),e.split(``).forEach(e=>n.add(e))})}:void 0;return Ie(e,r,a,t,u),Ne(e,r),O(e)||await q(e,r,t,u),await s?.(r),r}let c=e.cloneNode(!1);return await q(e,c,t),await s?.(c),c}function Y(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(t){e.log.warn(`Failed to destroyContext`,t)}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[],e.shadowRoots=[]}function Be(e){let{url:t,timeout:n,responseType:r,...i}=e,a=new AbortController,o=n?setTimeout(()=>a.abort(),n):void 0;return fetch(t,{signal:a.signal,...i}).then(e=>{if(!e.ok)throw Error(`Failed fetch, not 2xx response`,{cause:e});switch(r){case`arrayBuffer`:return e.arrayBuffer();case`dataUrl`:return e.blob().then(ye);case`text`:default:return e.text()}}).finally(()=>clearTimeout(o))}function X(e,t){let{url:n,requestType:r=`text`,responseType:i=`text`,imageDom:a}=t,o=n,{timeout:s,acceptOfImage:c,requests:l,fetchFn:u,fetch:{requestInit:d,bypassingCache:f,placeholderImage:p},font:m,workers:h,fontFamilies:g}=e;r===`image`&&(x||S)&&e.drawImageCount++;let _=l.get(n);if(!_){f&&f instanceof RegExp&&f.test(o)&&(o+=(/\?/.test(o)?`&`:`?`)+new Date().getTime());let t=r.startsWith(`font`)&&m&&m.minify,v=new Set;t&&r.split(`;`)[1].split(`,`).forEach(e=>{g.has(e)&&g.get(e).forEach(e=>v.add(e))});let y=t&&v.size,b={url:o,timeout:s,responseType:y?`arrayBuffer`:i,headers:r===`image`?{accept:c}:void 0,...d};_={type:r,resolve:void 0,reject:void 0,response:null},_.response=(async()=>{if(u&&r===`image`){let e=await u(n);if(e)return e}return!x&&n.startsWith(`http`)&&h.length?new Promise((e,t)=>{h[l.size&h.length-1].postMessage({rawUrl:n,...b}),_.resolve=e,_.reject=t}):Be(b)})().catch(t=>{if(l.delete(n),r===`image`&&p)return e.log.warn(`Failed to fetch image base64, trying to use placeholder image`,o),typeof p==`string`?p:p(a);throw t}),l.set(n,_)}return _.response}async function Z(e,t,n,r){if(!Q(e))return e;for(let[i,a]of He(e,t))try{let t=await X(n,{url:a,requestType:r?`image`:`text`,responseType:`dataUrl`});e=e.replace(Ue(i),`$1${t}$3`)}catch(e){n.log.warn(`Failed to fetch css data url`,i,e)}return e}function Q(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}var Ve=/url\((['"]?)([^'"]+?)\1\)/g;function He(e,t){let n=[];return e.replace(Ve,(e,r,i)=>(n.push([i,A(i,t)]),e)),n.filter(([e])=>!k(e))}function Ue(e){let t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,`\\$1`);return RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,`g`)}var We=[`background-image`,`border-image-source`,`-webkit-border-image`,`-webkit-mask-image`,`list-style-image`];function Ge(e,t){return We.map(n=>{let r=e.getPropertyValue(n);return!r||r===`none`?null:((x||S)&&t.drawImageCount++,Z(r,null,t,!0).then(t=>{!t||r===t||e.setProperty(n,t,e.getPropertyPriority(n))}))}).filter(Boolean)}function Ke(e,t){if(D(e)){let n=e.currentSrc||e.src;if(!k(n))return[X(t,{url:n,imageDom:e,requestType:`image`,responseType:`dataUrl`}).then(t=>{t&&(e.srcset=``,e.dataset.originalSrc=n,e.src=t||``)})];(x||S)&&t.drawImageCount++}else if(w(e)&&!k(e.href.baseVal)){let n=e.href.baseVal;return[X(t,{url:n,imageDom:e,requestType:`image`,responseType:`dataUrl`}).then(t=>{t&&(e.dataset.originalSrc=n,e.href.baseVal=t||``)})]}return[]}function qe(e,t){let{ownerDocument:n,svgDefsElement:r}=t,i=e.getAttribute(`href`)??e.getAttribute(`xlink:href`);if(!i)return[];let[a,o]=i.split(`#`);if(o){let i=`#${o}`,s=t.shadowRoots.reduce((e,t)=>e??t.querySelector(`svg ${i}`),n?.querySelector(`svg ${i}`));if(a&&e.setAttribute(`href`,i),r?.querySelector(i))return[];if(s)return r?.appendChild(s.cloneNode(!0)),[];if(a)return[X(t,{url:a,responseType:`text`}).then(e=>{r?.insertAdjacentHTML(`beforeend`,e)})]}return[]}function Je(e,t){let{tasks:n}=t;C(e)&&((D(e)||T(e))&&n.push(...Ke(e,t)),re(e)&&n.push(...qe(e,t))),E(e)&&n.push(...Ge(e.style,t)),e.childNodes.forEach(e=>{Je(e,t)})}async function Ye(e,t){let{ownerDocument:n,svgStyleElement:r,fontFamilies:i,fontCssTexts:a,tasks:o,font:s}=t;if(!(!n||!r||!i.size))if(s&&s.cssText){let e=tt(s.cssText,t);r.appendChild(n.createTextNode(`${e}
`))}else{let e=Array.from(n.styleSheets).filter(e=>{try{return`cssRules`in e&&!!e.cssRules.length}catch(n){return t.log.warn(`Error while reading CSS rules from ${e.href}`,n),!1}});await Promise.all(e.flatMap(e=>Array.from(e.cssRules).map(async(n,r)=>{if(ne(n)){let i=r+1,a=n.href,o=``;try{o=await X(t,{url:a,requestType:`text`,responseType:`text`})}catch(e){t.log.warn(`Error fetch remote css import from ${a}`,e)}let s=o.replace(Ve,(e,t,n)=>e.replace(n,A(n,a)));for(let n of Qe(s))try{e.insertRule(n,n.startsWith(`@import`)?i+=1:e.cssRules.length)}catch(e){t.log.warn(`Error inserting rule from remote css import`,{rule:n,error:e})}}}))),e.flatMap(e=>Array.from(e.cssRules)).filter(e=>te(e)&&Q(e.style.getPropertyValue(`src`))&&L(e.style.getPropertyValue(`font-family`))?.some(e=>i.has(e))).forEach(e=>{let i=e,s=a.get(i.cssText);s?r.appendChild(n.createTextNode(`${s}
`)):o.push(Z(i.cssText,i.parentStyleSheet?i.parentStyleSheet.href:null,t).then(e=>{e=tt(e,t),a.set(i.cssText,e),r.appendChild(n.createTextNode(`${e}
`))}))})}}var Xe=/(\/\*[\s\S]*?\*\/)/g,Ze=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function Qe(e){if(e==null)return[];let t=[],n=e.replace(Xe,``);for(;;){let e=Ze.exec(n);if(!e)break;t.push(e[0])}n=n.replace(Ze,``);let r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=RegExp(`((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})`,`gi`);for(;;){let e=r.exec(n);if(e)i.lastIndex=r.lastIndex;else if(e=i.exec(n),e)r.lastIndex=i.lastIndex;else break;t.push(e[0])}return t}var $e=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,et=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function tt(e,t){let{font:n}=t,r=n?n?.preferredFormat:void 0;return r?e.replace(et,e=>{for(;;){let[t,,n]=$e.exec(e)||[];if(!n)return``;if(n===r)return`src: ${t};`}}):e}async function nt(e,t){let n=await z(e,t);if(C(n.node)&&w(n.node))return n.node;let{ownerDocument:r,log:i,tasks:a,svgStyleElement:o,svgDefsElement:s,svgStyles:c,font:l,progress:u,autoDestruct:d,onCloneNode:f,onEmbedNode:p,onCreateForeignObjectSvg:m}=n;i.time(`clone node`);let h=await J(n.node,n,!0);if(o&&r){let e=``;c.forEach((t,n)=>{e+=`${t.join(`,
`)} {
  ${n}
}
`}),o.appendChild(r.createTextNode(e))}i.timeEnd(`clone node`),await f?.(h),l!==!1&&C(h)&&(i.time(`embed web font`),await Ye(h,n),i.timeEnd(`embed web font`)),i.time(`embed node`),Je(h,n);let g=a.length,_=0,v=async()=>{for(;;){let e=a.pop();if(!e)break;try{await e}catch(e){n.log.warn(`Failed to run task`,e)}u?.(++_,g)}};u?.(_,g),await Promise.all([...Array.from({length:4})].map(v)),i.timeEnd(`embed node`),await p?.(h);let y=rt(h,n);return s&&y.insertBefore(s,y.children[0]),o&&y.insertBefore(o,y.children[0]),d&&Y(n),await m?.(y),y}function rt(e,t){let{width:n,height:r}=t,i=ge(n,r,e.ownerDocument),a=i.ownerDocument.createElementNS(i.namespaceURI,`foreignObject`);return a.setAttributeNS(null,`x`,`0%`),a.setAttributeNS(null,`y`,`0%`),a.setAttributeNS(null,`width`,`100%`),a.setAttributeNS(null,`height`,`100%`),a.append(e),i.appendChild(a),i}async function it(e,t){let n=await z(e,t),r=await nt(n),i=_e(r,n.isEnable(`removeControlCharacter`));return n.autoDestruct||(n.svgStyleElement=V(n.ownerDocument),n.svgDefsElement=n.ownerDocument?.createElementNS(M,`defs`),n.svgStyles.clear()),await Ce(N(i,r.ownerDocument),n)}async function $(t,n){let r=await z(t,n),{log:i,quality:a,type:o,dpi:s}=r,c=await it(r);i.time(`canvas to data url`);let u=c.toDataURL(o,a);if([`image/png`,`image/jpeg`].includes(o)&&s&&_&&v){let[t,n]=u.split(`,`),r=0,i=!1;if(o===`image/png`){let e=p(n);e>=0?(r=Math.ceil((e+28)/3)*4,i=!0):r=33/3*4}else o===`image/jpeg`&&(r=18/3*4);let a=n.substring(0,r),c=n.substring(r),d=window.atob(a),f=new Uint8Array(d.length);for(let e=0;e<f.length;e++)f[e]=d.charCodeAt(e);let m=o===`image/png`?l(f,s,i):e(f,s);u=[t,`,`,window.btoa(String.fromCharCode(...m)),c].join(``)}return i.timeEnd(`canvas to data url`),u}async function at(e,t){return $(await z(e,{...t,type:`image/png`}))}export{B as createContext,Y as destroyContext,it as domToCanvas,$ as domToDataUrl,nt as domToForeignObjectSvg,at as domToPng,P as loadMedia,F as waitUntilLoad};