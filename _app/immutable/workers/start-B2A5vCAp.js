const instanceOfAny=(d,m)=>m.some(g=>d instanceof g);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const transactionDoneMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(d){const m=new Promise((g,w)=>{const $=()=>{d.removeEventListener("success",I),d.removeEventListener("error",D)},I=()=>{g(wrap(d.result)),$()},D=()=>{w(d.error),$()};d.addEventListener("success",I),d.addEventListener("error",D)});return reverseTransformCache.set(m,d),m}function cacheDonePromiseForTransaction(d){if(transactionDoneMap.has(d))return;const m=new Promise((g,w)=>{const $=()=>{d.removeEventListener("complete",I),d.removeEventListener("error",D),d.removeEventListener("abort",D)},I=()=>{g(),$()},D=()=>{w(d.error||new DOMException("AbortError","AbortError")),$()};d.addEventListener("complete",I),d.addEventListener("error",D),d.addEventListener("abort",D)});transactionDoneMap.set(d,m)}let idbProxyTraps={get(d,m,g){if(d instanceof IDBTransaction){if(m==="done")return transactionDoneMap.get(d);if(m==="store")return g.objectStoreNames[1]?void 0:g.objectStore(g.objectStoreNames[0])}return wrap(d[m])},set(d,m,g){return d[m]=g,!0},has(d,m){return d instanceof IDBTransaction&&(m==="done"||m==="store")?!0:m in d}};function replaceTraps(d){idbProxyTraps=d(idbProxyTraps)}function wrapFunction(d){return getCursorAdvanceMethods().includes(d)?function(...m){return d.apply(unwrap(this),m),wrap(this.request)}:function(...m){return wrap(d.apply(unwrap(this),m))}}function transformCachableValue(d){return typeof d=="function"?wrapFunction(d):(d instanceof IDBTransaction&&cacheDonePromiseForTransaction(d),instanceOfAny(d,getIdbProxyableTypes())?new Proxy(d,idbProxyTraps):d)}function wrap(d){if(d instanceof IDBRequest)return promisifyRequest(d);if(transformCache.has(d))return transformCache.get(d);const m=transformCachableValue(d);return m!==d&&(transformCache.set(d,m),reverseTransformCache.set(m,d)),m}const unwrap=d=>reverseTransformCache.get(d);function openDB(d,m,{blocked:g,upgrade:w,blocking:$,terminated:I}={}){const D=indexedDB.open(d,m),q=wrap(D);return w&&D.addEventListener("upgradeneeded",j=>{w(wrap(D.result),j.oldVersion,j.newVersion,wrap(D.transaction),j)}),g&&D.addEventListener("blocked",j=>g(j.oldVersion,j.newVersion,j)),q.then(j=>{I&&j.addEventListener("close",()=>I()),$&&j.addEventListener("versionchange",G=>$(G.oldVersion,G.newVersion,G))}).catch(()=>{}),q}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(d,m){if(!(d instanceof IDBDatabase&&!(m in d)&&typeof m=="string"))return;if(cachedMethods.get(m))return cachedMethods.get(m);const g=m.replace(/FromIndex$/,""),w=m!==g,$=writeMethods.includes(g);if(!(g in(w?IDBIndex:IDBObjectStore).prototype)||!($||readMethods.includes(g)))return;const I=async function(D,...q){const j=this.transaction(D,$?"readwrite":"readonly");let G=j.store;return w&&(G=G.index(q.shift())),(await Promise.all([G[g](...q),$&&j.done]))[0]};return cachedMethods.set(m,I),I}replaceTraps(d=>({...d,get:(m,g,w)=>getMethod(m,g)||d.get(m,g,w),has:(m,g)=>!!getMethod(m,g)||d.has(m,g)}));const advanceMethodProps=["continue","continuePrimaryKey","advance"],methodMap={},advanceResults=new WeakMap,ittrProxiedCursorToOriginalProxy=new WeakMap,cursorIteratorTraps={get(d,m){if(!advanceMethodProps.includes(m))return d[m];let g=methodMap[m];return g||(g=methodMap[m]=function(...w){advanceResults.set(this,ittrProxiedCursorToOriginalProxy.get(this)[m](...w))}),g}};async function*iterate$2(...d){let m=this;if(m instanceof IDBCursor||(m=await m.openCursor(...d)),!m)return;m=m;const g=new Proxy(m,cursorIteratorTraps);for(ittrProxiedCursorToOriginalProxy.set(g,m),reverseTransformCache.set(g,unwrap(m));m;)yield g,m=await(advanceResults.get(g)||m.continue()),advanceResults.delete(g)}function isIteratorProp(d,m){return m===Symbol.asyncIterator&&instanceOfAny(d,[IDBIndex,IDBObjectStore,IDBCursor])||m==="iterate"&&instanceOfAny(d,[IDBIndex,IDBObjectStore])}replaceTraps(d=>({...d,get(m,g,w){return isIteratorProp(m,g)?iterate$2:d.get(m,g,w)},has(m,g){return isIteratorProp(m,g)||d.has(m,g)}}));Map.groupBy??=function(m,g){const w=new Map;let $=0;for(const I of m){const D=g(I,$++),q=w.get(D);q?q.push(I):w.set(D,[I])}return w};function createLogger(d,m="debug",g,w){const $=LOG_LEVELS.slice(LOG_LEVELS.indexOf(m));if(w&&g){const I={rqid:w,nid:g};return{debug:$.includes("debug")?logger$1("debug",d,I):()=>{},info:$.includes("info")?logger$1("info",d,I):()=>{},warn:$.includes("warn")?logger$1("warn",d,I):()=>{},error:$.includes("error")?logger$1("error",d,I):()=>{}}}return{debug:$.includes("debug")?logger$1("debug",d,g):()=>{},info:$.includes("info")?logger$1("info",d,g):()=>{},warn:$.includes("warn")?logger$1("warn",d,g):()=>{},error:$.includes("error")?logger$1("error",d,g):()=>{}}}const LOG_LEVELS=["debug","info","warn","error"],PATCHABLE_LOG_METHODS=["debug","info","warn","error","log"];function logger$1(d,m,g){if(g===void 0||typeof g=="string"){const w=g??null;return($,...I)=>log$1(d,m,{nid:w,rqid:$},...I)}return(...w)=>log$1(d,m,g,...w)}const originalConsole=PATCHABLE_LOG_METHODS.reduce((d,m)=>(d[m]=console[m],d),{});function log$1(d,m,{rqid:g,nid:w},...$){const I=[`[SWARPC ${m}]`,g?`%c${g}%c`:"",w?`%c@ ${w}%c`:""].filter(Boolean).join(" "),D=[];return g&&D.push("color: cyan","color: inherit"),w&&D.push("color: hotpink","color: inherit"),originalConsole[d](I,...D,...$)}function injectIntoConsoleGlobal(d,m){for(const g of PATCHABLE_LOG_METHODS)d.self.console[g]=logger$1(g,"server",m)}class MockedWorkerGlobalScope{constructor(){}}const SharedWorkerGlobalScope=globalThis.SharedWorkerGlobalScope??MockedWorkerGlobalScope,DedicatedWorkerGlobalScope=globalThis.DedicatedWorkerGlobalScope??MockedWorkerGlobalScope,ServiceWorkerGlobalScope=globalThis.ServiceWorkerGlobalScope??MockedWorkerGlobalScope;function scopeIsShared(d,m){return d instanceof SharedWorkerGlobalScope||m==="shared"}function scopeIsDedicated(d,m){return d instanceof DedicatedWorkerGlobalScope||m==="dedicated"}function scopeIsService(d,m){return d instanceof ServiceWorkerGlobalScope||m==="service"}function nodeIdFromScope(d,m){return scopeIsDedicated(d,m)||scopeIsShared(d,m)?d.name:"(SW)"}const regex$1=((d,m)=>new RegExp(d,m));Object.assign(regex$1,{cast:regex$1});const liftArray=d=>Array.isArray(d)?d:[d],spliterate=(d,m)=>{const g=[[],[]];for(const w of d)m(w)?g[0].push(w):g[1].push(w);return g},ReadonlyArray=Array,includes=(d,m)=>d.includes(m),range$1=(d,m=0)=>[...new Array(d)].map((g,w)=>w+m),append=(d,m,g)=>d===void 0?m===void 0?[]:Array.isArray(m)?m:[m]:(Array.isArray(m)?d.push(...m):d.push(m),d),conflatenate=(d,m)=>m==null?d??[]:d==null?liftArray(m):d.concat(m),conflatenateAll=(...d)=>d.reduce(conflatenate,[]),appendUnique=(d,m,g)=>{if(d===void 0)return Array.isArray(m)?m:[m];const w=g?.isEqual??(($,I)=>$===I);for(const $ of liftArray(m))d.some(I=>w(I,$))||d.push($);return d},groupBy$1=(d,m)=>d.reduce((g,w)=>{const $=w[m];return g[$]=append(g[$],w),g},{}),arrayEquals=(d,m,g)=>d.length===m.length&&d.every(g?.isEqual?(w,$)=>g.isEqual(w,m[$]):(w,$)=>w===m[$]),hasDomain=(d,m)=>domainOf(d)===m,domainOf=d=>{const m=typeof d;return m==="object"?d===null?"null":"object":m==="function"?"object":m},domainDescriptions={boolean:"boolean",null:"null",undefined:"undefined",bigint:"a bigint",number:"a number",object:"an object",string:"a string",symbol:"a symbol"},jsTypeOfDescriptions={...domainDescriptions,function:"a function"};class InternalArktypeError extends Error{}const throwInternalError=d=>throwError(d,InternalArktypeError),throwError=(d,m=Error)=>{throw new m(d)};class ParseError extends Error{name="ParseError"}const throwParseError=d=>throwError(d,ParseError),noSuggest=d=>` ${d}`,ZeroWidthSpace="â€‹",flatMorph=(d,m)=>{const g={},w=Array.isArray(d);let $=!1;for(const[I,D]of Object.entries(d).entries()){const q=w?m(I,D[1]):m(...D,I);$||=typeof q[0]=="number";const j=Array.isArray(q[0])||q.length===0?q:[q];for(const[G,H]of j)typeof G=="object"?g[G.group]=append(g[G.group],H):g[G]=H}return $?Object.values(g):g},entriesOf=Object.entries,isKeyOf=(d,m)=>d in m,hasKey=(d,m)=>m in d;class DynamicBase{constructor(m){Object.assign(this,m)}}const NoopBase=class{};class CastableBase extends NoopBase{}const splitByKeys=(d,m)=>{const g={},w={};let $;for($ in d)$ in m?g[$]=d[$]:w[$]=d[$];return[g,w]},omit$1=(d,m)=>splitByKeys(d,m)[1],isEmptyObject=d=>Object.keys(d).length===0,stringAndSymbolicEntriesOf=d=>[...Object.entries(d),...Object.getOwnPropertySymbols(d).map(m=>[m,d[m]])],defineProperties=(d,m)=>Object.defineProperties(d,Object.getOwnPropertyDescriptors(m)),withAlphabetizedKeys=d=>{const m=Object.keys(d).sort(),g={};for(let w=0;w<m.length;w++)g[m[w]]=d[m[w]];return g},unset=noSuggest(`unset${ZeroWidthSpace}`),enumValues=d=>Object.values(d).filter(m=>typeof m=="number"?!0:typeof d[m]!="number"),ecmascriptConstructors={Array,Boolean,Date,Error,Function,Map,Number,Promise,RegExp,Set,String,WeakMap,WeakSet},FileConstructor=globalThis.File??Blob,platformConstructors={ArrayBuffer,Blob,File:FileConstructor,FormData,Headers,Request,Response,URL},typedArrayConstructors={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array},builtinConstructors={...ecmascriptConstructors,...platformConstructors,...typedArrayConstructors,String,Number,Boolean},objectKindOf=d=>{let m=Object.getPrototypeOf(d);for(;m?.constructor&&(!isKeyOf(m.constructor.name,builtinConstructors)||!(d instanceof builtinConstructors[m.constructor.name]));)m=Object.getPrototypeOf(m);const g=m?.constructor?.name;if(!(g===void 0||g==="Object"))return g},objectKindOrDomainOf=d=>typeof d=="object"&&d!==null?objectKindOf(d)??"object":domainOf(d),isArray$1=Array.isArray,ecmascriptDescriptions={Array:"an array",Function:"a function",Date:"a Date",RegExp:"a RegExp",Error:"an Error",Map:"a Map",Set:"a Set",String:"a String object",Number:"a Number object",Boolean:"a Boolean object",Promise:"a Promise",WeakMap:"a WeakMap",WeakSet:"a WeakSet"},platformDescriptions={ArrayBuffer:"an ArrayBuffer instance",Blob:"a Blob instance",File:"a File instance",FormData:"a FormData instance",Headers:"a Headers instance",Request:"a Request instance",Response:"a Response instance",URL:"a URL instance"},typedArrayDescriptions={Int8Array:"an Int8Array",Uint8Array:"a Uint8Array",Uint8ClampedArray:"a Uint8ClampedArray",Int16Array:"an Int16Array",Uint16Array:"a Uint16Array",Int32Array:"an Int32Array",Uint32Array:"a Uint32Array",Float32Array:"a Float32Array",Float64Array:"a Float64Array",BigInt64Array:"a BigInt64Array",BigUint64Array:"a BigUint64Array"},objectKindDescriptions={...ecmascriptDescriptions,...platformDescriptions,...typedArrayDescriptions},getBuiltinNameOfConstructor=d=>{const m=Object(d).name??null;return m&&isKeyOf(m,builtinConstructors)&&builtinConstructors[m]===d?m:null},constructorExtends=(d,m)=>{let g=d.prototype;for(;g!==null;){if(g===m.prototype)return!0;g=Object.getPrototypeOf(g)}return!1},deepClone=d=>_clone(d,new Map),_clone=(d,m)=>{if(typeof d!="object"||d===null)return d;if(m?.has(d))return m.get(d);const g=getBuiltinNameOfConstructor(d.constructor);if(g==="Date")return new Date(d.getTime());if(g&&g!=="Array")return d;const w=Array.isArray(d)?d.slice():Object.create(Object.getPrototypeOf(d)),$=Object.getOwnPropertyDescriptors(d);if(m){m.set(d,w);for(const I in $){const D=$[I];"get"in D||"set"in D||(D.value=_clone(D.value,m))}}return Object.defineProperties(w,$),w},cached=d=>{let m=unset;return()=>m===unset?m=d():m},isThunk=d=>typeof d=="function"&&d.length===0,DynamicFunction=class extends Function{constructor(...d){const m=d.slice(0,-1),g=d.at(-1);try{super(...m,g)}catch(w){return throwInternalError(`Encountered an unexpected error while compiling your definition:
                Message: ${w} 
                Source: (${d.slice(0,-1)}) => {
                    ${d.at(-1)}
                }`)}}};class Callable{constructor(m,...[g]){return Object.assign(Object.setPrototypeOf(m.bind(g?.bind??this),this.constructor.prototype),g?.attach)}}const envHasCsp=cached(()=>{try{return new Function("return false")()}catch{return!0}});class Hkt{constructor(){}}var define_globalThis_process_env_default={};const fileName=()=>{try{return((new Error().stack?.split(`
`)[2]?.trim()||"").match(/\(?(.+?)(?::\d+:\d+)?\)?$/)?.[1]||"unknown").replace(/^file:\/\//,"")}catch{return"unknown"}},env=define_globalThis_process_env_default??{},isomorphic={fileName,env},capitalize$1=d=>d[0].toUpperCase()+d.slice(1),anchoredRegex=d=>new RegExp(anchoredSource(d),typeof d=="string"?"":d.flags),anchoredSource=d=>`^(?:${typeof d=="string"?d:d.source})$`,RegexPatterns={negativeLookahead:d=>`(?!${d})`,nonCapturingGroup:d=>`(?:${d})`},Backslash="\\",whitespaceChars={" ":1,"\n":1,"	":1},anchoredNegativeZeroPattern=/^-0\.?0*$/.source,positiveIntegerPattern=/[1-9]\d*/.source,looseDecimalPattern=/\.\d+/.source,strictDecimalPattern=/\.\d*[1-9]/.source,createNumberMatcher=d=>anchoredRegex(RegexPatterns.negativeLookahead(anchoredNegativeZeroPattern)+RegexPatterns.nonCapturingGroup("-?"+RegexPatterns.nonCapturingGroup(RegexPatterns.nonCapturingGroup("0|"+positiveIntegerPattern)+RegexPatterns.nonCapturingGroup(d.decimalPattern)+"?")+(d.allowDecimalOnly?"|"+d.decimalPattern:"")+"?")),wellFormedNumberMatcher=createNumberMatcher({decimalPattern:strictDecimalPattern,allowDecimalOnly:!1}),isWellFormedNumber=wellFormedNumberMatcher.test.bind(wellFormedNumberMatcher),numericStringMatcher=createNumberMatcher({decimalPattern:looseDecimalPattern,allowDecimalOnly:!0});numericStringMatcher.test.bind(numericStringMatcher);const numberLikeMatcher=/^-?\d*\.?\d*$/,isNumberLike=d=>d.length!==0&&numberLikeMatcher.test(d),wellFormedIntegerMatcher=anchoredRegex(RegexPatterns.negativeLookahead("^-0$")+"-?"+RegexPatterns.nonCapturingGroup(RegexPatterns.nonCapturingGroup("0|"+positiveIntegerPattern))),isWellFormedInteger=wellFormedIntegerMatcher.test.bind(wellFormedIntegerMatcher),integerLikeMatcher=/^-?\d+$/,isIntegerLike=integerLikeMatcher.test.bind(integerLikeMatcher),numericLiteralDescriptions={number:"a number",bigint:"a bigint",integer:"an integer"},writeMalformedNumericLiteralMessage=(d,m)=>`'${d}' was parsed as ${numericLiteralDescriptions[m]} but could not be narrowed to a literal value. Avoid unnecessary leading or trailing zeros and other abnormal notation`,isWellFormed=(d,m)=>m==="number"?isWellFormedNumber(d):isWellFormedInteger(d),parseKind=(d,m)=>m==="number"?Number(d):Number.parseInt(d),isKindLike=(d,m)=>m==="number"?isNumberLike(d):isIntegerLike(d),tryParseNumber=(d,m)=>parseNumeric(d,"number",m),tryParseWellFormedNumber=(d,m)=>parseNumeric(d,"number",{...m,strict:!0}),tryParseInteger=(d,m)=>parseNumeric(d,"integer",m),parseNumeric=(d,m,g)=>{const w=parseKind(d,m);return!Number.isNaN(w)&&isKindLike(d,m)?g?.strict?isWellFormed(d,m)?w:throwParseError(writeMalformedNumericLiteralMessage(d,m)):w:g?.errorOnFail?throwParseError(g?.errorOnFail===!0?`Failed to parse ${numericLiteralDescriptions[m]} from '${d}'`:g?.errorOnFail):void 0},tryParseWellFormedBigint=d=>{if(d[d.length-1]!=="n")return;const m=d.slice(0,-1);let g;try{g=BigInt(m)}catch{return}if(wellFormedIntegerMatcher.test(m))return g;if(integerLikeMatcher.test(m))return throwParseError(writeMalformedNumericLiteralMessage(d,"bigint"))},arkUtilVersion="0.50.0",initialRegistryContents={version:arkUtilVersion,filename:isomorphic.fileName(),FileConstructor},registry=initialRegistryContents,namesByResolution=new Map,nameCounts=Object.create(null),register=d=>{const m=namesByResolution.get(d);if(m)return m;let g=baseNameFor(d);return nameCounts[g]?g=`${g}${nameCounts[g]++}`:nameCounts[g]=1,registry[g]=d,namesByResolution.set(d,g),g},isDotAccessible=d=>/^[$A-Z_a-z][\w$]*$/.test(d),baseNameFor=d=>{switch(typeof d){case"object":{if(d===null)break;const m=objectKindOf(d)??"object";return m[0].toLowerCase()+m.slice(1)}case"function":return isDotAccessible(d.name)?d.name:"fn";case"symbol":return d.description&&isDotAccessible(d.description)?d.description:"symbol"}return throwInternalError(`Unexpected attempt to register serializable value of type ${domainOf(d)}`)},serializePrimitive=d=>typeof d=="string"?JSON.stringify(d):typeof d=="bigint"?`${d}n`:`${d}`,snapshot=(d,m={})=>_serialize(d,{onUndefined:"$ark.undefined",onBigInt:g=>`$ark.bigint-${g}`,...m},[]),printable=(d,m)=>{switch(domainOf(d)){case"object":const g=d,w=g.constructor.name;return w==="Object"||w==="Array"?m?.quoteKeys===!1?stringifyUnquoted(g,m?.indent??0,""):JSON.stringify(_serialize(g,printableOpts,[]),null,m?.indent):stringifyUnquoted(g,m?.indent??0,"");case"symbol":return printableOpts.onSymbol(d);default:return serializePrimitive(d)}},stringifyUnquoted=(d,m,g)=>{if(typeof d=="function")return printableOpts.onFunction(d);if(typeof d!="object"||d===null)return serializePrimitive(d);const w=g+" ".repeat(m);if(Array.isArray(d)){if(d.length===0)return"[]";const I=d.map(D=>stringifyUnquoted(D,m,w)).join(`,
`+w);return m?`[
${w}${I}
${g}]`:`[${I}]`}const $=d.constructor.name;if($==="Object"){const I=stringAndSymbolicEntriesOf(d).map(([D,q])=>{const j=typeof D=="symbol"?printableOpts.onSymbol(D):isDotAccessible(D)?D:JSON.stringify(D),G=stringifyUnquoted(q,m,w);return`${w}${j}: ${G}`});return I.length===0?"{}":m?`{
${I.join(`,
`)}
${g}}`:`{${I.join(", ")}}`}return d instanceof Date?describeCollapsibleDate(d):"expression"in d&&typeof d.expression=="string"?d.expression:$},printableOpts={onCycle:()=>"(cycle)",onSymbol:d=>`Symbol(${register(d)})`,onFunction:d=>`Function(${register(d)})`},_serialize=(d,m,g)=>{switch(domainOf(d)){case"object":{const w=d;if("toJSON"in w&&typeof w.toJSON=="function")return w.toJSON();if(typeof w=="function")return printableOpts.onFunction(w);if(g.includes(w))return"(cycle)";const $=[...g,w];if(Array.isArray(w))return w.map(D=>_serialize(D,m,$));if(w instanceof Date)return w.toDateString();const I={};for(const D in w)I[D]=_serialize(w[D],m,$);for(const D of Object.getOwnPropertySymbols(w))I[m.onSymbol?.(D)??D.toString()]=_serialize(w[D],m,$);return I}case"symbol":return printableOpts.onSymbol(d);case"bigint":return m.onBigInt?.(d)??`${d}n`;case"undefined":return m.onUndefined??"undefined";case"string":return d.replaceAll("\\","\\\\");default:return d}},describeCollapsibleDate=d=>{const m=d.getFullYear(),g=d.getMonth(),w=d.getDate(),$=d.getHours(),I=d.getMinutes(),D=d.getSeconds(),q=d.getMilliseconds();if(g===0&&w===1&&$===0&&I===0&&D===0&&q===0)return`${m}`;const j=`${months[g]} ${w}, ${m}`;if($===0&&I===0&&D===0&&q===0)return j;let G=d.toLocaleTimeString();const H=G.endsWith(" AM")||G.endsWith(" PM")?G.slice(-3):"";return H&&(G=G.slice(0,-H.length)),q?G+=`.${pad(q,3)}`:timeWithUnnecessarySeconds.test(G)&&(G=G.slice(0,-3)),`${G+H}, ${j}`},months=["January","February","March","April","May","June","July","August","September","October","November","December"],timeWithUnnecessarySeconds=/:\d\d:00$/,pad=(d,m)=>String(d).padStart(m,"0"),appendStringifiedKey=(d,m,...[g])=>{const w=g?.stringifySymbol??printable;let $=d;switch(typeof m){case"string":$=isDotAccessible(m)?d===""?m:`${d}.${m}`:`${d}[${JSON.stringify(m)}]`;break;case"number":$=`${d}[${m}]`;break;case"symbol":$=`${d}[${w(m)}]`;break;default:g?.stringifyNonKey?$=`${d}[${g.stringifyNonKey(m)}]`:throwParseError(`${printable(m)} must be a PropertyKey or stringifyNonKey must be passed to options`)}return $},stringifyPath=(d,...m)=>d.reduce((g,w)=>appendStringifiedKey(g,w,...m),"");class ReadonlyPath extends ReadonlyArray{cache={};constructor(...m){super(),this.push(...m)}toJSON(){if(this.cache.json)return this.cache.json;this.cache.json=[];for(let m=0;m<this.length;m++)this.cache.json.push(typeof this[m]=="symbol"?printable(this[m]):this[m]);return this.cache.json}stringify(){return this.cache.stringify?this.cache.stringify:this.cache.stringify=stringifyPath(this)}stringifyAncestors(){if(this.cache.stringifyAncestors)return this.cache.stringifyAncestors;let m="";const g=[m];for(const w of this)m=appendStringifiedKey(m,w),g.push(m);return this.cache.stringifyAncestors=g}}class Scanner{chars;i;def;constructor(m){this.def=m,this.chars=[...m],this.i=0}shift(){return this.chars[this.i++]??""}get lookahead(){return this.chars[this.i]??""}get nextLookahead(){return this.chars[this.i+1]??""}get length(){return this.chars.length}shiftUntil(m){let g="";for(;this.lookahead&&!m(this,g);)g+=this.shift();return g}shiftUntilEscapable(m){let g="";for(;this.lookahead;)if(this.lookahead===Backslash)this.shift(),m(this,g)?g+=this.shift():this.lookahead===Backslash?g+=this.shift():g+=`${Backslash}${this.shift()}`;else{if(m(this,g))break;g+=this.shift()}return g}shiftUntilLookahead(m){return typeof m=="string"?this.shiftUntil(g=>g.lookahead===m):this.shiftUntil(g=>g.lookahead in m)}shiftUntilNonWhitespace(){return this.shiftUntil(()=>!(this.lookahead in whitespaceChars))}jumpToIndex(m){this.i=m<0?this.length+m:m}jumpForward(m){this.i+=m}get location(){return this.i}get unscanned(){return this.chars.slice(this.i,this.length).join("")}get scanned(){return this.chars.slice(0,this.i).join("")}sliceChars(m,g){return this.chars.slice(m,g).join("")}lookaheadIs(m){return this.lookahead===m}lookaheadIsIn(m){return this.lookahead in m}}const writeUnmatchedGroupCloseMessage=(d,m)=>`Unmatched ${d}${m===""?"":` before ${m}`}`,writeUnclosedGroupMessage=d=>`Missing ${d}`;let _registryName="$ark",suffix=2;for(;_registryName in globalThis;)_registryName=`$ark${suffix++}`;const registryName=_registryName;globalThis[registryName]=registry;const $ark=registry,reference=d=>`${registryName}.${d}`,registeredReference=d=>reference(register(d));class CompiledFunction extends CastableBase{argNames;body="";constructor(...m){super(),this.argNames=m;for(const g of m){if(g in this)throw new Error(`Arg name '${g}' would overwrite an existing property on FunctionBody`);this[g]=g}}indentation=0;indent(){return this.indentation+=4,this}dedent(){return this.indentation-=4,this}prop(m,g=!1){return compileLiteralPropAccess(m,g)}index(m,g=!1){return indexPropAccess(`${m}`,g)}line(m){return this.body+=`${" ".repeat(this.indentation)}${m}
`,this}const(m,g){return this.line(`const ${m} = ${g}`),this}let(m,g){return this.line(`let ${m} = ${g}`)}set(m,g){return this.line(`${m} = ${g}`)}if(m,g){return this.block(`if (${m})`,g)}elseIf(m,g){return this.block(`else if (${m})`,g)}else(m){return this.block("else",m)}for(m,g,w=0){return this.block(`for (let i = ${w}; ${m}; i++)`,g)}forIn(m,g){return this.block(`for (const k in ${m})`,g)}block(m,g,w=""){return this.line(`${m} {`),this.indent(),g(this),this.dedent(),this.line(`}${w}`)}return(m=""){return this.line(`return ${m}`)}write(m="anonymous",g=0){return`${m}(${this.argNames.join(", ")}) { ${g?this.body.split(`
`).map(w=>" ".repeat(g)+`${w}`).join(`
`):this.body} }`}compile(){return new DynamicFunction(...this.argNames,this.body)}}const compileSerializedValue=d=>hasDomain(d,"object")||typeof d=="symbol"?registeredReference(d):serializePrimitive(d),compileLiteralPropAccess=(d,m=!1)=>typeof d=="string"&&isDotAccessible(d)?`${m?"?":""}.${d}`:indexPropAccess(serializeLiteralKey(d),m),serializeLiteralKey=d=>typeof d=="symbol"?registeredReference(d):JSON.stringify(d),indexPropAccess=(d,m=!1)=>`${m?"?.":""}[${d}]`;class NodeCompiler extends CompiledFunction{traversalKind;optimistic;constructor(m){super("data","ctx"),this.traversalKind=m.kind,this.optimistic=m.optimistic===!0}invoke(m,g){const w=g?.arg??this.data,$=typeof m=="string"?!0:this.requiresContextFor(m),I=typeof m=="string"?m:m.id;return $?`${this.referenceToId(I,g)}(${w}, ${this.ctx})`:`${this.referenceToId(I,g)}(${w})`}referenceToId(m,g){const w=g?.kind??this.traversalKind,$=`this.${m}${w}`;return g?.bind?`${$}.bind(${g?.bind})`:$}requiresContextFor(m){return this.traversalKind==="Apply"||m.allowsRequiresContext}initializeErrorCount(){return this.const("errorCount","ctx.currentErrorCount")}returnIfFail(){return this.if("ctx.currentErrorCount > errorCount",()=>this.return())}returnIfFailFast(){return this.if("ctx.failFast && ctx.currentErrorCount > errorCount",()=>this.return())}traverseKey(m,g,w){const $=this.requiresContextFor(w);return $&&this.line(`${this.ctx}.path.push(${m})`),this.check(w,{arg:g}),$&&this.line(`${this.ctx}.path.pop()`),this}check(m,g){return this.traversalKind==="Allows"?this.if(`!${this.invoke(m,g)}`,()=>this.return(!1)):this.line(this.invoke(m,g))}}const makeRootAndArrayPropertiesMutable=d=>flatMorph(d,(m,g)=>[m,isArray$1(g)?[...g]:g]),arkKind=noSuggest("arkKind"),hasArkKind=(d,m)=>d?.[arkKind]===m,isNode$1=d=>hasArkKind(d,"root")||hasArkKind(d,"constraint"),basisKinds=["unit","proto","domain"],structuralKinds=["required","optional","index","sequence"],prestructuralKinds=["pattern","divisor","exactLength","max","min","maxLength","minLength","before","after"],refinementKinds=[...prestructuralKinds,"structure","predicate"],constraintKinds=[...refinementKinds,...structuralKinds],rootKinds=["alias","union","morph","unit","intersection","proto","domain"],nodeKinds=[...rootKinds,...constraintKinds],constraintKeys=flatMorph(constraintKinds,(d,m)=>[m,1]),structureKeys=flatMorph([...structuralKinds,"undeclared"],(d,m)=>[m,1]),precedenceByKind=flatMorph(nodeKinds,(d,m)=>[m,d]),isNodeKind=d=>typeof d=="string"&&d in precedenceByKind,precedenceOfKind=d=>precedenceByKind[d],schemaKindsRightOf=d=>rootKinds.slice(precedenceOfKind(d)+1);[...schemaKindsRightOf("union")];[...schemaKindsRightOf("morph")];const defaultValueSerializer=d=>typeof d=="string"||typeof d=="boolean"||d===null?d:typeof d=="number"?Number.isNaN(d)?"NaN":d===Number.POSITIVE_INFINITY?"Infinity":d===Number.NEGATIVE_INFINITY?"-Infinity":d:compileSerializedValue(d),compileObjectLiteral=d=>{let m="{ ";for(const[g,w]of Object.entries(d))m+=`${g}: ${compileSerializedValue(w)}, `;return m+" }"},implementNode=d=>{const m=d;return m.hasAssociatedError&&(m.defaults.expected??=g=>"description"in g?g.description:m.defaults.description(g),m.defaults.actual??=g=>printable(g),m.defaults.problem??=g=>`must be ${g.expected}${g.actual?` (was ${g.actual})`:""}`,m.defaults.message??=g=>{if(g.path.length===0)return g.problem;const w=`${g.propString} ${g.problem}`;return w[0]==="["?`value at ${w}`:w}),m};class ToJsonSchemaError extends Error{name="ToJsonSchemaError";code;context;constructor(m,g){super(printable(g,{quoteKeys:!1,indent:4})),this.code=m,this.context=g}hasCode(m){return this.code===m}}const defaultConfig={dialect:"https://json-schema.org/draft/2020-12/schema",useRefs:!1,fallback:{arrayObject:d=>ToJsonSchema.throw("arrayObject",d),arrayPostfix:d=>ToJsonSchema.throw("arrayPostfix",d),defaultValue:d=>ToJsonSchema.throw("defaultValue",d),domain:d=>ToJsonSchema.throw("domain",d),morph:d=>ToJsonSchema.throw("morph",d),patternIntersection:d=>ToJsonSchema.throw("patternIntersection",d),predicate:d=>ToJsonSchema.throw("predicate",d),proto:d=>ToJsonSchema.throw("proto",d),symbolKey:d=>ToJsonSchema.throw("symbolKey",d),unit:d=>ToJsonSchema.throw("unit",d),date:d=>ToJsonSchema.throw("date",d)}},ToJsonSchema={Error:ToJsonSchemaError,throw:(...d)=>{throw new ToJsonSchema.Error(...d)},throwInternalOperandError:(d,m)=>throwInternalError(`Unexpected JSON Schema input for ${d}: ${printable(m)}`),defaultConfig};$ark.config??={};const mergeConfigs=(d,m)=>{if(!m)return d;const g={...d};let w;for(w in m){const $={...d.keywords};if(w==="keywords"){for(const I in m[w]){const D=m.keywords[I];D!==void 0&&($[I]=typeof D=="string"?{description:D}:D)}g.keywords=$}else w==="toJsonSchema"?g[w]=mergeToJsonSchemaConfigs(d.toJsonSchema,m.toJsonSchema):isNodeKind(w)?g[w]={...d[w],...m[w]}:g[w]=m[w]}return g},mergeToJsonSchemaConfigs=((d,m)=>{if(!d)return m??{};if(!m)return d;const g={...d};let w;for(w in m)w==="fallback"?g.fallback=mergeFallbacks(d.fallback,m.fallback):g[w]=m[w];return g}),mergeFallbacks=(d,m)=>{d=normalizeFallback(d),m=normalizeFallback(m);const g={};let w;for(w in ToJsonSchema.defaultConfig.fallback)g[w]=m[w]??m.default??d[w]??d.default??ToJsonSchema.defaultConfig.fallback[w];return g},normalizeFallback=d=>typeof d=="function"?{default:d}:d??{};class ArkError extends CastableBase{[arkKind]="error";path;data;nodeConfig;input;ctx;constructor({prefixPath:m,relativePath:g,...w},$){super(),this.input=w,this.ctx=$,defineProperties(this,w);const I=$.data;w.code==="union"&&(w.errors=w.errors.flatMap(q=>{const j=q.hasCode("union")?q.errors:[q];return!m&&!g?j:j.map(G=>G.transform(H=>({...H,path:conflatenateAll(m,H.path,g)})))})),this.nodeConfig=$.config[this.code];const D=[...w.path??$.path];g&&D.push(...g),m&&D.unshift(...m),this.path=new ReadonlyPath(...D),this.data="data"in w?w.data:I}transform(m){return new ArkError(m({data:this.data,path:this.path,...this.input}),this.ctx)}hasCode(m){return this.code===m}get propString(){return stringifyPath(this.path)}get expected(){if(this.input.expected)return this.input.expected;const m=this.meta?.expected??this.nodeConfig.expected;return typeof m=="function"?m(this.input):m}get actual(){if(this.input.actual)return this.input.actual;const m=this.meta?.actual??this.nodeConfig.actual;return typeof m=="function"?m(this.data):m}get problem(){if(this.input.problem)return this.input.problem;const m=this.meta?.problem??this.nodeConfig.problem;return typeof m=="function"?m(this):m}get message(){if(this.input.message)return this.input.message;const m=this.meta?.message??this.nodeConfig.message;return typeof m=="function"?m(this):m}get flat(){return this.hasCode("intersection")?[...this.errors]:[this]}toJSON(){return{data:this.data,path:this.path,...this.input,expected:this.expected,actual:this.actual,problem:this.problem,message:this.message}}toString(){return this.message}throw(){throw this}}class ArkErrors extends ReadonlyArray{[arkKind]="errors";ctx;constructor(m){super(),this.ctx=m}byPath=Object.create(null);get flatByPath(){return flatMorph(this.byPath,(m,g)=>[m,g.flat])}get flatProblemsByPath(){return flatMorph(this.byPath,(m,g)=>[m,g.flat.map(w=>w.problem)])}byAncestorPath=Object.create(null);count=0;mutable=this;throw(){throw this.toTraversalError()}toTraversalError(){return new TraversalError(this)}add(m){const g=this.byPath[m.propString];if(g){if(m===g||g.hasCode("union")&&g.errors.length===0)return;const w=m.hasCode("union")&&m.errors.length===0?m:new ArkError({code:"intersection",errors:g.hasCode("intersection")?[...g.errors,m]:[g,m]},this.ctx),$=this.indexOf(g);this.mutable[$===-1?this.length:$]=w,this.byPath[m.propString]=w,this.addAncestorPaths(m)}else this.byPath[m.propString]=m,this.addAncestorPaths(m),this.mutable.push(m);this.count++}transform(m){const g=new ArkErrors(this.ctx);for(const w of this)g.add(m(w));return g}merge(m){for(const g of m)this.add(new ArkError({...g,path:[...this.ctx.path,...g.path]},this.ctx))}affectsPath(m){return this.length===0?!1:m.stringifyAncestors().some(g=>g in this.byPath)||m.stringify()in this.byAncestorPath}get summary(){return this.toString()}get issues(){return this}toJSON(){return[...this.map(m=>m.toJSON())]}toString(){return this.join(`
`)}addAncestorPaths(m){for(const g of m.path.stringifyAncestors())this.byAncestorPath[g]=append(this.byAncestorPath[g],m)}}class TraversalError extends Error{name="TraversalError";constructor(m){m.length===1?super(m.summary):super(`
`+m.map(g=>`  â€¢ ${indent(g)}`).join(`
`)),Object.defineProperty(this,"arkErrors",{value:m,enumerable:!1})}}const indent=d=>d.toString().split(`
`).join(`
  `);class Traversal{path=[];errors=new ArkErrors(this);root;config;queuedMorphs=[];branches=[];seen={};constructor(m,g){this.root=m,this.config=g}get data(){let m=this.root;for(const g of this.path)m=m?.[g];return m}get propString(){return stringifyPath(this.path)}reject(m){return this.error(m),!1}mustBe(m){return this.error(m),!1}error(m){const g=typeof m=="object"?m.code?m:{...m,code:"predicate"}:{code:"predicate",expected:m};return this.errorFromContext(g)}hasError(){return this.currentErrorCount!==0}get currentBranch(){return this.branches.at(-1)}queueMorphs(m){const g={path:new ReadonlyPath(...this.path),morphs:m};this.currentBranch?this.currentBranch.queuedMorphs.push(g):this.queuedMorphs.push(g)}finalize(m){return this.queuedMorphs.length&&(typeof this.root=="object"&&this.root!==null&&this.config.clone&&(this.root=this.config.clone(this.root)),this.applyQueuedMorphs()),this.hasError()?m?m(this.errors):this.errors:this.root}get currentErrorCount(){return this.currentBranch?this.currentBranch.error?1:0:this.errors.count}get failFast(){return this.branches.length!==0}pushBranch(){this.branches.push({error:void 0,queuedMorphs:[]})}popBranch(){return this.branches.pop()}get external(){return this}errorFromNodeContext(m){return this.errorFromContext(m)}errorFromContext(m){const g=new ArkError(m,this);return this.currentBranch?this.currentBranch.error=g:this.errors.add(g),g}applyQueuedMorphs(){for(;this.queuedMorphs.length;){const m=this.queuedMorphs;this.queuedMorphs=[];for(const{path:g,morphs:w}of m)this.errors.affectsPath(g)||this.applyMorphsAtPath(g,w)}}applyMorphsAtPath(m,g){const w=m.at(-1);let $;if(w!==void 0){$=this.root;for(let I=0;I<m.length-1;I++)$=$[m[I]]}for(const I of g){this.path=[...m];const D=isNode$1(I),q=I($===void 0?this.root:$[w],this);if(q instanceof ArkError){this.errors.add(q);break}if(q instanceof ArkErrors){D||this.errors.merge(q),this.queuedMorphs=[];break}$===void 0?this.root=q:$[w]=q,this.applyQueuedMorphs()}}}const traverseKey=(d,m,g)=>{if(!g)return m();g.path.push(d);const w=m();return g.path.pop(),w};class BaseNode extends Callable{attachments;$;onFail;includesTransform;includesContextualPredicate;isCyclic;allowsRequiresContext;rootApplyStrategy;contextFreeMorph;rootApply;referencesById;shallowReferences;flatRefs;flatMorphs;allows;get shallowMorphs(){return[]}constructor(m,g){super(($,I,D=this.onFail)=>I?(this.traverseApply($,I),I.hasError()?I.errors:I.data):this.rootApply($,D),{attach:m}),this.attachments=m,this.$=g,this.onFail=this.meta.onFail??this.$.resolvedConfig.onFail,this.includesTransform=this.hasKind("morph")||this.hasKind("structure")&&this.structuralMorph!==void 0||this.hasKind("sequence")&&this.inner.defaultables!==void 0,this.includesContextualPredicate=this.hasKind("predicate")&&this.inner.predicate.length!==1,this.isCyclic=this.kind==="alias",this.referencesById={[this.id]:this},this.shallowReferences=this.hasKind("structure")?[this,...this.children]:this.children.reduce(($,I)=>appendUniqueNodes($,I.shallowReferences),[this]);const w=this.isStructural();this.flatRefs=[],this.flatMorphs=[];for(let $=0;$<this.children.length;$++){if(this.includesTransform||=this.children[$].includesTransform,this.includesContextualPredicate||=this.children[$].includesContextualPredicate,this.isCyclic||=this.children[$].isCyclic,!w){const I=this.children[$].flatRefs;for(let D=0;D<I.length;D++){const q=I[D];if(!this.flatRefs.some(j=>flatRefsAreEqual(j,q))){this.flatRefs.push(q);for(const j of q.node.branches)(j.hasKind("morph")||j.hasKind("intersection")&&j.structure?.structuralMorph!==void 0)&&this.flatMorphs.push({path:q.path,propString:q.propString,node:j})}}}Object.assign(this.referencesById,this.children[$].referencesById)}this.flatRefs.sort(($,I)=>$.path.length>I.path.length?1:$.path.length<I.path.length?-1:$.propString>I.propString?1:$.propString<I.propString||$.node.expression<I.node.expression?-1:1),this.allowsRequiresContext=this.includesContextualPredicate||this.isCyclic,this.rootApplyStrategy=!this.allowsRequiresContext&&this.flatMorphs.length===0?this.shallowMorphs.length===0?"allows":this.shallowMorphs.every($=>$.length===1||$.name==="$arkStructuralMorph")?this.hasKind("union")?this.branches.some($=>$.shallowMorphs.length>1)?"contextual":"branchedOptimistic":this.shallowMorphs.length>1?"contextual":"optimistic":"contextual":"contextual",this.rootApply=this.createRootApply(),this.allows=this.allowsRequiresContext?$=>this.traverseAllows($,new Traversal($,this.$.resolvedConfig)):$=>this.traverseAllows($)}createRootApply(){switch(this.rootApplyStrategy){case"allows":return(g,w)=>{if(this.allows(g))return g;const $=new Traversal(g,this.$.resolvedConfig);return this.traverseApply(g,$),$.finalize(w)};case"contextual":return(g,w)=>{const $=new Traversal(g,this.$.resolvedConfig);return this.traverseApply(g,$),$.finalize(w)};case"optimistic":this.contextFreeMorph=this.shallowMorphs[0];const m=this.$.resolvedConfig.clone;return(g,w)=>{if(this.allows(g))return this.contextFreeMorph(m&&(typeof g=="object"&&g!==null||typeof g=="function")?m(g):g);const $=new Traversal(g,this.$.resolvedConfig);return this.traverseApply(g,$),$.finalize(w)};case"branchedOptimistic":return this.createBranchedOptimisticRootApply();default:return this.rootApplyStrategy,throwInternalError(`Unexpected rootApplyStrategy ${this.rootApplyStrategy}`)}}compiledMeta=compileMeta(this.metaJson);cacheGetter(m,g){return Object.defineProperty(this,m,{value:g}),g}get description(){return this.cacheGetter("description",this.meta?.description??this.$.resolvedConfig[this.kind].description(this))}get references(){return Object.values(this.referencesById)}precedence=precedenceOfKind(this.kind);precompilation;assert=(m,g)=>this(m,g,w=>w.throw());traverse(m,g){return this(m,g,null)}get in(){return this.cacheGetter("in",this.rawIn.isRoot()?this.$.finalize(this.rawIn):this.rawIn)}get rawIn(){return this.cacheGetter("rawIn",this.getIo("in"))}get out(){return this.cacheGetter("out",this.rawOut.isRoot()?this.$.finalize(this.rawOut):this.rawOut)}get rawOut(){return this.cacheGetter("rawOut",this.getIo("out"))}getIo(m){if(!this.includesTransform)return this;const g={};for(const[w,$]of this.innerEntries){const I=this.impl.keys[w];if(I.reduceIo)I.reduceIo(m,g,$);else if(I.child){const D=$;g[w]=isArray$1(D)?D.map(q=>m==="in"?q.rawIn:q.rawOut):m==="in"?D.rawIn:D.rawOut}else g[w]=$}return this.$.node(this.kind,g)}toJSON(){return this.json}toString(){return`Type<${this.expression}>`}equals(m){const g=isNode$1(m)?m:this.$.parseDefinition(m);return this.innerHash===g.innerHash}ifEquals(m){return this.equals(m)?this:void 0}hasKind(m){return this.kind===m}assertHasKind(m){return this.kind!==m&&throwError(`${this.kind} node was not of asserted kind ${m}`),this}hasKindIn(...m){return m.includes(this.kind)}assertHasKindIn(...m){return includes(m,this.kind)||throwError(`${this.kind} node was not one of asserted kinds ${m}`),this}isBasis(){return includes(basisKinds,this.kind)}isConstraint(){return includes(constraintKinds,this.kind)}isStructural(){return includes(structuralKinds,this.kind)}isRefinement(){return includes(refinementKinds,this.kind)}isRoot(){return includes(rootKinds,this.kind)}isUnknown(){return this.hasKind("intersection")&&this.children.length===0}isNever(){return this.hasKind("union")&&this.children.length===0}hasUnit(m){return this.hasKind("unit")&&this.allows(m)}hasOpenIntersection(){return this.impl.intersectionIsOpen}get nestableExpression(){return this.expression}select(m){const g=NodeSelector.normalize(m);return this._select(g)}_select(m){let g=NodeSelector.applyBoundary[m.boundary??"references"](this);return m.kind&&(g=g.filter(w=>w.kind===m.kind)),m.where&&(g=g.filter(m.where)),NodeSelector.applyMethod[m.method??"filter"](g,this,m)}transform(m,g){return this._transform(m,this._createTransformContext(g))}_createTransformContext(m){return{root:this,selected:void 0,seen:{},path:[],parseOptions:{prereduced:m?.prereduced??!1},undeclaredKeyHandling:void 0,...m}}_transform(m,g){const w=g.bindScope??this.$;if(g.seen[this.id])return this.$.lazilyResolve(g.seen[this.id]);if(g.shouldTransform?.(this,g)===!1)return this;let $;g.seen[this.id]=()=>$,this.hasKind("structure")&&this.undeclared!==g.undeclaredKeyHandling&&(g={...g,undeclaredKeyHandling:this.undeclared});const I=flatMorph(this.inner,(H,W)=>{if(!this.impl.keys[H].child)return[H,W];const V=W;if(!isArray$1(V)){const Z=V._transform(m,g);return Z?[H,Z]:[]}if(V.length===0)return[H,W];const K=V.flatMap(Z=>Z._transform(m,g)??[]);return K.length?[H,K]:[]});delete g.seen[this.id];const D=Object.assign(I,{meta:this.meta}),q=g.selected&&!g.selected.includes(this)?D:m(this.kind,D,g);if(q===null)return null;if(isNode$1(q))return $=q;const j=Object.keys(q);return(j.length===0||j.length===1&&j[0]==="meta")&&!isEmptyObject(this.inner)?null:(this.kind==="required"||this.kind==="optional"||this.kind==="index")&&!("value"in q)?g.undeclaredKeyHandling?{...q,value:$ark.intrinsic.unknown}:null:(this.kind==="morph"&&(q.in??=$ark.intrinsic.unknown),$=w.node(this.kind,q,g.parseOptions))}configureReferences(m,g="references"){const w=NodeSelector.normalize(g),$=typeof m=="string"?(j,G)=>({...G,meta:{...G.meta,description:m}}):typeof m=="function"?(j,G)=>({...G,meta:m(G.meta)}):(j,G)=>({...G,meta:{...G.meta,...m}});if(w.boundary==="self")return this.$.node(this.kind,$(this.kind,{...this.inner,meta:this.meta}));const I=this._select(w),D=I&&liftArray(I),q=w.boundary==="child"?(j,G)=>G.root.children.includes(j):w.boundary==="shallow"?j=>j.kind!=="structure":()=>!0;return this.$.finalize(this.transform($,{shouldTransform:q,selected:D}))}}const NodeSelector={applyBoundary:{self:d=>[d],child:d=>[...d.children],shallow:d=>[...d.shallowReferences],references:d=>[...d.references]},applyMethod:{filter:d=>d,assertFilter:(d,m,g)=>(d.length===0&&throwError(writeSelectAssertionMessage(m,g)),d),find:d=>d[0],assertFind:(d,m,g)=>(d.length===0&&throwError(writeSelectAssertionMessage(m,g)),d[0])},normalize:d=>typeof d=="function"?{boundary:"references",method:"filter",where:d}:typeof d=="string"?isKeyOf(d,NodeSelector.applyBoundary)?{method:"filter",boundary:d}:{boundary:"references",method:"filter",kind:d}:{boundary:"references",method:"filter",...d}},writeSelectAssertionMessage=(d,m)=>`${d} had no references matching ${printable(m)}.`,typePathToPropString=d=>stringifyPath(d,{stringifyNonKey:m=>m.expression}),referenceMatcher=/"(\$ark\.[^"]+)"/g,compileMeta=d=>JSON.stringify(d).replaceAll(referenceMatcher,"$1"),flatRef=(d,m)=>({path:d,node:m,propString:typePathToPropString(d)}),flatRefsAreEqual=(d,m)=>d.propString===m.propString&&d.node.equals(m.node),appendUniqueFlatRefs=(d,m)=>appendUnique(d,m,{isEqual:flatRefsAreEqual}),appendUniqueNodes=(d,m)=>appendUnique(d,m,{isEqual:(g,w)=>g.equals(w)});class Disjoint extends Array{static init(m,g,w,$){return new Disjoint({kind:m,l:g,r:w,path:$?.path??[],optional:$?.optional??!1})}add(m,g,w,$){return this.push({kind:m,l:g,r:w,path:$?.path??[],optional:$?.optional??!1}),this}get summary(){return this.describeReasons()}describeReasons(){if(this.length===1){const{path:m,l:g,r:w}=this[0],$=stringifyPath(m);return writeUnsatisfiableExpressionError(`Intersection${$&&` at ${$}`} of ${describeReasons(g,w)}`)}return`The following intersections result in unsatisfiable types:
â€¢ ${this.map(({path:m,l:g,r:w})=>`${m}: ${describeReasons(g,w)}`).join(`
â€¢ `)}`}throw(){return throwParseError(this.describeReasons())}invert(){const m=this.map(g=>({...g,l:g.r,r:g.l}));return m instanceof Disjoint?m:new Disjoint(...m)}withPrefixKey(m,g){return this.map(w=>({...w,path:[m,...w.path],optional:w.optional||g==="optional"}))}toNeverIfDisjoint(){return $ark.intrinsic.never}}const describeReasons=(d,m)=>`${describeReason(d)} and ${describeReason(m)}`,describeReason=d=>isNode$1(d)?d.expression:isArray$1(d)?d.map(describeReason).join(" | ")||"never":String(d),writeUnsatisfiableExpressionError=d=>`${d} results in an unsatisfiable type`,intersectionCache={},intersectNodesRoot=(d,m,g)=>intersectOrPipeNodes(d,m,{$:g,invert:!1,pipe:!1}),pipeNodesRoot=(d,m,g)=>intersectOrPipeNodes(d,m,{$:g,invert:!1,pipe:!0}),intersectOrPipeNodes=((d,m,g)=>{const w=g.pipe?"|>":"&",$=`${d.hash}${w}${m.hash}`;if(intersectionCache[$]!==void 0)return intersectionCache[$];if(!g.pipe){const q=`${m.hash}${w}${d.hash}`;if(intersectionCache[q]!==void 0){const j=intersectionCache[q],G=j instanceof Disjoint?j.invert():j;return intersectionCache[$]=G,G}}const I=!g.pipe||!d.includesTransform&&!m.includesTransform;if(I&&d.equals(m))return d;let D=I?_intersectNodes(d,m,g):d.hasKindIn(...rootKinds)?_pipeNodes(d,m,g):_intersectNodes(d,m,g);return isNode$1(D)&&(d.equals(D)?D=d:m.equals(D)&&(D=m)),intersectionCache[$]=D,D}),_intersectNodes=(d,m,g)=>{const w=d.precedence<m.precedence?d.kind:m.kind,$=d.impl.intersections[m.kind]??m.impl.intersections[d.kind];if($===void 0)return null;if(w===d.kind)return $(d,m,g);{let I=$(m,d,{...g,invert:!g.invert});return I instanceof Disjoint&&(I=I.invert()),I}},_pipeNodes=(d,m,g)=>d.includesTransform||m.includesTransform?g.invert?pipeMorphed(m,d,g):pipeMorphed(d,m,g):_intersectNodes(d,m,g),pipeMorphed=(d,m,g)=>d.distribute(w=>_pipeMorphed(w,m,g),w=>{const $=w.filter(isNode$1);if($.length===0)return Disjoint.init("union",d.branches,m.branches);if($.length<d.branches.length||!d.branches.every((D,q)=>D.rawIn.equals($[q].rawIn)))return g.$.parseSchema($);if($.length===1)return $[0];const I={branches:$};return g.$.parseSchema(I)}),_pipeMorphed=(d,m,g)=>{if(d.hasKind("morph")){const $=[...d.morphs];if(d.lastMorphIfNode){const I=intersectOrPipeNodes(d.lastMorphIfNode,m,g);if(I instanceof Disjoint)return I;$[$.length-1]=I}else $.push(m);return g.$.node("morph",{morphs:$,in:d.inner.in})}if(m.hasKind("morph")){const $=intersectOrPipeNodes(d,m.rawIn,g);return $ instanceof Disjoint?$:g.$.node("morph",{morphs:[m],in:$})}return g.$.node("morph",{morphs:[m],in:d})};class BaseConstraint extends BaseNode{constructor(m,g){super(m,g),Object.defineProperty(this,arkKind,{value:"constraint",enumerable:!1})}impliedSiblings;intersect(m){return intersectNodesRoot(this,m,this.$)}}class InternalPrimitiveConstraint extends BaseConstraint{traverseApply=(m,g)=>{this.traverseAllows(m,g)||g.errorFromNodeContext(this.errorContext)};compile(m){m.traversalKind==="Allows"?m.return(this.compiledCondition):m.if(this.compiledNegation,()=>m.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return compileObjectLiteral(this.errorContext)}}const constraintKeyParser=d=>(m,g)=>{if(isArray$1(m)){if(m.length===0)return;const $=m.map(I=>g.$.node(d,I));return d==="predicate"?$:$.sort((I,D)=>I.hash<D.hash?-1:1)}const w=g.$.node(d,m);return w.hasOpenIntersection()?[w]:w},intersectConstraints=d=>{const m=d.r.shift();if(!m){let w=d.l.length===0&&d.kind==="structure"?$ark.intrinsic.unknown.internal:d.ctx.$.node(d.kind,Object.assign(d.baseInner,unflattenConstraints(d.l)),{prereduced:!0});for(const $ of d.roots){if(w instanceof Disjoint)return w;w=intersectOrPipeNodes($,w,d.ctx)}return w}let g=!1;for(let w=0;w<d.l.length;w++){const $=intersectOrPipeNodes(d.l[w],m,d.ctx);if($!==null){if($ instanceof Disjoint)return $;if($.isRoot())return d.roots.push($),d.l.splice(w),intersectConstraints(d);if(!g)d.l[w]=$,g=!0;else if(!d.l.includes($))return throwInternalError(`Unexpectedly encountered multiple distinct intersection results for refinement ${m}`)}}if(g||d.l.push(m),d.kind==="intersection"&&m.impliedSiblings)for(const w of m.impliedSiblings)appendUnique(d.r,w);return intersectConstraints(d)},flattenConstraints=d=>Object.entries(d).flatMap(([g,w])=>g in constraintKeys?w:[]).sort((g,w)=>g.precedence<w.precedence?-1:g.precedence>w.precedence?1:g.kind==="predicate"&&w.kind==="predicate"?0:g.hash<w.hash?-1:1),unflattenConstraints=d=>{const m={};for(const g of d)if(g.hasOpenIntersection())m[g.kind]=append(m[g.kind],g);else{if(m[g.kind])return throwInternalError(`Unexpected intersection of closed refinements of kind ${g.kind}`);m[g.kind]=g}return m},throwInvalidOperandError=(...d)=>throwParseError(writeInvalidOperandMessage(...d)),writeInvalidOperandMessage=(d,m,g)=>{const w=g.hasKind("morph")?"a morph":g.isUnknown()?"unknown":g.exclude(m).defaultShortDescription;return`${capitalize$1(d)} operand must be ${m.description} (was ${w})`},parseGeneric=(d,m,g)=>new GenericRoot(d,m,g,g,null);class LazyGenericBody extends Callable{}class GenericRoot extends Callable{[arkKind]="generic";paramDefs;bodyDef;$;arg$;baseInstantiation;hkt;description;constructor(m,g,w,$,I){super((...D)=>{const q=flatMorph(this.names,(j,G)=>{const H=this.arg$.parse(D[j]);return H.extends(this.constraints[j])||throwParseError(writeUnsatisfiedParameterConstraintMessage(G,this.constraints[j].expression,H.expression)),[G,H]});if(this.defIsLazy()){const j=this.bodyDef(q);return this.$.parse(j)}return this.$.parse(g,{args:q})}),this.paramDefs=m,this.bodyDef=g,this.$=w,this.arg$=$,this.hkt=I,this.description=I?new I().description??`a generic type for ${I.constructor.name}`:"a generic type",this.baseInstantiation=this(...this.constraints)}defIsLazy(){return this.bodyDef instanceof LazyGenericBody}cacheGetter(m,g){return Object.defineProperty(this,m,{value:g}),g}get json(){return this.cacheGetter("json",{params:this.params.map(m=>m[1].isUnknown()?m[0]:[m[0],m[1].json]),body:snapshot(this.bodyDef)})}get params(){return this.cacheGetter("params",this.paramDefs.map(m=>typeof m=="string"?[m,$ark.intrinsic.unknown]:[m[0],this.$.parse(m[1])]))}get names(){return this.cacheGetter("names",this.params.map(m=>m[0]))}get constraints(){return this.cacheGetter("constraints",this.params.map(m=>m[1]))}get internal(){return this}get referencesById(){return this.baseInstantiation.internal.referencesById}get references(){return this.baseInstantiation.internal.references}}const writeUnsatisfiedParameterConstraintMessage=(d,m,g)=>`${d} must be assignable to ${m} (was ${g})`,implementation$l=implementNode({kind:"predicate",hasAssociatedError:!0,collapsibleKey:"predicate",keys:{predicate:{}},normalize:d=>typeof d=="function"?{predicate:d}:d,defaults:{description:d=>`valid according to ${d.predicate.name||"an anonymous predicate"}`},intersectionIsOpen:!0,intersections:{predicate:()=>null}});class PredicateNode extends BaseConstraint{serializedPredicate=registeredReference(this.predicate);compiledCondition=`${this.serializedPredicate}(data, ctx)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=null;expression=this.serializedPredicate;traverseAllows=this.predicate;errorContext={code:"predicate",description:this.description,meta:this.meta};compiledErrorContext=compileObjectLiteral(this.errorContext);traverseApply=(m,g)=>{!this.predicate(m,g.external)&&!g.hasError()&&g.errorFromNodeContext(this.errorContext)};compile(m){if(m.traversalKind==="Allows"){m.return(this.compiledCondition);return}m.if(`${this.compiledNegation} && !ctx.hasError()`,()=>m.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}reduceJsonSchema(m,g){return g.fallback.predicate({code:"predicate",base:m,predicate:this.predicate})}}const Predicate={implementation:implementation$l,Node:PredicateNode},implementation$k=implementNode({kind:"divisor",collapsibleKey:"rule",keys:{rule:{parse:d=>Number.isInteger(d)?d:throwParseError(writeNonIntegerDivisorMessage(d))}},normalize:d=>typeof d=="number"?{rule:d}:d,hasAssociatedError:!0,defaults:{description:d=>d.rule===1?"an integer":d.rule===2?"even":`a multiple of ${d.rule}`},intersections:{divisor:(d,m,g)=>g.$.node("divisor",{rule:Math.abs(d.rule*m.rule/greatestCommonDivisor(d.rule,m.rule))})},obviatesBasisDescription:!0});class DivisorNode extends InternalPrimitiveConstraint{traverseAllows=m=>m%this.rule===0;compiledCondition=`data % ${this.rule} === 0`;compiledNegation=`data % ${this.rule} !== 0`;impliedBasis=$ark.intrinsic.number.internal;expression=`% ${this.rule}`;reduceJsonSchema(m){return m.type="integer",this.rule===1||(m.multipleOf=this.rule),m}}const Divisor={implementation:implementation$k,Node:DivisorNode},writeNonIntegerDivisorMessage=d=>`divisor must be an integer (was ${d})`,greatestCommonDivisor=(d,m)=>{let g,w=d,$=m;for(;$!==0;)g=$,$=w%$,w=g;return w};class BaseRange extends InternalPrimitiveConstraint{boundOperandKind=operandKindsByBoundKind[this.kind];compiledActual=this.boundOperandKind==="value"?"data":this.boundOperandKind==="length"?"data.length":"data.valueOf()";comparator=compileComparator(this.kind,this.exclusive);numericLimit=this.rule.valueOf();expression=`${this.comparator} ${this.rule}`;compiledCondition=`${this.compiledActual} ${this.comparator} ${this.numericLimit}`;compiledNegation=`${this.compiledActual} ${negatedComparators[this.comparator]} ${this.numericLimit}`;stringLimit=this.boundOperandKind==="date"?dateLimitToString(this.numericLimit):`${this.numericLimit}`;limitKind=this.comparator[0]==="<"?"upper":"lower";isStricterThan(m){return(this.limitKind==="upper"?this.numericLimit<m.numericLimit:this.numericLimit>m.numericLimit)||this.numericLimit===m.numericLimit&&this.exclusive===!0&&!m.exclusive}overlapsRange(m){return!(this.isStricterThan(m)||this.numericLimit===m.numericLimit&&(this.exclusive||m.exclusive))}overlapIsUnit(m){return this.numericLimit===m.numericLimit&&!this.exclusive&&!m.exclusive}}const negatedComparators={"<":">=","<=":">",">":"<=",">=":"<"},boundKindPairsByLower={min:"max",minLength:"maxLength",after:"before"},parseExclusiveKey={parse:d=>d||void 0},createLengthSchemaNormalizer=d=>m=>{if(typeof m=="number")return{rule:m};const{exclusive:g,...w}=m;return g?{...w,rule:d==="minLength"?w.rule+1:w.rule-1}:w},createDateSchemaNormalizer=d=>m=>{if(typeof m=="number"||typeof m=="string"||m instanceof Date)return{rule:m};const{exclusive:g,...w}=m;if(!g)return w;const $=typeof w.rule=="number"?w.rule:typeof w.rule=="string"?new Date(w.rule).valueOf():w.rule.valueOf();return g?{...w,rule:d==="after"?$+1:$-1}:w},parseDateLimit=d=>typeof d=="string"||typeof d=="number"?new Date(d):d,writeInvalidLengthBoundMessage=(d,m)=>`${d} bound must be a positive integer (was ${m})`,createLengthRuleParser=d=>m=>((!Number.isInteger(m)||m<0)&&throwParseError(writeInvalidLengthBoundMessage(d,m)),m),operandKindsByBoundKind={min:"value",max:"value",minLength:"length",maxLength:"length",after:"date",before:"date"},compileComparator=(d,m)=>`${isKeyOf(d,boundKindPairsByLower)?">":"<"}${m?"":"="}`,dateLimitToString=d=>typeof d=="string"?d:new Date(d).toLocaleString(),writeUnboundableMessage=d=>`Bounded expression ${d} must be exactly one of number, string, Array, or Date`,implementation$j=implementNode({kind:"after",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:parseDateLimit,serialize:d=>d.toISOString()}},normalize:createDateSchemaNormalizer("after"),defaults:{description:d=>`${d.collapsibleLimitString} or later`,actual:describeCollapsibleDate},intersections:{after:(d,m)=>d.isStricterThan(m)?d:m}});class AfterNode extends BaseRange{impliedBasis=$ark.intrinsic.Date.internal;collapsibleLimitString=describeCollapsibleDate(this.rule);traverseAllows=m=>m>=this.rule;reduceJsonSchema(m,g){return g.fallback.date({code:"date",base:m,after:this.rule})}}const After={implementation:implementation$j,Node:AfterNode},implementation$i=implementNode({kind:"before",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:parseDateLimit,serialize:d=>d.toISOString()}},normalize:createDateSchemaNormalizer("before"),defaults:{description:d=>`${d.collapsibleLimitString} or earlier`,actual:describeCollapsibleDate},intersections:{before:(d,m)=>d.isStricterThan(m)?d:m,after:(d,m,g)=>d.overlapsRange(m)?d.overlapIsUnit(m)?g.$.node("unit",{unit:d.rule}):null:Disjoint.init("range",d,m)}});class BeforeNode extends BaseRange{collapsibleLimitString=describeCollapsibleDate(this.rule);traverseAllows=m=>m<=this.rule;impliedBasis=$ark.intrinsic.Date.internal;reduceJsonSchema(m,g){return g.fallback.date({code:"date",base:m,before:this.rule})}}const Before={implementation:implementation$i,Node:BeforeNode},implementation$h=implementNode({kind:"exactLength",collapsibleKey:"rule",keys:{rule:{parse:createLengthRuleParser("exactLength")}},normalize:d=>typeof d=="number"?{rule:d}:d,hasAssociatedError:!0,defaults:{description:d=>`exactly length ${d.rule}`,actual:d=>`${d.length}`},intersections:{exactLength:(d,m,g)=>Disjoint.init("unit",g.$.node("unit",{unit:d.rule}),g.$.node("unit",{unit:m.rule}),{path:["length"]}),minLength:(d,m)=>d.rule>=m.rule?d:Disjoint.init("range",d,m),maxLength:(d,m)=>d.rule<=m.rule?d:Disjoint.init("range",d,m)}});class ExactLengthNode extends InternalPrimitiveConstraint{traverseAllows=m=>m.length===this.rule;compiledCondition=`data.length === ${this.rule}`;compiledNegation=`data.length !== ${this.rule}`;impliedBasis=$ark.intrinsic.lengthBoundable.internal;expression=`== ${this.rule}`;reduceJsonSchema(m){switch(m.type){case"string":return m.minLength=this.rule,m.maxLength=this.rule,m;case"array":return m.minItems=this.rule,m.maxItems=this.rule,m;default:return ToJsonSchema.throwInternalOperandError("exactLength",m)}}}const ExactLength={implementation:implementation$h,Node:ExactLengthNode},implementation$g=implementNode({kind:"max",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:parseExclusiveKey},normalize:d=>typeof d=="number"?{rule:d}:d,defaults:{description:d=>d.rule===0?d.exclusive?"negative":"non-positive":`${d.exclusive?"less than":"at most"} ${d.rule}`},intersections:{max:(d,m)=>d.isStricterThan(m)?d:m,min:(d,m,g)=>d.overlapsRange(m)?d.overlapIsUnit(m)?g.$.node("unit",{unit:d.rule}):null:Disjoint.init("range",d,m)},obviatesBasisDescription:!0});class MaxNode extends BaseRange{impliedBasis=$ark.intrinsic.number.internal;traverseAllows=this.exclusive?m=>m<this.rule:m=>m<=this.rule;reduceJsonSchema(m){return this.exclusive?m.exclusiveMaximum=this.rule:m.maximum=this.rule,m}}const Max={implementation:implementation$g,Node:MaxNode},implementation$f=implementNode({kind:"maxLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:createLengthRuleParser("maxLength")}},reduce:(d,m)=>d.rule===0?m.node("exactLength",d):void 0,normalize:createLengthSchemaNormalizer("maxLength"),defaults:{description:d=>`at most length ${d.rule}`,actual:d=>`${d.length}`},intersections:{maxLength:(d,m)=>d.isStricterThan(m)?d:m,minLength:(d,m,g)=>d.overlapsRange(m)?d.overlapIsUnit(m)?g.$.node("exactLength",{rule:d.rule}):null:Disjoint.init("range",d,m)}});class MaxLengthNode extends BaseRange{impliedBasis=$ark.intrinsic.lengthBoundable.internal;traverseAllows=m=>m.length<=this.rule;reduceJsonSchema(m){switch(m.type){case"string":return m.maxLength=this.rule,m;case"array":return m.maxItems=this.rule,m;default:return ToJsonSchema.throwInternalOperandError("maxLength",m)}}}const MaxLength={implementation:implementation$f,Node:MaxLengthNode},implementation$e=implementNode({kind:"min",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:parseExclusiveKey},normalize:d=>typeof d=="number"?{rule:d}:d,defaults:{description:d=>d.rule===0?d.exclusive?"positive":"non-negative":`${d.exclusive?"more than":"at least"} ${d.rule}`},intersections:{min:(d,m)=>d.isStricterThan(m)?d:m},obviatesBasisDescription:!0});class MinNode extends BaseRange{impliedBasis=$ark.intrinsic.number.internal;traverseAllows=this.exclusive?m=>m>this.rule:m=>m>=this.rule;reduceJsonSchema(m){return this.exclusive?m.exclusiveMinimum=this.rule:m.minimum=this.rule,m}}const Min={implementation:implementation$e,Node:MinNode},implementation$d=implementNode({kind:"minLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:createLengthRuleParser("minLength")}},reduce:d=>d.rule===0?$ark.intrinsic.unknown:void 0,normalize:createLengthSchemaNormalizer("minLength"),defaults:{description:d=>d.rule===1?"non-empty":`at least length ${d.rule}`,actual:d=>d.length===0?"":`${d.length}`},intersections:{minLength:(d,m)=>d.isStricterThan(m)?d:m}});class MinLengthNode extends BaseRange{impliedBasis=$ark.intrinsic.lengthBoundable.internal;traverseAllows=m=>m.length>=this.rule;reduceJsonSchema(m){switch(m.type){case"string":return m.minLength=this.rule,m;case"array":return m.minItems=this.rule,m;default:return ToJsonSchema.throwInternalOperandError("minLength",m)}}}const MinLength={implementation:implementation$d,Node:MinLengthNode},boundImplementationsByKind={min:Min.implementation,max:Max.implementation,minLength:MinLength.implementation,maxLength:MaxLength.implementation,exactLength:ExactLength.implementation,after:After.implementation,before:Before.implementation},boundClassesByKind={min:Min.Node,max:Max.Node,minLength:MinLength.Node,maxLength:MaxLength.Node,exactLength:ExactLength.Node,after:After.Node,before:Before.Node},implementation$c=implementNode({kind:"pattern",collapsibleKey:"rule",keys:{rule:{},flags:{}},normalize:d=>typeof d=="string"?{rule:d}:d instanceof RegExp?d.flags?{rule:d.source,flags:d.flags}:{rule:d.source}:d,obviatesBasisDescription:!0,obviatesBasisExpression:!0,hasAssociatedError:!0,intersectionIsOpen:!0,defaults:{description:d=>`matched by ${d.rule}`},intersections:{pattern:()=>null}});class PatternNode extends InternalPrimitiveConstraint{instance=new RegExp(this.rule,this.flags);expression=`${this.instance}`;traverseAllows=this.instance.test.bind(this.instance);compiledCondition=`${this.expression}.test(data)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=$ark.intrinsic.string.internal;reduceJsonSchema(m,g){return m.pattern?g.fallback.patternIntersection({code:"patternIntersection",base:m,pattern:this.rule}):(m.pattern=this.rule,m)}}const Pattern={implementation:implementation$c,Node:PatternNode},schemaKindOf=(d,m)=>{const g=discriminateRootKind(d);return m&&!m.includes(g)?throwParseError(`Root of kind ${g} should be one of ${m}`):g},discriminateRootKind=d=>{if(hasArkKind(d,"root"))return d.kind;if(typeof d=="string")return d[0]==="$"?"alias":d in domainDescriptions?"domain":"proto";if(typeof d=="function")return"proto";if(typeof d!="object"||d===null)return throwParseError(writeInvalidSchemaMessage(d));if("morphs"in d)return"morph";if("branches"in d||isArray$1(d))return"union";if("unit"in d)return"unit";if("reference"in d)return"alias";const m=Object.keys(d);return m.length===0||m.some(g=>g in constraintKeys)?"intersection":"proto"in d?"proto":"domain"in d?"domain":throwParseError(writeInvalidSchemaMessage(d))},writeInvalidSchemaMessage=d=>`${printable(d)} is not a valid type schema`,nodeCountsByPrefix={},serializeListableChild=d=>isArray$1(d)?d.map(m=>m.collapsibleJson):d.collapsibleJson,nodesByRegisteredId={};$ark.nodesByRegisteredId=nodesByRegisteredId;const registerNodeId=d=>(nodeCountsByPrefix[d]??=0,`${d}${++nodeCountsByPrefix[d]}`),parseNode=d=>{const m=nodeImplementationsByKind[d.kind],g=m.applyConfig?.(d.def,d.$.resolvedConfig)??d.def,w={},{meta:$,...I}=g,D=$===void 0?{}:typeof $=="string"?{description:$}:$,q=entriesOf(I).sort(([G],[H])=>isNodeKind(G)?isNodeKind(H)?precedenceOfKind(G)-precedenceOfKind(H):1:isNodeKind(H)||G<H?-1:1).filter(([G,H])=>{if(G.startsWith("meta.")){const W=G.slice(5);return D[W]=H,!1}return!0});for(const G of q){const H=G[0],W=m.keys[H];if(!W)return throwParseError(`Key ${H} is not valid on ${d.kind} schema`);const V=W.parse?W.parse(G[1],d):G[1];V!==unset&&(V!==void 0||W.preserveUndefined)&&(w[H]=V)}if(m.reduce&&!d.prereduced){const G=m.reduce(w,d.$);if(G)return G instanceof Disjoint?G.throw():withMeta(G,D)}return createNode$1({id:d.id,kind:d.kind,inner:w,meta:D,$:d.$})},createNode$1=({id:d,kind:m,inner:g,meta:w,$,ignoreCache:I})=>{const D=nodeImplementationsByKind[m],q=entriesOf(g),j=[];let G={};for(const[re,se]of q){const oe=D.keys[re],ee=oe.serialize??(oe.child?serializeListableChild:defaultValueSerializer);if(G[re]=ee(se),oe.child===!0){const ae=se;isArray$1(ae)?j.push(...ae):j.push(ae)}else typeof oe.child=="function"&&j.push(...oe.child(se))}D.finalizeInnerJson&&(G=D.finalizeInnerJson(G));let H={...G},W={};isEmptyObject(w)||(W=flatMorph(w,(re,se)=>[re,re==="examples"?se:defaultValueSerializer(se)]),H.meta=possiblyCollapse(W,"description",!0)),G=possiblyCollapse(G,D.collapsibleKey,!1);const V=JSON.stringify({kind:m,...G});H=possiblyCollapse(H,D.collapsibleKey,!1);const K=possiblyCollapse(H,D.collapsibleKey,!0),Z=JSON.stringify({kind:m,...H});if($.nodesByHash[Z]&&!I)return $.nodesByHash[Z];const Q={id:d,kind:m,impl:D,inner:g,innerEntries:q,innerJson:G,innerHash:V,meta:w,metaJson:W,json:H,hash:Z,collapsibleJson:K,children:j};if(m!=="intersection")for(const re in g)re!=="in"&&re!=="out"&&(Q[re]=g[re]);const J=new nodeClassesByKind[m](Q,$);return $.nodesByHash[Z]=J},withId=(d,m)=>d.id===m?d:(isNode$1(nodesByRegisteredId[m])&&throwInternalError(`Unexpected attempt to overwrite node id ${m}`),createNode$1({id:m,kind:d.kind,inner:d.inner,meta:d.meta,$:d.$,ignoreCache:!0})),withMeta=(d,m,g)=>createNode$1({id:registerNodeId(m.alias??d.kind),kind:d.kind,inner:d.inner,meta:m,$:d.$}),possiblyCollapse=(d,m,g)=>{const w=Object.keys(d);if(w.length===1&&w[0]===m){const $=d[m];if(g||hasDomain($,"object")&&(Object.keys($).length===1||Array.isArray($)))return $}return d},intersectProps=(d,m,g)=>{if(d.key!==m.key)return null;const w=d.key;let $=intersectOrPipeNodes(d.value,m.value,g);const I=d.required||m.required?"required":"optional";if($ instanceof Disjoint)if(I==="optional")$=$ark.intrinsic.never.internal;else return $.withPrefixKey(d.key,d.required&&m.required?"required":"optional");if(I==="required")return g.$.node("required",{key:w,value:$});const D=d.hasDefault()?m.hasDefault()?d.default===m.default?d.default:throwParseError(writeDefaultIntersectionMessage(d.default,m.default)):d.default:m.hasDefault()?m.default:unset;return g.$.node("optional",{key:w,value:$,default:D})};class BaseProp extends BaseConstraint{required=this.kind==="required";optional=this.kind==="optional";impliedBasis=$ark.intrinsic.object.internal;serializedKey=compileSerializedValue(this.key);compiledKey=typeof this.key=="string"?this.key:this.serializedKey;flatRefs=append(this.value.flatRefs.map(m=>flatRef([this.key,...m.path],m.node)),flatRef([this.key],this.value));_transform(m,g){g.path.push(this.key);const w=super._transform(m,g);return g.path.pop(),w}hasDefault(){return"default"in this.inner}traverseAllows=(m,g)=>this.key in m?traverseKey(this.key,()=>this.value.traverseAllows(m[this.key],g),g):this.optional;traverseApply=(m,g)=>{this.key in m?traverseKey(this.key,()=>this.value.traverseApply(m[this.key],g),g):this.hasKind("required")&&g.errorFromNodeContext(this.errorContext)};compile(m){m.if(`${this.serializedKey} in data`,()=>m.traverseKey(this.serializedKey,`data${m.prop(this.key)}`,this.value)),this.hasKind("required")&&m.else(()=>m.traversalKind==="Apply"?m.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`):m.return(!1)),m.traversalKind==="Allows"&&m.return(!0)}}const writeDefaultIntersectionMessage=(d,m)=>`Invalid intersection of default values ${printable(d)} & ${printable(m)}`,implementation$b=implementNode({kind:"optional",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(d,m)=>m.$.parseSchema(d)},default:{preserveUndefined:!0}},normalize:d=>d,reduce:(d,m)=>{if(m.resolvedConfig.exactOptionalPropertyTypes===!1&&!d.value.allows(void 0))return m.node("optional",{...d,value:d.value.or(intrinsic.undefined)},{prereduced:!0})},defaults:{description:d=>`${d.compiledKey}?: ${d.value.description}`},intersections:{optional:intersectProps}});class OptionalNode extends BaseProp{constructor(...m){super(...m),"default"in this.inner&&assertDefaultValueAssignability(this.value,this.inner.default,this.key)}get rawIn(){const m=super.rawIn;return this.hasDefault()?this.$.node("optional",omit$1(m.inner,{default:!0}),{prereduced:!0}):m}get outProp(){if(!this.hasDefault())return this;const{default:m,...g}=this.inner;return this.cacheGetter("outProp",this.$.node("required",g,{prereduced:!0}))}expression=this.hasDefault()?`${this.compiledKey}: ${this.value.expression} = ${printable(this.inner.default)}`:`${this.compiledKey}?: ${this.value.expression}`;defaultValueMorph=getDefaultableMorph(this);defaultValueMorphRef=this.defaultValueMorph&&registeredReference(this.defaultValueMorph)}const Optional={implementation:implementation$b,Node:OptionalNode},defaultableMorphCache={},getDefaultableMorph=d=>{if(!d.hasDefault())return;const m=`{${d.compiledKey}: ${d.value.id} = ${defaultValueSerializer(d.default)}}`;return defaultableMorphCache[m]??=computeDefaultValueMorph(d.key,d.value,d.default)},computeDefaultValueMorph=(d,m,g)=>{if(typeof g=="function")return m.includesTransform?($,I)=>(traverseKey(d,()=>m($[d]=g(),I),I),$):$=>($[d]=g(),$);const w=m.includesTransform?m.assert(g):g;return hasDomain(w,"object")?($,I)=>(traverseKey(d,()=>m($[d]=g,I),I),$):$=>($[d]=w,$)},assertDefaultValueAssignability=(d,m,g)=>{const w=isThunk(m);hasDomain(m,"object")&&!w&&throwParseError(writeNonPrimitiveNonFunctionDefaultValueMessage(g));const $=d.in(w?m():m);if($ instanceof ArkErrors){g===null&&throwParseError(`Default ${$.summary}`);const I=$.transform(D=>D.transform(q=>({...q,prefixPath:[g]})));throwParseError(`Default for ${I.summary}`)}return m},writeNonPrimitiveNonFunctionDefaultValueMessage=d=>`Non-primitive default ${d===null?"":typeof d=="number"?`for value at [${d}] `:`for ${compileSerializedValue(d)} `}must be specified as a function like () => ({my: 'object'})`;class BaseRoot extends BaseNode{constructor(m,g){super(m,g),Object.defineProperty(this,arkKind,{value:"root",enumerable:!1})}get rawIn(){return super.rawIn}get rawOut(){return super.rawOut}get internal(){return this}get"~standard"(){return{vendor:"arktype",version:1,validate:m=>{const g=this(m);return g instanceof ArkErrors?g:{value:g}},toJSONSchema:m=>m.target&&m.target!=="draft-2020-12"?throwParseError(`JSONSchema target '${m.target}' is not supported (must be "draft-2020-12")`):m.io==="input"?this.rawIn.toJsonSchema():this.rawOut.toJsonSchema()}}as(){return this}brand(m){return m===""?throwParseError(emptyBrandNameMessage):this}readonly(){return this}branches=this.hasKind("union")?this.inner.branches:[this];distribute(m,g){const w=this.branches.map(m);return g?.(w)??w}get shortDescription(){return this.meta.description??this.defaultShortDescription}toJsonSchema(m={}){const g=mergeToJsonSchemaConfigs(this.$.resolvedConfig.toJsonSchema,m);g.useRefs||=this.isCyclic;const w=typeof g.dialect=="string"?{$schema:g.dialect}:{};return Object.assign(w,this.toJsonSchemaRecurse(g)),g.useRefs&&(w.$defs=flatMorph(this.references,($,I)=>I.isRoot()&&!I.alwaysExpandJsonSchema?[I.id,I.toResolvedJsonSchema(g)]:[])),w}toJsonSchemaRecurse(m){return m.useRefs&&!this.alwaysExpandJsonSchema?{$ref:`#/$defs/${this.id}`}:this.toResolvedJsonSchema(m)}get alwaysExpandJsonSchema(){return this.isBasis()||this.kind==="alias"||this.hasKind("union")&&this.isBoolean}toResolvedJsonSchema(m){const g=this.innerToJsonSchema(m);return Object.assign(g,this.metaJson)}intersect(m){const g=this.$.parseDefinition(m),w=this.rawIntersect(g);return w instanceof Disjoint?w:this.$.finalize(w)}rawIntersect(m){return intersectNodesRoot(this,m,this.$)}toNeverIfDisjoint(){return this}and(m){const g=this.intersect(m);return g instanceof Disjoint?g.throw():g}rawAnd(m){const g=this.rawIntersect(m);return g instanceof Disjoint?g.throw():g}or(m){const g=this.$.parseDefinition(m);return this.$.finalize(this.rawOr(g))}rawOr(m){const g=[...this.branches,...m.branches];return this.$.node("union",g)}map(m){return this.$.schema(this.applyStructuralOperation("map",[m]))}pick(...m){return this.$.schema(this.applyStructuralOperation("pick",m))}omit(...m){return this.$.schema(this.applyStructuralOperation("omit",m))}required(){return this.$.schema(this.applyStructuralOperation("required",[]))}partial(){return this.$.schema(this.applyStructuralOperation("partial",[]))}_keyof;keyof(){if(this._keyof)return this._keyof;const m=this.applyStructuralOperation("keyof",[]).reduce((g,w)=>g.intersect(w).toNeverIfDisjoint(),$ark.intrinsic.unknown.internal);return m.branches.length===0&&throwParseError(writeUnsatisfiableExpressionError(`keyof ${this.expression}`)),this._keyof=this.$.finalize(m)}get props(){return this.branches.length!==1?throwParseError(writeLiteralUnionEntriesMessage(this.expression)):[...this.applyStructuralOperation("props",[])[0]]}merge(m){const g=this.$.parseDefinition(m);return this.$.schema(g.distribute(w=>this.applyStructuralOperation("merge",[structureOf(w)??throwParseError(writeNonStructuralOperandMessage("merge",w.expression))])))}applyStructuralOperation(m,g){return this.distribute(w=>{if(w.equals($ark.intrinsic.object)&&m!=="merge")return w;const $=structureOf(w);if($||throwParseError(writeNonStructuralOperandMessage(m,w.expression)),m==="keyof")return $.keyof();if(m==="get")return $.get(...g);if(m==="props")return $.props;const I=m==="required"?"require":m==="partial"?"optionalize":m;return this.$.node("intersection",{domain:"object",structure:$[I](...g)})})}get(...m){return m[0]===void 0?this:this.$.schema(this.applyStructuralOperation("get",m))}extract(m){const g=this.$.parseDefinition(m);return this.$.schema(this.branches.filter(w=>w.extends(g)))}exclude(m){const g=this.$.parseDefinition(m);return this.$.schema(this.branches.filter(w=>!w.extends(g)))}array(){return this.$.schema(this.isUnknown()?{proto:Array}:{proto:Array,sequence:this},{prereduced:!0})}overlaps(m){return!(this.intersect(m)instanceof Disjoint)}extends(m){const g=this.intersect(m);return!(g instanceof Disjoint)&&this.equals(g)}ifExtends(m){return this.extends(m)?this:void 0}subsumes(m){return this.$.parseDefinition(m).extends(this)}configure(m,g="shallow"){return this.configureReferences(m,g)}describe(m,g="shallow"){return this.configure({description:m},g)}optional(){return[this,"?"]}default(m){return assertDefaultValueAssignability(this,m,null),[this,"=",m]}from(m){return this.assert(m)}_pipe(...m){const g=m.reduce((w,$)=>w.rawPipeOnce($),this);return this.$.finalize(g)}tryPipe(...m){const g=m.reduce((w,$)=>w.rawPipeOnce(hasArkKind($,"root")?$:((I,D)=>{try{return $(I,D)}catch(q){return D.error({code:"predicate",predicate:$,actual:`aborted due to error:
    ${q}
`})}})),this);return this.$.finalize(g)}pipe=Object.assign(this._pipe.bind(this),{try:this.tryPipe.bind(this)});to(m){return this.$.finalize(this.toNode(this.$.parseDefinition(m)))}toNode(m){const g=pipeNodesRoot(this,m,this.$);return g instanceof Disjoint?g.throw():g}rawPipeOnce(m){return hasArkKind(m,"root")?this.toNode(m):this.distribute(g=>g.hasKind("morph")?this.$.node("morph",{in:g.inner.in,morphs:[...g.morphs,m]}):this.$.node("morph",{in:g,morphs:[m]}),this.$.parseSchema)}narrow(m){return this.constrainOut("predicate",m)}constrain(m,g){return this._constrain("root",m,g)}constrainIn(m,g){return this._constrain("in",m,g)}constrainOut(m,g){return this._constrain("out",m,g)}_constrain(m,g,w){const $=this.$.node(g,w);if($.isRoot())return $.isUnknown()?this:throwInternalError(`Unexpected constraint node ${$}`);const I=m==="root"?this:m==="in"?this.rawIn:this.rawOut;if(I.hasKind("morph")||$.impliedBasis&&!I.extends($.impliedBasis))return throwInvalidOperandError(g,$.impliedBasis,this);const D=this.$.node("intersection",{[$.kind]:$}),q=m==="out"?pipeNodesRoot(this,D,this.$):intersectNodesRoot(this,D,this.$);return q instanceof Disjoint&&q.throw(),this.$.finalize(q)}onUndeclaredKey(m){const g=typeof m=="string"?m:m.rule,w=typeof m=="string"?!1:m.deep;return this.$.finalize(this.transform(($,I)=>$==="structure"?g==="ignore"?omit$1(I,{undeclared:1}):{...I,undeclared:g}:I,w?void 0:{shouldTransform:$=>!includes(structuralKinds,$.kind)}))}hasEqualMorphs(m){return!this.includesTransform&&!m.includesTransform?!0:!(!arrayEquals(this.shallowMorphs,m.shallowMorphs)||!arrayEquals(this.flatMorphs,m.flatMorphs,{isEqual:(g,w)=>g.propString===w.propString&&(g.node.hasKind("morph")&&w.node.hasKind("morph")?g.node.hasEqualMorphs(w.node):g.node.hasKind("intersection")&&w.node.hasKind("intersection")?g.node.structure?.structuralMorphRef===w.node.structure?.structuralMorphRef:!1)}))}onDeepUndeclaredKey(m){return this.onUndeclaredKey({rule:m,deep:!0})}filter(m){return this.constrainIn("predicate",m)}divisibleBy(m){return this.constrain("divisor",m)}matching(m){return this.constrain("pattern",m)}atLeast(m){return this.constrain("min",m)}atMost(m){return this.constrain("max",m)}moreThan(m){return this.constrain("min",exclusivizeRangeSchema(m))}lessThan(m){return this.constrain("max",exclusivizeRangeSchema(m))}atLeastLength(m){return this.constrain("minLength",m)}atMostLength(m){return this.constrain("maxLength",m)}moreThanLength(m){return this.constrain("minLength",exclusivizeRangeSchema(m))}lessThanLength(m){return this.constrain("maxLength",exclusivizeRangeSchema(m))}exactlyLength(m){return this.constrain("exactLength",m)}atOrAfter(m){return this.constrain("after",m)}atOrBefore(m){return this.constrain("before",m)}laterThan(m){return this.constrain("after",exclusivizeRangeSchema(m))}earlierThan(m){return this.constrain("before",exclusivizeRangeSchema(m))}}const emptyBrandNameMessage="Expected a non-empty brand name after #",exclusivizeRangeSchema=d=>typeof d=="object"&&!(d instanceof Date)?{...d,exclusive:!0}:{rule:d,exclusive:!0},typeOrTermExtends=(d,m)=>hasArkKind(m,"root")?hasArkKind(d,"root")?d.extends(m):m.allows(d):hasArkKind(d,"root")?d.hasUnit(m):m===d,structureOf=d=>d.hasKind("morph")?null:d.hasKind("intersection")?d.inner.structure??(d.basis?.domain==="object"?d.$.bindReference($ark.intrinsic.emptyStructure):null):d.isBasis()&&d.domain==="object"?d.$.bindReference($ark.intrinsic.emptyStructure):null,writeLiteralUnionEntriesMessage=d=>`Props cannot be extracted from a union. Use .distribute to extract props from each branch instead. Received:
${d}`,writeNonStructuralOperandMessage=(d,m)=>`${d} operand must be an object (was ${m})`,defineRightwardIntersections=(d,m)=>flatMorph(schemaKindsRightOf(d),(g,w)=>[w,m]),normalizeAliasSchema=d=>typeof d=="string"?{reference:d}:d,neverIfDisjoint=d=>d instanceof Disjoint?$ark.intrinsic.never.internal:d,implementation$a=implementNode({kind:"alias",hasAssociatedError:!1,collapsibleKey:"reference",keys:{reference:{serialize:d=>d.startsWith("$")?d:`$ark.${d}`},resolve:{}},normalize:normalizeAliasSchema,defaults:{description:d=>d.reference},intersections:{alias:(d,m,g)=>g.$.lazilyResolve(()=>neverIfDisjoint(intersectOrPipeNodes(d.resolution,m.resolution,g)),`${d.reference}${g.pipe?"=>":"&"}${m.reference}`),...defineRightwardIntersections("alias",(d,m,g)=>m.isUnknown()?d:m.isNever()?m:m.isBasis()&&!m.overlaps($ark.intrinsic.object)?Disjoint.init("assignability",$ark.intrinsic.object,m):g.$.lazilyResolve(()=>neverIfDisjoint(intersectOrPipeNodes(d.resolution,m,g)),`${d.reference}${g.pipe?"=>":"&"}${m.id}`))}});class AliasNode extends BaseRoot{expression=this.reference;structure=void 0;get resolution(){const m=this._resolve();return nodesByRegisteredId[this.id]=m}_resolve(){if(this.resolve)return this.resolve();if(this.reference[0]==="$")return this.$.resolveRoot(this.reference.slice(1));const m=this.reference;let g=nodesByRegisteredId[m];const w=[];for(;hasArkKind(g,"context");){if(w.includes(g.id))return throwParseError(writeShallowCycleErrorMessage(g.id,w));w.push(g.id),g=nodesByRegisteredId[g.id]}return hasArkKind(g,"root")?g:throwInternalError(`Unexpected resolution for reference ${this.reference}
Seen: [${w.join("->")}] 
Resolution: ${printable(g)}`)}get resolutionId(){if(this.reference.includes("&")||this.reference.includes("=>"))return this.resolution.id;if(this.reference[0]!=="$")return this.reference;const m=this.reference.slice(1),g=this.$.resolutions[m];return typeof g=="string"?g:hasArkKind(g,"root")?g.id:throwInternalError(`Unexpected resolution for reference ${this.reference}: ${printable(g)}`)}get defaultShortDescription(){return domainDescriptions.object}innerToJsonSchema(m){return this.resolution.toJsonSchemaRecurse(m)}traverseAllows=(m,g)=>{const w=g.seen[this.reference];return w?.includes(m)?!0:(g.seen[this.reference]=append(w,m),this.resolution.traverseAllows(m,g))};traverseApply=(m,g)=>{const w=g.seen[this.reference];w?.includes(m)||(g.seen[this.reference]=append(w,m),this.resolution.traverseApply(m,g))};compile(m){const g=this.resolutionId;m.if(`ctx.seen.${g} && ctx.seen.${g}.includes(data)`,()=>m.return(!0)),m.if(`!ctx.seen.${g}`,()=>m.line(`ctx.seen.${g} = []`)),m.line(`ctx.seen.${g}.push(data)`),m.return(m.invoke(g))}}const writeShallowCycleErrorMessage=(d,m)=>`Alias '${d}' has a shallow resolution cycle: ${[...m,d].join("->")}`,Alias$1={implementation:implementation$a,Node:AliasNode};class InternalBasis extends BaseRoot{traverseApply=(m,g)=>{this.traverseAllows(m,g)||g.errorFromNodeContext(this.errorContext)};get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return compileObjectLiteral(this.errorContext)}compile(m){m.traversalKind==="Allows"?m.return(this.compiledCondition):m.if(this.compiledNegation,()=>m.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}}const implementation$9=implementNode({kind:"domain",hasAssociatedError:!0,collapsibleKey:"domain",keys:{domain:{},numberAllowsNaN:{}},normalize:d=>typeof d=="string"?{domain:d}:hasKey(d,"numberAllowsNaN")&&d.domain!=="number"?throwParseError(Domain.writeBadAllowNanMessage(d.domain)):d,applyConfig:(d,m)=>d.numberAllowsNaN===void 0&&d.domain==="number"&&m.numberAllowsNaN?{...d,numberAllowsNaN:!0}:d,defaults:{description:d=>domainDescriptions[d.domain],actual:d=>Number.isNaN(d)?"NaN":domainDescriptions[domainOf(d)]},intersections:{domain:(d,m)=>d.domain==="number"&&m.domain==="number"?d.numberAllowsNaN?m:d:Disjoint.init("domain",d,m)}});class DomainNode extends InternalBasis{requiresNaNCheck=this.domain==="number"&&!this.numberAllowsNaN;traverseAllows=this.requiresNaNCheck?m=>typeof m=="number"&&!Number.isNaN(m):m=>domainOf(m)===this.domain;compiledCondition=this.domain==="object"?'((typeof data === "object" && data !== null) || typeof data === "function")':`typeof data === "${this.domain}"${this.requiresNaNCheck?" && !Number.isNaN(data)":""}`;compiledNegation=this.domain==="object"?'((typeof data !== "object" || data === null) && typeof data !== "function")':`typeof data !== "${this.domain}"${this.requiresNaNCheck?" || Number.isNaN(data)":""}`;expression=this.numberAllowsNaN?"number | NaN":this.domain;get nestableExpression(){return this.numberAllowsNaN?`(${this.expression})`:this.expression}get defaultShortDescription(){return domainDescriptions[this.domain]}innerToJsonSchema(m){return this.domain==="bigint"||this.domain==="symbol"?m.fallback.domain({code:"domain",base:{},domain:this.domain}):{type:this.domain}}}const Domain={implementation:implementation$9,Node:DomainNode,writeBadAllowNanMessage:d=>`numberAllowsNaN may only be specified with domain "number" (was ${d})`},implementation$8=implementNode({kind:"intersection",hasAssociatedError:!0,normalize:d=>{if(isNode$1(d))return d;const{structure:m,...g}=d,w=!!m,$=m??{},I=flatMorph(g,(D,q)=>isKeyOf(D,structureKeys)?(w&&throwParseError(`Flattened structure key ${D} cannot be specified alongside a root 'structure' key.`),$[D]=q,[]):[D,q]);return(hasArkKind($,"constraint")||!isEmptyObject($))&&(I.structure=$),I},finalizeInnerJson:({structure:d,...m})=>hasDomain(d,"object")?{...d,...m}:m,keys:{domain:{child:!0,parse:(d,m)=>m.$.node("domain",d)},proto:{child:!0,parse:(d,m)=>m.$.node("proto",d)},structure:{child:!0,parse:(d,m)=>m.$.node("structure",d),serialize:d=>{if(!d.sequence?.minLength)return d.collapsibleJson;const{sequence:m,...g}=d.collapsibleJson,{minVariadicLength:w,...$}=m,I=$.variadic&&Object.keys($).length===1?$.variadic:$;return{...g,sequence:I}}},divisor:{child:!0,parse:constraintKeyParser("divisor")},max:{child:!0,parse:constraintKeyParser("max")},min:{child:!0,parse:constraintKeyParser("min")},maxLength:{child:!0,parse:constraintKeyParser("maxLength")},minLength:{child:!0,parse:constraintKeyParser("minLength")},exactLength:{child:!0,parse:constraintKeyParser("exactLength")},before:{child:!0,parse:constraintKeyParser("before")},after:{child:!0,parse:constraintKeyParser("after")},pattern:{child:!0,parse:constraintKeyParser("pattern")},predicate:{child:!0,parse:constraintKeyParser("predicate")}},reduce:(d,m)=>intersectIntersections({},d,{$:m,invert:!1,pipe:!1}),defaults:{description:d=>{if(d.children.length===0)return"unknown";if(d.structure)return d.structure.description;const m=[];if(d.basis&&!d.prestructurals.some(g=>g.impl.obviatesBasisDescription)&&m.push(d.basis.description),d.prestructurals.length){const g=d.prestructurals.toSorted((w,$)=>w.kind==="min"&&$.kind==="max"?-1:0).map(w=>w.description);m.push(...g)}return d.inner.predicate&&m.push(...d.inner.predicate.map(g=>g.description)),m.join(" and ")},expected:d=>`  â—¦ ${d.errors.map(m=>m.expected).join(`
  â—¦ `)}`,problem:d=>`(${d.actual}) must be...
${d.expected}`},intersections:{intersection:(d,m,g)=>intersectIntersections(d.inner,m.inner,g),...defineRightwardIntersections("intersection",(d,m,g)=>{if(d.children.length===0)return m;const{domain:w,proto:$,...I}=d.inner,D=$??w,q=D?intersectOrPipeNodes(D,m,g):m;return q instanceof Disjoint?q:d?.basis?.equals(q)?d:d.$.node("intersection",{...I,[q.kind]:q},{prereduced:!0})})}});class IntersectionNode extends BaseRoot{basis=this.inner.domain??this.inner.proto??null;prestructurals=[];refinements=this.children.filter(m=>m.isRefinement()?(includes(prestructuralKinds,m.kind)&&this.prestructurals.push(m),!0):!1);structure=this.inner.structure;expression=writeIntersectionExpression(this);get shallowMorphs(){return this.inner.structure?.structuralMorph?[this.inner.structure.structuralMorph]:[]}get defaultShortDescription(){return this.basis?.defaultShortDescription??"present"}innerToJsonSchema(m){return this.children.reduce((g,w)=>w.isBasis()?w.toJsonSchemaRecurse(m):w.reduceJsonSchema(g,m),{})}traverseAllows=(m,g)=>this.children.every(w=>w.traverseAllows(m,g));traverseApply=(m,g)=>{const w=g.currentErrorCount;if(!(this.basis&&(this.basis.traverseApply(m,g),g.currentErrorCount>w))){if(this.prestructurals.length){for(let $=0;$<this.prestructurals.length-1;$++)if(this.prestructurals[$].traverseApply(m,g),g.failFast&&g.currentErrorCount>w)return;if(this.prestructurals.at(-1).traverseApply(m,g),g.currentErrorCount>w)return}if(!(this.structure&&(this.structure.traverseApply(m,g),g.currentErrorCount>w))&&this.inner.predicate){for(let $=0;$<this.inner.predicate.length-1;$++)if(this.inner.predicate[$].traverseApply(m,g),g.failFast&&g.currentErrorCount>w)return;this.inner.predicate.at(-1).traverseApply(m,g)}}};compile(m){if(m.traversalKind==="Allows"){for(const g of this.children)m.check(g);m.return(!0);return}if(m.initializeErrorCount(),this.basis&&(m.check(this.basis),this.children.length>1&&m.returnIfFail()),this.prestructurals.length){for(let g=0;g<this.prestructurals.length-1;g++)m.check(this.prestructurals[g]),m.returnIfFailFast();m.check(this.prestructurals.at(-1)),(this.structure||this.inner.predicate)&&m.returnIfFail()}if(this.structure&&(m.check(this.structure),this.inner.predicate&&m.returnIfFail()),this.inner.predicate){for(let g=0;g<this.inner.predicate.length-1;g++)m.check(this.inner.predicate[g]),m.returnIfFail();m.check(this.inner.predicate.at(-1))}}}const Intersection={implementation:implementation$8,Node:IntersectionNode},writeIntersectionExpression=d=>{if(d.structure?.expression)return d.structure.expression;const m=d.basis&&!d.prestructurals.some($=>$.impl.obviatesBasisExpression)?d.basis.nestableExpression:"",g=d.prestructurals.map($=>$.expression).join(" & "),w=`${m}${m?" ":""}${g}`;return w==="Array == 0"?"[]":w||"unknown"},intersectIntersections=(d,m,g)=>{const w={},$=d.proto??d.domain,I=m.proto??m.domain,D=$?I?intersectOrPipeNodes($,I,g):$:I;return D instanceof Disjoint?D:(D&&(w[D.kind]=D),intersectConstraints({kind:"intersection",baseInner:w,l:flattenConstraints(d),r:flattenConstraints(m),roots:[],ctx:g}))},implementation$7=implementNode({kind:"morph",hasAssociatedError:!1,keys:{in:{child:!0,parse:(d,m)=>m.$.parseSchema(d)},morphs:{parse:liftArray,serialize:d=>d.map(m=>hasArkKind(m,"root")?m.json:registeredReference(m))},declaredIn:{child:!1,serialize:d=>d.json},declaredOut:{child:!1,serialize:d=>d.json}},normalize:d=>d,defaults:{description:d=>`a morph from ${d.rawIn.description} to ${d.rawOut?.description??"unknown"}`},intersections:{morph:(d,m,g)=>{if(!d.hasEqualMorphs(m))return throwParseError(writeMorphIntersectionMessage(d.expression,m.expression));const w=intersectOrPipeNodes(d.rawIn,m.rawIn,g);if(w instanceof Disjoint)return w;const $={morphs:d.morphs};if(d.declaredIn||m.declaredIn){const I=intersectOrPipeNodes(d.rawIn,m.rawIn,g);if(I instanceof Disjoint)return I.throw();$.declaredIn=I}if(d.declaredOut||m.declaredOut){const I=intersectOrPipeNodes(d.rawOut,m.rawOut,g);if(I instanceof Disjoint)return I.throw();$.declaredOut=I}return w.distribute(I=>g.$.node("morph",{...$,in:I}),g.$.parseSchema)},...defineRightwardIntersections("morph",(d,m,g)=>{const w=d.inner.in?intersectOrPipeNodes(d.inner.in,m,g):m;return w instanceof Disjoint?w:w.equals(d.inner.in)?d:g.$.node("morph",{...d.inner,in:w})})}});class MorphNode extends BaseRoot{serializedMorphs=this.morphs.map(registeredReference);compiledMorphs=`[${this.serializedMorphs}]`;lastMorph=this.inner.morphs.at(-1);lastMorphIfNode=hasArkKind(this.lastMorph,"root")?this.lastMorph:void 0;introspectableIn=this.inner.in;introspectableOut=this.lastMorphIfNode?Object.assign(this.referencesById,this.lastMorphIfNode.referencesById)&&this.lastMorphIfNode.rawOut:void 0;get shallowMorphs(){return Array.isArray(this.inner.in?.shallowMorphs)?[...this.inner.in.shallowMorphs,...this.morphs]:this.morphs}get rawIn(){return this.declaredIn??this.inner.in?.rawIn??$ark.intrinsic.unknown.internal}get rawOut(){return this.declaredOut??this.introspectableOut??$ark.intrinsic.unknown.internal}declareIn(m){return this.$.node("morph",{...this.inner,declaredIn:m})}declareOut(m){return this.$.node("morph",{...this.inner,declaredOut:m})}expression=`(In: ${this.rawIn.expression}) => ${this.lastMorphIfNode?"To":"Out"}<${this.rawOut.expression}>`;get defaultShortDescription(){return this.rawIn.meta.description??this.rawIn.defaultShortDescription}innerToJsonSchema(m){return m.fallback.morph({code:"morph",base:this.rawIn.toJsonSchemaRecurse(m),out:this.introspectableOut?.toJsonSchemaRecurse(m)??null})}compile(m){if(m.traversalKind==="Allows"){if(!this.introspectableIn)return;m.return(m.invoke(this.introspectableIn));return}this.introspectableIn&&m.line(m.invoke(this.introspectableIn)),m.line(`ctx.queueMorphs(${this.compiledMorphs})`)}traverseAllows=(m,g)=>!this.introspectableIn||this.introspectableIn.traverseAllows(m,g);traverseApply=(m,g)=>{this.introspectableIn&&this.introspectableIn.traverseApply(m,g),g.queueMorphs(this.morphs)};hasEqualMorphs(m){return arrayEquals(this.morphs,m.morphs,{isEqual:(g,w)=>g===w||hasArkKind(g,"root")&&hasArkKind(w,"root")&&g.equals(w)})}}const Morph={implementation:implementation$7,Node:MorphNode},writeMorphIntersectionMessage=(d,m)=>`The intersection of distinct morphs at a single path is indeterminate:
Left: ${d}
Right: ${m}`,implementation$6=implementNode({kind:"proto",hasAssociatedError:!0,collapsibleKey:"proto",keys:{proto:{serialize:d=>getBuiltinNameOfConstructor(d)??defaultValueSerializer(d)},dateAllowsInvalid:{}},normalize:d=>{const m=typeof d=="string"?{proto:builtinConstructors[d]}:typeof d=="function"?isNode$1(d)?d:{proto:d}:typeof d.proto=="string"?{...d,proto:builtinConstructors[d.proto]}:d;return typeof m.proto!="function"&&throwParseError(Proto.writeInvalidSchemaMessage(m.proto)),hasKey(m,"dateAllowsInvalid")&&m.proto!==Date&&throwParseError(Proto.writeBadInvalidDateMessage(m.proto)),m},applyConfig:(d,m)=>d.dateAllowsInvalid===void 0&&d.proto===Date&&m.dateAllowsInvalid?{...d,dateAllowsInvalid:!0}:d,defaults:{description:d=>d.builtinName?objectKindDescriptions[d.builtinName]:`an instance of ${d.proto.name}`,actual:d=>d instanceof Date&&d.toString()==="Invalid Date"?"an invalid Date":objectKindOrDomainOf(d)},intersections:{proto:(d,m)=>d.proto===Date&&m.proto===Date?d.dateAllowsInvalid?m:d:constructorExtends(d.proto,m.proto)?d:constructorExtends(m.proto,d.proto)?m:Disjoint.init("proto",d,m),domain:(d,m)=>m.domain==="object"?d:Disjoint.init("domain",$ark.intrinsic.object.internal,m)}});class ProtoNode extends InternalBasis{builtinName=getBuiltinNameOfConstructor(this.proto);serializedConstructor=this.json.proto;requiresInvalidDateCheck=this.proto===Date&&!this.dateAllowsInvalid;traverseAllows=this.requiresInvalidDateCheck?m=>m instanceof Date&&m.toString()!=="Invalid Date":m=>m instanceof this.proto;compiledCondition=`data instanceof ${this.serializedConstructor}${this.requiresInvalidDateCheck?' && data.toString() !== "Invalid Date"':""}`;compiledNegation=`!(${this.compiledCondition})`;innerToJsonSchema(m){switch(this.builtinName){case"Array":return{type:"array"};case"Date":return m.fallback.date?.({code:"date",base:{}})??m.fallback.proto({code:"proto",base:{},proto:this.proto});default:return m.fallback.proto({code:"proto",base:{},proto:this.proto})}}expression=this.dateAllowsInvalid?"Date | InvalidDate":this.proto.name;get nestableExpression(){return this.dateAllowsInvalid?`(${this.expression})`:this.expression}domain="object";get defaultShortDescription(){return this.description}}const Proto={implementation:implementation$6,Node:ProtoNode,writeBadInvalidDateMessage:d=>`dateAllowsInvalid may only be specified with constructor Date (was ${d.name})`,writeInvalidSchemaMessage:d=>`instanceOf operand must be a function (was ${domainOf(d)})`},implementation$5=implementNode({kind:"union",hasAssociatedError:!0,collapsibleKey:"branches",keys:{ordered:{},branches:{child:!0,parse:(d,m)=>{const g=[];for(const w of d){const $=hasArkKind(w,"root")?w.branches:m.$.parseSchema(w).branches;for(const I of $)if(I.hasKind("morph")){const D=g.findIndex(q=>q.hasKind("morph")&&q.hasEqualMorphs(I));if(D===-1)g.push(I);else{const q=g[D];g[D]=m.$.node("morph",{...q.inner,in:q.rawIn.rawOr(I.rawIn)})}}else g.push(I)}return m.def.ordered||g.sort((w,$)=>w.hash<$.hash?-1:1),g}}},normalize:d=>isArray$1(d)?{branches:d}:d,reduce:(d,m)=>{const g=reduceBranches(d);if(g.length===1)return g[0];if(g.length!==d.branches.length)return m.node("union",{...d,branches:g},{prereduced:!0})},defaults:{description:d=>d.distribute(m=>m.description,describeBranches),expected:d=>{const m=groupBy$1(d.errors,"propString"),g=Object.entries(m).map(([w,$])=>{const I=[];for(const j of $)appendUnique(I,j.expected);const D=describeBranches(I),q=$.every(j=>j.actual===$[0].actual)?$[0].actual:printable($[0].data);return`${w&&`${w} `}must be ${D}${q&&` (was ${q})`}`});return describeBranches(g)},problem:d=>d.expected,message:d=>d.problem[0]==="["?`value at ${d.problem}`:d.problem},intersections:{union:(d,m,g)=>{if(d.isNever!==m.isNever)return Disjoint.init("presence",d,m);let w;return d.ordered?(m.ordered&&throwParseError(writeOrderedIntersectionMessage(d.expression,m.expression)),w=intersectBranches(m.branches,d.branches,g),w instanceof Disjoint&&w.invert()):w=intersectBranches(d.branches,m.branches,g),w instanceof Disjoint?w:g.$.parseSchema(d.ordered||m.ordered?{branches:w,ordered:!0}:{branches:w})},...defineRightwardIntersections("union",(d,m,g)=>{const w=intersectBranches(d.branches,[m],g);return w instanceof Disjoint?w:w.length===1?w[0]:g.$.parseSchema(d.ordered?{branches:w,ordered:!0}:{branches:w})})}});class UnionNode extends BaseRoot{isBoolean=this.branches.length===2&&this.branches[0].hasUnit(!1)&&this.branches[1].hasUnit(!0);get branchGroups(){const m=[];let g=-1;for(const w of this.branches){if(w.hasKind("unit")&&w.domain==="boolean"){g===-1?(g=m.length,m.push(w)):m[g]=$ark.intrinsic.boolean;continue}m.push(w)}return m}unitBranches=this.branches.filter(m=>m.rawIn.hasKind("unit"));discriminant=this.discriminate();discriminantJson=this.discriminant?discriminantToJson(this.discriminant):null;expression=this.distribute(m=>m.nestableExpression,expressBranches);createBranchedOptimisticRootApply(){return(m,g)=>{const w=this.traverseOptimistic(m);if(w!==unset)return w;const $=new Traversal(m,this.$.resolvedConfig);return this.traverseApply(m,$),$.finalize(g)}}get shallowMorphs(){return this.branches.reduce((m,g)=>appendUnique(m,g.shallowMorphs),[])}get defaultShortDescription(){return this.distribute(m=>m.defaultShortDescription,describeBranches)}innerToJsonSchema(m){if(this.branchGroups.length===1&&this.branchGroups[0].equals($ark.intrinsic.boolean))return{type:"boolean"};const g=this.branchGroups.map(w=>w.toJsonSchemaRecurse(m));return g.every(w=>Object.keys(w).length===1&&hasKey(w,"const"))?{enum:g.map(w=>w.const)}:{anyOf:g}}traverseAllows=(m,g)=>this.branches.some(w=>w.traverseAllows(m,g));traverseApply=(m,g)=>{const w=[];for(let $=0;$<this.branches.length;$++){if(g.pushBranch(),this.branches[$].traverseApply(m,g),!g.hasError())return this.branches[$].includesTransform?g.queuedMorphs.push(...g.popBranch().queuedMorphs):g.popBranch();w.push(g.popBranch().error)}g.errorFromNodeContext({code:"union",errors:w,meta:this.meta})};traverseOptimistic=m=>{for(let g=0;g<this.branches.length;g++){const w=this.branches[g];if(w.traverseAllows(m))return w.contextFreeMorph?w.contextFreeMorph(m):m}return unset};compile(m){if(!this.discriminant||this.unitBranches.length===this.branches.length&&this.branches.length===2)return this.compileIndiscriminable(m);let g=this.discriminant.optionallyChainedPropString;this.discriminant.kind==="domain"&&(g=`typeof ${g} === "object" ? ${g} === null ? "null" : "object" : typeof ${g} === "function" ? "object" : typeof ${g}`);const w=this.discriminant.cases,$=Object.keys(w),{optimistic:I}=m;if(m.optimistic=!1,m.block(`switch(${g})`,()=>{for(const H in w){const W=w[H],V=H==="default"?H:`case ${H}`;let K;W===!0?K=I?"data":"true":I?W.rootApplyStrategy==="branchedOptimistic"?K=m.invoke(W,{kind:"Optimistic"}):W.contextFreeMorph?K=`${m.invoke(W)} ? ${registeredReference(W.contextFreeMorph)}(data) : "${unset}"`:K=`${m.invoke(W)} ? data : "${unset}"`:K=m.invoke(W),m.line(`${V}: return ${K}`)}return m}),m.traversalKind==="Allows"){m.return(I?`"${unset}"`:!1);return}const D=describeBranches(this.discriminant.kind==="domain"?$.map(H=>{const W=H.slice(1,-1);return W==="function"?domainDescriptions.object:domainDescriptions[W]}):$),q=this.discriminant.path.map(H=>typeof H=="symbol"?registeredReference(H):JSON.stringify(H)),j=JSON.stringify(D),G=this.discriminant.kind==="domain"?`${serializedTypeOfDescriptions}[${g}]`:`${serializedPrintable}(${g})`;m.line(`ctx.errorFromNodeContext({
	code: "predicate",
	expected: ${j},
	actual: ${G},
	relativePath: [${q}],
	meta: ${this.compiledMeta}
})`)}compileIndiscriminable(m){if(m.traversalKind==="Apply"){m.const("errors","[]");for(const g of this.branches)m.line("ctx.pushBranch()").line(m.invoke(g)).if("!ctx.hasError()",()=>m.return(g.includesTransform?"ctx.queuedMorphs.push(...ctx.popBranch().queuedMorphs)":"ctx.popBranch()")).line("errors.push(ctx.popBranch().error)");m.line(`ctx.errorFromNodeContext({ code: "union", errors, meta: ${this.compiledMeta} })`)}else{const{optimistic:g}=m;m.optimistic=!1;for(const w of this.branches)m.if(`${m.invoke(w)}`,()=>m.return(g?w.contextFreeMorph?`${registeredReference(w.contextFreeMorph)}(data)`:"data":!0));m.return(g?`"${unset}"`:!1)}}get nestableExpression(){return this.isBoolean?"boolean":`(${this.expression})`}discriminate(){if(this.branches.length<2||this.isCyclic)return null;if(this.unitBranches.length===this.branches.length){const I=flatMorph(this.unitBranches,(D,q)=>[`${q.rawIn.serializedValue}`,q.hasKind("morph")?q:!0]);return{kind:"unit",path:[],optionallyChainedPropString:"data",cases:I}}const m=[];for(let I=0;I<this.branches.length-1;I++){const D=this.branches[I];for(let q=I+1;q<this.branches.length;q++){const j=this.branches[q],G=intersectNodesRoot(D.rawIn,j.rawIn,D.$);if(G instanceof Disjoint)for(const H of G){if(!H.kind||H.optional)continue;let W,V;if(H.kind==="domain"){const Z=H.l,Q=H.r;W=`"${typeof Z=="string"?Z:Z.domain}"`,V=`"${typeof Q=="string"?Q:Q.domain}"`}else if(H.kind==="unit")W=H.l.serializedValue,V=H.r.serializedValue;else continue;const K=m.find(Z=>arrayEquals(Z.path,H.path)&&Z.kind===H.kind);K?(K.cases[W]?K.cases[W].branchIndices=appendUnique(K.cases[W].branchIndices,I):K.cases[W]??={branchIndices:[I],condition:H.l},K.cases[V]?K.cases[V].branchIndices=appendUnique(K.cases[V].branchIndices,q):K.cases[V]??={branchIndices:[q],condition:H.r}):m.push({kind:H.kind,cases:{[W]:{branchIndices:[I],condition:H.l},[V]:{branchIndices:[q],condition:H.r}},path:H.path})}}}const g=this.ordered?viableOrderedCandidates(m,this.branches):m;if(!g.length)return null;const w=createCaseResolutionContext(g,this),$={};for(const I in w.best.cases){const D=resolveCase(w,I);if(D===null){$[I]=!0;continue}if(D.length===this.branches.length)return null;this.ordered&&D.sort((G,H)=>G.originalIndex-H.originalIndex);const q=D.map(G=>G.branch),j=q.length===1?q[0]:this.$.node("union",this.ordered?{branches:q,ordered:!0}:q);Object.assign(this.referencesById,j.referencesById),$[I]=j}if(w.defaultEntries.length){const I=w.defaultEntries.map(D=>D.branch);$.default=this.$.node("union",this.ordered?{branches:I,ordered:!0}:I,{prereduced:!0}),Object.assign(this.referencesById,$.default.referencesById)}return Object.assign(w.location,{cases:$})}}const createCaseResolutionContext=(d,m)=>{const w=d.sort((D,q)=>D.path.length===q.path.length?Object.keys(q.cases).length-Object.keys(D.cases).length:D.path.length-q.path.length)[0],$={kind:w.kind,path:w.path,optionallyChainedPropString:optionallyChainPropString(w.path)},I=m.branches.map((D,q)=>({originalIndex:q,branch:D}));return{best:w,location:$,defaultEntries:I,node:m}},resolveCase=(d,m)=>{const g=d.best.cases[m],w=discriminantCaseToNode(g.condition,d.location.path,d.node.$);let $=[];const I=[];for(let D=0;D<d.defaultEntries.length;D++){const q=d.defaultEntries[D];if(g.branchIndices.includes(q.originalIndex)){const j=pruneDiscriminant(d.node.branches[q.originalIndex],d.location);j===null?$=null:$?.push({originalIndex:q.originalIndex,branch:j})}else if(q.branch.hasKind("alias")&&w.hasKind("domain")&&w.domain==="object")$?.push(q);else{if(q.branch.rawIn.overlaps(w)){const j=pruneDiscriminant(q.branch,d.location);$?.push({originalIndex:q.originalIndex,branch:j})}I.push(q)}}return d.defaultEntries=I,$},viableOrderedCandidates=(d,m)=>d.filter(w=>{const $=Object.values(w.cases).map(I=>I.branchIndices);for(let I=0;I<$.length-1;I++){const D=$[I];for(let q=I+1;q<$.length;q++){const j=$[q];for(const G of D)for(const H of j)if(G>H&&m[G].overlaps(m[H]))return!1}}return!0}),discriminantCaseToNode=(d,m,g)=>{let w=d==="undefined"?g.node("unit",{unit:void 0}):d==="null"?g.node("unit",{unit:null}):d==="boolean"?g.units([!0,!1]):d;for(let $=m.length-1;$>=0;$--){const I=m[$];w=g.node("intersection",typeof I=="number"?{proto:"Array",sequence:[...range$1(I).map(D=>({})),w]}:{domain:"object",required:[{key:I,value:w}]})}return w},optionallyChainPropString=d=>d.reduce((m,g)=>m+compileLiteralPropAccess(g,!0),"data"),serializedTypeOfDescriptions=registeredReference(jsTypeOfDescriptions),serializedPrintable=registeredReference(printable),Union={implementation:implementation$5,Node:UnionNode},discriminantToJson=d=>({kind:d.kind,path:d.path.map(m=>typeof m=="string"?m:compileSerializedValue(m)),cases:flatMorph(d.cases,(m,g)=>[m,g===!0?g:g.hasKind("union")&&g.discriminantJson?g.discriminantJson:g.json])}),describeExpressionOptions={delimiter:" | ",finalDelimiter:" | "},expressBranches=d=>describeBranches(d,describeExpressionOptions),describeBranches=(d,m)=>{const g=m?.delimiter??", ",w=m?.finalDelimiter??" or ";if(d.length===0)return"never";if(d.length===1)return d[0];if(d.length===2&&d[0]==="false"&&d[1]==="true"||d[0]==="true"&&d[1]==="false")return"boolean";const $={},I=d.filter(q=>$[q]?!1:$[q]=!0),D=I.pop();return`${I.join(g)}${I.length?w:""}${D}`},intersectBranches=(d,m,g)=>{const w=m.map(()=>[]);for(let I=0;I<d.length;I++){let D={};for(let q=0;q<m.length;q++){if(w[q]===null)continue;if(d[I].equals(m[q])){w[q]=null,D={};break}const j=intersectOrPipeNodes(d[I],m[q],g);if(!(j instanceof Disjoint)){if(j.equals(d[I])){w[q].push(d[I]),D={};break}j.equals(m[q])?w[q]=null:D[q]=j}}for(const q in D)w[q][I]=D[q]}const $=w.flatMap((I,D)=>I?.flatMap(q=>q.branches)??m[D]);return $.length===0?Disjoint.init("union",d,m):$},reduceBranches=({branches:d,ordered:m})=>{if(d.length<2)return d;const g=d.map(()=>!0);for(let w=0;w<d.length;w++)for(let $=w+1;$<d.length&&g[w]&&g[$];$++){if(d[w].equals(d[$])){g[$]=!1;continue}const I=intersectNodesRoot(d[w].rawIn,d[$].rawIn,d[0].$);I instanceof Disjoint||(m||assertDeterminateOverlap(d[w],d[$]),I.equals(d[w].rawIn)?g[w]=!!m:I.equals(d[$].rawIn)&&(g[$]=!1))}return d.filter((w,$)=>g[$])},assertDeterminateOverlap=(d,m)=>{!d.includesTransform&&!m.includesTransform||(arrayEquals(d.shallowMorphs,m.shallowMorphs)||throwParseError(writeIndiscriminableMorphMessage(d.expression,m.expression)),arrayEquals(d.flatMorphs,m.flatMorphs,{isEqual:(g,w)=>g.propString===w.propString&&(g.node.hasKind("morph")&&w.node.hasKind("morph")?g.node.hasEqualMorphs(w.node):g.node.hasKind("intersection")&&w.node.hasKind("intersection")?g.node.structure?.structuralMorphRef===w.node.structure?.structuralMorphRef:!1)})||throwParseError(writeIndiscriminableMorphMessage(d.expression,m.expression)))},pruneDiscriminant=(d,m)=>d.transform((g,w)=>g==="domain"||g==="unit"?null:w,{shouldTransform:(g,w)=>{const $=optionallyChainPropString(w.path);return m.optionallyChainedPropString.startsWith($)?g.hasKind("domain")&&g.domain==="object"||(g.hasKind("domain")||m.kind==="unit")&&$===m.optionallyChainedPropString?!0:g.children.length!==0&&g.kind!=="index":!1}}),writeIndiscriminableMorphMessage=(d,m)=>`An unordered union of a type including a morph and a type with overlapping input is indeterminate:
Left: ${d}
Right: ${m}`,writeOrderedIntersectionMessage=(d,m)=>`The intersection of two ordered unions is indeterminate:
Left: ${d}
Right: ${m}`,implementation$4=implementNode({kind:"unit",hasAssociatedError:!0,keys:{unit:{preserveUndefined:!0,serialize:d=>d instanceof Date?d.toISOString():defaultValueSerializer(d)}},normalize:d=>d,defaults:{description:d=>printable(d.unit),problem:({expected:d,actual:m})=>`${d===m?`must be reference equal to ${d} (serialized to the same value)`:`must be ${d} (was ${m})`}`},intersections:{unit:(d,m)=>Disjoint.init("unit",d,m),...defineRightwardIntersections("unit",(d,m)=>{if(m.allows(d.unit))return d;const g=m.hasKind("intersection")?m.basis:m;if(g){const w=g.hasKind("domain")?g:$ark.intrinsic.object;if(d.domain!==w.domain){const $=d.domain==="undefined"||d.domain==="null"||d.domain==="boolean"?d.domain:$ark.intrinsic[d.domain];return Disjoint.init("domain",$,w)}}return Disjoint.init("assignability",d,m.hasKind("intersection")?m.children.find(w=>!w.allows(d.unit)):m)})}});class UnitNode extends InternalBasis{compiledValue=this.json.unit;serializedValue=typeof this.unit=="string"||this.unit instanceof Date?JSON.stringify(this.compiledValue):`${this.compiledValue}`;compiledCondition=compileEqualityCheck(this.unit,this.serializedValue);compiledNegation=compileEqualityCheck(this.unit,this.serializedValue,"negated");expression=printable(this.unit);domain=domainOf(this.unit);get defaultShortDescription(){return this.domain==="object"?domainDescriptions.object:this.description}innerToJsonSchema(m){return this.unit===null?{type:"null"}:$ark.intrinsic.jsonPrimitive.allows(this.unit)?{const:this.unit}:m.fallback.unit({code:"unit",base:{},unit:this.unit})}traverseAllows=this.unit instanceof Date?m=>m instanceof Date&&m.toISOString()===this.compiledValue:Number.isNaN(this.unit)?m=>Number.isNaN(m):m=>m===this.unit}const Unit={implementation:implementation$4,Node:UnitNode},compileEqualityCheck=(d,m,g)=>{if(d instanceof Date){const w=`data instanceof Date && data.toISOString() === ${m}`;return g?`!(${w})`:w}return Number.isNaN(d)?`${g?"!":""}Number.isNaN(data)`:`data ${g?"!":"="}== ${m}`},implementation$3=implementNode({kind:"index",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{signature:{child:!0,parse:(d,m)=>{const g=m.$.parseSchema(d);if(!g.extends($ark.intrinsic.key))return throwParseError(writeInvalidPropertyKeyMessage(g.expression));const w=g.branches.filter($=>$.hasKind("unit"));return w.length?throwParseError(writeEnumerableIndexBranches(w.map($=>printable($.unit)))):g}},value:{child:!0,parse:(d,m)=>m.$.parseSchema(d)}},normalize:d=>d,defaults:{description:d=>`[${d.signature.expression}]: ${d.value.description}`},intersections:{index:(d,m,g)=>{if(d.signature.equals(m.signature)){const w=intersectOrPipeNodes(d.value,m.value,g),$=w instanceof Disjoint?$ark.intrinsic.never.internal:w;return g.$.node("index",{signature:d.signature,value:$})}return d.signature.extends(m.signature)&&d.value.subsumes(m.value)?m:m.signature.extends(d.signature)&&m.value.subsumes(d.value)?d:null}}});class IndexNode extends BaseConstraint{impliedBasis=$ark.intrinsic.object.internal;expression=`[${this.signature.expression}]: ${this.value.expression}`;flatRefs=append(this.value.flatRefs.map(m=>flatRef([this.signature,...m.path],m.node)),flatRef([this.signature],this.value));traverseAllows=(m,g)=>stringAndSymbolicEntriesOf(m).every(w=>this.signature.traverseAllows(w[0],g)?traverseKey(w[0],()=>this.value.traverseAllows(w[1],g),g):!0);traverseApply=(m,g)=>{for(const w of stringAndSymbolicEntriesOf(m))this.signature.traverseAllows(w[0],g)&&traverseKey(w[0],()=>this.value.traverseApply(w[1],g),g)};_transform(m,g){g.path.push(this.signature);const w=super._transform(m,g);return g.path.pop(),w}compile(){}}const Index={implementation:implementation$3,Node:IndexNode},writeEnumerableIndexBranches=d=>`Index keys ${d.join(", ")} should be specified as named props.`,writeInvalidPropertyKeyMessage=d=>`Indexed key definition '${d}' must be a string or symbol`,implementation$2=implementNode({kind:"required",hasAssociatedError:!0,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(d,m)=>m.$.parseSchema(d)}},normalize:d=>d,defaults:{description:d=>`${d.compiledKey}: ${d.value.description}`,expected:d=>d.missingValueDescription,actual:()=>"missing"},intersections:{required:intersectProps,optional:intersectProps}});class RequiredNode extends BaseProp{expression=`${this.compiledKey}: ${this.value.expression}`;errorContext=Object.freeze({code:"required",missingValueDescription:this.value.defaultShortDescription,relativePath:[this.key],meta:this.meta});compiledErrorContext=compileObjectLiteral(this.errorContext)}const Required$1={implementation:implementation$2,Node:RequiredNode},implementation$1=implementNode({kind:"sequence",hasAssociatedError:!1,collapsibleKey:"variadic",keys:{prefix:{child:!0,parse:(d,m)=>{if(d.length!==0)return d.map(g=>m.$.parseSchema(g))}},optionals:{child:!0,parse:(d,m)=>{if(d.length!==0)return d.map(g=>m.$.parseSchema(g))}},defaultables:{child:d=>d.map(m=>m[0]),parse:(d,m)=>{if(d.length!==0)return d.map(g=>{const w=m.$.parseSchema(g[0]);return assertDefaultValueAssignability(w,g[1],null),[w,g[1]]})},serialize:d=>d.map(m=>[m[0].collapsibleJson,defaultValueSerializer(m[1])]),reduceIo:(d,m,g)=>{if(d==="in"){m.optionals=g.map(w=>w[0].rawIn);return}m.prefix=g.map(w=>w[0].rawOut)}},variadic:{child:!0,parse:(d,m)=>m.$.parseSchema(d,m)},minVariadicLength:{parse:d=>d===0?void 0:d},postfix:{child:!0,parse:(d,m)=>{if(d.length!==0)return d.map(g=>m.$.parseSchema(g))}}},normalize:d=>{if(typeof d=="string")return{variadic:d};if("variadic"in d||"prefix"in d||"defaultables"in d||"optionals"in d||"postfix"in d||"minVariadicLength"in d){if(d.postfix?.length){if(!d.variadic)return throwParseError(postfixWithoutVariadicMessage);if(d.optionals?.length||d.defaultables?.length)return throwParseError(postfixAfterOptionalOrDefaultableMessage)}return d.minVariadicLength&&!d.variadic?throwParseError("minVariadicLength may not be specified without a variadic element"):d}return{variadic:d}},reduce:(d,m)=>{let g=d.minVariadicLength??0;const w=d.prefix?.slice()??[],$=d.defaultables?.slice()??[],I=d.optionals?.slice()??[],D=d.postfix?.slice()??[];if(d.variadic){for(;I.at(-1)?.equals(d.variadic);)I.pop();if(I.length===0&&$.length===0)for(;w.at(-1)?.equals(d.variadic);)w.pop(),g++;for(;D[0]?.equals(d.variadic);)D.shift(),g++}else I.length===0&&$.length===0&&w.push(...D.splice(0));if(g!==d.minVariadicLength||d.prefix&&d.prefix.length!==w.length)return m.node("sequence",{...d,prefix:w,defaultables:$,optionals:I,postfix:D,minVariadicLength:g},{prereduced:!0})},defaults:{description:d=>d.isVariadicOnly?`${d.variadic.nestableExpression}[]`:`[${d.tuple.map(g=>g.kind==="defaultables"?`${g.node.nestableExpression} = ${printable(g.default)}`:g.kind==="optionals"?`${g.node.nestableExpression}?`:g.kind==="variadic"?`...${g.node.nestableExpression}[]`:g.node.expression).join(", ")}]`},intersections:{sequence:(d,m,g)=>{const w=_intersectSequences({l:d.tuple,r:m.tuple,disjoint:new Disjoint,result:[],fixedVariants:[],ctx:g}),$=w.disjoint.length===0?[w,...w.fixedVariants]:w.fixedVariants;return $.length===0?w.disjoint:$.length===1?g.$.node("sequence",sequenceTupleToInner($[0].result)):g.$.node("union",$.map(I=>({proto:Array,sequence:sequenceTupleToInner(I.result)})))}}});class SequenceNode extends BaseConstraint{impliedBasis=$ark.intrinsic.Array.internal;tuple=sequenceInnerToTuple(this.inner);prefixLength=this.prefix?.length??0;defaultablesLength=this.defaultables?.length??0;optionalsLength=this.optionals?.length??0;postfixLength=this.postfix?.length??0;defaultablesAndOptionals=[];prevariadic=this.tuple.filter(m=>m.kind==="defaultables"||m.kind==="optionals"?(this.defaultablesAndOptionals.push(m.node),!0):m.kind==="prefix");variadicOrPostfix=conflatenate(this.variadic&&[this.variadic],this.postfix);flatRefs=this.addFlatRefs();addFlatRefs(){return appendUniqueFlatRefs(this.flatRefs,this.prevariadic.flatMap((m,g)=>append(m.node.flatRefs.map(w=>flatRef([`${g}`,...w.path],w.node)),flatRef([`${g}`],m.node)))),appendUniqueFlatRefs(this.flatRefs,this.variadicOrPostfix.flatMap(m=>append(m.flatRefs.map(g=>flatRef([$ark.intrinsic.nonNegativeIntegerString.internal,...g.path],g.node)),flatRef([$ark.intrinsic.nonNegativeIntegerString.internal],m)))),this.flatRefs}isVariadicOnly=this.prevariadic.length+this.postfixLength===0;minVariadicLength=this.inner.minVariadicLength??0;minLength=this.prefixLength+this.minVariadicLength+this.postfixLength;minLengthNode=this.minLength===0?null:this.$.node("minLength",this.minLength);maxLength=this.variadic?null:this.tuple.length;maxLengthNode=this.maxLength===null?null:this.$.node("maxLength",this.maxLength);impliedSiblings=this.minLengthNode?this.maxLengthNode?[this.minLengthNode,this.maxLengthNode]:[this.minLengthNode]:this.maxLengthNode?[this.maxLengthNode]:[];defaultValueMorphs=getDefaultableMorphs(this);defaultValueMorphsReference=this.defaultValueMorphs.length?registeredReference(this.defaultValueMorphs):void 0;elementAtIndex(m,g){if(g<this.prevariadic.length)return this.tuple[g];const w=m.length-this.postfixLength;return g>=w?{kind:"postfix",node:this.postfix[g-w]}:{kind:"variadic",node:this.variadic??throwInternalError(`Unexpected attempt to access index ${g} on ${this}`)}}traverseAllows=(m,g)=>{for(let w=0;w<m.length;w++)if(!this.elementAtIndex(m,w).node.traverseAllows(m[w],g))return!1;return!0};traverseApply=(m,g)=>{let w=0;for(;w<m.length;w++)traverseKey(w,()=>this.elementAtIndex(m,w).node.traverseApply(m[w],g),g)};get element(){return this.cacheGetter("element",this.$.node("union",this.children))}compile(m){if(this.prefix)for(const[g,w]of this.prefix.entries())m.traverseKey(`${g}`,`data[${g}]`,w);for(const[g,w]of this.defaultablesAndOptionals.entries()){const $=`${g+this.prefixLength}`;m.if(`${$} >= data.length`,()=>m.traversalKind==="Allows"?m.return(!0):m.return()),m.traverseKey($,`data[${$}]`,w)}if(this.variadic&&(this.postfix&&m.const("firstPostfixIndex",`data.length${this.postfix?`- ${this.postfix.length}`:""}`),m.for(`i < ${this.postfix?"firstPostfixIndex":"data.length"}`,()=>m.traverseKey("i","data[i]",this.variadic),this.prevariadic.length),this.postfix))for(const[g,w]of this.postfix.entries()){const $=`firstPostfixIndex + ${g}`;m.traverseKey($,`data[${$}]`,w)}m.traversalKind==="Allows"&&m.return(!0)}_transform(m,g){g.path.push($ark.intrinsic.nonNegativeIntegerString.internal);const w=super._transform(m,g);return g.path.pop(),w}expression=this.description;reduceJsonSchema(m,g){if(this.prevariadic.length&&(m.prefixItems=this.prevariadic.map(w=>{const $=w.node.toJsonSchemaRecurse(g);if(w.kind==="defaultables"){const I=typeof w.default=="function"?w.default():w.default;$.default=$ark.intrinsic.jsonData.allows(I)?I:g.fallback.defaultValue({code:"defaultValue",base:$,value:I})}return $})),this.minLength&&(m.minItems=this.minLength),this.variadic){const w=Object.assign(m,{items:this.variadic.toJsonSchemaRecurse(g)});if(this.maxLength&&(w.maxItems=this.maxLength),this.postfix){const $=this.postfix.map(I=>I.toJsonSchemaRecurse(g));m=g.fallback.arrayPostfix({code:"arrayPostfix",base:w,elements:$})}}else m.items=!1,delete m.maxItems;return m}}const defaultableMorphsCache$1={},getDefaultableMorphs=d=>{if(!d.defaultables)return[];const m=[];let g="[";const w=d.prefixLength+d.defaultablesLength-1;for(let $=d.prefixLength;$<=w;$++){const[I,D]=d.defaultables[$-d.prefixLength];m.push(computeDefaultValueMorph($,I,D)),g+=`${$}: ${I.id} = ${defaultValueSerializer(D)}, `}return g+="]",defaultableMorphsCache$1[g]??=m},Sequence={implementation:implementation$1,Node:SequenceNode},sequenceInnerToTuple=d=>{const m=[];if(d.prefix)for(const g of d.prefix)m.push({kind:"prefix",node:g});if(d.defaultables)for(const[g,w]of d.defaultables)m.push({kind:"defaultables",node:g,default:w});if(d.optionals)for(const g of d.optionals)m.push({kind:"optionals",node:g});if(d.variadic&&m.push({kind:"variadic",node:d.variadic}),d.postfix)for(const g of d.postfix)m.push({kind:"postfix",node:g});return m},sequenceTupleToInner=d=>d.reduce((m,g)=>(g.kind==="variadic"?m.variadic=g.node:g.kind==="defaultables"?m.defaultables=append(m.defaultables,[[g.node,g.default]]):m[g.kind]=append(m[g.kind],g.node),m),{}),postfixAfterOptionalOrDefaultableMessage="A postfix required element cannot follow an optional or defaultable element",postfixWithoutVariadicMessage="A postfix element requires a variadic element",_intersectSequences=d=>{const[m,...g]=d.l,[w,...$]=d.r;if(!m||!w)return d;const I=g.at(-1)?.kind==="postfix",D=$.at(-1)?.kind==="postfix",q=m.kind==="prefix"||w.kind==="prefix"?"prefix":m.kind==="postfix"||w.kind==="postfix"?"postfix":m.kind==="variadic"&&w.kind==="variadic"?"variadic":I||D?"prefix":m.kind==="defaultables"||w.kind==="defaultables"?"defaultables":"optionals";if(m.kind==="prefix"&&w.kind==="variadic"&&D){const W=_intersectSequences({...d,fixedVariants:[],r:$.map(V=>({...V,kind:"prefix"}))});W.disjoint.length===0&&d.fixedVariants.push(W)}else if(w.kind==="prefix"&&m.kind==="variadic"&&I){const W=_intersectSequences({...d,fixedVariants:[],l:g.map(V=>({...V,kind:"prefix"}))});W.disjoint.length===0&&d.fixedVariants.push(W)}const j=intersectOrPipeNodes(m.node,w.node,d.ctx);if(j instanceof Disjoint)if(q==="prefix"||q==="postfix")d.disjoint.push(...j.withPrefixKey(q==="prefix"?d.result.length:`-${g.length+1}`,elementIsRequired(m)&&elementIsRequired(w)?"required":"optional")),d.result=[...d.result,{kind:q,node:$ark.intrinsic.never.internal}];else return q==="optionals"||q==="defaultables"?d:_intersectSequences({...d,fixedVariants:[],l:g.map(W=>({...W,kind:"prefix"})),r:g.map(W=>({...W,kind:"prefix"}))});else q==="defaultables"?(m.kind==="defaultables"&&w.kind==="defaultables"&&m.default!==w.default&&throwParseError(writeDefaultIntersectionMessage(m.default,w.default)),d.result=[...d.result,{kind:q,node:j,default:m.kind==="defaultables"?m.default:w.kind==="defaultables"?w.default:throwInternalError(`Unexpected defaultable intersection from ${m.kind} and ${w.kind} elements.`)}]):d.result=[...d.result,{kind:q,node:j}];const G=d.l.length,H=d.r.length;return(m.kind!=="variadic"||G>=H&&(w.kind==="variadic"||H===1))&&(d.l=g),(w.kind!=="variadic"||H>=G&&(m.kind==="variadic"||G===1))&&(d.r=$),_intersectSequences(d)},elementIsRequired=d=>d.kind==="prefix"||d.kind==="postfix",createStructuralWriter=d=>m=>{if(m.props.length||m.index){const g=m.index?.map($=>$[d])??[];for(const $ of m.props)g.push($[d]);m.undeclared&&g.push(`+ (undeclared): ${m.undeclared}`);const w=`{ ${g.join(", ")} }`;return m.sequence?`${w} & ${m.sequence.description}`:w}return m.sequence?.description??"{}"},structuralDescription=createStructuralWriter("description"),structuralExpression=createStructuralWriter("expression"),intersectPropsAndIndex=(d,m,g)=>{const w=d.required?"required":"optional";if(!m.signature.allows(d.key))return null;const $=intersectNodesRoot(d.value,m.value,g);return $ instanceof Disjoint?w==="optional"?g.node("optional",{key:d.key,value:$ark.intrinsic.never.internal}):$.withPrefixKey(d.key,d.kind):null},implementation=implementNode({kind:"structure",hasAssociatedError:!1,normalize:d=>d,applyConfig:(d,m)=>!d.undeclared&&m.onUndeclaredKey!=="ignore"?{...d,undeclared:m.onUndeclaredKey}:d,keys:{required:{child:!0,parse:constraintKeyParser("required"),reduceIo:(d,m,g)=>{m.required=append(m.required,g.map(w=>d==="in"?w.rawIn:w.rawOut))}},optional:{child:!0,parse:constraintKeyParser("optional"),reduceIo:(d,m,g)=>{if(d==="in"){m.optional=g.map(w=>w.rawIn);return}for(const w of g)m[w.outProp.kind]=append(m[w.outProp.kind],w.outProp.rawOut)}},index:{child:!0,parse:constraintKeyParser("index")},sequence:{child:!0,parse:constraintKeyParser("sequence")},undeclared:{parse:d=>d==="ignore"?void 0:d,reduceIo:(d,m,g)=>{if(g==="reject"){m.undeclared="reject";return}d==="in"?delete m.undeclared:m.undeclared="reject"}}},defaults:{description:structuralDescription},intersections:{structure:(d,m,g)=>{const w={...d.inner},$={...m.inner},I=new Disjoint;if(d.undeclared){const j=d.keyof();for(const G of m.requiredKeys)j.allows(G)||I.add("presence",$ark.intrinsic.never.internal,m.propsByKey[G].value,{path:[G]});$.optional&&($.optional=$.optional.filter(G=>j.allows(G.key))),$.index&&($.index=$.index.flatMap(G=>{if(G.signature.extends(j))return G;const H=intersectNodesRoot(j,G.signature,g.$);if(H instanceof Disjoint)return[];const W=normalizeIndex(H,G.value,g.$);return W.required&&($.required=conflatenate($.required,W.required)),W.optional&&($.optional=conflatenate($.optional,W.optional)),W.index??[]}))}if(m.undeclared){const j=m.keyof();for(const G of d.requiredKeys)j.allows(G)||I.add("presence",d.propsByKey[G].value,$ark.intrinsic.never.internal,{path:[G]});w.optional&&(w.optional=w.optional.filter(G=>j.allows(G.key))),w.index&&(w.index=w.index.flatMap(G=>{if(G.signature.extends(j))return G;const H=intersectNodesRoot(j,G.signature,g.$);if(H instanceof Disjoint)return[];const W=normalizeIndex(H,G.value,g.$);return W.required&&(w.required=conflatenate(w.required,W.required)),W.optional&&(w.optional=conflatenate(w.optional,W.optional)),W.index??[]}))}const D={};(d.undeclared||m.undeclared)&&(D.undeclared=d.undeclared==="reject"||m.undeclared==="reject"?"reject":"delete");const q=intersectConstraints({kind:"structure",baseInner:D,l:flattenConstraints(w),r:flattenConstraints($),roots:[],ctx:g});return q instanceof Disjoint&&I.push(...q),I.length?I:q}},reduce:(d,m)=>{if(d.index){if(!(d.required||d.optional))return;let g=!1;const w=d.required??[],$=d.optional??[],I=[...$];for(const D of d.index){for(const q of w){const j=intersectPropsAndIndex(q,D,m);if(j instanceof Disjoint)return j}for(const[q,j]of $.entries()){const G=intersectPropsAndIndex(j,D,m);if(G instanceof Disjoint)return G;G!==null&&(I[q]=G,g=!0)}}if(g)return m.node("structure",{...d,optional:I},{prereduced:!0})}}});class StructureNode extends BaseConstraint{impliedBasis=$ark.intrinsic.object.internal;impliedSiblings=this.children.flatMap(m=>m.impliedSiblings??[]);props=conflatenate(this.required,this.optional);propsByKey=flatMorph(this.props,(m,g)=>[g.key,g]);propsByKeyReference=registeredReference(this.propsByKey);expression=structuralExpression(this);requiredKeys=this.required?.map(m=>m.key)??[];optionalKeys=this.optional?.map(m=>m.key)??[];literalKeys=[...this.requiredKeys,...this.optionalKeys];_keyof;keyof(){if(this._keyof)return this._keyof;let m=this.$.units(this.literalKeys).branches;if(this.index)for(const{signature:g}of this.index)m=m.concat(g.branches);return this._keyof=this.$.node("union",m)}map(m){return this.$.node("structure",this.props.flatMap(m).reduce((g,w)=>{const $=this.propsByKey[w.key];if(isNode$1(w))return w.kind!=="required"&&w.kind!=="optional"?throwParseError(`Map result must have kind "required" or "optional" (was ${w.kind})`):(g[w.kind]=append(g[w.kind],w),g);const I=w.kind??$?.kind??"required",D=flatMorph(w,(q,j)=>q in Optional.implementation.keys?[q,j]:[]);return g[I]=append(g[I],this.$.node(I,D)),g},{}))}assertHasKeys(m){const g=m.filter(w=>!typeOrTermExtends(w,this.keyof()));if(g.length)return throwParseError(writeInvalidKeysMessage(this.expression,g))}get(m,...g){let w,$=!1;const I=indexerToKey(m);if((typeof I=="string"||typeof I=="symbol")&&this.propsByKey[I]&&(w=this.propsByKey[I].value,$=this.propsByKey[I].required),this.index)for(const q of this.index)typeOrTermExtends(I,q.signature)&&(w=w?.and(q.value)??q.value);if(this.sequence&&typeOrTermExtends(I,$ark.intrinsic.nonNegativeIntegerString))if(hasArkKind(I,"root"))this.sequence.variadic&&(w=w?.and(this.sequence.element)??this.sequence.element);else{const q=Number.parseInt(I);if(q<this.sequence.prevariadic.length){const j=this.sequence.prevariadic[q].node;w=w?.and(j)??j,$||=q<this.sequence.prefixLength}else if(this.sequence.variadic){const j=this.$.node("union",this.sequence.variadicOrPostfix);w=w?.and(j)??j}}if(!w)return this.sequence?.variadic&&hasArkKind(I,"root")&&I.extends($ark.intrinsic.number)?throwParseError(writeNumberIndexMessage(I.expression,this.sequence.expression)):throwParseError(writeInvalidKeysMessage(this.expression,[I]));const D=w.get(...g);return $?D:D.or($ark.intrinsic.undefined)}pick(...m){return this.assertHasKeys(m),this.$.node("structure",this.filterKeys("pick",m))}omit(...m){return this.assertHasKeys(m),this.$.node("structure",this.filterKeys("omit",m))}optionalize(){const{required:m,...g}=this.inner;return this.$.node("structure",{...g,optional:this.props.map(w=>w.hasKind("required")?this.$.node("optional",w.inner):w)})}require(){const{optional:m,...g}=this.inner;return this.$.node("structure",{...g,required:this.props.map(w=>w.hasKind("optional")?{key:w.key,value:w.value}:w)})}merge(m){const g=this.filterKeys("omit",[m.keyof()]);return m.required&&(g.required=append(g.required,m.required)),m.optional&&(g.optional=append(g.optional,m.optional)),m.index&&(g.index=append(g.index,m.index)),m.sequence&&(g.sequence=m.sequence),m.undeclared?g.undeclared=m.undeclared:delete g.undeclared,this.$.node("structure",g)}filterKeys(m,g){const w=makeRootAndArrayPropertiesMutable(this.inner),$=I=>{const D=g.some(q=>typeOrTermExtends(I,q));return m==="pick"?D:!D};return w.required&&(w.required=w.required.filter(I=>$(I.key))),w.optional&&(w.optional=w.optional.filter(I=>$(I.key))),w.index&&(w.index=w.index.filter(I=>$(I.signature))),w}traverseAllows=(m,g)=>this._traverse("Allows",m,g);traverseApply=(m,g)=>this._traverse("Apply",m,g);_traverse=(m,g,w)=>{const $=w?.currentErrorCount??0;for(let I=0;I<this.props.length;I++)if(m==="Allows"){if(!this.props[I].traverseAllows(g,w))return!1}else if(this.props[I].traverseApply(g,w),w.failFast&&w.currentErrorCount>$)return!1;if(this.sequence){if(m==="Allows"){if(!this.sequence.traverseAllows(g,w))return!1}else if(this.sequence.traverseApply(g,w),w.failFast&&w.currentErrorCount>$)return!1}if(this.index||this.undeclared==="reject"){const I=Object.keys(g);I.push(...Object.getOwnPropertySymbols(g));for(let D=0;D<I.length;D++){const q=I[D];if(this.index){for(const j of this.index)if(j.signature.traverseAllows(q,w)){if(m==="Allows"){if(!traverseKey(q,()=>j.value.traverseAllows(g[q],w),w))return!1}else if(traverseKey(q,()=>j.value.traverseApply(g[q],w),w),w.failFast&&w.currentErrorCount>$)return!1}}if(this.undeclared==="reject"&&!this.declaresKey(q)&&(m==="Allows"||(w.errorFromNodeContext({code:"predicate",expected:"removed",actual:"",relativePath:[q],meta:this.meta}),w.failFast)))return!1}}return this.structuralMorph&&w&&!w.hasError()&&w.queueMorphs([this.structuralMorph]),!0};get defaultable(){return this.cacheGetter("defaultable",this.optional?.filter(m=>m.hasDefault())??[])}declaresKey=m=>m in this.propsByKey||this.index?.some(g=>g.signature.allows(m))||this.sequence!==void 0&&$ark.intrinsic.nonNegativeIntegerString.allows(m);_compileDeclaresKey(m){const g=[];if(this.props.length&&g.push(`k in ${this.propsByKeyReference}`),this.index)for(const w of this.index)g.push(m.invoke(w.signature,{kind:"Allows",arg:"k"}));return this.sequence&&g.push("$ark.intrinsic.nonNegativeIntegerString.allows(k)"),g.join(" || ")||"false"}get structuralMorph(){return this.cacheGetter("structuralMorph",getPossibleMorph(this))}structuralMorphRef=this.structuralMorph&&registeredReference(this.structuralMorph);compile(m){m.traversalKind==="Apply"&&m.initializeErrorCount();for(const g of this.props)m.check(g),m.traversalKind==="Apply"&&m.returnIfFailFast();if(this.sequence&&(m.check(this.sequence),m.traversalKind==="Apply"&&m.returnIfFailFast()),(this.index||this.undeclared==="reject")&&(m.const("keys","Object.keys(data)"),m.line("keys.push(...Object.getOwnPropertySymbols(data))"),m.for("i < keys.length",()=>this.compileExhaustiveEntry(m))),m.traversalKind==="Allows")return m.return(!0);this.structuralMorphRef&&m.if("ctx && !ctx.hasError()",()=>(m.line("ctx.queueMorphs(["),precompileMorphs(m,this),m.line("])")))}compileExhaustiveEntry(m){if(m.const("k","keys[i]"),this.index)for(const g of this.index)m.if(`${m.invoke(g.signature,{arg:"k",kind:"Allows"})}`,()=>m.traverseKey("k","data[k]",g.value));return this.undeclared==="reject"&&m.if(`!(${this._compileDeclaresKey(m)})`,()=>m.traversalKind==="Allows"?m.return(!1):m.line(`ctx.errorFromNodeContext({ code: "predicate", expected: "removed", actual: "", relativePath: [k], meta: ${this.compiledMeta} })`).if("ctx.failFast",()=>m.return())),m}reduceJsonSchema(m,g){switch(m.type){case"object":return this.reduceObjectJsonSchema(m,g);case"array":const w=this.sequence?.reduceJsonSchema(m,g)??m;return this.props.length||this.index?g.fallback.arrayObject({code:"arrayObject",base:w,object:this.reduceObjectJsonSchema({type:"object"},g)}):w;default:return ToJsonSchema.throwInternalOperandError("structure",m)}}reduceObjectJsonSchema(m,g){if(this.props.length){m.properties={};for(const w of this.props){const $=w.value.toJsonSchemaRecurse(g);if(typeof w.key=="symbol"){g.fallback.symbolKey({code:"symbolKey",base:m,key:w.key,value:$,optional:w.optional});continue}if(w.hasDefault()){const I=typeof w.default=="function"?w.default():w.default;$.default=$ark.intrinsic.jsonData.allows(I)?I:g.fallback.defaultValue({code:"defaultValue",base:$,value:I})}m.properties[w.key]=$}this.requiredKeys.length&&m.properties&&(m.required=this.requiredKeys.filter(w=>typeof w=="string"&&w in m.properties))}if(this.index)for(const w of this.index){const $=w.value.toJsonSchemaRecurse(g);if(w.signature.equals($ark.intrinsic.string)){m.additionalProperties=$;continue}for(const I of w.signature.branches){if(!I.extends($ark.intrinsic.string)){m=g.fallback.symbolKey({code:"symbolKey",base:m,key:null,value:$,optional:!1});continue}let D={type:"string"};if(I.hasKind("morph")&&(D=g.fallback.morph({code:"morph",base:I.rawIn.toJsonSchemaRecurse(g),out:I.rawOut.toJsonSchemaRecurse(g)})),!I.hasKind("intersection"))return throwInternalError(`Unexpected index branch kind ${I.kind}.`);const{pattern:q}=I.inner;if(q){const j=Object.assign(D,{pattern:q[0].rule});for(let G=1;G<q.length;G++)D=g.fallback.patternIntersection({code:"patternIntersection",base:j,pattern:q[G].rule});m.patternProperties??={},m.patternProperties[j.pattern]=$}}}return this.undeclared&&!m.additionalProperties&&(m.additionalProperties=!1),m}}const defaultableMorphsCache={},constructStructuralMorphCacheKey=d=>{let m="";for(let g=0;g<d.defaultable.length;g++)m+=d.defaultable[g].defaultValueMorphRef;if(d.sequence?.defaultValueMorphsReference&&(m+=d.sequence?.defaultValueMorphsReference),d.undeclared==="delete"){if(m+="delete !(",d.required)for(const g of d.required)m+=g.compiledKey+" | ";if(d.optional)for(const g of d.optional)m+=g.compiledKey+" | ";if(d.index)for(const g of d.index)m+=g.signature.id+" | ";if(d.sequence)if(d.sequence.maxLength===null)m+=intrinsic.nonNegativeIntegerString.id;else for(let g=0;g<d.sequence.tuple.length;g++)m+=g+" | ";m+=")"}return m},getPossibleMorph=d=>{const m=constructStructuralMorphCacheKey(d);if(!m)return;if(defaultableMorphsCache[m])return defaultableMorphsCache[m];const g=(w,$)=>{for(let I=0;I<d.defaultable.length;I++)d.defaultable[I].key in w||d.defaultable[I].defaultValueMorph(w,$);if(d.sequence?.defaultables)for(let I=w.length-d.sequence.prefixLength;I<d.sequence.defaultables.length;I++)d.sequence.defaultValueMorphs[I](w,$);if(d.undeclared==="delete")for(const I in w)d.declaresKey(I)||delete w[I];return w};return defaultableMorphsCache[m]=g},precompileMorphs=(d,m)=>{const w=`(data${m.defaultable.some($=>$.defaultValueMorph.length===2)||m.sequence?.defaultValueMorphs.some($=>$.length===2)?", ctx":""})`;return d.block(`${w} => `,$=>{for(let I=0;I<m.defaultable.length;I++){const{serializedKey:D,defaultValueMorphRef:q}=m.defaultable[I];$.if(`!(${D} in data)`,j=>j.line(`${q}${w}`))}return m.sequence?.defaultables&&$.for(`i < ${m.sequence.defaultables.length}`,I=>I.set("data[i]",5),`data.length - ${m.sequence.prefixLength}`),m.undeclared==="delete"&&$.forIn("data",I=>I.if(`!(${m._compileDeclaresKey(I)})`,D=>D.line("delete data[k]"))),$.return("data")})},Structure={implementation,Node:StructureNode},indexerToKey=d=>(hasArkKind(d,"root")&&d.hasKind("unit")&&(d=d.unit),typeof d=="number"&&(d=`${d}`),d),writeNumberIndexMessage=(d,m)=>`${d} is not allowed as an array index on ${m}. Use the 'nonNegativeIntegerString' keyword instead.`,normalizeIndex=(d,m,g)=>{const[w,$]=spliterate(d.branches,D=>D.hasKind("unit"));if(!w.length)return{index:g.node("index",{signature:d,value:m})};const I={};for(const D of w){const q=g.node("required",{key:D.unit,value:m});I[q.kind]=append(I[q.kind],q)}return $.length&&(I.index=g.node("index",{signature:$,value:m})),I},typeKeyToString=d=>hasArkKind(d,"root")?d.expression:printable(d),writeInvalidKeysMessage=(d,m)=>`Key${m.length===1?"":"s"} ${m.map(typeKeyToString).join(", ")} ${m.length===1?"does":"do"} not exist on ${d}`,nodeImplementationsByKind={...boundImplementationsByKind,alias:Alias$1.implementation,domain:Domain.implementation,unit:Unit.implementation,proto:Proto.implementation,union:Union.implementation,morph:Morph.implementation,intersection:Intersection.implementation,divisor:Divisor.implementation,pattern:Pattern.implementation,predicate:Predicate.implementation,required:Required$1.implementation,optional:Optional.implementation,index:Index.implementation,sequence:Sequence.implementation,structure:Structure.implementation};$ark.defaultConfig=withAlphabetizedKeys(Object.assign(flatMorph(nodeImplementationsByKind,(d,m)=>[d,m.defaults]),{jitless:envHasCsp(),clone:deepClone,onUndeclaredKey:"ignore",exactOptionalPropertyTypes:!0,numberAllowsNaN:!1,dateAllowsInvalid:!1,onFail:null,keywords:{},toJsonSchema:ToJsonSchema.defaultConfig}));$ark.resolvedConfig=mergeConfigs($ark.defaultConfig,$ark.config);const nodeClassesByKind={...boundClassesByKind,alias:Alias$1.Node,domain:Domain.Node,unit:Unit.Node,proto:Proto.Node,union:Union.Node,morph:Morph.Node,intersection:Intersection.Node,divisor:Divisor.Node,pattern:Pattern.Node,predicate:Predicate.Node,required:Required$1.Node,optional:Optional.Node,index:Index.Node,sequence:Sequence.Node,structure:Structure.Node};class RootModule extends DynamicBase{get[arkKind](){return"module"}}const bindModule=(d,m)=>new RootModule(flatMorph(d,(g,w)=>[g,hasArkKind(w,"module")?bindModule(w,m):m.bindReference(w)])),schemaBranchesOf=d=>isArray$1(d)?d:"branches"in d&&isArray$1(d.branches)?d.branches:void 0,throwMismatchedNodeRootError=(d,m)=>throwParseError(`Node of kind ${m} is not valid as a ${d} definition`),writeDuplicateAliasError=d=>`#${d} duplicates public alias ${d}`,scopesByName={};$ark.ambient??={};let rawUnknownUnion;const rootScopeFnName="function $",precompile=d=>bindPrecompilation(d,precompileReferences(d)),bindPrecompilation=(d,m)=>{const g=m.write(rootScopeFnName,4),w=m.compile()();for(const $ of d)$.precompilation||($.traverseAllows=w[`${$.id}Allows`].bind(w),$.isRoot()&&!$.allowsRequiresContext&&($.allows=$.traverseAllows),$.traverseApply=w[`${$.id}Apply`].bind(w),w[`${$.id}Optimistic`]&&($.traverseOptimistic=w[`${$.id}Optimistic`].bind(w)),$.precompilation=g)},precompileReferences=d=>new CompiledFunction().return(d.reduce((m,g)=>{const w=new NodeCompiler({kind:"Allows"}).indent();g.compile(w);const $=w.write(`${g.id}Allows`),I=new NodeCompiler({kind:"Apply"}).indent();g.compile(I);const D=I.write(`${g.id}Apply`),q=`${m}${$},
${D},
`;if(!g.hasKind("union"))return q;const j=new NodeCompiler({kind:"Allows",optimistic:!0}).indent();g.compile(j);const G=j.write(`${g.id}Optimistic`);return`${q}${G},
`},`{
`)+"}");class BaseScope{config;resolvedConfig;name;get[arkKind](){return"scope"}referencesById={};references=[];resolutions={};exportedNames=[];aliases={};resolved=!1;nodesByHash={};intrinsic;constructor(m,g){this.config=mergeConfigs($ark.config,g),this.resolvedConfig=mergeConfigs($ark.resolvedConfig,g),this.name=this.resolvedConfig.name??`anonymousScope${Object.keys(scopesByName).length}`,this.name in scopesByName&&throwParseError(`A Scope already named ${this.name} already exists`),scopesByName[this.name]=this;const w=Object.entries(m).map($=>this.preparseOwnAliasEntry(...$));for(const[$,I]of w){let D=$;if($[0]==="#"?(D=$.slice(1),D in this.aliases&&throwParseError(writeDuplicateAliasError(D)),this.aliases[D]=I):(D in this.aliases&&throwParseError(writeDuplicateAliasError($)),this.aliases[D]=I,this.exportedNames.push(D)),!hasArkKind(I,"module")&&!hasArkKind(I,"generic")&&!isThunk(I)){const q=this.preparseOwnDefinitionFormat(I,{alias:D});this.resolutions[D]=hasArkKind(q,"root")?this.bindReference(q):this.createParseContext(q).id}}rawUnknownUnion??=this.node("union",{branches:["string","number","object","bigint","symbol",{unit:!0},{unit:!1},{unit:void 0},{unit:null}]},{prereduced:!0}),this.nodesByHash[rawUnknownUnion.hash]=this.node("intersection",{},{prereduced:!0}),this.intrinsic=$ark.intrinsic?flatMorph($ark.intrinsic,($,I)=>$.startsWith("json")?[]:[$,this.bindReference(I)]):{}}cacheGetter(m,g){return Object.defineProperty(this,m,{value:g}),g}get internal(){return this}_json;get json(){return this._json||this.export(),this._json}defineSchema(m){return m}generic=(...m)=>{const g=this;return(w,$)=>new GenericRoot(m,$?new LazyGenericBody(w):w,g,g,$??null)};units=(m,g)=>{const w=[];for(const I of m)w.includes(I)||w.push(I);const $=w.map(I=>this.node("unit",{unit:I},g));return this.node("union",$,{...g,prereduced:!0})};lazyResolutions=[];lazilyResolve(m,g){const w=this.node("alias",{reference:g??"synthetic",resolve:m},{prereduced:!0});return this.resolved||this.lazyResolutions.push(w),w}schema=(m,g)=>this.finalize(this.parseSchema(m,g));parseSchema=(m,g)=>this.node(schemaKindOf(m),m,g);preparseNode(m,g,w){let $=typeof m=="string"?m:schemaKindOf(g,m);if(isNode$1(g)&&g.kind===$)return g;if($==="alias"&&!w?.prereduced){const{reference:q}=Alias$1.implementation.normalize(g,this);if(q.startsWith("$")){const j=this.resolveRoot(q.slice(1));g=j,$=j.kind}}else if($==="union"&&hasDomain(g,"object")){const q=schemaBranchesOf(g);q?.length===1&&(g=q[0],$=schemaKindOf(g))}if(isNode$1(g)&&g.kind===$)return g;const D=nodeImplementationsByKind[$].normalize?.(g,this)??g;return isNode$1(D)?D.kind===$?D:throwMismatchedNodeRootError($,D.kind):{...w,$:this,kind:$,def:D,prefix:w.alias??$}}bindReference(m){let g;return isNode$1(m)?g=m.$===this?m:new m.constructor(m.attachments,this):g=m.$===this?m:new GenericRoot(m.params,m.bodyDef,m.$,this,m.hkt),this.resolved||Object.assign(this.referencesById,g.referencesById),g}resolveRoot(m){return this.maybeResolveRoot(m)??throwParseError(writeUnresolvableMessage(m))}maybeResolveRoot(m){const g=this.maybeResolve(m);if(!hasArkKind(g,"generic"))return g}maybeResolveSubalias(m){return maybeResolveSubalias(this.aliases,m)??maybeResolveSubalias(this.ambient,m)}get ambient(){return $ark.ambient}maybeResolve(m){const g=this.resolutions[m];if(g){if(typeof g!="string")return this.bindReference(g);const $=nodesByRegisteredId[g];if(hasArkKind($,"root"))return this.resolutions[m]=$;if(hasArkKind($,"context")){if($.phase==="resolving")return this.node("alias",{reference:`$${m}`},{prereduced:!0});if($.phase==="resolved")return throwInternalError(`Unexpected resolved context for was uncached by its scope: ${printable($)}`);$.phase="resolving";const I=this.bindReference(this.parseOwnDefinitionFormat($.def,$));return $.phase="resolved",nodesByRegisteredId[I.id]=I,nodesByRegisteredId[$.id]=I,this.resolutions[m]=I}return throwInternalError(`Unexpected nodesById entry for ${g}: ${printable($)}`)}let w=this.aliases[m]??this.ambient?.[m];return w?(w=this.normalizeRootScopeValue(w),hasArkKind(w,"generic")?this.resolutions[m]=this.bindReference(w):hasArkKind(w,"module")?(w.root||throwParseError(writeMissingSubmoduleAccessMessage(m)),this.resolutions[m]=this.bindReference(w.root)):this.resolutions[m]=this.parse(w,{alias:m})):this.maybeResolveSubalias(m)}createParseContext(m){const g=m.id??registerNodeId(m.prefix);return nodesByRegisteredId[g]=Object.assign(m,{[arkKind]:"context",$:this,id:g,phase:"unresolved"})}traversal(m){return new Traversal(m,this.resolvedConfig)}import(...m){return new RootModule(flatMorph(this.export(...m),(g,w)=>[`#${g}`,w]))}precompilation;_exportedResolutions;_exports;export(...m){if(!this._exports){this._exports={};for(const w of this.exportedNames){const $=this.aliases[w];this._exports[w]=hasArkKind($,"module")?bindModule($,this):bootstrapAliasReferences(this.maybeResolve(w))}for(const w of this.lazyResolutions)w.resolution;if(this._exportedResolutions=resolutionsOfModule(this,this._exports),this._json=resolutionsToJson(this._exportedResolutions),Object.assign(this.resolutions,this._exportedResolutions),this.references=Object.values(this.referencesById),!this.resolvedConfig.jitless){const w=precompileReferences(this.references);this.precompilation=w.write(rootScopeFnName,4),bindPrecompilation(this.references,w)}this.resolved=!0}const g=m.length?m:this.exportedNames;return new RootModule(flatMorph(g,(w,$)=>[$,this._exports[$]]))}resolve(m){return this.export()[m]}node=(m,g,w={})=>{const $=this.preparseNode(m,g,w);if(isNode$1($))return this.bindReference($);const I=this.createParseContext($),D=parseNode(I),q=this.bindReference(D);return nodesByRegisteredId[I.id]=q};parse=(m,g={})=>this.finalize(this.parseDefinition(m,g));parseDefinition(m,g={}){if(hasArkKind(m,"root"))return this.bindReference(m);const w=this.preparseOwnDefinitionFormat(m,g);if(hasArkKind(w,"root"))return this.bindReference(w);const $=this.createParseContext(w);nodesByRegisteredId[$.id]=$;let I=this.bindReference(this.parseOwnDefinitionFormat(m,$));return I.isCyclic&&(I=withId(I,$.id)),nodesByRegisteredId[$.id]=I,I}finalize(m){return bootstrapAliasReferences(m),!m.precompilation&&!this.resolvedConfig.jitless&&precompile(m.references),m}}class SchemaScope extends BaseScope{parseOwnDefinitionFormat(m,g){return parseNode(g)}preparseOwnDefinitionFormat(m,g){return this.preparseNode(schemaKindOf(m),m,g)}preparseOwnAliasEntry(m,g){return[m,g]}normalizeRootScopeValue(m){return m}}const bootstrapAliasReferences=d=>{const m=d.references.filter(g=>g.hasKind("alias"));for(const g of m){Object.assign(g.referencesById,g.resolution.referencesById);for(const w of d.references)g.id in w.referencesById&&Object.assign(w.referencesById,g.referencesById)}return d},resolutionsToJson=d=>flatMorph(d,(m,g)=>[m,hasArkKind(g,"root")||hasArkKind(g,"generic")?g.json:hasArkKind(g,"module")?resolutionsToJson(g):throwInternalError(`Unexpected resolution ${printable(g)}`)]),maybeResolveSubalias=(d,m)=>{const g=m.indexOf(".");if(g===-1)return;const w=m.slice(0,g),$=d[w];if($===void 0)return;if(!hasArkKind($,"module"))return throwParseError(writeNonSubmoduleDotMessage(w));const I=m.slice(g+1),D=$[I];if(D===void 0)return maybeResolveSubalias($,I);if(hasArkKind(D,"root")||hasArkKind(D,"generic"))return D;if(hasArkKind(D,"module"))return D.root??throwParseError(writeMissingSubmoduleAccessMessage(m));throwInternalError(`Unexpected resolution for alias '${m}': ${printable(D)}`)},schemaScope=(d,m)=>new SchemaScope(d,m),rootSchemaScope=new SchemaScope({}),resolutionsOfModule=(d,m)=>{const g={};for(const w in m){const $=m[w];if(hasArkKind($,"module")){const I=resolutionsOfModule(d,$),D=flatMorph(I,(q,j)=>[`${w}.${q}`,j]);Object.assign(g,D)}else hasArkKind($,"root")||hasArkKind($,"generic")?g[w]=$:throwInternalError(`Unexpected scope resolution ${printable($)}`)}return g},writeUnresolvableMessage=d=>`'${d}' is unresolvable`,writeNonSubmoduleDotMessage=d=>`'${d}' must reference a module to be accessed using dot syntax`,writeMissingSubmoduleAccessMessage=d=>`Reference to submodule '${d}' must specify an alias`;rootSchemaScope.export();const rootSchema=rootSchemaScope.schema,node=rootSchemaScope.node;rootSchemaScope.defineSchema;const genericNode=rootSchemaScope.generic,arrayIndexSource="^(?:0|[1-9]\\d*)$",arrayIndexMatcher=new RegExp(arrayIndexSource);registeredReference(arrayIndexMatcher);const intrinsicBases=schemaScope({bigint:"bigint",boolean:[{unit:!1},{unit:!0}],false:{unit:!1},never:[],null:{unit:null},number:"number",object:"object",string:"string",symbol:"symbol",true:{unit:!0},unknown:{},undefined:{unit:void 0},Array,Date},{prereducedAliases:!0}).export();$ark.intrinsic={...intrinsicBases};const intrinsicRoots=schemaScope({integer:{domain:"number",divisor:1},lengthBoundable:["string",Array],key:["string","symbol"],nonNegativeIntegerString:{domain:"string",pattern:arrayIndexSource}},{prereducedAliases:!0}).export();Object.assign($ark.intrinsic,intrinsicRoots);const intrinsicJson=schemaScope({jsonPrimitive:["string","number",{unit:!0},{unit:!1},{unit:null}],jsonObject:{domain:"object",index:{signature:"string",value:"$jsonData"}},jsonData:["$jsonPrimitive","$jsonObject"]},{prereducedAliases:!0}).export(),intrinsic={...intrinsicBases,...intrinsicRoots,...intrinsicJson,emptyStructure:node("structure",{},{prereduced:!0})};$ark.intrinsic={...intrinsic};const isDateLiteral=d=>typeof d=="string"&&d[0]==="d"&&(d[1]==="'"||d[1]==='"')&&d.at(-1)===d[1],isValidDate=d=>d.toString()!=="Invalid Date",extractDateLiteralSource=d=>d.slice(2,-1),writeInvalidDateMessage=d=>`'${d}' could not be parsed by the Date constructor`,tryParseDate=(d,m)=>maybeParseDate(d,m),maybeParseDate=(d,m)=>{const g=new Date(d);if(isValidDate(g))return g;const w=tryParseNumber(d);if(w!==void 0){const $=new Date(w);if(isValidDate($))return $}return m?throwParseError(m===!0?writeInvalidDateMessage(d):m):void 0},parseEnclosed=(d,m)=>{const g=d.scanner.shiftUntilEscapable(untilLookaheadIsClosing[enclosingTokens[m]]);if(d.scanner.lookahead==="")return d.error(writeUnterminatedEnclosedMessage(g,m));if(d.scanner.shift(),m==="/"){try{new RegExp(g)}catch(w){throwParseError(String(w))}d.root=d.ctx.$.node("intersection",{domain:"string",pattern:g},{prereduced:!0})}else if(isKeyOf(m,enclosingQuote))d.root=d.ctx.$.node("unit",{unit:g});else{const w=tryParseDate(g,writeInvalidDateMessage(g));d.root=d.ctx.$.node("unit",{meta:g,unit:w})}},enclosingQuote={"'":1,'"':1},enclosingChar={"/":1,"'":1,'"':1},enclosingLiteralTokens={"d'":"'",'d"':'"',"'":"'",'"':'"'},enclosingTokens={...enclosingLiteralTokens,"/":"/"},untilLookaheadIsClosing={"'":d=>d.lookahead==="'",'"':d=>d.lookahead==='"',"/":d=>d.lookahead==="/"},enclosingCharDescriptions={'"':"double-quote","'":"single-quote","/":"forward slash"},writeUnterminatedEnclosedMessage=(d,m)=>`${m}${d} requires a closing ${enclosingCharDescriptions[enclosingTokens[m]]}`,writePrefixedPrivateReferenceMessage=d=>`Private type references should not include '#'. Use '${d}' instead.`,shallowOptionalMessage="Optional definitions like 'string?' are only valid as properties in an object or tuple",shallowDefaultableMessage="Defaultable definitions like 'number = 0' are only valid as properties in an object or tuple",terminatingChars={"<":1,">":1,"=":1,"|":1,"&":1,")":1,"[":1,"%":1,",":1,":":1,"?":1,"#":1,...whitespaceChars},lookaheadIsFinalizing=(d,m)=>d===">"?m[0]==="="?m[1]==="=":m.trimStart()===""||isKeyOf(m.trimStart()[0],terminatingChars):d==="="?m[0]!=="=":d===","||d==="?",parseGenericArgs=(d,m,g)=>_parseGenericArgs(d,m,g,[]),_parseGenericArgs=(d,m,g,w)=>{const $=g.parseUntilFinalizer();return w.push($.root),$.finalizer===">"?w.length!==m.params.length?g.error(writeInvalidGenericArgCountMessage(d,m.names,w.map(I=>I.expression))):w:$.finalizer===","?_parseGenericArgs(d,m,g,w):$.error(writeUnclosedGroupMessage(">"))},writeInvalidGenericArgCountMessage=(d,m,g)=>`${d}<${m.join(", ")}> requires exactly ${m.length} args (got ${g.length}${g.length===0?"":`: ${g.join(", ")}`})`,parseUnenclosed=d=>{const m=d.scanner.shiftUntilLookahead(terminatingChars);m==="keyof"?d.addPrefix("keyof"):d.root=unenclosedToNode(d,m)},parseGenericInstantiation=(d,m,g)=>{if(g.scanner.shiftUntilNonWhitespace(),g.scanner.shift()!=="<")return g.error(writeInvalidGenericArgCountMessage(d,m.names,[]));const $=parseGenericArgs(d,m,g);return m(...$)},unenclosedToNode=(d,m)=>maybeParseReference(d,m)??maybeParseUnenclosedLiteral(d,m)??d.error(m===""?d.scanner.lookahead==="#"?writePrefixedPrivateReferenceMessage(d.shiftedByOne().scanner.shiftUntilLookahead(terminatingChars)):writeMissingOperandMessage(d):writeUnresolvableMessage(m)),maybeParseReference=(d,m)=>{if(d.ctx.args?.[m]){const w=d.ctx.args[m];return typeof w!="string"?w:d.ctx.$.node("alias",{reference:w},{prereduced:!0})}const g=d.ctx.$.maybeResolve(m);if(hasArkKind(g,"root"))return g;if(g!==void 0)return hasArkKind(g,"generic")?parseGenericInstantiation(m,g,d):throwParseError(`Unexpected resolution ${printable(g)}`)},maybeParseUnenclosedLiteral=(d,m)=>{const g=tryParseWellFormedNumber(m);if(g!==void 0)return d.ctx.$.node("unit",{unit:g});const w=tryParseWellFormedBigint(m);if(w!==void 0)return d.ctx.$.node("unit",{unit:w})},writeMissingOperandMessage=d=>{const m=d.previousOperator();return m?writeMissingRightOperandMessage(m,d.scanner.unscanned):writeExpressionExpectedMessage(d.scanner.unscanned)},writeMissingRightOperandMessage=(d,m="")=>`Token '${d}' requires a right operand${m?` before '${m}'`:""}`,writeExpressionExpectedMessage=d=>`Expected an expression${d?` before '${d}'`:""}`,parseOperand=d=>d.scanner.lookahead===""?d.error(writeMissingOperandMessage(d)):d.scanner.lookahead==="("?d.shiftedByOne().reduceGroupOpen():d.scanner.lookaheadIsIn(enclosingChar)?parseEnclosed(d,d.scanner.shift()):d.scanner.lookaheadIsIn(whitespaceChars)?parseOperand(d.shiftedByOne()):d.scanner.lookahead==="d"&&d.scanner.nextLookahead in enclosingQuote?parseEnclosed(d,`${d.scanner.shift()}${d.scanner.shift()}`):parseUnenclosed(d),minComparators={">":!0,">=":!0},maxComparators={"<":!0,"<=":!0},invertedComparators={"<":">",">":"<","<=":">=",">=":"<=","==":"=="},writeOpenRangeMessage=(d,m)=>`Left bounds are only valid when paired with right bounds (try ...${m}${d})`,writeUnpairableComparatorMessage=d=>`Left-bounded expressions must specify their limits using < or <= (was ${d})`,writeMultipleLeftBoundsMessage=(d,m,g,w)=>`An expression may have at most one left bound (parsed ${d}${invertedComparators[m]}, ${g}${invertedComparators[w]})`,parseBound=(d,m)=>{const g=shiftComparator(d,m);if(d.root.hasKind("unit")){if(typeof d.root.unit=="number"){d.reduceLeftBound(d.root.unit,g),d.unsetRoot();return}if(d.root.unit instanceof Date){const w=`d'${d.root.description??d.root.unit.toISOString()}'`;d.unsetRoot(),d.reduceLeftBound(w,g);return}}return parseRightBound(d,g)},comparatorStartChars={"<":1,">":1,"=":1},shiftComparator=(d,m)=>d.scanner.lookaheadIs("=")?`${m}${d.scanner.shift()}`:m,getBoundKinds=(d,m,g,w)=>g.extends($ark.intrinsic.number)?typeof m!="number"?throwParseError(writeInvalidLimitMessage(d,m,w)):d==="=="?["min","max"]:d[0]===">"?["min"]:["max"]:g.extends($ark.intrinsic.lengthBoundable)?typeof m!="number"?throwParseError(writeInvalidLimitMessage(d,m,w)):d==="=="?["exactLength"]:d[0]===">"?["minLength"]:["maxLength"]:g.extends($ark.intrinsic.Date)?d==="=="?["after","before"]:d[0]===">"?["after"]:["before"]:throwParseError(writeUnboundableMessage(g.expression)),openLeftBoundToRoot=d=>({rule:isDateLiteral(d.limit)?extractDateLiteralSource(d.limit):d.limit,exclusive:d.comparator.length===1}),parseRightBound=(d,m)=>{const g=d.unsetRoot(),w=d.scanner.location;d.parseOperand();const $=d.unsetRoot(),I=d.scanner.sliceChars(w,d.scanner.location);if(d.root=g,!$.hasKind("unit")||typeof $.unit!="number"&&!($.unit instanceof Date))return d.error(writeInvalidLimitMessage(m,I,"right"));const D=$.unit,q=m.length===1,j=getBoundKinds(m,typeof D=="number"?D:I,g,"right");for(const H of j)d.constrainRoot(H,m==="=="?{rule:D}:{rule:D,exclusive:q});if(!d.branches.leftBound)return;if(!isKeyOf(m,maxComparators))return d.error(writeUnpairableComparatorMessage(m));const G=getBoundKinds(d.branches.leftBound.comparator,d.branches.leftBound.limit,g,"left");d.constrainRoot(G[0],openLeftBoundToRoot(d.branches.leftBound)),d.branches.leftBound=null},writeInvalidLimitMessage=(d,m,g)=>`Comparator ${g==="left"?invertedComparators[d]:d} must be ${g==="left"?"preceded":"followed"} by a corresponding literal (was ${m})`,parseBrand=d=>{d.scanner.shiftUntilNonWhitespace();const m=d.scanner.shiftUntilLookahead(terminatingChars);d.root=d.root.brand(m)},parseDivisor=d=>{d.scanner.shiftUntilNonWhitespace();const m=d.scanner.shiftUntilLookahead(terminatingChars),g=tryParseInteger(m,{errorOnFail:writeInvalidDivisorMessage(m)});g===0&&d.error(writeInvalidDivisorMessage(0)),d.root=d.root.constrain("divisor",g)},writeInvalidDivisorMessage=d=>`% operator must be followed by a non-zero integer literal (was ${d})`,parseOperator=d=>{const m=d.scanner.shift();return m===""?d.finalize(""):m==="["?d.scanner.shift()==="]"?d.setRoot(d.root.array()):d.error(incompleteArrayTokenMessage):m==="|"?d.scanner.lookahead===">"?d.shiftedByOne().pushRootToBranch("|>"):d.pushRootToBranch(m):m==="&"?d.pushRootToBranch(m):m===")"?d.finalizeGroup():lookaheadIsFinalizing(m,d.scanner.unscanned)?d.finalize(m):isKeyOf(m,comparatorStartChars)?parseBound(d,m):m==="%"?parseDivisor(d):m==="#"?parseBrand(d):m in whitespaceChars?parseOperator(d):d.error(writeUnexpectedCharacterMessage(m))},writeUnexpectedCharacterMessage=(d,m="")=>`'${d}' is not allowed here${m&&` (should be ${m})`}`,incompleteArrayTokenMessage="Missing expected ']'",parseDefault=d=>{const m=d.unsetRoot();d.parseOperand();const g=d.unsetRoot();if(!g.hasKind("unit"))return d.error(writeNonLiteralDefaultMessage(g.expression));const w=g.unit instanceof Date?()=>new Date(g.unit):g.unit;return[m,"=",w]},writeNonLiteralDefaultMessage=d=>`Default value '${d}' must be a literal value`,parseString=(d,m)=>{const g=m.$.maybeResolveRoot(d);if(g)return g;if(d.endsWith("[]")){const I=m.$.maybeResolveRoot(d.slice(0,-2));if(I)return I.array()}const w=new RuntimeState(new Scanner(d),m),$=fullStringParse(w);return w.finalizer===">"&&throwParseError(writeUnexpectedCharacterMessage(">")),$},fullStringParse=d=>{d.parseOperand();let m=parseUntilFinalizer(d).root;return m?(d.finalizer==="="?m=parseDefault(d):d.finalizer==="?"&&(m=[m,"?"]),d.scanner.shiftUntilNonWhitespace(),d.scanner.lookahead&&throwParseError(writeUnexpectedCharacterMessage(d.scanner.lookahead)),m):throwInternalError(`Root was unexpectedly unset after parsing string '${d.scanner.scanned}'`)},parseUntilFinalizer=d=>{for(;d.finalizer===void 0;)next(d);return d},next=d=>d.hasRoot()?d.parseOperator():d.parseOperand();class RuntimeState{root;branches={prefixes:[],leftBound:null,intersection:null,union:null,pipe:null};finalizer;groups=[];scanner;ctx;constructor(m,g){this.scanner=m,this.ctx=g}error(m){return throwParseError(m)}hasRoot(){return this.root!==void 0}setRoot(m){this.root=m}unsetRoot(){const m=this.root;return this.root=void 0,m}constrainRoot(...m){this.root=this.root.constrain(m[0],m[1])}finalize(m){if(this.groups.length)return this.error(writeUnclosedGroupMessage(")"));this.finalizeBranches(),this.finalizer=m}reduceLeftBound(m,g){const w=invertedComparators[g];if(!isKeyOf(w,minComparators))return this.error(writeUnpairableComparatorMessage(g));if(this.branches.leftBound)return this.error(writeMultipleLeftBoundsMessage(this.branches.leftBound.limit,this.branches.leftBound.comparator,m,w));this.branches.leftBound={comparator:w,limit:m}}finalizeBranches(){if(this.assertRangeUnset(),this.branches.pipe){this.pushRootToBranch("|>"),this.root=this.branches.pipe;return}if(this.branches.union){this.pushRootToBranch("|"),this.root=this.branches.union;return}if(this.branches.intersection){this.pushRootToBranch("&"),this.root=this.branches.intersection;return}this.applyPrefixes()}finalizeGroup(){this.finalizeBranches();const m=this.groups.pop();if(!m)return this.error(writeUnmatchedGroupCloseMessage(")",this.scanner.unscanned));this.branches=m}addPrefix(m){this.branches.prefixes.push(m)}applyPrefixes(){for(;this.branches.prefixes.length;){const m=this.branches.prefixes.pop();this.root=m==="keyof"?this.root.keyof():throwInternalError(`Unexpected prefix '${m}'`)}}pushRootToBranch(m){this.assertRangeUnset(),this.applyPrefixes();const g=this.root;this.root=void 0,this.branches.intersection=this.branches.intersection?.rawAnd(g)??g,m!=="&"&&(this.branches.union=this.branches.union?.rawOr(this.branches.intersection)??this.branches.intersection,this.branches.intersection=null,m!=="|"&&(this.branches.pipe=this.branches.pipe?.rawPipeOnce(this.branches.union)??this.branches.union,this.branches.union=null))}parseUntilFinalizer(){return parseUntilFinalizer(new RuntimeState(this.scanner,this.ctx))}parseOperator(){return parseOperator(this)}parseOperand(){return parseOperand(this)}assertRangeUnset(){if(this.branches.leftBound)return this.error(writeOpenRangeMessage(this.branches.leftBound.limit,this.branches.leftBound.comparator))}reduceGroupOpen(){this.groups.push(this.branches),this.branches={prefixes:[],leftBound:null,union:null,intersection:null,pipe:null}}previousOperator(){return this.branches.leftBound?.comparator??this.branches.prefixes.at(-1)??(this.branches.intersection?"&":this.branches.union?"|":this.branches.pipe?"|>":void 0)}shiftedByOne(){return this.scanner.shift(),this}}const emptyGenericParameterMessage="An empty string is not a valid generic parameter name",parseGenericParamName=(d,m,g)=>{d.shiftUntilNonWhitespace();const w=d.shiftUntilLookahead(terminatingChars);return w===""?d.lookahead===""&&m.length?m:throwParseError(emptyGenericParameterMessage):(d.shiftUntilNonWhitespace(),_parseOptionalConstraint(d,w,m,g))},extendsToken="extends ",_parseOptionalConstraint=(d,m,g,w)=>{if(d.shiftUntilNonWhitespace(),d.unscanned.startsWith(extendsToken))d.jumpForward(extendsToken.length);else return d.lookahead===","&&d.shift(),g.push(m),parseGenericParamName(d,g,w);const $=parseUntilFinalizer(new RuntimeState(d,w));return g.push([m,$.root]),parseGenericParamName(d,g,w)};class InternalFnParser extends Callable{constructor(m){const g={$:m,raw:m.fn};super((...w)=>{const $=w.indexOf(":"),I=$===-1?w.length-1:$-1,D=w.slice(0,I+1),q=m.parse(D).assertHasKind("intersection");let j=m.intrinsic.unknown;if($!==-1){if($!==w.length-2)return throwParseError(badFnReturnTypeMessage);j=m.parse(w[$+1])}return G=>new InternalTypedFn(G,q,j)},{attach:g})}}class InternalTypedFn extends Callable{raw;params;returns;expression;constructor(m,g,w){const $=`typed ${m.name}`,I={[$]:(...q)=>{const j=g.assert(q),G=m(...j);return w.assert(G)}}[$];super(I),this.raw=m,this.params=g,this.returns=w;let D=g.expression;D[0]==="["&&D.at(-1)==="]"?D=D.slice(1,-1):D.endsWith("[]")&&(D=`...${D}`),this.expression=`(${D}) => ${w?.expression??"unknown"}`}}const badFnReturnTypeMessage=`":" must be followed by exactly one return type e.g:
fn("string", ":", "number")(s => s.length)`;class InternalMatchParser extends Callable{$;constructor(m){super((...g)=>new InternalChainedMatchParser(m)(...g),{bind:m}),this.$=m}in(m){return new InternalChainedMatchParser(this.$,m===void 0?void 0:this.$.parse(m))}at(m,g){return new InternalChainedMatchParser(this.$).at(m,g)}case(m,g){return new InternalChainedMatchParser(this.$).case(m,g)}}class InternalChainedMatchParser extends Callable{$;in;key;branches=[];constructor(m,g){super(w=>this.caseEntries(Object.entries(w).map(([$,I])=>$==="default"?[$,I]:[this.$.parse($),I]))),this.$=m,this.in=g}at(m,g){return this.key&&throwParseError(doubleAtMessage),this.branches.length&&throwParseError(chainedAtMessage),this.key=m,g?this.match(g):this}case(m,g){return this.caseEntry(this.$.parse(m),g)}caseEntry(m,g){const $=(this.key?this.$.parse({[this.key]:m}):m).pipe(g);return this.branches.push($),this}match(m){return this(m)}strings(m){return this.caseEntries(Object.entries(m).map(([g,w])=>g==="default"?[g,w]:[this.$.node("unit",{unit:g}),w]))}caseEntries(m){for(let g=0;g<m.length;g++){const[w,$]=m[g];if(w==="default")return g!==m.length-1&&throwParseError("default may only be specified as the last key of a switch definition"),this.default($);if(typeof $!="function")return throwParseError(`Value for case "${w}" must be a function (was ${domainOf($)})`);this.caseEntry(w,$)}return this}default(m){typeof m=="function"&&this.case(intrinsic.unknown,m);const g={branches:this.branches,ordered:!0};(m==="never"||m==="assert")&&(g.meta={onFail:throwOnDefault});const w=this.$.node("union",g);if(!this.in)return this.$.finalize(w);let $=this.in.pipe(w);return(m==="never"||m==="assert")&&($=$.configureReferences({onFail:throwOnDefault},"self")),this.$.finalize($)}}const throwOnDefault=d=>d.throw(),chainedAtMessage="A key matcher must be specified before the first case i.e. match.at('foo') or match.in<object>().at('bar')",doubleAtMessage="At most one key matcher may be specified per expression",parseProperty=(d,m)=>{if(isArray$1(d)){if(d[1]==="=")return[m.$.parseOwnDefinitionFormat(d[0],m),"=",d[2]];if(d[1]==="?")return[m.$.parseOwnDefinitionFormat(d[0],m),"?"]}return parseInnerDefinition(d,m)},invalidOptionalKeyKindMessage="Only required keys may make their values optional, e.g. { [mySymbol]: ['number', '?'] }",invalidDefaultableKeyKindMessage="Only required keys may specify default values, e.g. { value: 'number = 0' }",parseObjectLiteral=(d,m)=>{let g;const w={},$=stringAndSymbolicEntriesOf(d);for(const[D,q]of $){const j=preparseKey(D);if(j.kind==="spread"){if(!isEmptyObject(w))return throwParseError(nonLeadingSpreadError);const K=m.$.parseOwnDefinitionFormat(q,m);if(K.equals(intrinsic.object))continue;if(!K.hasKind("intersection")||!K.basis?.equals(intrinsic.object))return throwParseError(writeInvalidSpreadTypeMessage(K.expression));g=K.structure;continue}if(j.kind==="undeclared"){q!=="reject"&&q!=="delete"&&q!=="ignore"&&throwParseError(writeInvalidUndeclaredBehaviorMessage(q)),w.undeclared=q;continue}const G=parseProperty(q,m),H=j;if(j.kind==="required"){isArray$1(G)?appendNamedProp(w,"optional",G[1]==="="?{key:j.normalized,value:G[0],default:G[2]}:{key:j.normalized,value:G[0]},m):appendNamedProp(w,"required",{key:j.normalized,value:G},m);continue}if(isArray$1(G)&&(G[1]==="?"&&throwParseError(invalidOptionalKeyKindMessage),G[1]==="="&&throwParseError(invalidDefaultableKeyKindMessage)),j.kind==="optional"){appendNamedProp(w,"optional",{key:j.normalized,value:G},m);continue}const W=m.$.parseOwnDefinitionFormat(H.normalized,m),V=normalizeIndex(W,G,m.$);V.index&&(w.index=append(w.index,V.index)),V.required&&(w.required=append(w.required,V.required))}const I=m.$.node("structure",w);return m.$.parseSchema({domain:"object",structure:g?.merge(I)??I})},appendNamedProp=(d,m,g,w)=>{d[m]=append(d[m],w.$.node(m,g))},writeInvalidUndeclaredBehaviorMessage=d=>`Value of '+' key must be 'reject', 'delete', or 'ignore' (was ${printable(d)})`,nonLeadingSpreadError="Spread operator may only be used as the first key in an object",preparseKey=d=>typeof d=="symbol"?{kind:"required",normalized:d}:d.at(-1)==="?"?d.at(-2)===Backslash?{kind:"required",normalized:`${d.slice(0,-2)}?`}:{kind:"optional",normalized:d.slice(0,-1)}:d[0]==="["&&d.at(-1)==="]"?{kind:"index",normalized:d.slice(1,-1)}:d[0]===Backslash&&d[1]==="["&&d.at(-1)==="]"?{kind:"required",normalized:d.slice(1)}:d==="..."?{kind:"spread"}:d==="+"?{kind:"undeclared"}:{kind:"required",normalized:d==="\\..."?"...":d==="\\+"?"+":d},writeInvalidSpreadTypeMessage=d=>`Spread operand must resolve to an object literal type (was ${d})`,maybeParseTupleExpression=(d,m)=>isIndexZeroExpression(d)?indexZeroParsers[d[0]](d,m):isIndexOneExpression(d)?indexOneParsers[d[1]](d,m):null,parseKeyOfTuple=(d,m)=>m.$.parseOwnDefinitionFormat(d[1],m).keyof(),parseBranchTuple=(d,m)=>{if(d[2]===void 0)return throwParseError(writeMissingRightOperandMessage(d[1],""));const g=m.$.parseOwnDefinitionFormat(d[0],m),w=m.$.parseOwnDefinitionFormat(d[2],m);if(d[1]==="|")return m.$.node("union",{branches:[g,w]});const $=d[1]==="&"?intersectNodesRoot(g,w,m.$):pipeNodesRoot(g,w,m.$);return $ instanceof Disjoint?$.throw():$},parseArrayTuple=(d,m)=>m.$.parseOwnDefinitionFormat(d[0],m).array(),parseMorphTuple=(d,m)=>typeof d[2]!="function"?throwParseError(writeMalformedFunctionalExpressionMessage("=>",d[2])):m.$.parseOwnDefinitionFormat(d[0],m).pipe(d[2]),writeMalformedFunctionalExpressionMessage=(d,m)=>`${d===":"?"Narrow":"Morph"} expression requires a function following '${d}' (was ${typeof m})`,parseNarrowTuple=(d,m)=>typeof d[2]!="function"?throwParseError(writeMalformedFunctionalExpressionMessage(":",d[2])):m.$.parseOwnDefinitionFormat(d[0],m).constrain("predicate",d[2]),parseMetaTuple=(d,m)=>m.$.parseOwnDefinitionFormat(d[0],m).configure(d[2],d[3]),defineIndexOneParsers=d=>d,postfixParsers=defineIndexOneParsers({"[]":parseArrayTuple,"?":()=>throwParseError(shallowOptionalMessage)}),infixParsers=defineIndexOneParsers({"|":parseBranchTuple,"&":parseBranchTuple,":":parseNarrowTuple,"=>":parseMorphTuple,"|>":parseBranchTuple,"@":parseMetaTuple,"=":()=>throwParseError(shallowDefaultableMessage)}),indexOneParsers={...postfixParsers,...infixParsers},isIndexOneExpression=d=>indexOneParsers[d[1]]!==void 0,defineIndexZeroParsers=d=>d,indexZeroParsers=defineIndexZeroParsers({keyof:parseKeyOfTuple,instanceof:(d,m)=>{if(typeof d[1]!="function")return throwParseError(writeInvalidConstructorMessage(objectKindOrDomainOf(d[1])));const g=d.slice(1).map(w=>typeof w=="function"?m.$.node("proto",{proto:w}):throwParseError(writeInvalidConstructorMessage(objectKindOrDomainOf(w))));return g.length===1?g[0]:m.$.node("union",{branches:g})},"===":(d,m)=>m.$.units(d.slice(1))}),isIndexZeroExpression=d=>indexZeroParsers[d[0]]!==void 0,writeInvalidConstructorMessage=d=>`Expected a constructor following 'instanceof' operator (was ${d})`,parseTupleLiteral=(d,m)=>{let g=[{}],w=0;for(;w<d.length;){let $=!1;d[w]==="..."&&w<d.length-1&&($=!0,w++);const I=parseProperty(d[w],m),[D,q,j]=isArray$1(I)?I:[I];if(w++,$){if(!D.extends($ark.intrinsic.Array))return throwParseError(writeNonArraySpreadMessage(D.expression));g=g.flatMap(G=>D.distribute(H=>appendSpreadBranch(makeRootAndArrayPropertiesMutable(G),H)))}else g=g.map(G=>q==="?"?appendOptionalElement(G,D):q==="="?appendDefaultableElement(G,D,j):appendRequiredElement(G,D))}return m.$.parseSchema(g.map($=>isEmptyObject($)?{proto:Array,exactLength:0}:{proto:Array,sequence:$}))},appendRequiredElement=(d,m)=>d.defaultables||d.optionals?throwParseError(d.variadic?postfixAfterOptionalOrDefaultableMessage:requiredPostOptionalMessage):(d.variadic?d.postfix=append(d.postfix,m):d.prefix=append(d.prefix,m),d),appendOptionalElement=(d,m)=>d.variadic?throwParseError(optionalOrDefaultableAfterVariadicMessage):(d.optionals=append(d.optionals,m),d),appendDefaultableElement=(d,m,g)=>d.variadic?throwParseError(optionalOrDefaultableAfterVariadicMessage):d.optionals?throwParseError(defaultablePostOptionalMessage):(d.defaultables=append(d.defaultables,[[m,g]]),d),appendVariadicElement=(d,m)=>(d.postfix&&throwParseError(multipleVariadicMesage),d.variadic?d.variadic.equals(m)||throwParseError(multipleVariadicMesage):d.variadic=m.internal,d),appendSpreadBranch=(d,m)=>{const g=m.select({method:"find",kind:"sequence"});if(!g)return appendVariadicElement(d,$ark.intrinsic.unknown);if(g.prefix)for(const w of g.prefix)appendRequiredElement(d,w);if(g.optionals)for(const w of g.optionals)appendOptionalElement(d,w);if(g.variadic&&appendVariadicElement(d,g.variadic),g.postfix)for(const w of g.postfix)appendRequiredElement(d,w);return d},writeNonArraySpreadMessage=d=>`Spread element must be an array (was ${d})`,multipleVariadicMesage="A tuple may have at most one variadic element",requiredPostOptionalMessage="A required element may not follow an optional element",optionalOrDefaultableAfterVariadicMessage="An optional element may not follow a variadic element",defaultablePostOptionalMessage="A defaultable element may not follow an optional element without a default",parseCache={},parseInnerDefinition=(d,m)=>{if(typeof d=="string"){if(m.args&&Object.keys(m.args).some(w=>d.includes(w)))return parseString(d,m);const g=parseCache[m.$.name]??={};return g[d]??=parseString(d,m)}return hasDomain(d,"object")?parseObject(d,m):throwParseError(writeBadDefinitionTypeMessage(domainOf(d)))},parseObject=(d,m)=>{const g=objectKindOf(d);switch(g){case void 0:return hasArkKind(d,"root")?d:parseObjectLiteral(d,m);case"Array":return parseTuple(d,m);case"RegExp":return m.$.node("intersection",{domain:"string",pattern:d},{prereduced:!0});case"Function":{const w=isThunk(d)?d():d;return hasArkKind(w,"root")?w:throwParseError(writeBadDefinitionTypeMessage("Function"))}default:return throwParseError(writeBadDefinitionTypeMessage(g??printable(d)))}},parseTuple=(d,m)=>maybeParseTupleExpression(d,m)??parseTupleLiteral(d,m),writeBadDefinitionTypeMessage=d=>`Type definitions must be strings or objects (was ${d})`;class InternalTypeParser extends Callable{constructor(m){const g=Object.assign({errors:ArkErrors,hkt:Hkt,$:m,raw:m.parse,module:m.constructor.module,scope:m.constructor.scope,declare:m.declare,define:m.define,match:m.match,generic:m.generic,schema:m.schema,keywords:m.ambient,unit:m.unit,enumerated:m.enumerated,instanceOf:m.instanceOf,valueOf:m.valueOf,or:m.or,and:m.and,merge:m.merge,pipe:m.pipe,fn:m.fn},m.ambientAttachments);super((...w)=>{if(w.length===1)return m.parse(w[0]);if(w.length===2&&typeof w[0]=="string"&&w[0][0]==="<"&&w[0].at(-1)===">"){const $=w[0].slice(1,-1),I=m.parseGenericParams($,{});return new GenericRoot(I,w[1],m,m,null)}return m.parse(w)},{attach:g})}}const $arkTypeRegistry=$ark;class InternalScope extends BaseScope{get ambientAttachments(){if($arkTypeRegistry.typeAttachments)return this.cacheGetter("ambientAttachments",flatMorph($arkTypeRegistry.typeAttachments,(m,g)=>[m,this.bindReference(g)]))}preparseOwnAliasEntry(m,g){const w=m.indexOf("<");if(w===-1){if(hasArkKind(g,"module")||hasArkKind(g,"generic"))return[m,g];const D=this.name==="ark"?m:m==="root"?this.name:`${this.name}.${m}`,q=this.resolvedConfig.keywords?.[D];return q&&(g=[g,"@",q]),[m,g]}m.at(-1)!==">"&&throwParseError("'>' must be the last character of a generic declaration in a scope");const $=m.slice(0,w),I=m.slice(w+1,-1);return[$,()=>{const D=this.parseGenericParams(I,{alias:$});return parseGeneric(D,g,this)}]}parseGenericParams(m,g){return parseGenericParamName(new Scanner(m),[],this.createParseContext({...g,def:m,prefix:"generic"}))}normalizeRootScopeValue(m){return isThunk(m)&&!hasArkKind(m,"generic")?m():m}preparseOwnDefinitionFormat(m,g){return{...g,def:m,prefix:g.alias??"type"}}parseOwnDefinitionFormat(m,g){!(g.alias&&g.alias in this.aliases)&&!g.args&&(g.args={this:g.id});const $=parseInnerDefinition(m,g);if(isArray$1($)){if($[1]==="=")return throwParseError(shallowDefaultableMessage);if($[1]==="?")return throwParseError(shallowOptionalMessage)}return $}unit=m=>this.units([m]);valueOf=m=>this.units(enumValues(m));enumerated=(...m)=>this.units(m);instanceOf=m=>this.node("proto",{proto:m},{prereduced:!0});or=(...m)=>this.schema(m.map(g=>this.parse(g)));and=(...m)=>m.reduce((g,w)=>g.and(this.parse(w)),this.intrinsic.unknown);merge=(...m)=>m.reduce((g,w)=>g.merge(this.parse(w)),this.intrinsic.object);pipe=(...m)=>this.intrinsic.unknown.pipe(...m);fn=new InternalFnParser(this);match=new InternalMatchParser(this);declare=()=>({type:this.type});define(m){return m}type=new InternalTypeParser(this);static scope=((m,g={})=>new InternalScope(m,g));static module=((m,g={})=>this.scope(m,g).export())}const scope=Object.assign(InternalScope.scope,{define:d=>d}),Scope=InternalScope;class MergeHkt extends Hkt{description='merge an object\'s properties onto another like `Merge(User, { isAdmin: "true" })`'}const Merge=genericNode(["base",intrinsic.object],["props",intrinsic.object])(d=>d.base.merge(d.props),MergeHkt),arkBuiltins=Scope.module({Key:intrinsic.key,Merge});class liftFromHkt extends Hkt{}const liftFrom=genericNode("element")(d=>{const m=d.element.exclude(intrinsic.Array),g=m.array();return m.rawOr(g).pipe(liftArray).distribute(w=>w.assertHasKind("morph").declareOut(g),rootSchema)},liftFromHkt),arkArray=Scope.module({root:intrinsic.Array,readonly:"root",index:intrinsic.nonNegativeIntegerString,liftFrom},{name:"Array"}),value=rootSchema(["string",registry.FileConstructor]),parsedFormDataValue=value.rawOr(value.array()),parsed=rootSchema({meta:"an object representing parsed form data",domain:"object",index:{signature:"string",value:parsedFormDataValue}}),arkFormData=Scope.module({root:["instanceof",FormData],value,parsed,parse:rootSchema({in:FormData,morphs:d=>{const m={};for(const[g,w]of d)if(g in m){const $=m[g];typeof $=="string"||$ instanceof registry.FileConstructor?m[g]=[$,w]:$.push(w)}else m[g]=w;return m},declaredOut:parsed})},{name:"FormData"}),TypedArray=Scope.module({Int8:["instanceof",Int8Array],Uint8:["instanceof",Uint8Array],Uint8Clamped:["instanceof",Uint8ClampedArray],Int16:["instanceof",Int16Array],Uint16:["instanceof",Uint16Array],Int32:["instanceof",Int32Array],Uint32:["instanceof",Uint32Array],Float32:["instanceof",Float32Array],Float64:["instanceof",Float64Array],BigInt64:["instanceof",BigInt64Array],BigUint64:["instanceof",BigUint64Array]},{name:"TypedArray"}),omittedPrototypes={Boolean:1,Number:1,String:1},arkPrototypes=Scope.module({...flatMorph({...ecmascriptConstructors,...platformConstructors},(d,m)=>d in omittedPrototypes?[]:[d,["instanceof",m]]),Array:arkArray,TypedArray,FormData:arkFormData}),epoch$1=rootSchema({domain:{domain:"number",meta:"a number representing a Unix timestamp"},divisor:{rule:1,meta:"an integer representing a Unix timestamp"},min:{rule:-864e13,meta:"a Unix timestamp after -8640000000000000"},max:{rule:864e13,meta:"a Unix timestamp before 8640000000000000"},meta:"an integer representing a safe Unix timestamp"}),integer=rootSchema({domain:"number",divisor:1}),number=Scope.module({root:intrinsic.number,integer,epoch:epoch$1,safe:rootSchema({domain:{domain:"number",numberAllowsNaN:!1},min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER}),NaN:["===",Number.NaN],Infinity:["===",Number.POSITIVE_INFINITY],NegativeInfinity:["===",Number.NEGATIVE_INFINITY]},{name:"number"}),regexStringNode=(d,m,g)=>{const w={domain:"string",pattern:{rule:d.source,flags:d.flags,meta:m}};return g&&(w.meta={format:g}),node("intersection",w)},stringIntegerRoot=regexStringNode(wellFormedIntegerMatcher,"a well-formed integer string"),stringInteger=Scope.module({root:stringIntegerRoot,parse:rootSchema({in:stringIntegerRoot,morphs:(d,m)=>{const g=Number.parseInt(d);return Number.isSafeInteger(g)?g:m.error("an integer in the range Number.MIN_SAFE_INTEGER to Number.MAX_SAFE_INTEGER")},declaredOut:intrinsic.integer})},{name:"string.integer"}),hex=regexStringNode(/^[\dA-Fa-f]+$/,"hex characters only"),base64$1=Scope.module({root:regexStringNode(/^(?:[\d+/A-Za-z]{4})*(?:[\d+/A-Za-z]{2}==|[\d+/A-Za-z]{3}=)?$/,"base64-encoded"),url:regexStringNode(/^(?:[\w-]{4})*(?:[\w-]{2}(?:==|%3D%3D)?|[\w-]{3}(?:=|%3D)?)?$/,"base64url-encoded")},{name:"string.base64"}),preformattedCapitalize=regexStringNode(/^[A-Z].*$/,"capitalized"),capitalize=Scope.module({root:rootSchema({in:"string",morphs:d=>d.charAt(0).toUpperCase()+d.slice(1),declaredOut:preformattedCapitalize}),preformatted:preformattedCapitalize},{name:"string.capitalize"}),isLuhnValid=d=>{const m=d.replaceAll(/[ -]+/g,"");let g=0,w,$,I=!1;for(let D=m.length-1;D>=0;D--)w=m.substring(D,D+1),$=Number.parseInt(w,10),I?($*=2,g+=$>=10?$%10+1:$):g+=$,I=!I;return!!(g%10===0&&m)},creditCardMatcher=/^(?:4\d{12}(?:\d{3,6})?|5[1-5]\d{14}|(222[1-9]|22[3-9]\d|2[3-6]\d{2}|27[01]\d|2720)\d{12}|6(?:011|5\d\d)\d{12,15}|3[47]\d{13}|3(?:0[0-5]|[68]\d)\d{11}|(?:2131|1800|35\d{3})\d{11}|6[27]\d{14}|^(81\d{14,17}))$/,creditCard=rootSchema({domain:"string",pattern:{meta:"a credit card number",rule:creditCardMatcher.source},predicate:{meta:"a credit card number",predicate:isLuhnValid}}),iso8601Matcher=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))(T((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([,.]\d+(?!:))?)?(\17[0-5]\d([,.]\d+)?)?([Zz]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,isParsableDate=d=>!Number.isNaN(new Date(d).valueOf()),parsableDate=rootSchema({domain:"string",predicate:{meta:"a parsable date",predicate:isParsableDate}}).assertHasKind("intersection"),epochRoot=stringInteger.root.internal.narrow((d,m)=>{const g=Number.parseInt(d),w=number.epoch(g);return w instanceof ArkErrors?(m.errors.merge(w),!1):!0}).configure({description:"an integer string representing a safe Unix timestamp"},"self").assertHasKind("intersection"),epoch=Scope.module({root:epochRoot,parse:rootSchema({in:epochRoot,morphs:d=>new Date(d),declaredOut:intrinsic.Date})},{name:"string.date.epoch"}),isoRoot=regexStringNode(iso8601Matcher,"an ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ) date").internal.assertHasKind("intersection"),iso=Scope.module({root:isoRoot,parse:rootSchema({in:isoRoot,morphs:d=>new Date(d),declaredOut:intrinsic.Date})},{name:"string.date.iso"}),stringDate=Scope.module({root:parsableDate,parse:rootSchema({declaredIn:parsableDate,in:"string",morphs:(d,m)=>{const g=new Date(d);return Number.isNaN(g.valueOf())?m.error("a parsable date"):g},declaredOut:intrinsic.Date}),iso,epoch},{name:"string.date"}),email=regexStringNode(/^[\w%+.-]+@[\d.A-Za-z-]+\.[A-Za-z]{2,}$/,"an email address","email"),ipv4Segment="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",ipv4Address=`(${ipv4Segment}[.]){3}${ipv4Segment}`,ipv4Matcher=new RegExp(`^${ipv4Address}$`),ipv6Segment="(?:[0-9a-fA-F]{1,4})",ipv6Matcher=new RegExp(`^((?:${ipv6Segment}:){7}(?:${ipv6Segment}|:)|(?:${ipv6Segment}:){6}(?:${ipv4Address}|:${ipv6Segment}|:)|(?:${ipv6Segment}:){5}(?::${ipv4Address}|(:${ipv6Segment}){1,2}|:)|(?:${ipv6Segment}:){4}(?:(:${ipv6Segment}){0,1}:${ipv4Address}|(:${ipv6Segment}){1,3}|:)|(?:${ipv6Segment}:){3}(?:(:${ipv6Segment}){0,2}:${ipv4Address}|(:${ipv6Segment}){1,4}|:)|(?:${ipv6Segment}:){2}(?:(:${ipv6Segment}){0,3}:${ipv4Address}|(:${ipv6Segment}){1,5}|:)|(?:${ipv6Segment}:){1}(?:(:${ipv6Segment}){0,4}:${ipv4Address}|(:${ipv6Segment}){1,6}|:)|(?::((?::${ipv6Segment}){0,5}:${ipv4Address}|(?::${ipv6Segment}){1,7}|:)))(%[0-9a-zA-Z.]{1,})?$`),ip=Scope.module({root:["v4 | v6","@","an IP address"],v4:regexStringNode(ipv4Matcher,"an IPv4 address","ipv4"),v6:regexStringNode(ipv6Matcher,"an IPv6 address","ipv6")},{name:"string.ip"}),jsonStringDescription="a JSON string",writeJsonSyntaxErrorProblem=d=>{if(!(d instanceof SyntaxError))throw d;return`must be ${jsonStringDescription} (${d})`},jsonRoot=rootSchema({meta:jsonStringDescription,domain:"string",predicate:{meta:jsonStringDescription,predicate:(d,m)=>{try{return JSON.parse(d),!0}catch(g){return m.reject({code:"predicate",expected:jsonStringDescription,problem:writeJsonSyntaxErrorProblem(g)})}}}}),parseJson=(d,m)=>{if(d.length===0)return m.error({code:"predicate",expected:jsonStringDescription,actual:"empty"});try{return JSON.parse(d)}catch(g){return m.error({code:"predicate",expected:jsonStringDescription,problem:writeJsonSyntaxErrorProblem(g)})}},json$1=Scope.module({root:jsonRoot,parse:rootSchema({meta:"safe JSON string parser",in:"string",morphs:parseJson,declaredOut:intrinsic.jsonObject})},{name:"string.json"}),preformattedLower=regexStringNode(/^[a-z]*$/,"only lowercase letters"),lower=Scope.module({root:rootSchema({in:"string",morphs:d=>d.toLowerCase(),declaredOut:preformattedLower}),preformatted:preformattedLower},{name:"string.lower"}),normalizedForms=["NFC","NFD","NFKC","NFKD"],preformattedNodes=flatMorph(normalizedForms,(d,m)=>[m,rootSchema({domain:"string",predicate:g=>g.normalize(m)===g,meta:`${m}-normalized unicode`})]),normalizeNodes=flatMorph(normalizedForms,(d,m)=>[m,rootSchema({in:"string",morphs:g=>g.normalize(m),declaredOut:preformattedNodes[m]})]),NFC=Scope.module({root:normalizeNodes.NFC,preformatted:preformattedNodes.NFC},{name:"string.normalize.NFC"}),NFD=Scope.module({root:normalizeNodes.NFD,preformatted:preformattedNodes.NFD},{name:"string.normalize.NFD"}),NFKC=Scope.module({root:normalizeNodes.NFKC,preformatted:preformattedNodes.NFKC},{name:"string.normalize.NFKC"}),NFKD=Scope.module({root:normalizeNodes.NFKD,preformatted:preformattedNodes.NFKD},{name:"string.normalize.NFKD"}),normalize=Scope.module({root:"NFC",NFC,NFD,NFKC,NFKD},{name:"string.normalize"}),numericRoot=regexStringNode(numericStringMatcher,"a well-formed numeric string"),stringNumeric=Scope.module({root:numericRoot,parse:rootSchema({in:numericRoot,morphs:d=>Number.parseFloat(d),declaredOut:intrinsic.number})},{name:"string.numeric"}),regexPatternDescription="a regex pattern",regex=rootSchema({domain:"string",predicate:{meta:regexPatternDescription,predicate:(d,m)=>{try{return new RegExp(d),!0}catch(g){return m.reject({code:"predicate",expected:regexPatternDescription,problem:String(g)})}}},meta:{format:"regex"}}),semverMatcher=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*)(?:\.(?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*))*))?(?:\+([\dA-Za-z-]+(?:\.[\dA-Za-z-]+)*))?$/,semver=regexStringNode(semverMatcher,"a semantic version (see https://semver.org/)"),preformattedTrim=regexStringNode(/^\S.*\S$|^\S?$/,"trimmed"),trim=Scope.module({root:rootSchema({in:"string",morphs:d=>d.trim(),declaredOut:preformattedTrim}),preformatted:preformattedTrim},{name:"string.trim"}),preformattedUpper=regexStringNode(/^[A-Z]*$/,"only uppercase letters"),upper=Scope.module({root:rootSchema({in:"string",morphs:d=>d.toUpperCase(),declaredOut:preformattedUpper}),preformatted:preformattedUpper},{name:"string.upper"}),isParsableUrl=d=>URL.canParse(d),urlRoot=rootSchema({domain:"string",predicate:{meta:"a URL string",predicate:isParsableUrl},meta:{format:"uri"}}),url=Scope.module({root:urlRoot,parse:rootSchema({declaredIn:urlRoot,in:"string",morphs:(d,m)=>{try{return new URL(d)}catch{return m.error("a URL string")}},declaredOut:rootSchema(URL)})},{name:"string.url"}),uuid=Scope.module({root:["versioned | nil | max","@",{description:"a UUID",format:"uuid"}],"#nil":"'00000000-0000-0000-0000-000000000000'","#max":"'ffffffff-ffff-ffff-ffff-ffffffffffff'","#versioned":/[\da-f]{8}-[\da-f]{4}-[1-8][\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}/i,v1:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-1[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv1"),v2:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-2[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv2"),v3:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-3[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv3"),v4:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-4[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv4"),v5:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-5[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv5"),v6:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-6[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv6"),v7:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-7[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv7"),v8:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-8[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv8")},{name:"string.uuid"}),string$1=Scope.module({root:intrinsic.string,alpha:regexStringNode(/^[A-Za-z]*$/,"only letters"),alphanumeric:regexStringNode(/^[\dA-Za-z]*$/,"only letters and digits 0-9"),hex,base64:base64$1,capitalize,creditCard,date:stringDate,digits:regexStringNode(/^\d*$/,"only digits 0-9"),email,integer:stringInteger,ip,json:json$1,lower,normalize,numeric:stringNumeric,regex,semver,trim,upper,url,uuid},{name:"string"}),arkTsKeywords=Scope.module({bigint:intrinsic.bigint,boolean:intrinsic.boolean,false:intrinsic.false,never:intrinsic.never,null:intrinsic.null,number:intrinsic.number,object:intrinsic.object,string:intrinsic.string,symbol:intrinsic.symbol,true:intrinsic.true,unknown:intrinsic.unknown,undefined:intrinsic.undefined}),unknown=Scope.module({root:intrinsic.unknown,any:intrinsic.unknown},{name:"unknown"}),json=Scope.module({root:intrinsic.jsonObject,stringify:node("morph",{in:intrinsic.jsonObject,morphs:d=>JSON.stringify(d),declaredOut:intrinsic.string})},{name:"object.json"}),object=Scope.module({root:intrinsic.object,json},{name:"object"});class RecordHkt extends Hkt{description='instantiate an object from an index signature and corresponding value type like `Record("string", "number")`'}const Record=genericNode(["K",intrinsic.key],"V")(d=>({domain:"object",index:{signature:d.K,value:d.V}}),RecordHkt);class PickHkt extends Hkt{description='pick a set of properties from an object like `Pick(User, "name | age")`'}const Pick=genericNode(["T",intrinsic.object],["K",intrinsic.key])(d=>d.T.pick(d.K),PickHkt);class OmitHkt extends Hkt{description='omit a set of properties from an object like `Omit(User, "age")`'}const Omit=genericNode(["T",intrinsic.object],["K",intrinsic.key])(d=>d.T.omit(d.K),OmitHkt);class PartialHkt extends Hkt{description="make all named properties of an object optional like `Partial(User)`"}const Partial=genericNode(["T",intrinsic.object])(d=>d.T.partial(),PartialHkt);class RequiredHkt extends Hkt{description="make all named properties of an object required like `Required(User)`"}const Required=genericNode(["T",intrinsic.object])(d=>d.T.required(),RequiredHkt);class ExcludeHkt extends Hkt{description='exclude branches of a union like `Exclude("boolean", "true")`'}const Exclude=genericNode("T","U")(d=>d.T.exclude(d.U),ExcludeHkt);class ExtractHkt extends Hkt{description='extract branches of a union like `Extract("0 | false | 1", "number")`'}const Extract=genericNode("T","U")(d=>d.T.extract(d.U),ExtractHkt),arkTsGenerics=Scope.module({Exclude,Extract,Omit,Partial,Pick,Record,Required}),ark=scope({...arkTsKeywords,...arkTsGenerics,...arkPrototypes,...arkBuiltins,string:string$1,number,object,unknown},{prereducedAliases:!0,name:"ark"}),keywords=ark.export();Object.assign($arkTypeRegistry.ambient,keywords);$arkTypeRegistry.typeAttachments={string:keywords.string.root,number:keywords.number.root,bigint:keywords.bigint,boolean:keywords.boolean,symbol:keywords.symbol,undefined:keywords.undefined,null:keywords.null,object:keywords.object.root,unknown:keywords.unknown.root,false:keywords.false,true:keywords.true,never:keywords.never,arrayIndex:keywords.Array.index,Key:keywords.Key,Record:keywords.Record,Array:keywords.Array.root,Date:keywords.Date};const type=Object.assign(ark.type,$arkTypeRegistry.typeAttachments),match$1=ark.match;ark.fn;ark.generic;ark.schema;ark.define;ark.declare;const PayloadInitializeSchema=type({by:'"sw&rpc"',functionName:'"#initialize"',isInitializeRequest:"true",localStorageData:"Record<string, unknown>",nodeId:"string"}),PayloadHeaderSchema=type("<Name extends string>",{by:'"sw&rpc"',functionName:"Name",requestId:"string >= 1"}),PayloadCoreSchema=type("<I, P, S>",{"input?":"I","progress?":"P","result?":"S","abort?":{reason:"string"},"error?":{message:"string"}}),PayloadSchema=type.scope({PayloadCoreSchema,PayloadHeaderSchema,PayloadInitializeSchema}).type("<Name extends string, I, P, S>",[["PayloadHeaderSchema<Name>","&","PayloadCoreSchema<I, P, S>"],"|","PayloadInitializeSchema"]),zImplementations=Symbol("SWARPC implementations"),zProcedures=Symbol("SWARPC procedures"),transferableClasses=[MessagePort,ReadableStream,WritableStream,TransformStream,ArrayBuffer];function findTransferables(d){return d==null?[]:typeof d=="object"?ArrayBuffer.isView(d)||d instanceof ArrayBuffer?[d]:transferableClasses.some(m=>d instanceof m)?[d]:Array.isArray(d)?d.flatMap(findTransferables):Object.values(d).flatMap(findTransferables):[]}class FauxLocalStorage{data;keysOrder;constructor(m){this.data=m,this.keysOrder=Object.keys(m)}setItem(m,g){this.hasItem(m)||this.keysOrder.push(m),this.data[m]=g}getItem(m){return this.data[m]}hasItem(m){return Object.hasOwn(this.data,m)}removeItem(m){this.hasItem(m)&&(delete this.data[m],this.keysOrder=this.keysOrder.filter(g=>g!==m))}clear(){this.data={},this.keysOrder=[]}key(m){return this.keysOrder[m]}get length(){return this.keysOrder.length}register(m){m.localStorage=this}}const abortControllers=new Map,abortedRequests=new Set;function Server(d,{loglevel:m="debug",scope:g,_scopeType:w}={}){g??=self;const $=nodeIdFromScope(g,w),I=createLogger("server",m,$),D={[zProcedures]:d,[zImplementations]:{},start:async()=>{}};for(const q in d)D[q]=(j=>{if(!D[zProcedures][q])throw new Error(`No procedure found for function name: ${q}`);D[zImplementations][q]=(G,H,W)=>(W.abortSignal?.throwIfAborted(),new Promise((V,K)=>{W.abortSignal?.addEventListener("abort",()=>{let{requestId:Z,reason:Q}=W.abortSignal.reason;I.debug(Z,`Aborted ${q} request: ${Q}`),K({aborted:Q})}),j(G,H,W).then(V).catch(K)}))});return D.start=async()=>{const q=await new Promise(H=>{if(!scopeIsShared(g,w))return H(void 0);I.debug(null,"Awaiting shared worker connection..."),g.addEventListener("connect",({ports:[W]})=>{I.debug(null,"Shared worker connected with port",W),H(W)})}),j=async(H,W)=>{const V=H?[]:findTransferables(W);q?q.postMessage(W,{transfer:V}):scopeIsDedicated(g,w)?g.postMessage(W,{transfer:V}):scopeIsService(g,w)&&await g.clients.matchAll().then(K=>{K.forEach(Z=>Z.postMessage(W,{transfer:V}))})},G=async H=>{if(PayloadInitializeSchema.allows(H.data)){const{localStorageData:oe,nodeId:ee}=H.data;I.debug(null,"Setting up faux localStorage",oe),new FauxLocalStorage(oe).register(g),injectIntoConsoleGlobal(g,ee);return}const{requestId:W,functionName:V}=PayloadHeaderSchema(type.enumerated(...Object.keys(d))).assert(H.data);I.debug(W,`Received request for ${V}`,H.data);const{autotransfer:K="output-only",...Z}=D[zProcedures][V],Q=async oe=>{abortedRequests.has(W)||await j(K!=="never",{by:"sw&rpc",functionName:V,requestId:W,...oe})},J=async oe=>Q({error:{message:"message"in oe?oe.message:String(oe)}}),re=D[zImplementations][V];if(!re){await J("No implementation found");return}const se=PayloadSchema(type(`"${V}"`),Z.input,Z.progress,Z.success).assert(H.data);if("isInitializeRequest"in se)throw"Unreachable: #initialize request payload should've been handled already";if(se.abort){const oe=abortControllers.get(W);oe||await J("No abort controller found for request"),oe?.abort(se.abort.reason);return}if(abortControllers.set(W,new AbortController),!se.input){await J("No input provided");return}try{const oe=await re(se.input,async ee=>{await Q({progress:ee})},{nodeId:$,abortSignal:abortControllers.get(W)?.signal,logger:createLogger("server",m,$,W)});I.debug(W,`Result for ${V}`,oe),await Q({result:oe})}catch(oe){if("aborted"in oe){I.debug(W,`Received abort error for ${V}`,oe.aborted),abortedRequests.add(W),abortControllers.delete(W);return}I.info(W,`Error in ${V}`,oe),await J(oe)}finally{abortedRequests.delete(W)}};if(scopeIsShared(g,w)){if(!q)throw new Error("SharedWorker port not initialized");I.info(null,"Listening for shared worker messages on port",q),q.addEventListener("message",G),q.start()}else if(scopeIsDedicated(g,w))g.addEventListener("message",G);else if(scopeIsService(g,w))g.addEventListener("message",G);else throw new Error(`Unsupported worker scope ${g}`)},D}function localeFromNavigator(){return navigator.language.split("-")[0]==="fr"?"fr":"en"}var tick=1,maxTick=65535,resolution=4,inc=function(){tick=tick+1&maxTick},timer=setInterval(inc,1e3/resolution|0);timer.unref&&timer.unref();function speedometer(d){var m=resolution*d,g=[0],w=1,$=tick-1&maxTick;return function(I){var D=tick-$&maxTick;for(D>m&&(D=m),$=tick;D--;)w===m&&(w=0),g[w]=g[w===0?m-1:w-1],w++;I&&(g[w-1]+=I);var q=g[w-1],j=g.length<m?0:g[w===m?0:w];return g.length<resolution?q:(q-j)*resolution/g.length}}class Progress{constructor(m,g=1e3){this.length=parseInt(m,10)||0,this.transferred=0,this.speed=0,this.streamSpeed=speedometer(this.speed||5e3),this.initial=!1,this.emitDelay=g,this.eventStart=0,this.percentage=0}getRemainingBytes(){return parseInt(this.length,10)-parseInt(this.transferred,10)}getEta(){return this.length>=this.transferred?this.getRemainingBytes()/this.speed*1e9:0}flow(m,g){const w=m.length;if(this.transferred+=w,this.speed=this.streamSpeed(w),this.percentage=Math.round(this.transferred/this.length*100),this.initial||(this.eventStart=Date.now(),this.initial=!0),this.length>=this.transferred||Date.now()-this.eventStart>this.emitDelay){this.eventStart=Date.now();const $={total:this.length,transferred:this.transferred,speed:this.speed,eta:this.getEta()};this.length&&($.remaining=this.getRemainingBytes(),$.percentage=this.percentage),g($)}}}function isFetchProgressSupported(){return typeof Response<"u"&&typeof ReadableStream<"u"}function fetchProgress({defaultSize:d=0,emitDelay:m=10,onProgress:g=()=>null,onComplete:w=()=>null,onError:$=()=>null}){return function(D){if(!isFetchProgressSupported())return D;const{body:q,headers:j,status:G}=D,H=j.get("content-length")||d,W=new Progress(H,m),V=q.getReader(),K=new ReadableStream({start(Z){function Q(){V.read().then(({done:J,value:re})=>{if(J){w({}),Z.close();return}re&&W.flow(re,g),Z.enqueue(re),Q()}).catch(J=>{$(J)})}Q()}});return new Response(K,{headers:j,status:G})}}function mapValues(d,m){return Object.fromEntries(Object.entries(d).map(([g,w])=>[g,m(w)]))}function keys(d){return Object.keys(d)}function fromEntries(d){return Object.fromEntries(d)}function entries(d){return Object.entries(d)}function oneOf(d,m){return m.includes(d)}function pick(d,...m){const g={};for(const w of m)g[w]=d[w];return g}function omit(d,...m){return fromEntries(entries(d).filter(([g])=>!oneOf(g,m)))}function safeJSONStringify(d){try{return JSON.stringify(d)}catch{return}}function clamp(d,m,g){return Math.max(m,Math.min(g,d))}function unique(d,m=g=>g){const g=new Set;return d.filter(w=>{const $=m(w);return g.has($)?!1:(g.add($),!0)})}function splitFilenameOnExtension(d){const m=d.match(/^([^.]+)\.(.+)$/);return m?[m[1],m[2]]:[d,""]}function compareBy(d){return(m,g)=>{const w=d(m),$=d(g);return w===$?0:typeof w=="string"&&typeof $=="string"?w.localeCompare($):typeof w=="number"&&typeof $=="number"?w-$:w.toString().localeCompare($.toString())}}function range(d,m=void 0){return m===void 0?Array.from({length:d},(g,w)=>w):Array.from({length:m-d},(g,w)=>w+d)}async function fetchHttpRequest(d,{cacheAs:m="",onProgress:g}={}){let w=new URL(typeof d=="string"?d:d.url);const $=typeof d=="string"?{headers:{}}:d;return m&&w.searchParams.set("x-cigale-cache-as",m),g?fetch(w,$).then(fetchProgress({onProgress:g})):fetch(w,$)}function sum(d){return[...d].reduce((m,g)=>m+g,0)}function avg(d){return sum(d)/d.length}function nonnull(d){return d!=null}function progressSplitter(...d){let m=[];for(let g=0;g<d.length;g+=2){const w=d[g],$=d[g+1]??1-sum(m.map(([,I])=>I));m.push([w,$])}return(g,w)=>{let $=0;const I=m.findIndex(([D])=>D===g);for(const[D,[q,j]]of m.entries())D<I&&($+=j),D===I&&($+=j*w);return $}}function groupBy(d,m,g){if("groupBy"in Map&&!g)return Map.groupBy(d,m);const w=new Map;for(const $ of d){const I=m($);w.has(I)||w.set(I,[]),w.get(I).push(g?g($):$)}return w}const ID=type(/^[\w._]+$/),References=ID.array().pipe(d=>[...new Set(d)]),Probability=type("0 <= number <= 1.0001").pipe(d=>clamp(d,0,1)),URLString=type(/https?:\/\/.+/),HTTPRequest=URLString.configure("L'URL Ã  laquelle se situe le fichier. Effectue une requÃªte GET sans en-tÃªtes particuliers.","self").or({url:URLString.describe("L'URL de la requÃªte"),"headers?":type({"[string]":"string"}).describe("Les en-tÃªtes Ã  ajouter dans la requÃªte"),"method?":type.enumerated("GET","POST","PUT","DELETE").describe("La mÃ©thode de la requÃªte (GET par dÃ©faut)")}).configure("Le requÃªte HTTP pour obtenir le fichier, avec des en-tÃªtes et une mÃ©thode personnalisable","self"),ModelInput=type({width:["number < 1024","@","Largeur en pixels du tenseur d'entrÃ©e du modÃ¨le"],height:["number < 1024","@","Hauteur en pixels du tenseur d'entrÃ©e du modÃ¨le"],"disposition?":type(['"CHW"',"@","Tenseurs de la forme [3, H, W]"]).or(type(['"1CHW"',"@","Tenseurs de la forme [1, 3, H, W]"])),normalized:["boolean","@","Si les valeurs des pixels doivent Ãªtre normalisÃ©es entre 0 et 1. Sinon, elles sont entre 0 et 255"],"name?":["string","@","Nom de l'input du modÃ¨le Ã  utiliser. Par dÃ©faut, prend la premiÃ¨re input"]}),Dimensions=type({width:"number > 0",height:"number > 0"}).pipe(({width:d,height:m})=>({width:d,height:m,aspectRatio:d/m})),millisecondsInWeek=6048e5,millisecondsInDay=864e5,millisecondsInMinute=6e4,millisecondsInHour=36e5,millisecondsInSecond=1e3,constructFromSymbol=Symbol.for("constructDateFrom");function constructFrom(d,m){return typeof d=="function"?d(m):d&&typeof d=="object"&&constructFromSymbol in d?d[constructFromSymbol](m):d instanceof Date?new d.constructor(m):new Date(m)}function toDate(d,m){return constructFrom(m||d,d)}function addDays(d,m,g){const w=toDate(d,g?.in);return isNaN(m)?constructFrom(g?.in||d,NaN):(m&&w.setDate(w.getDate()+m),w)}let defaultOptions$1={};function getDefaultOptions$1(){return defaultOptions$1}function startOfWeek(d,m){const g=getDefaultOptions$1(),w=m?.weekStartsOn??m?.locale?.options?.weekStartsOn??g.weekStartsOn??g.locale?.options?.weekStartsOn??0,$=toDate(d,m?.in),I=$.getDay(),D=(I<w?7:0)+I-w;return $.setDate($.getDate()-D),$.setHours(0,0,0,0),$}function startOfISOWeek(d,m){return startOfWeek(d,{...m,weekStartsOn:1})}function getISOWeekYear(d,m){const g=toDate(d,m?.in),w=g.getFullYear(),$=constructFrom(g,0);$.setFullYear(w+1,0,4),$.setHours(0,0,0,0);const I=startOfISOWeek($),D=constructFrom(g,0);D.setFullYear(w,0,4),D.setHours(0,0,0,0);const q=startOfISOWeek(D);return g.getTime()>=I.getTime()?w+1:g.getTime()>=q.getTime()?w:w-1}function getTimezoneOffsetInMilliseconds(d){const m=toDate(d),g=new Date(Date.UTC(m.getFullYear(),m.getMonth(),m.getDate(),m.getHours(),m.getMinutes(),m.getSeconds(),m.getMilliseconds()));return g.setUTCFullYear(m.getFullYear()),+d-+g}function normalizeDates(d,...m){const g=constructFrom.bind(null,m.find(w=>typeof w=="object"));return m.map(g)}function startOfDay(d,m){const g=toDate(d,m?.in);return g.setHours(0,0,0,0),g}function differenceInCalendarDays(d,m,g){const[w,$]=normalizeDates(g?.in,d,m),I=startOfDay(w),D=startOfDay($),q=+I-getTimezoneOffsetInMilliseconds(I),j=+D-getTimezoneOffsetInMilliseconds(D);return Math.round((q-j)/millisecondsInDay)}function startOfISOWeekYear(d,m){const g=getISOWeekYear(d,m),w=constructFrom(d,0);return w.setFullYear(g,0,4),w.setHours(0,0,0,0),startOfISOWeek(w)}function isDate(d){return d instanceof Date||typeof d=="object"&&Object.prototype.toString.call(d)==="[object Date]"}function isValid$1(d){return!(!isDate(d)&&typeof d!="number"||isNaN(+toDate(d)))}function startOfYear(d,m){const g=toDate(d,m?.in);return g.setFullYear(g.getFullYear(),0,1),g.setHours(0,0,0,0),g}const formatDistanceLocale={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},formatDistance=(d,m,g)=>{let w;const $=formatDistanceLocale[d];return typeof $=="string"?w=$:m===1?w=$.one:w=$.other.replace("{{count}}",m.toString()),g?.addSuffix?g.comparison&&g.comparison>0?"in "+w:w+" ago":w};function buildFormatLongFn(d){return(m={})=>{const g=m.width?String(m.width):d.defaultWidth;return d.formats[g]||d.formats[d.defaultWidth]}}const dateFormats={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},timeFormats={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},dateTimeFormats={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},formatLong={date:buildFormatLongFn({formats:dateFormats,defaultWidth:"full"}),time:buildFormatLongFn({formats:timeFormats,defaultWidth:"full"}),dateTime:buildFormatLongFn({formats:dateTimeFormats,defaultWidth:"full"})},formatRelativeLocale={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},formatRelative=(d,m,g,w)=>formatRelativeLocale[d];function buildLocalizeFn(d){return(m,g)=>{const w=g?.context?String(g.context):"standalone";let $;if(w==="formatting"&&d.formattingValues){const D=d.defaultFormattingWidth||d.defaultWidth,q=g?.width?String(g.width):D;$=d.formattingValues[q]||d.formattingValues[D]}else{const D=d.defaultWidth,q=g?.width?String(g.width):d.defaultWidth;$=d.values[q]||d.values[D]}const I=d.argumentCallback?d.argumentCallback(m):m;return $[I]}}const eraValues={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},quarterValues={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},monthValues={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dayValues={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},dayPeriodValues={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},formattingDayPeriodValues={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ordinalNumber=(d,m)=>{const g=Number(d),w=g%100;if(w>20||w<10)switch(w%10){case 1:return g+"st";case 2:return g+"nd";case 3:return g+"rd"}return g+"th"},localize={ordinalNumber,era:buildLocalizeFn({values:eraValues,defaultWidth:"wide"}),quarter:buildLocalizeFn({values:quarterValues,defaultWidth:"wide",argumentCallback:d=>d-1}),month:buildLocalizeFn({values:monthValues,defaultWidth:"wide"}),day:buildLocalizeFn({values:dayValues,defaultWidth:"wide"}),dayPeriod:buildLocalizeFn({values:dayPeriodValues,defaultWidth:"wide",formattingValues:formattingDayPeriodValues,defaultFormattingWidth:"wide"})};function buildMatchFn(d){return(m,g={})=>{const w=g.width,$=w&&d.matchPatterns[w]||d.matchPatterns[d.defaultMatchWidth],I=m.match($);if(!I)return null;const D=I[0],q=w&&d.parsePatterns[w]||d.parsePatterns[d.defaultParseWidth],j=Array.isArray(q)?findIndex(q,W=>W.test(D)):findKey(q,W=>W.test(D));let G;G=d.valueCallback?d.valueCallback(j):j,G=g.valueCallback?g.valueCallback(G):G;const H=m.slice(D.length);return{value:G,rest:H}}}function findKey(d,m){for(const g in d)if(Object.prototype.hasOwnProperty.call(d,g)&&m(d[g]))return g}function findIndex(d,m){for(let g=0;g<d.length;g++)if(m(d[g]))return g}function buildMatchPatternFn(d){return(m,g={})=>{const w=m.match(d.matchPattern);if(!w)return null;const $=w[0],I=m.match(d.parsePattern);if(!I)return null;let D=d.valueCallback?d.valueCallback(I[0]):I[0];D=g.valueCallback?g.valueCallback(D):D;const q=m.slice($.length);return{value:D,rest:q}}}const matchOrdinalNumberPattern=/^(\d+)(th|st|nd|rd)?/i,parseOrdinalNumberPattern=/\d+/i,matchEraPatterns={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},parseEraPatterns={any:[/^b/i,/^(a|c)/i]},matchQuarterPatterns={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},parseQuarterPatterns={any:[/1/i,/2/i,/3/i,/4/i]},matchMonthPatterns={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},parseMonthPatterns={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},matchDayPatterns={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},parseDayPatterns={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},matchDayPeriodPatterns={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},parseDayPeriodPatterns={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},match={ordinalNumber:buildMatchPatternFn({matchPattern:matchOrdinalNumberPattern,parsePattern:parseOrdinalNumberPattern,valueCallback:d=>parseInt(d,10)}),era:buildMatchFn({matchPatterns:matchEraPatterns,defaultMatchWidth:"wide",parsePatterns:parseEraPatterns,defaultParseWidth:"any"}),quarter:buildMatchFn({matchPatterns:matchQuarterPatterns,defaultMatchWidth:"wide",parsePatterns:parseQuarterPatterns,defaultParseWidth:"any",valueCallback:d=>d+1}),month:buildMatchFn({matchPatterns:matchMonthPatterns,defaultMatchWidth:"wide",parsePatterns:parseMonthPatterns,defaultParseWidth:"any"}),day:buildMatchFn({matchPatterns:matchDayPatterns,defaultMatchWidth:"wide",parsePatterns:parseDayPatterns,defaultParseWidth:"any"}),dayPeriod:buildMatchFn({matchPatterns:matchDayPeriodPatterns,defaultMatchWidth:"any",parsePatterns:parseDayPeriodPatterns,defaultParseWidth:"any"})},enUS={code:"en-US",formatDistance,formatLong,formatRelative,localize,match,options:{weekStartsOn:0,firstWeekContainsDate:1}};function getDayOfYear(d,m){const g=toDate(d,m?.in);return differenceInCalendarDays(g,startOfYear(g))+1}function getISOWeek(d,m){const g=toDate(d,m?.in),w=+startOfISOWeek(g)-+startOfISOWeekYear(g);return Math.round(w/millisecondsInWeek)+1}function getWeekYear(d,m){const g=toDate(d,m?.in),w=g.getFullYear(),$=getDefaultOptions$1(),I=m?.firstWeekContainsDate??m?.locale?.options?.firstWeekContainsDate??$.firstWeekContainsDate??$.locale?.options?.firstWeekContainsDate??1,D=constructFrom(m?.in||d,0);D.setFullYear(w+1,0,I),D.setHours(0,0,0,0);const q=startOfWeek(D,m),j=constructFrom(m?.in||d,0);j.setFullYear(w,0,I),j.setHours(0,0,0,0);const G=startOfWeek(j,m);return+g>=+q?w+1:+g>=+G?w:w-1}function startOfWeekYear(d,m){const g=getDefaultOptions$1(),w=m?.firstWeekContainsDate??m?.locale?.options?.firstWeekContainsDate??g.firstWeekContainsDate??g.locale?.options?.firstWeekContainsDate??1,$=getWeekYear(d,m),I=constructFrom(m?.in||d,0);return I.setFullYear($,0,w),I.setHours(0,0,0,0),startOfWeek(I,m)}function getWeek(d,m){const g=toDate(d,m?.in),w=+startOfWeek(g,m)-+startOfWeekYear(g,m);return Math.round(w/millisecondsInWeek)+1}function addLeadingZeros(d,m){const g=d<0?"-":"",w=Math.abs(d).toString().padStart(m,"0");return g+w}const lightFormatters={y(d,m){const g=d.getFullYear(),w=g>0?g:1-g;return addLeadingZeros(m==="yy"?w%100:w,m.length)},M(d,m){const g=d.getMonth();return m==="M"?String(g+1):addLeadingZeros(g+1,2)},d(d,m){return addLeadingZeros(d.getDate(),m.length)},a(d,m){const g=d.getHours()/12>=1?"pm":"am";switch(m){case"a":case"aa":return g.toUpperCase();case"aaa":return g;case"aaaaa":return g[0];case"aaaa":default:return g==="am"?"a.m.":"p.m."}},h(d,m){return addLeadingZeros(d.getHours()%12||12,m.length)},H(d,m){return addLeadingZeros(d.getHours(),m.length)},m(d,m){return addLeadingZeros(d.getMinutes(),m.length)},s(d,m){return addLeadingZeros(d.getSeconds(),m.length)},S(d,m){const g=m.length,w=d.getMilliseconds(),$=Math.trunc(w*Math.pow(10,g-3));return addLeadingZeros($,m.length)}},dayPeriodEnum={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},formatters={G:function(d,m,g){const w=d.getFullYear()>0?1:0;switch(m){case"G":case"GG":case"GGG":return g.era(w,{width:"abbreviated"});case"GGGGG":return g.era(w,{width:"narrow"});case"GGGG":default:return g.era(w,{width:"wide"})}},y:function(d,m,g){if(m==="yo"){const w=d.getFullYear(),$=w>0?w:1-w;return g.ordinalNumber($,{unit:"year"})}return lightFormatters.y(d,m)},Y:function(d,m,g,w){const $=getWeekYear(d,w),I=$>0?$:1-$;if(m==="YY"){const D=I%100;return addLeadingZeros(D,2)}return m==="Yo"?g.ordinalNumber(I,{unit:"year"}):addLeadingZeros(I,m.length)},R:function(d,m){const g=getISOWeekYear(d);return addLeadingZeros(g,m.length)},u:function(d,m){const g=d.getFullYear();return addLeadingZeros(g,m.length)},Q:function(d,m,g){const w=Math.ceil((d.getMonth()+1)/3);switch(m){case"Q":return String(w);case"QQ":return addLeadingZeros(w,2);case"Qo":return g.ordinalNumber(w,{unit:"quarter"});case"QQQ":return g.quarter(w,{width:"abbreviated",context:"formatting"});case"QQQQQ":return g.quarter(w,{width:"narrow",context:"formatting"});case"QQQQ":default:return g.quarter(w,{width:"wide",context:"formatting"})}},q:function(d,m,g){const w=Math.ceil((d.getMonth()+1)/3);switch(m){case"q":return String(w);case"qq":return addLeadingZeros(w,2);case"qo":return g.ordinalNumber(w,{unit:"quarter"});case"qqq":return g.quarter(w,{width:"abbreviated",context:"standalone"});case"qqqqq":return g.quarter(w,{width:"narrow",context:"standalone"});case"qqqq":default:return g.quarter(w,{width:"wide",context:"standalone"})}},M:function(d,m,g){const w=d.getMonth();switch(m){case"M":case"MM":return lightFormatters.M(d,m);case"Mo":return g.ordinalNumber(w+1,{unit:"month"});case"MMM":return g.month(w,{width:"abbreviated",context:"formatting"});case"MMMMM":return g.month(w,{width:"narrow",context:"formatting"});case"MMMM":default:return g.month(w,{width:"wide",context:"formatting"})}},L:function(d,m,g){const w=d.getMonth();switch(m){case"L":return String(w+1);case"LL":return addLeadingZeros(w+1,2);case"Lo":return g.ordinalNumber(w+1,{unit:"month"});case"LLL":return g.month(w,{width:"abbreviated",context:"standalone"});case"LLLLL":return g.month(w,{width:"narrow",context:"standalone"});case"LLLL":default:return g.month(w,{width:"wide",context:"standalone"})}},w:function(d,m,g,w){const $=getWeek(d,w);return m==="wo"?g.ordinalNumber($,{unit:"week"}):addLeadingZeros($,m.length)},I:function(d,m,g){const w=getISOWeek(d);return m==="Io"?g.ordinalNumber(w,{unit:"week"}):addLeadingZeros(w,m.length)},d:function(d,m,g){return m==="do"?g.ordinalNumber(d.getDate(),{unit:"date"}):lightFormatters.d(d,m)},D:function(d,m,g){const w=getDayOfYear(d);return m==="Do"?g.ordinalNumber(w,{unit:"dayOfYear"}):addLeadingZeros(w,m.length)},E:function(d,m,g){const w=d.getDay();switch(m){case"E":case"EE":case"EEE":return g.day(w,{width:"abbreviated",context:"formatting"});case"EEEEE":return g.day(w,{width:"narrow",context:"formatting"});case"EEEEEE":return g.day(w,{width:"short",context:"formatting"});case"EEEE":default:return g.day(w,{width:"wide",context:"formatting"})}},e:function(d,m,g,w){const $=d.getDay(),I=($-w.weekStartsOn+8)%7||7;switch(m){case"e":return String(I);case"ee":return addLeadingZeros(I,2);case"eo":return g.ordinalNumber(I,{unit:"day"});case"eee":return g.day($,{width:"abbreviated",context:"formatting"});case"eeeee":return g.day($,{width:"narrow",context:"formatting"});case"eeeeee":return g.day($,{width:"short",context:"formatting"});case"eeee":default:return g.day($,{width:"wide",context:"formatting"})}},c:function(d,m,g,w){const $=d.getDay(),I=($-w.weekStartsOn+8)%7||7;switch(m){case"c":return String(I);case"cc":return addLeadingZeros(I,m.length);case"co":return g.ordinalNumber(I,{unit:"day"});case"ccc":return g.day($,{width:"abbreviated",context:"standalone"});case"ccccc":return g.day($,{width:"narrow",context:"standalone"});case"cccccc":return g.day($,{width:"short",context:"standalone"});case"cccc":default:return g.day($,{width:"wide",context:"standalone"})}},i:function(d,m,g){const w=d.getDay(),$=w===0?7:w;switch(m){case"i":return String($);case"ii":return addLeadingZeros($,m.length);case"io":return g.ordinalNumber($,{unit:"day"});case"iii":return g.day(w,{width:"abbreviated",context:"formatting"});case"iiiii":return g.day(w,{width:"narrow",context:"formatting"});case"iiiiii":return g.day(w,{width:"short",context:"formatting"});case"iiii":default:return g.day(w,{width:"wide",context:"formatting"})}},a:function(d,m,g){const $=d.getHours()/12>=1?"pm":"am";switch(m){case"a":case"aa":return g.dayPeriod($,{width:"abbreviated",context:"formatting"});case"aaa":return g.dayPeriod($,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return g.dayPeriod($,{width:"narrow",context:"formatting"});case"aaaa":default:return g.dayPeriod($,{width:"wide",context:"formatting"})}},b:function(d,m,g){const w=d.getHours();let $;switch(w===12?$=dayPeriodEnum.noon:w===0?$=dayPeriodEnum.midnight:$=w/12>=1?"pm":"am",m){case"b":case"bb":return g.dayPeriod($,{width:"abbreviated",context:"formatting"});case"bbb":return g.dayPeriod($,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return g.dayPeriod($,{width:"narrow",context:"formatting"});case"bbbb":default:return g.dayPeriod($,{width:"wide",context:"formatting"})}},B:function(d,m,g){const w=d.getHours();let $;switch(w>=17?$=dayPeriodEnum.evening:w>=12?$=dayPeriodEnum.afternoon:w>=4?$=dayPeriodEnum.morning:$=dayPeriodEnum.night,m){case"B":case"BB":case"BBB":return g.dayPeriod($,{width:"abbreviated",context:"formatting"});case"BBBBB":return g.dayPeriod($,{width:"narrow",context:"formatting"});case"BBBB":default:return g.dayPeriod($,{width:"wide",context:"formatting"})}},h:function(d,m,g){if(m==="ho"){let w=d.getHours()%12;return w===0&&(w=12),g.ordinalNumber(w,{unit:"hour"})}return lightFormatters.h(d,m)},H:function(d,m,g){return m==="Ho"?g.ordinalNumber(d.getHours(),{unit:"hour"}):lightFormatters.H(d,m)},K:function(d,m,g){const w=d.getHours()%12;return m==="Ko"?g.ordinalNumber(w,{unit:"hour"}):addLeadingZeros(w,m.length)},k:function(d,m,g){let w=d.getHours();return w===0&&(w=24),m==="ko"?g.ordinalNumber(w,{unit:"hour"}):addLeadingZeros(w,m.length)},m:function(d,m,g){return m==="mo"?g.ordinalNumber(d.getMinutes(),{unit:"minute"}):lightFormatters.m(d,m)},s:function(d,m,g){return m==="so"?g.ordinalNumber(d.getSeconds(),{unit:"second"}):lightFormatters.s(d,m)},S:function(d,m){return lightFormatters.S(d,m)},X:function(d,m,g){const w=d.getTimezoneOffset();if(w===0)return"Z";switch(m){case"X":return formatTimezoneWithOptionalMinutes(w);case"XXXX":case"XX":return formatTimezone(w);case"XXXXX":case"XXX":default:return formatTimezone(w,":")}},x:function(d,m,g){const w=d.getTimezoneOffset();switch(m){case"x":return formatTimezoneWithOptionalMinutes(w);case"xxxx":case"xx":return formatTimezone(w);case"xxxxx":case"xxx":default:return formatTimezone(w,":")}},O:function(d,m,g){const w=d.getTimezoneOffset();switch(m){case"O":case"OO":case"OOO":return"GMT"+formatTimezoneShort(w,":");case"OOOO":default:return"GMT"+formatTimezone(w,":")}},z:function(d,m,g){const w=d.getTimezoneOffset();switch(m){case"z":case"zz":case"zzz":return"GMT"+formatTimezoneShort(w,":");case"zzzz":default:return"GMT"+formatTimezone(w,":")}},t:function(d,m,g){const w=Math.trunc(+d/1e3);return addLeadingZeros(w,m.length)},T:function(d,m,g){return addLeadingZeros(+d,m.length)}};function formatTimezoneShort(d,m=""){const g=d>0?"-":"+",w=Math.abs(d),$=Math.trunc(w/60),I=w%60;return I===0?g+String($):g+String($)+m+addLeadingZeros(I,2)}function formatTimezoneWithOptionalMinutes(d,m){return d%60===0?(d>0?"-":"+")+addLeadingZeros(Math.abs(d)/60,2):formatTimezone(d,m)}function formatTimezone(d,m=""){const g=d>0?"-":"+",w=Math.abs(d),$=addLeadingZeros(Math.trunc(w/60),2),I=addLeadingZeros(w%60,2);return g+$+m+I}const dateLongFormatter=(d,m)=>{switch(d){case"P":return m.date({width:"short"});case"PP":return m.date({width:"medium"});case"PPP":return m.date({width:"long"});case"PPPP":default:return m.date({width:"full"})}},timeLongFormatter=(d,m)=>{switch(d){case"p":return m.time({width:"short"});case"pp":return m.time({width:"medium"});case"ppp":return m.time({width:"long"});case"pppp":default:return m.time({width:"full"})}},dateTimeLongFormatter=(d,m)=>{const g=d.match(/(P+)(p+)?/)||[],w=g[1],$=g[2];if(!$)return dateLongFormatter(d,m);let I;switch(w){case"P":I=m.dateTime({width:"short"});break;case"PP":I=m.dateTime({width:"medium"});break;case"PPP":I=m.dateTime({width:"long"});break;case"PPPP":default:I=m.dateTime({width:"full"});break}return I.replace("{{date}}",dateLongFormatter(w,m)).replace("{{time}}",timeLongFormatter($,m))},longFormatters={p:timeLongFormatter,P:dateTimeLongFormatter},dayOfYearTokenRE=/^D+$/,weekYearTokenRE=/^Y+$/,throwTokens=["D","DD","YY","YYYY"];function isProtectedDayOfYearToken(d){return dayOfYearTokenRE.test(d)}function isProtectedWeekYearToken(d){return weekYearTokenRE.test(d)}function warnOrThrowProtectedError(d,m,g){const w=message(d,m,g);if(console.warn(w),throwTokens.includes(d))throw new RangeError(w)}function message(d,m,g){const w=d[0]==="Y"?"years":"days of the month";return`Use \`${d.toLowerCase()}\` instead of \`${d}\` (in \`${m}\`) for formatting ${w} to the input \`${g}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const formattingTokensRegExp$1=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,longFormattingTokensRegExp$1=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,escapedStringRegExp$1=/^'([^]*?)'?$/,doubleQuoteRegExp$1=/''/g,unescapedLatinCharacterRegExp$1=/[a-zA-Z]/;function format(d,m,g){const w=getDefaultOptions$1(),$=w.locale??enUS,I=w.firstWeekContainsDate??w.locale?.options?.firstWeekContainsDate??1,D=w.weekStartsOn??w.locale?.options?.weekStartsOn??0,q=toDate(d,g?.in);if(!isValid$1(q))throw new RangeError("Invalid time value");let j=m.match(longFormattingTokensRegExp$1).map(H=>{const W=H[0];if(W==="p"||W==="P"){const V=longFormatters[W];return V(H,$.formatLong)}return H}).join("").match(formattingTokensRegExp$1).map(H=>{if(H==="''")return{isToken:!1,value:"'"};const W=H[0];if(W==="'")return{isToken:!1,value:cleanEscapedString$1(H)};if(formatters[W])return{isToken:!0,value:H};if(W.match(unescapedLatinCharacterRegExp$1))throw new RangeError("Format string contains an unescaped latin alphabet character `"+W+"`");return{isToken:!1,value:H}});$.localize.preprocessor&&(j=$.localize.preprocessor(q,j));const G={firstWeekContainsDate:I,weekStartsOn:D,locale:$};return j.map(H=>{if(!H.isToken)return H.value;const W=H.value;(isProtectedWeekYearToken(W)||isProtectedDayOfYearToken(W))&&warnOrThrowProtectedError(W,m,String(d));const V=formatters[W[0]];return V(q,W,$.localize,G)}).join("")}function cleanEscapedString$1(d){const m=d.match(escapedStringRegExp$1);return m?m[1].replace(doubleQuoteRegExp$1,"'"):d}function getDefaultOptions(){return Object.assign({},getDefaultOptions$1())}function getISODay(d,m){const g=toDate(d,m?.in).getDay();return g===0?7:g}function transpose(d,m){const g=isConstructor(m)?new m(0):constructFrom(m,0);return g.setFullYear(d.getFullYear(),d.getMonth(),d.getDate()),g.setHours(d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()),g}function isConstructor(d){return typeof d=="function"&&d.prototype?.constructor===d}const TIMEZONE_UNIT_PRIORITY=10;class Setter{subPriority=0;validate(m,g){return!0}}class ValueSetter extends Setter{constructor(m,g,w,$,I){super(),this.value=m,this.validateValue=g,this.setValue=w,this.priority=$,I&&(this.subPriority=I)}validate(m,g){return this.validateValue(m,this.value,g)}set(m,g,w){return this.setValue(m,g,this.value,w)}}class DateTimezoneSetter extends Setter{priority=TIMEZONE_UNIT_PRIORITY;subPriority=-1;constructor(m,g){super(),this.context=m||(w=>constructFrom(g,w))}set(m,g){return g.timestampIsSet?m:constructFrom(m,transpose(m,this.context))}}let Parser$3=class{run(m,g,w,$){const I=this.parse(m,g,w,$);return I?{setter:new ValueSetter(I.value,this.validate,this.set,this.priority,this.subPriority),rest:I.rest}:null}validate(m,g,w){return!0}};class EraParser extends Parser$3{priority=140;parse(m,g,w){switch(g){case"G":case"GG":case"GGG":return w.era(m,{width:"abbreviated"})||w.era(m,{width:"narrow"});case"GGGGG":return w.era(m,{width:"narrow"});case"GGGG":default:return w.era(m,{width:"wide"})||w.era(m,{width:"abbreviated"})||w.era(m,{width:"narrow"})}}set(m,g,w){return g.era=w,m.setFullYear(w,0,1),m.setHours(0,0,0,0),m}incompatibleTokens=["R","u","t","T"]}const numericPatterns={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},timezonePatterns={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function mapValue(d,m){return d&&{value:m(d.value),rest:d.rest}}function parseNumericPattern(d,m){const g=m.match(d);return g?{value:parseInt(g[0],10),rest:m.slice(g[0].length)}:null}function parseTimezonePattern(d,m){const g=m.match(d);if(!g)return null;if(g[0]==="Z")return{value:0,rest:m.slice(1)};const w=g[1]==="+"?1:-1,$=g[2]?parseInt(g[2],10):0,I=g[3]?parseInt(g[3],10):0,D=g[5]?parseInt(g[5],10):0;return{value:w*($*millisecondsInHour+I*millisecondsInMinute+D*millisecondsInSecond),rest:m.slice(g[0].length)}}function parseAnyDigitsSigned(d){return parseNumericPattern(numericPatterns.anyDigitsSigned,d)}function parseNDigits(d,m){switch(d){case 1:return parseNumericPattern(numericPatterns.singleDigit,m);case 2:return parseNumericPattern(numericPatterns.twoDigits,m);case 3:return parseNumericPattern(numericPatterns.threeDigits,m);case 4:return parseNumericPattern(numericPatterns.fourDigits,m);default:return parseNumericPattern(new RegExp("^\\d{1,"+d+"}"),m)}}function parseNDigitsSigned(d,m){switch(d){case 1:return parseNumericPattern(numericPatterns.singleDigitSigned,m);case 2:return parseNumericPattern(numericPatterns.twoDigitsSigned,m);case 3:return parseNumericPattern(numericPatterns.threeDigitsSigned,m);case 4:return parseNumericPattern(numericPatterns.fourDigitsSigned,m);default:return parseNumericPattern(new RegExp("^-?\\d{1,"+d+"}"),m)}}function dayPeriodEnumToHours(d){switch(d){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function normalizeTwoDigitYear(d,m){const g=m>0,w=g?m:1-m;let $;if(w<=50)$=d||100;else{const I=w+50,D=Math.trunc(I/100)*100,q=d>=I%100;$=d+D-(q?100:0)}return g?$:1-$}function isLeapYearIndex(d){return d%400===0||d%4===0&&d%100!==0}class YearParser extends Parser$3{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(m,g,w){const $=I=>({year:I,isTwoDigitYear:g==="yy"});switch(g){case"y":return mapValue(parseNDigits(4,m),$);case"yo":return mapValue(w.ordinalNumber(m,{unit:"year"}),$);default:return mapValue(parseNDigits(g.length,m),$)}}validate(m,g){return g.isTwoDigitYear||g.year>0}set(m,g,w){const $=m.getFullYear();if(w.isTwoDigitYear){const D=normalizeTwoDigitYear(w.year,$);return m.setFullYear(D,0,1),m.setHours(0,0,0,0),m}const I=!("era"in g)||g.era===1?w.year:1-w.year;return m.setFullYear(I,0,1),m.setHours(0,0,0,0),m}}class LocalWeekYearParser extends Parser$3{priority=130;parse(m,g,w){const $=I=>({year:I,isTwoDigitYear:g==="YY"});switch(g){case"Y":return mapValue(parseNDigits(4,m),$);case"Yo":return mapValue(w.ordinalNumber(m,{unit:"year"}),$);default:return mapValue(parseNDigits(g.length,m),$)}}validate(m,g){return g.isTwoDigitYear||g.year>0}set(m,g,w,$){const I=getWeekYear(m,$);if(w.isTwoDigitYear){const q=normalizeTwoDigitYear(w.year,I);return m.setFullYear(q,0,$.firstWeekContainsDate),m.setHours(0,0,0,0),startOfWeek(m,$)}const D=!("era"in g)||g.era===1?w.year:1-w.year;return m.setFullYear(D,0,$.firstWeekContainsDate),m.setHours(0,0,0,0),startOfWeek(m,$)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]}class ISOWeekYearParser extends Parser$3{priority=130;parse(m,g){return parseNDigitsSigned(g==="R"?4:g.length,m)}set(m,g,w){const $=constructFrom(m,0);return $.setFullYear(w,0,4),$.setHours(0,0,0,0),startOfISOWeek($)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]}class ExtendedYearParser extends Parser$3{priority=130;parse(m,g){return parseNDigitsSigned(g==="u"?4:g.length,m)}set(m,g,w){return m.setFullYear(w,0,1),m.setHours(0,0,0,0),m}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]}class QuarterParser extends Parser$3{priority=120;parse(m,g,w){switch(g){case"Q":case"QQ":return parseNDigits(g.length,m);case"Qo":return w.ordinalNumber(m,{unit:"quarter"});case"QQQ":return w.quarter(m,{width:"abbreviated",context:"formatting"})||w.quarter(m,{width:"narrow",context:"formatting"});case"QQQQQ":return w.quarter(m,{width:"narrow",context:"formatting"});case"QQQQ":default:return w.quarter(m,{width:"wide",context:"formatting"})||w.quarter(m,{width:"abbreviated",context:"formatting"})||w.quarter(m,{width:"narrow",context:"formatting"})}}validate(m,g){return g>=1&&g<=4}set(m,g,w){return m.setMonth((w-1)*3,1),m.setHours(0,0,0,0),m}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]}class StandAloneQuarterParser extends Parser$3{priority=120;parse(m,g,w){switch(g){case"q":case"qq":return parseNDigits(g.length,m);case"qo":return w.ordinalNumber(m,{unit:"quarter"});case"qqq":return w.quarter(m,{width:"abbreviated",context:"standalone"})||w.quarter(m,{width:"narrow",context:"standalone"});case"qqqqq":return w.quarter(m,{width:"narrow",context:"standalone"});case"qqqq":default:return w.quarter(m,{width:"wide",context:"standalone"})||w.quarter(m,{width:"abbreviated",context:"standalone"})||w.quarter(m,{width:"narrow",context:"standalone"})}}validate(m,g){return g>=1&&g<=4}set(m,g,w){return m.setMonth((w-1)*3,1),m.setHours(0,0,0,0),m}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]}class MonthParser extends Parser$3{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(m,g,w){const $=I=>I-1;switch(g){case"M":return mapValue(parseNumericPattern(numericPatterns.month,m),$);case"MM":return mapValue(parseNDigits(2,m),$);case"Mo":return mapValue(w.ordinalNumber(m,{unit:"month"}),$);case"MMM":return w.month(m,{width:"abbreviated",context:"formatting"})||w.month(m,{width:"narrow",context:"formatting"});case"MMMMM":return w.month(m,{width:"narrow",context:"formatting"});case"MMMM":default:return w.month(m,{width:"wide",context:"formatting"})||w.month(m,{width:"abbreviated",context:"formatting"})||w.month(m,{width:"narrow",context:"formatting"})}}validate(m,g){return g>=0&&g<=11}set(m,g,w){return m.setMonth(w,1),m.setHours(0,0,0,0),m}}class StandAloneMonthParser extends Parser$3{priority=110;parse(m,g,w){const $=I=>I-1;switch(g){case"L":return mapValue(parseNumericPattern(numericPatterns.month,m),$);case"LL":return mapValue(parseNDigits(2,m),$);case"Lo":return mapValue(w.ordinalNumber(m,{unit:"month"}),$);case"LLL":return w.month(m,{width:"abbreviated",context:"standalone"})||w.month(m,{width:"narrow",context:"standalone"});case"LLLLL":return w.month(m,{width:"narrow",context:"standalone"});case"LLLL":default:return w.month(m,{width:"wide",context:"standalone"})||w.month(m,{width:"abbreviated",context:"standalone"})||w.month(m,{width:"narrow",context:"standalone"})}}validate(m,g){return g>=0&&g<=11}set(m,g,w){return m.setMonth(w,1),m.setHours(0,0,0,0),m}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]}function setWeek(d,m,g){const w=toDate(d,g?.in),$=getWeek(w,g)-m;return w.setDate(w.getDate()-$*7),toDate(w,g?.in)}class LocalWeekParser extends Parser$3{priority=100;parse(m,g,w){switch(g){case"w":return parseNumericPattern(numericPatterns.week,m);case"wo":return w.ordinalNumber(m,{unit:"week"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=1&&g<=53}set(m,g,w,$){return startOfWeek(setWeek(m,w,$),$)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]}function setISOWeek(d,m,g){const w=toDate(d,g?.in),$=getISOWeek(w,g)-m;return w.setDate(w.getDate()-$*7),w}class ISOWeekParser extends Parser$3{priority=100;parse(m,g,w){switch(g){case"I":return parseNumericPattern(numericPatterns.week,m);case"Io":return w.ordinalNumber(m,{unit:"week"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=1&&g<=53}set(m,g,w){return startOfISOWeek(setISOWeek(m,w))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]}const DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],DAYS_IN_MONTH_LEAP_YEAR=[31,29,31,30,31,30,31,31,30,31,30,31];class DateParser extends Parser$3{priority=90;subPriority=1;parse(m,g,w){switch(g){case"d":return parseNumericPattern(numericPatterns.date,m);case"do":return w.ordinalNumber(m,{unit:"date"});default:return parseNDigits(g.length,m)}}validate(m,g){const w=m.getFullYear(),$=isLeapYearIndex(w),I=m.getMonth();return $?g>=1&&g<=DAYS_IN_MONTH_LEAP_YEAR[I]:g>=1&&g<=DAYS_IN_MONTH[I]}set(m,g,w){return m.setDate(w),m.setHours(0,0,0,0),m}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]}class DayOfYearParser extends Parser$3{priority=90;subpriority=1;parse(m,g,w){switch(g){case"D":case"DD":return parseNumericPattern(numericPatterns.dayOfYear,m);case"Do":return w.ordinalNumber(m,{unit:"date"});default:return parseNDigits(g.length,m)}}validate(m,g){const w=m.getFullYear();return isLeapYearIndex(w)?g>=1&&g<=366:g>=1&&g<=365}set(m,g,w){return m.setMonth(0,w),m.setHours(0,0,0,0),m}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]}function setDay(d,m,g){const w=getDefaultOptions$1(),$=g?.weekStartsOn??g?.locale?.options?.weekStartsOn??w.weekStartsOn??w.locale?.options?.weekStartsOn??0,I=toDate(d,g?.in),D=I.getDay(),j=(m%7+7)%7,G=7-$,H=m<0||m>6?m-(D+G)%7:(j+G)%7-(D+G)%7;return addDays(I,H,g)}class DayParser extends Parser$3{priority=90;parse(m,g,w){switch(g){case"E":case"EE":case"EEE":return w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"});case"EEEEE":return w.day(m,{width:"narrow",context:"formatting"});case"EEEEEE":return w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"});case"EEEE":default:return w.day(m,{width:"wide",context:"formatting"})||w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"})}}validate(m,g){return g>=0&&g<=6}set(m,g,w,$){return m=setDay(m,w,$),m.setHours(0,0,0,0),m}incompatibleTokens=["D","i","e","c","t","T"]}class LocalDayParser extends Parser$3{priority=90;parse(m,g,w,$){const I=D=>{const q=Math.floor((D-1)/7)*7;return(D+$.weekStartsOn+6)%7+q};switch(g){case"e":case"ee":return mapValue(parseNDigits(g.length,m),I);case"eo":return mapValue(w.ordinalNumber(m,{unit:"day"}),I);case"eee":return w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"});case"eeeee":return w.day(m,{width:"narrow",context:"formatting"});case"eeeeee":return w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"});case"eeee":default:return w.day(m,{width:"wide",context:"formatting"})||w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"})}}validate(m,g){return g>=0&&g<=6}set(m,g,w,$){return m=setDay(m,w,$),m.setHours(0,0,0,0),m}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]}class StandAloneLocalDayParser extends Parser$3{priority=90;parse(m,g,w,$){const I=D=>{const q=Math.floor((D-1)/7)*7;return(D+$.weekStartsOn+6)%7+q};switch(g){case"c":case"cc":return mapValue(parseNDigits(g.length,m),I);case"co":return mapValue(w.ordinalNumber(m,{unit:"day"}),I);case"ccc":return w.day(m,{width:"abbreviated",context:"standalone"})||w.day(m,{width:"short",context:"standalone"})||w.day(m,{width:"narrow",context:"standalone"});case"ccccc":return w.day(m,{width:"narrow",context:"standalone"});case"cccccc":return w.day(m,{width:"short",context:"standalone"})||w.day(m,{width:"narrow",context:"standalone"});case"cccc":default:return w.day(m,{width:"wide",context:"standalone"})||w.day(m,{width:"abbreviated",context:"standalone"})||w.day(m,{width:"short",context:"standalone"})||w.day(m,{width:"narrow",context:"standalone"})}}validate(m,g){return g>=0&&g<=6}set(m,g,w,$){return m=setDay(m,w,$),m.setHours(0,0,0,0),m}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]}function setISODay(d,m,g){const w=toDate(d,g?.in),$=getISODay(w,g),I=m-$;return addDays(w,I,g)}class ISODayParser extends Parser$3{priority=90;parse(m,g,w){const $=I=>I===0?7:I;switch(g){case"i":case"ii":return parseNDigits(g.length,m);case"io":return w.ordinalNumber(m,{unit:"day"});case"iii":return mapValue(w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"}),$);case"iiiii":return mapValue(w.day(m,{width:"narrow",context:"formatting"}),$);case"iiiiii":return mapValue(w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"}),$);case"iiii":default:return mapValue(w.day(m,{width:"wide",context:"formatting"})||w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"}),$)}}validate(m,g){return g>=1&&g<=7}set(m,g,w){return m=setISODay(m,w),m.setHours(0,0,0,0),m}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]}class AMPMParser extends Parser$3{priority=80;parse(m,g,w){switch(g){case"a":case"aa":case"aaa":return w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"});case"aaaaa":return w.dayPeriod(m,{width:"narrow",context:"formatting"});case"aaaa":default:return w.dayPeriod(m,{width:"wide",context:"formatting"})||w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"})}}set(m,g,w){return m.setHours(dayPeriodEnumToHours(w),0,0,0),m}incompatibleTokens=["b","B","H","k","t","T"]}class AMPMMidnightParser extends Parser$3{priority=80;parse(m,g,w){switch(g){case"b":case"bb":case"bbb":return w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"});case"bbbbb":return w.dayPeriod(m,{width:"narrow",context:"formatting"});case"bbbb":default:return w.dayPeriod(m,{width:"wide",context:"formatting"})||w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"})}}set(m,g,w){return m.setHours(dayPeriodEnumToHours(w),0,0,0),m}incompatibleTokens=["a","B","H","k","t","T"]}class DayPeriodParser extends Parser$3{priority=80;parse(m,g,w){switch(g){case"B":case"BB":case"BBB":return w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"});case"BBBBB":return w.dayPeriod(m,{width:"narrow",context:"formatting"});case"BBBB":default:return w.dayPeriod(m,{width:"wide",context:"formatting"})||w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"})}}set(m,g,w){return m.setHours(dayPeriodEnumToHours(w),0,0,0),m}incompatibleTokens=["a","b","t","T"]}class Hour1to12Parser extends Parser$3{priority=70;parse(m,g,w){switch(g){case"h":return parseNumericPattern(numericPatterns.hour12h,m);case"ho":return w.ordinalNumber(m,{unit:"hour"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=1&&g<=12}set(m,g,w){const $=m.getHours()>=12;return $&&w<12?m.setHours(w+12,0,0,0):!$&&w===12?m.setHours(0,0,0,0):m.setHours(w,0,0,0),m}incompatibleTokens=["H","K","k","t","T"]}class Hour0to23Parser extends Parser$3{priority=70;parse(m,g,w){switch(g){case"H":return parseNumericPattern(numericPatterns.hour23h,m);case"Ho":return w.ordinalNumber(m,{unit:"hour"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=0&&g<=23}set(m,g,w){return m.setHours(w,0,0,0),m}incompatibleTokens=["a","b","h","K","k","t","T"]}class Hour0To11Parser extends Parser$3{priority=70;parse(m,g,w){switch(g){case"K":return parseNumericPattern(numericPatterns.hour11h,m);case"Ko":return w.ordinalNumber(m,{unit:"hour"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=0&&g<=11}set(m,g,w){return m.getHours()>=12&&w<12?m.setHours(w+12,0,0,0):m.setHours(w,0,0,0),m}incompatibleTokens=["h","H","k","t","T"]}class Hour1To24Parser extends Parser$3{priority=70;parse(m,g,w){switch(g){case"k":return parseNumericPattern(numericPatterns.hour24h,m);case"ko":return w.ordinalNumber(m,{unit:"hour"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=1&&g<=24}set(m,g,w){const $=w<=24?w%24:w;return m.setHours($,0,0,0),m}incompatibleTokens=["a","b","h","H","K","t","T"]}class MinuteParser extends Parser$3{priority=60;parse(m,g,w){switch(g){case"m":return parseNumericPattern(numericPatterns.minute,m);case"mo":return w.ordinalNumber(m,{unit:"minute"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=0&&g<=59}set(m,g,w){return m.setMinutes(w,0,0),m}incompatibleTokens=["t","T"]}class SecondParser extends Parser$3{priority=50;parse(m,g,w){switch(g){case"s":return parseNumericPattern(numericPatterns.second,m);case"so":return w.ordinalNumber(m,{unit:"second"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=0&&g<=59}set(m,g,w){return m.setSeconds(w,0),m}incompatibleTokens=["t","T"]}class FractionOfSecondParser extends Parser$3{priority=30;parse(m,g){const w=$=>Math.trunc($*Math.pow(10,-g.length+3));return mapValue(parseNDigits(g.length,m),w)}set(m,g,w){return m.setMilliseconds(w),m}incompatibleTokens=["t","T"]}class ISOTimezoneWithZParser extends Parser$3{priority=10;parse(m,g){switch(g){case"X":return parseTimezonePattern(timezonePatterns.basicOptionalMinutes,m);case"XX":return parseTimezonePattern(timezonePatterns.basic,m);case"XXXX":return parseTimezonePattern(timezonePatterns.basicOptionalSeconds,m);case"XXXXX":return parseTimezonePattern(timezonePatterns.extendedOptionalSeconds,m);case"XXX":default:return parseTimezonePattern(timezonePatterns.extended,m)}}set(m,g,w){return g.timestampIsSet?m:constructFrom(m,m.getTime()-getTimezoneOffsetInMilliseconds(m)-w)}incompatibleTokens=["t","T","x"]}class ISOTimezoneParser extends Parser$3{priority=10;parse(m,g){switch(g){case"x":return parseTimezonePattern(timezonePatterns.basicOptionalMinutes,m);case"xx":return parseTimezonePattern(timezonePatterns.basic,m);case"xxxx":return parseTimezonePattern(timezonePatterns.basicOptionalSeconds,m);case"xxxxx":return parseTimezonePattern(timezonePatterns.extendedOptionalSeconds,m);case"xxx":default:return parseTimezonePattern(timezonePatterns.extended,m)}}set(m,g,w){return g.timestampIsSet?m:constructFrom(m,m.getTime()-getTimezoneOffsetInMilliseconds(m)-w)}incompatibleTokens=["t","T","X"]}class TimestampSecondsParser extends Parser$3{priority=40;parse(m){return parseAnyDigitsSigned(m)}set(m,g,w){return[constructFrom(m,w*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"}class TimestampMillisecondsParser extends Parser$3{priority=20;parse(m){return parseAnyDigitsSigned(m)}set(m,g,w){return[constructFrom(m,w),{timestampIsSet:!0}]}incompatibleTokens="*"}const parsers={G:new EraParser,y:new YearParser,Y:new LocalWeekYearParser,R:new ISOWeekYearParser,u:new ExtendedYearParser,Q:new QuarterParser,q:new StandAloneQuarterParser,M:new MonthParser,L:new StandAloneMonthParser,w:new LocalWeekParser,I:new ISOWeekParser,d:new DateParser,D:new DayOfYearParser,E:new DayParser,e:new LocalDayParser,c:new StandAloneLocalDayParser,i:new ISODayParser,a:new AMPMParser,b:new AMPMMidnightParser,B:new DayPeriodParser,h:new Hour1to12Parser,H:new Hour0to23Parser,K:new Hour0To11Parser,k:new Hour1To24Parser,m:new MinuteParser,s:new SecondParser,S:new FractionOfSecondParser,X:new ISOTimezoneWithZParser,x:new ISOTimezoneParser,t:new TimestampSecondsParser,T:new TimestampMillisecondsParser},formattingTokensRegExp=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,longFormattingTokensRegExp=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,escapedStringRegExp=/^'([^]*?)'?$/,doubleQuoteRegExp=/''/g,notWhitespaceRegExp=/\S/,unescapedLatinCharacterRegExp=/[a-zA-Z]/;function parse$2(d,m,g,w){const $=()=>constructFrom(g,NaN),I=getDefaultOptions(),D=I.locale??enUS,q=I.firstWeekContainsDate??I.locale?.options?.firstWeekContainsDate??1,j=I.weekStartsOn??I.locale?.options?.weekStartsOn??0;if(!m)return d?$():toDate(g,w?.in);const G={firstWeekContainsDate:q,weekStartsOn:j,locale:D},H=[new DateTimezoneSetter(w?.in,g)],W=m.match(longFormattingTokensRegExp).map(J=>{const re=J[0];if(re in longFormatters){const se=longFormatters[re];return se(J,D.formatLong)}return J}).join("").match(formattingTokensRegExp),V=[];for(let J of W){isProtectedWeekYearToken(J)&&warnOrThrowProtectedError(J,m,d),isProtectedDayOfYearToken(J)&&warnOrThrowProtectedError(J,m,d);const re=J[0],se=parsers[re];if(se){const{incompatibleTokens:oe}=se;if(Array.isArray(oe)){const ae=V.find(ce=>oe.includes(ce.token)||ce.token===re);if(ae)throw new RangeError(`The format string mustn't contain \`${ae.fullToken}\` and \`${J}\` at the same time`)}else if(se.incompatibleTokens==="*"&&V.length>0)throw new RangeError(`The format string mustn't contain \`${J}\` and any other token at the same time`);V.push({token:re,fullToken:J});const ee=se.run(d,J,D.match,G);if(!ee)return $();H.push(ee.setter),d=ee.rest}else{if(re.match(unescapedLatinCharacterRegExp))throw new RangeError("Format string contains an unescaped latin alphabet character `"+re+"`");if(J==="''"?J="'":re==="'"&&(J=cleanEscapedString(J)),d.indexOf(J)===0)d=d.slice(J.length);else return $()}}if(d.length>0&&notWhitespaceRegExp.test(d))return $();const K=H.map(J=>J.priority).sort((J,re)=>re-J).filter((J,re,se)=>se.indexOf(J)===re).map(J=>H.filter(re=>re.priority===J).sort((re,se)=>se.subPriority-re.subPriority)).map(J=>J[0]);let Z=toDate(g,w?.in);if(isNaN(+Z))return $();const Q={};for(const J of K){if(!J.validate(Z,G))return $();const re=J.set(Z,Q,G);Array.isArray(re)?(Z=re[0],Object.assign(Q,re[1])):Z=re}return Z}function cleanEscapedString(d){return d.match(escapedStringRegExp)[1].replace(doubleQuoteRegExp,"'")}function minutesToMilliseconds(d){return Math.trunc(d*millisecondsInMinute)}function parseISOSafe(d){return tryParse(d,"yyyy-MM-dd","yyyy-MM-dd'T'HH:mm:ss","yyyy-MM-dd'T'HH:mm:ssXXX")}function tryParse(d,...m){for(const g of m)try{const w=parse$2(d,g,new Date);if(isValid$1(w))return w}catch{continue}}const EXIF_REGULAR_FIELDS={InteropIndex:1,InteropVersion:2,ProcessingSoftware:11,SubfileType:254,OldSubfileType:255,ImageWidth:256,ImageHeight:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Thresholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,MinSampleValue:280,MaxSampleValue:281,XResolution:282,YResolution:283,PlanarConfiguration:284,PageName:285,XPosition:286,YPosition:287,FreeOffsets:288,FreeByteCounts:289,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,PageNumber:297,ColorResponseUnit:300,TransferFunction:301,Software:305,ModifyDate:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,BadFaxLines:326,CleanFaxData:327,ConsecutiveBadFaxLines:328,SubIFD:330,InkSet:332,InkNames:333,NumberofInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,GlobalParametersIFD:400,ProfileType:401,FaxProfile:402,CodingMethods:403,VersionYear:404,ModeNumber:405,Decode:433,DefaultImageColor:434,T82Options:435,JPEGProc:512,ThumbnailOffset:513,ThumbnailLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,StripRowCounts:559,ApplicationNotes:700,USPTOMiscellaneous:999,RelatedImageFileFormat:4096,RelatedImageWidth:4097,RelatedImageHeight:4098,Rating:18246,XP_DIP_XML:18247,StitchInfo:18248,RatingPercent:18249,ImageID:32781,WangTag1:32931,WangAnnotation:32932,WangTag3:32933,WangTag4:32934,Matteing:32995,DataType:32996,ImageDepth:32997,TileDepth:32998,Model2:33405,CFARepeatPatternDim:33421,CFAPattern2:33422,BatteryLevel:33423,KodakIFD:33424,Copyright:33432,ExposureTime:33434,FNumber:33437,MDFileTag:33445,MDScalePixel:33446,MDColorTable:33447,MDLabName:33448,MDSampleInfo:33449,MDPrepDate:33450,MDPrepTime:33451,MDFileUnits:33452,PixelScale:33550,AdventScale:33589,AdventRevision:33590,UIC1Tag:33628,UIC2Tag:33629,UIC3Tag:33630,UIC4Tag:33631,"IPTC-NAA":33723,IntergraphPacketData:33918,IntergraphFlagRegisters:33919,IntergraphMatrix:33920,INGRReserved:33921,ModelTiePoint:33922,Site:34016,ColorSequence:34017,IT8Header:34018,RasterPadding:34019,BitsPerRunLength:34020,BitsPerExtendedRunLength:34021,ColorTable:34022,ImageColorIndicator:34023,BackgroundColorIndicator:34024,ImageColorValue:34025,BackgroundColorValue:34026,PixelIntensityRange:34027,TransparencyIndicator:34028,ColorCharacterization:34029,HCUsage:34030,TrapIndicator:34031,CMYKEquivalent:34032,SEMInfo:34118,AFCP_IPTC:34152,PixelMagicJBIGOptions:34232,ModelTransform:34264,WB_GRGBLevels:34306,LeafData:34310,PhotoshopSettings:34377,ExifOffset:34665,ICC_Profile:34675,TIFF_FXExtensions:34687,MultiProfiles:34688,SharedData:34689,T88Options:34690,ImageLayer:34732,GeoTiffDirectory:34735,GeoTiffDoubleParams:34736,GeoTiffAsciiParams:34737,ExposureProgram:34850,SpectralSensitivity:34852,GPSInfo:34853,ISO:34855,"Opto-ElectricConvFactor":34856,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,FaxRecvParams:34908,FaxSubAddress:34909,FaxRecvTime:34910,LeafSubIFD:34954,ExifVersion:36864,DateTimeOriginal:36867,CreateDate:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureCompensation:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,SubjectArea:37396,ExposureIndex:37397,"TIFF-EPStandardID":37398,SensingMethod:37399,CIP3DataFile:37434,CIP3Sheet:37435,CIP3Side:37436,StoNits:37439,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,MSDocumentText:37679,MSPropertySetStorage:37680,MSDocumentTextPosition:37681,ImageSourceData:37724,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,FlashpixVersion:40960,ColorSpace:40961,ExifImageWidth:40962,ExifImageHeight:40963,RelatedSoundFile:40964,InteropOffset:40965,SubjectLocation:41492,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFormat:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,OwnerName:42032,SerialNumber:42033,LensInfo:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,GDALMetadata:42112,GDALNoData:42113,Gamma:42240,ExpandSoftware:44992,ExpandLens:44993,ExpandFilm:44994,ExpandFilterLens:44995,ExpandScanner:44996,ExpandFlashLamp:44997,PixelFormat:48129,Transformation:48130,Uncompressed:48131,ImageType:48132,WidthResolution:48258,HeightResolution:48259,ImageOffset:48320,ImageByteCount:48321,AlphaOffset:48322,AlphaByteCount:48323,ImageDataDiscard:48324,AlphaDataDiscard:48325,OceScanjobDesc:50215,OceApplicationSelector:50216,OceIDNumber:50217,OceImageLogic:50218,Annotations:50255,PrintIM:50341,USPTOOriginalContentType:50560,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,DNGLensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,RawImageSegmentation:50752,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,AliasLayerMetadata:50784,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,PanasonicTitle:50898,PanasonicTitle2:50899,CameraCalibrationSig:50931,ProfileCalibrationSig:50932,ProfileIFD:50933,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041,TimeCodes:51043,FrameRate:51044,TStop:51058,ReelName:51081,OriginalDefaultFinalSize:51089,OriginalBestQualitySize:51090,OriginalDefaultCropSize:51091,CameraLabel:51105,ProfileHueSatMapEncoding:51107,ProfileLookTableEncoding:51108,BaselineExposureOffset:51109,DefaultBlackRender:51110,NewRawImageDigest:51111,RawToPreviewGain:51112,DefaultUserCrop:51125,Padding:59932,OffsetSchema:59933,Lens:65002,KDC_IFD:65024,RawFile:65100,Converter:65101,Exposure:65105,Shadows:65106,Brightness:65107,Smoothness:65111,MoireFilter:65112},EXIF_GPS_FIELDS={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},EXIF_FIELDS={...EXIF_REGULAR_FIELDS,...EXIF_GPS_FIELDS};function metadataOptionId(d,m){return`${d}:${m}`}function parseMetadataOptionId(d){const m=d.split(":");if(m.length<2)throw new Error(`Invalid metadata option ID: ${d}`);const g=m.slice(0,-1).join(":"),w=m[m.length-1];return{metadataId:g,key:w}}const METADATA_TYPES={string:{help:"du texte"},boolean:{help:"vrai ou faux"},integer:{help:"un entier"},float:{help:"un nombre, potentiellement Ã  virgule"},enum:{help:"un ensemble de valeur fixes"},date:{help:"une date"},location:{help:"un objet avec deux nombres, `latitude` et `longitude`"},boundingbox:{help:"un objet reprÃ©sentant une rÃ©gion rectangulaire au format YOLO"}},MetadataType=type.or(type("'string'","@",METADATA_TYPES.string.help),type("'boolean'","@",METADATA_TYPES.boolean.help),type("'integer'","@",METADATA_TYPES.integer.help),type("'float'","@",METADATA_TYPES.float.help),type("'enum'","@",METADATA_TYPES.enum.help),type("'date'","@",METADATA_TYPES.date.help),type("'location'","@",METADATA_TYPES.location.help),type("'boundingbox'","@",METADATA_TYPES.boundingbox.help)),MetadataRuntimeValue={string:type("string"),boolean:type("boolean"),integer:type("number"),float:type("number"),enum:type("string"),date:type("Date"),location:type({latitude:"number",longitude:"number"}),boundingbox:type({x:"number",y:"number",w:"number",h:"number"})},MetadataRuntimeValueAny=type.or(MetadataRuntimeValue.string,MetadataRuntimeValue.boolean,MetadataRuntimeValue.integer,MetadataRuntimeValue.float,MetadataRuntimeValue.enum,MetadataRuntimeValue.date,MetadataRuntimeValue.location,MetadataRuntimeValue.boundingbox),MetadataValue=type({value:type("string.json").pipe(d=>{let m=JSON.parse(d);return typeof m=="string"&&(m=parseISOSafe(m)??m),m},MetadataRuntimeValueAny),confidence:Probability.default(1),manuallyModified:type("boolean").describe("Si la valeur a Ã©tÃ© modifiÃ©e manuellement").default(!1),alternatives:{"[string.json]":Probability}}),MetadataValues=scope({ID}).type({"[ID]":MetadataValue}),METADATA_MERGE_METHODS={min:{help:"Choisir la valeur avec la meilleure confiance, et prendre la plus petite valeur en cas d'ambuiguitÃ©"},max:{help:"Choisir la valeur avec la meilleure confiance, et prendre la plus grande valeur en cas d'ambuiguitÃ©"},average:{help:"Prend la moyenne des valeurs"},median:{help:"Prend la mÃ©diane des valeurs"},union:{help:"SpÃ©cifique aux boÃ®tes de recadrage: fusionne les boÃ®tes de recadrage en la plus petite boÃ®te englobant toutes les boÃ®tes"},none:{help:"Ne pas fusionner"}},MetadataMergeMethod=type.or(type('"min"',"@",METADATA_MERGE_METHODS.min.help),type('"max"',"@",METADATA_MERGE_METHODS.max.help),type('"average"',"@",METADATA_MERGE_METHODS.average.help),type('"median"',"@",METADATA_MERGE_METHODS.median.help),type('"none"',"@",METADATA_MERGE_METHODS.none.help),type('"union"',"@",METADATA_MERGE_METHODS.union.help)),MetadataEnumVariant=type({key:[ID,"@","Identifiant unique pour cette option"],label:["string","@","Nom de l'option, affichable dans une interface utilisateur"],description:["string","@","Description (optionnelle) de cette option"],"image?":URLString,"learnMore?":URLString.describe("Lien pour en savoir plus sur cette option de l'Ã©numÃ©ration en particulier"),"cascade?":scope({ID}).type({"[ID]":"ID"}).describe('Objet contenant pour clÃ©s des identifiants d\'autres mÃ©tadonnÃ©es, et pour valeurs la valeur Ã  assigner Ã  cette mÃ©tadonnÃ©e si cette option est choisie. Le processus est rÃ©cursif: Imaginons une mÃ©tadonnÃ©e species ayant une option avec `{ key: "1", cascade: { genus: "2" } }`, une mÃ©tadonnÃ©e genus ayant une option `{ key: "2", cascade: { family: "3" } }`. Si l\'option "1" de la mÃ©tadonnÃ©e species est choisie, la mÃ©tadonnÃ©e genus sera dÃ©finie sur l\'option "2" et la mÃ©tadonnÃ©e family sera Ã  son tour dÃ©finie sur l\'option "3".')}),EXIFField=type.enumerated(...keys(EXIF_FIELDS)),MetadataInferOptionsNeural=type({neural:type({model:HTTPRequest.describe("Lien vers le modÃ¨le de classification utilisÃ© pour infÃ©rer les mÃ©tadonnÃ©es. Au format ONNX (.onnx) seulement, pour le moment."),classmapping:HTTPRequest.describe("Fichier texte contenant une clÃ© de la mÃ©tadonnÃ©e par ligne, dans le mÃªme ordre que les neurones de sortie du modÃ¨le."),"name?":["string","@","Nom du rÃ©seau Ã  afficher dans l'interface. ParticuliÃ¨rement utile si il y a plusieurs rÃ©seaux"],input:ModelInput.describe("Configuration de l'entrÃ©e des modÃ¨les"),"output?":type({"name?":["string","@","Nom de l'output du modÃ¨le Ã  utiliser. output0 par dÃ©faut"]})}).array()}).describe("InfÃ©rer depuis un modÃ¨le de rÃ©seau de neurones","self"),MetadataInferOptionsEXIF=type({exif:EXIFField}).describe("InfÃ©rer depuis un champ EXIF","self"),MetadataInferOptions=type.or(MetadataInferOptionsEXIF,MetadataInferOptionsNeural).describe("Comment infÃ©rer la valeur de cette mÃ©tadonnÃ©e","self"),Metadata$1=type({id:ID.describe("Identifiant unique pour la mÃ©tadonnÃ©e. On conseille de mettre une partie qui vous identifie dans cet identifiant, car il doit Ãªtre globalement unique. Par exemple, mon-organisation.ma-mÃ©tadonnÃ©e"),label:["string","@","Nom de la mÃ©tadonnÃ©e"],mergeMethod:MetadataMergeMethod.configure("MÃ©thode utiliser pour fusionner plusieurs diffÃ©rentes valeurs d'une mÃ©tadonnÃ©e. Notamment utilisÃ© pour calculer la valeur d'une mÃ©tadonnÃ©e sur une Observation Ã  partir de ses images","self"),required:["boolean","@","Si la mÃ©tadonnÃ©e est obligatoire"],description:["string","@","Description, pour aider Ã  comprendre la mÃ©tadonnÃ©e"],learnMore:URLString.describe("Un lien pour en apprendre plus sur ce que cette mÃ©tadonnÃ©e dÃ©crit").optional(),"options?":MetadataEnumVariant.array().pipe(d=>unique(d,m=>m.key)).describe('Les options valides. Uniquement utile pour une mÃ©tadonnÃ©e de type "enum"')}).and(type.or({type:"'location'","infer?":{latitude:MetadataInferOptions,longitude:MetadataInferOptions}},{type:MetadataType.exclude('"location"'),"infer?":MetadataInferOptions}));function namespacedMetadataId(d,m){return m=m.replace(/^.+__/,""),`${d}__${m}`}function ensureNamespacedMetadataId(d,m){return isNamespacedToProtocol(m,d)?d:namespacedMetadataId(m,d)}function isNamespacedToProtocol(d,m){return m.startsWith(`${d}__`)}function removeNamespaceFromMetadataId(d){return d.replace(/^.+__/,"")}function namespaceOfMetadataId(d){const m=d.split("__");if(!(m.length<2))return m.slice(0,-1).join("__")}const Image$2=type({id:/\d+(_\d+)*/,filename:"string",addedAt:"string.date.iso.parse",dimensions:Dimensions,metadata:MetadataValues,contentType:/\w+\/\w+/,fileId:ID.or("null").describe("ID vers l'objet ImageFile associÃ©"),boundingBoxesAnalyzed:"boolean = false"}),Observation$1=type({id:ID,label:"string",addedAt:"string.date.iso.parse",metadataOverrides:MetadataValues,images:References});function getDefaultExportFromCjs$1(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var handlebars={exports:{}},handlebars_runtime={exports:{}},base$1={},utils={},hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1,utils.__esModule=!0,utils.extend=$,utils.indexOf=j,utils.escapeExpression=G,utils.isEmpty=H,utils.createFrame=W,utils.blockParams=V,utils.appendContextPath=K;var d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},m=/[&<>"'`=]/g,g=/[&<>"'`=]/;function w(Z){return d[Z]}function $(Z){for(var Q=1;Q<arguments.length;Q++)for(var J in arguments[Q])Object.prototype.hasOwnProperty.call(arguments[Q],J)&&(Z[J]=arguments[Q][J]);return Z}var I=Object.prototype.toString;utils.toString=I;var D=function(Q){return typeof Q=="function"};D(/x/)&&(utils.isFunction=D=function(Z){return typeof Z=="function"&&I.call(Z)==="[object Function]"}),utils.isFunction=D;var q=Array.isArray||function(Z){return Z&&typeof Z=="object"?I.call(Z)==="[object Array]":!1};utils.isArray=q;function j(Z,Q){for(var J=0,re=Z.length;J<re;J++)if(Z[J]===Q)return J;return-1}function G(Z){if(typeof Z!="string"){if(Z&&Z.toHTML)return Z.toHTML();if(Z==null)return"";if(!Z)return Z+"";Z=""+Z}return g.test(Z)?Z.replace(m,w):Z}function H(Z){return!Z&&Z!==0?!0:!!(q(Z)&&Z.length===0)}function W(Z){var Q=$({},Z);return Q._parent=Z,Q}function V(Z,Q){return Z.path=Q,Z}function K(Z,Q){return(Z?Z+".":"")+Q}return utils}var exception={exports:{}},hasRequiredException;function requireException(){return hasRequiredException||(hasRequiredException=1,(function(d,m){m.__esModule=!0;var g=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function w($,I){var D=I&&I.loc,q=void 0,j=void 0,G=void 0,H=void 0;D&&(q=D.start.line,j=D.end.line,G=D.start.column,H=D.end.column,$+=" - "+q+":"+G);for(var W=Error.prototype.constructor.call(this,$),V=0;V<g.length;V++)this[g[V]]=W[g[V]];Error.captureStackTrace&&Error.captureStackTrace(this,w);try{D&&(this.lineNumber=q,this.endLineNumber=j,Object.defineProperty?(Object.defineProperty(this,"column",{value:G,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:H,enumerable:!0})):(this.column=G,this.endColumn=H))}catch{}}w.prototype=new Error,m.default=w,d.exports=m.default})(exception,exception.exports)),exception.exports}var helpers$1={},blockHelperMissing={exports:{}},hasRequiredBlockHelperMissing;function requireBlockHelperMissing(){return hasRequiredBlockHelperMissing||(hasRequiredBlockHelperMissing=1,(function(d,m){m.__esModule=!0;var g=requireUtils();m.default=function(w){w.registerHelper("blockHelperMissing",function($,I){var D=I.inverse,q=I.fn;if($===!0)return q(this);if($===!1||$==null)return D(this);if(g.isArray($))return $.length>0?(I.ids&&(I.ids=[I.name]),w.helpers.each($,I)):D(this);if(I.data&&I.ids){var j=g.createFrame(I.data);j.contextPath=g.appendContextPath(I.data.contextPath,I.name),I={data:j}}return q($,I)})},d.exports=m.default})(blockHelperMissing,blockHelperMissing.exports)),blockHelperMissing.exports}var each={exports:{}},hasRequiredEach;function requireEach(){return hasRequiredEach||(hasRequiredEach=1,(function(d,m){m.__esModule=!0;function g(D){return D&&D.__esModule?D:{default:D}}var w=requireUtils(),$=requireException(),I=g($);m.default=function(D){D.registerHelper("each",function(q,j){if(!j)throw new I.default("Must pass iterator to #each");var G=j.fn,H=j.inverse,W=0,V="",K=void 0,Z=void 0;j.data&&j.ids&&(Z=w.appendContextPath(j.data.contextPath,j.ids[0])+"."),w.isFunction(q)&&(q=q.call(this)),j.data&&(K=w.createFrame(j.data));function Q(ee,ae,ce){K&&(K.key=ee,K.index=ae,K.first=ae===0,K.last=!!ce,Z&&(K.contextPath=Z+ee)),V=V+G(q[ee],{data:K,blockParams:w.blockParams([q[ee],ee],[Z+ee,null])})}if(q&&typeof q=="object")if(w.isArray(q))for(var J=q.length;W<J;W++)W in q&&Q(W,W,W===q.length-1);else if(typeof Symbol=="function"&&q[Symbol.iterator]){for(var re=[],se=q[Symbol.iterator](),oe=se.next();!oe.done;oe=se.next())re.push(oe.value);q=re;for(var J=q.length;W<J;W++)Q(W,W,W===q.length-1)}else(function(){var ee=void 0;Object.keys(q).forEach(function(ae){ee!==void 0&&Q(ee,W-1),ee=ae,W++}),ee!==void 0&&Q(ee,W-1,!0)})();return W===0&&(V=H(this)),V})},d.exports=m.default})(each,each.exports)),each.exports}var helperMissing={exports:{}},hasRequiredHelperMissing;function requireHelperMissing(){return hasRequiredHelperMissing||(hasRequiredHelperMissing=1,(function(d,m){m.__esModule=!0;function g(I){return I&&I.__esModule?I:{default:I}}var w=requireException(),$=g(w);m.default=function(I){I.registerHelper("helperMissing",function(){if(arguments.length!==1)throw new $.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},d.exports=m.default})(helperMissing,helperMissing.exports)),helperMissing.exports}var _if={exports:{}},hasRequired_if;function require_if(){return hasRequired_if||(hasRequired_if=1,(function(d,m){m.__esModule=!0;function g(D){return D&&D.__esModule?D:{default:D}}var w=requireUtils(),$=requireException(),I=g($);m.default=function(D){D.registerHelper("if",function(q,j){if(arguments.length!=2)throw new I.default("#if requires exactly one argument");return w.isFunction(q)&&(q=q.call(this)),!j.hash.includeZero&&!q||w.isEmpty(q)?j.inverse(this):j.fn(this)}),D.registerHelper("unless",function(q,j){if(arguments.length!=2)throw new I.default("#unless requires exactly one argument");return D.helpers.if.call(this,q,{fn:j.inverse,inverse:j.fn,hash:j.hash})})},d.exports=m.default})(_if,_if.exports)),_if.exports}var log={exports:{}},hasRequiredLog;function requireLog(){return hasRequiredLog||(hasRequiredLog=1,(function(d,m){m.__esModule=!0,m.default=function(g){g.registerHelper("log",function(){for(var w=[void 0],$=arguments[arguments.length-1],I=0;I<arguments.length-1;I++)w.push(arguments[I]);var D=1;$.hash.level!=null?D=$.hash.level:$.data&&$.data.level!=null&&(D=$.data.level),w[0]=D,g.log.apply(g,w)})},d.exports=m.default})(log,log.exports)),log.exports}var lookup$1={exports:{}},hasRequiredLookup;function requireLookup(){return hasRequiredLookup||(hasRequiredLookup=1,(function(d,m){m.__esModule=!0,m.default=function(g){g.registerHelper("lookup",function(w,$,I){return w&&I.lookupProperty(w,$)})},d.exports=m.default})(lookup$1,lookup$1.exports)),lookup$1.exports}var _with={exports:{}},hasRequired_with;function require_with(){return hasRequired_with||(hasRequired_with=1,(function(d,m){m.__esModule=!0;function g(D){return D&&D.__esModule?D:{default:D}}var w=requireUtils(),$=requireException(),I=g($);m.default=function(D){D.registerHelper("with",function(q,j){if(arguments.length!=2)throw new I.default("#with requires exactly one argument");w.isFunction(q)&&(q=q.call(this));var G=j.fn;if(w.isEmpty(q))return j.inverse(this);var H=j.data;return j.data&&j.ids&&(H=w.createFrame(j.data),H.contextPath=w.appendContextPath(j.data.contextPath,j.ids[0])),G(q,{data:H,blockParams:w.blockParams([q],[H&&H.contextPath])})})},d.exports=m.default})(_with,_with.exports)),_with.exports}var hasRequiredHelpers$1;function requireHelpers$1(){if(hasRequiredHelpers$1)return helpers$1;hasRequiredHelpers$1=1,helpers$1.__esModule=!0,helpers$1.registerDefaultHelpers=Q,helpers$1.moveHelperToHooks=J;function d(re){return re&&re.__esModule?re:{default:re}}var m=requireBlockHelperMissing(),g=d(m),w=requireEach(),$=d(w),I=requireHelperMissing(),D=d(I),q=require_if(),j=d(q),G=requireLog(),H=d(G),W=requireLookup(),V=d(W),K=require_with(),Z=d(K);function Q(re){g.default(re),$.default(re),D.default(re),j.default(re),H.default(re),V.default(re),Z.default(re)}function J(re,se,oe){re.helpers[se]&&(re.hooks[se]=re.helpers[se],oe||delete re.helpers[se])}return helpers$1}var decorators={},inline={exports:{}},hasRequiredInline;function requireInline(){return hasRequiredInline||(hasRequiredInline=1,(function(d,m){m.__esModule=!0;var g=requireUtils();m.default=function(w){w.registerDecorator("inline",function($,I,D,q){var j=$;return I.partials||(I.partials={},j=function(G,H){var W=D.partials;D.partials=g.extend({},W,I.partials);var V=$(G,H);return D.partials=W,V}),I.partials[q.args[0]]=q.fn,j})},d.exports=m.default})(inline,inline.exports)),inline.exports}var hasRequiredDecorators;function requireDecorators(){if(hasRequiredDecorators)return decorators;hasRequiredDecorators=1,decorators.__esModule=!0,decorators.registerDefaultDecorators=w;function d($){return $&&$.__esModule?$:{default:$}}var m=requireInline(),g=d(m);function w($){g.default($)}return decorators}var logger={exports:{}},hasRequiredLogger;function requireLogger(){return hasRequiredLogger||(hasRequiredLogger=1,(function(d,m){m.__esModule=!0;var g=requireUtils(),w={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(I){if(typeof I=="string"){var D=g.indexOf(w.methodMap,I.toLowerCase());D>=0?I=D:I=parseInt(I,10)}return I},log:function(I){if(I=w.lookupLevel(I),typeof console<"u"&&w.lookupLevel(w.level)<=I){var D=w.methodMap[I];console[D]||(D="log");for(var q=arguments.length,j=Array(q>1?q-1:0),G=1;G<q;G++)j[G-1]=arguments[G];console[D].apply(console,j)}}};m.default=w,d.exports=m.default})(logger,logger.exports)),logger.exports}var protoAccess={},createNewLookupObject={},hasRequiredCreateNewLookupObject;function requireCreateNewLookupObject(){if(hasRequiredCreateNewLookupObject)return createNewLookupObject;hasRequiredCreateNewLookupObject=1,createNewLookupObject.__esModule=!0,createNewLookupObject.createNewLookupObject=m;var d=requireUtils();function m(){for(var g=arguments.length,w=Array(g),$=0;$<g;$++)w[$]=arguments[$];return d.extend.apply(void 0,[Object.create(null)].concat(w))}return createNewLookupObject}var hasRequiredProtoAccess;function requireProtoAccess(){if(hasRequiredProtoAccess)return protoAccess;hasRequiredProtoAccess=1,protoAccess.__esModule=!0,protoAccess.createProtoAccessControl=I,protoAccess.resultIsAllowed=D,protoAccess.resetLoggedProperties=G;function d(H){return H&&H.__esModule?H:{default:H}}var m=requireCreateNewLookupObject(),g=requireLogger(),w=d(g),$=Object.create(null);function I(H){var W=Object.create(null);W.constructor=!1,W.__defineGetter__=!1,W.__defineSetter__=!1,W.__lookupGetter__=!1;var V=Object.create(null);return V.__proto__=!1,{properties:{whitelist:m.createNewLookupObject(V,H.allowedProtoProperties),defaultValue:H.allowProtoPropertiesByDefault},methods:{whitelist:m.createNewLookupObject(W,H.allowedProtoMethods),defaultValue:H.allowProtoMethodsByDefault}}}function D(H,W,V){return q(typeof H=="function"?W.methods:W.properties,V)}function q(H,W){return H.whitelist[W]!==void 0?H.whitelist[W]===!0:H.defaultValue!==void 0?H.defaultValue:(j(W),!1)}function j(H){$[H]!==!0&&($[H]=!0,w.default.log("error",'Handlebars: Access has been denied to resolve the property "'+H+`" because it is not an "own property" of its parent.
You can add a runtime option to disable the check or this warning:
See https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details`))}function G(){Object.keys($).forEach(function(H){delete $[H]})}return protoAccess}var hasRequiredBase$1;function requireBase$1(){if(hasRequiredBase$1)return base$1;hasRequiredBase$1=1,base$1.__esModule=!0,base$1.HandlebarsEnvironment=Z;function d(J){return J&&J.__esModule?J:{default:J}}var m=requireUtils(),g=requireException(),w=d(g),$=requireHelpers$1(),I=requireDecorators(),D=requireLogger(),q=d(D),j=requireProtoAccess(),G="4.7.8";base$1.VERSION=G;var H=8;base$1.COMPILER_REVISION=H;var W=7;base$1.LAST_COMPATIBLE_COMPILER_REVISION=W;var V={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};base$1.REVISION_CHANGES=V;var K="[object Object]";function Z(J,re,se){this.helpers=J||{},this.partials=re||{},this.decorators=se||{},$.registerDefaultHelpers(this),I.registerDefaultDecorators(this)}Z.prototype={constructor:Z,logger:q.default,log:q.default.log,registerHelper:function(re,se){if(m.toString.call(re)===K){if(se)throw new w.default("Arg not supported with multiple helpers");m.extend(this.helpers,re)}else this.helpers[re]=se},unregisterHelper:function(re){delete this.helpers[re]},registerPartial:function(re,se){if(m.toString.call(re)===K)m.extend(this.partials,re);else{if(typeof se>"u")throw new w.default('Attempting to register a partial called "'+re+'" as undefined');this.partials[re]=se}},unregisterPartial:function(re){delete this.partials[re]},registerDecorator:function(re,se){if(m.toString.call(re)===K){if(se)throw new w.default("Arg not supported with multiple decorators");m.extend(this.decorators,re)}else this.decorators[re]=se},unregisterDecorator:function(re){delete this.decorators[re]},resetLoggedPropertyAccesses:function(){j.resetLoggedProperties()}};var Q=q.default.log;return base$1.log=Q,base$1.createFrame=m.createFrame,base$1.logger=q.default,base$1}var safeString={exports:{}},hasRequiredSafeString;function requireSafeString(){return hasRequiredSafeString||(hasRequiredSafeString=1,(function(d,m){m.__esModule=!0;function g(w){this.string=w}g.prototype.toString=g.prototype.toHTML=function(){return""+this.string},m.default=g,d.exports=m.default})(safeString,safeString.exports)),safeString.exports}var runtime={},wrapHelper={},hasRequiredWrapHelper;function requireWrapHelper(){if(hasRequiredWrapHelper)return wrapHelper;hasRequiredWrapHelper=1,wrapHelper.__esModule=!0,wrapHelper.wrapHelper=d;function d(m,g){if(typeof m!="function")return m;var w=function(){var I=arguments[arguments.length-1];return arguments[arguments.length-1]=g(I),m.apply(this,arguments)};return w}return wrapHelper}var hasRequiredRuntime;function requireRuntime(){if(hasRequiredRuntime)return runtime;hasRequiredRuntime=1,runtime.__esModule=!0,runtime.checkRevision=H,runtime.template=W,runtime.wrapProgram=V,runtime.resolvePartial=K,runtime.invokePartial=Z,runtime.noop=Q;function d(ee){return ee&&ee.__esModule?ee:{default:ee}}function m(ee){if(ee&&ee.__esModule)return ee;var ae={};if(ee!=null)for(var ce in ee)Object.prototype.hasOwnProperty.call(ee,ce)&&(ae[ce]=ee[ce]);return ae.default=ee,ae}var g=requireUtils(),w=m(g),$=requireException(),I=d($),D=requireBase$1(),q=requireHelpers$1(),j=requireWrapHelper(),G=requireProtoAccess();function H(ee){var ae=ee&&ee[0]||1,ce=D.COMPILER_REVISION;if(!(ae>=D.LAST_COMPATIBLE_COMPILER_REVISION&&ae<=D.COMPILER_REVISION))if(ae<D.LAST_COMPATIBLE_COMPILER_REVISION){var le=D.REVISION_CHANGES[ce],de=D.REVISION_CHANGES[ae];throw new I.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+le+") or downgrade your runtime to an older version ("+de+").")}else throw new I.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+ee[1]+").")}function W(ee,ae){if(!ae)throw new I.default("No environment passed to template");if(!ee||!ee.main)throw new I.default("Unknown template object: "+typeof ee);ee.main.decorator=ee.main_d,ae.VM.checkRevision(ee.compiler);var ce=ee.compiler&&ee.compiler[0]===7;function le(we,pe,xe){xe.hash&&(pe=w.extend({},pe,xe.hash),xe.ids&&(xe.ids[0]=!0)),we=ae.VM.resolvePartial.call(this,we,pe,xe);var Ge=w.extend({},xe,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),Te=ae.VM.invokePartial.call(this,we,pe,Ge);if(Te==null&&ae.compile&&(xe.partials[xe.name]=ae.compile(we,ee.compilerOptions,ae),Te=xe.partials[xe.name](pe,Ge)),Te!=null){if(xe.indent){for(var Ce=Te.split(`
`),Oe=0,bt=Ce.length;Oe<bt&&!(!Ce[Oe]&&Oe+1===bt);Oe++)Ce[Oe]=xe.indent+Ce[Oe];Te=Ce.join(`
`)}return Te}else throw new I.default("The partial "+xe.name+" could not be compiled when running in runtime-only mode")}var de={strict:function(pe,xe,Ge){if(!pe||!(xe in pe))throw new I.default('"'+xe+'" not defined in '+pe,{loc:Ge});return de.lookupProperty(pe,xe)},lookupProperty:function(pe,xe){var Ge=pe[xe];if(Ge==null||Object.prototype.hasOwnProperty.call(pe,xe)||G.resultIsAllowed(Ge,de.protoAccessControl,xe))return Ge},lookup:function(pe,xe){for(var Ge=pe.length,Te=0;Te<Ge;Te++){var Ce=pe[Te]&&de.lookupProperty(pe[Te],xe);if(Ce!=null)return pe[Te][xe]}},lambda:function(pe,xe){return typeof pe=="function"?pe.call(xe):pe},escapeExpression:w.escapeExpression,invokePartial:le,fn:function(pe){var xe=ee[pe];return xe.decorator=ee[pe+"_d"],xe},programs:[],program:function(pe,xe,Ge,Te,Ce){var Oe=this.programs[pe],bt=this.fn(pe);return xe||Ce||Te||Ge?Oe=V(this,pe,bt,xe,Ge,Te,Ce):Oe||(Oe=this.programs[pe]=V(this,pe,bt)),Oe},data:function(pe,xe){for(;pe&&xe--;)pe=pe._parent;return pe},mergeIfNeeded:function(pe,xe){var Ge=pe||xe;return pe&&xe&&pe!==xe&&(Ge=w.extend({},xe,pe)),Ge},nullContext:Object.seal({}),noop:ae.VM.noop,compilerInfo:ee.compiler};function _e(we){var pe=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],xe=pe.data;_e._setup(pe),!pe.partial&&ee.useData&&(xe=J(we,xe));var Ge=void 0,Te=ee.useBlockParams?[]:void 0;ee.useDepths&&(pe.depths?Ge=we!=pe.depths[0]?[we].concat(pe.depths):pe.depths:Ge=[we]);function Ce(Oe){return""+ee.main(de,Oe,de.helpers,de.partials,xe,Te,Ge)}return Ce=re(ee.main,Ce,de,pe.depths||[],xe,Te),Ce(we,pe)}return _e.isTop=!0,_e._setup=function(we){if(we.partial)de.protoAccessControl=we.protoAccessControl,de.helpers=we.helpers,de.partials=we.partials,de.decorators=we.decorators,de.hooks=we.hooks;else{var pe=w.extend({},ae.helpers,we.helpers);se(pe,de),de.helpers=pe,ee.usePartial&&(de.partials=de.mergeIfNeeded(we.partials,ae.partials)),(ee.usePartial||ee.useDecorators)&&(de.decorators=w.extend({},ae.decorators,we.decorators)),de.hooks={},de.protoAccessControl=G.createProtoAccessControl(we);var xe=we.allowCallsToHelperMissing||ce;q.moveHelperToHooks(de,"helperMissing",xe),q.moveHelperToHooks(de,"blockHelperMissing",xe)}},_e._child=function(we,pe,xe,Ge){if(ee.useBlockParams&&!xe)throw new I.default("must pass block params");if(ee.useDepths&&!Ge)throw new I.default("must pass parent depths");return V(de,we,ee[we],pe,0,xe,Ge)},_e}function V(ee,ae,ce,le,de,_e,we){function pe(xe){var Ge=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],Te=we;return we&&xe!=we[0]&&!(xe===ee.nullContext&&we[0]===null)&&(Te=[xe].concat(we)),ce(ee,xe,ee.helpers,ee.partials,Ge.data||le,_e&&[Ge.blockParams].concat(_e),Te)}return pe=re(ce,pe,ee,we,le,_e),pe.program=ae,pe.depth=we?we.length:0,pe.blockParams=de||0,pe}function K(ee,ae,ce){return ee?!ee.call&&!ce.name&&(ce.name=ee,ee=ce.partials[ee]):ce.name==="@partial-block"?ee=ce.data["partial-block"]:ee=ce.partials[ce.name],ee}function Z(ee,ae,ce){var le=ce.data&&ce.data["partial-block"];ce.partial=!0,ce.ids&&(ce.data.contextPath=ce.ids[0]||ce.data.contextPath);var de=void 0;if(ce.fn&&ce.fn!==Q&&(function(){ce.data=D.createFrame(ce.data);var _e=ce.fn;de=ce.data["partial-block"]=function(pe){var xe=arguments.length<=1||arguments[1]===void 0?{}:arguments[1];return xe.data=D.createFrame(xe.data),xe.data["partial-block"]=le,_e(pe,xe)},_e.partials&&(ce.partials=w.extend({},ce.partials,_e.partials))})(),ee===void 0&&de&&(ee=de),ee===void 0)throw new I.default("The partial "+ce.name+" could not be found");if(ee instanceof Function)return ee(ae,ce)}function Q(){return""}function J(ee,ae){return(!ae||!("root"in ae))&&(ae=ae?D.createFrame(ae):{},ae.root=ee),ae}function re(ee,ae,ce,le,de,_e){if(ee.decorator){var we={};ae=ee.decorator(ae,we,ce,le&&le[0],de,_e,le),w.extend(ae,we)}return ae}function se(ee,ae){Object.keys(ee).forEach(function(ce){var le=ee[ce];ee[ce]=oe(le,ae)})}function oe(ee,ae){var ce=ae.lookupProperty;return j.wrapHelper(ee,function(le){return w.extend({lookupProperty:ce},le)})}return runtime}var noConflict={exports:{}},hasRequiredNoConflict;function requireNoConflict(){return hasRequiredNoConflict||(hasRequiredNoConflict=1,(function(d,m){m.__esModule=!0,m.default=function(g){(function(){typeof globalThis!="object"&&(Object.prototype.__defineGetter__("__magic__",function(){return this}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__)})();var w=globalThis.Handlebars;g.noConflict=function(){return globalThis.Handlebars===g&&(globalThis.Handlebars=w),g}},d.exports=m.default})(noConflict,noConflict.exports)),noConflict.exports}var hasRequiredHandlebars_runtime;function requireHandlebars_runtime(){return hasRequiredHandlebars_runtime||(hasRequiredHandlebars_runtime=1,(function(d,m){m.__esModule=!0;function g(se){return se&&se.__esModule?se:{default:se}}function w(se){if(se&&se.__esModule)return se;var oe={};if(se!=null)for(var ee in se)Object.prototype.hasOwnProperty.call(se,ee)&&(oe[ee]=se[ee]);return oe.default=se,oe}var $=requireBase$1(),I=w($),D=requireSafeString(),q=g(D),j=requireException(),G=g(j),H=requireUtils(),W=w(H),V=requireRuntime(),K=w(V),Z=requireNoConflict(),Q=g(Z);function J(){var se=new I.HandlebarsEnvironment;return W.extend(se,I),se.SafeString=q.default,se.Exception=G.default,se.Utils=W,se.escapeExpression=W.escapeExpression,se.VM=K,se.template=function(oe){return K.template(oe,se)},se}var re=J();re.create=J,Q.default(re),re.default=re,m.default=re,d.exports=m.default})(handlebars_runtime,handlebars_runtime.exports)),handlebars_runtime.exports}var ast={exports:{}},hasRequiredAst;function requireAst(){return hasRequiredAst||(hasRequiredAst=1,(function(d,m){m.__esModule=!0;var g={helpers:{helperExpression:function($){return $.type==="SubExpression"||($.type==="MustacheStatement"||$.type==="BlockStatement")&&!!($.params&&$.params.length||$.hash)},scopedId:function($){return/^\.|this\b/.test($.original)},simpleId:function($){return $.parts.length===1&&!g.helpers.scopedId($)&&!$.depth}}};m.default=g,d.exports=m.default})(ast,ast.exports)),ast.exports}var base={},parser$2={exports:{}},hasRequiredParser$1;function requireParser$1(){return hasRequiredParser$1||(hasRequiredParser$1=1,(function(d,m){m.__esModule=!0;var g=(function(){var w={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(q,j,G,H,W,V,K){var Z=V.length-1;switch(W){case 1:return V[Z-1];case 2:this.$=H.prepareProgram(V[Z]);break;case 3:this.$=V[Z];break;case 4:this.$=V[Z];break;case 5:this.$=V[Z];break;case 6:this.$=V[Z];break;case 7:this.$=V[Z];break;case 8:this.$=V[Z];break;case 9:this.$={type:"CommentStatement",value:H.stripComment(V[Z]),strip:H.stripFlags(V[Z],V[Z]),loc:H.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:V[Z],value:V[Z],loc:H.locInfo(this._$)};break;case 11:this.$=H.prepareRawBlock(V[Z-2],V[Z-1],V[Z],this._$);break;case 12:this.$={path:V[Z-3],params:V[Z-2],hash:V[Z-1]};break;case 13:this.$=H.prepareBlock(V[Z-3],V[Z-2],V[Z-1],V[Z],!1,this._$);break;case 14:this.$=H.prepareBlock(V[Z-3],V[Z-2],V[Z-1],V[Z],!0,this._$);break;case 15:this.$={open:V[Z-5],path:V[Z-4],params:V[Z-3],hash:V[Z-2],blockParams:V[Z-1],strip:H.stripFlags(V[Z-5],V[Z])};break;case 16:this.$={path:V[Z-4],params:V[Z-3],hash:V[Z-2],blockParams:V[Z-1],strip:H.stripFlags(V[Z-5],V[Z])};break;case 17:this.$={path:V[Z-4],params:V[Z-3],hash:V[Z-2],blockParams:V[Z-1],strip:H.stripFlags(V[Z-5],V[Z])};break;case 18:this.$={strip:H.stripFlags(V[Z-1],V[Z-1]),program:V[Z]};break;case 19:var Q=H.prepareBlock(V[Z-2],V[Z-1],V[Z],V[Z],!1,this._$),J=H.prepareProgram([Q],V[Z-1].loc);J.chained=!0,this.$={strip:V[Z-2].strip,program:J,chain:!0};break;case 20:this.$=V[Z];break;case 21:this.$={path:V[Z-1],strip:H.stripFlags(V[Z-2],V[Z])};break;case 22:this.$=H.prepareMustache(V[Z-3],V[Z-2],V[Z-1],V[Z-4],H.stripFlags(V[Z-4],V[Z]),this._$);break;case 23:this.$=H.prepareMustache(V[Z-3],V[Z-2],V[Z-1],V[Z-4],H.stripFlags(V[Z-4],V[Z]),this._$);break;case 24:this.$={type:"PartialStatement",name:V[Z-3],params:V[Z-2],hash:V[Z-1],indent:"",strip:H.stripFlags(V[Z-4],V[Z]),loc:H.locInfo(this._$)};break;case 25:this.$=H.preparePartialBlock(V[Z-2],V[Z-1],V[Z],this._$);break;case 26:this.$={path:V[Z-3],params:V[Z-2],hash:V[Z-1],strip:H.stripFlags(V[Z-4],V[Z])};break;case 27:this.$=V[Z];break;case 28:this.$=V[Z];break;case 29:this.$={type:"SubExpression",path:V[Z-3],params:V[Z-2],hash:V[Z-1],loc:H.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:V[Z],loc:H.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:H.id(V[Z-2]),value:V[Z],loc:H.locInfo(this._$)};break;case 32:this.$=H.id(V[Z-1]);break;case 33:this.$=V[Z];break;case 34:this.$=V[Z];break;case 35:this.$={type:"StringLiteral",value:V[Z],original:V[Z],loc:H.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(V[Z]),original:Number(V[Z]),loc:H.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:V[Z]==="true",original:V[Z]==="true",loc:H.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:H.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:H.locInfo(this._$)};break;case 40:this.$=V[Z];break;case 41:this.$=V[Z];break;case 42:this.$=H.preparePath(!0,V[Z],this._$);break;case 43:this.$=H.preparePath(!1,V[Z],this._$);break;case 44:V[Z-2].push({part:H.id(V[Z]),original:V[Z],separator:V[Z-1]}),this.$=V[Z-2];break;case 45:this.$=[{part:H.id(V[Z]),original:V[Z]}];break;case 46:this.$=[];break;case 47:V[Z-1].push(V[Z]);break;case 48:this.$=[];break;case 49:V[Z-1].push(V[Z]);break;case 50:this.$=[];break;case 51:V[Z-1].push(V[Z]);break;case 58:this.$=[];break;case 59:V[Z-1].push(V[Z]);break;case 64:this.$=[];break;case 65:V[Z-1].push(V[Z]);break;case 70:this.$=[];break;case 71:V[Z-1].push(V[Z]);break;case 78:this.$=[];break;case 79:V[Z-1].push(V[Z]);break;case 82:this.$=[];break;case 83:V[Z-1].push(V[Z]);break;case 86:this.$=[];break;case 87:V[Z-1].push(V[Z]);break;case 90:this.$=[];break;case 91:V[Z-1].push(V[Z]);break;case 94:this.$=[];break;case 95:V[Z-1].push(V[Z]);break;case 98:this.$=[V[Z]];break;case 99:V[Z-1].push(V[Z]);break;case 100:this.$=[V[Z]];break;case 101:V[Z-1].push(V[Z]);break}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(q,j){throw new Error(q)},parse:function(q){var j=this,G=[0],H=[null],W=[],V=this.table,K="",Z=0,Q=0;this.lexer.setInput(q),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc>"u"&&(this.lexer.yylloc={});var J=this.lexer.yylloc;W.push(J);var re=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);function se(){var Ge;return Ge=j.lexer.lex()||1,typeof Ge!="number"&&(Ge=j.symbols_[Ge]||Ge),Ge}for(var oe,ee,ae,ce,le={},de,_e,we,pe;;){if(ee=G[G.length-1],this.defaultActions[ee]?ae=this.defaultActions[ee]:((oe===null||typeof oe>"u")&&(oe=se()),ae=V[ee]&&V[ee][oe]),typeof ae>"u"||!ae.length||!ae[0]){var xe="";{pe=[];for(de in V[ee])this.terminals_[de]&&de>2&&pe.push("'"+this.terminals_[de]+"'");this.lexer.showPosition?xe="Parse error on line "+(Z+1)+`:
`+this.lexer.showPosition()+`
Expecting `+pe.join(", ")+", got '"+(this.terminals_[oe]||oe)+"'":xe="Parse error on line "+(Z+1)+": Unexpected "+(oe==1?"end of input":"'"+(this.terminals_[oe]||oe)+"'"),this.parseError(xe,{text:this.lexer.match,token:this.terminals_[oe]||oe,line:this.lexer.yylineno,loc:J,expected:pe})}}if(ae[0]instanceof Array&&ae.length>1)throw new Error("Parse Error: multiple actions possible at state: "+ee+", token: "+oe);switch(ae[0]){case 1:G.push(oe),H.push(this.lexer.yytext),W.push(this.lexer.yylloc),G.push(ae[1]),oe=null,Q=this.lexer.yyleng,K=this.lexer.yytext,Z=this.lexer.yylineno,J=this.lexer.yylloc;break;case 2:if(_e=this.productions_[ae[1]][1],le.$=H[H.length-_e],le._$={first_line:W[W.length-(_e||1)].first_line,last_line:W[W.length-1].last_line,first_column:W[W.length-(_e||1)].first_column,last_column:W[W.length-1].last_column},re&&(le._$.range=[W[W.length-(_e||1)].range[0],W[W.length-1].range[1]]),ce=this.performAction.call(le,K,Q,Z,this.yy,ae[1],H,W),typeof ce<"u")return ce;_e&&(G=G.slice(0,-1*_e*2),H=H.slice(0,-1*_e),W=W.slice(0,-1*_e)),G.push(this.productions_[ae[1]][0]),H.push(le.$),W.push(le._$),we=V[G[G.length-2]][G[G.length-1]],G.push(we);break;case 3:return!0}}return!0}},$=(function(){var D={EOF:1,parseError:function(j,G){if(this.yy.parser)this.yy.parser.parseError(j,G);else throw new Error(j)},setInput:function(j){return this._input=j,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var j=this._input[0];this.yytext+=j,this.yyleng++,this.offset++,this.match+=j,this.matched+=j;var G=j.match(/(?:\r\n?|\n).*/g);return G?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),j},unput:function(j){var G=j.length,H=j.split(/(?:\r\n?|\n)/g);this._input=j+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-G-1),this.offset-=G;var W=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),H.length-1&&(this.yylineno-=H.length-1);var V=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:H?(H.length===W.length?this.yylloc.first_column:0)+W[W.length-H.length].length-H[0].length:this.yylloc.first_column-G},this.options.ranges&&(this.yylloc.range=[V[0],V[0]+this.yyleng-G]),this},more:function(){return this._more=!0,this},less:function(j){this.unput(this.match.slice(j))},pastInput:function(){var j=this.matched.substr(0,this.matched.length-this.match.length);return(j.length>20?"...":"")+j.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var j=this.match;return j.length<20&&(j+=this._input.substr(0,20-j.length)),(j.substr(0,20)+(j.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var j=this.pastInput(),G=new Array(j.length+1).join("-");return j+this.upcomingInput()+`
`+G+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var j,G,H,W,V;this._more||(this.yytext="",this.match="");for(var K=this._currentRules(),Z=0;Z<K.length&&(H=this._input.match(this.rules[K[Z]]),!(H&&(!G||H[0].length>G[0].length)&&(G=H,W=Z,!this.options.flex)));Z++);return G?(V=G[0].match(/(?:\r\n?|\n).*/g),V&&(this.yylineno+=V.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:V?V[V.length-1].length-V[V.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+G[0].length},this.yytext+=G[0],this.match+=G[0],this.matches=G,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(G[0].length),this.matched+=G[0],j=this.performAction.call(this,this.yy,this,K[W],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),j||void 0):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var j=this.next();return typeof j<"u"?j:this.lex()},begin:function(j){this.conditionStack.push(j)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(j){this.begin(j)}};return D.options={},D.performAction=function(j,G,H,W){function V(K,Z){return G.yytext=G.yytext.substring(K,G.yyleng-Z+K)}switch(H){case 0:if(G.yytext.slice(-2)==="\\\\"?(V(0,1),this.begin("mu")):G.yytext.slice(-1)==="\\"?(V(0,1),this.begin("emu")):this.begin("mu"),G.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),this.conditionStack[this.conditionStack.length-1]==="raw"?15:(V(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(G.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return G.yytext=V(1,2).replace(/\\"/g,'"'),80;case 32:return G.yytext=V(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return G.yytext=G.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},D.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],D.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},D})();w.lexer=$;function I(){this.yy={}}return I.prototype=w,w.Parser=I,new I})();m.default=g,d.exports=m.default})(parser$2,parser$2.exports)),parser$2.exports}var whitespaceControl={exports:{}},visitor={exports:{}},hasRequiredVisitor;function requireVisitor(){return hasRequiredVisitor||(hasRequiredVisitor=1,(function(d,m){m.__esModule=!0;function g(G){return G&&G.__esModule?G:{default:G}}var w=requireException(),$=g(w);function I(){this.parents=[]}I.prototype={constructor:I,mutating:!1,acceptKey:function(H,W){var V=this.accept(H[W]);if(this.mutating){if(V&&!I.prototype[V.type])throw new $.default('Unexpected node type "'+V.type+'" found when accepting '+W+" on "+H.type);H[W]=V}},acceptRequired:function(H,W){if(this.acceptKey(H,W),!H[W])throw new $.default(H.type+" requires "+W)},acceptArray:function(H){for(var W=0,V=H.length;W<V;W++)this.acceptKey(H,W),H[W]||(H.splice(W,1),W--,V--)},accept:function(H){if(H){if(!this[H.type])throw new $.default("Unknown type: "+H.type,H);this.current&&this.parents.unshift(this.current),this.current=H;var W=this[H.type](H);if(this.current=this.parents.shift(),!this.mutating||W)return W;if(W!==!1)return H}},Program:function(H){this.acceptArray(H.body)},MustacheStatement:D,Decorator:D,BlockStatement:q,DecoratorBlock:q,PartialStatement:j,PartialBlockStatement:function(H){j.call(this,H),this.acceptKey(H,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:D,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(H){this.acceptArray(H.pairs)},HashPair:function(H){this.acceptRequired(H,"value")}};function D(G){this.acceptRequired(G,"path"),this.acceptArray(G.params),this.acceptKey(G,"hash")}function q(G){D.call(this,G),this.acceptKey(G,"program"),this.acceptKey(G,"inverse")}function j(G){this.acceptRequired(G,"name"),this.acceptArray(G.params),this.acceptKey(G,"hash")}m.default=I,d.exports=m.default})(visitor,visitor.exports)),visitor.exports}var hasRequiredWhitespaceControl;function requireWhitespaceControl(){return hasRequiredWhitespaceControl||(hasRequiredWhitespaceControl=1,(function(d,m){m.__esModule=!0;function g(H){return H&&H.__esModule?H:{default:H}}var w=requireVisitor(),$=g(w);function I(){var H=arguments.length<=0||arguments[0]===void 0?{}:arguments[0];this.options=H}I.prototype=new $.default,I.prototype.Program=function(H){var W=!this.options.ignoreStandalone,V=!this.isRootSeen;this.isRootSeen=!0;for(var K=H.body,Z=0,Q=K.length;Z<Q;Z++){var J=K[Z],re=this.accept(J);if(re){var se=D(K,Z,V),oe=q(K,Z,V),ee=re.openStandalone&&se,ae=re.closeStandalone&&oe,ce=re.inlineStandalone&&se&&oe;re.close&&j(K,Z,!0),re.open&&G(K,Z,!0),W&&ce&&(j(K,Z),G(K,Z)&&J.type==="PartialStatement"&&(J.indent=/([ \t]+$)/.exec(K[Z-1].original)[1])),W&&ee&&(j((J.program||J.inverse).body),G(K,Z)),W&&ae&&(j(K,Z),G((J.inverse||J.program).body))}}return H},I.prototype.BlockStatement=I.prototype.DecoratorBlock=I.prototype.PartialBlockStatement=function(H){this.accept(H.program),this.accept(H.inverse);var W=H.program||H.inverse,V=H.program&&H.inverse,K=V,Z=V;if(V&&V.chained)for(K=V.body[0].program;Z.chained;)Z=Z.body[Z.body.length-1].program;var Q={open:H.openStrip.open,close:H.closeStrip.close,openStandalone:q(W.body),closeStandalone:D((K||W).body)};if(H.openStrip.close&&j(W.body,null,!0),V){var J=H.inverseStrip;J.open&&G(W.body,null,!0),J.close&&j(K.body,null,!0),H.closeStrip.open&&G(Z.body,null,!0),!this.options.ignoreStandalone&&D(W.body)&&q(K.body)&&(G(W.body),j(K.body))}else H.closeStrip.open&&G(W.body,null,!0);return Q},I.prototype.Decorator=I.prototype.MustacheStatement=function(H){return H.strip},I.prototype.PartialStatement=I.prototype.CommentStatement=function(H){var W=H.strip||{};return{inlineStandalone:!0,open:W.open,close:W.close}};function D(H,W,V){W===void 0&&(W=H.length);var K=H[W-1],Z=H[W-2];if(!K)return V;if(K.type==="ContentStatement")return(Z||!V?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(K.original)}function q(H,W,V){W===void 0&&(W=-1);var K=H[W+1],Z=H[W+2];if(!K)return V;if(K.type==="ContentStatement")return(Z||!V?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(K.original)}function j(H,W,V){var K=H[W==null?0:W+1];if(!(!K||K.type!=="ContentStatement"||!V&&K.rightStripped)){var Z=K.value;K.value=K.value.replace(V?/^\s+/:/^[ \t]*\r?\n?/,""),K.rightStripped=K.value!==Z}}function G(H,W,V){var K=H[W==null?H.length-1:W-1];if(!(!K||K.type!=="ContentStatement"||!V&&K.leftStripped)){var Z=K.value;return K.value=K.value.replace(V?/\s+$/:/[ \t]+$/,""),K.leftStripped=K.value!==Z,K.leftStripped}}m.default=I,d.exports=m.default})(whitespaceControl,whitespaceControl.exports)),whitespaceControl.exports}var helpers={},hasRequiredHelpers;function requireHelpers(){if(hasRequiredHelpers)return helpers;hasRequiredHelpers=1,helpers.__esModule=!0,helpers.SourceLocation=$,helpers.id=I,helpers.stripFlags=D,helpers.stripComment=q,helpers.preparePath=j,helpers.prepareMustache=G,helpers.prepareRawBlock=H,helpers.prepareBlock=W,helpers.prepareProgram=V,helpers.preparePartialBlock=K;function d(Z){return Z&&Z.__esModule?Z:{default:Z}}var m=requireException(),g=d(m);function w(Z,Q){if(Q=Q.path?Q.path.original:Q,Z.path.original!==Q){var J={loc:Z.path.loc};throw new g.default(Z.path.original+" doesn't match "+Q,J)}}function $(Z,Q){this.source=Z,this.start={line:Q.first_line,column:Q.first_column},this.end={line:Q.last_line,column:Q.last_column}}function I(Z){return/^\[.*\]$/.test(Z)?Z.substring(1,Z.length-1):Z}function D(Z,Q){return{open:Z.charAt(2)==="~",close:Q.charAt(Q.length-3)==="~"}}function q(Z){return Z.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function j(Z,Q,J){J=this.locInfo(J);for(var re=Z?"@":"",se=[],oe=0,ee=0,ae=Q.length;ee<ae;ee++){var ce=Q[ee].part,le=Q[ee].original!==ce;if(re+=(Q[ee].separator||"")+ce,!le&&(ce===".."||ce==="."||ce==="this")){if(se.length>0)throw new g.default("Invalid path: "+re,{loc:J});ce===".."&&oe++}else se.push(ce)}return{type:"PathExpression",data:Z,depth:oe,parts:se,original:re,loc:J}}function G(Z,Q,J,re,se,oe){var ee=re.charAt(3)||re.charAt(2),ae=ee!=="{"&&ee!=="&",ce=/\*/.test(re);return{type:ce?"Decorator":"MustacheStatement",path:Z,params:Q,hash:J,escaped:ae,strip:se,loc:this.locInfo(oe)}}function H(Z,Q,J,re){w(Z,J),re=this.locInfo(re);var se={type:"Program",body:Q,strip:{},loc:re};return{type:"BlockStatement",path:Z.path,params:Z.params,hash:Z.hash,program:se,openStrip:{},inverseStrip:{},closeStrip:{},loc:re}}function W(Z,Q,J,re,se,oe){re&&re.path&&w(Z,re);var ee=/\*/.test(Z.open);Q.blockParams=Z.blockParams;var ae=void 0,ce=void 0;if(J){if(ee)throw new g.default("Unexpected inverse block on decorator",J);J.chain&&(J.program.body[0].closeStrip=re.strip),ce=J.strip,ae=J.program}return se&&(se=ae,ae=Q,Q=se),{type:ee?"DecoratorBlock":"BlockStatement",path:Z.path,params:Z.params,hash:Z.hash,program:Q,inverse:ae,openStrip:Z.strip,inverseStrip:ce,closeStrip:re&&re.strip,loc:this.locInfo(oe)}}function V(Z,Q){if(!Q&&Z.length){var J=Z[0].loc,re=Z[Z.length-1].loc;J&&re&&(Q={source:J.source,start:{line:J.start.line,column:J.start.column},end:{line:re.end.line,column:re.end.column}})}return{type:"Program",body:Z,strip:{},loc:Q}}function K(Z,Q,J,re){return w(Z,J),{type:"PartialBlockStatement",name:Z.path,params:Z.params,hash:Z.hash,program:Q,openStrip:Z.strip,closeStrip:J&&J.strip,loc:this.locInfo(re)}}return helpers}var hasRequiredBase;function requireBase(){if(hasRequiredBase)return base;hasRequiredBase=1,base.__esModule=!0,base.parseWithoutProcessing=H,base.parse=W;function d(V){if(V&&V.__esModule)return V;var K={};if(V!=null)for(var Z in V)Object.prototype.hasOwnProperty.call(V,Z)&&(K[Z]=V[Z]);return K.default=V,K}function m(V){return V&&V.__esModule?V:{default:V}}var g=requireParser$1(),w=m(g),$=requireWhitespaceControl(),I=m($),D=requireHelpers(),q=d(D),j=requireUtils();base.parser=w.default;var G={};j.extend(G,q);function H(V,K){if(V.type==="Program")return V;w.default.yy=G,G.locInfo=function(Q){return new G.SourceLocation(K&&K.srcName,Q)};var Z=w.default.parse(V);return Z}function W(V,K){var Z=H(V,K),Q=new I.default(K);return Q.accept(Z)}return base}var compiler={},hasRequiredCompiler;function requireCompiler(){if(hasRequiredCompiler)return compiler;hasRequiredCompiler=1,compiler.__esModule=!0,compiler.Compiler=q,compiler.precompile=j,compiler.compile=G;function d(V){return V&&V.__esModule?V:{default:V}}var m=requireException(),g=d(m),w=requireUtils(),$=requireAst(),I=d($),D=[].slice;function q(){}q.prototype={compiler:q,equals:function(K){var Z=this.opcodes.length;if(K.opcodes.length!==Z)return!1;for(var Q=0;Q<Z;Q++){var J=this.opcodes[Q],re=K.opcodes[Q];if(J.opcode!==re.opcode||!H(J.args,re.args))return!1}Z=this.children.length;for(var Q=0;Q<Z;Q++)if(!this.children[Q].equals(K.children[Q]))return!1;return!0},guid:0,compile:function(K,Z){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=Z,this.stringParams=Z.stringParams,this.trackIds=Z.trackIds,Z.blockParams=Z.blockParams||[],Z.knownHelpers=w.extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},Z.knownHelpers),this.accept(K)},compileProgram:function(K){var Z=new this.compiler,Q=Z.compile(K,this.options),J=this.guid++;return this.usePartial=this.usePartial||Q.usePartial,this.children[J]=Q,this.useDepths=this.useDepths||Q.useDepths,J},accept:function(K){if(!this[K.type])throw new g.default("Unknown type: "+K.type,K);this.sourceNode.unshift(K);var Z=this[K.type](K);return this.sourceNode.shift(),Z},Program:function(K){this.options.blockParams.unshift(K.blockParams);for(var Z=K.body,Q=Z.length,J=0;J<Q;J++)this.accept(Z[J]);return this.options.blockParams.shift(),this.isSimple=Q===1,this.blockParams=K.blockParams?K.blockParams.length:0,this},BlockStatement:function(K){W(K);var Z=K.program,Q=K.inverse;Z=Z&&this.compileProgram(Z),Q=Q&&this.compileProgram(Q);var J=this.classifySexpr(K);J==="helper"?this.helperSexpr(K,Z,Q):J==="simple"?(this.simpleSexpr(K),this.opcode("pushProgram",Z),this.opcode("pushProgram",Q),this.opcode("emptyHash"),this.opcode("blockValue",K.path.original)):(this.ambiguousSexpr(K,Z,Q),this.opcode("pushProgram",Z),this.opcode("pushProgram",Q),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(K){var Z=K.program&&this.compileProgram(K.program),Q=this.setupFullMustacheParams(K,Z,void 0),J=K.path;this.useDecorators=!0,this.opcode("registerDecorator",Q.length,J.original)},PartialStatement:function(K){this.usePartial=!0;var Z=K.program;Z&&(Z=this.compileProgram(K.program));var Q=K.params;if(Q.length>1)throw new g.default("Unsupported number of partial arguments: "+Q.length,K);Q.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):Q.push({type:"PathExpression",parts:[],depth:0}));var J=K.name.original,re=K.name.type==="SubExpression";re&&this.accept(K.name),this.setupFullMustacheParams(K,Z,void 0,!0);var se=K.indent||"";this.options.preventIndent&&se&&(this.opcode("appendContent",se),se=""),this.opcode("invokePartial",re,J,se),this.opcode("append")},PartialBlockStatement:function(K){this.PartialStatement(K)},MustacheStatement:function(K){this.SubExpression(K),K.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(K){this.DecoratorBlock(K)},ContentStatement:function(K){K.value&&this.opcode("appendContent",K.value)},CommentStatement:function(){},SubExpression:function(K){W(K);var Z=this.classifySexpr(K);Z==="simple"?this.simpleSexpr(K):Z==="helper"?this.helperSexpr(K):this.ambiguousSexpr(K)},ambiguousSexpr:function(K,Z,Q){var J=K.path,re=J.parts[0],se=Z!=null||Q!=null;this.opcode("getContext",J.depth),this.opcode("pushProgram",Z),this.opcode("pushProgram",Q),J.strict=!0,this.accept(J),this.opcode("invokeAmbiguous",re,se)},simpleSexpr:function(K){var Z=K.path;Z.strict=!0,this.accept(Z),this.opcode("resolvePossibleLambda")},helperSexpr:function(K,Z,Q){var J=this.setupFullMustacheParams(K,Z,Q),re=K.path,se=re.parts[0];if(this.options.knownHelpers[se])this.opcode("invokeKnownHelper",J.length,se);else{if(this.options.knownHelpersOnly)throw new g.default("You specified knownHelpersOnly, but used the unknown helper "+se,K);re.strict=!0,re.falsy=!0,this.accept(re),this.opcode("invokeHelper",J.length,re.original,I.default.helpers.simpleId(re))}},PathExpression:function(K){this.addDepth(K.depth),this.opcode("getContext",K.depth);var Z=K.parts[0],Q=I.default.helpers.scopedId(K),J=!K.depth&&!Q&&this.blockParamIndex(Z);J?this.opcode("lookupBlockParam",J,K.parts):Z?K.data?(this.options.data=!0,this.opcode("lookupData",K.depth,K.parts,K.strict)):this.opcode("lookupOnContext",K.parts,K.falsy,K.strict,Q):this.opcode("pushContext")},StringLiteral:function(K){this.opcode("pushString",K.value)},NumberLiteral:function(K){this.opcode("pushLiteral",K.value)},BooleanLiteral:function(K){this.opcode("pushLiteral",K.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(K){var Z=K.pairs,Q=0,J=Z.length;for(this.opcode("pushHash");Q<J;Q++)this.pushParam(Z[Q].value);for(;Q--;)this.opcode("assignToHash",Z[Q].key);this.opcode("popHash")},opcode:function(K){this.opcodes.push({opcode:K,args:D.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(K){K&&(this.useDepths=!0)},classifySexpr:function(K){var Z=I.default.helpers.simpleId(K.path),Q=Z&&!!this.blockParamIndex(K.path.parts[0]),J=!Q&&I.default.helpers.helperExpression(K),re=!Q&&(J||Z);if(re&&!J){var se=K.path.parts[0],oe=this.options;oe.knownHelpers[se]?J=!0:oe.knownHelpersOnly&&(re=!1)}return J?"helper":re?"ambiguous":"simple"},pushParams:function(K){for(var Z=0,Q=K.length;Z<Q;Z++)this.pushParam(K[Z])},pushParam:function(K){var Z=K.value!=null?K.value:K.original||"";if(this.stringParams)Z.replace&&(Z=Z.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),K.depth&&this.addDepth(K.depth),this.opcode("getContext",K.depth||0),this.opcode("pushStringParam",Z,K.type),K.type==="SubExpression"&&this.accept(K);else{if(this.trackIds){var Q=void 0;if(K.parts&&!I.default.helpers.scopedId(K)&&!K.depth&&(Q=this.blockParamIndex(K.parts[0])),Q){var J=K.parts.slice(1).join(".");this.opcode("pushId","BlockParam",Q,J)}else Z=K.original||Z,Z.replace&&(Z=Z.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",K.type,Z)}this.accept(K)}},setupFullMustacheParams:function(K,Z,Q,J){var re=K.params;return this.pushParams(re),this.opcode("pushProgram",Z),this.opcode("pushProgram",Q),K.hash?this.accept(K.hash):this.opcode("emptyHash",J),re},blockParamIndex:function(K){for(var Z=0,Q=this.options.blockParams.length;Z<Q;Z++){var J=this.options.blockParams[Z],re=J&&w.indexOf(J,K);if(J&&re>=0)return[Z,re]}}};function j(V,K,Z){if(V==null||typeof V!="string"&&V.type!=="Program")throw new g.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+V);K=K||{},"data"in K||(K.data=!0),K.compat&&(K.useDepths=!0);var Q=Z.parse(V,K),J=new Z.Compiler().compile(Q,K);return new Z.JavaScriptCompiler().compile(J,K)}function G(V,K,Z){if(K===void 0&&(K={}),V==null||typeof V!="string"&&V.type!=="Program")throw new g.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+V);K=w.extend({},K),"data"in K||(K.data=!0),K.compat&&(K.useDepths=!0);var Q=void 0;function J(){var se=Z.parse(V,K),oe=new Z.Compiler().compile(se,K),ee=new Z.JavaScriptCompiler().compile(oe,K,void 0,!0);return Z.template(ee)}function re(se,oe){return Q||(Q=J()),Q.call(this,se,oe)}return re._setup=function(se){return Q||(Q=J()),Q._setup(se)},re._child=function(se,oe,ee,ae){return Q||(Q=J()),Q._child(se,oe,ee,ae)},re}function H(V,K){if(V===K)return!0;if(w.isArray(V)&&w.isArray(K)&&V.length===K.length){for(var Z=0;Z<V.length;Z++)if(!H(V[Z],K[Z]))return!1;return!0}}function W(V){if(!V.path.parts){var K=V.path;V.path={type:"PathExpression",data:!1,depth:0,parts:[K.original+""],original:K.original+"",loc:K.loc}}}return compiler}var javascriptCompiler={exports:{}},codeGen={exports:{}},sourceMap={},sourceMapGenerator={},base64Vlq={},base64={},hasRequiredBase64;function requireBase64(){if(hasRequiredBase64)return base64;hasRequiredBase64=1;var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return base64.encode=function(m){if(0<=m&&m<d.length)return d[m];throw new TypeError("Must be between 0 and 63: "+m)},base64.decode=function(m){var g=65,w=90,$=97,I=122,D=48,q=57,j=43,G=47,H=26,W=52;return g<=m&&m<=w?m-g:$<=m&&m<=I?m-$+H:D<=m&&m<=q?m-D+W:m==j?62:m==G?63:-1},base64}var hasRequiredBase64Vlq;function requireBase64Vlq(){if(hasRequiredBase64Vlq)return base64Vlq;hasRequiredBase64Vlq=1;var d=requireBase64(),m=5,g=1<<m,w=g-1,$=g;function I(q){return q<0?(-q<<1)+1:(q<<1)+0}function D(q){var j=(q&1)===1,G=q>>1;return j?-G:G}return base64Vlq.encode=function(j){var G="",H,W=I(j);do H=W&w,W>>>=m,W>0&&(H|=$),G+=d.encode(H);while(W>0);return G},base64Vlq.decode=function(j,G,H){var W=j.length,V=0,K=0,Z,Q;do{if(G>=W)throw new Error("Expected more digits in base 64 VLQ value.");if(Q=d.decode(j.charCodeAt(G++)),Q===-1)throw new Error("Invalid base64 digit: "+j.charAt(G-1));Z=!!(Q&$),Q&=w,V=V+(Q<<K),K+=m}while(Z);H.value=D(V),H.rest=G},base64Vlq}var util$2={},hasRequiredUtil;function requireUtil(){return hasRequiredUtil||(hasRequiredUtil=1,(function(d){function m(ee,ae,ce){if(ae in ee)return ee[ae];if(arguments.length===3)return ce;throw new Error('"'+ae+'" is a required argument.')}d.getArg=m;var g=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,w=/^data:.+\,.+$/;function $(ee){var ae=ee.match(g);return ae?{scheme:ae[1],auth:ae[2],host:ae[3],port:ae[4],path:ae[5]}:null}d.urlParse=$;function I(ee){var ae="";return ee.scheme&&(ae+=ee.scheme+":"),ae+="//",ee.auth&&(ae+=ee.auth+"@"),ee.host&&(ae+=ee.host),ee.port&&(ae+=":"+ee.port),ee.path&&(ae+=ee.path),ae}d.urlGenerate=I;function D(ee){var ae=ee,ce=$(ee);if(ce){if(!ce.path)return ee;ae=ce.path}for(var le=d.isAbsolute(ae),de=ae.split(/\/+/),_e,we=0,pe=de.length-1;pe>=0;pe--)_e=de[pe],_e==="."?de.splice(pe,1):_e===".."?we++:we>0&&(_e===""?(de.splice(pe+1,we),we=0):(de.splice(pe,2),we--));return ae=de.join("/"),ae===""&&(ae=le?"/":"."),ce?(ce.path=ae,I(ce)):ae}d.normalize=D;function q(ee,ae){ee===""&&(ee="."),ae===""&&(ae=".");var ce=$(ae),le=$(ee);if(le&&(ee=le.path||"/"),ce&&!ce.scheme)return le&&(ce.scheme=le.scheme),I(ce);if(ce||ae.match(w))return ae;if(le&&!le.host&&!le.path)return le.host=ae,I(le);var de=ae.charAt(0)==="/"?ae:D(ee.replace(/\/+$/,"")+"/"+ae);return le?(le.path=de,I(le)):de}d.join=q,d.isAbsolute=function(ee){return ee.charAt(0)==="/"||g.test(ee)};function j(ee,ae){ee===""&&(ee="."),ee=ee.replace(/\/$/,"");for(var ce=0;ae.indexOf(ee+"/")!==0;){var le=ee.lastIndexOf("/");if(le<0||(ee=ee.slice(0,le),ee.match(/^([^\/]+:\/)?\/*$/)))return ae;++ce}return Array(ce+1).join("../")+ae.substr(ee.length+1)}d.relative=j;var G=(function(){var ee=Object.create(null);return!("__proto__"in ee)})();function H(ee){return ee}function W(ee){return K(ee)?"$"+ee:ee}d.toSetString=G?H:W;function V(ee){return K(ee)?ee.slice(1):ee}d.fromSetString=G?H:V;function K(ee){if(!ee)return!1;var ae=ee.length;if(ae<9||ee.charCodeAt(ae-1)!==95||ee.charCodeAt(ae-2)!==95||ee.charCodeAt(ae-3)!==111||ee.charCodeAt(ae-4)!==116||ee.charCodeAt(ae-5)!==111||ee.charCodeAt(ae-6)!==114||ee.charCodeAt(ae-7)!==112||ee.charCodeAt(ae-8)!==95||ee.charCodeAt(ae-9)!==95)return!1;for(var ce=ae-10;ce>=0;ce--)if(ee.charCodeAt(ce)!==36)return!1;return!0}function Z(ee,ae,ce){var le=J(ee.source,ae.source);return le!==0||(le=ee.originalLine-ae.originalLine,le!==0)||(le=ee.originalColumn-ae.originalColumn,le!==0||ce)||(le=ee.generatedColumn-ae.generatedColumn,le!==0)||(le=ee.generatedLine-ae.generatedLine,le!==0)?le:J(ee.name,ae.name)}d.compareByOriginalPositions=Z;function Q(ee,ae,ce){var le=ee.generatedLine-ae.generatedLine;return le!==0||(le=ee.generatedColumn-ae.generatedColumn,le!==0||ce)||(le=J(ee.source,ae.source),le!==0)||(le=ee.originalLine-ae.originalLine,le!==0)||(le=ee.originalColumn-ae.originalColumn,le!==0)?le:J(ee.name,ae.name)}d.compareByGeneratedPositionsDeflated=Q;function J(ee,ae){return ee===ae?0:ee===null?1:ae===null?-1:ee>ae?1:-1}function re(ee,ae){var ce=ee.generatedLine-ae.generatedLine;return ce!==0||(ce=ee.generatedColumn-ae.generatedColumn,ce!==0)||(ce=J(ee.source,ae.source),ce!==0)||(ce=ee.originalLine-ae.originalLine,ce!==0)||(ce=ee.originalColumn-ae.originalColumn,ce!==0)?ce:J(ee.name,ae.name)}d.compareByGeneratedPositionsInflated=re;function se(ee){return JSON.parse(ee.replace(/^\)]}'[^\n]*\n/,""))}d.parseSourceMapInput=se;function oe(ee,ae,ce){if(ae=ae||"",ee&&(ee[ee.length-1]!=="/"&&ae[0]!=="/"&&(ee+="/"),ae=ee+ae),ce){var le=$(ce);if(!le)throw new Error("sourceMapURL could not be parsed");if(le.path){var de=le.path.lastIndexOf("/");de>=0&&(le.path=le.path.substring(0,de+1))}ae=q(I(le),ae)}return D(ae)}d.computeSourceURL=oe})(util$2)),util$2}var arraySet={},hasRequiredArraySet;function requireArraySet(){if(hasRequiredArraySet)return arraySet;hasRequiredArraySet=1;var d=requireUtil(),m=Object.prototype.hasOwnProperty,g=typeof Map<"u";function w(){this._array=[],this._set=g?new Map:Object.create(null)}return w.fromArray=function(I,D){for(var q=new w,j=0,G=I.length;j<G;j++)q.add(I[j],D);return q},w.prototype.size=function(){return g?this._set.size:Object.getOwnPropertyNames(this._set).length},w.prototype.add=function(I,D){var q=g?I:d.toSetString(I),j=g?this.has(I):m.call(this._set,q),G=this._array.length;(!j||D)&&this._array.push(I),j||(g?this._set.set(I,G):this._set[q]=G)},w.prototype.has=function(I){if(g)return this._set.has(I);var D=d.toSetString(I);return m.call(this._set,D)},w.prototype.indexOf=function(I){if(g){var D=this._set.get(I);if(D>=0)return D}else{var q=d.toSetString(I);if(m.call(this._set,q))return this._set[q]}throw new Error('"'+I+'" is not in the set.')},w.prototype.at=function(I){if(I>=0&&I<this._array.length)return this._array[I];throw new Error("No element indexed by "+I)},w.prototype.toArray=function(){return this._array.slice()},arraySet.ArraySet=w,arraySet}var mappingList={},hasRequiredMappingList;function requireMappingList(){if(hasRequiredMappingList)return mappingList;hasRequiredMappingList=1;var d=requireUtil();function m(w,$){var I=w.generatedLine,D=$.generatedLine,q=w.generatedColumn,j=$.generatedColumn;return D>I||D==I&&j>=q||d.compareByGeneratedPositionsInflated(w,$)<=0}function g(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return g.prototype.unsortedForEach=function($,I){this._array.forEach($,I)},g.prototype.add=function($){m(this._last,$)?(this._last=$,this._array.push($)):(this._sorted=!1,this._array.push($))},g.prototype.toArray=function(){return this._sorted||(this._array.sort(d.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},mappingList.MappingList=g,mappingList}var hasRequiredSourceMapGenerator;function requireSourceMapGenerator(){if(hasRequiredSourceMapGenerator)return sourceMapGenerator;hasRequiredSourceMapGenerator=1;var d=requireBase64Vlq(),m=requireUtil(),g=requireArraySet().ArraySet,w=requireMappingList().MappingList;function $(I){I||(I={}),this._file=m.getArg(I,"file",null),this._sourceRoot=m.getArg(I,"sourceRoot",null),this._skipValidation=m.getArg(I,"skipValidation",!1),this._sources=new g,this._names=new g,this._mappings=new w,this._sourcesContents=null}return $.prototype._version=3,$.fromSourceMap=function(D){var q=D.sourceRoot,j=new $({file:D.file,sourceRoot:q});return D.eachMapping(function(G){var H={generated:{line:G.generatedLine,column:G.generatedColumn}};G.source!=null&&(H.source=G.source,q!=null&&(H.source=m.relative(q,H.source)),H.original={line:G.originalLine,column:G.originalColumn},G.name!=null&&(H.name=G.name)),j.addMapping(H)}),D.sources.forEach(function(G){var H=G;q!==null&&(H=m.relative(q,G)),j._sources.has(H)||j._sources.add(H);var W=D.sourceContentFor(G);W!=null&&j.setSourceContent(G,W)}),j},$.prototype.addMapping=function(D){var q=m.getArg(D,"generated"),j=m.getArg(D,"original",null),G=m.getArg(D,"source",null),H=m.getArg(D,"name",null);this._skipValidation||this._validateMapping(q,j,G,H),G!=null&&(G=String(G),this._sources.has(G)||this._sources.add(G)),H!=null&&(H=String(H),this._names.has(H)||this._names.add(H)),this._mappings.add({generatedLine:q.line,generatedColumn:q.column,originalLine:j!=null&&j.line,originalColumn:j!=null&&j.column,source:G,name:H})},$.prototype.setSourceContent=function(D,q){var j=D;this._sourceRoot!=null&&(j=m.relative(this._sourceRoot,j)),q!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[m.toSetString(j)]=q):this._sourcesContents&&(delete this._sourcesContents[m.toSetString(j)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},$.prototype.applySourceMap=function(D,q,j){var G=q;if(q==null){if(D.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);G=D.file}var H=this._sourceRoot;H!=null&&(G=m.relative(H,G));var W=new g,V=new g;this._mappings.unsortedForEach(function(K){if(K.source===G&&K.originalLine!=null){var Z=D.originalPositionFor({line:K.originalLine,column:K.originalColumn});Z.source!=null&&(K.source=Z.source,j!=null&&(K.source=m.join(j,K.source)),H!=null&&(K.source=m.relative(H,K.source)),K.originalLine=Z.line,K.originalColumn=Z.column,Z.name!=null&&(K.name=Z.name))}var Q=K.source;Q!=null&&!W.has(Q)&&W.add(Q);var J=K.name;J!=null&&!V.has(J)&&V.add(J)},this),this._sources=W,this._names=V,D.sources.forEach(function(K){var Z=D.sourceContentFor(K);Z!=null&&(j!=null&&(K=m.join(j,K)),H!=null&&(K=m.relative(H,K)),this.setSourceContent(K,Z))},this)},$.prototype._validateMapping=function(D,q,j,G){if(q&&typeof q.line!="number"&&typeof q.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(D&&"line"in D&&"column"in D&&D.line>0&&D.column>=0&&!q&&!j&&!G)){if(D&&"line"in D&&"column"in D&&q&&"line"in q&&"column"in q&&D.line>0&&D.column>=0&&q.line>0&&q.column>=0&&j)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:D,source:j,original:q,name:G}))}},$.prototype._serializeMappings=function(){for(var D=0,q=1,j=0,G=0,H=0,W=0,V="",K,Z,Q,J,re=this._mappings.toArray(),se=0,oe=re.length;se<oe;se++){if(Z=re[se],K="",Z.generatedLine!==q)for(D=0;Z.generatedLine!==q;)K+=";",q++;else if(se>0){if(!m.compareByGeneratedPositionsInflated(Z,re[se-1]))continue;K+=","}K+=d.encode(Z.generatedColumn-D),D=Z.generatedColumn,Z.source!=null&&(J=this._sources.indexOf(Z.source),K+=d.encode(J-W),W=J,K+=d.encode(Z.originalLine-1-G),G=Z.originalLine-1,K+=d.encode(Z.originalColumn-j),j=Z.originalColumn,Z.name!=null&&(Q=this._names.indexOf(Z.name),K+=d.encode(Q-H),H=Q)),V+=K}return V},$.prototype._generateSourcesContent=function(D,q){return D.map(function(j){if(!this._sourcesContents)return null;q!=null&&(j=m.relative(q,j));var G=m.toSetString(j);return Object.prototype.hasOwnProperty.call(this._sourcesContents,G)?this._sourcesContents[G]:null},this)},$.prototype.toJSON=function(){var D={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(D.file=this._file),this._sourceRoot!=null&&(D.sourceRoot=this._sourceRoot),this._sourcesContents&&(D.sourcesContent=this._generateSourcesContent(D.sources,D.sourceRoot)),D},$.prototype.toString=function(){return JSON.stringify(this.toJSON())},sourceMapGenerator.SourceMapGenerator=$,sourceMapGenerator}var sourceMapConsumer={},binarySearch={},hasRequiredBinarySearch;function requireBinarySearch(){return hasRequiredBinarySearch||(hasRequiredBinarySearch=1,(function(d){d.GREATEST_LOWER_BOUND=1,d.LEAST_UPPER_BOUND=2;function m(g,w,$,I,D,q){var j=Math.floor((w-g)/2)+g,G=D($,I[j],!0);return G===0?j:G>0?w-j>1?m(j,w,$,I,D,q):q==d.LEAST_UPPER_BOUND?w<I.length?w:-1:j:j-g>1?m(g,j,$,I,D,q):q==d.LEAST_UPPER_BOUND?j:g<0?-1:g}d.search=function(w,$,I,D){if($.length===0)return-1;var q=m(-1,$.length,w,$,I,D||d.GREATEST_LOWER_BOUND);if(q<0)return-1;for(;q-1>=0&&I($[q],$[q-1],!0)===0;)--q;return q}})(binarySearch)),binarySearch}var quickSort={},hasRequiredQuickSort;function requireQuickSort(){if(hasRequiredQuickSort)return quickSort;hasRequiredQuickSort=1;function d(w,$,I){var D=w[$];w[$]=w[I],w[I]=D}function m(w,$){return Math.round(w+Math.random()*($-w))}function g(w,$,I,D){if(I<D){var q=m(I,D),j=I-1;d(w,q,D);for(var G=w[D],H=I;H<D;H++)$(w[H],G)<=0&&(j+=1,d(w,j,H));d(w,j+1,H);var W=j+1;g(w,$,I,W-1),g(w,$,W+1,D)}}return quickSort.quickSort=function(w,$){g(w,$,0,w.length-1)},quickSort}var hasRequiredSourceMapConsumer;function requireSourceMapConsumer(){if(hasRequiredSourceMapConsumer)return sourceMapConsumer;hasRequiredSourceMapConsumer=1;var d=requireUtil(),m=requireBinarySearch(),g=requireArraySet().ArraySet,w=requireBase64Vlq(),$=requireQuickSort().quickSort;function I(G,H){var W=G;return typeof G=="string"&&(W=d.parseSourceMapInput(G)),W.sections!=null?new j(W,H):new D(W,H)}I.fromSourceMap=function(G,H){return D.fromSourceMap(G,H)},I.prototype._version=3,I.prototype.__generatedMappings=null,Object.defineProperty(I.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),I.prototype.__originalMappings=null,Object.defineProperty(I.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),I.prototype._charIsMappingSeparator=function(H,W){var V=H.charAt(W);return V===";"||V===","},I.prototype._parseMappings=function(H,W){throw new Error("Subclasses must implement _parseMappings")},I.GENERATED_ORDER=1,I.ORIGINAL_ORDER=2,I.GREATEST_LOWER_BOUND=1,I.LEAST_UPPER_BOUND=2,I.prototype.eachMapping=function(H,W,V){var K=W||null,Z=V||I.GENERATED_ORDER,Q;switch(Z){case I.GENERATED_ORDER:Q=this._generatedMappings;break;case I.ORIGINAL_ORDER:Q=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var J=this.sourceRoot;Q.map(function(re){var se=re.source===null?null:this._sources.at(re.source);return se=d.computeSourceURL(J,se,this._sourceMapURL),{source:se,generatedLine:re.generatedLine,generatedColumn:re.generatedColumn,originalLine:re.originalLine,originalColumn:re.originalColumn,name:re.name===null?null:this._names.at(re.name)}},this).forEach(H,K)},I.prototype.allGeneratedPositionsFor=function(H){var W=d.getArg(H,"line"),V={source:d.getArg(H,"source"),originalLine:W,originalColumn:d.getArg(H,"column",0)};if(V.source=this._findSourceIndex(V.source),V.source<0)return[];var K=[],Z=this._findMapping(V,this._originalMappings,"originalLine","originalColumn",d.compareByOriginalPositions,m.LEAST_UPPER_BOUND);if(Z>=0){var Q=this._originalMappings[Z];if(H.column===void 0)for(var J=Q.originalLine;Q&&Q.originalLine===J;)K.push({line:d.getArg(Q,"generatedLine",null),column:d.getArg(Q,"generatedColumn",null),lastColumn:d.getArg(Q,"lastGeneratedColumn",null)}),Q=this._originalMappings[++Z];else for(var re=Q.originalColumn;Q&&Q.originalLine===W&&Q.originalColumn==re;)K.push({line:d.getArg(Q,"generatedLine",null),column:d.getArg(Q,"generatedColumn",null),lastColumn:d.getArg(Q,"lastGeneratedColumn",null)}),Q=this._originalMappings[++Z]}return K},sourceMapConsumer.SourceMapConsumer=I;function D(G,H){var W=G;typeof G=="string"&&(W=d.parseSourceMapInput(G));var V=d.getArg(W,"version"),K=d.getArg(W,"sources"),Z=d.getArg(W,"names",[]),Q=d.getArg(W,"sourceRoot",null),J=d.getArg(W,"sourcesContent",null),re=d.getArg(W,"mappings"),se=d.getArg(W,"file",null);if(V!=this._version)throw new Error("Unsupported version: "+V);Q&&(Q=d.normalize(Q)),K=K.map(String).map(d.normalize).map(function(oe){return Q&&d.isAbsolute(Q)&&d.isAbsolute(oe)?d.relative(Q,oe):oe}),this._names=g.fromArray(Z.map(String),!0),this._sources=g.fromArray(K,!0),this._absoluteSources=this._sources.toArray().map(function(oe){return d.computeSourceURL(Q,oe,H)}),this.sourceRoot=Q,this.sourcesContent=J,this._mappings=re,this._sourceMapURL=H,this.file=se}D.prototype=Object.create(I.prototype),D.prototype.consumer=I,D.prototype._findSourceIndex=function(G){var H=G;if(this.sourceRoot!=null&&(H=d.relative(this.sourceRoot,H)),this._sources.has(H))return this._sources.indexOf(H);var W;for(W=0;W<this._absoluteSources.length;++W)if(this._absoluteSources[W]==G)return W;return-1},D.fromSourceMap=function(H,W){var V=Object.create(D.prototype),K=V._names=g.fromArray(H._names.toArray(),!0),Z=V._sources=g.fromArray(H._sources.toArray(),!0);V.sourceRoot=H._sourceRoot,V.sourcesContent=H._generateSourcesContent(V._sources.toArray(),V.sourceRoot),V.file=H._file,V._sourceMapURL=W,V._absoluteSources=V._sources.toArray().map(function(ce){return d.computeSourceURL(V.sourceRoot,ce,W)});for(var Q=H._mappings.toArray().slice(),J=V.__generatedMappings=[],re=V.__originalMappings=[],se=0,oe=Q.length;se<oe;se++){var ee=Q[se],ae=new q;ae.generatedLine=ee.generatedLine,ae.generatedColumn=ee.generatedColumn,ee.source&&(ae.source=Z.indexOf(ee.source),ae.originalLine=ee.originalLine,ae.originalColumn=ee.originalColumn,ee.name&&(ae.name=K.indexOf(ee.name)),re.push(ae)),J.push(ae)}return $(V.__originalMappings,d.compareByOriginalPositions),V},D.prototype._version=3,Object.defineProperty(D.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function q(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}D.prototype._parseMappings=function(H,W){for(var V=1,K=0,Z=0,Q=0,J=0,re=0,se=H.length,oe=0,ee={},ae={},ce=[],le=[],de,_e,we,pe,xe;oe<se;)if(H.charAt(oe)===";")V++,oe++,K=0;else if(H.charAt(oe)===",")oe++;else{for(de=new q,de.generatedLine=V,pe=oe;pe<se&&!this._charIsMappingSeparator(H,pe);pe++);if(_e=H.slice(oe,pe),we=ee[_e],we)oe+=_e.length;else{for(we=[];oe<pe;)w.decode(H,oe,ae),xe=ae.value,oe=ae.rest,we.push(xe);if(we.length===2)throw new Error("Found a source, but no line and column");if(we.length===3)throw new Error("Found a source and line, but no column");ee[_e]=we}de.generatedColumn=K+we[0],K=de.generatedColumn,we.length>1&&(de.source=J+we[1],J+=we[1],de.originalLine=Z+we[2],Z=de.originalLine,de.originalLine+=1,de.originalColumn=Q+we[3],Q=de.originalColumn,we.length>4&&(de.name=re+we[4],re+=we[4])),le.push(de),typeof de.originalLine=="number"&&ce.push(de)}$(le,d.compareByGeneratedPositionsDeflated),this.__generatedMappings=le,$(ce,d.compareByOriginalPositions),this.__originalMappings=ce},D.prototype._findMapping=function(H,W,V,K,Z,Q){if(H[V]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+H[V]);if(H[K]<0)throw new TypeError("Column must be greater than or equal to 0, got "+H[K]);return m.search(H,W,Z,Q)},D.prototype.computeColumnSpans=function(){for(var H=0;H<this._generatedMappings.length;++H){var W=this._generatedMappings[H];if(H+1<this._generatedMappings.length){var V=this._generatedMappings[H+1];if(W.generatedLine===V.generatedLine){W.lastGeneratedColumn=V.generatedColumn-1;continue}}W.lastGeneratedColumn=1/0}},D.prototype.originalPositionFor=function(H){var W={generatedLine:d.getArg(H,"line"),generatedColumn:d.getArg(H,"column")},V=this._findMapping(W,this._generatedMappings,"generatedLine","generatedColumn",d.compareByGeneratedPositionsDeflated,d.getArg(H,"bias",I.GREATEST_LOWER_BOUND));if(V>=0){var K=this._generatedMappings[V];if(K.generatedLine===W.generatedLine){var Z=d.getArg(K,"source",null);Z!==null&&(Z=this._sources.at(Z),Z=d.computeSourceURL(this.sourceRoot,Z,this._sourceMapURL));var Q=d.getArg(K,"name",null);return Q!==null&&(Q=this._names.at(Q)),{source:Z,line:d.getArg(K,"originalLine",null),column:d.getArg(K,"originalColumn",null),name:Q}}}return{source:null,line:null,column:null,name:null}},D.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(H){return H==null}):!1},D.prototype.sourceContentFor=function(H,W){if(!this.sourcesContent)return null;var V=this._findSourceIndex(H);if(V>=0)return this.sourcesContent[V];var K=H;this.sourceRoot!=null&&(K=d.relative(this.sourceRoot,K));var Z;if(this.sourceRoot!=null&&(Z=d.urlParse(this.sourceRoot))){var Q=K.replace(/^file:\/\//,"");if(Z.scheme=="file"&&this._sources.has(Q))return this.sourcesContent[this._sources.indexOf(Q)];if((!Z.path||Z.path=="/")&&this._sources.has("/"+K))return this.sourcesContent[this._sources.indexOf("/"+K)]}if(W)return null;throw new Error('"'+K+'" is not in the SourceMap.')},D.prototype.generatedPositionFor=function(H){var W=d.getArg(H,"source");if(W=this._findSourceIndex(W),W<0)return{line:null,column:null,lastColumn:null};var V={source:W,originalLine:d.getArg(H,"line"),originalColumn:d.getArg(H,"column")},K=this._findMapping(V,this._originalMappings,"originalLine","originalColumn",d.compareByOriginalPositions,d.getArg(H,"bias",I.GREATEST_LOWER_BOUND));if(K>=0){var Z=this._originalMappings[K];if(Z.source===V.source)return{line:d.getArg(Z,"generatedLine",null),column:d.getArg(Z,"generatedColumn",null),lastColumn:d.getArg(Z,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},sourceMapConsumer.BasicSourceMapConsumer=D;function j(G,H){var W=G;typeof G=="string"&&(W=d.parseSourceMapInput(G));var V=d.getArg(W,"version"),K=d.getArg(W,"sections");if(V!=this._version)throw new Error("Unsupported version: "+V);this._sources=new g,this._names=new g;var Z={line:-1,column:0};this._sections=K.map(function(Q){if(Q.url)throw new Error("Support for url field in sections not implemented.");var J=d.getArg(Q,"offset"),re=d.getArg(J,"line"),se=d.getArg(J,"column");if(re<Z.line||re===Z.line&&se<Z.column)throw new Error("Section offsets must be ordered and non-overlapping.");return Z=J,{generatedOffset:{generatedLine:re+1,generatedColumn:se+1},consumer:new I(d.getArg(Q,"map"),H)}})}return j.prototype=Object.create(I.prototype),j.prototype.constructor=I,j.prototype._version=3,Object.defineProperty(j.prototype,"sources",{get:function(){for(var G=[],H=0;H<this._sections.length;H++)for(var W=0;W<this._sections[H].consumer.sources.length;W++)G.push(this._sections[H].consumer.sources[W]);return G}}),j.prototype.originalPositionFor=function(H){var W={generatedLine:d.getArg(H,"line"),generatedColumn:d.getArg(H,"column")},V=m.search(W,this._sections,function(Z,Q){var J=Z.generatedLine-Q.generatedOffset.generatedLine;return J||Z.generatedColumn-Q.generatedOffset.generatedColumn}),K=this._sections[V];return K?K.consumer.originalPositionFor({line:W.generatedLine-(K.generatedOffset.generatedLine-1),column:W.generatedColumn-(K.generatedOffset.generatedLine===W.generatedLine?K.generatedOffset.generatedColumn-1:0),bias:H.bias}):{source:null,line:null,column:null,name:null}},j.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(H){return H.consumer.hasContentsOfAllSources()})},j.prototype.sourceContentFor=function(H,W){for(var V=0;V<this._sections.length;V++){var K=this._sections[V],Z=K.consumer.sourceContentFor(H,!0);if(Z)return Z}if(W)return null;throw new Error('"'+H+'" is not in the SourceMap.')},j.prototype.generatedPositionFor=function(H){for(var W=0;W<this._sections.length;W++){var V=this._sections[W];if(V.consumer._findSourceIndex(d.getArg(H,"source"))!==-1){var K=V.consumer.generatedPositionFor(H);if(K){var Z={line:K.line+(V.generatedOffset.generatedLine-1),column:K.column+(V.generatedOffset.generatedLine===K.line?V.generatedOffset.generatedColumn-1:0)};return Z}}}return{line:null,column:null}},j.prototype._parseMappings=function(H,W){this.__generatedMappings=[],this.__originalMappings=[];for(var V=0;V<this._sections.length;V++)for(var K=this._sections[V],Z=K.consumer._generatedMappings,Q=0;Q<Z.length;Q++){var J=Z[Q],re=K.consumer._sources.at(J.source);re=d.computeSourceURL(K.consumer.sourceRoot,re,this._sourceMapURL),this._sources.add(re),re=this._sources.indexOf(re);var se=null;J.name&&(se=K.consumer._names.at(J.name),this._names.add(se),se=this._names.indexOf(se));var oe={source:re,generatedLine:J.generatedLine+(K.generatedOffset.generatedLine-1),generatedColumn:J.generatedColumn+(K.generatedOffset.generatedLine===J.generatedLine?K.generatedOffset.generatedColumn-1:0),originalLine:J.originalLine,originalColumn:J.originalColumn,name:se};this.__generatedMappings.push(oe),typeof oe.originalLine=="number"&&this.__originalMappings.push(oe)}$(this.__generatedMappings,d.compareByGeneratedPositionsDeflated),$(this.__originalMappings,d.compareByOriginalPositions)},sourceMapConsumer.IndexedSourceMapConsumer=j,sourceMapConsumer}var sourceNode={},hasRequiredSourceNode;function requireSourceNode(){if(hasRequiredSourceNode)return sourceNode;hasRequiredSourceNode=1;var d=requireSourceMapGenerator().SourceMapGenerator,m=requireUtil(),g=/(\r?\n)/,w=10,$="$$$isSourceNode$$$";function I(D,q,j,G,H){this.children=[],this.sourceContents={},this.line=D??null,this.column=q??null,this.source=j??null,this.name=H??null,this[$]=!0,G!=null&&this.add(G)}return I.fromStringWithSourceMap=function(q,j,G){var H=new I,W=q.split(g),V=0,K=function(){var se=ee(),oe=ee()||"";return se+oe;function ee(){return V<W.length?W[V++]:void 0}},Z=1,Q=0,J=null;return j.eachMapping(function(se){if(J!==null)if(Z<se.generatedLine)re(J,K()),Z++,Q=0;else{var oe=W[V]||"",ee=oe.substr(0,se.generatedColumn-Q);W[V]=oe.substr(se.generatedColumn-Q),Q=se.generatedColumn,re(J,ee),J=se;return}for(;Z<se.generatedLine;)H.add(K()),Z++;if(Q<se.generatedColumn){var oe=W[V]||"";H.add(oe.substr(0,se.generatedColumn)),W[V]=oe.substr(se.generatedColumn),Q=se.generatedColumn}J=se},this),V<W.length&&(J&&re(J,K()),H.add(W.splice(V).join(""))),j.sources.forEach(function(se){var oe=j.sourceContentFor(se);oe!=null&&(G!=null&&(se=m.join(G,se)),H.setSourceContent(se,oe))}),H;function re(se,oe){if(se===null||se.source===void 0)H.add(oe);else{var ee=G?m.join(G,se.source):se.source;H.add(new I(se.originalLine,se.originalColumn,ee,oe,se.name))}}},I.prototype.add=function(q){if(Array.isArray(q))q.forEach(function(j){this.add(j)},this);else if(q[$]||typeof q=="string")q&&this.children.push(q);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+q);return this},I.prototype.prepend=function(q){if(Array.isArray(q))for(var j=q.length-1;j>=0;j--)this.prepend(q[j]);else if(q[$]||typeof q=="string")this.children.unshift(q);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+q);return this},I.prototype.walk=function(q){for(var j,G=0,H=this.children.length;G<H;G++)j=this.children[G],j[$]?j.walk(q):j!==""&&q(j,{source:this.source,line:this.line,column:this.column,name:this.name})},I.prototype.join=function(q){var j,G,H=this.children.length;if(H>0){for(j=[],G=0;G<H-1;G++)j.push(this.children[G]),j.push(q);j.push(this.children[G]),this.children=j}return this},I.prototype.replaceRight=function(q,j){var G=this.children[this.children.length-1];return G[$]?G.replaceRight(q,j):typeof G=="string"?this.children[this.children.length-1]=G.replace(q,j):this.children.push("".replace(q,j)),this},I.prototype.setSourceContent=function(q,j){this.sourceContents[m.toSetString(q)]=j},I.prototype.walkSourceContents=function(q){for(var j=0,G=this.children.length;j<G;j++)this.children[j][$]&&this.children[j].walkSourceContents(q);for(var H=Object.keys(this.sourceContents),j=0,G=H.length;j<G;j++)q(m.fromSetString(H[j]),this.sourceContents[H[j]])},I.prototype.toString=function(){var q="";return this.walk(function(j){q+=j}),q},I.prototype.toStringWithSourceMap=function(q){var j={code:"",line:1,column:0},G=new d(q),H=!1,W=null,V=null,K=null,Z=null;return this.walk(function(Q,J){j.code+=Q,J.source!==null&&J.line!==null&&J.column!==null?((W!==J.source||V!==J.line||K!==J.column||Z!==J.name)&&G.addMapping({source:J.source,original:{line:J.line,column:J.column},generated:{line:j.line,column:j.column},name:J.name}),W=J.source,V=J.line,K=J.column,Z=J.name,H=!0):H&&(G.addMapping({generated:{line:j.line,column:j.column}}),W=null,H=!1);for(var re=0,se=Q.length;re<se;re++)Q.charCodeAt(re)===w?(j.line++,j.column=0,re+1===se?(W=null,H=!1):H&&G.addMapping({source:J.source,original:{line:J.line,column:J.column},generated:{line:j.line,column:j.column},name:J.name})):j.column++}),this.walkSourceContents(function(Q,J){G.setSourceContent(Q,J)}),{code:j.code,map:G}},sourceNode.SourceNode=I,sourceNode}var hasRequiredSourceMap;function requireSourceMap(){return hasRequiredSourceMap||(hasRequiredSourceMap=1,sourceMap.SourceMapGenerator=requireSourceMapGenerator().SourceMapGenerator,sourceMap.SourceMapConsumer=requireSourceMapConsumer().SourceMapConsumer,sourceMap.SourceNode=requireSourceNode().SourceNode),sourceMap}var hasRequiredCodeGen;function requireCodeGen(){return hasRequiredCodeGen||(hasRequiredCodeGen=1,(function(d,m){m.__esModule=!0;var g=requireUtils(),w=void 0;try{var $=requireSourceMap();w=$.SourceNode}catch{}w||(w=function(q,j,G,H){this.src="",H&&this.add(H)},w.prototype={add:function(j){g.isArray(j)&&(j=j.join("")),this.src+=j},prepend:function(j){g.isArray(j)&&(j=j.join("")),this.src=j+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}});function I(q,j,G){if(g.isArray(q)){for(var H=[],W=0,V=q.length;W<V;W++)H.push(j.wrap(q[W],G));return H}else if(typeof q=="boolean"||typeof q=="number")return q+"";return q}function D(q){this.srcFile=q,this.source=[]}D.prototype={isEmpty:function(){return!this.source.length},prepend:function(j,G){this.source.unshift(this.wrap(j,G))},push:function(j,G){this.source.push(this.wrap(j,G))},merge:function(){var j=this.empty();return this.each(function(G){j.add(["  ",G,`
`])}),j},each:function(j){for(var G=0,H=this.source.length;G<H;G++)j(this.source[G])},empty:function(){var j=this.currentLocation||{start:{}};return new w(j.start.line,j.start.column,this.srcFile)},wrap:function(j){var G=arguments.length<=1||arguments[1]===void 0?this.currentLocation||{start:{}}:arguments[1];return j instanceof w?j:(j=I(j,this,G),new w(G.start.line,G.start.column,this.srcFile,j))},functionCall:function(j,G,H){return H=this.generateList(H),this.wrap([j,G?"."+G+"(":"(",H,")"])},quotedString:function(j){return'"'+(j+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(j){var G=this,H=[];Object.keys(j).forEach(function(V){var K=I(j[V],G);K!=="undefined"&&H.push([G.quotedString(V),":",K])});var W=this.generateList(H);return W.prepend("{"),W.add("}"),W},generateList:function(j){for(var G=this.empty(),H=0,W=j.length;H<W;H++)H&&G.add(","),G.add(I(j[H],this));return G},generateArray:function(j){var G=this.generateList(j);return G.prepend("["),G.add("]"),G}},m.default=D,d.exports=m.default})(codeGen,codeGen.exports)),codeGen.exports}var hasRequiredJavascriptCompiler;function requireJavascriptCompiler(){return hasRequiredJavascriptCompiler||(hasRequiredJavascriptCompiler=1,(function(d,m){m.__esModule=!0;function g(V){return V&&V.__esModule?V:{default:V}}var w=requireBase$1(),$=requireException(),I=g($),D=requireUtils(),q=requireCodeGen(),j=g(q);function G(V){this.value=V}function H(){}H.prototype={nameLookup:function(K,Z){return this.internalNameLookup(K,Z)},depthedLookup:function(K){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(K),")"]},compilerInfo:function(){var K=w.COMPILER_REVISION,Z=w.REVISION_CHANGES[K];return[K,Z]},appendToBuffer:function(K,Z,Q){return D.isArray(K)||(K=[K]),K=this.source.wrap(K,Z),this.environment.isSimple?["return ",K,";"]:Q?["buffer += ",K,";"]:(K.appendToBuffer=!0,K)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(K,Z){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",K,",",JSON.stringify(Z),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(K,Z,Q,J){this.environment=K,this.options=Z,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!J,this.name=this.environment.name,this.isChild=!!Q,this.context=Q||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(K,Z),this.useDepths=this.useDepths||K.useDepths||K.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||K.useBlockParams;var re=K.opcodes,se=void 0,oe=void 0,ee=void 0,ae=void 0;for(ee=0,ae=re.length;ee<ae;ee++)se=re[ee],this.source.currentLocation=se.loc,oe=oe||se.loc,this[se.opcode].apply(this,se.args);if(this.source.currentLocation=oe,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new I.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),`;
`]),this.decorators.push("return fn;"),J?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend(`function(fn, props, container, depth0, data, blockParams, depths) {
`),this.decorators.push(`}
`),this.decorators=this.decorators.merge()));var ce=this.createFunctionContext(J);if(this.isChild)return ce;var le={compiler:this.compilerInfo(),main:ce};this.decorators&&(le.main_d=this.decorators,le.useDecorators=!0);var de=this.context,_e=de.programs,we=de.decorators;for(ee=0,ae=_e.length;ee<ae;ee++)_e[ee]&&(le[ee]=_e[ee],we[ee]&&(le[ee+"_d"]=we[ee],le.useDecorators=!0));return this.environment.usePartial&&(le.usePartial=!0),this.options.data&&(le.useData=!0),this.useDepths&&(le.useDepths=!0),this.useBlockParams&&(le.useBlockParams=!0),this.options.compat&&(le.compat=!0),J?le.compilerOptions=this.options:(le.compiler=JSON.stringify(le.compiler),this.source.currentLocation={start:{line:1,column:0}},le=this.objectLiteral(le),Z.srcName?(le=le.toStringWithSourceMap({file:Z.destName}),le.map=le.map&&le.map.toString()):le=le.toString()),le},preamble:function(){this.lastContext=0,this.source=new j.default(this.options.srcName),this.decorators=new j.default(this.options.srcName)},createFunctionContext:function(K){var Z=this,Q="",J=this.stackVars.concat(this.registers.list);J.length>0&&(Q+=", "+J.join(", "));var re=0;Object.keys(this.aliases).forEach(function(ee){var ae=Z.aliases[ee];ae.children&&ae.referenceCount>1&&(Q+=", alias"+ ++re+"="+ee,ae.children[0]="alias"+re)}),this.lookupPropertyFunctionIsUsed&&(Q+=", "+this.lookupPropertyFunctionVarDeclaration());var se=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&se.push("blockParams"),this.useDepths&&se.push("depths");var oe=this.mergeSource(Q);return K?(se.push(oe),Function.apply(this,se)):this.source.wrap(["function(",se.join(","),`) {
  `,oe,"}"])},mergeSource:function(K){var Z=this.environment.isSimple,Q=!this.forceBuffer,J=void 0,re=void 0,se=void 0,oe=void 0;return this.source.each(function(ee){ee.appendToBuffer?(se?ee.prepend("  + "):se=ee,oe=ee):(se&&(re?se.prepend("buffer += "):J=!0,oe.add(";"),se=oe=void 0),re=!0,Z||(Q=!1))}),Q?se?(se.prepend("return "),oe.add(";")):re||this.source.push('return "";'):(K+=", buffer = "+(J?"":this.initializeBuffer()),se?(se.prepend("return buffer + "),oe.add(";")):this.source.push("return buffer;")),K&&this.source.prepend("var "+K.substring(2)+(J?"":`;
`)),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return`
      lookupProperty = container.lookupProperty || function(parent, propertyName) {
        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {
          return parent[propertyName];
        }
        return undefined
    }
    `.trim()},blockValue:function(K){var Z=this.aliasable("container.hooks.blockHelperMissing"),Q=[this.contextName(0)];this.setupHelperArgs(K,0,Q);var J=this.popStack();Q.splice(1,0,J),this.push(this.source.functionCall(Z,"call",Q))},ambiguousBlockValue:function(){var K=this.aliasable("container.hooks.blockHelperMissing"),Z=[this.contextName(0)];this.setupHelperArgs("",0,Z,!0),this.flushInline();var Q=this.topStack();Z.splice(1,0,Q),this.pushSource(["if (!",this.lastHelper,") { ",Q," = ",this.source.functionCall(K,"call",Z),"}"])},appendContent:function(K){this.pendingContent?K=this.pendingContent+K:this.pendingLocation=this.source.currentLocation,this.pendingContent=K},append:function(){if(this.isInline())this.replaceStack(function(Z){return[" != null ? ",Z,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var K=this.popStack();this.pushSource(["if (",K," != null) { ",this.appendToBuffer(K,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(K){this.lastContext=K},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(K,Z,Q,J){var re=0;!J&&this.options.compat&&!this.lastContext?this.push(this.depthedLookup(K[re++])):this.pushContext(),this.resolvePath("context",K,re,Z,Q)},lookupBlockParam:function(K,Z){this.useBlockParams=!0,this.push(["blockParams[",K[0],"][",K[1],"]"]),this.resolvePath("context",Z,1)},lookupData:function(K,Z,Q){K?this.pushStackLiteral("container.data(data, "+K+")"):this.pushStackLiteral("data"),this.resolvePath("data",Z,0,!0,Q)},resolvePath:function(K,Z,Q,J,re){var se=this;if(this.options.strict||this.options.assumeObjects){this.push(W(this.options.strict&&re,this,Z,Q,K));return}for(var oe=Z.length;Q<oe;Q++)this.replaceStack(function(ee){var ae=se.nameLookup(ee,Z[Q],K);return J?[" && ",ae]:[" != null ? ",ae," : ",ee]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(K,Z){this.pushContext(),this.pushString(Z),Z!=="SubExpression"&&(typeof K=="string"?this.pushString(K):this.pushStackLiteral(K))},emptyHash:function(K){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(K?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var K=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(K.ids)),this.stringParams&&(this.push(this.objectLiteral(K.contexts)),this.push(this.objectLiteral(K.types))),this.push(this.objectLiteral(K.values))},pushString:function(K){this.pushStackLiteral(this.quotedString(K))},pushLiteral:function(K){this.pushStackLiteral(K)},pushProgram:function(K){K!=null?this.pushStackLiteral(this.programExpression(K)):this.pushStackLiteral(null)},registerDecorator:function(K,Z){var Q=this.nameLookup("decorators",Z,"decorator"),J=this.setupHelperArgs(Z,K);this.decorators.push(["fn = ",this.decorators.functionCall(Q,"",["fn","props","container",J])," || fn;"])},invokeHelper:function(K,Z,Q){var J=this.popStack(),re=this.setupHelper(K,Z),se=[];Q&&se.push(re.name),se.push(J),this.options.strict||se.push(this.aliasable("container.hooks.helperMissing"));var oe=["(",this.itemsSeparatedBy(se,"||"),")"],ee=this.source.functionCall(oe,"call",re.callParams);this.push(ee)},itemsSeparatedBy:function(K,Z){var Q=[];Q.push(K[0]);for(var J=1;J<K.length;J++)Q.push(Z,K[J]);return Q},invokeKnownHelper:function(K,Z){var Q=this.setupHelper(K,Z);this.push(this.source.functionCall(Q.name,"call",Q.callParams))},invokeAmbiguous:function(K,Z){this.useRegister("helper");var Q=this.popStack();this.emptyHash();var J=this.setupHelper(0,K,Z),re=this.lastHelper=this.nameLookup("helpers",K,"helper"),se=["(","(helper = ",re," || ",Q,")"];this.options.strict||(se[0]="(helper = ",se.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",se,J.paramsInit?["),(",J.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",J.callParams)," : helper))"])},invokePartial:function(K,Z,Q){var J=[],re=this.setupParams(Z,1,J);K&&(Z=this.popStack(),delete re.name),Q&&(re.indent=JSON.stringify(Q)),re.helpers="helpers",re.partials="partials",re.decorators="container.decorators",K?J.unshift(Z):J.unshift(this.nameLookup("partials",Z,"partial")),this.options.compat&&(re.depths="depths"),re=this.objectLiteral(re),J.push(re),this.push(this.source.functionCall("container.invokePartial","",J))},assignToHash:function(K){var Z=this.popStack(),Q=void 0,J=void 0,re=void 0;this.trackIds&&(re=this.popStack()),this.stringParams&&(J=this.popStack(),Q=this.popStack());var se=this.hash;Q&&(se.contexts[K]=Q),J&&(se.types[K]=J),re&&(se.ids[K]=re),se.values[K]=Z},pushId:function(K,Z,Q){K==="BlockParam"?this.pushStackLiteral("blockParams["+Z[0]+"].path["+Z[1]+"]"+(Q?" + "+JSON.stringify("."+Q):"")):K==="PathExpression"?this.pushString(Z):K==="SubExpression"?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:H,compileChildren:function(K,Z){for(var Q=K.children,J=void 0,re=void 0,se=0,oe=Q.length;se<oe;se++){J=Q[se],re=new this.compiler;var ee=this.matchExistingProgram(J);if(ee==null){this.context.programs.push("");var ae=this.context.programs.length;J.index=ae,J.name="program"+ae,this.context.programs[ae]=re.compile(J,Z,this.context,!this.precompile),this.context.decorators[ae]=re.decorators,this.context.environments[ae]=J,this.useDepths=this.useDepths||re.useDepths,this.useBlockParams=this.useBlockParams||re.useBlockParams,J.useDepths=this.useDepths,J.useBlockParams=this.useBlockParams}else J.index=ee.index,J.name="program"+ee.index,this.useDepths=this.useDepths||ee.useDepths,this.useBlockParams=this.useBlockParams||ee.useBlockParams}},matchExistingProgram:function(K){for(var Z=0,Q=this.context.environments.length;Z<Q;Z++){var J=this.context.environments[Z];if(J&&J.equals(K))return J}},programExpression:function(K){var Z=this.environment.children[K],Q=[Z.index,"data",Z.blockParams];return(this.useBlockParams||this.useDepths)&&Q.push("blockParams"),this.useDepths&&Q.push("depths"),"container.program("+Q.join(", ")+")"},useRegister:function(K){this.registers[K]||(this.registers[K]=!0,this.registers.list.push(K))},push:function(K){return K instanceof G||(K=this.source.wrap(K)),this.inlineStack.push(K),K},pushStackLiteral:function(K){this.push(new G(K))},pushSource:function(K){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),K&&this.source.push(K)},replaceStack:function(K){var Z=["("],Q=void 0,J=void 0,re=void 0;if(!this.isInline())throw new I.default("replaceStack on non-inline");var se=this.popStack(!0);if(se instanceof G)Q=[se.value],Z=["(",Q],re=!0;else{J=!0;var oe=this.incrStack();Z=["((",this.push(oe)," = ",se,")"],Q=this.topStack()}var ee=K.call(this,Q);re||this.popStack(),J&&this.stackSlot--,this.push(Z.concat(ee,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var K=this.inlineStack;this.inlineStack=[];for(var Z=0,Q=K.length;Z<Q;Z++){var J=K[Z];if(J instanceof G)this.compileStack.push(J);else{var re=this.incrStack();this.pushSource([re," = ",J,";"]),this.compileStack.push(re)}}},isInline:function(){return this.inlineStack.length},popStack:function(K){var Z=this.isInline(),Q=(Z?this.inlineStack:this.compileStack).pop();if(!K&&Q instanceof G)return Q.value;if(!Z){if(!this.stackSlot)throw new I.default("Invalid stack pop");this.stackSlot--}return Q},topStack:function(){var K=this.isInline()?this.inlineStack:this.compileStack,Z=K[K.length-1];return Z instanceof G?Z.value:Z},contextName:function(K){return this.useDepths&&K?"depths["+K+"]":"depth"+K},quotedString:function(K){return this.source.quotedString(K)},objectLiteral:function(K){return this.source.objectLiteral(K)},aliasable:function(K){var Z=this.aliases[K];return Z?(Z.referenceCount++,Z):(Z=this.aliases[K]=this.source.wrap(K),Z.aliasable=!0,Z.referenceCount=1,Z)},setupHelper:function(K,Z,Q){var J=[],re=this.setupHelperArgs(Z,K,J,Q),se=this.nameLookup("helpers",Z,"helper"),oe=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:J,paramsInit:re,name:se,callParams:[oe].concat(J)}},setupParams:function(K,Z,Q){var J={},re=[],se=[],oe=[],ee=!Q,ae=void 0;ee&&(Q=[]),J.name=this.quotedString(K),J.hash=this.popStack(),this.trackIds&&(J.hashIds=this.popStack()),this.stringParams&&(J.hashTypes=this.popStack(),J.hashContexts=this.popStack());var ce=this.popStack(),le=this.popStack();(le||ce)&&(J.fn=le||"container.noop",J.inverse=ce||"container.noop");for(var de=Z;de--;)ae=this.popStack(),Q[de]=ae,this.trackIds&&(oe[de]=this.popStack()),this.stringParams&&(se[de]=this.popStack(),re[de]=this.popStack());return ee&&(J.args=this.source.generateArray(Q)),this.trackIds&&(J.ids=this.source.generateArray(oe)),this.stringParams&&(J.types=this.source.generateArray(se),J.contexts=this.source.generateArray(re)),this.options.data&&(J.data="data"),this.useBlockParams&&(J.blockParams="blockParams"),J},setupHelperArgs:function(K,Z,Q,J){var re=this.setupParams(K,Z,Q);return re.loc=JSON.stringify(this.source.currentLocation),re=this.objectLiteral(re),J?(this.useRegister("options"),Q.push("options"),["options=",re]):Q?(Q.push(re),""):re}},(function(){for(var V="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),K=H.RESERVED_WORDS={},Z=0,Q=V.length;Z<Q;Z++)K[V[Z]]=!0})(),H.isValidJavaScriptVariableName=function(V){return!H.RESERVED_WORDS[V]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(V)};function W(V,K,Z,Q,J){var re=K.popStack(),se=Z.length;for(V&&se--;Q<se;Q++)re=K.nameLookup(re,Z[Q],J);return V?[K.aliasable("container.strict"),"(",re,", ",K.quotedString(Z[Q]),", ",JSON.stringify(K.source.currentLocation)," )"]:re}m.default=H,d.exports=m.default})(javascriptCompiler,javascriptCompiler.exports)),javascriptCompiler.exports}var hasRequiredHandlebars;function requireHandlebars(){return hasRequiredHandlebars||(hasRequiredHandlebars=1,(function(d,m){m.__esModule=!0;function g(se){return se&&se.__esModule?se:{default:se}}var w=requireHandlebars_runtime(),$=g(w),I=requireAst(),D=g(I),q=requireBase(),j=requireCompiler(),G=requireJavascriptCompiler(),H=g(G),W=requireVisitor(),V=g(W),K=requireNoConflict(),Z=g(K),Q=$.default.create;function J(){var se=Q();return se.compile=function(oe,ee){return j.compile(oe,ee,se)},se.precompile=function(oe,ee){return j.precompile(oe,ee,se)},se.AST=D.default,se.Compiler=j.Compiler,se.JavaScriptCompiler=H.default,se.Parser=q.parser,se.parse=q.parse,se.parseWithoutProcessing=q.parseWithoutProcessing,se}var re=J();re.create=J,Z.default(re),re.Visitor=V.default,re.default=re,m.default=re,d.exports=m.default})(handlebars,handlebars.exports)),handlebars.exports}var handlebarsExports=requireHandlebars(),Handlebars=getDefaultExportFromCjs$1(handlebarsExports);const MODEL_DETECTION_OUTPUT_SHAPES={cx:{help:"CoordonÃ©e X du point central"},cy:{help:"CoordonÃ©e Y du point central"},sy:{help:"CoordonÃ©e Y du point supÃ©rieur gauche"},sx:{help:"CoordonÃ©e X du point supÃ©rieur gauche"},ex:{help:"CoordonÃ©e X du point infÃ©rieur droit"},ey:{help:"CoordonÃ©e Y du point infÃ©rieur droit"},w:{help:"Largeur de la boÃ®te englobante"},h:{help:"Hauteur de la boÃ®te englobante"},score:{help:"Score de confiance de cette boÃ®te, entre 0 et 1"},_:{help:"Autre valeur (ignorÃ©e par CIGALE)"}},ModelDetectionOutputShape=type.or(...entries(MODEL_DETECTION_OUTPUT_SHAPES).map(([d,{help:m}])=>type(`"${d}"`).describe(m,"self"))).array(),HANDLEBARS_HELPERS={suffix:{documentation:"Ajoute un suffixe Ã  un nom de fichier, avant l'extension",usage:"{{ suffix 'filename.jpeg' '_example' }} -> 'filename_example.jpeg'",implementation:(d,m)=>{const[g,w]=splitFilenameOnExtension(d);return`${g}${m}.${w}`}},extension:{documentation:"RÃ©cupÃ¨re lâ€™extension dâ€™un nom de fichier",usage:"{{ extension 'filename.jpeg' }} -> 'jpeg'",implementation:d=>splitFilenameOnExtension(d)[1]},fallback:{documentation:"Fournit une valeur de repli si la premiÃ¨re est indÃ©finie",usage:"{{ fallback obj.does_not_exist 'Unknown' }} -> 'Unknown'",implementation:(d,m)=>d??m}};for(const[d,{implementation:m}]of Object.entries(HANDLEBARS_HELPERS))Handlebars.registerHelper(d,m);const TemplatedString=d=>type.string.pipe(m=>{try{return{source:m,template:Handlebars.compile(m,{noEscape:!0,assumeObjects:!0,knownHelpersOnly:!0,knownHelpers:{suffix:!0,extension:!0,fallback:!0}})}}catch(g){throw new Error(`Invalid template ${safeJSONStringify(m)}: ${g}`)}}).pipe(({source:m,template:g})=>({render(w){return w=d.assert(w),g(w)},toJSON:()=>m})),FilepathTemplate=type.string.pipe(d=>{try{return{source:d,template:Handlebars.compile(d,{noEscape:!0,assumeObjects:!0,knownHelpersOnly:!0,knownHelpers:{suffix:!0,extension:!0,fallback:!0}})}}catch(m){throw new Error(`Invalid template ${safeJSONStringify(d)}: ${m}`)}}).pipe(({source:d,template:m})=>({render(g){return m(g).replaceAll("\\","/")},toJSON:()=>d})),Protocol$1=type({id:ID.describe("Identifiant unique pour le protocole. On conseille de mettre une partie qui vous identifie dans cet identifiant, car il doit Ãªtre globalement unique. Par exemple, mon-organisation.mon-protocole"),dirty:type("boolean").describe("Si le protocole a Ã©tÃ© modifiÃ© depuis sa derniÃ¨re exportation").default(!1),metadata:References,name:["string","@","Nom du protocole"],description:["string","@","Description du protocole"],"learnMore?":URLString.describe("Lien vers un site oÃ¹ l'on peut se renseigner sur ce protocole. Cela peut aussi Ãªtre simplement un lien de tÃ©lÃ©chargement direct de ce fichier"),"version?":["number","@","Version actuelle du protocole"],"source?":HTTPRequest.describe(`RequÃªte ou URL devant mener Ã  un fichier JSON contenant la version la plus rÃ©cente du protocole. Permet de proposer des mises Ã  jour.
		
		Si le champ "version" n'existe pas (que ce soit dans le protocole local ou distant), aucune mise Ã  jour ne sera proposÃ©e.`),authors:type({"email?":["string.email","@","Adresse email"],name:["string","@","PrÃ©nom Nom"]}).array().describe("Les auteurices ayant participÃ© Ã  l'Ã©laboration du protocole"),"metadataOrder?":type(ID.array()).describe("L'ordre dans lequel les mÃ©tadonnÃ©es doivent Ãªtre prÃ©sentÃ©es dans l'interface utilisateur. Les mÃ©tadonnÃ©es non listÃ©es ici seront affichÃ©es aprÃ¨s toutes celles listÃ©es ici"),"observations?":{"defaultLabel?":TemplatedString(type({images:Image$2.array(),observation:Observation$1})).describe("Label par dÃ©faut pour les observations. Template Handlebars, recevant une liste des images de l'observation Ã  crÃ©Ã©er (clÃ© images) et l'observation elle-mÃªme (clÃ© observation)")},crop:type({metadata:[ID,"@","MÃ©tadonnÃ©e associÃ©e Ã  la boÃ®te englobante"],"confirmationMetadata?":[ID,"@","MÃ©tadonnÃ©e associÃ©e au fait que la boÃ®te englobante a Ã©tÃ© (humainement) confirmÃ©e"],padding:type(/^\d+(%|px)$/).describe("Pixels de marge Ã  rajouter autour de la boÃ®te englobante au moment d'exporter les images recadrÃ©es. Nombre suivi de 'px' pour un nombre de pixels fixe, ou de '%' pour un pourcentage des dimensions de chaque image.").default("0px"),"infer?":type({"name?":["string","@","Nom du rÃ©seau Ã  afficher dans l'interface. ParticuliÃ¨rement utile si il y a plusieurs rÃ©seaux"],model:HTTPRequest.describe("Lien vers le modÃ¨le de dÃ©tection utilisÃ© pour infÃ©rer les boÃ®tes englobantes. Au format ONNX (.onnx) seulement, pour le moment."),input:ModelInput.describe("Configuration de l'entrÃ©e du modÃ¨le"),output:type({"name?":["string","@","Nom de l'output du modÃ¨le Ã  utiliser. output0 par dÃ©faut"],normalized:["boolean","@","Si les coordonnÃ©es des boÃ®tes englobantes sont normalisÃ©es par rapport aux dimensions de l'image"],shape:ModelDetectionOutputShape.describe("Forme de sortie de chaque boÃ®te englobante. NÃ©cÃ©ssite obligatoirement d'avoir 'score'; 2 parmi 'cx', 'sx', 'ex', 'w'; et 2 parmi 'cy', 'sy', 'ey', 'h'. Si les boÃ®tes contiennent d'autre valeurs, bien les mentionner avec '_', mÃªme quand c'est Ã  la fin de la liste: cela permet de savoir quand on passe Ã  la boÃ®te suivante. Par exemple, [cx, cy, w, h, score, _] correspond Ã  un modÃ¨le YOLO11 COCO")}).describe("Forme de la sortie du modÃ¨le de classification. Par exemple, shape: [cx, cy, w, h, score, _] et normalized: true correspond Ã  un modÃ¨le YOLO11 COCO")}).array().describe("Configuration de l'infÃ©rence des boÃ®tes englobantes")}).describe("Configuration de la partie recadrage"),exports:type({images:type({cropped:FilepathTemplate.describe("Chemins des images recadrÃ©es"),original:FilepathTemplate.describe("Chemins des images originales")}).describe(`Chemins oÃ¹ sauvegarder les images. Vous pouvez utiliser {{observation.metadata.identifiant.value}} pour insÃ©rer la valeur d'une mÃ©tadonnÃ©e, {{image.filename}} pour le nom de fichier, {{observation.label}} pour le label (nom) de l'observation, et {{sequence}} pour un numÃ©ro d'image, commenÃ§ant Ã  1. {{observation.metadata.identifiant.valueLabel}} peut Ãªtre pratique pour obtenir le label associÃ© au choix d'une mÃ©tadonnÃ©e de type 'enum'. Enfin, il est possible de faire {{suffix image.filename "_exemple"}} pour ajouter "_exemple" Ã  la fin d'un nom de fichier, mais avant son extension (par exemple: {{suffix image.filename "_cropped"}} donnera "IMG_1245_cropped.JPEG" si l'image avait pour nom de fichier "IMG_12345.JPEG"); Vous pouvez faire {{extension image.filename}} pour avoir l'extension d'un fichier, et {{fallback image.metadata.exemple "(Inconnnu)"}} pour utiliser "(Inconnu)" si image.metadata.example n'existe pas. Ce sont enfait des templates Handlebars, en savoir plus: https://handlebarsjs.com/guide/`),metadata:{json:type.string.describe("Chemin du fichier JSON contenant les rÃ©sultats de l'analyse").pipe(d=>d.replaceAll("\\","/")),csv:type.string.describe("Chemin du fichier CSV contenant les rÃ©sultats de l'analyse").pipe(d=>d.replaceAll("\\","/"))}}).describe("La structure du fichier .zip d'export pour ce protocole.").optional()}),ExportedProtocol=Protocol$1.omit("metadata","dirty").in.and({metadata:{"[string]":Metadata$1.omit("id").describe("MÃ©tadonnÃ©e du protocole")}}).pipe(d=>({...d,metadata:Object.fromEntries(Object.entries(d.metadata).map(([m,g])=>[namespacedMetadataId(d.id,m),g]))}));function generateId(d){return d.slice(0,1).toLowerCase()+Math.random().toString(36).slice(2,9)}const ImageFile=table(["id"],type({id:ID,bytes:"ArrayBuffer",filename:"string",contentType:/\w+\/\w+/,dimensions:Dimensions})),ImagePreviewFile=table(["id"],type({id:ID,bytes:"ArrayBuffer",filename:"string",contentType:/\w+\/\w+/,dimensions:Dimensions})),Image$1=table(["id","addedAt"],Image$2),Observation=table(["id","addedAt"],Observation$1),Metadata=table("id",Metadata$1.omit("options")),MetadataOption=table(["id"],MetadataEnumVariant.and({id:[/\w+:\w+/,"@","ID of the form metadata_id:key"],metadataId:ID})),Protocol=table("id",Protocol$1),Settings=table("id",type({id:'"defaults" | "user"',protocols:References,theme:type.enumerated("dark","light","auto"),gridSize:type.number.pipe(d=>d===10?1:clamp(d,.5,2)),language:type.enumerated("fr","en").default(()=>{try{const d=localStorage.getItem("PARAGLIDE_LOCALE");if(d==="fr"||d==="en")return localStorage.removeItem("PARAGLIDE_LOCALE"),d}catch(d){d instanceof ReferenceError||console.warn("Error migrating from PARAGLIDE_LOCALE ",d)}try{return localeFromNavigator()}catch(d){return console.warn("Error getting navigator.language, defaulting to fr",d),"fr"}}),showInputHints:"boolean",showTechnicalMetadata:"boolean",cropAutoNext:"boolean = false",parallelism:type("number").default(()=>{try{return Math.ceil(navigator.hardwareConcurrency/3)}catch(d){return console.warn("Couldn't get navigator.hardwareConcurrency, defaulting to 1",d),1}}),gallerySort:type({direction:type.enumerated("asc","desc"),key:type.enumerated("filename","date")}).default(()=>({direction:"asc",key:"date"})),protocolModelSelections:scope({ID}).type({"[ID]":{"[ID]":"number.integer >= -1"}}).default(()=>({}))})),Schemas={MetadataValues,Image:Image$1,ModelInput,ModelDetectionOutputShape,Metadata,Protocol,HTTPRequest},NO_REACTIVE_STATE_TABLES=["ImageFile","ImagePreviewFile","MetadataOption"];function isReactiveTable(d){return NO_REACTIVE_STATE_TABLES.every(m=>m!==d)}const Tables={Image:Image$1,ImageFile,ImagePreviewFile,Observation,Metadata,MetadataOption,Protocol,Settings};function table(d,m){const g=Array.isArray(d)?d.map(w=>w):[d];return m.configure({table:{indexes:g}})}const idComparator=(d,m)=>typeof d=="object"&&"id"in d||typeof m=="object"&&"id"in m?idComparator(d.id,m.id):typeof d=="number"&&typeof m=="number"?d-m:typeof d=="number"?-1:typeof m=="number"?1:/^\d+$/.test(d)&&/^\d+$/.test(m)?Number(d)-Number(m):d.localeCompare(m),PROCEDURES={init:{input:type({databaseName:"string",databaseRevision:"number.integer >= 1"}),progress:type("undefined"),success:type("undefined")},loadModel:{input:type({protocolId:"string",request:Schemas.HTTPRequest,"classmapping?":Schemas.HTTPRequest,task:'"classification" | "detection"',"webgpu?":"boolean"}),progress:type("0 <= number <= 1"),success:type("true")},isModelLoaded:{input:type('"classification" | "detection"'),progress:type({}),success:type("boolean")},inferBoundingBoxes:{input:type({fileId:"string",webgpu:"boolean = false",taskSettings:{input:Schemas.ModelInput,output:{"name?":"string",shape:Schemas.ModelDetectionOutputShape}}}),progress:type({}),success:type({boxes:type(["number","number","number","number"]).array(),scores:"number[]"})},classify:{input:type({imageId:"string","webgpu?":"boolean",metadataIds:{cropbox:"string",target:"string"},taskSettings:{input:Schemas.ModelInput,"output?":{name:"string"}}}),progress:type({}),success:type({scores:"number[]"})},importProtocol:{input:type({contents:"string",isJSON:"boolean = false"}),progress:type({phase:type.enumerated("parsing","filtering-builtin-metadata","input-validation","write-protocol","write-metadata","write-metadata-options","output-validation"),"detail?":"string"}),success:type({id:"string",name:"string","version?":"number | undefined"})},generateResultsZip:{input:type({protocolId:"string",include:type.enumerated("croppedonly","full","metadataonly"),cropPadding:/^\d+(px|%)$/,jsonSchemaURL:"string.url.parse"}),progress:type.or({progress:"number"},{warning:type.or(['"exif-write-error"',{filename:"string"}])}).pipe(d=>"progress"in d?{progress:d.progress,warning:void 0}:{progress:void 0,warning:d.warning}),success:type("ArrayBuffer")},diffProtocolWithRemote:{input:type({protocolId:"string"}),progress:type("0 <= number <= 1"),success:type({dirty:"boolean",changes:type.or({path:"(number|string)[]",type:'"CREATE"',value:"unknown"},{path:"(number|string)[]",type:'"CHANGE"',oldValue:"unknown",value:"unknown"},{path:"(number|string)[]",type:'"REMOVE"',oldValue:"unknown"}).array()})}};let _db,databaseParams;async function openDatabase$1(){if(!databaseParams)throw new Error("Database parameters not set, call swarp.init() first");return _db||(_db=await openDB(databaseParams.name,databaseParams.revision),_db)}const swarp=Server(PROCEDURES);swarp.init(async({databaseName:d,databaseRevision:m})=>{databaseParams={name:d,revision:m}});var ch2={},wk=(function(d,m,g,w,$){var I=new Worker(ch2[m]||(ch2[m]=URL.createObjectURL(new Blob([d+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return I.onmessage=function(D){var q=D.data,j=q.$e$;if(j){var G=new Error(j[0]);G.code=j[1],G.stack=j[2],$(G,null)}else $(null,q)},I.postMessage(g,w),I}),u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(d,m){for(var g=new u16(31),w=0;w<31;++w)g[w]=m+=1<<d[w-1];for(var $=new i32(g[30]),w=1;w<30;++w)for(var I=g[w];I<g[w+1];++I)$[I]=I-g[w]<<5|w;return{b:g,r:$}},_a$1=freb(fleb,2),fl$1=_a$1.b,revfl=_a$1.r;fl$1[28]=258,revfl[258]=28;var _b=freb(fdeb,0),revfd=_b.r,rev=new u16(32768);for(var i$1=0;i$1<32768;++i$1){var x$3=(i$1&43690)>>1|(i$1&21845)<<1;x$3=(x$3&52428)>>2|(x$3&13107)<<2,x$3=(x$3&61680)>>4|(x$3&3855)<<4,rev[i$1]=((x$3&65280)>>8|(x$3&255)<<8)>>1}var hMap=(function(d,m,g){for(var w=d.length,$=0,I=new u16(m);$<w;++$)d[$]&&++I[d[$]-1];var D=new u16(m);for($=1;$<m;++$)D[$]=D[$-1]+I[$-1]<<1;var q;if(g){q=new u16(1<<m);var j=15-m;for($=0;$<w;++$)if(d[$])for(var G=$<<4|d[$],H=m-d[$],W=D[d[$]-1]++<<H,V=W|(1<<H)-1;W<=V;++W)q[rev[W]>>j]=G}else for(q=new u16(w),$=0;$<w;++$)d[$]&&(q[$]=rev[D[d[$]-1]++]>>15-d[$]);return q}),flt=new u8(288);for(var i$1=0;i$1<144;++i$1)flt[i$1]=8;for(var i$1=144;i$1<256;++i$1)flt[i$1]=9;for(var i$1=256;i$1<280;++i$1)flt[i$1]=7;for(var i$1=280;i$1<288;++i$1)flt[i$1]=8;var fdt=new u8(32);for(var i$1=0;i$1<32;++i$1)fdt[i$1]=5;var flm=hMap(flt,9,0),fdm=hMap(fdt,5,0),shft=function(d){return(d+7)/8|0},slc=function(d,m,g){return(m==null||m<0)&&(m=0),(g==null||g>d.length)&&(g=d.length),new u8(d.subarray(m,g))},ec$1=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],err=function(d,m,g){var w=new Error(m||ec$1[d]);if(w.code=d,Error.captureStackTrace&&Error.captureStackTrace(w,err),!g)throw w;return w},wbits=function(d,m,g){g<<=m&7;var w=m/8|0;d[w]|=g,d[w+1]|=g>>8},wbits16=function(d,m,g){g<<=m&7;var w=m/8|0;d[w]|=g,d[w+1]|=g>>8,d[w+2]|=g>>16},hTree=function(d,m){for(var g=[],w=0;w<d.length;++w)d[w]&&g.push({s:w,f:d[w]});var $=g.length,I=g.slice();if(!$)return{t:et$1,l:0};if($==1){var D=new u8(g[0].s+1);return D[g[0].s]=1,{t:D,l:1}}g.sort(function(ae,ce){return ae.f-ce.f}),g.push({s:-1,f:25001});var q=g[0],j=g[1],G=0,H=1,W=2;for(g[0]={s:-1,f:q.f+j.f,l:q,r:j};H!=$-1;)q=g[g[G].f<g[W].f?G++:W++],j=g[G!=H&&g[G].f<g[W].f?G++:W++],g[H++]={s:-1,f:q.f+j.f,l:q,r:j};for(var V=I[0].s,w=1;w<$;++w)I[w].s>V&&(V=I[w].s);var K=new u16(V+1),Z=ln$1(g[H-1],K,0);if(Z>m){var w=0,Q=0,J=Z-m,re=1<<J;for(I.sort(function(ce,le){return K[le.s]-K[ce.s]||ce.f-le.f});w<$;++w){var se=I[w].s;if(K[se]>m)Q+=re-(1<<Z-K[se]),K[se]=m;else break}for(Q>>=J;Q>0;){var oe=I[w].s;K[oe]<m?Q-=1<<m-K[oe]++-1:++w}for(;w>=0&&Q;--w){var ee=I[w].s;K[ee]==m&&(--K[ee],++Q)}Z=m}return{t:new u8(K),l:Z}},ln$1=function(d,m,g){return d.s==-1?Math.max(ln$1(d.l,m,g+1),ln$1(d.r,m,g+1)):m[d.s]=g},lc$1=function(d){for(var m=d.length;m&&!d[--m];);for(var g=new u16(++m),w=0,$=d[0],I=1,D=function(j){g[w++]=j},q=1;q<=m;++q)if(d[q]==$&&q!=m)++I;else{if(!$&&I>2){for(;I>138;I-=138)D(32754);I>2&&(D(I>10?I-11<<5|28690:I-3<<5|12305),I=0)}else if(I>3){for(D($),--I;I>6;I-=6)D(8304);I>2&&(D(I-3<<5|8208),I=0)}for(;I--;)D($);I=1,$=d[q]}return{c:g.subarray(0,w),n:m}},clen=function(d,m){for(var g=0,w=0;w<m.length;++w)g+=d[w]*m[w];return g},wfblk=function(d,m,g){var w=g.length,$=shft(m+2);d[$]=w&255,d[$+1]=w>>8,d[$+2]=d[$]^255,d[$+3]=d[$+1]^255;for(var I=0;I<w;++I)d[$+I+4]=g[I];return($+4+w)*8},wblk=function(d,m,g,w,$,I,D,q,j,G,H){wbits(m,H++,g),++$[256];for(var W=hTree($,15),V=W.t,K=W.l,Z=hTree(I,15),Q=Z.t,J=Z.l,re=lc$1(V),se=re.c,oe=re.n,ee=lc$1(Q),ae=ee.c,ce=ee.n,le=new u16(19),de=0;de<se.length;++de)++le[se[de]&31];for(var de=0;de<ae.length;++de)++le[ae[de]&31];for(var _e=hTree(le,7),we=_e.t,pe=_e.l,xe=19;xe>4&&!we[clim[xe-1]];--xe);var Ge=G+5<<3,Te=clen($,flt)+clen(I,fdt)+D,Ce=clen($,V)+clen(I,Q)+D+14+3*xe+clen(le,we)+2*le[16]+3*le[17]+7*le[18];if(j>=0&&Ge<=Te&&Ge<=Ce)return wfblk(m,H,d.subarray(j,j+G));var Oe,bt,Mt,lt;if(wbits(m,H,1+(Ce<Te)),H+=2,Ce<Te){Oe=hMap(V,K,0),bt=V,Mt=hMap(Q,J,0),lt=Q;var ir=hMap(we,pe,0);wbits(m,H,oe-257),wbits(m,H+5,ce-1),wbits(m,H+10,xe-4),H+=14;for(var de=0;de<xe;++de)wbits(m,H+3*de,we[clim[de]]);H+=3*xe;for(var Ye=[se,ae],xt=0;xt<2;++xt)for(var ar=Ye[xt],de=0;de<ar.length;++de){var ht=ar[de]&31;wbits(m,H,ir[ht]),H+=we[ht],ht>15&&(wbits(m,H,ar[de]>>5&127),H+=ar[de]>>12)}}else Oe=flm,bt=flt,Mt=fdm,lt=fdt;for(var de=0;de<q;++de){var gt=w[de];if(gt>255){var ht=gt>>18&31;wbits16(m,H,Oe[ht+257]),H+=bt[ht+257],ht>7&&(wbits(m,H,gt>>23&31),H+=fleb[ht]);var zt=gt&31;wbits16(m,H,Mt[zt]),H+=lt[zt],zt>3&&(wbits16(m,H,gt>>5&8191),H+=fdeb[zt])}else wbits16(m,H,Oe[gt]),H+=bt[gt]}return wbits16(m,H,Oe[256]),H+bt[256]},deo=new i32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),et$1=new u8(0),dflt=function(d,m,g,w,$,I){var D=I.z||d.length,q=new u8(w+D+5*(1+Math.ceil(D/7e3))+$),j=q.subarray(w,q.length-$),G=I.l,H=(I.r||0)&7;if(m){H&&(j[0]=I.r>>3);for(var W=deo[m-1],V=W>>13,K=W&8191,Z=(1<<g)-1,Q=I.p||new u16(32768),J=I.h||new u16(Z+1),re=Math.ceil(g/3),se=2*re,oe=function(st){return(d[st]^d[st+1]<<re^d[st+2]<<se)&Z},ee=new i32(25e3),ae=new u16(288),ce=new u16(32),le=0,de=0,_e=I.i||0,we=0,pe=I.w||0,xe=0;_e+2<D;++_e){var Ge=oe(_e),Te=_e&32767,Ce=J[Ge];if(Q[Te]=Ce,J[Ge]=Te,pe<=_e){var Oe=D-_e;if((le>7e3||we>24576)&&(Oe>423||!G)){H=wblk(d,j,0,ee,ae,ce,de,we,xe,_e-xe,H),we=le=de=0,xe=_e;for(var bt=0;bt<286;++bt)ae[bt]=0;for(var bt=0;bt<30;++bt)ce[bt]=0}var Mt=2,lt=0,ir=K,Ye=Te-Ce&32767;if(Oe>2&&Ge==oe(_e-Ye))for(var xt=Math.min(V,Oe)-1,ar=Math.min(32767,_e),ht=Math.min(258,Oe);Ye<=ar&&--ir&&Te!=Ce;){if(d[_e+Mt]==d[_e+Mt-Ye]){for(var gt=0;gt<ht&&d[_e+gt]==d[_e+gt-Ye];++gt);if(gt>Mt){if(Mt=gt,lt=Ye,gt>xt)break;for(var zt=Math.min(Ye,gt-2),ur=0,bt=0;bt<zt;++bt){var dr=_e-Ye+bt&32767,fr=Q[dr],Ft=dr-fr&32767;Ft>ur&&(ur=Ft,Ce=dr)}}}Te=Ce,Ce=Q[Te],Ye+=Te-Ce&32767}if(lt){ee[we++]=268435456|revfl[Mt]<<18|revfd[lt];var $e=revfl[Mt]&31,Bt=revfd[lt]&31;de+=fleb[$e]+fdeb[Bt],++ae[257+$e],++ce[Bt],pe=_e+Mt,++le}else ee[we++]=d[_e],++ae[d[_e]]}}for(_e=Math.max(_e,pe);_e<D;++_e)ee[we++]=d[_e],++ae[d[_e]];H=wblk(d,j,G,ee,ae,ce,de,we,xe,_e-xe,H),G||(I.r=H&7|j[H/8|0]<<3,H-=7,I.h=J,I.p=Q,I.i=_e,I.w=pe)}else{for(var _e=I.w||0;_e<D+G;_e+=65535){var Qe=_e+65535;Qe>=D&&(j[H/8|0]=G,Qe=D),H=wfblk(j,H+1,d.subarray(_e,Qe))}I.i=D}return slc(q,0,w+shft(H)+$)},crct=(function(){for(var d=new Int32Array(256),m=0;m<256;++m){for(var g=m,w=9;--w;)g=(g&1&&-306674912)^g>>>1;d[m]=g}return d})(),crc=function(){var d=-1;return{p:function(m){for(var g=d,w=0;w<m.length;++w)g=crct[g&255^m[w]]^g>>>8;d=g},d:function(){return~d}}},dopt=function(d,m,g,w,$){if(!$&&($={l:1},m.dictionary)){var I=m.dictionary.subarray(-32768),D=new u8(I.length+d.length);D.set(I),D.set(d,I.length),d=D,$.w=I.length}return dflt(d,m.level==null?6:m.level,m.mem==null?$.l?Math.ceil(Math.max(8,Math.min(13,Math.log(d.length)))*1.5):20:12+m.mem,g,w,$)},mrg=function(d,m){var g={};for(var w in d)g[w]=d[w];for(var w in m)g[w]=m[w];return g},wcln=function(d,m,g){for(var w=d(),$=d.toString(),I=$.slice($.indexOf("[")+1,$.lastIndexOf("]")).replace(/\s+/g,"").split(","),D=0;D<w.length;++D){var q=w[D],j=I[D];if(typeof q=="function"){m+=";"+j+"=";var G=q.toString();if(q.prototype)if(G.indexOf("[native code]")!=-1){var H=G.indexOf(" ",8)+1;m+=G.slice(H,G.indexOf("(",H))}else{m+=G;for(var W in q.prototype)m+=";"+j+".prototype."+W+"="+q.prototype[W].toString()}else m+=G}else g[j]=q}return m},ch$1=[],cbfs=function(d){var m=[];for(var g in d)d[g].buffer&&m.push((d[g]=new d[g].constructor(d[g])).buffer);return m},wrkr=function(d,m,g,w){if(!ch$1[g]){for(var $="",I={},D=d.length-1,q=0;q<D;++q)$=wcln(d[q],$,I);ch$1[g]={c:wcln(d[D],$,I),e:I}}var j=mrg({},ch$1[g].e);return wk(ch$1[g].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+m.toString()+"}",g,j,cbfs(j),w)},bDflt=function(){return[u8,u16,i32,fleb,fdeb,clim,revfl,revfd,flm,flt,fdm,fdt,rev,deo,et$1,hMap,wbits,wbits16,hTree,ln$1,lc$1,clen,wfblk,wblk,shft,slc,dflt,dopt,deflateSync,pbf]},pbf=function(d){return postMessage(d,[d.buffer])},cbify=function(d,m,g,w,$,I){var D=wrkr(g,w,$,function(q,j){D.terminate(),I(q,j)});return D.postMessage([d,m],m.consume?[d.buffer]:[]),function(){D.terminate()}},wbytes=function(d,m,g){for(;g;++m)d[m]=g,g>>>=8};function deflate$2(d,m,g){return g||(g=m,m={}),typeof g!="function"&&err(7),cbify(d,m,[bDflt],function(w){return pbf(deflateSync(w.data[0],w.data[1]))},0,g)}function deflateSync(d,m){return dopt(d,m||{},0,0)}var fltn=function(d,m,g,w){for(var $ in d){var I=d[$],D=m+$,q=w;Array.isArray(I)&&(q=mrg(w,I[1]),I=I[0]),I instanceof u8?g[D]=[I,q]:(g[D+="/"]=[new u8(0),q],fltn(I,D,g,w))}},te=typeof TextEncoder<"u"&&new TextEncoder,td$1=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td$1.decode(et$1,{stream:!0}),tds=1}catch{}function strToU8(d,m){var g;if(te)return te.encode(d);for(var w=d.length,$=new u8(d.length+(d.length>>1)),I=0,D=function(G){$[I++]=G},g=0;g<w;++g){if(I+5>$.length){var q=new u8(I+8+(w-g<<1));q.set($),$=q}var j=d.charCodeAt(g);j<128||m?D(j):j<2048?(D(192|j>>6),D(128|j&63)):j>55295&&j<57344?(j=65536+(j&1047552)|d.charCodeAt(++g)&1023,D(240|j>>18),D(128|j>>12&63),D(128|j>>6&63),D(128|j&63)):(D(224|j>>12),D(128|j>>6&63),D(128|j&63))}return slc($,0,I)}var exfl=function(d){var m=0;if(d)for(var g in d){var w=d[g].length;w>65535&&err(9),m+=w+4}return m},wzh=function(d,m,g,w,$,I,D,q){var j=w.length,G=g.extra,H=q&&q.length,W=exfl(G);wbytes(d,m,D!=null?33639248:67324752),m+=4,D!=null&&(d[m++]=20,d[m++]=g.os),d[m]=20,m+=2,d[m++]=g.flag<<1|(I<0&&8),d[m++]=$&&8,d[m++]=g.compression&255,d[m++]=g.compression>>8;var V=new Date(g.mtime==null?Date.now():g.mtime),K=V.getFullYear()-1980;if((K<0||K>119)&&err(10),wbytes(d,m,K<<25|V.getMonth()+1<<21|V.getDate()<<16|V.getHours()<<11|V.getMinutes()<<5|V.getSeconds()>>1),m+=4,I!=-1&&(wbytes(d,m,g.crc),wbytes(d,m+4,I<0?-I-2:I),wbytes(d,m+8,g.size)),wbytes(d,m+12,j),wbytes(d,m+14,W),m+=16,D!=null&&(wbytes(d,m,H),wbytes(d,m+6,g.attrs),wbytes(d,m+10,D),m+=14),d.set(w,m),m+=j,W)for(var Z in G){var Q=G[Z],J=Q.length;wbytes(d,m,+Z),wbytes(d,m+2,J),d.set(Q,m+4),m+=4+J}return H&&(d.set(q,m),m+=H),m},wzf=function(d,m,g,w,$){wbytes(d,m,101010256),wbytes(d,m+8,g),wbytes(d,m+10,g),wbytes(d,m+12,w),wbytes(d,m+16,$)};function zip(d,m,g){g||(g=m,m={}),typeof g!="function"&&err(7);var w={};fltn(d,"",w,m);var $=Object.keys(w),I=$.length,D=0,q=0,j=I,G=new Array(I),H=[],W=function(){for(var J=0;J<H.length;++J)H[J]()},V=function(J,re){mt(function(){g(J,re)})};mt(function(){V=g});var K=function(){var J=new u8(q+22),re=D,se=q-D;q=0;for(var oe=0;oe<j;++oe){var ee=G[oe];try{var ae=ee.c.length;wzh(J,q,ee,ee.f,ee.u,ae);var ce=30+ee.f.length+exfl(ee.extra),le=q+ce;J.set(ee.c,le),wzh(J,D,ee,ee.f,ee.u,ae,q,ee.m),D+=16+ce+(ee.m?ee.m.length:0),q=le+ae}catch(de){return V(de,null)}}wzf(J,D,G.length,se,re),V(null,J)};I||K();for(var Z=function(J){var re=$[J],se=w[re],oe=se[0],ee=se[1],ae=crc(),ce=oe.length;ae.p(oe);var le=strToU8(re),de=le.length,_e=ee.comment,we=_e&&strToU8(_e),pe=we&&we.length,xe=exfl(ee.extra),Ge=ee.level==0?0:8,Te=function(Ce,Oe){if(Ce)W(),V(Ce,null);else{var bt=Oe.length;G[J]=mrg(ee,{size:ce,crc:ae.d(),c:Oe,f:le,m:we,u:de!=re.length||we&&_e.length!=pe,compression:Ge}),D+=30+de+xe+bt,q+=76+2*(de+xe)+(pe||0)+bt,--I||K()}};if(de>65535&&Te(err(11,0,1),null),!Ge)Te(null,oe);else if(ce<16e4)try{Te(null,deflateSync(oe,ee))}catch(Ce){Te(Ce,null)}else H.push(deflate$2(oe,ee,Te))},Q=0;Q<j;++Q)Z(Q);return W}var mt=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(d){d()};const ALIAS=Symbol.for("yaml.alias"),DOC=Symbol.for("yaml.document"),MAP=Symbol.for("yaml.map"),PAIR=Symbol.for("yaml.pair"),SCALAR$1=Symbol.for("yaml.scalar"),SEQ=Symbol.for("yaml.seq"),NODE_TYPE=Symbol.for("yaml.node.type"),isAlias=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===ALIAS,isDocument=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===DOC,isMap=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===MAP,isPair=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===PAIR,isScalar$1=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===SCALAR$1,isSeq=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===SEQ;function isCollection$1(d){if(d&&typeof d=="object")switch(d[NODE_TYPE]){case MAP:case SEQ:return!0}return!1}function isNode(d){if(d&&typeof d=="object")switch(d[NODE_TYPE]){case ALIAS:case MAP:case SCALAR$1:case SEQ:return!0}return!1}const hasAnchor=d=>(isScalar$1(d)||isCollection$1(d))&&!!d.anchor,BREAK$1=Symbol("break visit"),SKIP$1=Symbol("skip children"),REMOVE$1=Symbol("remove node");function visit$3(d,m){const g=initVisitor(m);isDocument(d)?visit_(null,d.contents,g,Object.freeze([d]))===REMOVE$1&&(d.contents=null):visit_(null,d,g,Object.freeze([]))}visit$3.BREAK=BREAK$1;visit$3.SKIP=SKIP$1;visit$3.REMOVE=REMOVE$1;function visit_(d,m,g,w){const $=callVisitor(d,m,g,w);if(isNode($)||isPair($))return replaceNode(d,w,$),visit_(d,$,g,w);if(typeof $!="symbol"){if(isCollection$1(m)){w=Object.freeze(w.concat(m));for(let I=0;I<m.items.length;++I){const D=visit_(I,m.items[I],g,w);if(typeof D=="number")I=D-1;else{if(D===BREAK$1)return BREAK$1;D===REMOVE$1&&(m.items.splice(I,1),I-=1)}}}else if(isPair(m)){w=Object.freeze(w.concat(m));const I=visit_("key",m.key,g,w);if(I===BREAK$1)return BREAK$1;I===REMOVE$1&&(m.key=null);const D=visit_("value",m.value,g,w);if(D===BREAK$1)return BREAK$1;D===REMOVE$1&&(m.value=null)}}return $}async function visitAsync(d,m){const g=initVisitor(m);isDocument(d)?await visitAsync_(null,d.contents,g,Object.freeze([d]))===REMOVE$1&&(d.contents=null):await visitAsync_(null,d,g,Object.freeze([]))}visitAsync.BREAK=BREAK$1;visitAsync.SKIP=SKIP$1;visitAsync.REMOVE=REMOVE$1;async function visitAsync_(d,m,g,w){const $=await callVisitor(d,m,g,w);if(isNode($)||isPair($))return replaceNode(d,w,$),visitAsync_(d,$,g,w);if(typeof $!="symbol"){if(isCollection$1(m)){w=Object.freeze(w.concat(m));for(let I=0;I<m.items.length;++I){const D=await visitAsync_(I,m.items[I],g,w);if(typeof D=="number")I=D-1;else{if(D===BREAK$1)return BREAK$1;D===REMOVE$1&&(m.items.splice(I,1),I-=1)}}}else if(isPair(m)){w=Object.freeze(w.concat(m));const I=await visitAsync_("key",m.key,g,w);if(I===BREAK$1)return BREAK$1;I===REMOVE$1&&(m.key=null);const D=await visitAsync_("value",m.value,g,w);if(D===BREAK$1)return BREAK$1;D===REMOVE$1&&(m.value=null)}}return $}function initVisitor(d){return typeof d=="object"&&(d.Collection||d.Node||d.Value)?Object.assign({Alias:d.Node,Map:d.Node,Scalar:d.Node,Seq:d.Node},d.Value&&{Map:d.Value,Scalar:d.Value,Seq:d.Value},d.Collection&&{Map:d.Collection,Seq:d.Collection},d):d}function callVisitor(d,m,g,w){if(typeof g=="function")return g(d,m,w);if(isMap(m))return g.Map?.(d,m,w);if(isSeq(m))return g.Seq?.(d,m,w);if(isPair(m))return g.Pair?.(d,m,w);if(isScalar$1(m))return g.Scalar?.(d,m,w);if(isAlias(m))return g.Alias?.(d,m,w)}function replaceNode(d,m,g){const w=m[m.length-1];if(isCollection$1(w))w.items[d]=g;else if(isPair(w))d==="key"?w.key=g:w.value=g;else if(isDocument(w))w.contents=g;else{const $=isAlias(w)?"alias":"scalar";throw new Error(`Cannot replace node with ${$} parent`)}}const escapeChars={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},escapeTagName=d=>d.replace(/[!,[\]{}]/g,m=>escapeChars[m]);class Directives{constructor(m,g){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},Directives.defaultYaml,m),this.tags=Object.assign({},Directives.defaultTags,g)}clone(){const m=new Directives(this.yaml,this.tags);return m.docStart=this.docStart,m}atDocument(){const m=new Directives(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:Directives.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},Directives.defaultTags);break}return m}add(m,g){this.atNextDocument&&(this.yaml={explicit:Directives.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},Directives.defaultTags),this.atNextDocument=!1);const w=m.trim().split(/[ \t]+/),$=w.shift();switch($){case"%TAG":{if(w.length!==2&&(g(0,"%TAG directive should contain exactly two parts"),w.length<2))return!1;const[I,D]=w;return this.tags[I]=D,!0}case"%YAML":{if(this.yaml.explicit=!0,w.length!==1)return g(0,"%YAML directive should contain exactly one part"),!1;const[I]=w;if(I==="1.1"||I==="1.2")return this.yaml.version=I,!0;{const D=/^\d+\.\d+$/.test(I);return g(6,`Unsupported YAML version ${I}`,D),!1}}default:return g(0,`Unknown directive ${$}`,!0),!1}}tagName(m,g){if(m==="!")return"!";if(m[0]!=="!")return g(`Not a valid tag: ${m}`),null;if(m[1]==="<"){const D=m.slice(2,-1);return D==="!"||D==="!!"?(g(`Verbatim tags aren't resolved, so ${m} is invalid.`),null):(m[m.length-1]!==">"&&g("Verbatim tags must end with a >"),D)}const[,w,$]=m.match(/^(.*!)([^!]*)$/s);$||g(`The ${m} tag has no suffix`);const I=this.tags[w];if(I)try{return I+decodeURIComponent($)}catch(D){return g(String(D)),null}return w==="!"?m:(g(`Could not resolve tag: ${m}`),null)}tagString(m){for(const[g,w]of Object.entries(this.tags))if(m.startsWith(w))return g+escapeTagName(m.substring(w.length));return m[0]==="!"?m:`!<${m}>`}toString(m){const g=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],w=Object.entries(this.tags);let $;if(m&&w.length>0&&isNode(m.contents)){const I={};visit$3(m.contents,(D,q)=>{isNode(q)&&q.tag&&(I[q.tag]=!0)}),$=Object.keys(I)}else $=[];for(const[I,D]of w)I==="!!"&&D==="tag:yaml.org,2002:"||(!m||$.some(q=>q.startsWith(D)))&&g.push(`%TAG ${I} ${D}`);return g.join(`
`)}}Directives.defaultYaml={explicit:!1,version:"1.2"};Directives.defaultTags={"!!":"tag:yaml.org,2002:"};function anchorIsValid(d){if(/[\x00-\x19\s,[\]{}]/.test(d)){const g=`Anchor must not contain whitespace or control characters: ${JSON.stringify(d)}`;throw new Error(g)}return!0}function anchorNames(d){const m=new Set;return visit$3(d,{Value(g,w){w.anchor&&m.add(w.anchor)}}),m}function findNewAnchor(d,m){for(let g=1;;++g){const w=`${d}${g}`;if(!m.has(w))return w}}function createNodeAnchors(d,m){const g=[],w=new Map;let $=null;return{onAnchor:I=>{g.push(I),$??($=anchorNames(d));const D=findNewAnchor(m,$);return $.add(D),D},setAnchors:()=>{for(const I of g){const D=w.get(I);if(typeof D=="object"&&D.anchor&&(isScalar$1(D.node)||isCollection$1(D.node)))D.node.anchor=D.anchor;else{const q=new Error("Failed to resolve repeated object (this should not happen)");throw q.source=I,q}}},sourceObjects:w}}function applyReviver(d,m,g,w){if(w&&typeof w=="object")if(Array.isArray(w))for(let $=0,I=w.length;$<I;++$){const D=w[$],q=applyReviver(d,w,String($),D);q===void 0?delete w[$]:q!==D&&(w[$]=q)}else if(w instanceof Map)for(const $ of Array.from(w.keys())){const I=w.get($),D=applyReviver(d,w,$,I);D===void 0?w.delete($):D!==I&&w.set($,D)}else if(w instanceof Set)for(const $ of Array.from(w)){const I=applyReviver(d,w,$,$);I===void 0?w.delete($):I!==$&&(w.delete($),w.add(I))}else for(const[$,I]of Object.entries(w)){const D=applyReviver(d,w,$,I);D===void 0?delete w[$]:D!==I&&(w[$]=D)}return d.call(m,g,w)}function toJS(d,m,g){if(Array.isArray(d))return d.map((w,$)=>toJS(w,String($),g));if(d&&typeof d.toJSON=="function"){if(!g||!hasAnchor(d))return d.toJSON(m,g);const w={aliasCount:0,count:1,res:void 0};g.anchors.set(d,w),g.onCreate=I=>{w.res=I,delete g.onCreate};const $=d.toJSON(m,g);return g.onCreate&&g.onCreate($),$}return typeof d=="bigint"&&!g?.keep?Number(d):d}class NodeBase{constructor(m){Object.defineProperty(this,NODE_TYPE,{value:m})}clone(){const m=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(m.range=this.range.slice()),m}toJS(m,{mapAsMap:g,maxAliasCount:w,onAnchor:$,reviver:I}={}){if(!isDocument(m))throw new TypeError("A document argument is required");const D={anchors:new Map,doc:m,keep:!0,mapAsMap:g===!0,mapKeyWarned:!1,maxAliasCount:typeof w=="number"?w:100},q=toJS(this,"",D);if(typeof $=="function")for(const{count:j,res:G}of D.anchors.values())$(G,j);return typeof I=="function"?applyReviver(I,{"":q},"",q):q}}class Alias extends NodeBase{constructor(m){super(ALIAS),this.source=m,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(m,g){let w;g?.aliasResolveCache?w=g.aliasResolveCache:(w=[],visit$3(m,{Node:(I,D)=>{(isAlias(D)||hasAnchor(D))&&w.push(D)}}),g&&(g.aliasResolveCache=w));let $;for(const I of w){if(I===this)break;I.anchor===this.source&&($=I)}return $}toJSON(m,g){if(!g)return{source:this.source};const{anchors:w,doc:$,maxAliasCount:I}=g,D=this.resolve($,g);if(!D){const j=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(j)}let q=w.get(D);if(q||(toJS(D,null,g),q=w.get(D)),!q||q.res===void 0){const j="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(j)}if(I>=0&&(q.count+=1,q.aliasCount===0&&(q.aliasCount=getAliasCount($,D,w)),q.count*q.aliasCount>I)){const j="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(j)}return q.res}toString(m,g,w){const $=`*${this.source}`;if(m){if(anchorIsValid(this.source),m.options.verifyAliasOrder&&!m.anchors.has(this.source)){const I=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(I)}if(m.implicitKey)return`${$} `}return $}}function getAliasCount(d,m,g){if(isAlias(m)){const w=m.resolve(d),$=g&&w&&g.get(w);return $?$.count*$.aliasCount:0}else if(isCollection$1(m)){let w=0;for(const $ of m.items){const I=getAliasCount(d,$,g);I>w&&(w=I)}return w}else if(isPair(m)){const w=getAliasCount(d,m.key,g),$=getAliasCount(d,m.value,g);return Math.max(w,$)}return 1}const isScalarValue=d=>!d||typeof d!="function"&&typeof d!="object";class Scalar extends NodeBase{constructor(m){super(SCALAR$1),this.value=m}toJSON(m,g){return g?.keep?this.value:toJS(this.value,m,g)}toString(){return String(this.value)}}Scalar.BLOCK_FOLDED="BLOCK_FOLDED";Scalar.BLOCK_LITERAL="BLOCK_LITERAL";Scalar.PLAIN="PLAIN";Scalar.QUOTE_DOUBLE="QUOTE_DOUBLE";Scalar.QUOTE_SINGLE="QUOTE_SINGLE";const defaultTagPrefix="tag:yaml.org,2002:";function findTagObject(d,m,g){if(m){const w=g.filter(I=>I.tag===m),$=w.find(I=>!I.format)??w[0];if(!$)throw new Error(`Tag ${m} not found`);return $}return g.find(w=>w.identify?.(d)&&!w.format)}function createNode(d,m,g){if(isDocument(d)&&(d=d.contents),isNode(d))return d;if(isPair(d)){const W=g.schema[MAP].createNode?.(g.schema,null,g);return W.items.push(d),W}(d instanceof String||d instanceof Number||d instanceof Boolean||typeof BigInt<"u"&&d instanceof BigInt)&&(d=d.valueOf());const{aliasDuplicateObjects:w,onAnchor:$,onTagObj:I,schema:D,sourceObjects:q}=g;let j;if(w&&d&&typeof d=="object"){if(j=q.get(d),j)return j.anchor??(j.anchor=$(d)),new Alias(j.anchor);j={anchor:null,node:null},q.set(d,j)}m?.startsWith("!!")&&(m=defaultTagPrefix+m.slice(2));let G=findTagObject(d,m,D.tags);if(!G){if(d&&typeof d.toJSON=="function"&&(d=d.toJSON()),!d||typeof d!="object"){const W=new Scalar(d);return j&&(j.node=W),W}G=d instanceof Map?D[MAP]:Symbol.iterator in Object(d)?D[SEQ]:D[MAP]}I&&(I(G),delete g.onTagObj);const H=G?.createNode?G.createNode(g.schema,d,g):typeof G?.nodeClass?.from=="function"?G.nodeClass.from(g.schema,d,g):new Scalar(d);return m?H.tag=m:G.default||(H.tag=G.tag),j&&(j.node=H),H}function collectionFromPath(d,m,g){let w=g;for(let $=m.length-1;$>=0;--$){const I=m[$];if(typeof I=="number"&&Number.isInteger(I)&&I>=0){const D=[];D[I]=w,w=D}else w=new Map([[I,w]])}return createNode(w,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:d,sourceObjects:new Map})}const isEmptyPath=d=>d==null||typeof d=="object"&&!!d[Symbol.iterator]().next().done;class Collection extends NodeBase{constructor(m,g){super(m),Object.defineProperty(this,"schema",{value:g,configurable:!0,enumerable:!1,writable:!0})}clone(m){const g=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return m&&(g.schema=m),g.items=g.items.map(w=>isNode(w)||isPair(w)?w.clone(m):w),this.range&&(g.range=this.range.slice()),g}addIn(m,g){if(isEmptyPath(m))this.add(g);else{const[w,...$]=m,I=this.get(w,!0);if(isCollection$1(I))I.addIn($,g);else if(I===void 0&&this.schema)this.set(w,collectionFromPath(this.schema,$,g));else throw new Error(`Expected YAML collection at ${w}. Remaining path: ${$}`)}}deleteIn(m){const[g,...w]=m;if(w.length===0)return this.delete(g);const $=this.get(g,!0);if(isCollection$1($))return $.deleteIn(w);throw new Error(`Expected YAML collection at ${g}. Remaining path: ${w}`)}getIn(m,g){const[w,...$]=m,I=this.get(w,!0);return $.length===0?!g&&isScalar$1(I)?I.value:I:isCollection$1(I)?I.getIn($,g):void 0}hasAllNullValues(m){return this.items.every(g=>{if(!isPair(g))return!1;const w=g.value;return w==null||m&&isScalar$1(w)&&w.value==null&&!w.commentBefore&&!w.comment&&!w.tag})}hasIn(m){const[g,...w]=m;if(w.length===0)return this.has(g);const $=this.get(g,!0);return isCollection$1($)?$.hasIn(w):!1}setIn(m,g){const[w,...$]=m;if($.length===0)this.set(w,g);else{const I=this.get(w,!0);if(isCollection$1(I))I.setIn($,g);else if(I===void 0&&this.schema)this.set(w,collectionFromPath(this.schema,$,g));else throw new Error(`Expected YAML collection at ${w}. Remaining path: ${$}`)}}}const stringifyComment=d=>d.replace(/^(?!$)(?: $)?/gm,"#");function indentComment(d,m){return/^\n+$/.test(d)?d.substring(1):m?d.replace(/^(?! *$)/gm,m):d}const lineComment=(d,m,g)=>d.endsWith(`
`)?indentComment(g,m):g.includes(`
`)?`
`+indentComment(g,m):(d.endsWith(" ")?"":" ")+g,FOLD_FLOW="flow",FOLD_BLOCK="block",FOLD_QUOTED="quoted";function foldFlowLines(d,m,g="flow",{indentAtStart:w,lineWidth:$=80,minContentWidth:I=20,onFold:D,onOverflow:q}={}){if(!$||$<0)return d;$<I&&(I=0);const j=Math.max(1+I,1+$-m.length);if(d.length<=j)return d;const G=[],H={};let W=$-m.length;typeof w=="number"&&(w>$-Math.max(2,I)?G.push(0):W=$-w);let V,K,Z=!1,Q=-1,J=-1,re=-1;g===FOLD_BLOCK&&(Q=consumeMoreIndentedLines(d,Q,m.length),Q!==-1&&(W=Q+j));for(let oe;oe=d[Q+=1];){if(g===FOLD_QUOTED&&oe==="\\"){switch(J=Q,d[Q+1]){case"x":Q+=3;break;case"u":Q+=5;break;case"U":Q+=9;break;default:Q+=1}re=Q}if(oe===`
`)g===FOLD_BLOCK&&(Q=consumeMoreIndentedLines(d,Q,m.length)),W=Q+m.length+j,V=void 0;else{if(oe===" "&&K&&K!==" "&&K!==`
`&&K!=="	"){const ee=d[Q+1];ee&&ee!==" "&&ee!==`
`&&ee!=="	"&&(V=Q)}if(Q>=W)if(V)G.push(V),W=V+j,V=void 0;else if(g===FOLD_QUOTED){for(;K===" "||K==="	";)K=oe,oe=d[Q+=1],Z=!0;const ee=Q>re+1?Q-2:J-1;if(H[ee])return d;G.push(ee),H[ee]=!0,W=ee+j,V=void 0}else Z=!0}K=oe}if(Z&&q&&q(),G.length===0)return d;D&&D();let se=d.slice(0,G[0]);for(let oe=0;oe<G.length;++oe){const ee=G[oe],ae=G[oe+1]||d.length;ee===0?se=`
${m}${d.slice(0,ae)}`:(g===FOLD_QUOTED&&H[ee]&&(se+=`${d[ee]}\\`),se+=`
${m}${d.slice(ee+1,ae)}`)}return se}function consumeMoreIndentedLines(d,m,g){let w=m,$=m+1,I=d[$];for(;I===" "||I==="	";)if(m<$+g)I=d[++m];else{do I=d[++m];while(I&&I!==`
`);w=m,$=m+1,I=d[$]}return w}const getFoldOptions=(d,m)=>({indentAtStart:m?d.indent.length:d.indentAtStart,lineWidth:d.options.lineWidth,minContentWidth:d.options.minContentWidth}),containsDocumentMarker=d=>/^(%|---|\.\.\.)/m.test(d);function lineLengthOverLimit(d,m,g){if(!m||m<0)return!1;const w=m-g,$=d.length;if($<=w)return!1;for(let I=0,D=0;I<$;++I)if(d[I]===`
`){if(I-D>w)return!0;if(D=I+1,$-D<=w)return!1}return!0}function doubleQuotedString(d,m){const g=JSON.stringify(d);if(m.options.doubleQuotedAsJSON)return g;const{implicitKey:w}=m,$=m.options.doubleQuotedMinMultiLineLength,I=m.indent||(containsDocumentMarker(d)?"  ":"");let D="",q=0;for(let j=0,G=g[j];G;G=g[++j])if(G===" "&&g[j+1]==="\\"&&g[j+2]==="n"&&(D+=g.slice(q,j)+"\\ ",j+=1,q=j,G="\\"),G==="\\")switch(g[j+1]){case"u":{D+=g.slice(q,j);const H=g.substr(j+2,4);switch(H){case"0000":D+="\\0";break;case"0007":D+="\\a";break;case"000b":D+="\\v";break;case"001b":D+="\\e";break;case"0085":D+="\\N";break;case"00a0":D+="\\_";break;case"2028":D+="\\L";break;case"2029":D+="\\P";break;default:H.substr(0,2)==="00"?D+="\\x"+H.substr(2):D+=g.substr(j,6)}j+=5,q=j+1}break;case"n":if(w||g[j+2]==='"'||g.length<$)j+=1;else{for(D+=g.slice(q,j)+`

`;g[j+2]==="\\"&&g[j+3]==="n"&&g[j+4]!=='"';)D+=`
`,j+=2;D+=I,g[j+2]===" "&&(D+="\\"),j+=1,q=j+1}break;default:j+=1}return D=q?D+g.slice(q):g,w?D:foldFlowLines(D,I,FOLD_QUOTED,getFoldOptions(m,!1))}function singleQuotedString(d,m){if(m.options.singleQuote===!1||m.implicitKey&&d.includes(`
`)||/[ \t]\n|\n[ \t]/.test(d))return doubleQuotedString(d,m);const g=m.indent||(containsDocumentMarker(d)?"  ":""),w="'"+d.replace(/'/g,"''").replace(/\n+/g,`$&
${g}`)+"'";return m.implicitKey?w:foldFlowLines(w,g,FOLD_FLOW,getFoldOptions(m,!1))}function quotedString(d,m){const{singleQuote:g}=m.options;let w;if(g===!1)w=doubleQuotedString;else{const $=d.includes('"'),I=d.includes("'");$&&!I?w=singleQuotedString:I&&!$?w=doubleQuotedString:w=g?singleQuotedString:doubleQuotedString}return w(d,m)}let blockEndNewlines;try{blockEndNewlines=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{blockEndNewlines=/\n+(?!\n|$)/g}function blockString({comment:d,type:m,value:g},w,$,I){const{blockQuote:D,commentString:q,lineWidth:j}=w.options;if(!D||/\n[\t ]+$/.test(g))return quotedString(g,w);const G=w.indent||(w.forceBlockIndent||containsDocumentMarker(g)?"  ":""),H=D==="literal"?!0:D==="folded"||m===Scalar.BLOCK_FOLDED?!1:m===Scalar.BLOCK_LITERAL?!0:!lineLengthOverLimit(g,j,G.length);if(!g)return H?`|
`:`>
`;let W,V;for(V=g.length;V>0;--V){const ae=g[V-1];if(ae!==`
`&&ae!=="	"&&ae!==" ")break}let K=g.substring(V);const Z=K.indexOf(`
`);Z===-1?W="-":g===K||Z!==K.length-1?(W="+",I&&I()):W="",K&&(g=g.slice(0,-K.length),K[K.length-1]===`
`&&(K=K.slice(0,-1)),K=K.replace(blockEndNewlines,`$&${G}`));let Q=!1,J,re=-1;for(J=0;J<g.length;++J){const ae=g[J];if(ae===" ")Q=!0;else if(ae===`
`)re=J;else break}let se=g.substring(0,re<J?re+1:J);se&&(g=g.substring(se.length),se=se.replace(/\n+/g,`$&${G}`));let ee=(Q?G?"2":"1":"")+W;if(d&&(ee+=" "+q(d.replace(/ ?[\r\n]+/g," ")),$&&$()),!H){const ae=g.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${G}`);let ce=!1;const le=getFoldOptions(w,!0);D!=="folded"&&m!==Scalar.BLOCK_FOLDED&&(le.onOverflow=()=>{ce=!0});const de=foldFlowLines(`${se}${ae}${K}`,G,FOLD_BLOCK,le);if(!ce)return`>${ee}
${G}${de}`}return g=g.replace(/\n+/g,`$&${G}`),`|${ee}
${G}${se}${g}${K}`}function plainString(d,m,g,w){const{type:$,value:I}=d,{actualString:D,implicitKey:q,indent:j,indentStep:G,inFlow:H}=m;if(q&&I.includes(`
`)||H&&/[[\]{},]/.test(I))return quotedString(I,m);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(I))return q||H||!I.includes(`
`)?quotedString(I,m):blockString(d,m,g,w);if(!q&&!H&&$!==Scalar.PLAIN&&I.includes(`
`))return blockString(d,m,g,w);if(containsDocumentMarker(I)){if(j==="")return m.forceBlockIndent=!0,blockString(d,m,g,w);if(q&&j===G)return quotedString(I,m)}const W=I.replace(/\n+/g,`$&
${j}`);if(D){const V=Q=>Q.default&&Q.tag!=="tag:yaml.org,2002:str"&&Q.test?.test(W),{compat:K,tags:Z}=m.doc.schema;if(Z.some(V)||K?.some(V))return quotedString(I,m)}return q?W:foldFlowLines(W,j,FOLD_FLOW,getFoldOptions(m,!1))}function stringifyString(d,m,g,w){const{implicitKey:$,inFlow:I}=m,D=typeof d.value=="string"?d:Object.assign({},d,{value:String(d.value)});let{type:q}=d;q!==Scalar.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(D.value)&&(q=Scalar.QUOTE_DOUBLE);const j=H=>{switch(H){case Scalar.BLOCK_FOLDED:case Scalar.BLOCK_LITERAL:return $||I?quotedString(D.value,m):blockString(D,m,g,w);case Scalar.QUOTE_DOUBLE:return doubleQuotedString(D.value,m);case Scalar.QUOTE_SINGLE:return singleQuotedString(D.value,m);case Scalar.PLAIN:return plainString(D,m,g,w);default:return null}};let G=j(q);if(G===null){const{defaultKeyType:H,defaultStringType:W}=m.options,V=$&&H||W;if(G=j(V),G===null)throw new Error(`Unsupported default string type ${V}`)}return G}function createStringifyContext(d,m){const g=Object.assign({blockQuote:!0,commentString:stringifyComment,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},d.schema.toStringOptions,m);let w;switch(g.collectionStyle){case"block":w=!1;break;case"flow":w=!0;break;default:w=null}return{anchors:new Set,doc:d,flowCollectionPadding:g.flowCollectionPadding?" ":"",indent:"",indentStep:typeof g.indent=="number"?" ".repeat(g.indent):"  ",inFlow:w,options:g}}function getTagObject(d,m){if(m.tag){const $=d.filter(I=>I.tag===m.tag);if($.length>0)return $.find(I=>I.format===m.format)??$[0]}let g,w;if(isScalar$1(m)){w=m.value;let $=d.filter(I=>I.identify?.(w));if($.length>1){const I=$.filter(D=>D.test);I.length>0&&($=I)}g=$.find(I=>I.format===m.format)??$.find(I=>!I.format)}else w=m,g=d.find($=>$.nodeClass&&w instanceof $.nodeClass);if(!g){const $=w?.constructor?.name??(w===null?"null":typeof w);throw new Error(`Tag not resolved for ${$} value`)}return g}function stringifyProps(d,m,{anchors:g,doc:w}){if(!w.directives)return"";const $=[],I=(isScalar$1(d)||isCollection$1(d))&&d.anchor;I&&anchorIsValid(I)&&(g.add(I),$.push(`&${I}`));const D=d.tag??(m.default?null:m.tag);return D&&$.push(w.directives.tagString(D)),$.join(" ")}function stringify$3(d,m,g,w){if(isPair(d))return d.toString(m,g,w);if(isAlias(d)){if(m.doc.directives)return d.toString(m);if(m.resolvedAliases?.has(d))throw new TypeError("Cannot stringify circular structure without alias nodes");m.resolvedAliases?m.resolvedAliases.add(d):m.resolvedAliases=new Set([d]),d=d.resolve(m.doc)}let $;const I=isNode(d)?d:m.doc.createNode(d,{onTagObj:j=>$=j});$??($=getTagObject(m.doc.schema.tags,I));const D=stringifyProps(I,$,m);D.length>0&&(m.indentAtStart=(m.indentAtStart??0)+D.length+1);const q=typeof $.stringify=="function"?$.stringify(I,m,g,w):isScalar$1(I)?stringifyString(I,m,g,w):I.toString(m,g,w);return D?isScalar$1(I)||q[0]==="{"||q[0]==="["?`${D} ${q}`:`${D}
${m.indent}${q}`:q}function stringifyPair({key:d,value:m},g,w,$){const{allNullValues:I,doc:D,indent:q,indentStep:j,options:{commentString:G,indentSeq:H,simpleKeys:W}}=g;let V=isNode(d)&&d.comment||null;if(W){if(V)throw new Error("With simple keys, key nodes cannot have comments");if(isCollection$1(d)||!isNode(d)&&typeof d=="object"){const le="With simple keys, collection cannot be used as a key value";throw new Error(le)}}let K=!W&&(!d||V&&m==null&&!g.inFlow||isCollection$1(d)||(isScalar$1(d)?d.type===Scalar.BLOCK_FOLDED||d.type===Scalar.BLOCK_LITERAL:typeof d=="object"));g=Object.assign({},g,{allNullValues:!1,implicitKey:!K&&(W||!I),indent:q+j});let Z=!1,Q=!1,J=stringify$3(d,g,()=>Z=!0,()=>Q=!0);if(!K&&!g.inFlow&&J.length>1024){if(W)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");K=!0}if(g.inFlow){if(I||m==null)return Z&&w&&w(),J===""?"?":K?`? ${J}`:J}else if(I&&!W||m==null&&K)return J=`? ${J}`,V&&!Z?J+=lineComment(J,g.indent,G(V)):Q&&$&&$(),J;Z&&(V=null),K?(V&&(J+=lineComment(J,g.indent,G(V))),J=`? ${J}
${q}:`):(J=`${J}:`,V&&(J+=lineComment(J,g.indent,G(V))));let re,se,oe;isNode(m)?(re=!!m.spaceBefore,se=m.commentBefore,oe=m.comment):(re=!1,se=null,oe=null,m&&typeof m=="object"&&(m=D.createNode(m))),g.implicitKey=!1,!K&&!V&&isScalar$1(m)&&(g.indentAtStart=J.length+1),Q=!1,!H&&j.length>=2&&!g.inFlow&&!K&&isSeq(m)&&!m.flow&&!m.tag&&!m.anchor&&(g.indent=g.indent.substring(2));let ee=!1;const ae=stringify$3(m,g,()=>ee=!0,()=>Q=!0);let ce=" ";if(V||re||se){if(ce=re?`
`:"",se){const le=G(se);ce+=`
${indentComment(le,g.indent)}`}ae===""&&!g.inFlow?ce===`
`&&(ce=`

`):ce+=`
${g.indent}`}else if(!K&&isCollection$1(m)){const le=ae[0],de=ae.indexOf(`
`),_e=de!==-1,we=g.inFlow??m.flow??m.items.length===0;if(_e||!we){let pe=!1;if(_e&&(le==="&"||le==="!")){let xe=ae.indexOf(" ");le==="&"&&xe!==-1&&xe<de&&ae[xe+1]==="!"&&(xe=ae.indexOf(" ",xe+1)),(xe===-1||de<xe)&&(pe=!0)}pe||(ce=`
${g.indent}`)}}else(ae===""||ae[0]===`
`)&&(ce="");return J+=ce+ae,g.inFlow?ee&&w&&w():oe&&!ee?J+=lineComment(J,g.indent,G(oe)):Q&&$&&$(),J}function warn(d,m){(d==="debug"||d==="warn")&&console.warn(m)}const MERGE_KEY="<<",merge={identify:d=>d===MERGE_KEY||typeof d=="symbol"&&d.description===MERGE_KEY,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new Scalar(Symbol(MERGE_KEY)),{addToJSMap:addMergeToJSMap}),stringify:()=>MERGE_KEY},isMergeKey=(d,m)=>(merge.identify(m)||isScalar$1(m)&&(!m.type||m.type===Scalar.PLAIN)&&merge.identify(m.value))&&d?.doc.schema.tags.some(g=>g.tag===merge.tag&&g.default);function addMergeToJSMap(d,m,g){if(g=d&&isAlias(g)?g.resolve(d.doc):g,isSeq(g))for(const w of g.items)mergeValue(d,m,w);else if(Array.isArray(g))for(const w of g)mergeValue(d,m,w);else mergeValue(d,m,g)}function mergeValue(d,m,g){const w=d&&isAlias(g)?g.resolve(d.doc):g;if(!isMap(w))throw new Error("Merge sources must be maps or map aliases");const $=w.toJSON(null,d,Map);for(const[I,D]of $)m instanceof Map?m.has(I)||m.set(I,D):m instanceof Set?m.add(I):Object.prototype.hasOwnProperty.call(m,I)||Object.defineProperty(m,I,{value:D,writable:!0,enumerable:!0,configurable:!0});return m}function addPairToJSMap(d,m,{key:g,value:w}){if(isNode(g)&&g.addToJSMap)g.addToJSMap(d,m,w);else if(isMergeKey(d,g))addMergeToJSMap(d,m,w);else{const $=toJS(g,"",d);if(m instanceof Map)m.set($,toJS(w,$,d));else if(m instanceof Set)m.add($);else{const I=stringifyKey(g,$,d),D=toJS(w,I,d);I in m?Object.defineProperty(m,I,{value:D,writable:!0,enumerable:!0,configurable:!0}):m[I]=D}}return m}function stringifyKey(d,m,g){if(m===null)return"";if(typeof m!="object")return String(m);if(isNode(d)&&g?.doc){const w=createStringifyContext(g.doc,{});w.anchors=new Set;for(const I of g.anchors.keys())w.anchors.add(I.anchor);w.inFlow=!0,w.inStringifyKey=!0;const $=d.toString(w);if(!g.mapKeyWarned){let I=JSON.stringify($);I.length>40&&(I=I.substring(0,36)+'..."'),warn(g.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${I}. Set mapAsMap: true to use object keys.`),g.mapKeyWarned=!0}return $}return JSON.stringify(m)}function createPair(d,m,g){const w=createNode(d,void 0,g),$=createNode(m,void 0,g);return new Pair(w,$)}class Pair{constructor(m,g=null){Object.defineProperty(this,NODE_TYPE,{value:PAIR}),this.key=m,this.value=g}clone(m){let{key:g,value:w}=this;return isNode(g)&&(g=g.clone(m)),isNode(w)&&(w=w.clone(m)),new Pair(g,w)}toJSON(m,g){const w=g?.mapAsMap?new Map:{};return addPairToJSMap(g,w,this)}toString(m,g,w){return m?.doc?stringifyPair(this,m,g,w):JSON.stringify(this)}}function stringifyCollection(d,m,g){return(m.inFlow??d.flow?stringifyFlowCollection:stringifyBlockCollection)(d,m,g)}function stringifyBlockCollection({comment:d,items:m},g,{blockItemPrefix:w,flowChars:$,itemIndent:I,onChompKeep:D,onComment:q}){const{indent:j,options:{commentString:G}}=g,H=Object.assign({},g,{indent:I,type:null});let W=!1;const V=[];for(let Z=0;Z<m.length;++Z){const Q=m[Z];let J=null;if(isNode(Q))!W&&Q.spaceBefore&&V.push(""),addCommentBefore(g,V,Q.commentBefore,W),Q.comment&&(J=Q.comment);else if(isPair(Q)){const se=isNode(Q.key)?Q.key:null;se&&(!W&&se.spaceBefore&&V.push(""),addCommentBefore(g,V,se.commentBefore,W))}W=!1;let re=stringify$3(Q,H,()=>J=null,()=>W=!0);J&&(re+=lineComment(re,I,G(J))),W&&J&&(W=!1),V.push(w+re)}let K;if(V.length===0)K=$.start+$.end;else{K=V[0];for(let Z=1;Z<V.length;++Z){const Q=V[Z];K+=Q?`
${j}${Q}`:`
`}}return d?(K+=`
`+indentComment(G(d),j),q&&q()):W&&D&&D(),K}function stringifyFlowCollection({items:d},m,{flowChars:g,itemIndent:w}){const{indent:$,indentStep:I,flowCollectionPadding:D,options:{commentString:q}}=m;w+=I;const j=Object.assign({},m,{indent:w,inFlow:!0,type:null});let G=!1,H=0;const W=[];for(let Z=0;Z<d.length;++Z){const Q=d[Z];let J=null;if(isNode(Q))Q.spaceBefore&&W.push(""),addCommentBefore(m,W,Q.commentBefore,!1),Q.comment&&(J=Q.comment);else if(isPair(Q)){const se=isNode(Q.key)?Q.key:null;se&&(se.spaceBefore&&W.push(""),addCommentBefore(m,W,se.commentBefore,!1),se.comment&&(G=!0));const oe=isNode(Q.value)?Q.value:null;oe?(oe.comment&&(J=oe.comment),oe.commentBefore&&(G=!0)):Q.value==null&&se?.comment&&(J=se.comment)}J&&(G=!0);let re=stringify$3(Q,j,()=>J=null);Z<d.length-1&&(re+=","),J&&(re+=lineComment(re,w,q(J))),!G&&(W.length>H||re.includes(`
`))&&(G=!0),W.push(re),H=W.length}const{start:V,end:K}=g;if(W.length===0)return V+K;if(!G){const Z=W.reduce((Q,J)=>Q+J.length+2,2);G=m.options.lineWidth>0&&Z>m.options.lineWidth}if(G){let Z=V;for(const Q of W)Z+=Q?`
${I}${$}${Q}`:`
`;return`${Z}
${$}${K}`}else return`${V}${D}${W.join(" ")}${D}${K}`}function addCommentBefore({indent:d,options:{commentString:m}},g,w,$){if(w&&$&&(w=w.replace(/^\n+/,"")),w){const I=indentComment(m(w),d);g.push(I.trimStart())}}function findPair(d,m){const g=isScalar$1(m)?m.value:m;for(const w of d)if(isPair(w)&&(w.key===m||w.key===g||isScalar$1(w.key)&&w.key.value===g))return w}class YAMLMap extends Collection{static get tagName(){return"tag:yaml.org,2002:map"}constructor(m){super(MAP,m),this.items=[]}static from(m,g,w){const{keepUndefined:$,replacer:I}=w,D=new this(m),q=(j,G)=>{if(typeof I=="function")G=I.call(g,j,G);else if(Array.isArray(I)&&!I.includes(j))return;(G!==void 0||$)&&D.items.push(createPair(j,G,w))};if(g instanceof Map)for(const[j,G]of g)q(j,G);else if(g&&typeof g=="object")for(const j of Object.keys(g))q(j,g[j]);return typeof m.sortMapEntries=="function"&&D.items.sort(m.sortMapEntries),D}add(m,g){let w;isPair(m)?w=m:!m||typeof m!="object"||!("key"in m)?w=new Pair(m,m?.value):w=new Pair(m.key,m.value);const $=findPair(this.items,w.key),I=this.schema?.sortMapEntries;if($){if(!g)throw new Error(`Key ${w.key} already set`);isScalar$1($.value)&&isScalarValue(w.value)?$.value.value=w.value:$.value=w.value}else if(I){const D=this.items.findIndex(q=>I(w,q)<0);D===-1?this.items.push(w):this.items.splice(D,0,w)}else this.items.push(w)}delete(m){const g=findPair(this.items,m);return g?this.items.splice(this.items.indexOf(g),1).length>0:!1}get(m,g){const $=findPair(this.items,m)?.value;return(!g&&isScalar$1($)?$.value:$)??void 0}has(m){return!!findPair(this.items,m)}set(m,g){this.add(new Pair(m,g),!0)}toJSON(m,g,w){const $=w?new w:g?.mapAsMap?new Map:{};g?.onCreate&&g.onCreate($);for(const I of this.items)addPairToJSMap(g,$,I);return $}toString(m,g,w){if(!m)return JSON.stringify(this);for(const $ of this.items)if(!isPair($))throw new Error(`Map items must all be pairs; found ${JSON.stringify($)} instead`);return!m.allNullValues&&this.hasAllNullValues(!1)&&(m=Object.assign({},m,{allNullValues:!0})),stringifyCollection(this,m,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:m.indent||"",onChompKeep:w,onComment:g})}}const map={collection:"map",default:!0,nodeClass:YAMLMap,tag:"tag:yaml.org,2002:map",resolve(d,m){return isMap(d)||m("Expected a mapping for this tag"),d},createNode:(d,m,g)=>YAMLMap.from(d,m,g)};class YAMLSeq extends Collection{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(m){super(SEQ,m),this.items=[]}add(m){this.items.push(m)}delete(m){const g=asItemIndex(m);return typeof g!="number"?!1:this.items.splice(g,1).length>0}get(m,g){const w=asItemIndex(m);if(typeof w!="number")return;const $=this.items[w];return!g&&isScalar$1($)?$.value:$}has(m){const g=asItemIndex(m);return typeof g=="number"&&g<this.items.length}set(m,g){const w=asItemIndex(m);if(typeof w!="number")throw new Error(`Expected a valid index, not ${m}.`);const $=this.items[w];isScalar$1($)&&isScalarValue(g)?$.value=g:this.items[w]=g}toJSON(m,g){const w=[];g?.onCreate&&g.onCreate(w);let $=0;for(const I of this.items)w.push(toJS(I,String($++),g));return w}toString(m,g,w){return m?stringifyCollection(this,m,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(m.indent||"")+"  ",onChompKeep:w,onComment:g}):JSON.stringify(this)}static from(m,g,w){const{replacer:$}=w,I=new this(m);if(g&&Symbol.iterator in Object(g)){let D=0;for(let q of g){if(typeof $=="function"){const j=g instanceof Set?q:String(D++);q=$.call(g,j,q)}I.items.push(createNode(q,void 0,w))}}return I}}function asItemIndex(d){let m=isScalar$1(d)?d.value:d;return m&&typeof m=="string"&&(m=Number(m)),typeof m=="number"&&Number.isInteger(m)&&m>=0?m:null}const seq={collection:"seq",default:!0,nodeClass:YAMLSeq,tag:"tag:yaml.org,2002:seq",resolve(d,m){return isSeq(d)||m("Expected a sequence for this tag"),d},createNode:(d,m,g)=>YAMLSeq.from(d,m,g)},string={identify:d=>typeof d=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:d=>d,stringify(d,m,g,w){return m=Object.assign({actualString:!0},m),stringifyString(d,m,g,w)}},nullTag={identify:d=>d==null,createNode:()=>new Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new Scalar(null),stringify:({source:d},m)=>typeof d=="string"&&nullTag.test.test(d)?d:m.options.nullStr},boolTag={identify:d=>typeof d=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:d=>new Scalar(d[0]==="t"||d[0]==="T"),stringify({source:d,value:m},g){if(d&&boolTag.test.test(d)){const w=d[0]==="t"||d[0]==="T";if(m===w)return d}return m?g.options.trueStr:g.options.falseStr}};function stringifyNumber({format:d,minFractionDigits:m,tag:g,value:w}){if(typeof w=="bigint")return String(w);const $=typeof w=="number"?w:Number(w);if(!isFinite($))return isNaN($)?".nan":$<0?"-.inf":".inf";let I=JSON.stringify(w);if(!d&&m&&(!g||g==="tag:yaml.org,2002:float")&&/^\d/.test(I)){let D=I.indexOf(".");D<0&&(D=I.length,I+=".");let q=m-(I.length-D-1);for(;q-- >0;)I+="0"}return I}const floatNaN$1={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:d=>d.slice(-3).toLowerCase()==="nan"?NaN:d[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:stringifyNumber},floatExp$1={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:d=>parseFloat(d),stringify(d){const m=Number(d.value);return isFinite(m)?m.toExponential():stringifyNumber(d)}},float$1={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(d){const m=new Scalar(parseFloat(d)),g=d.indexOf(".");return g!==-1&&d[d.length-1]==="0"&&(m.minFractionDigits=d.length-g-1),m},stringify:stringifyNumber},intIdentify$2=d=>typeof d=="bigint"||Number.isInteger(d),intResolve$1=(d,m,g,{intAsBigInt:w})=>w?BigInt(d):parseInt(d.substring(m),g);function intStringify$1(d,m,g){const{value:w}=d;return intIdentify$2(w)&&w>=0?g+w.toString(m):stringifyNumber(d)}const intOct$1={identify:d=>intIdentify$2(d)&&d>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(d,m,g)=>intResolve$1(d,2,8,g),stringify:d=>intStringify$1(d,8,"0o")},int$1={identify:intIdentify$2,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(d,m,g)=>intResolve$1(d,0,10,g),stringify:stringifyNumber},intHex$1={identify:d=>intIdentify$2(d)&&d>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(d,m,g)=>intResolve$1(d,2,16,g),stringify:d=>intStringify$1(d,16,"0x")},schema$2=[map,seq,string,nullTag,boolTag,intOct$1,int$1,intHex$1,floatNaN$1,floatExp$1,float$1];function intIdentify$1(d){return typeof d=="bigint"||Number.isInteger(d)}const stringifyJSON=({value:d})=>JSON.stringify(d),jsonScalars=[{identify:d=>typeof d=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:d=>d,stringify:stringifyJSON},{identify:d=>d==null,createNode:()=>new Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:stringifyJSON},{identify:d=>typeof d=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:d=>d==="true",stringify:stringifyJSON},{identify:intIdentify$1,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(d,m,{intAsBigInt:g})=>g?BigInt(d):parseInt(d,10),stringify:({value:d})=>intIdentify$1(d)?d.toString():JSON.stringify(d)},{identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:d=>parseFloat(d),stringify:stringifyJSON}],jsonError={default:!0,tag:"",test:/^/,resolve(d,m){return m(`Unresolved plain scalar ${JSON.stringify(d)}`),d}},schema$1=[map,seq].concat(jsonScalars,jsonError),binary={identify:d=>d instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(d,m){if(typeof atob=="function"){const g=atob(d.replace(/[\n\r]/g,"")),w=new Uint8Array(g.length);for(let $=0;$<g.length;++$)w[$]=g.charCodeAt($);return w}else return m("This environment does not support reading binary tags; either Buffer or atob is required"),d},stringify({comment:d,type:m,value:g},w,$,I){if(!g)return"";const D=g;let q;if(typeof btoa=="function"){let j="";for(let G=0;G<D.length;++G)j+=String.fromCharCode(D[G]);q=btoa(j)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(m??(m=Scalar.BLOCK_LITERAL),m!==Scalar.QUOTE_DOUBLE){const j=Math.max(w.options.lineWidth-w.indent.length,w.options.minContentWidth),G=Math.ceil(q.length/j),H=new Array(G);for(let W=0,V=0;W<G;++W,V+=j)H[W]=q.substr(V,j);q=H.join(m===Scalar.BLOCK_LITERAL?`
`:" ")}return stringifyString({comment:d,type:m,value:q},w,$,I)}};function resolvePairs(d,m){if(isSeq(d))for(let g=0;g<d.items.length;++g){let w=d.items[g];if(!isPair(w)){if(isMap(w)){w.items.length>1&&m("Each pair must have its own sequence indicator");const $=w.items[0]||new Pair(new Scalar(null));if(w.commentBefore&&($.key.commentBefore=$.key.commentBefore?`${w.commentBefore}
${$.key.commentBefore}`:w.commentBefore),w.comment){const I=$.value??$.key;I.comment=I.comment?`${w.comment}
${I.comment}`:w.comment}w=$}d.items[g]=isPair(w)?w:new Pair(w)}}else m("Expected a sequence for this tag");return d}function createPairs(d,m,g){const{replacer:w}=g,$=new YAMLSeq(d);$.tag="tag:yaml.org,2002:pairs";let I=0;if(m&&Symbol.iterator in Object(m))for(let D of m){typeof w=="function"&&(D=w.call(m,String(I++),D));let q,j;if(Array.isArray(D))if(D.length===2)q=D[0],j=D[1];else throw new TypeError(`Expected [key, value] tuple: ${D}`);else if(D&&D instanceof Object){const G=Object.keys(D);if(G.length===1)q=G[0],j=D[q];else throw new TypeError(`Expected tuple with one key, not ${G.length} keys`)}else q=D;$.items.push(createPair(q,j,g))}return $}const pairs={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:resolvePairs,createNode:createPairs};class YAMLOMap extends YAMLSeq{constructor(){super(),this.add=YAMLMap.prototype.add.bind(this),this.delete=YAMLMap.prototype.delete.bind(this),this.get=YAMLMap.prototype.get.bind(this),this.has=YAMLMap.prototype.has.bind(this),this.set=YAMLMap.prototype.set.bind(this),this.tag=YAMLOMap.tag}toJSON(m,g){if(!g)return super.toJSON(m);const w=new Map;g?.onCreate&&g.onCreate(w);for(const $ of this.items){let I,D;if(isPair($)?(I=toJS($.key,"",g),D=toJS($.value,I,g)):I=toJS($,"",g),w.has(I))throw new Error("Ordered maps must not include duplicate keys");w.set(I,D)}return w}static from(m,g,w){const $=createPairs(m,g,w),I=new this;return I.items=$.items,I}}YAMLOMap.tag="tag:yaml.org,2002:omap";const omap={collection:"seq",identify:d=>d instanceof Map,nodeClass:YAMLOMap,default:!1,tag:"tag:yaml.org,2002:omap",resolve(d,m){const g=resolvePairs(d,m),w=[];for(const{key:$}of g.items)isScalar$1($)&&(w.includes($.value)?m(`Ordered maps must not include duplicate keys: ${$.value}`):w.push($.value));return Object.assign(new YAMLOMap,g)},createNode:(d,m,g)=>YAMLOMap.from(d,m,g)};function boolStringify({value:d,source:m},g){return m&&(d?trueTag:falseTag).test.test(m)?m:d?g.options.trueStr:g.options.falseStr}const trueTag={identify:d=>d===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new Scalar(!0),stringify:boolStringify},falseTag={identify:d=>d===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new Scalar(!1),stringify:boolStringify},floatNaN={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:d=>d.slice(-3).toLowerCase()==="nan"?NaN:d[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:stringifyNumber},floatExp={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:d=>parseFloat(d.replace(/_/g,"")),stringify(d){const m=Number(d.value);return isFinite(m)?m.toExponential():stringifyNumber(d)}},float={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(d){const m=new Scalar(parseFloat(d.replace(/_/g,""))),g=d.indexOf(".");if(g!==-1){const w=d.substring(g+1).replace(/_/g,"");w[w.length-1]==="0"&&(m.minFractionDigits=w.length)}return m},stringify:stringifyNumber},intIdentify=d=>typeof d=="bigint"||Number.isInteger(d);function intResolve(d,m,g,{intAsBigInt:w}){const $=d[0];if(($==="-"||$==="+")&&(m+=1),d=d.substring(m).replace(/_/g,""),w){switch(g){case 2:d=`0b${d}`;break;case 8:d=`0o${d}`;break;case 16:d=`0x${d}`;break}const D=BigInt(d);return $==="-"?BigInt(-1)*D:D}const I=parseInt(d,g);return $==="-"?-1*I:I}function intStringify(d,m,g){const{value:w}=d;if(intIdentify(w)){const $=w.toString(m);return w<0?"-"+g+$.substr(1):g+$}return stringifyNumber(d)}const intBin={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(d,m,g)=>intResolve(d,2,2,g),stringify:d=>intStringify(d,2,"0b")},intOct={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(d,m,g)=>intResolve(d,1,8,g),stringify:d=>intStringify(d,8,"0")},int={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(d,m,g)=>intResolve(d,0,10,g),stringify:stringifyNumber},intHex={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(d,m,g)=>intResolve(d,2,16,g),stringify:d=>intStringify(d,16,"0x")};class YAMLSet extends YAMLMap{constructor(m){super(m),this.tag=YAMLSet.tag}add(m){let g;isPair(m)?g=m:m&&typeof m=="object"&&"key"in m&&"value"in m&&m.value===null?g=new Pair(m.key,null):g=new Pair(m,null),findPair(this.items,g.key)||this.items.push(g)}get(m,g){const w=findPair(this.items,m);return!g&&isPair(w)?isScalar$1(w.key)?w.key.value:w.key:w}set(m,g){if(typeof g!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof g}`);const w=findPair(this.items,m);w&&!g?this.items.splice(this.items.indexOf(w),1):!w&&g&&this.items.push(new Pair(m))}toJSON(m,g){return super.toJSON(m,g,Set)}toString(m,g,w){if(!m)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},m,{allNullValues:!0}),g,w);throw new Error("Set items must all have null values")}static from(m,g,w){const{replacer:$}=w,I=new this(m);if(g&&Symbol.iterator in Object(g))for(let D of g)typeof $=="function"&&(D=$.call(g,D,D)),I.items.push(createPair(D,null,w));return I}}YAMLSet.tag="tag:yaml.org,2002:set";const set$2={collection:"map",identify:d=>d instanceof Set,nodeClass:YAMLSet,default:!1,tag:"tag:yaml.org,2002:set",createNode:(d,m,g)=>YAMLSet.from(d,m,g),resolve(d,m){if(isMap(d)){if(d.hasAllNullValues(!0))return Object.assign(new YAMLSet,d);m("Set items must all have null values")}else m("Expected a mapping for this tag");return d}};function parseSexagesimal(d,m){const g=d[0],w=g==="-"||g==="+"?d.substring(1):d,$=D=>m?BigInt(D):Number(D),I=w.replace(/_/g,"").split(":").reduce((D,q)=>D*$(60)+$(q),$(0));return g==="-"?$(-1)*I:I}function stringifySexagesimal(d){let{value:m}=d,g=D=>D;if(typeof m=="bigint")g=D=>BigInt(D);else if(isNaN(m)||!isFinite(m))return stringifyNumber(d);let w="";m<0&&(w="-",m*=g(-1));const $=g(60),I=[m%$];return m<60?I.unshift(0):(m=(m-I[0])/$,I.unshift(m%$),m>=60&&(m=(m-I[0])/$,I.unshift(m))),w+I.map(D=>String(D).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const intTime={identify:d=>typeof d=="bigint"||Number.isInteger(d),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(d,m,{intAsBigInt:g})=>parseSexagesimal(d,g),stringify:stringifySexagesimal},floatTime={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:d=>parseSexagesimal(d,!1),stringify:stringifySexagesimal},timestamp={identify:d=>d instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(d){const m=d.match(timestamp.test);if(!m)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,g,w,$,I,D,q]=m.map(Number),j=m[7]?Number((m[7]+"00").substr(1,3)):0;let G=Date.UTC(g,w-1,$,I||0,D||0,q||0,j);const H=m[8];if(H&&H!=="Z"){let W=parseSexagesimal(H,!1);Math.abs(W)<30&&(W*=60),G-=6e4*W}return new Date(G)},stringify:({value:d})=>d?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""},schema=[map,seq,string,nullTag,trueTag,falseTag,intBin,intOct,int,intHex,floatNaN,floatExp,float,binary,merge,omap,pairs,set$2,intTime,floatTime,timestamp],schemas=new Map([["core",schema$2],["failsafe",[map,seq,string]],["json",schema$1],["yaml11",schema],["yaml-1.1",schema]]),tagsByName={binary,bool:boolTag,float:float$1,floatExp:floatExp$1,floatNaN:floatNaN$1,floatTime,int:int$1,intHex:intHex$1,intOct:intOct$1,intTime,map,merge,null:nullTag,omap,pairs,seq,set:set$2,timestamp},coreKnownTags={"tag:yaml.org,2002:binary":binary,"tag:yaml.org,2002:merge":merge,"tag:yaml.org,2002:omap":omap,"tag:yaml.org,2002:pairs":pairs,"tag:yaml.org,2002:set":set$2,"tag:yaml.org,2002:timestamp":timestamp};function getTags(d,m,g){const w=schemas.get(m);if(w&&!d)return g&&!w.includes(merge)?w.concat(merge):w.slice();let $=w;if(!$)if(Array.isArray(d))$=[];else{const I=Array.from(schemas.keys()).filter(D=>D!=="yaml11").map(D=>JSON.stringify(D)).join(", ");throw new Error(`Unknown schema "${m}"; use one of ${I} or define customTags array`)}if(Array.isArray(d))for(const I of d)$=$.concat(I);else typeof d=="function"&&($=d($.slice()));return g&&($=$.concat(merge)),$.reduce((I,D)=>{const q=typeof D=="string"?tagsByName[D]:D;if(!q){const j=JSON.stringify(D),G=Object.keys(tagsByName).map(H=>JSON.stringify(H)).join(", ");throw new Error(`Unknown custom tag ${j}; use one of ${G}`)}return I.includes(q)||I.push(q),I},[])}const sortMapEntriesByKey=(d,m)=>d.key<m.key?-1:d.key>m.key?1:0;class Schema{constructor({compat:m,customTags:g,merge:w,resolveKnownTags:$,schema:I,sortMapEntries:D,toStringDefaults:q}){this.compat=Array.isArray(m)?getTags(m,"compat"):m?getTags(null,m):null,this.name=typeof I=="string"&&I||"core",this.knownTags=$?coreKnownTags:{},this.tags=getTags(g,this.name,w),this.toStringOptions=q??null,Object.defineProperty(this,MAP,{value:map}),Object.defineProperty(this,SCALAR$1,{value:string}),Object.defineProperty(this,SEQ,{value:seq}),this.sortMapEntries=typeof D=="function"?D:D===!0?sortMapEntriesByKey:null}clone(){const m=Object.create(Schema.prototype,Object.getOwnPropertyDescriptors(this));return m.tags=this.tags.slice(),m}}function stringifyDocument(d,m){const g=[];let w=m.directives===!0;if(m.directives!==!1&&d.directives){const j=d.directives.toString(d);j?(g.push(j),w=!0):d.directives.docStart&&(w=!0)}w&&g.push("---");const $=createStringifyContext(d,m),{commentString:I}=$.options;if(d.commentBefore){g.length!==1&&g.unshift("");const j=I(d.commentBefore);g.unshift(indentComment(j,""))}let D=!1,q=null;if(d.contents){if(isNode(d.contents)){if(d.contents.spaceBefore&&w&&g.push(""),d.contents.commentBefore){const H=I(d.contents.commentBefore);g.push(indentComment(H,""))}$.forceBlockIndent=!!d.comment,q=d.contents.comment}const j=q?void 0:()=>D=!0;let G=stringify$3(d.contents,$,()=>q=null,j);q&&(G+=lineComment(G,"",I(q))),(G[0]==="|"||G[0]===">")&&g[g.length-1]==="---"?g[g.length-1]=`--- ${G}`:g.push(G)}else g.push(stringify$3(d.contents,$));if(d.directives?.docEnd)if(d.comment){const j=I(d.comment);j.includes(`
`)?(g.push("..."),g.push(indentComment(j,""))):g.push(`... ${j}`)}else g.push("...");else{let j=d.comment;j&&D&&(j=j.replace(/^\n+/,"")),j&&((!D||q)&&g[g.length-1]!==""&&g.push(""),g.push(indentComment(I(j),"")))}return g.join(`
`)+`
`}class Document{constructor(m,g,w){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,NODE_TYPE,{value:DOC});let $=null;typeof g=="function"||Array.isArray(g)?$=g:w===void 0&&g&&(w=g,g=void 0);const I=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},w);this.options=I;let{version:D}=I;w?._directives?(this.directives=w._directives.atDocument(),this.directives.yaml.explicit&&(D=this.directives.yaml.version)):this.directives=new Directives({version:D}),this.setSchema(D,w),this.contents=m===void 0?null:this.createNode(m,$,w)}clone(){const m=Object.create(Document.prototype,{[NODE_TYPE]:{value:DOC}});return m.commentBefore=this.commentBefore,m.comment=this.comment,m.errors=this.errors.slice(),m.warnings=this.warnings.slice(),m.options=Object.assign({},this.options),this.directives&&(m.directives=this.directives.clone()),m.schema=this.schema.clone(),m.contents=isNode(this.contents)?this.contents.clone(m.schema):this.contents,this.range&&(m.range=this.range.slice()),m}add(m){assertCollection(this.contents)&&this.contents.add(m)}addIn(m,g){assertCollection(this.contents)&&this.contents.addIn(m,g)}createAlias(m,g){if(!m.anchor){const w=anchorNames(this);m.anchor=!g||w.has(g)?findNewAnchor(g||"a",w):g}return new Alias(m.anchor)}createNode(m,g,w){let $;if(typeof g=="function")m=g.call({"":m},"",m),$=g;else if(Array.isArray(g)){const J=se=>typeof se=="number"||se instanceof String||se instanceof Number,re=g.filter(J).map(String);re.length>0&&(g=g.concat(re)),$=g}else w===void 0&&g&&(w=g,g=void 0);const{aliasDuplicateObjects:I,anchorPrefix:D,flow:q,keepUndefined:j,onTagObj:G,tag:H}=w??{},{onAnchor:W,setAnchors:V,sourceObjects:K}=createNodeAnchors(this,D||"a"),Z={aliasDuplicateObjects:I??!0,keepUndefined:j??!1,onAnchor:W,onTagObj:G,replacer:$,schema:this.schema,sourceObjects:K},Q=createNode(m,H,Z);return q&&isCollection$1(Q)&&(Q.flow=!0),V(),Q}createPair(m,g,w={}){const $=this.createNode(m,null,w),I=this.createNode(g,null,w);return new Pair($,I)}delete(m){return assertCollection(this.contents)?this.contents.delete(m):!1}deleteIn(m){return isEmptyPath(m)?this.contents==null?!1:(this.contents=null,!0):assertCollection(this.contents)?this.contents.deleteIn(m):!1}get(m,g){return isCollection$1(this.contents)?this.contents.get(m,g):void 0}getIn(m,g){return isEmptyPath(m)?!g&&isScalar$1(this.contents)?this.contents.value:this.contents:isCollection$1(this.contents)?this.contents.getIn(m,g):void 0}has(m){return isCollection$1(this.contents)?this.contents.has(m):!1}hasIn(m){return isEmptyPath(m)?this.contents!==void 0:isCollection$1(this.contents)?this.contents.hasIn(m):!1}set(m,g){this.contents==null?this.contents=collectionFromPath(this.schema,[m],g):assertCollection(this.contents)&&this.contents.set(m,g)}setIn(m,g){isEmptyPath(m)?this.contents=g:this.contents==null?this.contents=collectionFromPath(this.schema,Array.from(m),g):assertCollection(this.contents)&&this.contents.setIn(m,g)}setSchema(m,g={}){typeof m=="number"&&(m=String(m));let w;switch(m){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new Directives({version:"1.1"}),w={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=m:this.directives=new Directives({version:m}),w={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,w=null;break;default:{const $=JSON.stringify(m);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${$}`)}}if(g.schema instanceof Object)this.schema=g.schema;else if(w)this.schema=new Schema(Object.assign(w,g));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:m,jsonArg:g,mapAsMap:w,maxAliasCount:$,onAnchor:I,reviver:D}={}){const q={anchors:new Map,doc:this,keep:!m,mapAsMap:w===!0,mapKeyWarned:!1,maxAliasCount:typeof $=="number"?$:100},j=toJS(this.contents,g??"",q);if(typeof I=="function")for(const{count:G,res:H}of q.anchors.values())I(H,G);return typeof D=="function"?applyReviver(D,{"":j},"",j):j}toJSON(m,g){return this.toJS({json:!0,jsonArg:m,mapAsMap:!1,onAnchor:g})}toString(m={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in m&&(!Number.isInteger(m.indent)||Number(m.indent)<=0)){const g=JSON.stringify(m.indent);throw new Error(`"indent" option must be a positive integer, not ${g}`)}return stringifyDocument(this,m)}}function assertCollection(d){if(isCollection$1(d))return!0;throw new Error("Expected a YAML collection as document contents")}class YAMLError extends Error{constructor(m,g,w,$){super(),this.name=m,this.code=w,this.message=$,this.pos=g}}class YAMLParseError extends YAMLError{constructor(m,g,w){super("YAMLParseError",m,g,w)}}class YAMLWarning extends YAMLError{constructor(m,g,w){super("YAMLWarning",m,g,w)}}const prettifyError=(d,m)=>g=>{if(g.pos[0]===-1)return;g.linePos=g.pos.map(q=>m.linePos(q));const{line:w,col:$}=g.linePos[0];g.message+=` at line ${w}, column ${$}`;let I=$-1,D=d.substring(m.lineStarts[w-1],m.lineStarts[w]).replace(/[\n\r]+$/,"");if(I>=60&&D.length>80){const q=Math.min(I-39,D.length-79);D="â€¦"+D.substring(q),I-=q-1}if(D.length>80&&(D=D.substring(0,79)+"â€¦"),w>1&&/^ *$/.test(D.substring(0,I))){let q=d.substring(m.lineStarts[w-2],m.lineStarts[w-1]);q.length>80&&(q=q.substring(0,79)+`â€¦
`),D=q+D}if(/[^ ]/.test(D)){let q=1;const j=g.linePos[1];j&&j.line===w&&j.col>$&&(q=Math.max(1,Math.min(j.col-$,80-I)));const G=" ".repeat(I)+"^".repeat(q);g.message+=`:

${D}
${G}
`}};function resolveProps(d,{flow:m,indicator:g,next:w,offset:$,onError:I,parentIndent:D,startOnNewline:q}){let j=!1,G=q,H=q,W="",V="",K=!1,Z=!1,Q=null,J=null,re=null,se=null,oe=null,ee=null,ae=null;for(const de of d)switch(Z&&(de.type!=="space"&&de.type!=="newline"&&de.type!=="comma"&&I(de.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),Z=!1),Q&&(G&&de.type!=="comment"&&de.type!=="newline"&&I(Q,"TAB_AS_INDENT","Tabs are not allowed as indentation"),Q=null),de.type){case"space":!m&&(g!=="doc-start"||w?.type!=="flow-collection")&&de.source.includes("	")&&(Q=de),H=!0;break;case"comment":{H||I(de,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const _e=de.source.substring(1)||" ";W?W+=V+_e:W=_e,V="",G=!1;break}case"newline":G?W?W+=de.source:(!ee||g!=="seq-item-ind")&&(j=!0):V+=de.source,G=!0,K=!0,(J||re)&&(se=de),H=!0;break;case"anchor":J&&I(de,"MULTIPLE_ANCHORS","A node can have at most one anchor"),de.source.endsWith(":")&&I(de.offset+de.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),J=de,ae??(ae=de.offset),G=!1,H=!1,Z=!0;break;case"tag":{re&&I(de,"MULTIPLE_TAGS","A node can have at most one tag"),re=de,ae??(ae=de.offset),G=!1,H=!1,Z=!0;break}case g:(J||re)&&I(de,"BAD_PROP_ORDER",`Anchors and tags must be after the ${de.source} indicator`),ee&&I(de,"UNEXPECTED_TOKEN",`Unexpected ${de.source} in ${m??"collection"}`),ee=de,G=g==="seq-item-ind"||g==="explicit-key-ind",H=!1;break;case"comma":if(m){oe&&I(de,"UNEXPECTED_TOKEN",`Unexpected , in ${m}`),oe=de,G=!1,H=!1;break}default:I(de,"UNEXPECTED_TOKEN",`Unexpected ${de.type} token`),G=!1,H=!1}const ce=d[d.length-1],le=ce?ce.offset+ce.source.length:$;return Z&&w&&w.type!=="space"&&w.type!=="newline"&&w.type!=="comma"&&(w.type!=="scalar"||w.source!=="")&&I(w.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),Q&&(G&&Q.indent<=D||w?.type==="block-map"||w?.type==="block-seq")&&I(Q,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:oe,found:ee,spaceBefore:j,comment:W,hasNewline:K,anchor:J,tag:re,newlineAfterProp:se,end:le,start:ae??le}}function containsNewline(d){if(!d)return null;switch(d.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(d.source.includes(`
`))return!0;if(d.end){for(const m of d.end)if(m.type==="newline")return!0}return!1;case"flow-collection":for(const m of d.items){for(const g of m.start)if(g.type==="newline")return!0;if(m.sep){for(const g of m.sep)if(g.type==="newline")return!0}if(containsNewline(m.key)||containsNewline(m.value))return!0}return!1;default:return!0}}function flowIndentCheck(d,m,g){if(m?.type==="flow-collection"){const w=m.end[0];w.indent===d&&(w.source==="]"||w.source==="}")&&containsNewline(m)&&g(w,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function mapIncludes(d,m,g){const{uniqueKeys:w}=d.options;if(w===!1)return!1;const $=typeof w=="function"?w:(I,D)=>I===D||isScalar$1(I)&&isScalar$1(D)&&I.value===D.value;return m.some(I=>$(I.key,g))}const startColMsg="All mapping items must start at the same column";function resolveBlockMap({composeNode:d,composeEmptyNode:m},g,w,$,I){const D=I?.nodeClass??YAMLMap,q=new D(g.schema);g.atRoot&&(g.atRoot=!1);let j=w.offset,G=null;for(const H of w.items){const{start:W,key:V,sep:K,value:Z}=H,Q=resolveProps(W,{indicator:"explicit-key-ind",next:V??K?.[0],offset:j,onError:$,parentIndent:w.indent,startOnNewline:!0}),J=!Q.found;if(J){if(V&&(V.type==="block-seq"?$(j,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in V&&V.indent!==w.indent&&$(j,"BAD_INDENT",startColMsg)),!Q.anchor&&!Q.tag&&!K){G=Q.end,Q.comment&&(q.comment?q.comment+=`
`+Q.comment:q.comment=Q.comment);continue}(Q.newlineAfterProp||containsNewline(V))&&$(V??W[W.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else Q.found?.indent!==w.indent&&$(j,"BAD_INDENT",startColMsg);g.atKey=!0;const re=Q.end,se=V?d(g,V,Q,$):m(g,re,W,null,Q,$);g.schema.compat&&flowIndentCheck(w.indent,V,$),g.atKey=!1,mapIncludes(g,q.items,se)&&$(re,"DUPLICATE_KEY","Map keys must be unique");const oe=resolveProps(K??[],{indicator:"map-value-ind",next:Z,offset:se.range[2],onError:$,parentIndent:w.indent,startOnNewline:!V||V.type==="block-scalar"});if(j=oe.end,oe.found){J&&(Z?.type==="block-map"&&!oe.hasNewline&&$(j,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),g.options.strict&&Q.start<oe.found.offset-1024&&$(se.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const ee=Z?d(g,Z,oe,$):m(g,j,K,null,oe,$);g.schema.compat&&flowIndentCheck(w.indent,Z,$),j=ee.range[2];const ae=new Pair(se,ee);g.options.keepSourceTokens&&(ae.srcToken=H),q.items.push(ae)}else{J&&$(se.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),oe.comment&&(se.comment?se.comment+=`
`+oe.comment:se.comment=oe.comment);const ee=new Pair(se);g.options.keepSourceTokens&&(ee.srcToken=H),q.items.push(ee)}}return G&&G<j&&$(G,"IMPOSSIBLE","Map comment with trailing content"),q.range=[w.offset,j,G??j],q}function resolveBlockSeq({composeNode:d,composeEmptyNode:m},g,w,$,I){const D=I?.nodeClass??YAMLSeq,q=new D(g.schema);g.atRoot&&(g.atRoot=!1),g.atKey&&(g.atKey=!1);let j=w.offset,G=null;for(const{start:H,value:W}of w.items){const V=resolveProps(H,{indicator:"seq-item-ind",next:W,offset:j,onError:$,parentIndent:w.indent,startOnNewline:!0});if(!V.found)if(V.anchor||V.tag||W)W&&W.type==="block-seq"?$(V.end,"BAD_INDENT","All sequence items must start at the same column"):$(j,"MISSING_CHAR","Sequence item without - indicator");else{G=V.end,V.comment&&(q.comment=V.comment);continue}const K=W?d(g,W,V,$):m(g,V.end,H,null,V,$);g.schema.compat&&flowIndentCheck(w.indent,W,$),j=K.range[2],q.items.push(K)}return q.range=[w.offset,j,G??j],q}function resolveEnd(d,m,g,w){let $="";if(d){let I=!1,D="";for(const q of d){const{source:j,type:G}=q;switch(G){case"space":I=!0;break;case"comment":{g&&!I&&w(q,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const H=j.substring(1)||" ";$?$+=D+H:$=H,D="";break}case"newline":$&&(D+=j),I=!0;break;default:w(q,"UNEXPECTED_TOKEN",`Unexpected ${G} at node end`)}m+=j.length}}return{comment:$,offset:m}}const blockMsg="Block collections are not allowed within flow collections",isBlock=d=>d&&(d.type==="block-map"||d.type==="block-seq");function resolveFlowCollection({composeNode:d,composeEmptyNode:m},g,w,$,I){const D=w.start.source==="{",q=D?"flow map":"flow sequence",j=I?.nodeClass??(D?YAMLMap:YAMLSeq),G=new j(g.schema);G.flow=!0;const H=g.atRoot;H&&(g.atRoot=!1),g.atKey&&(g.atKey=!1);let W=w.offset+w.start.source.length;for(let J=0;J<w.items.length;++J){const re=w.items[J],{start:se,key:oe,sep:ee,value:ae}=re,ce=resolveProps(se,{flow:q,indicator:"explicit-key-ind",next:oe??ee?.[0],offset:W,onError:$,parentIndent:w.indent,startOnNewline:!1});if(!ce.found){if(!ce.anchor&&!ce.tag&&!ee&&!ae){J===0&&ce.comma?$(ce.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${q}`):J<w.items.length-1&&$(ce.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${q}`),ce.comment&&(G.comment?G.comment+=`
`+ce.comment:G.comment=ce.comment),W=ce.end;continue}!D&&g.options.strict&&containsNewline(oe)&&$(oe,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(J===0)ce.comma&&$(ce.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${q}`);else if(ce.comma||$(ce.start,"MISSING_CHAR",`Missing , between ${q} items`),ce.comment){let le="";e:for(const de of se)switch(de.type){case"comma":case"space":break;case"comment":le=de.source.substring(1);break e;default:break e}if(le){let de=G.items[G.items.length-1];isPair(de)&&(de=de.value??de.key),de.comment?de.comment+=`
`+le:de.comment=le,ce.comment=ce.comment.substring(le.length+1)}}if(!D&&!ee&&!ce.found){const le=ae?d(g,ae,ce,$):m(g,ce.end,ee,null,ce,$);G.items.push(le),W=le.range[2],isBlock(ae)&&$(le.range,"BLOCK_IN_FLOW",blockMsg)}else{g.atKey=!0;const le=ce.end,de=oe?d(g,oe,ce,$):m(g,le,se,null,ce,$);isBlock(oe)&&$(de.range,"BLOCK_IN_FLOW",blockMsg),g.atKey=!1;const _e=resolveProps(ee??[],{flow:q,indicator:"map-value-ind",next:ae,offset:de.range[2],onError:$,parentIndent:w.indent,startOnNewline:!1});if(_e.found){if(!D&&!ce.found&&g.options.strict){if(ee)for(const xe of ee){if(xe===_e.found)break;if(xe.type==="newline"){$(xe,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}ce.start<_e.found.offset-1024&&$(_e.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else ae&&("source"in ae&&ae.source&&ae.source[0]===":"?$(ae,"MISSING_CHAR",`Missing space after : in ${q}`):$(_e.start,"MISSING_CHAR",`Missing , or : between ${q} items`));const we=ae?d(g,ae,_e,$):_e.found?m(g,_e.end,ee,null,_e,$):null;we?isBlock(ae)&&$(we.range,"BLOCK_IN_FLOW",blockMsg):_e.comment&&(de.comment?de.comment+=`
`+_e.comment:de.comment=_e.comment);const pe=new Pair(de,we);if(g.options.keepSourceTokens&&(pe.srcToken=re),D){const xe=G;mapIncludes(g,xe.items,de)&&$(le,"DUPLICATE_KEY","Map keys must be unique"),xe.items.push(pe)}else{const xe=new YAMLMap(g.schema);xe.flow=!0,xe.items.push(pe);const Ge=(we??de).range;xe.range=[de.range[0],Ge[1],Ge[2]],G.items.push(xe)}W=we?we.range[2]:_e.end}}const V=D?"}":"]",[K,...Z]=w.end;let Q=W;if(K&&K.source===V)Q=K.offset+K.source.length;else{const J=q[0].toUpperCase()+q.substring(1),re=H?`${J} must end with a ${V}`:`${J} in block collection must be sufficiently indented and end with a ${V}`;$(W,H?"MISSING_CHAR":"BAD_INDENT",re),K&&K.source.length!==1&&Z.unshift(K)}if(Z.length>0){const J=resolveEnd(Z,Q,g.options.strict,$);J.comment&&(G.comment?G.comment+=`
`+J.comment:G.comment=J.comment),G.range=[w.offset,Q,J.offset]}else G.range=[w.offset,Q,Q];return G}function resolveCollection(d,m,g,w,$,I){const D=g.type==="block-map"?resolveBlockMap(d,m,g,w,I):g.type==="block-seq"?resolveBlockSeq(d,m,g,w,I):resolveFlowCollection(d,m,g,w,I),q=D.constructor;return $==="!"||$===q.tagName?(D.tag=q.tagName,D):($&&(D.tag=$),D)}function composeCollection(d,m,g,w,$){const I=w.tag,D=I?m.directives.tagName(I.source,V=>$(I,"TAG_RESOLVE_FAILED",V)):null;if(g.type==="block-seq"){const{anchor:V,newlineAfterProp:K}=w,Z=V&&I?V.offset>I.offset?V:I:V??I;Z&&(!K||K.offset<Z.offset)&&$(Z,"MISSING_CHAR","Missing newline after block sequence props")}const q=g.type==="block-map"?"map":g.type==="block-seq"?"seq":g.start.source==="{"?"map":"seq";if(!I||!D||D==="!"||D===YAMLMap.tagName&&q==="map"||D===YAMLSeq.tagName&&q==="seq")return resolveCollection(d,m,g,$,D);let j=m.schema.tags.find(V=>V.tag===D&&V.collection===q);if(!j){const V=m.schema.knownTags[D];if(V&&V.collection===q)m.schema.tags.push(Object.assign({},V,{default:!1})),j=V;else return V?$(I,"BAD_COLLECTION_TYPE",`${V.tag} used for ${q} collection, but expects ${V.collection??"scalar"}`,!0):$(I,"TAG_RESOLVE_FAILED",`Unresolved tag: ${D}`,!0),resolveCollection(d,m,g,$,D)}const G=resolveCollection(d,m,g,$,D,j),H=j.resolve?.(G,V=>$(I,"TAG_RESOLVE_FAILED",V),m.options)??G,W=isNode(H)?H:new Scalar(H);return W.range=G.range,W.tag=D,j?.format&&(W.format=j.format),W}function resolveBlockScalar(d,m,g){const w=m.offset,$=parseBlockScalarHeader(m,d.options.strict,g);if(!$)return{value:"",type:null,comment:"",range:[w,w,w]};const I=$.mode===">"?Scalar.BLOCK_FOLDED:Scalar.BLOCK_LITERAL,D=m.source?splitLines$1(m.source):[];let q=D.length;for(let Q=D.length-1;Q>=0;--Q){const J=D[Q][1];if(J===""||J==="\r")q=Q;else break}if(q===0){const Q=$.chomp==="+"&&D.length>0?`
`.repeat(Math.max(1,D.length-1)):"";let J=w+$.length;return m.source&&(J+=m.source.length),{value:Q,type:I,comment:$.comment,range:[w,J,J]}}let j=m.indent+$.indent,G=m.offset+$.length,H=0;for(let Q=0;Q<q;++Q){const[J,re]=D[Q];if(re===""||re==="\r")$.indent===0&&J.length>j&&(j=J.length);else{J.length<j&&g(G+J.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),$.indent===0&&(j=J.length),H=Q,j===0&&!d.atRoot&&g(G,"BAD_INDENT","Block scalar values in collections must be indented");break}G+=J.length+re.length+1}for(let Q=D.length-1;Q>=q;--Q)D[Q][0].length>j&&(q=Q+1);let W="",V="",K=!1;for(let Q=0;Q<H;++Q)W+=D[Q][0].slice(j)+`
`;for(let Q=H;Q<q;++Q){let[J,re]=D[Q];G+=J.length+re.length+1;const se=re[re.length-1]==="\r";if(se&&(re=re.slice(0,-1)),re&&J.length<j){const ee=`Block scalar lines must not be less indented than their ${$.indent?"explicit indentation indicator":"first line"}`;g(G-re.length-(se?2:1),"BAD_INDENT",ee),J=""}I===Scalar.BLOCK_LITERAL?(W+=V+J.slice(j)+re,V=`
`):J.length>j||re[0]==="	"?(V===" "?V=`
`:!K&&V===`
`&&(V=`

`),W+=V+J.slice(j)+re,V=`
`,K=!0):re===""?V===`
`?W+=`
`:V=`
`:(W+=V+re,V=" ",K=!1)}switch($.chomp){case"-":break;case"+":for(let Q=q;Q<D.length;++Q)W+=`
`+D[Q][0].slice(j);W[W.length-1]!==`
`&&(W+=`
`);break;default:W+=`
`}const Z=w+$.length+m.source.length;return{value:W,type:I,comment:$.comment,range:[w,Z,Z]}}function parseBlockScalarHeader({offset:d,props:m},g,w){if(m[0].type!=="block-scalar-header")return w(m[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:$}=m[0],I=$[0];let D=0,q="",j=-1;for(let V=1;V<$.length;++V){const K=$[V];if(!q&&(K==="-"||K==="+"))q=K;else{const Z=Number(K);!D&&Z?D=Z:j===-1&&(j=d+V)}}j!==-1&&w(j,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${$}`);let G=!1,H="",W=$.length;for(let V=1;V<m.length;++V){const K=m[V];switch(K.type){case"space":G=!0;case"newline":W+=K.source.length;break;case"comment":g&&!G&&w(K,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),W+=K.source.length,H=K.source.substring(1);break;case"error":w(K,"UNEXPECTED_TOKEN",K.message),W+=K.source.length;break;default:{const Z=`Unexpected token in block scalar header: ${K.type}`;w(K,"UNEXPECTED_TOKEN",Z);const Q=K.source;Q&&typeof Q=="string"&&(W+=Q.length)}}}return{mode:I,indent:D,chomp:q,comment:H,length:W}}function splitLines$1(d){const m=d.split(/\n( *)/),g=m[0],w=g.match(/^( *)/),I=[w?.[1]?[w[1],g.slice(w[1].length)]:["",g]];for(let D=1;D<m.length;D+=2)I.push([m[D],m[D+1]]);return I}function resolveFlowScalar(d,m,g){const{offset:w,type:$,source:I,end:D}=d;let q,j;const G=(V,K,Z)=>g(w+V,K,Z);switch($){case"scalar":q=Scalar.PLAIN,j=plainValue(I,G);break;case"single-quoted-scalar":q=Scalar.QUOTE_SINGLE,j=singleQuotedValue(I,G);break;case"double-quoted-scalar":q=Scalar.QUOTE_DOUBLE,j=doubleQuotedValue(I,G);break;default:return g(d,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${$}`),{value:"",type:null,comment:"",range:[w,w+I.length,w+I.length]}}const H=w+I.length,W=resolveEnd(D,H,m,g);return{value:j,type:q,comment:W.comment,range:[w,H,W.offset]}}function plainValue(d,m){let g="";switch(d[0]){case"	":g="a tab character";break;case",":g="flow indicator character ,";break;case"%":g="directive indicator character %";break;case"|":case">":{g=`block scalar indicator ${d[0]}`;break}case"@":case"`":{g=`reserved character ${d[0]}`;break}}return g&&m(0,"BAD_SCALAR_START",`Plain value cannot start with ${g}`),foldLines(d)}function singleQuotedValue(d,m){return(d[d.length-1]!=="'"||d.length===1)&&m(d.length,"MISSING_CHAR","Missing closing 'quote"),foldLines(d.slice(1,-1)).replace(/''/g,"'")}function foldLines(d){let m,g;try{m=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),g=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{m=/(.*?)[ \t]*\r?\n/sy,g=/[ \t]*(.*?)[ \t]*\r?\n/sy}let w=m.exec(d);if(!w)return d;let $=w[1],I=" ",D=m.lastIndex;for(g.lastIndex=D;w=g.exec(d);)w[1]===""?I===`
`?$+=I:I=`
`:($+=I+w[1],I=" "),D=g.lastIndex;const q=/[ \t]*(.*)/sy;return q.lastIndex=D,w=q.exec(d),$+I+(w?.[1]??"")}function doubleQuotedValue(d,m){let g="";for(let w=1;w<d.length-1;++w){const $=d[w];if(!($==="\r"&&d[w+1]===`
`))if($===`
`){const{fold:I,offset:D}=foldNewline(d,w);g+=I,w=D}else if($==="\\"){let I=d[++w];const D=escapeCodes[I];if(D)g+=D;else if(I===`
`)for(I=d[w+1];I===" "||I==="	";)I=d[++w+1];else if(I==="\r"&&d[w+1]===`
`)for(I=d[++w+1];I===" "||I==="	";)I=d[++w+1];else if(I==="x"||I==="u"||I==="U"){const q={x:2,u:4,U:8}[I];g+=parseCharCode(d,w+1,q,m),w+=q}else{const q=d.substr(w-1,2);m(w-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${q}`),g+=q}}else if($===" "||$==="	"){const I=w;let D=d[w+1];for(;D===" "||D==="	";)D=d[++w+1];D!==`
`&&!(D==="\r"&&d[w+2]===`
`)&&(g+=w>I?d.slice(I,w+1):$)}else g+=$}return(d[d.length-1]!=='"'||d.length===1)&&m(d.length,"MISSING_CHAR",'Missing closing "quote'),g}function foldNewline(d,m){let g="",w=d[m+1];for(;(w===" "||w==="	"||w===`
`||w==="\r")&&!(w==="\r"&&d[m+2]!==`
`);)w===`
`&&(g+=`
`),m+=1,w=d[m+1];return g||(g=" "),{fold:g,offset:m}}const escapeCodes={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"Â…",_:"Â ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function parseCharCode(d,m,g,w){const $=d.substr(m,g),D=$.length===g&&/^[0-9a-fA-F]+$/.test($)?parseInt($,16):NaN;if(isNaN(D)){const q=d.substr(m-2,g+2);return w(m-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${q}`),q}return String.fromCodePoint(D)}function composeScalar(d,m,g,w){const{value:$,type:I,comment:D,range:q}=m.type==="block-scalar"?resolveBlockScalar(d,m,w):resolveFlowScalar(m,d.options.strict,w),j=g?d.directives.tagName(g.source,W=>w(g,"TAG_RESOLVE_FAILED",W)):null;let G;d.options.stringKeys&&d.atKey?G=d.schema[SCALAR$1]:j?G=findScalarTagByName(d.schema,$,j,g,w):m.type==="scalar"?G=findScalarTagByTest(d,$,m,w):G=d.schema[SCALAR$1];let H;try{const W=G.resolve($,V=>w(g??m,"TAG_RESOLVE_FAILED",V),d.options);H=isScalar$1(W)?W:new Scalar(W)}catch(W){const V=W instanceof Error?W.message:String(W);w(g??m,"TAG_RESOLVE_FAILED",V),H=new Scalar($)}return H.range=q,H.source=$,I&&(H.type=I),j&&(H.tag=j),G.format&&(H.format=G.format),D&&(H.comment=D),H}function findScalarTagByName(d,m,g,w,$){if(g==="!")return d[SCALAR$1];const I=[];for(const q of d.tags)if(!q.collection&&q.tag===g)if(q.default&&q.test)I.push(q);else return q;for(const q of I)if(q.test?.test(m))return q;const D=d.knownTags[g];return D&&!D.collection?(d.tags.push(Object.assign({},D,{default:!1,test:void 0})),D):($(w,"TAG_RESOLVE_FAILED",`Unresolved tag: ${g}`,g!=="tag:yaml.org,2002:str"),d[SCALAR$1])}function findScalarTagByTest({atKey:d,directives:m,schema:g},w,$,I){const D=g.tags.find(q=>(q.default===!0||d&&q.default==="key")&&q.test?.test(w))||g[SCALAR$1];if(g.compat){const q=g.compat.find(j=>j.default&&j.test?.test(w))??g[SCALAR$1];if(D.tag!==q.tag){const j=m.tagString(D.tag),G=m.tagString(q.tag),H=`Value may be parsed as either ${j} or ${G}`;I($,"TAG_RESOLVE_FAILED",H,!0)}}return D}function emptyScalarPosition(d,m,g){if(m){g??(g=m.length);for(let w=g-1;w>=0;--w){let $=m[w];switch($.type){case"space":case"comment":case"newline":d-=$.source.length;continue}for($=m[++w];$?.type==="space";)d+=$.source.length,$=m[++w];break}}return d}const CN={composeNode,composeEmptyNode};function composeNode(d,m,g,w){const $=d.atKey,{spaceBefore:I,comment:D,anchor:q,tag:j}=g;let G,H=!0;switch(m.type){case"alias":G=composeAlias(d,m,w),(q||j)&&w(m,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":G=composeScalar(d,m,j,w),q&&(G.anchor=q.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":G=composeCollection(CN,d,m,g,w),q&&(G.anchor=q.source.substring(1));break;default:{const W=m.type==="error"?m.message:`Unsupported token (type: ${m.type})`;w(m,"UNEXPECTED_TOKEN",W),G=composeEmptyNode(d,m.offset,void 0,null,g,w),H=!1}}return q&&G.anchor===""&&w(q,"BAD_ALIAS","Anchor cannot be an empty string"),$&&d.options.stringKeys&&(!isScalar$1(G)||typeof G.value!="string"||G.tag&&G.tag!=="tag:yaml.org,2002:str")&&w(j??m,"NON_STRING_KEY","With stringKeys, all keys must be strings"),I&&(G.spaceBefore=!0),D&&(m.type==="scalar"&&m.source===""?G.comment=D:G.commentBefore=D),d.options.keepSourceTokens&&H&&(G.srcToken=m),G}function composeEmptyNode(d,m,g,w,{spaceBefore:$,comment:I,anchor:D,tag:q,end:j},G){const H={type:"scalar",offset:emptyScalarPosition(m,g,w),indent:-1,source:""},W=composeScalar(d,H,q,G);return D&&(W.anchor=D.source.substring(1),W.anchor===""&&G(D,"BAD_ALIAS","Anchor cannot be an empty string")),$&&(W.spaceBefore=!0),I&&(W.comment=I,W.range[2]=j),W}function composeAlias({options:d},{offset:m,source:g,end:w},$){const I=new Alias(g.substring(1));I.source===""&&$(m,"BAD_ALIAS","Alias cannot be an empty string"),I.source.endsWith(":")&&$(m+g.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const D=m+g.length,q=resolveEnd(w,D,d.strict,$);return I.range=[m,D,q.offset],q.comment&&(I.comment=q.comment),I}function composeDoc(d,m,{offset:g,start:w,value:$,end:I},D){const q=Object.assign({_directives:m},d),j=new Document(void 0,q),G={atKey:!1,atRoot:!0,directives:j.directives,options:j.options,schema:j.schema},H=resolveProps(w,{indicator:"doc-start",next:$??I?.[0],offset:g,onError:D,parentIndent:0,startOnNewline:!0});H.found&&(j.directives.docStart=!0,$&&($.type==="block-map"||$.type==="block-seq")&&!H.hasNewline&&D(H.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),j.contents=$?composeNode(G,$,H,D):composeEmptyNode(G,H.end,w,null,H,D);const W=j.contents.range[2],V=resolveEnd(I,W,!1,D);return V.comment&&(j.comment=V.comment),j.range=[g,W,V.offset],j}function getErrorPos(d){if(typeof d=="number")return[d,d+1];if(Array.isArray(d))return d.length===2?d:[d[0],d[1]];const{offset:m,source:g}=d;return[m,m+(typeof g=="string"?g.length:1)]}function parsePrelude(d){let m="",g=!1,w=!1;for(let $=0;$<d.length;++$){const I=d[$];switch(I[0]){case"#":m+=(m===""?"":w?`

`:`
`)+(I.substring(1)||" "),g=!0,w=!1;break;case"%":d[$+1]?.[0]!=="#"&&($+=1),g=!1;break;default:g||(w=!0),g=!1}}return{comment:m,afterEmptyLine:w}}class Composer{constructor(m={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(g,w,$,I)=>{const D=getErrorPos(g);I?this.warnings.push(new YAMLWarning(D,w,$)):this.errors.push(new YAMLParseError(D,w,$))},this.directives=new Directives({version:m.version||"1.2"}),this.options=m}decorate(m,g){const{comment:w,afterEmptyLine:$}=parsePrelude(this.prelude);if(w){const I=m.contents;if(g)m.comment=m.comment?`${m.comment}
${w}`:w;else if($||m.directives.docStart||!I)m.commentBefore=w;else if(isCollection$1(I)&&!I.flow&&I.items.length>0){let D=I.items[0];isPair(D)&&(D=D.key);const q=D.commentBefore;D.commentBefore=q?`${w}
${q}`:w}else{const D=I.commentBefore;I.commentBefore=D?`${w}
${D}`:w}}g?(Array.prototype.push.apply(m.errors,this.errors),Array.prototype.push.apply(m.warnings,this.warnings)):(m.errors=this.errors,m.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:parsePrelude(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(m,g=!1,w=-1){for(const $ of m)yield*this.next($);yield*this.end(g,w)}*next(m){switch(m.type){case"directive":this.directives.add(m.source,(g,w,$)=>{const I=getErrorPos(m);I[0]+=g,this.onError(I,"BAD_DIRECTIVE",w,$)}),this.prelude.push(m.source),this.atDirectives=!0;break;case"document":{const g=composeDoc(this.options,this.directives,m,this.onError);this.atDirectives&&!g.directives.docStart&&this.onError(m,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(g,!1),this.doc&&(yield this.doc),this.doc=g,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(m.source);break;case"error":{const g=m.source?`${m.message}: ${JSON.stringify(m.source)}`:m.message,w=new YAMLParseError(getErrorPos(m),"UNEXPECTED_TOKEN",g);this.atDirectives||!this.doc?this.errors.push(w):this.doc.errors.push(w);break}case"doc-end":{if(!this.doc){const w="Unexpected doc-end without preceding document";this.errors.push(new YAMLParseError(getErrorPos(m),"UNEXPECTED_TOKEN",w));break}this.doc.directives.docEnd=!0;const g=resolveEnd(m.end,m.offset+m.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),g.comment){const w=this.doc.comment;this.doc.comment=w?`${w}
${g.comment}`:g.comment}this.doc.range[2]=g.offset;break}default:this.errors.push(new YAMLParseError(getErrorPos(m),"UNEXPECTED_TOKEN",`Unsupported token ${m.type}`))}}*end(m=!1,g=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(m){const w=Object.assign({_directives:this.directives},this.options),$=new Document(void 0,w);this.atDirectives&&this.onError(g,"MISSING_CHAR","Missing directives-end indicator line"),$.range=[0,g,g],this.decorate($,!1),yield $}}}function resolveAsScalar(d,m=!0,g){if(d){const w=($,I,D)=>{const q=typeof $=="number"?$:Array.isArray($)?$[0]:$.offset;if(g)g(q,I,D);else throw new YAMLParseError([q,q+1],I,D)};switch(d.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return resolveFlowScalar(d,m,w);case"block-scalar":return resolveBlockScalar({options:{strict:m}},d,w)}}return null}function createScalarToken(d,m){const{implicitKey:g=!1,indent:w,inFlow:$=!1,offset:I=-1,type:D="PLAIN"}=m,q=stringifyString({type:D,value:d},{implicitKey:g,indent:w>0?" ".repeat(w):"",inFlow:$,options:{blockQuote:!0,lineWidth:-1}}),j=m.end??[{type:"newline",offset:-1,indent:w,source:`
`}];switch(q[0]){case"|":case">":{const G=q.indexOf(`
`),H=q.substring(0,G),W=q.substring(G+1)+`
`,V=[{type:"block-scalar-header",offset:I,indent:w,source:H}];return addEndtoBlockProps(V,j)||V.push({type:"newline",offset:-1,indent:w,source:`
`}),{type:"block-scalar",offset:I,indent:w,props:V,source:W}}case'"':return{type:"double-quoted-scalar",offset:I,indent:w,source:q,end:j};case"'":return{type:"single-quoted-scalar",offset:I,indent:w,source:q,end:j};default:return{type:"scalar",offset:I,indent:w,source:q,end:j}}}function setScalarValue(d,m,g={}){let{afterKey:w=!1,implicitKey:$=!1,inFlow:I=!1,type:D}=g,q="indent"in d?d.indent:null;if(w&&typeof q=="number"&&(q+=2),!D)switch(d.type){case"single-quoted-scalar":D="QUOTE_SINGLE";break;case"double-quoted-scalar":D="QUOTE_DOUBLE";break;case"block-scalar":{const G=d.props[0];if(G.type!=="block-scalar-header")throw new Error("Invalid block scalar header");D=G.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:D="PLAIN"}const j=stringifyString({type:D,value:m},{implicitKey:$||q===null,indent:q!==null&&q>0?" ".repeat(q):"",inFlow:I,options:{blockQuote:!0,lineWidth:-1}});switch(j[0]){case"|":case">":setBlockScalarValue(d,j);break;case'"':setFlowScalarValue(d,j,"double-quoted-scalar");break;case"'":setFlowScalarValue(d,j,"single-quoted-scalar");break;default:setFlowScalarValue(d,j,"scalar")}}function setBlockScalarValue(d,m){const g=m.indexOf(`
`),w=m.substring(0,g),$=m.substring(g+1)+`
`;if(d.type==="block-scalar"){const I=d.props[0];if(I.type!=="block-scalar-header")throw new Error("Invalid block scalar header");I.source=w,d.source=$}else{const{offset:I}=d,D="indent"in d?d.indent:-1,q=[{type:"block-scalar-header",offset:I,indent:D,source:w}];addEndtoBlockProps(q,"end"in d?d.end:void 0)||q.push({type:"newline",offset:-1,indent:D,source:`
`});for(const j of Object.keys(d))j!=="type"&&j!=="offset"&&delete d[j];Object.assign(d,{type:"block-scalar",indent:D,props:q,source:$})}}function addEndtoBlockProps(d,m){if(m)for(const g of m)switch(g.type){case"space":case"comment":d.push(g);break;case"newline":return d.push(g),!0}return!1}function setFlowScalarValue(d,m,g){switch(d.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":d.type=g,d.source=m;break;case"block-scalar":{const w=d.props.slice(1);let $=m.length;d.props[0].type==="block-scalar-header"&&($-=d.props[0].source.length);for(const I of w)I.offset+=$;delete d.props,Object.assign(d,{type:g,source:m,end:w});break}case"block-map":case"block-seq":{const $={type:"newline",offset:d.offset+m.length,indent:d.indent,source:`
`};delete d.items,Object.assign(d,{type:g,source:m,end:[$]});break}default:{const w="indent"in d?d.indent:-1,$="end"in d&&Array.isArray(d.end)?d.end.filter(I=>I.type==="space"||I.type==="comment"||I.type==="newline"):[];for(const I of Object.keys(d))I!=="type"&&I!=="offset"&&delete d[I];Object.assign(d,{type:g,indent:w,source:m,end:$})}}}const stringify$2=d=>"type"in d?stringifyToken(d):stringifyItem(d);function stringifyToken(d){switch(d.type){case"block-scalar":{let m="";for(const g of d.props)m+=stringifyToken(g);return m+d.source}case"block-map":case"block-seq":{let m="";for(const g of d.items)m+=stringifyItem(g);return m}case"flow-collection":{let m=d.start.source;for(const g of d.items)m+=stringifyItem(g);for(const g of d.end)m+=g.source;return m}case"document":{let m=stringifyItem(d);if(d.end)for(const g of d.end)m+=g.source;return m}default:{let m=d.source;if("end"in d&&d.end)for(const g of d.end)m+=g.source;return m}}}function stringifyItem({start:d,key:m,sep:g,value:w}){let $="";for(const I of d)$+=I.source;if(m&&($+=stringifyToken(m)),g)for(const I of g)$+=I.source;return w&&($+=stringifyToken(w)),$}const BREAK=Symbol("break visit"),SKIP=Symbol("skip children"),REMOVE=Symbol("remove item");function visit$2(d,m){"type"in d&&d.type==="document"&&(d={start:d.start,value:d.value}),_visit(Object.freeze([]),d,m)}visit$2.BREAK=BREAK;visit$2.SKIP=SKIP;visit$2.REMOVE=REMOVE;visit$2.itemAtPath=(d,m)=>{let g=d;for(const[w,$]of m){const I=g?.[w];if(I&&"items"in I)g=I.items[$];else return}return g};visit$2.parentCollection=(d,m)=>{const g=visit$2.itemAtPath(d,m.slice(0,-1)),w=m[m.length-1][0],$=g?.[w];if($&&"items"in $)return $;throw new Error("Parent collection not found")};function _visit(d,m,g){let w=g(m,d);if(typeof w=="symbol")return w;for(const $ of["key","value"]){const I=m[$];if(I&&"items"in I){for(let D=0;D<I.items.length;++D){const q=_visit(Object.freeze(d.concat([[$,D]])),I.items[D],g);if(typeof q=="number")D=q-1;else{if(q===BREAK)return BREAK;q===REMOVE&&(I.items.splice(D,1),D-=1)}}typeof w=="function"&&$==="key"&&(w=w(m,d))}}return typeof w=="function"?w(m,d):w}const BOM="\uFEFF",DOCUMENT="",FLOW_END="",SCALAR="",isCollection=d=>!!d&&"items"in d,isScalar=d=>!!d&&(d.type==="scalar"||d.type==="single-quoted-scalar"||d.type==="double-quoted-scalar"||d.type==="block-scalar");function prettyToken(d){switch(d){case BOM:return"<BOM>";case DOCUMENT:return"<DOC>";case FLOW_END:return"<FLOW_END>";case SCALAR:return"<SCALAR>";default:return JSON.stringify(d)}}function tokenType(d){switch(d){case BOM:return"byte-order-mark";case DOCUMENT:return"doc-mode";case FLOW_END:return"flow-error-end";case SCALAR:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(d[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}var cst=Object.freeze({__proto__:null,BOM,DOCUMENT,FLOW_END,SCALAR,createScalarToken,isCollection,isScalar,prettyToken,resolveAsScalar,setScalarValue,stringify:stringify$2,tokenType,visit:visit$2});function isEmpty(d){switch(d){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const hexDigits=new Set("0123456789ABCDEFabcdef"),tagChars=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),flowIndicatorChars=new Set(",[]{}"),invalidAnchorChars=new Set(` ,[]{}
\r	`),isNotAnchorChar=d=>!d||invalidAnchorChars.has(d);class Lexer{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(m,g=!1){if(m){if(typeof m!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+m:m,this.lineEndPos=null}this.atEnd=!g;let w=this.next??"stream";for(;w&&(g||this.hasChars(1));)w=yield*this.parseNext(w)}atLineEnd(){let m=this.pos,g=this.buffer[m];for(;g===" "||g==="	";)g=this.buffer[++m];return!g||g==="#"||g===`
`?!0:g==="\r"?this.buffer[m+1]===`
`:!1}charAt(m){return this.buffer[this.pos+m]}continueScalar(m){let g=this.buffer[m];if(this.indentNext>0){let w=0;for(;g===" ";)g=this.buffer[++w+m];if(g==="\r"){const $=this.buffer[w+m+1];if($===`
`||!$&&!this.atEnd)return m+w+1}return g===`
`||w>=this.indentNext||!g&&!this.atEnd?m+w:-1}if(g==="-"||g==="."){const w=this.buffer.substr(m,3);if((w==="---"||w==="...")&&isEmpty(this.buffer[m+3]))return-1}return m}getLine(){let m=this.lineEndPos;return(typeof m!="number"||m!==-1&&m<this.pos)&&(m=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=m),m===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[m-1]==="\r"&&(m-=1),this.buffer.substring(this.pos,m))}hasChars(m){return this.pos+m<=this.buffer.length}setNext(m){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=m,null}peek(m){return this.buffer.substr(this.pos,m)}*parseNext(m){switch(m){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let m=this.getLine();if(m===null)return this.setNext("stream");if(m[0]===BOM&&(yield*this.pushCount(1),m=m.substring(1)),m[0]==="%"){let g=m.length,w=m.indexOf("#");for(;w!==-1;){const I=m[w-1];if(I===" "||I==="	"){g=w-1;break}else w=m.indexOf("#",w+1)}for(;;){const I=m[g-1];if(I===" "||I==="	")g-=1;else break}const $=(yield*this.pushCount(g))+(yield*this.pushSpaces(!0));return yield*this.pushCount(m.length-$),this.pushNewline(),"stream"}if(this.atLineEnd()){const g=yield*this.pushSpaces(!0);return yield*this.pushCount(m.length-g),yield*this.pushNewline(),"stream"}return yield DOCUMENT,yield*this.parseLineStart()}*parseLineStart(){const m=this.charAt(0);if(!m&&!this.atEnd)return this.setNext("line-start");if(m==="-"||m==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const g=this.peek(3);if((g==="---"||g==="...")&&isEmpty(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,g==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!isEmpty(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[m,g]=this.peek(2);if(!g&&!this.atEnd)return this.setNext("block-start");if((m==="-"||m==="?"||m===":")&&isEmpty(g)){const w=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=w,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const m=this.getLine();if(m===null)return this.setNext("doc");let g=yield*this.pushIndicators();switch(m[g]){case"#":yield*this.pushCount(m.length-g);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(isNotAnchorChar),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return g+=yield*this.parseBlockScalarHeader(),g+=yield*this.pushSpaces(!0),yield*this.pushCount(m.length-g),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let m,g,w=-1;do m=yield*this.pushNewline(),m>0?(g=yield*this.pushSpaces(!1),this.indentValue=w=g):g=0,g+=yield*this.pushSpaces(!0);while(m+g>0);const $=this.getLine();if($===null)return this.setNext("flow");if((w!==-1&&w<this.indentNext&&$[0]!=="#"||w===0&&($.startsWith("---")||$.startsWith("..."))&&isEmpty($[3]))&&!(w===this.indentNext-1&&this.flowLevel===1&&($[0]==="]"||$[0]==="}")))return this.flowLevel=0,yield FLOW_END,yield*this.parseLineStart();let I=0;for(;$[I]===",";)I+=yield*this.pushCount(1),I+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(I+=yield*this.pushIndicators(),$[I]){case void 0:return"flow";case"#":return yield*this.pushCount($.length-I),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(isNotAnchorChar),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const D=this.charAt(1);if(this.flowKey||isEmpty(D)||D===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const m=this.charAt(0);let g=this.buffer.indexOf(m,this.pos+1);if(m==="'")for(;g!==-1&&this.buffer[g+1]==="'";)g=this.buffer.indexOf("'",g+2);else for(;g!==-1;){let I=0;for(;this.buffer[g-1-I]==="\\";)I+=1;if(I%2===0)break;g=this.buffer.indexOf('"',g+1)}const w=this.buffer.substring(0,g);let $=w.indexOf(`
`,this.pos);if($!==-1){for(;$!==-1;){const I=this.continueScalar($+1);if(I===-1)break;$=w.indexOf(`
`,I)}$!==-1&&(g=$-(w[$-1]==="\r"?2:1))}if(g===-1){if(!this.atEnd)return this.setNext("quoted-scalar");g=this.buffer.length}return yield*this.pushToIndex(g+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let m=this.pos;for(;;){const g=this.buffer[++m];if(g==="+")this.blockScalarKeep=!0;else if(g>"0"&&g<="9")this.blockScalarIndent=Number(g)-1;else if(g!=="-")break}return yield*this.pushUntil(g=>isEmpty(g)||g==="#")}*parseBlockScalar(){let m=this.pos-1,g=0,w;e:for(let I=this.pos;w=this.buffer[I];++I)switch(w){case" ":g+=1;break;case`
`:m=I,g=0;break;case"\r":{const D=this.buffer[I+1];if(!D&&!this.atEnd)return this.setNext("block-scalar");if(D===`
`)break}default:break e}if(!w&&!this.atEnd)return this.setNext("block-scalar");if(g>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=g:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const I=this.continueScalar(m+1);if(I===-1)break;m=this.buffer.indexOf(`
`,I)}while(m!==-1);if(m===-1){if(!this.atEnd)return this.setNext("block-scalar");m=this.buffer.length}}let $=m+1;for(w=this.buffer[$];w===" ";)w=this.buffer[++$];if(w==="	"){for(;w==="	"||w===" "||w==="\r"||w===`
`;)w=this.buffer[++$];m=$-1}else if(!this.blockScalarKeep)do{let I=m-1,D=this.buffer[I];D==="\r"&&(D=this.buffer[--I]);const q=I;for(;D===" ";)D=this.buffer[--I];if(D===`
`&&I>=this.pos&&I+1+g>q)m=I;else break}while(!0);return yield SCALAR,yield*this.pushToIndex(m+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const m=this.flowLevel>0;let g=this.pos-1,w=this.pos-1,$;for(;$=this.buffer[++w];)if($===":"){const I=this.buffer[w+1];if(isEmpty(I)||m&&flowIndicatorChars.has(I))break;g=w}else if(isEmpty($)){let I=this.buffer[w+1];if($==="\r"&&(I===`
`?(w+=1,$=`
`,I=this.buffer[w+1]):g=w),I==="#"||m&&flowIndicatorChars.has(I))break;if($===`
`){const D=this.continueScalar(w+1);if(D===-1)break;w=Math.max(w,D-2)}}else{if(m&&flowIndicatorChars.has($))break;g=w}return!$&&!this.atEnd?this.setNext("plain-scalar"):(yield SCALAR,yield*this.pushToIndex(g+1,!0),m?"flow":"doc")}*pushCount(m){return m>0?(yield this.buffer.substr(this.pos,m),this.pos+=m,m):0}*pushToIndex(m,g){const w=this.buffer.slice(this.pos,m);return w?(yield w,this.pos+=w.length,w.length):(g&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(isNotAnchorChar))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const m=this.flowLevel>0,g=this.charAt(1);if(isEmpty(g)||m&&flowIndicatorChars.has(g))return m?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let m=this.pos+2,g=this.buffer[m];for(;!isEmpty(g)&&g!==">";)g=this.buffer[++m];return yield*this.pushToIndex(g===">"?m+1:m,!1)}else{let m=this.pos+1,g=this.buffer[m];for(;g;)if(tagChars.has(g))g=this.buffer[++m];else if(g==="%"&&hexDigits.has(this.buffer[m+1])&&hexDigits.has(this.buffer[m+2]))g=this.buffer[m+=3];else break;return yield*this.pushToIndex(m,!1)}}*pushNewline(){const m=this.buffer[this.pos];return m===`
`?yield*this.pushCount(1):m==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(m){let g=this.pos-1,w;do w=this.buffer[++g];while(w===" "||m&&w==="	");const $=g-this.pos;return $>0&&(yield this.buffer.substr(this.pos,$),this.pos=g),$}*pushUntil(m){let g=this.pos,w=this.buffer[g];for(;!m(w);)w=this.buffer[++g];return yield*this.pushToIndex(g,!1)}}class LineCounter{constructor(){this.lineStarts=[],this.addNewLine=m=>this.lineStarts.push(m),this.linePos=m=>{let g=0,w=this.lineStarts.length;for(;g<w;){const I=g+w>>1;this.lineStarts[I]<m?g=I+1:w=I}if(this.lineStarts[g]===m)return{line:g+1,col:1};if(g===0)return{line:0,col:m};const $=this.lineStarts[g-1];return{line:g,col:m-$+1}}}}function includesToken(d,m){for(let g=0;g<d.length;++g)if(d[g].type===m)return!0;return!1}function findNonEmptyIndex(d){for(let m=0;m<d.length;++m)switch(d[m].type){case"space":case"comment":case"newline":break;default:return m}return-1}function isFlowToken(d){switch(d?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function getPrevProps(d){switch(d.type){case"document":return d.start;case"block-map":{const m=d.items[d.items.length-1];return m.sep??m.start}case"block-seq":return d.items[d.items.length-1].start;default:return[]}}function getFirstKeyStartProps(d){if(d.length===0)return[];let m=d.length;e:for(;--m>=0;)switch(d[m].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;d[++m]?.type==="space";);return d.splice(m,d.length)}function fixFlowSeqItems(d){if(d.start.type==="flow-seq-start")for(const m of d.items)m.sep&&!m.value&&!includesToken(m.start,"explicit-key-ind")&&!includesToken(m.sep,"map-value-ind")&&(m.key&&(m.value=m.key),delete m.key,isFlowToken(m.value)?m.value.end?Array.prototype.push.apply(m.value.end,m.sep):m.value.end=m.sep:Array.prototype.push.apply(m.start,m.sep),delete m.sep)}let Parser$2=class{constructor(m){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Lexer,this.onNewLine=m}*parse(m,g=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const w of this.lexer.lex(m,g))yield*this.next(w);g||(yield*this.end())}*next(m){if(this.source=m,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=m.length;return}const g=tokenType(m);if(g)if(g==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=g,yield*this.step(),g){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+m.length);break;case"space":this.atNewLine&&m[0]===" "&&(this.indent+=m.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=m.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=m.length}else{const w=`Not a YAML token: ${m}`;yield*this.pop({type:"error",offset:this.offset,message:w,source:m}),this.offset+=m.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const m=this.peek(1);if(this.type==="doc-end"&&(!m||m.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!m)return yield*this.stream();switch(m.type){case"document":return yield*this.document(m);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(m);case"block-scalar":return yield*this.blockScalar(m);case"block-map":return yield*this.blockMap(m);case"block-seq":return yield*this.blockSequence(m);case"flow-collection":return yield*this.flowCollection(m);case"doc-end":return yield*this.documentEnd(m)}yield*this.pop()}peek(m){return this.stack[this.stack.length-m]}*pop(m){const g=m??this.stack.pop();if(!g)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield g;else{const w=this.peek(1);switch(g.type==="block-scalar"?g.indent="indent"in w?w.indent:0:g.type==="flow-collection"&&w.type==="document"&&(g.indent=0),g.type==="flow-collection"&&fixFlowSeqItems(g),w.type){case"document":w.value=g;break;case"block-scalar":w.props.push(g);break;case"block-map":{const $=w.items[w.items.length-1];if($.value){w.items.push({start:[],key:g,sep:[]}),this.onKeyLine=!0;return}else if($.sep)$.value=g;else{Object.assign($,{key:g,sep:[]}),this.onKeyLine=!$.explicitKey;return}break}case"block-seq":{const $=w.items[w.items.length-1];$.value?w.items.push({start:[],value:g}):$.value=g;break}case"flow-collection":{const $=w.items[w.items.length-1];!$||$.value?w.items.push({start:[],key:g,sep:[]}):$.sep?$.value=g:Object.assign($,{key:g,sep:[]});return}default:yield*this.pop(),yield*this.pop(g)}if((w.type==="document"||w.type==="block-map"||w.type==="block-seq")&&(g.type==="block-map"||g.type==="block-seq")){const $=g.items[g.items.length-1];$&&!$.sep&&!$.value&&$.start.length>0&&findNonEmptyIndex($.start)===-1&&(g.indent===0||$.start.every(I=>I.type!=="comment"||I.indent<g.indent))&&(w.type==="document"?w.end=$.start:w.items.push({start:$.start}),g.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const m={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&m.start.push(this.sourceToken),this.stack.push(m);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(m){if(m.value)return yield*this.lineEnd(m);switch(this.type){case"doc-start":{findNonEmptyIndex(m.start)!==-1?(yield*this.pop(),yield*this.step()):m.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":m.start.push(this.sourceToken);return}const g=this.startBlockValue(m);g?this.stack.push(g):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(m){if(this.type==="map-value-ind"){const g=getPrevProps(this.peek(2)),w=getFirstKeyStartProps(g);let $;m.end?($=m.end,$.push(this.sourceToken),delete m.end):$=[this.sourceToken];const I={type:"block-map",offset:m.offset,indent:m.indent,items:[{start:w,key:m,sep:$}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=I}else yield*this.lineEnd(m)}*blockScalar(m){switch(this.type){case"space":case"comment":case"newline":m.props.push(this.sourceToken);return;case"scalar":if(m.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let g=this.source.indexOf(`
`)+1;for(;g!==0;)this.onNewLine(this.offset+g),g=this.source.indexOf(`
`,g)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(m){const g=m.items[m.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,g.value){const w="end"in g.value?g.value.end:void 0;(Array.isArray(w)?w[w.length-1]:void 0)?.type==="comment"?w?.push(this.sourceToken):m.items.push({start:[this.sourceToken]})}else g.sep?g.sep.push(this.sourceToken):g.start.push(this.sourceToken);return;case"space":case"comment":if(g.value)m.items.push({start:[this.sourceToken]});else if(g.sep)g.sep.push(this.sourceToken);else{if(this.atIndentedComment(g.start,m.indent)){const $=m.items[m.items.length-2]?.value?.end;if(Array.isArray($)){Array.prototype.push.apply($,g.start),$.push(this.sourceToken),m.items.pop();return}}g.start.push(this.sourceToken)}return}if(this.indent>=m.indent){const w=!this.onKeyLine&&this.indent===m.indent,$=w&&(g.sep||g.explicitKey)&&this.type!=="seq-item-ind";let I=[];if($&&g.sep&&!g.value){const D=[];for(let q=0;q<g.sep.length;++q){const j=g.sep[q];switch(j.type){case"newline":D.push(q);break;case"space":break;case"comment":j.indent>m.indent&&(D.length=0);break;default:D.length=0}}D.length>=2&&(I=g.sep.splice(D[1]))}switch(this.type){case"anchor":case"tag":$||g.value?(I.push(this.sourceToken),m.items.push({start:I}),this.onKeyLine=!0):g.sep?g.sep.push(this.sourceToken):g.start.push(this.sourceToken);return;case"explicit-key-ind":!g.sep&&!g.explicitKey?(g.start.push(this.sourceToken),g.explicitKey=!0):$||g.value?(I.push(this.sourceToken),m.items.push({start:I,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(g.explicitKey)if(g.sep)if(g.value)m.items.push({start:[],key:null,sep:[this.sourceToken]});else if(includesToken(g.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:I,key:null,sep:[this.sourceToken]}]});else if(isFlowToken(g.key)&&!includesToken(g.sep,"newline")){const D=getFirstKeyStartProps(g.start),q=g.key,j=g.sep;j.push(this.sourceToken),delete g.key,delete g.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:D,key:q,sep:j}]})}else I.length>0?g.sep=g.sep.concat(I,this.sourceToken):g.sep.push(this.sourceToken);else if(includesToken(g.start,"newline"))Object.assign(g,{key:null,sep:[this.sourceToken]});else{const D=getFirstKeyStartProps(g.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:D,key:null,sep:[this.sourceToken]}]})}else g.sep?g.value||$?m.items.push({start:I,key:null,sep:[this.sourceToken]}):includesToken(g.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):g.sep.push(this.sourceToken):Object.assign(g,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const D=this.flowScalar(this.type);$||g.value?(m.items.push({start:I,key:D,sep:[]}),this.onKeyLine=!0):g.sep?this.stack.push(D):(Object.assign(g,{key:D,sep:[]}),this.onKeyLine=!0);return}default:{const D=this.startBlockValue(m);if(D){if(D.type==="block-seq"){if(!g.explicitKey&&g.sep&&!includesToken(g.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else w&&m.items.push({start:I});this.stack.push(D);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(m){const g=m.items[m.items.length-1];switch(this.type){case"newline":if(g.value){const w="end"in g.value?g.value.end:void 0;(Array.isArray(w)?w[w.length-1]:void 0)?.type==="comment"?w?.push(this.sourceToken):m.items.push({start:[this.sourceToken]})}else g.start.push(this.sourceToken);return;case"space":case"comment":if(g.value)m.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(g.start,m.indent)){const $=m.items[m.items.length-2]?.value?.end;if(Array.isArray($)){Array.prototype.push.apply($,g.start),$.push(this.sourceToken),m.items.pop();return}}g.start.push(this.sourceToken)}return;case"anchor":case"tag":if(g.value||this.indent<=m.indent)break;g.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==m.indent)break;g.value||includesToken(g.start,"seq-item-ind")?m.items.push({start:[this.sourceToken]}):g.start.push(this.sourceToken);return}if(this.indent>m.indent){const w=this.startBlockValue(m);if(w){this.stack.push(w);return}}yield*this.pop(),yield*this.step()}*flowCollection(m){const g=m.items[m.items.length-1];if(this.type==="flow-error-end"){let w;do yield*this.pop(),w=this.peek(1);while(w&&w.type==="flow-collection")}else if(m.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!g||g.sep?m.items.push({start:[this.sourceToken]}):g.start.push(this.sourceToken);return;case"map-value-ind":!g||g.value?m.items.push({start:[],key:null,sep:[this.sourceToken]}):g.sep?g.sep.push(this.sourceToken):Object.assign(g,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!g||g.value?m.items.push({start:[this.sourceToken]}):g.sep?g.sep.push(this.sourceToken):g.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const $=this.flowScalar(this.type);!g||g.value?m.items.push({start:[],key:$,sep:[]}):g.sep?this.stack.push($):Object.assign(g,{key:$,sep:[]});return}case"flow-map-end":case"flow-seq-end":m.end.push(this.sourceToken);return}const w=this.startBlockValue(m);w?this.stack.push(w):(yield*this.pop(),yield*this.step())}else{const w=this.peek(2);if(w.type==="block-map"&&(this.type==="map-value-ind"&&w.indent===m.indent||this.type==="newline"&&!w.items[w.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&w.type!=="flow-collection"){const $=getPrevProps(w),I=getFirstKeyStartProps($);fixFlowSeqItems(m);const D=m.end.splice(1,m.end.length);D.push(this.sourceToken);const q={type:"block-map",offset:m.offset,indent:m.indent,items:[{start:I,key:m,sep:D}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=q}else yield*this.lineEnd(m)}}flowScalar(m){if(this.onNewLine){let g=this.source.indexOf(`
`)+1;for(;g!==0;)this.onNewLine(this.offset+g),g=this.source.indexOf(`
`,g)+1}return{type:m,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(m){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const g=getPrevProps(m),w=getFirstKeyStartProps(g);return w.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:w,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const g=getPrevProps(m),w=getFirstKeyStartProps(g);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:w,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(m,g){return this.type!=="comment"||this.indent<=g?!1:m.every(w=>w.type==="newline"||w.type==="space")}*documentEnd(m){this.type!=="doc-mode"&&(m.end?m.end.push(this.sourceToken):m.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(m){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:m.end?m.end.push(this.sourceToken):m.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}};function parseOptions(d){const m=d.prettyErrors!==!1;return{lineCounter:d.lineCounter||m&&new LineCounter||null,prettyErrors:m}}function parseAllDocuments(d,m={}){const{lineCounter:g,prettyErrors:w}=parseOptions(m),$=new Parser$2(g?.addNewLine),I=new Composer(m),D=Array.from(I.compose($.parse(d)));if(w&&g)for(const q of D)q.errors.forEach(prettifyError(d,g)),q.warnings.forEach(prettifyError(d,g));return D.length>0?D:Object.assign([],{empty:!0},I.streamInfo())}function parseDocument(d,m={}){const{lineCounter:g,prettyErrors:w}=parseOptions(m),$=new Parser$2(g?.addNewLine),I=new Composer(m);let D=null;for(const q of I.compose($.parse(d),!0,d.length))if(!D)D=q;else if(D.options.logLevel!=="silent"){D.errors.push(new YAMLParseError(q.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return w&&g&&(D.errors.forEach(prettifyError(d,g)),D.warnings.forEach(prettifyError(d,g))),D}function parse$1(d,m,g){let w;typeof m=="function"?w=m:g===void 0&&m&&typeof m=="object"&&(g=m);const $=parseDocument(d,g);if(!$)return null;if($.warnings.forEach(I=>warn($.options.logLevel,I)),$.errors.length>0){if($.options.logLevel!=="silent")throw $.errors[0];$.errors=[]}return $.toJS(Object.assign({reviver:w},g))}function stringify$1(d,m,g){let w=null;if(typeof m=="function"||Array.isArray(m)?w=m:g===void 0&&m&&(g=m),typeof g=="string"&&(g=g.length),typeof g=="number"){const $=Math.round(g);g=$<1?void 0:$>8?{indent:8}:{indent:$}}if(d===void 0){const{keepUndefined:$}=g??m??{};if(!$)return}return isDocument(d)&&!w?d.toString(g):new Document(d,w,g).toString(g)}var YAML=Object.freeze({__proto__:null,Alias,CST:cst,Composer,Document,Lexer,LineCounter,Pair,Parser:Parser$2,Scalar,Schema,YAMLError,YAMLMap,YAMLParseError,YAMLSeq,YAMLWarning,isAlias,isCollection:isCollection$1,isDocument,isMap,isNode,isPair,isScalar:isScalar$1,isSeq,parse:parse$1,parseAllDocuments,parseDocument,stringify:stringify$1,visit:visit$3,visitAsync});function stringifyWithToplevelOrdering(d,m,g,w){let $=[...w];$=["$schema",...$];const I=(D,q)=>q===null||Array.isArray(q)||typeof q!="object"?q:Object.keys(q).every(j=>$.includes(j))?Object.fromEntries($.map(j=>[j,q[j]])):q;return JSON.stringify({$schema:m,...g},I,2)}var jpeg$3,hasRequiredJpeg;function requireJpeg(){return hasRequiredJpeg||(hasRequiredJpeg=1,jpeg$3={parseSections:function(d,m){var g,w;for(d.setBigEndian(!0);d.remainingLength()>0&&w!==218;){if(d.nextUInt8()!==255)throw new Error("Invalid JPEG section offset");w=d.nextUInt8(),w>=208&&w<=217||w===218?g=0:g=d.nextUInt16()-2,m(w,d.branch(0,g)),d.skip(g)}},getSizeFromSOFSection:function(d){return d.skip(1),{height:d.nextUInt16(),width:d.nextUInt16()}},getSectionName:function(d){var m,g;switch(d){case 216:m="SOI";break;case 196:m="DHT";break;case 219:m="DQT";break;case 221:m="DRI";break;case 218:m="SOS";break;case 254:m="COM";break;case 217:m="EOI";break;default:d>=224&&d<=239?(m="APP",g=d-224):d>=192&&d<=207&&d!==196&&d!==200&&d!==204?(m="SOF",g=d-192):d>=208&&d<=215&&(m="RST",g=d-208);break}var w={name:m};return typeof g=="number"&&(w.index=g),w}}),jpeg$3}var exif$3,hasRequiredExif;function requireExif(){if(hasRequiredExif)return exif$3;hasRequiredExif=1;function d(I,D){switch(I){case 1:return D.nextUInt8();case 3:return D.nextUInt16();case 4:return D.nextUInt32();case 5:return[D.nextUInt32(),D.nextUInt32()];case 6:return D.nextInt8();case 8:return D.nextUInt16();case 9:return D.nextUInt32();case 10:return[D.nextInt32(),D.nextInt32()];case 11:return D.nextFloat();case 12:return D.nextDouble();default:throw new Error("Invalid format while decoding: "+I)}}function m(I){switch(I){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function g(I,D){var q=D.nextUInt16(),j=D.nextUInt16(),G=m(j),H=D.nextUInt32(),W=G*H,V,K;if(W>4&&(D=I.openWithOffset(D.nextUInt32())),j===2){V=D.nextString(H);var Z=V.indexOf("\0");Z!==-1&&(V=V.substr(0,Z))}else if(j===7)V=D.nextBuffer(H);else if(j!==0)for(V=[],K=0;K<H;++K)V.push(d(j,D));return W<4&&D.skip(4-W),[q,V,j]}function w(I,D,q){var j=D.nextUInt16(),G,H;for(H=0;H<j;++H)G=g(I,D),q(G[0],G[1],G[2])}function $(I){var D=I.nextString(6);if(D!=="Exif\0\0")throw new Error("Invalid EXIF header");var q=I.mark(),j=I.nextUInt16();if(j===18761)I.setBigEndian(!1);else if(j===19789)I.setBigEndian(!0);else throw new Error("Invalid TIFF header");if(I.nextUInt16()!==42)throw new Error("Invalid TIFF data");return q}return exif$3={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(I,D){var q;try{q=$(I)}catch{return!1}var j,G,H,W=q.openWithOffset(I.nextUInt32()),V=this.IFD0;w(q,W,function(oe,ee,ae){switch(oe){case 34853:G=ee[0];break;case 34665:j=ee[0];break;default:D(V,oe,ee,ae);break}});var K=W.nextUInt32();if(K!==0){var Z=q.openWithOffset(K);w(q,Z,D.bind(null,this.IFD1))}if(G){var Q=q.openWithOffset(G);w(q,Q,D.bind(null,this.GPSIFD))}if(j){var J=q.openWithOffset(j),re=this.InteropIFD;w(q,J,function(oe,ee,ae){oe===40965?H=ee[0]:D(re,oe,ee,ae)})}if(H){var se=q.openWithOffset(H);w(q,se,D.bind(null,this.InteropIFD))}return!0}},exif$3}var date$2,hasRequiredDate;function requireDate(){if(hasRequiredDate)return date$2;hasRequiredDate=1;function d(q){return parseInt(q,10)}var m=3600,g=60;function w(q,j){q=q.map(d),j=j.map(d);var G=q[0],H=q[1]-1,W=q[2],V=j[0],K=j[1],Z=j[2],Q=Date.UTC(G,H,W,V,K,Z,0),J=Q/1e3;return J}function $(q){var j=q.substr(0,10).split("-"),G=q.substr(11,8).split(":"),H=q.substr(19,6),W=H.split(":").map(d),V=W[0]*m+W[1]*g,K=w(j,G);if(K-=V,typeof K=="number"&&!isNaN(K))return K}function I(q){var j=q.split(" "),G=j[0].split(":"),H=j[1].split(":"),W=w(G,H);if(typeof W=="number"&&!isNaN(W))return W}function D(q){var j=q.length===19&&q.charAt(4)===":",G=q.length===25&&q.charAt(10)==="T";if(G)return $(q);if(j)return I(q)}return date$2={parseDateWithSpecFormat:I,parseDateWithTimezoneFormat:$,parseExifDate:D},date$2}var simplify$2,hasRequiredSimplify;function requireSimplify(){if(hasRequiredSimplify)return simplify$2;hasRequiredSimplify=1;var d=requireExif(),m=requireDate(),g=[{section:d.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:d.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],w=[{section:d.SubIFD,type:306,name:"ModifyDate"},{section:d.SubIFD,type:36867,name:"DateTimeOriginal"},{section:d.SubIFD,type:36868,name:"CreateDate"},{section:d.SubIFD,type:306,name:"ModifyDate"}];return simplify$2={castDegreeValues:function($,I){g.forEach(function(D){var q=$(D);if(q){var j=$({section:D.section,type:D.refType,name:D.refName}),G=j===D.posVal?1:-1,H=(q[0]+q[1]/60+q[2]/3600)*G;I(D,H)}})},castDateValues:function($,I){w.forEach(function(D){var q=$(D);if(q){var j=m.parseExifDate(q);typeof j<"u"&&I(D,j)}})},simplifyValue:function($,I){return Array.isArray($)&&($=$.map(function(D){return I===10||I===5?D[0]/D[1]:D}),$.length===1&&($=$[0])),$}},simplify$2}var exifTags$1,hasRequiredExifTags$1;function requireExifTags$1(){return hasRequiredExifTags$1||(hasRequiredExifTags$1=1,exifTags$1={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}}),exifTags$1}var parser$1,hasRequiredParser;function requireParser(){if(hasRequiredParser)return parser$1;hasRequiredParser=1;var d=requireJpeg(),m=requireExif(),g=requireSimplify();function w(I,D,q,j,G,H,W){this.startMarker=I,this.tags=D,this.imageSize=q,this.thumbnailOffset=j,this.thumbnailLength=G,this.thumbnailType=H,this.app1Offset=W}w.prototype={hasThumbnail:function(I){return!this.thumbnailOffset||!this.thumbnailLength?!1:typeof I!="string"?!0:I.toLowerCase().trim()==="image/jpeg"?this.thumbnailType===6:I.toLowerCase().trim()==="image/tiff"?this.thumbnailType===1:!1},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var I=this._getThumbnailStream(),D;return d.parseSections(I,function(q,j){d.getSectionName(q).name==="SOF"&&(D=d.getSizeFromSOFSection(j))}),D}};function $(I){this.stream=I,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}return $.prototype={enableBinaryFields:function(I){return this.flags.readBinaryTags=!!I,this},enablePointers:function(I){return this.flags.hidePointers=!I,this},enableTagNames:function(I){return this.flags.resolveTagNames=!!I,this},enableImageSize:function(I){return this.flags.imageSize=!!I,this},enableReturnTags:function(I){return this.flags.returnTags=!!I,this},enableSimpleValues:function(I){return this.flags.simplifyValues=!!I,this},parse:function(){var I=this.stream.mark(),D=I.openWithOffset(0),q=this.flags,j,G,H,W,V,K,Z,Q,J;return q.resolveTagNames&&(Z=requireExifTags$1()),q.resolveTagNames?(j={},Q=function(re){return j[re.name]},J=function(re,se){j[re.name]=se}):(j=[],Q=function(re){var se;for(se=0;se<j.length;++se)if(j[se].type===re.type&&j[se].section===re.section)return j.value},J=function(re,se){var oe;for(oe=0;oe<j.length;++oe)if(j[oe].type===re.type&&j[oe].section===re.section){j.value=se;return}}),d.parseSections(D,function(re,se){var oe,ee=se.offsetFrom(I);re===225?(oe=m.parseTags(se,function(ae,ce,le,de){if(!(!q.readBinaryTags&&de===7)){if(ce===513){if(H=le[0],q.hidePointers)return}else if(ce===514){if(W=le[0],q.hidePointers)return}else if(ce===259&&(V=le[0],q.hidePointers))return;if(q.returnTags)if(q.simplifyValues&&(le=g.simplifyValue(le,de)),q.resolveTagNames){var _e=ae===m.GPSIFD?Z.gps:Z.exif,we=_e[ce];we||(we=Z.exif[ce]),j.hasOwnProperty(we)||(j[we]=le)}else j.push({section:ae,type:ce,value:le})}}),oe&&(K=ee)):q.imageSize&&d.getSectionName(re).name==="SOF"&&(G=d.getSizeFromSOFSection(se))}),q.simplifyValues&&(g.castDegreeValues(Q,J),g.castDateValues(Q,J)),new w(I,j,G,H,W,V,K)}},parser$1=$,parser$1}var domBufferstream$1,hasRequiredDomBufferstream$1;function requireDomBufferstream$1(){if(hasRequiredDomBufferstream$1)return domBufferstream$1;hasRequiredDomBufferstream$1=1;function d(m,g,w,$,I,D){this.global=I,g=g||0,w=w||m.byteLength-g,this.arrayBuffer=m.slice(g,g+w),this.view=new I.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian($),this.offset=0,this.parentOffset=(D||0)+g}return d.prototype={setBigEndian:function(m){this.littleEndian=!m},nextUInt8:function(){var m=this.view.getUint8(this.offset);return this.offset+=1,m},nextInt8:function(){var m=this.view.getInt8(this.offset);return this.offset+=1,m},nextUInt16:function(){var m=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,m},nextUInt32:function(){var m=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,m},nextInt16:function(){var m=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,m},nextInt32:function(){var m=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,m},nextFloat:function(){var m=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,m},nextDouble:function(){var m=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,m},nextBuffer:function(m){var g=this.arrayBuffer.slice(this.offset,this.offset+m);return this.offset+=m,g},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(m){var g=this.arrayBuffer.slice(this.offset,this.offset+m);return g=String.fromCharCode.apply(null,new this.global.Uint8Array(g)),this.offset+=m,g},mark:function(){var m=this;return{openWithOffset:function(g){return g=(g||0)+this.offset,new d(m.arrayBuffer,g,m.arrayBuffer.byteLength-g,!m.littleEndian,m.global,m.parentOffset)},offset:this.offset,getParentOffset:function(){return m.parentOffset}}},offsetFrom:function(m){return this.parentOffset+this.offset-(m.offset+m.getParentOffset())},skip:function(m){this.offset+=m},branch:function(m,g){return g=typeof g=="number"?g:this.arrayBuffer.byteLength-(this.offset+m),new d(this.arrayBuffer,this.offset+m,g,!this.littleEndian,this.global,this.parentOffset)}},domBufferstream$1=d,domBufferstream$1}var bufferstream$1,hasRequiredBufferstream$1;function requireBufferstream$1(){if(hasRequiredBufferstream$1)return bufferstream$1;hasRequiredBufferstream$1=1;function d(m,g,w,$){this.buffer=m,this.offset=g||0,w=typeof w=="number"?w:m.length,this.endPosition=this.offset+w,this.setBigEndian($)}return d.prototype={setBigEndian:function(m){this.bigEndian=!!m},nextUInt8:function(){var m=this.buffer.readUInt8(this.offset);return this.offset+=1,m},nextInt8:function(){var m=this.buffer.readInt8(this.offset);return this.offset+=1,m},nextUInt16:function(){var m=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,m},nextUInt32:function(){var m=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,m},nextInt16:function(){var m=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,m},nextInt32:function(){var m=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,m},nextFloat:function(){var m=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,m},nextDouble:function(){var m=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,m},nextBuffer:function(m){var g=this.buffer.slice(this.offset,this.offset+m);return this.offset+=m,g},remainingLength:function(){return this.endPosition-this.offset},nextString:function(m){var g=this.buffer.toString("utf8",this.offset,this.offset+m);return this.offset+=m,g},mark:function(){var m=this;return{openWithOffset:function(g){return g=(g||0)+this.offset,new d(m.buffer,g,m.endPosition-g,m.bigEndian)},offset:this.offset}},offsetFrom:function(m){return this.offset-m.offset},skip:function(m){this.offset+=m},branch:function(m,g){return g=typeof g=="number"?g:this.endPosition-(this.offset+m),new d(this.buffer,this.offset+m,g,this.bigEndian)}},bufferstream$1=d,bufferstream$1}var exifParser$1,hasRequiredExifParser;function requireExifParser(){if(hasRequiredExifParser)return exifParser$1;hasRequiredExifParser=1;var d=requireParser();function m(){return(0,eval)("this")}return exifParser$1={create:function(g,w){if(w=w||m(),g instanceof w.ArrayBuffer){var $=requireDomBufferstream$1();return new d(new $(g,0,g.byteLength,!0,w))}else{var I=requireBufferstream$1();return new d(new I(g,0,g.length,!0))}}},exifParser$1}requireExifParser();var piexif$1={exports:{}},hasRequiredPiexif;function requirePiexif(){return hasRequiredPiexif||(hasRequiredPiexif=1,(function(d,m){(function(){var g={};g.version="1.0.4",g.remove=function(ae){var ce=!1;if(ae.slice(0,2)!="Ã¿Ã˜")if(ae.slice(0,23)=="data:image/jpeg;base64,"||ae.slice(0,22)=="data:image/jpg;base64,")ae=V(ae.split(",")[1]),ce=!0;else throw new Error("Given data is not jpeg.");var le=J(ae),de=le.filter(function(we){return!(we.slice(0,2)=="Ã¿Ã¡"&&we.slice(4,10)=="Exif\0\0")}),_e=de.join("");return ce&&(_e="data:image/jpeg;base64,"+W(_e)),_e},g.insert=function(ae,ce){var le=!1;if(ae.slice(0,6)!="Exif\0\0")throw new Error("Given data is not exif.");if(ce.slice(0,2)!="Ã¿Ã˜")if(ce.slice(0,23)=="data:image/jpeg;base64,"||ce.slice(0,22)=="data:image/jpg;base64,")ce=V(ce.split(",")[1]),le=!0;else throw new Error("Given data is not jpeg.");var de="Ã¿Ã¡"+K(">H",[ae.length+2])+ae,_e=J(ce),we=se(_e,de);return le&&(we="data:image/jpeg;base64,"+W(we)),we},g.load=function(ae){var ce;if(typeof ae=="string")if(ae.slice(0,2)=="Ã¿Ã˜")ce=ae;else if(ae.slice(0,23)=="data:image/jpeg;base64,"||ae.slice(0,22)=="data:image/jpg;base64,")ce=V(ae.split(",")[1]);else if(ae.slice(0,4)=="Exif")ce=ae.slice(6);else throw new Error("'load' gots invalid file data.");else throw new Error("'load' gots invalid type argument.");var le={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},de=new H(ce);if(de.tiftag===null)return le;de.tiftag.slice(0,2)=="II"?de.endian_mark="<":de.endian_mark=">";var _e=Z(de.endian_mark+"L",de.tiftag.slice(4,8))[0];le["0th"]=de.get_ifd(_e,"0th");var we=le["0th"].first_ifd_pointer;if(delete le["0th"].first_ifd_pointer,34665 in le["0th"]&&(_e=le["0th"][34665],le.Exif=de.get_ifd(_e,"Exif")),34853 in le["0th"]&&(_e=le["0th"][34853],le.GPS=de.get_ifd(_e,"GPS")),40965 in le.Exif&&(_e=le.Exif[40965],le.Interop=de.get_ifd(_e,"Interop")),we!="\0\0\0\0"&&(_e=Z(de.endian_mark+"L",we)[0],le["1st"]=de.get_ifd(_e,"1st"),513 in le["1st"]&&514 in le["1st"])){var pe=le["1st"][513]+le["1st"][514],xe=de.tiftag.slice(le["1st"][513],pe);le.thumbnail=xe}return le},g.dump=function(ae){var ce=8,le=w(ae),de="Exif\0\0MM\0*\0\0\0\b",_e=!1,we=!1,pe=!1,xe=!1,Ge,Te,Ce,Oe,bt;"0th"in le?Ge=le["0th"]:Ge={},"Exif"in le&&Object.keys(le.Exif).length||"Interop"in le&&Object.keys(le.Interop).length?(Ge[34665]=1,_e=!0,Te=le.Exif,"Interop"in le&&Object.keys(le.Interop).length?(Te[40965]=1,pe=!0,Ce=le.Interop):Object.keys(Te).indexOf(g.ExifIFD.InteroperabilityTag.toString())>-1&&delete Te[40965]):Object.keys(Ge).indexOf(g.ImageIFD.ExifTag.toString())>-1&&delete Ge[34665],"GPS"in le&&Object.keys(le.GPS).length?(Ge[g.ImageIFD.GPSTag]=1,we=!0,Oe=le.GPS):Object.keys(Ge).indexOf(g.ImageIFD.GPSTag.toString())>-1&&delete Ge[g.ImageIFD.GPSTag],"1st"in le&&"thumbnail"in le&&le.thumbnail!=null&&(xe=!0,le["1st"][513]=1,le["1st"][514]=1,bt=le["1st"]);var Mt=G(Ge,"0th",0),lt=Mt[0].length+_e*12+we*12+4+Mt[1].length,ir,Ye="",xt=0,ar,ht="",gt=0,zt,ur="",dr=0,fr,Ft="",$e;if(_e&&(ir=G(Te,"Exif",lt),xt=ir[0].length+pe*12+ir[1].length),we&&(ar=G(Oe,"GPS",lt+xt),ht=ar.join(""),gt=ht.length),pe){var Bt=lt+xt+gt;zt=G(Ce,"Interop",Bt),ur=zt.join(""),dr=ur.length}if(xe){var Bt=lt+xt+gt+dr;if(fr=G(bt,"1st",Bt),$e=$(le.thumbnail),$e.length>64e3)throw new Error("Given thumbnail is too large. max 64kB")}var Qe="",st="",at="",pt="\0\0\0\0";if(_e){var sr=ce+lt,Ee=K(">L",[sr]),ze=34665,ct=K(">H",[ze]),ft=K(">H",[oe.Long]),pr=K(">L",[1]);Qe=ct+ft+pr+Ee}if(we){var sr=ce+lt+xt,Ee=K(">L",[sr]),ze=34853,ct=K(">H",[ze]),ft=K(">H",[oe.Long]),pr=K(">L",[1]);st=ct+ft+pr+Ee}if(pe){var sr=ce+lt+xt+gt,Ee=K(">L",[sr]),ze=40965,ct=K(">H",[ze]),ft=K(">H",[oe.Long]),pr=K(">L",[1]);at=ct+ft+pr+Ee}if(xe){var sr=ce+lt+xt+gt+dr;pt=K(">L",[sr]);var fn=sr+fr[0].length+24+4+fr[1].length,vn="\0\0\0\0"+K(">L",[fn]),En="\0\0\0\0"+K(">L",[$e.length]);Ft=fr[0]+vn+En+"\0\0\0\0"+fr[1]+$e}var bn=Mt[0]+Qe+st+pt+Mt[1];return _e&&(Ye=ir[0]+at+ir[1]),de+bn+Ye+ht+ur+Ft};function w(ae){return JSON.parse(JSON.stringify(ae))}function $(ae){for(var ce=J(ae);"Ã¿Ã "<=ce[1].slice(0,2)&&ce[1].slice(0,2)<="Ã¿Ã¯";)ce=[ce[0]].concat(ce.slice(2));return ce.join("")}function I(ae){return K(">"+Q("B",ae.length),ae)}function D(ae){return K(">"+Q("H",ae.length),ae)}function q(ae){return K(">"+Q("L",ae.length),ae)}function j(ae,ce,le){var de="",_e="",we,pe,xe,Ge;if(ce=="Byte")we=ae.length,we<=4?_e=I(ae)+Q("\0",4-we):(_e=K(">L",[le]),de=I(ae));else if(ce=="Short")we=ae.length,we<=2?_e=D(ae)+Q("\0\0",2-we):(_e=K(">L",[le]),de=D(ae));else if(ce=="Long")we=ae.length,we<=1?_e=q(ae):(_e=K(">L",[le]),de=q(ae));else if(ce=="Ascii")pe=ae+"\0",we=pe.length,we>4?(_e=K(">L",[le]),de=pe):_e=pe+Q("\0",4-we);else if(ce=="Rational"){if(typeof ae[0]=="number")we=1,xe=ae[0],Ge=ae[1],pe=K(">L",[xe])+K(">L",[Ge]);else{we=ae.length,pe="";for(var Te=0;Te<we;Te++)xe=ae[Te][0],Ge=ae[Te][1],pe+=K(">L",[xe])+K(">L",[Ge])}_e=K(">L",[le]),de=pe}else if(ce=="SRational"){if(typeof ae[0]=="number")we=1,xe=ae[0],Ge=ae[1],pe=K(">l",[xe])+K(">l",[Ge]);else{we=ae.length,pe="";for(var Te=0;Te<we;Te++)xe=ae[Te][0],Ge=ae[Te][1],pe+=K(">l",[xe])+K(">l",[Ge])}_e=K(">L",[le]),de=pe}else ce=="Undefined"&&(we=ae.length,we>4?(_e=K(">L",[le]),de=ae):_e=ae+Q("\0",4-we));var Ce=K(">L",[we]);return[Ce,_e,de]}function G(ae,ce,le){var de=8,_e=Object.keys(ae).length,we=K(">H",[_e]),pe;["0th","1st"].indexOf(ce)>-1?pe=2+_e*12+4:pe=2+_e*12;var xe="",Ge="",Te;for(var Te in ae)if(typeof Te=="string"&&(Te=parseInt(Te)),!(ce=="0th"&&[34665,34853].indexOf(Te)>-1)){{if(ce=="Exif"&&Te==40965)continue;if(ce=="1st"&&[513,514].indexOf(Te)>-1)continue}var Ce=ae[Te],Oe=K(">H",[Te]),bt=ee[ce][Te].type,Mt=K(">H",[oe[bt]]);typeof Ce=="number"&&(Ce=[Ce]);var lt=de+pe+le+Ge.length,ir=j(Ce,bt,lt),Ye=ir[0],xt=ir[1],ar=ir[2];xe+=Oe+Mt+Ye+xt,Ge+=ar}return[we+xe,Ge]}function H(ae){var ce,le;if(ae.slice(0,2)=="Ã¿Ã˜")ce=J(ae),le=re(ce),le?this.tiftag=le.slice(10):this.tiftag=null;else if(["II","MM"].indexOf(ae.slice(0,2))>-1)this.tiftag=ae;else if(ae.slice(0,4)=="Exif")this.tiftag=ae.slice(6);else throw new Error("Given file is neither JPEG nor TIFF.")}if(H.prototype={get_ifd:function(ae,ce){var le={},de=Z(this.endian_mark+"H",this.tiftag.slice(ae,ae+2))[0],_e=ae+2,we;["0th","1st"].indexOf(ce)>-1?we="Image":we=ce;for(var pe=0;pe<de;pe++){ae=_e+12*pe;var xe=Z(this.endian_mark+"H",this.tiftag.slice(ae,ae+2))[0],Ge=Z(this.endian_mark+"H",this.tiftag.slice(ae+2,ae+4))[0],Te=Z(this.endian_mark+"L",this.tiftag.slice(ae+4,ae+8))[0],Ce=this.tiftag.slice(ae+8,ae+12),Oe=[Ge,Te,Ce];xe in ee[we]&&(le[xe]=this.convert_value(Oe))}return ce=="0th"&&(ae=_e+12*de,le.first_ifd_pointer=this.tiftag.slice(ae,ae+4)),le},convert_value:function(ae){var ce=null,le=ae[0],de=ae[1],_e=ae[2],we;if(le==1)de>4?(we=Z(this.endian_mark+"L",_e)[0],ce=Z(this.endian_mark+Q("B",de),this.tiftag.slice(we,we+de))):ce=Z(this.endian_mark+Q("B",de),_e.slice(0,de));else if(le==2)de>4?(we=Z(this.endian_mark+"L",_e)[0],ce=this.tiftag.slice(we,we+de-1)):ce=_e.slice(0,de-1);else if(le==3)de>2?(we=Z(this.endian_mark+"L",_e)[0],ce=Z(this.endian_mark+Q("H",de),this.tiftag.slice(we,we+de*2))):ce=Z(this.endian_mark+Q("H",de),_e.slice(0,de*2));else if(le==4)de>1?(we=Z(this.endian_mark+"L",_e)[0],ce=Z(this.endian_mark+Q("L",de),this.tiftag.slice(we,we+de*4))):ce=Z(this.endian_mark+Q("L",de),_e);else if(le==5)if(we=Z(this.endian_mark+"L",_e)[0],de>1){ce=[];for(var pe=0;pe<de;pe++)ce.push([Z(this.endian_mark+"L",this.tiftag.slice(we+pe*8,we+4+pe*8))[0],Z(this.endian_mark+"L",this.tiftag.slice(we+4+pe*8,we+8+pe*8))[0]])}else ce=[Z(this.endian_mark+"L",this.tiftag.slice(we,we+4))[0],Z(this.endian_mark+"L",this.tiftag.slice(we+4,we+8))[0]];else if(le==7)de>4?(we=Z(this.endian_mark+"L",_e)[0],ce=this.tiftag.slice(we,we+de)):ce=_e.slice(0,de);else if(le==9)de>1?(we=Z(this.endian_mark+"L",_e)[0],ce=Z(this.endian_mark+Q("l",de),this.tiftag.slice(we,we+de*4))):ce=Z(this.endian_mark+Q("l",de),_e);else if(le==10)if(we=Z(this.endian_mark+"L",_e)[0],de>1){ce=[];for(var pe=0;pe<de;pe++)ce.push([Z(this.endian_mark+"l",this.tiftag.slice(we+pe*8,we+4+pe*8))[0],Z(this.endian_mark+"l",this.tiftag.slice(we+4+pe*8,we+8+pe*8))[0]])}else ce=[Z(this.endian_mark+"l",this.tiftag.slice(we,we+4))[0],Z(this.endian_mark+"l",this.tiftag.slice(we+4,we+8))[0]];else throw new Error("Exif might be wrong. Got incorrect value type to decode. type:"+le);return ce instanceof Array&&ce.length==1?ce[0]:ce}},typeof window<"u"&&typeof window.btoa=="function")var W=window.btoa;if(typeof W>"u")var W=function(ce){for(var le="",de,_e,we,pe,xe,Ge,Te,Ce=0,Oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Ce<ce.length;)de=ce.charCodeAt(Ce++),_e=ce.charCodeAt(Ce++),we=ce.charCodeAt(Ce++),pe=de>>2,xe=(de&3)<<4|_e>>4,Ge=(_e&15)<<2|we>>6,Te=we&63,isNaN(_e)?Ge=Te=64:isNaN(we)&&(Te=64),le=le+Oe.charAt(pe)+Oe.charAt(xe)+Oe.charAt(Ge)+Oe.charAt(Te);return le};if(typeof window<"u"&&typeof window.atob=="function")var V=window.atob;if(typeof V>"u")var V=function(ce){var le="",de,_e,we,pe,xe,Ge,Te,Ce=0,Oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(ce=ce.replace(/[^A-Za-z0-9\+\/\=]/g,"");Ce<ce.length;)pe=Oe.indexOf(ce.charAt(Ce++)),xe=Oe.indexOf(ce.charAt(Ce++)),Ge=Oe.indexOf(ce.charAt(Ce++)),Te=Oe.indexOf(ce.charAt(Ce++)),de=pe<<2|xe>>4,_e=(xe&15)<<4|Ge>>2,we=(Ge&3)<<6|Te,le=le+String.fromCharCode(de),Ge!=64&&(le=le+String.fromCharCode(_e)),Te!=64&&(le=le+String.fromCharCode(we));return le};function K(ae,ce){if(!(ce instanceof Array))throw new Error("'pack' error. Got invalid type argument.");if(ae.length-1!=ce.length)throw new Error("'pack' error. "+(ae.length-1)+" marks, "+ce.length+" elements.");var le;if(ae[0]=="<")le=!0;else if(ae[0]==">")le=!1;else throw new Error("");for(var de="",_e=1,we=null,pe=null,xe=null;pe=ae[_e];){if(pe.toLowerCase()=="b"){if(we=ce[_e-1],pe=="b"&&we<0&&(we+=256),we>255||we<0)throw new Error("'pack' error.");xe=String.fromCharCode(we)}else if(pe=="H"){if(we=ce[_e-1],we>65535||we<0)throw new Error("'pack' error.");xe=String.fromCharCode(Math.floor(we%65536/256))+String.fromCharCode(we%256),le&&(xe=xe.split("").reverse().join(""))}else if(pe.toLowerCase()=="l"){if(we=ce[_e-1],pe=="l"&&we<0&&(we+=4294967296),we>4294967295||we<0)throw new Error("'pack' error.");xe=String.fromCharCode(Math.floor(we/16777216))+String.fromCharCode(Math.floor(we%16777216/65536))+String.fromCharCode(Math.floor(we%65536/256))+String.fromCharCode(we%256),le&&(xe=xe.split("").reverse().join(""))}else throw new Error("'pack' error.");de+=xe,_e+=1}return de}function Z(ae,ce){if(typeof ce!="string")throw new Error("'unpack' error. Got invalid type argument.");for(var le=0,de=1;de<ae.length;de++)if(ae[de].toLowerCase()=="b")le+=1;else if(ae[de].toLowerCase()=="h")le+=2;else if(ae[de].toLowerCase()=="l")le+=4;else throw new Error("'unpack' error. Got invalid mark.");if(le!=ce.length)throw new Error("'unpack' error. Mismatch between symbol and string length. "+le+":"+ce.length);var _e;if(ae[0]=="<")_e=!0;else if(ae[0]==">")_e=!1;else throw new Error("'unpack' error.");for(var we=[],pe=0,xe=1,Ge=null,Te=null,Ce=null,Oe="";Te=ae[xe];){if(Te.toLowerCase()=="b")Ce=1,Oe=ce.slice(pe,pe+Ce),Ge=Oe.charCodeAt(0),Te=="b"&&Ge>=128&&(Ge-=256);else if(Te=="H")Ce=2,Oe=ce.slice(pe,pe+Ce),_e&&(Oe=Oe.split("").reverse().join("")),Ge=Oe.charCodeAt(0)*256+Oe.charCodeAt(1);else if(Te.toLowerCase()=="l")Ce=4,Oe=ce.slice(pe,pe+Ce),_e&&(Oe=Oe.split("").reverse().join("")),Ge=Oe.charCodeAt(0)*16777216+Oe.charCodeAt(1)*65536+Oe.charCodeAt(2)*256+Oe.charCodeAt(3),Te=="l"&&Ge>=2147483648&&(Ge-=4294967296);else throw new Error("'unpack' error. "+Te);we.push(Ge),pe+=Ce,xe+=1}return we}function Q(ae,ce){for(var le="",de=0;de<ce;de++)le+=ae;return le}function J(ae){if(ae.slice(0,2)!="Ã¿Ã˜")throw new Error("Given data isn't JPEG.");for(var ce=2,le=["Ã¿Ã˜"];;){if(ae.slice(ce,ce+2)=="Ã¿Ãš"){le.push(ae.slice(ce));break}else{var de=Z(">H",ae.slice(ce+2,ce+4))[0],_e=ce+de+2;le.push(ae.slice(ce,_e)),ce=_e}if(ce>=ae.length)throw new Error("Wrong JPEG data.")}return le}function re(ae){for(var ce,le=0;le<ae.length;le++)if(ce=ae[le],ce.slice(0,2)=="Ã¿Ã¡"&&ce.slice(4,10)=="Exif\0\0")return ce;return null}function se(ae,ce){var le=!1,de=[];return ae.forEach(function(_e,we){_e.slice(0,2)=="Ã¿Ã¡"&&_e.slice(4,10)=="Exif\0\0"&&(le?de.unshift(we):(ae[we]=ce,le=!0))}),de.forEach(function(_e){ae.splice(_e,1)}),!le&&ce&&(ae=[ae[0],ce].concat(ae.slice(1))),ae.join("")}var oe={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},ee={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};ee["0th"]=ee.Image,ee["1st"]=ee.Image,g.TAGS=ee,g.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},g.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},g.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},g.InteropIFD={InteroperabilityIndex:1},g.GPSHelper={degToDmsRational:function(ae){var ce=Math.abs(ae),le=ce%1*60,de=le%1*60,_e=Math.floor(ce),we=Math.floor(le),pe=Math.round(de*100);return[[_e,1],[we,1],[pe,100]]},dmsRationalToDeg:function(ae,ce){var le=ce==="S"||ce==="W"?-1:1,de=ae[0][0]/ae[0][1]+ae[1][0]/ae[1][1]/60+ae[2][0]/ae[2][1]/3600;return de*le}},d.exports&&(m=d.exports=g),m.piexif=g})()})(piexif$1,piexif$1.exports)),piexif$1.exports}var piexifExports=requirePiexif(),piexif=getDefaultExportFromCjs$1(piexifExports);const UNINITIALIZED=Symbol();var DEV=!1,is_array=Array.isArray,index_of=Array.prototype.indexOf,get_descriptor=Object.getOwnPropertyDescriptor,object_prototype=Object.prototype,array_prototype=Array.prototype,get_prototype_of=Object.getPrototypeOf;function run_all(d){for(var m=0;m<d.length;m++)d[m]()}function deferred(){var d,m,g=new Promise((w,$)=>{d=w,m=$});return{promise:g,resolve:d,reject:m}}const DERIVED=2,EFFECT=4,BLOCK_EFFECT=16,BRANCH_EFFECT=32,ROOT_EFFECT=64,BOUNDARY_EFFECT=128,CLEAN=1024,DIRTY$1=2048,MAYBE_DIRTY=4096,INERT=8192,DESTROYED=16384,EFFECT_RAN=32768,EAGER_EFFECT=1<<17,HEAD_EFFECT=1<<18,UNOWNED=256,DISCONNECTED=512,WAS_MARKED=32768,REACTION_IS_UPDATING=1<<21,ASYNC=1<<22,ERROR_VALUE=1<<23,STATE_SYMBOL=Symbol("$state"),STALE_REACTION=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function effect_update_depth_exceeded(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function state_descriptors_fixed(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function state_prototype_fixed(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function state_unsafe_mutation(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function equals(d){return d===this.v}let tracing_mode_flag=!1;function set_component_context(d){}function is_runes(){return!0}let micro_tasks=[];function run_micro_tasks(){var d=micro_tasks;micro_tasks=[],run_all(d)}function queue_micro_task(d){if(micro_tasks.length===0){var m=micro_tasks;queueMicrotask(()=>{m===micro_tasks&&run_micro_tasks()})}micro_tasks.push(d)}function handle_error(d){var m=active_effect;if(m===null)return active_reaction.f|=ERROR_VALUE,d;if((m.f&EFFECT_RAN)===0){if((m.f&BOUNDARY_EFFECT)===0)throw d;m.b.error(d)}else invoke_error_boundary(d,m)}function invoke_error_boundary(d,m){for(;m!==null;){if((m.f&BOUNDARY_EFFECT)!==0)try{m.b.error(d);return}catch(g){d=g}m=m.parent}throw d}const batches=new Set;let current_batch=null,batch_values=null,effect_pending_updates=new Set,queued_root_effects=[],last_scheduled_effect=null,is_flushing=!1;class Batch{committed=!1;current=new Map;previous=new Map;#r=new Set;#n=new Set;#e=0;#t=0;#a=null;#s=[];#o=[];skipped_effects=new Set;is_fork=!1;process(m){queued_root_effects=[],this.apply();var g={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const w of m)this.#l(w,g);this.is_fork||this.#u(),this.#t>0||this.is_fork?(this.#i(g.effects),this.#i(g.render_effects),this.#i(g.block_effects)):(current_batch=null,flush_queued_effects(g.render_effects),flush_queued_effects(g.effects)),batch_values=null}#l(m,g){m.f^=CLEAN;for(var w=m.first;w!==null;){var $=w.f,I=($&(BRANCH_EFFECT|ROOT_EFFECT))!==0,D=I&&($&CLEAN)!==0,q=D||($&INERT)!==0||this.skipped_effects.has(w);if((w.f&BOUNDARY_EFFECT)!==0&&w.b?.is_pending()&&(g={parent:g,effect:w,effects:[],render_effects:[],block_effects:[]}),!q&&w.fn!==null){I?w.f^=CLEAN:($&EFFECT)!==0?g.effects.push(w):is_dirty(w)&&((w.f&BLOCK_EFFECT)!==0&&g.block_effects.push(w),update_effect(w));var j=w.first;if(j!==null){w=j;continue}}var G=w.parent;for(w=w.next;w===null&&G!==null;)G===g.effect&&(this.#i(g.effects),this.#i(g.render_effects),this.#i(g.block_effects),g=g.parent),w=G.next,G=G.parent}}#i(m){for(const g of m)((g.f&DIRTY$1)!==0?this.#s:this.#o).push(g),set_signal_status(g,CLEAN)}capture(m,g){this.previous.has(m)||this.previous.set(m,g),this.current.set(m,m.v),batch_values?.set(m,m.v)}activate(){current_batch=this}deactivate(){current_batch=null,batch_values=null}flush(){if(this.activate(),queued_root_effects.length>0){if(flush_effects(),current_batch!==null&&current_batch!==this)return}else this.#e===0&&this.process([]);this.deactivate();for(const m of effect_pending_updates)if(effect_pending_updates.delete(m),m(),current_batch!==null)break}discard(){for(const m of this.#n)m(this);this.#n.clear()}#u(){if(this.#t===0){for(const m of this.#r)m();this.#r.clear()}this.#e===0&&this.#c()}#c(){if(batches.size>1){this.previous.clear();var m=batch_values,g=!0,w={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const $ of batches){if($===this){g=!1;continue}const I=[];for(const[q,j]of this.current){if($.current.has(q))if(g&&j!==$.current.get(q))$.current.set(q,j);else continue;I.push(q)}if(I.length===0)continue;const D=[...$.current.keys()].filter(q=>!this.current.has(q));if(D.length>0){const q=new Set,j=new Map;for(const G of I)mark_effects(G,D,q,j);if(queued_root_effects.length>0){current_batch=$,$.apply();for(const G of queued_root_effects)$.#l(G,w);queued_root_effects=[],$.deactivate()}}}current_batch=null,batch_values=m}this.committed=!0,batches.delete(this),this.#a?.resolve()}increment(m){this.#e+=1,m&&(this.#t+=1)}decrement(m){this.#e-=1,m&&(this.#t-=1),this.revive()}revive(){for(const m of this.#s)set_signal_status(m,DIRTY$1),schedule_effect(m);for(const m of this.#o)set_signal_status(m,MAYBE_DIRTY),schedule_effect(m);this.#s=[],this.#o=[],this.flush()}oncommit(m){this.#r.add(m)}ondiscard(m){this.#n.add(m)}settled(){return(this.#a??=deferred()).promise}static ensure(){if(current_batch===null){const m=current_batch=new Batch;batches.add(current_batch),Batch.enqueue(()=>{current_batch===m&&m.flush()})}return current_batch}static enqueue(m){queue_micro_task(m)}apply(){}}function flush_effects(){var d=is_updating_effect;is_flushing=!0;try{var m=0;for(set_is_updating_effect(!0);queued_root_effects.length>0;){var g=Batch.ensure();if(m++>1e3){var w,$;infinite_loop_guard()}g.process(queued_root_effects),old_values.clear()}}finally{is_flushing=!1,set_is_updating_effect(d),last_scheduled_effect=null}}function infinite_loop_guard(){try{effect_update_depth_exceeded()}catch(d){invoke_error_boundary(d,last_scheduled_effect)}}let eager_block_effects=null;function flush_queued_effects(d){var m=d.length;if(m!==0){for(var g=0;g<m;){var w=d[g++];if((w.f&(DESTROYED|INERT))===0&&is_dirty(w)&&(eager_block_effects=new Set,update_effect(w),w.deps===null&&w.first===null&&w.nodes_start===null&&(w.teardown===null&&w.ac===null?unlink_effect(w):w.fn=null),eager_block_effects?.size>0)){old_values.clear();for(const $ of eager_block_effects){if(($.f&(DESTROYED|INERT))!==0)continue;const I=[$];let D=$.parent;for(;D!==null;)eager_block_effects.has(D)&&(eager_block_effects.delete(D),I.push(D)),D=D.parent;for(let q=I.length-1;q>=0;q--){const j=I[q];(j.f&(DESTROYED|INERT))===0&&update_effect(j)}}eager_block_effects.clear()}}eager_block_effects=null}}function mark_effects(d,m,g,w){if(!g.has(d)&&(g.add(d),d.reactions!==null))for(const $ of d.reactions){const I=$.f;(I&DERIVED)!==0?mark_effects($,m,g,w):(I&(ASYNC|BLOCK_EFFECT))!==0&&(I&DIRTY$1)===0&&depends_on($,m,w)&&(set_signal_status($,DIRTY$1),schedule_effect($))}}function depends_on(d,m,g){const w=g.get(d);if(w!==void 0)return w;if(d.deps!==null)for(const $ of d.deps){if(m.includes($))return!0;if(($.f&DERIVED)!==0&&depends_on($,m,g))return g.set($,!0),!0}return g.set(d,!1),!1}function schedule_effect(d){for(var m=last_scheduled_effect=d;m.parent!==null;){m=m.parent;var g=m.f;if(is_flushing&&m===active_effect&&(g&BLOCK_EFFECT)!==0)return;if((g&(ROOT_EFFECT|BRANCH_EFFECT))!==0){if((g&CLEAN)===0)return;m.f^=CLEAN}}queued_root_effects.push(m)}function destroy_derived_effects(d){var m=d.effects;if(m!==null){d.effects=null;for(var g=0;g<m.length;g+=1)destroy_effect(m[g])}}function get_derived_parent_effect(d){for(var m=d.parent;m!==null;){if((m.f&DERIVED)===0)return m;m=m.parent}return null}function execute_derived(d){var m,g=active_effect;set_active_effect(get_derived_parent_effect(d));try{d.f&=~WAS_MARKED,destroy_derived_effects(d),m=update_reaction(d)}finally{set_active_effect(g)}return m}function update_derived(d){var m=execute_derived(d);if(d.equals(m)||(d.v=m,d.wv=increment_write_version()),!is_destroying_effect)if(batch_values!==null)batch_values.set(d,d.v);else{var g=(skip_reaction||(d.f&UNOWNED)!==0)&&d.deps!==null?MAYBE_DIRTY:CLEAN;set_signal_status(d,g)}}let eager_effects=new Set;const old_values=new Map;let eager_effects_deferred=!1;function source(d,m){var g={f:0,v:d,reactions:null,equals,rv:0,wv:0};return g}function state(d,m){const g=source(d);return push_reaction_value(g),g}function set$1(d,m,g=!1){active_reaction!==null&&(!untracking||(active_reaction.f&EAGER_EFFECT)!==0)&&is_runes()&&(active_reaction.f&(DERIVED|BLOCK_EFFECT|ASYNC|EAGER_EFFECT))!==0&&!current_sources?.includes(d)&&state_unsafe_mutation();let w=g?proxy(m):m;return internal_set(d,w)}function internal_set(d,m){if(!d.equals(m)){var g=d.v;is_destroying_effect?old_values.set(d,m):old_values.set(d,g),d.v=m;var w=Batch.ensure();w.capture(d,g),(d.f&DERIVED)!==0&&((d.f&DIRTY$1)!==0&&execute_derived(d),set_signal_status(d,(d.f&UNOWNED)===0?CLEAN:MAYBE_DIRTY)),d.wv=increment_write_version(),mark_reactions(d,DIRTY$1),active_effect!==null&&(active_effect.f&CLEAN)!==0&&(active_effect.f&(BRANCH_EFFECT|ROOT_EFFECT))===0&&(untracked_writes===null?set_untracked_writes([d]):untracked_writes.push(d)),!w.is_fork&&eager_effects.size>0&&!eager_effects_deferred&&flush_eager_effects()}return m}function flush_eager_effects(){eager_effects_deferred=!1;const d=Array.from(eager_effects);for(const m of d)(m.f&CLEAN)!==0&&set_signal_status(m,MAYBE_DIRTY),is_dirty(m)&&update_effect(m);eager_effects.clear()}function increment(d){set$1(d,d.v+1)}function mark_reactions(d,m){var g=d.reactions;if(g!==null)for(var w=g.length,$=0;$<w;$++){var I=g[$],D=I.f,q=(D&DIRTY$1)===0;q&&set_signal_status(I,m),(D&DERIVED)!==0?(D&WAS_MARKED)===0&&(I.f|=WAS_MARKED,mark_reactions(I,MAYBE_DIRTY)):q&&((D&BLOCK_EFFECT)!==0&&eager_block_effects!==null&&eager_block_effects.add(I),schedule_effect(I))}}function proxy(d){if(typeof d!="object"||d===null||STATE_SYMBOL in d)return d;const m=get_prototype_of(d);if(m!==object_prototype&&m!==array_prototype)return d;var g=new Map,w=is_array(d),$=state(0),I=update_version,D=q=>{if(update_version===I)return q();var j=active_reaction,G=update_version;set_active_reaction(null),set_update_version(I);var H=q();return set_active_reaction(j),set_update_version(G),H};return w&&g.set("length",state(d.length)),new Proxy(d,{defineProperty(q,j,G){(!("value"in G)||G.configurable===!1||G.enumerable===!1||G.writable===!1)&&state_descriptors_fixed();var H=g.get(j);return H===void 0?H=D(()=>{var W=state(G.value);return g.set(j,W),W}):set$1(H,G.value,!0),!0},deleteProperty(q,j){var G=g.get(j);if(G===void 0){if(j in q){const H=D(()=>state(UNINITIALIZED));g.set(j,H),increment($)}}else set$1(G,UNINITIALIZED),increment($);return!0},get(q,j,G){if(j===STATE_SYMBOL)return d;var H=g.get(j),W=j in q;if(H===void 0&&(!W||get_descriptor(q,j)?.writable)&&(H=D(()=>{var K=proxy(W?q[j]:UNINITIALIZED),Z=state(K);return Z}),g.set(j,H)),H!==void 0){var V=get$1(H);return V===UNINITIALIZED?void 0:V}return Reflect.get(q,j,G)},getOwnPropertyDescriptor(q,j){var G=Reflect.getOwnPropertyDescriptor(q,j);if(G&&"value"in G){var H=g.get(j);H&&(G.value=get$1(H))}else if(G===void 0){var W=g.get(j),V=W?.v;if(W!==void 0&&V!==UNINITIALIZED)return{enumerable:!0,configurable:!0,value:V,writable:!0}}return G},has(q,j){if(j===STATE_SYMBOL)return!0;var G=g.get(j),H=G!==void 0&&G.v!==UNINITIALIZED||Reflect.has(q,j);if(G!==void 0||active_effect!==null&&(!H||get_descriptor(q,j)?.writable)){G===void 0&&(G=D(()=>{var V=H?proxy(q[j]):UNINITIALIZED,K=state(V);return K}),g.set(j,G));var W=get$1(G);if(W===UNINITIALIZED)return!1}return H},set(q,j,G,H){var W=g.get(j),V=j in q;if(w&&j==="length")for(var K=G;K<W.v;K+=1){var Z=g.get(K+"");Z!==void 0?set$1(Z,UNINITIALIZED):K in q&&(Z=D(()=>state(UNINITIALIZED)),g.set(K+"",Z))}if(W===void 0)(!V||get_descriptor(q,j)?.writable)&&(W=D(()=>state(void 0)),set$1(W,proxy(G)),g.set(j,W));else{V=W.v!==UNINITIALIZED;var Q=D(()=>proxy(G));set$1(W,Q)}var J=Reflect.getOwnPropertyDescriptor(q,j);if(J?.set&&J.set.call(H,G),!V){if(w&&typeof j=="string"){var re=g.get("length"),se=Number(j);Number.isInteger(se)&&se>=re.v&&set$1(re,se+1)}increment($)}return!0},ownKeys(q){get$1($);var j=Reflect.ownKeys(q).filter(W=>{var V=g.get(W);return V===void 0||V.v!==UNINITIALIZED});for(var[G,H]of g)H.v!==UNINITIALIZED&&!(G in q)&&j.push(G);return j},setPrototypeOf(){state_prototype_fixed()}})}var next_sibling_getter;function get_next_sibling(d){return next_sibling_getter.call(d)}function without_reactive_context(d){var m=active_reaction,g=active_effect;set_active_reaction(null),set_active_effect(null);try{return d()}finally{set_active_reaction(m),set_active_effect(g)}}function execute_effect_teardown(d){var m=d.teardown;if(m!==null){const g=is_destroying_effect,w=active_reaction;set_is_destroying_effect(!0),set_active_reaction(null);try{m.call(null)}finally{set_is_destroying_effect(g),set_active_reaction(w)}}}function destroy_effect_children(d,m=!1){var g=d.first;for(d.first=d.last=null;g!==null;){const $=g.ac;$!==null&&without_reactive_context(()=>{$.abort(STALE_REACTION)});var w=g.next;(g.f&ROOT_EFFECT)!==0?g.parent=null:destroy_effect(g,m),g=w}}function destroy_block_effect_children(d){for(var m=d.first;m!==null;){var g=m.next;(m.f&BRANCH_EFFECT)===0&&destroy_effect(m),m=g}}function destroy_effect(d,m=!0){var g=!1;(m||(d.f&HEAD_EFFECT)!==0)&&d.nodes_start!==null&&d.nodes_end!==null&&(remove_effect_dom(d.nodes_start,d.nodes_end),g=!0),destroy_effect_children(d,m&&!g),remove_reactions(d,0),set_signal_status(d,DESTROYED);var w=d.transitions;if(w!==null)for(const I of w)I.stop();execute_effect_teardown(d);var $=d.parent;$!==null&&$.first!==null&&unlink_effect(d),d.next=d.prev=d.teardown=d.ctx=d.deps=d.fn=d.nodes_start=d.nodes_end=d.ac=null}function remove_effect_dom(d,m){for(;d!==null;){var g=d===m?null:get_next_sibling(d);d.remove(),d=g}}function unlink_effect(d){var m=d.parent,g=d.prev,w=d.next;g!==null&&(g.next=w),w!==null&&(w.prev=g),m!==null&&(m.first===d&&(m.first=w),m.last===d&&(m.last=g))}let is_updating_effect=!1;function set_is_updating_effect(d){is_updating_effect=d}let is_destroying_effect=!1;function set_is_destroying_effect(d){is_destroying_effect=d}let active_reaction=null,untracking=!1;function set_active_reaction(d){active_reaction=d}let active_effect=null;function set_active_effect(d){active_effect=d}let current_sources=null;function push_reaction_value(d){active_reaction!==null&&(current_sources===null?current_sources=[d]:current_sources.push(d))}let new_deps=null,skipped_deps=0,untracked_writes=null;function set_untracked_writes(d){untracked_writes=d}let write_version=1,read_version=0,update_version=read_version;function set_update_version(d){update_version=d}let skip_reaction=!1;function increment_write_version(){return++write_version}function is_dirty(d){var m=d.f;if((m&DIRTY$1)!==0)return!0;if((m&MAYBE_DIRTY)!==0){var g=d.deps,w=(m&UNOWNED)!==0;if(m&DERIVED&&(d.f&=~WAS_MARKED),g!==null){var $,I,D=(m&DISCONNECTED)!==0,q=w&&active_effect!==null&&!skip_reaction,j=g.length;if((D||q)&&(active_effect===null||(active_effect.f&DESTROYED)===0)){var G=d,H=G.parent;for($=0;$<j;$++)I=g[$],(D||!I?.reactions?.includes(G))&&(I.reactions??=[]).push(G);D&&(G.f^=DISCONNECTED),q&&H!==null&&(H.f&UNOWNED)===0&&(G.f^=UNOWNED)}for($=0;$<j;$++)if(I=g[$],is_dirty(I)&&update_derived(I),I.wv>d.wv)return!0}(!w||active_effect!==null&&!skip_reaction)&&set_signal_status(d,CLEAN)}return!1}function schedule_possible_effect_self_invalidation(d,m,g=!0){var w=d.reactions;if(w!==null&&!current_sources?.includes(d))for(var $=0;$<w.length;$++){var I=w[$];(I.f&DERIVED)!==0?schedule_possible_effect_self_invalidation(I,m,!1):m===I&&(g?set_signal_status(I,DIRTY$1):(I.f&CLEAN)!==0&&set_signal_status(I,MAYBE_DIRTY),schedule_effect(I))}}function update_reaction(d){var m=new_deps,g=skipped_deps,w=untracked_writes,$=active_reaction,I=skip_reaction,D=current_sources,q=untracking,j=update_version,G=d.f;new_deps=null,skipped_deps=0,untracked_writes=null,skip_reaction=(G&UNOWNED)!==0&&(untracking||!is_updating_effect||active_reaction===null),active_reaction=(G&(BRANCH_EFFECT|ROOT_EFFECT))===0?d:null,current_sources=null,d.ctx,untracking=!1,update_version=++read_version,d.ac!==null&&(without_reactive_context(()=>{d.ac.abort(STALE_REACTION)}),d.ac=null);try{d.f|=REACTION_IS_UPDATING;var H=d.fn,W=H(),V=d.deps;if(new_deps!==null){var K;if(remove_reactions(d,skipped_deps),V!==null&&skipped_deps>0)for(V.length=skipped_deps+new_deps.length,K=0;K<new_deps.length;K++)V[skipped_deps+K]=new_deps[K];else d.deps=V=new_deps;if(!skip_reaction||(G&DERIVED)!==0&&d.reactions!==null)for(K=skipped_deps;K<V.length;K++)(V[K].reactions??=[]).push(d)}else V!==null&&skipped_deps<V.length&&(remove_reactions(d,skipped_deps),V.length=skipped_deps);if(is_runes()&&untracked_writes!==null&&!untracking&&V!==null&&(d.f&(DERIVED|MAYBE_DIRTY|DIRTY$1))===0)for(K=0;K<untracked_writes.length;K++)schedule_possible_effect_self_invalidation(untracked_writes[K],d);return $!==null&&$!==d&&(read_version++,untracked_writes!==null&&(w===null?w=untracked_writes:w.push(...untracked_writes))),(d.f&ERROR_VALUE)!==0&&(d.f^=ERROR_VALUE),W}catch(Z){return handle_error(Z)}finally{d.f^=REACTION_IS_UPDATING,new_deps=m,skipped_deps=g,untracked_writes=w,active_reaction=$,skip_reaction=I,current_sources=D,untracking=q,update_version=j}}function remove_reaction(d,m){let g=m.reactions;if(g!==null){var w=index_of.call(g,d);if(w!==-1){var $=g.length-1;$===0?g=m.reactions=null:(g[w]=g[$],g.pop())}}g===null&&(m.f&DERIVED)!==0&&(new_deps===null||!new_deps.includes(m))&&(set_signal_status(m,MAYBE_DIRTY),(m.f&(UNOWNED|DISCONNECTED))===0&&(m.f^=DISCONNECTED),destroy_derived_effects(m),remove_reactions(m,0))}function remove_reactions(d,m){var g=d.deps;if(g!==null)for(var w=m;w<g.length;w++)remove_reaction(d,g[w])}function update_effect(d){var m=d.f;if((m&DESTROYED)===0){set_signal_status(d,CLEAN);var g=active_effect,w=is_updating_effect;active_effect=d,is_updating_effect=!0;try{(m&BLOCK_EFFECT)!==0?destroy_block_effect_children(d):destroy_effect_children(d),execute_effect_teardown(d);var $=update_reaction(d);d.teardown=typeof $=="function"?$:null,d.wv=write_version;var I;DEV&&tracing_mode_flag&&(d.f&DIRTY$1)!==0&&d.deps}finally{is_updating_effect=w,active_effect=g}}}function get$1(d){var m=d.f,g=(m&DERIVED)!==0;if(active_reaction!==null&&!untracking){var w=active_effect!==null&&(active_effect.f&DESTROYED)!==0;if(!w&&!current_sources?.includes(d)){var $=active_reaction.deps;if((active_reaction.f&REACTION_IS_UPDATING)!==0)d.rv<read_version&&(d.rv=read_version,new_deps===null&&$!==null&&$[skipped_deps]===d?skipped_deps++:new_deps===null?new_deps=[d]:(!skip_reaction||!new_deps.includes(d))&&new_deps.push(d));else{(active_reaction.deps??=[]).push(d);var I=d.reactions;I===null?d.reactions=[active_reaction]:I.includes(active_reaction)||I.push(active_reaction)}}}else if(g&&d.deps===null&&d.effects===null){var D=d,q=D.parent;q!==null&&(q.f&UNOWNED)===0&&(D.f^=UNOWNED)}if(is_destroying_effect){if(old_values.has(d))return old_values.get(d);if(g){D=d;var j=D.v;return((D.f&CLEAN)===0&&D.reactions!==null||depends_on_old_values(D))&&(j=execute_derived(D)),old_values.set(D,j),j}}else if(g){if(D=d,batch_values?.has(D))return batch_values.get(D);is_dirty(D)&&update_derived(D)}if(batch_values?.has(d))return batch_values.get(d);if((d.f&ERROR_VALUE)!==0)throw d.v;return d.v}function depends_on_old_values(d){if(d.v===UNINITIALIZED)return!0;if(d.deps===null)return!1;for(const m of d.deps)if(old_values.has(m)||(m.f&DERIVED)!==0&&depends_on_old_values(m))return!0;return!1}const STATUS_MASK=-7169;function set_signal_status(d,m){d.f=d.f&STATUS_MASK|m}class DevalueError extends Error{constructor(m,g){super(m),this.name="DevalueError",this.path=g.join("")}}function is_primitive(d){return Object(d)!==d}const object_proto_names=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function is_plain_object(d){const m=Object.getPrototypeOf(d);return m===Object.prototype||m===null||Object.getPrototypeOf(m)===null||Object.getOwnPropertyNames(m).sort().join("\0")===object_proto_names}function get_type(d){return Object.prototype.toString.call(d).slice(8,-1)}function get_escaped_char(d){switch(d){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return d<" "?`\\u${d.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function stringify_string(d){let m="",g=0;const w=d.length;for(let $=0;$<w;$+=1){const I=d[$],D=get_escaped_char(I);D&&(m+=d.slice(g,$)+D,g=$+1)}return`"${g===0?d:m+d.slice(g)}"`}function enumerable_symbols(d){return Object.getOwnPropertySymbols(d).filter(m=>Object.getOwnPropertyDescriptor(d,m).enumerable)}const is_identifier=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;function stringify_key(d){return is_identifier.test(d)?"."+d:"["+JSON.stringify(d)+"]"}function encode64(d){const m=new DataView(d);let g="";for(let w=0;w<d.byteLength;w++)g+=String.fromCharCode(m.getUint8(w));return binaryToAscii(g)}function decode64(d){const m=asciiToBinary(d),g=new ArrayBuffer(m.length),w=new DataView(g);for(let $=0;$<g.byteLength;$++)w.setUint8($,m.charCodeAt($));return g}const KEY_STRING="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function asciiToBinary(d){d.length%4===0&&(d=d.replace(/==?$/,""));let m="",g=0,w=0;for(let $=0;$<d.length;$++)g<<=6,g|=KEY_STRING.indexOf(d[$]),w+=6,w===24&&(m+=String.fromCharCode((g&16711680)>>16),m+=String.fromCharCode((g&65280)>>8),m+=String.fromCharCode(g&255),g=w=0);return w===12?(g>>=4,m+=String.fromCharCode(g)):w===18&&(g>>=2,m+=String.fromCharCode((g&65280)>>8),m+=String.fromCharCode(g&255)),m}function binaryToAscii(d){let m="";for(let g=0;g<d.length;g+=3){const w=[void 0,void 0,void 0,void 0];w[0]=d.charCodeAt(g)>>2,w[1]=(d.charCodeAt(g)&3)<<4,d.length>g+1&&(w[1]|=d.charCodeAt(g+1)>>4,w[2]=(d.charCodeAt(g+1)&15)<<2),d.length>g+2&&(w[2]|=d.charCodeAt(g+2)>>6,w[3]=d.charCodeAt(g+2)&63);for(let $=0;$<w.length;$++)typeof w[$]>"u"?m+="=":m+=KEY_STRING[w[$]]}return m}const UNDEFINED=-1,HOLE=-2,NAN=-3,POSITIVE_INFINITY=-4,NEGATIVE_INFINITY=-5,NEGATIVE_ZERO=-6;function parse(d,m){return unflatten(JSON.parse(d),m)}function unflatten(d,m){if(typeof d=="number")return $(d,!0);if(!Array.isArray(d)||d.length===0)throw new Error("Invalid input");const g=d,w=Array(g.length);function $(I,D=!1){if(I===UNDEFINED)return;if(I===NAN)return NaN;if(I===POSITIVE_INFINITY)return 1/0;if(I===NEGATIVE_INFINITY)return-1/0;if(I===NEGATIVE_ZERO)return-0;if(D||typeof I!="number")throw new Error("Invalid input");if(I in w)return w[I];const q=g[I];if(!q||typeof q!="object")w[I]=q;else if(Array.isArray(q))if(typeof q[0]=="string"){const j=q[0],G=m?.[j];if(G){let H=q[1];return typeof H!="number"&&(H=g.push(q[1])-1),w[I]=G($(H))}switch(j){case"Date":w[I]=new Date(q[1]);break;case"Set":const H=new Set;w[I]=H;for(let K=1;K<q.length;K+=1)H.add($(q[K]));break;case"Map":const W=new Map;w[I]=W;for(let K=1;K<q.length;K+=2)W.set($(q[K]),$(q[K+1]));break;case"RegExp":w[I]=new RegExp(q[1],q[2]);break;case"Object":w[I]=Object(q[1]);break;case"BigInt":w[I]=BigInt(q[1]);break;case"null":const V=Object.create(null);w[I]=V;for(let K=1;K<q.length;K+=2)V[q[K]]=$(q[K+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const K=globalThis[j],Z=new K($(q[1]));w[I]=q[2]!==void 0?Z.subarray(q[2],q[3]):Z;break}case"ArrayBuffer":{const K=q[1],Z=decode64(K);w[I]=Z;break}case"Temporal.Duration":case"Temporal.Instant":case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.PlainMonthDay":case"Temporal.PlainYearMonth":case"Temporal.ZonedDateTime":{const K=j.slice(9);w[I]=Temporal[K].from(q[1]);break}case"URL":{const K=new URL(q[1]);w[I]=K;break}case"URLSearchParams":{const K=new URLSearchParams(q[1]);w[I]=K;break}default:throw new Error(`Unknown type ${j}`)}}else{const j=new Array(q.length);w[I]=j;for(let G=0;G<q.length;G+=1){const H=q[G];H!==HOLE&&(j[G]=$(H))}}else{const j={};w[I]=j;for(const G in q){if(G==="__proto__")throw new Error("Cannot parse an object with a `__proto__` property");const H=q[G];j[G]=$(H)}}return w[I]}return $(0)}function stringify(d,m){const g=[],w=new Map,$=[];if(m)for(const G of Object.getOwnPropertyNames(m))$.push({key:G,fn:m[G]});const I=[];let D=0;function q(G){if(typeof G=="function")throw new DevalueError("Cannot stringify a function",I);if(G===void 0)return UNDEFINED;if(Number.isNaN(G))return NAN;if(G===1/0)return POSITIVE_INFINITY;if(G===-1/0)return NEGATIVE_INFINITY;if(G===0&&1/G<0)return NEGATIVE_ZERO;if(w.has(G))return w.get(G);const H=D++;w.set(G,H);for(const{key:V,fn:K}of $){const Z=K(G);if(Z)return g[H]=`["${V}",${q(Z)}]`,H}let W="";if(is_primitive(G))W=stringify_primitive(G);else{const V=get_type(G);switch(V){case"Number":case"String":case"Boolean":W=`["Object",${stringify_primitive(G)}]`;break;case"BigInt":W=`["BigInt",${G}]`;break;case"Date":W=`["Date","${!isNaN(G.getDate())?G.toISOString():""}"]`;break;case"URL":W=`["URL",${stringify_string(G.toString())}]`;break;case"URLSearchParams":W=`["URLSearchParams",${stringify_string(G.toString())}]`;break;case"RegExp":const{source:Z,flags:Q}=G;W=Q?`["RegExp",${stringify_string(Z)},"${Q}"]`:`["RegExp",${stringify_string(Z)}]`;break;case"Array":W="[";for(let J=0;J<G.length;J+=1)J>0&&(W+=","),J in G?(I.push(`[${J}]`),W+=q(G[J]),I.pop()):W+=HOLE;W+="]";break;case"Set":W='["Set"';for(const J of G)W+=`,${q(J)}`;W+="]";break;case"Map":W='["Map"';for(const[J,re]of G)I.push(`.get(${is_primitive(J)?stringify_primitive(J):"..."})`),W+=`,${q(J)},${q(re)}`,I.pop();W+="]";break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const J=G;W='["'+V+'",'+q(J.buffer);const re=G.byteOffset,se=re+G.byteLength;if(re>0||se!==J.buffer.byteLength){const oe=+/(\d+)/.exec(V)[1]/8;W+=`,${re/oe},${se/oe}`}W+="]";break}case"ArrayBuffer":{W=`["ArrayBuffer","${encode64(G)}"]`;break}case"Temporal.Duration":case"Temporal.Instant":case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.PlainMonthDay":case"Temporal.PlainYearMonth":case"Temporal.ZonedDateTime":W=`["${V}",${stringify_string(G.toString())}]`;break;default:if(!is_plain_object(G))throw new DevalueError("Cannot stringify arbitrary non-POJOs",I);if(enumerable_symbols(G).length>0)throw new DevalueError("Cannot stringify POJOs with symbolic keys",I);if(Object.getPrototypeOf(G)===null){W='["null"';for(const J in G)I.push(stringify_key(J)),W+=`,${stringify_string(J)},${q(G[J])}`,I.pop();W+="]"}else{W="{";let J=!1;for(const re in G)J&&(W+=","),J=!0,I.push(stringify_key(re)),W+=`${stringify_string(re)}:${q(G[re])}`,I.pop();W+="}"}}}return g[H]=W,H}const j=q(d);return j<0?`${j}`:`[${g.join(",")}]`}function stringify_primitive(d){const m=typeof d;return m==="string"?stringify_string(d):d instanceof String?stringify_string(d.toString()):d===void 0?UNDEFINED.toString():d===0&&1/d<0?NEGATIVE_ZERO.toString():m==="bigint"?`["BigInt","${d}"]`:String(d)}const urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let nanoid=(d=21)=>{let m="",g=crypto.getRandomValues(new Uint8Array(d|=0));for(;d--;)m+=urlAlphabet[g[d]&63];return m};const previewingPrNumber=null,databaseName="database",databaseRevision=3,tableNames=Object.keys(Tables),_tablesState=proxy({Image:[],Metadata:[],Observation:[],Protocol:[],Settings:[]}),tables={...Object.fromEntries(tableNames.filter(isReactiveTable).map(d=>[d,wrangler(d)])),async initialize(){for(const d of tableNames)isReactiveTable(d)&&await tables[d].refresh()}};function wrangler(d){return{get state(){return _tablesState[d]},async refresh(){console.info(`refresh ${d}`),_tablesState[d]=await this.list()},get:async m=>get(d,m),getFromState:m=>_tablesState[d].find(g=>g.id===m),async set(m){await set(d,m);const g=Tables[d].assert(m),w=_tablesState[d].findIndex($=>$.id===m.id);return w!==-1?_tablesState[d][w]=g:(_tablesState[d].push(g),_tablesState[d].sort(idComparator)),g},async update(m,g,w){const $=`upd ${d} ${m} ${typeof g=="string"?g:"<Symbol>"} = ${w}`,I=await this.raw.get(m);if(!I)return console.error(`${$}: item not found`),!1;I[g]=w,await set(d,I);const D=_tablesState[d].findIndex(q=>q.id===m);return D===-1?(console.debug(`${$}: item not found in reactive state, refetching entire list`),_tablesState[d]=await this.list()):(console.debug(`${$}: updating state @ ${d}[${D}]`),_tablesState[d][D]=Tables[d].assert(I)),!0},async add(m){return this.set({...m,id:generateId(d)})},async clear(){await clear(d),_tablesState[d]=[]},async remove(m){await drop(d,m);const g=_tablesState[d].findIndex(w=>w.id===m);g!==-1?(console.warn(`del ${d} ${m}: not found in reactive state, re-fetching`),_tablesState[d]=await this.list()):delete _tablesState[d][g]},async do(m){const g=`do ${d} #${nanoid()}`;console.debug(g),await openTransaction([d],{},async w=>{await m(w.objectStore(d))})},list:async()=>list(d),all:()=>iterator(d),count:async()=>await(await openDatabase()).count(d),raw:{async set(m){return await(await openDatabase()).put(d,m)},async get(m){return await(await openDatabase()).get(d,m)}}}}async function set(d,m){const g=await openDatabase();return Tables[d].assert(m),await g.put(d,m).then($=>$)}async function clear(d){await(await openDatabase()).clear(d).then(g=>g)}async function get(d,m){const g=await openDatabase(),w=Tables[d];return await g.get(d,m).then($=>$?w.assert($):void 0)}async function list(d,m=void 0){const g=await openDatabase(),w=Tables[d];return await g.getAll(d,m).then($=>$.map(I=>w.assert(I)).sort(idComparator)).then($=>$)}async function drop(d,m){return await(await openDatabase()).delete(d,m).then(()=>list(d)).then(w=>{console.debug(`delete ${d} ${m}: objects are now ${w.map($=>$.id).join(", ")}`)})}async function*iterator(d,m=void 0){const g=await openDatabase(),w=Tables[d],$=g.transaction(d).store,I=m?$.index(m).iterate():$.iterate();for await(const D of I)yield w.assert(D.value)}function dependencyURI(d,m,...g){return["idb:/",d,m,...g].filter(Boolean).join("/")}async function openTransaction(d,{mode:m},g){m??="readwrite";const w=nanoid(8);console.debug(`txn open ${w} tables ${d} mode ${m}`);const I=(await openDatabase()).transaction(d,m);I.id=w,await g(I),console.debug(`txn commit ${w} `),await I.done;for(const D of d.filter(isReactiveTable))await tables[D].refresh()}function databaseHandle(){if(!_database)throw new Error("Database not initialized. Call openDatabase() first.");return _database}async function openDatabase(){if(_database)return _database;const d=Object.entries(Tables);return _database=await openDB(databaseName,databaseRevision,{upgrade(m,g){const w=($,I)=>{if(!I.meta.table)return;const D=I.meta.table.indexes[0],q=m.createObjectStore($,{keyPath:D});for(const j of I.meta.table.indexes.slice(1))q.createIndex(j,j)};if(g===1)for(const $ of m.objectStoreNames)m.deleteObjectStore($);if(g===2){w("ImagePreviewFile",Tables.ImagePreviewFile);return}for(const[$,I]of d)w($,I)}}),window.devalue={stringify,parse},window.DB=_database,window.refreshDB=()=>{for(const m of tableNames)isReactiveTable(m)&&tables[m].refresh()},_database}function nukeDatabase(){_database&&(_database.close(),_database=void 0),indexedDB.deleteDatabase(databaseName)}let _database;var idb_svelte=Object.freeze({__proto__:null,_tablesState,clear,databaseHandle,databaseName,databaseRevision,dependencyURI,drop,get,iterator,list,nukeDatabase,openDatabase,openTransaction,previewingPrNumber,set,tables});async function computeCascades({db:d,metadataId:m,confidence:g,value:w,alternatives:$}){return await Promise.all([{value:w,confidence:g},...$].map(async({confidence:I,value:D})=>{const q=await d.get("MetadataOption",metadataOptionId(m,D));if(!q?.cascade)return;const{cascade:j}=q;return{cascade:j,confidence:I}})).then(I=>{const D=groupBy(I.filter(nonnull).flatMap(({cascade:j,confidence:G})=>entries(j).map(([H,W])=>({optionId:metadataOptionId(H,W),confidence:G}))),j=>j.optionId,j=>j.confidence);return[...groupBy(D.entries(),([j])=>parseMetadataOptionId(j).metadataId,([j,G])=>({value:parseMetadataOptionId(j).key,confidence:sum(G)})).entries()].map(([j,G])=>{const[{value:H,confidence:W},...V]=G.toSorted(({confidence:K},{confidence:Z})=>Z-K);return{metadataId:j,value:H,confidence:W,alternatives:V}})})}async function refreshTables(...d){try{const m=await Promise.resolve().then(function(){return idb_svelte});await Promise.all(d.map(g=>m.tables[g].refresh()))}catch(m){console.warn(`Cannot refresh tables ${d}:`,m)}}function serializeMetadataValue(d){return JSON.stringify(d instanceof Date&&isValid$1(d)?format(d,"yyyy-MM-dd'T'HH:mm:ss"):d)}async function storeMetadataValue({db:d,subjectId:m,metadataId:g,type:w,value:$,confidence:I=1,alternatives:D=[],manuallyModified:q=!1,cascadedFrom:j=[],abortSignal:G}){if(!namespaceOfMetadataId(g))throw new Error(`Le metadataId ${g} n'est pas namespacÃ©`);G?.throwIfAborted();const H={value:serializeMetadataValue($),confidence:I,manuallyModified:q,alternatives:Object.fromEntries(D.map(J=>[serializeMetadataValue(J.value),J.confidence]))};H.alternatives=Object.fromEntries(Object.entries(H.alternatives).filter(([J])=>J!==H.value)),console.debug(`Store metadata ${g} = `,$,` in ${m}`,H);const W=await d.get("Metadata",g);if(!W)throw new Error(`MÃ©tadonnÃ©e inconnue avec l'ID ${g}`);if(w&&W.type!==w)throw new Error(`Type de mÃ©tadonnÃ©e incorrect: ${W.type} !== ${w}`);G?.throwIfAborted();const V=await d.get("Image",m),K=await d.get("Observation",m),Z=await d.getAll("Image").then(J=>J.filter(({fileId:re})=>re===m));if(G?.throwIfAborted(),V)V.metadata[g]=H,d.put("Image",V);else if(K)K.metadataOverrides[g]=H,d.put("Observation",K);else if(Z)for(const{id:J}of Z)await storeMetadataValue({db:d,subjectId:J,metadataId:g,value:$,confidence:I,manuallyModified:q,abortSignal:G});else throw new Error(`Aucune image ou observation avec l'ID ${m}`);G?.throwIfAborted();const Q=await computeCascades({db:d,metadataId:g,value:$,confidence:I,alternatives:D});for(const J of Q){if(G?.throwIfAborted(),j.includes(J.metadataId))throw new Error(`Boucle infinie de cascade dÃ©tectÃ©e pour ${J.metadataId} avec ${J.value}: ${j.join(" -> ")} -> ${g} -> ${J.metadataId}`);console.info(`Cascading metadata ${g} @ ${$} -> ${J.metadataId}  = ${J.value}`);const re=namespaceOfMetadataId(g);if(!re)throw new Error(`Metadata ${g} is not namespaced, cannot cascade onto ${J.metadataId}`);J.metadataId=ensureNamespacedMetadataId(J.metadataId,re),await storeMetadataValue({db:d,subjectId:m,manuallyModified:q,cascadedFrom:[...j,g],abortSignal:G,...J})}j.length===0&&await refreshTables(V?"Image":"Observation")}async function observationMetadata(d,m){const g=await d.getAll("Image").then($=>$.filter(I=>m.images.includes(I.id)));return{...await mergeMetadataValues(d,g.map($=>Schemas.MetadataValues.assert($.metadata))),...m.metadataOverrides}}async function addValueLabels(d,m){return Object.fromEntries(Object.entries(d).map(([g,w])=>{const $=m[g];return $?[g,{...w,valueLabel:$?.find(I=>I.key===w.value.toString())?.label}]:[g,w]}))}async function mergeMetadataValues(d,m){if(m.length===1)return mapValues(m[0],$=>({...$,merged:!1}));const g={},w=new Set(m.flatMap($=>Object.keys($)));for(const $ of w){const I=Schemas.Metadata.assert(await d.get("Metadata",$));if(!I){console.warn(`Cannot merge metadata values for unknown key ${$}`);continue}const D=m.flatMap(j=>Object.entries(j).filter(([G])=>G===$).map(([,G])=>G)),q=mergeMetadata(I,D);q!=null&&(g[$]={...q,merged:new Set(D.map(j=>JSON.stringify(j.value))).size>1})}return g}function mergeMetadata(d,m){const g=(w,$)=>Object.fromEntries($.flatMap(I=>Object.keys(I.alternatives)).map(I=>[I,w($.flatMap(D=>D.alternatives[I]??null).filter(Boolean))]));switch(d.mergeMethod){case"average":return{value:mergeAverage(d.type,m.map(w=>w.value)),manuallyModified:m.some(w=>w.manuallyModified),confidence:avg(m.map(w=>w.confidence)),alternatives:g(avg,m)};case"max":case"min":return{value:mergeByMajority(d.type,m,d.mergeMethod==="max"?max:min),manuallyModified:m.some(w=>w.manuallyModified),confidence:max(m.map(w=>w.confidence)),alternatives:g(max,m)};case"median":return{value:mergeMedian(d.type,m.map(w=>w.value)),manuallyModified:m.some(w=>w.manuallyModified),confidence:median(m.map(w=>w.confidence)),alternatives:g(median,m)};case"union":return{value:mergeByUnion(d.type,m.map(w=>w.value)),manuallyModified:m.some(w=>w.manuallyModified),confidence:avg(m.map(w=>w.confidence)),alternatives:g(avg,m)};case"none":return null}}const max=d=>Math.max(...d),min=d=>Math.min(...d);function mergeByMajority(d,m,g){const w=Math.max(...m.map(I=>I.confidence)),$=m.filter(I=>I.confidence===w);try{return g($.map(I=>I.value))}catch(I){return console.error(I),$[0].value}}function mergeAverage(d,m){const g=w=>avg(toNumber(d,w));if(d==="boolean")return g(m)>.5;if(d==="integer")return Math.ceil(g(m));if(d==="float")return g(m);if(d==="date")return new Date(g(m));if(d==="location")return{latitude:avg(m.map(w=>w.latitude)),longitude:avg(m.map(w=>w.longitude))};throw new Error(`Impossible de fusionner en mode moyenne des valeurs de type ${d}`)}const median=d=>{const m=d.sort((w,$)=>w-$),g=Math.floor(m.length/2);return m.length%2===0?(m[g-1]+m[g])/2:m[g]};function mergeMedian(d,m){const g=w=>median(toNumber(d,w));if(d==="boolean")return g(m)>.5;if(d==="integer")return Math.ceil(g(m));if(d==="float")return g(m);if(d==="date")return new Date(g(m));if(d==="location")return{latitude:median(m.map(w=>w.latitude)),longitude:median(m.map(w=>w.longitude))};throw new Error(`Impossible de fusionner en mode mÃ©diane des valeurs de type ${d}`)}function mergeByUnion(d,m){if(!areType("boundingbox",d,m))throw new Error(`Impossible de fusionner en mode union des valeurs de type ${d}`);const g=Math.min(...m.map(D=>D.x)),w=Math.min(...m.map(D=>D.y)),$=Math.max(...m.map(D=>D.x+D.w)),I=Math.max(...m.map(D=>D.y+D.h));return{x:g,y:w,w:$-g,h:I-w}}function toNumber(d,m){if(d==="integer"||d==="float")return m;if(d==="boolean")return m.map(g=>g?1:0);if(d==="date")return m.map(g=>new Date(g).getTime());throw new Error(`Impossible de convertir des valeurs de type ${d} en nombre`)}function metadataPrettyValue(d,m,g,w=void 0){if(g===null)return"";switch(m.type){case"boolean":switch(d){case"fr":return g?"Oui":"Non";default:return g?"Yes":"No"}case"date":return g instanceof Date?format(g,"Ppp"):g.toString();case"enum":return w||g.toString();case"location":{const{latitude:$,longitude:I}=type({latitude:"number",longitude:"number"}).assert(g);return`${$}, ${I}`}case"boundingbox":{const{x:$,y:I,w:D,h:q}=type({x:"number",y:"number",h:"number",w:"number"}).assert(g);switch(d){case"fr":return`BoÃ®te de (${$}, ${I}) Ã  (${$+D}, ${I+q})`;default:return`Box from (${$}, ${I}) to (${$+D}, ${I+q})`}}case"float":case"integer":return Intl.NumberFormat(d).format(type("number").assert(g));default:return g.toString()}}function metadataPrettyKey(d){let m=d.label;switch(d.type){case"location":m+=" (latitude, longitude)"}return m}function isType(d,m,g){const w=$=>m===d&&(g===void 0||!($(g)instanceof type.errors));switch(d){case"boolean":return w(type("boolean"));case"integer":case"float":return w(type("number"));case"enum":return w(type("string | number"));case"date":return w(type("Date"));case"location":return w(type({latitude:"number",longitude:"number"}));case"boundingbox":return w(type({x:"number",y:"number",w:"number",h:"number"}));case"string":return w(type("string"));default:throw new Error(`Type inconnu: ${d}`)}}function areType(d,m,g){return g.every(w=>isType(d,m,w))}const METADATA_ZERO_VALUE={value:null,manuallyModified:!1,confidence:0,alternatives:{}};function protocolMetadataValues(d,m){return fromEntries(d.metadata.filter(g=>isNamespacedToProtocol(d.id,g)).map(g=>[removeNamespaceFromMetadataId(g),m[g]??METADATA_ZERO_VALUE]))}function metadataOptionsKeyRange(d,m){if(m){const g=ensureNamespacedMetadataId(m,d);return IDBKeyRange.bound(g+":",g+":ï¿¿")}else return IDBKeyRange.bound(namespacedMetadataId("",d),namespacedMetadataId("ï¿¿",d))}const TOAST_POOLS={default:{lifetime:3e3,capacity:3},exporter:{lifetime:1/0,capacity:1/0},protocolcreator:{lifetime:1/0,capacity:1/0}};class Toasts{#r=state();get pools(){return get$1(this.#r)}set pools(m){set$1(this.#r,m,!0)}#n=state();get currentPoolName(){return get$1(this.#n)}set currentPoolName(m){set$1(this.#n,m,!0)}constructor(m,g){this.currentPoolName=g,this.pools=mapValues(m,w=>({items:[],...w}))}get pool(){return this.pools[this.currentPoolName]}setCurrentPool(m){this.#e(m),this.freeze(this.currentPoolName),this.currentPoolName=m,this.unfreeze(this.currentPoolName)}items(m=void 0){return m&&this.#e(m),this.pools[m??this.currentPoolName].items}#e(m){if(!this.pools[m])throw new Error(`Toast pool ${m} does not exist`)}add(m,g,w){if(!g)return;const{labels:$,data:I,closed:D,action:q,lifetime:j="inferred",...G}=w??{},H={closed:D,action:q};if(Object.values(H).some(Boolean)&&!I)throw new Error("You must provide data if you're using callbacks");const W=nanoid(),V={addedAt:new Date,id:W,message:g.replaceAll(`
`,"; "),type:m,labels:$??{},callbacks:H,data:I??null,lifetime:j==="inferred"?this.#a(g):j,...G};return Number.isFinite(V.lifetime)&&this.#t(V),this.pools[this.currentPoolName].items=[...this.items().slice(0,this.pool.capacity-1),V],W}withUndo(m,g,{undo:w,commit:$,...I}){if(!g)return;const D=this;return this.add(m,g,{lifetime:4*this.#a(g),data:[],...I,closed:$,action:q=>{w(),D.remove(q.id,D.currentPoolName,{silent:!0})},labels:{action:"Annuler"}})}info(m,g){return this.add("info",m,g)}warn(m,g){return this.add("warning",m,g)}error(m,g){return this.add("error",m?.toString()??"Erreur inattendue",{...g,lifetime:g?.lifetime??"inferred"})}success(m,g){return this.add("success",m,g)}async remove(m,g,{silent:w=!1}={}){for(const[$,{items:I}]of entries(this.pools)){if(g&&g!==$)continue;const D=I.find(q=>q.id===m);if(!D)return;w||await D.callbacks.closed?.(D),this.pools[$].items=this.items($).filter(q=>q.id!==m)}}async clear(m=this.currentPoolName){const g=this.items(m);await Promise.all(g.map(w=>w.callbacks?.closed?w.callbacks.closed(w):Promise.resolve())),this.pools[m].items=[]}freeze(m=this.currentPoolName){for(const g of this.items(m).filter(w=>w.timeoutHandle))clearTimeout(g.timeoutHandle)}unfreeze(m=this.currentPoolName){for(const g of this.items(m).filter(w=>w.timeoutHandle))this.#t(g)}#t(m){m.timeoutHandle=setTimeout(()=>{this.remove(m.id)},m.lifetime)}#a(m){const g=m.split(" ").length+m.split(" ").length;return this.pool.lifetime+minutesToMilliseconds(g/300)}}new Toasts(TOAST_POOLS,"default");function serializeExifValue(d){return d instanceof Date?format(d,"yyyy:MM:dd HH:mm:ss"):Array.isArray(d)?d:d===void 0?"undefined":d===null?"null":typeof d=="object"&&d!==null?Object.entries(d).map(([m,g])=>`${m}=${g}`).join(";"):d?.toString()??""}function addExifMetadata(d,m,g){const w=Schemas.Metadata.and({infer:[{exif:"string"},"|",{latitude:{exif:"string"},longitude:{exif:"string"}}]}),$={GPS:{},Exif:{}},I=(G,H)=>{const W=Object.keys(EXIF_GPS_FIELDS).includes(G)?"GPS":"Exif",V=serializeExifValue(H);V!==void 0&&($[W][piexif[`${W}IFD`][G]]=V)};for(const G of m.map(H=>w(H))){if(G instanceof type.errors)continue;const H=g[G.id]?.value;H!==void 0&&(type({latitude:{exif:"string"},longitude:{exif:"string"}}).allows(G.infer)&&type({latitude:"number",longitude:"number"}).allows(H)?(G.infer.latitude.exif==="GPSLatitude"?(I("GPSLatitudeRef",H.latitude>=0?"N":"S"),I("GPSLatitude",piexif.GPSHelper.degToDmsRational(H.latitude))):I(G.infer.latitude.exif,H.latitude),G.infer.longitude.exif==="GPSLongitude"?(I("GPSLongitudeRef",H.longitude>=0?"E":"W"),I("GPSLongitude",piexif.GPSHelper.degToDmsRational(H.longitude))):I(G.infer.longitude.exif,H.longitude)):I(G.infer.exif,H))}let D="",q=32e3;for(let G=0;G<d.byteLength;G+=q){const H=d.slice(G,G+q);D+=String.fromCharCode(...new Uint8Array(H))}const j=piexif.insert(piexif.dump($),D);return new Uint8Array(Array.from(j).map(G=>G.charCodeAt(0)))}/*!
 * ONNX Runtime Web v1.22.0
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var zn=Object.defineProperty,Vp=Object.getOwnPropertyDescriptor,Wp=Object.getOwnPropertyNames,Lp=Object.prototype.hasOwnProperty,Dn=(d=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(d,{get:(m,g)=>(typeof require<"u"?require:m)[g]}):d)(function(d){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+d+'" is not supported')}),U=(d,m)=>()=>(d&&(m=d(d=0)),m),Rt=(d,m)=>{for(var g in m)zn(d,g,{get:m[g],enumerable:!0})},Gp=(d,m,g,w)=>{if(m&&typeof m=="object"||typeof m=="function")for(let $ of Wp(m))!Lp.call(d,$)&&$!==g&&zn(d,$,{get:()=>m[$],enumerable:!(w=Vp(m,$))||w.enumerable});return d},qt=d=>Gp(zn({},"__esModule",{value:!0}),d),hr,St,Tt,Hp,Fi,Bn=U(()=>{hr=new Map,St=[],Tt=(d,m,g)=>{if(m&&typeof m.init=="function"&&typeof m.createInferenceSessionHandler=="function"){let w=hr.get(d);if(w===void 0)hr.set(d,{backend:m,priority:g});else{if(w.priority>g)return;if(w.priority===g&&w.backend!==m)throw new Error(`cannot register backend "${d}" using priority ${g}`)}if(g>=0){let $=St.indexOf(d);$!==-1&&St.splice($,1);for(let I=0;I<St.length;I++)if(hr.get(St[I]).priority<=g){St.splice(I,0,d);return}St.push(d)}return}throw new TypeError("not a valid backend")},Hp=async d=>{let m=hr.get(d);if(!m)return"backend not found.";if(m.initialized)return m.backend;if(m.aborted)return m.error;{let g=!!m.initPromise;try{return g||(m.initPromise=m.backend.init(d)),await m.initPromise,m.initialized=!0,m.backend}catch(w){return g||(m.error=`${w}`,m.aborted=!0),m.error}finally{delete m.initPromise}}},Fi=async d=>{let m=d.executionProviders||[],g=m.map(j=>typeof j=="string"?j:j.name),w=g.length===0?St:g,$,I=[],D=new Set;for(let j of w){let G=await Hp(j);typeof G=="string"?I.push({name:j,err:G}):($||($=G),$===G&&D.add(j))}if(!$)throw new Error(`no available backend found. ERR: ${I.map(j=>`[${j.name}] ${j.err}`).join(", ")}`);for(let{name:j,err:G}of I)g.includes(j)&&console.warn(`removing requested execution provider "${j}" from session options because it is not available: ${G}`);let q=m.filter(j=>D.has(typeof j=="string"?j:j.name));return[$,new Proxy(d,{get:(j,G)=>G==="executionProviders"?q:Reflect.get(j,G)})]}}),qi=U(()=>{Bn()}),Ki,ji=U(()=>{Ki="1.22.0"}),Zi,Me,Mn=U(()=>{ji(),Zi="warning",Me={wasm:{},webgl:{},webgpu:{},versions:{common:Ki},set logLevel(d){if(d!==void 0){if(typeof d!="string"||["verbose","info","warning","error","fatal"].indexOf(d)===-1)throw new Error(`Unsupported logging level: ${d}`);Zi=d}},get logLevel(){return Zi}},Object.defineProperty(Me,"logLevel",{enumerable:!0})}),be,Qi=U(()=>{Mn(),be=Me}),Yi,Xi,Ji=U(()=>{Yi=(d,m)=>{let g=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);g.width=d.dims[3],g.height=d.dims[2];let w=g.getContext("2d");if(w!=null){let $,I;m?.tensorLayout!==void 0&&m.tensorLayout==="NHWC"?($=d.dims[2],I=d.dims[3]):($=d.dims[3],I=d.dims[2]);let D=m?.format!==void 0?m.format:"RGB",q=m?.norm,j,G;q===void 0||q.mean===void 0?j=[255,255,255,255]:typeof q.mean=="number"?j=[q.mean,q.mean,q.mean,q.mean]:(j=[q.mean[0],q.mean[1],q.mean[2],0],q.mean[3]!==void 0&&(j[3]=q.mean[3])),q===void 0||q.bias===void 0?G=[0,0,0,0]:typeof q.bias=="number"?G=[q.bias,q.bias,q.bias,q.bias]:(G=[q.bias[0],q.bias[1],q.bias[2],0],q.bias[3]!==void 0&&(G[3]=q.bias[3]));let H=I*$,W=0,V=H,K=H*2,Z=-1;D==="RGBA"?(W=0,V=H,K=H*2,Z=H*3):D==="RGB"?(W=0,V=H,K=H*2):D==="RBG"&&(W=0,K=H,V=H*2);for(let Q=0;Q<I;Q++)for(let J=0;J<$;J++){let re=(d.data[W++]-G[0])*j[0],se=(d.data[V++]-G[1])*j[1],oe=(d.data[K++]-G[2])*j[2],ee=Z===-1?255:(d.data[Z++]-G[3])*j[3];w.fillStyle="rgba("+re+","+se+","+oe+","+ee+")",w.fillRect(J,Q,1,1)}if("toDataURL"in g)return g.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Xi=(d,m)=>{let g=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),w;if(g!=null){let $,I,D;m?.tensorLayout!==void 0&&m.tensorLayout==="NHWC"?($=d.dims[2],I=d.dims[1],D=d.dims[3]):($=d.dims[3],I=d.dims[2],D=d.dims[1]);let q=m!==void 0&&m.format!==void 0?m.format:"RGB",j=m?.norm,G,H;j===void 0||j.mean===void 0?G=[255,255,255,255]:typeof j.mean=="number"?G=[j.mean,j.mean,j.mean,j.mean]:(G=[j.mean[0],j.mean[1],j.mean[2],255],j.mean[3]!==void 0&&(G[3]=j.mean[3])),j===void 0||j.bias===void 0?H=[0,0,0,0]:typeof j.bias=="number"?H=[j.bias,j.bias,j.bias,j.bias]:(H=[j.bias[0],j.bias[1],j.bias[2],0],j.bias[3]!==void 0&&(H[3]=j.bias[3]));let W=I*$;if(m!==void 0&&(m.format!==void 0&&D===4&&m.format!=="RGBA"||D===3&&m.format!=="RGB"&&m.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let V=4,K=0,Z=1,Q=2,J=3,re=0,se=W,oe=W*2,ee=-1;q==="RGBA"?(re=0,se=W,oe=W*2,ee=W*3):q==="RGB"?(re=0,se=W,oe=W*2):q==="RBG"&&(re=0,oe=W,se=W*2),w=g.createImageData($,I);for(let ae=0;ae<I*$;K+=V,Z+=V,Q+=V,J+=V,ae++)w.data[K]=(d.data[re++]-H[0])*G[0],w.data[Z]=(d.data[se++]-H[1])*G[1],w.data[Q]=(d.data[oe++]-H[2])*G[2],w.data[J]=ee===-1?255:(d.data[ee++]-H[3])*G[3]}else throw new Error("Can not access image data");return w}}),Rn,ea,ta,ra,na,oa,ia=U(()=>{gr(),Rn=(d,m)=>{if(d===void 0)throw new Error("Image buffer must be defined");if(m.height===void 0||m.width===void 0)throw new Error("Image height and width must be defined");if(m.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:g,width:w}=m,$=m.norm??{mean:255,bias:0},I,D;typeof $.mean=="number"?I=[$.mean,$.mean,$.mean,$.mean]:I=[$.mean[0],$.mean[1],$.mean[2],$.mean[3]??255],typeof $.bias=="number"?D=[$.bias,$.bias,$.bias,$.bias]:D=[$.bias[0],$.bias[1],$.bias[2],$.bias[3]??0];let q=m.format!==void 0?m.format:"RGBA",j=m.tensorFormat!==void 0&&m.tensorFormat!==void 0?m.tensorFormat:"RGB",G=g*w,H=j==="RGBA"?new Float32Array(G*4):new Float32Array(G*3),W=4,V=0,K=1,Z=2,Q=3,J=0,re=G,se=G*2,oe=-1;q==="RGB"&&(W=3,V=0,K=1,Z=2,Q=-1),j==="RGBA"?oe=G*3:j==="RBG"?(J=0,se=G,re=G*2):j==="BGR"&&(se=0,re=G,J=G*2);for(let ee=0;ee<G;ee++,V+=W,Z+=W,K+=W,Q+=W)H[J++]=(d[V]+D[0])/I[0],H[re++]=(d[K]+D[1])/I[1],H[se++]=(d[Z]+D[2])/I[2],oe!==-1&&Q!==-1&&(H[oe++]=(d[Q]+D[3])/I[3]);return j==="RGBA"?new Pe("float32",H,[1,4,g,w]):new Pe("float32",H,[1,3,g,w])},ea=async(d,m)=>{let g=typeof HTMLImageElement<"u"&&d instanceof HTMLImageElement,w=typeof ImageData<"u"&&d instanceof ImageData,$=typeof ImageBitmap<"u"&&d instanceof ImageBitmap,I=typeof d=="string",D,q=m??{},j=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},G=H=>typeof HTMLCanvasElement<"u"&&H instanceof HTMLCanvasElement||H instanceof OffscreenCanvas?H.getContext("2d"):null;if(g){let H=j();H.width=d.width,H.height=d.height;let W=G(H);if(W!=null){let V=d.height,K=d.width;if(m!==void 0&&m.resizedHeight!==void 0&&m.resizedWidth!==void 0&&(V=m.resizedHeight,K=m.resizedWidth),m!==void 0){if(q=m,m.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");q.tensorFormat="RGBA",q.height=V,q.width=K}else q.tensorFormat="RGBA",q.height=V,q.width=K;W.drawImage(d,0,0),D=W.getImageData(0,0,K,V).data}else throw new Error("Can not access image data")}else if(w){let H,W;if(m!==void 0&&m.resizedWidth!==void 0&&m.resizedHeight!==void 0?(H=m.resizedHeight,W=m.resizedWidth):(H=d.height,W=d.width),m!==void 0&&(q=m),q.format="RGBA",q.height=H,q.width=W,m!==void 0){let V=j();V.width=W,V.height=H;let K=G(V);if(K!=null)K.putImageData(d,0,0),D=K.getImageData(0,0,W,H).data;else throw new Error("Can not access image data")}else D=d.data}else if($){if(m===void 0)throw new Error("Please provide image config with format for Imagebitmap");let H=j();H.width=d.width,H.height=d.height;let W=G(H);if(W!=null){let V=d.height,K=d.width;return W.drawImage(d,0,0,K,V),D=W.getImageData(0,0,K,V).data,q.height=V,q.width=K,Rn(D,q)}else throw new Error("Can not access image data")}else{if(I)return new Promise((H,W)=>{let V=j(),K=G(V);if(!d||!K)return W();let Z=new Image;Z.crossOrigin="Anonymous",Z.src=d,Z.onload=()=>{V.width=Z.width,V.height=Z.height,K.drawImage(Z,0,0,V.width,V.height);let Q=K.getImageData(0,0,V.width,V.height);q.height=V.height,q.width=V.width,H(Rn(Q.data,q))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(D!==void 0)return Rn(D,q);throw new Error("Input data provided is not supported - aborted tensor creation")},ta=(d,m)=>{let{width:g,height:w,download:$,dispose:I}=m,D=[1,w,g,4];return new Pe({location:"texture",type:"float32",texture:d,dims:D,download:$,dispose:I})},ra=(d,m)=>{let{dataType:g,dims:w,download:$,dispose:I}=m;return new Pe({location:"gpu-buffer",type:g??"float32",gpuBuffer:d,dims:w,download:$,dispose:I})},na=(d,m)=>{let{dataType:g,dims:w,download:$,dispose:I}=m;return new Pe({location:"ml-tensor",type:g??"float32",mlTensor:d,dims:w,download:$,dispose:I})},oa=(d,m,g)=>new Pe({location:"cpu-pinned",type:d,data:m,dims:g??[m.length]})}),It,Kt,aa,sa,ua=U(()=>{It=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Kt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),aa=!1,sa=()=>{if(!aa){aa=!0;let d=typeof BigInt64Array<"u"&&BigInt64Array.from,m=typeof BigUint64Array<"u"&&BigUint64Array.from,g=globalThis.Float16Array,w=typeof g<"u"&&g.from;d&&(It.set("int64",BigInt64Array),Kt.set(BigInt64Array,"int64")),m&&(It.set("uint64",BigUint64Array),Kt.set(BigUint64Array,"uint64")),w?(It.set("float16",g),Kt.set(g,"float16")):It.set("float16",Uint16Array)}}}),da,la,ca=U(()=>{gr(),da=d=>{let m=1;for(let g=0;g<d.length;g++){let w=d[g];if(typeof w!="number"||!Number.isSafeInteger(w))throw new TypeError(`dims[${g}] must be an integer, got: ${w}`);if(w<0)throw new RangeError(`dims[${g}] must be a non-negative integer, got: ${w}`);m*=w}return m},la=(d,m)=>{switch(d.location){case"cpu":return new Pe(d.type,d.data,m);case"cpu-pinned":return new Pe({location:"cpu-pinned",data:d.data,type:d.type,dims:m});case"texture":return new Pe({location:"texture",texture:d.texture,type:d.type,dims:m});case"gpu-buffer":return new Pe({location:"gpu-buffer",gpuBuffer:d.gpuBuffer,type:d.type,dims:m});case"ml-tensor":return new Pe({location:"ml-tensor",mlTensor:d.mlTensor,type:d.type,dims:m});default:throw new Error(`tensorReshape: tensor location ${d.location} is not supported`)}}}),Pe,gr=U(()=>{Ji(),ia(),ua(),ca(),Pe=class{constructor(d,m,g){sa();let w,$;if(typeof d=="object"&&"location"in d)switch(this.dataLocation=d.location,w=d.type,$=d.dims,d.location){case"cpu-pinned":{let D=It.get(w);if(!D)throw new TypeError(`unsupported type "${w}" to create tensor from pinned buffer`);if(!(d.data instanceof D))throw new TypeError(`buffer should be of type ${D.name}`);this.cpuData=d.data;break}case"texture":{if(w!=="float32")throw new TypeError(`unsupported type "${w}" to create tensor from texture`);this.gpuTextureData=d.texture,this.downloader=d.download,this.disposer=d.dispose;break}case"gpu-buffer":{if(w!=="float32"&&w!=="float16"&&w!=="int32"&&w!=="int64"&&w!=="uint32"&&w!=="uint8"&&w!=="bool"&&w!=="uint4"&&w!=="int4")throw new TypeError(`unsupported type "${w}" to create tensor from gpu buffer`);this.gpuBufferData=d.gpuBuffer,this.downloader=d.download,this.disposer=d.dispose;break}case"ml-tensor":{if(w!=="float32"&&w!=="float16"&&w!=="int32"&&w!=="int64"&&w!=="uint32"&&w!=="uint64"&&w!=="int8"&&w!=="uint8"&&w!=="bool"&&w!=="uint4"&&w!=="int4")throw new TypeError(`unsupported type "${w}" to create tensor from MLTensor`);this.mlTensorData=d.mlTensor,this.downloader=d.download,this.disposer=d.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let D,q;if(typeof d=="string")if(w=d,q=g,d==="string"){if(!Array.isArray(m))throw new TypeError("A string tensor's data must be a string array.");D=m}else{let j=It.get(d);if(j===void 0)throw new TypeError(`Unsupported tensor type: ${d}.`);if(Array.isArray(m)){if(d==="float16"&&j===Uint16Array||d==="uint4"||d==="int4")throw new TypeError(`Creating a ${d} tensor from number array is not supported. Please use ${j.name} as data.`);d==="uint64"||d==="int64"?D=j.from(m,BigInt):D=j.from(m)}else if(m instanceof j)D=m;else if(m instanceof Uint8ClampedArray)if(d==="uint8")D=Uint8Array.from(m);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(d==="float16"&&m instanceof Uint16Array&&j!==Uint16Array)D=new globalThis.Float16Array(m.buffer,m.byteOffset,m.length);else throw new TypeError(`A ${w} tensor's data must be type of ${j}`)}else if(q=m,Array.isArray(d)){if(d.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let j=typeof d[0];if(j==="string")w="string",D=d;else if(j==="boolean")w="bool",D=Uint8Array.from(d);else throw new TypeError(`Invalid element type of data array: ${j}.`)}else if(d instanceof Uint8ClampedArray)w="uint8",D=Uint8Array.from(d);else{let j=Kt.get(d.constructor);if(j===void 0)throw new TypeError(`Unsupported type for tensor data: ${d.constructor}.`);w=j,D=d}if(q===void 0)q=[D.length];else if(!Array.isArray(q))throw new TypeError("A tensor's dims must be a number array");$=q,this.cpuData=D,this.dataLocation="cpu"}let I=da($);if(this.cpuData&&I!==this.cpuData.length&&!((w==="uint4"||w==="int4")&&Math.ceil(I/2)===this.cpuData.length))throw new Error(`Tensor's size(${I}) does not match data length(${this.cpuData.length}).`);this.type=w,this.dims=$,this.size=I}static async fromImage(d,m){return ea(d,m)}static fromTexture(d,m){return ta(d,m)}static fromGpuBuffer(d,m){return ra(d,m)}static fromMLTensor(d,m){return na(d,m)}static fromPinnedBuffer(d,m,g){return oa(d,m,g)}toDataURL(d){return Yi(this,d)}toImageData(d){return Xi(this,d)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(d){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let m=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=m,d&&this.disposer&&(this.disposer(),this.disposer=void 0),m}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(d){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return la(this,d)}}}),He,Un=U(()=>{gr(),He=Pe}),br,pa,Re,De,Nn=U(()=>{Mn(),br=(d,m)=>{(typeof Me.trace>"u"?!Me.wasm.trace:!Me.trace)||console.timeStamp(`${d}::ORT::${m}`)},pa=(d,m)=>{let g=new Error().stack?.split(/\r\n|\r|\n/g)||[],w=!1;for(let $=0;$<g.length;$++){if(w&&!g[$].includes("TRACE_FUNC")){let I=`FUNC_${d}::${g[$].trim().split(" ")[1]}`;m&&(I+=`::${m}`),br("CPU",I);return}g[$].includes("TRACE_FUNC")&&(w=!0)}},Re=d=>{(typeof Me.trace>"u"?!Me.wasm.trace:!Me.trace)||pa("BEGIN",d)},De=d=>{(typeof Me.trace>"u"?!Me.wasm.trace:!Me.trace)||pa("END",d)}}),yr,ma=U(()=>{Bn(),Un(),Nn(),yr=class Ph{constructor(m){this.handler=m}async run(m,g,w){Re();let $={},I={};if(typeof m!="object"||m===null||m instanceof He||Array.isArray(m))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let D=!0;if(typeof g=="object"){if(g===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(g instanceof He)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(g)){if(g.length===0)throw new TypeError("'fetches' cannot be an empty array.");D=!1;for(let G of g){if(typeof G!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(G)===-1)throw new RangeError(`'fetches' contains invalid output name: ${G}.`);$[G]=null}if(typeof w=="object"&&w!==null)I=w;else if(typeof w<"u")throw new TypeError("'options' must be an object.")}else{let G=!1,H=Object.getOwnPropertyNames(g);for(let W of this.outputNames)if(H.indexOf(W)!==-1){let V=g[W];(V===null||V instanceof He)&&(G=!0,D=!1,$[W]=V)}if(G){if(typeof w=="object"&&w!==null)I=w;else if(typeof w<"u")throw new TypeError("'options' must be an object.")}else I=g}}else if(typeof g<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let G of this.inputNames)if(typeof m[G]>"u")throw new Error(`input '${G}' is missing in 'feeds'.`);if(D)for(let G of this.outputNames)$[G]=null;let q=await this.handler.run(m,$,I),j={};for(let G in q)if(Object.hasOwnProperty.call(q,G)){let H=q[G];H instanceof He?j[G]=H:j[G]=new He(H.type,H.data,H.dims)}return De(),j}async release(){return this.handler.dispose()}static async create(m,g,w,$){Re();let I,D={};if(typeof m=="string"){if(I=m,typeof g=="object"&&g!==null)D=g;else if(typeof g<"u")throw new TypeError("'options' must be an object.")}else if(m instanceof Uint8Array){if(I=m,typeof g=="object"&&g!==null)D=g;else if(typeof g<"u")throw new TypeError("'options' must be an object.")}else if(m instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&m instanceof SharedArrayBuffer){let H=m,W=0,V=m.byteLength;if(typeof g=="object"&&g!==null)D=g;else if(typeof g=="number"){if(W=g,!Number.isSafeInteger(W))throw new RangeError("'byteOffset' must be an integer.");if(W<0||W>=H.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${H.byteLength}).`);if(V=m.byteLength-W,typeof w=="number"){if(V=w,!Number.isSafeInteger(V))throw new RangeError("'byteLength' must be an integer.");if(V<=0||W+V>H.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${H.byteLength-W}].`);if(typeof $=="object"&&$!==null)D=$;else if(typeof $<"u")throw new TypeError("'options' must be an object.")}else if(typeof w<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof g<"u")throw new TypeError("'options' must be an object.");I=new Uint8Array(H,W,V)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[q,j]=await Fi(D),G=await q.createInferenceSessionHandler(I,j);return De(),new Ph(G)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Fp,fa=U(()=>{ma(),Fp=yr}),ha=U(()=>{}),ga=U(()=>{}),ba=U(()=>{}),ya=U(()=>{}),Vn={};Rt(Vn,{InferenceSession:()=>Fp,TRACE:()=>br,TRACE_FUNC_BEGIN:()=>Re,TRACE_FUNC_END:()=>De,Tensor:()=>He,env:()=>be,registerBackend:()=>Tt});var We=U(()=>{qi(),Qi(),fa(),Un(),ha(),ga(),Nn(),ba(),ya()}),_r=U(()=>{}),$a={};Rt($a,{default:()=>qp});var wa,va,qp,xa=U(()=>{Wn(),yt(),wr(),wa="ort-wasm-proxy-worker",va=globalThis.self?.name===wa,va&&(self.onmessage=d=>{let{type:m,in:g}=d.data;try{switch(m){case"init-wasm":vr(g.wasm).then(()=>{$r(g).then(()=>{postMessage({type:m})},w=>{postMessage({type:m,err:w})})},w=>{postMessage({type:m,err:w})});break;case"init-ep":{let{epName:w,env:$}=g;xr($,w).then(()=>{postMessage({type:m})},I=>{postMessage({type:m,err:I})});break}case"copy-from":{let{buffer:w}=g,$=jt(w);postMessage({type:m,out:$});break}case"create":{let{model:w,options:$}=g;Sr(w,$).then(I=>{postMessage({type:m,out:I})},I=>{postMessage({type:m,err:I})});break}case"release":Tr(g),postMessage({type:m});break;case"run":{let{sessionId:w,inputIndices:$,inputs:I,outputIndices:D,options:q}=g;Ir(w,$,I,D,new Array(D.length).fill(null),q).then(j=>{j.some(G=>G[3]!=="cpu")?postMessage({type:m,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:m,out:j},Ar([...I,...j]))},j=>{postMessage({type:m,err:j})});break}case"end-profiling":Cr(g),postMessage({type:m});break;default:}}catch(w){postMessage({type:m,err:w})}}),qp=va?null:d=>new Worker(d??Ue,{type:"module",name:wa})}),Ta={};Rt(Ta,{default:()=>Kp});var Ln,Sa,Kp,jp,Ia=U(()=>{Sa=(Ln=import.meta.url,async function(d={}){var m,g,w=d,$=new Promise((ve,Ve)=>{m=ve,g=Ve}),I=typeof window=="object",D=typeof WorkerGlobalScope<"u",q=D&&self.name?.startsWith("em-pthread");w.mountExternalData=(ve,Ve)=>{ve.startsWith("./")&&(ve=ve.substring(2)),(w.Fb||(w.Fb=new Map)).set(ve,Ve)},w.unmountExternalData=()=>{delete w.Fb};var j=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let G=ve=>async(...Ve)=>{try{if(w.Gb)throw Error("Session already started");let Ct=w.Gb={ec:Ve[0],errors:[]},Ht=await ve(...Ve);if(w.Gb!==Ct)throw Error("Session mismatch");w.Kb?.flush();let lr=Ct.errors;if(0<lr.length){let pn=await Promise.all(lr);if(pn=pn.filter(Sn=>Sn),0<pn.length)throw Error(pn.join(`
`))}return Ht}finally{w.Gb=null}};w.jsepInit=(ve,Ve)=>{if(ve==="webgpu"){[w.Kb,w.Vb,w.Zb,w.Lb,w.Yb,w.kb,w.$b,w.bc,w.Wb,w.Xb,w.ac]=Ve;let Ct=w.Kb;w.jsepRegisterBuffer=(Ht,lr,pn,Sn)=>Ct.registerBuffer(Ht,lr,pn,Sn),w.jsepGetBuffer=Ht=>Ct.getBuffer(Ht),w.jsepCreateDownloader=(Ht,lr,pn)=>Ct.createDownloader(Ht,lr,pn),w.jsepOnCreateSession=Ht=>{Ct.onCreateSession(Ht)},w.jsepOnReleaseSession=Ht=>{Ct.onReleaseSession(Ht)},w.jsepOnRunStart=Ht=>Ct.onRunStart(Ht),w.cc=(Ht,lr)=>{Ct.upload(Ht,lr)}}else if(ve==="webnn"){let Ct=Ve[0];[w.oc,w.Ob,w.webnnEnsureTensor,w.Pb,w.webnnDownloadTensor]=Ve.slice(1),w.webnnReleaseTensorId=w.Ob,w.webnnUploadTensor=w.Pb,w.webnnOnRunStart=Ht=>Ct.onRunStart(Ht),w.webnnOnRunEnd=Ct.onRunEnd.bind(Ct),w.webnnRegisterMLContext=(Ht,lr)=>{Ct.registerMLContext(Ht,lr)},w.webnnOnReleaseSession=Ht=>{Ct.onReleaseSession(Ht)},w.webnnCreateMLTensorDownloader=(Ht,lr)=>Ct.createMLTensorDownloader(Ht,lr),w.webnnRegisterMLTensor=(Ht,lr,pn,Sn)=>Ct.registerMLTensor(Ht,lr,pn,Sn),w.webnnCreateMLContext=Ht=>Ct.createMLContext(Ht),w.webnnRegisterMLConstant=(Ht,lr,pn,Sn,In,Pn)=>Ct.registerMLConstant(Ht,lr,pn,Sn,In,w.Fb,Pn),w.webnnRegisterGraphInput=Ct.registerGraphInput.bind(Ct),w.webnnIsGraphInput=Ct.isGraphInput.bind(Ct),w.webnnRegisterGraphOutput=Ct.registerGraphOutput.bind(Ct),w.webnnIsGraphOutput=Ct.isGraphOutput.bind(Ct),w.webnnCreateTemporaryTensor=Ct.createTemporaryTensor.bind(Ct),w.webnnIsGraphInputOutputTypeSupported=Ct.isGraphInputOutputTypeSupported.bind(Ct)}};let H=()=>{let ve=(Ve,Ct,Ht)=>(...lr)=>{let pn=Pi,Sn=Ct?.();lr=Ve(...lr);let In=Ct?.();return Sn!==In&&(Ve=In,Ht(Sn),Ct=Ht=null),Pi!=pn?new Promise((Pn,ni)=>{Ko={resolve:Pn,reject:ni}}):lr};(()=>{for(let Ve of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])w[Ve]=ve(w[Ve],()=>w[Ve],Ct=>w[Ve]=Ct)})(),G!==void 0&&(w._OrtRun=G(w._OrtRun),w._OrtRunWithBinding=G(w._OrtRunWithBinding)),H=void 0};w.asyncInit=()=>{H?.()};var W,V,K=Object.assign({},w),Z=(ve,Ve)=>{throw Ve},Q="";(I||D)&&(D?Q=self.location.href:typeof document<"u"&&document.currentScript&&(Q=document.currentScript.src),Ln&&(Q=Ln),Q=Q.startsWith("blob:")?"":Q.slice(0,Q.replace(/[?#].*/,"").lastIndexOf("/")+1),D&&(V=ve=>{var Ve=new XMLHttpRequest;return Ve.open("GET",ve,!1),Ve.responseType="arraybuffer",Ve.send(null),new Uint8Array(Ve.response)}),W=async ve=>{if(lt(ve))return new Promise((Ct,Ht)=>{var lr=new XMLHttpRequest;lr.open("GET",ve,!0),lr.responseType="arraybuffer",lr.onload=()=>{lr.status==200||lr.status==0&&lr.response?Ct(lr.response):Ht(lr.status)},lr.onerror=Ht,lr.send(null)});var Ve=await fetch(ve,{credentials:"same-origin"});if(Ve.ok)return Ve.arrayBuffer();throw Error(Ve.status+" : "+Ve.url)});var J=console.log.bind(console),re=console.error.bind(console),se=J,oe=re;Object.assign(w,K),K=null;var ee,ae,ce,le,de,_e,we,pe,xe,Ge,Te,Ce,Oe,bt=w.wasmBinary,Mt=!1,lt=ve=>ve.startsWith("file://");function ir(){return ee.buffer!=le.buffer&&Ft(),le}function Ye(){return ee.buffer!=le.buffer&&Ft(),de}function xt(){return ee.buffer!=le.buffer&&Ft(),_e}function ar(){return ee.buffer!=le.buffer&&Ft(),we}function ht(){return ee.buffer!=le.buffer&&Ft(),pe}function gt(){return ee.buffer!=le.buffer&&Ft(),xe}function zt(){return ee.buffer!=le.buffer&&Ft(),Ge}function ur(){return ee.buffer!=le.buffer&&Ft(),Oe}if(q){let ve=function(Ve){try{var Ct=Ve.data,Ht=Ct.Cb;if(Ht==="load"){let lr=[];self.onmessage=pn=>lr.push(pn),self.startWorker=()=>{postMessage({Cb:"loaded"});for(let pn of lr)ve(pn);self.onmessage=ve};for(let pn of Ct.Sb)w[pn]&&!w[pn].proxy||(w[pn]=(...Sn)=>{postMessage({Cb:"callHandler",Rb:pn,args:Sn})},pn=="print"&&(se=w[pn]),pn=="printErr"&&(oe=w[pn]));ee=Ct.lc,Ft(),dr(Ct.mc)}else if(Ht==="run"){Dt(Ct.Bb),Jo(Ct.Bb,0,0,1,0,0),kn(),Wo(Ct.Bb),fr||(Hc(),fr=!0);try{wn(Ct.hc,Ct.Ib)}catch(lr){if(lr!="unwind")throw lr}}else Ct.target!=="setimmediate"&&(Ht==="checkMailbox"?fr&&Wi():Ht&&(oe(`worker: received unknown command ${Ht}`),oe(Ct)))}catch(lr){throw Wc(),lr}};var dr,fr=!1;oe=function(...Ve){Ve=Ve.join(" "),console.error(Ve)},self.alert=function(...Ve){postMessage({Cb:"alert",text:Ve.join(" "),jc:Bo()})},self.onunhandledrejection=Ve=>{throw Ve.reason||Ve},self.onmessage=ve}function Ft(){var ve=ee.buffer;w.HEAP8=le=new Int8Array(ve),w.HEAP16=_e=new Int16Array(ve),w.HEAPU8=de=new Uint8Array(ve),w.HEAPU16=we=new Uint16Array(ve),w.HEAP32=pe=new Int32Array(ve),w.HEAPU32=xe=new Uint32Array(ve),w.HEAPF32=Ge=new Float32Array(ve),w.HEAPF64=Oe=new Float64Array(ve),w.HEAP64=Te=new BigInt64Array(ve),w.HEAPU64=Ce=new BigUint64Array(ve)}function $e(){q?startWorker(w):ai.Da()}q||(ee=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),Ft());var Bt,Qe=0,st=null;function at(){if(--Qe==0&&st){var ve=st;st=null,ve()}}function pt(ve){throw oe(ve="Aborted("+ve+")"),Mt=!0,ve=new WebAssembly.RuntimeError(ve+". Build with -sASSERTIONS for more info."),g(ve),ve}function sr(){return{a:{L:ct,Aa:ze,b:Ze,$:hn,A:ri,pa:An,X:wi,Z:ci,qa:hi,na:mi,ga:gi,ma:Ai,J:Ti,Y:pi,V:bi,oa:Si,W:_i,va:Oi,E:Hi,Q:tp,O:np,D:sp,v:op,r:lp,P:up,z:gp,R:yp,ja:bp,T:_p,aa:wp,M:vp,F:xp,ia:Wo,sa:Sp,t:kp,Ca:Ep,w:Ap,o:Tp,m:Cp,c:jo,Ba:Mp,n:Op,j:Dp,u:Bp,p:zp,f:Up,s:e0,l:t0,e:r0,k:n0,h:i0,g:a0,d:s0,da:o0,ea:l0,fa:u0,ba:Cc,ca:Mc,N:Oc,xa:d0,ua:h0,i:p0,C:m0,G:g0,ta:f0,x:y0,ra:b0,U:_0,q:c0,y:w0,K:v0,S:x0,za:S0,ya:k0,ka:Bc,la:Lc,_:ti,B:zc,I:Fc,ha:Uc,H:qc,a:ee,wa:$n}}}var Ee={840156:(ve,Ve,Ct,Ht,lr)=>{if(w===void 0||!w.Fb)return 1;if((ve=mn(Number(ve>>>0))).startsWith("./")&&(ve=ve.substring(2)),!(ve=w.Fb.get(ve)))return 2;if(Ve=Number(Ve>>>0),Ct=Number(Ct>>>0),Ht=Number(Ht>>>0),Ve+Ct>ve.byteLength)return 3;try{let pn=ve.subarray(Ve,Ve+Ct);switch(lr){case 0:Ye().set(pn,Ht>>>0);break;case 1:w.nc?w.nc(Ht,pn):w.cc(Ht,pn);break;default:return 4}return 0}catch{return 4}},840980:(ve,Ve,Ct)=>{w.Pb(ve,Ye().subarray(Ve>>>0,Ve+Ct>>>0))},841044:()=>w.oc(),841086:ve=>{w.Ob(ve)},841123:()=>{w.Wb()},841154:()=>{w.Xb()},841183:()=>{w.ac()},841208:ve=>w.Vb(ve),841241:ve=>w.Zb(ve),841273:(ve,Ve,Ct)=>{w.Lb(Number(ve),Number(Ve),Number(Ct),!0)},841336:(ve,Ve,Ct)=>{w.Lb(Number(ve),Number(Ve),Number(Ct))},841393:()=>typeof wasmOffsetConverter<"u",841450:ve=>{w.kb("Abs",ve,void 0)},841501:ve=>{w.kb("Neg",ve,void 0)},841552:ve=>{w.kb("Floor",ve,void 0)},841605:ve=>{w.kb("Ceil",ve,void 0)},841657:ve=>{w.kb("Reciprocal",ve,void 0)},841715:ve=>{w.kb("Sqrt",ve,void 0)},841767:ve=>{w.kb("Exp",ve,void 0)},841818:ve=>{w.kb("Erf",ve,void 0)},841869:ve=>{w.kb("Sigmoid",ve,void 0)},841924:(ve,Ve,Ct)=>{w.kb("HardSigmoid",ve,{alpha:Ve,beta:Ct})},842003:ve=>{w.kb("Log",ve,void 0)},842054:ve=>{w.kb("Sin",ve,void 0)},842105:ve=>{w.kb("Cos",ve,void 0)},842156:ve=>{w.kb("Tan",ve,void 0)},842207:ve=>{w.kb("Asin",ve,void 0)},842259:ve=>{w.kb("Acos",ve,void 0)},842311:ve=>{w.kb("Atan",ve,void 0)},842363:ve=>{w.kb("Sinh",ve,void 0)},842415:ve=>{w.kb("Cosh",ve,void 0)},842467:ve=>{w.kb("Asinh",ve,void 0)},842520:ve=>{w.kb("Acosh",ve,void 0)},842573:ve=>{w.kb("Atanh",ve,void 0)},842626:ve=>{w.kb("Tanh",ve,void 0)},842678:ve=>{w.kb("Not",ve,void 0)},842729:(ve,Ve,Ct)=>{w.kb("Clip",ve,{min:Ve,max:Ct})},842798:ve=>{w.kb("Clip",ve,void 0)},842850:(ve,Ve)=>{w.kb("Elu",ve,{alpha:Ve})},842908:ve=>{w.kb("Gelu",ve,void 0)},842960:ve=>{w.kb("Relu",ve,void 0)},843012:(ve,Ve)=>{w.kb("LeakyRelu",ve,{alpha:Ve})},843076:(ve,Ve)=>{w.kb("ThresholdedRelu",ve,{alpha:Ve})},843146:(ve,Ve)=>{w.kb("Cast",ve,{to:Ve})},843204:ve=>{w.kb("Add",ve,void 0)},843255:ve=>{w.kb("Sub",ve,void 0)},843306:ve=>{w.kb("Mul",ve,void 0)},843357:ve=>{w.kb("Div",ve,void 0)},843408:ve=>{w.kb("Pow",ve,void 0)},843459:ve=>{w.kb("Equal",ve,void 0)},843512:ve=>{w.kb("Greater",ve,void 0)},843567:ve=>{w.kb("GreaterOrEqual",ve,void 0)},843629:ve=>{w.kb("Less",ve,void 0)},843681:ve=>{w.kb("LessOrEqual",ve,void 0)},843740:(ve,Ve,Ct,Ht,lr)=>{w.kb("ReduceMean",ve,{keepDims:!!Ve,noopWithEmptyAxes:!!Ct,axes:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},843915:(ve,Ve,Ct,Ht,lr)=>{w.kb("ReduceMax",ve,{keepDims:!!Ve,noopWithEmptyAxes:!!Ct,axes:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},844089:(ve,Ve,Ct,Ht,lr)=>{w.kb("ReduceMin",ve,{keepDims:!!Ve,noopWithEmptyAxes:!!Ct,axes:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},844263:(ve,Ve,Ct,Ht,lr)=>{w.kb("ReduceProd",ve,{keepDims:!!Ve,noopWithEmptyAxes:!!Ct,axes:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},844438:(ve,Ve,Ct,Ht,lr)=>{w.kb("ReduceSum",ve,{keepDims:!!Ve,noopWithEmptyAxes:!!Ct,axes:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},844612:(ve,Ve,Ct,Ht,lr)=>{w.kb("ReduceL1",ve,{keepDims:!!Ve,noopWithEmptyAxes:!!Ct,axes:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},844785:(ve,Ve,Ct,Ht,lr)=>{w.kb("ReduceL2",ve,{keepDims:!!Ve,noopWithEmptyAxes:!!Ct,axes:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},844958:(ve,Ve,Ct,Ht,lr)=>{w.kb("ReduceLogSum",ve,{keepDims:!!Ve,noopWithEmptyAxes:!!Ct,axes:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},845135:(ve,Ve,Ct,Ht,lr)=>{w.kb("ReduceSumSquare",ve,{keepDims:!!Ve,noopWithEmptyAxes:!!Ct,axes:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},845315:(ve,Ve,Ct,Ht,lr)=>{w.kb("ReduceLogSumExp",ve,{keepDims:!!Ve,noopWithEmptyAxes:!!Ct,axes:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},845495:ve=>{w.kb("Where",ve,void 0)},845548:(ve,Ve,Ct)=>{w.kb("Transpose",ve,{perm:Ve?Array.from(ht().subarray(Number(Ve)>>>0,Number(Ct)>>>0)):[]})},845672:(ve,Ve,Ct,Ht)=>{w.kb("DepthToSpace",ve,{blocksize:Ve,mode:mn(Ct),format:Ht?"NHWC":"NCHW"})},845805:(ve,Ve,Ct,Ht)=>{w.kb("DepthToSpace",ve,{blocksize:Ve,mode:mn(Ct),format:Ht?"NHWC":"NCHW"})},845938:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni,li,ui,fi,vi,Bi)=>{w.kb("ConvTranspose",ve,{format:Pn?"NHWC":"NCHW",autoPad:Ve,dilations:[Ct],group:Ht,kernelShape:[lr],pads:[pn,Sn],strides:[In],wIsConst:()=>!!ir()[ni>>>0],outputPadding:li?Array.from(ht().subarray(Number(li)>>>0,Number(ui)>>>0)):[],outputShape:fi?Array.from(ht().subarray(Number(fi)>>>0,Number(vi)>>>0)):[],activation:mn(Bi)})},846371:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni,li,ui,fi,vi)=>{w.kb("ConvTranspose",ve,{format:In?"NHWC":"NCHW",autoPad:Ve,dilations:Array.from(ht().subarray(Number(Ct)>>>0,2+(Number(Ct)>>>0)>>>0)),group:Ht,kernelShape:Array.from(ht().subarray(Number(lr)>>>0,2+(Number(lr)>>>0)>>>0)),pads:Array.from(ht().subarray(Number(pn)>>>0,4+(Number(pn)>>>0)>>>0)),strides:Array.from(ht().subarray(Number(Sn)>>>0,2+(Number(Sn)>>>0)>>>0)),wIsConst:()=>!!ir()[Pn>>>0],outputPadding:ni?Array.from(ht().subarray(Number(ni)>>>0,Number(li)>>>0)):[],outputShape:ui?Array.from(ht().subarray(Number(ui)>>>0,Number(fi)>>>0)):[],activation:mn(vi)})},847032:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni,li,ui,fi,vi,Bi)=>{w.kb("ConvTranspose",ve,{format:Pn?"NHWC":"NCHW",autoPad:Ve,dilations:[Ct],group:Ht,kernelShape:[lr],pads:[pn,Sn],strides:[In],wIsConst:()=>!!ir()[ni>>>0],outputPadding:li?Array.from(ht().subarray(Number(li)>>>0,Number(ui)>>>0)):[],outputShape:fi?Array.from(ht().subarray(Number(fi)>>>0,Number(vi)>>>0)):[],activation:mn(Bi)})},847465:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni,li,ui,fi,vi)=>{w.kb("ConvTranspose",ve,{format:In?"NHWC":"NCHW",autoPad:Ve,dilations:Array.from(ht().subarray(Number(Ct)>>>0,2+(Number(Ct)>>>0)>>>0)),group:Ht,kernelShape:Array.from(ht().subarray(Number(lr)>>>0,2+(Number(lr)>>>0)>>>0)),pads:Array.from(ht().subarray(Number(pn)>>>0,4+(Number(pn)>>>0)>>>0)),strides:Array.from(ht().subarray(Number(Sn)>>>0,2+(Number(Sn)>>>0)>>>0)),wIsConst:()=>!!ir()[Pn>>>0],outputPadding:ni?Array.from(ht().subarray(Number(ni)>>>0,Number(li)>>>0)):[],outputShape:ui?Array.from(ht().subarray(Number(ui)>>>0,Number(fi)>>>0)):[],activation:mn(vi)})},848126:(ve,Ve)=>{w.kb("GlobalAveragePool",ve,{format:Ve?"NHWC":"NCHW"})},848217:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni,li,ui,fi,vi)=>{w.kb("AveragePool",ve,{format:vi?"NHWC":"NCHW",auto_pad:Ve,ceil_mode:Ct,count_include_pad:Ht,storage_order:lr,dilations:pn?Array.from(ht().subarray(Number(pn)>>>0,Number(Sn)>>>0)):[],kernel_shape:In?Array.from(ht().subarray(Number(In)>>>0,Number(Pn)>>>0)):[],pads:ni?Array.from(ht().subarray(Number(ni)>>>0,Number(li)>>>0)):[],strides:ui?Array.from(ht().subarray(Number(ui)>>>0,Number(fi)>>>0)):[]})},848696:(ve,Ve)=>{w.kb("GlobalAveragePool",ve,{format:Ve?"NHWC":"NCHW"})},848787:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni,li,ui,fi,vi)=>{w.kb("AveragePool",ve,{format:vi?"NHWC":"NCHW",auto_pad:Ve,ceil_mode:Ct,count_include_pad:Ht,storage_order:lr,dilations:pn?Array.from(ht().subarray(Number(pn)>>>0,Number(Sn)>>>0)):[],kernel_shape:In?Array.from(ht().subarray(Number(In)>>>0,Number(Pn)>>>0)):[],pads:ni?Array.from(ht().subarray(Number(ni)>>>0,Number(li)>>>0)):[],strides:ui?Array.from(ht().subarray(Number(ui)>>>0,Number(fi)>>>0)):[]})},849266:(ve,Ve)=>{w.kb("GlobalMaxPool",ve,{format:Ve?"NHWC":"NCHW"})},849353:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni,li,ui,fi,vi)=>{w.kb("MaxPool",ve,{format:vi?"NHWC":"NCHW",auto_pad:Ve,ceil_mode:Ct,count_include_pad:Ht,storage_order:lr,dilations:pn?Array.from(ht().subarray(Number(pn)>>>0,Number(Sn)>>>0)):[],kernel_shape:In?Array.from(ht().subarray(Number(In)>>>0,Number(Pn)>>>0)):[],pads:ni?Array.from(ht().subarray(Number(ni)>>>0,Number(li)>>>0)):[],strides:ui?Array.from(ht().subarray(Number(ui)>>>0,Number(fi)>>>0)):[]})},849828:(ve,Ve)=>{w.kb("GlobalMaxPool",ve,{format:Ve?"NHWC":"NCHW"})},849915:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni,li,ui,fi,vi)=>{w.kb("MaxPool",ve,{format:vi?"NHWC":"NCHW",auto_pad:Ve,ceil_mode:Ct,count_include_pad:Ht,storage_order:lr,dilations:pn?Array.from(ht().subarray(Number(pn)>>>0,Number(Sn)>>>0)):[],kernel_shape:In?Array.from(ht().subarray(Number(In)>>>0,Number(Pn)>>>0)):[],pads:ni?Array.from(ht().subarray(Number(ni)>>>0,Number(li)>>>0)):[],strides:ui?Array.from(ht().subarray(Number(ui)>>>0,Number(fi)>>>0)):[]})},850390:(ve,Ve,Ct,Ht,lr)=>{w.kb("Gemm",ve,{alpha:Ve,beta:Ct,transA:Ht,transB:lr})},850494:ve=>{w.kb("MatMul",ve,void 0)},850548:(ve,Ve,Ct,Ht)=>{w.kb("ArgMax",ve,{keepDims:!!Ve,selectLastIndex:!!Ct,axis:Ht})},850656:(ve,Ve,Ct,Ht)=>{w.kb("ArgMin",ve,{keepDims:!!Ve,selectLastIndex:!!Ct,axis:Ht})},850764:(ve,Ve)=>{w.kb("Softmax",ve,{axis:Ve})},850827:(ve,Ve)=>{w.kb("Concat",ve,{axis:Ve})},850887:(ve,Ve,Ct,Ht,lr)=>{w.kb("Split",ve,{axis:Ve,numOutputs:Ct,splitSizes:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},851043:ve=>{w.kb("Expand",ve,void 0)},851097:(ve,Ve)=>{w.kb("Gather",ve,{axis:Number(Ve)})},851168:(ve,Ve)=>{w.kb("GatherElements",ve,{axis:Number(Ve)})},851247:(ve,Ve)=>{w.kb("GatherND",ve,{batch_dims:Number(Ve)})},851326:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni,li)=>{w.kb("Resize",ve,{antialias:Ve,axes:Ct?Array.from(ht().subarray(Number(Ct)>>>0,Number(Ht)>>>0)):[],coordinateTransformMode:mn(lr),cubicCoeffA:pn,excludeOutside:Sn,extrapolationValue:In,keepAspectRatioPolicy:mn(Pn),mode:mn(ni),nearestMode:mn(li)})},851688:(ve,Ve,Ct,Ht,lr,pn,Sn)=>{w.kb("Slice",ve,{starts:Ve?Array.from(ht().subarray(Number(Ve)>>>0,Number(Ct)>>>0)):[],ends:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[],axes:pn?Array.from(ht().subarray(Number(pn)>>>0,Number(Sn)>>>0)):[]})},851952:ve=>{w.kb("Tile",ve,void 0)},852004:(ve,Ve,Ct)=>{w.kb("InstanceNormalization",ve,{epsilon:Ve,format:Ct?"NHWC":"NCHW"})},852118:(ve,Ve,Ct)=>{w.kb("InstanceNormalization",ve,{epsilon:Ve,format:Ct?"NHWC":"NCHW"})},852232:ve=>{w.kb("Range",ve,void 0)},852285:(ve,Ve)=>{w.kb("Einsum",ve,{equation:mn(Ve)})},852366:(ve,Ve,Ct,Ht,lr)=>{w.kb("Pad",ve,{mode:Ve,value:Ct,pads:Ht?Array.from(ht().subarray(Number(Ht)>>>0,Number(lr)>>>0)):[]})},852509:(ve,Ve,Ct,Ht,lr,pn)=>{w.kb("BatchNormalization",ve,{epsilon:Ve,momentum:Ct,spatial:!!lr,trainingMode:!!Ht,format:pn?"NHWC":"NCHW"})},852678:(ve,Ve,Ct,Ht,lr,pn)=>{w.kb("BatchNormalization",ve,{epsilon:Ve,momentum:Ct,spatial:!!lr,trainingMode:!!Ht,format:pn?"NHWC":"NCHW"})},852847:(ve,Ve,Ct)=>{w.kb("CumSum",ve,{exclusive:Number(Ve),reverse:Number(Ct)})},852944:(ve,Ve,Ct)=>{w.kb("DequantizeLinear",ve,{axis:Ve,blockSize:Ct})},853034:(ve,Ve,Ct,Ht,lr)=>{w.kb("GridSample",ve,{align_corners:Ve,mode:mn(Ct),padding_mode:mn(Ht),format:lr?"NHWC":"NCHW"})},853204:(ve,Ve,Ct,Ht,lr)=>{w.kb("GridSample",ve,{align_corners:Ve,mode:mn(Ct),padding_mode:mn(Ht),format:lr?"NHWC":"NCHW"})},853374:(ve,Ve)=>{w.kb("ScatterND",ve,{reduction:mn(Ve)})},853459:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn)=>{w.kb("Attention",ve,{numHeads:Ve,isUnidirectional:Ct,maskFilterValue:Ht,scale:lr,doRotary:pn,qkvHiddenSizes:Sn?Array.from(ht().subarray(Number(In)>>>0,Number(In)+Sn>>>0)):[],pastPresentShareBuffer:!!Pn})},853731:ve=>{w.kb("BiasAdd",ve,void 0)},853786:ve=>{w.kb("BiasSplitGelu",ve,void 0)},853847:ve=>{w.kb("FastGelu",ve,void 0)},853903:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni,li,ui,fi,vi,Bi,I0)=>{w.kb("Conv",ve,{format:ui?"NHWC":"NCHW",auto_pad:Ve,dilations:Ct?Array.from(ht().subarray(Number(Ct)>>>0,Number(Ht)>>>0)):[],group:lr,kernel_shape:pn?Array.from(ht().subarray(Number(pn)>>>0,Number(Sn)>>>0)):[],pads:In?Array.from(ht().subarray(Number(In)>>>0,Number(Pn)>>>0)):[],strides:ni?Array.from(ht().subarray(Number(ni)>>>0,Number(li)>>>0)):[],w_is_const:()=>!!ir()[Number(fi)>>>0],activation:mn(vi),activation_params:Bi?Array.from(zt().subarray(Number(Bi)>>>0,Number(I0)>>>0)):[]})},854487:ve=>{w.kb("Gelu",ve,void 0)},854539:(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn)=>{w.kb("GroupQueryAttention",ve,{numHeads:Ve,kvNumHeads:Ct,scale:Ht,softcap:lr,doRotary:pn,rotaryInterleaved:Sn,smoothSoftmax:In,localWindowSize:Pn})},854756:(ve,Ve,Ct,Ht)=>{w.kb("LayerNormalization",ve,{axis:Ve,epsilon:Ct,simplified:!!Ht})},854867:(ve,Ve,Ct,Ht)=>{w.kb("LayerNormalization",ve,{axis:Ve,epsilon:Ct,simplified:!!Ht})},854978:(ve,Ve,Ct,Ht,lr,pn)=>{w.kb("MatMulNBits",ve,{k:Ve,n:Ct,accuracyLevel:Ht,bits:lr,blockSize:pn})},855105:(ve,Ve,Ct,Ht,lr,pn)=>{w.kb("MultiHeadAttention",ve,{numHeads:Ve,isUnidirectional:Ct,maskFilterValue:Ht,scale:lr,doRotary:pn})},855264:(ve,Ve)=>{w.kb("QuickGelu",ve,{alpha:Ve})},855328:(ve,Ve,Ct,Ht,lr)=>{w.kb("RotaryEmbedding",ve,{interleaved:!!Ve,numHeads:Ct,rotaryEmbeddingDim:Ht,scale:lr})},855467:(ve,Ve,Ct)=>{w.kb("SkipLayerNormalization",ve,{epsilon:Ve,simplified:!!Ct})},855569:(ve,Ve,Ct)=>{w.kb("SkipLayerNormalization",ve,{epsilon:Ve,simplified:!!Ct})},855671:(ve,Ve,Ct,Ht)=>{w.kb("GatherBlockQuantized",ve,{gatherAxis:Ve,quantizeAxis:Ct,blockSize:Ht})},855792:ve=>{w.$b(ve)},855826:(ve,Ve)=>w.bc(Number(ve),Number(Ve),w.Gb.ec,w.Gb.errors)};function ze(ve,Ve,Ct){return Ec(async()=>{await w.Yb(Number(ve),Number(Ve),Number(Ct))})}function ct(){return typeof wasmOffsetConverter<"u"}class ft{name="ExitStatus";constructor(Ve){this.message=`Program terminated with exit(${Ve})`,this.status=Ve}}var pr=ve=>{ve.terminate(),ve.onmessage=()=>{}},fn=[],vn=ve=>{Cn.length==0&&(yn(),mr(Cn[0]));var Ve=Cn.pop();if(!Ve)return 6;On.push(Ve),Tn[ve.Bb]=Ve,Ve.Bb=ve.Bb;var Ct={Cb:"run",hc:ve.fc,Ib:ve.Ib,Bb:ve.Bb};return Ve.postMessage(Ct,ve.Nb),0},En=0,bn=(ve,Ve,...Ct)=>{for(var Ht=2*Ct.length,lr=yc(),pn=yu(8*Ht),Sn=pn>>>3,In=0;In<Ct.length;In++){var Pn=Ct[In];typeof Pn=="bigint"?(Te[Sn+2*In]=1n,Te[Sn+2*In+1]=Pn):(Te[Sn+2*In]=0n,ur()[Sn+2*In+1>>>0]=Pn)}return ve=Vc(ve,0,Ht,pn,Ve),zo(lr),ve};function $n(ve){if(q)return bn(0,1,ve);if(ce=ve,!(0<En)){for(var Ve of On)pr(Ve);for(Ve of Cn)pr(Ve);Cn=[],On=[],Tn={},Mt=!0}Z(0,new ft(ve))}function xn(ve){if(q)return bn(1,0,ve);ti(ve)}var ti=ve=>{if(ce=ve,q)throw xn(ve),"unwind";$n(ve)},Cn=[],On=[],si=[],Tn={},or=ve=>{var Ve=ve.Bb;delete Tn[Ve],Cn.push(ve),On.splice(On.indexOf(ve),1),ve.Bb=0,Kc(Ve)};function kn(){si.forEach(ve=>ve())}var mr=ve=>new Promise(Ve=>{ve.onmessage=lr=>{var pn=(lr=lr.data).Cb;if(lr.Hb&&lr.Hb!=Bo()){var Sn=Tn[lr.Hb];Sn?Sn.postMessage(lr,lr.Nb):oe(`Internal error! Worker sent a message "${pn}" to target pthread ${lr.Hb}, but that thread no longer exists!`)}else pn==="checkMailbox"?Wi():pn==="spawnThread"?vn(lr):pn==="cleanupThread"?or(Tn[lr.ic]):pn==="loaded"?(ve.loaded=!0,Ve(ve)):pn==="alert"?alert(`Thread ${lr.jc}: ${lr.text}`):lr.target==="setimmediate"?ve.postMessage(lr):pn==="callHandler"?w[lr.Rb](...lr.args):pn&&oe(`worker sent an unknown command ${pn}`)},ve.onerror=lr=>{throw oe(`worker sent an error! ${lr.filename}:${lr.lineno}: ${lr.message}`),lr};var Ct,Ht=[];for(Ct of[])w.propertyIsEnumerable(Ct)&&Ht.push(Ct);ve.postMessage({Cb:"load",Sb:Ht,lc:ee,mc:ae})});function yn(){var ve=new Worker((()=>{let Ve=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new Ve("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});Cn.push(ve)}var Dt=ve=>{Ft();var Ve=gt()[ve+52>>>2>>>0];ve=gt()[ve+56>>>2>>>0],Qc(Ve,Ve-ve),zo(Ve)},wn=(ve,Ve)=>{En=0,ve=Jc(ve,Ve),0<En?ce=ve:Xo(ve)};class ii{constructor(Ve){this.Jb=Ve-24}}function Ze(ve,Ve,Ct){var Ht=new ii(ve>>>=0);throw Ve>>>=0,Ct>>>=0,gt()[Ht.Jb+16>>>2>>>0]=0,gt()[Ht.Jb+4>>>2>>>0]=Ve,gt()[Ht.Jb+8>>>2>>>0]=Ct,ve}function _n(ve,Ve,Ct,Ht){return q?bn(2,1,ve,Ve,Ct,Ht):hn(ve,Ve,Ct,Ht)}function hn(ve,Ve,Ct,Ht){if(ve>>>=0,Ct>>>=0,Ht>>>=0,j===void 0)return 6;var lr=[];return q&&lr.length===0?_n(ve,Ve>>>=0,Ct,Ht):(ve={fc:Ct,Bb:ve,Ib:Ht,Nb:lr},q?(ve.Cb="spawnThread",postMessage(ve,lr),0):vn(ve))}var cr=typeof TextDecoder<"u"?new TextDecoder:void 0,gn=(ve,Ve=0,Ct=NaN)=>{var Ht=(Ve>>>=0)+Ct;for(Ct=Ve;ve[Ct]&&!(Ct>=Ht);)++Ct;if(16<Ct-Ve&&ve.buffer&&cr)return cr.decode(ve.buffer instanceof ArrayBuffer?ve.subarray(Ve,Ct):ve.slice(Ve,Ct));for(Ht="";Ve<Ct;){var lr=ve[Ve++];if(128&lr){var pn=63&ve[Ve++];if((224&lr)==192)Ht+=String.fromCharCode((31&lr)<<6|pn);else{var Sn=63&ve[Ve++];65536>(lr=(240&lr)==224?(15&lr)<<12|pn<<6|Sn:(7&lr)<<18|pn<<12|Sn<<6|63&ve[Ve++])?Ht+=String.fromCharCode(lr):(lr-=65536,Ht+=String.fromCharCode(55296|lr>>10,56320|1023&lr))}}else Ht+=String.fromCharCode(lr)}return Ht},mn=(ve,Ve)=>(ve>>>=0)?gn(Ye(),ve,Ve):"";function ri(ve,Ve,Ct){return q?bn(3,1,ve,Ve,Ct):0}function An(ve,Ve){if(q)return bn(4,1,ve,Ve)}var ei=ve=>{for(var Ve=0,Ct=0;Ct<ve.length;++Ct){var Ht=ve.charCodeAt(Ct);127>=Ht?Ve++:2047>=Ht?Ve+=2:55296<=Ht&&57343>=Ht?(Ve+=4,++Ct):Ve+=3}return Ve},oi=(ve,Ve,Ct)=>{var Ht=Ye();if(Ve>>>=0,0<Ct){var lr=Ve;Ct=Ve+Ct-1;for(var pn=0;pn<ve.length;++pn){var Sn=ve.charCodeAt(pn);if(55296<=Sn&&57343>=Sn&&(Sn=65536+((1023&Sn)<<10)|1023&ve.charCodeAt(++pn)),127>=Sn){if(Ve>=Ct)break;Ht[Ve++>>>0]=Sn}else{if(2047>=Sn){if(Ve+1>=Ct)break;Ht[Ve++>>>0]=192|Sn>>6}else{if(65535>=Sn){if(Ve+2>=Ct)break;Ht[Ve++>>>0]=224|Sn>>12}else{if(Ve+3>=Ct)break;Ht[Ve++>>>0]=240|Sn>>18,Ht[Ve++>>>0]=128|Sn>>12&63}Ht[Ve++>>>0]=128|Sn>>6&63}Ht[Ve++>>>0]=128|63&Sn}}Ht[Ve>>>0]=0,ve=Ve-lr}else ve=0;return ve};function wi(ve,Ve){if(q)return bn(5,1,ve,Ve)}function ci(ve,Ve,Ct){if(q)return bn(6,1,ve,Ve,Ct)}function hi(ve,Ve,Ct){return q?bn(7,1,ve,Ve,Ct):0}function mi(ve,Ve){if(q)return bn(8,1,ve,Ve)}function gi(ve,Ve,Ct){if(q)return bn(9,1,ve,Ve,Ct)}function Ai(ve,Ve,Ct,Ht){if(q)return bn(10,1,ve,Ve,Ct,Ht)}function Ti(ve,Ve,Ct,Ht){if(q)return bn(11,1,ve,Ve,Ct,Ht)}function pi(ve,Ve,Ct,Ht){if(q)return bn(12,1,ve,Ve,Ct,Ht)}function bi(ve){if(q)return bn(13,1,ve)}function Si(ve,Ve){if(q)return bn(14,1,ve,Ve)}function _i(ve,Ve,Ct){if(q)return bn(15,1,ve,Ve,Ct)}var yi,di,Oi=()=>pt(""),ki=ve=>{for(var Ve="";Ye()[ve>>>0];)Ve+=yi[Ye()[ve++>>>0]];return Ve},Ri={},Di={};function Ei(ve,Ve,Ct={}){return(function(Ht,lr,pn={}){var Sn=lr.name;if(!Ht)throw new di(`type "${Sn}" must have a positive integer typeid pointer`);if(Di.hasOwnProperty(Ht)){if(pn.Tb)return;throw new di(`Cannot register type '${Sn}' twice`)}Di[Ht]=lr,Ri.hasOwnProperty(Ht)&&(lr=Ri[Ht],delete Ri[Ht],lr.forEach(In=>In()))})(ve,Ve,Ct)}var Li=(ve,Ve,Ct)=>{switch(Ve){case 1:return Ct?Ht=>ir()[Ht>>>0]:Ht=>Ye()[Ht>>>0];case 2:return Ct?Ht=>xt()[Ht>>>1>>>0]:Ht=>ar()[Ht>>>1>>>0];case 4:return Ct?Ht=>ht()[Ht>>>2>>>0]:Ht=>gt()[Ht>>>2>>>0];case 8:return Ct?Ht=>Te[Ht>>>3]:Ht=>Ce[Ht>>>3];default:throw new TypeError(`invalid integer width (${Ve}): ${ve}`)}};function Hi(ve,Ve,Ct){Ct>>>=0,Ei(ve>>>=0,{name:Ve=ki(Ve>>>0),fromWireType:Ht=>Ht,toWireType:function(Ht,lr){if(typeof lr!="bigint"&&typeof lr!="number")throw lr=lr===null?"null":(Ht=typeof lr)=="object"||Ht==="array"||Ht==="function"?lr.toString():""+lr,new TypeError(`Cannot convert "${lr}" to ${this.name}`);return typeof lr=="number"&&(lr=BigInt(lr)),lr},Db:Ii,readValueFromPointer:Li(Ve,Ct,Ve.indexOf("u")==-1),Eb:null})}var Ii=8;function tp(ve,Ve,Ct,Ht){Ei(ve>>>=0,{name:Ve=ki(Ve>>>0),fromWireType:function(lr){return!!lr},toWireType:function(lr,pn){return pn?Ct:Ht},Db:Ii,readValueFromPointer:function(lr){return this.fromWireType(Ye()[lr>>>0])},Eb:null})}var qo=[],Mi=[];function jo(ve){9<(ve>>>=0)&&--Mi[ve+1]==0&&(Mi[ve]=void 0,qo.push(ve))}var xi=ve=>{if(!ve)throw new di("Cannot use deleted val. handle = "+ve);return Mi[ve]},$i=ve=>{switch(ve){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let Ve=qo.pop()||Mi.length;return Mi[Ve]=ve,Mi[Ve+1]=1,Ve}};function Go(ve){return this.fromWireType(gt()[ve>>>2>>>0])}var rp={name:"emscripten::val",fromWireType:ve=>{var Ve=xi(ve);return jo(ve),Ve},toWireType:(ve,Ve)=>$i(Ve),Db:Ii,readValueFromPointer:Go,Eb:null};function np(ve){return Ei(ve>>>0,rp)}var ap=(ve,Ve)=>{switch(Ve){case 4:return function(Ct){return this.fromWireType(zt()[Ct>>>2>>>0])};case 8:return function(Ct){return this.fromWireType(ur()[Ct>>>3>>>0])};default:throw new TypeError(`invalid float width (${Ve}): ${ve}`)}};function sp(ve,Ve,Ct){Ct>>>=0,Ei(ve>>>=0,{name:Ve=ki(Ve>>>0),fromWireType:Ht=>Ht,toWireType:(Ht,lr)=>lr,Db:Ii,readValueFromPointer:ap(Ve,Ct),Eb:null})}function op(ve,Ve,Ct,Ht,lr){if(ve>>>=0,Ct>>>=0,Ve=ki(Ve>>>0),lr===-1&&(lr=4294967295),lr=In=>In,Ht===0){var pn=32-8*Ct;lr=In=>In<<pn>>>pn}var Sn=Ve.includes("unsigned")?function(In,Pn){return Pn>>>0}:function(In,Pn){return Pn};Ei(ve,{name:Ve,fromWireType:lr,toWireType:Sn,Db:Ii,readValueFromPointer:Li(Ve,Ct,Ht!==0),Eb:null})}function lp(ve,Ve,Ct){function Ht(pn){var Sn=gt()[pn>>>2>>>0];return pn=gt()[pn+4>>>2>>>0],new lr(ir().buffer,pn,Sn)}var lr=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][Ve];Ei(ve>>>=0,{name:Ct=ki(Ct>>>0),fromWireType:Ht,Db:Ii,readValueFromPointer:Ht},{Tb:!0})}function up(ve,Ve){Ei(ve>>>=0,{name:Ve=ki(Ve>>>0),fromWireType:function(Ct){for(var Ht,lr=gt()[Ct>>>2>>>0],pn=Ct+4,Sn=pn,In=0;In<=lr;++In){var Pn=pn+In;In!=lr&&Ye()[Pn>>>0]!=0||(Sn=mn(Sn,Pn-Sn),Ht===void 0?Ht=Sn:(Ht+="\0",Ht+=Sn),Sn=Pn+1)}return Ci(Ct),Ht},toWireType:function(Ct,Ht){Ht instanceof ArrayBuffer&&(Ht=new Uint8Array(Ht));var lr=typeof Ht=="string";if(!(lr||Ht instanceof Uint8Array||Ht instanceof Uint8ClampedArray||Ht instanceof Int8Array))throw new di("Cannot pass non-string to std::string");var pn=lr?ei(Ht):Ht.length,Sn=Lo(4+pn+1),In=Sn+4;if(gt()[Sn>>>2>>>0]=pn,lr)oi(Ht,In,pn+1);else if(lr)for(lr=0;lr<pn;++lr){var Pn=Ht.charCodeAt(lr);if(255<Pn)throw Ci(Sn),new di("String has UTF-16 code units that do not fit in 8 bits");Ye()[In+lr>>>0]=Pn}else for(lr=0;lr<pn;++lr)Ye()[In+lr>>>0]=Ht[lr];return Ct!==null&&Ct.push(Ci,Sn),Sn},Db:Ii,readValueFromPointer:Go,Eb(Ct){Ci(Ct)}})}var wc=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,cp=(ve,Ve)=>{for(var Ct=ve>>1,Ht=Ct+Ve/2;!(Ct>=Ht)&&ar()[Ct>>>0];)++Ct;if(32<(Ct<<=1)-ve&&wc)return wc.decode(Ye().slice(ve,Ct));for(Ct="",Ht=0;!(Ht>=Ve/2);++Ht){var lr=xt()[ve+2*Ht>>>1>>>0];if(lr==0)break;Ct+=String.fromCharCode(lr)}return Ct},dp=(ve,Ve,Ct)=>{if(Ct??=2147483647,2>Ct)return 0;var Ht=Ve;Ct=(Ct-=2)<2*ve.length?Ct/2:ve.length;for(var lr=0;lr<Ct;++lr){var pn=ve.charCodeAt(lr);xt()[Ve>>>1>>>0]=pn,Ve+=2}return xt()[Ve>>>1>>>0]=0,Ve-Ht},fp=ve=>2*ve.length,hp=(ve,Ve)=>{for(var Ct=0,Ht="";!(Ct>=Ve/4);){var lr=ht()[ve+4*Ct>>>2>>>0];if(lr==0)break;++Ct,65536<=lr?(lr-=65536,Ht+=String.fromCharCode(55296|lr>>10,56320|1023&lr)):Ht+=String.fromCharCode(lr)}return Ht},pp=(ve,Ve,Ct)=>{if(Ve>>>=0,Ct??=2147483647,4>Ct)return 0;var Ht=Ve;Ct=Ht+Ct-4;for(var lr=0;lr<ve.length;++lr){var pn=ve.charCodeAt(lr);if(55296<=pn&&57343>=pn&&(pn=65536+((1023&pn)<<10)|1023&ve.charCodeAt(++lr)),ht()[Ve>>>2>>>0]=pn,(Ve+=4)+4>Ct)break}return ht()[Ve>>>2>>>0]=0,Ve-Ht},mp=ve=>{for(var Ve=0,Ct=0;Ct<ve.length;++Ct){var Ht=ve.charCodeAt(Ct);55296<=Ht&&57343>=Ht&&++Ct,Ve+=4}return Ve};function gp(ve,Ve,Ct){if(ve>>>=0,Ve>>>=0,Ct=ki(Ct>>>=0),Ve===2)var Ht=cp,lr=dp,pn=fp,Sn=In=>ar()[In>>>1>>>0];else Ve===4&&(Ht=hp,lr=pp,pn=mp,Sn=In=>gt()[In>>>2>>>0]);Ei(ve,{name:Ct,fromWireType:In=>{for(var Pn,ni=gt()[In>>>2>>>0],li=In+4,ui=0;ui<=ni;++ui){var fi=In+4+ui*Ve;ui!=ni&&Sn(fi)!=0||(li=Ht(li,fi-li),Pn===void 0?Pn=li:(Pn+="\0",Pn+=li),li=fi+Ve)}return Ci(In),Pn},toWireType:(In,Pn)=>{if(typeof Pn!="string")throw new di(`Cannot pass non-string to C++ string type ${Ct}`);var ni=pn(Pn),li=Lo(4+ni+Ve);return gt()[li>>>2>>>0]=ni/Ve,lr(Pn,li+4,ni+Ve),In!==null&&In.push(Ci,li),li},Db:Ii,readValueFromPointer:Go,Eb(In){Ci(In)}})}function yp(ve,Ve){Ei(ve>>>=0,{Ub:!0,name:Ve=ki(Ve>>>0),Db:0,fromWireType:()=>{},toWireType:()=>{}})}function bp(ve){Jo(ve>>>0,!D,1,!I,131072,!1),kn()}var Ho=ve=>{if(!Mt)try{if(ve(),!(0<En))try{q?Xo(ce):ti(ce)}catch(Ve){Ve instanceof ft||Ve=="unwind"||Z(0,Ve)}}catch(Ve){Ve instanceof ft||Ve=="unwind"||Z(0,Ve)}};function Wo(ve){ve>>>=0,typeof Atomics.kc=="function"&&(Atomics.kc(ht(),ve>>>2,ve).value.then(Wi),ve+=128,Atomics.store(ht(),ve>>>2,1))}var Wi=()=>{var ve=Bo();ve&&(Wo(ve),Ho(Yc))};function _p(ve,Ve){(ve>>>=0)==Ve>>>0?setTimeout(Wi):q?postMessage({Hb:ve,Cb:"checkMailbox"}):(ve=Tn[ve])&&ve.postMessage({Cb:"checkMailbox"})}var Vo=[];function wp(ve,Ve,Ct,Ht,lr){for(Ve>>>=0,Ht/=2,Vo.length=Ht,Ct=lr>>>0>>>3,lr=0;lr<Ht;lr++)Vo[lr]=Te[Ct+2*lr]?Te[Ct+2*lr+1]:ur()[Ct+2*lr+1>>>0];return(Ve?Ee[Ve]:$0[ve])(...Vo)}var vp=()=>{En=0};function xp(ve){ve>>>=0,q?postMessage({Cb:"cleanupThread",ic:ve}):or(Tn[ve])}function Sp(ve){}var Vi=(ve,Ve)=>{var Ct=Di[ve];if(Ct===void 0)throw ve=Gc(ve),Ct=ki(ve),Ci(ve),new di(`${Ve} has unknown type ${Ct}`);return Ct},vc=(ve,Ve,Ct)=>{var Ht=[];return ve=ve.toWireType(Ht,Ct),Ht.length&&(gt()[Ve>>>2>>>0]=$i(Ht)),ve};function kp(ve,Ve,Ct){return Ve>>>=0,Ct>>>=0,ve=xi(ve>>>0),Ve=Vi(Ve,"emval::as"),vc(Ve,Ct,ve)}function Ep(ve,Ve){return Ve>>>=0,ve=xi(ve>>>0),(Ve=Vi(Ve,"emval::as")).toWireType(null,ve)}var Xa=ve=>{try{ve()}catch(Ve){pt(Ve)}},Ni=0,Pi=null,xc=0,Mo=[],Sc={},kc={},$p=0,Ko=null,Ip=[];function Ec(ve){return(function(Ve){if(!Mt){if(Ni===0){var Ct=!1,Ht=!1;Ve((lr=0)=>{if(!Mt&&(xc=lr,Ct=!0,Ht)){Ni=2,Xa(()=>th(Pi)),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.resume(),lr=!1;try{var pn=(function(){var Pn=ht()[Pi+8>>>2>>>0];return Pn=ai[kc[Pn]],--En,Pn()})()}catch(Pn){pn=Pn,lr=!0}var Sn=!1;if(!Pi){var In=Ko;In&&(Ko=null,(lr?In.reject:In.resolve)(pn),Sn=!0)}if(lr&&!Sn)throw pn}}),Ht=!0,Ct||(Ni=1,Pi=(function(){var lr=Lo(65548),pn=lr+12;gt()[lr>>>2>>>0]=pn,gt()[lr+4>>>2>>>0]=pn+65536,pn=Mo[0];var Sn=Sc[pn];return Sn===void 0&&(Sn=$p++,Sc[pn]=Sn,kc[Sn]=pn),pn=Sn,ht()[lr+8>>>2>>>0]=pn,lr})(),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.pause(),Xa(()=>Xc(Pi)))}else Ni===2?(Ni=0,Xa(rh),Ci(Pi),Pi=null,Ip.forEach(Ho)):pt(`invalid state: ${Ni}`);return xc}})(Ve=>{ve().then(Ve)})}function Ap(ve){return ve>>>=0,Ec(async()=>{var Ve=await xi(ve);return $i(Ve)})}var Oo=[];function Tp(ve,Ve,Ct,Ht){return Ct>>>=0,Ht>>>=0,(ve=Oo[ve>>>0])(null,Ve=xi(Ve>>>0),Ct,Ht)}var Pp={},No=ve=>{var Ve=Pp[ve];return Ve===void 0?ki(ve):Ve};function Cp(ve,Ve,Ct,Ht,lr){return Ct>>>=0,Ht>>>=0,lr>>>=0,(ve=Oo[ve>>>0])(Ve=xi(Ve>>>0),Ve[Ct=No(Ct)],Ht,lr)}function Mp(ve,Ve){return Ve>>>=0,(ve=xi(ve>>>0))==xi(Ve)}var $c=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Op(ve){return(ve>>>=0)==0?$i($c()):(ve=No(ve),$i($c()[ve]))}var Np=ve=>{var Ve=Oo.length;return Oo.push(ve),Ve},Rp=(ve,Ve)=>{for(var Ct=Array(ve),Ht=0;Ht<ve;++Ht)Ct[Ht]=Vi(gt()[Ve+4*Ht>>>2>>>0],"parameter "+Ht);return Ct},Ic=(ve,Ve)=>Object.defineProperty(Ve,"name",{value:ve});function Dp(ve,Ve,Ct){var Ht=(Ve=Rp(ve,Ve>>>0)).shift();ve--;var lr=`return function (obj, func, destructorsRef, args) {
`,pn=0,Sn=[];Ct===0&&Sn.push("obj");for(var In=["retType"],Pn=[Ht],ni=0;ni<ve;++ni)Sn.push("arg"+ni),In.push("argType"+ni),Pn.push(Ve[ni]),lr+=`  var arg${ni} = argType${ni}.readValueFromPointer(args${pn?"+"+pn:""});
`,pn+=Ve[ni].Db;return lr+=`  var rv = ${Ct===1?"new func":"func.call"}(${Sn.join(", ")});
`,Ht.Ub||(In.push("emval_returnValue"),Pn.push(vc),lr+=`  return emval_returnValue(retType, destructorsRef, rv);
`),In.push(lr+`};
`),ve=(function(li){var ui=Function;if(!(ui instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof ui} which is not a function`);var fi=Ic(ui.name||"unknownFunctionName",function(){});return fi.prototype=ui.prototype,fi=new fi,(li=ui.apply(fi,li))instanceof Object?li:fi})(In)(...Pn),Ct=`methodCaller<(${Ve.map(li=>li.name).join(", ")}) => ${Ht.name}>`,Np(Ic(Ct,ve))}function Bp(ve){return ve=No(ve>>>0),$i(w[ve])}function zp(ve,Ve){return Ve>>>=0,ve=xi(ve>>>0),Ve=xi(Ve),$i(ve[Ve])}function Up(ve){9<(ve>>>=0)&&(Mi[ve+1]+=1)}function e0(){return $i([])}function t0(ve){ve=xi(ve>>>0);for(var Ve=Array(ve.length),Ct=0;Ct<ve.length;Ct++)Ve[Ct]=ve[Ct];return $i(Ve)}function r0(ve){return $i(No(ve>>>0))}function n0(){return $i({})}function i0(ve){for(var Ve=xi(ve>>>=0);Ve.length;){var Ct=Ve.pop();Ve.pop()(Ct)}jo(ve)}function a0(ve,Ve,Ct){Ve>>>=0,Ct>>>=0,ve=xi(ve>>>0),Ve=xi(Ve),Ct=xi(Ct),ve[Ve]=Ct}function s0(ve,Ve){return Ve>>>=0,ve=(ve=Vi(ve>>>0,"_emval_take_value")).readValueFromPointer(Ve),$i(ve)}function o0(ve,Ve){ve=-9007199254740992>ve||9007199254740992<ve?NaN:Number(ve),Ve>>>=0,ve=new Date(1e3*ve),ht()[Ve>>>2>>>0]=ve.getUTCSeconds(),ht()[Ve+4>>>2>>>0]=ve.getUTCMinutes(),ht()[Ve+8>>>2>>>0]=ve.getUTCHours(),ht()[Ve+12>>>2>>>0]=ve.getUTCDate(),ht()[Ve+16>>>2>>>0]=ve.getUTCMonth(),ht()[Ve+20>>>2>>>0]=ve.getUTCFullYear()-1900,ht()[Ve+24>>>2>>>0]=ve.getUTCDay(),ve=(ve.getTime()-Date.UTC(ve.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,ht()[Ve+28>>>2>>>0]=ve}var Ac=ve=>ve%4==0&&(ve%100!=0||ve%400==0),Tc=[0,31,60,91,121,152,182,213,244,274,305,335],Pc=[0,31,59,90,120,151,181,212,243,273,304,334];function l0(ve,Ve){ve=-9007199254740992>ve||9007199254740992<ve?NaN:Number(ve),Ve>>>=0,ve=new Date(1e3*ve),ht()[Ve>>>2>>>0]=ve.getSeconds(),ht()[Ve+4>>>2>>>0]=ve.getMinutes(),ht()[Ve+8>>>2>>>0]=ve.getHours(),ht()[Ve+12>>>2>>>0]=ve.getDate(),ht()[Ve+16>>>2>>>0]=ve.getMonth(),ht()[Ve+20>>>2>>>0]=ve.getFullYear()-1900,ht()[Ve+24>>>2>>>0]=ve.getDay();var Ct=(Ac(ve.getFullYear())?Tc:Pc)[ve.getMonth()]+ve.getDate()-1|0;ht()[Ve+28>>>2>>>0]=Ct,ht()[Ve+36>>>2>>>0]=-60*ve.getTimezoneOffset(),Ct=new Date(ve.getFullYear(),6,1).getTimezoneOffset();var Ht=new Date(ve.getFullYear(),0,1).getTimezoneOffset();ve=0|(Ct!=Ht&&ve.getTimezoneOffset()==Math.min(Ht,Ct)),ht()[Ve+32>>>2>>>0]=ve}function u0(ve){ve>>>=0;var Ve=new Date(ht()[ve+20>>>2>>>0]+1900,ht()[ve+16>>>2>>>0],ht()[ve+12>>>2>>>0],ht()[ve+8>>>2>>>0],ht()[ve+4>>>2>>>0],ht()[ve>>>2>>>0],0),Ct=ht()[ve+32>>>2>>>0],Ht=Ve.getTimezoneOffset(),lr=new Date(Ve.getFullYear(),6,1).getTimezoneOffset(),pn=new Date(Ve.getFullYear(),0,1).getTimezoneOffset(),Sn=Math.min(pn,lr);return 0>Ct?ht()[ve+32>>>2>>>0]=+(lr!=pn&&Sn==Ht):0<Ct!=(Sn==Ht)&&(lr=Math.max(pn,lr),Ve.setTime(Ve.getTime()+6e4*((0<Ct?Sn:lr)-Ht))),ht()[ve+24>>>2>>>0]=Ve.getDay(),Ct=(Ac(Ve.getFullYear())?Tc:Pc)[Ve.getMonth()]+Ve.getDate()-1|0,ht()[ve+28>>>2>>>0]=Ct,ht()[ve>>>2>>>0]=Ve.getSeconds(),ht()[ve+4>>>2>>>0]=Ve.getMinutes(),ht()[ve+8>>>2>>>0]=Ve.getHours(),ht()[ve+12>>>2>>>0]=Ve.getDate(),ht()[ve+16>>>2>>>0]=Ve.getMonth(),ht()[ve+20>>>2>>>0]=Ve.getYear(),ve=Ve.getTime(),BigInt(isNaN(ve)?-1:ve/1e3)}function Cc(ve,Ve,Ct,Ht,lr,pn,Sn){return q?bn(16,1,ve,Ve,Ct,Ht,lr,pn,Sn):-52}function Mc(ve,Ve,Ct,Ht,lr,pn){if(q)return bn(17,1,ve,Ve,Ct,Ht,lr,pn)}var zi={},c0=()=>performance.timeOrigin+performance.now();function Oc(ve,Ve){if(q)return bn(18,1,ve,Ve);if(zi[ve]&&(clearTimeout(zi[ve].id),delete zi[ve]),!Ve)return 0;var Ct=setTimeout(()=>{delete zi[ve],Ho(()=>Zc(ve,performance.timeOrigin+performance.now()))},Ve);return zi[ve]={id:Ct,rc:Ve},0}function d0(ve,Ve,Ct,Ht){ve>>>=0,Ve>>>=0,Ct>>>=0,Ht>>>=0;var lr=new Date().getFullYear(),pn=new Date(lr,0,1).getTimezoneOffset();lr=new Date(lr,6,1).getTimezoneOffset();var Sn=Math.max(pn,lr);gt()[ve>>>2>>>0]=60*Sn,ht()[Ve>>>2>>>0]=+(pn!=lr),ve=(Ve=In=>{var Pn=Math.abs(In);return`UTC${0<=In?"-":"+"}${String(Math.floor(Pn/60)).padStart(2,"0")}${String(Pn%60).padStart(2,"0")}`})(pn),Ve=Ve(lr),lr<pn?(oi(ve,Ct,17),oi(Ve,Ht,17)):(oi(ve,Ht,17),oi(Ve,Ct,17))}var f0=()=>Date.now();function h0(ve,Ve,Ct){return 0<=ve&&3>=ve?(ve===0?ve=Date.now():ve=performance.timeOrigin+performance.now(),Te[Ct>>>0>>>3]=BigInt(Math.round(1e6*ve)),0):28}var Zo=[],Nc=(ve,Ve)=>{Zo.length=0;for(var Ct;Ct=Ye()[ve++>>>0];){var Ht=Ct!=105;Ve+=(Ht&=Ct!=112)&&Ve%8?4:0,Zo.push(Ct==112?gt()[Ve>>>2>>>0]:Ct==106?Te[Ve>>>3]:Ct==105?ht()[Ve>>>2>>>0]:ur()[Ve>>>3>>>0]),Ve+=Ht?8:4}return Zo};function p0(ve,Ve,Ct){return ve>>>=0,Ve=Nc(Ve>>>0,Ct>>>0),Ee[ve](...Ve)}function m0(ve,Ve,Ct){return ve>>>=0,Ve=Nc(Ve>>>0,Ct>>>0),Ee[ve](...Ve)}var g0=()=>{};function y0(ve,Ve){return oe(mn(ve>>>0,Ve>>>0))}var b0=()=>{throw En+=1,"unwind"};function _0(){return 4294901760}var w0=()=>navigator.hardwareConcurrency;function v0(){return pt("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function x0(ve){ve>>>=0;var Ve=Ye().length;if(ve<=Ve||4294901760<ve)return!1;for(var Ct=1;4>=Ct;Ct*=2){var Ht=Ve*(1+.2/Ct);Ht=Math.min(Ht,ve+100663296);e:{Ht=(Math.min(4294901760,65536*Math.ceil(Math.max(ve,Ht)/65536))-ee.buffer.byteLength+65535)/65536|0;try{ee.grow(Ht),Ft();var lr=1;break e}catch{}lr=void 0}if(lr)return!0}return!1}var Ro=()=>(pt("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Ui={},Rc=ve=>{ve.forEach(Ve=>{Ro()})};function S0(){var ve=Error().stack.toString().split(`
`);return ve[0]=="Error"&&ve.shift(),Rc(ve),Ui.Mb=Ro(),Ui.dc=ve,Ui.Mb}function k0(ve,Ve,Ct){if(ve>>>=0,Ve>>>=0,Ui.Mb==ve)var Ht=Ui.dc;else(Ht=Error().stack.toString().split(`
`))[0]=="Error"&&Ht.shift(),Rc(Ht);for(var lr=3;Ht[lr]&&Ro()!=ve;)++lr;for(ve=0;ve<Ct&&Ht[ve+lr];++ve)ht()[Ve+4*ve>>>2>>>0]=Ro();return ve}var Yo,Qo={},Dc=()=>{if(!Yo){var ve,Ve={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(ve in Qo)Qo[ve]===void 0?delete Ve[ve]:Ve[ve]=Qo[ve];var Ct=[];for(ve in Ve)Ct.push(`${ve}=${Ve[ve]}`);Yo=Ct}return Yo};function Bc(ve,Ve){if(q)return bn(19,1,ve,Ve);ve>>>=0,Ve>>>=0;var Ct=0;return Dc().forEach((Ht,lr)=>{var pn=Ve+Ct;for(lr=gt()[ve+4*lr>>>2>>>0]=pn,pn=0;pn<Ht.length;++pn)ir()[lr++>>>0]=Ht.charCodeAt(pn);ir()[lr>>>0]=0,Ct+=Ht.length+1}),0}function Lc(ve,Ve){if(q)return bn(20,1,ve,Ve);ve>>>=0,Ve>>>=0;var Ct=Dc();gt()[ve>>>2>>>0]=Ct.length;var Ht=0;return Ct.forEach(lr=>Ht+=lr.length+1),gt()[Ve>>>2>>>0]=Ht,0}function zc(ve){return q?bn(21,1,ve):52}function Fc(ve,Ve,Ct,Ht){return q?bn(22,1,ve,Ve,Ct,Ht):52}function Uc(ve,Ve,Ct,Ht){return q?bn(23,1,ve,Ve,Ct,Ht):70}var E0=[null,[],[]];function qc(ve,Ve,Ct,Ht){if(q)return bn(24,1,ve,Ve,Ct,Ht);Ve>>>=0,Ct>>>=0,Ht>>>=0;for(var lr=0,pn=0;pn<Ct;pn++){var Sn=gt()[Ve>>>2>>>0],In=gt()[Ve+4>>>2>>>0];Ve+=8;for(var Pn=0;Pn<In;Pn++){var ni=Ye()[Sn+Pn>>>0],li=E0[ve];ni===0||ni===10?((ve===1?se:oe)(gn(li)),li.length=0):li.push(ni)}lr+=In}return gt()[Ht>>>2>>>0]=lr,0}q||(function(){for(var ve=w.numThreads-1;ve--;)yn();fn.unshift(()=>{Qe++,(function(Ve){q?Ve():Promise.all(Cn.map(mr)).then(Ve)})(()=>at())})})();for(var jc=Array(256),Do=0;256>Do;++Do)jc[Do]=String.fromCharCode(Do);yi=jc,di=w.BindingError=class extends Error{constructor(ve){super(ve),this.name="BindingError"}},w.InternalError=class extends Error{constructor(ve){super(ve),this.name="InternalError"}},Mi.push(0,1,void 0,1,null,1,!0,1,!1,1),w.count_emval_handles=()=>Mi.length/2-5-qo.length;var ai,$0=[$n,xn,_n,ri,An,wi,ci,hi,mi,gi,Ai,Ti,pi,bi,Si,_i,Cc,Mc,Oc,Bc,Lc,zc,Fc,Uc,qc];(async function(){function ve(Ht,lr){return ai=Ht.exports,ai=(function(){var pn=ai,Sn={};for(let[In,Pn]of Object.entries(pn))Sn[In]=typeof Pn=="function"?(...ni)=>{Mo.push(In);try{return Pn(...ni)}finally{Mt||(Mo.pop(),Pi&&Ni===1&&Mo.length===0&&(Ni=0,En+=1,Xa(of),typeof Fibers<"u"&&Fibers.sc()))}}:Pn;return Sn})(),ai=(function(){var pn=ai,Sn=Pn=>ni=>Pn(ni)>>>0,In=Pn=>()=>Pn()>>>0;return(pn=Object.assign({},pn)).Ea=Sn(pn.Ea),pn.gb=In(pn.gb),pn.ib=Sn(pn.ib),pn.ub=Sn(pn.ub),pn.vb=In(pn.vb),pn.__cxa_get_exception_ptr=Sn(pn.__cxa_get_exception_ptr),pn})(),si.push(ai.jb),ae=lr,at(),ai}Qe++;var Ve=sr();if(w.instantiateWasm)return new Promise(Ht=>{w.instantiateWasm(Ve,(lr,pn)=>{ve(lr,pn),Ht(lr.exports)})});if(q)return new Promise(Ht=>{dr=lr=>{var pn=new WebAssembly.Instance(lr,sr());Ht(ve(pn,lr))}});Bt??=w.locateFile?w.locateFile?w.locateFile("ort-wasm-simd-threaded.jsep.wasm",Q):Q+"ort-wasm-simd-threaded.jsep.wasm":new URL(""+new URL("assets/ort-wasm-simd-threaded.jsep-CLPRrI3A.wasm",import.meta.url).href,import.meta.url).href;try{var Ct=await(async function(Ht){var lr=Bt;if(!bt&&typeof WebAssembly.instantiateStreaming=="function"&&!lt(lr))try{var pn=fetch(lr,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(pn,Ht)}catch(Sn){oe(`wasm streaming compile failed: ${Sn}`),oe("falling back to ArrayBuffer instantiation")}return(async function(Sn,In){try{var Pn=await(async function(ni){if(!bt)try{var li=await W(ni);return new Uint8Array(li)}catch{}if(ni==Bt&&bt)ni=new Uint8Array(bt);else{if(!V)throw"both async and sync fetching of the wasm failed";ni=V(ni)}return ni})(Sn);return await WebAssembly.instantiate(Pn,In)}catch(ni){oe(`failed to asynchronously prepare wasm: ${ni}`),pt(ni)}})(lr,Ht)})(Ve);return ve(Ct.instance,Ct.module)}catch(Ht){return g(Ht),Promise.reject(Ht)}})();var Gc=ve=>(Gc=ai.Ea)(ve),Hc=()=>(Hc=ai.Fa)();w._OrtInit=(ve,Ve)=>(w._OrtInit=ai.Ga)(ve,Ve),w._OrtGetLastError=(ve,Ve)=>(w._OrtGetLastError=ai.Ha)(ve,Ve),w._OrtCreateSessionOptions=(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni)=>(w._OrtCreateSessionOptions=ai.Ia)(ve,Ve,Ct,Ht,lr,pn,Sn,In,Pn,ni),w._OrtAppendExecutionProvider=(ve,Ve,Ct,Ht,lr)=>(w._OrtAppendExecutionProvider=ai.Ja)(ve,Ve,Ct,Ht,lr),w._OrtAddFreeDimensionOverride=(ve,Ve,Ct)=>(w._OrtAddFreeDimensionOverride=ai.Ka)(ve,Ve,Ct),w._OrtAddSessionConfigEntry=(ve,Ve,Ct)=>(w._OrtAddSessionConfigEntry=ai.La)(ve,Ve,Ct),w._OrtReleaseSessionOptions=ve=>(w._OrtReleaseSessionOptions=ai.Ma)(ve),w._OrtCreateSession=(ve,Ve,Ct)=>(w._OrtCreateSession=ai.Na)(ve,Ve,Ct),w._OrtReleaseSession=ve=>(w._OrtReleaseSession=ai.Oa)(ve),w._OrtGetInputOutputCount=(ve,Ve,Ct)=>(w._OrtGetInputOutputCount=ai.Pa)(ve,Ve,Ct),w._OrtGetInputOutputMetadata=(ve,Ve,Ct,Ht)=>(w._OrtGetInputOutputMetadata=ai.Qa)(ve,Ve,Ct,Ht),w._OrtFree=ve=>(w._OrtFree=ai.Ra)(ve),w._OrtCreateTensor=(ve,Ve,Ct,Ht,lr,pn)=>(w._OrtCreateTensor=ai.Sa)(ve,Ve,Ct,Ht,lr,pn),w._OrtGetTensorData=(ve,Ve,Ct,Ht,lr)=>(w._OrtGetTensorData=ai.Ta)(ve,Ve,Ct,Ht,lr),w._OrtReleaseTensor=ve=>(w._OrtReleaseTensor=ai.Ua)(ve),w._OrtCreateRunOptions=(ve,Ve,Ct,Ht)=>(w._OrtCreateRunOptions=ai.Va)(ve,Ve,Ct,Ht),w._OrtAddRunConfigEntry=(ve,Ve,Ct)=>(w._OrtAddRunConfigEntry=ai.Wa)(ve,Ve,Ct),w._OrtReleaseRunOptions=ve=>(w._OrtReleaseRunOptions=ai.Xa)(ve),w._OrtCreateBinding=ve=>(w._OrtCreateBinding=ai.Ya)(ve),w._OrtBindInput=(ve,Ve,Ct)=>(w._OrtBindInput=ai.Za)(ve,Ve,Ct),w._OrtBindOutput=(ve,Ve,Ct,Ht)=>(w._OrtBindOutput=ai._a)(ve,Ve,Ct,Ht),w._OrtClearBoundOutputs=ve=>(w._OrtClearBoundOutputs=ai.$a)(ve),w._OrtReleaseBinding=ve=>(w._OrtReleaseBinding=ai.ab)(ve),w._OrtRunWithBinding=(ve,Ve,Ct,Ht,lr)=>(w._OrtRunWithBinding=ai.bb)(ve,Ve,Ct,Ht,lr),w._OrtRun=(ve,Ve,Ct,Ht,lr,pn,Sn,In)=>(w._OrtRun=ai.cb)(ve,Ve,Ct,Ht,lr,pn,Sn,In),w._OrtEndProfiling=ve=>(w._OrtEndProfiling=ai.db)(ve),w._JsepOutput=(ve,Ve,Ct)=>(w._JsepOutput=ai.eb)(ve,Ve,Ct),w._JsepGetNodeName=ve=>(w._JsepGetNodeName=ai.fb)(ve);var Bo=()=>(Bo=ai.gb)(),Ci=w._free=ve=>(Ci=w._free=ai.hb)(ve),Lo=w._malloc=ve=>(Lo=w._malloc=ai.ib)(ve),Jo=(ve,Ve,Ct,Ht,lr,pn)=>(Jo=ai.lb)(ve,Ve,Ct,Ht,lr,pn),Wc=()=>(Wc=ai.mb)(),Vc=(ve,Ve,Ct,Ht,lr)=>(Vc=ai.nb)(ve,Ve,Ct,Ht,lr),Kc=ve=>(Kc=ai.ob)(ve),Xo=ve=>(Xo=ai.pb)(ve),Zc=(ve,Ve)=>(Zc=ai.qb)(ve,Ve),Yc=()=>(Yc=ai.rb)(),Qc=(ve,Ve)=>(Qc=ai.sb)(ve,Ve),zo=ve=>(zo=ai.tb)(ve),yu=ve=>(yu=ai.ub)(ve),yc=()=>(yc=ai.vb)(),Jc=w.dynCall_ii=(ve,Ve)=>(Jc=w.dynCall_ii=ai.wb)(ve,Ve),Xc=ve=>(Xc=ai.xb)(ve),of=()=>(of=ai.yb)(),th=ve=>(th=ai.zb)(ve),rh=()=>(rh=ai.Ab)();return w.stackSave=()=>yc(),w.stackRestore=ve=>zo(ve),w.stackAlloc=ve=>yu(ve),w.setValue=function(ve,Ve,Ct="i8"){switch(Ct.endsWith("*")&&(Ct="*"),Ct){case"i1":case"i8":ir()[ve>>>0]=Ve;break;case"i16":xt()[ve>>>1>>>0]=Ve;break;case"i32":ht()[ve>>>2>>>0]=Ve;break;case"i64":Te[ve>>>3]=BigInt(Ve);break;case"float":zt()[ve>>>2>>>0]=Ve;break;case"double":ur()[ve>>>3>>>0]=Ve;break;case"*":gt()[ve>>>2>>>0]=Ve;break;default:pt(`invalid type for setValue: ${Ct}`)}},w.getValue=function(ve,Ve="i8"){switch(Ve.endsWith("*")&&(Ve="*"),Ve){case"i1":case"i8":return ir()[ve>>>0];case"i16":return xt()[ve>>>1>>>0];case"i32":return ht()[ve>>>2>>>0];case"i64":return Te[ve>>>3];case"float":return zt()[ve>>>2>>>0];case"double":return ur()[ve>>>3>>>0];case"*":return gt()[ve>>>2>>>0];default:pt(`invalid type for getValue: ${Ve}`)}},w.UTF8ToString=mn,w.stringToUTF8=oi,w.lengthBytesUTF8=ei,(function ve(){if(0<Qe)st=ve;else if(q)m(w),$e();else{for(;0<fn.length;)fn.shift()(w);0<Qe?st=ve:(w.calledRun=!0,Mt||($e(),m(w)))}})(),w.PTR_SIZE=4,$}),Kp=Sa,jp=globalThis.self?.name?.startsWith("em-pthread"),jp&&Sa()}),ka,Hn,Zp,Ue,Ea,Gn,Qp,Yp,Pa,Xp,Ca,Oa,Aa,za,wr=U(()=>{_r(),ka=typeof location>"u"?void 0:location.origin,Hn=import.meta.url>"file:"&&import.meta.url<"file;",Zp=()=>{{if(Hn){let d=URL;return new URL(new d("ort.bundle.min.mjs",import.meta.url).href,ka).href}return import.meta.url}},Ue=Zp(),Ea=()=>{if(Ue&&!Ue.startsWith("blob:"))return Ue.substring(0,Ue.lastIndexOf("/")+1)},Gn=(d,m)=>{try{let g=m??Ue;return(g?new URL(d,g):new URL(d)).origin===ka}catch{return!1}},Qp=(d,m)=>{let g=m??Ue;try{return(g?new URL(d,g):new URL(d)).href}catch{return}},Yp=(d,m)=>`${m??"./"}${d}`,Pa=async d=>{let m=await(await fetch(d,{credentials:"same-origin"})).blob();return URL.createObjectURL(m)},Xp=async d=>(await import(d)).default,Ca=(xa(),qt($a)).default,Oa=async()=>{if(!Ue)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Gn(Ue))return[void 0,Ca()];let d=await Pa(Ue);return[d,Ca(d)]},Aa=(Ia(),qt(Ta)).default,za=async(d,m,g)=>{if(!d&&!m&&Aa&&Ue&&Gn(Ue))return[void 0,Aa];{let w="ort-wasm-simd-threaded.jsep.mjs",$=d??Qp(w,m),I=g&&$&&!Gn($,m),D=I?await Pa($):$??Yp(w,m);return[I?D:void 0,await Xp(D)]}}}),Fn,qn,kr,Da,Jp,em,tm,vr,ge,yt=U(()=>{wr(),qn=!1,kr=!1,Da=!1,Jp=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},em=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},tm=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},vr=async d=>{if(qn)return Promise.resolve();if(kr)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Da)throw new Error("previous call to 'initializeWebAssembly()' failed.");kr=!0;let m=d.initTimeout,g=d.numThreads;if(d.simd!==!1){if(d.simd==="relaxed"){if(!tm())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!em())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let w=Jp();g>1&&!w&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+g+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),d.numThreads=g=1);let $=d.wasmPaths,I=typeof $=="string"?$:void 0,D=$?.mjs,q=D?.href??D,j=$?.wasm,G=j?.href??j,H=d.wasmBinary,[W,V]=await za(q,I,g>1),K=!1,Z=[];if(m>0&&Z.push(new Promise(Q=>{setTimeout(()=>{K=!0,Q()},m)})),Z.push(new Promise((Q,J)=>{let re={numThreads:g};if(H)re.wasmBinary=H;else if(G||I)re.locateFile=se=>G??I+se;else if(q&&q.indexOf("blob:")!==0)re.locateFile=se=>new URL(se,q).href;else if(W){let se=Ea();se&&(re.locateFile=oe=>se+oe)}V(re).then(se=>{kr=!1,qn=!0,Fn=se,Q(),W&&URL.revokeObjectURL(W)},se=>{kr=!1,Da=!0,J(se)})})),await Promise.race(Z),K)throw new Error(`WebAssembly backend initializing failed due to timeout: ${m}ms`)},ge=()=>{if(qn&&Fn)return Fn;throw new Error("WebAssembly is not initialized yet.")}}),Ne,Zt,fe,Er=U(()=>{yt(),Ne=(d,m)=>{let g=ge(),w=g.lengthBytesUTF8(d)+1,$=g._malloc(w);return g.stringToUTF8(d,$,w),m.push($),$},Zt=(d,m,g,w)=>{if(typeof d=="object"&&d!==null){if(g.has(d))throw new Error("Circular reference in options");g.add(d)}Object.entries(d).forEach(([$,I])=>{let D=m?m+$:$;if(typeof I=="object")Zt(I,D+".",g,w);else if(typeof I=="string"||typeof I=="number")w(D,I.toString());else if(typeof I=="boolean")w(D,I?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof I}`)})},fe=d=>{let m=ge(),g=m.stackSave();try{let w=m.PTR_SIZE,$=m.stackAlloc(2*w);m._OrtGetLastError($,$+w);let I=Number(m.getValue($,w===4?"i32":"i64")),D=m.getValue($+w,"*"),q=D?m.UTF8ToString(D):"";throw new Error(`${d} ERROR_CODE: ${I}, ERROR_MESSAGE: ${q}`)}finally{m.stackRestore(g)}}}),Ba,Ma=U(()=>{yt(),Er(),Ba=d=>{let m=ge(),g=0,w=[],$=d||{};try{if(d?.logSeverityLevel===void 0)$.logSeverityLevel=2;else if(typeof d.logSeverityLevel!="number"||!Number.isInteger(d.logSeverityLevel)||d.logSeverityLevel<0||d.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${d.logSeverityLevel}`);if(d?.logVerbosityLevel===void 0)$.logVerbosityLevel=0;else if(typeof d.logVerbosityLevel!="number"||!Number.isInteger(d.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${d.logVerbosityLevel}`);d?.terminate===void 0&&($.terminate=!1);let I=0;return d?.tag!==void 0&&(I=Ne(d.tag,w)),g=m._OrtCreateRunOptions($.logSeverityLevel,$.logVerbosityLevel,!!$.terminate,I),g===0&&fe("Can't create run options."),d?.extra!==void 0&&Zt(d.extra,"",new WeakSet,(D,q)=>{let j=Ne(D,w),G=Ne(q,w);m._OrtAddRunConfigEntry(g,j,G)!==0&&fe(`Can't set a run config entry: ${D} - ${q}.`)}),[g,w]}catch(I){throw g!==0&&m._OrtReleaseRunOptions(g),w.forEach(D=>m._free(D)),I}}}),rm,nm,om,Pr,im,Ra,Ua=U(()=>{yt(),Er(),rm=d=>{switch(d){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${d}`)}},nm=d=>{switch(d){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${d}`)}},om=d=>{d.extra||(d.extra={}),d.extra.session||(d.extra.session={});let m=d.extra.session;m.use_ort_model_bytes_directly||(m.use_ort_model_bytes_directly="1"),d.executionProviders&&d.executionProviders.some(g=>(typeof g=="string"?g:g.name)==="webgpu")&&(d.enableMemPattern=!1)},Pr=(d,m,g,w)=>{let $=Ne(m,w),I=Ne(g,w);ge()._OrtAddSessionConfigEntry(d,$,I)!==0&&fe(`Can't set a session config entry: ${m} - ${g}.`)},im=async(d,m,g)=>{for(let w of m){let $=typeof w=="string"?w:w.name,I=[];switch($){case"webnn":if($="WEBNN",typeof w!="string"){let H=w?.deviceType;H&&Pr(d,"deviceType",H,g)}break;case"webgpu":if($="JS",typeof w!="string"){let H=w;if(H?.preferredLayout){if(H.preferredLayout!=="NCHW"&&H.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${H.preferredLayout}`);Pr(d,"preferredLayout",H.preferredLayout,g)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${$}`)}let D=Ne($,g),q=I.length,j=0,G=0;if(q>0){j=ge()._malloc(q*ge().PTR_SIZE),g.push(j),G=ge()._malloc(q*ge().PTR_SIZE),g.push(G);for(let H=0;H<q;H++)ge().setValue(j+H*ge().PTR_SIZE,I[H][0],"*"),ge().setValue(G+H*ge().PTR_SIZE,I[H][1],"*")}await ge()._OrtAppendExecutionProvider(d,D,j,G,q)!==0&&fe(`Can't append execution provider: ${$}.`)}},Ra=async d=>{let m=ge(),g=0,w=[],$=d||{};om($);try{let I=rm($.graphOptimizationLevel??"all"),D=nm($.executionMode??"sequential"),q=typeof $.logId=="string"?Ne($.logId,w):0,j=$.logSeverityLevel??2;if(!Number.isInteger(j)||j<0||j>4)throw new Error(`log serverity level is not valid: ${j}`);let G=$.logVerbosityLevel??0;if(!Number.isInteger(G)||G<0||G>4)throw new Error(`log verbosity level is not valid: ${G}`);let H=typeof $.optimizedModelFilePath=="string"?Ne($.optimizedModelFilePath,w):0;if(g=m._OrtCreateSessionOptions(I,!!$.enableCpuMemArena,!!$.enableMemPattern,D,!!$.enableProfiling,0,q,j,G,H),g===0&&fe("Can't create session options."),$.executionProviders&&await im(g,$.executionProviders,w),$.enableGraphCapture!==void 0){if(typeof $.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${$.enableGraphCapture}`);Pr(g,"enableGraphCapture",$.enableGraphCapture.toString(),w)}if($.freeDimensionOverrides)for(let[W,V]of Object.entries($.freeDimensionOverrides)){if(typeof W!="string")throw new Error(`free dimension override name must be a string: ${W}`);if(typeof V!="number"||!Number.isInteger(V)||V<0)throw new Error(`free dimension override value must be a non-negative integer: ${V}`);let K=Ne(W,w);m._OrtAddFreeDimensionOverride(g,K,V)!==0&&fe(`Can't set a free dimension override: ${W} - ${V}.`)}return $.extra!==void 0&&Zt($.extra,"",new WeakSet,(W,V)=>{Pr(g,W,V,w)}),[g,w]}catch(I){throw g!==0&&m._OrtReleaseSessionOptions(g)!==0&&fe("Can't release session options."),w.forEach(D=>m._free(D)),I}}}),_t,Xe,wt,Ut,Qt,Or,zr,Kn,Y$2=U(()=>{_t=d=>{switch(d){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${d}`)}},Xe=d=>{switch(d){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${d}`)}},wt=(d,m)=>{let g=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][d],w=typeof m=="number"?m:m.reduce(($,I)=>$*I,1);return g>0?Math.ceil(w*g):void 0},Ut=d=>{switch(d){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${d}`)}},Qt=d=>{switch(d){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${d}`)}},Or=d=>d==="float32"||d==="float16"||d==="int32"||d==="int64"||d==="uint32"||d==="uint8"||d==="bool"||d==="uint4"||d==="int4",zr=d=>d==="float32"||d==="float16"||d==="int32"||d==="int64"||d==="uint32"||d==="uint64"||d==="int8"||d==="uint8"||d==="bool"||d==="uint4"||d==="int4",Kn=d=>{switch(d){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${d}`)}}}),Yt,jn=U(()=>{_r(),Yt=async d=>{if(typeof d=="string"){let m=await fetch(d);if(!m.ok)throw new Error(`failed to load external data file: ${d}`);let g=m.headers.get("Content-Length"),w=g?parseInt(g,10):0;if(w<1073741824)return new Uint8Array(await m.arrayBuffer());{if(!m.body)throw new Error(`failed to load external data file: ${d}, no response body.`);let $=m.body.getReader(),I;try{I=new ArrayBuffer(w)}catch(q){if(q instanceof RangeError){let j=Math.ceil(w/65536);I=new WebAssembly.Memory({initial:j,maximum:j}).buffer}else throw q}let D=0;for(;;){let{done:q,value:j}=await $.read();if(q)break;let G=j.byteLength;new Uint8Array(I,D,G).set(j),D+=G}return new Uint8Array(I,0,w)}}else return d instanceof Blob?new Uint8Array(await d.arrayBuffer()):d instanceof Uint8Array?d:new Uint8Array(d)}}),am,sm,Na,Va,Dr,um,ue,Je=U(()=>{Y$2(),am=["V","I","W","E","F"],sm=(d,m)=>{console.log(`[${am[d]},${new Date().toISOString()}]${m}`)},Dr=(d,m)=>{Na=d,Va=m},um=(d,m)=>{let g=Qt(d),w=Qt(Na);g>=w&&sm(g,typeof m=="function"?m():m)},ue=(...d)=>{Va&&um(...d)}}),Zn,et,E$1,At,Br,Wa,La,ne=U(()=>{Zn=class{static calcMatMulShape(d,m){return d[1]!==m[0]?void 0:[d[0],m[1]]}},et=class{static calcShape(d,m,g=!1){let w=d.length,$=m.length;if(w===0)return m;if($===0)return d;let I=Math.max(d.length,m.length),D=new Array(I);if(g){if(w<2||$<2)return;let q=Zn.calcMatMulShape([d[w-2],d[w-1]],[m[$-2],m[$-1]]);if(q===void 0)return;[D[I-2],D[I-1]]=q}for(let q=g?3:1;q<=I;q++){let j=w-q<0?1:d[w-q],G=$-q<0?1:m[$-q];if(j!==G&&j>1&&G>1)return;let H=Math.max(j,G);if(j&&G)D[I-q]=Math.max(j,G);else{if(H>1)return;D[I-q]=0}}return D}static isValidBroadcast(d,m){let g=d.length,w=m.length;if(g>w)return!1;for(let $=1;$<=g;$++)if(d[g-$]!==1&&d[g-$]!==m[w-$])return!1;return!0}},E$1=class Fo{static size(m){return Fo.getSizeFromDimensionRange(m,0,m.length)}static convertShape(m,g=4){let w=m.length;if(w===0)return[];let $=new Array(w),I=w-1;for(;I>=0;){if(m[I]%g===0){$[I]=m[I]/g;break}if(g%m[I]!==0)throw new Error("cannot convert shape");$[I]=1,g/=m[I],I--}for(I--;I>=0;I--)$[I]=m[I];return $}static sizeFromDimension(m,g){if(g<0||g>m.length)throw new Error(`invalid dimension of ${g} for sizeFromDimension as Tensor has ${m.length} dimensions.`);return Fo.getSizeFromDimensionRange(m,g,m.length)}static sizeToDimension(m,g){if(g<0||g>m.length)throw new Error(`invalid dimension of ${g} for sizeToDimension as Tensor has ${m.length} dimensions.`);return Fo.getSizeFromDimensionRange(m,0,g)}static getSizeFromDimensionRange(m,g,w){let $=1;for(let I=g;I<w;I++){if(m[I]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");$*=Number(m[I])}return $}static computeStrides(m){let g=m.length;if(g===0)return[];if(g===1)return[1];let w=new Array(g);w[g-1]=1,w[g-2]=m[g-1];for(let $=g-3;$>=0;--$)w[$]=w[$+1]*m[$+1];return w}static normalizeAxis(m,g){if(m<-g&&m>=g)throw new Error("unsupported axis for this operation.");return m<0?m+g:m}static normalizeAxes(m,g){return m.map(w=>this.normalizeAxis(w,g??m.length))}static sortBasedOnPerm(m,g){return g?g.map(w=>m[w]):m.slice().reverse()}static padShape(m,g){let w=m.length;return m.map(($,I)=>$+g[I]+g[I+w])}static areEqual(m,g){return m.length!==g.length?!1:m.every((w,$)=>w===g[$])}},At=class Gi{static adjustPoolAttributes(m,g,w,$,I,D){if(!m&&w.length!==g.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(m)for(let q=0;q<g.length-2;q++)q>=w.length?w.push(g[q+2]):w[q]=g[q+2];for(let q=0;q<w.length;q++)if(q<$.length){if($[q]<0)throw new Error("strides should be greater than or equal to 1")}else $.push(1);for(let q=0;q<w.length;q++)if(q<I.length){if(I[q]<0)throw new Error("dilations should be greater than or equal to 1")}else I.push(1);for(let q=0;q<w.length*2;q++)if(q<D.length){if(D[q]<0)throw new Error("pad should be greater than or equal to 1")}else D.push(0);for(let q=0;q<w.length;q++){if(w[q]<=0)throw new Error("kernel shapes need to be greater than 0");if(D[q]>=w[q]||D[q+w.length]>=w[q])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(m,g,w,$,I,D,q){if(q){if(I.length!==2*(m.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(g.length!==m.length-2)throw new Error("length of strides should be the length of data dimensions");if($.length!==m.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let j=0;j<m.length-2;j++)Gi.adjustPadAndReturnShape(m[j+(D?1:2)],g[j],w[j],$[j],I,j,j+m.length-2,q)}}static computePoolOutputShape(m,g,w,$,I,D,q){if(g.length<=0)throw new Error("input shape must be of size greater than 0");let j=[g[0],g[1]];return Gi.computeShapeHelper(m,g,j,w,$,I,D,q),j}static computeConvOutputShape(m,g,w,$,I,D,q){if(m.length<=0||g.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let j=[m[0],g[0]];return Gi.computeShapeHelper(!1,m,j,w,$,I,D,q),j}static computeShapeHelper(m,g,w,$,I,D,q,j){if(m)for(let G=0;G<g.length-2;G++)w.push(1);else for(let G=0;G<g.length-2;G++)w.push(Gi.adjustPadAndReturnShape(g[G+2],$[G],I[G],D[G],q,G,G+g.length-2,j))}static adjustPadAndReturnShape(m,g,w,$,I,D,q,j){let G=w*($-1)+1;if(j&&j!=="NOTSET")switch(j){case"VALID":return I[D]=0,I[q]=0,Math.floor((m-G)/g+1);case"SAME_LOWER":case"SAME_UPPER":if(w!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let H=((m+g-1)/g-1)*g+$-m;return I[D]=Math.floor(j==="SAME_LOWER"?(H+1)/2:H/2),I[q]=H-I[D],Math.floor((m+H-$)/g+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((m+I[D]+I[q]-G)/g+1)}},Br=class{static getShapeOfGemmResult(d,m,g,w,$){if(d.length!==2||g.length!==2)throw new Error("shape need to be of size 2");let I,D,q;m?(I=d[1],D=d[0]):(I=d[0],D=d[1]);let j=-1;if(w?(q=g[0],j=1):(q=g[1],j=0),g[j]!==D)throw new Error("dimension mismatch");if(I<=0||q<=0||D<=0)throw new Error("invalid shape specified");if($&&!et.isValidBroadcast($,[I,q]))throw new Error("gemm: invalid bias shape for broadcast");return[I,q,D]}},Wa=-34028234663852886e22,La=34028234663852886e22}),Mr,Qn=U(()=>{Y$2(),Mr=(d,m)=>new(Ut(m))(d)}),Ha,Xn,Fa,dm,Ga,lm,qa,Rr,Ur,Yn,Ka,ja=U(()=>{Y$2(),Je(),Ha=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),Xn=(d,m)=>{if(m==="int32")return d;let g=Ha.get(m);if(!g)throw new Error(`WebNN backend does not support data type: ${m}`);let w=g/8;if(d.byteLength%w!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${w}.`);let $=d.byteLength/w,I=new(Ut(m))(d.buffer,d.byteOffset,$);switch(m){case"int64":case"uint64":{let D=new Int32Array($);for(let q=0;q<$;q++){let j=I[q];if(j>2147483647n||j<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");D[q]=Number(j)}return new Uint8Array(D.buffer)}case"int8":case"uint8":case"uint32":{if(m==="uint32"&&I.some(q=>q>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let D=Int32Array.from(I,Number);return new Uint8Array(D.buffer)}default:throw new Error(`Unsupported data conversion from ${m} to 'int32'`)}},Fa=(d,m)=>{if(m==="int32")return d;if(d.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let g=d.byteLength/4,w=new Int32Array(d.buffer,d.byteOffset,g);switch(m){case"int64":{let $=BigInt64Array.from(w,BigInt);return new Uint8Array($.buffer)}case"uint64":{if(w.some(I=>I<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let $=BigUint64Array.from(w,BigInt);return new Uint8Array($.buffer)}case"int8":{if(w.some(I=>I<-128||I>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let $=Int8Array.from(w,Number);return new Uint8Array($.buffer)}case"uint8":{if(w.some($=>$<0||$>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(w,Number)}case"uint32":{if(w.some(I=>I<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let $=Uint32Array.from(w,Number);return new Uint8Array($.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${m}`)}},dm=1,Ga=()=>dm++,lm=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),qa=(d,m)=>{let g=Ha.get(d);if(!g)throw new Error(`WebNN backend does not support data type: ${d}`);return m.length>0?Math.ceil(m.reduce((w,$)=>w*$)*g/8):0},Rr=class{constructor(d){this.isDataConverted=!1;let{sessionId:m,context:g,tensor:w,dataType:$,shape:I,fallbackDataType:D}=d;this.sessionId=m,this.mlContext=g,this.mlTensor=w,this.dataType=$,this.tensorShape=I,this.fallbackDataType=D}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return qa(this.dataType,this.tensorShape)}destroy(){ue("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(d){this.mlContext.writeTensor(this.mlTensor,d)}async read(d){if(this.fallbackDataType){let m=await this.mlContext.readTensor(this.mlTensor),g=Fa(new Uint8Array(m),this.dataType);if(d){(d instanceof ArrayBuffer?new Uint8Array(d):new Uint8Array(d.buffer,d.byteOffset,d.byteLength)).set(g);return}else return g.buffer}else return d?this.mlContext.readTensor(this.mlTensor,d):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(d,m,g){return this.mlContext===d&&this.dataType===m&&this.tensorShape.length===g.length&&this.tensorShape.every((w,$)=>w===g[$])}setIsDataConverted(d){this.isDataConverted=d}},Ur=class{constructor(d,m){this.tensorManager=d,this.wrapper=m}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(d,m,g,w){let $=this.tensorManager.getMLContext(d),I;if(!$.opSupportLimits().input.dataTypes.includes(m)){if(I=lm.get(m),!I||!$.opSupportLimits().input.dataTypes.includes(I))throw new Error(`WebNN backend does not support data type: ${m}`);ue("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${m} to ${I}`)}if(this.wrapper){if(this.wrapper.canReuseTensor($,m,g))return this.wrapper.tensor;if(w){if(this.wrapper.byteLength!==qa(m,g))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let D=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(d,m,g,D,!0,!0,I),w&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(d){let m=d;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")m=Xn(d,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(d.byteLength===this.wrapper.byteLength){this.wrapper.write(m);return}else ue("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(m):this.activeUpload=new Uint8Array(m)}async download(d){if(this.activeUpload){let m=this.wrapper?.isDataConverted?Fa(this.activeUpload,this.wrapper?.type):this.activeUpload;if(d){d instanceof ArrayBuffer?new Uint8Array(d).set(m):new Uint8Array(d.buffer,d.byteOffset,d.byteLength).set(m);return}else return m.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return d?this.wrapper.read(d):this.wrapper.read()}},Yn=class{constructor(d){this.backend=d,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(d){let m=this.backend.getMLContext(d);if(!m)throw new Error("MLContext not found for session.");return m}reserveTensorId(){let d=Ga();return this.tensorTrackersById.set(d,new Ur(this)),d}releaseTensorId(d){let m=this.tensorTrackersById.get(d);m&&(this.tensorTrackersById.delete(d),m.tensorWrapper&&this.releaseTensor(m.tensorWrapper))}async ensureTensor(d,m,g,w,$){ue("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${m}, dataType: ${g}, shape: ${w}, copyOld: ${$}}`);let I=this.tensorTrackersById.get(m);if(!I)throw new Error("Tensor not found.");return I.ensureTensor(d,g,w,$)}upload(d,m){let g=this.tensorTrackersById.get(d);if(!g)throw new Error("Tensor not found.");g.upload(m)}async download(d,m){ue("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${d}, dstBuffer: ${m?.byteLength}}`);let g=this.tensorTrackersById.get(d);if(!g)throw new Error("Tensor not found.");return g.download(m)}releaseTensorsForSession(d){for(let m of this.freeTensors)m.sessionId===d&&m.destroy();this.freeTensors=this.freeTensors.filter(m=>m.sessionId!==d)}registerTensor(d,m,g,w){let $=this.getMLContext(d),I=Ga(),D=new Rr({sessionId:d,context:$,tensor:m,dataType:g,shape:w});return this.tensorTrackersById.set(I,new Ur(this,D)),this.externalTensors.add(D),I}async getCachedTensor(d,m,g,w,$,I,D){let q=this.getMLContext(d);for(let[G,H]of this.freeTensors.entries())if(H.canReuseTensor(q,m,g)){ue("verbose",()=>`[WebNN] Reusing tensor {dataType: ${m}, ${D?`fallbackDataType: ${D},`:""} shape: ${g}`);let W=this.freeTensors.splice(G,1)[0];return W.sessionId=d,W}ue("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${m}, ${D?`fallbackDataType: ${D},`:""} shape: ${g}}`);let j=await q.createTensor({dataType:D??m,shape:g,dimensions:g,usage:w,writable:$,readable:I});return new Rr({sessionId:d,context:q,tensor:j,dataType:m,shape:g,fallbackDataType:D})}releaseTensor(d){this.externalTensors.has(d)&&this.externalTensors.delete(d),this.freeTensors.push(d)}},Ka=(...d)=>new Yn(...d)}),Nr,cm,Vr,Za=U(()=>{Y$2(),yt(),Qn(),ja(),Je(),Nr=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),cm=(d,m)=>{if(d===m)return!0;if(d===void 0||m===void 0)return!1;let g=Object.keys(d).sort(),w=Object.keys(m).sort();return g.length===w.length&&g.every(($,I)=>$===w[I]&&d[$]===m[$])},Vr=class{constructor(d){this.tensorManager=Ka(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,Dr(d.logLevel,!!d.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(d){ue("verbose",()=>`[WebNN] onRunStart {sessionId: ${d}}`),this.activeSessionId=d}onRunEnd(d){ue("verbose",()=>`[WebNN] onRunEnd {sessionId: ${d}}`);let m=this.temporarySessionTensorIds.get(d);if(m){for(let g of m)ue("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${g}}`),this.tensorManager.releaseTensorId(g);this.temporarySessionTensorIds.delete(d),this.activeSessionId=void 0}}async createMLContext(d){if(d instanceof GPUDevice){let g=this.mlContextCache.findIndex(w=>w.gpuDevice===d);if(g!==-1)return this.mlContextCache[g].mlContext;{let w=await navigator.ml.createContext(d);return this.mlContextCache.push({gpuDevice:d,mlContext:w}),w}}else if(d===void 0){let g=this.mlContextCache.findIndex(w=>w.options===void 0&&w.gpuDevice===void 0);if(g!==-1)return this.mlContextCache[g].mlContext;{let w=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:w}),w}}let m=this.mlContextCache.findIndex(g=>cm(g.options,d));if(m!==-1)return this.mlContextCache[m].mlContext;{let g=await navigator.ml.createContext(d);return this.mlContextCache.push({options:d,mlContext:g}),g}}registerMLContext(d,m){this.mlContextBySessionId.set(d,m);let g=this.sessionIdsByMLContext.get(m);g||(g=new Set,this.sessionIdsByMLContext.set(m,g)),g.add(d),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(d,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(d,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(d){this.sessionGraphInputs.delete(d),this.sessionGraphOutputs.delete(d);let m=this.mlContextBySessionId.get(d);if(!m)return;this.tensorManager.releaseTensorsForSession(d),this.mlContextBySessionId.delete(d);let g=this.sessionIdsByMLContext.get(m);if(g.delete(d),g.size===0){this.sessionIdsByMLContext.delete(m);let w=this.mlContextCache.findIndex($=>$.mlContext===m);w!==-1&&this.mlContextCache.splice(w,1)}}getMLContext(d){return this.mlContextBySessionId.get(d)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(d){ue("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${d}}`),this.tensorManager.releaseTensorId(d)}async ensureTensor(d,m,g,w,$){let I=Nr.get(g);if(!I)throw new Error(`Unsupported ONNX data type: ${g}`);return this.tensorManager.ensureTensor(d??this.currentSessionId,m,I,w,$)}async createTemporaryTensor(d,m,g){ue("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${m}, shape: ${g}}`);let w=Nr.get(m);if(!w)throw new Error(`Unsupported ONNX data type: ${m}`);let $=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(d,$,w,g,!1);let I=this.temporarySessionTensorIds.get(d);return I?I.push($):this.temporarySessionTensorIds.set(d,[$]),$}uploadTensor(d,m){if(!ge().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");ue("verbose",()=>`[WebNN] uploadTensor {tensorId: ${d}, data: ${m.byteLength}}`),this.tensorManager.upload(d,m)}async downloadTensor(d,m){return this.tensorManager.download(d,m)}createMLTensorDownloader(d,m){return async()=>{let g=await this.tensorManager.download(d);return Mr(g,m)}}registerMLTensor(d,m,g,w){let $=Nr.get(g);if(!$)throw new Error(`Unsupported ONNX data type: ${g}`);let I=this.tensorManager.registerTensor(d,m,$,w);return ue("verbose",()=>`[WebNN] registerMLTensor {tensor: ${m}, dataType: ${$}, dimensions: ${w}} -> {tensorId: ${I}}`),I}registerMLConstant(d,m,g,w,$,I,D=!1){if(!I)throw new Error("External mounted files are not available.");let q=d;d.startsWith("./")&&(q=d.substring(2));let j=I.get(q);if(!j)throw new Error(`File with name ${q} not found in preloaded files.`);if(m+g>j.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let G=j.slice(m,m+g).buffer,H;switch($.dataType){case"float32":H=new Float32Array(G);break;case"float16":H=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(G):new Uint16Array(G);break;case"int32":H=new Int32Array(G);break;case"uint32":H=new Uint32Array(G);break;case"int64":if(D){let W=Xn(new Uint8Array(G),"int64");H=new Int32Array(W.buffer),$.dataType="int32"}else H=new BigInt64Array(G);break;case"uint64":H=new BigUint64Array(G);break;case"int8":H=new Int8Array(G);break;case"int4":case"uint4":case"uint8":H=new Uint8Array(G);break;default:throw new Error(`Unsupported data type: ${$.dataType} in creating WebNN Constant from external data.`)}return ue("verbose",()=>`[WebNN] registerMLConstant {dataType: ${$.dataType}, shape: ${$.shape}}} ${D?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),w.constant($,H)}registerGraphInput(d){this.temporaryGraphInputs.push(d)}registerGraphOutput(d){this.temporaryGraphOutputs.push(d)}isGraphInput(d,m){let g=this.sessionGraphInputs.get(d);return g?g.includes(m):!1}isGraphOutput(d,m){let g=this.sessionGraphOutputs.get(d);return g?g.includes(m):!1}isGraphInputOutputTypeSupported(d,m,g=!0){let w=this.mlContextBySessionId.get(d),$=Nr.get(_t(m));return typeof $>"u"?!1:g?!!w?.opSupportLimits().input.dataTypes.includes($):!!w?.opSupportLimits().output.dataTypes.includes($)}flush(){}}}),Wr=U(()=>{}),Qa,Jn,eo,pm,mm,Ya,ro,to$1,Ja,es=U(()=>{Je(),Wr(),Qa=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),Jn=[],eo=d=>Math.ceil(Number(d)/16)*16,pm=d=>{for(let m=0;m<Jn.length;m++){let g=Jn[m];if(d<=g)return g}return Math.ceil(d/16)*16},mm=1,Ya=()=>mm++,ro=async(d,m,g,w)=>{let $=eo(g),I=d.device.createBuffer({size:$,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let D=d.getCommandEncoder();d.endComputePass(),D.copyBufferToBuffer(m,0,I,0,$),d.flush(),await I.mapAsync(GPUMapMode.READ);let q=I.getMappedRange();if(w){let j=w();return j.set(new Uint8Array(q,0,g)),j}else return new Uint8Array(q.slice(0,g))}finally{I.destroy()}},to$1=class{constructor(d){this.backend=d,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[m]of Qa)Jn.push(m),this.freeBuffers.set(m,[]),this.freeUniformBuffers.set(m,[]);this.sessionCount=0}upload(d,m){let g=m.buffer,w=m.byteOffset,$=m.byteLength,I=eo($),D=this.storageCache.get(d);if(!D)throw new Error("gpu data for uploading does not exist");if(Number(D.originalSize)!==$)throw new Error(`inconsistent data size. gpu data size=${D.originalSize}, data size=${$}`);let q=this.backend.device.createBuffer({mappedAtCreation:!0,size:I,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),j=q.getMappedRange();new Uint8Array(j).set(new Uint8Array(g,w,$)),q.unmap();let G=this.backend.device.createCommandEncoder();G.copyBufferToBuffer(q,0,D.gpuData.buffer,0,I),this.backend.device.queue.submit([G.finish()]),q.destroy(),ue("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${d})`)}memcpy(d,m){let g=this.storageCache.get(d);if(!g)throw new Error("source gpu data for memcpy does not exist");let w=this.storageCache.get(m);if(!w)throw new Error("destination gpu data for memcpy does not exist");if(g.originalSize!==w.originalSize)throw new Error("inconsistent source and destination gpu data size");let $=eo(g.originalSize),I=this.backend.getCommandEncoder();this.backend.endComputePass(),I.copyBufferToBuffer(g.gpuData.buffer,0,w.gpuData.buffer,0,$)}registerExternalBuffer(d,m,g){let w;if(g){if(w=g[0],d===g[1])return ue("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${m}) => id=${w}, buffer is the same, skip.`),w;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else w=Ya();return this.storageCache.set(w,{gpuData:{id:w,type:0,buffer:d},originalSize:m}),ue("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${m}) => id=${w}, registered.`),w}unregisterExternalBuffer(d){d!==void 0&&(this.storageCache.delete(d),ue("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${d}`))}create(d,m=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let g=pm(d),w,$=(m&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,I=(m&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if($||I){let q=($?this.freeBuffers:this.freeUniformBuffers).get(g);q?q.length>0?w=q.pop():w=this.backend.device.createBuffer({size:g,usage:m}):w=this.backend.device.createBuffer({size:g,usage:m})}else w=this.backend.device.createBuffer({size:g,usage:m});let D={id:Ya(),type:0,buffer:w};return this.storageCache.set(D.id,{gpuData:D,originalSize:Number(d)}),ue("verbose",()=>`[WebGPU] GpuDataManager.create(size=${d}) => id=${D.id}`),D}get(d){return this.storageCache.get(d)?.gpuData}release(d){let m=typeof d=="bigint"?Number(d):d,g=this.storageCache.get(m);if(!g){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return ue("verbose",()=>`[WebGPU] GpuDataManager.release(id=${m}), gpuDataId=${g.gpuData.id}`),this.storageCache.delete(m),this.buffersPending.push(g.gpuData.buffer),g.originalSize}async download(d,m){let g=this.storageCache.get(Number(d));if(!g)throw new Error("data does not exist");await ro(this.backend,g.gpuData.buffer,g.originalSize,m)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let d of this.buffersPending){let m=Qa.get(d.size);if((d.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let g=this.freeBuffers.get(d.size)||[];m===void 0||g.length>=m?d.destroy():g.push(d)}else if((d.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let g=this.freeUniformBuffers.get(d.size)||[];m===void 0||g.length>=m?d.destroy():g.push(d)}else d.destroy()}this.buffersPending=[]}else{let d=this.capturedPendingBuffers.get(this.backend.currentSessionId);d||(d=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,d));for(let m of this.buffersPending)d.push(m);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(d=>{d.forEach(m=>{m.destroy()})}),this.freeUniformBuffers.forEach(d=>{d.forEach(m=>{m.destroy()})}),this.storageCache.forEach(d=>{d.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(d=>{d.forEach(m=>{m.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(d){let m=this.capturedPendingBuffers.get(d);m&&(m.forEach(g=>{g.destroy()}),this.capturedPendingBuffers.delete(d)),this.sessionCount-=1,this.sessionCount===0&&(ue("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(g=>{g.gpuData.buffer.destroy()}),this.storageCache=new Map)}},Ja=(...d)=>new to$1(...d)}),no,X,Se=U(()=>{no=class{constructor(d){Object.assign(this,d)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(d=>`${this[d]}`).join(";")),this.key}},X=d=>new no(d)}),kt,io,ye,Ae,N$1,me,ao,Et,Fe,F,Lr,P,M$1,ts,Gr,oo,rs,ie=U(()=>{Y$2(),ne(),kt=64,io=(d,m)=>{if(m===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(d)){case 10:return m>1?`vec${m}<f16>`:"f16";case 1:return m>1?`vec${m}<f32>`:"f32";case 6:return m>1?`vec${m}<i32>`:"i32";case 12:return m>1?`vec${m}<u32>`:"u32";case 7:if(m>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(m>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(m!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${d}`)}},ye=(d,m=1)=>{let g=io(d,m);return typeof g=="string"?g:g[0]},Ae=(d,m=1)=>{let g=io(d,m);return typeof g=="string"?g:g[1]},N$1=(...d)=>{let m=[];return d.forEach(g=>{g.length!==0&&m.push({type:12,data:g},{type:12,data:E$1.computeStrides(g)})}),m},me=d=>d%4===0?4:d%2===0?2:1,ao=(d="f32",m,g="0")=>!m||m===1?`${d}(${g})`:`vec${m}<${d}>(${g})`,Et=(d,m,g)=>d==="f32"?g:m===1?`f32(${g})`:`vec${m}<f32>(${g})`,Fe=(d,m)=>m===4?`(${d}.x + ${d}.y + ${d}.z + ${d}.w)`:m===2?`(${d}.x + ${d}.y)`:m===3?`(${d}.x + ${d}.y + ${d}.z)`:d,F=(d,m,g,w)=>d.startsWith("uniforms.")&&g>4?typeof m=="string"?w==="f16"?`${d}[(${m}) / 8][(${m}) % 8 / 4][(${m}) % 8 % 4]`:`${d}[(${m}) / 4][(${m}) % 4]`:w==="f16"?`${d}[${Math.floor(m/8)}][${Math.floor(m%8/4)}][${m%8%4}]`:`${d}[${Math.floor(m/4)}][${m%4}]`:g>1?`${d}[${m}]`:d,Lr=(d,m,g,w,$)=>{let I=typeof g=="number",D=I?g:g.length,q=[...new Array(D).keys()],j=D<2?"u32":D<=4?`vec${D}<u32>`:`array<u32, ${D}>`,G=io(m,$),H=typeof G=="string"?G:G[1],W=typeof G=="string"?G:G[0],V={indices:j,value:H,storage:W,tensor:m},K=Ye=>typeof Ye=="string"?Ye:`${Ye}u`,Z={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},Q=I?"uniforms.":"",J=`${Q}${d}_shape`,re=`${Q}${d}_strides`,se="";for(let Ye=0;Ye<D-1;Ye++)se+=`
    let dim${Ye} = current / ${F(re,Ye,D)};
    let rest${Ye} = current % ${F(re,Ye,D)};
    indices[${Ye}] = dim${Ye};
    current = rest${Ye};
    `;se+=`indices[${D-1}] = current;`;let oe=D<2?"":`
  fn o2i_${d}(offset: u32) -> ${V.indices} {
    var indices: ${V.indices};
    var current = offset;
    ${se}
    return indices;
  }`,ee=Ye=>(Z.offsetToIndices=!0,D<2?Ye:`o2i_${d}(${Ye})`),ae=[];if(D>=2)for(let Ye=D-1;Ye>=0;Ye--)ae.push(`${F(re,Ye,D)} * (indices[${Ye}])`);let ce=D<2?"":`
  fn i2o_${d}(indices: ${V.indices}) -> u32 {
    return ${ae.join("+")};
  }`,le=Ye=>(Z.indicesToOffset=!0,D<2?Ye:`i2o_${d}(${Ye})`),de=(...Ye)=>D===0?"0u":`${V.indices}(${Ye.map(K).join(",")})`,_e=(Ye,xt)=>D<2?`${Ye}`:`${F(Ye,xt,D)}`,we=(Ye,xt,ar)=>D<2?`${Ye}=${ar};`:`${F(Ye,xt,D)}=${ar};`,pe={},xe=(Ye,xt)=>{Z.broadcastedIndicesToOffset=!0;let ar=`${xt.name}broadcastedIndicesTo${d}Offset`;if(ar in pe)return`${ar}(${Ye})`;let ht=[];for(let gt=D-1;gt>=0;gt--){let zt=xt.indicesGet("outputIndices",gt+xt.rank-D);ht.push(`${_e(re,gt)} * (${zt} % ${_e(J,gt)})`)}return pe[ar]=`fn ${ar}(outputIndices: ${xt.type.indices}) -> u32 {
             return ${ht.length>0?ht.join("+"):"0u"};
           }`,`${ar}(${Ye})`},Ge=(Ye,xt)=>(()=>{if(V.storage===V.value)return`${d}[${Ye}]=${xt};`;if(V.storage==="vec2<u32>"&&V.value==="i32")return`${d}[${Ye}]=vec2<u32>(u32(${xt}), select(0u, 0xFFFFFFFFu, ${xt} < 0));`;if(V.storage==="vec2<u32>"&&V.value==="u32")return`${d}[${Ye}]=vec2<u32>(u32(${xt}), 0u);`;if(V.storage==="u32"&&V.value==="vec4<bool>")return`${d}[${Ye}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${xt}));`;throw new Error(`not supported combination of storage type ${V.storage} and value type ${V.value} yet`)})(),Te=Ye=>(()=>{if(V.storage===V.value)return`${d}[${Ye}]`;if(V.storage==="vec2<u32>"&&V.value==="i32")return`i32(${d}[${Ye}].x)`;if(V.storage==="vec2<u32>"&&V.value==="u32")return`u32(${d}[${Ye}].x)`;if(V.storage==="u32"&&V.value==="vec4<bool>")return`vec4<bool>(bool(${d}[${Ye}] & 0xFFu), bool(${d}[${Ye}] & 0xFF00u), bool(${d}[${Ye}] & 0xFF0000u), bool(${d}[${Ye}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${V.storage} and value type ${V.value} yet`)})(),Ce=D<2?"":`
  fn get_${d}ByIndices(indices: ${V.indices}) -> ${H} {
    return ${Te(`i2o_${d}(indices)`)};
  }`,Oe=D<2?"":(()=>{let Ye=q.map(ar=>`d${ar}: u32`).join(", "),xt=q.map(ar=>`d${ar}`).join(", ");return`
  fn get_${d}(${Ye}) -> ${H} {
    return get_${d}ByIndices(${de(xt)});
  }`})(),bt=(...Ye)=>{if(Ye.length!==D)throw new Error(`indices length must be ${D}`);let xt=Ye.map(K).join(",");return D===0?Te("0u"):D===1?Te(xt[0]):(Z.get=!0,Z.getByIndices=!0,Z.indicesToOffset=!0,`get_${d}(${xt})`)},Mt=Ye=>D<2?Te(Ye):(Z.getByIndices=!0,Z.indicesToOffset=!0,`get_${d}ByIndices(${Ye})`),lt=D<2?"":`
  fn set_${d}ByIndices(indices: ${V.indices}, value: ${H}) {
    ${Ge(`i2o_${d}(indices)`,"value")}
  }`,ir=D<2?"":(()=>{let Ye=q.map(ar=>`d${ar}: u32`).join(", "),xt=q.map(ar=>`d${ar}`).join(", ");return`
  fn set_${d}(${Ye}, value: ${H}) {
    set_${d}ByIndices(${de(xt)}, value);
  }`})();return{impl:()=>{let Ye=[],xt=!1;return Z.offsetToIndices&&(Ye.push(oe),xt=!0),Z.indicesToOffset&&(Ye.push(ce),xt=!0),Z.broadcastedIndicesToOffset&&(Object.values(pe).forEach(ar=>Ye.push(ar)),xt=!0),Z.set&&(Ye.push(ir),xt=!0),Z.setByIndices&&(Ye.push(lt),xt=!0),Z.get&&(Ye.push(Oe),xt=!0),Z.getByIndices&&(Ye.push(Ce),xt=!0),!I&&xt&&Ye.unshift(`const ${J} = ${V.indices}(${g.join(",")});`,`const ${re} = ${V.indices}(${E$1.computeStrides(g).join(",")});`),Ye.join(`
`)},type:V,offsetToIndices:ee,indicesToOffset:le,broadcastedIndicesToOffset:xe,indices:de,indicesGet:_e,indicesSet:we,set:(...Ye)=>{if(Ye.length!==D+1)throw new Error(`indices length must be ${D}`);let xt=Ye[D];if(typeof xt!="string")throw new Error("value must be string");let ar=Ye.slice(0,D).map(K).join(",");return D===0?Ge("0u",xt):D===1?Ge(ar[0],xt):(Z.set=!0,Z.setByIndices=!0,Z.indicesToOffset=!0,`set_${d}(${ar}, ${xt})`)},setByOffset:Ge,setByIndices:(Ye,xt)=>D<2?Ge(Ye,xt):(Z.setByIndices=!0,Z.indicesToOffset=!0,`set_${d}ByIndices(${Ye}, ${xt});`),get:bt,getByOffset:Te,getByIndices:Mt,usage:w,name:d,strides:re,shape:J,rank:D}},P=(d,m,g,w=1)=>Lr(d,m,g,"input",w),M$1=(d,m,g,w=1)=>Lr(d,m,g,"output",w),ts=(d,m,g)=>Lr(d,m,g,"atomicOutput",1),Gr=(d,m,g,w=1)=>Lr(d,m,g,"internal",w),oo=class{constructor(d,m){this.normalizedDispatchGroup=d,this.limits=m,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(d){return`if (global_idx >= ${typeof d=="number"?`${d}u`:d}) { return; }`}mainStart(d=kt){let m=typeof d=="number"?d:d[0],g=typeof d=="number"?1:d[1],w=typeof d=="number"?1:d[2];if(m>this.limits.maxComputeWorkgroupSizeX||g>this.limits.maxComputeWorkgroupSizeY||w>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${m}, ${g}, ${w}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(m*g*w>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${m}, ${g}, ${w}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let $=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,I=$?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,D=$?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${m*g*w}u + local_idx;`;return`@compute @workgroup_size(${m}, ${g}, ${w})
  fn main(${I}) {
    ${D}
  `}appendVariableUniforms(d){d.rank!==0&&(d.shape.startsWith("uniforms.")&&this.uniforms.push({name:d.shape.replace("uniforms.",""),type:"u32",length:d.rank}),d.strides.startsWith("uniforms.")&&this.uniforms.push({name:d.strides.replace("uniforms.",""),type:"u32",length:d.rank}))}declareVariable(d,m){if(d.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(d),this.appendVariableUniforms(d);let g=d.usage==="input"?"read":"read_write",w=d.usage==="atomicOutput"?"atomic<i32>":d.type.storage;return`@group(0) @binding(${m}) var<storage, ${g}> ${d.name}: array<${w}>;`}declareVariables(...d){return d.map(m=>this.declareVariable(m,this.variableIndex++)).join(`
`)}registerInternalVariable(d){if(d.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(d),this.appendVariableUniforms(d)}registerInternalVariables(...d){return d.forEach(m=>this.registerInternalVariable(m)),this}registerUniform(d,m,g=1){return this.uniforms.push({name:d,type:m,length:g}),this}registerUniforms(d){return this.uniforms=this.uniforms.concat(d),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let d=[];for(let{name:m,type:g,length:w}of this.uniforms)if(w&&w>4)g==="f16"?d.push(`@align(16) ${m}:array<mat2x4<${g}>, ${Math.ceil(w/8)}>`):d.push(`${m}:array<vec4<${g}>, ${Math.ceil(w/4)}>`);else{let $=w==null||w===1?g:`vec${w}<${g}>`;d.push(`${m}:${$}`)}return`
      struct Uniforms { ${d.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(d=>d.impl()).join(`
`)+this.internalVariables.map(d=>d.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let d=m=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(m)];return this.uniforms.map(m=>[d(m.type),m.length??1])}},rs=(d,m)=>new oo(d,m)}),fm,ns,hm,gm,bm,ym,ke,os,is,ut=U(()=>{Y$2(),ne(),Se(),ie(),fm=(d,m)=>{if(!d||d.length!==1)throw new Error("Transpose requires 1 input.");if(m.length!==0&&m.length!==d[0].dims.length)throw new Error(`perm size ${m.length} does not match input rank ${d[0].dims.length}`)},ns=(d,m)=>m.length!==0?m:[...new Array(d).keys()].reverse(),hm=(d,m)=>E$1.sortBasedOnPerm(d,ns(d.length,m)),gm=(d,m,g,w)=>{let $=`fn perm(i: ${w.type.indices}) -> ${g.type.indices} {
    var a: ${g.type.indices};`;for(let I=0;I<m;++I)$+=`a[${d[I]}]=i[${I}];`;return $+="return a;}"},bm=(d,m)=>{let g=[],w=[];for(let $=0;$<d.length;++$)d[$]!==1&&g.push(d[$]),d[m[$]]!==1&&w.push(m[$]);return{newShape:g,newPerm:w}},ym=(d,m)=>{let g=0;for(let w=0;w<d.length;++w)if(m[d[w]]!==1){if(d[w]<g)return!1;g=d[w]}return!0},ke=(d,m)=>{let g=d.dataType,w=d.dims.length,$=ns(w,m),I=hm(d.dims,$),D=d.dims,q=I,j=w<2||ym($,d.dims),G;if(j)return G=Z=>{let Q=P("input",g,D,4),J=M$1("output",g,q,4);return`
  ${Z.registerUniform("output_size","u32").declareVariables(Q,J)}
  ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let Z=E$1.size(I);return{outputs:[{dims:I,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(Z/64/4)},programUniforms:[{type:12,data:Math.ceil(Z/4)}]}},getShaderSource:G};let{newShape:H,newPerm:W}=bm(d.dims,$),V=E$1.areEqual(W,[2,3,1]),K=E$1.areEqual(W,[3,1,2]);if(H.length===2||V||K){D=V?[H[0],H[1]*H[2]]:K?[H[0]*H[1],H[2]]:H,q=[D[1],D[0]];let Z=16;return G=Q=>{let J=P("a",g,D.length),re=M$1("output",g,q.length);return`
  ${Q.registerUniform("output_size","u32").declareVariables(J,re)}
  var<workgroup> tile : array<array<${re.type.value}, ${Z+1}>, ${Z}>;
  ${Q.mainStart([Z,Z,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${Z} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${Z}u + local_id.x;
    let input_row = workgroup_id_x * ${Z}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${J.getByIndices(`${J.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${Z}u + local_id.x;
    let output_row = workgroup_id_y * ${Z}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${re.setByIndices(`${re.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let Q=E$1.size(I);return{outputs:[{dims:I,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(q[1]/Z),y:Math.ceil(q[0]/Z)},programUniforms:[{type:12,data:Q},...N$1(D,q)]}},getShaderSource:G}}return G=Z=>{let Q=P("a",g,D.length),J=M$1("output",g,q.length);return`
  ${Z.registerUniform("output_size","u32").declareVariables(Q,J)}

  ${gm($,w,Q,J)}

  ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${J.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${J.setByOffset("global_idx",Q.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${m}`,inputDependencies:["rank"]},getRunData:()=>{let Z=E$1.size(I);return{outputs:[{dims:I,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(Z/64)},programUniforms:[{type:12,data:Z},...N$1(D,q)]}},getShaderSource:G}},os=(d,m)=>{fm(d.inputs,m.perm),d.compute(ke(d.inputs[0],m.perm))},is=d=>X({perm:d.perm})}),_m,wm,vm,$m,xm,Sm,Tm,Im,Cm,Am,tt,as,ss,us,ds,ls,cs,ps,ms,fs,hs,gs=U(()=>{Y$2(),ne(),ie(),Hr(),ut(),_m={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},wm={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},vm={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},$m={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},xm=(d,m)=>{let g=[];for(let w=m-d;w<m;++w)g.push(w);return g},Sm=(d,m)=>{let g=[],w=d.length;for(let I=0;I<w;I++)m.indexOf(I)===-1&&g.push(d[I]);let $=m.map(I=>d[I]);return[g,$]},Tm=(d,m)=>{let g=d.length+m.length,w=[],$=0;for(let I=0;I<g;I++)m.indexOf(I)===-1?w.push(d[$++]):w.push(1);return w},Im=(d,m)=>{for(let g=0;g<d.length;++g)if(d[d.length-g-1]!==m-1-g)return!1;return!0},Cm=(d,m)=>{let g=[];if(!Im(d,m)){for(let w=0;w<m;++w)d.indexOf(w)===-1&&g.push(w);d.forEach(w=>g.push(w))}return g},Am=(d,m,g,w,$,I,D)=>{let q=g[0].dims,j=E$1.size(I),G=E$1.size(D),H=P("_A",g[0].dataType,q),W=M$1("output",$,I),V=64;j===1&&(V=256);let K=`
          var<workgroup> aBestValues : array<f32, ${V}>;
       `,Z=Q=>`
        ${Q.registerUniform("reduceSize","u32").declareVariables(H,W)}
        ${K}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${Q.mainStart(V)}

          let outputIndex = global_idx / ${V};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${vm[w]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${V}) {
           let candidate = f32(${H.getByOffset("offset + k")});
           bestValue = ${_m[w]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${V}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${wm[w]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${W.setByOffset("outputIndex",`${w==="mean"?`${W.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${W.type.storage}(${$m[w]})`}`)};
         }
        }`;return{name:d,shaderCache:{hint:`${m};${V}`,inputDependencies:["type"]},getShaderSource:Z,getRunData:()=>({outputs:[{dims:I,dataType:$}],dispatchGroup:{x:j},programUniforms:[{type:12,data:G}]})}},tt=(d,m,g,w)=>{let $=d.inputs.length===1?g:so(d.inputs,g),I=$.axes;I.length===0&&!$.noopWithEmptyAxes&&(I=d.inputs[0].dims.map((K,Z)=>Z));let D=E$1.normalizeAxes(I,d.inputs[0].dims.length),q=D,j=d.inputs[0],G=Cm(q,d.inputs[0].dims.length);G.length>0&&(j=d.compute(ke(d.inputs[0],G),{inputs:[0],outputs:[-1]})[0],q=xm(q.length,j.dims.length));let[H,W]=Sm(j.dims,q),V=H;$.keepDims&&(V=Tm(H,D)),d.compute(Am(m,$.cacheKey,[j],w,d.inputs[0].dataType,V,W),{inputs:[j]})},as=(d,m)=>{tt(d,"ReduceMeanShared",m,"mean")},ss=(d,m)=>{tt(d,"ReduceL1Shared",m,"l1")},us=(d,m)=>{tt(d,"ReduceL2Shared",m,"l2")},ds=(d,m)=>{tt(d,"ReduceLogSumExpShared",m,"logSumExp")},ls=(d,m)=>{tt(d,"ReduceMaxShared",m,"max")},cs=(d,m)=>{tt(d,"ReduceMinShared",m,"min")},ps=(d,m)=>{tt(d,"ReduceProdShared",m,"prod")},ms=(d,m)=>{tt(d,"ReduceSumShared",m,"sum")},fs=(d,m)=>{tt(d,"ReduceSumSquareShared",m,"sumSquare")},hs=(d,m)=>{tt(d,"ReduceLogSumShared",m,"logSum")}}),rt,km,Fr,so,nt,Em,Pm,Om,zm,Dm,Bm,Mm,Rm,Um,Nm,ot,bs,ys,_s,ws,vs,$s,xs,Ss,Ts,Is,Hr=U(()=>{Y$2(),ne(),Se(),ie(),gs(),rt=d=>{if(!d||d.length===0||d.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(d.length===2&&d[1].dims.length!==1)throw new Error("Invalid axes input dims.")},km=d=>["","",`var value = ${d.getByIndices("input_indices")};`,""],Fr=(d,m,g,w,$,I,D=!1,q=!1)=>{let j=[],G=g[0].dims,H=G.length,W=E$1.normalizeAxes($,H),V=!q&&W.length===0;G.forEach((Q,J)=>{V||W.indexOf(J)>=0?D&&j.push(1):j.push(Q)});let K=j.length,Z=E$1.size(j);return{name:d,shaderCache:m,getShaderSource:Q=>{let J=[],re=P("_A",g[0].dataType,H),se=M$1("output",I,K),oe=w(re,se,W),ee=oe[2];for(let ae=0,ce=0;ae<H;ae++)V||W.indexOf(ae)>=0?(D&&ce++,ee=`for(var j${ae}: u32 = 0; j${ae} < ${G[ae]}; j${ae}++) {
                  ${oe[2].includes("last_index")?`let last_index = j${ae};`:""}
                  ${re.indicesSet("input_indices",ae,`j${ae}`)}
                  ${ee}
                }`):(J.push(`${re.indicesSet("input_indices",ae,se.indicesGet("output_indices",ce))};`),ce++);return`

        ${Q.registerUniform("output_size","u32").declareVariables(re,se)}

        ${Q.mainStart()}
          ${Q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${re.type.indices};
          let output_indices = ${se.offsetToIndices("global_idx")};

          ${J.join(`
`)}
          ${oe[0]}       // init ops for reduce max/min
          ${oe[1]}
          ${ee}
          ${oe[3]}
          ${oe.length===4?se.setByOffset("global_idx","value"):oe.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:j,dataType:I}],dispatchGroup:{x:Math.ceil(Z/64)},programUniforms:[{type:12,data:Z},...N$1(G,j)]})}},so=(d,m)=>{let g=[];return d[1].dims[0]>0&&d[1].getBigInt64Array().forEach(w=>g.push(Number(w))),X({axes:g,keepDims:m.keepDims,noopWithEmptyAxes:m.noopWithEmptyAxes})},nt=(d,m,g,w)=>{let $=d.inputs,I=$.length===1?g:so($,g);d.compute(Fr(m,{hint:I.cacheKey,inputDependencies:["rank"]},[$[0]],I.noopWithEmptyAxes&&I.axes.length===0?km:w,I.axes,$[0].dataType,I.keepDims,I.noopWithEmptyAxes),{inputs:[0]})},Em=(d,m)=>{rt(d.inputs),nt(d,"ReduceLogSum",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += ${g.getByIndices("input_indices")};`,"value = log(value);"])},Pm=(d,m)=>{rt(d.inputs),nt(d,"ReduceL1",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += abs(${g.getByIndices("input_indices")});`,""])},Om=(d,m)=>{rt(d.inputs),nt(d,"ReduceL2",m,(g,w)=>[`var t = ${w.type.value}(0); var value = ${w.type.value}(0);`,"",`t = ${g.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},zm=(d,m)=>{rt(d.inputs),nt(d,"ReduceLogSumExp",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += exp(${g.getByIndices("input_indices")});`,"value = log(value);"])},Dm=(d,m)=>{rt(d.inputs),nt(d,"ReduceMax",m,(g,w,$)=>{let I=[];for(let D=0;D<g.rank;D++)($.indexOf(D)>=0||$.length===0)&&I.push(g.indicesSet("input_indices",D,0));return[`${I.join(`
`)}`,`var value = ${g.getByIndices("input_indices")};`,`value = max(value, ${g.getByIndices("input_indices")});`,""]})},Bm=(d,m)=>{rt(d.inputs),nt(d,"ReduceMean",m,(g,w,$)=>{let I=1;for(let D=0;D<g.rank;D++)($.indexOf(D)>=0||$.length===0)&&(I*=d.inputs[0].dims[D]);return["var sum = f32(0);","",`sum += f32(${g.getByIndices("input_indices")});`,`let value = ${w.type.value}(sum / ${I});`]})},Mm=(d,m)=>{rt(d.inputs),nt(d,"ReduceMin",m,(g,w,$)=>{let I=[];for(let D=0;D<g.rank;D++)($.indexOf(D)>=0||$.length===0)&&I.push(`input_indices[${D}] = 0;`);return[`${I.join(`
`)}`,`var value = ${g.getByIndices("input_indices")};`,`value = min(value, ${g.getByIndices("input_indices")});`,""]})},Rm=(d,m)=>{rt(d.inputs),nt(d,"ReduceProd",m,(g,w)=>[`var value = ${w.type.storage}(1);`,"",`value *= ${g.getByIndices("input_indices")};`,""])},Um=(d,m)=>{rt(d.inputs),nt(d,"ReduceSum",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += ${g.getByIndices("input_indices")};`,""])},Nm=(d,m)=>{rt(d.inputs),nt(d,"ReduceSumSquare",m,(g,w)=>[`var t = ${w.type.value}(0); var value = ${w.type.value}(0);`,"",`t = ${g.getByIndices("input_indices")}; value += t * t;`,""])},ot=(d,m,g)=>{if(m.length===0)return g;let w=1,$=1;for(let I=0;I<m.length;I++)m.indexOf(I)===-1?w*=d[I]:$*=d[I];return $<32&&w>1024},bs=(d,m)=>{ot(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Bm(d,m):as(d,m)},ys=(d,m)=>{ot(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Pm(d,m):ss(d,m)},_s=(d,m)=>{ot(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Om(d,m):us(d,m)},ws=(d,m)=>{ot(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?zm(d,m):ds(d,m)},vs=(d,m)=>{ot(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Dm(d,m):ls(d,m)},$s=(d,m)=>{ot(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Mm(d,m):cs(d,m)},xs=(d,m)=>{ot(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Rm(d,m):ps(d,m)},Ss=(d,m)=>{ot(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Um(d,m):ms(d,m)},Ts=(d,m)=>{ot(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Nm(d,m):fs(d,m)},Is=(d,m)=>{ot(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Em(d,m):hs(d,m)}}),Cs,As,ks,uo,Es=U(()=>{Y$2(),Se(),Hr(),Cs=d=>{if(!d||d.length===0||d.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(d[0].dataType!==1)throw new Error("Invalid input type.")},As=(d,m)=>{Cs(d.inputs);let g=(w,$,I)=>{let D=[];for(let q=0;q<w.rank;q++)(I.indexOf(q)>=0||I.length===0)&&D.push(`input_indices[${q}] = 0;`);return[`${D.join(`
`)}`,`var value = ${w.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${w.getByIndices("input_indices")} ${m.selectLastIndex>0?"<=":"<"} value) {
         value = ${w.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",$.setByOffset("global_idx","best_index")]};d.compute(Fr("ArgMin",{hint:m.cacheKey,inputDependencies:["rank"]},[d.inputs[0]],g,[m.axis],7,m.keepDims),{inputs:[0]})},ks=(d,m)=>{Cs(d.inputs);let g=(w,$,I)=>{let D=[];for(let q=0;q<w.rank;q++)(I.indexOf(q)>=0||I.length===0)&&D.push(`input_indices[${q}] = 0;`);return[`${D.join(`
`)}`,`var value = ${w.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${w.getByIndices("input_indices")} ${m.selectLastIndex>0?">=":">"} value) {
         value = ${w.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",$.setByOffset("global_idx","best_index")]};d.compute(Fr("argMax",{hint:m.cacheKey,inputDependencies:["rank"]},[d.inputs[0]],g,[m.axis],7,m.keepDims),{inputs:[0]})},uo=d=>X(d)}),Vm,lo,Wm,Lm,Gm,Nt,Hm,Ps,qr=U(()=>{Y$2(),ne(),Wr(),ie(),Vm=(d,m)=>{let g=d[0],w=d[1],$=d[2],I=d[3],D=d[4],q=d[5];if(D&&q)throw new Error("Attention cannot have both past and attention_bias");if(g.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let j=g.dims[0],G=g.dims[1],H=g.dims[2];if($.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(w.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(w.dims[0]!==H)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if($.dims[0]!==w.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let W=$.dims[0]/3,V=W,K=V;if(m.qkvHiddenSizes.length>0){if(m.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let oe of m.qkvHiddenSizes)if(oe%m.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");W=m.qkvHiddenSizes[0],V=m.qkvHiddenSizes[1],K=m.qkvHiddenSizes[2]}let Z=G;if(W!==V)throw new Error("qkv_hidden_sizes first element should be same as the second");if($.dims[0]!==W+V+K)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let Q=0;if(D){if(V!==K)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(D.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(D.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(D.dims[1]!==j)throw new Error('Input "past" second dimension must be batch_size');if(D.dims[2]!==m.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(D.dims[4]!==V/m.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');m.pastPresentShareBuffer||(Q=D.dims[3])}let J=Z+Q,re=-1,se=0;if(I)throw new Error("Mask not supported");if(D)throw new Error("past is not supported");if(q){if(q.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(q.dims[0]!==j||q.dims[1]!==m.numHeads||q.dims[2]!==G||q.dims[3]!==J)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:j,sequenceLength:G,pastSequenceLength:Q,kvSequenceLength:Z,totalSequenceLength:J,maxSequenceLength:re,inputHiddenSize:H,hiddenSize:W,vHiddenSize:K,headSize:Math.floor(W/m.numHeads),vHeadSize:Math.floor(K/m.numHeads),numHeads:m.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:m.maskFilterValue,maskType:se,scale:m.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},lo=(d,m,g)=>m&&d?`
      let total_sequence_length_input = u32(${m.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${d?.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${g?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,Wm=(d,m,g,w,$,I,D,q)=>{let j=me(D?1:I),G=64,H=I/j;H<G&&(G=32);let W=Math.ceil(I/j/G),V=[{type:12,data:m},{type:12,data:g},{type:12,data:w},{type:12,data:$},{type:12,data:H},{type:12,data:W}],K=ye(d.dataType,j),Z=Ae(1,j),Q=["type"];D&&Q.push("type"),q&&Q.push("type");let J=re=>{let se=M$1("x",d.dataType,d.dims,j),oe=[se],ee=D?P("seq_lens",D.dataType,D.dims):void 0;ee&&oe.push(ee);let ae=q?P("total_sequence_length_input",q.dataType,q.dims):void 0;ae&&oe.push(ae);let ce=Ae(d.dataType),le=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${G}>;
  var<workgroup> thread_sum: array<f32, ${G}>;
  ${re.registerUniforms(le).declareVariables(...oe)}
  ${re.mainStart([G,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${lo(ee,ae,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${G}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${D?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${Z}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${Z}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(j){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${j}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${G}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${Z}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${Z}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(j){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${j}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${G}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${se.type.value}(${ce}(1.0) / ${ce}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${Z}(x[offset + i]);
        x[offset + i] = ${se.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${D?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${se.type.value}(${ce}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${G};${K};${j}`,inputDependencies:Q},getShaderSource:J,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:$,z:m*g},programUniforms:V})}},Lm=(d,m,g,w,$,I,D,q,j)=>{let G=D+I.kvSequenceLength,H=[I.batchSize,I.numHeads,I.sequenceLength,G],W=d>1&&w,V=I.kvNumHeads?I.kvNumHeads:I.numHeads,K=W?[I.batchSize,V,G,I.headSize]:void 0,Z=I.nReps?I.nReps:1,Q=I.scale===0?1/Math.sqrt(I.headSize):I.scale,J=me(I.headSize),re=I.headSize/J,se=12,oe={x:Math.ceil(G/se),y:Math.ceil(I.sequenceLength/se),z:I.batchSize*I.numHeads},ee=[{type:12,data:I.sequenceLength},{type:12,data:re},{type:12,data:G},{type:12,data:I.numHeads},{type:12,data:I.headSize},{type:1,data:Q},{type:12,data:D},{type:12,data:I.kvSequenceLength},{type:12,data:Z}],ae=W&&w&&E$1.size(w.dims)>0,ce=["type","type"];ae&&ce.push("type"),$&&ce.push("type"),q&&ce.push("type"),j&&ce.push("type");let le=[{dims:H,dataType:m.dataType,gpuDataType:0}];W&&le.push({dims:K,dataType:m.dataType,gpuDataType:0});let de=_e=>{let we=P("q",m.dataType,m.dims,J),pe=P("key",g.dataType,g.dims,J),xe=[we,pe];if(ae){let lt=P("past_key",w.dataType,w.dims,J);xe.push(lt)}$&&xe.push(P("attention_bias",$.dataType,$.dims));let Ge=q?P("seq_lens",q.dataType,q.dims):void 0;Ge&&xe.push(Ge);let Te=j?P("total_sequence_length_input",j.dataType,j.dims):void 0;Te&&xe.push(Te);let Ce=M$1("output",m.dataType,H),Oe=[Ce];W&&Oe.push(M$1("present_key",m.dataType,K,J));let bt=Ae(1,J),Mt=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${se}u;

  var<workgroup> tileQ: array<${we.type.storage}, ${se*se}>;
  var<workgroup> tileK: array<${we.type.storage}, ${se*se}>;
  ${_e.registerUniforms(Mt).declareVariables(...xe,...Oe)}
  ${_e.mainStart([se,se,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${Z===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${Z===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${lo(Ge,Te,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${ae&&W?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${W?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${bt}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${ae&&W?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${W?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${bt}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(J){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${J}`)}})()};
        output[outputIdx] = ${Ce.type.value} (sum * uniforms.alpha) + ${$?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${J};${$!==void 0};${w!==void 0};${d}`,inputDependencies:ce},getRunData:()=>({outputs:le,dispatchGroup:oe,programUniforms:ee}),getShaderSource:de}},Gm=(d,m,g,w,$,I,D=void 0,q=void 0)=>{let j=I+$.kvSequenceLength,G=$.nReps?$.nReps:1,H=$.vHiddenSize*G,W=d>1&&w,V=$.kvNumHeads?$.kvNumHeads:$.numHeads,K=W?[$.batchSize,V,j,$.headSize]:void 0,Z=[$.batchSize,$.sequenceLength,H],Q=12,J={x:Math.ceil($.vHeadSize/Q),y:Math.ceil($.sequenceLength/Q),z:$.batchSize*$.numHeads},re=[{type:12,data:$.sequenceLength},{type:12,data:j},{type:12,data:$.vHeadSize},{type:12,data:$.numHeads},{type:12,data:$.headSize},{type:12,data:H},{type:12,data:I},{type:12,data:$.kvSequenceLength},{type:12,data:G}],se=W&&w&&E$1.size(w.dims)>0,oe=["type","type"];se&&oe.push("type"),D&&oe.push("type"),q&&oe.push("type");let ee=[{dims:Z,dataType:m.dataType,gpuDataType:0}];W&&ee.push({dims:K,dataType:m.dataType,gpuDataType:0});let ae=ce=>{let le=P("probs",m.dataType,m.dims),de=P("v",g.dataType,g.dims),_e=[le,de];se&&_e.push(P("past_value",w.dataType,w.dims));let we=D?P("seq_lens",D.dataType,D.dims):void 0;D&&_e.push(we);let pe=q?P("total_sequence_length_input",q.dataType,q.dims):void 0;q&&_e.push(pe);let xe=[M$1("output",m.dataType,Z)];W&&xe.push(M$1("present_value",m.dataType,K));let Ge=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${Q}u;
  var<workgroup> tileQ: array<${le.type.value}, ${Q*Q}>;
  var<workgroup> tileV: array<${le.type.value}, ${Q*Q}>;
  ${ce.registerUniforms(Ge).declareVariables(..._e,...xe)}
  ${ce.mainStart([Q,Q,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${G===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${G===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${lo(we,pe,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${se&&W?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${W?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${le.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${se&&W?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${W?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${w!==void 0};${d}`,inputDependencies:oe},getRunData:()=>({outputs:ee,dispatchGroup:J,programUniforms:re}),getShaderSource:ae}},Nt=(d,m,g,w,$,I,D,q,j,G,H=void 0,W=void 0)=>{let V=Math.min(d.outputCount,1+(D?1:0)+(q?1:0)),K=V>1?G.pastSequenceLength:0,Z=K+G.kvSequenceLength,Q=j&&E$1.size(j.dims)>0?j:void 0,J=[m,g];V>1&&D&&E$1.size(D.dims)>0&&J.push(D),Q&&J.push(Q),H&&J.push(H),W&&J.push(W);let re=d.compute(Lm(V,m,g,D,Q,G,K,H,W),{inputs:J,outputs:V>1?[-1,1]:[-1]})[0];d.compute(Wm(re,G.batchSize,G.numHeads,K,G.sequenceLength,Z,H,W),{inputs:H&&W?[re,H,W]:[re],outputs:[]});let se=[re,w];V>1&&q&&E$1.size(q.dims)>0&&se.push(q),H&&se.push(H),W&&se.push(W),d.compute(Gm(V,re,w,q,G,K,H,W),{inputs:se,outputs:V>1?[0,2]:[0]})},Hm=(d,m)=>{let g=[m.batchSize,m.numHeads,m.sequenceLength,m.headSize],w=m.sequenceLength,$=m.inputHiddenSize,I=m.headSize,D=12,q={x:Math.ceil(m.headSize/D),y:Math.ceil(m.sequenceLength/D),z:m.batchSize*m.numHeads},j=[d.inputs[0],d.inputs[1],d.inputs[2]],G=[{type:12,data:w},{type:12,data:$},{type:12,data:I},{type:12,data:m.numHeads},{type:12,data:m.headSize},{type:12,data:m.hiddenSize},{type:12,data:m.hiddenSize+m.hiddenSize+m.vHiddenSize}],H=W=>{let V=M$1("output_q",j[0].dataType,g),K=M$1("output_k",j[0].dataType,g),Z=M$1("output_v",j[0].dataType,g),Q=P("input",j[0].dataType,j[0].dims),J=P("weight",j[1].dataType,j[1].dims),re=P("bias",j[2].dataType,j[2].dims),se=Q.type.storage,oe=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${D}u;
  var<workgroup> tileInput: array<${se}, ${D*D}>;
  var<workgroup> tileWeightQ: array<${se}, ${D*D}>;
  var<workgroup> tileWeightK: array<${se}, ${D*D}>;
  var<workgroup> tileWeightV: array<${se}, ${D*D}>;
  ${W.registerUniforms(oe).declareVariables(Q,J,re,V,K,Z)}
  ${W.mainStart([D,D,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${se}(0);
    var valueK = ${se}(0);
    var valueV = ${se}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return d.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:g,dataType:d.inputs[0].dataType,gpuDataType:0},{dims:g,dataType:d.inputs[0].dataType,gpuDataType:0},{dims:g,dataType:d.inputs[0].dataType,gpuDataType:0}],dispatchGroup:q,programUniforms:G}),getShaderSource:H},{inputs:j,outputs:[-1,-1,-1]})},Ps=(d,m)=>{let g=Vm(d.inputs,m),[w,$,I]=Hm(d,g);return Nt(d,w,$,I,d.inputs[4],void 0,void 0,void 0,d.inputs[5],g)}}),Fm,qm,Km,Os,zs=U(()=>{We(),Y$2(),ne(),Se(),ie(),Fm=(d,m)=>{if(!d||d.length!==5)throw new Error("BatchNormalization requires 5 inputs");let g=(w,$,I)=>{let D=$.length;if(D!==w.length)throw new Error(`${I}: num dimensions != ${D}`);$.forEach((q,j)=>{if(q!==w[j])throw new Error(`${I}: dim[${j}] do not match`)})};if(d[0].dims.length>1){let w=m.format==="NHWC"?m.spatial?d[0].dims.slice(-1):d[0].dims.slice(-1).concat(d[0].dims.slice(1,d[0].dims.length-1)):d[0].dims.slice(1,m.spatial?2:void 0);g(d[1].dims,w,"Invalid input scale"),g(d[2].dims,w,"Invalid input B"),g(d[3].dims,w,"Invalid input mean"),g(d[4].dims,w,"Invalid input var")}else g(d[1].dims,[1],"Invalid input scale"),g(d[2].dims,[1],"Invalid input B"),g(d[3].dims,[1],"Invalid input mean"),g(d[4].dims,[1],"Invalid input var")},qm=(d,m)=>{let{epsilon:g,spatial:w,format:$}=m,I=d[0].dims,D=w?me(I[I.length-1]):1,q=$==="NHWC"&&I.length>1?D:1,j=E$1.size(I)/D,G=w,H=G?I.length:I,W=P("x",d[0].dataType,d[0].dims,D),V=P("scale",d[1].dataType,d[1].dims,q),K=P("bias",d[2].dataType,d[2].dims,q),Z=P("inputMean",d[3].dataType,d[3].dims,q),Q=P("inputVar",d[4].dataType,d[4].dims,q),J=M$1("y",d[0].dataType,H,D),re=()=>{let oe="";if(w)oe=`let cOffset = ${I.length===1?"0u":$==="NHWC"?`outputIndices[${I.length-1}] / ${D}`:"outputIndices[1]"};`;else if($==="NCHW")oe=`
            ${J.indicesSet("outputIndices","0","0")}
            let cOffset = ${J.indicesToOffset("outputIndices")};`;else{oe=`var cIndices = ${V.type.indices}(0);
                       cIndices[0] = outputIndices[${I.length-1}];`;for(let ee=1;ee<V.rank;ee++)oe+=`cIndices[${ee}] = outputIndices[${ee}];`;oe+=`let cOffset = ${V.indicesToOffset("cIndices")};`}return oe},se=oe=>`
  const epsilon = ${g};
  ${oe.registerUniform("outputSize","u32").declareVariables(W,V,K,Z,Q,J)}
  ${oe.mainStart()}
  ${oe.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${J.offsetToIndices(`global_idx * ${D}`)};
    ${re()}
    let scale = ${V.getByOffset("cOffset")};
    let bias = ${K.getByOffset("cOffset")};
    let inputMean = ${Z.getByOffset("cOffset")};
    let inputVar = ${Q.getByOffset("cOffset")};
    let x = ${W.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${J.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${m.epsilon}_${m.format}_${w}_${D}`,inputDependencies:G?["rank","type","type","type","type"]:void 0},getShaderSource:se,getRunData:()=>({outputs:[{dims:d[0].dims,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:G?[{type:12,data:j},...N$1(I)]:[{type:12,data:j}]})}},Km=d=>X(d),Os=(d,m)=>{let{inputs:g,outputCount:w}=d,$=Km({...m,outputCount:w});if(be.webgpu.validateInputContent&&Fm(g,$),m.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");d.compute(qm(g,$))}}),jm,Zm,Ds,Bs=U(()=>{ne(),ie(),jm=d=>{if(d[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(d[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(d[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(d[0].dims[2]!==d[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Zm=d=>{let m=d[0].dims,g=d[0].dims[2],w=E$1.size(m)/4,$=d[0].dataType,I=P("input",$,m,4),D=P("bias",$,[g],4),q=P("residual",$,m,4),j=M$1("output",$,m,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:m,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(w/64)}}),getShaderSource:G=>`
  const channels = ${g}u / 4;
  ${G.declareVariables(I,D,q,j)}

  ${G.mainStart()}
    ${G.guardAgainstOutOfBoundsWorkgroupSizes(w)}
    let value = ${I.getByOffset("global_idx")}
      + ${D.getByOffset("global_idx % channels")} + ${q.getByOffset("global_idx")};
    ${j.setByOffset("global_idx","value")}
  }`}},Ds=d=>{jm(d.inputs),d.compute(Zm(d.inputs))}}),Qm,he,Ms,Rs,Us,Ns,Vs,Ws,Ls,Gs,Hs,Ym,Fs,qs,Ks,js,Xt,Zs,Kr,Qs,Ys,Xs,Js,eu,tu,ru,nu,ou,iu,au,su,uu,du,lu,cu,pu,mu,co,po,fu,hu,gu,Xm,Jm,bu,jr=U(()=>{Y$2(),ne(),Se(),ie(),Qm=(d,m,g,w,$,I,D)=>{let q=Math.ceil(m/4),j="";typeof $=="string"?j=`${$}(a)`:j=$("a");let G=P("inputData",g,[q],4),H=M$1("outputData",w,[q],4),W=[{name:"vec_size",type:"u32"}];return D&&W.push(...D),`
      ${d.registerUniforms(W).declareVariables(G,H)}

  ${I??""}

  ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${G.getByOffset("global_idx")};
    ${H.setByOffset("global_idx",j)}
  }`},he=(d,m,g,w,$,I=d.dataType,D,q)=>{let j=[{type:12,data:Math.ceil(E$1.size(d.dims)/4)}];return D&&j.push(...D),{name:m,shaderCache:{hint:$,inputDependencies:["type"]},getShaderSource:G=>Qm(G,E$1.size(d.dims),d.dataType,I,g,w,q),getRunData:G=>({outputs:[{dims:d.dims,dataType:I}],dispatchGroup:{x:Math.ceil(E$1.size(G[0].dims)/64/4)},programUniforms:j})}},Ms=d=>{d.compute(he(d.inputs[0],"Abs","abs"))},Rs=d=>{d.compute(he(d.inputs[0],"Acos","acos"))},Us=d=>{d.compute(he(d.inputs[0],"Acosh","acosh"))},Ns=d=>{d.compute(he(d.inputs[0],"Asin","asin"))},Vs=d=>{d.compute(he(d.inputs[0],"Asinh","asinh"))},Ws=d=>{d.compute(he(d.inputs[0],"Atan","atan"))},Ls=d=>{d.compute(he(d.inputs[0],"Atanh","atanh"))},Gs=d=>X(d),Hs=(d,m)=>{let g;switch(m.to){case 10:g="vec4<f16>";break;case 1:g="vec4<f32>";break;case 12:g="vec4<u32>";break;case 6:g="vec4<i32>";break;case 9:g="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${m.to}`)}d.compute(he(d.inputs[0],"Cast",g,void 0,m.cacheKey,m.to))},Ym=d=>{let m,g,w=d.length>=2&&d[1].data!==0,$=d.length>=3&&d[2].data!==0;switch(d[0].dataType){case 1:m=w?d[1].getFloat32Array()[0]:-34028234663852886e22,g=$?d[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:m=w?d[1].getUint16Array()[0]:64511,g=$?d[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return X({min:m,max:g})},Fs=(d,m)=>{let g=m||Ym(d.inputs),w=Ae(d.inputs[0].dataType);d.compute(he(d.inputs[0],"Clip",$=>`clamp(${$}, vec4<${w}>(uniforms.min), vec4<${w}>(uniforms.max))`,void 0,g.cacheKey,void 0,[{type:d.inputs[0].dataType,data:g.min},{type:d.inputs[0].dataType,data:g.max}],[{name:"min",type:w},{name:"max",type:w}]),{inputs:[0]})},qs=d=>{d.compute(he(d.inputs[0],"Ceil","ceil"))},Ks=d=>{d.compute(he(d.inputs[0],"Cos","cos"))},js=d=>{d.compute(he(d.inputs[0],"Cosh","cosh"))},Xt=d=>X(d),Zs=(d,m)=>{let g=Ae(d.inputs[0].dataType);d.compute(he(d.inputs[0],"Elu",w=>`elu_vf32(${w})`,`
  const elu_alpha_ = ${g}(${m.alpha});

  fn elu_f32(a: ${g}) -> ${g} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${g}>) -> vec4<${g}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,m.cacheKey))},Kr=(d="f32")=>`
const r0: ${d} = 0.3275911;
const r1: ${d} = 0.254829592;
const r2: ${d} = -0.284496736;
const r3: ${d} = 1.421413741;
const r4: ${d} = -1.453152027;
const r5: ${d} = 1.061405429;

fn erf_vf32(v: vec4<${d}>) -> vec4<${d}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,Qs=d=>{let m=Ae(d.inputs[0].dataType);d.compute(he(d.inputs[0],"Erf",g=>`erf_vf32(${g})`,Kr(m)))},Ys=d=>{d.compute(he(d.inputs[0],"Exp","exp"))},Xs=d=>{d.compute(he(d.inputs[0],"Floor","floor"))},Js=d=>{let m=Ae(d.inputs[0].dataType);d.compute(he(d.inputs[0],"Gelu",g=>`0.5 * ${g} * (1.0 + erf_vf32(${g} * 0.7071067811865475))`,Kr(m)))},eu=(d,m)=>{let g=Ae(d.inputs[0].dataType);d.compute(he(d.inputs[0],"LeakyRelu",w=>`select(leaky_relu_alpha_ * ${w}, ${w}, ${w} >= vec4<${g}>(0.0))`,`const leaky_relu_alpha_ = ${g}(${m.alpha});`,m.cacheKey))},tu=d=>{d.compute(he(d.inputs[0],"Not",m=>`!${m}`))},ru=d=>{d.compute(he(d.inputs[0],"Neg",m=>`-${m}`))},nu=d=>{d.compute(he(d.inputs[0],"Reciprocal",m=>`1.0/${m}`))},ou=d=>{let m=Ae(d.inputs[0].dataType);d.compute(he(d.inputs[0],"Relu",g=>`select(vec4<${m}>(0.0), ${g}, ${g} > vec4<${m}>(0.0))`))},iu=d=>{d.compute(he(d.inputs[0],"Sigmoid",m=>`(1.0 / (1.0 + exp(-${m})))`))},au=d=>X(d),su=(d,m)=>{let g=Ae(d.inputs[0].dataType);d.compute(he(d.inputs[0],"HardSigmoid",w=>`max(vec4<${g}>(0.0), min(vec4<${g}>(1.0), ${m.alpha} * ${w} + vec4<${g}>(${m.beta})))`,void 0,m.cacheKey))},uu=d=>{d.compute(he(d.inputs[0],"Sin","sin"))},du=d=>{d.compute(he(d.inputs[0],"Sinh","sinh"))},lu=d=>{d.compute(he(d.inputs[0],"Sqrt","sqrt"))},cu=d=>{d.compute(he(d.inputs[0],"Tan","tan"))},pu=d=>`sign(${d}) * (1 - exp(-2 * abs(${d}))) / (1 + exp(-2 * abs(${d})))`,mu=d=>{d.compute(he(d.inputs[0],"Tanh",pu))},co=(d="f32")=>`
const fast_gelu_a: ${d} = 0.5;
const fast_gelu_b: ${d} = 0.7978845608028654;
const fast_gelu_c: ${d} = 0.035677408136300125;

fn tanh_v(v: vec4<${d}>) -> vec4<${d}> {
  return ${pu("v")};
}
`,po=d=>`(fast_gelu_a + fast_gelu_a * tanh_v(${d} * (fast_gelu_c * ${d} * ${d} + fast_gelu_b))) * ${d}`,fu=d=>{let m=Ae(d.inputs[0].dataType);d.compute(he(d.inputs[0],"FastGelu",po,co(m),void 0,d.inputs[0].dataType))},hu=(d,m)=>{let g=Ae(d.inputs[0].dataType);return d.compute(he(d.inputs[0],"ThresholdedRelu",w=>`select(vec4<${g}>(0.0), ${w}, ${w} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${g}>(${m.alpha});`,m.cacheKey)),0},gu=d=>{d.compute(he(d.inputs[0],"Log","log"))},Xm=(d,m)=>`
const alpha = vec4<${d}>(${m});
const one = ${d}(1.0);
const zero = ${d}(0.0);

fn quick_gelu_impl(x: vec4<${d}>) -> vec4<${d}> {
  let v = x *alpha;
  var x1 : vec4<${d}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,Jm=d=>`quick_gelu_impl(${d})`,bu=(d,m)=>{let g=Ae(d.inputs[0].dataType);d.compute(he(d.inputs[0],"QuickGelu",Jm,Xm(g,m.alpha),m.cacheKey,d.inputs[0].dataType))}}),ef,tf,_u,wu=U(()=>{ne(),ie(),jr(),ef=d=>{if(d[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(d[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(d[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(d[0].dims[2]!==d[1].dims[0])throw new Error("last dimension of input and bias are not the same")},tf=d=>{let m=d[0].dims.slice();m[2]=m[2]/2;let g=P("input",d[0].dataType,d[0].dims,4),w=P("bias",d[0].dataType,[d[0].dims[2]],4),$=M$1("output",d[0].dataType,m,4),I=E$1.size(m)/4,D=ye(d[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:m,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(I/64)}}),getShaderSource:q=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${d[0].dims[2]/4/2}u;

  ${q.declareVariables(g,w,$)}

  ${Kr(D)}

  ${q.mainStart()}
    ${q.guardAgainstOutOfBoundsWorkgroupSizes(I)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${$.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},_u=d=>{ef(d.inputs),d.compute(tf(d.inputs))}}),rf,nf,it,vu,$u,xu,Su,Tu,Iu,Cu,Au,ku,Eu,Pu=U(()=>{Y$2(),ne(),ie(),rf=(d,m,g,w,$,I,D,q,j,G,H,W)=>{let V,K;typeof q=="string"?V=K=(se,oe)=>`${q}((${se}),(${oe}))`:typeof q=="function"?V=K=q:(V=q.scalar,K=q.vector);let Z=M$1("outputData",H,w.length,4),Q=P("aData",j,m.length,4),J=P("bData",G,g.length,4),re;if($)if(I){let se=E$1.size(m)===1,oe=E$1.size(g)===1,ee=m.length>0&&m[m.length-1]%4===0,ae=g.length>0&&g[g.length-1]%4===0;se||oe?re=Z.setByOffset("global_idx",K(se?`${Q.type.value}(${Q.getByOffset("0")}.x)`:Q.getByOffset("global_idx"),oe?`${J.type.value}(${J.getByOffset("0")}.x)`:J.getByOffset("global_idx"))):re=`
            let outputIndices = ${Z.offsetToIndices("global_idx * 4u")};
            let offsetA = ${Q.broadcastedIndicesToOffset("outputIndices",Z)};
            let offsetB = ${J.broadcastedIndicesToOffset("outputIndices",Z)};
            ${Z.setByOffset("global_idx",K(D||ee?Q.getByOffset("offsetA / 4u"):`${Q.type.value}(${Q.getByOffset("offsetA / 4u")}[offsetA % 4u])`,D||ae?J.getByOffset("offsetB / 4u"):`${J.type.value}(${J.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else re=Z.setByOffset("global_idx",K(Q.getByOffset("global_idx"),J.getByOffset("global_idx")));else{if(!I)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let se=(oe,ee,ae="")=>{let ce=`aData[indexA${ee}][componentA${ee}]`,le=`bData[indexB${ee}][componentB${ee}]`;return`
            let outputIndices${ee} = ${Z.offsetToIndices(`global_idx * 4u + ${ee}u`)};
            let offsetA${ee} = ${Q.broadcastedIndicesToOffset(`outputIndices${ee}`,Z)};
            let offsetB${ee} = ${J.broadcastedIndicesToOffset(`outputIndices${ee}`,Z)};
            let indexA${ee} = offsetA${ee} / 4u;
            let indexB${ee} = offsetB${ee} / 4u;
            let componentA${ee} = offsetA${ee} % 4u;
            let componentB${ee} = offsetB${ee} % 4u;
            ${oe}[${ee}] = ${ae}(${V(ce,le)});
          `};H===9?re=`
            var data = vec4<u32>(0);
            ${se("data",0,"u32")}
            ${se("data",1,"u32")}
            ${se("data",2,"u32")}
            ${se("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:re=`
            ${se("outputData[global_idx]",0)}
            ${se("outputData[global_idx]",1)}
            ${se("outputData[global_idx]",2)}
            ${se("outputData[global_idx]",3)}
          `}return`
        ${d.registerUniform("vec_size","u32").declareVariables(Q,J,Z)}

        ${W??""}

        ${d.mainStart()}
        ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${re}
      }`},nf=(d,m,g,w,$,I,D=g.dataType)=>{let q=g.dims.map(Q=>Number(Q)??1),j=w.dims.map(Q=>Number(Q)??1),G=!E$1.areEqual(q,j),H=q,W=E$1.size(q),V=!1,K=!1,Z=[G];if(G){let Q=et.calcShape(q,j,!1);if(!Q)throw new Error("Can't perform binary op on the given tensors");H=Q.slice(),W=E$1.size(H);let J=E$1.size(q)===1,re=E$1.size(j)===1,se=q.length>0&&q[q.length-1]%4===0,oe=j.length>0&&j[j.length-1]%4===0;Z.push(J),Z.push(re),Z.push(se),Z.push(oe);let ee=1;for(let ae=1;ae<H.length;ae++){let ce=q[q.length-ae],le=j[j.length-ae];if(ce===le)ee*=ce;else break}ee%4===0?(K=!0,V=!0):(J||re||se||oe)&&(V=!0)}else V=!0;return Z.push(V),{name:d,shaderCache:{hint:m+Z.map(Q=>Q.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:Q=>rf(Q,q,j,H,V,G,K,$,g.dataType,w.dataType,D,I),getRunData:()=>({outputs:[{dims:H,dataType:D}],dispatchGroup:{x:Math.ceil(W/64/4)},programUniforms:[{type:12,data:Math.ceil(E$1.size(H)/4)},...N$1(q,j,H)]})}},it=(d,m,g,w,$,I)=>{d.compute(nf(m,$??"",d.inputs[0],d.inputs[1],g,w,I))},vu=d=>{it(d,"Add",(m,g)=>`${m}+${g}`)},$u=d=>{it(d,"Div",(m,g)=>`${m}/${g}`)},xu=d=>{it(d,"Equal",{scalar:(m,g)=>`u32(${m}==${g})`,vector:(m,g)=>`vec4<u32>(${m}==${g})`},void 0,void 0,9)},Su=d=>{it(d,"Mul",(m,g)=>`${m}*${g}`)},Tu=d=>{let m=P("input",d.inputs[0].dataType,d.inputs[0].dims).type.value;it(d,"Pow",{scalar:(g,w)=>`pow_custom(${g},${w})`,vector:(g,w)=>`pow_vector_custom(${g},${w})`},`
    fn pow_custom(a : ${m}, b : ${m}) -> ${m} {
      if (b == ${m}(0.0)) {
        return ${m}(1.0);
      } else if (a < ${m}(0.0) && f32(b) != floor(f32(b))) {
        return ${m}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${m}(1.0), round(f32(abs(b) % ${m}(2.0))) != 1.0) * ${m}(${m==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${m}>, b : vec4<${m}>) -> vec4<${m}> {
      // TODO: implement vectorized pow
      return vec4<${m}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},Iu=d=>{it(d,"Sub",(m,g)=>`${m}-${g}`)},Cu=d=>{it(d,"Greater",{scalar:(m,g)=>`u32(${m}>${g})`,vector:(m,g)=>`vec4<u32>(${m}>${g})`},void 0,void 0,9)},Au=d=>{it(d,"Less",{scalar:(m,g)=>`u32(${m}<${g})`,vector:(m,g)=>`vec4<u32>(${m}<${g})`},void 0,void 0,9)},ku=d=>{it(d,"GreaterOrEqual",{scalar:(m,g)=>`u32(${m}>=${g})`,vector:(m,g)=>`vec4<u32>(${m}>=${g})`},void 0,void 0,9)},Eu=d=>{it(d,"LessOrEqual",{scalar:(m,g)=>`u32(${m}<=${g})`,vector:(m,g)=>`vec4<u32>(${m}<=${g})`},void 0,void 0,9)}}),af,sf,uf,df,Ou,zu,Du=U(()=>{Y$2(),ne(),Se(),ie(),af=(d,m)=>{if(!d||d.length<1)throw new Error("too few inputs");let g=0,w=d[g],$=w.dataType,I=w.dims.length;d.forEach((D,q)=>{if(q!==g){if(D.dataType!==$)throw new Error("input tensors should be one type");if(D.dims.length!==I)throw new Error("input tensors should have the same shape");D.dims.forEach((j,G)=>{if(G!==m&&j!==w.dims[G])throw new Error("non concat dimensions must match")})}})},sf=(d,m)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${d}u>(${m});
    for (var i: u32 = 0u; i < ${d}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${d}u;
  }`,uf=(d,m)=>{let g=d.length,w=[];for(let $=0;$<g;++$){let I=m.setByOffset("global_idx",d[$].getByIndices("indices"));g===1?w.push(I):$===0?w.push(`if (inputIndex == ${$}u) { ${I} }`):$===g-1?w.push(`else { ${I} }`):w.push(`else if (inputIndex == ${$}) { ${I} }`)}return w.join(`
`)},df=(d,m,g,w)=>{let $=E$1.size(g),I=new Array(d.length),D=new Array(d.length),q=0,j=[],G=[],H=[{type:12,data:$}];for(let Q=0;Q<d.length;++Q)q+=d[Q].dims[m],I[Q]=q,G.push(d[Q].dims.length),D[Q]=P(`input${Q}`,w,G[Q]),j.push("rank"),H.push({type:12,data:I[Q]});for(let Q=0;Q<d.length;++Q)H.push(...N$1(d[Q].dims));H.push(...N$1(g));let W=M$1("output",w,g.length),V=W.indicesGet("indices",m),K=Array.from(Array(I.length).keys()).map(Q=>`uniforms.sizeInConcatAxis${Q}`).join(","),Z=Q=>`

  ${(()=>{Q.registerUniform("outputSize","u32");for(let J=0;J<d.length;J++)Q.registerUniform(`sizeInConcatAxis${J}`,"u32");return Q.declareVariables(...D,W)})()}

  ${sf(I.length,K)}

  ${Q.mainStart()}
    ${Q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${W.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${V});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${I.length}u>(${K});
      ${V} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${uf(D,W)}
  }`;return{name:"Concat",shaderCache:{hint:`${m}`,inputDependencies:j},getRunData:()=>({outputs:[{dims:g,dataType:w}],dispatchGroup:{x:Math.ceil($/64)},programUniforms:H}),getShaderSource:Z}},Ou=(d,m)=>{let g=d.inputs,w=g[0].dims,$=E$1.normalizeAxis(m.axis,w.length);af(g,$);let I=w.slice();I[$]=g.reduce((q,j)=>q+(j.dims.length>$?j.dims[$]:0),0);let D=g.filter(q=>E$1.size(q.dims)>0);d.compute(df(D,$,I,g[0].dataType),{inputs:D})},zu=d=>X({axis:d.axis})}),qe,Ke,je,Zr,vt=U(()=>{Y$2(),ne(),qe=(d,m,g="f32")=>{switch(d.activation){case"Relu":return`value = max(value, ${m}(0.0));`;case"Sigmoid":return`value = (${m}(1.0) / (${m}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${m}(${g}(uniforms.clip_min)), ${m}(${g}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${m}(0.0), min(${m}(1.0), ${g}(uniforms.alpha) * value + ${g}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${g}(uniforms.alpha) * value, value, value >= ${m}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${d.activation}`)}},Ke=(d,m)=>{d.activation==="Clip"?m.push({type:1,data:d.clipMax},{type:1,data:d.clipMin}):d.activation==="HardSigmoid"?m.push({type:1,data:d.alpha},{type:1,data:d.beta}):d.activation==="LeakyRelu"&&m.push({type:1,data:d.alpha})},je=(d,m)=>{d.activation==="Clip"?m.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):d.activation==="HardSigmoid"?m.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):d.activation==="LeakyRelu"&&m.push({name:"alpha",type:"f32"})},Zr=d=>{let m=d?.activation||"";if(m==="HardSigmoid"){let[g,w]=d?.activation_params||[.2,.5];return{activation:m,alpha:g,beta:w}}else if(m==="Clip"){let[g,w]=d?.activation_params||[Wa,La];return{activation:m,clipMax:w,clipMin:g}}else if(m==="LeakyRelu"){let[g]=d?.activation_params||[.01];return{activation:m,alpha:g}}return{activation:m}}}),Ie,Bu,Qr=U(()=>{Ie=(d,m)=>{switch(d){case 1:return m;case 2:return`vec2<${m}>`;case 3:return`vec3<${m}>`;case 4:return`vec4<${m}>`;default:throw new Error(`${d}-component is not supported.`)}},Bu=d=>`
      ${d?"value = value + getBiasByOutputCoords(coords);":""}
      `}),Mu,Ru=U(()=>{Mu=d=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${d}.x), i32(${d}.y), i32(${d}.z), 1));
}
`}),Jt,Yr,Xr=U(()=>{Y$2(),ne(),ie(),vt(),Jt=(d,m,g,w,$)=>{let I=w-g;return`
      ${Array.from({length:g}).map((D,q)=>`
      if (${F(m.shape,q,m.rank)} != 1) {
        ${m.indicesSet(d,q,F($,q+I,w))}
      } else {
        ${m.indicesSet(d,q,0)}
      }`).join("")}
`},Yr=(d,m,g,w,$=!1,I)=>{let D=d[0].dims,q=d[1].dims,j=D[D.length-2],G=q[q.length-1],H=D[D.length-1],W=me(G),V=me(H),K=me(j),Z=E$1.size(g)/W/K,Q=d.length>2,J=w?w.slice(0,-2):g.slice(0,-2),re=[E$1.size(J),j,G],se=[{type:12,data:Z},{type:12,data:j},{type:12,data:G},{type:12,data:H}];Ke(m,se),se.push(...N$1(J,D,q)),Q&&se.push(...N$1(d[2].dims)),se.push(...N$1(re));let oe=ee=>{let ae=Gr("batch_dims",d[0].dataType,J.length),ce=P("a",d[0].dataType,D.length,V),le=P("b",d[1].dataType,q.length,W),de=M$1("output",d[0].dataType,re.length,W),_e=ye(de.type.tensor),we=qe(m,de.type.value,_e),pe=[ce,le],xe="";if(Q){let Ce=$?W:1;pe.push(P("bias",d[2].dataType,d[2].dims.length,Ce)),xe=`${$?`value += bias[col / ${Ce}];`:`value += ${de.type.value}(bias[row + i]);`}`}let Ge=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];je(m,Ge);let Te=()=>{let Ce=`var a_data: ${ce.type.value};`;for(let Oe=0;Oe<V;Oe++)Ce+=`
              let b_data${Oe} = b[(b_offset + (k + ${Oe}) * uniforms.N + col) / ${W}];`;for(let Oe=0;Oe<K;Oe++){Ce+=`a_data = a[(a_offset + (row + ${Oe}) * uniforms.K + k) / ${V}];`;for(let bt=0;bt<V;bt++)Ce+=`
            values[${Oe}] = fma(${le.type.value}(a_data${V===1?"":`[${bt}]`}), b_data${bt}, values[${Oe}]);
`}return Ce};return`
  ${ee.registerUniforms(Ge).registerInternalVariables(ae).declareVariables(...pe,de)}
  ${ee.mainStart()}
    ${ee.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${W})) * ${W};
    var index1 = global_idx / (uniforms.N / ${W});
    let stride1 = uniforms.M / ${K};
    let row = (index1 % stride1) * ${K};
    let batch = index1 / stride1;

    ${g.length===2?"":`let batch_indices = ${ae.offsetToIndices("batch")};`}

    var a_indices: ${ce.type.indices};
    ${Jt("a_indices",ce,ce.rank-2,ae.rank,"batch_indices")}
    ${ce.indicesSet("a_indices",ce.rank-2,0)}
    ${ce.indicesSet("a_indices",ce.rank-1,0)}
    let a_offset = ${ce.indicesToOffset("a_indices")};

    var b_indices: ${le.type.indices};
    ${Jt("b_indices",le,le.rank-2,ae.rank,"batch_indices")}
    ${le.indicesSet("b_indices",le.rank-2,0)}
    ${le.indicesSet("b_indices",le.rank-1,0)}
    let b_offset = ${le.indicesToOffset("b_indices")};
    var values: array<${de.type.value}, ${K}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${V}) {
      ${Te()}
    }
    for (var i = 0u; i < ${K}u; i++) {
      var value = values[i];
      ${xe}
      ${we}
      let cur_indices = ${de.type.indices}(batch, row + i, col);
      let offset = ${de.indicesToOffset("cur_indices")};
      ${de.setByOffset(`offset / ${W}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${m.activation};${W};${V};${K};${$}`,inputDependencies:Q?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:I?I(g):g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(Z/64)},programUniforms:se}),getShaderSource:oe}}}),lf,cf,mo,Uu,pf,fo,mf,er,Jr=U(()=>{Y$2(),ne(),ie(),vt(),Xr(),Qr(),lf=(d,m)=>d?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${m?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${m?", batchIndices":""});
        `,cf=(d,m)=>d?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${m===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${m===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${m===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,mo=(d,m,g="f32",w,$=!1,I=32,D=!1,q=32)=>{let j=m[1]*d[1],G=m[0]*d[0],H=$?j:I,W=$?I:j,V=H/m[0],K=I/m[1];if(!(($&&V===4&&d[1]===4||!$&&(V===3||V===4))&&H%m[0]===0&&I%m[1]===0&&d[0]===4))throw new Error(`If transposeA ${$} is true, innerElementSize ${V} and workPerThread[1] ${d[1]} must be 4.
      Otherwise, innerElementSize ${V} must be 3 or 4.
  tileAWidth ${H} must be divisible by workgroupSize[0]${m[0]}. tileInner ${I} must be divisible by workgroupSize[1] ${m[1]}. colPerThread ${d[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${V}<${g}>, ${H/V}>, ${W}>;
var<workgroup> mm_Bsub: array<array<vec4<${g}>, ${G/d[0]}>, ${I}>;

const rowPerThread = ${d[1]};
const colPerThread = ${d[0]};
const innerElementSize = ${V};
const tileInner = ${I};

@compute @workgroup_size(${m[0]}, ${m[1]}, ${m[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${D?"0":"i32(globalId.z)"};
  ${w?`let batchIndices = ${w.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${j};

  let num_tiles = ${D?`${Math.ceil(q/I)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${D?`i32(globalId.z) * ${q}`:"0"};

  var acc: array<vec4<${g}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${K};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${lf($,w)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${K}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${w?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${V===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${cf($,V)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},Uu=(d,m)=>d?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${m?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${m?", batchIndices":""});
            `,pf=d=>d?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",fo=(d,m,g="f32",w,$=!1,I=32,D=!1,q=32,j=!1)=>{let G=d[1]*m[1],H=d[0]*m[0],W=$?G:I,V=$?I:G;if(!(V%m[1]===0&&W%m[0]===0&&I%m[1]===0))throw new Error(`tileAHight ${V} must be divisible by workgroupSize[1]${m[1]}, tileAWidth ${W} must be divisible by workgroupSize[0]${m[0]}, tileInner ${I} must be divisible by workgroupSize[1]${m[1]}`);let K=V/m[1],Z=W/m[0],Q=I/m[1],J=j?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${G};
    let globalColStart = i32(workgroupId.x) * ${H};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${V}; inputRow = inputRow + ${m[1]}) {
        for (var inputCol = localCol; inputCol < ${W}; inputCol = inputCol + ${m[0]}) {
          ${Uu($,w)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${I}; inputRow = inputRow + ${m[1]}) {
            for (var inputCol = localCol; inputCol < ${H}; inputCol = inputCol + ${m[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${w?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${g}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${m[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${$?`mm_Asub[k][localRow + innerRow * ${m[1]}];`:`mm_Asub[localRow + innerRow * ${m[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${m[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${m[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${G};

let tileRowA = i32(localId.y) * ${K};
let tileColA = i32(localId.x) * ${Z};
let tileRowB = i32(localId.y) * ${Q};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${K}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${Z}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${Uu($,w)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${Q}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${w?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${g}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${pf($)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${g}, ${W}>, ${V}>;
  var<workgroup> mm_Bsub : array<array<${g}, ${H}>, ${I}>;
  const rowPerThread = ${d[1]};
  const colPerThread = ${d[0]};
  const tileInner = ${I};

@compute @workgroup_size(${m[0]}, ${m[1]}, ${m[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${D?"0":"i32(globalId.z)"};
    ${w?`let batchIndices = ${w.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${D?`${Math.ceil(q/I)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${D?`i32(globalId.z) * ${q}`:"0"};

    var acc : array<array<${g}, colPerThread>, rowPerThread>;
    ${J}
  }
`},mf=(d,m,g,w,$=!1)=>{let[I,D,q,j]=w,G=ye(w[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${I.type.indices}) -> ${Ie(d,G)} {
      var value = ${Ie(d,G)}(0.0);
      let col = colIn * ${d};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${D.type.indices};
        ${Jt("aIndices",D,D.rank-2,I.rank,"batchIndices")}
        ${D.indicesSet("aIndices",D.rank-2,"u32(row)")}
        ${D.indicesSet("aIndices",D.rank-1,"u32(colIn)")}
        value = ${D.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${I.type.indices}) -> ${Ie(d,G)} {
      var value = ${Ie(d,G)}(0.0);
      let col = colIn * ${d};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${q.type.indices};
        ${Jt("bIndices",q,q.rank-2,I.rank,"batchIndices")}
        ${q.indicesSet("bIndices",q.rank-2,"u32(row)")}
        ${q.indicesSet("bIndices",q.rank-1,"u32(colIn)")}
        value = ${q.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Ie(d,G)}) {
      let col = colIn * ${d};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${m?`value = value + ${$?"bias[colIn]":`${Ie(d,G)}(bias[row])`};`:""}
        ${g}
        ${j.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},er=(d,m,g,w,$=!1,I)=>{let D=d[0].dims,q=d[1].dims,j=D.slice(0,-2),G=q.slice(0,-2),H=w?w.slice(0,-2):g.slice(0,-2),W=E$1.size(H),V=D[D.length-2],K=D[D.length-1],Z=q[q.length-1],Q=K%4===0&&Z%4===0,J=V<=8?[4,1,1]:[4,4,1],re=[8,8,1],se=[Math.ceil(Z/re[0]/J[0]),Math.ceil(V/re[1]/J[1]),Math.ceil(W/re[2]/J[2])],oe=Q?4:1,ee=[...j,V,K/oe],ae=ee.length,ce=[...G,K,Z/oe],le=ce.length,de=[W,V,Z/oe],_e=[{type:6,data:V},{type:6,data:Z},{type:6,data:K}];Ke(m,_e),_e.push(...N$1(H,ee,ce));let we=["rank","rank"],pe=d.length>2;pe&&(_e.push(...N$1(d[2].dims)),we.push("rank")),_e.push(...N$1(de));let xe=Ge=>{let Te=H.length,Ce=Gr("batchDims",d[0].dataType,Te,1),Oe=ye(d[0].dataType),bt=P("a",d[0].dataType,ae,oe),Mt=P("b",d[1].dataType,le,oe),lt=M$1("result",d[0].dataType,de.length,oe),ir=[bt,Mt];if(pe){let gt=$?oe:1;ir.push(P("bias",d[2].dataType,d[2].dims.length,gt))}let Ye=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];je(m,Ye);let xt=ye(lt.type.tensor),ar=qe(m,lt.type.value,xt),ht=mf(oe,pe,ar,[Ce,bt,Mt,lt],$);return`
  ${Ge.registerUniforms(Ye).registerInternalVariables(Ce).declareVariables(...ir,lt)}
  ${ht}
  ${Q?mo(J,re,Oe,Ce):fo(J,re,Oe,Ce)}
                   `};return{name:"MatMul",shaderCache:{hint:`${J};${m.activation};${Q};${$}`,inputDependencies:we},getRunData:()=>({outputs:[{dims:I?I(g):g,dataType:d[0].dataType}],dispatchGroup:{x:se[0],y:se[1],z:se[2]},programUniforms:_e}),getShaderSource:xe}}}),ff,Nu,Vu=U(()=>{Y$2(),Je(),ie(),vt(),Qr(),Ru(),Jr(),ff=(d,m,g,w,$=!1,I,D=4,q=4,j=4,G="f32")=>{let H=_e=>{switch(_e){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${G}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${_e} is not supported.`)}},W=_e=>{switch(_e){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${_e} is not supported.`)}},V=d?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,K=d?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,Z=d?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",Q=d?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",J=d?"row":"col",re=d?"col":"row",se=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${d?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${J} / outWidth;
    let outCol = ${J} % outWidth;

    let WRow = ${re} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${re} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${re} % inChannels;
    var resData = ${Ie(D,G)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${Z} && xCol >= 0 && xCol < ${Q}) {
      ${V}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${H(D)}
    }
    return resData;`,oe=d?m&&w?`
    let col = colIn * ${D};
    ${se}`:`
    let col = colIn * ${D};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${se}
    }
    return ${Ie(D,G)}(0.0);`:w&&g?`
    let col = colIn * ${D};
    ${se}`:`
    let col = colIn * ${D};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${se}
    }
    return ${Ie(D,G)}(0.0);`,ee=d?w&&g?W(q):`
    let col = colIn * ${q};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${W(q)}
    }
    return ${Ie(q,G)}(0.0);`:`
    let col = colIn * ${q};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${W(q)}
    }
    return ${Ie(q,G)}(0.0);`,ae=Ie(j,G),ce=Ie(d?D:q,G),le=Ie(d?q:D,G),de=qe(I,ae,G);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${ce} {
      ${d?oe:ee}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${le} {
      ${d?ee:oe}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${ae}) {
      let col = colIn * ${j};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${d?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${K}
      ${Bu($)}
      ${de}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},Nu=(d,m,g,w,$,I,D,q,j)=>{let G=m.format==="NHWC",H=G?d[0].dims[3]:d[0].dims[1],W=g[0],V=G?g[2]:g[3],K=G?g[1]:g[2],Z=G?g[3]:g[1],Q=G&&(H%4===0||H%3===0)&&Z%4===0,J=G?Z:V*K,re=G?V*K:Z,se=[8,8,1],oe=w<=8?[4,1,1]:[4,4,1],ee=[Math.ceil(J/se[0]/oe[0]),Math.ceil(re/se[1]/oe[1]),Math.ceil(W/se[2]/oe[2])];ue("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${ee}`);let ae=Q?G&&H%4!==0?3:4:1,ce=se[1]*oe[1],le=se[0]*oe[0],de=Math.max(se[0]*ae,se[1]),_e=w%ce===0,we=$%le===0,pe=I%de===0,xe=Q?[ae,4,4]:[1,1,1],Ge=[{type:6,data:w},{type:6,data:$},{type:6,data:I},{type:6,data:[m.pads[0],m.pads[1]]},{type:6,data:m.strides},{type:6,data:m.dilations}];Ke(m,Ge),Ge.push(...N$1(d[0].dims,d[1].dims));let Te=["rank","rank"];D&&(Ge.push(...N$1(d[2].dims)),Te.push("rank")),Ge.push(...N$1(g));let Ce=Oe=>{let bt=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];je(m,bt);let Mt=Q?4:1,lt=ye(d[0].dataType),ir=`
      fn setOutputAtIndex(flatIndex : i32, value : ${Q?`vec4<${lt}>`:lt}) {
        result[flatIndex] = ${Q?`vec4<${lt}>`:lt}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${Q?`vec4<${lt}>`:lt}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${Q?"/ 4":""}, value);
      }`,Ye=P("x",d[0].dataType,d[0].dims.length,ae===3?1:ae),xt=P("w",d[1].dataType,d[1].dims.length,Mt),ar=[Ye,xt],ht=M$1("result",d[0].dataType,g.length,Mt);if(D){let gt=P("bias",d[2].dataType,d[2].dims.length,Mt);ar.push(gt),ir+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${Q?`vec4<${lt}>`:lt} {
          return bias[coords.${G?"w":"y"}${Q?"/ 4":""}];
        }`}return`
        ${Mu("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${Oe.registerUniforms(bt).declareVariables(...ar,ht)}
        ${ir}
        ${ff(G,_e,we,pe,D,m,xe[0],xe[1],xe[2],lt)}
        ${Q?mo(oe,se,lt,void 0,!G,de):fo(oe,se,lt,void 0,!G,de,!1,void 0,q)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${m.cacheKey};${ae};${Q};${_e};${we};${pe};${ce};${le};${de}`,inputDependencies:Te},getRunData:()=>({outputs:[{dims:j?j(g):g,dataType:d[0].dataType}],dispatchGroup:{x:ee[0],y:ee[1],z:ee[2]},programUniforms:Ge}),getShaderSource:Ce}}}),hf,Wu,en,gf,Lu,bf,Gu,Hu,Fu=U(()=>{Y$2(),Je(),ne(),ie(),vt(),Qr(),hf=d=>{let m=1;for(let g=0;g<d.length;g++)m*=d[g];return m},Wu=d=>typeof d=="number"?[d,d,d]:d,en=(d,m)=>m<=1?d:d+(d-1)*(m-1),gf=(d,m,g,w=1)=>{let $=en(m,w);return Math.floor((d[0]*(g-1)-g+$)/2)},Lu=(d,m,g,w,$)=>{$==null&&($=gf(d,m[0],w[0]));let I=[0,0,0,g];for(let D=0;D<3;D++)d[D]+2*$>=m[D]&&(I[D]=Math.trunc((d[D]-m[D]+2*$)/w[D]+1));return I},bf=(d,m,g,w,$,I,D,q,j,G)=>{let H,W,V,K;if(d==="VALID"&&(d=0),typeof d=="number"){H={top:d,bottom:d,left:d,right:d,front:d,back:d};let Z=Lu([m,g,w,1],[q,j,G],1,[$,I,D],d);W=Z[0],V=Z[1],K=Z[2]}else if(Array.isArray(d)){if(!d.every((Q,J,re)=>Q===re[0]))throw Error(`Unsupported padding parameter: ${d}`);H={top:d[0],bottom:d[1],left:d[2],right:d[3],front:d[4],back:d[5]};let Z=Lu([m,g,w,1],[q,j,G],1,[$,I,D],d[0]);W=Z[0],V=Z[1],K=Z[2]}else if(d==="SAME_UPPER"){W=Math.ceil(m/$),V=Math.ceil(g/I),K=Math.ceil(w/D);let Z=(W-1)*$+q-m,Q=(V-1)*I+j-g,J=(K-1)*D+G-w,re=Math.floor(Z/2),se=Z-re,oe=Math.floor(Q/2),ee=Q-oe,ae=Math.floor(J/2),ce=J-ae;H={top:oe,bottom:ee,left:ae,right:ce,front:re,back:se}}else throw Error(`Unknown padding parameter: ${d}`);return{padInfo:H,outDepth:W,outHeight:V,outWidth:K}},Gu=(d,m,g,w,$,I=!1,D="channelsLast")=>{let q,j,G,H,W;if(D==="channelsLast")[q,j,G,H,W]=d;else if(D==="channelsFirst")[q,W,j,G,H]=d;else throw new Error(`Unknown dataFormat ${D}`);let[V,,K,Z,Q]=m,[J,re,se]=Wu(g),[oe,ee,ae]=Wu(w),ce=en(K,oe),le=en(Z,ee),de=en(Q,ae),{padInfo:_e,outDepth:we,outHeight:pe,outWidth:xe}=bf($,j,G,H,J,re,se,ce,le,de),Ge=I?V*W:V,Te=[0,0,0,0,0];return D==="channelsFirst"?Te=[q,Ge,we,pe,xe]:D==="channelsLast"&&(Te=[q,we,pe,xe,Ge]),{batchSize:q,dataFormat:D,inDepth:j,inHeight:G,inWidth:H,inChannels:W,outDepth:we,outHeight:pe,outWidth:xe,outChannels:Ge,padInfo:_e,strideDepth:J,strideHeight:re,strideWidth:se,filterDepth:K,filterHeight:Z,filterWidth:Q,effectiveFilterDepth:ce,effectiveFilterHeight:le,effectiveFilterWidth:de,dilationDepth:oe,dilationHeight:ee,dilationWidth:ae,inShape:d,outShape:Te,filterShape:m}},Hu=(d,m,g,w,$,I)=>{let D=I==="channelsLast";D?d[0].dims[3]:d[0].dims[1];let q=[64,1,1],j={x:g.map((J,re)=>re)},G=[Math.ceil(hf(j.x.map(J=>g[J]))/q[0]),1,1];ue("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${G}`);let H=1,W=E$1.size(g),V=[{type:12,data:W},{type:12,data:w},{type:12,data:$},{type:12,data:m.strides},{type:12,data:m.dilations}];Ke(m,V),V.push(...N$1(d[0].dims,d[1].dims));let K=["rank","rank"],Z=d.length===3;Z&&(V.push(...N$1(d[2].dims)),K.push("rank")),V.push(...N$1(g));let Q=J=>{let re=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:w.length},{name:"pads",type:"u32",length:$.length},{name:"strides",type:"u32",length:m.strides.length},{name:"dilations",type:"u32",length:m.dilations.length}];je(m,re);let se=1,oe=ye(d[0].dataType),ee=P("x",d[0].dataType,d[0].dims.length,H),ae=P("W",d[1].dataType,d[1].dims.length,se),ce=[ee,ae],le=M$1("result",d[0].dataType,g.length,se),de="";if(Z){let pe=P("bias",d[2].dataType,d[2].dims.length,se);ce.push(pe),de+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${oe} {
          return bias[${D?F("coords",4,5):F("coords",1,5)}];
        }`}let _e=Ie(H,oe),we=qe(m,_e,oe);return`
            ${de}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${ee.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${ae.getByIndices("aIndices")};
            }
          ${J.registerUniforms(re).declareVariables(...ce,le)}
          ${J.mainStart()}
          ${J.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${le.offsetToIndices("global_idx")};
              let batch = ${F("coords",0,ee.rank)};
              let d2 = ${D?F("coords",ee.rank-1,ee.rank):F("coords",1,ee.rank)};
              let xFRCCorner = vec3<u32>(${D?F("coords",1,ee.rank):F("coords",2,ee.rank)},
              ${D?F("coords",2,ee.rank):F("coords",3,ee.rank)},
              ${D?F("coords",3,ee.rank):F("coords",4,ee.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${D?F("uniforms.x_shape",1,ee.rank):F("uniforms.x_shape",2,ee.rank)};
              let xShapeZ = ${D?F("uniforms.x_shape",2,ee.rank):F("uniforms.x_shape",3,ee.rank)};
              let xShapeW = ${D?F("uniforms.x_shape",3,ee.rank):F("uniforms.x_shape",4,ee.rank)};
              let xShapeU = ${D?F("uniforms.x_shape",4,ee.rank):F("uniforms.x_shape",1,ee.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${D?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${D?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${D?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${D?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${Z?"value = value + getBiasByOutputCoords(coords)":""};
              ${we}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${m.cacheKey};${D};${H};${Z}`,inputDependencies:K},getRunData:()=>({outputs:[{dims:g,dataType:d[0].dataType}],dispatchGroup:{x:G[0],y:G[1],z:G[2]},programUniforms:V}),getShaderSource:Q}}}),qu,Ku,ju=U(()=>{Y$2(),ne(),ie(),vt(),qu=(d,m,g,w)=>{let $=d.length>2,I=$?"value += b[output_channel];":"",D=d[0].dims,q=d[1].dims,j=m.format==="NHWC",G=j?g[3]:g[1],H=G/m.group,W=j&&H>=4?me(G):1,V=E$1.size(g)/W,K=[{type:12,data:V},{type:12,data:m.dilations},{type:12,data:[m.strides[0],m.strides[1]]},{type:12,data:[m.pads[0],m.pads[1]]},{type:12,data:H}];Ke(m,K),K.push(...N$1(D,[q[0],q[1],q[2],q[3]/W]));let Z=$?["rank","rank","rank"]:["rank","rank"];K.push(...N$1([g[0],g[1],g[2],g[3]/W]));let Q=J=>{let re=M$1("output",d[0].dataType,g.length,W),se=ye(re.type.tensor),oe=qe(m,re.type.value,se),ee=P("x",d[0].dataType,D.length),ae=P("w",d[1].dataType,q.length,W),ce=[ee,ae];$&&ce.push(P("b",d[2].dataType,d[2].dims,W));let le=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:m.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];je(m,le);let de=j?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${ee.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${ae.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${ee.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${ae.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${J.registerUniforms(le).declareVariables(...ce,re)}

  ${J.mainStart()}
    ${J.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${re.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${j?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${j?1:2}], outputIndices[${j?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${W} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${j?2:1}];

    var value: ${re.type.value} = ${re.type.value}(0);
    ${de}
    ${I}
    ${oe}
    ${re.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${m.cacheKey}_${W}`,inputDependencies:Z},getRunData:()=>({outputs:[{dims:w?w(g):g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(V/64)},programUniforms:K}),getShaderSource:Q}},Ku=(d,m,g,w)=>{let $=d.length>2,I=me(g[3]),D=me(g[2]),q=E$1.size(g)/I/D,j=[d[0].dims[0],d[0].dims[1],d[0].dims[2],d[0].dims[3]/I],G=[d[1].dims[0],d[1].dims[1],d[1].dims[2],d[1].dims[3]/I],H=[g[0],g[1],g[2],g[3]/I],W=[{type:12,data:q},{type:6,data:[m.strides[0],m.strides[1]]},{type:6,data:[m.pads[0],m.pads[1]]}];Ke(m,W),W.push(...N$1(j,G,H));let V=(D-1)*m.strides[1]+G[1],K=Z=>{let Q=M$1("output",d[0].dataType,H.length,I),J=ye(Q.type.tensor),re=qe(m,Q.type.value,J),se=P("x",d[0].dataType,j.length,I),oe=P("w",d[1].dataType,G.length,I),ee=[se,oe];$&&ee.push(P("b",d[2].dataType,d[2].dims,I));let ae=$?"value += b[output_channel];":"",ce=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return je(m,ce),`
  ${Z.registerUniforms(ce).declareVariables(...ee,Q)}
  ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${D}u;
    let col = (index1 % width1) * ${D}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${se.type.value}, ${V}>;
    var values: array<${Q.type.value}, ${D}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${G[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${V}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${se.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${se.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${G[1]}; w_width++) {
          let w_val = ${oe.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${D}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${D}u; i++) {
      var value = values[i];
      ${ae}
      ${re}
      ${Q.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${m.cacheKey};${I};${D};${V};${G[0]};${G[1]}`,inputDependencies:$?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:w?w(g):g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(q/64)},programUniforms:W}),getShaderSource:K}}}),yf,ho,_f,go,bo,Zu,wf,vf,yo,Qu=U(()=>{ne(),Vu(),Fu(),Jr(),ju(),vt(),Xr(),ut(),yf=(d,m,g,w,$,I)=>{let D=d[0],q=d.slice(I?1:2,I?3:4),j=q.length,G=m[0],H=m.slice(2).map((V,K)=>V+(V-1)*(g[K]-1)),W=q.map((V,K)=>V+w[K]+w[K+j]).map((V,K)=>Math.floor((V-H[K]+$[K])/$[K]));return W.splice(0,0,D),W.splice(I?3:1,0,G),W},ho=[2,3,1,0],_f=(d,m)=>{if(!d||d.length!==2&&d.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(d[0].dims.length>5)throw new Error("greater than 5D is not supported");if(d[0].dims.length!==d[1].dims.length)throw new Error("filter does not have same dimension as input");let g=d[0].dims[m.format==="NHWC"?d[0].dims.length-1:1],w=d[1].dims[1]*m.group;if(g!==w)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(d.length===3&&(d[2].dims.length!==1||d[1].dims[0]!==d[2].dims[0]))throw new Error("invalid bias");let $=d[0].dims.length-2;if(m.dilations.length!==$)throw new Error(`dilations should be ${$}D`);if(m.strides.length!==$)throw new Error(`strides should be ${$}D`);if(m.pads.length!==$*2)throw new Error(`pads should be ${$*2}D`);if(m.kernelShape.length!==0&&m.kernelShape.length!==d[1].dims.length-2)throw new Error("invalid kernel shape")},go=(d,m)=>{let g=d.kernelShape.slice();g.length<m[1].dims.length-2&&g.push(...Array(m[1].dims.length-2-g.length).fill(0));for(let I=2;I<m[1].dims.length;++I)g[I-2]===0&&(g[I-2]=m[1].dims[I]);let w=d.pads.slice();At.adjustPadsBasedOnAutoPad(m[0].dims,d.strides,d.dilations,g,w,d.format==="NHWC",d.autoPad);let $=Object.assign({},d);return Object.assign($,{kernelShape:g,pads:w}),$},bo=d=>{let m=Zr(d),g=d.format,w=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][d.auto_pad],$=d.dilations,I=d.group,D=d.kernel_shape,q=d.pads,j=d.strides,G=d.w_is_const();return{autoPad:w,format:g,dilations:$,group:I,kernelShape:D,pads:q,strides:j,wIsConst:G,...m,cacheKey:`${d.format};${m.activation};`}},Zu=(d,m,g,w)=>{let $=g.format==="NHWC",I=yf(m[0].dims,m[1].dims,g.dilations,g.pads,g.strides,$);if(g.group!==1){let ce=[m[0]];if($){let le=d.kernelCustomData.wT??d.compute(ke(m[1],ho),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=le),ce.push(le)}else ce.push(m[1]);m.length===3&&ce.push(m[2]),!d.adapterInfo.isArchitecture("ampere")&&$&&m[1].dims[0]===g.group&&m[1].dims[1]===1&&g.dilations[0]===1&&g.dilations[1]===1?d.compute(Ku(ce,g,I,w),{inputs:ce}):d.compute(qu(ce,g,I,w),{inputs:ce});return}let D=m.length===3,q=m[0].dims[$?1:2],j=m[0].dims[$?2:3],G=m[0].dims[$?3:1],H=m[1].dims[2],W=m[1].dims[3],V=I[$?1:2],K=I[$?2:3],Z=I[$?3:1],Q=$&&H===q&&W===j&&g.pads[0]===0&&g.pads[1]===0;if(Q||H===1&&W===1&&g.dilations[0]===1&&g.dilations[1]===1&&g.strides[0]===1&&g.strides[1]===1&&g.pads[0]===0&&g.pads[1]===0){let ce=I[0],le,de,_e,we=[];if($){let Ge=d.kernelCustomData.wT??d.compute(ke(m[1],ho),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];if(g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=Ge),Q){let Te=q*j*G;le=m[0].reshape([1,ce,Te]),de=Ge.reshape([1,Te,Z]),_e=[1,ce,Z]}else le=m[0].reshape([ce,q*j,G]),de=Ge.reshape([1,G,Z]),_e=[ce,V*K,Z];we.push(le),we.push(de)}else le=m[0].reshape([ce,G,q*j]),de=m[1].reshape([1,Z,G]),_e=[ce,Z,V*K],we.push(de),we.push(le);D&&we.push(m[2]);let pe=_e[2],xe=we[0].dims[we[0].dims.length-1];pe<8&&xe<8?d.compute(Yr(we,g,I,_e,$,w),{inputs:we}):d.compute(er(we,g,I,_e,$,w),{inputs:we});return}let J=!0,re=d.kernelCustomData.wT??d.compute(ke(m[1],ho),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=re);let se=[m[0],re];D&&se.push(m[2]);let oe=$?V*K:Z,ee=$?Z:V*K,ae=H*W*G;d.compute(Nu(se,g,I,oe,ee,ae,D,J,w),{inputs:se})},wf=(d,m)=>{let g=m.format==="NHWC",w=[d.inputs[0].reshape(g?[d.inputs[0].dims[0],1,d.inputs[0].dims[1],d.inputs[0].dims[2]]:[d.inputs[0].dims[0],d.inputs[0].dims[1],1,d.inputs[0].dims[2]]),d.inputs[1].reshape([d.inputs[1].dims[0],d.inputs[1].dims[1],1,d.inputs[1].dims[2]])];d.inputs.length===3&&w.push(d.inputs[2]);let $=[0,m.pads[0],0,m.pads[1]],I=[1].concat(m.strides),D=[1].concat(m.dilations),q=[1].concat(m.kernelShape),j=go({...m,pads:$,strides:I,dilations:D,kernelShape:q},w);Zu(d,w,j,G=>g?[G[0],G[2],G[3]]:[G[0],G[1],G[3]])},vf=(d,m,g)=>{let w=g.format==="NHWC"?"channelsLast":"channelsFirst",$=go(g,m),I=g.autoPad==="NOTSET"?g.pads:g.autoPad,D=Gu(m[0].dims,m[1].dims,g.strides,g.dilations,I,!1,w);d.compute(Hu(m,$,D.outShape,[D.filterDepth,D.filterHeight,D.filterWidth],[D.padInfo.front,D.padInfo.top,D.padInfo.left],w))},yo=(d,m)=>{if(_f(d.inputs,m),d.inputs[0].dims.length===3)wf(d,m);else if(d.inputs[0].dims.length===5)vf(d,d.inputs,m);else{let g=go(m,d.inputs);Zu(d,d.inputs,g)}}}),Yu,Xu=U(()=>{Y$2(),Je(),ne(),ie(),Yu=(d,m,g)=>{let w=d.length>2,$=m.outputShape,I=m.format==="NHWC",D=m.group,q=d[1].dims,j=q[2]/D,G=q[3],H=I?me(j):1,W=I&&G===1&&j>=4,V=W?Math.floor(j/4)*4:Math.floor(j/H)*H,K=j-V,Z=I?me(G):1,Q=I?G===1?H:Z:1,J=E$1.size($)/Z,re=[Math.ceil(J/64),1,1];ue("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${re}`);let se=["rank","rank"],oe=[m.strides[0],m.strides[1]],ee=[m.kernelShape[I?1:2],m.kernelShape[I?2:3]],ae=[m.dilations[0],m.dilations[1]],ce=[ee[0]+(m.dilations[0]<=1?0:(m.kernelShape[I?1:2]-1)*(m.dilations[0]-1)),ee[1]+(m.dilations[1]<=1?0:(m.kernelShape[I?2:3]-1)*(m.dilations[1]-1))],le=[ce[0]-1-Math.floor((m.pads[0]+m.pads[2])/2),ce[1]-1-Math.floor((m.pads[1]+m.pads[3])/2)],de=[{type:12,data:J},{type:12,data:oe},{type:12,data:ee},{type:12,data:ae},{type:12,data:ce},{type:6,data:le},{type:12,data:V},{type:12,data:j},{type:12,data:G},...N$1(d[0].dims,d[1].dims)];w&&(de.push(...N$1(d[2].dims)),se.push("rank")),de.push(...N$1($));let _e=we=>{let pe=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:oe.length},{name:"filter_dims",type:"u32",length:ee.length},{name:"dilations",type:"u32",length:ee.length},{name:"effective_filter_dims",type:"u32",length:ce.length},{name:"pads",type:"i32",length:le.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],xe=ye(d[0].dataType),Ge=I?1:2,Te=I?2:3,Ce=I?3:1,Oe=P("W",d[1].dataType,d[1].dims.length,Q),bt=P("Dy",d[0].dataType,d[0].dims.length,H),Mt=[bt,Oe];w&&Mt.push(P("bias",d[2].dataType,[$[Ce]].length,Z));let lt=M$1("result",d[0].dataType,$.length,Z),ir=()=>{let ar="";if(W)H===4?ar+=`
        let xValue = ${bt.getByOffset("x_offset")};
        let wValue = ${Oe.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:H===2?ar+=`
          dotProd = dotProd + dot(vec4<${xe}>(${bt.getByOffset("x_offset")}, ${bt.getByOffset("x_offset + 1u")}), vec4<${xe}>(${Oe.getByOffset("w_offset")}, ${Oe.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:H===1&&(ar+=`
          dotProd = dotProd + dot(vec4<${xe}>(${bt.getByOffset("x_offset")}, ${bt.getByOffset("x_offset + 1u")}, ${bt.getByOffset("x_offset + 2u")}, ${bt.getByOffset("x_offset + 3u")}), vec4<${xe}>(${Oe.getByOffset("w_offset")}, ${Oe.getByOffset("w_offset + 1u")}, ${Oe.getByOffset("w_offset + 2u")}, ${Oe.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(ar+=`
                  let xValue = ${I?bt.getByOffset(`${bt.indicesToOffset(`${bt.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${H}`):bt.get("batch","inputChannel","idyR","idyC")};
        `,H===1)ar+=`
          let w_offset = ${Oe.indicesToOffset(`${Oe.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${Oe.getByOffset(`w_offset / ${Q}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let ht=0;ht<H;ht++)ar+=`
            let wValue${ht} = ${Oe.getByOffset(`${Oe.indicesToOffset(`${Oe.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${ht}, wOutChannel)`)} / ${Q}`)};
            dotProd = dotProd + xValue[${ht}] * wValue${ht};`;return ar},Ye=()=>{if(K===0)return"";if(!W)throw new Error(`packInputAs4 ${W} is not true.`);let ar="";if(H===1){ar+="dotProd = dotProd";for(let ht=0;ht<K;ht++)ar+=`
            + ${bt.getByOffset(`x_offset + ${ht}`)} * ${Oe.getByOffset(`w_offset + ${ht}`)}`;ar+=";"}else if(H===2){if(K!==2)throw new Error(`Invalid inputChannelsRemainder ${K}.`);ar+=`
          let xValue = ${bt.getByOffset("x_offset")};
          let wValue = ${Oe.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return ar},xt=`
            let outputIndices = ${lt.offsetToIndices(`global_idx * ${Z}`)};
            let batch = ${lt.indicesGet("outputIndices",0)};
            let d1 = ${lt.indicesGet("outputIndices",Ce)};
            let r = ${lt.indicesGet("outputIndices",Ge)};
            let c = ${lt.indicesGet("outputIndices",Te)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${lt.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${xe}(dyRCorner) + ${xe}(wR)) / ${xe}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${xe}(uniforms.Dy_shape[${Ge}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${xe}(dyCCorner) + ${xe}(wC)) / ${xe}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${xe}(uniforms.Dy_shape[${Te}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${W?`
                var x_offset = ${bt.indicesToOffset(`${bt.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${H};
                var w_offset = ${Oe.indicesToOffset(`${Oe.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${Q};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${W?4:H}) {
                  ${ir()}
                  inputChannel = inputChannel + ${W?4:H};
                }
                ${Ye()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${w?` + bias[d1 / ${Z}]`:""};
            ${lt.setByOffset("global_idx","value")};
          `;return`
    ${we.registerUniforms(pe).declareVariables(...Mt,lt)}
      ${we.mainStart()}
      ${we.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${xt}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${m.cacheKey};${H}${Q}${Z}${W}${K}`,inputDependencies:se},getRunData:()=>({dispatchGroup:{x:re[0],y:re[1],z:re[2]},outputs:[{dims:g?g($):$,dataType:d[0].dataType}],programUniforms:de}),getShaderSource:_e}}}),$f,xf,Sf,Ju,ed,Tf,td,If,rd,nd=U(()=>{Xu(),vt(),ut(),$f=(d,m,g,w,$,I)=>(d-1)*m+g+(w-1)*$+1-I,xf=(d,m,g,w,$)=>{let I=Math.floor(d/2);m==="SAME_UPPER"?(g[w]=I,g[$]=d-I):m==="SAME_LOWER"&&(g[w]=d-I,g[$]=I)},Sf=(d,m,g,w,$,I,D,q,j,G)=>{let H=d.length-2,W=G.length===0;j.length<H&&j.push(...Array(H-j.length).fill(0));let V=d[0],K=m[q?3:1]*$;for(let Z=0,Q=d.length-H-(q?1:0);Z<H;++Z,++Q){let J=d[Q],re=W?J*D[Z]:G[Z],se=$f(J,D[Z],I[Z],m[Q],g[Z],re);xf(se,w,I,Z,Z+H),W&&G.push(D[Z]*(J-1)+j[Z]+(m[Q]-1)*g[Z]+1-I[Z]-I[Z+H])}G.splice(0,0,V),G.splice(q?3:1,0,K)},Ju=(d,m)=>{let g=d.kernelShape.slice();if(d.kernelShape.length===0||d.kernelShape.reduce((W,V)=>W*V,1)===0){g.length=0;for(let W=2;W<m[1].dims.length;++W)g.push(m[1].dims[W])}let w=d.format==="NHWC";g.splice(0,0,m[1].dims[0]),g.splice(w?3:1,0,m[1].dims[1]);let $=d.pads.slice(),I=d.outputShape.slice(),D=d.outputPadding.slice(),q=m[0].dims,j=d.dilations.slice();if(j.reduce((W,V)=>W+V,0)===0){let W=m[0].dims.length-2;j=new Array(W).fill(1)}let G=d.strides.slice();if(G.reduce((W,V)=>W+V,0)===0){let W=m[0].dims.length-2;G=new Array(W).fill(1)}Sf(q,g,j,d.autoPad,d.group,$,G,w,D,I);let H=Object.assign({},d);return Object.assign(H,{kernelShape:g,pads:$,outputPadding:D,outputShape:I,dilations:j,strides:G}),H},ed=d=>{let m=Zr(d),g=d.format,w=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof d.autoPad>"u"?0:d.autoPad],$=d.dilations,I=d.group,D=d.kernelShape,q=d.pads,j=d.strides,G=d.wIsConst(),H=d.outputPadding,W=d.outputShape;return{autoPad:w,format:g,dilations:$,group:I,kernelShape:D,outputPadding:H,outputShape:W,pads:q,strides:j,wIsConst:G,...m,cacheKey:`${d.format};${m.activation};`}},Tf=(d,m)=>{if(!d||d.length!==2&&d.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(d[0].dims.length!==4&&d[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(d[0].dims.length!==d[1].dims.length)throw new Error("filter does not have same dimension as input");let g=d[0].dims[m.format==="NHWC"?d[0].dims.length-1:1],w=d[1].dims[0];if(g!==w)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let $=d[1].dims[1]*m.group;if(d.length===3&&(d[2].dims.length!==1||d[2].dims[0]!==$))throw new Error("invalid bias");let I=d[0].dims.length-2;if(m.dilations.reduce((D,q)=>D+q,0)>0&&m.dilations.length!==I)throw new Error(`dilations should be ${I}D`);if(m.strides.reduce((D,q)=>D+q,0)>0&&m.strides.length!==I)throw new Error(`strides should be ${I}D`);if(m.pads.reduce((D,q)=>D+q,0)>0&&m.pads.length!==I*2)throw new Error(`pads should be ${I*2}D`);if(m.outputPadding.length!==I&&m.outputPadding.length!==0)throw new Error(`output_padding should be ${I}D`);if(m.kernelShape.reduce((D,q)=>D+q,0)>0&&m.kernelShape.length!==0&&m.kernelShape.length!==d[1].dims.length-2)throw new Error("invalid kernel shape");if(m.outputShape.length!==0&&m.outputShape.length!==d[0].dims.length-2)throw new Error("invalid output shape")},td=(d,m,g,w)=>{let $=d.kernelCustomData.wT??d.compute(ke(m[1],[2,3,0,1]),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=$);let I=[m[0],$];m.length===3&&I.push(m[2]),d.compute(Yu(I,g,w),{inputs:I})},If=(d,m)=>{let g=m.format==="NHWC",w=[d.inputs[0].reshape(g?[d.inputs[0].dims[0],1,d.inputs[0].dims[1],d.inputs[0].dims[2]]:[d.inputs[0].dims[0],d.inputs[0].dims[1],1,d.inputs[0].dims[2]]),d.inputs[1].reshape([d.inputs[1].dims[0],d.inputs[1].dims[1],1,d.inputs[1].dims[2]])];d.inputs.length===3&&w.push(d.inputs[2]);let $=m.kernelShape;($.length===0||$[0]===0)&&($=[d.inputs[1].dims[2]]);let I=m.dilations;(I.length===0||I[0]===0)&&(I=[1]);let D=m.strides;(D.length===0||D[0]===0)&&(D=[1]);let q=m.pads;q.length===0&&(q=[0,0]),q=[0,q[0],0,q[1]],D=[1].concat(D),I=[1].concat(I),$=[1].concat($);let j=m.outputPadding;j=[0].concat(j);let G=Ju({...m,pads:q,strides:D,dilations:I,kernelShape:$,outputPadding:j},w);td(d,w,G,H=>g?[H[0],H[2],H[3]]:[H[0],H[1],H[3]])},rd=(d,m)=>{if(Tf(d.inputs,m),d.inputs[0].dims.length===3)If(d,m);else{let g=Ju(m,d.inputs);td(d,d.inputs,g)}}}),Cf,od,id,ad=U(()=>{Y$2(),ne(),Se(),ie(),Cf=(d,m,g,w)=>{let $=E$1.size(m),I=m.length,D=P("input",d,I),q=M$1("output",d,I),j=g.dataType===6?g.getInt32Array()[0]:Number(g.getBigInt64Array()[0]),G=E$1.normalizeAxis(j,I),H=W=>{let V=` i32(${D.indicesGet("inputIndices","uniforms.axis")}) `,K=F("uniforms.input_shape","uniforms.axis",I),Z=w.reverse?V+(w.exclusive?" + 1":""):"0",Q=w.reverse?K:V+(w.exclusive?"":" + 1");return`
                ${W.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(D,q)}
                ${W.mainStart()}
                  ${W.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${q.offsetToIndices("global_idx")};
                  var sum = ${q.type.value}(0);
                  let first : i32 = ${Z};
                  let last : i32 = ${Q};
                  for (var i : i32 = first; i < last; i++) {
                    ${D.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${D.getByIndices("inputIndices")};
                  }
                  ${q.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:w.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:m,dataType:d}],dispatchGroup:{x:Math.ceil($/64)},programUniforms:[{type:12,data:$},{type:12,data:G},...N$1(m,m)]}),getShaderSource:H}},od=(d,m)=>{let g=d.inputs[0].dims,w=d.inputs[0].dataType,$=d.inputs[1];d.compute(Cf(w,g,$,m),{inputs:[0]})},id=d=>{let m=d.exclusive===1,g=d.reverse===1;return X({exclusive:m,reverse:g})}}),Af,kf,Ef,sd,ud,dd=U(()=>{Y$2(),ne(),Se(),ie(),Af=d=>{if(!d||d.length!==1)throw new Error("DepthToSpace requires 1 input.");if(d[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},kf=(d,m,g,w)=>{let $=[];$.push(`fn perm(i: ${w.type.indices}) -> ${g.type.indices} {
    var a: ${g.type.indices};`);for(let I=0;I<m;++I)$.push(g.indicesSet("a",d[I],`i[${I}]`));return $.push("return a;}"),$.join(`
`)},Ef=(d,m)=>{let g,w,$,I,D,q,j=m.format==="NHWC",G=m.blocksize,H=m.mode==="DCR";j?([g,w,$,I]=d.dims,D=H?[g,w,$,G,G,I/G**2]:[g,w,$,I/G**2,G,G],q=H?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([g,w,$,I]=[d.dims[0],d.dims[2],d.dims[3],d.dims[1]],D=H?[g,G,G,I/G**2,w,$]:[g,I/G**2,G,G,w,$],q=H?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let W=d.reshape(D),V=W.dims.length,K=d.dataType,Z=P("a",K,V),Q=M$1("output",K,V),J=re=>`
  ${re.registerUniform("output_size","u32").declareVariables(Z,Q)}

  ${kf(q,V,Z,Q)}

  ${re.mainStart()}
    ${re.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${Q.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${Q.setByOffset("global_idx",Z.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${d.dims};${m.blocksize};${m.mode}`,inputDependencies:["rank"]},getRunData:re=>{let se=j?[g,w*G,$*G,I/G**2]:[g,I/G**2,w*G,$*G],oe=E$1.size(se),ee=W.dims,ae=E$1.sortBasedOnPerm(ee,q);return{outputs:[{dims:se,dataType:re[0].dataType}],dispatchGroup:{x:Math.ceil(oe/64)},programUniforms:[{type:12,data:oe},...N$1(ee,ae)]}},getShaderSource:J}},sd=(d,m)=>{Af(d.inputs),d.compute(Ef(d.inputs[0],m))},ud=d=>X({blocksize:d.blocksize,mode:d.mode,format:d.format})}),_o,tn,ld,Pf,Of,wo,vo,cd,zf,pd,md,fd=U(()=>{Y$2(),ne(),Se(),ie(),_o="[a-zA-Z]|\\.\\.\\.",tn="("+_o+")+",ld="^"+tn+"$",Pf="("+tn+",)*"+tn,Of="^"+Pf+"$",wo=class{constructor(d=-1){this.symbolToIndices=new Map,this.inputIndex=d}addSymbol(d,m){let g=this.symbolToIndices.get(d);g===void 0?g=[m]:g.push(m),this.symbolToIndices.set(d,g)}},vo=class{constructor(d,m){this.equation=m,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[g,w]=m.includes("->")?m.split("->",2):[m,""];if(!g.match(RegExp(Of)))throw new Error("Invalid LHS term");if(g.split(",").forEach(($,I)=>{let D=d[I].dims.slice();if(!$.match(RegExp(ld)))throw new Error("Invalid LHS term");let q=this.processTerm($,!0,D,I);this.lhs.push(q)}),w==="")w+=[...this.symbolToInfo.entries()].filter(([$,I])=>I.count===1||$==="...").map(([$])=>$).join("");else if(!w.match(RegExp(tn)))throw new Error("Invalid RHS");w.match(RegExp(_o,"g"))?.forEach($=>{if($==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let I=this.symbolToInfo.get($);if(I===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(I.dimValue)}}),this.rhs=this.processTerm(w,!1,this.outputDims)}addSymbol(d,m,g){let w=this.symbolToInfo.get(d);if(w!==void 0){if(w.dimValue!==m&&w.count!==1)throw new Error("Dimension mismatch");w.count++,w.inputIndices.push(g)}else w={count:1,dimValue:m,inputIndices:[g]};this.symbolToInfo.set(d,w)}processTerm(d,m,g,w=-1){let $=g.length,I=!1,D=[],q=0;if(!d.match(RegExp(ld))&&!m&&d!=="")throw new Error("Invalid LHS term");let j=d.match(RegExp(_o,"g")),G=new wo(w);return j?.forEach((H,W)=>{if(H==="..."){if(I)throw new Error("Only one ellipsis is allowed per input term");I=!0;let V=$-j.length+1;if(V<0)throw new Error("Ellipsis out of bounds");if(D=g.slice(q,q+V),this.hasEllipsis){if(this.ellipsisDims.length!==D.length||this.ellipsisDims.toString()!==D.toString())throw new Error("Ellipsis dimensions mismatch")}else if(m)this.hasEllipsis=!0,this.ellipsisDims=D;else throw new Error("Ellipsis must be specified in the LHS");for(let K=0;K<D.length;K++){let Z=String.fromCharCode(48+K);G.addSymbol(Z,W+K),this.addSymbol(Z,g[q++],w)}}else G.addSymbol(H,W+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(H,g[q++],w)}),G}},cd=d=>d+"_max",zf=(d,m,g,w)=>{let $=d.map(G=>G.length).map((G,H)=>P(`input${H}`,m,G)),I=E$1.size(w),D=M$1("output",m,w.length),q=[...g.symbolToInfo.keys()].filter(G=>!g.rhs.symbolToIndices.has(G)),j=G=>{let H=[],W="var prod = 1.0;",V="var sum = 0.0;",K="sum += prod;",Z=[],Q=[],J=[],re=[],se=g.symbolToInfo.size===g.rhs.symbolToIndices.size;g.symbolToInfo.forEach((ee,ae)=>{if(g.rhs.symbolToIndices.has(ae)){let ce=g.rhs.symbolToIndices.get(ae)?.[0];ce!==void 0&&g.lhs.forEach((le,de)=>{if(ee.inputIndices.includes(de)){let _e=le.symbolToIndices.get(ae);if(_e===void 0)throw new Error("Invalid symbol error");_e.forEach(we=>{H.push(`${$[de].indicesSet(`input${de}Indices`,we,D.indicesGet("outputIndices",ce))}`)})}})}else g.lhs.forEach((ce,le)=>{if(ee.inputIndices.includes(le)){let de=ce.symbolToIndices.get(ae);if(de===void 0)throw new Error("Invalid symbol error");de.forEach(_e=>{Z.push(`${$[le].indicesSet(`input${le}Indices`,_e,`${ae}`)}`)}),re.push(`prod *= ${$[le].getByIndices(`input${le}Indices`)};`)}}),Q.push(`for(var ${ae}: u32 = 0; ${ae} < uniforms.${cd(ae)}; ${ae}++) {`),J.push("}")});let oe=se?[...H,`let sum = ${$.map((ee,ae)=>ee.getByIndices(`input${ae}Indices`)).join(" * ")};`]:[...H,V,...Q,...Z,W,...re,K,...J];return`
            ${G.registerUniforms(q.map(ee=>({name:`${cd(ee)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...$,D)}

            ${G.mainStart()}
            ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${D.offsetToIndices("global_idx")};
            ${$.map((ee,ae)=>`var input${ae}Indices: ${$[ae].type.indices};`).join(`
`)}
            ${oe.join(`
`)};
            ${D.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:g.equation,inputDependencies:d.map(()=>"rank")},getRunData:()=>{let G=q.filter(W=>g.symbolToInfo.has(W)).map(W=>({type:12,data:g.symbolToInfo.get(W)?.dimValue||0}));G.push({type:12,data:I});let H=d.map((W,V)=>[...N$1(W)]).reduce((W,V)=>W.concat(V),G);return H.push(...N$1(w)),{outputs:[{dims:w,dataType:m}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:H}},getShaderSource:j}},pd=(d,m)=>{let g=new vo(d.inputs,m.equation),w=g.outputDims,$=d.inputs.map((I,D)=>I.dims);d.compute(zf($,d.inputs[0].dataType,g,w))},md=d=>{let m=d.equation.replace(/\s+/g,"");return X({equation:m})}}),Df,hd,Bf,Mf,gd,bd=U(()=>{Y$2(),ne(),ie(),Df=d=>{if(!d||d.length!==2)throw new Error("Expand requires 2 input.");let m=d[0].dims,g=Array.from(d[1].getBigInt64Array(),Number),w=g.length<m.length?0:g.length-m.length,$=m.length<g.length?0:m.length-g.length;for(;w<g.length&&$<m.length;++w,++$)if(g[w]!==m[$]&&g[w]!==1&&m[$]!==1)throw new Error("Expand requires shape to be broadcastable to input")},hd=(d,m)=>{let g=d.length-m.length,w=[];for(let $=0;$<g;++$)w.push(d[$]);for(let $=0;$<m.length;++$)w.push(m[$]===1?d[$+g]:m[$]);return w},Bf=(d,m)=>d.length>m.length?hd(d,m):hd(m,d),Mf=d=>{let m=d[0].dims,g=Array.from(d[1].getBigInt64Array(),Number),w=Bf(m,g),$=d[0].dataType,I=$===9||E$1.size(m)===1,D=$===9||m.length>0&&m[m.length-1]%4===0?4:1,q=I||w.length>0&&w[w.length-1]%4===0?4:1,j=Math.ceil(E$1.size(w)/q),G=W=>{let V=P("input",$,m.length,D),K=M$1("output",$,w.length,q),Z;if($===9){let Q=(J,re,se="")=>`
          let outputIndices${re} = ${K.offsetToIndices(`outputOffset + ${re}u`)};
          let offset${re} = ${V.broadcastedIndicesToOffset(`outputIndices${re}`,K)};
          let index${re} = offset${re} / 4u;
          let component${re} = offset${re} % 4u;
          ${J}[${re}] = ${se}(${V.getByOffset(`index${re}`)}[component${re}]);
        `;Z=`
        let outputOffset = global_idx * ${q};
        var data = vec4<u32>(0);
        ${Q("data",0,"u32")}
        ${Q("data",1,"u32")}
        ${Q("data",2,"u32")}
        ${Q("data",3,"u32")}
        ${K.setByOffset("global_idx","data")}
      }`}else Z=`
        let outputIndices = ${K.offsetToIndices(`global_idx * ${q}`)};
        let inputOffset = ${V.broadcastedIndicesToOffset("outputIndices",K)};
        let data = ${K.type.value}(${V.getByOffset(`inputOffset / ${D}`)});
        ${K.setByOffset("global_idx","data")}
      }`;return`
    ${W.registerUniform("vec_size","u32").declareVariables(V,K)}
    ${W.mainStart()}
    ${W.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${Z}`},H=[{type:12,data:j},...N$1(m,w)];return{name:"Expand",shaderCache:{hint:`${w.length};${D}${q}`,inputDependencies:["rank"]},getShaderSource:G,getRunData:()=>({outputs:[{dims:w,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:H})}},gd=d=>{Df(d.inputs),d.compute(Mf(d.inputs),{inputs:[0]})}}),Rf,yd,_d=U(()=>{Y$2(),ne(),ie(),jr(),Rf=d=>{let m=d[0].dataType,g=E$1.size(d[0].dims),w=E$1.size(d[1].dims),$=w%4===0,I=D=>{let q=P("x",m,[1],4),j=P("bias",m,[1],4),G=M$1("y",m,[1],4),H=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],W=K=>`
      let bias${K}_offset: u32 = (global_idx * 4 + ${K}) % uniforms.bias_size;
      let bias${K} = ${j.getByOffset(`bias${K}_offset / 4`)}[bias${K}_offset % 4];`,V=$?`
      let bias = ${j.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${W(0)}${W(1)}${W(2)}${W(3)}
      let bias = ${q.type.value}(bias0, bias1, bias2, bias3);`;return`${D.registerUniforms(H).declareVariables(q,j,G)}

    ${co(Ae(m))}

    ${D.mainStart(kt)}
      ${D.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${q.getByOffset("global_idx")};
      ${V}
      let x_in = x + bias;
      ${G.setByOffset("global_idx",po("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${$}`,inputDependencies:["type","type"]},getShaderSource:I,getRunData:D=>({outputs:[{dims:D[0].dims,dataType:D[0].dataType}],programUniforms:[{type:12,data:Math.ceil(g/4)},{type:12,data:w}],dispatchGroup:{x:Math.ceil(g/kt/4)}})}},yd=d=>{d.inputs.length<2||E$1.size(d.inputs[1].dims)===0?fu(d):d.compute(Rf(d.inputs))}}),Uf,Nf,wd,vd,$d=U(()=>{Y$2(),ne(),Se(),ie(),Uf=d=>{if(!d||d.length!==2)throw new Error("Gather requires 2 inputs.")},Nf=(d,m)=>{let g=d[0].dims,w=d[1].dims,$=g.length,I=E$1.normalizeAxis(m.axis,$),D=g.slice(0);D.splice(I,1,...w);let q=g[I],j=d[0].dataType===9?4:1,G=Math.ceil(E$1.size(D)/j),H=[{type:12,data:G},{type:6,data:q},{type:12,data:I},...N$1(d[0].dims,d[1].dims,D)],W=V=>{let K=P("data",d[0].dataType,d[0].dims.length,j),Z=P("inputIndices",d[1].dataType,d[1].dims.length),Q=M$1("output",d[0].dataType,D.length,j),J=se=>{let oe=w.length,ee=`var indicesIndices${se}  = ${Z.type.indices}(0);`;for(let ae=0;ae<oe;ae++)ee+=`${oe>1?`indicesIndices${se}[${ae}]`:`indicesIndices${se}`} = ${D.length>1?`outputIndices${se}[uniforms.axis + ${ae}]`:`outputIndices${se}`};`;ee+=`
          var idx${se} = ${Z.getByIndices(`indicesIndices${se}`)};
          if (idx${se} < 0) {
            idx${se} = idx${se} + uniforms.axisDimLimit;
          }
          var dataIndices${se} : ${K.type.indices};
        `;for(let ae=0,ce=0;ae<$;ae++)ae===I?(ee+=`${$>1?`dataIndices${se}[${ae}]`:`dataIndices${se}`} = u32(idx${se});`,ce+=oe):(ee+=`${$>1?`dataIndices${se}[${ae}]`:`dataIndices${se}`} = ${D.length>1?`outputIndices${se}[${ce}]`:`outputIndices${se}`};`,ce++);return ee},re;if(d[0].dataType===9){let se=(oe,ee,ae="")=>`
          let outputIndices${ee} = ${Q.offsetToIndices(`outputOffset + ${ee}u`)};
          ${J(ee)};
          let offset${ee} = ${K.indicesToOffset(`dataIndices${ee}`)};
          let index${ee} = offset${ee} / 4u;
          let component${ee} = offset${ee} % 4u;
          ${oe}[${ee}] = ${ae}(${K.getByOffset(`index${ee}`)}[component${ee}]);
        `;re=`
        let outputOffset = global_idx * ${j};
        var value = vec4<u32>(0);
        ${se("value",0,"u32")}
        ${se("value",1,"u32")}
        ${se("value",2,"u32")}
        ${se("value",3,"u32")}
        ${Q.setByOffset("global_idx","value")}
      `}else re=`
      let outputIndices = ${Q.offsetToIndices("global_idx")};
      ${J("")};
      let value = ${K.getByIndices("dataIndices")};
      ${Q.setByOffset("global_idx","value")};
      `;return`
      ${V.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(K,Z,Q)}
      ${V.mainStart()}
        ${V.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${re}
      }`};return{name:"Gather",shaderCache:{hint:m.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:D,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(G/64)},programUniforms:H}),getShaderSource:W}},wd=d=>X({axis:d.axis}),vd=(d,m)=>{let g=d.inputs;Uf(g),d.compute(Nf(d.inputs,m))}}),Vf,xd,Sd,Td=U(()=>{Y$2(),ne(),ie(),Vf=(d,m,g,w,$,I,D,q,j)=>{let G=[{type:12,data:I},{type:12,data:w},{type:12,data:$},{type:12,data:g},{type:12,data:D},{type:12,data:q},{type:12,data:j}],H=[I];G.push(...N$1(m.dims,H));let W=V=>{let K=P("indices_data",m.dataType,m.dims.length),Z=M$1("input_slice_offsets_data",12,1,1),Q=[K,Z],J=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:$.length},{name:"sizes_from_slice_dims_data",type:"u32",length:g.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${V.registerUniforms(J).declareVariables(...Q)}
  ${V.mainStart()}
    ${V.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${$.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${g.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return d.compute({name:"computeSliceOffsets",shaderCache:{hint:`${$.length}_${g.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:H,dataType:d.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:G}),getShaderSource:W},{inputs:[m],outputs:[-1]})[0]},xd=(d,m)=>{let g=d.inputs,w=g[0].dims,$=g[0].dataType,I=g[1].dims,D=I[I.length-1],q=E$1.sizeToDimension(I,I.length-1),j=E$1.sizeFromDimension(w,m.batchDims+D),G=E$1.sizeToDimension(w,m.batchDims),H=E$1.sizeFromDimension(w,m.batchDims),W=q/G,V=new Array(D),K=j;for(let ee=0;ee<D;++ee)V[D-1-ee]=K,K*=w[m.batchDims+D-1-ee];let Z=Vf(d,g[1],V,m.batchDims,w,q,W,H,D),Q=m.batchDims+D;if(Q>w.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let J=I.slice(0,-1).concat(w.slice(Q)),re=E$1.size(J),se=[{type:12,data:re},{type:12,data:j},...N$1(g[0].dims,Z.dims,J)],oe=ee=>{let ae=P("data",g[0].dataType,g[0].dims.length),ce=P("slice_offsets",12,Z.dims.length),le=M$1("output",g[0].dataType,J.length);return`
          ${ee.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(ae,ce,le)}
            ${ee.mainStart()}
            ${ee.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};d.compute({name:"GatherND",shaderCache:{hint:m.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:J,dataType:$}],dispatchGroup:{x:Math.ceil(re/64)},programUniforms:se}),getShaderSource:oe},{inputs:[g[0],Z]})},Sd=d=>({batchDims:d.batch_dims,cacheKey:""})}),Wf,Lf,Id,Cd,Ad=U(()=>{Y$2(),ne(),Se(),ie(),Wf=(d,m)=>{if(d.length<3||d.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let g=E$1.normalizeAxis(m.quantizeAxis,d[0].dims.length),w=m.blockSize,$=d[0],I=d[2],D=d.length===4?d[3]:void 0;if(I.dims.length!==$.dims.length||!$.dims.map((q,j)=>j===g?Math.ceil(q/w)===I.dims[j]:q===I.dims[j]).reduce((q,j)=>q&&j,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(D){if(D.dataType!==$.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(D.dims.length!==I.dims.length||!D.dims.map((q,j)=>q===I.dims[j]).reduce((q,j)=>q&&j,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},Lf=(d,m)=>{let g=d[0].dims,w=d[1].dims,$=g.length,I=E$1.normalizeAxis(m.gatherAxis,$),D=E$1.normalizeAxis(m.quantizeAxis,$),q=g.slice(0);q.splice(I,1,...w);let j=E$1.size(q),G=d[2].dataType,H=d[0].dataType===22,W=[{type:12,data:j},{type:12,data:D},{type:12,data:I},{type:12,data:m.blockSize},...N$1(...d.map((K,Z)=>K.dims),q)],V=K=>{let Z=P("data",d[0].dataType,d[0].dims.length),Q=P("inputIndices",d[1].dataType,d[1].dims.length),J=P("scales",d[2].dataType,d[2].dims.length),re=d.length>3?P("zeroPoint",d[3].dataType,d[3].dims.length):void 0,se=M$1("output",G,q.length),oe=[Z,Q,J];re&&oe.push(re);let ee=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${K.registerUniforms(ee).declareVariables(...oe,se)}
        ${K.mainStart()}
        let output_indices = ${se.offsetToIndices("global_idx")};
        var indices_indices = ${Q.type.indices}(0);
        ${w.length>1?`
          for (var i: u32 = 0; i < ${w.length}; i++) {
            let index = ${se.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${Q.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${se.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${Z.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${se.indicesGet("output_indices","i")};
          ${Z.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${Q.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${g[I]};
        }
        ${Z.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${q.length}; i++) {
          let index = ${se.indicesGet("output_indices",`i + ${w.length} - 1`)};
          ${Z.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${Z.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${Z.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${H?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${J.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${J.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${J.getByIndices("scale_indices")};
        ${re?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${re.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${re.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${H?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${Ae(G)}(quantized_data - zero_point) * scale;
        ${se.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${m.cacheKey};${d.filter((K,Z)=>Z!==1).map(K=>K.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:d.length},(K,Z)=>"rank")},getRunData:()=>({outputs:[{dims:q,dataType:G}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:W}),getShaderSource:V}},Id=(d,m)=>{let g=d.inputs;Wf(g,m),d.compute(Lf(d.inputs,m))},Cd=d=>X({blockSize:d.blockSize,gatherAxis:d.gatherAxis,quantizeAxis:d.quantizeAxis})}),Gf,Hf,kd,Ed,Pd=U(()=>{Y$2(),ne(),Se(),ie(),Gf=d=>{if(!d||d.length!==2)throw new Error("GatherElements requires 2 inputs.");if(d[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(d[0].dims.length!==d[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},Hf=(d,m)=>{let g=d[0].dims,w=d[0].dataType,$=g.length,I=d[1].dims,D=d[1].dataType,q=E$1.normalizeAxis(m.axis,$),j=g[q],G=I.slice(0),H=E$1.size(G),W=P("input",w,$),V=P("indicesInput",D,I.length),K=M$1("output",w,G.length),Z=[{type:12,data:H},{type:6,data:j},{type:12,data:q}];return Z.push(...N$1(g,I,G)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:G,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(H/64)},programUniforms:Z}),getShaderSource:Q=>`
      ${Q.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(W,V,K)}
      ${Q.mainStart()}
      ${Q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${K.offsetToIndices("global_idx")};

      var idx = ${V.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${W.type.indices}(outputIndices);
      ${W.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${W.getByIndices("inputIndices")};

      ${K.setByOffset("global_idx","value")};
  }`}},kd=d=>X({axis:d.axis}),Ed=(d,m)=>{let g=d.inputs;Gf(g),d.compute(Hf(d.inputs,m))}}),Ff,qf,Od,zd,Dd=U(()=>{Y$2(),ne(),ie(),Ff=d=>{if(!d)throw new Error("Input is missing");if(d.length<2||d.length>3)throw new Error("Invaid input number.");if(d.length===3&&d[2].dims.length>2)throw new Error("Invalid input shape of C");if(d[0].dataType!==d[1].dataType||d.length===3&&d[0].dataType!==d[2].dataType)throw new Error("Input types are mismatched")},qf=(d,m)=>{let g=d[0].dims.slice(),w=d[1].dims.slice(),[$,I,D]=Br.getShapeOfGemmResult(g,m.transA,w,m.transB,d.length===3?d[2].dims:void 0),q=[$,I];if(!q)throw new Error("Can't use gemm on the given tensors");let j=16,G=Math.ceil(I/j),H=Math.ceil($/j),W=!0,V=E$1.size(q),K=[{type:12,data:W?G:V},{type:12,data:$},{type:12,data:I},{type:12,data:D},{type:1,data:m.alpha},{type:1,data:m.beta}],Z=["type","type"];d.length===3&&(K.push(...N$1(d[2].dims)),Z.push("rank")),K.push(...N$1(q));let Q=re=>{let se="";m.transA&&m.transB?se="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":m.transA&&!m.transB?se="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!m.transA&&m.transB?se="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!m.transA&&!m.transB&&(se="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let oe=m.alpha===1?"":"value *= uniforms.alpha;",ee=P("a",d[0].dataType,d[0].dims),ae=P("b",d[1].dataType,d[1].dims),ce=ee.type.value,le=null,de=[ee,ae];d.length===3&&(le=P("c",d[2].dataType,d[2].dims.length),de.push(le));let _e=M$1("output",d[0].dataType,q.length);de.push(_e);let we=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${re.registerUniforms(we).declareVariables(...de)}

  ${re.mainStart()}
    ${re.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${ce}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${se}
    }

    ${oe}
    ${le!=null?`let cOffset = ${le.broadcastedIndicesToOffset("vec2(m, n)",_e)}; value += ${ce}(uniforms.beta) * ${le.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},J=re=>{let se=P("a",d[0].dataType,d[0].dims),oe=P("b",d[1].dataType,d[1].dims),ee=null,ae=[se,oe];d.length===3&&(ee=P("c",d[2].dataType,d[2].dims.length),ae.push(ee));let ce=M$1("output",d[0].dataType,q.length);ae.push(ce);let le=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],de="",_e="";m.transA&&m.transB?(_e=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${se.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${oe.type.value}(0);
      }
      `,de="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):m.transA&&!m.transB?(_e=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${se.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${oe.type.value}(0);
      }
      `,de="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!m.transA&&m.transB?(_e=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${se.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${oe.type.value}(0);
      }
      `,de="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!m.transA&&!m.transB&&(_e=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${se.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${oe.type.value}(0);
      }
      `,de="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let we=m.alpha===1?"":"value *= uniforms.alpha;";return`
  ${re.registerUniforms(le).declareVariables(...ae)}
  var<workgroup> tile_a: array<array<${se.type.storage}, ${j}>, ${j}>;
  var<workgroup> tile_b: array<array<${oe.type.storage}, ${j}>, ${j}>;
  ${re.mainStart([j,j,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${j};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${j};
    let num_tiles = (uniforms.K - 1) / ${j} + 1;
    var k_start = 0u;
    var value = ${ce.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${_e}
      k_start = k_start + ${j};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${j}; k++) {
        ${de}
      }
      workgroupBarrier();
    }

    ${we}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${ee!=null?`let cOffset = ${ee.broadcastedIndicesToOffset("vec2(m, n)",ce)}; value += ${ce.type.value}(uniforms.beta) * ${ee.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return W?{name:"GemmShared",shaderCache:{hint:`${m.cacheKey}`,inputDependencies:Z},getRunData:()=>({outputs:[{dims:q,dataType:d[0].dataType}],dispatchGroup:{x:G*H},programUniforms:K}),getShaderSource:J}:{name:"Gemm",shaderCache:{hint:`${m.cacheKey}`,inputDependencies:Z},getRunData:()=>({outputs:[{dims:q,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(V/64)},programUniforms:K}),getShaderSource:Q}},Od=d=>{let m=d.transA,g=d.transB,w=d.alpha,$=d.beta;return{transA:m,transB:g,alpha:w,beta:$,cacheKey:`${d.transA};${d.transB};${d.alpha===1}`}},zd=(d,m)=>{Ff(d.inputs),d.compute(qf(d.inputs,m))}}),dt,$t,Vt,Wt,Kf,jf,Zf,Qf,Yf,Xf,Jf,eh,Bd,Md,Rd=U(()=>{Y$2(),ne(),Se(),ie(),[dt,$t,Vt,Wt]=[0,1,2,3],Kf=d=>{if(d[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(d[0].dims.length!==d[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(d[0].dims.length-2!==d[1].dims[d[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${d[0].dims.length-2}`);if(d[0].dims[0]!==d[1].dims[0])throw new Error("grid batch size must match input batch size")},jf=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,Zf=d=>`
  fn gs_bicubic_interpolate(p: mat4x4<${d}>, x: f32, y: f32) -> ${d} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${d}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,Qf=d=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${d.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,Yf=d=>`
  ${d.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,Xf=(d,m,g)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${m} {
     var pixel = ${m}(0);
     var indices = vec4<u32>(0);
     indices[${dt}] = batch;
     indices[${$t}] = channel;`+(()=>{switch(g.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${Vt}] = u32(r);
            indices[${Wt}] = u32(c);
          } else {
            return ${m}(0);
          }
        `;case"border":return`
          indices[${Vt}] = u32(clamp(r, 0, H - 1));
          indices[${Wt}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${Vt}] = gs_reflect(r, border[1], border[3]);
          indices[${Wt}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${g.paddingMode} is not supported`)}})()+`
    return ${d.getByIndices("indices")};
  }
`,Jf=(d,m,g)=>(()=>{switch(g.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${dt}], indices[${$t}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${dt}], indices[${$t}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${dt}], indices[${$t}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${dt}], indices[${$t}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${dt}], indices[${$t}], border);

          let dx2 = ${m}(f32(x2) - x);
          let dx1 = ${m}(x - f32(x1));
          let dy2 = ${m}(f32(y2) - y);
          let dy1 = ${m}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${m}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${dt}], indices[${$t}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${g.mode} is not supported`)}})()+`${d.setByOffset("global_idx","result")}`,eh=(d,m)=>{let g=P("x",d[0].dataType,d[0].dims.length),w=[d[1].dims[0],d[1].dims[1],d[1].dims[2]],$=P("grid",d[1].dataType,w.length,2),I=[d[0].dims[0],d[0].dims[1],d[1].dims[1],d[1].dims[2]];m.format==="NHWC"&&(I=[d[0].dims[0],d[1].dims[1],d[1].dims[2],d[0].dims[3]],[dt,$t,Vt,Wt]=[0,3,1,2]);let D=M$1("output",d[0].dataType,I.length),q=g.type.value,j=E$1.size(I),G=[{type:12,data:j},...N$1(d[0].dims,w,I)],H=W=>`
  ${W.registerUniform("output_size","u32").declareVariables(g,$,D)}
  ${jf}
  ${Zf(q)}
  ${Qf(m)}
  ${Yf(m)}
  ${Xf(g,q,m)}

  ${W.mainStart()}
    ${W.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${Vt}]);
      let W_in = i32(uniforms.x_shape[${Wt}]);

      ${m.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${D.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${dt}], indices[${Vt}], indices[${Wt}]);
      let nxy = ${$.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${Jf(D,q,m)}
  }`;return{name:"GridSample",shaderCache:{hint:`${m.cacheKey}`,inputDependencies:["type","type"]},getRunData:W=>{let V=E$1.size(I);return{outputs:[{dims:I,dataType:W[0].dataType}],dispatchGroup:{x:Math.ceil(V/64)},programUniforms:G}},getShaderSource:H}},Bd=(d,m)=>{Kf(d.inputs),d.compute(eh(d.inputs,m))},Md=d=>X({alignCorners:d.align_corners,mode:d.mode,paddingMode:d.padding_mode,format:d.format})}),Be,nh,Nd,Ud,oh,tr,Vd,$o=U(()=>{Y$2(),ne(),Se(),Wr(),qr(),ie(),ut(),Be=(d,m)=>d.length>m&&d[m].dims.length>0?d[m]:void 0,nh=(d,m)=>{let g=d[0],w=Be(d,1),$=Be(d,2),I=Be(d,3),D=Be(d,4),q=Be(d,5),j=Be(d,6),G=Be(d,7);if(g.dims.length!==3&&g.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let H=g.dims[0],W=g.dims[1],V=g.dims.length===3?g.dims[2]:m.numHeads*g.dims[4],K=W,Z=0,Q=0,J=Math.floor(V/m.numHeads);if(j&&G&&E$1.size(j.dims)&&E$1.size(G.dims)){if(j.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(j.dims[0]!==H||j.dims[1]!==m.numHeads||j.dims[3]!==J)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(G.dims[0]!==H||G.dims[1]!==m.numHeads||G.dims[3]!==J)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(j.dims[2]!==G.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(G.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');Z=j.dims[2],Q=j.dims[2]}else if(j&&E$1.size(j.dims)||G&&E$1.size(G.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let re;if(w&&E$1.size(w.dims)>0){if(g.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(w.dims.length<3||w.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(g.dims[0]!==w.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(w.dims.length===3){if(w.dims[2]!==g.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');re=2,K=w.dims[1]}else if(w.dims.length===5){if(w.dims[2]!==m.numHeads||w.dims[3]!==2||w.dims[4]!==J)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if($)throw new Error('Expect "value" be none when "key" has packed kv format.');re=5,K=w.dims[1]}else{if(w.dims[1]!==m.numHeads||w.dims[3]!==J)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');re=0,K=w.dims[2]}}else{if(g.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(g.dims[2]!==m.numHeads||g.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');re=3}if(I&&E$1.size(I.dims)>0){if(I.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(w&&w.dims.length===5&&w.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let se=Z+K,oe=0;if(D&&E$1.size(D.dims)>0){oe=8;let le=D.dims;throw le.length===1?le[0]===H?oe=1:le[0]===3*H+2&&(oe=3):le.length===2&&le[0]===H&&le[1]===se&&(oe=5),oe===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let ee=!1,ae=V;if($&&E$1.size($.dims)>0){if($.dims.length!==3&&$.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(g.dims[0]!==$.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if($.dims.length===3){if(K!==$.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');ae=$.dims[2]}else{if(K!==$.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');ae=$.dims[1]*$.dims[3],ee=!0}}let ce=!1;if(D&&E$1.size(D.dims)>0)throw new Error("Key padding mask is not supported");if(q&&E$1.size(q.dims)>0){if(q.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(q.dims[0]!==H||q.dims[1]!==m.numHeads||q.dims[2]!==W||q.dims[3]!==se)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:H,sequenceLength:W,pastSequenceLength:Z,kvSequenceLength:K,totalSequenceLength:se,maxSequenceLength:Q,inputHiddenSize:0,hiddenSize:V,vHiddenSize:ae,headSize:J,vHeadSize:Math.floor(ae/m.numHeads),numHeads:m.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:m.maskFilterValue,maskType:oe,scale:m.scale,broadcastResPosBias:ce,passPastInKv:ee,qkvFormat:re}},Nd=d=>X({...d}),Ud=X({perm:[0,2,1,3]}),oh=(d,m,g,w,$,I,D)=>{let q=[w,$,I],j=E$1.size(q),G=[{type:12,data:j},{type:12,data:D},{type:12,data:I}],H=W=>{let V=M$1("qkv_with_bias",m.dataType,q),K=P("qkv",m.dataType,q),Z=P("bias",g.dataType,q),Q=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${W.registerUniforms(Q).declareVariables(K,Z,V)}
  ${W.mainStart()}
    ${W.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return d.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:q,dataType:m.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:G}),getShaderSource:H},{inputs:[m,g],outputs:[-1]})[0]},tr=(d,m,g,w,$,I,D,q)=>{let j=I;if(D&&E$1.size(D.dims)>0){if(w===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return j=oh(d,I,D,m,w,g*$,q),j=j.reshape([m,w,g,$]),g===1||w===1?j:d.compute(ke(j,Ud.perm),{inputs:[j],outputs:[-1]})[0]}else return I.dims.length===3&&(j=I.reshape([m,w,g,$])),g===1||w===1?j:d.compute(ke(j,Ud.perm),{inputs:[j],outputs:[-1]})[0]},Vd=(d,m)=>{let g=nh(d.inputs,m),w=d.inputs[0],$=Be(d.inputs,1),I=Be(d.inputs,2),D=Be(d.inputs,3),q=Be(d.inputs,4),j=Be(d.inputs,5),G=Be(d.inputs,6),H=Be(d.inputs,7);if(w.dims.length===5)throw new Error("Packed QKV is not implemented");if($?.dims.length===5)throw new Error("Packed KV is not implemented");let W=$&&I&&$.dims.length===4&&I.dims.length===4,V=tr(d,g.batchSize,g.numHeads,g.sequenceLength,g.headSize,w,D,0);if(W)return Nt(d,V,$,I,q,void 0,G,H,j,g);if(!$||!I)throw new Error("key and value must be provided");let K=tr(d,g.batchSize,g.numHeads,g.kvSequenceLength,g.headSize,$,D,g.hiddenSize),Z=tr(d,g.batchSize,g.numHeads,g.kvSequenceLength,g.vHeadSize,I,D,2*g.hiddenSize);Nt(d,V,K,Z,q,void 0,G,H,j,g)}}),ih,ah,sh,uh,xo,Wd,Ld,So=U(()=>{Y$2(),ne(),Se(),ie(),ih=d=>{if(!d||d.length<1)throw new Error("too few inputs")},ah=(d,m)=>{let g=[],w=m.numOutputs;return d[1].dims[0]>0&&(d[1].getBigInt64Array().forEach($=>g.push(Number($))),w=g.length),X({numOutputs:w,axis:m.axis,splitSizes:g})},sh=d=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${d}u; i += 1u ) {
    if (index < ${F("uniforms.size_in_split_axis","i",d)}) {
        return i;
    }
    }
    return ${d}u;
}`,uh=d=>{let m=d.length,g=[];for(let w=0;w<m;++w){let $=d[w].setByIndices("indices","input[global_idx]");m===1?g.push($):w===0?g.push(`if (output_number == ${w}u) { ${$} }`):w===m-1?g.push(`else { ${$} }`):g.push(`else if (output_number == ${w}) { ${$} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${d[0].type.indices}, global_idx: u32) {
        ${g.join(`
`)}
      }`},xo=(d,m)=>{let g=d[0].dims,w=E$1.size(g),$=d[0].dataType,I=E$1.normalizeAxis(m.axis,g.length),D=new Array(m.numOutputs),q=P("input",$,g.length),j=new Array(m.numOutputs),G=[],H=[],W=0,V=[{type:12,data:w}];for(let Z=0;Z<m.numOutputs;Z++){W+=m.splitSizes[Z],j[Z]=W;let Q=g.slice();Q[I]=m.splitSizes[Z],H.push(Q),D[Z]=M$1(`output${Z}`,$,Q.length),G.push({dims:H[Z],dataType:d[0].dataType})}V.push({type:12,data:j},...N$1(g,...H));let K=Z=>`
  ${Z.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",j.length).declareVariables(q,...D)}
  ${sh(j.length)}
  ${uh(D)}

  ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${q.offsetToIndices("global_idx")};
    var index = ${q.indicesGet("indices",I)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${F("uniforms.size_in_split_axis","output_number - 1u",j.length)};
      ${q.indicesSet("indices",I,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:m.cacheKey,inputDependencies:["rank"]},getShaderSource:K,getRunData:()=>({outputs:G,dispatchGroup:{x:Math.ceil(w/64)},programUniforms:V})}},Wd=(d,m)=>{ih(d.inputs);let g=d.inputs.length===1?m:ah(d.inputs,m);d.compute(xo(d.inputs,g),{inputs:[0]})},Ld=d=>{let m=d.axis,g=d.splitSizes,w=d.numOutputs<0?g.length:d.numOutputs;if(w!==g.length)throw new Error("numOutputs and splitSizes lengh must be equal");return X({axis:m,numOutputs:w,splitSizes:g})}}),dh,rn,Gd,To=U(()=>{Y$2(),ne(),Se(),ie(),dh=(d,m)=>{let[g,w,$,I]=d,{numHeads:D,rotaryEmbeddingDim:q}=m;if(g.dims.length!==3&&g.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${g.dims.length}`);if(!E$1.areEqual(w.dims,[])&&!E$1.areEqual(w.dims,[1])&&w.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${w.dims.length}`);if($.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${$.dims.length}`);if(I.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${I.dims.length}`);if(!E$1.areEqual($.dims,I.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(q>0&&D===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let j=g.dims[0],G=g.dims[g.dims.length-2],H=$.dims[0],W=E$1.sizeFromDimension(g.dims,1)/G,V=q===0?$.dims[1]*2:W/D;if(q>V)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(w.dims.length===2){if(j!==w.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${w.dims[0]}`);if(G!==w.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${w.dims[1]}`)}if(V/2!==$.dims[1]&&q/2!==$.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${$.dims[1]}`);if(G>H)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},rn=(d,m)=>{let{interleaved:g,numHeads:w,rotaryEmbeddingDim:$,scale:I}=m,D=d[0].dims[0],q=E$1.sizeFromDimension(d[0].dims,1),j=d[0].dims[d[0].dims.length-2],G=q/j,H=d[2].dims[1],W=$===0?H*2:G/w,V=new Array(D,j,G/W,W-H),K=E$1.computeStrides(V),Z=[{type:1,data:I},{type:12,data:V},{type:12,data:K},...d[0].dims.length===3?new Array({type:12,data:[q,G,W,1]}):[],...d[0].dims.length===4?new Array({type:12,data:[q,W,j*W,1]}):[],...N$1(d[0].dims,d[1].dims,d[2].dims,d[3].dims,d[0].dims)],Q=J=>{let re=P("input",d[0].dataType,d[0].dims.length),se=P("position_ids",d[1].dataType,d[1].dims.length),oe=P("cos_cache",d[2].dataType,d[2].dims.length),ee=P("sin_cache",d[3].dataType,d[3].dims.length),ae=M$1("output",d[0].dataType,d[0].dims.length);return J.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:V.length},{name:"global_strides",type:"u32",length:K.length},{name:"input_output_strides",type:"u32",length:K.length}]),`
        ${J.declareVariables(re,se,oe,ee,ae)}

        ${J.mainStart(kt)}
          let half_rotary_emb_dim = uniforms.${oe.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${J.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${se.broadcastedIndicesToOffset("bsnh.xy",M$1("",se.type.tensor,2))};
            let position_id =
                u32(${se.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${g});
            let j = i + select(half_rotary_emb_dim, 1, ${g});
            let re = ${re.getByOffset("i")} * ${oe.get("position_id","bsnh[3]")} -
                ${re.getByOffset("j")} * ${ee.get("position_id","bsnh[3]")};
            ${ae.setByOffset("i","re")}
            let im = ${re.getByOffset("i")} * ${ee.get("position_id","bsnh[3]")} +
                ${re.getByOffset("j")} * ${oe.get("position_id","bsnh[3]")};
            ${ae.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${ae.setByOffset("k",re.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:X({interleaved:g}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:Q,getRunData:()=>({outputs:[{dims:d[0].dims,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(E$1.size(V)/kt)},programUniforms:Z})}},Gd=(d,m)=>{dh(d.inputs,m),d.compute(rn(d.inputs,m))}}),lh,ch,Hd,ph,Fd,qd=U(()=>{Se(),Y$2(),qr(),$o(),So(),ut(),To(),ie(),lh=(d,m)=>{if(m.doRotary&&d.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let g=d[0],w=d[1],$=d[2],I=d[3],D=d[4];if(m.doRotary!==0&&d.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(m.localWindowSize!==-1)throw new Error("Local attention is not supported");if(m.softcap!==0)throw new Error("Softcap is not supported");if(m.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(m.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(g.dims.length!==3&&g.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let q=!1,j=g.dims[0],G=g.dims[1],H=g.dims.length===3?q?g.dims[2]/3:g.dims[2]:m.numHeads*g.dims[4],W=G,V=0,K=!w||w.dims.length===0,Z=Math.floor(K?H/(m.numHeads+2*m.kvNumHeads):H/m.numHeads);K&&(H=Z*m.numHeads);let Q=I&&I.dims.length!==0,J=D&&D.dims.length!==0;if(Q&&I.dims.length===4&&I.dims[0]===j&&I.dims[1]!==m.kvNumHeads&&I.dims[2]===m.kvNumHeads&&I.dims[3]===Z)throw new Error("BSNH pastKey/pastValue is not supported");if(Q&&J){if(I.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(D.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');V=I.dims[2]}else if(Q||J)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let re=1;if(w&&w.dims.length>0){if(g.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(w.dims.length<3||w.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(g.dims[0]!==w.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(w.dims.length===3){if(g.dims[2]%w.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');W=w.dims[1]}else if(w.dims.length===5){if(w.dims[2]!==m.numHeads||w.dims[3]!==2||w.dims[4]!==Z)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if($)throw new Error('Expect "value" be none when "key" has packed kv format.');W=w.dims[1]}else{if(w.dims[1]!==m.numHeads||w.dims[3]!==Z)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');W=w.dims[2]}}else{if(g.dims.length!==3&&g.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(g.dims.length===5&&(g.dims[2]!==m.numHeads||g.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');re=3}let se=0,oe=!1,ee=m.kvNumHeads?Z*m.kvNumHeads:H;if($&&$.dims.length>0){if($.dims.length!==3&&$.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(g.dims[0]!==$.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if($.dims.length===3){if(W!==$.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');ee=$.dims[2]}else{if(W!==$.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');ee=$.dims[1]*$.dims[3],oe=!0}}let ae=d.length>4?d[5]:void 0;if(ae&&ae.dims.length!==1&&ae.dims[0]!==j)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:j,sequenceLength:G,pastSequenceLength:V,kvSequenceLength:W,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:H,vHiddenSize:ee,headSize:Z,vHeadSize:Math.floor(ee/m.kvNumHeads),numHeads:m.numHeads,kvNumHeads:m.kvNumHeads,nReps:m.numHeads/m.kvNumHeads,pastPresentShareBuffer:!1,maskType:se,scale:m.scale,broadcastResPosBias:!1,passPastInKv:oe,qkvFormat:re}},ch=X({perm:[0,2,1,3]}),Hd=(d,m,g)=>{let w=m,$=g.kvNumHeads;return m.dims.length===3&&g.kvSequenceLength!==0&&(w=m.reshape([g.batchSize,g.kvSequenceLength,$,g.headSize]),w=d.compute(ke(w,ch.perm),{inputs:[w],outputs:[-1]})[0]),w},ph=(d,m,g,w)=>{let $=7,I=["type","type"],D=[d*m],q=d*m,j=[{type:12,data:q},{type:12,data:m},{type:12,data:d}],G=H=>{let W=P("seq_lens",g.dataType,g.dims),V=P("total_seq_lens",w.dataType,w.dims),K=M$1("pos_ids",$,D),Z=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${H.registerUniforms(Z).declareVariables(W,V,K)}
  ${H.mainStart()}
    ${H.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${V.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${W.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${K.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${K.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${K.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${d};${m}`,inputDependencies:I},getRunData:()=>({outputs:[{dims:D,dataType:$}],dispatchGroup:{x:Math.ceil(q/64)},programUniforms:j}),getShaderSource:G}},Fd=(d,m)=>{let g=lh(d.inputs,m);if(d.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(d.inputs[1]?.dims.length===5)throw new Error("Packed KV is not implemented");let w=d.inputs[0],$=d.inputs[1]&&d.inputs[1].dims.length>0?d.inputs[1]:void 0,I=d.inputs[2]&&d.inputs[2].dims.length>0?d.inputs[2]:void 0,D=d.inputs[3]&&d.inputs[3].dims.length!==0?d.inputs[3]:void 0,q=d.inputs[4]&&d.inputs[4].dims.length!==0?d.inputs[4]:void 0,j=d.inputs.length>4?d.inputs[5]:void 0,G=d.inputs.length>5?d.inputs[6]:void 0,H=g.kvNumHeads?g.kvNumHeads:g.numHeads,W=X({axis:2,numOutputs:3,splitSizes:[g.numHeads*g.headSize,H*g.headSize,H*g.headSize]}),[V,K,Z]=!$&&!I?d.compute(xo([w],W),{inputs:[w],outputs:[-1,-1,-1]}):[w,$,I],Q,J;if(m.doRotary){let ee=d.compute(ph(g.batchSize,g.sequenceLength,j,G),{inputs:[j,G],outputs:[-1]})[0],ae=d.inputs[7],ce=d.inputs[8],le=X({interleaved:m.rotaryInterleaved!==0,numHeads:g.numHeads,rotaryEmbeddingDim:0,scale:m.scale}),de=[V,ee,ae,ce],_e=[-1];Q=d.compute(rn(de,le),{inputs:de,outputs:_e})[0],de.splice(0,1,K);let we=X({interleaved:m.rotaryInterleaved!==0,numHeads:g.kvNumHeads,rotaryEmbeddingDim:0,scale:m.scale});J=d.compute(rn(de,we),{inputs:de,outputs:_e})[0]}let re=tr(d,g.batchSize,g.numHeads,g.sequenceLength,g.headSize,m.doRotary?Q:V,void 0,0),se=Hd(d,m.doRotary?J:K,g),oe=Hd(d,Z,g);Nt(d,re,se,oe,void 0,void 0,D,q,void 0,g,j,G)}}),Kd,mh,fh,jd,Zd=U(()=>{Y$2(),ne(),ut(),ie(),Kd=(d,m,g,w,$,I,D,q)=>{let j=me(I),G=j===1?"f32":`vec${j}f`,H=j===1?"vec2f":`mat2x${j}f`,W=$*D,V=64;W===1&&(V=256);let K=[$,D,I/j],Z=[$,D,2],Q=["rank","type","type"],J=[];J.push(...N$1(K,Z));let re=se=>{let oe=P("x",m.dataType,3,j),ee=P("scale",g.dataType,g.dims),ae=P("bias",w.dataType,w.dims),ce=M$1("output",1,3,2),le=[oe,ee,ae,ce];return`
  var<workgroup> workgroup_shared : array<${H}, ${V}>;
  const workgroup_size = ${V}u;
  ${se.declareVariables(...le)}
  ${se.mainStart(V)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${G}(0);
    var squared_sum = ${G}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${G}(${oe.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${H}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${Fe("workgroup_shared[0][0]",j)} / f32(hight * ${j});
      let squared_sum_final = ${Fe("workgroup_shared[0][1]",j)} / f32(hight * ${j});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${q}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return d.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${j};${q};${V}`,inputDependencies:Q},getRunData:()=>({outputs:[{dims:Z,dataType:1}],dispatchGroup:{x:W},programUniforms:J}),getShaderSource:re},{inputs:[m,g,w],outputs:[-1]})[0]},mh=(d,m,g)=>{let w=m[0].dims,$=w,I=2,D=w[0],q=w[1],j=E$1.sizeFromDimension(w,I),G=me(j),H=E$1.size($)/G,W=Kd(d,m[0],m[1],m[2],D,j,q,g.epsilon),V=[D,q,j/G],K=[D,q],Z=["type","none"],Q=J=>{let re=P("x",m[0].dataType,V.length,G),se=P("scale_shift",1,K.length,2),oe=M$1("output",m[0].dataType,V.length,G),ee=[re,se,oe];return`
  ${J.registerUniform("output_size","u32").declareVariables(...ee)}
  ${J.mainStart()}
  ${J.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${oe.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${se.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${re.getByOffset("global_idx")} * ${oe.type.value}(scale_shift.x) + ${oe.type.value}(scale_shift.y);
      ${oe.setByOffset("global_idx","value")};
  }`};d.compute({name:"InstanceNormalization",shaderCache:{hint:`${G}`,inputDependencies:Z},getRunData:()=>({outputs:[{dims:$,dataType:m[0].dataType}],dispatchGroup:{x:Math.ceil(H/64)},programUniforms:[{type:12,data:H},...N$1(V,K,V)]}),getShaderSource:Q},{inputs:[m[0],W]})},fh=(d,m,g)=>{let w=m[0].dims,$=w,I=w[0],D=w[w.length-1],q=E$1.sizeFromDimension(w,1)/D,j=me(D),G=E$1.size($)/j,H=[{type:12,data:q},{type:12,data:Math.floor(D/j)}],W=["type","type"],V=!1,K=[0,w.length-1];for(let re=0;re<w.length-2;re++)V=V||w[re+1]!==1,K.push(re+1);V=V&&w[w.length-1]!==1;let Z=V?d.compute(ke(d.inputs[0],K),{inputs:[d.inputs[0]],outputs:[-1]})[0]:d.inputs[0].reshape(Array.from({length:w.length},(re,se)=>w[K[se]])),Q=Kd(d,Z,m[1],m[2],I,q,D,g.epsilon),J=re=>{let se=ye(m[0].dataType),oe=j===1?"vec2f":`mat${j}x2f`,ee=le=>{let de=le===0?"x":"y",_e=j===1?"f32":`vec${j}f`;switch(j){case 1:return`${se}(${_e}(scale.${de}))`;case 2:return`vec2<${se}>(${_e}(scale[0].${de}, scale[1].${de}))`;case 4:return`vec4<${se}>(${_e}(scale[0].${de}, scale[1].${de}, scale[2].${de}, scale[3].${de}))`;default:throw new Error(`Not supported compoents ${j}`)}},ae=P("input",m[0].dataType,m[0].dims,j),ce=M$1("output",m[0].dataType,$,j);return`
  @group(0) @binding(0) var<storage, read> input : array<${ae.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${oe}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${ce.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${re.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${ee(0)}, ${ee(1)});
  }`};d.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${j}`,inputDependencies:W},getRunData:()=>({outputs:[{dims:$,dataType:m[0].dataType}],dispatchGroup:{x:Math.ceil(G/64)},programUniforms:H}),getShaderSource:J},{inputs:[m[0],Q]})},jd=(d,m)=>{m.format==="NHWC"?fh(d,d.inputs,m):mh(d,d.inputs,m)}}),hh,gh,Qd,Yd=U(()=>{Y$2(),ne(),ie(),hh=d=>{if(!d||d.length<2)throw new Error("layerNorm requires at least 2 inputs.")},gh=(d,m,g)=>{let w=m.simplified,$=d[0].dims,I=d[1],D=!w&&d[2],q=$,j=E$1.normalizeAxis(m.axis,$.length),G=E$1.sizeToDimension($,j),H=E$1.sizeFromDimension($,j),W=E$1.size(I.dims),V=D?E$1.size(D.dims):0;if(W!==H||D&&V!==H)throw new Error(`Size of X.shape()[axis:] == ${H}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${W} and bias size of ${V}`);let K=[];for(let ae=0;ae<$.length;++ae)ae<j?K.push($[ae]):K.push(1);let Z=me(H),Q=["type","type"],J=[{type:12,data:G},{type:1,data:H},{type:12,data:Math.floor(H/Z)},{type:1,data:m.epsilon}];D&&Q.push("type");let re=g>1,se=g>2,oe=ae=>{let ce=ye(d[0].dataType),le=[P("x",d[0].dataType,d[0].dims,Z),P("scale",I.dataType,I.dims,Z)];D&&le.push(P("bias",D.dataType,D.dims,Z)),le.push(M$1("output",d[0].dataType,q,Z)),re&&le.push(M$1("mean_data_output",1,K)),se&&le.push(M$1("inv_std_output",1,K));let de=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${ae.registerUniforms(de).declareVariables(...le)}
  ${ae.mainStart()}
    ${ae.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${ao("f32",Z)};
    var mean_square_vector = ${ao("f32",Z)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${Et(ce,Z,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${Fe("mean_vector",Z)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${Fe("mean_square_vector",Z)} / uniforms.norm_size ${w?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${Et(ce,Z,"x[j + offset]")};
      let f32scale = ${Et(ce,Z,"scale[j]")};
      output[j + offset] = ${le[0].type.value}((f32input ${w?"":"- mean"}) * inv_std_dev * f32scale
        ${D?`+ ${Et(ce,Z,"bias[j]")}`:""}
      );
    }

    ${re?"mean_data_output[global_idx] = mean":""};
    ${se?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},ee=[{dims:q,dataType:d[0].dataType}];return re&&ee.push({dims:K,dataType:1}),se&&ee.push({dims:K,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${Z};${g};${w}`,inputDependencies:Q},getRunData:()=>({outputs:ee,dispatchGroup:{x:Math.ceil(G/64)},programUniforms:J}),getShaderSource:oe}},Qd=(d,m)=>{hh(d.inputs),d.compute(gh(d.inputs,m,d.outputCount))}}),bh,Xd,Jd=U(()=>{ne(),Xr(),Jr(),bh=d=>{if(!d||d.length!==2)throw new Error("MatMul requires 2 inputs.");if(d[0].dims[d[0].dims.length-1]!==d[1].dims[d[1].dims.length-2])throw new Error("shared dimension does not match.")},Xd=d=>{bh(d.inputs);let m=et.calcShape(d.inputs[0].dims,d.inputs[1].dims,!0);if(!m)throw new Error("Can't use matmul on the given tensors");let g=m[m.length-1],w=d.inputs[0].dims[d.inputs[0].dims.length-1];if(g<8&&w<8)d.compute(Yr(d.inputs,{activation:""},m));else{let $=m[m.length-2],I=E$1.size(d.inputs[0].dims.slice(0,-2)),D=E$1.size(d.inputs[1].dims.slice(0,-2));if(I!==1&&$===1&&D===1){let q=d.inputs[0].reshape([1,I,w]),j=d.inputs[1].reshape([1,w,g]),G=[1,I,g],H=[q,j];d.compute(er(H,{activation:""},m,G),{inputs:H})}else d.compute(er(d.inputs,{activation:""},m))}}}),yh,_h,wh,el,tl,rl=U(()=>{Y$2(),ne(),Se(),ie(),yh=(d,m)=>{if(d.length<3||d.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let g=d[0],w=g.dims.length;if(g.dims[w-1]!==m.k)throw new Error("The last dim of input shape does not match the k value");let $=Math.floor((m.k+m.blockSize-1)/m.blockSize),I=m.blockSize/8*m.bits,D=d[1];if(!E$1.areEqual(D.dims,[m.n,$,I]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let q=d[2].dims;if(E$1.size(q)!==m.n*$)throw new Error("scales input size error.");if(d.length===4){let j=d[3].dims,G=m.bits>4?m.n*$:m.n*Math.floor(($+1)/2);if(E$1.size(j)!==G)throw new Error("zeroPoints input size error.")}},_h=(d,m)=>{let g=d[0].dims,w=g.length,$=g[w-2],I=m.k,D=m.n,q=g.slice(0,w-2),j=E$1.size(q),G=d[1].dims[2]/4,H=d[0].dataType,W=me(m.k),V=me(G),K=me(D),Z=q.concat([$,D]),Q=$>1&&D/K%2===0?2:1,J=E$1.size(Z)/K/Q,re=64,se=[],oe=[j,$,I/W],ee=E$1.convertShape(d[1].dims).slice();ee.splice(-1,1,G/V),se.push(...N$1(oe)),se.push(...N$1(ee)),se.push(...N$1(d[2].dims)),d.length===4&&se.push(...N$1(E$1.convertShape(d[3].dims)));let ae=[j,$,D/K];se.push(...N$1(ae));let ce=le=>{let de=oe.length,_e=P("a",d[0].dataType,de,W),we=P("b",12,ee.length,V),pe=P("scales",d[2].dataType,d[2].dims.length),xe=[_e,we,pe],Ge=d.length===4?P("zero_points",12,d[3].dims.length):void 0;Ge&&xe.push(Ge);let Te=ae.length,Ce=M$1("output",d[0].dataType,Te,K),Oe=ye(d[0].dataType),bt=(()=>{switch(W){case 1:return`array<${Oe}, 8>`;case 2:return`mat4x2<${Oe}>`;case 4:return`mat2x4<${Oe}>`;default:throw new Error(`${W}-component is not supported.`)}})(),Mt=()=>{let Ye=`
          // reuse a data
            var input_offset = ${_e.indicesToOffset(`${_e.type.indices}(batch, row, word_offset)`)};
            var a_data: ${bt};
            for (var j: u32 = 0; j < ${8/W}; j++) {
              a_data[j] = ${_e.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let xt=0;xt<K*Q;xt++)Ye+=`
            b_value = ${V===1?`b${xt}_data`:`b${xt}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${bt}(${Array.from({length:4},(ar,ht)=>`${Oe}(b_value_lower[${ht}]), ${Oe}(b_value_upper[${ht}])`).join(", ")});
            b_dequantized_values = ${W===1?`${bt}(${Array.from({length:8},(ar,ht)=>`(b_quantized_values[${ht}] - ${Ge?`zero_point${xt}`:"zero_point"}) * scale${xt}`).join(", ")});`:`(b_quantized_values - ${bt}(${Array(8).fill(`${Ge?`zero_point${xt}`:"zero_point"}`).join(",")})) * scale${xt};`};
            workgroup_shared[local_id.x * ${Q} + ${Math.floor(xt/K)}]${K>1?`[${xt%K}]`:""} += ${Array.from({length:8/W},(ar,ht)=>`${W===1?`a_data[${ht}] * b_dequantized_values[${ht}]`:`dot(a_data[${ht}], b_dequantized_values[${ht}])`}`).join(" + ")};
          `;return Ye},lt=()=>{let Ye=`
            var col_index = col * ${K};
            ${Ge?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Oe}(8);`}
            `;for(let xt=0;xt<K*Q;xt++)Ye+=`
            let scale${xt} = ${pe.getByOffset("col_index * nBlocksPerCol + block")};
            ${Ge?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${Ge.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${xt} = ${Oe}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return Ye},ir=()=>{let Ye=`col_index = col * ${K};`;for(let xt=0;xt<K*Q;xt++)Ye+=`
            let b${xt}_data = ${we.getByIndices(`${we.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return Ye+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${bt};
            var b_dequantized_values: ${bt};`,Ye};return`
        var<workgroup> workgroup_shared: array<${Ce.type.value}, ${Q*re}>;
        ${le.declareVariables(...xe,Ce)}
        ${le.mainStart([re,1,1])}
          let output_indices = ${Ce.offsetToIndices(`(global_idx / ${re}) * ${Q}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${re}) {
            //process one block
            var word_offset: u32 = block * ${m.blockSize/W};
            ${lt()}
            for (var word: u32 = 0; word < ${G}; word += ${V}) {
              ${ir()}
              for (var i: u32 = 0; i < ${V}; i++) {
                ${Mt()}
                word_offset += ${8/W};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${Q}) {
            var output_value: ${Ce.type.value} = ${Ce.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${re}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${Q};
            }
            ${Ce.setByIndices(`${Ce.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${m.blockSize};${m.bits};${W};${V};${K};${Q};${re}`,inputDependencies:Array(d.length).fill("rank")},getRunData:()=>({outputs:[{dims:Z,dataType:H}],dispatchGroup:{x:J},programUniforms:se}),getShaderSource:ce}},wh=(d,m)=>{let g=d[0].dims,w=g.length,$=g[w-2],I=m.k,D=m.n,q=g.slice(0,w-2),j=E$1.size(q),G=d[1].dims[2]/4,H=d[0].dataType,W=me(m.k),V=me(G),K=q.concat([$,D]),Z=128,Q=D%8===0?8:D%4===0?4:1,J=Z/Q,re=J*V*8,se=re/W,oe=re/m.blockSize,ee=E$1.size(K)/Q,ae=[],ce=[j,$,I/W],le=E$1.convertShape(d[1].dims).slice();le.splice(-1,1,G/V),ae.push(...N$1(ce)),ae.push(...N$1(le)),ae.push(...N$1(d[2].dims)),d.length===4&&ae.push(...N$1(E$1.convertShape(d[3].dims)));let de=[j,$,D];ae.push(...N$1(de));let _e=we=>{let pe=ce.length,xe=P("a",d[0].dataType,pe,W),Ge=P("b",12,le.length,V),Te=P("scales",d[2].dataType,d[2].dims.length),Ce=[xe,Ge,Te],Oe=d.length===4?P("zero_points",12,d[3].dims.length):void 0;Oe&&Ce.push(Oe);let bt=de.length,Mt=M$1("output",d[0].dataType,bt),lt=ye(d[0].dataType),ir=()=>{switch(W){case 1:return`
          let a_data0 = vec4<${lt}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${lt}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${lt}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${lt}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${W}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${xe.type.value}, ${se}>;
        var<workgroup> inter_results: array<array<${Mt.type.value}, ${J}>, ${Q}>;
        ${we.declareVariables(...Ce,Mt)}
        ${we.mainStart([J,Q,1])}
          let output_indices = ${Mt.offsetToIndices(`workgroup_index * ${Q}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${oe} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${se};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${se}; a_offset += ${Z})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${xe.getByIndices(`${xe.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${xe.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${oe} + local_id.x;
            ${Oe?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${Oe.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${lt}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${lt}(8);`}
            let scale = ${Te.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${Ge.getByIndices(`${Ge.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${m.blockSize/W};
            for (var i: u32 = 0; i < ${V}; i++) {
              ${ir()}
              let b_value = ${V===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${lt}>(${Array.from({length:4},(Ye,xt)=>`${lt}(b_value_lower[${xt}]), ${lt}(b_value_upper[${xt}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${lt}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(Ye,xt)=>`${`dot(a_data${xt}, b_dequantized_values[${xt}])`}`).join(" + ")};
              word_offset += ${8/W};
            }
            workgroupBarrier();
          }

          if (local_idx < ${Q}) {
            var output_value: ${Mt.type.value} = ${Mt.type.value}(0);
            for (var b = 0u; b < ${J}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${Mt.setByIndices(`${Mt.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${m.blockSize};${W};${V};${J};${Q}`,inputDependencies:Array(d.length).fill("rank")},getRunData:()=>({outputs:[{dims:K,dataType:H}],dispatchGroup:{x:ee},programUniforms:ae}),getShaderSource:_e}},el=(d,m)=>{yh(d.inputs,m),m.blockSize===32&&d.adapterInfo.isVendor("intel")&&d.adapterInfo.isArchitecture("gen-12lp")?d.compute(wh(d.inputs,m)):d.compute(_h(d.inputs,m))},tl=d=>X(d)}),vh,$h,xh,Sh,Th,Ih,Ch,Ah,nl,ol=U(()=>{Y$2(),ne(),ie(),vh=d=>{if(!d||d.length<1)throw new Error("Too few inputs");if(d[0].dataType!==1&&d[0].dataType!==10)throw new Error("Input type must be float or float16.");if(d.length>=2){let m=d[0].dims.length*2===d[1].dims[0];if(d.length===4&&(m=d[3].dims[0]*2===d[1].dims[0]),!m)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},$h=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
            k = i32(${d.indicesGet("indices",$)}) - ${F("uniforms.pads",$,g)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${F("uniforms.x_shape",$,m)})) {
              break;
            }
            offset += k * i32(${F("uniforms.x_strides",$,m)});
        `;return`
          value = ${d.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${w}
            value = x[offset];
          }
      `},xh=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
                k = i32(${d.indicesGet("indices",$)}) - ${F("uniforms.pads",$,g)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${F("uniforms.x_shape",$,m)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${F("uniforms.x_shape",$,m)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${F("uniforms.x_strides",$,m)});
            `;return`
              var offset = 0;
              var k = 0;
              ${w}
              value = x[offset];
          `},Sh=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
                k = i32(${d.indicesGet("indices",$)}) - ${F("uniforms.pads",$,g)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${F("uniforms.x_shape",$,m)})) {
                  k = i32(${F("uniforms.x_shape",$,m)}) - 1;
                }
                offset += k * i32(${F("uniforms.x_strides",$,m)});
            `;return`
              var offset = 0;
              var k = 0;
              ${w}
              value = x[offset];
          `},Th=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
                k = i32(${d.indicesGet("indices",$)}) - ${F("uniforms.pads",$,g)};
                if (k < 0)  {
                  k += i32(${F("uniforms.x_shape",$,m)}]);
                }
                if (k >= i32(${F("uniforms.x_shape",$,m)})) {
                  k -= i32(${F("uniforms.x_shape",$,m)});
                }
                offset += k * i32(${F("uniforms.x_strides",$,m)});
            `;return`
              var offset = 0;
              var k = 0;
              ${w}
              value = x[offset];
          `},Ih=(d,m,g)=>{switch(g.mode){case 0:return $h(d,m,g.pads.length);case 1:return xh(d,m,g.pads.length);case 2:return Sh(d,m,g.pads.length);case 3:return Th(d,m,g.pads.length);default:throw new Error("Invalid mode")}},Ch=(d,m)=>{let g=E$1.padShape(d[0].dims.slice(),m.pads),w=d[0].dims,$=E$1.size(g),I=[{type:12,data:$},{type:6,data:m.pads}],D=d.length>=3&&d[2].data;m.mode===0&&I.push({type:D?d[2].dataType:1,data:m.value}),I.push(...N$1(d[0].dims,g));let q=["rank"],j=G=>{let H=M$1("output",d[0].dataType,g.length),W=P("x",d[0].dataType,w.length),V=W.type.value,K=Ih(H,w.length,m),Z=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:m.pads.length}];return m.mode===0&&Z.push({name:"constant_value",type:D?V:"f32"}),`
            ${G.registerUniforms(Z).declareVariables(W,H)}
            ${G.mainStart()}
            ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${H.offsetToIndices("global_idx")};

            var value = ${V}(0);
            ${K}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${m.mode}${D}`,inputDependencies:q},getRunData:()=>({outputs:[{dims:g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(E$1.size(g)/64)},programUniforms:I}),getShaderSource:j}},Ah=(d,m)=>{if(d.length>1){let g=d[1].getBigInt64Array(),w=d.length>=3&&d[2].data?d[2].dataType===10?d[2].getUint16Array()[0]:d[2].getFloat32Array()[0]:0,$=d[0].dims.length,I=new Int32Array(2*$).fill(0);if(d.length>=4){let q=d[3].getBigInt64Array();for(let j=0;j<q.length;j++)I[Number(q[j])]=Number(g[j]),I[Number(q[j])+$]=Number(g[j+q.length])}else g.forEach((q,j)=>I[Number(j)]=Number(q));let D=[];return I.forEach(q=>D.push(q)),{mode:m.mode,value:w,pads:D}}else return m},nl=(d,m)=>{vh(d.inputs);let g=Ah(d.inputs,m);d.compute(Ch(d.inputs,g),{inputs:[0]})}}),nn,il,al,sl,ul,kh,Eh,dl,ll,cl,pl,ml,fl,hl,gl,bl,yl,_l,wl,vl=U(()=>{We(),Y$2(),ne(),ie(),nn=d=>{if(be.webgpu.validateInputContent&&(!d||d.length!==1))throw new Error("Pool ops requires 1 input.")},il=(d,m,g)=>{let w=m.format==="NHWC",$=d.dims.slice();w&&$.splice(1,0,$.pop());let I=Object.hasOwnProperty.call(m,"dilations"),D=m.kernelShape.slice(),q=m.strides.slice(),j=I?m.dilations.slice():[],G=m.pads.slice();At.adjustPoolAttributes(g,$,D,q,j,G);let H=At.computePoolOutputShape(g,$,q,j,D,G,m.autoPad),W=Object.assign({},m);I?Object.assign(W,{kernelShape:D,strides:q,pads:G,dilations:j,cacheKey:m.cacheKey}):Object.assign(W,{kernelShape:D,strides:q,pads:G,cacheKey:m.cacheKey});let V=H.slice();return V.push(V.splice(1,1)[0]),[W,w?V:H]},al=(d,m)=>{let g=m.format==="NHWC",w=E$1.size(d),$=E$1.size(m.kernelShape),I=[{type:12,data:w},{type:12,data:$}],D=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(m.kernelShape.length<=2){let q=m.kernelShape[m.kernelShape.length-1],j=m.strides[m.strides.length-1],G=m.pads[m.pads.length/2-1],H=m.pads[m.pads.length-1],W=!!(G+H);I.push({type:12,data:q},{type:12,data:j},{type:12,data:G},{type:12,data:H}),D.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let V=!1;if(m.kernelShape.length===2){let K=m.kernelShape[m.kernelShape.length-2],Z=m.strides[m.strides.length-2],Q=m.pads[m.pads.length/2-2],J=m.pads[m.pads.length-2];V=!!(Q+J),I.push({type:12,data:K},{type:12,data:Z},{type:12,data:Q},{type:12,data:J}),D.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[I,D,!0,W,V]}else{if(g)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let q=E$1.computeStrides(m.kernelShape);I.push({type:12,data:q},{type:12,data:m.pads},{type:12,data:m.strides}),D.push({name:"kernelStrides",type:"u32",length:q.length},{name:"pads",type:"u32",length:m.pads.length},{name:"strides",type:"u32",length:m.strides.length});let j=m.pads.reduce((G,H)=>G+H);return[I,D,!!j,!1,!1]}},sl=(d,m,g,w,$,I,D,q,j,G,H,W)=>{let V=$.format==="NHWC",K=m.type.value,Z=M$1("output",m.type.tensor,w);if($.kernelShape.length<=2){let Q="",J="",re="",se=g-(V?2:1);if(H?Q=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${se}] = indices[${se}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${se}] < 0 || xIndices[${se}]
                      >= uniforms.x_shape[${se}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${m.indicesToOffset("xIndices")}];
                  ${I}
                }`:Q=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${se}] = indices[${se}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${m.indicesToOffset("xIndices")}];
                  ${I}
                }`,$.kernelShape.length===2){let oe=g-(V?3:2);W?J=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${oe}] = indices[${oe}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${oe}] < 0 || xIndices[${oe}] >= uniforms.x_shape[${oe}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:J=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${oe}] = indices[${oe}] * uniforms.sh - uniforms.phStart + j;
                `,re=`
              }
            `}return`
            ${d.registerUniforms(j).declareVariables(m,Z)}

            ${d.mainStart()}
              ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${Z.offsetToIndices("global_idx")};
              var xIndices = ${Z.offsetToIndices("global_idx")};

              var value = ${K}(${q});
              var pad = 0;
              ${J}
              ${Q}
              ${re}
              ${D}

              output[global_idx] = value;
            }`}else{if(V)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let Q=$.kernelShape.length,J=$.pads.length,re="";return G?re=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${m.indicesToOffset("xIndices")}];
                ${I}
              }`:re=`
              }
              let x_val = x[${m.indicesToOffset("xIndices")}];
              ${I}
            `,`
            ${d.registerUniforms(j).declareVariables(m,Z)}

            ${d.mainStart()}
              ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${Z.offsetToIndices("global_idx")};
              var xIndices = ${Z.offsetToIndices("global_idx")};

              var offsets: array<u32, ${Q}>;

              var value = ${K}(${q});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${Q-1}u; j++) {
                  offsets[j] = offset / ${F("uniforms.kernelStrides","j",Q)};
                  offset -= offsets[j] * ${F("uniforms.kernelStrides","j",Q)};
                }
                offsets[${Q-1}] = offset;

                isPad = false;
                for (var j = ${g-Q}u; j < ${g}u; j++) {
                  xIndices[j] = indices[j] * ${F("uniforms.strides",`j - ${g-Q}u`,Q)}
                    + offsets[j - ${g-Q}u] - ${F("uniforms.pads","j - 2u",J)};
                  ${re}
              }
              ${D}

              output[global_idx] = value;
            }`}},ul=d=>`${d.format};${d.ceilMode};${d.autoPad};${d.kernelShape.length}`,kh=d=>`${ul(d)};${d.countIncludePad}`,Eh=d=>`${ul(d)};${d.storageOrder};${d.dilations}`,dl=d=>({format:d.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][d.auto_pad],ceilMode:d.ceil_mode,kernelShape:d.kernel_shape,strides:d.strides,pads:d.pads}),ll=(d,m,g,w)=>{let[$,I]=il(m,w,g),D=P("x",m.dataType,m.dims.length),q=D.type.value,j="value += x_val;",G="";$.countIncludePad?G+=`value /= ${q}(uniforms.kernelSize);`:G+=`value /= ${q}(i32(uniforms.kernelSize) - pad);`;let[H,W,V,K,Z]=al(I,$);H.push(...N$1(m.dims,I));let Q=["rank"];return{name:d,shaderCache:{hint:`${w.cacheKey};${V};${K};${Z}`,inputDependencies:Q},getRunData:()=>({outputs:[{dims:I,dataType:m.dataType}],dispatchGroup:{x:Math.ceil(E$1.size(I)/64)},programUniforms:H}),getShaderSource:J=>sl(J,D,m.dims.length,I.length,$,j,G,0,W,V,K,Z)}},cl=d=>{let m=d.count_include_pad!==0,g=dl(d);if(g.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let w={countIncludePad:m,...g,cacheKey:""};return{...w,cacheKey:kh(w)}},pl=(d,m)=>{nn(d.inputs),d.compute(ll("AveragePool",d.inputs[0],!1,m))},ml={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},fl=d=>{let m=d.format;return{format:m,...ml,cacheKey:m}},hl=(d,m)=>{nn(d.inputs),d.compute(ll("GlobalAveragePool",d.inputs[0],!0,m))},gl=(d,m,g,w)=>{let[$,I]=il(m,w,g),D=`
      value = max(x_val, value);
    `,q="",j=P("x",m.dataType,m.dims.length),G=["rank"],[H,W,V,K,Z]=al(I,$);return H.push(...N$1(m.dims,I)),{name:d,shaderCache:{hint:`${w.cacheKey};${V};${K};${Z}`,inputDependencies:G},getRunData:()=>({outputs:[{dims:I,dataType:m.dataType}],dispatchGroup:{x:Math.ceil(E$1.size(I)/64)},programUniforms:H}),getShaderSource:Q=>sl(Q,j,m.dims.length,I.length,$,D,q,m.dataType===10?-65504:-1e5,W,V,K,Z)}},bl=(d,m)=>{nn(d.inputs),d.compute(gl("MaxPool",d.inputs[0],!1,m))},yl=d=>{let m=d.storage_order,g=d.dilations,w=dl(d);if(m!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(w.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let $={storageOrder:m,dilations:g,...w,cacheKey:""};return{...$,cacheKey:Eh($)}},_l=d=>{let m=d.format;return{format:m,...ml,cacheKey:m}},wl=(d,m)=>{nn(d.inputs),d.compute(gl("GlobalMaxPool",d.inputs[0],!0,m))}}),Oh,zh,$l,xl,Sl=U(()=>{Y$2(),ne(),Se(),ie(),Oh=(d,m)=>{if(d.length<2||d.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(d.length===3&&d[1].dims===d[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(d.length===3&&d[0].dataType!==d[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(d[0].dataType===6&&d.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(d[1].dims.length!==0&&d[1].dims.length!==1&&d[1].dims.length!==d[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(d.length>2){if(d[0].dataType!==d[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(d[1].dims.length!==d[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!d[1].dims.map((g,w)=>g===d[2].dims[w]).reduce((g,w)=>g&&w,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(m.blockSize>0){if(d[1].dims.length===0||d[1].dims.length===1&&d[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!d[1].dims.map(($,I)=>I===m.axis||$===d[0].dims[I]).reduce(($,I)=>$&&I,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(d[1].dims.length!==d[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let g=d[0].dims[m.axis],w=d[1].dims[m.axis];if(m.blockSize<Math.ceil(g/w)||m.blockSize>Math.ceil(g/(w-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},zh=(d,m)=>{let g=E$1.normalizeAxis(m.axis,d[0].dims.length),w=d[0].dataType,$=w===3,I=d[0].dims,D=d[1].dataType,q=E$1.size(I),j=w===3||w===2,G=j?[Math.ceil(E$1.size(d[0].dims)/4)]:d[0].dims,H=d[1].dims,W=d.length>2?d[2]:void 0,V=W?j?[Math.ceil(E$1.size(W.dims)/4)]:W.dims:void 0,K=H.length===0||H.length===1&&H[0]===1,Z=K===!1&&H.length===1,Q=me(q),J=K&&(!j||Q===4),re=J?Q:1,se=J&&!j?Q:1,oe=P("input",j?12:w,G.length,se),ee=P("scale",D,H.length),ae=W?P("zero_point",j?12:w,V.length):void 0,ce=M$1("output",D,I.length,re),le=[oe,ee];ae&&le.push(ae);let de=[G,H];W&&de.push(V);let _e=[{type:12,data:q/re},{type:12,data:g},{type:12,data:m.blockSize},...N$1(...de,I)],we=pe=>{let xe=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${pe.registerUniforms(xe).declareVariables(...le,ce)}
      ${pe.mainStart()}
          ${pe.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${ce.offsetToIndices("global_idx")};

          // Set input x
          ${j?`
            let input = ${oe.getByOffset("global_idx / 4")};
            let x_vec = ${$?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${re===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${oe.getByOffset("global_idx")};`};

          // Set scale input
          ${K?`let scale_value= ${ee.getByOffset("0")}`:Z?`
            let scale_index = ${ce.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${ee.getByOffset("scale_index")};`:`
            var scale_indices: ${ee.type.indices} = output_indices;
            let index = ${ee.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${ee.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${ee.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${ae?K?j?`
                let zero_point_input = ${ae.getByOffset("0")};
                let zero_point_vec =  ${$?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${ae.getByOffset("0")}`:Z?j?`
                let zero_point_index = ${ce.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${ae.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${$?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${ce.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${ae.getByOffset("zero_point_index")};`:j?`
                let zero_point_offset = ${ee.indicesToOffset("scale_indices")};
                let zero_point_input = ${ae.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${$?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${ae.getByIndices("scale_indices")};`:`let zero_point_value = ${j?$?"i32":"u32":oe.type.value}(0);`};
      // Compute and write output
      ${ce.setByOffset("global_idx",`${ce.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:m.cacheKey,inputDependencies:ae?["rank","rank","rank"]:["rank","rank"]},getShaderSource:we,getRunData:()=>({outputs:[{dims:I,dataType:D}],dispatchGroup:{x:Math.ceil(q/re/64),y:1,z:1},programUniforms:_e})}},$l=(d,m)=>{Oh(d.inputs,m),d.compute(zh(d.inputs,m))},xl=d=>X({axis:d.axis,blockSize:d.blockSize})}),Dh,Bh,Tl,Il=U(()=>{We(),Y$2(),ie(),Dh=(d,m,g)=>{let w=d===m,$=d<m&&g<0,I=d>m&&g>0;if(w||$||I)throw new Error("Range these inputs' contents are invalid.")},Bh=(d,m,g,w)=>{let $=Math.abs(Math.ceil((m-d)/g)),I=[$],D=$,q=[{type:12,data:D},{type:w,data:d},{type:w,data:g},...N$1(I)],j=G=>{let H=M$1("output",w,I.length),W=H.type.value,V=[{name:"outputSize",type:"u32"},{name:"start",type:W},{name:"delta",type:W}];return`
        ${G.registerUniforms(V).declareVariables(H)}
        ${G.mainStart()}
        ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${W}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${w}`},getShaderSource:j,getRunData:()=>({outputs:[{dims:I,dataType:w}],dispatchGroup:{x:Math.ceil(D/64)},programUniforms:q})}},Tl=d=>{let m=0,g=0,w=0;d.inputs[0].dataType===6?(m=d.inputs[0].getInt32Array()[0],g=d.inputs[1].getInt32Array()[0],w=d.inputs[2].getInt32Array()[0]):d.inputs[0].dataType===1&&(m=d.inputs[0].getFloat32Array()[0],g=d.inputs[1].getFloat32Array()[0],w=d.inputs[2].getFloat32Array()[0]),be.webgpu.validateInputContent&&Dh(m,g,w),d.compute(Bh(m,g,w,d.inputs[0].dataType),{inputs:[]})}}),Mh,Cl,Al,Rh,kl,El,Pl=U(()=>{Y$2(),ne(),Se(),ie(),Mh=(d,m,g,w)=>{if(d!=="none"&&w!=="i32"&&w!=="u32"&&w!=="f32")throw new Error(`Input ${w} is not supported with reduction ${d}.`);let $=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,I=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${m}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(d){case"none":return`${m}=${g};`;case"add":return w==="i32"||w==="u32"?`atomicAdd(&${m}, bitcast<${w}>(${g}));`:`
              ${$}bitcast<${w}>(oldValue) + (${g})${I}`;case"max":return w==="i32"||w==="u32"?`atomicMax(&${m}, bitcast<${w}>(${g}));`:`
                ${$}max(bitcast<f32>(oldValue), (${g}))${I}`;case"min":return w==="i32"||w==="u32"?`atomicMin(&${m}, bitcast<${w}>(${g}));`:`${$}min(bitcast<${w}>(oldValue), (${g}))${I}`;case"mul":return`${$}(bitcast<${w}>(oldValue) * (${g}))${I}`;default:throw new Error(`Reduction ${d} is not supported.`)}},Cl=(d,m)=>`${d===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[${m?"i - indices_start":"i"}];
    let dim_value = uniforms.output_shape[${m?"i - indices_start":"i"} + uniforms.last_index_dimension];`}
    
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));`,Al=(d,m,g)=>`for (var i = 0u; i < uniforms.num_updates_elements; i++) {
        let value = updates[uniforms.num_updates_elements * ${g?"global_idx":"idx"} + i];
        ${Mh(d.reduction,"output[data_offset + i]","value",m)}
      }`,Rh=(d,m)=>{let g=d[0].dims,w=d[1].dims,$=g,I=1,D=Math.ceil(E$1.size(w)/I),q=w[w.length-1],j=E$1.sizeFromDimension(g,q),G=E$1.sizeFromDimension(w,0)/q,H=[{type:12,data:D},{type:12,data:q},{type:12,data:j},...N$1(d[1].dims,d[2].dims,$)],W=V=>{let K=P("indices",d[1].dataType,d[1].dims.length),Z=P("updates",d[2].dataType,d[2].dims.length,I),Q=m.reduction!=="none"&&m.reduction!==""?ts("output",d[0].dataType,$.length):M$1("output",d[0].dataType,$.length,I);return`
      ${V.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(K,Z,Q)}
      ${V.mainStart()}
        ${V.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var hasDuplicates = false;
  if (${m.reduction==="none"}) {
    for (var i = 0; i < ${G}; i = i + 1) {
      for (var j = i + 1; j < ${G}; j = j + 1) {
        var index_i = i32(indices[i].x);
        var index_j = i32(indices[j].x);
        if (index_i == index_j) {
          hasDuplicates = true;
          break;
        }
      }
      if (hasDuplicates) {
        break;
      }
    }
  }

  if (${m.reduction==="none"} && hasDuplicates) {
    if (global_idx != 0u) {
      return;
    }
    // Process each index-update pair individually when duplicates exist
    for (var idx = 0u; idx < ${G}u; idx++) {
      var data_offset = 0u;
      for (var i = 0u; i < uniforms.last_index_dimension; i++) {
        var index = i32(indices[idx * uniforms.last_index_dimension + i].x);
        ${Cl(g.length,!1)}
      }
      ${Al(m,Q.type.value,!1)}
    }
    return;
  }

  var data_offset = 0u;
  var indices_start = uniforms.last_index_dimension * global_idx;
  var indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${Cl(g.length,!0)}
  }
  ${Al(m,Q.type.value,!0)}
  }`};return{name:"ScatterND",shaderCache:{hint:`${m.cacheKey}_${m.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:$,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(D/64)},programUniforms:H}),getShaderSource:W}},kl=d=>X({reduction:d.reduction}),El=(d,m)=>{d.compute(Rh(d.inputs,m),{inputs:[d.inputs[1],d.inputs[2]],outputs:[]})}}),Uh,Nh,Vh,Ol,Wh,Lh,Gh,Hh,Fh,qh,Kh,jh,zl,Zh,Qh,Yh,Xh,Jh,Dl,Bl,Ml=U(()=>{Y$2(),ne(),Se(),ie(),Uh=(d,m)=>{if(d.every(g=>g>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),d.length>0){if(m.mode==="linear"){if(!(d.length===2||d.length===3||d.length===4&&d[0]===1&&d[1]===1||d.length===4&&d[0]===1&&d[3]===1||d.length===5&&d[0]===1&&d[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(m.mode==="cubic"&&!(d.length===2||d.length===4&&d[0]===1&&d[1]===1||d.length===4&&d[0]===1&&d[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},Nh=(d,m,g)=>{m.every($=>$>=0&&$<g||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let w=new Array(g).fill(1);return m.forEach(($,I)=>w[$]=d[I]),w},Vh=(d,m,g,w,$,I)=>{let[D,q,j]=g>10?[1,2,3]:[-1,d.length>1?1:-1,-1],G=d[0].dims.length;if(D>0&&d.length>D&&d[D].dims.length>0)d[D].getFloat32Array().forEach(H=>I.push(H));else if(m.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(q>0&&d.length>q&&d[q].dims.length===1&&d[q].dims[0]>0){if(d[q].getFloat32Array().forEach(H=>w.push(H)),w.length!==0&&w.length!==G&&g>=18&&w.length!==m.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");Uh(w,m),m.axes.length>0&&Nh(w,m.axes,G).forEach((H,W)=>w[W]=H)}if(j>0&&d.length>j&&d[j].dims.length===1&&d[j].dims[0]>0&&(d[j].getBigInt64Array().forEach(H=>$.push(Number(H))),$.length!==0&&$.length!==G&&g>=18&&$.length!==m.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(m.axes.length>0){if(w.length!==0&&w.length!==m.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if($.length!==0&&$.length!==m.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof w<"u"&&typeof $<"u"&&w.length>0&&$.length>G)throw new Error("Resize requires only of scales or sizes to be specified")},Ol=(d,m,g,w)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${d}) * (${m});
  let whole = ${w}(big / (${g}));
  let fract = ${w}(big % (${g})) / ${w}(${g});
  return whole + fract;
`,Wh=(d,m)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${m} { `+(()=>{switch(d){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${m}(xResized) / ${m}(xScale);
          } else {
            ${Ol("xResized","lengthOriginal","lengthResized",m)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${m}(xResized) + 0.5) / ${m}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${m}(xResized) + 0.5) / ${m}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${Ol("xResized","lengthOriginal - 1","lengthResized - 1",m)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${m}(roiStart) * ${m}(lengthOriginal - 1) +
                        (${m}(xResized) * ${m}(roiEnd - roiStart) * ${m}(lengthOriginal - 1)) /
                        ${m}(lengthResized - 1);
                  } else {
                    return 0.5 * ${m}(roiStart + roiEnd) * ${m}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${m}xScale * ${m}(lengthResized);
                  const adjustment = ${m}(lengthResized) / outputWidth;
                  const center = ${m}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${m}(xResized) + 0.5) / ${m}(xScale)) - 0.5;`;case"half_pixel":return`return ((${m}(xResized) + 0.5) / ${m}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${d} is not supported`)}})()+"}",Lh=(d,m,g)=>`fn getNearestPixelFromOriginal(xOriginal: ${g}, isDownSample: bool) -> ${g} {`+(()=>{switch(d){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(m<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${d} is not supported`)}})()+"}",Gh=(d,m,g)=>{let w=new Array(g).fill(0).concat(new Array(g).fill(1)),$=d.length===0?w:d.slice();return m.length>0?(m.forEach((I,D)=>{w[I]=$[D],w[D+g]=$[m.length+D]}),w):$},Hh=(d,m,g,w)=>{let $=[];if(g.length>0)if(w.length>0){if(d.forEach(I=>$.push(I)),Math.max(...w)>d.length)throw new Error("axes is out of bound");w.forEach((I,D)=>$[I]=g[D])}else g.forEach(I=>$.push(I));else{if(m.length===0)throw new Error("Resize requires either scales or sizes.");$=d.map((I,D)=>Math.round(I*m[D]))}return $},Fh=(d,m,g)=>{let w=(()=>{switch(g.keepAspectRatioPolicy){case"not_larger":return g.axes.length>0?Math.min(...g.axes.map(I=>m[I]),Number.MAX_VALUE):Math.min(...m,Number.MAX_VALUE);case"not_smaller":return g.axes.length>0?Math.max(...g.axes.map(I=>m[I]),Number.MIN_VALUE):Math.max(...m,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${g.keepAspectRatioPolicy} is not supported`)}})();m.fill(1,0,m.length);let $=d.slice();return g.axes.length>0?(g.axes.forEach(I=>m[I]=w),g.axes.forEach(I=>$[I]=Math.round(d[I]*m[I]))):(m.fill(w,0,m.length),$.forEach((I,D)=>$[D]=Math.round(I*m[D]))),$},qh=(d,m,g,w,$)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${d.type.indices}) -> array<${d.type.value}, ${g.length}> {
      var original_indices: array<${d.type.value}, ${g.length}>;
      for (var i:u32 = 0; i < ${g.length}; i++) {
        var output_index = ${d.indicesGet("output_indices","i")};
        var scale = ${F("uniforms.scales","i",w)};
        var roi_low = ${F("uniforms.roi","i",$)};
        var roi_hi = ${F("uniforms.roi",`i + ${m.length}`,$)};
        if (scale == 1.0) {
          original_indices[i] = ${d.type.value}(output_index);
        } else {
          var input_shape_i = ${F("uniforms.input_shape","i",m.length)};
          var output_shape_i = ${F("uniforms.output_shape","i",g.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,Kh=(d,m,g,w,$,I,D)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${m.type.indices}) -> ${d.type.indices} {
      var input_indices: ${d.type.indices};
      for (var i:u32 = 0; i < ${w.length}; i++) {
        var output_index = ${m.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${F("uniforms.scales","i",$)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${F("uniforms.roi","i",I)};
          var roi_hi = ${F("uniforms.roi",`i + ${g.length}`,I)};
          var input_shape_i = ${F("uniforms.input_shape","i",g.length)};
          var output_shape_i = ${F("uniforms.output_shape","i",w.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${D} || (original_idx >= 0 && original_idx < ${m.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${m.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${d.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,jh=(d,m)=>`
    fn checkInputIndices(input_indices: ${d.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${m.length}; i++) {
        var input_index = ${d.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${F("uniforms.input_shape","i",m.length)}) {
          return false;
        }
      }
      return true;
    }`,zl=(d,m,g,w)=>d.rank>w?`
    ${d.indicesSet("input_indices",m,"channel")};
    ${d.indicesSet("input_indices",g,"batch")};
`:"",Zh=(d,m,g,w,$)=>{let[I,D,q,j]=g.length===2?[-1,0,1,-1]:[0,2,3,1],G=d.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${G} {
      var input_indices: ${d.type.indices};
      ${d.indicesSet("input_indices",D,`max(0, min(row, ${g[D]} - 1))`)};
      ${d.indicesSet("input_indices",q,`max(0, min(col, ${g[q]} - 1))`)};
      ${zl(d,j,I,2)}
      return ${d.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${m.type.indices}) -> ${G} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${G} = originalIndices[${D}];
      var col:${G} = originalIndices[${q}];
      ${w?`if (row < 0 || row > (${g[D]} - 1) || col < 0 || col > (${g[q]} - 1)) {
        return ${$};
      }`:""};
      row = max(0, min(row, ${g[D]} - 1));
      col = max(0, min(col, ${g[q]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${g.length>2?`u32(originalIndices[${j}])`:"0"};
      var batch: u32 =  ${g.length>2?`u32(originalIndices[${I}])`:"0"};
      var x11: ${G} = getInputValue(batch, channel, row1, col1);
      var x12: ${G} = getInputValue(batch, channel, row1, col2);
      var x21: ${G} = getInputValue(batch, channel, row2, col1);
      var x22: ${G} = getInputValue(batch, channel, row2, col2);
      var dx1: ${G} = abs(row - ${G}(row1));
      var dx2: ${G} = abs(${G}(row2) - row);
      var dy1: ${G} = abs(col - ${G}(col1));
      var dy2: ${G} = abs(${G}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},Qh=(d,m,g,w,$,I,D,q,j,G)=>{let H=g.length===2,[W,V]=H?[0,1]:[2,3],K=d.type.value,Z=Q=>{let J=Q===W?"row":"col";return`
      fn ${J}CubicInterpolation(input_indices: ${d.type.indices}, output_indices: ${m.type.indices}) -> ${K} {
        var output_index = ${m.indicesGet("output_indices",Q)};
        var originalIdx: ${K} = getOriginalCoordinateFromResizedCoordinate(output_index, ${$[Q]},
        ${w[Q]}, ${g[Q]}, ${I[Q]}, ${I[Q]} + ${g.length});
        var fractOriginalIdx: ${K} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${q} && (originalIdx < 0 || originalIdx > (${g[Q]} - 1))) {
          return ${j};
        }
        var data: array<${K}, 4> = array<${K}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${J}: ${K} = originalIdx + ${K}(i);
          if (${J} < 0 || ${J} >= ${g[Q]}) {
            ${G?`coefs[i + 1] = 0.0;
                        continue;`:q?`return ${j};`:`${J} = max(0, min(${J}, ${g[Q]} - 1));`};
          }
        var input_indices_copy: ${d.type.indices} = input_indices;
          ${d.indicesSet("input_indices_copy",Q,`u32(${J})`)};
          data[i + 1] = ${Q===W?d.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${Z(W)};
    ${Z(V)};
  fn getCubicInterpolationCoefs(s: ${K}) -> array<${K}, 4> {
    var absS = abs(s);
    var coeffs: array<${K}, 4> = array<${K}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${K} = 1.0 - absS;
    var twoMinusAbsS: ${K} = 2.0 - absS;
    var onePlusAbsS: ${K} = 1.0 + absS;
    coeffs[0] = ((${D} * onePlusAbsS - 5 * ${D}) * onePlusAbsS + 8 * ${D}) * onePlusAbsS - 4 * ${D};
    coeffs[1] = ((${D} + 2) * absS - (${D} + 3)) * absS * absS + 1;
    coeffs[2] = ((${D} + 2) * oneMinusAbsS - (${D} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${D} * twoMinusAbsS - 5 * ${D}) * twoMinusAbsS + 8 * ${D}) * twoMinusAbsS - 4 * ${D};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${K}, 4>, coefs: array<${K}, 4>) -> ${K} {
    var coefsSum: ${K} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${m.type.indices}) -> ${K} {
    var input_indices: ${d.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},Yh=(d,m,g,w,$)=>{let[I,D,q,j,G]=g.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],H=d.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${H} {
      var input_indices: ${d.type.indices};
      ${d.indicesSet("input_indices",D,`max(0, min(depth, ${g[D]} - 1))`)};
      ${d.indicesSet("input_indices",q,`max(0, min(height, ${g[q]} - 1))`)};
      ${d.indicesSet("input_indices",j,`max(0, min(width, ${g[j]} - 1))`)};
      ${zl(d,G,I,3)}
      return ${d.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${m.type.indices}) -> ${H} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${H} = originalIndices[${D}];
      var height:${H} = originalIndices[${q}];
      var width:${H} = originalIndices[${j}];
      ${w?`if (depth < 0 || depth > (${g[D]} - 1) || height < 0 || height > (${g[q]} - 1) || width < 0 || (width > ${g[j]} - 1)) {
      return ${$};
        }`:""};

    depth = max(0, min(depth, ${g[D]} - 1));
      height = max(0, min(height, ${g[q]} - 1));
      width = max(0, min(width, ${g[j]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${g.length>3?`u32(originalIndices[${G}])`:"0"};
      var batch: u32 =  ${g.length>3?`u32(originalIndices[${I}])`:"0"};

      var x111: ${H} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${H} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${H} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${H} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${H} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${H} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${H} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${H} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${H} = abs(depth - ${H}(depth1));
      var dx2: ${H} = abs(${H}(depth2) - depth);
      var dy1: ${H} = abs(height - ${H}(height1));
      var dy2: ${H} = abs(${H}(height2) - height);
      var dz1: ${H} = abs(width - ${H}(width1));
      var dz2: ${H} = abs(${H}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},Xh=(d,m,g,w,$,I)=>{let D=d.dims,q=Gh(I,m.axes,D.length),j=Hh(D,w,$,m.axes),G=w.slice();w.length===0&&(G=D.map((se,oe)=>se===0?1:j[oe]/se),m.keepAspectRatioPolicy!=="stretch"&&(j=Fh(D,G,m)));let H=M$1("output",d.dataType,j.length),W=P("input",d.dataType,D.length),V=E$1.size(j),K=D.length===j.length&&D.every((se,oe)=>se===j[oe]),Z=m.coordinateTransformMode==="tf_crop_and_resize",Q=m.extrapolationValue,J=W.type.value,re=se=>`
      ${K?"":`
      ${Wh(m.coordinateTransformMode,J)};
      ${(()=>{switch(m.mode){case"nearest":return`
              ${jh(W,D)};
              ${Lh(m.nearestMode,g,J)};
              ${Kh(W,H,D,j,G.length,q.length,Z)};
              `;case"linear":return`
              ${qh(H,D,j,G.length,q.length)};
              ${(()=>{if(D.length===2||D.length===4)return`${Zh(W,H,D,Z,Q)}`;if(D.length===3||D.length===5)return`${Yh(W,H,D,Z,Q)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(D.length===2||D.length===4)return`${Qh(W,H,D,j,G,q,m.cubicCoeffA,Z,m.extrapolationValue,m.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${se.registerUniform("output_size","u32").registerUniform("scales","f32",G.length).registerUniform("roi","f32",q.length).declareVariables(W,H)}
      ${se.mainStart()}
        ${se.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${K?"output[global_idx] = input[global_idx];":`
        let output_indices = ${H.offsetToIndices("global_idx")};
        var input_indices: ${W.type.indices};
        ${(()=>{switch(m.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${W.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${m.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${D.length===2||D.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${m.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${m.cacheKey}|${g}|${G.length>0?m.mode==="cubic"?G:G.length:""}|${$.length>0?$:""}|${q.length>0?q:""}|${K}|${m.mode==="nearest"?D.length:D}`,inputDependencies:["rank"]},getShaderSource:re,getRunData:()=>({outputs:[{dims:j,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(V/64)},programUniforms:[{type:12,data:V},{type:1,data:G},{type:1,data:q},...N$1(D,j)]})}},Jh=d=>{let m=d.customDataBuffer;return new Uint32Array(m,m.byteOffset,1)[0]},Dl=(d,m)=>{let g=[],w=[],$=[],I=Jh(d);if(m.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");Vh(d.inputs,m,I,g,w,$),d.compute(Xh(d.inputs[0],m,I,g,w,$),{inputs:[0]})},Bl=d=>{let m=d.antialias,g=d.axes,w=d.coordinateTransformMode,$=d.cubicCoeffA,I=d.excludeOutside!==0,D=d.extrapolationValue,q=d.keepAspectRatioPolicy,j=d.mode,G=d.nearestMode===""?"simple":d.nearestMode;return X({antialias:m,axes:g,coordinateTransformMode:w,cubicCoeffA:$,excludeOutside:I,extrapolationValue:D,keepAspectRatioPolicy:q,mode:j,nearestMode:G})}}),eg,tg,Rl,Ul=U(()=>{Y$2(),ne(),ie(),eg=d=>{if(!d||d.length<3)throw new Error("layerNorm requires at least 3 inputs.");let m=d[0],g=d[1],w=d[2];if(m.dataType!==g.dataType||m.dataType!==w.dataType)throw new Error("All inputs must have the same data type");if(m.dims.length!==3&&m.dims.length!==2)throw new Error("Input must be 2D or 3D");if(g.dims.length!==3&&g.dims.length!==2)throw new Error("Skip must be 2D or 3D");let $=m.dims[m.dims.length-1],I=m.dims[m.dims.length-2];if(g.dims[g.dims.length-1]!==$)throw new Error("Skip must have the same hidden size as input");if(g.dims[g.dims.length-2]!==I)throw new Error("Skip must have the same sequence length as input");if(w.dims.length!==1)throw new Error("Gamma must be 1D");if(w.dims[w.dims.length-1]!==$)throw new Error("Gamma must have the same hidden size as input");if(d.length>3){let D=d[3];if(D.dims.length!==1)throw new Error("Beta must be 1D");if(D.dims[D.dims.length-1]!==$)throw new Error("Beta must have the same hidden size as input")}if(d.length>4){let D=d[4];if(D.dims.length!==1)throw new Error("Bias must be 1D");if(D.dims[D.dims.length-1]!==$)throw new Error("Bias must have the same hidden size as input")}},tg=(d,m,g,w)=>{let $=m.simplified,I=d[0].dims,D=E$1.size(I),q=I,j=D,G=I.slice(-1)[0],H=w?I.slice(0,-1).concat(1):[],W=!$&&d.length>3,V=d.length>4,K=w&&g>1,Z=w&&g>2,Q=g>3,J=64,re=me(G),se=[{type:12,data:j},{type:12,data:re},{type:12,data:G},{type:1,data:m.epsilon}],oe=ae=>{let ce=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],le=[P("x",d[0].dataType,d[0].dims,re),P("skip",d[1].dataType,d[1].dims,re),P("gamma",d[2].dataType,d[2].dims,re)];W&&le.push(P("beta",d[3].dataType,d[3].dims,re)),V&&le.push(P("bias",d[4].dataType,d[4].dims,re)),le.push(M$1("output",d[0].dataType,q,re)),K&&le.push(M$1("mean_output",1,H)),Z&&le.push(M$1("inv_std_output",1,H)),Q&&le.push(M$1("input_skip_bias_sum",d[0].dataType,q,re));let de=ye(d[0].dataType),_e=ye(1,re);return`

      ${ae.registerUniforms(ce).declareVariables(...le)}
      var<workgroup> sum_shared : array<${_e}, ${J}>;
      var<workgroup> sum_squared_shared : array<${_e}, ${J}>;

      ${ae.mainStart([J,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${J};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${J};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${J-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${V?"bias[offset1d + i]":de+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${Q?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${Et(de,re,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${J};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${Fe("sum",re)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${Fe("square_sum",re)} / f32(uniforms.hidden_size) ${$?"":"- mean * mean"} + uniforms.epsilon);
        ${K?"mean_output[global_idx] = mean;":""}
        ${Z?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${$?"":`- ${de}(mean)`}) *
            ${de}(inv_std_dev) * gamma[offset1d + i]
            ${W?"+ beta[offset1d + i]":""};
        }
      }`},ee=[{dims:q,dataType:d[0].dataType}];return g>1&&ee.push({dims:H,dataType:1}),g>2&&ee.push({dims:H,dataType:1}),g>3&&ee.push({dims:I,dataType:d[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${re};${K};${Z};${Q}`,inputDependencies:d.map((ae,ce)=>"type")},getShaderSource:oe,getRunData:()=>({outputs:ee,dispatchGroup:{x:Math.ceil(j/G)},programUniforms:se})}},Rl=(d,m)=>{eg(d.inputs);let g=[0];d.outputCount>1&&g.push(-3),d.outputCount>2&&g.push(-3),d.outputCount>3&&g.push(3),d.compute(tg(d.inputs,m,d.outputCount,!1),{outputs:g})}}),rg,on,ng,Nl,og,ig,Vl,Wl,Ll=U(()=>{Y$2(),ne(),Se(),ie(),rg=(d,m)=>{if(!d||d.length<1)throw new Error("too few inputs");if(m.axes.length!==0){if(m.axes.length!==m.starts.length||m.axes.length!==m.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(m.starts.length!==m.ends.length)throw new Error("starts and ends must have the same length");d.slice(1).forEach((g,w)=>{if(d[w+1].dataType!==6&&d[w+1].dataType!==7)throw new Error(`Input ${w} must be an array of int32 or int64`)})},on=(d,m)=>{let g=[];if(d.length>m)if(d[m].dataType===7)d[m].getBigInt64Array().forEach(w=>g.push(Number(w)));else if(d[m].dataType===6)d[m].getInt32Array().forEach(w=>g.push(Number(w)));else throw new Error(`Input ${m} must be an array of int32 or int64`);return g},ng=(d,m)=>{if(d.length>1){let g=on(d,1),w=on(d,2),$=on(d,3);return $.length===0&&($=[...Array(d[0].dims.length).keys()]),X({starts:g,ends:w,axes:$})}else return m},Nl=(d,m,g,w,$)=>{let I=d;return d<0&&(I+=g[w[m]]),$[m]<0?Math.max(0,Math.min(I,g[w[m]]-1)):Math.max(0,Math.min(I,g[w[m]]))},og=(d,m,g)=>`fn calculateInputIndices(output_indices: ${m.type.indices}) -> ${d.type.indices} {
          var input_indices: ${d.type.indices};
          var carry = 0u;
          for (var i = ${g.length}; i >= 0; i--) {
            let input_shape_i = ${F("uniforms.input_shape","i",g.length)};
            let steps_i = ${F("uniforms.steps","i",g.length)};
            let signs_i = ${F("uniforms.signs","i",g.length)};
            let starts_i = ${F("uniforms.starts","i",g.length)};
            var output_index = ${m.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${d.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,ig=(d,m)=>{let g=d[0].dims,w=E$1.size(g),$=m.axes.length>0?E$1.normalizeAxes(m.axes,g.length):[...Array(g.length).keys()],I=on(d,4);I.forEach(re=>re!==0||(()=>{throw new Error("step cannot be 0")})),I.length===0&&(I=Array($.length).fill(1));let D=m.starts.map((re,se)=>Nl(re,se,g,$,I)),q=m.ends.map((re,se)=>Nl(re,se,g,$,I));if($.length!==D.length||$.length!==q.length)throw new Error("start, ends and axes should have the same number of elements");if($.length!==g.length)for(let re=0;re<g.length;++re)$.includes(re)||(D.splice(re,0,0),q.splice(re,0,g[re]),I.splice(re,0,1));let j=I.map(re=>Math.sign(re));I.forEach((re,se,oe)=>{if(re<0){let ee=(q[se]-D[se])/re,ae=D[se],ce=ae+ee*I[se];D[se]=ce,q[se]=ae,oe[se]=-re}});let G=g.slice(0);$.forEach((re,se)=>{G[re]=Math.ceil((q[re]-D[re])/I[re])});let H={dims:G,dataType:d[0].dataType},W=M$1("output",d[0].dataType,G.length),V=P("input",d[0].dataType,d[0].dims.length),K=E$1.size(G),Z=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:D.length},{name:"signs",type:"i32",length:j.length},{name:"steps",type:"u32",length:I.length}],Q=[{type:12,data:K},{type:12,data:D},{type:6,data:j},{type:12,data:I},...N$1(d[0].dims,G)],J=re=>`
      ${re.registerUniforms(Z).declareVariables(V,W)}
        ${og(V,W,g)}
        ${re.mainStart()}
          ${re.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${W.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${W.setByOffset("global_idx",V.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${j.length}_${D.length}_${I.length}`,inputDependencies:["rank"]},getShaderSource:J,getRunData:()=>({outputs:[H],dispatchGroup:{x:Math.ceil(w/64)},programUniforms:Q})}},Vl=(d,m)=>{rg(d.inputs,m);let g=ng(d.inputs,m);d.compute(ig(d.inputs,g),{inputs:[0]})},Wl=d=>{let m=d.starts,g=d.ends,w=d.axes;return X({starts:m,ends:g,axes:w})}}),ag,sg,Gl,Hl,Fl=U(()=>{Y$2(),ne(),Se(),ut(),ie(),ag=d=>{if(!d||d.length!==1)throw new Error("Softmax op requires 1 input.")},sg=(d,m)=>{let g=d.inputs[0],w=g.dims,$=E$1.size(w),I=w.length,D=E$1.normalizeAxis(m.axis,I),q=D<w.length-1,j,G=[];q?(G=Array.from({length:I},(le,de)=>de),G[D]=I-1,G[I-1]=D,j=d.compute(ke(g,G),{inputs:[g],outputs:[-1]})[0]):j=g;let H=j.dims,W=H[I-1],V=$/W,K=me(W),Z=W/K,Q=64;V===1&&(Q=256);let J=(le,de)=>de===4?`max(max(${le}.x, ${le}.y), max(${le}.z, ${le}.w))`:de===2?`max(${le}.x, ${le}.y)`:de===3?`max(max(${le}.x, ${le}.y), ${le}.z)`:le,re=P("x",j.dataType,j.dims,K),se=M$1("result",j.dataType,j.dims,K),oe=re.type.value,ee=ye(j.dataType)==="f32"?`var threadMax = ${oe}(-3.402823e+38f);`:`var threadMax = ${oe}(-65504.0h);`,ae=le=>`
      var<workgroup> rowMaxShared : ${oe};
      var<workgroup> rowSumShared : ${oe};
      var<workgroup> threadShared : array<${oe}, ${Q}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${oe} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${oe}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${le.registerUniform("packedCols","i32").declareVariables(re,se)}
      ${le.mainStart(Q)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${Q};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${ee}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${oe}(${J("threadShared[0]",K)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${oe}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${oe}(${Fe("threadShared[0]",K)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,ce=d.compute({name:"Softmax",shaderCache:{hint:`${K};${Q}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:H,dataType:j.dataType}],dispatchGroup:{x:V},programUniforms:[{type:6,data:Z}]}),getShaderSource:ae},{inputs:[j],outputs:[q?-1:0]})[0];q&&d.compute(ke(ce,G),{inputs:[ce]})},Gl=(d,m)=>{ag(d.inputs),sg(d,m)},Hl=d=>X({axis:d.axis})}),ql,ug,dg,lg,Kl,jl=U(()=>{Y$2(),ne(),ie(),ql=d=>Array.from(d.getBigInt64Array(),Number),ug=d=>{if(!d||d.length!==2)throw new Error("Tile requires 2 inputs.");if(d[0].dataType!==1&&d[0].dataType!==10&&d[0].dataType!==6&&d[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(d[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(d[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(ql(d[1]).length!==d[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},dg=(d,m)=>{let g=[];for(let w=0;w<d.length;++w)g.push(d[w]*m[w]);return g},lg=(d,m)=>{let g=d[0].dims,w=m??ql(d[1]),$=dg(g,w),I=E$1.size($),D=d[0].dataType,q=P("input",D,g.length),j=M$1("output",D,$.length),G=H=>`
      const inputShape = ${q.indices(...g)};
      ${H.registerUniform("output_size","u32").declareVariables(q,j)}
      ${H.mainStart()}
      ${H.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${j.offsetToIndices("global_idx")};
      var input_indices: ${q.type.indices};
      for (var i = 0; i < ${g.length}; i++) {
        let input_dim_i = ${q.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${j.indicesGet("output_indices","i")}  % input_dim_i;

        ${q.indicesSet("input_indices","i","input_dim_value")}
      }
      ${j.setByOffset("global_idx",q.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${w}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:$,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:[{type:12,data:I},...N$1(d[0].dims,$)]}),getShaderSource:G}},Kl=d=>{ug(d.inputs),d.compute(lg(d.inputs),{inputs:[0]})}}),cg,pg,Zl,Ql=U(()=>{Y$2(),ne(),ie(),cg=(d,m,g,w,$)=>{let I=M$1("output_data",$,g.length,4),D=P("a_data",m[1].dataType,m[1].dims.length,4),q=P("b_data",m[2].dataType,m[2].dims.length,4),j=P("c_data",m[0].dataType,m[0].dims.length,4),G,H=(W,V,K)=>`select(${V}, ${W}, ${K})`;if(!w)G=I.setByOffset("global_idx",H(D.getByOffset("global_idx"),q.getByOffset("global_idx"),j.getByOffset("global_idx")));else{let W=(V,K,Z="")=>{let Q=`a_data[index_a${K}][component_a${K}]`,J=`b_data[index_b${K}][component_b${K}]`,re=`bool(c_data[index_c${K}] & (0xffu << (component_c${K} * 8)))`;return`
            let output_indices${K} = ${I.offsetToIndices(`global_idx * 4u + ${K}u`)};
            let offset_a${K} = ${D.broadcastedIndicesToOffset(`output_indices${K}`,I)};
            let offset_b${K} = ${q.broadcastedIndicesToOffset(`output_indices${K}`,I)};
            let offset_c${K} = ${j.broadcastedIndicesToOffset(`output_indices${K}`,I)};
            let index_a${K} = offset_a${K} / 4u;
            let index_b${K} = offset_b${K} / 4u;
            let index_c${K} = offset_c${K} / 4u;
            let component_a${K} = offset_a${K} % 4u;
            let component_b${K} = offset_b${K} % 4u;
            let component_c${K} = offset_c${K} % 4u;
            ${V}[${K}] = ${Z}(${H(Q,J,re)});
          `};$===9?G=`
            var data = vec4<u32>(0);
            ${W("data",0,"u32")}
            ${W("data",1,"u32")}
            ${W("data",2,"u32")}
            ${W("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:G=`
            ${W("output_data[global_idx]",0)}
            ${W("output_data[global_idx]",1)}
            ${W("output_data[global_idx]",2)}
            ${W("output_data[global_idx]",3)}
          `}return`
        ${d.registerUniform("vec_size","u32").declareVariables(j,D,q,I)}
        ${d.mainStart()}
        ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${G}
      }`},pg=d=>{let m=d[1].dims,g=d[2].dims,w=d[0].dims,$=d[1].dataType,I=!(E$1.areEqual(m,g)&&E$1.areEqual(g,w)),D=m,q=E$1.size(m);if(I){let G=et.calcShape(et.calcShape(m,g,!1),w,!1);if(!G)throw new Error("Can't perform where op on the given tensors");D=G,q=E$1.size(D)}let j=Math.ceil(q/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:G=>cg(G,d,D,I,$),getRunData:()=>({outputs:[{dims:D,dataType:$}],dispatchGroup:{x:Math.ceil(q/64/4)},programUniforms:[{type:12,data:j},...N$1(w,m,g,D)]})}},Zl=d=>{d.compute(pg(d.inputs))}}),Yl,Xl=U(()=>{Es(),qr(),zs(),Bs(),wu(),Pu(),Du(),Qu(),nd(),ad(),dd(),fd(),bd(),_d(),$d(),Td(),Ad(),Pd(),Dd(),Rd(),qd(),Zd(),Yd(),Jd(),rl(),$o(),ol(),vl(),Sl(),Il(),Pl(),Hr(),Ml(),To(),Ul(),Ll(),Fl(),So(),jl(),ut(),jr(),Ql(),Yl=new Map([["Abs",[Ms]],["Acos",[Rs]],["Acosh",[Us]],["Add",[vu]],["ArgMax",[ks,uo]],["ArgMin",[As,uo]],["Asin",[Ns]],["Asinh",[Vs]],["Atan",[Ws]],["Atanh",[Ls]],["Attention",[Ps]],["AveragePool",[pl,cl]],["BatchNormalization",[Os]],["BiasAdd",[Ds]],["BiasSplitGelu",[_u]],["Cast",[Hs,Gs]],["Ceil",[qs]],["Clip",[Fs]],["Concat",[Ou,zu]],["Conv",[yo,bo]],["ConvTranspose",[rd,ed]],["Cos",[Ks]],["Cosh",[js]],["CumSum",[od,id]],["DepthToSpace",[sd,ud]],["DequantizeLinear",[$l,xl]],["Div",[$u]],["Einsum",[pd,md]],["Elu",[Zs,Xt]],["Equal",[xu]],["Erf",[Qs]],["Exp",[Ys]],["Expand",[gd]],["FastGelu",[yd]],["Floor",[Xs]],["FusedConv",[yo,bo]],["Gather",[vd,wd]],["GatherElements",[Ed,kd]],["GatherBlockQuantized",[Id,Cd]],["GatherND",[xd,Sd]],["Gelu",[Js]],["Gemm",[zd,Od]],["GlobalAveragePool",[hl,fl]],["GlobalMaxPool",[wl,_l]],["Greater",[Cu]],["GreaterOrEqual",[ku]],["GridSample",[Bd,Md]],["GroupQueryAttention",[Fd]],["HardSigmoid",[su,au]],["InstanceNormalization",[jd]],["LayerNormalization",[Qd]],["LeakyRelu",[eu,Xt]],["Less",[Au]],["LessOrEqual",[Eu]],["Log",[gu]],["MatMul",[Xd]],["MatMulNBits",[el,tl]],["MaxPool",[bl,yl]],["Mul",[Su]],["MultiHeadAttention",[Vd,Nd]],["Neg",[ru]],["Not",[tu]],["Pad",[nl]],["Pow",[Tu]],["QuickGelu",[bu,Xt]],["Range",[Tl]],["Reciprocal",[nu]],["ReduceMin",[$s]],["ReduceMean",[bs]],["ReduceMax",[vs]],["ReduceSum",[Ss]],["ReduceProd",[xs]],["ReduceL1",[ys]],["ReduceL2",[_s]],["ReduceLogSum",[Is]],["ReduceLogSumExp",[ws]],["ReduceSumSquare",[Ts]],["Relu",[ou]],["Resize",[Dl,Bl]],["RotaryEmbedding",[Gd]],["ScatterND",[El,kl]],["Sigmoid",[iu]],["Sin",[uu]],["Sinh",[du]],["Slice",[Vl,Wl]],["SkipLayerNormalization",[Rl]],["Split",[Wd,Ld]],["Sqrt",[lu]],["Softmax",[Gl,Hl]],["Sub",[Iu]],["Tan",[cu]],["Tanh",[mu]],["ThresholdedRelu",[hu,Xt]],["Tile",[Kl]],["Transpose",[os,is]],["Where",[Zl]]])}),an,Jl=U(()=>{We(),Je(),ie(),an=class{constructor(d){this.backend=d,this.repo=new Map,this.attributesBound=!1}getArtifact(d){return this.repo.get(d)}setArtifact(d,m){this.repo.set(d,m)}run(d,m,g,w,$){Re(d.programInfo.name);let I=this.backend.device,D=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let q=[];for(let G of m)q.push({binding:q.length,resource:{buffer:G.buffer}});for(let G of g)q.push({binding:q.length,resource:{buffer:G.buffer}});$&&q.push({binding:q.length,resource:$});let j=I.createBindGroup({layout:d.computePipeline.getBindGroupLayout(0),entries:q,label:d.programInfo.name});if(this.backend.sessionStatus==="capturing"){let G={kernelId:this.backend.currentKernelId,computePipeline:d.computePipeline,bindGroup:j,dispatchGroup:w};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(G)}D.setPipeline(d.computePipeline),D.setBindGroup(0,j),D.dispatchWorkgroups(...w),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),De(d.programInfo.name)}dispose(){}build(d,m){Re(d.name);let g=this.backend.device,w=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(G=>{g.features.has(G.feature)&&w.push(`enable ${G.extension};`)});let $=rs(m,this.backend.device.limits),I=d.getShaderSource($),D=`${w.join(`
`)}
${$.additionalImplementations}
${I}`,q=g.createShaderModule({code:D,label:d.name});ue("verbose",()=>`[WebGPU] ${d.name} shader code: ${D}`);let j=g.createComputePipeline({compute:{module:q,entryPoint:"main"},layout:"auto",label:d.name});return De(d.name),{programInfo:d,computePipeline:j,uniformVariablesInfo:$.variablesInfo}}normalizeDispatchGroupSize(d){let m=typeof d=="number"?d:d.x,g=typeof d=="number"?1:d.y||1,w=typeof d=="number"?1:d.z||1,$=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(m<=$&&g<=$&&w<=$)return[m,g,w];let I=m*g*w,D=Math.ceil(Math.sqrt(I));if(D>$){if(D=Math.ceil(Math.cbrt(I)),D>$)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[D,D,D]}else return[D,D,1]}}}),ec={};Rt(ec,{WebGpuBackend:()=>Co});var mg,fg,Io,Co,tc=U(()=>{We(),Y$2(),Je(),Qn(),es(),Xl(),Jl(),mg=(d,m)=>{if(m.length!==d.length)throw new Error(`inputDependencies length ${m.length} is not equal to inputTensors length ${d.length}.`);let g=[];for(let w=0;w<d.length;++w){let $=d[w].dataType;switch(m[w]){case"none":{g.push("");break}case"type":{g.push(`${$}`);break}case"rank":{let I=d[w].dims.length;g.push(`${$};${I}`);break}case"dims":{let I=d[w].dims.join(",");g.push(`${$};${I}`);break}default:throw new Error(`unsupported input dependency: ${m[w]}`)}}return g.join("|")},fg=(d,m,g)=>{let w=d.name;return d.shaderCache?.hint&&(w+="["+d.shaderCache.hint+"]"),w+=":"+g+`:${mg(m,d.shaderCache?.inputDependencies??new Array(m.length).fill("dims"))}`,w},Io=class{constructor(d){d&&(this.architecture=d.architecture,this.vendor=d.vendor)}isArchitecture(d){return this.architecture===d}isVendor(d){return this.vendor===d}},Co=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let d=this.kernelCustomData.get(this.currentKernelId);return d||(d={},this.kernelCustomData.set(this.currentKernelId,d)),d}async initialize(d,m){this.env=d;let g=[],w={requiredLimits:{maxComputeWorkgroupStorageSize:m.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:m.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:m.limits.maxStorageBufferBindingSize,maxBufferSize:m.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:m.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:m.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:m.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:m.limits.maxComputeWorkgroupSizeZ},requiredFeatures:g},$=I=>m.features.has(I)&&g.push(I)&&!0;$("chromium-experimental-timestamp-query-inside-passes")||$("timestamp-query"),$("shader-f16"),$("subgroups"),this.device=await m.requestDevice(w),this.adapterInfo=new Io(m.info||await m.requestAdapterInfo()),this.gpuDataManager=Ja(this),this.programManager=new an(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,Dr(d.logLevel,!!d.debug),this.device.onuncapturederror=I=>{I.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${I.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:m,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let d=this.getCommandEncoder(),m={};this.queryType==="at-passes"&&(m.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=d.beginComputePass(m)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Re(),this.endComputePass();let d;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),d=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(d,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,d,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&d.mapAsync(GPUMapMode.READ).then(()=>{let m=new BigUint64Array(d.getMappedRange()),g=this.pendingQueries.get(d);for(let w=0;w<m.length/2;w++){let $=g[w],I=$.kernelId,D=this.kernels.get(I),q=D.kernelType,j=D.kernelName,G=$.programName,H=$.inputTensorViews,W=$.outputTensorViews,V=m[w*2],K=m[w*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=V);let Z=Number(V-this.queryTimeBase),Q=Number(K-this.queryTimeBase);if(!Number.isSafeInteger(Z)||!Number.isSafeInteger(Q))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:H.map(J=>({dims:J.dims,dataType:Xe(J.dataType)})),outputsMetadata:W.map(J=>({dims:J.dims,dataType:Xe(J.dataType)})),kernelId:I,kernelType:q,kernelName:j,programName:G,startTime:Z,endTime:Q});else{let J="";H.forEach((se,oe)=>{J+=`input[${oe}]: [${se.dims}] | ${Xe(se.dataType)}, `});let re="";W.forEach((se,oe)=>{re+=`output[${oe}]: [${se.dims}] | ${Xe(se.dataType)}, `}),console.log(`[profiling] kernel "${I}|${q}|${j}|${G}" ${J}${re}execution time: ${Q-Z} ns`)}br("GPU",`${G}::${V}::${K}`)}d.unmap(),this.pendingQueries.delete(d)}),De()}run(d,m,g,w,$,I){Re(d.name);let D=[];for(let se=0;se<m.length;++se){let oe=m[se].data;if(oe===0)continue;let ee=this.gpuDataManager.get(oe);if(!ee)throw new Error(`no GPU data for input: ${oe}`);D.push(ee)}let{outputs:q,dispatchGroup:j,programUniforms:G}=d.getRunData(m),H=g.length===0?q.map((se,oe)=>oe):g;if(H.length!==q.length)throw new Error(`Output size ${H.length} must be equal to ${q.length}.`);let W=[],V=[];for(let se=0;se<q.length;++se){if(!Number.isInteger(H[se])||H[se]<-3||H[se]>=I)throw new Error(`Invalid output index: ${H[se]}`);if(H[se]===-3)continue;let oe=H[se]===-1,ee=H[se]===-2,ae=oe||ee?$(q[se].dataType,q[se].dims):w(H[se],q[se].dataType,q[se].dims);if(W.push(ae),ae.data===0)continue;let ce=this.gpuDataManager.get(ae.data);if(!ce)throw new Error(`no GPU data for output: ${ae.data}`);if(oe&&this.temporaryData.push(ce),ee){let le=this.kernelPersistentData.get(this.currentKernelId);le||(le=[],this.kernelPersistentData.set(this.currentKernelId,le)),le.push(ce)}V.push(ce)}if(D.length!==m.length||V.length!==W.length){if(V.length===0)return De(d.name),W;throw new Error(`Program ${d.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let K;if(G){let se=0,oe=[];G.forEach(le=>{let de=typeof le.data=="number"?[le.data]:le.data;if(de.length===0)return;let _e=le.type===10?2:4,we,pe;le.type===10?(pe=de.length>4?16:de.length>2?8:de.length*_e,we=de.length>4?16:_e*de.length):(pe=de.length<=2?de.length*_e:16,we=16),se=Math.ceil(se/pe)*pe,oe.push(se);let xe=le.type===10?8:4;se+=de.length>4?Math.ceil(de.length/xe)*we:de.length*_e});let ee=16;se=Math.ceil(se/ee)*ee;let ae=new ArrayBuffer(se);G.forEach((le,de)=>{let _e=oe[de],we=typeof le.data=="number"?[le.data]:le.data;if(le.type===6)new Int32Array(ae,_e,we.length).set(we);else if(le.type===12)new Uint32Array(ae,_e,we.length).set(we);else if(le.type===10)new Uint16Array(ae,_e,we.length).set(we);else if(le.type===1)new Float32Array(ae,_e,we.length).set(we);else throw new Error(`Unsupported uniform type: ${Xe(le.type)}`)});let ce=this.gpuDataManager.create(se,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(ce.buffer,0,ae,0,se),this.gpuDataManager.release(ce.id),K={offset:0,size:se,buffer:ce.buffer}}let Z=this.programManager.normalizeDispatchGroupSize(j),Q=Z[1]===1&&Z[2]===1,J=fg(d,m,Q),re=this.programManager.getArtifact(J);if(re||(re=this.programManager.build(d,Z),this.programManager.setArtifact(J,re),ue("info",()=>`[artifact] key: ${J}, programName: ${d.name}`)),G&&re.uniformVariablesInfo){if(G.length!==re.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${re.uniformVariablesInfo.length}, got ${G.length} in program "${re.programInfo.name}".`);for(let se=0;se<G.length;se++){let oe=G[se],ee=oe.type,ae=typeof oe.data=="number"?1:oe.data.length,[ce,le]=re.uniformVariablesInfo[se];if(ee!==ce||ae!==le)throw new Error(`Uniform variable ${se} mismatch: expect type ${ce} with size ${le}, got type ${ee} with size ${ae} in program "${re.programInfo.name}".`)}}if(ue("info",()=>`[ProgramManager] run "${d.name}" (key=${J}) with ${Z[0]}x${Z[1]}x${Z[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let se={kernelId:this.currentKernelId,programName:re.programInfo.name,inputTensorViews:m,outputTensorViews:W};this.pendingKernels.push(se),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(se)}return this.programManager.run(re,D,V,Z,K),De(d.name),W}upload(d,m){this.gpuDataManager.upload(d,m)}memcpy(d,m){this.gpuDataManager.memcpy(d,m)}async download(d,m){await this.gpuDataManager.download(d,m)}alloc(d){return this.gpuDataManager.create(d).id}free(d){return this.gpuDataManager.release(d)}createKernel(d,m,g,w){let $=Yl.get(d);if(!$)throw new Error(`kernel not implemented: ${d}`);let I={kernelType:d,kernelName:w,kernelEntry:$[0],attributes:[$[1],g]};this.kernels.set(m,I)}releaseKernel(d){let m=this.kernelPersistentData.get(d);if(m){for(let g of m)this.gpuDataManager.release(g.id);this.kernelPersistentData.delete(d)}this.kernelCustomData.delete(d),this.kernels.delete(d)}computeKernel(d,m,g){let w=this.kernels.get(d);if(!w)throw new Error(`kernel not created: ${d}`);let $=w.kernelType,I=w.kernelName,D=w.kernelEntry,q=w.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${$}] ${I}" is not allowed to be called recursively`);this.currentKernelId=d,q[0]&&(q[1]=q[0](q[1]),q[0]=void 0),ue("info",()=>`[WebGPU] Start to run kernel "[${$}] ${I}"...`);let j=this.env.debug;this.temporaryData=[];try{return j&&this.device.pushErrorScope("validation"),D(m,q[1]),0}catch(G){return g.push(Promise.resolve(`[WebGPU] Kernel "[${$}] ${I}" failed. ${G}`)),1}finally{j&&g.push(this.device.popErrorScope().then(G=>G?`GPU validation error for kernel "[${$}] ${I}": ${G.message}`:null));for(let G of this.temporaryData)this.gpuDataManager.release(G.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(d,m,g,w){let $=this.sessionExternalDataMapping.get(d);$||($=new Map,this.sessionExternalDataMapping.set(d,$));let I=$.get(m),D=this.gpuDataManager.registerExternalBuffer(g,w,I);return $.set(m,[D,g]),D}unregisterBuffers(d){let m=this.sessionExternalDataMapping.get(d);m&&(m.forEach(g=>this.gpuDataManager.unregisterExternalBuffer(g[0])),this.sessionExternalDataMapping.delete(d))}getBuffer(d){let m=this.gpuDataManager.get(d);if(!m)throw new Error(`no GPU data for buffer: ${d}`);return m.buffer}createDownloader(d,m,g){return async()=>{let w=await ro(this,d,m);return Mr(w.buffer,g)}}writeTimestamp(d){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,d)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){ue("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){ue("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){ue("info","replay"),this.sessionStatus="replaying";let d=this.capturedCommandList.get(this.currentSessionId),m=this.capturedPendingKernels.get(this.currentSessionId),g=d.length;this.pendingKernels=[];for(let w=0;w<g;w++){let $=this.getComputePassEncoder(),I=d[w];this.writeTimestamp(this.pendingDispatchNumber*2),$.setPipeline(I.computePipeline),$.setBindGroup(0,I.bindGroup),$.dispatchWorkgroups(...I.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(m[w]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(d){this.unregisterBuffers(d),this.capturedCommandList.has(d)&&this.capturedCommandList.delete(d),this.capturedPendingKernels.has(d)&&this.capturedPendingKernels.delete(d),this.gpuDataManager.onReleaseSession(d)}onRunStart(d){this.currentSessionId=d,this.setQueryType()}}}),rc={};Rt(rc,{init:()=>hg});var rr,Ao,hg,nc=U(()=>{Y$2(),Je(),ne(),Za(),rr=class ep{constructor(m,g,w,$){this.module=m,this.dataType=g,this.data=w,this.dims=$}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,m)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,m)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,m)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,m)}reshape(m){if(E$1.size(m)!==E$1.size(this.dims))throw new Error("Invalid new shape");return new ep(this.module,this.dataType,this.data,m)}},Ao=class{constructor(d,m,g){this.module=d,this.backend=m,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=m.adapterInfo;let w=d.PTR_SIZE,$=g/d.PTR_SIZE,I=w===4?"i32":"i64";this.opKernelContext=Number(d.getValue(w*$++,I));let D=Number(d.getValue(w*$++,I));this.outputCount=Number(d.getValue(w*$++,I)),this.customDataOffset=Number(d.getValue(w*$++,"*")),this.customDataSize=Number(d.getValue(w*$++,I));let q=[];for(let j=0;j<D;j++){let G=Number(d.getValue(w*$++,I)),H=Number(d.getValue(w*$++,"*")),W=Number(d.getValue(w*$++,I)),V=[];for(let K=0;K<W;K++)V.push(Number(d.getValue(w*$++,I)));q.push(new rr(d,G,H,V))}this.inputs=q}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(d,m){let g=m?.inputs?.map(D=>typeof D=="number"?this.inputs[D]:D)??this.inputs,w=m?.outputs??[],$=(D,q,j)=>new rr(this.module,q,this.output(D,j),j),I=(D,q)=>{let j=wt(D,q);if(!j)throw new Error(`Unsupported data type: ${D}`);let G=j>0?this.backend.gpuDataManager.create(j).id:0;return new rr(this.module,D,G,q)};return this.backend.run(d,g,w,$,I,this.outputCount)}output(d,m){let g=this.module.stackSave();try{let w=this.module.PTR_SIZE,$=w===4?"i32":"i64",I=this.module.stackAlloc((1+m.length)*w);this.module.setValue(I,m.length,$);for(let D=0;D<m.length;D++)this.module.setValue(I+w*(D+1),m[D],$);return this.module._JsepOutput(this.opKernelContext,d,I)}catch(w){throw new Error(`Failed to generate kernel's output[${d}] with dims [${m}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${w}`)}finally{this.module.stackRestore(g)}}},hg=async(d,m,g,w)=>{let $=m.jsepInit;if(!$)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(d==="webgpu"){let I=(tc(),qt(ec)).WebGpuBackend,D=new I;await D.initialize(g,w),$("webgpu",[D,q=>D.alloc(Number(q)),q=>D.free(q),(q,j,G,H=!1)=>{if(H)ue("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(q)}, dst=${Number(j)}, size=${Number(G)}`),D.memcpy(Number(q),Number(j));else{ue("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(q)}, gpuDataId=${Number(j)}, size=${Number(G)}`);let W=m.HEAPU8.subarray(Number(q>>>0),Number(q>>>0)+Number(G));D.upload(Number(j),W)}},async(q,j,G)=>{ue("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${q}, dataOffset=${j}, size=${G}`),await D.download(Number(q),()=>m.HEAPU8.subarray(Number(j)>>>0,Number(j+G)>>>0))},(q,j,G)=>D.createKernel(q,Number(j),G,m.UTF8ToString(m._JsepGetNodeName(Number(j)))),q=>D.releaseKernel(q),(q,j,G,H)=>{ue("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${G}, kernel=${q}, contextDataOffset=${j}`);let W=new Ao(m,D,Number(j));return D.computeKernel(Number(q),W,H)},()=>D.captureBegin(),()=>D.captureEnd(),()=>D.replay()])}else{let I=new Vr(g);$("webnn",[I,()=>I.reserveTensorId(),D=>I.releaseTensorId(D),async(D,q,j,G,H)=>I.ensureTensor(D,q,j,G,H),(D,q)=>{I.uploadTensor(D,q)},async(D,q)=>I.downloadTensor(D,q)])}}}),gg,$r,xr,Pt,bg,oc,jt,Sr,Tr,ic,Ir,Cr,Ar,Wn=U(()=>{Ma(),Ua(),Y$2(),yt(),Er(),jn(),gg=(d,m)=>{ge()._OrtInit(d,m)!==0&&fe("Can't initialize onnxruntime.")},$r=async d=>{gg(d.wasm.numThreads,Qt(d.logLevel))},xr=async(d,m)=>{ge().asyncInit?.();{let g=(nc(),qt(rc)).init;if(m==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let w=d.webgpu.adapter;if(w){if(typeof w.limits!="object"||typeof w.features!="object"||typeof w.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let $=d.webgpu.powerPreference;if($!==void 0&&$!=="low-power"&&$!=="high-performance")throw new Error(`Invalid powerPreference setting: "${$}"`);let I=d.webgpu.forceFallbackAdapter;if(I!==void 0&&typeof I!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${I}"`);if(w=await navigator.gpu.requestAdapter({powerPreference:$,forceFallbackAdapter:I}),!w)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}await g("webgpu",ge(),d,w)}if(m==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await g("webnn",ge(),d)}}},Pt=new Map,bg=d=>{let m=ge(),g=m.stackSave();try{let w=m.PTR_SIZE,$=m.stackAlloc(2*w);m._OrtGetInputOutputCount(d,$,$+w)!==0&&fe("Can't get session input/output count.");let I=w===4?"i32":"i64";return[Number(m.getValue($,I)),Number(m.getValue($+w,I))]}finally{m.stackRestore(g)}},oc=(d,m)=>{let g=ge(),w=g.stackSave(),$=0;try{let I=g.PTR_SIZE,D=g.stackAlloc(2*I);g._OrtGetInputOutputMetadata(d,m,D,D+I)!==0&&fe("Can't get session input/output metadata.");let q=Number(g.getValue(D,"*"));$=Number(g.getValue(D+I,"*"));let j=g.HEAP32[$/4];if(j===0)return[q,0];let G=g.HEAPU32[$/4+1],H=[];for(let W=0;W<G;W++){let V=Number(g.getValue($+8+W*I,"*"));H.push(V!==0?g.UTF8ToString(V):Number(g.getValue($+8+(W+G)*I,"*")))}return[q,j,H]}finally{g.stackRestore(w),$!==0&&g._OrtFree($)}},jt=d=>{let m=ge(),g=m._malloc(d.byteLength);if(g===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${d.byteLength}.`);return m.HEAPU8.set(d,g),[g,d.byteLength]},Sr=async(d,m)=>{let g,w,$=ge();Array.isArray(d)?[g,w]=d:d.buffer===$.HEAPU8.buffer?[g,w]=[d.byteOffset,d.byteLength]:[g,w]=jt(d);let I=0,D=0,q=0,j=[],G=[],H=[];try{if([D,j]=await Ra(m),m?.externalData&&$.mountExternalData){let ee=[];for(let ae of m.externalData){let ce=typeof ae=="string"?ae:ae.path;ee.push(Yt(typeof ae=="string"?ae:ae.data).then(le=>{$.mountExternalData(ce,le)}))}await Promise.all(ee)}for(let ee of m?.executionProviders??[])if((typeof ee=="string"?ee:ee.name)==="webnn"){if($.shouldTransferToMLTensor=!1,typeof ee!="string"){let ae=ee,ce=ae?.context,le=ae?.gpuDevice,de=ae?.deviceType,_e=ae?.powerPreference;ce?$.currentContext=ce:le?$.currentContext=await $.webnnCreateMLContext(le):$.currentContext=await $.webnnCreateMLContext({deviceType:de,powerPreference:_e})}else $.currentContext=await $.webnnCreateMLContext();break}I=await $._OrtCreateSession(g,w,D),$.webgpuOnCreateSession?.(I),I===0&&fe("Can't create a session."),$.jsepOnCreateSession?.(),$.currentContext&&($.webnnRegisterMLContext(I,$.currentContext),$.currentContext=void 0,$.shouldTransferToMLTensor=!0);let[W,V]=bg(I),K=!!m?.enableGraphCapture,Z=[],Q=[],J=[],re=[],se=[];for(let ee=0;ee<W;ee++){let[ae,ce,le]=oc(I,ee);ae===0&&fe("Can't get an input name."),G.push(ae);let de=$.UTF8ToString(ae);Z.push(de),J.push(ce===0?{name:de,isTensor:!1}:{name:de,isTensor:!0,type:Xe(ce),shape:le})}for(let ee=0;ee<V;ee++){let[ae,ce,le]=oc(I,ee+W);ae===0&&fe("Can't get an output name."),H.push(ae);let de=$.UTF8ToString(ae);Q.push(de),re.push(ce===0?{name:de,isTensor:!1}:{name:de,isTensor:!0,type:Xe(ce),shape:le});{if(K&&m?.preferredOutputLocation===void 0){se.push("gpu-buffer");continue}let _e=typeof m?.preferredOutputLocation=="string"?m.preferredOutputLocation:m?.preferredOutputLocation?.[de]??"cpu",we=$.webnnIsGraphOutput;if(_e==="cpu"&&we&&we(I,de)){se.push("ml-tensor-cpu-output");continue}if(_e!=="cpu"&&_e!=="cpu-pinned"&&_e!=="gpu-buffer"&&_e!=="ml-tensor")throw new Error(`Not supported preferred output location: ${_e}.`);if(K&&_e!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${_e}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);se.push(_e)}}let oe=null;return se.some(ee=>ee==="gpu-buffer"||ee==="ml-tensor"||ee==="ml-tensor-cpu-output")&&(q=$._OrtCreateBinding(I),q===0&&fe("Can't create IO binding."),oe={handle:q,outputPreferredLocations:se,outputPreferredLocationsEncoded:se.map(ee=>ee==="ml-tensor-cpu-output"?"ml-tensor":ee).map(ee=>Kn(ee))}),Pt.set(I,[I,G,H,oe,K,!1]),[I,Z,Q,J,re]}catch(W){throw G.forEach(V=>$._OrtFree(V)),H.forEach(V=>$._OrtFree(V)),q!==0&&$._OrtReleaseBinding(q)!==0&&fe("Can't release IO binding."),I!==0&&$._OrtReleaseSession(I)!==0&&fe("Can't release session."),W}finally{$._free(g),D!==0&&$._OrtReleaseSessionOptions(D)!==0&&fe("Can't release session options."),j.forEach(W=>$._free(W)),$.unmountExternalData?.()}},Tr=d=>{let m=ge(),g=Pt.get(d);if(!g)throw new Error(`cannot release session. invalid session id: ${d}`);let[w,$,I,D,q]=g;D&&(q&&m._OrtClearBoundOutputs(D.handle)!==0&&fe("Can't clear bound outputs."),m._OrtReleaseBinding(D.handle)!==0&&fe("Can't release IO binding.")),m.jsepOnReleaseSession?.(d),m.webnnOnReleaseSession?.(d),m.webgpuOnReleaseSession?.(d),$.forEach(j=>m._OrtFree(j)),I.forEach(j=>m._OrtFree(j)),m._OrtReleaseSession(w)!==0&&fe("Can't release session."),Pt.delete(d)},ic=async(d,m,g,w,$,I,D=!1)=>{if(!d){m.push(0);return}let q=ge(),j=q.PTR_SIZE,G=d[0],H=d[1],W=d[3],V=W,K,Z;if(G==="string"&&(W==="gpu-buffer"||W==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(D&&W!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${I} when enableGraphCapture is true.`);if(W==="gpu-buffer"){let re=d[2].gpuBuffer;Z=wt(_t(G),H);{let se=q.jsepRegisterBuffer;if(!se)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');K=se(w,I,re,Z)}}else if(W==="ml-tensor"){let re=d[2].mlTensor;Z=wt(_t(G),H);let se=q.webnnRegisterMLTensor;if(!se)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');K=se(w,re,_t(G),H)}else{let re=d[2];if(Array.isArray(re)){Z=j*re.length,K=q._malloc(Z),g.push(K);for(let se=0;se<re.length;se++){if(typeof re[se]!="string")throw new TypeError(`tensor data at index ${se} is not a string`);q.setValue(K+se*j,Ne(re[se],g),"*")}}else{let se=q.webnnIsGraphInput,oe=q.webnnIsGraphOutput;if(G!=="string"&&se&&oe){let ee=q.UTF8ToString($);if(se(w,ee)||oe(w,ee)){let ae=_t(G);Z=wt(ae,H),V="ml-tensor";let ce=q.webnnCreateTemporaryTensor,le=q.webnnUploadTensor;if(!ce||!le)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let de=await ce(w,ae,H);le(de,new Uint8Array(re.buffer,re.byteOffset,re.byteLength)),K=de}else Z=re.byteLength,K=q._malloc(Z),g.push(K),q.HEAPU8.set(new Uint8Array(re.buffer,re.byteOffset,Z),K)}else Z=re.byteLength,K=q._malloc(Z),g.push(K),q.HEAPU8.set(new Uint8Array(re.buffer,re.byteOffset,Z),K)}}let Q=q.stackSave(),J=q.stackAlloc(4*H.length);try{H.forEach((se,oe)=>q.setValue(J+oe*j,se,j===4?"i32":"i64"));let re=q._OrtCreateTensor(_t(G),K,Z,J,H.length,Kn(V));re===0&&fe(`Can't create tensor for input/output. session=${w}, index=${I}.`),m.push(re)}finally{q.stackRestore(Q)}},Ir=async(d,m,g,w,$,I)=>{let D=ge(),q=D.PTR_SIZE,j=Pt.get(d);if(!j)throw new Error(`cannot run inference. invalid session id: ${d}`);let G=j[0],H=j[1],W=j[2],V=j[3],K=j[4],Z=j[5],Q=m.length,J=w.length,re=0,se=[],oe=[],ee=[],ae=[],ce=D.stackSave(),le=D.stackAlloc(Q*q),de=D.stackAlloc(Q*q),_e=D.stackAlloc(J*q),we=D.stackAlloc(J*q);try{[re,se]=Ba(I);for(let Te=0;Te<Q;Te++)await ic(g[Te],oe,ae,d,H[m[Te]],m[Te],K);for(let Te=0;Te<J;Te++)await ic($[Te],ee,ae,d,W[w[Te]],Q+w[Te],K);for(let Te=0;Te<Q;Te++)D.setValue(le+Te*q,oe[Te],"*"),D.setValue(de+Te*q,H[m[Te]],"*");for(let Te=0;Te<J;Te++)D.setValue(_e+Te*q,ee[Te],"*"),D.setValue(we+Te*q,W[w[Te]],"*");if(V&&!Z){let{handle:Te,outputPreferredLocations:Ce,outputPreferredLocationsEncoded:Oe}=V;if(H.length!==Q)throw new Error(`input count from feeds (${Q}) is expected to be always equal to model's input count (${H.length}).`);for(let bt=0;bt<Q;bt++){let Mt=m[bt];await D._OrtBindInput(Te,H[Mt],oe[bt])!==0&&fe(`Can't bind input[${bt}] for session=${d}.`)}for(let bt=0;bt<J;bt++){let Mt=w[bt];$[bt]?.[3]?D._OrtBindOutput(Te,W[Mt],ee[bt],0)!==0&&fe(`Can't bind pre-allocated output[${bt}] for session=${d}.`):D._OrtBindOutput(Te,W[Mt],0,Oe[Mt])!==0&&fe(`Can't bind output[${bt}] to ${Ce[bt]} for session=${d}.`)}Pt.set(d,[G,H,W,V,K,!0])}D.jsepOnRunStart?.(G),D.webnnOnRunStart?.(G);let pe;V?pe=await D._OrtRunWithBinding(G,V.handle,J,_e,re):pe=await D._OrtRun(G,de,le,Q,we,J,_e,re),pe!==0&&fe("failed to call OrtRun().");let xe=[],Ge=[];for(let Te=0;Te<J;Te++){let Ce=Number(D.getValue(_e+Te*q,"*"));if(Ce===ee[Te]){xe.push($[Te]);continue}let Oe=D.stackSave(),bt=D.stackAlloc(4*q),Mt=!1,lt,ir=0;try{D._OrtGetTensorData(Ce,bt,bt+q,bt+2*q,bt+3*q)!==0&&fe(`Can't access output tensor data on index ${Te}.`);let Ye=q===4?"i32":"i64",xt=Number(D.getValue(bt,Ye));ir=D.getValue(bt+q,"*");let ar=D.getValue(bt+q*2,"*"),ht=Number(D.getValue(bt+q*3,Ye)),gt=[];for(let dr=0;dr<ht;dr++)gt.push(Number(D.getValue(ar+dr*q,Ye)));D._OrtFree(ar)!==0&&fe("Can't free memory for tensor dims.");let zt=gt.reduce((dr,fr)=>dr*fr,1);lt=Xe(xt);let ur=V?.outputPreferredLocations[w[Te]];if(lt==="string"){if(ur==="gpu-buffer"||ur==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let dr=[];for(let fr=0;fr<zt;fr++){let Ft=D.getValue(ir+fr*q,"*"),$e=D.getValue(ir+(fr+1)*q,"*"),Bt=fr===zt-1?void 0:$e-Ft;dr.push(D.UTF8ToString(Ft,Bt))}xe.push([lt,gt,dr,"cpu"])}else if(ur==="gpu-buffer"&&zt>0){let dr=D.jsepGetBuffer;if(!dr)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let fr=dr(ir),Ft=wt(xt,zt);if(Ft===void 0||!Or(lt))throw new Error(`Unsupported data type: ${lt}`);Mt=!0,xe.push([lt,gt,{gpuBuffer:fr,download:D.jsepCreateDownloader(fr,Ft,lt),dispose:()=>{D._OrtReleaseTensor(Ce)!==0&&fe("Can't release tensor.")}},"gpu-buffer"])}else if(ur==="ml-tensor"&&zt>0){let dr=D.webnnEnsureTensor,fr=D.webnnIsGraphInputOutputTypeSupported;if(!dr||!fr)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(wt(xt,zt)===void 0||!zr(lt))throw new Error(`Unsupported data type: ${lt}`);if(!fr(d,lt,!1))throw new Error(`preferredLocation "ml-tensor" for ${lt} output is not supported by current WebNN Context.`);let Ft=await dr(d,ir,xt,gt,!1);Mt=!0,xe.push([lt,gt,{mlTensor:Ft,download:D.webnnCreateMLTensorDownloader(ir,lt),dispose:()=>{D.webnnReleaseTensorId(ir),D._OrtReleaseTensor(Ce)}},"ml-tensor"])}else if(ur==="ml-tensor-cpu-output"&&zt>0){let dr=D.webnnCreateMLTensorDownloader(ir,lt)(),fr=xe.length;Mt=!0,Ge.push((async()=>{let Ft=[fr,await dr];return D.webnnReleaseTensorId(ir),D._OrtReleaseTensor(Ce),Ft})()),xe.push([lt,gt,[],"cpu"])}else{let dr=Ut(lt),fr=new dr(zt);new Uint8Array(fr.buffer,fr.byteOffset,fr.byteLength).set(D.HEAPU8.subarray(ir,ir+fr.byteLength)),xe.push([lt,gt,fr,"cpu"])}}finally{D.stackRestore(Oe),lt==="string"&&ir&&D._free(ir),Mt||D._OrtReleaseTensor(Ce)}}V&&!K&&(D._OrtClearBoundOutputs(V.handle)!==0&&fe("Can't clear bound outputs."),Pt.set(d,[G,H,W,V,K,!1]));for(let[Te,Ce]of await Promise.all(Ge))xe[Te][2]=Ce;return xe}finally{D.webnnOnRunEnd?.(G),D.stackRestore(ce),oe.forEach(pe=>D._OrtReleaseTensor(pe)),ee.forEach(pe=>D._OrtReleaseTensor(pe)),ae.forEach(pe=>D._free(pe)),re!==0&&D._OrtReleaseRunOptions(re),se.forEach(pe=>D._free(pe))}},Cr=d=>{let m=ge(),g=Pt.get(d);if(!g)throw new Error("invalid session id");let w=g[0],$=m._OrtEndProfiling(w);$===0&&fe("Can't get an profile file name."),m._OrtFree($)},Ar=d=>{let m=[];for(let g of d){let w=g[2];!Array.isArray(w)&&"buffer"in w&&m.push(w.buffer)}return m}}),Ot,Le,nr,un,dn,sn,ko,Eo,Lt,Gt,_g,ac,sc,uc,dc,lc,cc,pc,Po=U(()=>{We(),Wn(),yt(),wr(),Ot=()=>!!be.wasm.proxy&&typeof document<"u",nr=!1,un=!1,dn=!1,Eo=new Map,Lt=(d,m)=>{let g=Eo.get(d);g?g.push(m):Eo.set(d,[m])},Gt=()=>{if(nr||!un||dn||!Le)throw new Error("worker not ready")},_g=d=>{switch(d.data.type){case"init-wasm":nr=!1,d.data.err?(dn=!0,ko[1](d.data.err)):(un=!0,ko[0]()),sn&&(URL.revokeObjectURL(sn),sn=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let m=Eo.get(d.data.type);d.data.err?m.shift()[1](d.data.err):m.shift()[0](d.data.out);break}}},ac=async()=>{if(!un){if(nr)throw new Error("multiple calls to 'initWasm()' detected.");if(dn)throw new Error("previous call to 'initWasm()' failed.");if(nr=!0,Ot())return new Promise((d,m)=>{Le?.terminate(),Oa().then(([g,w])=>{try{Le=w,Le.onerror=I=>m(I),Le.onmessage=_g,ko=[d,m];let $={type:"init-wasm",in:be};!$.in.wasm.wasmPaths&&(g||Hn)&&($.in.wasm.wasmPaths={wasm:new URL(""+new URL("assets/ort-wasm-simd-threaded.jsep-CLPRrI3A.wasm",import.meta.url).href,import.meta.url).href}),Le.postMessage($),sn=g}catch($){m($)}},m)});try{await vr(be.wasm),await $r(be),un=!0}catch(d){throw dn=!0,d}finally{nr=!1}}},sc=async d=>{if(Ot())return Gt(),new Promise((m,g)=>{Lt("init-ep",[m,g]);let w={type:"init-ep",in:{epName:d,env:be}};Le.postMessage(w)});await xr(be,d)},uc=async d=>Ot()?(Gt(),new Promise((m,g)=>{Lt("copy-from",[m,g]);let w={type:"copy-from",in:{buffer:d}};Le.postMessage(w,[d.buffer])})):jt(d),dc=async(d,m)=>{if(Ot()){if(m?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Gt(),new Promise((g,w)=>{Lt("create",[g,w]);let $={type:"create",in:{model:d,options:{...m}}},I=[];d instanceof Uint8Array&&I.push(d.buffer),Le.postMessage($,I)})}else return Sr(d,m)},lc=async d=>{if(Ot())return Gt(),new Promise((m,g)=>{Lt("release",[m,g]);let w={type:"release",in:d};Le.postMessage(w)});Tr(d)},cc=async(d,m,g,w,$,I)=>{if(Ot()){if(g.some(D=>D[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if($.some(D=>D))throw new Error("pre-allocated output tensor is not supported for proxy.");return Gt(),new Promise((D,q)=>{Lt("run",[D,q]);let j=g,G={type:"run",in:{sessionId:d,inputIndices:m,inputs:j,outputIndices:w,options:I}};Le.postMessage(G,Ar(j))})}else return Ir(d,m,g,w,$,I)},pc=async d=>{if(Ot())return Gt(),new Promise((m,g)=>{Lt("end-profiling",[m,g]);let w={type:"end-profiling",in:d};Le.postMessage(w)});Cr(d)}}),mc,wg,ln,fc=U(()=>{We(),Po(),Y$2(),_r(),jn(),mc=(d,m)=>{switch(d.location){case"cpu":return[d.type,d.dims,d.data,"cpu"];case"gpu-buffer":return[d.type,d.dims,{gpuBuffer:d.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[d.type,d.dims,{mlTensor:d.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${d.location} for ${m()}`)}},wg=d=>{switch(d[3]){case"cpu":return new He(d[0],d[2],d[1]);case"gpu-buffer":{let m=d[0];if(!Or(m))throw new Error(`not supported data type: ${m} for deserializing GPU tensor`);let{gpuBuffer:g,download:w,dispose:$}=d[2];return He.fromGpuBuffer(g,{dataType:m,dims:d[1],download:w,dispose:$})}case"ml-tensor":{let m=d[0];if(!zr(m))throw new Error(`not supported data type: ${m} for deserializing MLTensor tensor`);let{mlTensor:g,download:w,dispose:$}=d[2];return He.fromMLTensor(g,{dataType:m,dims:d[1],download:w,dispose:$})}default:throw new Error(`invalid data location: ${d[3]}`)}},ln=class{async fetchModelAndCopyToWasmMemory(d){return uc(await Yt(d))}async loadModel(d,m){Re();let g;typeof d=="string"?g=await this.fetchModelAndCopyToWasmMemory(d):g=d,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await dc(g,m),De()}async dispose(){return lc(this.sessionId)}async run(d,m,g){Re();let w=[],$=[];Object.entries(d).forEach(W=>{let V=W[0],K=W[1],Z=this.inputNames.indexOf(V);if(Z===-1)throw new Error(`invalid input '${V}'`);w.push(K),$.push(Z)});let I=[],D=[];Object.entries(m).forEach(W=>{let V=W[0],K=W[1],Z=this.outputNames.indexOf(V);if(Z===-1)throw new Error(`invalid output '${V}'`);I.push(K),D.push(Z)});let q=w.map((W,V)=>mc(W,()=>`input "${this.inputNames[$[V]]}"`)),j=I.map((W,V)=>W?mc(W,()=>`output "${this.outputNames[D[V]]}"`):null),G=await cc(this.sessionId,$,q,D,j,g),H={};for(let W=0;W<G.length;W++)H[this.outputNames[D[W]]]=I[W]??wg(G[W]);return De(),H}startProfiling(){}endProfiling(){pc(this.sessionId)}}}),gc={};Rt(gc,{OnnxruntimeWebAssemblyBackend:()=>cn,initializeFlags:()=>hc,wasmBackend:()=>vg});var hc,cn,vg,bc=U(()=>{We(),Po(),fc(),hc=()=>{(typeof be.wasm.initTimeout!="number"||be.wasm.initTimeout<0)&&(be.wasm.initTimeout=0);let d=be.wasm.simd;if(typeof d!="boolean"&&d!==void 0&&d!=="fixed"&&d!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${d}". Reset it to \`false\` and ignore SIMD feature checking.`),be.wasm.simd=!1),typeof be.wasm.proxy!="boolean"&&(be.wasm.proxy=!1),typeof be.wasm.trace!="boolean"&&(be.wasm.trace=!1),typeof be.wasm.numThreads!="number"||!Number.isInteger(be.wasm.numThreads)||be.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)be.wasm.numThreads=1;else{let m=typeof navigator>"u"?Dn("node:os").cpus().length:navigator.hardwareConcurrency;be.wasm.numThreads=Math.min(4,Math.ceil((m||1)/2))}},cn=class{async init(d){hc(),await ac(),await sc(d)}async createInferenceSessionHandler(d,m){let g=new ln;return await g.loadModel(d,m),g}},vg=new cn});We();We();We();var _a="1.22.0";{let d=(bc(),qt(gc)).wasmBackend;Tt("webgpu",d,5),Tt("webnn",d,5),Tt("cpu",d,10),Tt("wasm",d,10)}Object.defineProperty(be.versions,"web",{value:_a,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}function getAugmentedNamespace(d){if(d.__esModule)return d;var m=d.default;if(typeof m=="function"){var g=function w(){return this instanceof w?Reflect.construct(m,arguments,this.constructor):m.apply(this,arguments)};g.prototype=m.prototype}else g={};return Object.defineProperty(g,"__esModule",{value:!0}),Object.keys(d).forEach((function(w){var $=Object.getOwnPropertyDescriptor(d,w);Object.defineProperty(g,w,$.get?$:{enumerable:!0,get:function(){return d[w]}})})),g}typeof self>"u"&&typeof commonjsGlobal=="object"&&(commonjsGlobal.self=commonjsGlobal);var global$1=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",m=0;m<64;++m)lookup[m]=d[m],revLookup[d.charCodeAt(m)]=m;revLookup[45]=62,revLookup[95]=63}function toByteArray(d){var m,g,w,$,I,D;inited||init();var q=d.length;if(q%4>0)throw new Error("Invalid string. Length must be a multiple of 4");I=d[q-2]==="="?2:d[q-1]==="="?1:0,D=new Arr(3*q/4-I),w=I>0?q-4:q;var j=0;for(m=0,g=0;m<w;m+=4,g+=3)$=revLookup[d.charCodeAt(m)]<<18|revLookup[d.charCodeAt(m+1)]<<12|revLookup[d.charCodeAt(m+2)]<<6|revLookup[d.charCodeAt(m+3)],D[j++]=$>>16&255,D[j++]=$>>8&255,D[j++]=255&$;return I===2?($=revLookup[d.charCodeAt(m)]<<2|revLookup[d.charCodeAt(m+1)]>>4,D[j++]=255&$):I===1&&($=revLookup[d.charCodeAt(m)]<<10|revLookup[d.charCodeAt(m+1)]<<4|revLookup[d.charCodeAt(m+2)]>>2,D[j++]=$>>8&255,D[j++]=255&$),D}function tripletToBase64(d){return lookup[d>>18&63]+lookup[d>>12&63]+lookup[d>>6&63]+lookup[63&d]}function encodeChunk(d,m,g){for(var w,$=[],I=m;I<g;I+=3)w=(d[I]<<16)+(d[I+1]<<8)+d[I+2],$.push(tripletToBase64(w));return $.join("")}function fromByteArray(d){var m;inited||init();for(var g=d.length,w=g%3,$="",I=[],D=16383,q=0,j=g-w;q<j;q+=D)I.push(encodeChunk(d,q,q+D>j?j:q+D));return w===1?(m=d[g-1],$+=lookup[m>>2],$+=lookup[m<<4&63],$+="=="):w===2&&(m=(d[g-2]<<8)+d[g-1],$+=lookup[m>>10],$+=lookup[m>>4&63],$+=lookup[m<<2&63],$+="="),I.push($),I.join("")}function read(d,m,g,w,$){var I,D,q=8*$-w-1,j=(1<<q)-1,G=j>>1,H=-7,W=g?$-1:0,V=g?-1:1,K=d[m+W];for(W+=V,I=K&(1<<-H)-1,K>>=-H,H+=q;H>0;I=256*I+d[m+W],W+=V,H-=8);for(D=I&(1<<-H)-1,I>>=-H,H+=w;H>0;D=256*D+d[m+W],W+=V,H-=8);if(I===0)I=1-G;else{if(I===j)return D?NaN:1/0*(K?-1:1);D+=Math.pow(2,w),I-=G}return(K?-1:1)*D*Math.pow(2,I-w)}function write(d,m,g,w,$,I){var D,q,j,G=8*I-$-1,H=(1<<G)-1,W=H>>1,V=$===23?Math.pow(2,-24)-Math.pow(2,-77):0,K=w?0:I-1,Z=w?1:-1,Q=m<0||m===0&&1/m<0?1:0;for(m=Math.abs(m),isNaN(m)||m===1/0?(q=isNaN(m)?1:0,D=H):(D=Math.floor(Math.log(m)/Math.LN2),m*(j=Math.pow(2,-D))<1&&(D--,j*=2),(m+=D+W>=1?V/j:V*Math.pow(2,1-W))*j>=2&&(D++,j/=2),D+W>=H?(q=0,D=H):D+W>=1?(q=(m*j-1)*Math.pow(2,$),D+=W):(q=m*Math.pow(2,W-1)*Math.pow(2,$),D=0));$>=8;d[g+K]=255&q,K+=Z,q/=256,$-=8);for(D=D<<$|q,G+=$;G>0;d[g+K]=255&D,K+=Z,D/=256,G-=8);d[g+K-Z]|=128*Q}var toString={}.toString,isArray=Array.isArray||function(d){return toString.call(d)=="[object Array]"},INSPECT_MAX_BYTES=50;function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(d,m){if(kMaxLength()<m)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(d=new Uint8Array(m)).__proto__=Buffer.prototype:(d===null&&(d=new Buffer(m)),d.length=m),d}function Buffer(d,m,g){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(d,m,g);if(typeof d=="number"){if(typeof m=="string")throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,d)}return from(this,d,m,g)}function from(d,m,g,w){if(typeof m=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&m instanceof ArrayBuffer?fromArrayBuffer(d,m,g,w):typeof m=="string"?fromString(d,m,g):fromObject(d,m)}function assertSize(d){if(typeof d!="number")throw new TypeError('"size" argument must be a number');if(d<0)throw new RangeError('"size" argument must not be negative')}function alloc(d,m,g,w){return assertSize(m),m<=0?createBuffer(d,m):g!==void 0?typeof w=="string"?createBuffer(d,m).fill(g,w):createBuffer(d,m).fill(g):createBuffer(d,m)}function allocUnsafe(d,m){if(assertSize(m),d=createBuffer(d,m<0?0:0|checked(m)),!Buffer.TYPED_ARRAY_SUPPORT)for(var g=0;g<m;++g)d[g]=0;return d}function fromString(d,m,g){if(typeof g=="string"&&g!==""||(g="utf8"),!Buffer.isEncoding(g))throw new TypeError('"encoding" must be a valid string encoding');var w=0|byteLength(m,g),$=(d=createBuffer(d,w)).write(m,g);return $!==w&&(d=d.slice(0,$)),d}function fromArrayLike(d,m){var g=m.length<0?0:0|checked(m.length);d=createBuffer(d,g);for(var w=0;w<g;w+=1)d[w]=255&m[w];return d}function fromArrayBuffer(d,m,g,w){if(m.byteLength,g<0||m.byteLength<g)throw new RangeError("'offset' is out of bounds");if(m.byteLength<g+(w||0))throw new RangeError("'length' is out of bounds");return m=g===void 0&&w===void 0?new Uint8Array(m):w===void 0?new Uint8Array(m,g):new Uint8Array(m,g,w),Buffer.TYPED_ARRAY_SUPPORT?(d=m).__proto__=Buffer.prototype:d=fromArrayLike(d,m),d}function fromObject(d,m){if(internalIsBuffer(m)){var g=0|checked(m.length);return(d=createBuffer(d,g)).length===0||m.copy(d,0,0,g),d}if(m){if(typeof ArrayBuffer<"u"&&m.buffer instanceof ArrayBuffer||"length"in m)return typeof m.length!="number"||isnan(m.length)?createBuffer(d,0):fromArrayLike(d,m);if(m.type==="Buffer"&&isArray(m.data))return fromArrayLike(d,m.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(d){if(d>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|d}function internalIsBuffer(d){return!(d==null||!d._isBuffer)}function byteLength(d,m){if(internalIsBuffer(d))return d.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(d)||d instanceof ArrayBuffer))return d.byteLength;typeof d!="string"&&(d=""+d);var g=d.length;if(g===0)return 0;for(var w=!1;;)switch(m){case"ascii":case"latin1":case"binary":return g;case"utf8":case"utf-8":case void 0:return utf8ToBytes(d).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*g;case"hex":return g>>>1;case"base64":return base64ToBytes(d).length;default:if(w)return utf8ToBytes(d).length;m=(""+m).toLowerCase(),w=!0}}function slowToString(d,m,g){var w=!1;if((m===void 0||m<0)&&(m=0),m>this.length||((g===void 0||g>this.length)&&(g=this.length),g<=0)||(g>>>=0)<=(m>>>=0))return"";for(d||(d="utf8");;)switch(d){case"hex":return hexSlice(this,m,g);case"utf8":case"utf-8":return utf8Slice(this,m,g);case"ascii":return asciiSlice(this,m,g);case"latin1":case"binary":return latin1Slice(this,m,g);case"base64":return base64Slice(this,m,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,m,g);default:if(w)throw new TypeError("Unknown encoding: "+d);d=(d+"").toLowerCase(),w=!0}}function swap(d,m,g){var w=d[m];d[m]=d[g],d[g]=w}function bidirectionalIndexOf(d,m,g,w,$){if(d.length===0)return-1;if(typeof g=="string"?(w=g,g=0):g>2147483647?g=2147483647:g<-2147483648&&(g=-2147483648),g=+g,isNaN(g)&&(g=$?0:d.length-1),g<0&&(g=d.length+g),g>=d.length){if($)return-1;g=d.length-1}else if(g<0){if(!$)return-1;g=0}if(typeof m=="string"&&(m=Buffer.from(m,w)),internalIsBuffer(m))return m.length===0?-1:arrayIndexOf(d,m,g,w,$);if(typeof m=="number")return m&=255,Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?$?Uint8Array.prototype.indexOf.call(d,m,g):Uint8Array.prototype.lastIndexOf.call(d,m,g):arrayIndexOf(d,[m],g,w,$);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(d,m,g,w,$){var I,D=1,q=d.length,j=m.length;if(w!==void 0&&((w=String(w).toLowerCase())==="ucs2"||w==="ucs-2"||w==="utf16le"||w==="utf-16le")){if(d.length<2||m.length<2)return-1;D=2,q/=2,j/=2,g/=2}function G(K,Z){return D===1?K[Z]:K.readUInt16BE(Z*D)}if($){var H=-1;for(I=g;I<q;I++)if(G(d,I)===G(m,H===-1?0:I-H)){if(H===-1&&(H=I),I-H+1===j)return H*D}else H!==-1&&(I-=I-H),H=-1}else for(g+j>q&&(g=q-j),I=g;I>=0;I--){for(var W=!0,V=0;V<j;V++)if(G(d,I+V)!==G(m,V)){W=!1;break}if(W)return I}return-1}function hexWrite(d,m,g,w){g=Number(g)||0;var $=d.length-g;w?(w=Number(w))>$&&(w=$):w=$;var I=m.length;if(I%2!=0)throw new TypeError("Invalid hex string");w>I/2&&(w=I/2);for(var D=0;D<w;++D){var q=parseInt(m.substr(2*D,2),16);if(isNaN(q))return D;d[g+D]=q}return D}function utf8Write(d,m,g,w){return blitBuffer(utf8ToBytes(m,d.length-g),d,g,w)}function asciiWrite(d,m,g,w){return blitBuffer(asciiToBytes(m),d,g,w)}function latin1Write(d,m,g,w){return asciiWrite(d,m,g,w)}function base64Write(d,m,g,w){return blitBuffer(base64ToBytes(m),d,g,w)}function ucs2Write(d,m,g,w){return blitBuffer(utf16leToBytes(m,d.length-g),d,g,w)}function base64Slice(d,m,g){return m===0&&g===d.length?fromByteArray(d):fromByteArray(d.slice(m,g))}function utf8Slice(d,m,g){g=Math.min(d.length,g);for(var w=[],$=m;$<g;){var I,D,q,j,G=d[$],H=null,W=G>239?4:G>223?3:G>191?2:1;if($+W<=g)switch(W){case 1:G<128&&(H=G);break;case 2:(192&(I=d[$+1]))==128&&(j=(31&G)<<6|63&I)>127&&(H=j);break;case 3:I=d[$+1],D=d[$+2],(192&I)==128&&(192&D)==128&&(j=(15&G)<<12|(63&I)<<6|63&D)>2047&&(j<55296||j>57343)&&(H=j);break;case 4:I=d[$+1],D=d[$+2],q=d[$+3],(192&I)==128&&(192&D)==128&&(192&q)==128&&(j=(15&G)<<18|(63&I)<<12|(63&D)<<6|63&q)>65535&&j<1114112&&(H=j)}H===null?(H=65533,W=1):H>65535&&(H-=65536,w.push(H>>>10&1023|55296),H=56320|1023&H),w.push(H),$+=W}return decodeCodePointsArray(w)}Buffer.TYPED_ARRAY_SUPPORT=global$1.TYPED_ARRAY_SUPPORT===void 0||global$1.TYPED_ARRAY_SUPPORT,kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(d){return d.__proto__=Buffer.prototype,d},Buffer.from=function(d,m,g){return from(null,d,m,g)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&Buffer[Symbol.species]),Buffer.alloc=function(d,m,g){return alloc(null,d,m,g)},Buffer.allocUnsafe=function(d){return allocUnsafe(null,d)},Buffer.allocUnsafeSlow=function(d){return allocUnsafe(null,d)},Buffer.isBuffer=isBuffer,Buffer.compare=function(d,m){if(!internalIsBuffer(d)||!internalIsBuffer(m))throw new TypeError("Arguments must be Buffers");if(d===m)return 0;for(var g=d.length,w=m.length,$=0,I=Math.min(g,w);$<I;++$)if(d[$]!==m[$]){g=d[$],w=m[$];break}return g<w?-1:w<g?1:0},Buffer.isEncoding=function(d){switch(String(d).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(d,m){if(!isArray(d))throw new TypeError('"list" argument must be an Array of Buffers');if(d.length===0)return Buffer.alloc(0);var g;if(m===void 0)for(m=0,g=0;g<d.length;++g)m+=d[g].length;var w=Buffer.allocUnsafe(m),$=0;for(g=0;g<d.length;++g){var I=d[g];if(!internalIsBuffer(I))throw new TypeError('"list" argument must be an Array of Buffers');I.copy(w,$),$+=I.length}return w},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var d=this.length;if(d%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var m=0;m<d;m+=2)swap(this,m,m+1);return this},Buffer.prototype.swap32=function(){var d=this.length;if(d%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var m=0;m<d;m+=4)swap(this,m,m+3),swap(this,m+1,m+2);return this},Buffer.prototype.swap64=function(){var d=this.length;if(d%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var m=0;m<d;m+=8)swap(this,m,m+7),swap(this,m+1,m+6),swap(this,m+2,m+5),swap(this,m+3,m+4);return this},Buffer.prototype.toString=function(){var d=0|this.length;return d===0?"":arguments.length===0?utf8Slice(this,0,d):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(d){if(!internalIsBuffer(d))throw new TypeError("Argument must be a Buffer");return this===d||Buffer.compare(this,d)===0},Buffer.prototype.inspect=function(){var d="",m=INSPECT_MAX_BYTES;return this.length>0&&(d=this.toString("hex",0,m).match(/.{2}/g).join(" "),this.length>m&&(d+=" ... ")),"<Buffer "+d+">"},Buffer.prototype.compare=function(d,m,g,w,$){if(!internalIsBuffer(d))throw new TypeError("Argument must be a Buffer");if(m===void 0&&(m=0),g===void 0&&(g=d?d.length:0),w===void 0&&(w=0),$===void 0&&($=this.length),m<0||g>d.length||w<0||$>this.length)throw new RangeError("out of range index");if(w>=$&&m>=g)return 0;if(w>=$)return-1;if(m>=g)return 1;if(this===d)return 0;for(var I=($>>>=0)-(w>>>=0),D=(g>>>=0)-(m>>>=0),q=Math.min(I,D),j=this.slice(w,$),G=d.slice(m,g),H=0;H<q;++H)if(j[H]!==G[H]){I=j[H],D=G[H];break}return I<D?-1:D<I?1:0},Buffer.prototype.includes=function(d,m,g){return this.indexOf(d,m,g)!==-1},Buffer.prototype.indexOf=function(d,m,g){return bidirectionalIndexOf(this,d,m,g,!0)},Buffer.prototype.lastIndexOf=function(d,m,g){return bidirectionalIndexOf(this,d,m,g,!1)},Buffer.prototype.write=function(d,m,g,w){if(m===void 0)w="utf8",g=this.length,m=0;else if(g===void 0&&typeof m=="string")w=m,g=this.length,m=0;else{if(!isFinite(m))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");m|=0,isFinite(g)?(g|=0,w===void 0&&(w="utf8")):(w=g,g=void 0)}var $=this.length-m;if((g===void 0||g>$)&&(g=$),d.length>0&&(g<0||m<0)||m>this.length)throw new RangeError("Attempt to write outside buffer bounds");w||(w="utf8");for(var I=!1;;)switch(w){case"hex":return hexWrite(this,d,m,g);case"utf8":case"utf-8":return utf8Write(this,d,m,g);case"ascii":return asciiWrite(this,d,m,g);case"latin1":case"binary":return latin1Write(this,d,m,g);case"base64":return base64Write(this,d,m,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,d,m,g);default:if(I)throw new TypeError("Unknown encoding: "+w);w=(""+w).toLowerCase(),I=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(d){var m=d.length;if(m<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,d);for(var g="",w=0;w<m;)g+=String.fromCharCode.apply(String,d.slice(w,w+=MAX_ARGUMENTS_LENGTH));return g}function asciiSlice(d,m,g){var w="";g=Math.min(d.length,g);for(var $=m;$<g;++$)w+=String.fromCharCode(127&d[$]);return w}function latin1Slice(d,m,g){var w="";g=Math.min(d.length,g);for(var $=m;$<g;++$)w+=String.fromCharCode(d[$]);return w}function hexSlice(d,m,g){var w=d.length;(!m||m<0)&&(m=0),(!g||g<0||g>w)&&(g=w);for(var $="",I=m;I<g;++I)$+=toHex(d[I]);return $}function utf16leSlice(d,m,g){for(var w=d.slice(m,g),$="",I=0;I<w.length;I+=2)$+=String.fromCharCode(w[I]+256*w[I+1]);return $}function checkOffset(d,m,g){if(d%1!=0||d<0)throw new RangeError("offset is not uint");if(d+m>g)throw new RangeError("Trying to access beyond buffer length")}function checkInt(d,m,g,w,$,I){if(!internalIsBuffer(d))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>$||m<I)throw new RangeError('"value" argument is out of bounds');if(g+w>d.length)throw new RangeError("Index out of range")}function objectWriteUInt16(d,m,g,w){m<0&&(m=65535+m+1);for(var $=0,I=Math.min(d.length-g,2);$<I;++$)d[g+$]=(m&255<<8*(w?$:1-$))>>>8*(w?$:1-$)}function objectWriteUInt32(d,m,g,w){m<0&&(m=4294967295+m+1);for(var $=0,I=Math.min(d.length-g,4);$<I;++$)d[g+$]=m>>>8*(w?$:3-$)&255}function checkIEEE754(d,m,g,w,$,I){if(g+w>d.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("Index out of range")}function writeFloat(d,m,g,w,$){return $||checkIEEE754(d,m,g,4),write(d,m,g,w,23,4),g+4}function writeDouble(d,m,g,w,$){return $||checkIEEE754(d,m,g,8),write(d,m,g,w,52,8),g+8}Buffer.prototype.slice=function(d,m){var g,w=this.length;if((d=~~d)<0?(d+=w)<0&&(d=0):d>w&&(d=w),(m=m===void 0?w:~~m)<0?(m+=w)<0&&(m=0):m>w&&(m=w),m<d&&(m=d),Buffer.TYPED_ARRAY_SUPPORT)(g=this.subarray(d,m)).__proto__=Buffer.prototype;else{var $=m-d;g=new Buffer($,void 0);for(var I=0;I<$;++I)g[I]=this[I+d]}return g},Buffer.prototype.readUIntLE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=this[d],$=1,I=0;++I<m&&($*=256);)w+=this[d+I]*$;return w},Buffer.prototype.readUIntBE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=this[d+--m],$=1;m>0&&($*=256);)w+=this[d+--m]*$;return w},Buffer.prototype.readUInt8=function(d,m){return m||checkOffset(d,1,this.length),this[d]},Buffer.prototype.readUInt16LE=function(d,m){return m||checkOffset(d,2,this.length),this[d]|this[d+1]<<8},Buffer.prototype.readUInt16BE=function(d,m){return m||checkOffset(d,2,this.length),this[d]<<8|this[d+1]},Buffer.prototype.readUInt32LE=function(d,m){return m||checkOffset(d,4,this.length),(this[d]|this[d+1]<<8|this[d+2]<<16)+16777216*this[d+3]},Buffer.prototype.readUInt32BE=function(d,m){return m||checkOffset(d,4,this.length),16777216*this[d]+(this[d+1]<<16|this[d+2]<<8|this[d+3])},Buffer.prototype.readIntLE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=this[d],$=1,I=0;++I<m&&($*=256);)w+=this[d+I]*$;return w>=($*=128)&&(w-=Math.pow(2,8*m)),w},Buffer.prototype.readIntBE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=m,$=1,I=this[d+--w];w>0&&($*=256);)I+=this[d+--w]*$;return I>=($*=128)&&(I-=Math.pow(2,8*m)),I},Buffer.prototype.readInt8=function(d,m){return m||checkOffset(d,1,this.length),128&this[d]?-1*(255-this[d]+1):this[d]},Buffer.prototype.readInt16LE=function(d,m){m||checkOffset(d,2,this.length);var g=this[d]|this[d+1]<<8;return 32768&g?4294901760|g:g},Buffer.prototype.readInt16BE=function(d,m){m||checkOffset(d,2,this.length);var g=this[d+1]|this[d]<<8;return 32768&g?4294901760|g:g},Buffer.prototype.readInt32LE=function(d,m){return m||checkOffset(d,4,this.length),this[d]|this[d+1]<<8|this[d+2]<<16|this[d+3]<<24},Buffer.prototype.readInt32BE=function(d,m){return m||checkOffset(d,4,this.length),this[d]<<24|this[d+1]<<16|this[d+2]<<8|this[d+3]},Buffer.prototype.readFloatLE=function(d,m){return m||checkOffset(d,4,this.length),read(this,d,!0,23,4)},Buffer.prototype.readFloatBE=function(d,m){return m||checkOffset(d,4,this.length),read(this,d,!1,23,4)},Buffer.prototype.readDoubleLE=function(d,m){return m||checkOffset(d,8,this.length),read(this,d,!0,52,8)},Buffer.prototype.readDoubleBE=function(d,m){return m||checkOffset(d,8,this.length),read(this,d,!1,52,8)},Buffer.prototype.writeUIntLE=function(d,m,g,w){d=+d,m|=0,g|=0,w||checkInt(this,d,m,g,Math.pow(2,8*g)-1,0);var $=1,I=0;for(this[m]=255&d;++I<g&&($*=256);)this[m+I]=d/$&255;return m+g},Buffer.prototype.writeUIntBE=function(d,m,g,w){d=+d,m|=0,g|=0,w||checkInt(this,d,m,g,Math.pow(2,8*g)-1,0);var $=g-1,I=1;for(this[m+$]=255&d;--$>=0&&(I*=256);)this[m+$]=d/I&255;return m+g},Buffer.prototype.writeUInt8=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(d=Math.floor(d)),this[m]=255&d,m+1},Buffer.prototype.writeUInt16LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=255&d,this[m+1]=d>>>8):objectWriteUInt16(this,d,m,!0),m+2},Buffer.prototype.writeUInt16BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>8,this[m+1]=255&d):objectWriteUInt16(this,d,m,!1),m+2},Buffer.prototype.writeUInt32LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m+3]=d>>>24,this[m+2]=d>>>16,this[m+1]=d>>>8,this[m]=255&d):objectWriteUInt32(this,d,m,!0),m+4},Buffer.prototype.writeUInt32BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>24,this[m+1]=d>>>16,this[m+2]=d>>>8,this[m+3]=255&d):objectWriteUInt32(this,d,m,!1),m+4},Buffer.prototype.writeIntLE=function(d,m,g,w){if(d=+d,m|=0,!w){var $=Math.pow(2,8*g-1);checkInt(this,d,m,g,$-1,-$)}var I=0,D=1,q=0;for(this[m]=255&d;++I<g&&(D*=256);)d<0&&q===0&&this[m+I-1]!==0&&(q=1),this[m+I]=(d/D|0)-q&255;return m+g},Buffer.prototype.writeIntBE=function(d,m,g,w){if(d=+d,m|=0,!w){var $=Math.pow(2,8*g-1);checkInt(this,d,m,g,$-1,-$)}var I=g-1,D=1,q=0;for(this[m+I]=255&d;--I>=0&&(D*=256);)d<0&&q===0&&this[m+I+1]!==0&&(q=1),this[m+I]=(d/D|0)-q&255;return m+g},Buffer.prototype.writeInt8=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(d=Math.floor(d)),d<0&&(d=255+d+1),this[m]=255&d,m+1},Buffer.prototype.writeInt16LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=255&d,this[m+1]=d>>>8):objectWriteUInt16(this,d,m,!0),m+2},Buffer.prototype.writeInt16BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>8,this[m+1]=255&d):objectWriteUInt16(this,d,m,!1),m+2},Buffer.prototype.writeInt32LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=255&d,this[m+1]=d>>>8,this[m+2]=d>>>16,this[m+3]=d>>>24):objectWriteUInt32(this,d,m,!0),m+4},Buffer.prototype.writeInt32BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,2147483647,-2147483648),d<0&&(d=4294967295+d+1),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>24,this[m+1]=d>>>16,this[m+2]=d>>>8,this[m+3]=255&d):objectWriteUInt32(this,d,m,!1),m+4},Buffer.prototype.writeFloatLE=function(d,m,g){return writeFloat(this,d,m,!0,g)},Buffer.prototype.writeFloatBE=function(d,m,g){return writeFloat(this,d,m,!1,g)},Buffer.prototype.writeDoubleLE=function(d,m,g){return writeDouble(this,d,m,!0,g)},Buffer.prototype.writeDoubleBE=function(d,m,g){return writeDouble(this,d,m,!1,g)},Buffer.prototype.copy=function(d,m,g,w){if(g||(g=0),w||w===0||(w=this.length),m>=d.length&&(m=d.length),m||(m=0),w>0&&w<g&&(w=g),w===g||d.length===0||this.length===0)return 0;if(m<0)throw new RangeError("targetStart out of bounds");if(g<0||g>=this.length)throw new RangeError("sourceStart out of bounds");if(w<0)throw new RangeError("sourceEnd out of bounds");w>this.length&&(w=this.length),d.length-m<w-g&&(w=d.length-m+g);var $,I=w-g;if(this===d&&g<m&&m<w)for($=I-1;$>=0;--$)d[$+m]=this[$+g];else if(I<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for($=0;$<I;++$)d[$+m]=this[$+g];else Uint8Array.prototype.set.call(d,this.subarray(g,g+I),m);return I},Buffer.prototype.fill=function(d,m,g,w){if(typeof d=="string"){if(typeof m=="string"?(w=m,m=0,g=this.length):typeof g=="string"&&(w=g,g=this.length),d.length===1){var $=d.charCodeAt(0);$<256&&(d=$)}if(w!==void 0&&typeof w!="string")throw new TypeError("encoding must be a string");if(typeof w=="string"&&!Buffer.isEncoding(w))throw new TypeError("Unknown encoding: "+w)}else typeof d=="number"&&(d&=255);if(m<0||this.length<m||this.length<g)throw new RangeError("Out of range index");if(g<=m)return this;var I;if(m>>>=0,g=g===void 0?this.length:g>>>0,d||(d=0),typeof d=="number")for(I=m;I<g;++I)this[I]=d;else{var D=internalIsBuffer(d)?d:utf8ToBytes(new Buffer(d,w).toString()),q=D.length;for(I=0;I<g-m;++I)this[I+m]=D[I%q]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g,HeaderTypes;function base64clean(d){if((d=stringtrim(d).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;d.length%4!=0;)d+="=";return d}function stringtrim(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")}function toHex(d){return d<16?"0"+d.toString(16):d.toString(16)}function utf8ToBytes(d,m){var g;m=m||1/0;for(var w=d.length,$=null,I=[],D=0;D<w;++D){if((g=d.charCodeAt(D))>55295&&g<57344){if(!$){if(g>56319){(m-=3)>-1&&I.push(239,191,189);continue}if(D+1===w){(m-=3)>-1&&I.push(239,191,189);continue}$=g;continue}if(g<56320){(m-=3)>-1&&I.push(239,191,189),$=g;continue}g=65536+($-55296<<10|g-56320)}else $&&(m-=3)>-1&&I.push(239,191,189);if($=null,g<128){if((m-=1)<0)break;I.push(g)}else if(g<2048){if((m-=2)<0)break;I.push(g>>6|192,63&g|128)}else if(g<65536){if((m-=3)<0)break;I.push(g>>12|224,g>>6&63|128,63&g|128)}else{if(!(g<1114112))throw new Error("Invalid code point");if((m-=4)<0)break;I.push(g>>18|240,g>>12&63|128,g>>6&63|128,63&g|128)}}return I}function asciiToBytes(d){for(var m=[],g=0;g<d.length;++g)m.push(255&d.charCodeAt(g));return m}function utf16leToBytes(d,m){for(var g,w,$,I=[],D=0;D<d.length&&!((m-=2)<0);++D)w=(g=d.charCodeAt(D))>>8,$=g%256,I.push($),I.push(w);return I}function base64ToBytes(d){return toByteArray(base64clean(d))}function blitBuffer(d,m,g,w){for(var $=0;$<w&&!($+g>=m.length||$>=d.length);++$)m[$+g]=d[$];return $}function isnan(d){return d!=d}function isBuffer(d){return d!=null&&(!!d._isBuffer||isFastBuffer(d)||isSlowBuffer(d))}function isFastBuffer(d){return!!d.constructor&&typeof d.constructor.isBuffer=="function"&&d.constructor.isBuffer(d)}function isSlowBuffer(d){return typeof d.readFloatLE=="function"&&typeof d.slice=="function"&&isFastBuffer(d.slice(0,0))}(function(d){d[d.BITMAP_INFO_HEADER=40]="BITMAP_INFO_HEADER",d[d.BITMAP_V2_INFO_HEADER=52]="BITMAP_V2_INFO_HEADER",d[d.BITMAP_V3_INFO_HEADER=56]="BITMAP_V3_INFO_HEADER",d[d.BITMAP_V4_HEADER=108]="BITMAP_V4_HEADER",d[d.BITMAP_V5_HEADER=124]="BITMAP_V5_HEADER"})(HeaderTypes||(HeaderTypes={}));var HeaderTypes$1=HeaderTypes,BmpCompression;function maskColor(d,m,g,w){const $=1+~d&d,I=1+~m&m,D=1+~g&g,q=1+~w&w,j=d/$+1,G=m/I+1,H=g/D+1,W=w/q+1;return{shiftRed:V=>(V&d)/$*256/j,shiftGreen:V=>(V&m)/I*256/G,shiftBlue:V=>(V&g)/D*256/H,shiftAlpha:w!==0?V=>(V&w)/q*256/W:()=>255}}(function(d){d[d.NONE=0]="NONE",d[d.BI_RLE8=1]="BI_RLE8",d[d.BI_RLE4=2]="BI_RLE4",d[d.BI_BIT_FIELDS=3]="BI_BIT_FIELDS",d[d.BI_ALPHA_BIT_FIELDS=6]="BI_ALPHA_BIT_FIELDS"})(BmpCompression||(BmpCompression={}));class BmpDecoder{flag;fileSize;reserved1;reserved2;offset;headerSize;width;height;planes;bitPP;compression;rawSize;hr;vr;colors;importantColors;palette;data;maskRed;maskGreen;maskBlue;maskAlpha;toRGBA;pos;bottomUp;buffer;locRed;locGreen;locBlue;locAlpha;shiftRed;shiftGreen;shiftBlue;shiftAlpha;constructor(m,{toRGBA:g}={toRGBA:!1}){if(this.buffer=m,this.toRGBA=!!g,this.pos=0,this.bottomUp=!0,this.flag=this.buffer.toString("utf-8",0,this.pos+=2),this.flag!=="BM")throw new Error("Invalid BMP File");this.locRed=this.toRGBA?0:3,this.locGreen=this.toRGBA?1:2,this.locBlue=this.toRGBA?2:1,this.locAlpha=this.toRGBA?3:0,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.readUInt32LE(),this.reserved1=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.reserved2=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.offset=this.readUInt32LE(),this.headerSize=this.readUInt32LE(),!(this.headerSize in HeaderTypes$1))throw new Error(`Unsupported BMP header size ${this.headerSize}`);if(this.width=this.readUInt32LE(),this.height=this.readUInt32LE(),this.height=this.height>2147483647?this.height-4294967296:this.height,this.planes=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.bitPP=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.compression=this.readUInt32LE(),this.rawSize=this.readUInt32LE(),this.hr=this.readUInt32LE(),this.vr=this.readUInt32LE(),this.colors=this.readUInt32LE(),this.importantColors=this.readUInt32LE(),this.bitPP===32?(this.maskAlpha=0,this.maskRed=16711680,this.maskGreen=65280,this.maskBlue=255):this.bitPP===16&&(this.maskAlpha=0,this.maskRed=31744,this.maskGreen=992,this.maskBlue=31),(this.headerSize>HeaderTypes$1.BITMAP_INFO_HEADER||this.compression===BmpCompression.BI_BIT_FIELDS||this.compression===BmpCompression.BI_ALPHA_BIT_FIELDS)&&(this.maskRed=this.readUInt32LE(),this.maskGreen=this.readUInt32LE(),this.maskBlue=this.readUInt32LE()),(this.headerSize>HeaderTypes$1.BITMAP_V2_INFO_HEADER||this.compression===BmpCompression.BI_ALPHA_BIT_FIELDS)&&(this.maskAlpha=this.readUInt32LE()),this.headerSize>HeaderTypes$1.BITMAP_V3_INFO_HEADER&&(this.pos+=HeaderTypes$1.BITMAP_V4_HEADER-HeaderTypes$1.BITMAP_V3_INFO_HEADER),this.headerSize>HeaderTypes$1.BITMAP_V4_HEADER&&(this.pos+=HeaderTypes$1.BITMAP_V5_HEADER-HeaderTypes$1.BITMAP_V4_HEADER),this.bitPP<=8||this.colors>0){const g=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(g);for(let w=0;w<g;w++){const $=this.buffer.readUInt8(this.pos++),I=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++),q=this.buffer.readUInt8(this.pos++);this.palette[w]={red:D,green:I,blue:$,quad:q}}}this.height<0&&(this.height*=-1,this.bottomUp=!1);const m=maskColor(this.maskRed,this.maskGreen,this.maskBlue,this.maskAlpha);this.shiftRed=m.shiftRed,this.shiftGreen=m.shiftGreen,this.shiftBlue=m.shiftBlue,this.shiftAlpha=m.shiftAlpha}parseRGBA(){switch(this.data=Buffer.alloc(this.width*this.height*4),this.bitPP){case 1:this.bit1();break;case 4:this.bit4();break;case 8:this.bit8();break;case 16:this.bit16();break;case 24:this.bit24();break;default:this.bit32()}}bit1(){const m=Math.ceil(this.width/8),g=m%4,w=g!==0?4-g:0;this.scanImage(w,m,(($,I)=>{const D=this.buffer.readUInt8(this.pos++),q=I*this.width*4+8*$*4;for(let j=0;j<8&&8*$+j<this.width;j++){const G=this.palette[D>>7-j&1];this.data[q+j*this.locAlpha]=0,this.data[q+4*j+this.locBlue]=G.blue,this.data[q+4*j+this.locGreen]=G.green,this.data[q+4*j+this.locRed]=G.red}}))}bit4(){if(this.compression===BmpCompression.BI_RLE4){this.data.fill(0);let m=!1,g=this.bottomUp?this.height-1:0,w=0;for(;w<this.data.length;){const $=this.buffer.readUInt8(this.pos++),I=this.buffer.readUInt8(this.pos++);if($===0){if(I===0){g+=this.bottomUp?-1:1,w=g*this.width*4,m=!1;continue}if(I===1)break;if(I===2){const D=this.buffer.readUInt8(this.pos++),q=this.buffer.readUInt8(this.pos++);g+=this.bottomUp?-q:q,w+=q*this.width*4+4*D}else{let D=this.buffer.readUInt8(this.pos++);for(let q=0;q<I;q++)w=this.setPixelData(w,m?15&D:(240&D)>>4),1&q&&q+1<I&&(D=this.buffer.readUInt8(this.pos++)),m=!m;(I+1>>1&1)==1&&this.pos++}}else for(let D=0;D<$;D++)w=this.setPixelData(w,m?15&I:(240&I)>>4),m=!m}}else{const m=Math.ceil(this.width/2),g=m%4,w=g!==0?4-g:0;this.scanImage(w,m,(($,I)=>{const D=this.buffer.readUInt8(this.pos++),q=I*this.width*4+2*$*4,j=D>>4;let G=this.palette[j];if(this.data[q]=0,this.data[q+1]=G.blue,this.data[q+2]=G.green,this.data[q+3]=G.red,2*$+1>=this.width)return!1;const H=15&D;G=this.palette[H],this.data[q+4]=0,this.data[q+4+1]=G.blue,this.data[q+4+2]=G.green,this.data[q+4+3]=G.red}))}}bit8(){if(this.compression===BmpCompression.BI_RLE8){this.data.fill(0);let m=this.bottomUp?this.height-1:0,g=0;for(;g<this.data.length;){const w=this.buffer.readUInt8(this.pos++),$=this.buffer.readUInt8(this.pos++);if(w===0){if($===0){m+=this.bottomUp?-1:1,g=m*this.width*4;continue}if($===1)break;if($===2){const I=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++);m+=this.bottomUp?-D:D,g+=D*this.width*4+4*I}else{for(let I=0;I<$;I++){const D=this.buffer.readUInt8(this.pos++);g=this.setPixelData(g,D)}!0&$&&this.pos++}}else for(let I=0;I<w;I++)g=this.setPixelData(g,$)}}else{const m=this.width%4,g=m!==0?4-m:0;this.scanImage(g,this.width,((w,$)=>{const I=this.buffer.readUInt8(this.pos++),D=$*this.width*4+4*w;if(I<this.palette.length){const q=this.palette[I];this.data[D]=0,this.data[D+1]=q.blue,this.data[D+2]=q.green,this.data[D+3]=q.red}else this.data[D]=0,this.data[D+1]=255,this.data[D+2]=255,this.data[D+3]=255}))}}bit16(){const m=this.width%2*2;this.scanImage(m,this.width,((g,w)=>{const $=w*this.width*4+4*g,I=this.buffer.readUInt16LE(this.pos);this.pos+=2,this.data[$+this.locRed]=this.shiftRed(I),this.data[$+this.locGreen]=this.shiftGreen(I),this.data[$+this.locBlue]=this.shiftBlue(I),this.data[$+this.locAlpha]=this.shiftAlpha(I)}))}bit24(){const m=this.width%4;this.scanImage(m,this.width,((g,w)=>{const $=w*this.width*4+4*g,I=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++),q=this.buffer.readUInt8(this.pos++);this.data[$+this.locRed]=q,this.data[$+this.locGreen]=D,this.data[$+this.locBlue]=I,this.data[$+this.locAlpha]=0}))}bit32(){this.scanImage(0,this.width,((m,g)=>{const w=g*this.width*4+4*m,$=this.readUInt32LE();this.data[w+this.locRed]=this.shiftRed($),this.data[w+this.locGreen]=this.shiftGreen($),this.data[w+this.locBlue]=this.shiftBlue($),this.data[w+this.locAlpha]=this.shiftAlpha($)}))}scanImage(m=0,g=this.width,w){for(let $=this.height-1;$>=0;$--){const I=this.bottomUp?$:this.height-1-$;for(let D=0;D<g;D++)if(w.call(this,D,I)===!1)return;this.pos+=m}}readUInt32LE(){const m=this.buffer.readUInt32LE(this.pos);return this.pos+=4,m}setPixelData(m,g){const{blue:w,green:$,red:I}=this.palette[g];return this.data[m+this.locAlpha]=0,this.data[m+1+this.locBlue]=w,this.data[m+2+this.locGreen]=$,this.data[m+3+this.locRed]=I,m+4}}function createInteger(d){return d.reduce(((m,g)=>m<<1|g),0)}function createColor(d){return d.quad<<24|d.red<<16|d.green<<8|d.blue}class BmpEncoder{fileSize;reserved1;reserved2;offset;width;flag;height;planes;bitPP;compress;hr;vr;colors;importantColors;rawSize;headerSize;data;palette;extraBytes;buffer;bytesInColor;pos;constructor(m){switch(this.buffer=m.data,this.width=m.width,this.height=m.height,this.headerSize=HeaderTypes$1.BITMAP_INFO_HEADER,this.flag="BM",this.bitPP=m.bitPP||24,this.offset=54,this.reserved1=m.reserved1||0,this.reserved2=m.reserved2||0,this.planes=1,this.compress=0,this.hr=m.hr||0,this.vr=m.vr||0,this.importantColors=m.importantColors||0,this.colors=Math.min(2**(this.bitPP-1||1),m.colors||1/0),this.palette=m.palette||[],this.colors&&this.bitPP<16?this.offset+=4*this.colors:this.colors=0,this.bitPP){case 32:this.bytesInColor=4;break;case 16:this.bytesInColor=2;break;case 8:this.bytesInColor=1;break;case 4:this.bytesInColor=.5;break;case 1:this.bytesInColor=1/8;break;default:this.bytesInColor=3,this.bitPP=24}const g=this.width*this.bitPP/32,w=Math.ceil(g);this.extraBytes=4*(w-g),this.rawSize=this.height*w*4+2,this.fileSize=this.rawSize+this.offset,this.data=Buffer.alloc(this.fileSize,1),this.pos=0,this.encode()}encode(){switch(this.pos=0,this.writeHeader(),this.bitPP){case 32:this.bit32();break;case 16:this.bit16();break;case 8:this.bit8();break;case 4:this.bit4();break;case 1:this.bit1();break;default:this.bit24()}}writeHeader(){this.data.write(this.flag,this.pos,2),this.pos+=2,this.writeUInt32LE(this.fileSize),this.writeUInt32LE(this.reserved1<<16|this.reserved2),this.writeUInt32LE(this.offset),this.writeUInt32LE(this.headerSize),this.writeUInt32LE(this.width),this.writeUInt32LE(this.height),this.data.writeUInt16LE(this.planes,this.pos),this.pos+=2,this.data.writeUInt16LE(this.bitPP,this.pos),this.pos+=2,this.writeUInt32LE(this.compress),this.writeUInt32LE(this.rawSize),this.writeUInt32LE(this.hr),this.writeUInt32LE(this.vr),this.writeUInt32LE(this.colors),this.writeUInt32LE(this.importantColors)}bit1(){this.palette.length&&this.colors===2?this.initColors(1):(this.writeUInt32LE(16777215),this.writeUInt32LE(0)),this.pos+=1;let m=[];this.writeImage(((g,w,$)=>{let I=w;I++;const D=this.buffer[I++],q=this.buffer[I++],j=.2126*this.buffer[I++]+.7152*q+.0722*D;return m.push(j>127?0:1),($+1)%8==0?(this.data[g-1]=createInteger(m),m=[]):$===this.width-1&&m.length>0&&(this.data[g-1]=createInteger(m)<<4,m=[]),I}))}bit4(){const m=this.initColors(4);let g=[];this.writeImage(((w,$,I)=>{let D=$;const q=createColor({quad:this.buffer[D++],blue:this.buffer[D++],green:this.buffer[D++],red:this.buffer[D++]}),j=m.findIndex((G=>G===q));return j!==-1?g.push(j):g.push(0),(I+1)%2==0&&(this.data[w]=g[0]<<4|g[1],g=[]),D}))}bit8(){const m=this.initColors(8);this.writeImage(((g,w)=>{let $=w;const I=createColor({quad:this.buffer[$++],blue:this.buffer[$++],green:this.buffer[$++],red:this.buffer[$++]}),D=m.findIndex((q=>q===I));return this.data[g]=D!==-1?D:0,$}))}bit16(){this.writeImage(((m,g)=>{let w=g+1;const $=this.buffer[w++]/8,I=this.buffer[w++]/8,D=this.buffer[w++]/8<<10|I<<5|$;return this.data[m]=255&D,this.data[m+1]=(65280&D)>>8,w}))}bit24(){this.writeImage(((m,g)=>{let w=g+1;return this.data[m]=this.buffer[w++],this.data[m+1]=this.buffer[w++],this.data[m+2]=this.buffer[w++],w}))}bit32(){this.writeImage(((m,g)=>{let w=g;return this.data[m+3]=this.buffer[w++],this.data[m]=this.buffer[w++],this.data[m+1]=this.buffer[w++],this.data[m+2]=this.buffer[w++],w}))}writeImage(m){const g=this.extraBytes+this.width*this.bytesInColor;let w=0;for(let $=0;$<this.height;$++)for(let I=0;I<this.width;I++){const D=Math.floor(this.pos+(this.height-1-$)*g+I*this.bytesInColor);w=m.call(this,D,w,I,$)}}initColors(m){const g=[];if(!this.palette.length)throw new Error(`To encode ${m}-bit BMPs a pallette is needed. Please choose up to ${this.colors} colors. Colors must be 32-bit integers.`);for(let w=0;w<this.colors;w++){const $=createColor(this.palette[w]);this.writeUInt32LE($),g.push($)}return g}writeUInt32LE(m){this.data.writeUInt32LE(m,this.pos),this.pos+=4}}function decode$2(d,m){return new BmpDecoder(d,m)}function encode$2(d){return new BmpEncoder(d)}function _typeof(d){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},_typeof(d)}var trimLeft=/^\s+/,trimRight=/\s+$/;function tinycolor(d,m){if(m=m||{},(d=d||"")instanceof tinycolor)return d;if(!(this instanceof tinycolor))return new tinycolor(d,m);var g=inputToRGB(d);this._originalInput=d,this._r=g.r,this._g=g.g,this._b=g.b,this._a=g.a,this._roundA=Math.round(100*this._a)/100,this._format=m.format||g.format,this._gradientType=m.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=g.ok}function inputToRGB(d){var m={r:0,g:0,b:0},g=1,w=null,$=null,I=null,D=!1,q=!1;return typeof d=="string"&&(d=stringInputToObject(d)),_typeof(d)=="object"&&(isValidCSSUnit(d.r)&&isValidCSSUnit(d.g)&&isValidCSSUnit(d.b)?(m=rgbToRgb(d.r,d.g,d.b),D=!0,q=String(d.r).substr(-1)==="%"?"prgb":"rgb"):isValidCSSUnit(d.h)&&isValidCSSUnit(d.s)&&isValidCSSUnit(d.v)?(w=convertToPercentage(d.s),$=convertToPercentage(d.v),m=hsvToRgb(d.h,w,$),D=!0,q="hsv"):isValidCSSUnit(d.h)&&isValidCSSUnit(d.s)&&isValidCSSUnit(d.l)&&(w=convertToPercentage(d.s),I=convertToPercentage(d.l),m=hslToRgb(d.h,w,I),D=!0,q="hsl"),d.hasOwnProperty("a")&&(g=d.a)),g=boundAlpha(g),{ok:D,format:d.format||q,r:Math.min(255,Math.max(m.r,0)),g:Math.min(255,Math.max(m.g,0)),b:Math.min(255,Math.max(m.b,0)),a:g}}function rgbToRgb(d,m,g){return{r:255*bound01(d,255),g:255*bound01(m,255),b:255*bound01(g,255)}}function rgbToHsl(d,m,g){d=bound01(d,255),m=bound01(m,255),g=bound01(g,255);var w,$,I=Math.max(d,m,g),D=Math.min(d,m,g),q=(I+D)/2;if(I==D)w=$=0;else{var j=I-D;switch($=q>.5?j/(2-I-D):j/(I+D),I){case d:w=(m-g)/j+(m<g?6:0);break;case m:w=(g-d)/j+2;break;case g:w=(d-m)/j+4}w/=6}return{h:w,s:$,l:q}}function hslToRgb(d,m,g){var w,$,I;function D(G,H,W){return W<0&&(W+=1),W>1&&(W-=1),W<1/6?G+6*(H-G)*W:W<.5?H:W<2/3?G+(H-G)*(2/3-W)*6:G}if(d=bound01(d,360),m=bound01(m,100),g=bound01(g,100),m===0)w=$=I=g;else{var q=g<.5?g*(1+m):g+m-g*m,j=2*g-q;w=D(j,q,d+1/3),$=D(j,q,d),I=D(j,q,d-1/3)}return{r:255*w,g:255*$,b:255*I}}function rgbToHsv(d,m,g){d=bound01(d,255),m=bound01(m,255),g=bound01(g,255);var w,$,I=Math.max(d,m,g),D=Math.min(d,m,g),q=I,j=I-D;if($=I===0?0:j/I,I==D)w=0;else{switch(I){case d:w=(m-g)/j+(m<g?6:0);break;case m:w=(g-d)/j+2;break;case g:w=(d-m)/j+4}w/=6}return{h:w,s:$,v:q}}function hsvToRgb(d,m,g){d=6*bound01(d,360),m=bound01(m,100),g=bound01(g,100);var w=Math.floor(d),$=d-w,I=g*(1-m),D=g*(1-$*m),q=g*(1-(1-$)*m),j=w%6;return{r:255*[g,D,I,I,q,g][j],g:255*[q,g,g,D,I,I][j],b:255*[I,I,q,g,g,D][j]}}function rgbToHex(d,m,g,w){var $=[pad2(Math.round(d).toString(16)),pad2(Math.round(m).toString(16)),pad2(Math.round(g).toString(16))];return w&&$[0].charAt(0)==$[0].charAt(1)&&$[1].charAt(0)==$[1].charAt(1)&&$[2].charAt(0)==$[2].charAt(1)?$[0].charAt(0)+$[1].charAt(0)+$[2].charAt(0):$.join("")}function rgbaToHex(d,m,g,w,$){var I=[pad2(Math.round(d).toString(16)),pad2(Math.round(m).toString(16)),pad2(Math.round(g).toString(16)),pad2(convertDecimalToHex(w))];return $&&I[0].charAt(0)==I[0].charAt(1)&&I[1].charAt(0)==I[1].charAt(1)&&I[2].charAt(0)==I[2].charAt(1)&&I[3].charAt(0)==I[3].charAt(1)?I[0].charAt(0)+I[1].charAt(0)+I[2].charAt(0)+I[3].charAt(0):I.join("")}function rgbaToArgbHex(d,m,g,w){return[pad2(convertDecimalToHex(w)),pad2(Math.round(d).toString(16)),pad2(Math.round(m).toString(16)),pad2(Math.round(g).toString(16))].join("")}function _desaturate(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.s-=m/100,g.s=clamp01(g.s),tinycolor(g)}function _saturate(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.s+=m/100,g.s=clamp01(g.s),tinycolor(g)}function _greyscale(d){return tinycolor(d).desaturate(100)}function _lighten(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.l+=m/100,g.l=clamp01(g.l),tinycolor(g)}function _brighten(d,m){m=m===0?0:m||10;var g=tinycolor(d).toRgb();return g.r=Math.max(0,Math.min(255,g.r-Math.round(-m/100*255))),g.g=Math.max(0,Math.min(255,g.g-Math.round(-m/100*255))),g.b=Math.max(0,Math.min(255,g.b-Math.round(-m/100*255))),tinycolor(g)}function _darken(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.l-=m/100,g.l=clamp01(g.l),tinycolor(g)}function _spin(d,m){var g=tinycolor(d).toHsl(),w=(g.h+m)%360;return g.h=w<0?360+w:w,tinycolor(g)}function _complement(d){var m=tinycolor(d).toHsl();return m.h=(m.h+180)%360,tinycolor(m)}function polyad(d,m){if(isNaN(m)||m<=0)throw new Error("Argument to polyad must be a positive number");for(var g=tinycolor(d).toHsl(),w=[tinycolor(d)],$=360/m,I=1;I<m;I++)w.push(tinycolor({h:(g.h+I*$)%360,s:g.s,l:g.l}));return w}function _splitcomplement(d){var m=tinycolor(d).toHsl(),g=m.h;return[tinycolor(d),tinycolor({h:(g+72)%360,s:m.s,l:m.l}),tinycolor({h:(g+216)%360,s:m.s,l:m.l})]}function _analogous(d,m,g){m=m||6,g=g||30;var w=tinycolor(d).toHsl(),$=360/g,I=[tinycolor(d)];for(w.h=(w.h-($*m>>1)+720)%360;--m;)w.h=(w.h+$)%360,I.push(tinycolor(w));return I}function _monochromatic(d,m){m=m||6;for(var g=tinycolor(d).toHsv(),w=g.h,$=g.s,I=g.v,D=[],q=1/m;m--;)D.push(tinycolor({h:w,s:$,v:I})),I=(I+q)%1;return D}tinycolor.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var d=this.toRgb();return(299*d.r+587*d.g+114*d.b)/1e3},getLuminance:function(){var d,m,g,w=this.toRgb();return d=w.r/255,m=w.g/255,g=w.b/255,.2126*(d<=.03928?d/12.92:Math.pow((d+.055)/1.055,2.4))+.7152*(m<=.03928?m/12.92:Math.pow((m+.055)/1.055,2.4))+.0722*(g<=.03928?g/12.92:Math.pow((g+.055)/1.055,2.4))},setAlpha:function(d){return this._a=boundAlpha(d),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var d=rgbToHsv(this._r,this._g,this._b);return{h:360*d.h,s:d.s,v:d.v,a:this._a}},toHsvString:function(){var d=rgbToHsv(this._r,this._g,this._b),m=Math.round(360*d.h),g=Math.round(100*d.s),w=Math.round(100*d.v);return this._a==1?"hsv("+m+", "+g+"%, "+w+"%)":"hsva("+m+", "+g+"%, "+w+"%, "+this._roundA+")"},toHsl:function(){var d=rgbToHsl(this._r,this._g,this._b);return{h:360*d.h,s:d.s,l:d.l,a:this._a}},toHslString:function(){var d=rgbToHsl(this._r,this._g,this._b),m=Math.round(360*d.h),g=Math.round(100*d.s),w=Math.round(100*d.l);return this._a==1?"hsl("+m+", "+g+"%, "+w+"%)":"hsla("+m+", "+g+"%, "+w+"%, "+this._roundA+")"},toHex:function(d){return rgbToHex(this._r,this._g,this._b,d)},toHexString:function(d){return"#"+this.toHex(d)},toHex8:function(d){return rgbaToHex(this._r,this._g,this._b,this._a,d)},toHex8String:function(d){return"#"+this.toHex8(d)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*bound01(this._r,255))+"%",g:Math.round(100*bound01(this._g,255))+"%",b:Math.round(100*bound01(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(100*bound01(this._r,255))+"%, "+Math.round(100*bound01(this._g,255))+"%, "+Math.round(100*bound01(this._b,255))+"%)":"rgba("+Math.round(100*bound01(this._r,255))+"%, "+Math.round(100*bound01(this._g,255))+"%, "+Math.round(100*bound01(this._b,255))+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":!(this._a<1)&&(hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1)},toFilter:function(d){var m="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),g=m,w=this._gradientType?"GradientType = 1, ":"";if(d){var $=tinycolor(d);g="#"+rgbaToArgbHex($._r,$._g,$._b,$._a)}return"progid:DXImageTransform.Microsoft.gradient("+w+"startColorstr="+m+",endColorstr="+g+")"},toString:function(d){var m=!!d;d=d||this._format;var g=!1,w=this._a<1&&this._a>=0;return m||!w||d!=="hex"&&d!=="hex6"&&d!=="hex3"&&d!=="hex4"&&d!=="hex8"&&d!=="name"?(d==="rgb"&&(g=this.toRgbString()),d==="prgb"&&(g=this.toPercentageRgbString()),d!=="hex"&&d!=="hex6"||(g=this.toHexString()),d==="hex3"&&(g=this.toHexString(!0)),d==="hex4"&&(g=this.toHex8String(!0)),d==="hex8"&&(g=this.toHex8String()),d==="name"&&(g=this.toName()),d==="hsl"&&(g=this.toHslString()),d==="hsv"&&(g=this.toHsvString()),g||this.toHexString()):d==="name"&&this._a===0?this.toName():this.toRgbString()},clone:function(){return tinycolor(this.toString())},_applyModification:function(d,m){var g=d.apply(null,[this].concat([].slice.call(m)));return this._r=g._r,this._g=g._g,this._b=g._b,this.setAlpha(g._a),this},lighten:function(){return this._applyModification(_lighten,arguments)},brighten:function(){return this._applyModification(_brighten,arguments)},darken:function(){return this._applyModification(_darken,arguments)},desaturate:function(){return this._applyModification(_desaturate,arguments)},saturate:function(){return this._applyModification(_saturate,arguments)},greyscale:function(){return this._applyModification(_greyscale,arguments)},spin:function(){return this._applyModification(_spin,arguments)},_applyCombination:function(d,m){return d.apply(null,[this].concat([].slice.call(m)))},analogous:function(){return this._applyCombination(_analogous,arguments)},complement:function(){return this._applyCombination(_complement,arguments)},monochromatic:function(){return this._applyCombination(_monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(_splitcomplement,arguments)},triad:function(){return this._applyCombination(polyad,[3])},tetrad:function(){return this._applyCombination(polyad,[4])}},tinycolor.fromRatio=function(d,m){if(_typeof(d)=="object"){var g={};for(var w in d)d.hasOwnProperty(w)&&(g[w]=w==="a"?d[w]:convertToPercentage(d[w]));d=g}return tinycolor(d,m)},tinycolor.equals=function(d,m){return!(!d||!m)&&tinycolor(d).toRgbString()==tinycolor(m).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},tinycolor.mix=function(d,m,g){g=g===0?0:g||50;var w=tinycolor(d).toRgb(),$=tinycolor(m).toRgb(),I=g/100;return tinycolor({r:($.r-w.r)*I+w.r,g:($.g-w.g)*I+w.g,b:($.b-w.b)*I+w.b,a:($.a-w.a)*I+w.a})},tinycolor.readability=function(d,m){var g=tinycolor(d),w=tinycolor(m);return(Math.max(g.getLuminance(),w.getLuminance())+.05)/(Math.min(g.getLuminance(),w.getLuminance())+.05)},tinycolor.isReadable=function(d,m,g){var w,$,I=tinycolor.readability(d,m);switch($=!1,(w=validateWCAG2Parms(g)).level+w.size){case"AAsmall":case"AAAlarge":$=I>=4.5;break;case"AAlarge":$=I>=3;break;case"AAAsmall":$=I>=7}return $},tinycolor.mostReadable=function(d,m,g){var w,$,I,D,q=null,j=0;$=(g=g||{}).includeFallbackColors,I=g.level,D=g.size;for(var G=0;G<m.length;G++)(w=tinycolor.readability(d,m[G]))>j&&(j=w,q=tinycolor(m[G]));return tinycolor.isReadable(d,q,{level:I,size:D})||!$?q:(g.includeFallbackColors=!1,tinycolor.mostReadable(d,["#fff","#000"],g))};var names$1=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip(names$1);function flip(d){var m={};for(var g in d)d.hasOwnProperty(g)&&(m[d[g]]=g);return m}function boundAlpha(d){return d=parseFloat(d),(isNaN(d)||d<0||d>1)&&(d=1),d}function bound01(d,m){isOnePointZero(d)&&(d="100%");var g=isPercentage(d);return d=Math.min(m,Math.max(0,parseFloat(d))),g&&(d=parseInt(d*m,10)/100),Math.abs(d-m)<1e-6?1:d%m/parseFloat(m)}function clamp01(d){return Math.min(1,Math.max(0,d))}function parseIntFromHex(d){return parseInt(d,16)}function isOnePointZero(d){return typeof d=="string"&&d.indexOf(".")!=-1&&parseFloat(d)===1}function isPercentage(d){return typeof d=="string"&&d.indexOf("%")!=-1}function pad2(d){return d.length==1?"0"+d:""+d}function convertToPercentage(d){return d<=1&&(d=100*d+"%"),d}function convertDecimalToHex(d){return Math.round(255*parseFloat(d)).toString(16)}function convertHexToDecimal(d){return parseIntFromHex(d)/255}var matchers=(CSS_UNIT="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",{CSS_UNIT:new RegExp(CSS_UNIT),rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}),CSS_UNIT,PERMISSIVE_MATCH3,PERMISSIVE_MATCH4;function isValidCSSUnit(d){return!!matchers.CSS_UNIT.exec(d)}function stringInputToObject(d){d=d.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var m,g=!1;if(names$1[d])d=names$1[d],g=!0;else if(d=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};return(m=matchers.rgb.exec(d))?{r:m[1],g:m[2],b:m[3]}:(m=matchers.rgba.exec(d))?{r:m[1],g:m[2],b:m[3],a:m[4]}:(m=matchers.hsl.exec(d))?{h:m[1],s:m[2],l:m[3]}:(m=matchers.hsla.exec(d))?{h:m[1],s:m[2],l:m[3],a:m[4]}:(m=matchers.hsv.exec(d))?{h:m[1],s:m[2],v:m[3]}:(m=matchers.hsva.exec(d))?{h:m[1],s:m[2],v:m[3],a:m[4]}:(m=matchers.hex8.exec(d))?{r:parseIntFromHex(m[1]),g:parseIntFromHex(m[2]),b:parseIntFromHex(m[3]),a:convertHexToDecimal(m[4]),format:g?"name":"hex8"}:(m=matchers.hex6.exec(d))?{r:parseIntFromHex(m[1]),g:parseIntFromHex(m[2]),b:parseIntFromHex(m[3]),format:g?"name":"hex"}:(m=matchers.hex4.exec(d))?{r:parseIntFromHex(m[1]+""+m[1]),g:parseIntFromHex(m[2]+""+m[2]),b:parseIntFromHex(m[3]+""+m[3]),a:convertHexToDecimal(m[4]+""+m[4]),format:g?"name":"hex8"}:!!(m=matchers.hex3.exec(d))&&{r:parseIntFromHex(m[1]+""+m[1]),g:parseIntFromHex(m[2]+""+m[2]),b:parseIntFromHex(m[3]+""+m[3]),format:g?"name":"hex"}}function validateWCAG2Parms(d){var m,g;return(m=((d=d||{level:"AA",size:"small"}).level||"AA").toUpperCase())!=="AA"&&m!=="AAA"&&(m="AA"),(g=(d.size||"small").toLowerCase())!=="small"&&g!=="large"&&(g="small"),{level:m,size:g}}function clone(d){const m={width:d.bitmap.width,height:d.bitmap.height,data:Buffer.from(d.bitmap.data)};return new d.constructor(m)}function scan(d,m,g,w,$,I){let D,q,j,G,H;if(typeof m=="function")H=m,D=0,q=0,j=d.bitmap.width,G=d.bitmap.height;else{if(D=m,typeof g!="number")throw new Error("y must be a number");if(q=g,typeof w!="number")throw new Error("w must be a number");if(j=w,typeof $!="number")throw new Error("h must be a number");if(G=$,typeof I!="function")throw new Error("cb must be a function");H=I}D=Math.round(D),q=Math.round(q),j=Math.round(j),G=Math.round(G);const W=H.bind(d);for(let V=q;V<q+G;V++)for(let K=D;K<D+j;K++)W(K,V,d.bitmap.width*V+K<<2);return d}function*scanIterator(d,m,g,w,$){m=Math.round(m),g=Math.round(g),w=Math.round(w),$=Math.round($);for(let I=g;I<g+$;I++)for(let D=m;D<m+w;D++){const q=d.bitmap.width*I+D<<2;yield{x:D,y:I,idx:q,image:d}}}function intToRGBA$1(d){if(typeof d!="number")throw new Error("i must be a number");const m={r:0,g:0,b:0,a:0};return m.r=Math.floor(d/Math.pow(256,3)),m.g=Math.floor((d-m.r*Math.pow(256,3))/Math.pow(256,2)),m.b=Math.floor((d-m.r*Math.pow(256,3)-m.g*Math.pow(256,2))/Math.pow(256,1)),m.a=Math.floor((d-m.r*Math.pow(256,3)-m.g*Math.pow(256,2)-m.b*Math.pow(256,1))/Math.pow(256,0)),m}function colorDiff(d,m){const g=D=>Math.pow(D,2),{max:w}=Math,$="a"in d?d.a:255,I="a"in m?m.a:255;return(w(g(d.r-m.r),g(d.r-m.r-$+I))+w(g(d.g-m.g),g(d.g-m.g-$+I))+w(g(d.b-m.b),g(d.b-m.b-$+I)))/195075}function limit255(d){return d=Math.max(d,0),d=Math.min(d,255)}function cssColorToHex(d){return typeof d=="number"?d:parseInt(tinycolor(d).toHex8(),16)}function encode$1(d,m={}){return scan({bitmap:d},0,0,d.width,d.height,(function(g,w,$){const I=d.data[$+0],D=d.data[$+1],q=d.data[$+2],j=d.data[$+3];d.data[$+0]=j,d.data[$+1]=q,d.data[$+2]=D,d.data[$+3]=I})),encode$2({...d,...m}).data}function decode$1(d,m){const g=decode$2(d,m);return scan({bitmap:g},0,0,g.width,g.height,(function(w,$,I){const D=g.data[I+1],q=g.data[I+2],j=g.data[I+3];g.data[I+0]=j,g.data[I+1]=q,g.data[I+2]=D,g.data[I+3]=255})),g}function msBmp(){return{mime:"image/x-ms-bmp",encode:encode$1,decode:decode$1}}function bmp(){return{mime:"image/bmp",encode:encode$1,decode:decode$1}}var omggif={},GifReader_1,GifWriter_1;function GifWriter(d,m,g,w){var $=0,I=(w=w===void 0?{}:w).loop===void 0?null:w.loop,D=w.palette===void 0?null:w.palette;if(m<=0||g<=0||m>65535||g>65535)throw new Error("Width/Height invalid.");function q(Q){var J=Q.length;if(J<2||J>256||J&J-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return J}d[$++]=71,d[$++]=73,d[$++]=70,d[$++]=56,d[$++]=57,d[$++]=97;var j=0,G=0;if(D!==null){for(var H=q(D);H>>=1;)++j;if(H=1<<j,--j,w.background!==void 0){if((G=w.background)>=H)throw new Error("Background index out of range.");if(G===0)throw new Error("Background index explicitly passed as 0.")}}if(d[$++]=255&m,d[$++]=m>>8&255,d[$++]=255&g,d[$++]=g>>8&255,d[$++]=(D!==null?128:0)|j,d[$++]=G,d[$++]=0,D!==null)for(var W=0,V=D.length;W<V;++W){var K=D[W];d[$++]=K>>16&255,d[$++]=K>>8&255,d[$++]=255&K}if(I!==null){if(I<0||I>65535)throw new Error("Loop count invalid.");d[$++]=33,d[$++]=255,d[$++]=11,d[$++]=78,d[$++]=69,d[$++]=84,d[$++]=83,d[$++]=67,d[$++]=65,d[$++]=80,d[$++]=69,d[$++]=50,d[$++]=46,d[$++]=48,d[$++]=3,d[$++]=1,d[$++]=255&I,d[$++]=I>>8&255,d[$++]=0}var Z=!1;this.addFrame=function(Q,J,re,se,oe,ee){if(Z===!0&&(--$,Z=!1),ee=ee===void 0?{}:ee,Q<0||J<0||Q>65535||J>65535)throw new Error("x/y invalid.");if(re<=0||se<=0||re>65535||se>65535)throw new Error("Width/Height invalid.");if(oe.length<re*se)throw new Error("Not enough pixels for the frame size.");var ae=!0,ce=ee.palette;if(ce==null&&(ae=!1,ce=D),ce==null)throw new Error("Must supply either a local or global palette.");for(var le=q(ce),de=0;le>>=1;)++de;le=1<<de;var _e=ee.delay===void 0?0:ee.delay,we=ee.disposal===void 0?0:ee.disposal;if(we<0||we>3)throw new Error("Disposal out of range.");var pe=!1,xe=0;if(ee.transparent!==void 0&&ee.transparent!==null&&(pe=!0,(xe=ee.transparent)<0||xe>=le))throw new Error("Transparent color index.");if((we!==0||pe||_e!==0)&&(d[$++]=33,d[$++]=249,d[$++]=4,d[$++]=we<<2|(pe===!0?1:0),d[$++]=255&_e,d[$++]=_e>>8&255,d[$++]=xe,d[$++]=0),d[$++]=44,d[$++]=255&Q,d[$++]=Q>>8&255,d[$++]=255&J,d[$++]=J>>8&255,d[$++]=255&re,d[$++]=re>>8&255,d[$++]=255&se,d[$++]=se>>8&255,d[$++]=ae===!0?128|de-1:0,ae===!0)for(var Ge=0,Te=ce.length;Ge<Te;++Ge){var Ce=ce[Ge];d[$++]=Ce>>16&255,d[$++]=Ce>>8&255,d[$++]=255&Ce}return $=GifWriterOutputLZWCodeStream(d,$,de<2?2:de,oe)},this.end=function(){return Z===!1&&(d[$++]=59,Z=!0),$},this.getOutputBuffer=function(){return d},this.setOutputBuffer=function(Q){d=Q},this.getOutputBufferPosition=function(){return $},this.setOutputBufferPosition=function(Q){$=Q}}function GifWriterOutputLZWCodeStream(d,m,g,w){d[m++]=g;var $=m++,I=1<<g,D=I-1,q=I+1,j=q+1,G=g+1,H=0,W=0;function V(ae){for(;H>=ae;)d[m++]=255&W,W>>=8,H-=8,m===$+256&&(d[$]=255,$=m++)}function K(ae){W|=ae<<H,H+=G,V(8)}var Z=w[0]&D,Q={};K(I);for(var J=1,re=w.length;J<re;++J){var se=w[J]&D,oe=Z<<8|se,ee=Q[oe];if(ee===void 0){for(W|=Z<<H,H+=G;H>=8;)d[m++]=255&W,W>>=8,H-=8,m===$+256&&(d[$]=255,$=m++);j===4096?(K(I),j=q+1,G=g+1,Q={}):(j>=1<<G&&++G,Q[oe]=j++),Z=se}else Z=ee}return K(Z),K(q),V(1),$+1===m?d[$]=0:(d[$]=m-$-1,d[m++]=0),m}function GifReader(d){var m=0;if(d[m++]!==71||d[m++]!==73||d[m++]!==70||d[m++]!==56||(d[m++]+1&253)!=56||d[m++]!==97)throw new Error("Invalid GIF 87a/89a header.");var g=d[m++]|d[m++]<<8,w=d[m++]|d[m++]<<8,$=d[m++],I=$>>7,D=1<<(7&$)+1;d[m++],d[m++];var q=null,j=null;I&&(q=m,j=D,m+=3*D);var G=!0,H=[],W=0,V=null,K=0,Z=null;for(this.width=g,this.height=w;G&&m<d.length;)switch(d[m++]){case 33:switch(d[m++]){case 255:if(d[m]!==11||d[m+1]==78&&d[m+2]==69&&d[m+3]==84&&d[m+4]==83&&d[m+5]==67&&d[m+6]==65&&d[m+7]==80&&d[m+8]==69&&d[m+9]==50&&d[m+10]==46&&d[m+11]==48&&d[m+12]==3&&d[m+13]==1&&d[m+16]==0)m+=14,Z=d[m++]|d[m++]<<8,m++;else for(m+=12;;){if(!((pe=d[m++])>=0))throw Error("Invalid block size");if(pe===0)break;m+=pe}break;case 249:if(d[m++]!==4||d[m+4]!==0)throw new Error("Invalid graphics extension block.");var Q=d[m++];W=d[m++]|d[m++]<<8,V=d[m++],1&Q||(V=null),K=Q>>2&7,m++;break;case 254:for(;;){if(!((pe=d[m++])>=0))throw Error("Invalid block size");if(pe===0)break;m+=pe}break;default:throw new Error("Unknown graphic control label: 0x"+d[m-1].toString(16))}break;case 44:var J=d[m++]|d[m++]<<8,re=d[m++]|d[m++]<<8,se=d[m++]|d[m++]<<8,oe=d[m++]|d[m++]<<8,ee=d[m++],ae=ee>>6&1,ce=1<<(7&ee)+1,le=q,de=j,_e=!1;ee>>7&&(_e=!0,le=m,de=ce,m+=3*ce);var we=m;for(m++;;){var pe;if(!((pe=d[m++])>=0))throw Error("Invalid block size");if(pe===0)break;m+=pe}H.push({x:J,y:re,width:se,height:oe,has_local_palette:_e,palette_offset:le,palette_size:de,data_offset:we,data_length:m-we,transparent_index:V,interlaced:!!ae,delay:W,disposal:K});break;case 59:G=!1;break;default:throw new Error("Unknown gif block: 0x"+d[m-1].toString(16))}this.numFrames=function(){return H.length},this.loopCount=function(){return Z},this.frameInfo=function(xe){if(xe<0||xe>=H.length)throw new Error("Frame index out of range.");return H[xe]},this.decodeAndBlitFrameBGRA=function(xe,Ge){var Te=this.frameInfo(xe),Ce=Te.width*Te.height,Oe=new Uint8Array(Ce);GifReaderLZWOutputIndexStream(d,Te.data_offset,Oe,Ce);var bt=Te.palette_offset,Mt=Te.transparent_index;Mt===null&&(Mt=256);var lt=Te.width,ir=g-lt,Ye=lt,xt=4*(Te.y*g+Te.x),ar=4*((Te.y+Te.height)*g+Te.x),ht=xt,gt=4*ir;Te.interlaced===!0&&(gt+=4*g*7);for(var zt=8,ur=0,dr=Oe.length;ur<dr;++ur){var fr=Oe[ur];if(Ye===0&&(Ye=lt,(ht+=gt)>=ar&&(gt=4*ir+4*g*(zt-1),ht=xt+(lt+ir)*(zt<<1),zt>>=1)),fr===Mt)ht+=4;else{var Ft=d[bt+3*fr],$e=d[bt+3*fr+1],Bt=d[bt+3*fr+2];Ge[ht++]=Bt,Ge[ht++]=$e,Ge[ht++]=Ft,Ge[ht++]=255}--Ye}},this.decodeAndBlitFrameRGBA=function(xe,Ge){var Te=this.frameInfo(xe),Ce=Te.width*Te.height,Oe=new Uint8Array(Ce);GifReaderLZWOutputIndexStream(d,Te.data_offset,Oe,Ce);var bt=Te.palette_offset,Mt=Te.transparent_index;Mt===null&&(Mt=256);var lt=Te.width,ir=g-lt,Ye=lt,xt=4*(Te.y*g+Te.x),ar=4*((Te.y+Te.height)*g+Te.x),ht=xt,gt=4*ir;Te.interlaced===!0&&(gt+=4*g*7);for(var zt=8,ur=0,dr=Oe.length;ur<dr;++ur){var fr=Oe[ur];if(Ye===0&&(Ye=lt,(ht+=gt)>=ar&&(gt=4*ir+4*g*(zt-1),ht=xt+(lt+ir)*(zt<<1),zt>>=1)),fr===Mt)ht+=4;else{var Ft=d[bt+3*fr],$e=d[bt+3*fr+1],Bt=d[bt+3*fr+2];Ge[ht++]=Ft,Ge[ht++]=$e,Ge[ht++]=Bt,Ge[ht++]=255}--Ye}}}function GifReaderLZWOutputIndexStream(d,m,g,w){for(var $=d[m++],I=1<<$,D=I+1,q=D+1,j=$+1,G=(1<<j)-1,H=0,W=0,V=0,K=d[m++],Z=new Int32Array(4096),Q=null;;){for(;H<16&&K!==0;)W|=d[m++]<<H,H+=8,K===1?K=d[m++]:--K;if(H<j)break;var J=W&G;if(W>>=j,H-=j,J!==I){if(J===D)break;for(var re=J<q?J:Q,se=0,oe=re;oe>I;)oe=Z[oe]>>8,++se;var ee=oe;if(V+se+(re!==J?1:0)>w)return void console.log("Warning, gif stream longer than expected.");g[V++]=ee;var ae=V+=se;for(re!==J&&(g[V++]=ee),oe=re;se--;)oe=Z[oe],g[--ae]=255&oe,oe>>=8;Q!==null&&q<4096&&(Z[q++]=Q<<8|ee,q>=G+1&&j<12&&(++j,G=G<<1|1)),Q=J}else q=D+1,G=(1<<(j=$+1))-1,Q=null}return V!==w&&console.log("Warning, gif stream shorter than expected."),g}try{GifWriter_1=omggif.GifWriter=GifWriter,GifReader_1=omggif.GifReader=GifReader}catch{}let BitmapImage$2=class Uo{constructor(...m){if(m.length===0)throw new Error("constructor requires parameters");const g=m[0];if(g!==null&&typeof g=="object")if(g instanceof Uo){const w=g.bitmap;this.bitmap={width:w.width,height:w.height,data:new Buffer(w.width*w.height*4)},w.data.copy(this.bitmap.data)}else{if(!(g.width&&g.height&&g.data))throw new Error("unrecognized constructor parameters");this.bitmap=g}else{if(typeof g!="number"||typeof m[1]!="number")throw new Error("unrecognized constructor parameters");{const w=g,$=m[1],I=m[2];this.bitmap={width:w,height:$},Buffer.isBuffer(I)?this.bitmap.data=I:(this.bitmap.data=new Buffer(w*$*4),typeof I=="number"&&this.fillRGBA(I))}}}blit(m,g,w,$,I,D,q){if($+D>this.bitmap.width)throw new Error("copy exceeds width of source bitmap");if(g+D>m.bitmap.width)throw new Error("copy exceeds width of target bitmap");if(I+q>this.bitmap.height)throw new Error("copy exceeds height of source bitmap");if(w+q>m.bitmap.height)throw new Erro("copy exceeds height of target bitmap");const j=this.bitmap.data,G=m.bitmap.data,H=4*this.bitmap.width,W=4*m.bitmap.width,V=4*D;let K=I*H+4*$,Z=w*W+4*g;for(;--q>=0;)j.copy(G,Z,K,K+V),K+=H,Z+=W;return this}fillRGBA(m){const g=this.bitmap.data,w=4*this.bitmap.height;let $=0;for(;$<w;)g.writeUInt32BE(m,$),$+=4;for(;$<g.length;)g.copy(g,$,0,w),$+=w;return this}getRGBA(m,g){const w=4*(g*this.bitmap.width+m);return this.bitmap.data.readUInt32BE(w)}getRGBASet(){const m=new Set,g=this.bitmap.data;for(let w=0;w<g.length;w+=4)m.add(g.readUInt32BE(w,!0));return m}greyscale(){const m=this.bitmap.data;return this.scan(0,0,this.bitmap.width,this.bitmap.height,((g,w,$)=>{const I=Math.round(.299*m[$]+.587*m[$+1]+.114*m[$+2]);m[$]=I,m[$+1]=I,m[$+2]=I})),this}reframe(m,g,w,$,I){const D=m<0?0:m,q=g<0?0:g,j=w+D>this.bitmap.width?this.bitmap.width-D:w,G=$+q>this.bitmap.height?this.bitmap.height-q:$,H=m<0?-m:0,W=g<0?-g:0;let V;if(I===void 0){if(D!==m||q!=g||j!==w||G!==$)throw new GifError("fillRGBA required for this reframing");V=new Uo(w,$)}else V=new Uo(w,$,I);return this.blit(V,H,W,D,q,j,G),this.bitmap=V.bitmap,this}scale(m){if(m===1)return;if(!Number.isInteger(m)||m<1)throw new Error("the scale must be an integer >= 1");const g=this.bitmap.width,w=this.bitmap.height,$=g*m*4,I=this.bitmap.data,D=new Buffer(w*$*m);let q,j=0,G=0;for(let H=0;H<w;++H){q=G;for(let W=0;W<g;++W){const V=I.readUInt32BE(j,!0);for(let K=0;K<m;++K)D.writeUInt32BE(V,G),G+=4;j+=4}for(let W=1;W<m;++W)D.copy(D,G,q,G),G+=$,q+=$}return this.bitmap={width:g*m,height:w*m,data:D},this}scanAllCoords(m){const g=this.bitmap.width,w=this.bitmap.data.length;let $=0,I=0;for(let D=0;D<w;D+=4)m($,I,D),++$===g&&($=0,++I)}scanAllIndexes(m){const g=this.bitmap.data.length;for(let w=0;w<g;w+=4)m(w)}};var bitmapimage=BitmapImage$2,gif$1={};let Gif$1=class{constructor(d,m,g){this.width=g.width,this.height=g.height,this.loops=g.loops,this.usesTransparency=g.usesTransparency,this.colorScope=g.colorScope,this.frames=m,this.buffer=d}};Gif$1.GlobalColorsPreferred=0,Gif$1.GlobalColorsOnly=1,Gif$1.LocalColorsOnly=2;let GifError$2=class extends Error{constructor(d){super(d),d instanceof Error&&(this.stack="Gif"+d.stack)}};gif$1.Gif=Gif$1,gif$1.GifError=GifError$2;var gifcodec={},gifutil={},_polyfillNode_fs={},_polyfillNode_fs$1=Object.freeze({__proto__:null,default:_polyfillNode_fs}),require$$0=getAugmentedNamespace(_polyfillNode_fs$1),__defProp$3=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__defNormalProp$3=(d,m,g)=>m in d?__defProp$3(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__markAsModule=d=>__defProp$3(d,"__esModule",{value:!0}),__export$1=(d,m)=>{for(var g in m)__defProp$3(d,g,{get:m[g],enumerable:!0})},__reExport=(d,m,g,w)=>{if(m&&typeof m=="object"||typeof m=="function")for(let $ of __getOwnPropNames(m))!__hasOwnProp.call(d,$)&&g&&__defProp$3(d,$,{get:()=>m[$],enumerable:!(w=__getOwnPropDesc(m,$))||w.enumerable});return d},__toCommonJS=(d=>(m,g)=>d&&d.get(m)||(g=__reExport(__markAsModule({}),m,1),d&&d.set(m,g),g))(typeof WeakMap<"u"?new WeakMap:0),__publicField$3=(d,m,g)=>(__defNormalProp$3(d,typeof m!="symbol"?m+"":m,g),g),src_exports={};__export$1(src_exports,{applyPalette:()=>applyPalette,applyPaletteSync:()=>applyPaletteSync$1,buildPalette:()=>buildPalette,buildPaletteSync:()=>buildPaletteSync$1,constants:()=>constants_exports$1,conversion:()=>conversion_exports$1,distance:()=>distance_exports$1,image:()=>image_exports$1,palette:()=>palette_exports$1,quality:()=>quality_exports$1,utils:()=>utils_exports$1});var constants_exports$1={};__export$1(constants_exports$1,{bt709:()=>bt709_exports$1});var bt709_exports$1={};__export$1(bt709_exports$1,{Y:()=>Y$1,x:()=>x$2,y:()=>y$2});var Y$1=(d=>(d[d.RED=.2126]="RED",d[d.GREEN=.7152]="GREEN",d[d.BLUE=.0722]="BLUE",d[d.WHITE=1]="WHITE",d))(Y$1||{}),x$2=(d=>(d[d.RED=.64]="RED",d[d.GREEN=.3]="GREEN",d[d.BLUE=.15]="BLUE",d[d.WHITE=.3127]="WHITE",d))(x$2||{}),y$2=(d=>(d[d.RED=.33]="RED",d[d.GREEN=.6]="GREEN",d[d.BLUE=.06]="BLUE",d[d.WHITE=.329]="WHITE",d))(y$2||{}),conversion_exports$1={};function correctGamma$1(d){return d>.04045?((d+.055)/1.055)**2.4:d/12.92}function rgb2xyz$1(d,m,g){return{x:.4124*(d=correctGamma$1(d/255))+.3576*(m=correctGamma$1(m/255))+.1805*(g=correctGamma$1(g/255)),y:.2126*d+.7152*m+.0722*g,z:.0193*d+.1192*m+.9505*g}}__export$1(conversion_exports$1,{lab2rgb:()=>lab2rgb$1,lab2xyz:()=>lab2xyz$1,rgb2hsl:()=>rgb2hsl$1,rgb2lab:()=>rgb2lab$1,rgb2xyz:()=>rgb2xyz$1,xyz2lab:()=>xyz2lab$1,xyz2rgb:()=>xyz2rgb$1});var arithmetic_exports$1={};function degrees2radians$1(d){return d*(Math.PI/180)}function max3$1(d,m,g){let w=d;return w<m&&(w=m),w<g&&(w=g),w}function min3$1(d,m,g){let w=d;return w>m&&(w=m),w>g&&(w=g),w}function intInRange$1(d,m,g){return d>g&&(d=g),d<m&&(d=m),0|d}function inRange0to255Rounded$1(d){return(d=Math.round(d))>255?d=255:d<0&&(d=0),d}function inRange0to255$1(d){return d>255?d=255:d<0&&(d=0),d}function stableSort$1(d,m){const g=typeof d[0];let w;if(g==="number"||g==="string"){const $=Object.create(null);for(let I=0,D=d.length;I<D;I++){const q=d[I];$[q]||$[q]===0||($[q]=I)}w=d.sort(((I,D)=>m(I,D)||$[I]-$[D]))}else{const $=d.slice(0);w=d.sort(((I,D)=>m(I,D)||$.indexOf(I)-$.indexOf(D)))}return w}function rgb2hsl$1(d,m,g){const w=min3$1(d,m,g),$=max3$1(d,m,g),I=$-w,D=(w+$)/510;let q=0;D>0&&D<1&&(q=I/(D<.5?$+w:510-$-w));let j=0;return I>0&&(j=$===d?(m-g)/I:$===m?2+(g-d)/I:4+(d-m)/I,j*=60,j<0&&(j+=360)),{h:j,s:q,l:D}}__export$1(arithmetic_exports$1,{degrees2radians:()=>degrees2radians$1,inRange0to255:()=>inRange0to255$1,inRange0to255Rounded:()=>inRange0to255Rounded$1,intInRange:()=>intInRange$1,max3:()=>max3$1,min3:()=>min3$1,stableSort:()=>stableSort$1});var refX$1=.95047,refY$1=1,refZ$1=1.08883;function pivot$1(d){return d>.008856?d**(1/3):7.787*d+16/116}function xyz2lab$1(d,m,g){if(d=pivot$1(d/refX$1),m=pivot$1(m/refY$1),g=pivot$1(g/refZ$1),116*m-16<0)throw new Error("xxx");return{L:Math.max(0,116*m-16),a:500*(d-m),b:200*(m-g)}}function rgb2lab$1(d,m,g){const w=rgb2xyz$1(d,m,g);return xyz2lab$1(w.x,w.y,w.z)}var refX2$1=.95047,refY2$1=1,refZ2$1=1.08883;function pivot2$1(d){return d>.206893034?d**3:(d-16/116)/7.787}function lab2xyz$1(d,m,g){const w=(d+16)/116,$=w-g/200;return{x:refX2$1*pivot2$1(m/500+w),y:refY2$1*pivot2$1(w),z:refZ2$1*pivot2$1($)}}function correctGamma2$1(d){return d>.0031308?1.055*d**(1/2.4)-.055:12.92*d}function xyz2rgb$1(d,m,g){const w=correctGamma2$1(3.2406*d+-1.5372*m+-.4986*g),$=correctGamma2$1(-.9689*d+1.8758*m+.0415*g),I=correctGamma2$1(.0557*d+-.204*m+1.057*g);return{r:inRange0to255Rounded$1(255*w),g:inRange0to255Rounded$1(255*$),b:inRange0to255Rounded$1(255*I)}}function lab2rgb$1(d,m,g){const w=lab2xyz$1(d,m,g);return xyz2rgb$1(w.x,w.y,w.z)}var distance_exports$1={};__export$1(distance_exports$1,{AbstractDistanceCalculator:()=>AbstractDistanceCalculator$1,AbstractEuclidean:()=>AbstractEuclidean$1,AbstractManhattan:()=>AbstractManhattan$1,CIE94GraphicArts:()=>CIE94GraphicArts$1,CIE94Textiles:()=>CIE94Textiles$1,CIEDE2000:()=>CIEDE2000$1,CMetric:()=>CMetric$1,Euclidean:()=>Euclidean$1,EuclideanBT709:()=>EuclideanBT709$1,EuclideanBT709NoAlpha:()=>EuclideanBT709NoAlpha$1,Manhattan:()=>Manhattan$1,ManhattanBT709:()=>ManhattanBT709$1,ManhattanNommyde:()=>ManhattanNommyde$1,PNGQuant:()=>PNGQuant$1});var AbstractDistanceCalculator$1=class{constructor(){__publicField$3(this,"_maxDistance"),__publicField$3(this,"_whitePoint"),this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(d,m,g,w){this._whitePoint={r:d>0?255/d:0,g:m>0?255/m:0,b:g>0?255/g:0,a:w>0?255/w:0},this._maxDistance=this.calculateRaw(d,m,g,w,0,0,0,0)}calculateNormalized(d,m){return this.calculateRaw(d.r,d.g,d.b,d.a,m.r,m.g,m.b,m.a)/this._maxDistance}},AbstractCIE94$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,q){const j=rgb2lab$1(inRange0to255$1(d*this._whitePoint.r),inRange0to255$1(m*this._whitePoint.g),inRange0to255$1(g*this._whitePoint.b)),G=rgb2lab$1(inRange0to255$1($*this._whitePoint.r),inRange0to255$1(I*this._whitePoint.g),inRange0to255$1(D*this._whitePoint.b)),H=j.L-G.L,W=j.a-G.a,V=j.b-G.b,K=Math.sqrt(j.a*j.a+j.b*j.b),Z=K-Math.sqrt(G.a*G.a+G.b*G.b);let Q=W*W+V*V-Z*Z;Q=Q<0?0:Math.sqrt(Q);const J=(q-w)*this._whitePoint.a*this._kA;return Math.sqrt((H/this._Kl)**2+(Z/(1+this._K1*K))**2+(Q/(1+this._K2*K))**2+J**2)}},CIE94Textiles$1=class extends AbstractCIE94$1{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=12.5/255}},CIE94GraphicArts$1=class extends AbstractCIE94$1{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=25/255}},_CIEDE2000$1=class extends AbstractDistanceCalculator$1{_setDefaults(){}static _calculatehp(d,m){const g=Math.atan2(d,m);return g>=0?g:g+_CIEDE2000$1._deg360InRad}static _calculateRT(d,m){const g=m**7,w=2*Math.sqrt(g/(g+_CIEDE2000$1._pow25to7)),$=_CIEDE2000$1._deg30InRad*Math.exp(-(((d-_CIEDE2000$1._deg275InRad)/_CIEDE2000$1._deg25InRad)**2));return-Math.sin(2*$)*w}static _calculateT(d){return 1-.17*Math.cos(d-_CIEDE2000$1._deg30InRad)+.24*Math.cos(2*d)+.32*Math.cos(3*d+_CIEDE2000$1._deg6InRad)-.2*Math.cos(4*d-_CIEDE2000$1._deg63InRad)}static _calculate_ahp(d,m,g,w){const $=g+w;return d===0?$:m<=_CIEDE2000$1._deg180InRad?$/2:$<_CIEDE2000$1._deg360InRad?($+_CIEDE2000$1._deg360InRad)/2:($-_CIEDE2000$1._deg360InRad)/2}static _calculate_dHp(d,m,g,w){let $;return $=d===0?0:m<=_CIEDE2000$1._deg180InRad?g-w:g<=w?g-w+_CIEDE2000$1._deg360InRad:g-w-_CIEDE2000$1._deg360InRad,2*Math.sqrt(d)*Math.sin($/2)}calculateRaw(d,m,g,w,$,I,D,q){const j=rgb2lab$1(inRange0to255$1(d*this._whitePoint.r),inRange0to255$1(m*this._whitePoint.g),inRange0to255$1(g*this._whitePoint.b)),G=rgb2lab$1(inRange0to255$1($*this._whitePoint.r),inRange0to255$1(I*this._whitePoint.g),inRange0to255$1(D*this._whitePoint.b)),H=(q-w)*this._whitePoint.a*_CIEDE2000$1._kA,W=this.calculateRawInLab(j,G);return Math.sqrt(W+H*H)}calculateRawInLab(d,m){const g=d.L,w=d.a,$=d.b,I=m.L,D=m.a,q=m.b,j=((Math.sqrt(w*w+$*$)+Math.sqrt(D*D+q*q))/2)**7,G=.5*(1-Math.sqrt(j/(j+_CIEDE2000$1._pow25to7))),H=(1+G)*w,W=(1+G)*D,V=Math.sqrt(H*H+$*$),K=Math.sqrt(W*W+q*q),Z=V*K,Q=_CIEDE2000$1._calculatehp($,H),J=_CIEDE2000$1._calculatehp(q,W),re=Math.abs(Q-J),se=I-g,oe=K-V,ee=_CIEDE2000$1._calculate_dHp(Z,re,J,Q),ae=_CIEDE2000$1._calculate_ahp(Z,re,Q,J),ce=(V+K)/2,le=((g+I)/2-50)**2,de=oe/(1+.045*ce),_e=ee/(1+.015*_CIEDE2000$1._calculateT(ae)*ce);return(se/(1+.015*le/Math.sqrt(20+le)))**2+de**2+_e**2+_CIEDE2000$1._calculateRT(ae,ce)*de*_e}},CIEDE2000$1=_CIEDE2000$1;__publicField$3(CIEDE2000$1,"_kA",25/255),__publicField$3(CIEDE2000$1,"_pow25to7",25**7),__publicField$3(CIEDE2000$1,"_deg360InRad",degrees2radians$1(360)),__publicField$3(CIEDE2000$1,"_deg180InRad",degrees2radians$1(180)),__publicField$3(CIEDE2000$1,"_deg30InRad",degrees2radians$1(30)),__publicField$3(CIEDE2000$1,"_deg6InRad",degrees2radians$1(6)),__publicField$3(CIEDE2000$1,"_deg63InRad",degrees2radians$1(63)),__publicField$3(CIEDE2000$1,"_deg275InRad",degrees2radians$1(275)),__publicField$3(CIEDE2000$1,"_deg25InRad",degrees2radians$1(25));var CMetric$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,q){const j=(d+$)/2*this._whitePoint.r,G=(d-$)*this._whitePoint.r,H=(m-I)*this._whitePoint.g,W=(g-D)*this._whitePoint.b,V=((512+j)*G*G>>8)+4*H*H+((767-j)*W*W>>8),K=(q-w)*this._whitePoint.a;return Math.sqrt(V+K*K)}_setDefaults(){}},AbstractEuclidean$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,q){const j=$-d,G=I-m,H=D-g,W=q-w;return Math.sqrt(this._kR*j*j+this._kG*G*G+this._kB*H*H+this._kA*W*W)}},Euclidean$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},EuclideanBT709$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},EuclideanBT709NoAlpha$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=0}},AbstractManhattan$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,q){let j=$-d,G=I-m,H=D-g,W=q-w;return j<0&&(j=0-j),G<0&&(G=0-G),H<0&&(H=0-H),W<0&&(W=0-W),this._kR*j+this._kG*G+this._kB*H+this._kA*W}},Manhattan$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},ManhattanNommyde$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}},ManhattanBT709$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},PNGQuant$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,q){const j=(q-w)*this._whitePoint.a;return this._colordifferenceCh(d*this._whitePoint.r,$*this._whitePoint.r,j)+this._colordifferenceCh(m*this._whitePoint.g,I*this._whitePoint.g,j)+this._colordifferenceCh(g*this._whitePoint.b,D*this._whitePoint.b,j)}_colordifferenceCh(d,m,g){const w=d-m,$=w+g;return w*w+$*$}_setDefaults(){}},palette_exports$1={};__export$1(palette_exports$1,{AbstractPaletteQuantizer:()=>AbstractPaletteQuantizer$1,ColorHistogram:()=>ColorHistogram$1,NeuQuant:()=>NeuQuant$1,NeuQuantFloat:()=>NeuQuantFloat$1,RGBQuant:()=>RGBQuant$1,WuColorCube:()=>WuColorCube$1,WuQuant:()=>WuQuant$1});var AbstractPaletteQuantizer$1=class{quantizeSync(){for(const d of this.quantize())if(d.palette)return d.palette;throw new Error("unreachable")}},Point$1=class{constructor(){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),__publicField$3(this,"uint32"),__publicField$3(this,"rgba"),this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}static createByQuadruplet(d){const m=new Point$1;return m.r=0|d[0],m.g=0|d[1],m.b=0|d[2],m.a=0|d[3],m._loadUINT32(),m._loadQuadruplet(),m}static createByRGBA(d,m,g,w){const $=new Point$1;return $.r=0|d,$.g=0|m,$.b=0|g,$.a=0|w,$._loadUINT32(),$._loadQuadruplet(),$}static createByUint32(d){const m=new Point$1;return m.uint32=d>>>0,m._loadRGBA(),m._loadQuadruplet(),m}from(d){this.r=d.r,this.g=d.g,this.b=d.b,this.a=d.a,this.uint32=d.uint32,this.rgba[0]=d.r,this.rgba[1]=d.g,this.rgba[2]=d.b,this.rgba[3]=d.a}getLuminosity(d){let m=this.r,g=this.g,w=this.b;return d&&(m=Math.min(255,255-this.a+this.a*m/255),g=Math.min(255,255-this.a+this.a*g/255),w=Math.min(255,255-this.a+this.a*w/255)),.2126*m+.7152*g+.0722*w}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=255&this.uint32,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}},PointContainer$1=class{constructor(){__publicField$3(this,"_pointArray"),__publicField$3(this,"_width"),__publicField$3(this,"_height"),this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(d){this._width=d}setHeight(d){this._height=d}getPointArray(){return this._pointArray}clone(){const d=new PointContainer$1;d._width=this._width,d._height=this._height;for(let m=0,g=this._pointArray.length;m<g;m++)d._pointArray[m]=Point$1.createByUint32(0|this._pointArray[m].uint32);return d}toUint32Array(){const d=this._pointArray.length,m=new Uint32Array(d);for(let g=0;g<d;g++)m[g]=this._pointArray[g].uint32;return m}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(d){const m=d.naturalWidth,g=d.naturalHeight,w=document.createElement("canvas");return w.width=m,w.height=g,w.getContext("2d").drawImage(d,0,0,m,g,0,0,m,g),PointContainer$1.fromHTMLCanvasElement(w)}static fromHTMLCanvasElement(d){const m=d.width,g=d.height,w=d.getContext("2d").getImageData(0,0,m,g);return PointContainer$1.fromImageData(w)}static fromImageData(d){const m=d.width,g=d.height;return PointContainer$1.fromUint8Array(d.data,m,g)}static fromUint8Array(d,m,g){switch(Object.prototype.toString.call(d)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:d=new Uint8Array(d)}const w=new Uint32Array(d.buffer);return PointContainer$1.fromUint32Array(w,m,g)}static fromUint32Array(d,m,g){const w=new PointContainer$1;w._width=m,w._height=g;for(let $=0,I=d.length;$<I;$++)w._pointArray[$]=Point$1.createByUint32(0|d[$]);return w}static fromBuffer(d,m,g){const w=new Uint32Array(d.buffer,d.byteOffset,d.byteLength/Uint32Array.BYTES_PER_ELEMENT);return PointContainer$1.fromUint32Array(w,m,g)}},hueGroups$1=10;function hueGroup$1(d,m){const g=360/m;for(let w=1,$=g-g/2;w<m;w++,$+=g)if(d>=$&&d<$+g)return w;return 0}var Palette$1=class{constructor(){__publicField$3(this,"_pointContainer"),__publicField$3(this,"_pointArray",[]),__publicField$3(this,"_i32idx",{}),this._pointContainer=new PointContainer$1,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(d){this._pointArray.push(d),this._pointContainer.setWidth(this._pointArray.length)}has(d){for(let m=this._pointArray.length-1;m>=0;m--)if(d.uint32===this._pointArray[m].uint32)return!0;return!1}getNearestColor(d,m){return this._pointArray[0|this._getNearestIndex(d,m)]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(d){return typeof this._i32idx[d]=="number"?this._i32idx[d]:-1}_getNearestIndex(d,m){let g=this._nearestPointFromCache(""+m.uint32);if(g>=0)return g;let w=Number.MAX_VALUE;g=0;for(let $=0,I=this._pointArray.length;$<I;$++){const D=this._pointArray[$],q=d.calculateRaw(m.r,m.g,m.b,m.a,D.r,D.g,D.b,D.a);q<w&&(w=q,g=$)}return this._i32idx[m.uint32]=g,g}sort(){this._i32idx={},this._pointArray.sort(((d,m)=>{const g=rgb2hsl$1(d.r,d.g,d.b),w=rgb2hsl$1(m.r,m.g,m.b),$=d.r===d.g&&d.g===d.b?0:1+hueGroup$1(g.h,hueGroups$1),I=(m.r===m.g&&m.g===m.b?0:1+hueGroup$1(w.h,hueGroups$1))-$;if(I)return-I;const D=d.getLuminosity(!0),q=m.getLuminosity(!0);if(q-D!=0)return q-D;const j=(100*w.s|0)-(100*g.s|0);return j?-j:0}))}},utils_exports$1={};__export$1(utils_exports$1,{HueStatistics:()=>HueStatistics$1,Palette:()=>Palette$1,Point:()=>Point$1,PointContainer:()=>PointContainer$1,ProgressTracker:()=>ProgressTracker$1,arithmetic:()=>arithmetic_exports$1});var HueGroup$1=class{constructor(){__publicField$3(this,"num",0),__publicField$3(this,"cols",[])}},HueStatistics$1=class{constructor(d,m){__publicField$3(this,"_numGroups"),__publicField$3(this,"_minCols"),__publicField$3(this,"_stats"),__publicField$3(this,"_groupsFull"),this._numGroups=d,this._minCols=m,this._stats=[];for(let g=0;g<=d;g++)this._stats[g]=new HueGroup$1;this._groupsFull=0}check(d){this._groupsFull===this._numGroups+1&&(this.check=()=>{});const m=255&d,g=d>>>8&255,w=d>>>16&255,$=m===g&&g===w?0:1+hueGroup$1(rgb2hsl$1(m,g,w).h,this._numGroups),I=this._stats[$],D=this._minCols;I.num++,I.num>D||(I.num===D&&this._groupsFull++,I.num<=D&&this._stats[$].cols.push(d))}injectIntoDictionary(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d[g]?d[g]++:d[g]=1}))}injectIntoArray(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d.indexOf(g)===-1&&d.push(g)}))}},_ProgressTracker$1=class{constructor(d,m){__publicField$3(this,"progress"),__publicField$3(this,"_step"),__publicField$3(this,"_range"),__publicField$3(this,"_last"),__publicField$3(this,"_progressRange"),this._range=d,this._progressRange=m,this._step=Math.max(1,this._range/(_ProgressTracker$1.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(d){return d-this._last>=this._step&&(this._last=d,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0)}},ProgressTracker$1=_ProgressTracker$1;__publicField$3(ProgressTracker$1,"steps",100);var networkBiasShift$1=3,Neuron$1=class{constructor(d){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point$1.createByRGBA(this.r>>networkBiasShift$1,this.g>>networkBiasShift$1,this.b>>networkBiasShift$1,this.a>>networkBiasShift$1)}subtract(d,m,g,w){this.r-=0|d,this.g-=0|m,this.b-=0|g,this.a-=0|w}},_NeuQuant$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256){super(),__publicField$3(this,"_pointArray"),__publicField$3(this,"_networkSize"),__publicField$3(this,"_network"),__publicField$3(this,"_sampleFactor"),__publicField$3(this,"_radPower"),__publicField$3(this,"_freq"),__publicField$3(this,"_bias"),__publicField$3(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift$1,255<<networkBiasShift$1,255<<networkBiasShift$1,255<<networkBiasShift$1)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new Neuron$1((d<<networkBiasShift$1+8)/this._networkSize|0),this._freq[d]=_NeuQuant$1._initialBias/this._networkSize|0,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuant$1._minpicturebytes&&(d=1);const g=30+(d-1)/3|0,w=m/d|0;let $,I=w/_NeuQuant$1._nCycles|0,D=_NeuQuant$1._initAlpha,q=(this._networkSize>>3)*_NeuQuant$1._radiusBias,j=q>>_NeuQuant$1._radiusBiasShift;j<=1&&(j=0);for(let H=0;H<j;H++)this._radPower[H]=D*((j*j-H*H)*_NeuQuant$1._radBias/(j*j))>>>0;$=m<_NeuQuant$1._minpicturebytes?1:m%_NeuQuant$1._prime1!=0?_NeuQuant$1._prime1:m%_NeuQuant$1._prime2!=0?_NeuQuant$1._prime2:m%_NeuQuant$1._prime3!=0?_NeuQuant$1._prime3:_NeuQuant$1._prime4;const G=new ProgressTracker$1(w,99);for(let H=0,W=0;H<w;){G.shouldNotify(H)&&(yield{progress:G.progress});const V=this._pointArray[W],K=V.b<<networkBiasShift$1,Z=V.g<<networkBiasShift$1,Q=V.r<<networkBiasShift$1,J=V.a<<networkBiasShift$1,re=this._contest(K,Z,Q,J);if(this._alterSingle(D,re,K,Z,Q,J),j!==0&&this._alterNeighbour(j,re,K,Z,Q,J),W+=$,W>=m&&(W-=m),H++,I===0&&(I=1),H%I==0){D-=D/g|0,q-=q/_NeuQuant$1._radiusDecrease|0,j=q>>_NeuQuant$1._radiusBiasShift,j<=1&&(j=0);for(let se=0;se<j;se++)this._radPower[se]=D*((j*j-se*se)*_NeuQuant$1._radBias/(j*j))>>>0}}}_buildPalette(){const d=new Palette$1;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let q=m+d;q>this._networkSize&&(q=this._networkSize);let j=m+1,G=m-1,H=1;for(;j<q||G>D;){const W=this._radPower[H++]/_NeuQuant$1._alphaRadBias;if(j<q){const V=this._network[j++];V.subtract(W*(V.r-$),W*(V.g-w),W*(V.b-g),W*(V.a-I))}if(G>D){const V=this._network[G--];V.subtract(W*(V.r-$),W*(V.g-w),W*(V.b-g),W*(V.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuant$1._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift$1;let I=2147483647,D=I,q=-1,j=q;for(let G=0;G<this._networkSize;G++){const H=this._network[G],W=this._distance.calculateNormalized(H,{r:g,g:m,b:d,a:w})*$|0;W<I&&(I=W,q=G);const V=W-(this._bias[G]>>_NeuQuant$1._initialBiasShift-networkBiasShift$1);V<D&&(D=V,j=G);const K=this._freq[G]>>_NeuQuant$1._betaShift;this._freq[G]-=K,this._bias[G]+=K<<_NeuQuant$1._gammaShift}return this._freq[q]+=_NeuQuant$1._beta,this._bias[q]-=_NeuQuant$1._betaGamma,j}},NeuQuant$1=_NeuQuant$1;__publicField$3(NeuQuant$1,"_prime1",499),__publicField$3(NeuQuant$1,"_prime2",491),__publicField$3(NeuQuant$1,"_prime3",487),__publicField$3(NeuQuant$1,"_prime4",503),__publicField$3(NeuQuant$1,"_minpicturebytes",_NeuQuant$1._prime4),__publicField$3(NeuQuant$1,"_nCycles",100),__publicField$3(NeuQuant$1,"_initialBiasShift",16),__publicField$3(NeuQuant$1,"_initialBias",1<<_NeuQuant$1._initialBiasShift),__publicField$3(NeuQuant$1,"_gammaShift",10),__publicField$3(NeuQuant$1,"_betaShift",10),__publicField$3(NeuQuant$1,"_beta",_NeuQuant$1._initialBias>>_NeuQuant$1._betaShift),__publicField$3(NeuQuant$1,"_betaGamma",_NeuQuant$1._initialBias<<_NeuQuant$1._gammaShift-_NeuQuant$1._betaShift),__publicField$3(NeuQuant$1,"_radiusBiasShift",6),__publicField$3(NeuQuant$1,"_radiusBias",1<<_NeuQuant$1._radiusBiasShift),__publicField$3(NeuQuant$1,"_radiusDecrease",30),__publicField$3(NeuQuant$1,"_alphaBiasShift",10),__publicField$3(NeuQuant$1,"_initAlpha",1<<_NeuQuant$1._alphaBiasShift),__publicField$3(NeuQuant$1,"_radBiasShift",8),__publicField$3(NeuQuant$1,"_radBias",1<<_NeuQuant$1._radBiasShift),__publicField$3(NeuQuant$1,"_alphaRadBiasShift",_NeuQuant$1._alphaBiasShift+_NeuQuant$1._radBiasShift),__publicField$3(NeuQuant$1,"_alphaRadBias",1<<_NeuQuant$1._alphaRadBiasShift);var networkBiasShift2$1=3,NeuronFloat$1=class{constructor(d){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point$1.createByRGBA(this.r>>networkBiasShift2$1,this.g>>networkBiasShift2$1,this.b>>networkBiasShift2$1,this.a>>networkBiasShift2$1)}subtract(d,m,g,w){this.r-=d,this.g-=m,this.b-=g,this.a-=w}},_NeuQuantFloat$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256){super(),__publicField$3(this,"_pointArray"),__publicField$3(this,"_networkSize"),__publicField$3(this,"_network"),__publicField$3(this,"_sampleFactor"),__publicField$3(this,"_radPower"),__publicField$3(this,"_freq"),__publicField$3(this,"_bias"),__publicField$3(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift2$1,255<<networkBiasShift2$1,255<<networkBiasShift2$1,255<<networkBiasShift2$1)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new NeuronFloat$1((d<<networkBiasShift2$1+8)/this._networkSize),this._freq[d]=_NeuQuantFloat$1._initialBias/this._networkSize,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuantFloat$1._minpicturebytes&&(d=1);const g=30+(d-1)/3,w=m/d;let $,I=w/_NeuQuantFloat$1._nCycles|0,D=_NeuQuantFloat$1._initAlpha,q=(this._networkSize>>3)*_NeuQuantFloat$1._radiusBias,j=q>>_NeuQuantFloat$1._radiusBiasShift;j<=1&&(j=0);for(let H=0;H<j;H++)this._radPower[H]=D*((j*j-H*H)*_NeuQuantFloat$1._radBias/(j*j));$=m<_NeuQuantFloat$1._minpicturebytes?1:m%_NeuQuantFloat$1._prime1!=0?_NeuQuantFloat$1._prime1:m%_NeuQuantFloat$1._prime2!=0?_NeuQuantFloat$1._prime2:m%_NeuQuantFloat$1._prime3!=0?_NeuQuantFloat$1._prime3:_NeuQuantFloat$1._prime4;const G=new ProgressTracker$1(w,99);for(let H=0,W=0;H<w;){G.shouldNotify(H)&&(yield{progress:G.progress});const V=this._pointArray[W],K=V.b<<networkBiasShift2$1,Z=V.g<<networkBiasShift2$1,Q=V.r<<networkBiasShift2$1,J=V.a<<networkBiasShift2$1,re=this._contest(K,Z,Q,J);if(this._alterSingle(D,re,K,Z,Q,J),j!==0&&this._alterNeighbour(j,re,K,Z,Q,J),W+=$,W>=m&&(W-=m),H++,I===0&&(I=1),H%I==0){D-=D/g,q-=q/_NeuQuantFloat$1._radiusDecrease,j=q>>_NeuQuantFloat$1._radiusBiasShift,j<=1&&(j=0);for(let se=0;se<j;se++)this._radPower[se]=D*((j*j-se*se)*_NeuQuantFloat$1._radBias/(j*j))}}}_buildPalette(){const d=new Palette$1;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let q=m+d;q>this._networkSize&&(q=this._networkSize);let j=m+1,G=m-1,H=1;for(;j<q||G>D;){const W=this._radPower[H++]/_NeuQuantFloat$1._alphaRadBias;if(j<q){const V=this._network[j++];V.subtract(W*(V.r-$),W*(V.g-w),W*(V.b-g),W*(V.a-I))}if(G>D){const V=this._network[G--];V.subtract(W*(V.r-$),W*(V.g-w),W*(V.b-g),W*(V.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuantFloat$1._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift2$1;let I=2147483647,D=I,q=-1,j=q;for(let G=0;G<this._networkSize;G++){const H=this._network[G],W=this._distance.calculateNormalized(H,{r:g,g:m,b:d,a:w})*$;W<I&&(I=W,q=G);const V=W-(this._bias[G]>>_NeuQuantFloat$1._initialBiasShift-networkBiasShift2$1);V<D&&(D=V,j=G);const K=this._freq[G]>>_NeuQuantFloat$1._betaShift;this._freq[G]-=K,this._bias[G]+=K<<_NeuQuantFloat$1._gammaShift}return this._freq[q]+=_NeuQuantFloat$1._beta,this._bias[q]-=_NeuQuantFloat$1._betaGamma,j}},NeuQuantFloat$1=_NeuQuantFloat$1;__publicField$3(NeuQuantFloat$1,"_prime1",499),__publicField$3(NeuQuantFloat$1,"_prime2",491),__publicField$3(NeuQuantFloat$1,"_prime3",487),__publicField$3(NeuQuantFloat$1,"_prime4",503),__publicField$3(NeuQuantFloat$1,"_minpicturebytes",_NeuQuantFloat$1._prime4),__publicField$3(NeuQuantFloat$1,"_nCycles",100),__publicField$3(NeuQuantFloat$1,"_initialBiasShift",16),__publicField$3(NeuQuantFloat$1,"_initialBias",1<<_NeuQuantFloat$1._initialBiasShift),__publicField$3(NeuQuantFloat$1,"_gammaShift",10),__publicField$3(NeuQuantFloat$1,"_betaShift",10),__publicField$3(NeuQuantFloat$1,"_beta",_NeuQuantFloat$1._initialBias>>_NeuQuantFloat$1._betaShift),__publicField$3(NeuQuantFloat$1,"_betaGamma",_NeuQuantFloat$1._initialBias<<_NeuQuantFloat$1._gammaShift-_NeuQuantFloat$1._betaShift),__publicField$3(NeuQuantFloat$1,"_radiusBiasShift",6),__publicField$3(NeuQuantFloat$1,"_radiusBias",1<<_NeuQuantFloat$1._radiusBiasShift),__publicField$3(NeuQuantFloat$1,"_radiusDecrease",30),__publicField$3(NeuQuantFloat$1,"_alphaBiasShift",10),__publicField$3(NeuQuantFloat$1,"_initAlpha",1<<_NeuQuantFloat$1._alphaBiasShift),__publicField$3(NeuQuantFloat$1,"_radBiasShift",8),__publicField$3(NeuQuantFloat$1,"_radBias",1<<_NeuQuantFloat$1._radBiasShift),__publicField$3(NeuQuantFloat$1,"_alphaRadBiasShift",_NeuQuantFloat$1._alphaBiasShift+_NeuQuantFloat$1._radBiasShift),__publicField$3(NeuQuantFloat$1,"_alphaRadBias",1<<_NeuQuantFloat$1._alphaRadBiasShift);var _ColorHistogram$1=class{constructor(d,m){__publicField$3(this,"_method"),__publicField$3(this,"_hueStats"),__publicField$3(this,"_histogram"),__publicField$3(this,"_initColors"),__publicField$3(this,"_minHueCols"),this._method=d,this._minHueCols=m<<2,this._initColors=m<<2,this._hueStats=new HueStatistics$1(_ColorHistogram$1._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(d){switch(this._method){case 1:this._colorStats1D(d);break;case 2:this._colorStats2D(d)}}getImportanceSortedColorsIDXI32(){const d=stableSort$1(Object.keys(this._histogram),((g,w)=>this._histogram[w]-this._histogram[g]));if(d.length===0)return[];let m;switch(this._method){case 1:const g=Math.min(d.length,this._initColors),w=d[g-1],$=this._histogram[w];m=d.slice(0,g);let I=g;const D=d.length;for(;I<D&&this._histogram[d[I]]===$;)m.push(d[I++]);this._hueStats.injectIntoArray(m);break;case 2:m=d;break;default:throw new Error("Incorrect method")}return m.map((g=>+g))}_colorStats1D(d){const m=this._histogram,g=d.getPointArray(),w=g.length;for(let $=0;$<w;$++){const I=g[$].uint32;this._hueStats.check(I),I in m?m[I]++:m[I]=1}}_colorStats2D(d){const m=d.getWidth(),g=d.getHeight(),w=d.getPointArray(),$=_ColorHistogram$1._boxSize[0],I=_ColorHistogram$1._boxSize[1],D=$*I,q=this._makeBoxes(m,g,$,I),j=this._histogram;q.forEach((G=>{let H=Math.round(G.w*G.h/D)*_ColorHistogram$1._boxPixels;H<2&&(H=2);const W={};this._iterateBox(G,m,(V=>{const K=w[V].uint32;this._hueStats.check(K),K in j?j[K]++:K in W?++W[K]>=H&&(j[K]=W[K]):W[K]=1}))})),this._hueStats.injectIntoDictionary(j)}_iterateBox(d,m,g){const w=d,$=w.y*m+w.x,I=(w.y+w.h-1)*m+(w.x+w.w-1),D=m-w.w+1;let q=0,j=$;do g.call(this,j),j+=++q%w.w==0?D:1;while(j<=I)}_makeBoxes(d,m,g,w){const $=d%g,I=m%w,D=d-$,q=m-I,j=[];for(let G=0;G<m;G+=w)for(let H=0;H<d;H+=g)j.push({x:H,y:G,w:H===D?$:g,h:G===q?I:w});return j}},ColorHistogram$1=_ColorHistogram$1;__publicField$3(ColorHistogram$1,"_boxSize",[64,64]),__publicField$3(ColorHistogram$1,"_boxPixels",2),__publicField$3(ColorHistogram$1,"_hueGroups",10);var RemovedColor$1=class{constructor(d,m,g){__publicField$3(this,"index"),__publicField$3(this,"color"),__publicField$3(this,"distance"),this.index=d,this.color=m,this.distance=g}},RGBQuant$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256,g=2){super(),__publicField$3(this,"_colors"),__publicField$3(this,"_initialDistance"),__publicField$3(this,"_distanceIncrement"),__publicField$3(this,"_histogram"),__publicField$3(this,"_distance"),this._distance=d,this._colors=m,this._histogram=new ColorHistogram$1(g,m),this._initialDistance=.01,this._distanceIncrement=.005}sample(d){this._histogram.sample(d)}*quantize(){const d=this._histogram.getImportanceSortedColorsIDXI32();if(d.length===0)throw new Error("No colors in image");yield*this._buildPalette(d)}*_buildPalette(d){const m=new Palette$1,g=m.getPointContainer().getPointArray(),w=new Array(d.length);for(let H=0;H<d.length;H++)g.push(Point$1.createByUint32(d[H])),w[H]=1;const $=g.length,I=[];let D=$,q=this._initialDistance;const j=new ProgressTracker$1(D-this._colors,99);for(;D>this._colors;){I.length=0;for(let H=0;H<$;H++){if(j.shouldNotify($-D)&&(yield{progress:j.progress}),w[H]===0)continue;const W=g[H];for(let V=H+1;V<$;V++){if(w[V]===0)continue;const K=g[V],Z=this._distance.calculateNormalized(W,K);Z<q&&(I.push(new RemovedColor$1(V,K,Z)),w[V]=0,D--)}}q+=D>3*this._colors?this._initialDistance:this._distanceIncrement}if(D<this._colors){stableSort$1(I,((W,V)=>V.distance-W.distance));let H=0;for(;D<this._colors&&H<I.length;)w[I[H].index]=1,D++,H++}let G=g.length;for(let H=G-1;H>=0;H--)w[H]===0&&(H!==G-1&&(g[H]=g[G-1]),--G);g.length=G,m.sort(),yield{palette:m,progress:100}}};function createArray1D$1(d){const m=[];for(let g=0;g<d;g++)m[g]=0;return m}function createArray4D$1(d,m,g,w){const $=new Array(d);for(let I=0;I<d;I++){$[I]=new Array(m);for(let D=0;D<m;D++){$[I][D]=new Array(g);for(let q=0;q<g;q++){$[I][D][q]=new Array(w);for(let j=0;j<w;j++)$[I][D][q][j]=0}}}return $}function createArray3D$1(d,m,g){const w=new Array(d);for(let $=0;$<d;$++){w[$]=new Array(m);for(let I=0;I<m;I++){w[$][I]=new Array(g);for(let D=0;D<g;D++)w[$][I][D]=0}}return w}function fillArray3D$1(d,m,g,w,$){for(let I=0;I<m;I++){d[I]=[];for(let D=0;D<g;D++){d[I][D]=[];for(let q=0;q<w;q++)d[I][D][q]=$}}}function fillArray1D$1(d,m,g){for(let w=0;w<m;w++)d[w]=g}var WuColorCube$1=class{constructor(){__publicField$3(this,"redMinimum"),__publicField$3(this,"redMaximum"),__publicField$3(this,"greenMinimum"),__publicField$3(this,"greenMaximum"),__publicField$3(this,"blueMinimum"),__publicField$3(this,"blueMaximum"),__publicField$3(this,"volume"),__publicField$3(this,"alphaMinimum"),__publicField$3(this,"alphaMaximum")}},_WuQuant$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256,g=5){super(),__publicField$3(this,"_reds"),__publicField$3(this,"_greens"),__publicField$3(this,"_blues"),__publicField$3(this,"_alphas"),__publicField$3(this,"_sums"),__publicField$3(this,"_weights"),__publicField$3(this,"_momentsRed"),__publicField$3(this,"_momentsGreen"),__publicField$3(this,"_momentsBlue"),__publicField$3(this,"_momentsAlpha"),__publicField$3(this,"_moments"),__publicField$3(this,"_table"),__publicField$3(this,"_pixels"),__publicField$3(this,"_cubes"),__publicField$3(this,"_colors"),__publicField$3(this,"_significantBitsPerChannel"),__publicField$3(this,"_maxSideIndex"),__publicField$3(this,"_alphaMaxSideIndex"),__publicField$3(this,"_sideSize"),__publicField$3(this,"_alphaSideSize"),__publicField$3(this,"_distance"),this._distance=d,this._setQuality(g),this._initialize(m)}sample(d){const m=d.getPointArray();for(let g=0,w=m.length;g<w;g++)this._addColor(m[g]);this._pixels=this._pixels.concat(m)}*quantize(){yield*this._preparePalette();const d=new Palette$1;for(let m=0;m<this._colors;m++)if(this._sums[m]>0){const g=this._sums[m],w=this._reds[m]/g,$=this._greens[m]/g,I=this._blues[m]/g,D=this._alphas[m]/g,q=Point$1.createByRGBA(0|w,0|$,0|I,0|D);d.add(q)}d.sort(),yield{palette:d,progress:100}}*_preparePalette(){yield*this._calculateMoments();let d=0;const m=createArray1D$1(this._colors);for(let D=1;D<this._colors;++D){this._cut(this._cubes[d],this._cubes[D])?(m[d]=this._cubes[d].volume>1?this._calculateVariance(this._cubes[d]):0,m[D]=this._cubes[D].volume>1?this._calculateVariance(this._cubes[D]):0):(m[d]=0,D--),d=0;let q=m[0];for(let j=1;j<=D;++j)m[j]>q&&(q=m[j],d=j);if(q<=0){this._colors=D+1;break}}const g=[],w=[],$=[],I=[];for(let D=0;D<this._colors;++D){const q=_WuQuant$1._volume(this._cubes[D],this._weights);q>0?(g[D]=_WuQuant$1._volume(this._cubes[D],this._momentsRed)/q|0,w[D]=_WuQuant$1._volume(this._cubes[D],this._momentsGreen)/q|0,$[D]=_WuQuant$1._volume(this._cubes[D],this._momentsBlue)/q|0,I[D]=_WuQuant$1._volume(this._cubes[D],this._momentsAlpha)/q|0):(g[D]=0,w[D]=0,$[D]=0,I[D]=0)}this._reds=createArray1D$1(this._colors+1),this._greens=createArray1D$1(this._colors+1),this._blues=createArray1D$1(this._colors+1),this._alphas=createArray1D$1(this._colors+1),this._sums=createArray1D$1(this._colors+1);for(let D=0,q=this._pixels.length;D<q;D++){const j=this._pixels[D];let G=-1,H=Number.MAX_VALUE;for(let W=0;W<this._colors;W++){const V=g[W],K=w[W],Z=$[W],Q=I[W],J=this._distance.calculateRaw(V,K,Z,Q,j.r,j.g,j.b,j.a);J<H&&(H=J,G=W)}this._reds[G]+=j.r,this._greens[G]+=j.g,this._blues[G]+=j.b,this._alphas[G]+=j.a,this._sums[G]++}}_addColor(d){const m=8-this._significantBitsPerChannel,g=1+(d.r>>m),w=1+(d.g>>m),$=1+(d.b>>m),I=1+(d.a>>m);this._weights[I][g][w][$]++,this._momentsRed[I][g][w][$]+=d.r,this._momentsGreen[I][g][w][$]+=d.g,this._momentsBlue[I][g][w][$]+=d.b,this._momentsAlpha[I][g][w][$]+=d.a,this._moments[I][g][w][$]+=this._table[d.r]+this._table[d.g]+this._table[d.b]+this._table[d.a]}*_calculateMoments(){const d=[],m=[],g=[],w=[],$=[],I=[],D=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),q=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),j=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),G=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),H=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),W=createArray3D$1(this._sideSize,this._sideSize,this._sideSize);let V=0;const K=new ProgressTracker$1(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let Z=1;Z<=this._alphaMaxSideIndex;++Z){fillArray3D$1(D,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(q,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(j,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(G,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(H,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(W,this._sideSize,this._sideSize,this._sideSize,0);for(let Q=1;Q<=this._maxSideIndex;++Q,++V){K.shouldNotify(V)&&(yield{progress:K.progress}),fillArray1D$1(d,this._sideSize,0),fillArray1D$1(m,this._sideSize,0),fillArray1D$1(g,this._sideSize,0),fillArray1D$1(w,this._sideSize,0),fillArray1D$1($,this._sideSize,0),fillArray1D$1(I,this._sideSize,0);for(let J=1;J<=this._maxSideIndex;++J){let re=0,se=0,oe=0,ee=0,ae=0,ce=0;for(let le=1;le<=this._maxSideIndex;++le)re+=this._weights[Z][Q][J][le],se+=this._momentsRed[Z][Q][J][le],oe+=this._momentsGreen[Z][Q][J][le],ee+=this._momentsBlue[Z][Q][J][le],ae+=this._momentsAlpha[Z][Q][J][le],ce+=this._moments[Z][Q][J][le],d[le]+=re,m[le]+=se,g[le]+=oe,w[le]+=ee,$[le]+=ae,I[le]+=ce,D[Q][J][le]=D[Q-1][J][le]+d[le],q[Q][J][le]=q[Q-1][J][le]+m[le],j[Q][J][le]=j[Q-1][J][le]+g[le],G[Q][J][le]=G[Q-1][J][le]+w[le],H[Q][J][le]=H[Q-1][J][le]+$[le],W[Q][J][le]=W[Q-1][J][le]+I[le],this._weights[Z][Q][J][le]=this._weights[Z-1][Q][J][le]+D[Q][J][le],this._momentsRed[Z][Q][J][le]=this._momentsRed[Z-1][Q][J][le]+q[Q][J][le],this._momentsGreen[Z][Q][J][le]=this._momentsGreen[Z-1][Q][J][le]+j[Q][J][le],this._momentsBlue[Z][Q][J][le]=this._momentsBlue[Z-1][Q][J][le]+G[Q][J][le],this._momentsAlpha[Z][Q][J][le]=this._momentsAlpha[Z-1][Q][J][le]+H[Q][J][le],this._moments[Z][Q][J][le]=this._moments[Z-1][Q][J][le]+W[Q][J][le]}}}}static _volumeFloat(d,m){return m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMaximum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum])}static _volume(d,m){return 0|_WuQuant$1._volumeFloat(d,m)}static _top(d,m,g,w){let $;switch(m){case _WuQuant$1._alpha:$=w[g][d.redMaximum][d.greenMaximum][d.blueMaximum]-w[g][d.redMaximum][d.greenMinimum][d.blueMaximum]-w[g][d.redMinimum][d.greenMaximum][d.blueMaximum]+w[g][d.redMinimum][d.greenMinimum][d.blueMaximum]-(w[g][d.redMaximum][d.greenMaximum][d.blueMinimum]-w[g][d.redMaximum][d.greenMinimum][d.blueMinimum]-w[g][d.redMinimum][d.greenMaximum][d.blueMinimum]+w[g][d.redMinimum][d.greenMinimum][d.blueMinimum]);break;case _WuQuant$1._red:$=w[d.alphaMaximum][g][d.greenMaximum][d.blueMaximum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMaximum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMaximum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMaximum]-(w[d.alphaMaximum][g][d.greenMaximum][d.blueMinimum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMinimum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMinimum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMinimum]);break;case _WuQuant$1._green:$=w[d.alphaMaximum][d.redMaximum][g][d.blueMaximum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMaximum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMaximum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMaximum]-(w[d.alphaMaximum][d.redMaximum][g][d.blueMinimum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMinimum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMinimum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMinimum]);break;case _WuQuant$1._blue:$=w[d.alphaMaximum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMaximum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMaximum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMaximum][d.redMinimum][d.greenMinimum][g]-(w[d.alphaMinimum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMinimum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMinimum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMinimum][d.redMinimum][d.greenMinimum][g]);break;default:throw new Error("impossible")}return 0|$}static _bottom(d,m,g){switch(m){case _WuQuant$1._alpha:return-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant$1._red:return-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant$1._green:return-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant$1._blue:return-g[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);default:return 0}}_calculateVariance(d){const m=_WuQuant$1._volume(d,this._momentsRed),g=_WuQuant$1._volume(d,this._momentsGreen),w=_WuQuant$1._volume(d,this._momentsBlue),$=_WuQuant$1._volume(d,this._momentsAlpha);return _WuQuant$1._volumeFloat(d,this._moments)-(m*m+g*g+w*w+$*$)/_WuQuant$1._volume(d,this._weights)}_maximize(d,m,g,w,$,I,D,q,j){const G=0|_WuQuant$1._bottom(d,m,this._momentsRed),H=0|_WuQuant$1._bottom(d,m,this._momentsGreen),W=0|_WuQuant$1._bottom(d,m,this._momentsBlue),V=0|_WuQuant$1._bottom(d,m,this._momentsAlpha),K=0|_WuQuant$1._bottom(d,m,this._weights);let Z=0,Q=-1;for(let J=g;J<w;++J){let re=G+_WuQuant$1._top(d,m,J,this._momentsRed),se=H+_WuQuant$1._top(d,m,J,this._momentsGreen),oe=W+_WuQuant$1._top(d,m,J,this._momentsBlue),ee=V+_WuQuant$1._top(d,m,J,this._momentsAlpha),ae=K+_WuQuant$1._top(d,m,J,this._weights);if(ae!==0){let ce=re*re+se*se+oe*oe+ee*ee,le=ce/ae;re=$-re,se=I-se,oe=D-oe,ee=q-ee,ae=j-ae,ae!==0&&(ce=re*re+se*se+oe*oe+ee*ee,le+=ce/ae,le>Z&&(Z=le,Q=J))}}return{max:Z,position:Q}}_cut(d,m){let g;const w=_WuQuant$1._volume(d,this._momentsRed),$=_WuQuant$1._volume(d,this._momentsGreen),I=_WuQuant$1._volume(d,this._momentsBlue),D=_WuQuant$1._volume(d,this._momentsAlpha),q=_WuQuant$1._volume(d,this._weights),j=this._maximize(d,_WuQuant$1._red,d.redMinimum+1,d.redMaximum,w,$,I,D,q),G=this._maximize(d,_WuQuant$1._green,d.greenMinimum+1,d.greenMaximum,w,$,I,D,q),H=this._maximize(d,_WuQuant$1._blue,d.blueMinimum+1,d.blueMaximum,w,$,I,D,q),W=this._maximize(d,_WuQuant$1._alpha,d.alphaMinimum+1,d.alphaMaximum,w,$,I,D,q);if(W.max>=j.max&&W.max>=G.max&&W.max>=H.max){if(g=_WuQuant$1._alpha,W.position<0)return!1}else g=j.max>=W.max&&j.max>=G.max&&j.max>=H.max?_WuQuant$1._red:G.max>=W.max&&G.max>=j.max&&G.max>=H.max?_WuQuant$1._green:_WuQuant$1._blue;switch(m.redMaximum=d.redMaximum,m.greenMaximum=d.greenMaximum,m.blueMaximum=d.blueMaximum,m.alphaMaximum=d.alphaMaximum,g){case _WuQuant$1._red:m.redMinimum=d.redMaximum=j.position,m.greenMinimum=d.greenMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant$1._green:m.greenMinimum=d.greenMaximum=G.position,m.redMinimum=d.redMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant$1._blue:m.blueMinimum=d.blueMaximum=H.position,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant$1._alpha:m.alphaMinimum=d.alphaMaximum=W.position,m.blueMinimum=d.blueMinimum,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum}return d.volume=(d.redMaximum-d.redMinimum)*(d.greenMaximum-d.greenMinimum)*(d.blueMaximum-d.blueMinimum)*(d.alphaMaximum-d.alphaMinimum),m.volume=(m.redMaximum-m.redMinimum)*(m.greenMaximum-m.greenMinimum)*(m.blueMaximum-m.blueMinimum)*(m.alphaMaximum-m.alphaMinimum),!0}_initialize(d){this._colors=d,this._cubes=[];for(let m=0;m<d;m++)this._cubes[m]=new WuColorCube$1;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let m=0;m<256;++m)this._table[m]=m*m;this._pixels=[]}_setQuality(d=5){this._significantBitsPerChannel=d,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}},WuQuant$1=_WuQuant$1;__publicField$3(WuQuant$1,"_alpha",3),__publicField$3(WuQuant$1,"_red",2),__publicField$3(WuQuant$1,"_green",1),__publicField$3(WuQuant$1,"_blue",0);var image_exports$1={};__export$1(image_exports$1,{AbstractImageQuantizer:()=>AbstractImageQuantizer$1,ErrorDiffusionArray:()=>ErrorDiffusionArray$1,ErrorDiffusionArrayKernel:()=>ErrorDiffusionArrayKernel$1,ErrorDiffusionRiemersma:()=>ErrorDiffusionRiemersma$1,NearestColor:()=>NearestColor$1});var AbstractImageQuantizer$1=class{quantizeSync(d,m){for(const g of this.quantize(d,m))if(g.pointContainer)return g.pointContainer;throw new Error("unreachable")}},NearestColor$1=class extends AbstractImageQuantizer$1{constructor(d){super(),__publicField$3(this,"_distance"),this._distance=d}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=new ProgressTracker$1($,99);for(let D=0;D<$;D++){I.shouldNotify(D)&&(yield{progress:I.progress});for(let q=0,j=D*w;q<w;q++,j++){const G=g[j];G.from(m.getNearestColor(this._distance,G))}}yield{pointContainer:d,progress:100}}},ErrorDiffusionArrayKernel$1=(d=>(d[d.FloydSteinberg=0]="FloydSteinberg",d[d.FalseFloydSteinberg=1]="FalseFloydSteinberg",d[d.Stucki=2]="Stucki",d[d.Atkinson=3]="Atkinson",d[d.Jarvis=4]="Jarvis",d[d.Burkes=5]="Burkes",d[d.Sierra=6]="Sierra",d[d.TwoSierra=7]="TwoSierra",d[d.SierraLite=8]="SierraLite",d))(ErrorDiffusionArrayKernel$1||{}),ErrorDiffusionArray$1=class extends AbstractImageQuantizer$1{constructor(d,m,g=!0,w=0,$=!1){super(),__publicField$3(this,"_minColorDistance"),__publicField$3(this,"_serpentine"),__publicField$3(this,"_kernel"),__publicField$3(this,"_calculateErrorLikeGIMP"),__publicField$3(this,"_distance"),this._setKernel(m),this._distance=d,this._minColorDistance=w,this._serpentine=g,this._calculateErrorLikeGIMP=$}*quantize(d,m){const g=d.getPointArray(),w=new Point$1,$=d.getWidth(),I=d.getHeight(),D=[];let q=1,j=1;for(const H of this._kernel){const W=H[2]+1;j<W&&(j=W)}for(let H=0;H<j;H++)this._fillErrorLine(D[H]=[],$);const G=new ProgressTracker$1(I,99);for(let H=0;H<I;H++){G.shouldNotify(H)&&(yield{progress:G.progress}),this._serpentine&&(q*=-1);const W=H*$,V=q===1?0:$-1,K=q===1?$:-1;this._fillErrorLine(D[0],$),D.push(D.shift());const Z=D[0];for(let Q=V,J=W+V;Q!==K;Q+=q,J+=q){const re=g[J],se=Z[Q];w.from(re);const oe=Point$1.createByRGBA(inRange0to255Rounded$1(re.r+se[0]),inRange0to255Rounded$1(re.g+se[1]),inRange0to255Rounded$1(re.b+se[2]),inRange0to255Rounded$1(re.a+se[3])),ee=m.getNearestColor(this._distance,oe);if(re.from(ee),this._minColorDistance&&this._distance.calculateNormalized(w,ee)<this._minColorDistance)continue;let ae,ce,le,de;this._calculateErrorLikeGIMP?(ae=oe.r-ee.r,ce=oe.g-ee.g,le=oe.b-ee.b,de=oe.a-ee.a):(ae=w.r-ee.r,ce=w.g-ee.g,le=w.b-ee.b,de=w.a-ee.a);const _e=q===1?0:this._kernel.length-1,we=q===1?this._kernel.length:-1;for(let pe=_e;pe!==we;pe+=q){const xe=this._kernel[pe][1]*q,Ge=this._kernel[pe][2];if(xe+Q>=0&&xe+Q<$&&Ge+H>=0&&Ge+H<I){const Te=this._kernel[pe][0],Ce=D[Ge][xe+Q];Ce[0]+=ae*Te,Ce[1]+=ce*Te,Ce[2]+=le*Te,Ce[3]+=de*Te}}}}yield{pointContainer:d,progress:100}}_fillErrorLine(d,m){d.length>m&&(d.length=m);const g=d.length;for(let w=0;w<g;w++){const $=d[w];$[0]=$[1]=$[2]=$[3]=0}for(let w=g;w<m;w++)d[w]=[0,0,0,0]}_setKernel(d){switch(d){case 0:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case 1:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case 2:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case 3:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case 4:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case 5:this._kernel=[[.25,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[.25,0,1],[4/32,1,1],[2/32,2,1]];break;case 6:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case 7:this._kernel=[[.25,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case 8:this._kernel=[[.5,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw new Error(`ErrorDiffusionArray: unknown kernel = ${d}`)}}};function*hilbertCurve$1(d,m,g){const w=Math.max(d,m),$={width:d,height:m,level:Math.floor(Math.log(w)/Math.log(2)+1),callback:g,tracker:new ProgressTracker$1(d*m,99),index:0,x:0,y:0};yield*walkHilbert$1($,1),visit$1($,0)}function*walkHilbert$1(d,m){if(!(d.level<1)){switch(d.tracker.shouldNotify(d.index)&&(yield{progress:d.tracker.progress}),d.level--,m){case 2:yield*walkHilbert$1(d,1),visit$1(d,3),yield*walkHilbert$1(d,2),visit$1(d,4),yield*walkHilbert$1(d,2),visit$1(d,2),yield*walkHilbert$1(d,4);break;case 3:yield*walkHilbert$1(d,4),visit$1(d,2),yield*walkHilbert$1(d,3),visit$1(d,1),yield*walkHilbert$1(d,3),visit$1(d,3),yield*walkHilbert$1(d,1);break;case 1:yield*walkHilbert$1(d,2),visit$1(d,4),yield*walkHilbert$1(d,1),visit$1(d,3),yield*walkHilbert$1(d,1),visit$1(d,1),yield*walkHilbert$1(d,3);break;case 4:yield*walkHilbert$1(d,3),visit$1(d,1),yield*walkHilbert$1(d,4),visit$1(d,2),yield*walkHilbert$1(d,4),visit$1(d,4),yield*walkHilbert$1(d,2)}d.level++}}function visit$1(d,m){switch(d.x>=0&&d.x<d.width&&d.y>=0&&d.y<d.height&&(d.callback(d.x,d.y),d.index++),m){case 2:d.x--;break;case 3:d.x++;break;case 1:d.y--;break;case 4:d.y++}}var ErrorDiffusionRiemersma$1=class extends AbstractImageQuantizer$1{constructor(d,m=16,g=1){super(),__publicField$3(this,"_distance"),__publicField$3(this,"_weights"),__publicField$3(this,"_errorQueueSize"),this._distance=d,this._errorQueueSize=m,this._weights=ErrorDiffusionRiemersma$1._createWeights(g,m)}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=[];let D=0;for(let q=0;q<this._errorQueueSize;q++)I[q]={r:0,g:0,b:0,a:0};yield*hilbertCurve$1(w,$,((q,j)=>{const G=g[q+j*w];let{r:H,g:W,b:V,a:K}=G;for(let re=0;re<this._errorQueueSize;re++){const se=this._weights[re],oe=I[(re+D)%this._errorQueueSize];H+=oe.r*se,W+=oe.g*se,V+=oe.b*se,K+=oe.a*se}const Z=Point$1.createByRGBA(inRange0to255Rounded$1(H),inRange0to255Rounded$1(W),inRange0to255Rounded$1(V),inRange0to255Rounded$1(K)),Q=m.getNearestColor(this._distance,Z);D=(D+1)%this._errorQueueSize;const J=(D+this._errorQueueSize-1)%this._errorQueueSize;I[J].r=G.r-Q.r,I[J].g=G.g-Q.g,I[J].b=G.b-Q.b,I[J].a=G.a-Q.a,G.from(Q)})),yield{pointContainer:d,progress:100}}static _createWeights(d,m){const g=[],w=Math.exp(Math.log(m)/(m-1));for(let $=0,I=1;$<m;$++)g[$]=(I+.5|0)/m*d,I*=w;return g}},quality_exports$1={};__export$1(quality_exports$1,{ssim:()=>ssim$1});var K1$1=.01,K2$1=.03;function ssim$1(d,m){if(d.getHeight()!==m.getHeight()||d.getWidth()!==m.getWidth())throw new Error("Images have different sizes!");const g=(255*K1$1)**2,w=(255*K2$1)**2;let $=0,I=0;return iterate$1(d,m,((D,q,j,G)=>{let H=0,W=0,V=0;for(let Z=0;Z<D.length;Z++)W+=(D[Z]-j)**2,V+=(q[Z]-G)**2,H+=(D[Z]-j)*(q[Z]-G);const K=D.length-1;W/=K,V/=K,H/=K,I+=(2*j*G+g)*(2*H+w)/((j**2+G**2+g)*(W+V+w)),$++})),I/$}function iterate$1(d,m,g){const w=d.getWidth(),$=d.getHeight();for(let I=0;I<$;I+=8)for(let D=0;D<w;D+=8){const q=Math.min(8,w-D),j=Math.min(8,$-I),G=calculateLumaValuesForWindow$1(d,D,I,q,j),H=calculateLumaValuesForWindow$1(m,D,I,q,j);g(G,H,calculateAverageLuma$1(G),calculateAverageLuma$1(H))}}function calculateLumaValuesForWindow$1(d,m,g,w,$){const I=d.getPointArray(),D=[];let q=0;for(let j=g;j<g+$;j++){const G=j*d.getWidth();for(let H=m;H<m+w;H++){const W=I[G+H];D[q]=.2126*W.r+.7152*W.g+.0722*W.b,q++}}return D}function calculateAverageLuma$1(d){let m=0;for(const g of d)m+=g;return m/d.length}var setImmediateImpl=typeof setImmediate=="function"?setImmediate:typeof process<"u"&&typeof(process==null?void 0:process.nextTick)=="function"?d=>process.nextTick(d):d=>setTimeout(d,0);function buildPaletteSync$1(d,{colorDistanceFormula:m,paletteQuantization:g,colors:w}={}){const $=paletteQuantizationToPaletteQuantizer$1(colorDistanceFormulaToColorDistance$1(m),g,w);return d.forEach((I=>$.sample(I))),$.quantizeSync()}async function buildPalette(d,{colorDistanceFormula:m,paletteQuantization:g,colors:w,onProgress:$}={}){return new Promise(((I,D)=>{const q=paletteQuantizationToPaletteQuantizer$1(colorDistanceFormulaToColorDistance$1(m),g,w);let j;d.forEach((W=>q.sample(W)));const G=q.quantize(),H=()=>{try{const W=G.next();W.done?I(j):(W.value.palette&&(j=W.value.palette),$&&$(W.value.progress),setImmediateImpl(H))}catch(W){D(W)}};setImmediateImpl(H)}))}function applyPaletteSync$1(d,m,{colorDistanceFormula:g,imageQuantization:w}={}){return imageQuantizationToImageQuantizer$1(colorDistanceFormulaToColorDistance$1(g),w).quantizeSync(d,m)}async function applyPalette(d,m,{colorDistanceFormula:g,imageQuantization:w,onProgress:$}={}){return new Promise(((I,D)=>{let q;const j=imageQuantizationToImageQuantizer$1(colorDistanceFormulaToColorDistance$1(g),w).quantize(d,m),G=()=>{try{const H=j.next();H.done?I(q):(H.value.pointContainer&&(q=H.value.pointContainer),$&&$(H.value.progress),setImmediateImpl(G))}catch(H){D(H)}};setImmediateImpl(G)}))}function colorDistanceFormulaToColorDistance$1(d="euclidean-bt709"){switch(d){case"cie94-graphic-arts":return new CIE94GraphicArts$1;case"cie94-textiles":return new CIE94Textiles$1;case"ciede2000":return new CIEDE2000$1;case"color-metric":return new CMetric$1;case"euclidean":return new Euclidean$1;case"euclidean-bt709":return new EuclideanBT709$1;case"euclidean-bt709-noalpha":return new EuclideanBT709NoAlpha$1;case"manhattan":return new Manhattan$1;case"manhattan-bt709":return new ManhattanBT709$1;case"manhattan-nommyde":return new ManhattanNommyde$1;case"pngquant":return new PNGQuant$1;default:throw new Error(`Unknown colorDistanceFormula ${d}`)}}function imageQuantizationToImageQuantizer$1(d,m="floyd-steinberg"){switch(m){case"nearest":return new NearestColor$1(d);case"riemersma":return new ErrorDiffusionRiemersma$1(d);case"floyd-steinberg":return new ErrorDiffusionArray$1(d,0);case"false-floyd-steinberg":return new ErrorDiffusionArray$1(d,1);case"stucki":return new ErrorDiffusionArray$1(d,2);case"atkinson":return new ErrorDiffusionArray$1(d,3);case"jarvis":return new ErrorDiffusionArray$1(d,4);case"burkes":return new ErrorDiffusionArray$1(d,5);case"sierra":return new ErrorDiffusionArray$1(d,6);case"two-sierra":return new ErrorDiffusionArray$1(d,7);case"sierra-lite":return new ErrorDiffusionArray$1(d,8);default:throw new Error(`Unknown imageQuantization ${m}`)}}function paletteQuantizationToPaletteQuantizer$1(d,m="wuquant",g=256){switch(m){case"neuquant":return new NeuQuant$1(d,g);case"rgbquant":return new RGBQuant$1(d,g);case"wuquant":return new WuQuant$1(d,g);case"neuquant-float":return new NeuQuantFloat$1(d,g);default:throw new Error(`Unknown paletteQuantization ${m}`)}}var imageQ=__toCommonJS(src_exports),gifframe={};const BitmapImage$1=bitmapimage;let GifFrame$1=class _c extends BitmapImage$1{constructor(...m){if(super(...m),m[0]instanceof _c){const g=m[0];this.xOffset=g.xOffset,this.yOffset=g.yOffset,this.disposalMethod=g.disposalMethod,this.delayCentisecs=g.delayCentisecs,this.interlaced=g.interlaced}else{const g=m[m.length-1];let w={};typeof g!="object"||g instanceof BitmapImage$1||(w=g),this.xOffset=w.xOffset||0,this.yOffset=w.yOffset||0,this.disposalMethod=w.disposalMethod!==void 0?w.disposalMethod:_c.DisposeToBackgroundColor,this.delayCentisecs=w.delayCentisecs||8,this.interlaced=w.interlaced||!1}}getPalette(){const m=new Set,g=this.bitmap.data;let w=0,$=!1;for(;w<g.length;){if(g[w+3]===0)$=!0;else{const j=g.readUInt32BE(w,!0)>>8&16777215;m.add(j)}w+=4}const I=new Array(m.size),D=m.values();for(w=0;w<I.length;++w)I[w]=D.next().value;I.sort(((j,G)=>j-G));let q=I.length;return $&&++q,{colors:I,usesTransparency:$,indexCount:q}}};var hasRequiredGifutil,hasRequiredGifcodec;function requireGifutil(){return hasRequiredGifutil||(hasRequiredGifutil=1,(function(d){const m=require$$0,g=imageQ,w=bitmapimage,{GifFrame:$}=gifframe,{GifError:I}=gif$1,{GifCodec:D}=requireGifcodec(),q=[".jpg",".jpeg",".png",".bmp"],j=new D;function G(H,W,V,K,Z){const Q=Array.isArray(H)?H:[H];if(Z){if(["FloydSteinberg","FalseFloydSteinberg","Stucki","Atkinson","Jarvis","Burkes","Sierra","TwoSierra","SierraLite"].indexOf(Z.ditherAlgorithm)<0)throw new Error(`Invalid ditherAlgorithm '${Z.ditherAlgorithm}'`);Z.serpentine===void 0&&(Z.serpentine=!0),Z.minimumColorDistanceToDither===void 0&&(Z.minimumColorDistanceToDither=0),Z.calculateErrorLikeGIMP===void 0&&(Z.calculateErrorLikeGIMP=!1)}const J=new g.distance.Euclidean,re=new g.palette[W](J,V,K);let se;se=Z?new g.image.ErrorDiffusionArray(J,g.image.ErrorDiffusionArrayKernel[Z.ditherAlgorithm],Z.serpentine,Z.minimumColorDistanceToDither,Z.calculateErrorLikeGIMP):new g.image.NearestColor(J);const oe=[];Q.forEach((ae=>{const ce=ae.bitmap.data,le=new ArrayBuffer(ce.length),de=new Uint32Array(le);for(let we=0,pe=0;we<ce.length;we+=4,++pe)de[pe]=ce.readUInt32LE(we,!0);const _e=g.utils.PointContainer.fromUint32Array(de,ae.bitmap.width,ae.bitmap.height);re.sample(_e),oe.push(_e)}));const ee=re.quantizeSync();for(let ae=0;ae<Q.length;++ae){const ce=Q[ae].bitmap.data,le=se.quantizeSync(oe[ae],ee).toUint32Array();for(let de=0,_e=0;de<ce.length;de+=4,++_e)ce.writeUInt32LE(le[_e],de)}}d.cloneFrames=function(H){let W=[];return H.forEach((V=>{W.push(new $(V))})),W},d.getColorInfo=function(H,W){let V=!1;const K=[];for(let se=0;se<H.length;++se){let oe=H[se].getPalette();if(oe.usesTransparency&&(V=!0),oe.indexCount>256)throw new I(`Frame ${se} uses more than 256 color indexes`);K.push(oe)}if(W===0)return{usesTransparency:V,palettes:K};const Z=new Set;K.forEach((se=>{se.colors.forEach((oe=>{Z.add(oe)}))}));let Q=Z.size;if(V&&++Q,W&&Q>W)return{usesTransparency:V,palettes:K};const J=new Array(Z.size),re=Z.values();for(let se=0;se<J.length;++se)J[se]=re.next().value;return J.sort(((se,oe)=>se-oe)),{colors:J,indexCount:Q,usesTransparency:V,palettes:K}},d.copyAsJimp=function(H,W){return d.shareAsJimp(H,new w(W))},d.getMaxDimensions=function(H){let W=0,V=0;return H.forEach((K=>{const Z=K.xOffset+K.bitmap.width;Z>W&&(W=Z);const Q=K.yOffset+K.bitmap.height;Q>V&&(V=Q)})),{maxWidth:W,maxHeight:V}},d.quantizeDekker=function(H,W,V){G(H,"NeuQuantFloat",W=W||256,0,V)},d.quantizeSorokin=function(H,W,V,K){let Z;switch(W=W||256,V=V||"min-pop"){case"min-pop":Z=2;break;case"top-pop":Z=1;break;default:throw new Error(`Invalid quantizeSorokin histogram '${V}'`)}G(H,"RGBQuant",W,Z,K)},d.quantizeWu=function(H,W,V,K){if(W=W||256,(V=V||5)<1||V>8)throw new Error("Invalid quantization quality");G(H,"WuQuant",W,V,K)},d.read=function(H,W){return W=W||j,Buffer.isBuffer(H)?W.decodeGif(H):(function(V){return new Promise(((K,Z)=>{m.readFile(V,((Q,J)=>Q?Z(Q):K(J)))}))})(H).then((V=>W.decodeGif(V)))},d.shareAsJimp=function(H,W){const V=new H(W.bitmap.width,W.bitmap.height,0);return V.bitmap.data=W.bitmap.data,V},d.write=function(H,W,V,K){K=K||j;const Z=H.match(/\.[a-zA-Z]+$/);if(Z!==null&&q.includes(Z[0].toLowerCase()))throw new Error(`GIF '${H}' has an unexpected suffix`);return K.encodeGif(W,V).then((Q=>(function(J,re){return new Promise(((se,oe)=>{m.writeFile(J,re,(ee=>ee?oe(ee):se()))}))})(H,Q.buffer).then((()=>Q))))}})(gifutil)),gifutil}function requireGifcodec(){if(hasRequiredGifcodec)return gifcodec;hasRequiredGifcodec=1;const d=omggif,{Gif:m,GifError:g}=gif$1;function w(){const W=requireGifutil();return w=function(){return W},W}const{GifFrame:$}=gifframe;function I(W,V){const K=W.indexOf(V);return K===-1?null:K}function D(W,V){for(var K,Z=0,Q=W.length-1;Z<=Q;)if(W[K=Math.floor((Z+Q)/2)]>V)Q=K-1;else{if(!(W[K]<V))return K;Z=K+1}return null}function q(W){const V=W.colors;W.usesTransparency&&V.push(0);const K=V.length;let Z=2;for(;K>Z;)Z<<=1;V.length=Z,V.fill(0,K)}function j(W,V){let K=W.bitmap.width*W.bitmap.height;return K=Math.ceil(K*V/8),K+=Math.ceil(K/255),100+K+768}function G(W){let V=W.indexCount,K=0;for(--V;V;)++K,V>>=1;return K>0?K:1}function H(W,V,K,Z,Q){if(K.interlaced)throw new g("writing interlaced GIFs is not supported");const J=(function(se,oe,ee){const ae=ee.colors,ce=ae.length<=8?I:D,le=oe.bitmap.data,de=new Buffer(le.length/4);let _e=ae.length,we=0,pe=0;for(;we<le.length;){if(le[we+3]!==0){const xe=le.readUInt32BE(we,!0)>>8&16777215;de[pe]=ce(ae,xe)}else de[pe]=_e;we+=4,++pe}if(ee.usesTransparency){if(_e===256)throw new g(`Frame ${se} already has 256 colorsand so can't use transparency`)}else _e=null;return{buffer:de,transparentIndex:_e}})(V,K,Z),re={delay:K.delayCentisecs,disposal:K.disposalMethod,transparent:J.transparentIndex};Q&&(q(Z),re.palette=Z.colors);try{let se,oe=W.getOutputBuffer(),ee=W.getOutputBufferPosition(),ae=!0;for(;ae;)if(se=W.addFrame(K.xOffset,K.yOffset,K.bitmap.width,K.bitmap.height,J.buffer,re),ae=!1,se>=oe.length-1){const ce=new Buffer(1.5*oe.length);oe.copy(ce),W.setOutputBuffer(ce),W.setOutputBufferPosition(ee),oe=ce,ae=!0}return oe}catch(se){throw new g(se)}}return gifcodec.GifCodec=class{constructor(W={}){this._transparentRGB=null,typeof W.transparentRGB=="number"&&W.transparentRGB!==0&&(this._transparentRGBA=256*W.transparentRGB),this._testInitialBufferSize=0}decodeGif(W){try{let V;try{V=new d.GifReader(W)}catch(J){throw new g(J)}const K=V.numFrames(),Z=[],Q={width:V.width,height:V.height,loops:V.loopCount(),usesTransparency:!1};for(let J=0;J<K;++J){const re=this._decodeFrame(V,J,Q.usesTransparency);Z.push(re.frame),re.usesTransparency&&(Q.usesTransparency=!0)}return Promise.resolve(new m(W,Z,Q))}catch(V){return Promise.reject(V)}}encodeGif(W,V={}){try{if(W===null||W.length===0)throw new g("there are no frames");const K=w().getMaxDimensions(W);return(V=Object.assign({},V)).width=K.maxWidth,V.height=K.maxHeight,V.loops===void 0&&(V.loops=0),V.colorScope=V.colorScope||m.GlobalColorsPreferred,Promise.resolve(this._encodeGif(W,V))}catch(K){return Promise.reject(K)}}_decodeFrame(W,V,K){let Z,Q;try{if(Z=W.frameInfo(V),Q=new Buffer(W.width*W.height*4),W.decodeAndBlitFrameRGBA(V,Q),Z.width!==W.width||Z.height!==W.height){if(Z.y&&(Q=Q.slice(Z.y*W.width*4)),W.width>Z.width)for(let re=0;re<Z.height;++re)Q.copy(Q,re*Z.width*4,4*(Z.x+re*W.width),4*(Z.x+re*W.width)+4*Z.width);Q=Q.slice(0,Z.width*Z.height*4)}}catch(re){throw new g(re)}let J=!1;if(this._transparentRGBA===null){if(!K)for(let re=3;re<Q.length;re+=4)Q[re]===0&&(J=!0,re=Q.length)}else for(let re=3;re<Q.length;re+=4)Q[re]===0&&(Q.writeUInt32BE(this._transparentRGBA,re-3),J=!0);return{frame:new $(Z.width,Z.height,Q,{xOffset:Z.x,yOffset:Z.y,disposalMethod:Z.disposal,interlaced:Z.interlaced,delayCentisecs:Z.delay}),usesTransparency:J}}_encodeGif(W,V){let K;if(V.colorScope===m.LocalColorsOnly)K=w().getColorInfo(W,0);else if(K=w().getColorInfo(W,256),!K.colors){if(V.colorScope===m.GlobalColorsOnly)throw new g("Too many color indexes for global color table");V.colorScope=m.LocalColorsOnly}V.usesTransparency=K.usesTransparency;const Z=K.palettes;return V.colorScope===m.LocalColorsOnly?(function(Q,J,re,se){const oe={loop:J.loops};let ee,ae=new Buffer(re);try{ee=new d.GifWriter(ae,J.width,J.height,oe)}catch(ce){throw new g(ce)}for(let ce=0;ce<Q.length;++ce)ae=H(ee,ce,Q[ce],se[ce],!0);return new m(ae.slice(0,ee.end()),Q,J)})(W,V,2e3,Z):(function(Q,J,re,se){const oe={colors:se.colors.slice(),usesTransparency:se.usesTransparency};q(oe);const ee={palette:oe.colors,loop:J.loops};let ae,ce=new Buffer(re);try{ae=new d.GifWriter(ce,J.width,J.height,ee)}catch(le){throw new g(le)}for(let le=0;le<Q.length;++le)ce=H(ae,le,Q[le],se,!1);return new m(ce.slice(0,ae.end()),Q,J)})(W,V,2e3,K)}_getSizeEstimateGlobal(W,V){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let K=968;const Z=G(W);return V.forEach((Q=>{K+=j(Q,Z)})),K}_getSizeEstimateLocal(W,V){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let K=200;for(let Z=0;Z<V.length;++Z){const Q=G(W[Z]);K+=j(V[Z],Q)}return K}},gifcodec}GifFrame$1.DisposeToAnything=0,GifFrame$1.DisposeNothing=1,GifFrame$1.DisposeToBackgroundColor=2,GifFrame$1.DisposeToPrevious=3,gifframe.GifFrame=GifFrame$1;const BitmapImage=bitmapimage,{GifCodec}=requireGifcodec(),{GifFrame}=gifframe,GifUtil=requireGifutil();var src={BitmapImage,GifCodec,GifFrame,GifUtil};function gif(){return{mime:"image/gif",encode:async d=>{const m=new src.BitmapImage(d);src.GifUtil.quantizeDekker(m,256);const g=new src.GifFrame(d);return(await new src.GifCodec().encodeGif([g],{})).buffer},decode:d=>{const m=new omggif.GifReader(d),g=Buffer.alloc(m.width*m.height*4);return m.decodeAndBlitFrameRGBA(0,g),{data:g,width:m.width,height:m.height}}}}var encoder={exports:{}};(function(d){function m(g){var w,$,I,D,q,j=Math.floor,G=new Array(64),H=new Array(64),W=new Array(64),V=new Array(64),K=new Array(65535),Z=new Array(65535),Q=new Array(64),J=new Array(64),re=[],se=0,oe=7,ee=new Array(64),ae=new Array(64),ce=new Array(64),le=new Array(256),de=new Array(2048),_e=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],we=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],pe=[0,1,2,3,4,5,6,7,8,9,10,11],xe=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Ge=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Te=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Ce=[0,1,2,3,4,5,6,7,8,9,10,11],Oe=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],bt=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Mt(ht,gt){for(var zt=0,ur=0,dr=new Array,fr=1;fr<=16;fr++){for(var Ft=1;Ft<=ht[fr];Ft++)dr[gt[ur]]=[],dr[gt[ur]][0]=zt,dr[gt[ur]][1]=fr,ur++,zt++;zt*=2}return dr}function lt(ht){for(var gt=ht[0],zt=ht[1]-1;zt>=0;)gt&1<<zt&&(se|=1<<oe),zt--,--oe<0&&(se==255?(ir(255),ir(0)):ir(se),oe=7,se=0)}function ir(ht){re.push(ht)}function Ye(ht){ir(ht>>8&255),ir(255&ht)}function xt(ht,gt,zt,ur,dr){for(var fr,Ft=dr[0],$e=dr[240],Bt=(function(ft,pr){var fn,vn,En,bn,$n,xn,ti,Cn,On,si,Tn=0;for(On=0;On<8;++On){fn=ft[Tn],vn=ft[Tn+1],En=ft[Tn+2],bn=ft[Tn+3],$n=ft[Tn+4],xn=ft[Tn+5],ti=ft[Tn+6];var or=fn+(Cn=ft[Tn+7]),kn=fn-Cn,mr=vn+ti,yn=vn-ti,Dt=En+xn,wn=En-xn,ii=bn+$n,Ze=bn-$n,_n=or+ii,hn=or-ii,cr=mr+Dt,gn=mr-Dt;ft[Tn]=_n+cr,ft[Tn+4]=_n-cr;var mn=.707106781*(gn+hn);ft[Tn+2]=hn+mn,ft[Tn+6]=hn-mn;var ri=.382683433*((_n=Ze+wn)-(gn=yn+kn)),An=.5411961*_n+ri,ei=1.306562965*gn+ri,oi=.707106781*(cr=wn+yn),wi=kn+oi,ci=kn-oi;ft[Tn+5]=ci+An,ft[Tn+3]=ci-An,ft[Tn+1]=wi+ei,ft[Tn+7]=wi-ei,Tn+=8}for(Tn=0,On=0;On<8;++On){fn=ft[Tn],vn=ft[Tn+8],En=ft[Tn+16],bn=ft[Tn+24],$n=ft[Tn+32],xn=ft[Tn+40],ti=ft[Tn+48];var hi=fn+(Cn=ft[Tn+56]),mi=fn-Cn,gi=vn+ti,Ai=vn-ti,Ti=En+xn,pi=En-xn,bi=bn+$n,Si=bn-$n,_i=hi+bi,yi=hi-bi,di=gi+Ti,Oi=gi-Ti;ft[Tn]=_i+di,ft[Tn+32]=_i-di;var ki=.707106781*(Oi+yi);ft[Tn+16]=yi+ki,ft[Tn+48]=yi-ki;var Ri=.382683433*((_i=Si+pi)-(Oi=Ai+mi)),Di=.5411961*_i+Ri,Ei=1.306562965*Oi+Ri,Li=.707106781*(di=pi+Ai),Hi=mi+Li,Ii=mi-Li;ft[Tn+40]=Ii+Di,ft[Tn+24]=Ii-Di,ft[Tn+8]=Hi+Ei,ft[Tn+56]=Hi-Ei,Tn++}for(On=0;On<64;++On)si=ft[On]*pr[On],Q[On]=si>0?si+.5|0:si-.5|0;return Q})(ht,gt),Qe=0;Qe<64;++Qe)J[_e[Qe]]=Bt[Qe];var st=J[0]-zt;zt=J[0],st==0?lt(ur[0]):(lt(ur[Z[fr=32767+st]]),lt(K[fr]));for(var at=63;at>0&&J[at]==0;at--);if(at==0)return lt(Ft),zt;for(var pt,sr=1;sr<=at;){for(var Ee=sr;J[sr]==0&&sr<=at;++sr);var ze=sr-Ee;if(ze>=16){pt=ze>>4;for(var ct=1;ct<=pt;++ct)lt($e);ze&=15}fr=32767+J[sr],lt(dr[(ze<<4)+Z[fr]]),lt(K[fr]),sr++}return at!=63&&lt(Ft),zt}function ar(ht){ht<=0&&(ht=1),ht>100&&(ht=100),q!=ht&&((function(gt){for(var zt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],ur=0;ur<64;ur++){var dr=j((zt[ur]*gt+50)/100);dr<1?dr=1:dr>255&&(dr=255),G[_e[ur]]=dr}for(var fr=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Ft=0;Ft<64;Ft++){var $e=j((fr[Ft]*gt+50)/100);$e<1?$e=1:$e>255&&($e=255),H[_e[Ft]]=$e}for(var Bt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Qe=0,st=0;st<8;st++)for(var at=0;at<8;at++)W[Qe]=1/(G[_e[Qe]]*Bt[st]*Bt[at]*8),V[Qe]=1/(H[_e[Qe]]*Bt[st]*Bt[at]*8),Qe++})(ht<50?Math.floor(5e3/ht):Math.floor(200-2*ht)),q=ht)}this.encode=function(ht,gt){var zt;new Date().getTime(),gt&&ar(gt),re=new Array,se=0,oe=7,Ye(65496),Ye(65504),Ye(16),ir(74),ir(70),ir(73),ir(70),ir(0),ir(1),ir(1),ir(0),Ye(1),Ye(1),ir(0),ir(0),(zt=ht.comments)!==void 0&&zt.constructor===Array&&zt.forEach((En=>{if(typeof En=="string"){Ye(65534);var bn,$n=En.length;for(Ye($n+2),bn=0;bn<$n;bn++)ir(En.charCodeAt(bn))}})),(function(En){if(En){Ye(65505),En[0]===69&&En[1]===120&&En[2]===105&&En[3]===102?Ye(En.length+2):(Ye(En.length+5+2),ir(69),ir(120),ir(105),ir(102),ir(0));for(var bn=0;bn<En.length;bn++)ir(En[bn])}})(ht.exifBuffer),(function(){Ye(65499),Ye(132),ir(0);for(var En=0;En<64;En++)ir(G[En]);ir(1);for(var bn=0;bn<64;bn++)ir(H[bn])})(),(function(En,bn){Ye(65472),Ye(17),ir(8),Ye(bn),Ye(En),ir(3),ir(1),ir(17),ir(0),ir(2),ir(17),ir(1),ir(3),ir(17),ir(1)})(ht.width,ht.height),(function(){Ye(65476),Ye(418),ir(0);for(var En=0;En<16;En++)ir(we[En+1]);for(var bn=0;bn<=11;bn++)ir(pe[bn]);ir(16);for(var $n=0;$n<16;$n++)ir(xe[$n+1]);for(var xn=0;xn<=161;xn++)ir(Ge[xn]);ir(1);for(var ti=0;ti<16;ti++)ir(Te[ti+1]);for(var Cn=0;Cn<=11;Cn++)ir(Ce[Cn]);ir(17);for(var On=0;On<16;On++)ir(Oe[On+1]);for(var si=0;si<=161;si++)ir(bt[si])})(),Ye(65498),Ye(12),ir(3),ir(1),ir(0),ir(2),ir(17),ir(3),ir(17),ir(0),ir(63),ir(0);var ur=0,dr=0,fr=0;se=0,oe=7,this.encode.displayName="_encode_";for(var Ft,$e,Bt,Qe,st,at,pt,sr,Ee,ze=ht.data,ct=ht.width,ft=ht.height,pr=4*ct,fn=0;fn<ft;){for(Ft=0;Ft<pr;){for(at=st=pr*fn+Ft,pt=-1,sr=0,Ee=0;Ee<64;Ee++)at=st+(sr=Ee>>3)*pr+(pt=4*(7&Ee)),fn+sr>=ft&&(at-=pr*(fn+1+sr-ft)),Ft+pt>=pr&&(at-=Ft+pt-pr+4),$e=ze[at++],Bt=ze[at++],Qe=ze[at++],ee[Ee]=(de[$e]+de[Bt+256|0]+de[Qe+512|0]>>16)-128,ae[Ee]=(de[$e+768|0]+de[Bt+1024|0]+de[Qe+1280|0]>>16)-128,ce[Ee]=(de[$e+1280|0]+de[Bt+1536|0]+de[Qe+1792|0]>>16)-128;ur=xt(ee,W,ur,w,I),dr=xt(ae,V,dr,$,D),fr=xt(ce,V,fr,$,D),Ft+=32}fn+=8}if(oe>=0){var vn=[];vn[1]=oe+1,vn[0]=(1<<oe+1)-1,lt(vn)}return Ye(65497),Buffer.from(re)},new Date().getTime(),g||(g=50),(function(){for(var ht=String.fromCharCode,gt=0;gt<256;gt++)le[gt]=ht(gt)})(),w=Mt(we,pe),$=Mt(Te,Ce),I=Mt(xe,Ge),D=Mt(Oe,bt),(function(){for(var ht=1,gt=2,zt=1;zt<=15;zt++){for(var ur=ht;ur<gt;ur++)Z[32767+ur]=zt,K[32767+ur]=[],K[32767+ur][1]=zt,K[32767+ur][0]=ur;for(var dr=-(gt-1);dr<=-ht;dr++)Z[32767+dr]=zt,K[32767+dr]=[],K[32767+dr][1]=zt,K[32767+dr][0]=gt-1+dr;ht<<=1,gt<<=1}})(),(function(){for(var ht=0;ht<256;ht++)de[ht]=19595*ht,de[ht+256|0]=38470*ht,de[ht+512|0]=7471*ht+32768,de[ht+768|0]=-11059*ht,de[ht+1024|0]=-21709*ht,de[ht+1280|0]=32768*ht+8421375,de[ht+1536|0]=-27439*ht,de[ht+1792|0]=-5329*ht})(),ar(g),new Date().getTime()}encoder.exports=function(g,w){w===void 0&&(w=50);var $=new m(w),I=$.encode(g,w);return{data:I,width:g.width,height:g.height}}})();var encoderExports=encoder.exports,decoder={exports:{}},module,JpegImage;module=decoder,JpegImage=(function(){var d=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),m=4017,g=799,w=3406,$=2276,I=1567,D=3784,q=5793,j=2896;function G(){}function H(re,se){for(var oe,ee,ae=0,ce=[],le=16;le>0&&!re[le-1];)le--;ce.push({children:[],index:0});var de,_e=ce[0];for(oe=0;oe<le;oe++){for(ee=0;ee<re[oe];ee++){for((_e=ce.pop()).children[_e.index]=se[ae];_e.index>0;){if(ce.length===0)throw new Error("Could not recreate Huffman Table");_e=ce.pop()}for(_e.index++,ce.push(_e);ce.length<=oe;)ce.push(de={children:[],index:0}),_e.children[_e.index]=de.children,_e=de;ae++}oe+1<le&&(ce.push(de={children:[],index:0}),_e.children[_e.index]=de.children,_e=de)}return ce[0].children}function W(re,se,oe,ee,ae,ce,le,de,_e,we){oe.precision,oe.samplesPerLine,oe.scanLines;var pe=oe.mcusPerLine,xe=oe.progressive;oe.maxH,oe.maxV;var Ge=se,Te=0,Ce=0;function Oe(){if(Ce>0)return Ce--,Te>>Ce&1;if((Te=re[se++])==255){var sr=re[se++];if(sr)throw new Error("unexpected marker: "+(Te<<8|sr).toString(16))}return Ce=7,Te>>>7}function bt(sr){for(var Ee,ze=sr;(Ee=Oe())!==null;){if(typeof(ze=ze[Ee])=="number")return ze;if(typeof ze!="object")throw new Error("invalid huffman sequence")}return null}function Mt(sr){for(var Ee=0;sr>0;){var ze=Oe();if(ze===null)return;Ee=Ee<<1|ze,sr--}return Ee}function lt(sr){var Ee=Mt(sr);return Ee>=1<<sr-1?Ee:Ee+(-1<<sr)+1}var ir,Ye=0,xt=0;function ar(sr,Ee,ze,ct,ft){var pr=ze%pe,fn=(ze/pe|0)*sr.v+ct,vn=pr*sr.h+ft;sr.blocks[fn]===void 0&&we.tolerantDecoding||Ee(sr,sr.blocks[fn][vn])}function ht(sr,Ee,ze){var ct=ze/sr.blocksPerLine|0,ft=ze%sr.blocksPerLine;sr.blocks[ct]===void 0&&we.tolerantDecoding||Ee(sr,sr.blocks[ct][ft])}var gt,zt,ur,dr,fr,Ft,$e=ee.length;Ft=xe?ce===0?de===0?function(sr,Ee){var ze=bt(sr.huffmanTableDC),ct=ze===0?0:lt(ze)<<_e;Ee[0]=sr.pred+=ct}:function(sr,Ee){Ee[0]|=Oe()<<_e}:de===0?function(sr,Ee){if(Ye>0)Ye--;else for(var ze=ce,ct=le;ze<=ct;){var ft=bt(sr.huffmanTableAC),pr=15&ft,fn=ft>>4;if(pr!==0)Ee[d[ze+=fn]]=lt(pr)*(1<<_e),ze++;else{if(fn<15){Ye=Mt(fn)+(1<<fn)-1;break}ze+=16}}}:function(sr,Ee){for(var ze=ce,ct=le,ft=0;ze<=ct;){var pr=d[ze],fn=Ee[pr]<0?-1:1;switch(xt){case 0:var vn=bt(sr.huffmanTableAC),En=15&vn;if(ft=vn>>4,En===0)ft<15?(Ye=Mt(ft)+(1<<ft),xt=4):(ft=16,xt=1);else{if(En!==1)throw new Error("invalid ACn encoding");ir=lt(En),xt=ft?2:3}continue;case 1:case 2:Ee[pr]?Ee[pr]+=(Oe()<<_e)*fn:--ft==0&&(xt=xt==2?3:0);break;case 3:Ee[pr]?Ee[pr]+=(Oe()<<_e)*fn:(Ee[pr]=ir<<_e,xt=0);break;case 4:Ee[pr]&&(Ee[pr]+=(Oe()<<_e)*fn)}ze++}xt===4&&--Ye==0&&(xt=0)}:function(sr,Ee){var ze=bt(sr.huffmanTableDC),ct=ze===0?0:lt(ze);Ee[0]=sr.pred+=ct;for(var ft=1;ft<64;){var pr=bt(sr.huffmanTableAC),fn=15&pr,vn=pr>>4;if(fn!==0)Ee[d[ft+=vn]]=lt(fn),ft++;else{if(vn<15)break;ft+=16}}};var Bt,Qe,st,at,pt=0;for(Qe=$e==1?ee[0].blocksPerLine*ee[0].blocksPerColumn:pe*oe.mcusPerColumn,ae||(ae=Qe);pt<Qe;){for(zt=0;zt<$e;zt++)ee[zt].pred=0;if(Ye=0,$e==1)for(gt=ee[0],fr=0;fr<ae;fr++)ht(gt,Ft,pt),pt++;else for(fr=0;fr<ae;fr++){for(zt=0;zt<$e;zt++)for(st=(gt=ee[zt]).h,at=gt.v,ur=0;ur<at;ur++)for(dr=0;dr<st;dr++)ar(gt,Ft,pt,ur,dr);if(++pt===Qe)break}if(pt===Qe)do{if(re[se]===255&&re[se+1]!==0)break;se+=1}while(se<re.length-2);if(Ce=0,(Bt=re[se]<<8|re[se+1])<65280)throw new Error("marker was not found");if(!(Bt>=65488&&Bt<=65495))break;se+=2}return se-Ge}function V(re,se){var oe,ee,ae=[],ce=se.blocksPerLine,le=se.blocksPerColumn,de=ce<<3,_e=new Int32Array(64),we=new Uint8Array(64);function pe(Mt,lt,ir){var Ye,xt,ar,ht,gt,zt,ur,dr,fr,Ft,$e=se.quantizationTable,Bt=ir;for(Ft=0;Ft<64;Ft++)Bt[Ft]=Mt[Ft]*$e[Ft];for(Ft=0;Ft<8;++Ft){var Qe=8*Ft;Bt[1+Qe]!=0||Bt[2+Qe]!=0||Bt[3+Qe]!=0||Bt[4+Qe]!=0||Bt[5+Qe]!=0||Bt[6+Qe]!=0||Bt[7+Qe]!=0?(Ye=q*Bt[0+Qe]+128>>8,xt=q*Bt[4+Qe]+128>>8,ar=Bt[2+Qe],ht=Bt[6+Qe],gt=j*(Bt[1+Qe]-Bt[7+Qe])+128>>8,dr=j*(Bt[1+Qe]+Bt[7+Qe])+128>>8,zt=Bt[3+Qe]<<4,ur=Bt[5+Qe]<<4,fr=Ye-xt+1>>1,Ye=Ye+xt+1>>1,xt=fr,fr=ar*D+ht*I+128>>8,ar=ar*I-ht*D+128>>8,ht=fr,fr=gt-ur+1>>1,gt=gt+ur+1>>1,ur=fr,fr=dr+zt+1>>1,zt=dr-zt+1>>1,dr=fr,fr=Ye-ht+1>>1,Ye=Ye+ht+1>>1,ht=fr,fr=xt-ar+1>>1,xt=xt+ar+1>>1,ar=fr,fr=gt*$+dr*w+2048>>12,gt=gt*w-dr*$+2048>>12,dr=fr,fr=zt*g+ur*m+2048>>12,zt=zt*m-ur*g+2048>>12,ur=fr,Bt[0+Qe]=Ye+dr,Bt[7+Qe]=Ye-dr,Bt[1+Qe]=xt+ur,Bt[6+Qe]=xt-ur,Bt[2+Qe]=ar+zt,Bt[5+Qe]=ar-zt,Bt[3+Qe]=ht+gt,Bt[4+Qe]=ht-gt):(fr=q*Bt[0+Qe]+512>>10,Bt[0+Qe]=fr,Bt[1+Qe]=fr,Bt[2+Qe]=fr,Bt[3+Qe]=fr,Bt[4+Qe]=fr,Bt[5+Qe]=fr,Bt[6+Qe]=fr,Bt[7+Qe]=fr)}for(Ft=0;Ft<8;++Ft){var st=Ft;Bt[8+st]!=0||Bt[16+st]!=0||Bt[24+st]!=0||Bt[32+st]!=0||Bt[40+st]!=0||Bt[48+st]!=0||Bt[56+st]!=0?(Ye=q*Bt[0+st]+2048>>12,xt=q*Bt[32+st]+2048>>12,ar=Bt[16+st],ht=Bt[48+st],gt=j*(Bt[8+st]-Bt[56+st])+2048>>12,dr=j*(Bt[8+st]+Bt[56+st])+2048>>12,zt=Bt[24+st],ur=Bt[40+st],fr=Ye-xt+1>>1,Ye=Ye+xt+1>>1,xt=fr,fr=ar*D+ht*I+2048>>12,ar=ar*I-ht*D+2048>>12,ht=fr,fr=gt-ur+1>>1,gt=gt+ur+1>>1,ur=fr,fr=dr+zt+1>>1,zt=dr-zt+1>>1,dr=fr,fr=Ye-ht+1>>1,Ye=Ye+ht+1>>1,ht=fr,fr=xt-ar+1>>1,xt=xt+ar+1>>1,ar=fr,fr=gt*$+dr*w+2048>>12,gt=gt*w-dr*$+2048>>12,dr=fr,fr=zt*g+ur*m+2048>>12,zt=zt*m-ur*g+2048>>12,ur=fr,Bt[0+st]=Ye+dr,Bt[56+st]=Ye-dr,Bt[8+st]=xt+ur,Bt[48+st]=xt-ur,Bt[16+st]=ar+zt,Bt[40+st]=ar-zt,Bt[24+st]=ht+gt,Bt[32+st]=ht-gt):(fr=q*ir[Ft+0]+8192>>14,Bt[0+st]=fr,Bt[8+st]=fr,Bt[16+st]=fr,Bt[24+st]=fr,Bt[32+st]=fr,Bt[40+st]=fr,Bt[48+st]=fr,Bt[56+st]=fr)}for(Ft=0;Ft<64;++Ft){var at=128+(Bt[Ft]+8>>4);lt[Ft]=at<0?0:at>255?255:at}}J(de*le*8);for(var xe=0;xe<le;xe++){var Ge=xe<<3;for(oe=0;oe<8;oe++)ae.push(new Uint8Array(de));for(var Te=0;Te<ce;Te++){pe(se.blocks[xe][Te],we,_e);var Ce=0,Oe=Te<<3;for(ee=0;ee<8;ee++){var bt=ae[Ge+ee];for(oe=0;oe<8;oe++)bt[Oe+oe]=we[Ce++]}}}return ae}function K(re){return re<0?0:re>255?255:re}G.prototype={load:function(re){var se=new XMLHttpRequest;se.open("GET",re,!0),se.responseType="arraybuffer",se.onload=(function(){var oe=new Uint8Array(se.response||se.mozResponseArrayBuffer);this.parse(oe),this.onload&&this.onload()}).bind(this),se.send(null)},parse:function(re){var se=1e3*this.opts.maxResolutionInMP*1e3,oe=0;function ee(){var bn=re[oe]<<8|re[oe+1];return oe+=2,bn}function ae(bn){var $n,xn,ti=1,Cn=1;for(xn in bn.components)bn.components.hasOwnProperty(xn)&&(ti<($n=bn.components[xn]).h&&(ti=$n.h),Cn<$n.v&&(Cn=$n.v));var On=Math.ceil(bn.samplesPerLine/8/ti),si=Math.ceil(bn.scanLines/8/Cn);for(xn in bn.components)if(bn.components.hasOwnProperty(xn)){$n=bn.components[xn];var Tn=Math.ceil(Math.ceil(bn.samplesPerLine/8)*$n.h/ti),or=Math.ceil(Math.ceil(bn.scanLines/8)*$n.v/Cn),kn=On*$n.h,mr=si*$n.v,yn=[];J(mr*kn*256);for(var Dt=0;Dt<mr;Dt++){for(var wn=[],ii=0;ii<kn;ii++)wn.push(new Int32Array(64));yn.push(wn)}$n.blocksPerLine=Tn,$n.blocksPerColumn=or,$n.blocks=yn}bn.maxH=ti,bn.maxV=Cn,bn.mcusPerLine=On,bn.mcusPerColumn=si}re.length;var ce,le,de,_e,we=null,pe=null,xe=[],Ge=[],Te=[],Ce=[],Oe=ee(),bt=-1;if(this.comments=[],Oe!=65496)throw new Error("SOI not found");for(Oe=ee();Oe!=65497;){switch(Oe){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Mt=(de=void 0,_e=void 0,de=ee(),_e=re.subarray(oe,oe+de-2),oe+=_e.length,_e);if(Oe===65534){var lt=String.fromCharCode.apply(null,Mt);this.comments.push(lt)}Oe===65504&&Mt[0]===74&&Mt[1]===70&&Mt[2]===73&&Mt[3]===70&&Mt[4]===0&&(we={version:{major:Mt[5],minor:Mt[6]},densityUnits:Mt[7],xDensity:Mt[8]<<8|Mt[9],yDensity:Mt[10]<<8|Mt[11],thumbWidth:Mt[12],thumbHeight:Mt[13],thumbData:Mt.subarray(14,14+3*Mt[12]*Mt[13])}),Oe===65505&&Mt[0]===69&&Mt[1]===120&&Mt[2]===105&&Mt[3]===102&&Mt[4]===0&&(this.exifBuffer=Mt.subarray(5,Mt.length)),Oe===65518&&Mt[0]===65&&Mt[1]===100&&Mt[2]===111&&Mt[3]===98&&Mt[4]===101&&Mt[5]===0&&(pe={version:Mt[6],flags0:Mt[7]<<8|Mt[8],flags1:Mt[9]<<8|Mt[10],transformCode:Mt[11]});break;case 65499:for(var ir=ee()+oe-2;oe<ir;){var Ye=re[oe++];J(256);var xt=new Int32Array(64);if(Ye>>4){if(Ye>>4!=1)throw new Error("DQT: invalid table spec");for(vn=0;vn<64;vn++)xt[d[vn]]=ee()}else for(vn=0;vn<64;vn++)xt[d[vn]]=re[oe++];xe[15&Ye]=xt}break;case 65472:case 65473:case 65474:ee(),(ce={}).extended=Oe===65473,ce.progressive=Oe===65474,ce.precision=re[oe++],ce.scanLines=ee(),ce.samplesPerLine=ee(),ce.components={},ce.componentsOrder=[];var ar=ce.scanLines*ce.samplesPerLine;if(ar>se){var ht=Math.ceil((ar-se)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${ht}MP`)}var gt,zt=re[oe++];for(pr=0;pr<zt;pr++){gt=re[oe];var ur=re[oe+1]>>4,dr=15&re[oe+1],fr=re[oe+2];if(ur<=0||dr<=0)throw new Error("Invalid sampling factor, expected values above 0");ce.componentsOrder.push(gt),ce.components[gt]={h:ur,v:dr,quantizationIdx:fr},oe+=3}ae(ce),Ge.push(ce);break;case 65476:var Ft=ee();for(pr=2;pr<Ft;){var $e=re[oe++],Bt=new Uint8Array(16),Qe=0;for(vn=0;vn<16;vn++,oe++)Qe+=Bt[vn]=re[oe];J(16+Qe);var st=new Uint8Array(Qe);for(vn=0;vn<Qe;vn++,oe++)st[vn]=re[oe];pr+=17+Qe,($e>>4?Te:Ce)[15&$e]=H(Bt,st)}break;case 65501:ee(),le=ee();break;case 65500:ee(),ee();break;case 65498:ee();var at=re[oe++],pt=[];for(pr=0;pr<at;pr++){En=ce.components[re[oe++]];var sr=re[oe++];En.huffmanTableDC=Ce[sr>>4],En.huffmanTableAC=Te[15&sr],pt.push(En)}var Ee=re[oe++],ze=re[oe++],ct=re[oe++],ft=W(re,oe,ce,pt,le,Ee,ze,ct>>4,15&ct,this.opts);oe+=ft;break;case 65535:re[oe]!==255&&oe--;break;default:if(re[oe-3]==255&&re[oe-2]>=192&&re[oe-2]<=254){oe-=3;break}if(Oe===224||Oe==225){if(bt!==-1)throw new Error(`first unknown JPEG marker at offset ${bt.toString(16)}, second unknown JPEG marker ${Oe.toString(16)} at offset ${(oe-1).toString(16)}`);bt=oe-1;const bn=ee();if(re[oe+bn-2]===255){oe+=bn-2;break}}throw new Error("unknown JPEG marker "+Oe.toString(16))}Oe=ee()}if(Ge.length!=1)throw new Error("only single frame JPEGs supported");for(var pr=0;pr<Ge.length;pr++){var fn=Ge[pr].components;for(var vn in fn)fn[vn].quantizationTable=xe[fn[vn].quantizationIdx],delete fn[vn].quantizationIdx}for(this.width=ce.samplesPerLine,this.height=ce.scanLines,this.jfif=we,this.adobe=pe,this.components=[],pr=0;pr<ce.componentsOrder.length;pr++){var En=ce.components[ce.componentsOrder[pr]];this.components.push({lines:V(0,En),scaleX:En.h/ce.maxH,scaleY:En.v/ce.maxV})}},getData:function(re,se){var oe,ee,ae,ce,le,de,_e,we,pe,xe,Ge,Te,Ce,Oe,bt,Mt,lt,ir,Ye,xt,ar,ht=this.width/re,gt=this.height/se,zt=0,ur=re*se*this.components.length;J(ur);var dr=new Uint8Array(ur);switch(this.components.length){case 1:for(oe=this.components[0],xe=0;xe<se;xe++)for(le=oe.lines[0|xe*oe.scaleY*gt],pe=0;pe<re;pe++)Ge=le[0|pe*oe.scaleX*ht],dr[zt++]=Ge;break;case 2:for(oe=this.components[0],ee=this.components[1],xe=0;xe<se;xe++)for(le=oe.lines[0|xe*oe.scaleY*gt],de=ee.lines[0|xe*ee.scaleY*gt],pe=0;pe<re;pe++)Ge=le[0|pe*oe.scaleX*ht],dr[zt++]=Ge,Ge=de[0|pe*ee.scaleX*ht],dr[zt++]=Ge;break;case 3:for(ar=!0,this.adobe&&this.adobe.transformCode?ar=!0:this.opts.colorTransform!==void 0&&(ar=!!this.opts.colorTransform),oe=this.components[0],ee=this.components[1],ae=this.components[2],xe=0;xe<se;xe++)for(le=oe.lines[0|xe*oe.scaleY*gt],de=ee.lines[0|xe*ee.scaleY*gt],_e=ae.lines[0|xe*ae.scaleY*gt],pe=0;pe<re;pe++)ar?(Ge=le[0|pe*oe.scaleX*ht],Te=de[0|pe*ee.scaleX*ht],ir=K(Ge+1.402*((Ce=_e[0|pe*ae.scaleX*ht])-128)),Ye=K(Ge-.3441363*(Te-128)-.71413636*(Ce-128)),xt=K(Ge+1.772*(Te-128))):(ir=le[0|pe*oe.scaleX*ht],Ye=de[0|pe*ee.scaleX*ht],xt=_e[0|pe*ae.scaleX*ht]),dr[zt++]=ir,dr[zt++]=Ye,dr[zt++]=xt;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(ar=!1,this.adobe&&this.adobe.transformCode?ar=!0:this.opts.colorTransform!==void 0&&(ar=!!this.opts.colorTransform),oe=this.components[0],ee=this.components[1],ae=this.components[2],ce=this.components[3],xe=0;xe<se;xe++)for(le=oe.lines[0|xe*oe.scaleY*gt],de=ee.lines[0|xe*ee.scaleY*gt],_e=ae.lines[0|xe*ae.scaleY*gt],we=ce.lines[0|xe*ce.scaleY*gt],pe=0;pe<re;pe++)ar?(Ge=le[0|pe*oe.scaleX*ht],Te=de[0|pe*ee.scaleX*ht],Ce=_e[0|pe*ae.scaleX*ht],Oe=we[0|pe*ce.scaleX*ht],bt=255-K(Ge+1.402*(Ce-128)),Mt=255-K(Ge-.3441363*(Te-128)-.71413636*(Ce-128)),lt=255-K(Ge+1.772*(Te-128))):(bt=le[0|pe*oe.scaleX*ht],Mt=de[0|pe*ee.scaleX*ht],lt=_e[0|pe*ae.scaleX*ht],Oe=we[0|pe*ce.scaleX*ht]),dr[zt++]=255-bt,dr[zt++]=255-Mt,dr[zt++]=255-lt,dr[zt++]=255-Oe;break;default:throw new Error("Unsupported color mode")}return dr},copyToImageData:function(re,se){var oe,ee,ae,ce,le,de,_e,we,pe,xe=re.width,Ge=re.height,Te=re.data,Ce=this.getData(xe,Ge),Oe=0,bt=0;switch(this.components.length){case 1:for(ee=0;ee<Ge;ee++)for(oe=0;oe<xe;oe++)ae=Ce[Oe++],Te[bt++]=ae,Te[bt++]=ae,Te[bt++]=ae,se&&(Te[bt++]=255);break;case 3:for(ee=0;ee<Ge;ee++)for(oe=0;oe<xe;oe++)_e=Ce[Oe++],we=Ce[Oe++],pe=Ce[Oe++],Te[bt++]=_e,Te[bt++]=we,Te[bt++]=pe,se&&(Te[bt++]=255);break;case 4:for(ee=0;ee<Ge;ee++)for(oe=0;oe<xe;oe++)le=Ce[Oe++],de=Ce[Oe++],ae=Ce[Oe++],_e=255-K(le*(1-(ce=Ce[Oe++])/255)+ce),we=255-K(de*(1-ce/255)+ce),pe=255-K(ae*(1-ce/255)+ce),Te[bt++]=_e,Te[bt++]=we,Te[bt++]=pe,se&&(Te[bt++]=255);break;default:throw new Error("Unsupported color mode")}}};var Z=0,Q=0;function J(re=0){var se=Z+re;if(se>Q){var oe=Math.ceil((se-Q)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${oe}MB`)}Z=se}return G.resetMaxMemoryUsage=function(re){Z=0,Q=re},G.getBytesAllocated=function(){return Z},G.requestMemoryAllocation=J,G})(),module.exports=function(d,m={}){var g={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...m},w=new Uint8Array(d),$=new JpegImage;$.opts=g,JpegImage.resetMaxMemoryUsage(1024*g.maxMemoryUsageInMB*1024),$.parse(w);var I=g.formatAsRGBA?4:3,D=$.width*$.height*I;try{JpegImage.requestMemoryAllocation(D);var q={width:$.width,height:$.height,exifBuffer:$.exifBuffer,data:g.useTArray?new Uint8Array(D):Buffer.alloc(D)};$.comments.length>0&&(q.comments=$.comments)}catch(j){throw j instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+D):j instanceof ReferenceError&&j.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):j}return $.copyToImageData(q,g.formatAsRGBA),q};var decoderExports=decoder.exports,encode=encoderExports,decode=decoderExports,jpegJs={encode,decode},JPEG=getDefaultExportFromCjs(jpegJs);function jpeg$2(){return{mime:"image/jpeg",encode:(d,{quality:m=100}={})=>JPEG.encode(d,m).data,decode:(d,m)=>JPEG.decode(d,m)}}function commonjsRequire(d){throw new Error('Could not dynamically require "'+d+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var browser$1={exports:{}};browser$1.exports=(function(){function d(m,g,w){function $(q,j){if(!g[q]){if(!m[q]){var G=typeof commonjsRequire=="function"&&commonjsRequire;if(!j&&G)return G(q,!0);if(I)return I(q,!0);var H=new Error("Cannot find module '"+q+"'");throw H.code="MODULE_NOT_FOUND",H}var W=g[q]={exports:{}};m[q][0].call(W.exports,(function(V){return $(m[q][1][V]||V)}),W,W.exports,d,m,g,w)}return g[q].exports}for(var I=typeof commonjsRequire=="function"&&commonjsRequire,D=0;D<w.length;D++)$(w[D]);return $}return d})()({1:[function(d,m,g){(function(w){(function(){let $=d("./interlace"),I=[function(){},function(H,W,V,K){if(K===W.length)throw new Error("Ran out of data");let Z=W[K];H[V]=Z,H[V+1]=Z,H[V+2]=Z,H[V+3]=255},function(H,W,V,K){if(K+1>=W.length)throw new Error("Ran out of data");let Z=W[K];H[V]=Z,H[V+1]=Z,H[V+2]=Z,H[V+3]=W[K+1]},function(H,W,V,K){if(K+2>=W.length)throw new Error("Ran out of data");H[V]=W[K],H[V+1]=W[K+1],H[V+2]=W[K+2],H[V+3]=255},function(H,W,V,K){if(K+3>=W.length)throw new Error("Ran out of data");H[V]=W[K],H[V+1]=W[K+1],H[V+2]=W[K+2],H[V+3]=W[K+3]}],D=[function(){},function(H,W,V,K){let Z=W[0];H[V]=Z,H[V+1]=Z,H[V+2]=Z,H[V+3]=K},function(H,W,V){let K=W[0];H[V]=K,H[V+1]=K,H[V+2]=K,H[V+3]=W[1]},function(H,W,V,K){H[V]=W[0],H[V+1]=W[1],H[V+2]=W[2],H[V+3]=K},function(H,W,V){H[V]=W[0],H[V+1]=W[1],H[V+2]=W[2],H[V+3]=W[3]}];function q(H,W){let V=[],K=0;function Z(){if(K===H.length)throw new Error("Ran out of data");let Q,J,re,se,oe,ee,ae,ce,le=H[K];switch(K++,W){default:throw new Error("unrecognised depth");case 16:ae=H[K],K++,V.push((le<<8)+ae);break;case 4:ae=15&le,ce=le>>4,V.push(ce,ae);break;case 2:oe=3&le,ee=le>>2&3,ae=le>>4&3,ce=le>>6&3,V.push(ce,ae,ee,oe);break;case 1:Q=1&le,J=le>>1&1,re=le>>2&1,se=le>>3&1,oe=le>>4&1,ee=le>>5&1,ae=le>>6&1,ce=le>>7&1,V.push(ce,ae,ee,oe,se,re,J,Q)}}return{get:function(Q){for(;V.length<Q;)Z();let J=V.slice(0,Q);return V=V.slice(Q),J},resetAfterLine:function(){V.length=0},end:function(){if(K!==H.length)throw new Error("extra data found")}}}function j(H,W,V,K,Z,Q){let J=H.width,re=H.height,se=H.index;for(let oe=0;oe<re;oe++)for(let ee=0;ee<J;ee++){let ae=V(ee,oe,se);I[K](W,Z,ae,Q),Q+=K}return Q}function G(H,W,V,K,Z,Q){let J=H.width,re=H.height,se=H.index;for(let oe=0;oe<re;oe++){for(let ee=0;ee<J;ee++){let ae=Z.get(K),ce=V(ee,oe,se);D[K](W,ae,ce,Q)}Z.resetAfterLine()}}g.dataToBitMap=function(H,W){let V,K,Z=W.width,Q=W.height,J=W.depth,re=W.bpp,se=W.interlace;J!==8&&(V=q(H,J)),K=J<=8?w.alloc(Z*Q*4):new Uint16Array(Z*Q*4);let oe,ee,ae=Math.pow(2,J)-1,ce=0;if(se)oe=$.getImagePasses(Z,Q),ee=$.getInterlaceIterator(Z,Q);else{let le=0;ee=function(){let de=le;return le+=4,de},oe=[{width:Z,height:Q}]}for(let le=0;le<oe.length;le++)J===8?ce=j(oe[le],K,ee,re,H,ce):G(oe[le],K,ee,re,V,ae);if(J===8){if(ce!==H.length)throw new Error("extra data found")}else V.end();return K}}).call(this)}).call(this,d("buffer").Buffer)},{"./interlace":11,buffer:32}],2:[function(d,m,g){(function(w){(function(){let $=d("./constants");m.exports=function(I,D,q,j){let G=[$.COLORTYPE_COLOR_ALPHA,$.COLORTYPE_ALPHA].indexOf(j.colorType)!==-1;if(j.colorType===j.inputColorType){let oe=(function(){let ee=new ArrayBuffer(2);return new DataView(ee).setInt16(0,256,!0),new Int16Array(ee)[0]!==256})();if(j.bitDepth===8||j.bitDepth===16&&oe)return I}let H=j.bitDepth!==16?I:new Uint16Array(I.buffer),W=255,V=$.COLORTYPE_TO_BPP_MAP[j.inputColorType];V!==4||j.inputHasAlpha||(V=3);let K=$.COLORTYPE_TO_BPP_MAP[j.colorType];j.bitDepth===16&&(W=65535,K*=2);let Z=w.alloc(D*q*K),Q=0,J=0,re=j.bgColor||{};function se(){let oe,ee,ae,ce=W;switch(j.inputColorType){case $.COLORTYPE_COLOR_ALPHA:ce=H[Q+3],oe=H[Q],ee=H[Q+1],ae=H[Q+2];break;case $.COLORTYPE_COLOR:oe=H[Q],ee=H[Q+1],ae=H[Q+2];break;case $.COLORTYPE_ALPHA:ce=H[Q+1],oe=H[Q],ee=oe,ae=oe;break;case $.COLORTYPE_GRAYSCALE:oe=H[Q],ee=oe,ae=oe;break;default:throw new Error("input color type:"+j.inputColorType+" is not supported at present")}return j.inputHasAlpha&&(G||(ce/=W,oe=Math.min(Math.max(Math.round((1-ce)*re.red+ce*oe),0),W),ee=Math.min(Math.max(Math.round((1-ce)*re.green+ce*ee),0),W),ae=Math.min(Math.max(Math.round((1-ce)*re.blue+ce*ae),0),W))),{red:oe,green:ee,blue:ae,alpha:ce}}re.red===void 0&&(re.red=W),re.green===void 0&&(re.green=W),re.blue===void 0&&(re.blue=W);for(let oe=0;oe<q;oe++)for(let ee=0;ee<D;ee++){let ae=se();switch(j.colorType){case $.COLORTYPE_COLOR_ALPHA:case $.COLORTYPE_COLOR:j.bitDepth===8?(Z[J]=ae.red,Z[J+1]=ae.green,Z[J+2]=ae.blue,G&&(Z[J+3]=ae.alpha)):(Z.writeUInt16BE(ae.red,J),Z.writeUInt16BE(ae.green,J+2),Z.writeUInt16BE(ae.blue,J+4),G&&Z.writeUInt16BE(ae.alpha,J+6));break;case $.COLORTYPE_ALPHA:case $.COLORTYPE_GRAYSCALE:{let ce=(ae.red+ae.green+ae.blue)/3;j.bitDepth===8?(Z[J]=ce,G&&(Z[J+1]=ae.alpha)):(Z.writeUInt16BE(ce,J),G&&Z.writeUInt16BE(ae.alpha,J+2));break}default:throw new Error("unrecognised color Type "+j.colorType)}Q+=V,J+=K}return Z}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,buffer:32}],3:[function(d,m,g){(function(w,$){(function(){let I=d("util"),D=d("stream"),q=m.exports=function(){D.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};I.inherits(q,D),q.prototype.read=function(j,G){this._reads.push({length:Math.abs(j),allowLess:j<0,func:G}),w.nextTick((function(){this._process(),this._paused&&this._reads&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}).bind(this))},q.prototype.write=function(j,G){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;let H;return H=$.isBuffer(j)?j:$.from(j,G||this._encoding),this._buffers.push(H),this._buffered+=H.length,this._process(),this._reads&&this._reads.length===0&&(this._paused=!0),this.writable&&!this._paused},q.prototype.end=function(j,G){j&&this.write(j,G),this.writable=!1,this._buffers&&(this._buffers.length===0?this._end():(this._buffers.push(null),this._process()))},q.prototype.destroySoon=q.prototype.end,q.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("Unexpected end of input")),this.destroy()},q.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},q.prototype._processReadAllowingLess=function(j){this._reads.shift();let G=this._buffers[0];G.length>j.length?(this._buffered-=j.length,this._buffers[0]=G.slice(j.length),j.func.call(this,G.slice(0,j.length))):(this._buffered-=G.length,this._buffers.shift(),j.func.call(this,G))},q.prototype._processRead=function(j){this._reads.shift();let G=0,H=0,W=$.alloc(j.length);for(;G<j.length;){let V=this._buffers[H++],K=Math.min(V.length,j.length-G);V.copy(W,G,0,K),G+=K,K!==V.length&&(this._buffers[--H]=V.slice(K))}H>0&&this._buffers.splice(0,H),this._buffered-=j.length,j.func.call(this,W)},q.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){let j=this._reads[0];if(j.allowLess)this._processReadAllowingLess(j);else{if(!(this._buffered>=j.length))break;this._processRead(j)}}this._buffers&&!this.writable&&this._end()}catch(j){this.emit("error",j)}}}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{_process:63,buffer:32,stream:65,util:84}],4:[function(d,m,g){m.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],5:[function(d,m,g){let w=[];(function(){for(let I=0;I<256;I++){let D=I;for(let q=0;q<8;q++)1&D?D=3988292384^D>>>1:D>>>=1;w[I]=D}})();let $=m.exports=function(){this._crc=-1};$.prototype.write=function(I){for(let D=0;D<I.length;D++)this._crc=w[255&(this._crc^I[D])]^this._crc>>>8;return!0},$.prototype.crc32=function(){return~this._crc},$.crc32=function(I){let D=-1;for(let q=0;q<I.length;q++)D=w[255&(D^I[q])]^D>>>8;return~D}},{}],6:[function(d,m,g){(function(w){(function(){let $=d("./paeth-predictor");function I(re,se,oe,ee,ae){for(let ce=0;ce<oe;ce++)ee[ae+ce]=re[se+ce]}function D(re,se,oe){let ee=0,ae=se+oe;for(let ce=se;ce<ae;ce++)ee+=Math.abs(re[ce]);return ee}function q(re,se,oe,ee,ae,ce){for(let le=0;le<oe;le++){let de=le>=ce?re[se+le-ce]:0,_e=re[se+le]-de;ee[ae+le]=_e}}function j(re,se,oe,ee){let ae=0;for(let ce=0;ce<oe;ce++){let le=ce>=ee?re[se+ce-ee]:0,de=re[se+ce]-le;ae+=Math.abs(de)}return ae}function G(re,se,oe,ee,ae){for(let ce=0;ce<oe;ce++){let le=se>0?re[se+ce-oe]:0,de=re[se+ce]-le;ee[ae+ce]=de}}function H(re,se,oe){let ee=0,ae=se+oe;for(let ce=se;ce<ae;ce++){let le=se>0?re[ce-oe]:0,de=re[ce]-le;ee+=Math.abs(de)}return ee}function W(re,se,oe,ee,ae,ce){for(let le=0;le<oe;le++){let de=le>=ce?re[se+le-ce]:0,_e=se>0?re[se+le-oe]:0,we=re[se+le]-(de+_e>>1);ee[ae+le]=we}}function V(re,se,oe,ee){let ae=0;for(let ce=0;ce<oe;ce++){let le=ce>=ee?re[se+ce-ee]:0,de=se>0?re[se+ce-oe]:0,_e=re[se+ce]-(le+de>>1);ae+=Math.abs(_e)}return ae}function K(re,se,oe,ee,ae,ce){for(let le=0;le<oe;le++){let de=le>=ce?re[se+le-ce]:0,_e=se>0?re[se+le-oe]:0,we=se>0&&le>=ce?re[se+le-(oe+ce)]:0,pe=re[se+le]-$(de,_e,we);ee[ae+le]=pe}}function Z(re,se,oe,ee){let ae=0;for(let ce=0;ce<oe;ce++){let le=ce>=ee?re[se+ce-ee]:0,de=se>0?re[se+ce-oe]:0,_e=se>0&&ce>=ee?re[se+ce-(oe+ee)]:0,we=re[se+ce]-$(le,de,_e);ae+=Math.abs(we)}return ae}let Q={0:I,1:q,2:G,3:W,4:K},J={0:D,1:j,2:H,3:V,4:Z};m.exports=function(re,se,oe,ee,ae){let ce;if("filterType"in ee&&ee.filterType!==-1){if(typeof ee.filterType!="number")throw new Error("unrecognised filter types");ce=[ee.filterType]}else ce=[0,1,2,3,4];ee.bitDepth===16&&(ae*=2);let le=se*ae,de=0,_e=0,we=w.alloc((le+1)*oe),pe=ce[0];for(let xe=0;xe<oe;xe++){if(ce.length>1){let Ge=1/0;for(let Te=0;Te<ce.length;Te++){let Ce=J[ce[Te]](re,_e,le,ae);Ce<Ge&&(pe=ce[Te],Ge=Ce)}}we[de]=pe,de++,Q[pe](re,_e,le,we,de,ae),de+=le,_e+=le}return we}}).call(this)}).call(this,d("buffer").Buffer)},{"./paeth-predictor":15,buffer:32}],7:[function(d,m,g){(function(w){(function(){let $=d("util"),I=d("./chunkstream"),D=d("./filter-parse"),q=m.exports=function(j){I.call(this);let G=[],H=this;this._filter=new D(j,{read:this.read.bind(this),write:function(W){G.push(W)},complete:function(){H.emit("complete",w.concat(G))}}),this._filter.start()};$.inherits(q,I)}).call(this)}).call(this,d("buffer").Buffer)},{"./chunkstream":3,"./filter-parse":9,buffer:32,util:84}],8:[function(d,m,g){(function(w){(function(){let $=d("./sync-reader"),I=d("./filter-parse");g.process=function(D,q){let j=[],G=new $(D);return new I(q,{read:G.read.bind(G),write:function(H){j.push(H)},complete:function(){}}).start(),G.process(),w.concat(j)}}).call(this)}).call(this,d("buffer").Buffer)},{"./filter-parse":9,"./sync-reader":22,buffer:32}],9:[function(d,m,g){(function(w){(function(){let $=d("./interlace"),I=d("./paeth-predictor");function D(j,G,H){let W=j*G;return H!==8&&(W=Math.ceil(W/(8/H))),W}let q=m.exports=function(j,G){let H=j.width,W=j.height,V=j.interlace,K=j.bpp,Z=j.depth;if(this.read=G.read,this.write=G.write,this.complete=G.complete,this._imageIndex=0,this._images=[],V){let Q=$.getImagePasses(H,W);for(let J=0;J<Q.length;J++)this._images.push({byteWidth:D(Q[J].width,K,Z),height:Q[J].height,lineIndex:0})}else this._images.push({byteWidth:D(H,K,Z),height:W,lineIndex:0});this._xComparison=Z===8?K:Z===16?2*K:1};q.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},q.prototype._unFilterType1=function(j,G,H){let W=this._xComparison,V=W-1;for(let K=0;K<H;K++){let Z=j[1+K],Q=K>V?G[K-W]:0;G[K]=Z+Q}},q.prototype._unFilterType2=function(j,G,H){let W=this._lastLine;for(let V=0;V<H;V++){let K=j[1+V],Z=W?W[V]:0;G[V]=K+Z}},q.prototype._unFilterType3=function(j,G,H){let W=this._xComparison,V=W-1,K=this._lastLine;for(let Z=0;Z<H;Z++){let Q=j[1+Z],J=K?K[Z]:0,re=Z>V?G[Z-W]:0,se=Math.floor((re+J)/2);G[Z]=Q+se}},q.prototype._unFilterType4=function(j,G,H){let W=this._xComparison,V=W-1,K=this._lastLine;for(let Z=0;Z<H;Z++){let Q=j[1+Z],J=K?K[Z]:0,re=Z>V?G[Z-W]:0,se=Z>V&&K?K[Z-W]:0,oe=I(re,J,se);G[Z]=Q+oe}},q.prototype._reverseFilterLine=function(j){let G,H=j[0],W=this._images[this._imageIndex],V=W.byteWidth;if(H===0)G=j.slice(1,V+1);else switch(G=w.alloc(V),H){case 1:this._unFilterType1(j,G,V);break;case 2:this._unFilterType2(j,G,V);break;case 3:this._unFilterType3(j,G,V);break;case 4:this._unFilterType4(j,G,V);break;default:throw new Error("Unrecognised filter type - "+H)}this.write(G),W.lineIndex++,W.lineIndex>=W.height?(this._lastLine=null,this._imageIndex++,W=this._images[this._imageIndex]):this._lastLine=G,W?this.read(W.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}}).call(this)}).call(this,d("buffer").Buffer)},{"./interlace":11,"./paeth-predictor":15,buffer:32}],10:[function(d,m,g){(function(w){(function(){function $(q,j,G,H,W){let V=0;for(let K=0;K<H;K++)for(let Z=0;Z<G;Z++){let Q=W[q[V]];if(!Q)throw new Error("index "+q[V]+" not in palette");for(let J=0;J<4;J++)j[V+J]=Q[J];V+=4}}function I(q,j,G,H,W){let V=0;for(let K=0;K<H;K++)for(let Z=0;Z<G;Z++){let Q=!1;if(W.length===1?W[0]===q[V]&&(Q=!0):W[0]===q[V]&&W[1]===q[V+1]&&W[2]===q[V+2]&&(Q=!0),Q)for(let J=0;J<4;J++)j[V+J]=0;V+=4}}function D(q,j,G,H,W){let V=255,K=Math.pow(2,W)-1,Z=0;for(let Q=0;Q<H;Q++)for(let J=0;J<G;J++){for(let re=0;re<4;re++)j[Z+re]=Math.floor(q[Z+re]*V/K+.5);Z+=4}}m.exports=function(q,j,G=!1){let H=j.depth,W=j.width,V=j.height,K=j.colorType,Z=j.transColor,Q=j.palette,J=q;return K===3?$(q,J,W,V,Q):(Z&&I(q,J,W,V,Z),H===8||G||(H===16&&(J=w.alloc(W*V*4)),D(q,J,W,V,H))),J}}).call(this)}).call(this,d("buffer").Buffer)},{buffer:32}],11:[function(d,m,g){let w=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];g.getImagePasses=function($,I){let D=[],q=$%8,j=I%8,G=($-q)/8,H=(I-j)/8;for(let W=0;W<w.length;W++){let V=w[W],K=G*V.x.length,Z=H*V.y.length;for(let Q=0;Q<V.x.length&&V.x[Q]<q;Q++)K++;for(let Q=0;Q<V.y.length&&V.y[Q]<j;Q++)Z++;K>0&&Z>0&&D.push({width:K,height:Z,index:W})}return D},g.getInterlaceIterator=function($){return function(I,D,q){let j=I%w[q].x.length,G=(I-j)/w[q].x.length*8+w[q].x[j],H=D%w[q].y.length;return 4*G+((D-H)/w[q].y.length*8+w[q].y[H])*$*4}}},{}],12:[function(d,m,g){(function(w){(function(){let $=d("util"),I=d("stream"),D=d("./constants"),q=d("./packer"),j=m.exports=function(G){I.call(this);let H=G||{};this._packer=new q(H),this._deflate=this._packer.createDeflate(),this.readable=!0};$.inherits(j,I),j.prototype.pack=function(G,H,W,V){this.emit("data",w.from(D.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(H,W)),V&&this.emit("data",this._packer.packGAMA(V));let K=this._packer.filterData(G,H,W);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",(function(Z){this.emit("data",this._packer.packIDAT(Z))}).bind(this)),this._deflate.on("end",(function(){this.emit("data",this._packer.packIEND()),this.emit("end")}).bind(this)),this._deflate.end(K)}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:32,stream:65,util:84}],13:[function(d,m,g){(function(w){(function(){let $=!0,I=d("zlib");I.deflateSync||($=!1);let D=d("./constants"),q=d("./packer");m.exports=function(j,G){if(!$)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let H=new q(G||{}),W=[];W.push(w.from(D.PNG_SIGNATURE)),W.push(H.packIHDR(j.width,j.height)),j.gamma&&W.push(H.packGAMA(j.gamma));let V=H.filterData(j.data,j.width,j.height),K=I.deflateSync(V,H.getDeflateOptions());if(V=null,!K||!K.length)throw new Error("bad png - invalid compressed data response");return W.push(H.packIDAT(K)),W.push(H.packIEND()),w.concat(W)}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:32,zlib:31}],14:[function(d,m,g){(function(w){(function(){let $=d("./constants"),I=d("./crc"),D=d("./bitpacker"),q=d("./filter-pack"),j=d("zlib"),G=m.exports=function(H){if(this._options=H,H.deflateChunkSize=H.deflateChunkSize||32768,H.deflateLevel=H.deflateLevel!=null?H.deflateLevel:9,H.deflateStrategy=H.deflateStrategy!=null?H.deflateStrategy:3,H.inputHasAlpha=H.inputHasAlpha==null||H.inputHasAlpha,H.deflateFactory=H.deflateFactory||j.createDeflate,H.bitDepth=H.bitDepth||8,H.colorType=typeof H.colorType=="number"?H.colorType:$.COLORTYPE_COLOR_ALPHA,H.inputColorType=typeof H.inputColorType=="number"?H.inputColorType:$.COLORTYPE_COLOR_ALPHA,[$.COLORTYPE_GRAYSCALE,$.COLORTYPE_COLOR,$.COLORTYPE_COLOR_ALPHA,$.COLORTYPE_ALPHA].indexOf(H.colorType)===-1)throw new Error("option color type:"+H.colorType+" is not supported at present");if([$.COLORTYPE_GRAYSCALE,$.COLORTYPE_COLOR,$.COLORTYPE_COLOR_ALPHA,$.COLORTYPE_ALPHA].indexOf(H.inputColorType)===-1)throw new Error("option input color type:"+H.inputColorType+" is not supported at present");if(H.bitDepth!==8&&H.bitDepth!==16)throw new Error("option bit depth:"+H.bitDepth+" is not supported at present")};G.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},G.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},G.prototype.filterData=function(H,W,V){let K=D(H,W,V,this._options),Z=$.COLORTYPE_TO_BPP_MAP[this._options.colorType];return q(K,W,V,this._options,Z)},G.prototype._packChunk=function(H,W){let V=W?W.length:0,K=w.alloc(V+12);return K.writeUInt32BE(V,0),K.writeUInt32BE(H,4),W&&W.copy(K,8),K.writeInt32BE(I.crc32(K.slice(4,K.length-4)),K.length-4),K},G.prototype.packGAMA=function(H){let W=w.alloc(4);return W.writeUInt32BE(Math.floor(H*$.GAMMA_DIVISION),0),this._packChunk($.TYPE_gAMA,W)},G.prototype.packIHDR=function(H,W){let V=w.alloc(13);return V.writeUInt32BE(H,0),V.writeUInt32BE(W,4),V[8]=this._options.bitDepth,V[9]=this._options.colorType,V[10]=0,V[11]=0,V[12]=0,this._packChunk($.TYPE_IHDR,V)},G.prototype.packIDAT=function(H){return this._packChunk($.TYPE_IDAT,H)},G.prototype.packIEND=function(){return this._packChunk($.TYPE_IEND,null)}}).call(this)}).call(this,d("buffer").Buffer)},{"./bitpacker":2,"./constants":4,"./crc":5,"./filter-pack":6,buffer:32,zlib:31}],15:[function(d,m,g){m.exports=function(w,$,I){let D=w+$-I,q=Math.abs(D-w),j=Math.abs(D-$),G=Math.abs(D-I);return q<=j&&q<=G?w:j<=G?$:I}},{}],16:[function(d,m,g){let w=d("util"),$=d("zlib"),I=d("./chunkstream"),D=d("./filter-parse-async"),q=d("./parser"),j=d("./bitmapper"),G=d("./format-normaliser"),H=m.exports=function(W){I.call(this),this._parser=new q(W,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=W,this.writable=!0,this._parser.start()};w.inherits(H,I),H.prototype._handleError=function(W){this.emit("error",W),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",(function(){}))),this.errord=!0},H.prototype._inflateData=function(W){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=$.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{let V=(1+(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3))*this._bitmapInfo.height,K=Math.max(V,$.Z_MIN_CHUNK);this._inflate=$.createInflate({chunkSize:K});let Z=V,Q=this.emit.bind(this,"error");this._inflate.on("error",(function(re){Z&&Q(re)})),this._filter.on("complete",this._complete.bind(this));let J=this._filter.write.bind(this._filter);this._inflate.on("data",(function(re){Z&&(re.length>Z&&(re=re.slice(0,Z)),Z-=re.length,J(re))})),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(W)},H.prototype._handleMetaData=function(W){this._metaData=W,this._bitmapInfo=Object.create(W),this._filter=new D(this._bitmapInfo)},H.prototype._handleTransColor=function(W){this._bitmapInfo.transColor=W},H.prototype._handlePalette=function(W){this._bitmapInfo.palette=W},H.prototype._simpleTransparency=function(){this._metaData.alpha=!0},H.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},H.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"))},H.prototype._complete=function(W){if(this.errord)return;let V;try{let K=j.dataToBitMap(W,this._bitmapInfo);V=G(K,this._bitmapInfo,this._options.skipRescale),K=null}catch(K){return void this._handleError(K)}this.emit("parsed",V)}},{"./bitmapper":1,"./chunkstream":3,"./filter-parse-async":7,"./format-normaliser":10,"./parser":18,util:84,zlib:31}],17:[function(d,m,g){(function(w){(function(){let $=!0,I=d("zlib"),D=d("./sync-inflate");I.deflateSync||($=!1);let q=d("./sync-reader"),j=d("./filter-parse-sync"),G=d("./parser"),H=d("./bitmapper"),W=d("./format-normaliser");m.exports=function(V,K){if(!$)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let Z,Q,J;function re(Ce){Z=Ce}function se(Ce){Q=Ce}function oe(Ce){Q.transColor=Ce}function ee(Ce){Q.palette=Ce}function ae(){Q.alpha=!0}function ce(Ce){J=Ce}let le=[];function de(Ce){le.push(Ce)}let _e=new q(V);if(new G(K,{read:_e.read.bind(_e),error:re,metadata:se,gamma:ce,palette:ee,transColor:oe,inflateData:de,simpleTransparency:ae}).start(),_e.process(),Z)throw Z;let we,pe=w.concat(le);if(le.length=0,Q.interlace)we=I.inflateSync(pe);else{let Ce=(1+(Q.width*Q.bpp*Q.depth+7>>3))*Q.height;we=D(pe,{chunkSize:Ce,maxLength:Ce})}if(pe=null,!we||!we.length)throw new Error("bad png - invalid inflate data response");let xe=j.process(we,Q);pe=null;let Ge=H.dataToBitMap(xe,Q);xe=null;let Te=W(Ge,Q,K.skipRescale);return Q.data=Te,Q.gamma=J||0,Q}}).call(this)}).call(this,d("buffer").Buffer)},{"./bitmapper":1,"./filter-parse-sync":8,"./format-normaliser":10,"./parser":18,"./sync-inflate":21,"./sync-reader":22,buffer:32,zlib:31}],18:[function(d,m,g){(function(w){(function(){let $=d("./constants"),I=d("./crc"),D=m.exports=function(q,j){this._options=q,q.checkCRC=q.checkCRC!==!1,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[$.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[$.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[$.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[$.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[$.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[$.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=j.read,this.error=j.error,this.metadata=j.metadata,this.gamma=j.gamma,this.transColor=j.transColor,this.palette=j.palette,this.parsed=j.parsed,this.inflateData=j.inflateData,this.finished=j.finished,this.simpleTransparency=j.simpleTransparency,this.headersFinished=j.headersFinished||function(){}};D.prototype.start=function(){this.read($.PNG_SIGNATURE.length,this._parseSignature.bind(this))},D.prototype._parseSignature=function(q){let j=$.PNG_SIGNATURE;for(let G=0;G<j.length;G++)if(q[G]!==j[G])return void this.error(new Error("Invalid file signature"));this.read(8,this._parseChunkBegin.bind(this))},D.prototype._parseChunkBegin=function(q){let j=q.readUInt32BE(0),G=q.readUInt32BE(4),H="";for(let V=4;V<8;V++)H+=String.fromCharCode(q[V]);let W=!!(32&q[4]);if(this._hasIHDR||G===$.TYPE_IHDR){if(this._crc=new I,this._crc.write(w.from(H)),this._chunks[G])return this._chunks[G](j);W?this.read(j+4,this._skipChunk.bind(this)):this.error(new Error("Unsupported critical chunk type "+H))}else this.error(new Error("Expected IHDR on beggining"))},D.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},D.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},D.prototype._parseChunkEnd=function(q){let j=q.readInt32BE(0),G=this._crc.crc32();this._options.checkCRC&&G!==j?this.error(new Error("Crc error - "+j+" - "+G)):this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},D.prototype._handleIHDR=function(q){this.read(q,this._parseIHDR.bind(this))},D.prototype._parseIHDR=function(q){this._crc.write(q);let j=q.readUInt32BE(0),G=q.readUInt32BE(4),H=q[8],W=q[9],V=q[10],K=q[11],Z=q[12];if(H!==8&&H!==4&&H!==2&&H!==1&&H!==16)return void this.error(new Error("Unsupported bit depth "+H));if(!(W in $.COLORTYPE_TO_BPP_MAP))return void this.error(new Error("Unsupported color type"));if(V!==0)return void this.error(new Error("Unsupported compression method"));if(K!==0)return void this.error(new Error("Unsupported filter method"));if(Z!==0&&Z!==1)return void this.error(new Error("Unsupported interlace method"));this._colorType=W;let Q=$.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:j,height:G,depth:H,interlace:!!Z,palette:!!(W&$.COLORTYPE_PALETTE),color:!!(W&$.COLORTYPE_COLOR),alpha:!!(W&$.COLORTYPE_ALPHA),bpp:Q,colorType:W}),this._handleChunkEnd()},D.prototype._handlePLTE=function(q){this.read(q,this._parsePLTE.bind(this))},D.prototype._parsePLTE=function(q){this._crc.write(q);let j=Math.floor(q.length/3);for(let G=0;G<j;G++)this._palette.push([q[3*G],q[3*G+1],q[3*G+2],255]);this.palette(this._palette),this._handleChunkEnd()},D.prototype._handleTRNS=function(q){this.simpleTransparency(),this.read(q,this._parseTRNS.bind(this))},D.prototype._parseTRNS=function(q){if(this._crc.write(q),this._colorType===$.COLORTYPE_PALETTE_COLOR){if(this._palette.length===0)return void this.error(new Error("Transparency chunk must be after palette"));if(q.length>this._palette.length)return void this.error(new Error("More transparent colors than palette size"));for(let j=0;j<q.length;j++)this._palette[j][3]=q[j];this.palette(this._palette)}this._colorType===$.COLORTYPE_GRAYSCALE&&this.transColor([q.readUInt16BE(0)]),this._colorType===$.COLORTYPE_COLOR&&this.transColor([q.readUInt16BE(0),q.readUInt16BE(2),q.readUInt16BE(4)]),this._handleChunkEnd()},D.prototype._handleGAMA=function(q){this.read(q,this._parseGAMA.bind(this))},D.prototype._parseGAMA=function(q){this._crc.write(q),this.gamma(q.readUInt32BE(0)/$.GAMMA_DIVISION),this._handleChunkEnd()},D.prototype._handleIDAT=function(q){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-q,this._parseIDAT.bind(this,q))},D.prototype._parseIDAT=function(q,j){if(this._crc.write(j),this._colorType===$.COLORTYPE_PALETTE_COLOR&&this._palette.length===0)throw new Error("Expected palette not found");this.inflateData(j);let G=q-j.length;G>0?this._handleIDAT(G):this._handleChunkEnd()},D.prototype._handleIEND=function(q){this.read(q,this._parseIEND.bind(this))},D.prototype._parseIEND=function(q){this._crc.write(q),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,"./crc":5,buffer:32}],19:[function(d,m,g){let w=d("./parser-sync"),$=d("./packer-sync");g.read=function(I,D){return w(I,D||{})},g.write=function(I,D){return $(I,D)}},{"./packer-sync":13,"./parser-sync":17}],20:[function(d,m,g){(function(w,$){(function(){let I=d("util"),D=d("stream"),q=d("./parser-async"),j=d("./packer-async"),G=d("./png-sync"),H=g.PNG=function(W){D.call(this),W=W||{},this.width=0|W.width,this.height=0|W.height,this.data=this.width>0&&this.height>0?$.alloc(4*this.width*this.height):null,W.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new q(W),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",(function(V){this.data=V,this.emit("parsed",V)}).bind(this)),this._packer=new j(W),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};I.inherits(H,D),H.sync=G,H.prototype.pack=function(){return this.data&&this.data.length?(w.nextTick((function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}).bind(this)),this):(this.emit("error","No data provided"),this)},H.prototype.parse=function(W,V){if(V){let K,Z;K=(function(Q){this.removeListener("error",Z),this.data=Q,V(null,this)}).bind(this),Z=(function(Q){this.removeListener("parsed",K),V(Q,null)}).bind(this),this.once("parsed",K),this.once("error",Z)}return this.end(W),this},H.prototype.write=function(W){return this._parser.write(W),!0},H.prototype.end=function(W){this._parser.end(W)},H.prototype._metadata=function(W){this.width=W.width,this.height=W.height,this.emit("metadata",W)},H.prototype._gamma=function(W){this.gamma=W},H.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},H.bitblt=function(W,V,K,Z,Q,J,re,se){if(Z|=0,Q|=0,J|=0,re|=0,se|=0,(K|=0)>W.width||Z>W.height||K+Q>W.width||Z+J>W.height)throw new Error("bitblt reading outside image");if(re>V.width||se>V.height||re+Q>V.width||se+J>V.height)throw new Error("bitblt writing outside image");for(let oe=0;oe<J;oe++)W.data.copy(V.data,(se+oe)*V.width+re<<2,(Z+oe)*W.width+K<<2,(Z+oe)*W.width+K+Q<<2)},H.prototype.bitblt=function(W,V,K,Z,Q,J,re){return H.bitblt(this,W,V,K,Z,Q,J,re),this},H.adjustGamma=function(W){if(W.gamma){for(let V=0;V<W.height;V++)for(let K=0;K<W.width;K++){let Z=W.width*V+K<<2;for(let Q=0;Q<3;Q++){let J=W.data[Z+Q]/255;J=Math.pow(J,1/2.2/W.gamma),W.data[Z+Q]=Math.round(255*J)}}W.gamma=0}},H.prototype.adjustGamma=function(){H.adjustGamma(this)}}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{"./packer-async":12,"./parser-async":16,"./png-sync":19,_process:63,buffer:32,stream:65,util:84}],21:[function(d,m,g){(function(w,$){(function(){let I=d("assert").ok,D=d("zlib"),q=d("util"),j=d("buffer").kMaxLength;function G(Z){if(!(this instanceof G))return new G(Z);Z&&Z.chunkSize<D.Z_MIN_CHUNK&&(Z.chunkSize=D.Z_MIN_CHUNK),D.Inflate.call(this,Z),this._offset=this._offset===void 0?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,Z&&Z.maxLength!=null&&(this._maxLength=Z.maxLength)}function H(Z){return new G(Z)}function W(Z,Q){Z._handle&&(Z._handle.close(),Z._handle=null)}function V(Z,Q){if(typeof Q=="string"&&(Q=$.from(Q)),!(Q instanceof $))throw new TypeError("Not a string or buffer");let J=Z._finishFlushFlag;return J==null&&(J=D.Z_FINISH),Z._processChunk(Q,J)}function K(Z,Q){return V(new G(Q),Z)}G.prototype._processChunk=function(Z,Q,J){if(typeof J=="function")return D.Inflate._processChunk.call(this,Z,Q,J);let re,se,oe=this,ee=Z&&Z.length,ae=this._chunkSize-this._offset,ce=this._maxLength,le=0,de=[],_e=0;function we(xe,Ge){if(oe._hadError)return;let Te=ae-Ge;if(I(Te>=0,"have should not go down"),Te>0){let Ce=oe._buffer.slice(oe._offset,oe._offset+Te);if(oe._offset+=Te,Ce.length>ce&&(Ce=Ce.slice(0,ce)),de.push(Ce),_e+=Ce.length,ce-=Ce.length,ce===0)return!1}return(Ge===0||oe._offset>=oe._chunkSize)&&(ae=oe._chunkSize,oe._offset=0,oe._buffer=$.allocUnsafe(oe._chunkSize)),Ge===0&&(le+=ee-xe,ee=xe,!0)}this.on("error",(function(xe){re=xe})),I(this._handle,"zlib binding closed");do se=this._handle.writeSync(Q,Z,le,ee,this._buffer,this._offset,ae),se=se||this._writeState;while(!this._hadError&&we(se[0],se[1]));if(this._hadError)throw re;if(_e>=j)throw W(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+j.toString(16)+" bytes");let pe=$.concat(de,_e);return W(this),pe},q.inherits(G,D.Inflate),m.exports=g=K,g.Inflate=G,g.createInflate=H,g.inflateSync=K}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{_process:63,assert:23,buffer:32,util:84,zlib:31}],22:[function(d,m,g){let w=m.exports=function($){this._buffer=$,this._reads=[]};w.prototype.read=function($,I){this._reads.push({length:Math.abs($),allowLess:$<0,func:I})},w.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){let $=this._reads[0];if(!this._buffer.length||!(this._buffer.length>=$.length||$.allowLess))break;{this._reads.shift();let I=this._buffer;this._buffer=I.slice($.length),$.func.call(this,I.slice(0,$.length))}}if(this._reads.length>0)throw new Error("There are some read requests waitng on finished stream");if(this._buffer.length>0)throw new Error("unrecognised content at end of stream")}},{}],23:[function(d,m,g){(function(w){(function(){var $=d("object-assign");/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */function I(Te,Ce){if(Te===Ce)return 0;for(var Oe=Te.length,bt=Ce.length,Mt=0,lt=Math.min(Oe,bt);Mt<lt;++Mt)if(Te[Mt]!==Ce[Mt]){Oe=Te[Mt],bt=Ce[Mt];break}return Oe<bt?-1:bt<Oe?1:0}function D(Te){return w.Buffer&&typeof w.Buffer.isBuffer=="function"?w.Buffer.isBuffer(Te):!(Te==null||!Te._isBuffer)}var q=d("util/"),j=Object.prototype.hasOwnProperty,G=Array.prototype.slice,H=(function(){}).name==="foo";function W(Te){return Object.prototype.toString.call(Te)}function V(Te){return!D(Te)&&typeof w.ArrayBuffer=="function"&&(typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(Te):!!Te&&(Te instanceof DataView||!!(Te.buffer&&Te.buffer instanceof ArrayBuffer)))}var K=m.exports=ee,Z=/\s*function\s+([^\(\s]*)\s*/;function Q(Te){if(q.isFunction(Te)){if(H)return Te.name;var Ce=Te.toString().match(Z);return Ce&&Ce[1]}}function J(Te,Ce){return typeof Te=="string"?Te.length<Ce?Te:Te.slice(0,Ce):Te}function re(Te){if(H||!q.isFunction(Te))return q.inspect(Te);var Ce=Q(Te);return"[Function"+(Ce?": "+Ce:"")+"]"}function se(Te){return J(re(Te.actual),128)+" "+Te.operator+" "+J(re(Te.expected),128)}function oe(Te,Ce,Oe,bt,Mt){throw new K.AssertionError({message:Oe,actual:Te,expected:Ce,operator:bt,stackStartFunction:Mt})}function ee(Te,Ce){Te||oe(Te,!0,Ce,"==",K.ok)}function ae(Te,Ce,Oe,bt){if(Te===Ce)return!0;if(D(Te)&&D(Ce))return I(Te,Ce)===0;if(q.isDate(Te)&&q.isDate(Ce))return Te.getTime()===Ce.getTime();if(q.isRegExp(Te)&&q.isRegExp(Ce))return Te.source===Ce.source&&Te.global===Ce.global&&Te.multiline===Ce.multiline&&Te.lastIndex===Ce.lastIndex&&Te.ignoreCase===Ce.ignoreCase;if(Te!==null&&typeof Te=="object"||Ce!==null&&typeof Ce=="object"){if(V(Te)&&V(Ce)&&W(Te)===W(Ce)&&!(Te instanceof Float32Array||Te instanceof Float64Array))return I(new Uint8Array(Te.buffer),new Uint8Array(Ce.buffer))===0;if(D(Te)!==D(Ce))return!1;var Mt=(bt=bt||{actual:[],expected:[]}).actual.indexOf(Te);return Mt!==-1&&Mt===bt.expected.indexOf(Ce)||(bt.actual.push(Te),bt.expected.push(Ce),le(Te,Ce,Oe,bt))}return Oe?Te===Ce:Te==Ce}function ce(Te){return Object.prototype.toString.call(Te)=="[object Arguments]"}function le(Te,Ce,Oe,bt){if(Te==null||Ce==null)return!1;if(q.isPrimitive(Te)||q.isPrimitive(Ce))return Te===Ce;if(Oe&&Object.getPrototypeOf(Te)!==Object.getPrototypeOf(Ce))return!1;var Mt=ce(Te),lt=ce(Ce);if(Mt&&!lt||!Mt&&lt)return!1;if(Mt)return ae(Te=G.call(Te),Ce=G.call(Ce),Oe);var ir,Ye,xt=Ge(Te),ar=Ge(Ce);if(xt.length!==ar.length)return!1;for(xt.sort(),ar.sort(),Ye=xt.length-1;Ye>=0;Ye--)if(xt[Ye]!==ar[Ye])return!1;for(Ye=xt.length-1;Ye>=0;Ye--)if(!ae(Te[ir=xt[Ye]],Ce[ir],Oe,bt))return!1;return!0}function de(Te,Ce,Oe){ae(Te,Ce,!0)&&oe(Te,Ce,Oe,"notDeepStrictEqual",de)}function _e(Te,Ce){if(!Te||!Ce)return!1;if(Object.prototype.toString.call(Ce)=="[object RegExp]")return Ce.test(Te);try{if(Te instanceof Ce)return!0}catch{}return!Error.isPrototypeOf(Ce)&&Ce.call({},Te)===!0}function we(Te){var Ce;try{Te()}catch(Oe){Ce=Oe}return Ce}function pe(Te,Ce,Oe,bt){var Mt;if(typeof Ce!="function")throw new TypeError('"block" argument must be a function');typeof Oe=="string"&&(bt=Oe,Oe=null),Mt=we(Ce),bt=(Oe&&Oe.name?" ("+Oe.name+").":".")+(bt?" "+bt:"."),Te&&!Mt&&oe(Mt,Oe,"Missing expected exception"+bt);var lt=typeof bt=="string",ir=!Te&&Mt&&!Oe;if((!Te&&q.isError(Mt)&&lt&&_e(Mt,Oe)||ir)&&oe(Mt,Oe,"Got unwanted exception"+bt),Te&&Mt&&Oe&&!_e(Mt,Oe)||!Te&&Mt)throw Mt}function xe(Te,Ce){Te||oe(Te,!0,Ce,"==",xe)}K.AssertionError=function(Te){this.name="AssertionError",this.actual=Te.actual,this.expected=Te.expected,this.operator=Te.operator,Te.message?(this.message=Te.message,this.generatedMessage=!1):(this.message=se(this),this.generatedMessage=!0);var Ce=Te.stackStartFunction||oe;if(Error.captureStackTrace)Error.captureStackTrace(this,Ce);else{var Oe=new Error;if(Oe.stack){var bt=Oe.stack,Mt=Q(Ce),lt=bt.indexOf(`
`+Mt);if(lt>=0){var ir=bt.indexOf(`
`,lt+1);bt=bt.substring(ir+1)}this.stack=bt}}},q.inherits(K.AssertionError,Error),K.fail=oe,K.ok=ee,K.equal=function(Te,Ce,Oe){Te!=Ce&&oe(Te,Ce,Oe,"==",K.equal)},K.notEqual=function(Te,Ce,Oe){Te==Ce&&oe(Te,Ce,Oe,"!=",K.notEqual)},K.deepEqual=function(Te,Ce,Oe){ae(Te,Ce,!1)||oe(Te,Ce,Oe,"deepEqual",K.deepEqual)},K.deepStrictEqual=function(Te,Ce,Oe){ae(Te,Ce,!0)||oe(Te,Ce,Oe,"deepStrictEqual",K.deepStrictEqual)},K.notDeepEqual=function(Te,Ce,Oe){ae(Te,Ce,!1)&&oe(Te,Ce,Oe,"notDeepEqual",K.notDeepEqual)},K.notDeepStrictEqual=de,K.strictEqual=function(Te,Ce,Oe){Te!==Ce&&oe(Te,Ce,Oe,"===",K.strictEqual)},K.notStrictEqual=function(Te,Ce,Oe){Te===Ce&&oe(Te,Ce,Oe,"!==",K.notStrictEqual)},K.throws=function(Te,Ce,Oe){pe(!0,Te,Ce,Oe)},K.doesNotThrow=function(Te,Ce,Oe){pe(!1,Te,Ce,Oe)},K.ifError=function(Te){if(Te)throw Te},K.strict=$(xe,K,{equal:K.strictEqual,deepEqual:K.deepStrictEqual,notEqual:K.notStrictEqual,notDeepEqual:K.notDeepStrictEqual}),K.strict.strict=K.strict;var Ge=Object.keys||function(Te){var Ce=[];for(var Oe in Te)j.call(Te,Oe)&&Ce.push(Oe);return Ce}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"object-assign":51,"util/":26}],24:[function(d,m,g){typeof Object.create=="function"?m.exports=function(w,$){w.super_=$,w.prototype=Object.create($.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}})}:m.exports=function(w,$){w.super_=$;var I=function(){};I.prototype=$.prototype,w.prototype=new I,w.prototype.constructor=w}},{}],25:[function(d,m,g){m.exports=function(w){return w&&typeof w=="object"&&typeof w.copy=="function"&&typeof w.fill=="function"&&typeof w.readUInt8=="function"}},{}],26:[function(d,m,g){(function(w,$){(function(){var I=/%[sdj%]/g;g.format=function(Ye){if(!le(Ye)){for(var xt=[],ar=0;ar<arguments.length;ar++)xt.push(j(arguments[ar]));return xt.join(" ")}ar=1;for(var ht=arguments,gt=ht.length,zt=String(Ye).replace(I,(function(dr){if(dr==="%%")return"%";if(ar>=gt)return dr;switch(dr){case"%s":return String(ht[ar++]);case"%d":return Number(ht[ar++]);case"%j":try{return JSON.stringify(ht[ar++])}catch{return"[Circular]"}default:return dr}})),ur=ht[ar];ar<gt;ur=ht[++ar])ee(ur)||!pe(ur)?zt+=" "+ur:zt+=" "+j(ur);return zt},g.deprecate=function(Ye,xt){if(_e($.process))return function(){return g.deprecate(Ye,xt).apply(this,arguments)};if(w.noDeprecation===!0)return Ye;var ar=!1;function ht(){if(!ar){if(w.throwDeprecation)throw new Error(xt);w.traceDeprecation?console.trace(xt):console.error(xt),ar=!0}return Ye.apply(this,arguments)}return ht};var D,q={};function j(Ye,xt){var ar={seen:[],stylize:H};return arguments.length>=3&&(ar.depth=arguments[2]),arguments.length>=4&&(ar.colors=arguments[3]),oe(xt)?ar.showHidden=xt:xt&&g._extend(ar,xt),_e(ar.showHidden)&&(ar.showHidden=!1),_e(ar.depth)&&(ar.depth=2),_e(ar.colors)&&(ar.colors=!1),_e(ar.customInspect)&&(ar.customInspect=!0),ar.colors&&(ar.stylize=G),V(ar,Ye,ar.depth)}function G(Ye,xt){var ar=j.styles[xt];return ar?"\x1B["+j.colors[ar][0]+"m"+Ye+"\x1B["+j.colors[ar][1]+"m":Ye}function H(Ye,xt){return Ye}function W(Ye){var xt={};return Ye.forEach((function(ar,ht){xt[ar]=!0})),xt}function V(Ye,xt,ar){if(Ye.customInspect&&xt&&Te(xt.inspect)&&xt.inspect!==g.inspect&&(!xt.constructor||xt.constructor.prototype!==xt)){var ht=xt.inspect(ar,Ye);return le(ht)||(ht=V(Ye,ht,ar)),ht}var gt=K(Ye,xt);if(gt)return gt;var zt=Object.keys(xt),ur=W(zt);if(Ye.showHidden&&(zt=Object.getOwnPropertyNames(xt)),Ge(xt)&&(zt.indexOf("message")>=0||zt.indexOf("description")>=0))return Z(xt);if(zt.length===0){if(Te(xt)){var dr=xt.name?": "+xt.name:"";return Ye.stylize("[Function"+dr+"]","special")}if(we(xt))return Ye.stylize(RegExp.prototype.toString.call(xt),"regexp");if(xe(xt))return Ye.stylize(Date.prototype.toString.call(xt),"date");if(Ge(xt))return Z(xt)}var fr,Ft="",$e=!1,Bt=["{","}"];return se(xt)&&($e=!0,Bt=["[","]"]),Te(xt)&&(Ft=" [Function"+(xt.name?": "+xt.name:"")+"]"),we(xt)&&(Ft=" "+RegExp.prototype.toString.call(xt)),xe(xt)&&(Ft=" "+Date.prototype.toUTCString.call(xt)),Ge(xt)&&(Ft=" "+Z(xt)),zt.length!==0||$e&&xt.length!=0?ar<0?we(xt)?Ye.stylize(RegExp.prototype.toString.call(xt),"regexp"):Ye.stylize("[Object]","special"):(Ye.seen.push(xt),fr=$e?Q(Ye,xt,ar,ur,zt):zt.map((function(Qe){return J(Ye,xt,ar,ur,Qe,$e)})),Ye.seen.pop(),re(fr,Ft,Bt)):Bt[0]+Ft+Bt[1]}function K(Ye,xt){if(_e(xt))return Ye.stylize("undefined","undefined");if(le(xt)){var ar="'"+JSON.stringify(xt).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Ye.stylize(ar,"string")}return ce(xt)?Ye.stylize(""+xt,"number"):oe(xt)?Ye.stylize(""+xt,"boolean"):ee(xt)?Ye.stylize("null","null"):void 0}function Z(Ye){return"["+Error.prototype.toString.call(Ye)+"]"}function Q(Ye,xt,ar,ht,gt){for(var zt=[],ur=0,dr=xt.length;ur<dr;++ur)ir(xt,String(ur))?zt.push(J(Ye,xt,ar,ht,String(ur),!0)):zt.push("");return gt.forEach((function(fr){fr.match(/^\d+$/)||zt.push(J(Ye,xt,ar,ht,fr,!0))})),zt}function J(Ye,xt,ar,ht,gt,zt){var ur,dr,fr;if((fr=Object.getOwnPropertyDescriptor(xt,gt)||{value:xt[gt]}).get?dr=fr.set?Ye.stylize("[Getter/Setter]","special"):Ye.stylize("[Getter]","special"):fr.set&&(dr=Ye.stylize("[Setter]","special")),ir(ht,gt)||(ur="["+gt+"]"),dr||(Ye.seen.indexOf(fr.value)<0?(dr=ee(ar)?V(Ye,fr.value,null):V(Ye,fr.value,ar-1)).indexOf(`
`)>-1&&(dr=zt?dr.split(`
`).map((function(Ft){return"  "+Ft})).join(`
`).substr(2):`
`+dr.split(`
`).map((function(Ft){return"   "+Ft})).join(`
`)):dr=Ye.stylize("[Circular]","special")),_e(ur)){if(zt&&gt.match(/^\d+$/))return dr;(ur=JSON.stringify(""+gt)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(ur=ur.substr(1,ur.length-2),ur=Ye.stylize(ur,"name")):(ur=ur.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),ur=Ye.stylize(ur,"string"))}return ur+": "+dr}function re(Ye,xt,ar){return Ye.reduce((function(ht,gt){return gt.indexOf(`
`),ht+gt.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?ar[0]+(xt===""?"":xt+`
 `)+" "+Ye.join(`,
  `)+" "+ar[1]:ar[0]+xt+" "+Ye.join(", ")+" "+ar[1]}function se(Ye){return Array.isArray(Ye)}function oe(Ye){return typeof Ye=="boolean"}function ee(Ye){return Ye===null}function ae(Ye){return Ye==null}function ce(Ye){return typeof Ye=="number"}function le(Ye){return typeof Ye=="string"}function de(Ye){return typeof Ye=="symbol"}function _e(Ye){return Ye===void 0}function we(Ye){return pe(Ye)&&Oe(Ye)==="[object RegExp]"}function pe(Ye){return typeof Ye=="object"&&Ye!==null}function xe(Ye){return pe(Ye)&&Oe(Ye)==="[object Date]"}function Ge(Ye){return pe(Ye)&&(Oe(Ye)==="[object Error]"||Ye instanceof Error)}function Te(Ye){return typeof Ye=="function"}function Ce(Ye){return Ye===null||typeof Ye=="boolean"||typeof Ye=="number"||typeof Ye=="string"||typeof Ye=="symbol"||Ye===void 0}function Oe(Ye){return Object.prototype.toString.call(Ye)}function bt(Ye){return Ye<10?"0"+Ye.toString(10):Ye.toString(10)}g.debuglog=function(Ye){if(_e(D)&&(D=w.env.NODE_DEBUG||""),Ye=Ye.toUpperCase(),!q[Ye])if(new RegExp("\\b"+Ye+"\\b","i").test(D)){var xt=w.pid;q[Ye]=function(){var ar=g.format.apply(g,arguments);console.error("%s %d: %s",Ye,xt,ar)}}else q[Ye]=function(){};return q[Ye]},g.inspect=j,j.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},j.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},g.isArray=se,g.isBoolean=oe,g.isNull=ee,g.isNullOrUndefined=ae,g.isNumber=ce,g.isString=le,g.isSymbol=de,g.isUndefined=_e,g.isRegExp=we,g.isObject=pe,g.isDate=xe,g.isError=Ge,g.isFunction=Te,g.isPrimitive=Ce,g.isBuffer=d("./support/isBuffer");var Mt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function lt(){var Ye=new Date,xt=[bt(Ye.getHours()),bt(Ye.getMinutes()),bt(Ye.getSeconds())].join(":");return[Ye.getDate(),Mt[Ye.getMonth()],xt].join(" ")}function ir(Ye,xt){return Object.prototype.hasOwnProperty.call(Ye,xt)}g.log=function(){console.log("%s - %s",lt(),g.format.apply(g,arguments))},g.inherits=d("inherits"),g._extend=function(Ye,xt){if(!xt||!pe(xt))return Ye;for(var ar=Object.keys(xt),ht=ar.length;ht--;)Ye[ar[ht]]=xt[ar[ht]];return Ye}}).call(this)}).call(this,d("_process"),commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"./support/isBuffer":25,_process:63,inherits:24}],27:[function(d,m,g){(function(w){(function(){var $=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],I=typeof globalThis>"u"?w:globalThis;m.exports=function(){for(var D=[],q=0;q<$.length;q++)typeof I[$[q]]=="function"&&(D[D.length]=$[q]);return D}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],28:[function(d,m,g){g.byteLength=H,g.toByteArray=V,g.fromByteArray=Q;for(var w=[],$=[],I=typeof Uint8Array<"u"?Uint8Array:Array,D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q=0,j=D.length;q<j;++q)w[q]=D[q],$[D.charCodeAt(q)]=q;function G(J){var re=J.length;if(re%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var se=J.indexOf("=");return se===-1&&(se=re),[se,se===re?0:4-se%4]}function H(J){var re=G(J),se=re[0],oe=re[1];return 3*(se+oe)/4-oe}function W(J,re,se){return 3*(re+se)/4-se}function V(J){var re,se,oe=G(J),ee=oe[0],ae=oe[1],ce=new I(W(J,ee,ae)),le=0,de=ae>0?ee-4:ee;for(se=0;se<de;se+=4)re=$[J.charCodeAt(se)]<<18|$[J.charCodeAt(se+1)]<<12|$[J.charCodeAt(se+2)]<<6|$[J.charCodeAt(se+3)],ce[le++]=re>>16&255,ce[le++]=re>>8&255,ce[le++]=255&re;return ae===2&&(re=$[J.charCodeAt(se)]<<2|$[J.charCodeAt(se+1)]>>4,ce[le++]=255&re),ae===1&&(re=$[J.charCodeAt(se)]<<10|$[J.charCodeAt(se+1)]<<4|$[J.charCodeAt(se+2)]>>2,ce[le++]=re>>8&255,ce[le++]=255&re),ce}function K(J){return w[J>>18&63]+w[J>>12&63]+w[J>>6&63]+w[63&J]}function Z(J,re,se){for(var oe,ee=[],ae=re;ae<se;ae+=3)oe=(J[ae]<<16&16711680)+(J[ae+1]<<8&65280)+(255&J[ae+2]),ee.push(K(oe));return ee.join("")}function Q(J){for(var re,se=J.length,oe=se%3,ee=[],ae=16383,ce=0,le=se-oe;ce<le;ce+=ae)ee.push(Z(J,ce,ce+ae>le?le:ce+ae));return oe===1?(re=J[se-1],ee.push(w[re>>2]+w[re<<4&63]+"==")):oe===2&&(re=(J[se-2]<<8)+J[se-1],ee.push(w[re>>10]+w[re>>4&63]+w[re<<2&63]+"=")),ee.join("")}$[45]=62,$[95]=63},{}],29:[function(d,m,g){},{}],30:[function(d,m,g){(function(w,$){(function(){var I=d("assert"),D=d("pako/lib/zlib/zstream"),q=d("pako/lib/zlib/deflate.js"),j=d("pako/lib/zlib/inflate.js"),G=d("pako/lib/zlib/constants");for(var H in G)g[H]=G[H];g.NONE=0,g.DEFLATE=1,g.INFLATE=2,g.GZIP=3,g.GUNZIP=4,g.DEFLATERAW=5,g.INFLATERAW=6,g.UNZIP=7;var W=31,V=139;function K(Z){if(typeof Z!="number"||Z<g.DEFLATE||Z>g.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=Z,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}K.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,I(this.init_done,"close before init"),I(this.mode<=g.UNZIP),this.mode===g.DEFLATE||this.mode===g.GZIP||this.mode===g.DEFLATERAW?q.deflateEnd(this.strm):this.mode!==g.INFLATE&&this.mode!==g.GUNZIP&&this.mode!==g.INFLATERAW&&this.mode!==g.UNZIP||j.inflateEnd(this.strm),this.mode=g.NONE,this.dictionary=null)},K.prototype.write=function(Z,Q,J,re,se,oe,ee){return this._write(!0,Z,Q,J,re,se,oe,ee)},K.prototype.writeSync=function(Z,Q,J,re,se,oe,ee){return this._write(!1,Z,Q,J,re,se,oe,ee)},K.prototype._write=function(Z,Q,J,re,se,oe,ee,ae){if(I.equal(arguments.length,8),I(this.init_done,"write before init"),I(this.mode!==g.NONE,"already finalized"),I.equal(!1,this.write_in_progress,"write already in progress"),I.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,I.equal(!1,Q===void 0,"must provide flush value"),this.write_in_progress=!0,Q!==g.Z_NO_FLUSH&&Q!==g.Z_PARTIAL_FLUSH&&Q!==g.Z_SYNC_FLUSH&&Q!==g.Z_FULL_FLUSH&&Q!==g.Z_FINISH&&Q!==g.Z_BLOCK)throw new Error("Invalid flush value");if(J==null&&(J=$.alloc(0),se=0,re=0),this.strm.avail_in=se,this.strm.input=J,this.strm.next_in=re,this.strm.avail_out=ae,this.strm.output=oe,this.strm.next_out=ee,this.flush=Q,!Z)return this._process(),this._checkError()?this._afterSync():void 0;var ce=this;return w.nextTick((function(){ce._process(),ce._after()})),this},K.prototype._afterSync=function(){var Z=this.strm.avail_out,Q=this.strm.avail_in;return this.write_in_progress=!1,[Q,Z]},K.prototype._process=function(){var Z=null;switch(this.mode){case g.DEFLATE:case g.GZIP:case g.DEFLATERAW:this.err=q.deflate(this.strm,this.flush);break;case g.UNZIP:switch(this.strm.avail_in>0&&(Z=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(Z===null)break;if(this.strm.input[Z]!==W){this.mode=g.INFLATE;break}if(this.gzip_id_bytes_read=1,Z++,this.strm.avail_in===1)break;case 1:if(Z===null)break;this.strm.input[Z]===V?(this.gzip_id_bytes_read=2,this.mode=g.GUNZIP):this.mode=g.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case g.INFLATE:case g.GUNZIP:case g.INFLATERAW:for(this.err=j.inflate(this.strm,this.flush),this.err===g.Z_NEED_DICT&&this.dictionary&&(this.err=j.inflateSetDictionary(this.strm,this.dictionary),this.err===g.Z_OK?this.err=j.inflate(this.strm,this.flush):this.err===g.Z_DATA_ERROR&&(this.err=g.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===g.GUNZIP&&this.err===g.Z_STREAM_END&&this.strm.next_in[0]!==0;)this.reset(),this.err=j.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},K.prototype._checkError=function(){switch(this.err){case g.Z_OK:case g.Z_BUF_ERROR:if(this.strm.avail_out!==0&&this.flush===g.Z_FINISH)return this._error("unexpected end of file"),!1;break;case g.Z_STREAM_END:break;case g.Z_NEED_DICT:return this.dictionary==null?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},K.prototype._after=function(){if(this._checkError()){var Z=this.strm.avail_out,Q=this.strm.avail_in;this.write_in_progress=!1,this.callback(Q,Z),this.pending_close&&this.close()}},K.prototype._error=function(Z){this.strm.msg&&(Z=this.strm.msg),this.onerror(Z,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},K.prototype.init=function(Z,Q,J,re,se){I(arguments.length===4||arguments.length===5,"init(windowBits, level, memLevel, strategy, [dictionary])"),I(Z>=8&&Z<=15,"invalid windowBits"),I(Q>=-1&&Q<=9,"invalid compression level"),I(J>=1&&J<=9,"invalid memlevel"),I(re===g.Z_FILTERED||re===g.Z_HUFFMAN_ONLY||re===g.Z_RLE||re===g.Z_FIXED||re===g.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(Q,Z,J,re,se),this._setDictionary()},K.prototype.params=function(){throw new Error("deflateParams Not supported")},K.prototype.reset=function(){this._reset(),this._setDictionary()},K.prototype._init=function(Z,Q,J,re,se){switch(this.level=Z,this.windowBits=Q,this.memLevel=J,this.strategy=re,this.flush=g.Z_NO_FLUSH,this.err=g.Z_OK,this.mode!==g.GZIP&&this.mode!==g.GUNZIP||(this.windowBits+=16),this.mode===g.UNZIP&&(this.windowBits+=32),this.mode!==g.DEFLATERAW&&this.mode!==g.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new D,this.mode){case g.DEFLATE:case g.GZIP:case g.DEFLATERAW:this.err=q.deflateInit2(this.strm,this.level,g.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case g.INFLATE:case g.GUNZIP:case g.INFLATERAW:case g.UNZIP:this.err=j.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==g.Z_OK&&this._error("Init error"),this.dictionary=se,this.write_in_progress=!1,this.init_done=!0},K.prototype._setDictionary=function(){if(this.dictionary!=null){switch(this.err=g.Z_OK,this.mode){case g.DEFLATE:case g.DEFLATERAW:this.err=q.deflateSetDictionary(this.strm,this.dictionary)}this.err!==g.Z_OK&&this._error("Failed to set dictionary")}},K.prototype._reset=function(){switch(this.err=g.Z_OK,this.mode){case g.DEFLATE:case g.DEFLATERAW:case g.GZIP:this.err=q.deflateReset(this.strm);break;case g.INFLATE:case g.INFLATERAW:case g.GUNZIP:this.err=j.inflateReset(this.strm)}this.err!==g.Z_OK&&this._error("Failed to reset stream")},g.Zlib=K}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{_process:63,assert:23,buffer:32,"pako/lib/zlib/constants":54,"pako/lib/zlib/deflate.js":56,"pako/lib/zlib/inflate.js":58,"pako/lib/zlib/zstream":62}],31:[function(d,m,g){(function(w){(function(){var $=d("buffer").Buffer,I=d("stream").Transform,D=d("./binding"),q=d("util"),j=d("assert").ok,G=d("buffer").kMaxLength,H="Cannot create final Buffer. It would be larger than 0x"+G.toString(16)+" bytes";D.Z_MIN_WINDOWBITS=8,D.Z_MAX_WINDOWBITS=15,D.Z_DEFAULT_WINDOWBITS=15,D.Z_MIN_CHUNK=64,D.Z_MAX_CHUNK=1/0,D.Z_DEFAULT_CHUNK=16384,D.Z_MIN_MEMLEVEL=1,D.Z_MAX_MEMLEVEL=9,D.Z_DEFAULT_MEMLEVEL=8,D.Z_MIN_LEVEL=-1,D.Z_MAX_LEVEL=9,D.Z_DEFAULT_LEVEL=D.Z_DEFAULT_COMPRESSION;for(var W=Object.keys(D),V=0;V<W.length;V++){var K=W[V];K.match(/^Z/)&&Object.defineProperty(g,K,{enumerable:!0,value:D[K],writable:!1})}for(var Z={Z_OK:D.Z_OK,Z_STREAM_END:D.Z_STREAM_END,Z_NEED_DICT:D.Z_NEED_DICT,Z_ERRNO:D.Z_ERRNO,Z_STREAM_ERROR:D.Z_STREAM_ERROR,Z_DATA_ERROR:D.Z_DATA_ERROR,Z_MEM_ERROR:D.Z_MEM_ERROR,Z_BUF_ERROR:D.Z_BUF_ERROR,Z_VERSION_ERROR:D.Z_VERSION_ERROR},Q=Object.keys(Z),J=0;J<Q.length;J++){var re=Q[J];Z[Z[re]]=re}function se(Ce,Oe,bt){var Mt=[],lt=0;function ir(){for(var ar;(ar=Ce.read())!==null;)Mt.push(ar),lt+=ar.length;Ce.once("readable",ir)}function Ye(ar){Ce.removeListener("end",xt),Ce.removeListener("readable",ir),bt(ar)}function xt(){var ar,ht=null;lt>=G?ht=new RangeError(H):ar=$.concat(Mt,lt),Mt=[],Ce.close(),bt(ht,ar)}Ce.on("error",Ye),Ce.on("end",xt),Ce.end(Oe),ir()}function oe(Ce,Oe){if(typeof Oe=="string"&&(Oe=$.from(Oe)),!$.isBuffer(Oe))throw new TypeError("Not a string or buffer");var bt=Ce._finishFlushFlag;return Ce._processChunk(Oe,bt)}function ee(Ce){if(!(this instanceof ee))return new ee(Ce);xe.call(this,Ce,D.DEFLATE)}function ae(Ce){if(!(this instanceof ae))return new ae(Ce);xe.call(this,Ce,D.INFLATE)}function ce(Ce){if(!(this instanceof ce))return new ce(Ce);xe.call(this,Ce,D.GZIP)}function le(Ce){if(!(this instanceof le))return new le(Ce);xe.call(this,Ce,D.GUNZIP)}function de(Ce){if(!(this instanceof de))return new de(Ce);xe.call(this,Ce,D.DEFLATERAW)}function _e(Ce){if(!(this instanceof _e))return new _e(Ce);xe.call(this,Ce,D.INFLATERAW)}function we(Ce){if(!(this instanceof we))return new we(Ce);xe.call(this,Ce,D.UNZIP)}function pe(Ce){return Ce===D.Z_NO_FLUSH||Ce===D.Z_PARTIAL_FLUSH||Ce===D.Z_SYNC_FLUSH||Ce===D.Z_FULL_FLUSH||Ce===D.Z_FINISH||Ce===D.Z_BLOCK}function xe(Ce,Oe){var bt=this;if(this._opts=Ce=Ce||{},this._chunkSize=Ce.chunkSize||g.Z_DEFAULT_CHUNK,I.call(this,Ce),Ce.flush&&!pe(Ce.flush))throw new Error("Invalid flush flag: "+Ce.flush);if(Ce.finishFlush&&!pe(Ce.finishFlush))throw new Error("Invalid flush flag: "+Ce.finishFlush);if(this._flushFlag=Ce.flush||D.Z_NO_FLUSH,this._finishFlushFlag=Ce.finishFlush!==void 0?Ce.finishFlush:D.Z_FINISH,Ce.chunkSize&&(Ce.chunkSize<g.Z_MIN_CHUNK||Ce.chunkSize>g.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+Ce.chunkSize);if(Ce.windowBits&&(Ce.windowBits<g.Z_MIN_WINDOWBITS||Ce.windowBits>g.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+Ce.windowBits);if(Ce.level&&(Ce.level<g.Z_MIN_LEVEL||Ce.level>g.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+Ce.level);if(Ce.memLevel&&(Ce.memLevel<g.Z_MIN_MEMLEVEL||Ce.memLevel>g.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+Ce.memLevel);if(Ce.strategy&&Ce.strategy!=g.Z_FILTERED&&Ce.strategy!=g.Z_HUFFMAN_ONLY&&Ce.strategy!=g.Z_RLE&&Ce.strategy!=g.Z_FIXED&&Ce.strategy!=g.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+Ce.strategy);if(Ce.dictionary&&!$.isBuffer(Ce.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new D.Zlib(Oe);var Mt=this;this._hadError=!1,this._handle.onerror=function(Ye,xt){Ge(Mt),Mt._hadError=!0;var ar=new Error(Ye);ar.errno=xt,ar.code=g.codes[xt],Mt.emit("error",ar)};var lt=g.Z_DEFAULT_COMPRESSION;typeof Ce.level=="number"&&(lt=Ce.level);var ir=g.Z_DEFAULT_STRATEGY;typeof Ce.strategy=="number"&&(ir=Ce.strategy),this._handle.init(Ce.windowBits||g.Z_DEFAULT_WINDOWBITS,lt,Ce.memLevel||g.Z_DEFAULT_MEMLEVEL,ir,Ce.dictionary),this._buffer=$.allocUnsafe(this._chunkSize),this._offset=0,this._level=lt,this._strategy=ir,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!bt._handle},configurable:!0,enumerable:!0})}function Ge(Ce,Oe){Oe&&w.nextTick(Oe),Ce._handle&&(Ce._handle.close(),Ce._handle=null)}function Te(Ce){Ce.emit("close")}Object.defineProperty(g,"codes",{enumerable:!0,value:Object.freeze(Z),writable:!1}),g.Deflate=ee,g.Inflate=ae,g.Gzip=ce,g.Gunzip=le,g.DeflateRaw=de,g.InflateRaw=_e,g.Unzip=we,g.createDeflate=function(Ce){return new ee(Ce)},g.createInflate=function(Ce){return new ae(Ce)},g.createDeflateRaw=function(Ce){return new de(Ce)},g.createInflateRaw=function(Ce){return new _e(Ce)},g.createGzip=function(Ce){return new ce(Ce)},g.createGunzip=function(Ce){return new le(Ce)},g.createUnzip=function(Ce){return new we(Ce)},g.deflate=function(Ce,Oe,bt){return typeof Oe=="function"&&(bt=Oe,Oe={}),se(new ee(Oe),Ce,bt)},g.deflateSync=function(Ce,Oe){return oe(new ee(Oe),Ce)},g.gzip=function(Ce,Oe,bt){return typeof Oe=="function"&&(bt=Oe,Oe={}),se(new ce(Oe),Ce,bt)},g.gzipSync=function(Ce,Oe){return oe(new ce(Oe),Ce)},g.deflateRaw=function(Ce,Oe,bt){return typeof Oe=="function"&&(bt=Oe,Oe={}),se(new de(Oe),Ce,bt)},g.deflateRawSync=function(Ce,Oe){return oe(new de(Oe),Ce)},g.unzip=function(Ce,Oe,bt){return typeof Oe=="function"&&(bt=Oe,Oe={}),se(new we(Oe),Ce,bt)},g.unzipSync=function(Ce,Oe){return oe(new we(Oe),Ce)},g.inflate=function(Ce,Oe,bt){return typeof Oe=="function"&&(bt=Oe,Oe={}),se(new ae(Oe),Ce,bt)},g.inflateSync=function(Ce,Oe){return oe(new ae(Oe),Ce)},g.gunzip=function(Ce,Oe,bt){return typeof Oe=="function"&&(bt=Oe,Oe={}),se(new le(Oe),Ce,bt)},g.gunzipSync=function(Ce,Oe){return oe(new le(Oe),Ce)},g.inflateRaw=function(Ce,Oe,bt){return typeof Oe=="function"&&(bt=Oe,Oe={}),se(new _e(Oe),Ce,bt)},g.inflateRawSync=function(Ce,Oe){return oe(new _e(Oe),Ce)},q.inherits(xe,I),xe.prototype.params=function(Ce,Oe,bt){if(Ce<g.Z_MIN_LEVEL||Ce>g.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+Ce);if(Oe!=g.Z_FILTERED&&Oe!=g.Z_HUFFMAN_ONLY&&Oe!=g.Z_RLE&&Oe!=g.Z_FIXED&&Oe!=g.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+Oe);if(this._level!==Ce||this._strategy!==Oe){var Mt=this;this.flush(D.Z_SYNC_FLUSH,(function(){j(Mt._handle,"zlib binding closed"),Mt._handle.params(Ce,Oe),Mt._hadError||(Mt._level=Ce,Mt._strategy=Oe,bt&&bt())}))}else w.nextTick(bt)},xe.prototype.reset=function(){return j(this._handle,"zlib binding closed"),this._handle.reset()},xe.prototype._flush=function(Ce){this._transform($.alloc(0),"",Ce)},xe.prototype.flush=function(Ce,Oe){var bt=this,Mt=this._writableState;(typeof Ce=="function"||Ce===void 0&&!Oe)&&(Oe=Ce,Ce=D.Z_FULL_FLUSH),Mt.ended?Oe&&w.nextTick(Oe):Mt.ending?Oe&&this.once("end",Oe):Mt.needDrain?Oe&&this.once("drain",(function(){return bt.flush(Ce,Oe)})):(this._flushFlag=Ce,this.write($.alloc(0),"",Oe))},xe.prototype.close=function(Ce){Ge(this,Ce),w.nextTick(Te,this)},xe.prototype._transform=function(Ce,Oe,bt){var Mt,lt=this._writableState,ir=(lt.ending||lt.ended)&&(!Ce||lt.length===Ce.length);return Ce===null||$.isBuffer(Ce)?this._handle?(ir?Mt=this._finishFlushFlag:(Mt=this._flushFlag,Ce.length>=lt.length&&(this._flushFlag=this._opts.flush||D.Z_NO_FLUSH)),void this._processChunk(Ce,Mt,bt)):bt(new Error("zlib binding closed")):bt(new Error("invalid input"))},xe.prototype._processChunk=function(Ce,Oe,bt){var Mt=Ce&&Ce.length,lt=this._chunkSize-this._offset,ir=0,Ye=this,xt=typeof bt=="function";if(!xt){var ar,ht=[],gt=0;this.on("error",(function(Ft){ar=Ft})),j(this._handle,"zlib binding closed");do var zt=this._handle.writeSync(Oe,Ce,ir,Mt,this._buffer,this._offset,lt);while(!this._hadError&&fr(zt[0],zt[1]));if(this._hadError)throw ar;if(gt>=G)throw Ge(this),new RangeError(H);var ur=$.concat(ht,gt);return Ge(this),ur}j(this._handle,"zlib binding closed");var dr=this._handle.write(Oe,Ce,ir,Mt,this._buffer,this._offset,lt);function fr(Ft,$e){if(this&&(this.buffer=null,this.callback=null),!Ye._hadError){var Bt=lt-$e;if(j(Bt>=0,"have should not go down"),Bt>0){var Qe=Ye._buffer.slice(Ye._offset,Ye._offset+Bt);Ye._offset+=Bt,xt?Ye.push(Qe):(ht.push(Qe),gt+=Qe.length)}if(($e===0||Ye._offset>=Ye._chunkSize)&&(lt=Ye._chunkSize,Ye._offset=0,Ye._buffer=$.allocUnsafe(Ye._chunkSize)),$e===0){if(ir+=Mt-Ft,Mt=Ft,!xt)return!0;var st=Ye._handle.write(Oe,Ce,ir,Mt,Ye._buffer,Ye._offset,Ye._chunkSize);return st.callback=fr,void(st.buffer=Ce)}if(!xt)return!1;bt()}}dr.buffer=Ce,dr.callback=fr},q.inherits(ee,xe),q.inherits(ae,xe),q.inherits(ce,xe),q.inherits(le,xe),q.inherits(de,xe),q.inherits(_e,xe),q.inherits(we,xe)}).call(this)}).call(this,d("_process"))},{"./binding":30,_process:63,assert:23,buffer:32,stream:65,util:84}],32:[function(d,m,g){(function(w){(function(){var $=d("base64-js"),I=d("ieee754");g.Buffer=G,g.SlowBuffer=oe,g.INSPECT_MAX_BYTES=50;var D=2147483647;function q(){try{var Ee=new Uint8Array(1);return Ee.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},Ee.foo()===42}catch{return!1}}function j(Ee){if(Ee>D)throw new RangeError('The value "'+Ee+'" is invalid for option "size"');var ze=new Uint8Array(Ee);return ze.__proto__=G.prototype,ze}function G(Ee,ze,ct){if(typeof Ee=="number"){if(typeof ze=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return K(Ee)}return H(Ee,ze,ct)}function H(Ee,ze,ct){if(typeof Ee=="string")return Z(Ee,ze);if(ArrayBuffer.isView(Ee))return Q(Ee);if(Ee==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ee);if(pt(Ee,ArrayBuffer)||Ee&&pt(Ee.buffer,ArrayBuffer))return J(Ee,ze,ct);if(typeof Ee=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var ft=Ee.valueOf&&Ee.valueOf();if(ft!=null&&ft!==Ee)return G.from(ft,ze,ct);var pr=re(Ee);if(pr)return pr;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Ee[Symbol.toPrimitive]=="function")return G.from(Ee[Symbol.toPrimitive]("string"),ze,ct);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Ee)}function W(Ee){if(typeof Ee!="number")throw new TypeError('"size" argument must be of type number');if(Ee<0)throw new RangeError('The value "'+Ee+'" is invalid for option "size"')}function V(Ee,ze,ct){return W(Ee),Ee<=0?j(Ee):ze!==void 0?typeof ct=="string"?j(Ee).fill(ze,ct):j(Ee).fill(ze):j(Ee)}function K(Ee){return W(Ee),j(Ee<0?0:0|se(Ee))}function Z(Ee,ze){if(typeof ze=="string"&&ze!==""||(ze="utf8"),!G.isEncoding(ze))throw new TypeError("Unknown encoding: "+ze);var ct=0|ee(Ee,ze),ft=j(ct),pr=ft.write(Ee,ze);return pr!==ct&&(ft=ft.slice(0,pr)),ft}function Q(Ee){for(var ze=Ee.length<0?0:0|se(Ee.length),ct=j(ze),ft=0;ft<ze;ft+=1)ct[ft]=255&Ee[ft];return ct}function J(Ee,ze,ct){if(ze<0||Ee.byteLength<ze)throw new RangeError('"offset" is outside of buffer bounds');if(Ee.byteLength<ze+(ct||0))throw new RangeError('"length" is outside of buffer bounds');var ft;return(ft=ze===void 0&&ct===void 0?new Uint8Array(Ee):ct===void 0?new Uint8Array(Ee,ze):new Uint8Array(Ee,ze,ct)).__proto__=G.prototype,ft}function re(Ee){if(G.isBuffer(Ee)){var ze=0|se(Ee.length),ct=j(ze);return ct.length===0||Ee.copy(ct,0,0,ze),ct}return Ee.length!==void 0?typeof Ee.length!="number"||sr(Ee.length)?j(0):Q(Ee):Ee.type==="Buffer"&&Array.isArray(Ee.data)?Q(Ee.data):void 0}function se(Ee){if(Ee>=D)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+D.toString(16)+" bytes");return 0|Ee}function oe(Ee){return+Ee!=Ee&&(Ee=0),G.alloc(+Ee)}function ee(Ee,ze){if(G.isBuffer(Ee))return Ee.length;if(ArrayBuffer.isView(Ee)||pt(Ee,ArrayBuffer))return Ee.byteLength;if(typeof Ee!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Ee);var ct=Ee.length,ft=arguments.length>2&&arguments[2]===!0;if(!ft&&ct===0)return 0;for(var pr=!1;;)switch(ze){case"ascii":case"latin1":case"binary":return ct;case"utf8":case"utf-8":return $e(Ee).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*ct;case"hex":return ct>>>1;case"base64":return st(Ee).length;default:if(pr)return ft?-1:$e(Ee).length;ze=(""+ze).toLowerCase(),pr=!0}}function ae(Ee,ze,ct){var ft=!1;if((ze===void 0||ze<0)&&(ze=0),ze>this.length||((ct===void 0||ct>this.length)&&(ct=this.length),ct<=0)||(ct>>>=0)<=(ze>>>=0))return"";for(Ee||(Ee="utf8");;)switch(Ee){case"hex":return Ye(this,ze,ct);case"utf8":case"utf-8":return Oe(this,ze,ct);case"ascii":return lt(this,ze,ct);case"latin1":case"binary":return ir(this,ze,ct);case"base64":return Ce(this,ze,ct);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return xt(this,ze,ct);default:if(ft)throw new TypeError("Unknown encoding: "+Ee);Ee=(Ee+"").toLowerCase(),ft=!0}}function ce(Ee,ze,ct){var ft=Ee[ze];Ee[ze]=Ee[ct],Ee[ct]=ft}function le(Ee,ze,ct,ft,pr){if(Ee.length===0)return-1;if(typeof ct=="string"?(ft=ct,ct=0):ct>2147483647?ct=2147483647:ct<-2147483648&&(ct=-2147483648),sr(ct=+ct)&&(ct=pr?0:Ee.length-1),ct<0&&(ct=Ee.length+ct),ct>=Ee.length){if(pr)return-1;ct=Ee.length-1}else if(ct<0){if(!pr)return-1;ct=0}if(typeof ze=="string"&&(ze=G.from(ze,ft)),G.isBuffer(ze))return ze.length===0?-1:de(Ee,ze,ct,ft,pr);if(typeof ze=="number")return ze&=255,typeof Uint8Array.prototype.indexOf=="function"?pr?Uint8Array.prototype.indexOf.call(Ee,ze,ct):Uint8Array.prototype.lastIndexOf.call(Ee,ze,ct):de(Ee,[ze],ct,ft,pr);throw new TypeError("val must be string, number or Buffer")}function de(Ee,ze,ct,ft,pr){var fn,vn=1,En=Ee.length,bn=ze.length;if(ft!==void 0&&((ft=String(ft).toLowerCase())==="ucs2"||ft==="ucs-2"||ft==="utf16le"||ft==="utf-16le")){if(Ee.length<2||ze.length<2)return-1;vn=2,En/=2,bn/=2,ct/=2}function $n(On,si){return vn===1?On[si]:On.readUInt16BE(si*vn)}if(pr){var xn=-1;for(fn=ct;fn<En;fn++)if($n(Ee,fn)===$n(ze,xn===-1?0:fn-xn)){if(xn===-1&&(xn=fn),fn-xn+1===bn)return xn*vn}else xn!==-1&&(fn-=fn-xn),xn=-1}else for(ct+bn>En&&(ct=En-bn),fn=ct;fn>=0;fn--){for(var ti=!0,Cn=0;Cn<bn;Cn++)if($n(Ee,fn+Cn)!==$n(ze,Cn)){ti=!1;break}if(ti)return fn}return-1}function _e(Ee,ze,ct,ft){ct=Number(ct)||0;var pr=Ee.length-ct;ft?(ft=Number(ft))>pr&&(ft=pr):ft=pr;var fn=ze.length;ft>fn/2&&(ft=fn/2);for(var vn=0;vn<ft;++vn){var En=parseInt(ze.substr(2*vn,2),16);if(sr(En))return vn;Ee[ct+vn]=En}return vn}function we(Ee,ze,ct,ft){return at($e(ze,Ee.length-ct),Ee,ct,ft)}function pe(Ee,ze,ct,ft){return at(Bt(ze),Ee,ct,ft)}function xe(Ee,ze,ct,ft){return pe(Ee,ze,ct,ft)}function Ge(Ee,ze,ct,ft){return at(st(ze),Ee,ct,ft)}function Te(Ee,ze,ct,ft){return at(Qe(ze,Ee.length-ct),Ee,ct,ft)}function Ce(Ee,ze,ct){return ze===0&&ct===Ee.length?$.fromByteArray(Ee):$.fromByteArray(Ee.slice(ze,ct))}function Oe(Ee,ze,ct){ct=Math.min(Ee.length,ct);for(var ft=[],pr=ze;pr<ct;){var fn,vn,En,bn,$n=Ee[pr],xn=null,ti=$n>239?4:$n>223?3:$n>191?2:1;if(pr+ti<=ct)switch(ti){case 1:$n<128&&(xn=$n);break;case 2:(192&(fn=Ee[pr+1]))==128&&(bn=(31&$n)<<6|63&fn)>127&&(xn=bn);break;case 3:fn=Ee[pr+1],vn=Ee[pr+2],(192&fn)==128&&(192&vn)==128&&(bn=(15&$n)<<12|(63&fn)<<6|63&vn)>2047&&(bn<55296||bn>57343)&&(xn=bn);break;case 4:fn=Ee[pr+1],vn=Ee[pr+2],En=Ee[pr+3],(192&fn)==128&&(192&vn)==128&&(192&En)==128&&(bn=(15&$n)<<18|(63&fn)<<12|(63&vn)<<6|63&En)>65535&&bn<1114112&&(xn=bn)}xn===null?(xn=65533,ti=1):xn>65535&&(xn-=65536,ft.push(xn>>>10&1023|55296),xn=56320|1023&xn),ft.push(xn),pr+=ti}return Mt(ft)}g.kMaxLength=D,G.TYPED_ARRAY_SUPPORT=q(),G.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(G.prototype,"parent",{enumerable:!0,get:function(){if(G.isBuffer(this))return this.buffer}}),Object.defineProperty(G.prototype,"offset",{enumerable:!0,get:function(){if(G.isBuffer(this))return this.byteOffset}}),typeof Symbol<"u"&&Symbol.species!=null&&G[Symbol.species]===G&&Object.defineProperty(G,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),G.poolSize=8192,G.from=function(Ee,ze,ct){return H(Ee,ze,ct)},G.prototype.__proto__=Uint8Array.prototype,G.__proto__=Uint8Array,G.alloc=function(Ee,ze,ct){return V(Ee,ze,ct)},G.allocUnsafe=function(Ee){return K(Ee)},G.allocUnsafeSlow=function(Ee){return K(Ee)},G.isBuffer=function(Ee){return Ee!=null&&Ee._isBuffer===!0&&Ee!==G.prototype},G.compare=function(Ee,ze){if(pt(Ee,Uint8Array)&&(Ee=G.from(Ee,Ee.offset,Ee.byteLength)),pt(ze,Uint8Array)&&(ze=G.from(ze,ze.offset,ze.byteLength)),!G.isBuffer(Ee)||!G.isBuffer(ze))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(Ee===ze)return 0;for(var ct=Ee.length,ft=ze.length,pr=0,fn=Math.min(ct,ft);pr<fn;++pr)if(Ee[pr]!==ze[pr]){ct=Ee[pr],ft=ze[pr];break}return ct<ft?-1:ft<ct?1:0},G.isEncoding=function(Ee){switch(String(Ee).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},G.concat=function(Ee,ze){if(!Array.isArray(Ee))throw new TypeError('"list" argument must be an Array of Buffers');if(Ee.length===0)return G.alloc(0);var ct;if(ze===void 0)for(ze=0,ct=0;ct<Ee.length;++ct)ze+=Ee[ct].length;var ft=G.allocUnsafe(ze),pr=0;for(ct=0;ct<Ee.length;++ct){var fn=Ee[ct];if(pt(fn,Uint8Array)&&(fn=G.from(fn)),!G.isBuffer(fn))throw new TypeError('"list" argument must be an Array of Buffers');fn.copy(ft,pr),pr+=fn.length}return ft},G.byteLength=ee,G.prototype._isBuffer=!0,G.prototype.swap16=function(){var Ee=this.length;if(Ee%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var ze=0;ze<Ee;ze+=2)ce(this,ze,ze+1);return this},G.prototype.swap32=function(){var Ee=this.length;if(Ee%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var ze=0;ze<Ee;ze+=4)ce(this,ze,ze+3),ce(this,ze+1,ze+2);return this},G.prototype.swap64=function(){var Ee=this.length;if(Ee%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var ze=0;ze<Ee;ze+=8)ce(this,ze,ze+7),ce(this,ze+1,ze+6),ce(this,ze+2,ze+5),ce(this,ze+3,ze+4);return this},G.prototype.toString=function(){var Ee=this.length;return Ee===0?"":arguments.length===0?Oe(this,0,Ee):ae.apply(this,arguments)},G.prototype.toLocaleString=G.prototype.toString,G.prototype.equals=function(Ee){if(!G.isBuffer(Ee))throw new TypeError("Argument must be a Buffer");return this===Ee||G.compare(this,Ee)===0},G.prototype.inspect=function(){var Ee="",ze=g.INSPECT_MAX_BYTES;return Ee=this.toString("hex",0,ze).replace(/(.{2})/g,"$1 ").trim(),this.length>ze&&(Ee+=" ... "),"<Buffer "+Ee+">"},G.prototype.compare=function(Ee,ze,ct,ft,pr){if(pt(Ee,Uint8Array)&&(Ee=G.from(Ee,Ee.offset,Ee.byteLength)),!G.isBuffer(Ee))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof Ee);if(ze===void 0&&(ze=0),ct===void 0&&(ct=Ee?Ee.length:0),ft===void 0&&(ft=0),pr===void 0&&(pr=this.length),ze<0||ct>Ee.length||ft<0||pr>this.length)throw new RangeError("out of range index");if(ft>=pr&&ze>=ct)return 0;if(ft>=pr)return-1;if(ze>=ct)return 1;if(this===Ee)return 0;for(var fn=(pr>>>=0)-(ft>>>=0),vn=(ct>>>=0)-(ze>>>=0),En=Math.min(fn,vn),bn=this.slice(ft,pr),$n=Ee.slice(ze,ct),xn=0;xn<En;++xn)if(bn[xn]!==$n[xn]){fn=bn[xn],vn=$n[xn];break}return fn<vn?-1:vn<fn?1:0},G.prototype.includes=function(Ee,ze,ct){return this.indexOf(Ee,ze,ct)!==-1},G.prototype.indexOf=function(Ee,ze,ct){return le(this,Ee,ze,ct,!0)},G.prototype.lastIndexOf=function(Ee,ze,ct){return le(this,Ee,ze,ct,!1)},G.prototype.write=function(Ee,ze,ct,ft){if(ze===void 0)ft="utf8",ct=this.length,ze=0;else if(ct===void 0&&typeof ze=="string")ft=ze,ct=this.length,ze=0;else{if(!isFinite(ze))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");ze>>>=0,isFinite(ct)?(ct>>>=0,ft===void 0&&(ft="utf8")):(ft=ct,ct=void 0)}var pr=this.length-ze;if((ct===void 0||ct>pr)&&(ct=pr),Ee.length>0&&(ct<0||ze<0)||ze>this.length)throw new RangeError("Attempt to write outside buffer bounds");ft||(ft="utf8");for(var fn=!1;;)switch(ft){case"hex":return _e(this,Ee,ze,ct);case"utf8":case"utf-8":return we(this,Ee,ze,ct);case"ascii":return pe(this,Ee,ze,ct);case"latin1":case"binary":return xe(this,Ee,ze,ct);case"base64":return Ge(this,Ee,ze,ct);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Te(this,Ee,ze,ct);default:if(fn)throw new TypeError("Unknown encoding: "+ft);ft=(""+ft).toLowerCase(),fn=!0}},G.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var bt=4096;function Mt(Ee){var ze=Ee.length;if(ze<=bt)return String.fromCharCode.apply(String,Ee);for(var ct="",ft=0;ft<ze;)ct+=String.fromCharCode.apply(String,Ee.slice(ft,ft+=bt));return ct}function lt(Ee,ze,ct){var ft="";ct=Math.min(Ee.length,ct);for(var pr=ze;pr<ct;++pr)ft+=String.fromCharCode(127&Ee[pr]);return ft}function ir(Ee,ze,ct){var ft="";ct=Math.min(Ee.length,ct);for(var pr=ze;pr<ct;++pr)ft+=String.fromCharCode(Ee[pr]);return ft}function Ye(Ee,ze,ct){var ft=Ee.length;(!ze||ze<0)&&(ze=0),(!ct||ct<0||ct>ft)&&(ct=ft);for(var pr="",fn=ze;fn<ct;++fn)pr+=Ft(Ee[fn]);return pr}function xt(Ee,ze,ct){for(var ft=Ee.slice(ze,ct),pr="",fn=0;fn<ft.length;fn+=2)pr+=String.fromCharCode(ft[fn]+256*ft[fn+1]);return pr}function ar(Ee,ze,ct){if(Ee%1!=0||Ee<0)throw new RangeError("offset is not uint");if(Ee+ze>ct)throw new RangeError("Trying to access beyond buffer length")}function ht(Ee,ze,ct,ft,pr,fn){if(!G.isBuffer(Ee))throw new TypeError('"buffer" argument must be a Buffer instance');if(ze>pr||ze<fn)throw new RangeError('"value" argument is out of bounds');if(ct+ft>Ee.length)throw new RangeError("Index out of range")}function gt(Ee,ze,ct,ft,pr,fn){if(ct+ft>Ee.length)throw new RangeError("Index out of range");if(ct<0)throw new RangeError("Index out of range")}function zt(Ee,ze,ct,ft,pr){return ze=+ze,ct>>>=0,pr||gt(Ee,ze,ct,4),I.write(Ee,ze,ct,ft,23,4),ct+4}function ur(Ee,ze,ct,ft,pr){return ze=+ze,ct>>>=0,pr||gt(Ee,ze,ct,8),I.write(Ee,ze,ct,ft,52,8),ct+8}G.prototype.slice=function(Ee,ze){var ct=this.length;(Ee=~~Ee)<0?(Ee+=ct)<0&&(Ee=0):Ee>ct&&(Ee=ct),(ze=ze===void 0?ct:~~ze)<0?(ze+=ct)<0&&(ze=0):ze>ct&&(ze=ct),ze<Ee&&(ze=Ee);var ft=this.subarray(Ee,ze);return ft.__proto__=G.prototype,ft},G.prototype.readUIntLE=function(Ee,ze,ct){Ee>>>=0,ze>>>=0,ct||ar(Ee,ze,this.length);for(var ft=this[Ee],pr=1,fn=0;++fn<ze&&(pr*=256);)ft+=this[Ee+fn]*pr;return ft},G.prototype.readUIntBE=function(Ee,ze,ct){Ee>>>=0,ze>>>=0,ct||ar(Ee,ze,this.length);for(var ft=this[Ee+--ze],pr=1;ze>0&&(pr*=256);)ft+=this[Ee+--ze]*pr;return ft},G.prototype.readUInt8=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,1,this.length),this[Ee]},G.prototype.readUInt16LE=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,2,this.length),this[Ee]|this[Ee+1]<<8},G.prototype.readUInt16BE=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,2,this.length),this[Ee]<<8|this[Ee+1]},G.prototype.readUInt32LE=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,4,this.length),(this[Ee]|this[Ee+1]<<8|this[Ee+2]<<16)+16777216*this[Ee+3]},G.prototype.readUInt32BE=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,4,this.length),16777216*this[Ee]+(this[Ee+1]<<16|this[Ee+2]<<8|this[Ee+3])},G.prototype.readIntLE=function(Ee,ze,ct){Ee>>>=0,ze>>>=0,ct||ar(Ee,ze,this.length);for(var ft=this[Ee],pr=1,fn=0;++fn<ze&&(pr*=256);)ft+=this[Ee+fn]*pr;return ft>=(pr*=128)&&(ft-=Math.pow(2,8*ze)),ft},G.prototype.readIntBE=function(Ee,ze,ct){Ee>>>=0,ze>>>=0,ct||ar(Ee,ze,this.length);for(var ft=ze,pr=1,fn=this[Ee+--ft];ft>0&&(pr*=256);)fn+=this[Ee+--ft]*pr;return fn>=(pr*=128)&&(fn-=Math.pow(2,8*ze)),fn},G.prototype.readInt8=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,1,this.length),128&this[Ee]?-1*(255-this[Ee]+1):this[Ee]},G.prototype.readInt16LE=function(Ee,ze){Ee>>>=0,ze||ar(Ee,2,this.length);var ct=this[Ee]|this[Ee+1]<<8;return 32768&ct?4294901760|ct:ct},G.prototype.readInt16BE=function(Ee,ze){Ee>>>=0,ze||ar(Ee,2,this.length);var ct=this[Ee+1]|this[Ee]<<8;return 32768&ct?4294901760|ct:ct},G.prototype.readInt32LE=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,4,this.length),this[Ee]|this[Ee+1]<<8|this[Ee+2]<<16|this[Ee+3]<<24},G.prototype.readInt32BE=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,4,this.length),this[Ee]<<24|this[Ee+1]<<16|this[Ee+2]<<8|this[Ee+3]},G.prototype.readFloatLE=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,4,this.length),I.read(this,Ee,!0,23,4)},G.prototype.readFloatBE=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,4,this.length),I.read(this,Ee,!1,23,4)},G.prototype.readDoubleLE=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,8,this.length),I.read(this,Ee,!0,52,8)},G.prototype.readDoubleBE=function(Ee,ze){return Ee>>>=0,ze||ar(Ee,8,this.length),I.read(this,Ee,!1,52,8)},G.prototype.writeUIntLE=function(Ee,ze,ct,ft){Ee=+Ee,ze>>>=0,ct>>>=0,ft||ht(this,Ee,ze,ct,Math.pow(2,8*ct)-1,0);var pr=1,fn=0;for(this[ze]=255&Ee;++fn<ct&&(pr*=256);)this[ze+fn]=Ee/pr&255;return ze+ct},G.prototype.writeUIntBE=function(Ee,ze,ct,ft){Ee=+Ee,ze>>>=0,ct>>>=0,ft||ht(this,Ee,ze,ct,Math.pow(2,8*ct)-1,0);var pr=ct-1,fn=1;for(this[ze+pr]=255&Ee;--pr>=0&&(fn*=256);)this[ze+pr]=Ee/fn&255;return ze+ct},G.prototype.writeUInt8=function(Ee,ze,ct){return Ee=+Ee,ze>>>=0,ct||ht(this,Ee,ze,1,255,0),this[ze]=255&Ee,ze+1},G.prototype.writeUInt16LE=function(Ee,ze,ct){return Ee=+Ee,ze>>>=0,ct||ht(this,Ee,ze,2,65535,0),this[ze]=255&Ee,this[ze+1]=Ee>>>8,ze+2},G.prototype.writeUInt16BE=function(Ee,ze,ct){return Ee=+Ee,ze>>>=0,ct||ht(this,Ee,ze,2,65535,0),this[ze]=Ee>>>8,this[ze+1]=255&Ee,ze+2},G.prototype.writeUInt32LE=function(Ee,ze,ct){return Ee=+Ee,ze>>>=0,ct||ht(this,Ee,ze,4,4294967295,0),this[ze+3]=Ee>>>24,this[ze+2]=Ee>>>16,this[ze+1]=Ee>>>8,this[ze]=255&Ee,ze+4},G.prototype.writeUInt32BE=function(Ee,ze,ct){return Ee=+Ee,ze>>>=0,ct||ht(this,Ee,ze,4,4294967295,0),this[ze]=Ee>>>24,this[ze+1]=Ee>>>16,this[ze+2]=Ee>>>8,this[ze+3]=255&Ee,ze+4},G.prototype.writeIntLE=function(Ee,ze,ct,ft){if(Ee=+Ee,ze>>>=0,!ft){var pr=Math.pow(2,8*ct-1);ht(this,Ee,ze,ct,pr-1,-pr)}var fn=0,vn=1,En=0;for(this[ze]=255&Ee;++fn<ct&&(vn*=256);)Ee<0&&En===0&&this[ze+fn-1]!==0&&(En=1),this[ze+fn]=(Ee/vn|0)-En&255;return ze+ct},G.prototype.writeIntBE=function(Ee,ze,ct,ft){if(Ee=+Ee,ze>>>=0,!ft){var pr=Math.pow(2,8*ct-1);ht(this,Ee,ze,ct,pr-1,-pr)}var fn=ct-1,vn=1,En=0;for(this[ze+fn]=255&Ee;--fn>=0&&(vn*=256);)Ee<0&&En===0&&this[ze+fn+1]!==0&&(En=1),this[ze+fn]=(Ee/vn|0)-En&255;return ze+ct},G.prototype.writeInt8=function(Ee,ze,ct){return Ee=+Ee,ze>>>=0,ct||ht(this,Ee,ze,1,127,-128),Ee<0&&(Ee=255+Ee+1),this[ze]=255&Ee,ze+1},G.prototype.writeInt16LE=function(Ee,ze,ct){return Ee=+Ee,ze>>>=0,ct||ht(this,Ee,ze,2,32767,-32768),this[ze]=255&Ee,this[ze+1]=Ee>>>8,ze+2},G.prototype.writeInt16BE=function(Ee,ze,ct){return Ee=+Ee,ze>>>=0,ct||ht(this,Ee,ze,2,32767,-32768),this[ze]=Ee>>>8,this[ze+1]=255&Ee,ze+2},G.prototype.writeInt32LE=function(Ee,ze,ct){return Ee=+Ee,ze>>>=0,ct||ht(this,Ee,ze,4,2147483647,-2147483648),this[ze]=255&Ee,this[ze+1]=Ee>>>8,this[ze+2]=Ee>>>16,this[ze+3]=Ee>>>24,ze+4},G.prototype.writeInt32BE=function(Ee,ze,ct){return Ee=+Ee,ze>>>=0,ct||ht(this,Ee,ze,4,2147483647,-2147483648),Ee<0&&(Ee=4294967295+Ee+1),this[ze]=Ee>>>24,this[ze+1]=Ee>>>16,this[ze+2]=Ee>>>8,this[ze+3]=255&Ee,ze+4},G.prototype.writeFloatLE=function(Ee,ze,ct){return zt(this,Ee,ze,!0,ct)},G.prototype.writeFloatBE=function(Ee,ze,ct){return zt(this,Ee,ze,!1,ct)},G.prototype.writeDoubleLE=function(Ee,ze,ct){return ur(this,Ee,ze,!0,ct)},G.prototype.writeDoubleBE=function(Ee,ze,ct){return ur(this,Ee,ze,!1,ct)},G.prototype.copy=function(Ee,ze,ct,ft){if(!G.isBuffer(Ee))throw new TypeError("argument should be a Buffer");if(ct||(ct=0),ft||ft===0||(ft=this.length),ze>=Ee.length&&(ze=Ee.length),ze||(ze=0),ft>0&&ft<ct&&(ft=ct),ft===ct||Ee.length===0||this.length===0)return 0;if(ze<0)throw new RangeError("targetStart out of bounds");if(ct<0||ct>=this.length)throw new RangeError("Index out of range");if(ft<0)throw new RangeError("sourceEnd out of bounds");ft>this.length&&(ft=this.length),Ee.length-ze<ft-ct&&(ft=Ee.length-ze+ct);var pr=ft-ct;if(this===Ee&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(ze,ct,ft);else if(this===Ee&&ct<ze&&ze<ft)for(var fn=pr-1;fn>=0;--fn)Ee[fn+ze]=this[fn+ct];else Uint8Array.prototype.set.call(Ee,this.subarray(ct,ft),ze);return pr},G.prototype.fill=function(Ee,ze,ct,ft){if(typeof Ee=="string"){if(typeof ze=="string"?(ft=ze,ze=0,ct=this.length):typeof ct=="string"&&(ft=ct,ct=this.length),ft!==void 0&&typeof ft!="string")throw new TypeError("encoding must be a string");if(typeof ft=="string"&&!G.isEncoding(ft))throw new TypeError("Unknown encoding: "+ft);if(Ee.length===1){var pr=Ee.charCodeAt(0);(ft==="utf8"&&pr<128||ft==="latin1")&&(Ee=pr)}}else typeof Ee=="number"&&(Ee&=255);if(ze<0||this.length<ze||this.length<ct)throw new RangeError("Out of range index");if(ct<=ze)return this;var fn;if(ze>>>=0,ct=ct===void 0?this.length:ct>>>0,Ee||(Ee=0),typeof Ee=="number")for(fn=ze;fn<ct;++fn)this[fn]=Ee;else{var vn=G.isBuffer(Ee)?Ee:G.from(Ee,ft),En=vn.length;if(En===0)throw new TypeError('The value "'+Ee+'" is invalid for argument "value"');for(fn=0;fn<ct-ze;++fn)this[fn+ze]=vn[fn%En]}return this};var dr=/[^+/0-9A-Za-z-_]/g;function fr(Ee){if((Ee=(Ee=Ee.split("=")[0]).trim().replace(dr,"")).length<2)return"";for(;Ee.length%4!=0;)Ee+="=";return Ee}function Ft(Ee){return Ee<16?"0"+Ee.toString(16):Ee.toString(16)}function $e(Ee,ze){var ct;ze=ze||1/0;for(var ft=Ee.length,pr=null,fn=[],vn=0;vn<ft;++vn){if((ct=Ee.charCodeAt(vn))>55295&&ct<57344){if(!pr){if(ct>56319){(ze-=3)>-1&&fn.push(239,191,189);continue}if(vn+1===ft){(ze-=3)>-1&&fn.push(239,191,189);continue}pr=ct;continue}if(ct<56320){(ze-=3)>-1&&fn.push(239,191,189),pr=ct;continue}ct=65536+(pr-55296<<10|ct-56320)}else pr&&(ze-=3)>-1&&fn.push(239,191,189);if(pr=null,ct<128){if((ze-=1)<0)break;fn.push(ct)}else if(ct<2048){if((ze-=2)<0)break;fn.push(ct>>6|192,63&ct|128)}else if(ct<65536){if((ze-=3)<0)break;fn.push(ct>>12|224,ct>>6&63|128,63&ct|128)}else{if(!(ct<1114112))throw new Error("Invalid code point");if((ze-=4)<0)break;fn.push(ct>>18|240,ct>>12&63|128,ct>>6&63|128,63&ct|128)}}return fn}function Bt(Ee){for(var ze=[],ct=0;ct<Ee.length;++ct)ze.push(255&Ee.charCodeAt(ct));return ze}function Qe(Ee,ze){for(var ct,ft,pr,fn=[],vn=0;vn<Ee.length&&!((ze-=2)<0);++vn)ft=(ct=Ee.charCodeAt(vn))>>8,pr=ct%256,fn.push(pr),fn.push(ft);return fn}function st(Ee){return $.toByteArray(fr(Ee))}function at(Ee,ze,ct,ft){for(var pr=0;pr<ft&&!(pr+ct>=ze.length||pr>=Ee.length);++pr)ze[pr+ct]=Ee[pr];return pr}function pt(Ee,ze){return Ee instanceof ze||Ee!=null&&Ee.constructor!=null&&Ee.constructor.name!=null&&Ee.constructor.name===ze.name}function sr(Ee){return Ee!=Ee}}).call(this)}).call(this,d("buffer").Buffer)},{"base64-js":28,buffer:32,ieee754:45}],33:[function(d,m,g){var w=d("get-intrinsic"),$=d("./"),I=$(w("String.prototype.indexOf"));m.exports=function(D,q){var j=w(D,!!q);return typeof j=="function"&&I(D,".prototype.")>-1?$(j):j}},{"./":34,"get-intrinsic":39}],34:[function(d,m,g){var w=d("function-bind"),$=d("get-intrinsic"),I=$("%Function.prototype.apply%"),D=$("%Function.prototype.call%"),q=$("%Reflect.apply%",!0)||w.call(D,I),j=$("%Object.getOwnPropertyDescriptor%",!0),G=$("%Object.defineProperty%",!0),H=$("%Math.max%");if(G)try{G({},"a",{value:1})}catch{G=null}m.exports=function(V){var K=q(w,D,arguments);return j&&G&&j(K,"length").configurable&&G(K,"length",{value:1+H(0,V.length-(arguments.length-1))}),K};var W=function(){return q(w,I,arguments)};G?G(m.exports,"apply",{value:W}):m.exports.apply=W},{"function-bind":38,"get-intrinsic":39}],35:[function(d,m,g){var w,$=typeof Reflect=="object"?Reflect:null,I=$&&typeof $.apply=="function"?$.apply:function(le,de,_e){return Function.prototype.apply.call(le,de,_e)};function D(le){console&&console.warn&&console.warn(le)}w=$&&typeof $.ownKeys=="function"?$.ownKeys:Object.getOwnPropertySymbols?function(le){return Object.getOwnPropertyNames(le).concat(Object.getOwnPropertySymbols(le))}:function(le){return Object.getOwnPropertyNames(le)};var q=Number.isNaN||function(le){return le!=le};function j(){j.init.call(this)}m.exports=j,m.exports.once=ee,j.EventEmitter=j,j.prototype._events=void 0,j.prototype._eventsCount=0,j.prototype._maxListeners=void 0;var G=10;function H(le){if(typeof le!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof le)}function W(le){return le._maxListeners===void 0?j.defaultMaxListeners:le._maxListeners}function V(le,de,_e,we){var pe,xe,Ge;if(H(_e),(xe=le._events)===void 0?(xe=le._events=Object.create(null),le._eventsCount=0):(xe.newListener!==void 0&&(le.emit("newListener",de,_e.listener?_e.listener:_e),xe=le._events),Ge=xe[de]),Ge===void 0)Ge=xe[de]=_e,++le._eventsCount;else if(typeof Ge=="function"?Ge=xe[de]=we?[_e,Ge]:[Ge,_e]:we?Ge.unshift(_e):Ge.push(_e),(pe=W(le))>0&&Ge.length>pe&&!Ge.warned){Ge.warned=!0;var Te=new Error("Possible EventEmitter memory leak detected. "+Ge.length+" "+String(de)+" listeners added. Use emitter.setMaxListeners() to increase limit");Te.name="MaxListenersExceededWarning",Te.emitter=le,Te.type=de,Te.count=Ge.length,D(Te)}return le}function K(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Z(le,de,_e){var we={fired:!1,wrapFn:void 0,target:le,type:de,listener:_e},pe=K.bind(we);return pe.listener=_e,we.wrapFn=pe,pe}function Q(le,de,_e){var we=le._events;if(we===void 0)return[];var pe=we[de];return pe===void 0?[]:typeof pe=="function"?_e?[pe.listener||pe]:[pe]:_e?oe(pe):re(pe,pe.length)}function J(le){var de=this._events;if(de!==void 0){var _e=de[le];if(typeof _e=="function")return 1;if(_e!==void 0)return _e.length}return 0}function re(le,de){for(var _e=new Array(de),we=0;we<de;++we)_e[we]=le[we];return _e}function se(le,de){for(;de+1<le.length;de++)le[de]=le[de+1];le.pop()}function oe(le){for(var de=new Array(le.length),_e=0;_e<de.length;++_e)de[_e]=le[_e].listener||le[_e];return de}function ee(le,de){return new Promise((function(_e,we){function pe(Ge){le.removeListener(de,xe),we(Ge)}function xe(){typeof le.removeListener=="function"&&le.removeListener("error",pe),_e([].slice.call(arguments))}ce(le,de,xe,{once:!0}),de!=="error"&&ae(le,pe,{once:!0})}))}function ae(le,de,_e){typeof le.on=="function"&&ce(le,"error",de,_e)}function ce(le,de,_e,we){if(typeof le.on=="function")we.once?le.once(de,_e):le.on(de,_e);else{if(typeof le.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof le);le.addEventListener(de,(function pe(xe){we.once&&le.removeEventListener(de,pe),_e(xe)}))}}Object.defineProperty(j,"defaultMaxListeners",{enumerable:!0,get:function(){return G},set:function(le){if(typeof le!="number"||le<0||q(le))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+le+".");G=le}}),j.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},j.prototype.setMaxListeners=function(le){if(typeof le!="number"||le<0||q(le))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+le+".");return this._maxListeners=le,this},j.prototype.getMaxListeners=function(){return W(this)},j.prototype.emit=function(le){for(var de=[],_e=1;_e<arguments.length;_e++)de.push(arguments[_e]);var we=le==="error",pe=this._events;if(pe!==void 0)we=we&&pe.error===void 0;else if(!we)return!1;if(we){var xe;if(de.length>0&&(xe=de[0]),xe instanceof Error)throw xe;var Ge=new Error("Unhandled error."+(xe?" ("+xe.message+")":""));throw Ge.context=xe,Ge}var Te=pe[le];if(Te===void 0)return!1;if(typeof Te=="function")I(Te,this,de);else{var Ce=Te.length,Oe=re(Te,Ce);for(_e=0;_e<Ce;++_e)I(Oe[_e],this,de)}return!0},j.prototype.addListener=function(le,de){return V(this,le,de,!1)},j.prototype.on=j.prototype.addListener,j.prototype.prependListener=function(le,de){return V(this,le,de,!0)},j.prototype.once=function(le,de){return H(de),this.on(le,Z(this,le,de)),this},j.prototype.prependOnceListener=function(le,de){return H(de),this.prependListener(le,Z(this,le,de)),this},j.prototype.removeListener=function(le,de){var _e,we,pe,xe,Ge;if(H(de),(we=this._events)===void 0)return this;if((_e=we[le])===void 0)return this;if(_e===de||_e.listener===de)--this._eventsCount==0?this._events=Object.create(null):(delete we[le],we.removeListener&&this.emit("removeListener",le,_e.listener||de));else if(typeof _e!="function"){for(pe=-1,xe=_e.length-1;xe>=0;xe--)if(_e[xe]===de||_e[xe].listener===de){Ge=_e[xe].listener,pe=xe;break}if(pe<0)return this;pe===0?_e.shift():se(_e,pe),_e.length===1&&(we[le]=_e[0]),we.removeListener!==void 0&&this.emit("removeListener",le,Ge||de)}return this},j.prototype.off=j.prototype.removeListener,j.prototype.removeAllListeners=function(le){var de,_e,we;if((_e=this._events)===void 0)return this;if(_e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):_e[le]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete _e[le]),this;if(arguments.length===0){var pe,xe=Object.keys(_e);for(we=0;we<xe.length;++we)(pe=xe[we])!=="removeListener"&&this.removeAllListeners(pe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(de=_e[le])=="function")this.removeListener(le,de);else if(de!==void 0)for(we=de.length-1;we>=0;we--)this.removeListener(le,de[we]);return this},j.prototype.listeners=function(le){return Q(this,le,!0)},j.prototype.rawListeners=function(le){return Q(this,le,!1)},j.listenerCount=function(le,de){return typeof le.listenerCount=="function"?le.listenerCount(de):J.call(le,de)},j.prototype.listenerCount=J,j.prototype.eventNames=function(){return this._eventsCount>0?w(this._events):[]}},{}],36:[function(d,m,g){var w=d("is-callable"),$=Object.prototype.toString,I=Object.prototype.hasOwnProperty,D=function(H,W,V){for(var K=0,Z=H.length;K<Z;K++)I.call(H,K)&&(V==null?W(H[K],K,H):W.call(V,H[K],K,H))},q=function(H,W,V){for(var K=0,Z=H.length;K<Z;K++)V==null?W(H.charAt(K),K,H):W.call(V,H.charAt(K),K,H)},j=function(H,W,V){for(var K in H)I.call(H,K)&&(V==null?W(H[K],K,H):W.call(V,H[K],K,H))},G=function(H,W,V){if(!w(W))throw new TypeError("iterator must be a function");var K;arguments.length>=3&&(K=V),$.call(H)==="[object Array]"?D(H,W,K):typeof H=="string"?q(H,W,K):j(H,W,K)};m.exports=G},{"is-callable":48}],37:[function(d,m,g){var w="Function.prototype.bind called on incompatible ",$=Array.prototype.slice,I=Object.prototype.toString,D="[object Function]";m.exports=function(q){var j=this;if(typeof j!="function"||I.call(j)!==D)throw new TypeError(w+j);for(var G,H=$.call(arguments,1),W=function(){if(this instanceof G){var J=j.apply(this,H.concat($.call(arguments)));return Object(J)===J?J:this}return j.apply(q,H.concat($.call(arguments)))},V=Math.max(0,j.length-H.length),K=[],Z=0;Z<V;Z++)K.push("$"+Z);if(G=Function("binder","return function ("+K.join(",")+"){ return binder.apply(this,arguments); }")(W),j.prototype){var Q=function(){};Q.prototype=j.prototype,G.prototype=new Q,Q.prototype=null}return G}},{}],38:[function(d,m,g){var w=d("./implementation");m.exports=Function.prototype.bind||w},{"./implementation":37}],39:[function(d,m,g){var w,$=SyntaxError,I=Function,D=TypeError,q=function(Te){try{return I('"use strict"; return ('+Te+").constructor;")()}catch{}},j=Object.getOwnPropertyDescriptor;if(j)try{j({},"")}catch{j=null}var G=function(){throw new D},H=j?(function(){try{return G}catch{try{return j(arguments,"callee").get}catch{return G}}})():G,W=d("has-symbols")(),V=Object.getPrototypeOf||function(Te){return Te.__proto__},K={},Z=typeof Uint8Array>"u"?w:V(Uint8Array),Q={"%AggregateError%":typeof AggregateError>"u"?w:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?w:ArrayBuffer,"%ArrayIteratorPrototype%":W?V([][Symbol.iterator]()):w,"%AsyncFromSyncIteratorPrototype%":w,"%AsyncFunction%":K,"%AsyncGenerator%":K,"%AsyncGeneratorFunction%":K,"%AsyncIteratorPrototype%":K,"%Atomics%":typeof Atomics>"u"?w:Atomics,"%BigInt%":typeof BigInt>"u"?w:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?w:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?w:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?w:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?w:Float32Array,"%Float64Array%":typeof Float64Array>"u"?w:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?w:FinalizationRegistry,"%Function%":I,"%GeneratorFunction%":K,"%Int8Array%":typeof Int8Array>"u"?w:Int8Array,"%Int16Array%":typeof Int16Array>"u"?w:Int16Array,"%Int32Array%":typeof Int32Array>"u"?w:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":W?V(V([][Symbol.iterator]())):w,"%JSON%":typeof JSON=="object"?JSON:w,"%Map%":typeof Map>"u"?w:Map,"%MapIteratorPrototype%":typeof Map<"u"&&W?V(new Map()[Symbol.iterator]()):w,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?w:Promise,"%Proxy%":typeof Proxy>"u"?w:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?w:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?w:Set,"%SetIteratorPrototype%":typeof Set<"u"&&W?V(new Set()[Symbol.iterator]()):w,"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?w:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":W?V(""[Symbol.iterator]()):w,"%Symbol%":W?Symbol:w,"%SyntaxError%":$,"%ThrowTypeError%":H,"%TypedArray%":Z,"%TypeError%":D,"%Uint8Array%":typeof Uint8Array>"u"?w:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?w:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?w:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?w:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?w:WeakMap,"%WeakRef%":typeof WeakRef>"u"?w:WeakRef,"%WeakSet%":typeof WeakSet>"u"?w:WeakSet};try{null.error}catch(Te){var J=V(V(Te));Q["%Error.prototype%"]=J}var re=function Te(Ce){var Oe;if(Ce==="%AsyncFunction%")Oe=q("async function () {}");else if(Ce==="%GeneratorFunction%")Oe=q("function* () {}");else if(Ce==="%AsyncGeneratorFunction%")Oe=q("async function* () {}");else if(Ce==="%AsyncGenerator%"){var bt=Te("%AsyncGeneratorFunction%");bt&&(Oe=bt.prototype)}else if(Ce==="%AsyncIteratorPrototype%"){var Mt=Te("%AsyncGenerator%");Mt&&(Oe=V(Mt.prototype))}return Q[Ce]=Oe,Oe},se={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},oe=d("function-bind"),ee=d("has"),ae=oe.call(Function.call,Array.prototype.concat),ce=oe.call(Function.apply,Array.prototype.splice),le=oe.call(Function.call,String.prototype.replace),de=oe.call(Function.call,String.prototype.slice),_e=oe.call(Function.call,RegExp.prototype.exec),we=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,pe=/\\(\\)?/g,xe=function(Te){var Ce=de(Te,0,1),Oe=de(Te,-1);if(Ce==="%"&&Oe!=="%")throw new $("invalid intrinsic syntax, expected closing `%`");if(Oe==="%"&&Ce!=="%")throw new $("invalid intrinsic syntax, expected opening `%`");var bt=[];return le(Te,we,(function(Mt,lt,ir,Ye){bt[bt.length]=ir?le(Ye,pe,"$1"):lt||Mt})),bt},Ge=function(Te,Ce){var Oe,bt=Te;if(ee(se,bt)&&(bt="%"+(Oe=se[bt])[0]+"%"),ee(Q,bt)){var Mt=Q[bt];if(Mt===K&&(Mt=re(bt)),Mt===void 0&&!Ce)throw new D("intrinsic "+Te+" exists, but is not available. Please file an issue!");return{alias:Oe,name:bt,value:Mt}}throw new $("intrinsic "+Te+" does not exist!")};m.exports=function(Te,Ce){if(typeof Te!="string"||Te.length===0)throw new D("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Ce!="boolean")throw new D('"allowMissing" argument must be a boolean');if(_e(/^%?[^%]*%?$/,Te)===null)throw new $("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Oe=xe(Te),bt=Oe.length>0?Oe[0]:"",Mt=Ge("%"+bt+"%",Ce),lt=Mt.name,ir=Mt.value,Ye=!1,xt=Mt.alias;xt&&(bt=xt[0],ce(Oe,ae([0,1],xt)));for(var ar=1,ht=!0;ar<Oe.length;ar+=1){var gt=Oe[ar],zt=de(gt,0,1),ur=de(gt,-1);if((zt==='"'||zt==="'"||zt==="`"||ur==='"'||ur==="'"||ur==="`")&&zt!==ur)throw new $("property names with quotes must have matching quotes");if(gt!=="constructor"&&ht||(Ye=!0),ee(Q,lt="%"+(bt+="."+gt)+"%"))ir=Q[lt];else if(ir!=null){if(!(gt in ir)){if(!Ce)throw new D("base intrinsic for "+Te+" exists, but the property is not available.");return}if(j&&ar+1>=Oe.length){var dr=j(ir,gt);ir=(ht=!!dr)&&"get"in dr&&!("originalValue"in dr.get)?dr.get:ir[gt]}else ht=ee(ir,gt),ir=ir[gt];ht&&!Ye&&(Q[lt]=ir)}}return ir}},{"function-bind":38,has:44,"has-symbols":41}],40:[function(d,m,g){var w=d("get-intrinsic")("%Object.getOwnPropertyDescriptor%",!0);if(w)try{w([],"length")}catch{w=null}m.exports=w},{"get-intrinsic":39}],41:[function(d,m,g){var w=typeof Symbol<"u"&&Symbol,$=d("./shams");m.exports=function(){return typeof w=="function"&&typeof Symbol=="function"&&typeof w("foo")=="symbol"&&typeof Symbol("bar")=="symbol"&&$()}},{"./shams":42}],42:[function(d,m,g){m.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var w={},$=Symbol("test"),I=Object($);if(typeof $=="string"||Object.prototype.toString.call($)!=="[object Symbol]"||Object.prototype.toString.call(I)!=="[object Symbol]")return!1;var D=42;for($ in w[$]=D,w)return!1;if(typeof Object.keys=="function"&&Object.keys(w).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(w).length!==0)return!1;var q=Object.getOwnPropertySymbols(w);if(q.length!==1||q[0]!==$||!Object.prototype.propertyIsEnumerable.call(w,$))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var j=Object.getOwnPropertyDescriptor(w,$);if(j.value!==D||j.enumerable!==!0)return!1}return!0}},{}],43:[function(d,m,g){var w=d("has-symbols/shams");m.exports=function(){return w()&&!!Symbol.toStringTag}},{"has-symbols/shams":42}],44:[function(d,m,g){var w=d("function-bind");m.exports=w.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":38}],45:[function(d,m,g){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */g.read=function(w,$,I,D,q){var j,G,H=8*q-D-1,W=(1<<H)-1,V=W>>1,K=-7,Z=I?q-1:0,Q=I?-1:1,J=w[$+Z];for(Z+=Q,j=J&(1<<-K)-1,J>>=-K,K+=H;K>0;j=256*j+w[$+Z],Z+=Q,K-=8);for(G=j&(1<<-K)-1,j>>=-K,K+=D;K>0;G=256*G+w[$+Z],Z+=Q,K-=8);if(j===0)j=1-V;else{if(j===W)return G?NaN:1/0*(J?-1:1);G+=Math.pow(2,D),j-=V}return(J?-1:1)*G*Math.pow(2,j-D)},g.write=function(w,$,I,D,q,j){var G,H,W,V=8*j-q-1,K=(1<<V)-1,Z=K>>1,Q=q===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=D?0:j-1,re=D?1:-1,se=$<0||$===0&&1/$<0?1:0;for($=Math.abs($),isNaN($)||$===1/0?(H=isNaN($)?1:0,G=K):(G=Math.floor(Math.log($)/Math.LN2),$*(W=Math.pow(2,-G))<1&&(G--,W*=2),($+=G+Z>=1?Q/W:Q*Math.pow(2,1-Z))*W>=2&&(G++,W/=2),G+Z>=K?(H=0,G=K):G+Z>=1?(H=($*W-1)*Math.pow(2,q),G+=Z):(H=$*Math.pow(2,Z-1)*Math.pow(2,q),G=0));q>=8;w[I+J]=255&H,J+=re,H/=256,q-=8);for(G=G<<q|H,V+=q;V>0;w[I+J]=255&G,J+=re,G/=256,V-=8);w[I+J-re]|=128*se}},{}],46:[function(d,m,g){typeof Object.create=="function"?m.exports=function(w,$){$&&(w.super_=$,w.prototype=Object.create($.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}))}:m.exports=function(w,$){if($){w.super_=$;var I=function(){};I.prototype=$.prototype,w.prototype=new I,w.prototype.constructor=w}}},{}],47:[function(d,m,g){var w=d("has-tostringtag/shams")(),$=d("call-bind/callBound")("Object.prototype.toString"),I=function(j){return!(w&&j&&typeof j=="object"&&Symbol.toStringTag in j)&&$(j)==="[object Arguments]"},D=function(j){return!!I(j)||j!==null&&typeof j=="object"&&typeof j.length=="number"&&j.length>=0&&$(j)!=="[object Array]"&&$(j.callee)==="[object Function]"},q=(function(){return I(arguments)})();I.isLegacyArguments=D,m.exports=q?I:D},{"call-bind/callBound":33,"has-tostringtag/shams":43}],48:[function(d,m,g){var w,$,I=Function.prototype.toString,D=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply;if(typeof D=="function"&&typeof Object.defineProperty=="function")try{w=Object.defineProperty({},"length",{get:function(){throw $}}),$={},D((function(){throw 42}),null,w)}catch(ae){ae!==$&&(D=null)}else D=null;var q=/^\s*class\b/,j=function(ae){try{var ce=I.call(ae);return q.test(ce)}catch{return!1}},G=function(ae){try{return!j(ae)&&(I.call(ae),!0)}catch{return!1}},H=Object.prototype.toString,W="[object Object]",V="[object Function]",K="[object GeneratorFunction]",Z="[object HTMLAllCollection]",Q="[object HTML document.all class]",J="[object HTMLCollection]",re=typeof Symbol=="function"&&!!Symbol.toStringTag,se=!(0 in[,]),oe=function(){return!1};if(typeof document=="object"){var ee=document.all;H.call(ee)===H.call(document.all)&&(oe=function(ae){if((se||!ae)&&(ae===void 0||typeof ae=="object"))try{var ce=H.call(ae);return(ce===Z||ce===Q||ce===J||ce===W)&&ae("")==null}catch{}return!1})}m.exports=D?function(ae){if(oe(ae))return!0;if(!ae||typeof ae!="function"&&typeof ae!="object")return!1;try{D(ae,null,w)}catch(ce){if(ce!==$)return!1}return!j(ae)&&G(ae)}:function(ae){if(oe(ae))return!0;if(!ae||typeof ae!="function"&&typeof ae!="object")return!1;if(re)return G(ae);if(j(ae))return!1;var ce=H.call(ae);return!(ce!==V&&ce!==K&&!/^\[object HTML/.test(ce))&&G(ae)}},{}],49:[function(d,m,g){var w,$=Object.prototype.toString,I=Function.prototype.toString,D=/^\s*(?:function)?\*/,q=d("has-tostringtag/shams")(),j=Object.getPrototypeOf,G=function(){if(!q)return!1;try{return Function("return function*() {}")()}catch{}};m.exports=function(H){if(typeof H!="function")return!1;if(D.test(I.call(H)))return!0;if(!q)return $.call(H)==="[object GeneratorFunction]";if(!j)return!1;if(w===void 0){var W=G();w=!!W&&j(W)}return j(H)===w}},{"has-tostringtag/shams":43}],50:[function(d,m,g){(function(w){(function(){var $=d("for-each"),I=d("available-typed-arrays"),D=d("call-bind/callBound"),q=D("Object.prototype.toString"),j=d("has-tostringtag/shams")(),G=d("gopd"),H=typeof globalThis>"u"?w:globalThis,W=I(),V=D("Array.prototype.indexOf",!0)||function(re,se){for(var oe=0;oe<re.length;oe+=1)if(re[oe]===se)return oe;return-1},K=D("String.prototype.slice"),Z={},Q=Object.getPrototypeOf;j&&G&&Q&&$(W,(function(re){var se=new H[re];if(Symbol.toStringTag in se){var oe=Q(se),ee=G(oe,Symbol.toStringTag);if(!ee){var ae=Q(oe);ee=G(ae,Symbol.toStringTag)}Z[re]=ee.get}}));var J=function(re){var se=!1;return $(Z,(function(oe,ee){if(!se)try{se=oe.call(re)===ee}catch{}})),se};m.exports=function(re){if(!re||typeof re!="object")return!1;if(!j||!(Symbol.toStringTag in re)){var se=K(q(re),8,-1);return V(W,se)>-1}return!!G&&J(re)}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":27,"call-bind/callBound":33,"for-each":36,gopd:40,"has-tostringtag/shams":43}],51:[function(d,m,g){var w=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;function D(j){if(j==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(j)}function q(){try{if(!Object.assign)return!1;var j=new String("abc");if(j[5]="de",Object.getOwnPropertyNames(j)[0]==="5")return!1;for(var G={},H=0;H<10;H++)G["_"+String.fromCharCode(H)]=H;var W=Object.getOwnPropertyNames(G).map((function(K){return G[K]}));if(W.join("")!=="0123456789")return!1;var V={};return"abcdefghijklmnopqrst".split("").forEach((function(K){V[K]=K})),Object.keys(Object.assign({},V)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}m.exports=q()?Object.assign:function(j,G){for(var H,W,V=D(j),K=1;K<arguments.length;K++){for(var Z in H=Object(arguments[K]))$.call(H,Z)&&(V[Z]=H[Z]);if(w){W=w(H);for(var Q=0;Q<W.length;Q++)I.call(H,W[Q])&&(V[W[Q]]=H[W[Q]])}}return V}},{}],52:[function(d,m,g){var w=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function $(q,j){return Object.prototype.hasOwnProperty.call(q,j)}g.assign=function(q){for(var j=Array.prototype.slice.call(arguments,1);j.length;){var G=j.shift();if(G){if(typeof G!="object")throw new TypeError(G+"must be non-object");for(var H in G)$(G,H)&&(q[H]=G[H])}}return q},g.shrinkBuf=function(q,j){return q.length===j?q:q.subarray?q.subarray(0,j):(q.length=j,q)};var I={arraySet:function(q,j,G,H,W){if(j.subarray&&q.subarray)q.set(j.subarray(G,G+H),W);else for(var V=0;V<H;V++)q[W+V]=j[G+V]},flattenChunks:function(q){var j,G,H,W,V,K;for(H=0,j=0,G=q.length;j<G;j++)H+=q[j].length;for(K=new Uint8Array(H),W=0,j=0,G=q.length;j<G;j++)V=q[j],K.set(V,W),W+=V.length;return K}},D={arraySet:function(q,j,G,H,W){for(var V=0;V<H;V++)q[W+V]=j[G+V]},flattenChunks:function(q){return[].concat.apply([],q)}};g.setTyped=function(q){q?(g.Buf8=Uint8Array,g.Buf16=Uint16Array,g.Buf32=Int32Array,g.assign(g,I)):(g.Buf8=Array,g.Buf16=Array,g.Buf32=Array,g.assign(g,D))},g.setTyped(w)},{}],53:[function(d,m,g){function w($,I,D,q){for(var j=65535&$,G=$>>>16&65535,H=0;D!==0;){D-=H=D>2e3?2e3:D;do G=G+(j=j+I[q++]|0)|0;while(--H);j%=65521,G%=65521}return j|G<<16}m.exports=w},{}],54:[function(d,m,g){m.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],55:[function(d,m,g){function w(){for(var D,q=[],j=0;j<256;j++){D=j;for(var G=0;G<8;G++)D=1&D?3988292384^D>>>1:D>>>1;q[j]=D}return q}var $=w();function I(D,q,j,G){var H=$,W=G+j;D^=-1;for(var V=G;V<W;V++)D=D>>>8^H[255&(D^q[V])];return~D}m.exports=I},{}],56:[function(d,m,g){var w,$=d("../utils/common"),I=d("./trees"),D=d("./adler32"),q=d("./crc32"),j=d("./messages"),G=0,H=1,W=3,V=4,K=5,Z=0,Q=1,J=-2,re=-3,se=-5,oe=-1,ee=1,ae=2,ce=3,le=4,de=0,_e=2,we=8,pe=9,xe=15,Ge=8,Te=286,Ce=30,Oe=19,bt=2*Te+1,Mt=15,lt=3,ir=258,Ye=ir+lt+1,xt=32,ar=42,ht=69,gt=73,zt=91,ur=103,dr=113,fr=666,Ft=1,$e=2,Bt=3,Qe=4,st=3;function at(Ze,_n){return Ze.msg=j[_n],_n}function pt(Ze){return(Ze<<1)-(Ze>4?9:0)}function sr(Ze){for(var _n=Ze.length;--_n>=0;)Ze[_n]=0}function Ee(Ze){var _n=Ze.state,hn=_n.pending;hn>Ze.avail_out&&(hn=Ze.avail_out),hn!==0&&($.arraySet(Ze.output,_n.pending_buf,_n.pending_out,hn,Ze.next_out),Ze.next_out+=hn,_n.pending_out+=hn,Ze.total_out+=hn,Ze.avail_out-=hn,_n.pending-=hn,_n.pending===0&&(_n.pending_out=0))}function ze(Ze,_n){I._tr_flush_block(Ze,Ze.block_start>=0?Ze.block_start:-1,Ze.strstart-Ze.block_start,_n),Ze.block_start=Ze.strstart,Ee(Ze.strm)}function ct(Ze,_n){Ze.pending_buf[Ze.pending++]=_n}function ft(Ze,_n){Ze.pending_buf[Ze.pending++]=_n>>>8&255,Ze.pending_buf[Ze.pending++]=255&_n}function pr(Ze,_n,hn,cr){var gn=Ze.avail_in;return gn>cr&&(gn=cr),gn===0?0:(Ze.avail_in-=gn,$.arraySet(_n,Ze.input,Ze.next_in,gn,hn),Ze.state.wrap===1?Ze.adler=D(Ze.adler,_n,gn,hn):Ze.state.wrap===2&&(Ze.adler=q(Ze.adler,_n,gn,hn)),Ze.next_in+=gn,Ze.total_in+=gn,gn)}function fn(Ze,_n){var hn,cr,gn=Ze.max_chain_length,mn=Ze.strstart,ri=Ze.prev_length,An=Ze.nice_match,ei=Ze.strstart>Ze.w_size-Ye?Ze.strstart-(Ze.w_size-Ye):0,oi=Ze.window,wi=Ze.w_mask,ci=Ze.prev,hi=Ze.strstart+ir,mi=oi[mn+ri-1],gi=oi[mn+ri];Ze.prev_length>=Ze.good_match&&(gn>>=2),An>Ze.lookahead&&(An=Ze.lookahead);do if(oi[(hn=_n)+ri]===gi&&oi[hn+ri-1]===mi&&oi[hn]===oi[mn]&&oi[++hn]===oi[mn+1]){mn+=2,hn++;do;while(oi[++mn]===oi[++hn]&&oi[++mn]===oi[++hn]&&oi[++mn]===oi[++hn]&&oi[++mn]===oi[++hn]&&oi[++mn]===oi[++hn]&&oi[++mn]===oi[++hn]&&oi[++mn]===oi[++hn]&&oi[++mn]===oi[++hn]&&mn<hi);if(cr=ir-(hi-mn),mn=hi-ir,cr>ri){if(Ze.match_start=_n,ri=cr,cr>=An)break;mi=oi[mn+ri-1],gi=oi[mn+ri]}}while((_n=ci[_n&wi])>ei&&--gn!=0);return ri<=Ze.lookahead?ri:Ze.lookahead}function vn(Ze){var _n,hn,cr,gn,mn,ri=Ze.w_size;do{if(gn=Ze.window_size-Ze.lookahead-Ze.strstart,Ze.strstart>=ri+(ri-Ye)){$.arraySet(Ze.window,Ze.window,ri,ri,0),Ze.match_start-=ri,Ze.strstart-=ri,Ze.block_start-=ri,_n=hn=Ze.hash_size;do cr=Ze.head[--_n],Ze.head[_n]=cr>=ri?cr-ri:0;while(--hn);_n=hn=ri;do cr=Ze.prev[--_n],Ze.prev[_n]=cr>=ri?cr-ri:0;while(--hn);gn+=ri}if(Ze.strm.avail_in===0)break;if(hn=pr(Ze.strm,Ze.window,Ze.strstart+Ze.lookahead,gn),Ze.lookahead+=hn,Ze.lookahead+Ze.insert>=lt)for(mn=Ze.strstart-Ze.insert,Ze.ins_h=Ze.window[mn],Ze.ins_h=(Ze.ins_h<<Ze.hash_shift^Ze.window[mn+1])&Ze.hash_mask;Ze.insert&&(Ze.ins_h=(Ze.ins_h<<Ze.hash_shift^Ze.window[mn+lt-1])&Ze.hash_mask,Ze.prev[mn&Ze.w_mask]=Ze.head[Ze.ins_h],Ze.head[Ze.ins_h]=mn,mn++,Ze.insert--,!(Ze.lookahead+Ze.insert<lt)););}while(Ze.lookahead<Ye&&Ze.strm.avail_in!==0)}function En(Ze,_n){var hn=65535;for(hn>Ze.pending_buf_size-5&&(hn=Ze.pending_buf_size-5);;){if(Ze.lookahead<=1){if(vn(Ze),Ze.lookahead===0&&_n===G)return Ft;if(Ze.lookahead===0)break}Ze.strstart+=Ze.lookahead,Ze.lookahead=0;var cr=Ze.block_start+hn;if((Ze.strstart===0||Ze.strstart>=cr)&&(Ze.lookahead=Ze.strstart-cr,Ze.strstart=cr,ze(Ze,!1),Ze.strm.avail_out===0)||Ze.strstart-Ze.block_start>=Ze.w_size-Ye&&(ze(Ze,!1),Ze.strm.avail_out===0))return Ft}return Ze.insert=0,_n===V?(ze(Ze,!0),Ze.strm.avail_out===0?Bt:Qe):(Ze.strstart>Ze.block_start&&(ze(Ze,!1),Ze.strm.avail_out),Ft)}function bn(Ze,_n){for(var hn,cr;;){if(Ze.lookahead<Ye){if(vn(Ze),Ze.lookahead<Ye&&_n===G)return Ft;if(Ze.lookahead===0)break}if(hn=0,Ze.lookahead>=lt&&(Ze.ins_h=(Ze.ins_h<<Ze.hash_shift^Ze.window[Ze.strstart+lt-1])&Ze.hash_mask,hn=Ze.prev[Ze.strstart&Ze.w_mask]=Ze.head[Ze.ins_h],Ze.head[Ze.ins_h]=Ze.strstart),hn!==0&&Ze.strstart-hn<=Ze.w_size-Ye&&(Ze.match_length=fn(Ze,hn)),Ze.match_length>=lt)if(cr=I._tr_tally(Ze,Ze.strstart-Ze.match_start,Ze.match_length-lt),Ze.lookahead-=Ze.match_length,Ze.match_length<=Ze.max_lazy_match&&Ze.lookahead>=lt){Ze.match_length--;do Ze.strstart++,Ze.ins_h=(Ze.ins_h<<Ze.hash_shift^Ze.window[Ze.strstart+lt-1])&Ze.hash_mask,hn=Ze.prev[Ze.strstart&Ze.w_mask]=Ze.head[Ze.ins_h],Ze.head[Ze.ins_h]=Ze.strstart;while(--Ze.match_length!=0);Ze.strstart++}else Ze.strstart+=Ze.match_length,Ze.match_length=0,Ze.ins_h=Ze.window[Ze.strstart],Ze.ins_h=(Ze.ins_h<<Ze.hash_shift^Ze.window[Ze.strstart+1])&Ze.hash_mask;else cr=I._tr_tally(Ze,0,Ze.window[Ze.strstart]),Ze.lookahead--,Ze.strstart++;if(cr&&(ze(Ze,!1),Ze.strm.avail_out===0))return Ft}return Ze.insert=Ze.strstart<lt-1?Ze.strstart:lt-1,_n===V?(ze(Ze,!0),Ze.strm.avail_out===0?Bt:Qe):Ze.last_lit&&(ze(Ze,!1),Ze.strm.avail_out===0)?Ft:$e}function $n(Ze,_n){for(var hn,cr,gn;;){if(Ze.lookahead<Ye){if(vn(Ze),Ze.lookahead<Ye&&_n===G)return Ft;if(Ze.lookahead===0)break}if(hn=0,Ze.lookahead>=lt&&(Ze.ins_h=(Ze.ins_h<<Ze.hash_shift^Ze.window[Ze.strstart+lt-1])&Ze.hash_mask,hn=Ze.prev[Ze.strstart&Ze.w_mask]=Ze.head[Ze.ins_h],Ze.head[Ze.ins_h]=Ze.strstart),Ze.prev_length=Ze.match_length,Ze.prev_match=Ze.match_start,Ze.match_length=lt-1,hn!==0&&Ze.prev_length<Ze.max_lazy_match&&Ze.strstart-hn<=Ze.w_size-Ye&&(Ze.match_length=fn(Ze,hn),Ze.match_length<=5&&(Ze.strategy===ee||Ze.match_length===lt&&Ze.strstart-Ze.match_start>4096)&&(Ze.match_length=lt-1)),Ze.prev_length>=lt&&Ze.match_length<=Ze.prev_length){gn=Ze.strstart+Ze.lookahead-lt,cr=I._tr_tally(Ze,Ze.strstart-1-Ze.prev_match,Ze.prev_length-lt),Ze.lookahead-=Ze.prev_length-1,Ze.prev_length-=2;do++Ze.strstart<=gn&&(Ze.ins_h=(Ze.ins_h<<Ze.hash_shift^Ze.window[Ze.strstart+lt-1])&Ze.hash_mask,hn=Ze.prev[Ze.strstart&Ze.w_mask]=Ze.head[Ze.ins_h],Ze.head[Ze.ins_h]=Ze.strstart);while(--Ze.prev_length!=0);if(Ze.match_available=0,Ze.match_length=lt-1,Ze.strstart++,cr&&(ze(Ze,!1),Ze.strm.avail_out===0))return Ft}else if(Ze.match_available){if((cr=I._tr_tally(Ze,0,Ze.window[Ze.strstart-1]))&&ze(Ze,!1),Ze.strstart++,Ze.lookahead--,Ze.strm.avail_out===0)return Ft}else Ze.match_available=1,Ze.strstart++,Ze.lookahead--}return Ze.match_available&&(cr=I._tr_tally(Ze,0,Ze.window[Ze.strstart-1]),Ze.match_available=0),Ze.insert=Ze.strstart<lt-1?Ze.strstart:lt-1,_n===V?(ze(Ze,!0),Ze.strm.avail_out===0?Bt:Qe):Ze.last_lit&&(ze(Ze,!1),Ze.strm.avail_out===0)?Ft:$e}function xn(Ze,_n){for(var hn,cr,gn,mn,ri=Ze.window;;){if(Ze.lookahead<=ir){if(vn(Ze),Ze.lookahead<=ir&&_n===G)return Ft;if(Ze.lookahead===0)break}if(Ze.match_length=0,Ze.lookahead>=lt&&Ze.strstart>0&&(cr=ri[gn=Ze.strstart-1])===ri[++gn]&&cr===ri[++gn]&&cr===ri[++gn]){mn=Ze.strstart+ir;do;while(cr===ri[++gn]&&cr===ri[++gn]&&cr===ri[++gn]&&cr===ri[++gn]&&cr===ri[++gn]&&cr===ri[++gn]&&cr===ri[++gn]&&cr===ri[++gn]&&gn<mn);Ze.match_length=ir-(mn-gn),Ze.match_length>Ze.lookahead&&(Ze.match_length=Ze.lookahead)}if(Ze.match_length>=lt?(hn=I._tr_tally(Ze,1,Ze.match_length-lt),Ze.lookahead-=Ze.match_length,Ze.strstart+=Ze.match_length,Ze.match_length=0):(hn=I._tr_tally(Ze,0,Ze.window[Ze.strstart]),Ze.lookahead--,Ze.strstart++),hn&&(ze(Ze,!1),Ze.strm.avail_out===0))return Ft}return Ze.insert=0,_n===V?(ze(Ze,!0),Ze.strm.avail_out===0?Bt:Qe):Ze.last_lit&&(ze(Ze,!1),Ze.strm.avail_out===0)?Ft:$e}function ti(Ze,_n){for(var hn;;){if(Ze.lookahead===0&&(vn(Ze),Ze.lookahead===0)){if(_n===G)return Ft;break}if(Ze.match_length=0,hn=I._tr_tally(Ze,0,Ze.window[Ze.strstart]),Ze.lookahead--,Ze.strstart++,hn&&(ze(Ze,!1),Ze.strm.avail_out===0))return Ft}return Ze.insert=0,_n===V?(ze(Ze,!0),Ze.strm.avail_out===0?Bt:Qe):Ze.last_lit&&(ze(Ze,!1),Ze.strm.avail_out===0)?Ft:$e}function Cn(Ze,_n,hn,cr,gn){this.good_length=Ze,this.max_lazy=_n,this.nice_length=hn,this.max_chain=cr,this.func=gn}function On(Ze){Ze.window_size=2*Ze.w_size,sr(Ze.head),Ze.max_lazy_match=w[Ze.level].max_lazy,Ze.good_match=w[Ze.level].good_length,Ze.nice_match=w[Ze.level].nice_length,Ze.max_chain_length=w[Ze.level].max_chain,Ze.strstart=0,Ze.block_start=0,Ze.lookahead=0,Ze.insert=0,Ze.match_length=Ze.prev_length=lt-1,Ze.match_available=0,Ze.ins_h=0}function si(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=we,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new $.Buf16(2*bt),this.dyn_dtree=new $.Buf16(2*(2*Ce+1)),this.bl_tree=new $.Buf16(2*(2*Oe+1)),sr(this.dyn_ltree),sr(this.dyn_dtree),sr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new $.Buf16(Mt+1),this.heap=new $.Buf16(2*Te+1),sr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new $.Buf16(2*Te+1),sr(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Tn(Ze){var _n;return Ze&&Ze.state?(Ze.total_in=Ze.total_out=0,Ze.data_type=_e,(_n=Ze.state).pending=0,_n.pending_out=0,_n.wrap<0&&(_n.wrap=-_n.wrap),_n.status=_n.wrap?ar:dr,Ze.adler=_n.wrap===2?0:1,_n.last_flush=G,I._tr_init(_n),Z):at(Ze,J)}function or(Ze){var _n=Tn(Ze);return _n===Z&&On(Ze.state),_n}function kn(Ze,_n){return Ze&&Ze.state?Ze.state.wrap!==2?J:(Ze.state.gzhead=_n,Z):J}function mr(Ze,_n,hn,cr,gn,mn){if(!Ze)return J;var ri=1;if(_n===oe&&(_n=6),cr<0?(ri=0,cr=-cr):cr>15&&(ri=2,cr-=16),gn<1||gn>pe||hn!==we||cr<8||cr>15||_n<0||_n>9||mn<0||mn>le)return at(Ze,J);cr===8&&(cr=9);var An=new si;return Ze.state=An,An.strm=Ze,An.wrap=ri,An.gzhead=null,An.w_bits=cr,An.w_size=1<<An.w_bits,An.w_mask=An.w_size-1,An.hash_bits=gn+7,An.hash_size=1<<An.hash_bits,An.hash_mask=An.hash_size-1,An.hash_shift=~~((An.hash_bits+lt-1)/lt),An.window=new $.Buf8(2*An.w_size),An.head=new $.Buf16(An.hash_size),An.prev=new $.Buf16(An.w_size),An.lit_bufsize=1<<gn+6,An.pending_buf_size=4*An.lit_bufsize,An.pending_buf=new $.Buf8(An.pending_buf_size),An.d_buf=1*An.lit_bufsize,An.l_buf=3*An.lit_bufsize,An.level=_n,An.strategy=mn,An.method=hn,or(Ze)}function yn(Ze,_n){return mr(Ze,_n,we,xe,Ge,de)}function Dt(Ze,_n){var hn,cr,gn,mn;if(!Ze||!Ze.state||_n>K||_n<0)return Ze?at(Ze,J):J;if(cr=Ze.state,!Ze.output||!Ze.input&&Ze.avail_in!==0||cr.status===fr&&_n!==V)return at(Ze,Ze.avail_out===0?se:J);if(cr.strm=Ze,hn=cr.last_flush,cr.last_flush=_n,cr.status===ar)if(cr.wrap===2)Ze.adler=0,ct(cr,31),ct(cr,139),ct(cr,8),cr.gzhead?(ct(cr,(cr.gzhead.text?1:0)+(cr.gzhead.hcrc?2:0)+(cr.gzhead.extra?4:0)+(cr.gzhead.name?8:0)+(cr.gzhead.comment?16:0)),ct(cr,255&cr.gzhead.time),ct(cr,cr.gzhead.time>>8&255),ct(cr,cr.gzhead.time>>16&255),ct(cr,cr.gzhead.time>>24&255),ct(cr,cr.level===9?2:cr.strategy>=ae||cr.level<2?4:0),ct(cr,255&cr.gzhead.os),cr.gzhead.extra&&cr.gzhead.extra.length&&(ct(cr,255&cr.gzhead.extra.length),ct(cr,cr.gzhead.extra.length>>8&255)),cr.gzhead.hcrc&&(Ze.adler=q(Ze.adler,cr.pending_buf,cr.pending,0)),cr.gzindex=0,cr.status=ht):(ct(cr,0),ct(cr,0),ct(cr,0),ct(cr,0),ct(cr,0),ct(cr,cr.level===9?2:cr.strategy>=ae||cr.level<2?4:0),ct(cr,st),cr.status=dr);else{var ri=we+(cr.w_bits-8<<4)<<8;ri|=(cr.strategy>=ae||cr.level<2?0:cr.level<6?1:cr.level===6?2:3)<<6,cr.strstart!==0&&(ri|=xt),ri+=31-ri%31,cr.status=dr,ft(cr,ri),cr.strstart!==0&&(ft(cr,Ze.adler>>>16),ft(cr,65535&Ze.adler)),Ze.adler=1}if(cr.status===ht)if(cr.gzhead.extra){for(gn=cr.pending;cr.gzindex<(65535&cr.gzhead.extra.length)&&(cr.pending!==cr.pending_buf_size||(cr.gzhead.hcrc&&cr.pending>gn&&(Ze.adler=q(Ze.adler,cr.pending_buf,cr.pending-gn,gn)),Ee(Ze),gn=cr.pending,cr.pending!==cr.pending_buf_size));)ct(cr,255&cr.gzhead.extra[cr.gzindex]),cr.gzindex++;cr.gzhead.hcrc&&cr.pending>gn&&(Ze.adler=q(Ze.adler,cr.pending_buf,cr.pending-gn,gn)),cr.gzindex===cr.gzhead.extra.length&&(cr.gzindex=0,cr.status=gt)}else cr.status=gt;if(cr.status===gt)if(cr.gzhead.name){gn=cr.pending;do{if(cr.pending===cr.pending_buf_size&&(cr.gzhead.hcrc&&cr.pending>gn&&(Ze.adler=q(Ze.adler,cr.pending_buf,cr.pending-gn,gn)),Ee(Ze),gn=cr.pending,cr.pending===cr.pending_buf_size)){mn=1;break}mn=cr.gzindex<cr.gzhead.name.length?255&cr.gzhead.name.charCodeAt(cr.gzindex++):0,ct(cr,mn)}while(mn!==0);cr.gzhead.hcrc&&cr.pending>gn&&(Ze.adler=q(Ze.adler,cr.pending_buf,cr.pending-gn,gn)),mn===0&&(cr.gzindex=0,cr.status=zt)}else cr.status=zt;if(cr.status===zt)if(cr.gzhead.comment){gn=cr.pending;do{if(cr.pending===cr.pending_buf_size&&(cr.gzhead.hcrc&&cr.pending>gn&&(Ze.adler=q(Ze.adler,cr.pending_buf,cr.pending-gn,gn)),Ee(Ze),gn=cr.pending,cr.pending===cr.pending_buf_size)){mn=1;break}mn=cr.gzindex<cr.gzhead.comment.length?255&cr.gzhead.comment.charCodeAt(cr.gzindex++):0,ct(cr,mn)}while(mn!==0);cr.gzhead.hcrc&&cr.pending>gn&&(Ze.adler=q(Ze.adler,cr.pending_buf,cr.pending-gn,gn)),mn===0&&(cr.status=ur)}else cr.status=ur;if(cr.status===ur&&(cr.gzhead.hcrc?(cr.pending+2>cr.pending_buf_size&&Ee(Ze),cr.pending+2<=cr.pending_buf_size&&(ct(cr,255&Ze.adler),ct(cr,Ze.adler>>8&255),Ze.adler=0,cr.status=dr)):cr.status=dr),cr.pending!==0){if(Ee(Ze),Ze.avail_out===0)return cr.last_flush=-1,Z}else if(Ze.avail_in===0&&pt(_n)<=pt(hn)&&_n!==V)return at(Ze,se);if(cr.status===fr&&Ze.avail_in!==0)return at(Ze,se);if(Ze.avail_in!==0||cr.lookahead!==0||_n!==G&&cr.status!==fr){var An=cr.strategy===ae?ti(cr,_n):cr.strategy===ce?xn(cr,_n):w[cr.level].func(cr,_n);if(An!==Bt&&An!==Qe||(cr.status=fr),An===Ft||An===Bt)return Ze.avail_out===0&&(cr.last_flush=-1),Z;if(An===$e&&(_n===H?I._tr_align(cr):_n!==K&&(I._tr_stored_block(cr,0,0,!1),_n===W&&(sr(cr.head),cr.lookahead===0&&(cr.strstart=0,cr.block_start=0,cr.insert=0))),Ee(Ze),Ze.avail_out===0))return cr.last_flush=-1,Z}return _n!==V?Z:cr.wrap<=0?Q:(cr.wrap===2?(ct(cr,255&Ze.adler),ct(cr,Ze.adler>>8&255),ct(cr,Ze.adler>>16&255),ct(cr,Ze.adler>>24&255),ct(cr,255&Ze.total_in),ct(cr,Ze.total_in>>8&255),ct(cr,Ze.total_in>>16&255),ct(cr,Ze.total_in>>24&255)):(ft(cr,Ze.adler>>>16),ft(cr,65535&Ze.adler)),Ee(Ze),cr.wrap>0&&(cr.wrap=-cr.wrap),cr.pending!==0?Z:Q)}function wn(Ze){var _n;return Ze&&Ze.state?(_n=Ze.state.status)!==ar&&_n!==ht&&_n!==gt&&_n!==zt&&_n!==ur&&_n!==dr&&_n!==fr?at(Ze,J):(Ze.state=null,_n===dr?at(Ze,re):Z):J}function ii(Ze,_n){var hn,cr,gn,mn,ri,An,ei,oi,wi=_n.length;if(!Ze||!Ze.state||(mn=(hn=Ze.state).wrap)===2||mn===1&&hn.status!==ar||hn.lookahead)return J;for(mn===1&&(Ze.adler=D(Ze.adler,_n,wi,0)),hn.wrap=0,wi>=hn.w_size&&(mn===0&&(sr(hn.head),hn.strstart=0,hn.block_start=0,hn.insert=0),oi=new $.Buf8(hn.w_size),$.arraySet(oi,_n,wi-hn.w_size,hn.w_size,0),_n=oi,wi=hn.w_size),ri=Ze.avail_in,An=Ze.next_in,ei=Ze.input,Ze.avail_in=wi,Ze.next_in=0,Ze.input=_n,vn(hn);hn.lookahead>=lt;){cr=hn.strstart,gn=hn.lookahead-(lt-1);do hn.ins_h=(hn.ins_h<<hn.hash_shift^hn.window[cr+lt-1])&hn.hash_mask,hn.prev[cr&hn.w_mask]=hn.head[hn.ins_h],hn.head[hn.ins_h]=cr,cr++;while(--gn);hn.strstart=cr,hn.lookahead=lt-1,vn(hn)}return hn.strstart+=hn.lookahead,hn.block_start=hn.strstart,hn.insert=hn.lookahead,hn.lookahead=0,hn.match_length=hn.prev_length=lt-1,hn.match_available=0,Ze.next_in=An,Ze.input=ei,Ze.avail_in=ri,hn.wrap=mn,Z}w=[new Cn(0,0,0,0,En),new Cn(4,4,8,4,bn),new Cn(4,5,16,8,bn),new Cn(4,6,32,32,bn),new Cn(4,4,16,16,$n),new Cn(8,16,32,32,$n),new Cn(8,16,128,128,$n),new Cn(8,32,128,256,$n),new Cn(32,128,258,1024,$n),new Cn(32,258,258,4096,$n)],g.deflateInit=yn,g.deflateInit2=mr,g.deflateReset=or,g.deflateResetKeep=Tn,g.deflateSetHeader=kn,g.deflate=Dt,g.deflateEnd=wn,g.deflateSetDictionary=ii,g.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":52,"./adler32":53,"./crc32":55,"./messages":60,"./trees":61}],57:[function(d,m,g){var w=30,$=12;m.exports=function(I,D){var q,j,G,H,W,V,K,Z,Q,J,re,se,oe,ee,ae,ce,le,de,_e,we,pe,xe,Ge,Te,Ce;q=I.state,j=I.next_in,Te=I.input,G=j+(I.avail_in-5),H=I.next_out,Ce=I.output,W=H-(D-I.avail_out),V=H+(I.avail_out-257),K=q.dmax,Z=q.wsize,Q=q.whave,J=q.wnext,re=q.window,se=q.hold,oe=q.bits,ee=q.lencode,ae=q.distcode,ce=(1<<q.lenbits)-1,le=(1<<q.distbits)-1;e:do{oe<15&&(se+=Te[j++]<<oe,oe+=8,se+=Te[j++]<<oe,oe+=8),de=ee[se&ce];t:for(;;){if(se>>>=_e=de>>>24,oe-=_e,(_e=de>>>16&255)==0)Ce[H++]=65535&de;else{if(!(16&_e)){if(64&_e){if(32&_e){q.mode=$;break e}I.msg="invalid literal/length code",q.mode=w;break e}de=ee[(65535&de)+(se&(1<<_e)-1)];continue t}for(we=65535&de,(_e&=15)&&(oe<_e&&(se+=Te[j++]<<oe,oe+=8),we+=se&(1<<_e)-1,se>>>=_e,oe-=_e),oe<15&&(se+=Te[j++]<<oe,oe+=8,se+=Te[j++]<<oe,oe+=8),de=ae[se&le];;){if(se>>>=_e=de>>>24,oe-=_e,16&(_e=de>>>16&255)){if(pe=65535&de,oe<(_e&=15)&&(se+=Te[j++]<<oe,(oe+=8)<_e&&(se+=Te[j++]<<oe,oe+=8)),(pe+=se&(1<<_e)-1)>K){I.msg="invalid distance too far back",q.mode=w;break e}if(se>>>=_e,oe-=_e,pe>(_e=H-W)){if((_e=pe-_e)>Q&&q.sane){I.msg="invalid distance too far back",q.mode=w;break e}if(xe=0,Ge=re,J===0){if(xe+=Z-_e,_e<we){we-=_e;do Ce[H++]=re[xe++];while(--_e);xe=H-pe,Ge=Ce}}else if(J<_e){if(xe+=Z+J-_e,(_e-=J)<we){we-=_e;do Ce[H++]=re[xe++];while(--_e);if(xe=0,J<we){we-=_e=J;do Ce[H++]=re[xe++];while(--_e);xe=H-pe,Ge=Ce}}}else if(xe+=J-_e,_e<we){we-=_e;do Ce[H++]=re[xe++];while(--_e);xe=H-pe,Ge=Ce}for(;we>2;)Ce[H++]=Ge[xe++],Ce[H++]=Ge[xe++],Ce[H++]=Ge[xe++],we-=3;we&&(Ce[H++]=Ge[xe++],we>1&&(Ce[H++]=Ge[xe++]))}else{xe=H-pe;do Ce[H++]=Ce[xe++],Ce[H++]=Ce[xe++],Ce[H++]=Ce[xe++],we-=3;while(we>2);we&&(Ce[H++]=Ce[xe++],we>1&&(Ce[H++]=Ce[xe++]))}break}if(64&_e){I.msg="invalid distance code",q.mode=w;break e}de=ae[(65535&de)+(se&(1<<_e)-1)]}}break}}while(j<G&&H<V);j-=we=oe>>3,se&=(1<<(oe-=we<<3))-1,I.next_in=j,I.next_out=H,I.avail_in=j<G?G-j+5:5-(j-G),I.avail_out=H<V?V-H+257:257-(H-V),q.hold=se,q.bits=oe}},{}],58:[function(d,m,g){var w=d("../utils/common"),$=d("./adler32"),I=d("./crc32"),D=d("./inffast"),q=d("./inftrees"),j=0,G=1,H=2,W=4,V=5,K=6,Z=0,Q=1,J=2,re=-2,se=-3,oe=-4,ee=-5,ae=8,ce=1,le=2,de=3,_e=4,we=5,pe=6,xe=7,Ge=8,Te=9,Ce=10,Oe=11,bt=12,Mt=13,lt=14,ir=15,Ye=16,xt=17,ar=18,ht=19,gt=20,zt=21,ur=22,dr=23,fr=24,Ft=25,$e=26,Bt=27,Qe=28,st=29,at=30,pt=31,sr=852,Ee=592,ze=15;function ct(mr){return(mr>>>24&255)+(mr>>>8&65280)+((65280&mr)<<8)+((255&mr)<<24)}function ft(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new w.Buf16(320),this.work=new w.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function pr(mr){var yn;return mr&&mr.state?(yn=mr.state,mr.total_in=mr.total_out=yn.total=0,mr.msg="",yn.wrap&&(mr.adler=1&yn.wrap),yn.mode=ce,yn.last=0,yn.havedict=0,yn.dmax=32768,yn.head=null,yn.hold=0,yn.bits=0,yn.lencode=yn.lendyn=new w.Buf32(sr),yn.distcode=yn.distdyn=new w.Buf32(Ee),yn.sane=1,yn.back=-1,Z):re}function fn(mr){var yn;return mr&&mr.state?((yn=mr.state).wsize=0,yn.whave=0,yn.wnext=0,pr(mr)):re}function vn(mr,yn){var Dt,wn;return mr&&mr.state?(wn=mr.state,yn<0?(Dt=0,yn=-yn):(Dt=1+(yn>>4),yn<48&&(yn&=15)),yn&&(yn<8||yn>15)?re:(wn.window!==null&&wn.wbits!==yn&&(wn.window=null),wn.wrap=Dt,wn.wbits=yn,fn(mr))):re}function En(mr,yn){var Dt,wn;return mr?(wn=new ft,mr.state=wn,wn.window=null,(Dt=vn(mr,yn))!==Z&&(mr.state=null),Dt):re}function bn(mr){return En(mr,ze)}var $n,xn,ti=!0;function Cn(mr){if(ti){var yn;for($n=new w.Buf32(512),xn=new w.Buf32(32),yn=0;yn<144;)mr.lens[yn++]=8;for(;yn<256;)mr.lens[yn++]=9;for(;yn<280;)mr.lens[yn++]=7;for(;yn<288;)mr.lens[yn++]=8;for(q(G,mr.lens,0,288,$n,0,mr.work,{bits:9}),yn=0;yn<32;)mr.lens[yn++]=5;q(H,mr.lens,0,32,xn,0,mr.work,{bits:5}),ti=!1}mr.lencode=$n,mr.lenbits=9,mr.distcode=xn,mr.distbits=5}function On(mr,yn,Dt,wn){var ii,Ze=mr.state;return Ze.window===null&&(Ze.wsize=1<<Ze.wbits,Ze.wnext=0,Ze.whave=0,Ze.window=new w.Buf8(Ze.wsize)),wn>=Ze.wsize?(w.arraySet(Ze.window,yn,Dt-Ze.wsize,Ze.wsize,0),Ze.wnext=0,Ze.whave=Ze.wsize):((ii=Ze.wsize-Ze.wnext)>wn&&(ii=wn),w.arraySet(Ze.window,yn,Dt-wn,ii,Ze.wnext),(wn-=ii)?(w.arraySet(Ze.window,yn,Dt-wn,wn,0),Ze.wnext=wn,Ze.whave=Ze.wsize):(Ze.wnext+=ii,Ze.wnext===Ze.wsize&&(Ze.wnext=0),Ze.whave<Ze.wsize&&(Ze.whave+=ii))),0}function si(mr,yn){var Dt,wn,ii,Ze,_n,hn,cr,gn,mn,ri,An,ei,oi,wi,ci,hi,mi,gi,Ai,Ti,pi,bi,Si,_i,yi=0,di=new w.Buf8(4),Oi=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!mr||!mr.state||!mr.output||!mr.input&&mr.avail_in!==0)return re;(Dt=mr.state).mode===bt&&(Dt.mode=Mt),_n=mr.next_out,ii=mr.output,cr=mr.avail_out,Ze=mr.next_in,wn=mr.input,hn=mr.avail_in,gn=Dt.hold,mn=Dt.bits,ri=hn,An=cr,bi=Z;e:for(;;)switch(Dt.mode){case ce:if(Dt.wrap===0){Dt.mode=Mt;break}for(;mn<16;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}if(2&Dt.wrap&&gn===35615){Dt.check=0,di[0]=255&gn,di[1]=gn>>>8&255,Dt.check=I(Dt.check,di,2,0),gn=0,mn=0,Dt.mode=le;break}if(Dt.flags=0,Dt.head&&(Dt.head.done=!1),!(1&Dt.wrap)||(((255&gn)<<8)+(gn>>8))%31){mr.msg="incorrect header check",Dt.mode=at;break}if((15&gn)!==ae){mr.msg="unknown compression method",Dt.mode=at;break}if(mn-=4,pi=8+(15&(gn>>>=4)),Dt.wbits===0)Dt.wbits=pi;else if(pi>Dt.wbits){mr.msg="invalid window size",Dt.mode=at;break}Dt.dmax=1<<pi,mr.adler=Dt.check=1,Dt.mode=512&gn?Ce:bt,gn=0,mn=0;break;case le:for(;mn<16;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}if(Dt.flags=gn,(255&Dt.flags)!==ae){mr.msg="unknown compression method",Dt.mode=at;break}if(57344&Dt.flags){mr.msg="unknown header flags set",Dt.mode=at;break}Dt.head&&(Dt.head.text=gn>>8&1),512&Dt.flags&&(di[0]=255&gn,di[1]=gn>>>8&255,Dt.check=I(Dt.check,di,2,0)),gn=0,mn=0,Dt.mode=de;case de:for(;mn<32;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}Dt.head&&(Dt.head.time=gn),512&Dt.flags&&(di[0]=255&gn,di[1]=gn>>>8&255,di[2]=gn>>>16&255,di[3]=gn>>>24&255,Dt.check=I(Dt.check,di,4,0)),gn=0,mn=0,Dt.mode=_e;case _e:for(;mn<16;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}Dt.head&&(Dt.head.xflags=255&gn,Dt.head.os=gn>>8),512&Dt.flags&&(di[0]=255&gn,di[1]=gn>>>8&255,Dt.check=I(Dt.check,di,2,0)),gn=0,mn=0,Dt.mode=we;case we:if(1024&Dt.flags){for(;mn<16;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}Dt.length=gn,Dt.head&&(Dt.head.extra_len=gn),512&Dt.flags&&(di[0]=255&gn,di[1]=gn>>>8&255,Dt.check=I(Dt.check,di,2,0)),gn=0,mn=0}else Dt.head&&(Dt.head.extra=null);Dt.mode=pe;case pe:if(1024&Dt.flags&&((ei=Dt.length)>hn&&(ei=hn),ei&&(Dt.head&&(pi=Dt.head.extra_len-Dt.length,Dt.head.extra||(Dt.head.extra=new Array(Dt.head.extra_len)),w.arraySet(Dt.head.extra,wn,Ze,ei,pi)),512&Dt.flags&&(Dt.check=I(Dt.check,wn,ei,Ze)),hn-=ei,Ze+=ei,Dt.length-=ei),Dt.length))break e;Dt.length=0,Dt.mode=xe;case xe:if(2048&Dt.flags){if(hn===0)break e;ei=0;do pi=wn[Ze+ei++],Dt.head&&pi&&Dt.length<65536&&(Dt.head.name+=String.fromCharCode(pi));while(pi&&ei<hn);if(512&Dt.flags&&(Dt.check=I(Dt.check,wn,ei,Ze)),hn-=ei,Ze+=ei,pi)break e}else Dt.head&&(Dt.head.name=null);Dt.length=0,Dt.mode=Ge;case Ge:if(4096&Dt.flags){if(hn===0)break e;ei=0;do pi=wn[Ze+ei++],Dt.head&&pi&&Dt.length<65536&&(Dt.head.comment+=String.fromCharCode(pi));while(pi&&ei<hn);if(512&Dt.flags&&(Dt.check=I(Dt.check,wn,ei,Ze)),hn-=ei,Ze+=ei,pi)break e}else Dt.head&&(Dt.head.comment=null);Dt.mode=Te;case Te:if(512&Dt.flags){for(;mn<16;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}if(gn!==(65535&Dt.check)){mr.msg="header crc mismatch",Dt.mode=at;break}gn=0,mn=0}Dt.head&&(Dt.head.hcrc=Dt.flags>>9&1,Dt.head.done=!0),mr.adler=Dt.check=0,Dt.mode=bt;break;case Ce:for(;mn<32;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}mr.adler=Dt.check=ct(gn),gn=0,mn=0,Dt.mode=Oe;case Oe:if(Dt.havedict===0)return mr.next_out=_n,mr.avail_out=cr,mr.next_in=Ze,mr.avail_in=hn,Dt.hold=gn,Dt.bits=mn,J;mr.adler=Dt.check=1,Dt.mode=bt;case bt:if(yn===V||yn===K)break e;case Mt:if(Dt.last){gn>>>=7&mn,mn-=7&mn,Dt.mode=Bt;break}for(;mn<3;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}switch(Dt.last=1&gn,mn-=1,3&(gn>>>=1)){case 0:Dt.mode=lt;break;case 1:if(Cn(Dt),Dt.mode=gt,yn===K){gn>>>=2,mn-=2;break e}break;case 2:Dt.mode=xt;break;case 3:mr.msg="invalid block type",Dt.mode=at}gn>>>=2,mn-=2;break;case lt:for(gn>>>=7&mn,mn-=7&mn;mn<32;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}if((65535&gn)!=(gn>>>16^65535)){mr.msg="invalid stored block lengths",Dt.mode=at;break}if(Dt.length=65535&gn,gn=0,mn=0,Dt.mode=ir,yn===K)break e;case ir:Dt.mode=Ye;case Ye:if(ei=Dt.length){if(ei>hn&&(ei=hn),ei>cr&&(ei=cr),ei===0)break e;w.arraySet(ii,wn,Ze,ei,_n),hn-=ei,Ze+=ei,cr-=ei,_n+=ei,Dt.length-=ei;break}Dt.mode=bt;break;case xt:for(;mn<14;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}if(Dt.nlen=257+(31&gn),gn>>>=5,mn-=5,Dt.ndist=1+(31&gn),gn>>>=5,mn-=5,Dt.ncode=4+(15&gn),gn>>>=4,mn-=4,Dt.nlen>286||Dt.ndist>30){mr.msg="too many length or distance symbols",Dt.mode=at;break}Dt.have=0,Dt.mode=ar;case ar:for(;Dt.have<Dt.ncode;){for(;mn<3;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}Dt.lens[Oi[Dt.have++]]=7&gn,gn>>>=3,mn-=3}for(;Dt.have<19;)Dt.lens[Oi[Dt.have++]]=0;if(Dt.lencode=Dt.lendyn,Dt.lenbits=7,Si={bits:Dt.lenbits},bi=q(j,Dt.lens,0,19,Dt.lencode,0,Dt.work,Si),Dt.lenbits=Si.bits,bi){mr.msg="invalid code lengths set",Dt.mode=at;break}Dt.have=0,Dt.mode=ht;case ht:for(;Dt.have<Dt.nlen+Dt.ndist;){for(;hi=(yi=Dt.lencode[gn&(1<<Dt.lenbits)-1])>>>16&255,mi=65535&yi,!((ci=yi>>>24)<=mn);){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}if(mi<16)gn>>>=ci,mn-=ci,Dt.lens[Dt.have++]=mi;else{if(mi===16){for(_i=ci+2;mn<_i;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}if(gn>>>=ci,mn-=ci,Dt.have===0){mr.msg="invalid bit length repeat",Dt.mode=at;break}pi=Dt.lens[Dt.have-1],ei=3+(3&gn),gn>>>=2,mn-=2}else if(mi===17){for(_i=ci+3;mn<_i;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}mn-=ci,pi=0,ei=3+(7&(gn>>>=ci)),gn>>>=3,mn-=3}else{for(_i=ci+7;mn<_i;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}mn-=ci,pi=0,ei=11+(127&(gn>>>=ci)),gn>>>=7,mn-=7}if(Dt.have+ei>Dt.nlen+Dt.ndist){mr.msg="invalid bit length repeat",Dt.mode=at;break}for(;ei--;)Dt.lens[Dt.have++]=pi}}if(Dt.mode===at)break;if(Dt.lens[256]===0){mr.msg="invalid code -- missing end-of-block",Dt.mode=at;break}if(Dt.lenbits=9,Si={bits:Dt.lenbits},bi=q(G,Dt.lens,0,Dt.nlen,Dt.lencode,0,Dt.work,Si),Dt.lenbits=Si.bits,bi){mr.msg="invalid literal/lengths set",Dt.mode=at;break}if(Dt.distbits=6,Dt.distcode=Dt.distdyn,Si={bits:Dt.distbits},bi=q(H,Dt.lens,Dt.nlen,Dt.ndist,Dt.distcode,0,Dt.work,Si),Dt.distbits=Si.bits,bi){mr.msg="invalid distances set",Dt.mode=at;break}if(Dt.mode=gt,yn===K)break e;case gt:Dt.mode=zt;case zt:if(hn>=6&&cr>=258){mr.next_out=_n,mr.avail_out=cr,mr.next_in=Ze,mr.avail_in=hn,Dt.hold=gn,Dt.bits=mn,D(mr,An),_n=mr.next_out,ii=mr.output,cr=mr.avail_out,Ze=mr.next_in,wn=mr.input,hn=mr.avail_in,gn=Dt.hold,mn=Dt.bits,Dt.mode===bt&&(Dt.back=-1);break}for(Dt.back=0;hi=(yi=Dt.lencode[gn&(1<<Dt.lenbits)-1])>>>16&255,mi=65535&yi,!((ci=yi>>>24)<=mn);){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}if(hi&&!(240&hi)){for(gi=ci,Ai=hi,Ti=mi;hi=(yi=Dt.lencode[Ti+((gn&(1<<gi+Ai)-1)>>gi)])>>>16&255,mi=65535&yi,!(gi+(ci=yi>>>24)<=mn);){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}gn>>>=gi,mn-=gi,Dt.back+=gi}if(gn>>>=ci,mn-=ci,Dt.back+=ci,Dt.length=mi,hi===0){Dt.mode=$e;break}if(32&hi){Dt.back=-1,Dt.mode=bt;break}if(64&hi){mr.msg="invalid literal/length code",Dt.mode=at;break}Dt.extra=15&hi,Dt.mode=ur;case ur:if(Dt.extra){for(_i=Dt.extra;mn<_i;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}Dt.length+=gn&(1<<Dt.extra)-1,gn>>>=Dt.extra,mn-=Dt.extra,Dt.back+=Dt.extra}Dt.was=Dt.length,Dt.mode=dr;case dr:for(;hi=(yi=Dt.distcode[gn&(1<<Dt.distbits)-1])>>>16&255,mi=65535&yi,!((ci=yi>>>24)<=mn);){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}if(!(240&hi)){for(gi=ci,Ai=hi,Ti=mi;hi=(yi=Dt.distcode[Ti+((gn&(1<<gi+Ai)-1)>>gi)])>>>16&255,mi=65535&yi,!(gi+(ci=yi>>>24)<=mn);){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}gn>>>=gi,mn-=gi,Dt.back+=gi}if(gn>>>=ci,mn-=ci,Dt.back+=ci,64&hi){mr.msg="invalid distance code",Dt.mode=at;break}Dt.offset=mi,Dt.extra=15&hi,Dt.mode=fr;case fr:if(Dt.extra){for(_i=Dt.extra;mn<_i;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}Dt.offset+=gn&(1<<Dt.extra)-1,gn>>>=Dt.extra,mn-=Dt.extra,Dt.back+=Dt.extra}if(Dt.offset>Dt.dmax){mr.msg="invalid distance too far back",Dt.mode=at;break}Dt.mode=Ft;case Ft:if(cr===0)break e;if(ei=An-cr,Dt.offset>ei){if((ei=Dt.offset-ei)>Dt.whave&&Dt.sane){mr.msg="invalid distance too far back",Dt.mode=at;break}ei>Dt.wnext?(ei-=Dt.wnext,oi=Dt.wsize-ei):oi=Dt.wnext-ei,ei>Dt.length&&(ei=Dt.length),wi=Dt.window}else wi=ii,oi=_n-Dt.offset,ei=Dt.length;ei>cr&&(ei=cr),cr-=ei,Dt.length-=ei;do ii[_n++]=wi[oi++];while(--ei);Dt.length===0&&(Dt.mode=zt);break;case $e:if(cr===0)break e;ii[_n++]=Dt.length,cr--,Dt.mode=zt;break;case Bt:if(Dt.wrap){for(;mn<32;){if(hn===0)break e;hn--,gn|=wn[Ze++]<<mn,mn+=8}if(An-=cr,mr.total_out+=An,Dt.total+=An,An&&(mr.adler=Dt.check=Dt.flags?I(Dt.check,ii,An,_n-An):$(Dt.check,ii,An,_n-An)),An=cr,(Dt.flags?gn:ct(gn))!==Dt.check){mr.msg="incorrect data check",Dt.mode=at;break}gn=0,mn=0}Dt.mode=Qe;case Qe:if(Dt.wrap&&Dt.flags){for(;mn<32;){if(hn===0)break e;hn--,gn+=wn[Ze++]<<mn,mn+=8}if(gn!==(4294967295&Dt.total)){mr.msg="incorrect length check",Dt.mode=at;break}gn=0,mn=0}Dt.mode=st;case st:bi=Q;break e;case at:bi=se;break e;case pt:return oe;default:return re}return mr.next_out=_n,mr.avail_out=cr,mr.next_in=Ze,mr.avail_in=hn,Dt.hold=gn,Dt.bits=mn,(Dt.wsize||An!==mr.avail_out&&Dt.mode<at&&(Dt.mode<Bt||yn!==W))&&On(mr,mr.output,mr.next_out,An-mr.avail_out),ri-=mr.avail_in,An-=mr.avail_out,mr.total_in+=ri,mr.total_out+=An,Dt.total+=An,Dt.wrap&&An&&(mr.adler=Dt.check=Dt.flags?I(Dt.check,ii,An,mr.next_out-An):$(Dt.check,ii,An,mr.next_out-An)),mr.data_type=Dt.bits+(Dt.last?64:0)+(Dt.mode===bt?128:0)+(Dt.mode===gt||Dt.mode===ir?256:0),(ri===0&&An===0||yn===W)&&bi===Z&&(bi=ee),bi}function Tn(mr){if(!mr||!mr.state)return re;var yn=mr.state;return yn.window&&(yn.window=null),mr.state=null,Z}function or(mr,yn){var Dt;return mr&&mr.state&&2&(Dt=mr.state).wrap?(Dt.head=yn,yn.done=!1,Z):re}function kn(mr,yn){var Dt,wn=yn.length;return mr&&mr.state?(Dt=mr.state).wrap!==0&&Dt.mode!==Oe?re:Dt.mode===Oe&&$(1,yn,wn,0)!==Dt.check?se:On(mr,yn,wn,wn)?(Dt.mode=pt,oe):(Dt.havedict=1,Z):re}g.inflateReset=fn,g.inflateReset2=vn,g.inflateResetKeep=pr,g.inflateInit=bn,g.inflateInit2=En,g.inflate=si,g.inflateEnd=Tn,g.inflateGetHeader=or,g.inflateSetDictionary=kn,g.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":52,"./adler32":53,"./crc32":55,"./inffast":57,"./inftrees":59}],59:[function(d,m,g){var w=d("../utils/common"),$=15,I=852,D=592,q=0,j=1,G=2,H=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],W=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],V=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],K=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];m.exports=function(Z,Q,J,re,se,oe,ee,ae){var ce,le,de,_e,we,pe,xe,Ge,Te,Ce=ae.bits,Oe=0,bt=0,Mt=0,lt=0,ir=0,Ye=0,xt=0,ar=0,ht=0,gt=0,zt=null,ur=0,dr=new w.Buf16($+1),fr=new w.Buf16($+1),Ft=null,$e=0;for(Oe=0;Oe<=$;Oe++)dr[Oe]=0;for(bt=0;bt<re;bt++)dr[Q[J+bt]]++;for(ir=Ce,lt=$;lt>=1&&dr[lt]===0;lt--);if(ir>lt&&(ir=lt),lt===0)return se[oe++]=20971520,se[oe++]=20971520,ae.bits=1,0;for(Mt=1;Mt<lt&&dr[Mt]===0;Mt++);for(ir<Mt&&(ir=Mt),ar=1,Oe=1;Oe<=$;Oe++)if(ar<<=1,(ar-=dr[Oe])<0)return-1;if(ar>0&&(Z===q||lt!==1))return-1;for(fr[1]=0,Oe=1;Oe<$;Oe++)fr[Oe+1]=fr[Oe]+dr[Oe];for(bt=0;bt<re;bt++)Q[J+bt]!==0&&(ee[fr[Q[J+bt]]++]=bt);if(Z===q?(zt=Ft=ee,pe=19):Z===j?(zt=H,ur-=257,Ft=W,$e-=257,pe=256):(zt=V,Ft=K,pe=-1),gt=0,bt=0,Oe=Mt,we=oe,Ye=ir,xt=0,de=-1,_e=(ht=1<<ir)-1,Z===j&&ht>I||Z===G&&ht>D)return 1;for(;;){xe=Oe-xt,ee[bt]<pe?(Ge=0,Te=ee[bt]):ee[bt]>pe?(Ge=Ft[$e+ee[bt]],Te=zt[ur+ee[bt]]):(Ge=96,Te=0),ce=1<<Oe-xt,Mt=le=1<<Ye;do se[we+(gt>>xt)+(le-=ce)]=xe<<24|Ge<<16|Te;while(le!==0);for(ce=1<<Oe-1;gt&ce;)ce>>=1;if(ce!==0?(gt&=ce-1,gt+=ce):gt=0,bt++,--dr[Oe]==0){if(Oe===lt)break;Oe=Q[J+ee[bt]]}if(Oe>ir&&(gt&_e)!==de){for(xt===0&&(xt=ir),we+=Mt,ar=1<<(Ye=Oe-xt);Ye+xt<lt&&!((ar-=dr[Ye+xt])<=0);)Ye++,ar<<=1;if(ht+=1<<Ye,Z===j&&ht>I||Z===G&&ht>D)return 1;se[de=gt&_e]=ir<<24|Ye<<16|we-oe}}return gt!==0&&(se[we+gt]=Oe-xt<<24|64<<16),ae.bits=ir,0}},{"../utils/common":52}],60:[function(d,m,g){m.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],61:[function(d,m,g){var w=d("../utils/common"),$=4,I=0,D=1,q=2;function j(or){for(var kn=or.length;--kn>=0;)or[kn]=0}var G=0,H=1,W=2,V=3,K=258,Z=29,Q=256,J=Q+1+Z,re=30,se=19,oe=2*J+1,ee=15,ae=16,ce=7,le=256,de=16,_e=17,we=18,pe=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],xe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ge=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ce=512,Oe=new Array(2*(J+2));j(Oe);var bt=new Array(2*re);j(bt);var Mt=new Array(Ce);j(Mt);var lt=new Array(K-V+1);j(lt);var ir=new Array(Z);j(ir);var Ye,xt,ar,ht=new Array(re);function gt(or,kn,mr,yn,Dt){this.static_tree=or,this.extra_bits=kn,this.extra_base=mr,this.elems=yn,this.max_length=Dt,this.has_stree=or&&or.length}function zt(or,kn){this.dyn_tree=or,this.max_code=0,this.stat_desc=kn}function ur(or){return or<256?Mt[or]:Mt[256+(or>>>7)]}function dr(or,kn){or.pending_buf[or.pending++]=255&kn,or.pending_buf[or.pending++]=kn>>>8&255}function fr(or,kn,mr){or.bi_valid>ae-mr?(or.bi_buf|=kn<<or.bi_valid&65535,dr(or,or.bi_buf),or.bi_buf=kn>>ae-or.bi_valid,or.bi_valid+=mr-ae):(or.bi_buf|=kn<<or.bi_valid&65535,or.bi_valid+=mr)}function Ft(or,kn,mr){fr(or,mr[2*kn],mr[2*kn+1])}function $e(or,kn){var mr=0;do mr|=1&or,or>>>=1,mr<<=1;while(--kn>0);return mr>>>1}function Bt(or){or.bi_valid===16?(dr(or,or.bi_buf),or.bi_buf=0,or.bi_valid=0):or.bi_valid>=8&&(or.pending_buf[or.pending++]=255&or.bi_buf,or.bi_buf>>=8,or.bi_valid-=8)}function Qe(or,kn){var mr,yn,Dt,wn,ii,Ze,_n=kn.dyn_tree,hn=kn.max_code,cr=kn.stat_desc.static_tree,gn=kn.stat_desc.has_stree,mn=kn.stat_desc.extra_bits,ri=kn.stat_desc.extra_base,An=kn.stat_desc.max_length,ei=0;for(wn=0;wn<=ee;wn++)or.bl_count[wn]=0;for(_n[2*or.heap[or.heap_max]+1]=0,mr=or.heap_max+1;mr<oe;mr++)(wn=_n[2*_n[2*(yn=or.heap[mr])+1]+1]+1)>An&&(wn=An,ei++),_n[2*yn+1]=wn,yn>hn||(or.bl_count[wn]++,ii=0,yn>=ri&&(ii=mn[yn-ri]),Ze=_n[2*yn],or.opt_len+=Ze*(wn+ii),gn&&(or.static_len+=Ze*(cr[2*yn+1]+ii)));if(ei!==0){do{for(wn=An-1;or.bl_count[wn]===0;)wn--;or.bl_count[wn]--,or.bl_count[wn+1]+=2,or.bl_count[An]--,ei-=2}while(ei>0);for(wn=An;wn!==0;wn--)for(yn=or.bl_count[wn];yn!==0;)(Dt=or.heap[--mr])>hn||(_n[2*Dt+1]!==wn&&(or.opt_len+=(wn-_n[2*Dt+1])*_n[2*Dt],_n[2*Dt+1]=wn),yn--)}}function st(or,kn,mr){var yn,Dt,wn=new Array(ee+1),ii=0;for(yn=1;yn<=ee;yn++)wn[yn]=ii=ii+mr[yn-1]<<1;for(Dt=0;Dt<=kn;Dt++){var Ze=or[2*Dt+1];Ze!==0&&(or[2*Dt]=$e(wn[Ze]++,Ze))}}function at(){var or,kn,mr,yn,Dt,wn=new Array(ee+1);for(mr=0,yn=0;yn<Z-1;yn++)for(ir[yn]=mr,or=0;or<1<<pe[yn];or++)lt[mr++]=yn;for(lt[mr-1]=yn,Dt=0,yn=0;yn<16;yn++)for(ht[yn]=Dt,or=0;or<1<<xe[yn];or++)Mt[Dt++]=yn;for(Dt>>=7;yn<re;yn++)for(ht[yn]=Dt<<7,or=0;or<1<<xe[yn]-7;or++)Mt[256+Dt++]=yn;for(kn=0;kn<=ee;kn++)wn[kn]=0;for(or=0;or<=143;)Oe[2*or+1]=8,or++,wn[8]++;for(;or<=255;)Oe[2*or+1]=9,or++,wn[9]++;for(;or<=279;)Oe[2*or+1]=7,or++,wn[7]++;for(;or<=287;)Oe[2*or+1]=8,or++,wn[8]++;for(st(Oe,J+1,wn),or=0;or<re;or++)bt[2*or+1]=5,bt[2*or]=$e(or,5);Ye=new gt(Oe,pe,Q+1,J,ee),xt=new gt(bt,xe,0,re,ee),ar=new gt(new Array(0),Ge,0,se,ce)}function pt(or){var kn;for(kn=0;kn<J;kn++)or.dyn_ltree[2*kn]=0;for(kn=0;kn<re;kn++)or.dyn_dtree[2*kn]=0;for(kn=0;kn<se;kn++)or.bl_tree[2*kn]=0;or.dyn_ltree[2*le]=1,or.opt_len=or.static_len=0,or.last_lit=or.matches=0}function sr(or){or.bi_valid>8?dr(or,or.bi_buf):or.bi_valid>0&&(or.pending_buf[or.pending++]=or.bi_buf),or.bi_buf=0,or.bi_valid=0}function Ee(or,kn,mr,yn){sr(or),dr(or,mr),dr(or,~mr),w.arraySet(or.pending_buf,or.window,kn,mr,or.pending),or.pending+=mr}function ze(or,kn,mr,yn){var Dt=2*kn,wn=2*mr;return or[Dt]<or[wn]||or[Dt]===or[wn]&&yn[kn]<=yn[mr]}function ct(or,kn,mr){for(var yn=or.heap[mr],Dt=mr<<1;Dt<=or.heap_len&&(Dt<or.heap_len&&ze(kn,or.heap[Dt+1],or.heap[Dt],or.depth)&&Dt++,!ze(kn,yn,or.heap[Dt],or.depth));)or.heap[mr]=or.heap[Dt],mr=Dt,Dt<<=1;or.heap[mr]=yn}function ft(or,kn,mr){var yn,Dt,wn,ii,Ze=0;if(or.last_lit!==0)do yn=or.pending_buf[or.d_buf+2*Ze]<<8|or.pending_buf[or.d_buf+2*Ze+1],Dt=or.pending_buf[or.l_buf+Ze],Ze++,yn===0?Ft(or,Dt,kn):(Ft(or,(wn=lt[Dt])+Q+1,kn),(ii=pe[wn])!==0&&fr(or,Dt-=ir[wn],ii),Ft(or,wn=ur(--yn),mr),(ii=xe[wn])!==0&&fr(or,yn-=ht[wn],ii));while(Ze<or.last_lit);Ft(or,le,kn)}function pr(or,kn){var mr,yn,Dt,wn=kn.dyn_tree,ii=kn.stat_desc.static_tree,Ze=kn.stat_desc.has_stree,_n=kn.stat_desc.elems,hn=-1;for(or.heap_len=0,or.heap_max=oe,mr=0;mr<_n;mr++)wn[2*mr]!==0?(or.heap[++or.heap_len]=hn=mr,or.depth[mr]=0):wn[2*mr+1]=0;for(;or.heap_len<2;)wn[2*(Dt=or.heap[++or.heap_len]=hn<2?++hn:0)]=1,or.depth[Dt]=0,or.opt_len--,Ze&&(or.static_len-=ii[2*Dt+1]);for(kn.max_code=hn,mr=or.heap_len>>1;mr>=1;mr--)ct(or,wn,mr);Dt=_n;do mr=or.heap[1],or.heap[1]=or.heap[or.heap_len--],ct(or,wn,1),yn=or.heap[1],or.heap[--or.heap_max]=mr,or.heap[--or.heap_max]=yn,wn[2*Dt]=wn[2*mr]+wn[2*yn],or.depth[Dt]=(or.depth[mr]>=or.depth[yn]?or.depth[mr]:or.depth[yn])+1,wn[2*mr+1]=wn[2*yn+1]=Dt,or.heap[1]=Dt++,ct(or,wn,1);while(or.heap_len>=2);or.heap[--or.heap_max]=or.heap[1],Qe(or,kn),st(wn,hn,or.bl_count)}function fn(or,kn,mr){var yn,Dt,wn=-1,ii=kn[1],Ze=0,_n=7,hn=4;for(ii===0&&(_n=138,hn=3),kn[2*(mr+1)+1]=65535,yn=0;yn<=mr;yn++)Dt=ii,ii=kn[2*(yn+1)+1],++Ze<_n&&Dt===ii||(Ze<hn?or.bl_tree[2*Dt]+=Ze:Dt!==0?(Dt!==wn&&or.bl_tree[2*Dt]++,or.bl_tree[2*de]++):Ze<=10?or.bl_tree[2*_e]++:or.bl_tree[2*we]++,Ze=0,wn=Dt,ii===0?(_n=138,hn=3):Dt===ii?(_n=6,hn=3):(_n=7,hn=4))}function vn(or,kn,mr){var yn,Dt,wn=-1,ii=kn[1],Ze=0,_n=7,hn=4;for(ii===0&&(_n=138,hn=3),yn=0;yn<=mr;yn++)if(Dt=ii,ii=kn[2*(yn+1)+1],!(++Ze<_n&&Dt===ii)){if(Ze<hn)do Ft(or,Dt,or.bl_tree);while(--Ze!=0);else Dt!==0?(Dt!==wn&&(Ft(or,Dt,or.bl_tree),Ze--),Ft(or,de,or.bl_tree),fr(or,Ze-3,2)):Ze<=10?(Ft(or,_e,or.bl_tree),fr(or,Ze-3,3)):(Ft(or,we,or.bl_tree),fr(or,Ze-11,7));Ze=0,wn=Dt,ii===0?(_n=138,hn=3):Dt===ii?(_n=6,hn=3):(_n=7,hn=4)}}function En(or){var kn;for(fn(or,or.dyn_ltree,or.l_desc.max_code),fn(or,or.dyn_dtree,or.d_desc.max_code),pr(or,or.bl_desc),kn=se-1;kn>=3&&or.bl_tree[2*Te[kn]+1]===0;kn--);return or.opt_len+=3*(kn+1)+5+5+4,kn}function bn(or,kn,mr,yn){var Dt;for(fr(or,kn-257,5),fr(or,mr-1,5),fr(or,yn-4,4),Dt=0;Dt<yn;Dt++)fr(or,or.bl_tree[2*Te[Dt]+1],3);vn(or,or.dyn_ltree,kn-1),vn(or,or.dyn_dtree,mr-1)}function $n(or){var kn,mr=4093624447;for(kn=0;kn<=31;kn++,mr>>>=1)if(1&mr&&or.dyn_ltree[2*kn]!==0)return I;if(or.dyn_ltree[18]!==0||or.dyn_ltree[20]!==0||or.dyn_ltree[26]!==0)return D;for(kn=32;kn<Q;kn++)if(or.dyn_ltree[2*kn]!==0)return D;return I}j(ht);var xn=!1;function ti(or){xn||(at(),xn=!0),or.l_desc=new zt(or.dyn_ltree,Ye),or.d_desc=new zt(or.dyn_dtree,xt),or.bl_desc=new zt(or.bl_tree,ar),or.bi_buf=0,or.bi_valid=0,pt(or)}function Cn(or,kn,mr,yn){fr(or,(G<<1)+(yn?1:0),3),Ee(or,kn,mr)}function On(or){fr(or,H<<1,3),Ft(or,le,Oe),Bt(or)}function si(or,kn,mr,yn){var Dt,wn,ii=0;or.level>0?(or.strm.data_type===q&&(or.strm.data_type=$n(or)),pr(or,or.l_desc),pr(or,or.d_desc),ii=En(or),Dt=or.opt_len+3+7>>>3,(wn=or.static_len+3+7>>>3)<=Dt&&(Dt=wn)):Dt=wn=mr+5,mr+4<=Dt&&kn!==-1?Cn(or,kn,mr,yn):or.strategy===$||wn===Dt?(fr(or,(H<<1)+(yn?1:0),3),ft(or,Oe,bt)):(fr(or,(W<<1)+(yn?1:0),3),bn(or,or.l_desc.max_code+1,or.d_desc.max_code+1,ii+1),ft(or,or.dyn_ltree,or.dyn_dtree)),pt(or),yn&&sr(or)}function Tn(or,kn,mr){return or.pending_buf[or.d_buf+2*or.last_lit]=kn>>>8&255,or.pending_buf[or.d_buf+2*or.last_lit+1]=255&kn,or.pending_buf[or.l_buf+or.last_lit]=255&mr,or.last_lit++,kn===0?or.dyn_ltree[2*mr]++:(or.matches++,kn--,or.dyn_ltree[2*(lt[mr]+Q+1)]++,or.dyn_dtree[2*ur(kn)]++),or.last_lit===or.lit_bufsize-1}g._tr_init=ti,g._tr_stored_block=Cn,g._tr_flush_block=si,g._tr_tally=Tn,g._tr_align=On},{"../utils/common":52}],62:[function(d,m,g){function w(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}m.exports=w},{}],63:[function(d,m,g){var w,$,I=m.exports={};function D(){throw new Error("setTimeout has not been defined")}function q(){throw new Error("clearTimeout has not been defined")}function j(se){if(w===setTimeout)return setTimeout(se,0);if((w===D||!w)&&setTimeout)return w=setTimeout,setTimeout(se,0);try{return w(se,0)}catch{try{return w.call(null,se,0)}catch{return w.call(this,se,0)}}}function G(se){if($===clearTimeout)return clearTimeout(se);if(($===q||!$)&&clearTimeout)return $=clearTimeout,clearTimeout(se);try{return $(se)}catch{try{return $.call(null,se)}catch{return $.call(this,se)}}}(function(){try{w=typeof setTimeout=="function"?setTimeout:D}catch{w=D}try{$=typeof clearTimeout=="function"?clearTimeout:q}catch{$=q}})();var H,W=[],V=!1,K=-1;function Z(){V&&H&&(V=!1,H.length?W=H.concat(W):K=-1,W.length&&Q())}function Q(){if(!V){var se=j(Z);V=!0;for(var oe=W.length;oe;){for(H=W,W=[];++K<oe;)H&&H[K].run();K=-1,oe=W.length}H=null,V=!1,G(se)}}function J(se,oe){this.fun=se,this.array=oe}function re(){}I.nextTick=function(se){var oe=new Array(arguments.length-1);if(arguments.length>1)for(var ee=1;ee<arguments.length;ee++)oe[ee-1]=arguments[ee];W.push(new J(se,oe)),W.length!==1||V||j(Q)},J.prototype.run=function(){this.fun.apply(null,this.array)},I.title="browser",I.browser=!0,I.env={},I.argv=[],I.version="",I.versions={},I.on=re,I.addListener=re,I.once=re,I.off=re,I.removeListener=re,I.removeAllListeners=re,I.emit=re,I.prependListener=re,I.prependOnceListener=re,I.listeners=function(se){return[]},I.binding=function(se){throw new Error("process.binding is not supported")},I.cwd=function(){return"/"},I.chdir=function(se){throw new Error("process.chdir is not supported")},I.umask=function(){return 0}},{}],64:[function(d,m,g){/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var w=d("buffer"),$=w.Buffer;function I(q,j){for(var G in q)j[G]=q[G]}function D(q,j,G){return $(q,j,G)}$.from&&$.alloc&&$.allocUnsafe&&$.allocUnsafeSlow?m.exports=w:(I(w,g),g.Buffer=D),D.prototype=Object.create($.prototype),I($,D),D.from=function(q,j,G){if(typeof q=="number")throw new TypeError("Argument must not be a number");return $(q,j,G)},D.alloc=function(q,j,G){if(typeof q!="number")throw new TypeError("Argument must be a number");var H=$(q);return j!==void 0?typeof G=="string"?H.fill(j,G):H.fill(j):H.fill(0),H},D.allocUnsafe=function(q){if(typeof q!="number")throw new TypeError("Argument must be a number");return $(q)},D.allocUnsafeSlow=function(q){if(typeof q!="number")throw new TypeError("Argument must be a number");return w.SlowBuffer(q)}},{buffer:32}],65:[function(d,m,g){m.exports=$;var w=d("events").EventEmitter;function $(){w.call(this)}d("inherits")($,w),$.Readable=d("readable-stream/lib/_stream_readable.js"),$.Writable=d("readable-stream/lib/_stream_writable.js"),$.Duplex=d("readable-stream/lib/_stream_duplex.js"),$.Transform=d("readable-stream/lib/_stream_transform.js"),$.PassThrough=d("readable-stream/lib/_stream_passthrough.js"),$.finished=d("readable-stream/lib/internal/streams/end-of-stream.js"),$.pipeline=d("readable-stream/lib/internal/streams/pipeline.js"),$.Stream=$,$.prototype.pipe=function(I,D){var q=this;function j(Q){I.writable&&I.write(Q)===!1&&q.pause&&q.pause()}function G(){q.readable&&q.resume&&q.resume()}q.on("data",j),I.on("drain",G),I._isStdio||D&&D.end===!1||(q.on("end",W),q.on("close",V));var H=!1;function W(){H||(H=!0,I.end())}function V(){H||(H=!0,typeof I.destroy=="function"&&I.destroy())}function K(Q){if(Z(),w.listenerCount(this,"error")===0)throw Q}function Z(){q.removeListener("data",j),I.removeListener("drain",G),q.removeListener("end",W),q.removeListener("close",V),q.removeListener("error",K),I.removeListener("error",K),q.removeListener("end",Z),q.removeListener("close",Z),I.removeListener("close",Z)}return q.on("error",K),I.on("error",K),q.on("end",Z),q.on("close",Z),I.on("close",Z),I.emit("pipe",q),I}},{events:35,inherits:46,"readable-stream/lib/_stream_duplex.js":67,"readable-stream/lib/_stream_passthrough.js":68,"readable-stream/lib/_stream_readable.js":69,"readable-stream/lib/_stream_transform.js":70,"readable-stream/lib/_stream_writable.js":71,"readable-stream/lib/internal/streams/end-of-stream.js":75,"readable-stream/lib/internal/streams/pipeline.js":77}],66:[function(d,m,g){function w(H,W){H.prototype=Object.create(W.prototype),H.prototype.constructor=H,H.__proto__=W}var $={};function I(H,W,V){function K(Q,J,re){return typeof W=="string"?W:W(Q,J,re)}V||(V=Error);var Z=(function(Q){function J(re,se,oe){return Q.call(this,K(re,se,oe))||this}return w(J,Q),J})(V);Z.prototype.name=V.name,Z.prototype.code=H,$[H]=Z}function D(H,W){if(Array.isArray(H)){var V=H.length;return H=H.map((function(K){return String(K)})),V>2?"one of ".concat(W," ").concat(H.slice(0,V-1).join(", "),", or ")+H[V-1]:V===2?"one of ".concat(W," ").concat(H[0]," or ").concat(H[1]):"of ".concat(W," ").concat(H[0])}return"of ".concat(W," ").concat(String(H))}function q(H,W,V){return H.substr(0,W.length)===W}function j(H,W,V){return(V===void 0||V>H.length)&&(V=H.length),H.substring(V-W.length,V)===W}function G(H,W,V){return typeof V!="number"&&(V=0),!(V+W.length>H.length)&&H.indexOf(W,V)!==-1}I("ERR_INVALID_OPT_VALUE",(function(H,W){return'The value "'+W+'" is invalid for option "'+H+'"'}),TypeError),I("ERR_INVALID_ARG_TYPE",(function(H,W,V){var K,Z;if(typeof W=="string"&&q(W,"not ")?(K="must not be",W=W.replace(/^not /,"")):K="must be",j(H," argument"))Z="The ".concat(H," ").concat(K," ").concat(D(W,"type"));else{var Q=G(H,".")?"property":"argument";Z='The "'.concat(H,'" ').concat(Q," ").concat(K," ").concat(D(W,"type"))}return Z+=". Received type ".concat(typeof V)}),TypeError),I("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),I("ERR_METHOD_NOT_IMPLEMENTED",(function(H){return"The "+H+" method is not implemented"})),I("ERR_STREAM_PREMATURE_CLOSE","Premature close"),I("ERR_STREAM_DESTROYED",(function(H){return"Cannot call "+H+" after a stream was destroyed"})),I("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),I("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),I("ERR_STREAM_WRITE_AFTER_END","write after end"),I("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),I("ERR_UNKNOWN_ENCODING",(function(H){return"Unknown encoding: "+H}),TypeError),I("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),m.exports.codes=$},{}],67:[function(d,m,g){(function(w){(function(){var $=Object.keys||function(K){var Z=[];for(var Q in K)Z.push(Q);return Z};m.exports=H;var I=d("./_stream_readable"),D=d("./_stream_writable");d("inherits")(H,I);for(var q=$(D.prototype),j=0;j<q.length;j++){var G=q[j];H.prototype[G]||(H.prototype[G]=D.prototype[G])}function H(K){if(!(this instanceof H))return new H(K);I.call(this,K),D.call(this,K),this.allowHalfOpen=!0,K&&(K.readable===!1&&(this.readable=!1),K.writable===!1&&(this.writable=!1),K.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",W)))}function W(){this._writableState.ended||w.nextTick(V,this)}function V(K){K.end()}Object.defineProperty(H.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(H.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(H.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(H.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(K){this._readableState!==void 0&&this._writableState!==void 0&&(this._readableState.destroyed=K,this._writableState.destroyed=K)}})}).call(this)}).call(this,d("_process"))},{"./_stream_readable":69,"./_stream_writable":71,_process:63,inherits:46}],68:[function(d,m,g){m.exports=$;var w=d("./_stream_transform");function $(I){if(!(this instanceof $))return new $(I);w.call(this,I)}d("inherits")($,w),$.prototype._transform=function(I,D,q){q(null,I)}},{"./_stream_transform":70,inherits:46}],69:[function(d,m,g){(function(w,$){(function(){var I;m.exports=Ge,Ge.ReadableState=xe,d("events").EventEmitter;var D=function(at,pt){return at.listeners(pt).length},q=d("./internal/streams/stream"),j=d("buffer").Buffer,G=$.Uint8Array||function(){};function H(at){return j.from(at)}function W(at){return j.isBuffer(at)||at instanceof G}var V,K=d("util");V=K&&K.debuglog?K.debuglog("stream"):function(){};var Z,Q,J,re=d("./internal/streams/buffer_list"),se=d("./internal/streams/destroy"),oe=d("./internal/streams/state").getHighWaterMark,ee=d("../errors").codes,ae=ee.ERR_INVALID_ARG_TYPE,ce=ee.ERR_STREAM_PUSH_AFTER_EOF,le=ee.ERR_METHOD_NOT_IMPLEMENTED,de=ee.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;d("inherits")(Ge,q);var _e=se.errorOrDestroy,we=["error","close","destroy","pause","resume"];function pe(at,pt,sr){if(typeof at.prependListener=="function")return at.prependListener(pt,sr);at._events&&at._events[pt]?Array.isArray(at._events[pt])?at._events[pt].unshift(sr):at._events[pt]=[sr,at._events[pt]]:at.on(pt,sr)}function xe(at,pt,sr){I=I||d("./_stream_duplex"),at=at||{},typeof sr!="boolean"&&(sr=pt instanceof I),this.objectMode=!!at.objectMode,sr&&(this.objectMode=this.objectMode||!!at.readableObjectMode),this.highWaterMark=oe(this,at,"readableHighWaterMark",sr),this.buffer=new re,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=at.emitClose!==!1,this.autoDestroy=!!at.autoDestroy,this.destroyed=!1,this.defaultEncoding=at.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,at.encoding&&(Z||(Z=d("string_decoder/").StringDecoder),this.decoder=new Z(at.encoding),this.encoding=at.encoding)}function Ge(at){if(I=I||d("./_stream_duplex"),!(this instanceof Ge))return new Ge(at);var pt=this instanceof I;this._readableState=new xe(at,this,pt),this.readable=!0,at&&(typeof at.read=="function"&&(this._read=at.read),typeof at.destroy=="function"&&(this._destroy=at.destroy)),q.call(this)}function Te(at,pt,sr,Ee,ze){V("readableAddChunk",pt);var ct,ft=at._readableState;if(pt===null)ft.reading=!1,ir(at,ft);else if(ze||(ct=Oe(ft,pt)),ct)_e(at,ct);else if(ft.objectMode||pt&&pt.length>0)if(typeof pt=="string"||ft.objectMode||Object.getPrototypeOf(pt)===j.prototype||(pt=H(pt)),Ee)ft.endEmitted?_e(at,new de):Ce(at,ft,pt,!0);else if(ft.ended)_e(at,new ce);else{if(ft.destroyed)return!1;ft.reading=!1,ft.decoder&&!sr?(pt=ft.decoder.write(pt),ft.objectMode||pt.length!==0?Ce(at,ft,pt,!1):ar(at,ft)):Ce(at,ft,pt,!1)}else Ee||(ft.reading=!1,ar(at,ft));return!ft.ended&&(ft.length<ft.highWaterMark||ft.length===0)}function Ce(at,pt,sr,Ee){pt.flowing&&pt.length===0&&!pt.sync?(pt.awaitDrain=0,at.emit("data",sr)):(pt.length+=pt.objectMode?1:sr.length,Ee?pt.buffer.unshift(sr):pt.buffer.push(sr),pt.needReadable&&Ye(at)),ar(at,pt)}function Oe(at,pt){var sr;return W(pt)||typeof pt=="string"||pt===void 0||at.objectMode||(sr=new ae("chunk",["string","Buffer","Uint8Array"],pt)),sr}Object.defineProperty(Ge.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(at){this._readableState&&(this._readableState.destroyed=at)}}),Ge.prototype.destroy=se.destroy,Ge.prototype._undestroy=se.undestroy,Ge.prototype._destroy=function(at,pt){pt(at)},Ge.prototype.push=function(at,pt){var sr,Ee=this._readableState;return Ee.objectMode?sr=!0:typeof at=="string"&&((pt=pt||Ee.defaultEncoding)!==Ee.encoding&&(at=j.from(at,pt),pt=""),sr=!0),Te(this,at,pt,!1,sr)},Ge.prototype.unshift=function(at){return Te(this,at,null,!0,!1)},Ge.prototype.isPaused=function(){return this._readableState.flowing===!1},Ge.prototype.setEncoding=function(at){Z||(Z=d("string_decoder/").StringDecoder);var pt=new Z(at);this._readableState.decoder=pt,this._readableState.encoding=this._readableState.decoder.encoding;for(var sr=this._readableState.buffer.head,Ee="";sr!==null;)Ee+=pt.write(sr.data),sr=sr.next;return this._readableState.buffer.clear(),Ee!==""&&this._readableState.buffer.push(Ee),this._readableState.length=Ee.length,this};var bt=1073741824;function Mt(at){return at>=bt?at=bt:(at--,at|=at>>>1,at|=at>>>2,at|=at>>>4,at|=at>>>8,at|=at>>>16,at++),at}function lt(at,pt){return at<=0||pt.length===0&&pt.ended?0:pt.objectMode?1:at!=at?pt.flowing&&pt.length?pt.buffer.head.data.length:pt.length:(at>pt.highWaterMark&&(pt.highWaterMark=Mt(at)),at<=pt.length?at:pt.ended?pt.length:(pt.needReadable=!0,0))}function ir(at,pt){if(V("onEofChunk"),!pt.ended){if(pt.decoder){var sr=pt.decoder.end();sr&&sr.length&&(pt.buffer.push(sr),pt.length+=pt.objectMode?1:sr.length)}pt.ended=!0,pt.sync?Ye(at):(pt.needReadable=!1,pt.emittedReadable||(pt.emittedReadable=!0,xt(at)))}}function Ye(at){var pt=at._readableState;V("emitReadable",pt.needReadable,pt.emittedReadable),pt.needReadable=!1,pt.emittedReadable||(V("emitReadable",pt.flowing),pt.emittedReadable=!0,w.nextTick(xt,at))}function xt(at){var pt=at._readableState;V("emitReadable_",pt.destroyed,pt.length,pt.ended),pt.destroyed||!pt.length&&!pt.ended||(at.emit("readable"),pt.emittedReadable=!1),pt.needReadable=!pt.flowing&&!pt.ended&&pt.length<=pt.highWaterMark,Ft(at)}function ar(at,pt){pt.readingMore||(pt.readingMore=!0,w.nextTick(ht,at,pt))}function ht(at,pt){for(;!pt.reading&&!pt.ended&&(pt.length<pt.highWaterMark||pt.flowing&&pt.length===0);){var sr=pt.length;if(V("maybeReadMore read 0"),at.read(0),sr===pt.length)break}pt.readingMore=!1}function gt(at){return function(){var pt=at._readableState;V("pipeOnDrain",pt.awaitDrain),pt.awaitDrain&&pt.awaitDrain--,pt.awaitDrain===0&&D(at,"data")&&(pt.flowing=!0,Ft(at))}}function zt(at){var pt=at._readableState;pt.readableListening=at.listenerCount("readable")>0,pt.resumeScheduled&&!pt.paused?pt.flowing=!0:at.listenerCount("data")>0&&at.resume()}function ur(at){V("readable nexttick read 0"),at.read(0)}function dr(at,pt){pt.resumeScheduled||(pt.resumeScheduled=!0,w.nextTick(fr,at,pt))}function fr(at,pt){V("resume",pt.reading),pt.reading||at.read(0),pt.resumeScheduled=!1,at.emit("resume"),Ft(at),pt.flowing&&!pt.reading&&at.read(0)}function Ft(at){var pt=at._readableState;for(V("flow",pt.flowing);pt.flowing&&at.read()!==null;);}function $e(at,pt){return pt.length===0?null:(pt.objectMode?sr=pt.buffer.shift():!at||at>=pt.length?(sr=pt.decoder?pt.buffer.join(""):pt.buffer.length===1?pt.buffer.first():pt.buffer.concat(pt.length),pt.buffer.clear()):sr=pt.buffer.consume(at,pt.decoder),sr);var sr}function Bt(at){var pt=at._readableState;V("endReadable",pt.endEmitted),pt.endEmitted||(pt.ended=!0,w.nextTick(Qe,pt,at))}function Qe(at,pt){if(V("endReadableNT",at.endEmitted,at.length),!at.endEmitted&&at.length===0&&(at.endEmitted=!0,pt.readable=!1,pt.emit("end"),at.autoDestroy)){var sr=pt._writableState;(!sr||sr.autoDestroy&&sr.finished)&&pt.destroy()}}function st(at,pt){for(var sr=0,Ee=at.length;sr<Ee;sr++)if(at[sr]===pt)return sr;return-1}Ge.prototype.read=function(at){V("read",at),at=parseInt(at,10);var pt=this._readableState,sr=at;if(at!==0&&(pt.emittedReadable=!1),at===0&&pt.needReadable&&((pt.highWaterMark!==0?pt.length>=pt.highWaterMark:pt.length>0)||pt.ended))return V("read: emitReadable",pt.length,pt.ended),pt.length===0&&pt.ended?Bt(this):Ye(this),null;if((at=lt(at,pt))===0&&pt.ended)return pt.length===0&&Bt(this),null;var Ee,ze=pt.needReadable;return V("need readable",ze),(pt.length===0||pt.length-at<pt.highWaterMark)&&V("length less than watermark",ze=!0),pt.ended||pt.reading?V("reading or ended",ze=!1):ze&&(V("do read"),pt.reading=!0,pt.sync=!0,pt.length===0&&(pt.needReadable=!0),this._read(pt.highWaterMark),pt.sync=!1,pt.reading||(at=lt(sr,pt))),(Ee=at>0?$e(at,pt):null)===null?(pt.needReadable=pt.length<=pt.highWaterMark,at=0):(pt.length-=at,pt.awaitDrain=0),pt.length===0&&(pt.ended||(pt.needReadable=!0),sr!==at&&pt.ended&&Bt(this)),Ee!==null&&this.emit("data",Ee),Ee},Ge.prototype._read=function(at){_e(this,new le("_read()"))},Ge.prototype.pipe=function(at,pt){var sr=this,Ee=this._readableState;switch(Ee.pipesCount){case 0:Ee.pipes=at;break;case 1:Ee.pipes=[Ee.pipes,at];break;default:Ee.pipes.push(at)}Ee.pipesCount+=1,V("pipe count=%d opts=%j",Ee.pipesCount,pt);var ze=pt&&pt.end===!1||at===w.stdout||at===w.stderr?ti:ft;function ct(Cn,On){V("onunpipe"),Cn===sr&&On&&On.hasUnpiped===!1&&(On.hasUnpiped=!0,vn())}function ft(){V("onend"),at.end()}Ee.endEmitted?w.nextTick(ze):sr.once("end",ze),at.on("unpipe",ct);var pr=gt(sr);at.on("drain",pr);var fn=!1;function vn(){V("cleanup"),at.removeListener("close",$n),at.removeListener("finish",xn),at.removeListener("drain",pr),at.removeListener("error",bn),at.removeListener("unpipe",ct),sr.removeListener("end",ft),sr.removeListener("end",ti),sr.removeListener("data",En),fn=!0,!Ee.awaitDrain||at._writableState&&!at._writableState.needDrain||pr()}function En(Cn){V("ondata");var On=at.write(Cn);V("dest.write",On),On===!1&&((Ee.pipesCount===1&&Ee.pipes===at||Ee.pipesCount>1&&st(Ee.pipes,at)!==-1)&&!fn&&(V("false write response, pause",Ee.awaitDrain),Ee.awaitDrain++),sr.pause())}function bn(Cn){V("onerror",Cn),ti(),at.removeListener("error",bn),D(at,"error")===0&&_e(at,Cn)}function $n(){at.removeListener("finish",xn),ti()}function xn(){V("onfinish"),at.removeListener("close",$n),ti()}function ti(){V("unpipe"),sr.unpipe(at)}return sr.on("data",En),pe(at,"error",bn),at.once("close",$n),at.once("finish",xn),at.emit("pipe",sr),Ee.flowing||(V("pipe resume"),sr.resume()),at},Ge.prototype.unpipe=function(at){var pt=this._readableState,sr={hasUnpiped:!1};if(pt.pipesCount===0)return this;if(pt.pipesCount===1)return at&&at!==pt.pipes||(at||(at=pt.pipes),pt.pipes=null,pt.pipesCount=0,pt.flowing=!1,at&&at.emit("unpipe",this,sr)),this;if(!at){var Ee=pt.pipes,ze=pt.pipesCount;pt.pipes=null,pt.pipesCount=0,pt.flowing=!1;for(var ct=0;ct<ze;ct++)Ee[ct].emit("unpipe",this,{hasUnpiped:!1});return this}var ft=st(pt.pipes,at);return ft===-1||(pt.pipes.splice(ft,1),pt.pipesCount-=1,pt.pipesCount===1&&(pt.pipes=pt.pipes[0]),at.emit("unpipe",this,sr)),this},Ge.prototype.on=function(at,pt){var sr=q.prototype.on.call(this,at,pt),Ee=this._readableState;return at==="data"?(Ee.readableListening=this.listenerCount("readable")>0,Ee.flowing!==!1&&this.resume()):at==="readable"&&(Ee.endEmitted||Ee.readableListening||(Ee.readableListening=Ee.needReadable=!0,Ee.flowing=!1,Ee.emittedReadable=!1,V("on readable",Ee.length,Ee.reading),Ee.length?Ye(this):Ee.reading||w.nextTick(ur,this))),sr},Ge.prototype.addListener=Ge.prototype.on,Ge.prototype.removeListener=function(at,pt){var sr=q.prototype.removeListener.call(this,at,pt);return at==="readable"&&w.nextTick(zt,this),sr},Ge.prototype.removeAllListeners=function(at){var pt=q.prototype.removeAllListeners.apply(this,arguments);return at!=="readable"&&at!==void 0||w.nextTick(zt,this),pt},Ge.prototype.resume=function(){var at=this._readableState;return at.flowing||(V("resume"),at.flowing=!at.readableListening,dr(this,at)),at.paused=!1,this},Ge.prototype.pause=function(){return V("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(V("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},Ge.prototype.wrap=function(at){var pt=this,sr=this._readableState,Ee=!1;for(var ze in at.on("end",(function(){if(V("wrapped end"),sr.decoder&&!sr.ended){var ft=sr.decoder.end();ft&&ft.length&&pt.push(ft)}pt.push(null)})),at.on("data",(function(ft){V("wrapped data"),sr.decoder&&(ft=sr.decoder.write(ft)),sr.objectMode&&ft==null||(sr.objectMode||ft&&ft.length)&&(pt.push(ft)||(Ee=!0,at.pause()))})),at)this[ze]===void 0&&typeof at[ze]=="function"&&(this[ze]=(function(ft){return function(){return at[ft].apply(at,arguments)}})(ze));for(var ct=0;ct<we.length;ct++)at.on(we[ct],this.emit.bind(this,we[ct]));return this._read=function(ft){V("wrapped _read",ft),Ee&&(Ee=!1,at.resume())},this},typeof Symbol=="function"&&(Ge.prototype[Symbol.asyncIterator]=function(){return Q===void 0&&(Q=d("./internal/streams/async_iterator")),Q(this)}),Object.defineProperty(Ge.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Ge.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Ge.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(at){this._readableState&&(this._readableState.flowing=at)}}),Ge._fromList=$e,Object.defineProperty(Ge.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(Ge.from=function(at,pt){return J===void 0&&(J=d("./internal/streams/from")),J(Ge,at,pt)})}).call(this)}).call(this,d("_process"),commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":66,"./_stream_duplex":67,"./internal/streams/async_iterator":72,"./internal/streams/buffer_list":73,"./internal/streams/destroy":74,"./internal/streams/from":76,"./internal/streams/state":78,"./internal/streams/stream":79,_process:63,buffer:32,events:35,inherits:46,"string_decoder/":80,util:29}],70:[function(d,m,g){m.exports=H;var w=d("../errors").codes,$=w.ERR_METHOD_NOT_IMPLEMENTED,I=w.ERR_MULTIPLE_CALLBACK,D=w.ERR_TRANSFORM_ALREADY_TRANSFORMING,q=w.ERR_TRANSFORM_WITH_LENGTH_0,j=d("./_stream_duplex");function G(K,Z){var Q=this._transformState;Q.transforming=!1;var J=Q.writecb;if(J===null)return this.emit("error",new I);Q.writechunk=null,Q.writecb=null,Z!=null&&this.push(Z),J(K);var re=this._readableState;re.reading=!1,(re.needReadable||re.length<re.highWaterMark)&&this._read(re.highWaterMark)}function H(K){if(!(this instanceof H))return new H(K);j.call(this,K),this._transformState={afterTransform:G.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,K&&(typeof K.transform=="function"&&(this._transform=K.transform),typeof K.flush=="function"&&(this._flush=K.flush)),this.on("prefinish",W)}function W(){var K=this;typeof this._flush!="function"||this._readableState.destroyed?V(this,null,null):this._flush((function(Z,Q){V(K,Z,Q)}))}function V(K,Z,Q){if(Z)return K.emit("error",Z);if(Q!=null&&K.push(Q),K._writableState.length)throw new q;if(K._transformState.transforming)throw new D;return K.push(null)}d("inherits")(H,j),H.prototype.push=function(K,Z){return this._transformState.needTransform=!1,j.prototype.push.call(this,K,Z)},H.prototype._transform=function(K,Z,Q){Q(new $("_transform()"))},H.prototype._write=function(K,Z,Q){var J=this._transformState;if(J.writecb=Q,J.writechunk=K,J.writeencoding=Z,!J.transforming){var re=this._readableState;(J.needTransform||re.needReadable||re.length<re.highWaterMark)&&this._read(re.highWaterMark)}},H.prototype._read=function(K){var Z=this._transformState;Z.writechunk===null||Z.transforming?Z.needTransform=!0:(Z.transforming=!0,this._transform(Z.writechunk,Z.writeencoding,Z.afterTransform))},H.prototype._destroy=function(K,Z){j.prototype._destroy.call(this,K,(function(Q){Z(Q)}))}},{"../errors":66,"./_stream_duplex":67,inherits:46}],71:[function(d,m,g){(function(w,$){(function(){function I(Ft){var $e=this;this.next=null,this.entry=null,this.finish=function(){fr($e,Ft)}}var D;m.exports=xe,xe.WritableState=pe;var q={deprecate:d("util-deprecate")},j=d("./internal/streams/stream"),G=d("buffer").Buffer,H=$.Uint8Array||function(){};function W(Ft){return G.from(Ft)}function V(Ft){return G.isBuffer(Ft)||Ft instanceof H}var K,Z=d("./internal/streams/destroy"),Q=d("./internal/streams/state").getHighWaterMark,J=d("../errors").codes,re=J.ERR_INVALID_ARG_TYPE,se=J.ERR_METHOD_NOT_IMPLEMENTED,oe=J.ERR_MULTIPLE_CALLBACK,ee=J.ERR_STREAM_CANNOT_PIPE,ae=J.ERR_STREAM_DESTROYED,ce=J.ERR_STREAM_NULL_VALUES,le=J.ERR_STREAM_WRITE_AFTER_END,de=J.ERR_UNKNOWN_ENCODING,_e=Z.errorOrDestroy;function we(){}function pe(Ft,$e,Bt){D=D||d("./_stream_duplex"),Ft=Ft||{},typeof Bt!="boolean"&&(Bt=$e instanceof D),this.objectMode=!!Ft.objectMode,Bt&&(this.objectMode=this.objectMode||!!Ft.writableObjectMode),this.highWaterMark=Q(this,Ft,"writableHighWaterMark",Bt),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Qe=Ft.decodeStrings===!1;this.decodeStrings=!Qe,this.defaultEncoding=Ft.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(st){ir($e,st)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=Ft.emitClose!==!1,this.autoDestroy=!!Ft.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new I(this)}function xe(Ft){var $e=this instanceof(D=D||d("./_stream_duplex"));if(!$e&&!K.call(xe,this))return new xe(Ft);this._writableState=new pe(Ft,this,$e),this.writable=!0,Ft&&(typeof Ft.write=="function"&&(this._write=Ft.write),typeof Ft.writev=="function"&&(this._writev=Ft.writev),typeof Ft.destroy=="function"&&(this._destroy=Ft.destroy),typeof Ft.final=="function"&&(this._final=Ft.final)),j.call(this)}function Ge(Ft,$e){var Bt=new le;_e(Ft,Bt),w.nextTick($e,Bt)}function Te(Ft,$e,Bt,Qe){var st;return Bt===null?st=new ce:typeof Bt=="string"||$e.objectMode||(st=new re("chunk",["string","Buffer"],Bt)),!st||(_e(Ft,st),w.nextTick(Qe,st),!1)}function Ce(Ft,$e,Bt){return Ft.objectMode||Ft.decodeStrings===!1||typeof $e!="string"||($e=G.from($e,Bt)),$e}function Oe(Ft,$e,Bt,Qe,st,at){if(!Bt){var pt=Ce($e,Qe,st);Qe!==pt&&(Bt=!0,st="buffer",Qe=pt)}var sr=$e.objectMode?1:Qe.length;$e.length+=sr;var Ee=$e.length<$e.highWaterMark;if(Ee||($e.needDrain=!0),$e.writing||$e.corked){var ze=$e.lastBufferedRequest;$e.lastBufferedRequest={chunk:Qe,encoding:st,isBuf:Bt,callback:at,next:null},ze?ze.next=$e.lastBufferedRequest:$e.bufferedRequest=$e.lastBufferedRequest,$e.bufferedRequestCount+=1}else bt(Ft,$e,!1,sr,Qe,st,at);return Ee}function bt(Ft,$e,Bt,Qe,st,at,pt){$e.writelen=Qe,$e.writecb=pt,$e.writing=!0,$e.sync=!0,$e.destroyed?$e.onwrite(new ae("write")):Bt?Ft._writev(st,$e.onwrite):Ft._write(st,at,$e.onwrite),$e.sync=!1}function Mt(Ft,$e,Bt,Qe,st){--$e.pendingcb,Bt?(w.nextTick(st,Qe),w.nextTick(ur,Ft,$e),Ft._writableState.errorEmitted=!0,_e(Ft,Qe)):(st(Qe),Ft._writableState.errorEmitted=!0,_e(Ft,Qe),ur(Ft,$e))}function lt(Ft){Ft.writing=!1,Ft.writecb=null,Ft.length-=Ft.writelen,Ft.writelen=0}function ir(Ft,$e){var Bt=Ft._writableState,Qe=Bt.sync,st=Bt.writecb;if(typeof st!="function")throw new oe;if(lt(Bt),$e)Mt(Ft,Bt,Qe,$e,st);else{var at=ht(Bt)||Ft.destroyed;at||Bt.corked||Bt.bufferProcessing||!Bt.bufferedRequest||ar(Ft,Bt),Qe?w.nextTick(Ye,Ft,Bt,at,st):Ye(Ft,Bt,at,st)}}function Ye(Ft,$e,Bt,Qe){Bt||xt(Ft,$e),$e.pendingcb--,Qe(),ur(Ft,$e)}function xt(Ft,$e){$e.length===0&&$e.needDrain&&($e.needDrain=!1,Ft.emit("drain"))}function ar(Ft,$e){$e.bufferProcessing=!0;var Bt=$e.bufferedRequest;if(Ft._writev&&Bt&&Bt.next){var Qe=$e.bufferedRequestCount,st=new Array(Qe),at=$e.corkedRequestsFree;at.entry=Bt;for(var pt=0,sr=!0;Bt;)st[pt]=Bt,Bt.isBuf||(sr=!1),Bt=Bt.next,pt+=1;st.allBuffers=sr,bt(Ft,$e,!0,$e.length,st,"",at.finish),$e.pendingcb++,$e.lastBufferedRequest=null,at.next?($e.corkedRequestsFree=at.next,at.next=null):$e.corkedRequestsFree=new I($e),$e.bufferedRequestCount=0}else{for(;Bt;){var Ee=Bt.chunk,ze=Bt.encoding,ct=Bt.callback;if(bt(Ft,$e,!1,$e.objectMode?1:Ee.length,Ee,ze,ct),Bt=Bt.next,$e.bufferedRequestCount--,$e.writing)break}Bt===null&&($e.lastBufferedRequest=null)}$e.bufferedRequest=Bt,$e.bufferProcessing=!1}function ht(Ft){return Ft.ending&&Ft.length===0&&Ft.bufferedRequest===null&&!Ft.finished&&!Ft.writing}function gt(Ft,$e){Ft._final((function(Bt){$e.pendingcb--,Bt&&_e(Ft,Bt),$e.prefinished=!0,Ft.emit("prefinish"),ur(Ft,$e)}))}function zt(Ft,$e){$e.prefinished||$e.finalCalled||(typeof Ft._final!="function"||$e.destroyed?($e.prefinished=!0,Ft.emit("prefinish")):($e.pendingcb++,$e.finalCalled=!0,w.nextTick(gt,Ft,$e)))}function ur(Ft,$e){var Bt=ht($e);if(Bt&&(zt(Ft,$e),$e.pendingcb===0&&($e.finished=!0,Ft.emit("finish"),$e.autoDestroy))){var Qe=Ft._readableState;(!Qe||Qe.autoDestroy&&Qe.endEmitted)&&Ft.destroy()}return Bt}function dr(Ft,$e,Bt){$e.ending=!0,ur(Ft,$e),Bt&&($e.finished?w.nextTick(Bt):Ft.once("finish",Bt)),$e.ended=!0,Ft.writable=!1}function fr(Ft,$e,Bt){var Qe=Ft.entry;for(Ft.entry=null;Qe;){var st=Qe.callback;$e.pendingcb--,st(Bt),Qe=Qe.next}$e.corkedRequestsFree.next=Ft}d("inherits")(xe,j),pe.prototype.getBuffer=function(){for(var Ft=this.bufferedRequest,$e=[];Ft;)$e.push(Ft),Ft=Ft.next;return $e},(function(){try{Object.defineProperty(pe.prototype,"buffer",{get:q.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})(),typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(K=Function.prototype[Symbol.hasInstance],Object.defineProperty(xe,Symbol.hasInstance,{value:function(Ft){return!!K.call(this,Ft)||this===xe&&Ft&&Ft._writableState instanceof pe}})):K=function(Ft){return Ft instanceof this},xe.prototype.pipe=function(){_e(this,new ee)},xe.prototype.write=function(Ft,$e,Bt){var Qe=this._writableState,st=!1,at=!Qe.objectMode&&V(Ft);return at&&!G.isBuffer(Ft)&&(Ft=W(Ft)),typeof $e=="function"&&(Bt=$e,$e=null),at?$e="buffer":$e||($e=Qe.defaultEncoding),typeof Bt!="function"&&(Bt=we),Qe.ending?Ge(this,Bt):(at||Te(this,Qe,Ft,Bt))&&(Qe.pendingcb++,st=Oe(this,Qe,at,Ft,$e,Bt)),st},xe.prototype.cork=function(){this._writableState.corked++},xe.prototype.uncork=function(){var Ft=this._writableState;Ft.corked&&(Ft.corked--,Ft.writing||Ft.corked||Ft.bufferProcessing||!Ft.bufferedRequest||ar(this,Ft))},xe.prototype.setDefaultEncoding=function(Ft){if(typeof Ft=="string"&&(Ft=Ft.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Ft+"").toLowerCase())>-1))throw new de(Ft);return this._writableState.defaultEncoding=Ft,this},Object.defineProperty(xe.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(xe.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),xe.prototype._write=function(Ft,$e,Bt){Bt(new se("_write()"))},xe.prototype._writev=null,xe.prototype.end=function(Ft,$e,Bt){var Qe=this._writableState;return typeof Ft=="function"?(Bt=Ft,Ft=null,$e=null):typeof $e=="function"&&(Bt=$e,$e=null),Ft!=null&&this.write(Ft,$e),Qe.corked&&(Qe.corked=1,this.uncork()),Qe.ending||dr(this,Qe,Bt),this},Object.defineProperty(xe.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(xe.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(Ft){this._writableState&&(this._writableState.destroyed=Ft)}}),xe.prototype.destroy=Z.destroy,xe.prototype._undestroy=Z.undestroy,xe.prototype._destroy=function(Ft,$e){$e(Ft)}}).call(this)}).call(this,d("_process"),commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":66,"./_stream_duplex":67,"./internal/streams/destroy":74,"./internal/streams/state":78,"./internal/streams/stream":79,_process:63,buffer:32,inherits:46,"util-deprecate":81}],72:[function(d,m,g){(function(w){(function(){var $;function I(ae,ce,le){return ce in ae?Object.defineProperty(ae,ce,{value:le,enumerable:!0,configurable:!0,writable:!0}):ae[ce]=le,ae}var D=d("./end-of-stream"),q=Symbol("lastResolve"),j=Symbol("lastReject"),G=Symbol("error"),H=Symbol("ended"),W=Symbol("lastPromise"),V=Symbol("handlePromise"),K=Symbol("stream");function Z(ae,ce){return{value:ae,done:ce}}function Q(ae){var ce=ae[q];if(ce!==null){var le=ae[K].read();le!==null&&(ae[W]=null,ae[q]=null,ae[j]=null,ce(Z(le,!1)))}}function J(ae){w.nextTick(Q,ae)}function re(ae,ce){return function(le,de){ae.then((function(){ce[H]?le(Z(void 0,!0)):ce[V](le,de)}),de)}}var se=Object.getPrototypeOf((function(){})),oe=Object.setPrototypeOf(($={get stream(){return this[K]},next:function(){var ae=this,ce=this[G];if(ce!==null)return Promise.reject(ce);if(this[H])return Promise.resolve(Z(void 0,!0));if(this[K].destroyed)return new Promise((function(we,pe){w.nextTick((function(){ae[G]?pe(ae[G]):we(Z(void 0,!0))}))}));var le,de=this[W];if(de)le=new Promise(re(de,this));else{var _e=this[K].read();if(_e!==null)return Promise.resolve(Z(_e,!1));le=new Promise(this[V])}return this[W]=le,le}},I($,Symbol.asyncIterator,(function(){return this})),I($,"return",(function(){var ae=this;return new Promise((function(ce,le){ae[K].destroy(null,(function(de){de?le(de):ce(Z(void 0,!0))}))}))})),$),se),ee=function(ae){var ce,le=Object.create(oe,(I(ce={},K,{value:ae,writable:!0}),I(ce,q,{value:null,writable:!0}),I(ce,j,{value:null,writable:!0}),I(ce,G,{value:null,writable:!0}),I(ce,H,{value:ae._readableState.endEmitted,writable:!0}),I(ce,V,{value:function(de,_e){var we=le[K].read();we?(le[W]=null,le[q]=null,le[j]=null,de(Z(we,!1))):(le[q]=de,le[j]=_e)},writable:!0}),ce));return le[W]=null,D(ae,(function(de){if(de&&de.code!=="ERR_STREAM_PREMATURE_CLOSE"){var _e=le[j];return _e!==null&&(le[W]=null,le[q]=null,le[j]=null,_e(de)),void(le[G]=de)}var we=le[q];we!==null&&(le[W]=null,le[q]=null,le[j]=null,we(Z(void 0,!0))),le[H]=!0})),ae.on("readable",J.bind(null,le)),le};m.exports=ee}).call(this)}).call(this,d("_process"))},{"./end-of-stream":75,_process:63}],73:[function(d,m,g){function w(K,Z){var Q=Object.keys(K);if(Object.getOwnPropertySymbols){var J=Object.getOwnPropertySymbols(K);Z&&(J=J.filter((function(re){return Object.getOwnPropertyDescriptor(K,re).enumerable}))),Q.push.apply(Q,J)}return Q}function $(K){for(var Z=1;Z<arguments.length;Z++){var Q=arguments[Z]!=null?arguments[Z]:{};Z%2?w(Object(Q),!0).forEach((function(J){I(K,J,Q[J])})):Object.getOwnPropertyDescriptors?Object.defineProperties(K,Object.getOwnPropertyDescriptors(Q)):w(Object(Q)).forEach((function(J){Object.defineProperty(K,J,Object.getOwnPropertyDescriptor(Q,J))}))}return K}function I(K,Z,Q){return Z in K?Object.defineProperty(K,Z,{value:Q,enumerable:!0,configurable:!0,writable:!0}):K[Z]=Q,K}function D(K,Z){if(!(K instanceof Z))throw new TypeError("Cannot call a class as a function")}function q(K,Z){for(var Q=0;Q<Z.length;Q++){var J=Z[Q];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(K,J.key,J)}}function j(K,Z,Q){return Z&&q(K.prototype,Z),K}var G=d("buffer").Buffer,H=d("util").inspect,W=H&&H.custom||"inspect";function V(K,Z,Q){G.prototype.copy.call(K,Z,Q)}m.exports=(function(){function K(){D(this,K),this.head=null,this.tail=null,this.length=0}return j(K,[{key:"push",value:function(Z){var Q={data:Z,next:null};this.length>0?this.tail.next=Q:this.head=Q,this.tail=Q,++this.length}},{key:"unshift",value:function(Z){var Q={data:Z,next:this.head};this.length===0&&(this.tail=Q),this.head=Q,++this.length}},{key:"shift",value:function(){if(this.length!==0){var Z=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,Z}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(Z){if(this.length===0)return"";for(var Q=this.head,J=""+Q.data;Q=Q.next;)J+=Z+Q.data;return J}},{key:"concat",value:function(Z){if(this.length===0)return G.alloc(0);for(var Q=G.allocUnsafe(Z>>>0),J=this.head,re=0;J;)V(J.data,Q,re),re+=J.data.length,J=J.next;return Q}},{key:"consume",value:function(Z,Q){var J;return Z<this.head.data.length?(J=this.head.data.slice(0,Z),this.head.data=this.head.data.slice(Z)):J=Z===this.head.data.length?this.shift():Q?this._getString(Z):this._getBuffer(Z),J}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(Z){var Q=this.head,J=1,re=Q.data;for(Z-=re.length;Q=Q.next;){var se=Q.data,oe=Z>se.length?se.length:Z;if(oe===se.length?re+=se:re+=se.slice(0,Z),(Z-=oe)==0){oe===se.length?(++J,Q.next?this.head=Q.next:this.head=this.tail=null):(this.head=Q,Q.data=se.slice(oe));break}++J}return this.length-=J,re}},{key:"_getBuffer",value:function(Z){var Q=G.allocUnsafe(Z),J=this.head,re=1;for(J.data.copy(Q),Z-=J.data.length;J=J.next;){var se=J.data,oe=Z>se.length?se.length:Z;if(se.copy(Q,Q.length-Z,0,oe),(Z-=oe)==0){oe===se.length?(++re,J.next?this.head=J.next:this.head=this.tail=null):(this.head=J,J.data=se.slice(oe));break}++re}return this.length-=re,Q}},{key:W,value:function(Z,Q){return H(this,$({},Q,{depth:0,customInspect:!1}))}}]),K})()},{buffer:32,util:29}],74:[function(d,m,g){(function(w){(function(){function $(H,W){var V=this,K=this._readableState&&this._readableState.destroyed,Z=this._writableState&&this._writableState.destroyed;return K||Z?(W?W(H):H&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,w.nextTick(j,this,H)):w.nextTick(j,this,H)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(H||null,(function(Q){!W&&Q?V._writableState?V._writableState.errorEmitted?w.nextTick(D,V):(V._writableState.errorEmitted=!0,w.nextTick(I,V,Q)):w.nextTick(I,V,Q):W?(w.nextTick(D,V),W(Q)):w.nextTick(D,V)})),this)}function I(H,W){j(H,W),D(H)}function D(H){H._writableState&&!H._writableState.emitClose||H._readableState&&!H._readableState.emitClose||H.emit("close")}function q(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function j(H,W){H.emit("error",W)}function G(H,W){var V=H._readableState,K=H._writableState;V&&V.autoDestroy||K&&K.autoDestroy?H.destroy(W):H.emit("error",W)}m.exports={destroy:$,undestroy:q,errorOrDestroy:G}}).call(this)}).call(this,d("_process"))},{_process:63}],75:[function(d,m,g){var w=d("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function $(j){var G=!1;return function(){if(!G){G=!0;for(var H=arguments.length,W=new Array(H),V=0;V<H;V++)W[V]=arguments[V];j.apply(this,W)}}}function I(){}function D(j){return j.setHeader&&typeof j.abort=="function"}function q(j,G,H){if(typeof G=="function")return q(j,null,G);G||(G={}),H=$(H||I);var W=G.readable||G.readable!==!1&&j.readable,V=G.writable||G.writable!==!1&&j.writable,K=function(){j.writable||Q()},Z=j._writableState&&j._writableState.finished,Q=function(){V=!1,Z=!0,W||H.call(j)},J=j._readableState&&j._readableState.endEmitted,re=function(){W=!1,J=!0,V||H.call(j)},se=function(ae){H.call(j,ae)},oe=function(){var ae;return W&&!J?(j._readableState&&j._readableState.ended||(ae=new w),H.call(j,ae)):V&&!Z?(j._writableState&&j._writableState.ended||(ae=new w),H.call(j,ae)):void 0},ee=function(){j.req.on("finish",Q)};return D(j)?(j.on("complete",Q),j.on("abort",oe),j.req?ee():j.on("request",ee)):V&&!j._writableState&&(j.on("end",K),j.on("close",K)),j.on("end",re),j.on("finish",Q),G.error!==!1&&j.on("error",se),j.on("close",oe),function(){j.removeListener("complete",Q),j.removeListener("abort",oe),j.removeListener("request",ee),j.req&&j.req.removeListener("finish",Q),j.removeListener("end",K),j.removeListener("close",K),j.removeListener("finish",Q),j.removeListener("end",re),j.removeListener("error",se),j.removeListener("close",oe)}}m.exports=q},{"../../../errors":66}],76:[function(d,m,g){m.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],77:[function(d,m,g){var w;function $(Q){var J=!1;return function(){J||(J=!0,Q.apply(void 0,arguments))}}var I=d("../../../errors").codes,D=I.ERR_MISSING_ARGS,q=I.ERR_STREAM_DESTROYED;function j(Q){if(Q)throw Q}function G(Q){return Q.setHeader&&typeof Q.abort=="function"}function H(Q,J,re,se){se=$(se);var oe=!1;Q.on("close",(function(){oe=!0})),w===void 0&&(w=d("./end-of-stream")),w(Q,{readable:J,writable:re},(function(ae){if(ae)return se(ae);oe=!0,se()}));var ee=!1;return function(ae){if(!oe&&!ee)return ee=!0,G(Q)?Q.abort():typeof Q.destroy=="function"?Q.destroy():void se(ae||new q("pipe"))}}function W(Q){Q()}function V(Q,J){return Q.pipe(J)}function K(Q){return Q.length?typeof Q[Q.length-1]!="function"?j:Q.pop():j}function Z(){for(var Q=arguments.length,J=new Array(Q),re=0;re<Q;re++)J[re]=arguments[re];var se,oe=K(J);if(Array.isArray(J[0])&&(J=J[0]),J.length<2)throw new D("streams");var ee=J.map((function(ae,ce){var le=ce<J.length-1;return H(ae,le,ce>0,(function(de){se||(se=de),de&&ee.forEach(W),le||(ee.forEach(W),oe(se))}))}));return J.reduce(V)}m.exports=Z},{"../../../errors":66,"./end-of-stream":75}],78:[function(d,m,g){var w=d("../../../errors").codes.ERR_INVALID_OPT_VALUE;function $(D,q,j){return D.highWaterMark!=null?D.highWaterMark:q?D[j]:null}function I(D,q,j,G){var H=$(q,G,j);if(H!=null){if(!isFinite(H)||Math.floor(H)!==H||H<0)throw new w(G?j:"highWaterMark",H);return Math.floor(H)}return D.objectMode?16:16384}m.exports={getHighWaterMark:I}},{"../../../errors":66}],79:[function(d,m,g){m.exports=d("events").EventEmitter},{events:35}],80:[function(d,m,g){var w=d("safe-buffer").Buffer,$=w.isEncoding||function(ee){switch((ee=""+ee)&&ee.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function I(ee){if(!ee)return"utf8";for(var ae;;)switch(ee){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return ee;default:if(ae)return;ee=(""+ee).toLowerCase(),ae=!0}}function D(ee){var ae=I(ee);if(typeof ae!="string"&&(w.isEncoding===$||!$(ee)))throw new Error("Unknown encoding: "+ee);return ae||ee}function q(ee){var ae;switch(this.encoding=D(ee),this.encoding){case"utf16le":this.text=Z,this.end=Q,ae=4;break;case"utf8":this.fillLast=W,ae=4;break;case"base64":this.text=J,this.end=re,ae=3;break;default:return this.write=se,void(this.end=oe)}this.lastNeed=0,this.lastTotal=0,this.lastChar=w.allocUnsafe(ae)}function j(ee){return ee<=127?0:ee>>5==6?2:ee>>4==14?3:ee>>3==30?4:ee>>6==2?-1:-2}function G(ee,ae,ce){var le=ae.length-1;if(le<ce)return 0;var de=j(ae[le]);return de>=0?(de>0&&(ee.lastNeed=de-1),de):--le<ce||de===-2?0:(de=j(ae[le]))>=0?(de>0&&(ee.lastNeed=de-2),de):--le<ce||de===-2?0:(de=j(ae[le]))>=0?(de>0&&(de===2?de=0:ee.lastNeed=de-3),de):0}function H(ee,ae,ce){if((192&ae[0])!=128)return ee.lastNeed=0,"ï¿½";if(ee.lastNeed>1&&ae.length>1){if((192&ae[1])!=128)return ee.lastNeed=1,"ï¿½";if(ee.lastNeed>2&&ae.length>2&&(192&ae[2])!=128)return ee.lastNeed=2,"ï¿½"}}function W(ee){var ae=this.lastTotal-this.lastNeed,ce=H(this,ee);return ce!==void 0?ce:this.lastNeed<=ee.length?(ee.copy(this.lastChar,ae,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(ee.copy(this.lastChar,ae,0,ee.length),void(this.lastNeed-=ee.length))}function V(ee,ae){var ce=G(this,ee,ae);if(!this.lastNeed)return ee.toString("utf8",ae);this.lastTotal=ce;var le=ee.length-(ce-this.lastNeed);return ee.copy(this.lastChar,0,le),ee.toString("utf8",ae,le)}function K(ee){var ae=ee&&ee.length?this.write(ee):"";return this.lastNeed?ae+"ï¿½":ae}function Z(ee,ae){if((ee.length-ae)%2==0){var ce=ee.toString("utf16le",ae);if(ce){var le=ce.charCodeAt(ce.length-1);if(le>=55296&&le<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=ee[ee.length-2],this.lastChar[1]=ee[ee.length-1],ce.slice(0,-1)}return ce}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=ee[ee.length-1],ee.toString("utf16le",ae,ee.length-1)}function Q(ee){var ae=ee&&ee.length?this.write(ee):"";if(this.lastNeed){var ce=this.lastTotal-this.lastNeed;return ae+this.lastChar.toString("utf16le",0,ce)}return ae}function J(ee,ae){var ce=(ee.length-ae)%3;return ce===0?ee.toString("base64",ae):(this.lastNeed=3-ce,this.lastTotal=3,ce===1?this.lastChar[0]=ee[ee.length-1]:(this.lastChar[0]=ee[ee.length-2],this.lastChar[1]=ee[ee.length-1]),ee.toString("base64",ae,ee.length-ce))}function re(ee){var ae=ee&&ee.length?this.write(ee):"";return this.lastNeed?ae+this.lastChar.toString("base64",0,3-this.lastNeed):ae}function se(ee){return ee.toString(this.encoding)}function oe(ee){return ee&&ee.length?this.write(ee):""}g.StringDecoder=q,q.prototype.write=function(ee){if(ee.length===0)return"";var ae,ce;if(this.lastNeed){if((ae=this.fillLast(ee))===void 0)return"";ce=this.lastNeed,this.lastNeed=0}else ce=0;return ce<ee.length?ae?ae+this.text(ee,ce):this.text(ee,ce):ae||""},q.prototype.end=K,q.prototype.text=V,q.prototype.fillLast=function(ee){if(this.lastNeed<=ee.length)return ee.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);ee.copy(this.lastChar,this.lastTotal-this.lastNeed,0,ee.length),this.lastNeed-=ee.length}},{"safe-buffer":64}],81:[function(d,m,g){(function(w){(function(){function $(D,q){if(I("noDeprecation"))return D;var j=!1;function G(){if(!j){if(I("throwDeprecation"))throw new Error(q);I("traceDeprecation")?console.trace(q):console.warn(q),j=!0}return D.apply(this,arguments)}return G}function I(D){try{if(!w.localStorage)return!1}catch{return!1}var q=w.localStorage[D];return q!=null&&String(q).toLowerCase()==="true"}m.exports=$}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],82:[function(d,m,g){arguments[4][25][0].apply(g,arguments)},{dup:25}],83:[function(d,m,g){var w=d("is-arguments"),$=d("is-generator-function"),I=d("which-typed-array"),D=d("is-typed-array");function q(ft){return ft.call.bind(ft)}var j=typeof BigInt<"u",G=typeof Symbol<"u",H=q(Object.prototype.toString),W=q(Number.prototype.valueOf),V=q(String.prototype.valueOf),K=q(Boolean.prototype.valueOf);if(j)var Z=q(BigInt.prototype.valueOf);if(G)var Q=q(Symbol.prototype.valueOf);function J(ft,pr){if(typeof ft!="object")return!1;try{return pr(ft),!0}catch{return!1}}function re(ft){return typeof Promise<"u"&&ft instanceof Promise||ft!==null&&typeof ft=="object"&&typeof ft.then=="function"&&typeof ft.catch=="function"}function se(ft){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(ft):D(ft)||gt(ft)}function oe(ft){return I(ft)==="Uint8Array"}function ee(ft){return I(ft)==="Uint8ClampedArray"}function ae(ft){return I(ft)==="Uint16Array"}function ce(ft){return I(ft)==="Uint32Array"}function le(ft){return I(ft)==="Int8Array"}function de(ft){return I(ft)==="Int16Array"}function _e(ft){return I(ft)==="Int32Array"}function we(ft){return I(ft)==="Float32Array"}function pe(ft){return I(ft)==="Float64Array"}function xe(ft){return I(ft)==="BigInt64Array"}function Ge(ft){return I(ft)==="BigUint64Array"}function Te(ft){return H(ft)==="[object Map]"}function Ce(ft){return typeof Map<"u"&&(Te.working?Te(ft):ft instanceof Map)}function Oe(ft){return H(ft)==="[object Set]"}function bt(ft){return typeof Set<"u"&&(Oe.working?Oe(ft):ft instanceof Set)}function Mt(ft){return H(ft)==="[object WeakMap]"}function lt(ft){return typeof WeakMap<"u"&&(Mt.working?Mt(ft):ft instanceof WeakMap)}function ir(ft){return H(ft)==="[object WeakSet]"}function Ye(ft){return ir(ft)}function xt(ft){return H(ft)==="[object ArrayBuffer]"}function ar(ft){return typeof ArrayBuffer<"u"&&(xt.working?xt(ft):ft instanceof ArrayBuffer)}function ht(ft){return H(ft)==="[object DataView]"}function gt(ft){return typeof DataView<"u"&&(ht.working?ht(ft):ft instanceof DataView)}g.isArgumentsObject=w,g.isGeneratorFunction=$,g.isTypedArray=D,g.isPromise=re,g.isArrayBufferView=se,g.isUint8Array=oe,g.isUint8ClampedArray=ee,g.isUint16Array=ae,g.isUint32Array=ce,g.isInt8Array=le,g.isInt16Array=de,g.isInt32Array=_e,g.isFloat32Array=we,g.isFloat64Array=pe,g.isBigInt64Array=xe,g.isBigUint64Array=Ge,Te.working=typeof Map<"u"&&Te(new Map),g.isMap=Ce,Oe.working=typeof Set<"u"&&Oe(new Set),g.isSet=bt,Mt.working=typeof WeakMap<"u"&&Mt(new WeakMap),g.isWeakMap=lt,ir.working=typeof WeakSet<"u"&&ir(new WeakSet),g.isWeakSet=Ye,xt.working=typeof ArrayBuffer<"u"&&xt(new ArrayBuffer),g.isArrayBuffer=ar,ht.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&ht(new DataView(new ArrayBuffer(1),0,1)),g.isDataView=gt;var zt=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function ur(ft){return H(ft)==="[object SharedArrayBuffer]"}function dr(ft){return zt!==void 0&&(ur.working===void 0&&(ur.working=ur(new zt)),ur.working?ur(ft):ft instanceof zt)}function fr(ft){return H(ft)==="[object AsyncFunction]"}function Ft(ft){return H(ft)==="[object Map Iterator]"}function $e(ft){return H(ft)==="[object Set Iterator]"}function Bt(ft){return H(ft)==="[object Generator]"}function Qe(ft){return H(ft)==="[object WebAssembly.Module]"}function st(ft){return J(ft,W)}function at(ft){return J(ft,V)}function pt(ft){return J(ft,K)}function sr(ft){return j&&J(ft,Z)}function Ee(ft){return G&&J(ft,Q)}function ze(ft){return st(ft)||at(ft)||pt(ft)||sr(ft)||Ee(ft)}function ct(ft){return typeof Uint8Array<"u"&&(ar(ft)||dr(ft))}g.isSharedArrayBuffer=dr,g.isAsyncFunction=fr,g.isMapIterator=Ft,g.isSetIterator=$e,g.isGeneratorObject=Bt,g.isWebAssemblyCompiledModule=Qe,g.isNumberObject=st,g.isStringObject=at,g.isBooleanObject=pt,g.isBigIntObject=sr,g.isSymbolObject=Ee,g.isBoxedPrimitive=ze,g.isAnyArrayBuffer=ct,["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(ft){Object.defineProperty(g,ft,{enumerable:!1,value:function(){throw new Error(ft+" is not supported in userland")}})}))},{"is-arguments":47,"is-generator-function":49,"is-typed-array":50,"which-typed-array":85}],84:[function(d,m,g){(function(w){(function(){var $=Object.getOwnPropertyDescriptors||function(gt){for(var zt=Object.keys(gt),ur={},dr=0;dr<zt.length;dr++)ur[zt[dr]]=Object.getOwnPropertyDescriptor(gt,zt[dr]);return ur},I=/%[sdj%]/g;g.format=function(gt){if(!de(gt)){for(var zt=[],ur=0;ur<arguments.length;ur++)zt.push(G(arguments[ur]));return zt.join(" ")}ur=1;for(var dr=arguments,fr=dr.length,Ft=String(gt).replace(I,(function(Bt){if(Bt==="%%")return"%";if(ur>=fr)return Bt;switch(Bt){case"%s":return String(dr[ur++]);case"%d":return Number(dr[ur++]);case"%j":try{return JSON.stringify(dr[ur++])}catch{return"[Circular]"}default:return Bt}})),$e=dr[ur];ur<fr;$e=dr[++ur])ae($e)||!xe($e)?Ft+=" "+$e:Ft+=" "+G($e);return Ft},g.deprecate=function(gt,zt){if(w!==void 0&&w.noDeprecation===!0)return gt;if(w===void 0)return function(){return g.deprecate(gt,zt).apply(this,arguments)};var ur=!1;function dr(){if(!ur){if(w.throwDeprecation)throw new Error(zt);w.traceDeprecation?console.trace(zt):console.error(zt),ur=!0}return gt.apply(this,arguments)}return dr};var D={},q=/^$/;if(w.env.NODE_DEBUG){var j=w.env.NODE_DEBUG;j=j.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),q=new RegExp("^"+j+"$","i")}function G(gt,zt){var ur={seen:[],stylize:W};return arguments.length>=3&&(ur.depth=arguments[2]),arguments.length>=4&&(ur.colors=arguments[3]),ee(zt)?ur.showHidden=zt:zt&&g._extend(ur,zt),we(ur.showHidden)&&(ur.showHidden=!1),we(ur.depth)&&(ur.depth=2),we(ur.colors)&&(ur.colors=!1),we(ur.customInspect)&&(ur.customInspect=!0),ur.colors&&(ur.stylize=H),K(ur,gt,ur.depth)}function H(gt,zt){var ur=G.styles[zt];return ur?"\x1B["+G.colors[ur][0]+"m"+gt+"\x1B["+G.colors[ur][1]+"m":gt}function W(gt,zt){return gt}function V(gt){var zt={};return gt.forEach((function(ur,dr){zt[ur]=!0})),zt}function K(gt,zt,ur){if(gt.customInspect&&zt&&Ce(zt.inspect)&&zt.inspect!==g.inspect&&(!zt.constructor||zt.constructor.prototype!==zt)){var dr=zt.inspect(ur,gt);return de(dr)||(dr=K(gt,dr,ur)),dr}var fr=Z(gt,zt);if(fr)return fr;var Ft=Object.keys(zt),$e=V(Ft);if(gt.showHidden&&(Ft=Object.getOwnPropertyNames(zt)),Te(zt)&&(Ft.indexOf("message")>=0||Ft.indexOf("description")>=0))return Q(zt);if(Ft.length===0){if(Ce(zt)){var Bt=zt.name?": "+zt.name:"";return gt.stylize("[Function"+Bt+"]","special")}if(pe(zt))return gt.stylize(RegExp.prototype.toString.call(zt),"regexp");if(Ge(zt))return gt.stylize(Date.prototype.toString.call(zt),"date");if(Te(zt))return Q(zt)}var Qe,st="",at=!1,pt=["{","}"];return oe(zt)&&(at=!0,pt=["[","]"]),Ce(zt)&&(st=" [Function"+(zt.name?": "+zt.name:"")+"]"),pe(zt)&&(st=" "+RegExp.prototype.toString.call(zt)),Ge(zt)&&(st=" "+Date.prototype.toUTCString.call(zt)),Te(zt)&&(st=" "+Q(zt)),Ft.length!==0||at&&zt.length!=0?ur<0?pe(zt)?gt.stylize(RegExp.prototype.toString.call(zt),"regexp"):gt.stylize("[Object]","special"):(gt.seen.push(zt),Qe=at?J(gt,zt,ur,$e,Ft):Ft.map((function(sr){return re(gt,zt,ur,$e,sr,at)})),gt.seen.pop(),se(Qe,st,pt)):pt[0]+st+pt[1]}function Z(gt,zt){if(we(zt))return gt.stylize("undefined","undefined");if(de(zt)){var ur="'"+JSON.stringify(zt).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return gt.stylize(ur,"string")}return le(zt)?gt.stylize(""+zt,"number"):ee(zt)?gt.stylize(""+zt,"boolean"):ae(zt)?gt.stylize("null","null"):void 0}function Q(gt){return"["+Error.prototype.toString.call(gt)+"]"}function J(gt,zt,ur,dr,fr){for(var Ft=[],$e=0,Bt=zt.length;$e<Bt;++$e)Ye(zt,String($e))?Ft.push(re(gt,zt,ur,dr,String($e),!0)):Ft.push("");return fr.forEach((function(Qe){Qe.match(/^\d+$/)||Ft.push(re(gt,zt,ur,dr,Qe,!0))})),Ft}function re(gt,zt,ur,dr,fr,Ft){var $e,Bt,Qe;if((Qe=Object.getOwnPropertyDescriptor(zt,fr)||{value:zt[fr]}).get?Bt=Qe.set?gt.stylize("[Getter/Setter]","special"):gt.stylize("[Getter]","special"):Qe.set&&(Bt=gt.stylize("[Setter]","special")),Ye(dr,fr)||($e="["+fr+"]"),Bt||(gt.seen.indexOf(Qe.value)<0?(Bt=ae(ur)?K(gt,Qe.value,null):K(gt,Qe.value,ur-1)).indexOf(`
`)>-1&&(Bt=Ft?Bt.split(`
`).map((function(st){return"  "+st})).join(`
`).slice(2):`
`+Bt.split(`
`).map((function(st){return"   "+st})).join(`
`)):Bt=gt.stylize("[Circular]","special")),we($e)){if(Ft&&fr.match(/^\d+$/))return Bt;($e=JSON.stringify(""+fr)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?($e=$e.slice(1,-1),$e=gt.stylize($e,"name")):($e=$e.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),$e=gt.stylize($e,"string"))}return $e+": "+Bt}function se(gt,zt,ur){return gt.reduce((function(dr,fr){return fr.indexOf(`
`),dr+fr.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?ur[0]+(zt===""?"":zt+`
 `)+" "+gt.join(`,
  `)+" "+ur[1]:ur[0]+zt+" "+gt.join(", ")+" "+ur[1]}function oe(gt){return Array.isArray(gt)}function ee(gt){return typeof gt=="boolean"}function ae(gt){return gt===null}function ce(gt){return gt==null}function le(gt){return typeof gt=="number"}function de(gt){return typeof gt=="string"}function _e(gt){return typeof gt=="symbol"}function we(gt){return gt===void 0}function pe(gt){return xe(gt)&&bt(gt)==="[object RegExp]"}function xe(gt){return typeof gt=="object"&&gt!==null}function Ge(gt){return xe(gt)&&bt(gt)==="[object Date]"}function Te(gt){return xe(gt)&&(bt(gt)==="[object Error]"||gt instanceof Error)}function Ce(gt){return typeof gt=="function"}function Oe(gt){return gt===null||typeof gt=="boolean"||typeof gt=="number"||typeof gt=="string"||typeof gt=="symbol"||gt===void 0}function bt(gt){return Object.prototype.toString.call(gt)}function Mt(gt){return gt<10?"0"+gt.toString(10):gt.toString(10)}g.debuglog=function(gt){if(gt=gt.toUpperCase(),!D[gt])if(q.test(gt)){var zt=w.pid;D[gt]=function(){var ur=g.format.apply(g,arguments);console.error("%s %d: %s",gt,zt,ur)}}else D[gt]=function(){};return D[gt]},g.inspect=G,G.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},G.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},g.types=d("./support/types"),g.isArray=oe,g.isBoolean=ee,g.isNull=ae,g.isNullOrUndefined=ce,g.isNumber=le,g.isString=de,g.isSymbol=_e,g.isUndefined=we,g.isRegExp=pe,g.types.isRegExp=pe,g.isObject=xe,g.isDate=Ge,g.types.isDate=Ge,g.isError=Te,g.types.isNativeError=Te,g.isFunction=Ce,g.isPrimitive=Oe,g.isBuffer=d("./support/isBuffer");var lt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ir(){var gt=new Date,zt=[Mt(gt.getHours()),Mt(gt.getMinutes()),Mt(gt.getSeconds())].join(":");return[gt.getDate(),lt[gt.getMonth()],zt].join(" ")}function Ye(gt,zt){return Object.prototype.hasOwnProperty.call(gt,zt)}g.log=function(){console.log("%s - %s",ir(),g.format.apply(g,arguments))},g.inherits=d("inherits"),g._extend=function(gt,zt){if(!zt||!xe(zt))return gt;for(var ur=Object.keys(zt),dr=ur.length;dr--;)gt[ur[dr]]=zt[ur[dr]];return gt};var xt=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;function ar(gt,zt){if(!gt){var ur=new Error("Promise was rejected with a falsy value");ur.reason=gt,gt=ur}return zt(gt)}function ht(gt){if(typeof gt!="function")throw new TypeError('The "original" argument must be of type Function');function zt(){for(var ur=[],dr=0;dr<arguments.length;dr++)ur.push(arguments[dr]);var fr=ur.pop();if(typeof fr!="function")throw new TypeError("The last argument must be of type Function");var Ft=this,$e=function(){return fr.apply(Ft,arguments)};gt.apply(this,ur).then((function(Bt){w.nextTick($e.bind(null,null,Bt))}),(function(Bt){w.nextTick(ar.bind(null,Bt,$e))}))}return Object.setPrototypeOf(zt,Object.getPrototypeOf(gt)),Object.defineProperties(zt,$(gt)),zt}g.promisify=function(gt){if(typeof gt!="function")throw new TypeError('The "original" argument must be of type Function');if(xt&&gt[xt]){var zt;if(typeof(zt=gt[xt])!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(zt,xt,{value:zt,enumerable:!1,writable:!1,configurable:!0}),zt}function zt(){for(var ur,dr,fr=new Promise((function(Bt,Qe){ur=Bt,dr=Qe})),Ft=[],$e=0;$e<arguments.length;$e++)Ft.push(arguments[$e]);Ft.push((function(Bt,Qe){Bt?dr(Bt):ur(Qe)}));try{gt.apply(this,Ft)}catch(Bt){dr(Bt)}return fr}return Object.setPrototypeOf(zt,Object.getPrototypeOf(gt)),xt&&Object.defineProperty(zt,xt,{value:zt,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(zt,$(gt))},g.promisify.custom=xt,g.callbackify=ht}).call(this)}).call(this,d("_process"))},{"./support/isBuffer":82,"./support/types":83,_process:63,inherits:46}],85:[function(d,m,g){(function(w){(function(){var $=d("for-each"),I=d("available-typed-arrays"),D=d("call-bind/callBound"),q=d("gopd"),j=D("Object.prototype.toString"),G=d("has-tostringtag/shams")(),H=typeof globalThis>"u"?w:globalThis,W=I(),V=D("String.prototype.slice"),K={},Z=Object.getPrototypeOf;G&&q&&Z&&$(W,(function(re){if(typeof H[re]=="function"){var se=new H[re];if(Symbol.toStringTag in se){var oe=Z(se),ee=q(oe,Symbol.toStringTag);if(!ee){var ae=Z(oe);ee=q(ae,Symbol.toStringTag)}K[re]=ee.get}}}));var Q=function(re){var se=!1;return $(K,(function(oe,ee){if(!se)try{var ae=oe.call(re);ae===ee&&(se=ae)}catch{}})),se},J=d("is-typed-array");m.exports=function(re){return!!J(re)&&(G&&Symbol.toStringTag in re?Q(re):V(j(re),8,-1))}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":27,"call-bind/callBound":33,"for-each":36,gopd:40,"has-tostringtag/shams":43,"is-typed-array":50}]},{},[20])(20);var browserExports=browser$1.exports,PNGFilterType,PNGFilterType2,PNGColorType,PNGColorType2;function png(){return{mime:"image/png",hasAlpha:!0,encode:(d,{deflateLevel:m=9,deflateStrategy:g=3,filterType:w=PNGFilterType.AUTO,colorType:$,inputHasAlpha:I=!0,...D}={})=>{const q=new browserExports.PNG({width:d.width,height:d.height});return q.data=d.data,browserExports.PNG.sync.write(q,{...D,deflateLevel:m,deflateStrategy:g,filterType:w,colorType:$!==void 0?$:I?PNGColorType.COLOR_ALPHA:PNGColorType.COLOR,inputHasAlpha:I})},decode:(d,m)=>{const g=browserExports.PNG.sync.read(d,m);return{data:g.data,width:g.width,height:g.height}}}}PNGFilterType2=PNGFilterType||(PNGFilterType={}),PNGFilterType2[PNGFilterType2.AUTO=-1]="AUTO",PNGFilterType2[PNGFilterType2.NONE=0]="NONE",PNGFilterType2[PNGFilterType2.SUB=1]="SUB",PNGFilterType2[PNGFilterType2.UP=2]="UP",PNGFilterType2[PNGFilterType2.AVERAGE=3]="AVERAGE",PNGFilterType2[PNGFilterType2.PATH=4]="PATH",PNGColorType2=PNGColorType||(PNGColorType={}),PNGColorType2[PNGColorType2.GRAYSCALE=0]="GRAYSCALE",PNGColorType2[PNGColorType2.COLOR=2]="COLOR",PNGColorType2[PNGColorType2.GRAYSCALE_ALPHA=4]="GRAYSCALE_ALPHA",PNGColorType2[PNGColorType2.COLOR_ALPHA=6]="COLOR_ALPHA";var UTIF={exports:{}},common={},hasRequiredCommon;function requireCommon(){return hasRequiredCommon||(hasRequiredCommon=1,(function(d){var m=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function g(I,D){return Object.prototype.hasOwnProperty.call(I,D)}d.assign=function(I){for(var D=Array.prototype.slice.call(arguments,1);D.length;){var q=D.shift();if(q){if(typeof q!="object")throw new TypeError(q+"must be non-object");for(var j in q)g(q,j)&&(I[j]=q[j])}}return I},d.shrinkBuf=function(I,D){return I.length===D?I:I.subarray?I.subarray(0,D):(I.length=D,I)};var w={arraySet:function(I,D,q,j,G){if(D.subarray&&I.subarray)I.set(D.subarray(q,q+j),G);else for(var H=0;H<j;H++)I[G+H]=D[q+H]},flattenChunks:function(I){var D,q,j,G,H,W;for(j=0,D=0,q=I.length;D<q;D++)j+=I[D].length;for(W=new Uint8Array(j),G=0,D=0,q=I.length;D<q;D++)H=I[D],W.set(H,G),G+=H.length;return W}},$={arraySet:function(I,D,q,j,G){for(var H=0;H<j;H++)I[G+H]=D[q+H]},flattenChunks:function(I){return[].concat.apply([],I)}};d.setTyped=function(I){I?(d.Buf8=Uint8Array,d.Buf16=Uint16Array,d.Buf32=Int32Array,d.assign(d,w)):(d.Buf8=Array,d.Buf16=Array,d.Buf32=Array,d.assign(d,$))},d.setTyped(m)})(common)),common}var deflate$1={},deflate={},trees={},hasRequiredTrees,adler32_1,hasRequiredAdler32,crc32_1,hasRequiredCrc32,messages,hasRequiredMessages,hasRequiredDeflate$1;function requireTrees(){if(hasRequiredTrees)return trees;hasRequiredTrees=1;var d=requireCommon(),m=0,g=1;function w(Qe){for(var st=Qe.length;--st>=0;)Qe[st]=0}var $=0,I=29,D=256,q=D+1+I,j=30,G=19,H=2*q+1,W=15,V=16,K=7,Z=256,Q=16,J=17,re=18,se=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],oe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ee=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ce=new Array(2*(q+2));w(ce);var le=new Array(2*j);w(le);var de=new Array(512);w(de);var _e=new Array(256);w(_e);var we=new Array(I);w(we);var pe,xe,Ge,Te=new Array(j);function Ce(Qe,st,at,pt,sr){this.static_tree=Qe,this.extra_bits=st,this.extra_base=at,this.elems=pt,this.max_length=sr,this.has_stree=Qe&&Qe.length}function Oe(Qe,st){this.dyn_tree=Qe,this.max_code=0,this.stat_desc=st}function bt(Qe){return Qe<256?de[Qe]:de[256+(Qe>>>7)]}function Mt(Qe,st){Qe.pending_buf[Qe.pending++]=255&st,Qe.pending_buf[Qe.pending++]=st>>>8&255}function lt(Qe,st,at){Qe.bi_valid>V-at?(Qe.bi_buf|=st<<Qe.bi_valid&65535,Mt(Qe,Qe.bi_buf),Qe.bi_buf=st>>V-Qe.bi_valid,Qe.bi_valid+=at-V):(Qe.bi_buf|=st<<Qe.bi_valid&65535,Qe.bi_valid+=at)}function ir(Qe,st,at){lt(Qe,at[2*st],at[2*st+1])}function Ye(Qe,st){var at=0;do at|=1&Qe,Qe>>>=1,at<<=1;while(--st>0);return at>>>1}function xt(Qe,st,at){var pt,sr,Ee=new Array(W+1),ze=0;for(pt=1;pt<=W;pt++)Ee[pt]=ze=ze+at[pt-1]<<1;for(sr=0;sr<=st;sr++){var ct=Qe[2*sr+1];ct!==0&&(Qe[2*sr]=Ye(Ee[ct]++,ct))}}function ar(Qe){var st;for(st=0;st<q;st++)Qe.dyn_ltree[2*st]=0;for(st=0;st<j;st++)Qe.dyn_dtree[2*st]=0;for(st=0;st<G;st++)Qe.bl_tree[2*st]=0;Qe.dyn_ltree[2*Z]=1,Qe.opt_len=Qe.static_len=0,Qe.last_lit=Qe.matches=0}function ht(Qe){Qe.bi_valid>8?Mt(Qe,Qe.bi_buf):Qe.bi_valid>0&&(Qe.pending_buf[Qe.pending++]=Qe.bi_buf),Qe.bi_buf=0,Qe.bi_valid=0}function gt(Qe,st,at,pt){var sr=2*st,Ee=2*at;return Qe[sr]<Qe[Ee]||Qe[sr]===Qe[Ee]&&pt[st]<=pt[at]}function zt(Qe,st,at){for(var pt=Qe.heap[at],sr=at<<1;sr<=Qe.heap_len&&(sr<Qe.heap_len&&gt(st,Qe.heap[sr+1],Qe.heap[sr],Qe.depth)&&sr++,!gt(st,pt,Qe.heap[sr],Qe.depth));)Qe.heap[at]=Qe.heap[sr],at=sr,sr<<=1;Qe.heap[at]=pt}function ur(Qe,st,at){var pt,sr,Ee,ze,ct=0;if(Qe.last_lit!==0)do pt=Qe.pending_buf[Qe.d_buf+2*ct]<<8|Qe.pending_buf[Qe.d_buf+2*ct+1],sr=Qe.pending_buf[Qe.l_buf+ct],ct++,pt===0?ir(Qe,sr,st):(ir(Qe,(Ee=_e[sr])+D+1,st),(ze=se[Ee])!==0&&lt(Qe,sr-=we[Ee],ze),ir(Qe,Ee=bt(--pt),at),(ze=oe[Ee])!==0&&lt(Qe,pt-=Te[Ee],ze));while(ct<Qe.last_lit);ir(Qe,Z,st)}function dr(Qe,st){var at,pt,sr,Ee=st.dyn_tree,ze=st.stat_desc.static_tree,ct=st.stat_desc.has_stree,ft=st.stat_desc.elems,pr=-1;for(Qe.heap_len=0,Qe.heap_max=H,at=0;at<ft;at++)Ee[2*at]!==0?(Qe.heap[++Qe.heap_len]=pr=at,Qe.depth[at]=0):Ee[2*at+1]=0;for(;Qe.heap_len<2;)Ee[2*(sr=Qe.heap[++Qe.heap_len]=pr<2?++pr:0)]=1,Qe.depth[sr]=0,Qe.opt_len--,ct&&(Qe.static_len-=ze[2*sr+1]);for(st.max_code=pr,at=Qe.heap_len>>1;at>=1;at--)zt(Qe,Ee,at);sr=ft;do at=Qe.heap[1],Qe.heap[1]=Qe.heap[Qe.heap_len--],zt(Qe,Ee,1),pt=Qe.heap[1],Qe.heap[--Qe.heap_max]=at,Qe.heap[--Qe.heap_max]=pt,Ee[2*sr]=Ee[2*at]+Ee[2*pt],Qe.depth[sr]=(Qe.depth[at]>=Qe.depth[pt]?Qe.depth[at]:Qe.depth[pt])+1,Ee[2*at+1]=Ee[2*pt+1]=sr,Qe.heap[1]=sr++,zt(Qe,Ee,1);while(Qe.heap_len>=2);Qe.heap[--Qe.heap_max]=Qe.heap[1],(function(fn,vn){var En,bn,$n,xn,ti,Cn,On=vn.dyn_tree,si=vn.max_code,Tn=vn.stat_desc.static_tree,or=vn.stat_desc.has_stree,kn=vn.stat_desc.extra_bits,mr=vn.stat_desc.extra_base,yn=vn.stat_desc.max_length,Dt=0;for(xn=0;xn<=W;xn++)fn.bl_count[xn]=0;for(On[2*fn.heap[fn.heap_max]+1]=0,En=fn.heap_max+1;En<H;En++)(xn=On[2*On[2*(bn=fn.heap[En])+1]+1]+1)>yn&&(xn=yn,Dt++),On[2*bn+1]=xn,bn>si||(fn.bl_count[xn]++,ti=0,bn>=mr&&(ti=kn[bn-mr]),Cn=On[2*bn],fn.opt_len+=Cn*(xn+ti),or&&(fn.static_len+=Cn*(Tn[2*bn+1]+ti)));if(Dt!==0){do{for(xn=yn-1;fn.bl_count[xn]===0;)xn--;fn.bl_count[xn]--,fn.bl_count[xn+1]+=2,fn.bl_count[yn]--,Dt-=2}while(Dt>0);for(xn=yn;xn!==0;xn--)for(bn=fn.bl_count[xn];bn!==0;)($n=fn.heap[--En])>si||(On[2*$n+1]!==xn&&(fn.opt_len+=(xn-On[2*$n+1])*On[2*$n],On[2*$n+1]=xn),bn--)}})(Qe,st),xt(Ee,pr,Qe.bl_count)}function fr(Qe,st,at){var pt,sr,Ee=-1,ze=st[1],ct=0,ft=7,pr=4;for(ze===0&&(ft=138,pr=3),st[2*(at+1)+1]=65535,pt=0;pt<=at;pt++)sr=ze,ze=st[2*(pt+1)+1],++ct<ft&&sr===ze||(ct<pr?Qe.bl_tree[2*sr]+=ct:sr!==0?(sr!==Ee&&Qe.bl_tree[2*sr]++,Qe.bl_tree[2*Q]++):ct<=10?Qe.bl_tree[2*J]++:Qe.bl_tree[2*re]++,ct=0,Ee=sr,ze===0?(ft=138,pr=3):sr===ze?(ft=6,pr=3):(ft=7,pr=4))}function Ft(Qe,st,at){var pt,sr,Ee=-1,ze=st[1],ct=0,ft=7,pr=4;for(ze===0&&(ft=138,pr=3),pt=0;pt<=at;pt++)if(sr=ze,ze=st[2*(pt+1)+1],!(++ct<ft&&sr===ze)){if(ct<pr)do ir(Qe,sr,Qe.bl_tree);while(--ct!=0);else sr!==0?(sr!==Ee&&(ir(Qe,sr,Qe.bl_tree),ct--),ir(Qe,Q,Qe.bl_tree),lt(Qe,ct-3,2)):ct<=10?(ir(Qe,J,Qe.bl_tree),lt(Qe,ct-3,3)):(ir(Qe,re,Qe.bl_tree),lt(Qe,ct-11,7));ct=0,Ee=sr,ze===0?(ft=138,pr=3):sr===ze?(ft=6,pr=3):(ft=7,pr=4)}}w(Te);var $e=!1;function Bt(Qe,st,at,pt){lt(Qe,($<<1)+(pt?1:0),3),(function(sr,Ee,ze,ct){ht(sr),Mt(sr,ze),Mt(sr,~ze),d.arraySet(sr.pending_buf,sr.window,Ee,ze,sr.pending),sr.pending+=ze})(Qe,st,at)}return trees._tr_init=function(Qe){$e||((function(){var st,at,pt,sr,Ee,ze=new Array(W+1);for(pt=0,sr=0;sr<I-1;sr++)for(we[sr]=pt,st=0;st<1<<se[sr];st++)_e[pt++]=sr;for(_e[pt-1]=sr,Ee=0,sr=0;sr<16;sr++)for(Te[sr]=Ee,st=0;st<1<<oe[sr];st++)de[Ee++]=sr;for(Ee>>=7;sr<j;sr++)for(Te[sr]=Ee<<7,st=0;st<1<<oe[sr]-7;st++)de[256+Ee++]=sr;for(at=0;at<=W;at++)ze[at]=0;for(st=0;st<=143;)ce[2*st+1]=8,st++,ze[8]++;for(;st<=255;)ce[2*st+1]=9,st++,ze[9]++;for(;st<=279;)ce[2*st+1]=7,st++,ze[7]++;for(;st<=287;)ce[2*st+1]=8,st++,ze[8]++;for(xt(ce,q+1,ze),st=0;st<j;st++)le[2*st+1]=5,le[2*st]=Ye(st,5);pe=new Ce(ce,se,D+1,q,W),xe=new Ce(le,oe,0,j,W),Ge=new Ce(new Array(0),ee,0,G,K)})(),$e=!0),Qe.l_desc=new Oe(Qe.dyn_ltree,pe),Qe.d_desc=new Oe(Qe.dyn_dtree,xe),Qe.bl_desc=new Oe(Qe.bl_tree,Ge),Qe.bi_buf=0,Qe.bi_valid=0,ar(Qe)},trees._tr_stored_block=Bt,trees._tr_flush_block=function(Qe,st,at,pt){var sr,Ee,ze=0;Qe.level>0?(Qe.strm.data_type===2&&(Qe.strm.data_type=(function(ct){var ft,pr=4093624447;for(ft=0;ft<=31;ft++,pr>>>=1)if(1&pr&&ct.dyn_ltree[2*ft]!==0)return m;if(ct.dyn_ltree[18]!==0||ct.dyn_ltree[20]!==0||ct.dyn_ltree[26]!==0)return g;for(ft=32;ft<D;ft++)if(ct.dyn_ltree[2*ft]!==0)return g;return m})(Qe)),dr(Qe,Qe.l_desc),dr(Qe,Qe.d_desc),ze=(function(ct){var ft;for(fr(ct,ct.dyn_ltree,ct.l_desc.max_code),fr(ct,ct.dyn_dtree,ct.d_desc.max_code),dr(ct,ct.bl_desc),ft=G-1;ft>=3&&ct.bl_tree[2*ae[ft]+1]===0;ft--);return ct.opt_len+=3*(ft+1)+5+5+4,ft})(Qe),sr=Qe.opt_len+3+7>>>3,(Ee=Qe.static_len+3+7>>>3)<=sr&&(sr=Ee)):sr=Ee=at+5,at+4<=sr&&st!==-1?Bt(Qe,st,at,pt):Qe.strategy===4||Ee===sr?(lt(Qe,2+(pt?1:0),3),ur(Qe,ce,le)):(lt(Qe,4+(pt?1:0),3),(function(ct,ft,pr,fn){var vn;for(lt(ct,ft-257,5),lt(ct,pr-1,5),lt(ct,fn-4,4),vn=0;vn<fn;vn++)lt(ct,ct.bl_tree[2*ae[vn]+1],3);Ft(ct,ct.dyn_ltree,ft-1),Ft(ct,ct.dyn_dtree,pr-1)})(Qe,Qe.l_desc.max_code+1,Qe.d_desc.max_code+1,ze+1),ur(Qe,Qe.dyn_ltree,Qe.dyn_dtree)),ar(Qe),pt&&ht(Qe)},trees._tr_tally=function(Qe,st,at){return Qe.pending_buf[Qe.d_buf+2*Qe.last_lit]=st>>>8&255,Qe.pending_buf[Qe.d_buf+2*Qe.last_lit+1]=255&st,Qe.pending_buf[Qe.l_buf+Qe.last_lit]=255&at,Qe.last_lit++,st===0?Qe.dyn_ltree[2*at]++:(Qe.matches++,st--,Qe.dyn_ltree[2*(_e[at]+D+1)]++,Qe.dyn_dtree[2*bt(st)]++),Qe.last_lit===Qe.lit_bufsize-1},trees._tr_align=function(Qe){lt(Qe,2,3),ir(Qe,Z,ce),(function(st){st.bi_valid===16?(Mt(st,st.bi_buf),st.bi_buf=0,st.bi_valid=0):st.bi_valid>=8&&(st.pending_buf[st.pending++]=255&st.bi_buf,st.bi_buf>>=8,st.bi_valid-=8)})(Qe)},trees}function requireAdler32(){return hasRequiredAdler32||(hasRequiredAdler32=1,adler32_1=function(d,m,g,w){for(var $=65535&d,I=d>>>16&65535,D=0;g!==0;){g-=D=g>2e3?2e3:g;do I=I+($=$+m[w++]|0)|0;while(--D);$%=65521,I%=65521}return $|I<<16}),adler32_1}function requireCrc32(){if(hasRequiredCrc32)return crc32_1;hasRequiredCrc32=1;var d=(function(){for(var m,g=[],w=0;w<256;w++){m=w;for(var $=0;$<8;$++)m=1&m?3988292384^m>>>1:m>>>1;g[w]=m}return g})();return crc32_1=function(m,g,w,$){var I=d,D=$+w;m^=-1;for(var q=$;q<D;q++)m=m>>>8^I[255&(m^g[q])];return~m},crc32_1}function requireMessages(){return hasRequiredMessages?messages:(hasRequiredMessages=1,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"})}function requireDeflate$1(){if(hasRequiredDeflate$1)return deflate;hasRequiredDeflate$1=1;var d,m=requireCommon(),g=requireTrees(),w=requireAdler32(),$=requireCrc32(),I=requireMessages(),D=0,q=4,j=0,G=-2,H=-1,W=4,V=2,K=8,Z=9,Q=286,J=30,re=19,se=2*Q+1,oe=15,ee=3,ae=258,ce=ae+ee+1,le=42,de=103,_e=113,we=666,pe=1,xe=2,Ge=3,Te=4;function Ce($e,Bt){return $e.msg=I[Bt],Bt}function Oe($e){return($e<<1)-($e>4?9:0)}function bt($e){for(var Bt=$e.length;--Bt>=0;)$e[Bt]=0}function Mt($e){var Bt=$e.state,Qe=Bt.pending;Qe>$e.avail_out&&(Qe=$e.avail_out),Qe!==0&&(m.arraySet($e.output,Bt.pending_buf,Bt.pending_out,Qe,$e.next_out),$e.next_out+=Qe,Bt.pending_out+=Qe,$e.total_out+=Qe,$e.avail_out-=Qe,Bt.pending-=Qe,Bt.pending===0&&(Bt.pending_out=0))}function lt($e,Bt){g._tr_flush_block($e,$e.block_start>=0?$e.block_start:-1,$e.strstart-$e.block_start,Bt),$e.block_start=$e.strstart,Mt($e.strm)}function ir($e,Bt){$e.pending_buf[$e.pending++]=Bt}function Ye($e,Bt){$e.pending_buf[$e.pending++]=Bt>>>8&255,$e.pending_buf[$e.pending++]=255&Bt}function xt($e,Bt){var Qe,st,at=$e.max_chain_length,pt=$e.strstart,sr=$e.prev_length,Ee=$e.nice_match,ze=$e.strstart>$e.w_size-ce?$e.strstart-($e.w_size-ce):0,ct=$e.window,ft=$e.w_mask,pr=$e.prev,fn=$e.strstart+ae,vn=ct[pt+sr-1],En=ct[pt+sr];$e.prev_length>=$e.good_match&&(at>>=2),Ee>$e.lookahead&&(Ee=$e.lookahead);do if(ct[(Qe=Bt)+sr]===En&&ct[Qe+sr-1]===vn&&ct[Qe]===ct[pt]&&ct[++Qe]===ct[pt+1]){pt+=2,Qe++;do;while(ct[++pt]===ct[++Qe]&&ct[++pt]===ct[++Qe]&&ct[++pt]===ct[++Qe]&&ct[++pt]===ct[++Qe]&&ct[++pt]===ct[++Qe]&&ct[++pt]===ct[++Qe]&&ct[++pt]===ct[++Qe]&&ct[++pt]===ct[++Qe]&&pt<fn);if(st=ae-(fn-pt),pt=fn-ae,st>sr){if($e.match_start=Bt,sr=st,st>=Ee)break;vn=ct[pt+sr-1],En=ct[pt+sr]}}while((Bt=pr[Bt&ft])>ze&&--at!=0);return sr<=$e.lookahead?sr:$e.lookahead}function ar($e){var Bt,Qe,st,at,pt,sr,Ee,ze,ct,ft,pr=$e.w_size;do{if(at=$e.window_size-$e.lookahead-$e.strstart,$e.strstart>=pr+(pr-ce)){m.arraySet($e.window,$e.window,pr,pr,0),$e.match_start-=pr,$e.strstart-=pr,$e.block_start-=pr,Bt=Qe=$e.hash_size;do st=$e.head[--Bt],$e.head[Bt]=st>=pr?st-pr:0;while(--Qe);Bt=Qe=pr;do st=$e.prev[--Bt],$e.prev[Bt]=st>=pr?st-pr:0;while(--Qe);at+=pr}if($e.strm.avail_in===0)break;if(sr=$e.strm,Ee=$e.window,ze=$e.strstart+$e.lookahead,ct=at,ft=void 0,(ft=sr.avail_in)>ct&&(ft=ct),Qe=ft===0?0:(sr.avail_in-=ft,m.arraySet(Ee,sr.input,sr.next_in,ft,ze),sr.state.wrap===1?sr.adler=w(sr.adler,Ee,ft,ze):sr.state.wrap===2&&(sr.adler=$(sr.adler,Ee,ft,ze)),sr.next_in+=ft,sr.total_in+=ft,ft),$e.lookahead+=Qe,$e.lookahead+$e.insert>=ee)for(pt=$e.strstart-$e.insert,$e.ins_h=$e.window[pt],$e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[pt+1])&$e.hash_mask;$e.insert&&($e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[pt+ee-1])&$e.hash_mask,$e.prev[pt&$e.w_mask]=$e.head[$e.ins_h],$e.head[$e.ins_h]=pt,pt++,$e.insert--,!($e.lookahead+$e.insert<ee)););}while($e.lookahead<ce&&$e.strm.avail_in!==0)}function ht($e,Bt){for(var Qe,st;;){if($e.lookahead<ce){if(ar($e),$e.lookahead<ce&&Bt===D)return pe;if($e.lookahead===0)break}if(Qe=0,$e.lookahead>=ee&&($e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[$e.strstart+ee-1])&$e.hash_mask,Qe=$e.prev[$e.strstart&$e.w_mask]=$e.head[$e.ins_h],$e.head[$e.ins_h]=$e.strstart),Qe!==0&&$e.strstart-Qe<=$e.w_size-ce&&($e.match_length=xt($e,Qe)),$e.match_length>=ee)if(st=g._tr_tally($e,$e.strstart-$e.match_start,$e.match_length-ee),$e.lookahead-=$e.match_length,$e.match_length<=$e.max_lazy_match&&$e.lookahead>=ee){$e.match_length--;do $e.strstart++,$e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[$e.strstart+ee-1])&$e.hash_mask,Qe=$e.prev[$e.strstart&$e.w_mask]=$e.head[$e.ins_h],$e.head[$e.ins_h]=$e.strstart;while(--$e.match_length!=0);$e.strstart++}else $e.strstart+=$e.match_length,$e.match_length=0,$e.ins_h=$e.window[$e.strstart],$e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[$e.strstart+1])&$e.hash_mask;else st=g._tr_tally($e,0,$e.window[$e.strstart]),$e.lookahead--,$e.strstart++;if(st&&(lt($e,!1),$e.strm.avail_out===0))return pe}return $e.insert=$e.strstart<ee-1?$e.strstart:ee-1,Bt===q?(lt($e,!0),$e.strm.avail_out===0?Ge:Te):$e.last_lit&&(lt($e,!1),$e.strm.avail_out===0)?pe:xe}function gt($e,Bt){for(var Qe,st,at;;){if($e.lookahead<ce){if(ar($e),$e.lookahead<ce&&Bt===D)return pe;if($e.lookahead===0)break}if(Qe=0,$e.lookahead>=ee&&($e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[$e.strstart+ee-1])&$e.hash_mask,Qe=$e.prev[$e.strstart&$e.w_mask]=$e.head[$e.ins_h],$e.head[$e.ins_h]=$e.strstart),$e.prev_length=$e.match_length,$e.prev_match=$e.match_start,$e.match_length=ee-1,Qe!==0&&$e.prev_length<$e.max_lazy_match&&$e.strstart-Qe<=$e.w_size-ce&&($e.match_length=xt($e,Qe),$e.match_length<=5&&($e.strategy===1||$e.match_length===ee&&$e.strstart-$e.match_start>4096)&&($e.match_length=ee-1)),$e.prev_length>=ee&&$e.match_length<=$e.prev_length){at=$e.strstart+$e.lookahead-ee,st=g._tr_tally($e,$e.strstart-1-$e.prev_match,$e.prev_length-ee),$e.lookahead-=$e.prev_length-1,$e.prev_length-=2;do++$e.strstart<=at&&($e.ins_h=($e.ins_h<<$e.hash_shift^$e.window[$e.strstart+ee-1])&$e.hash_mask,Qe=$e.prev[$e.strstart&$e.w_mask]=$e.head[$e.ins_h],$e.head[$e.ins_h]=$e.strstart);while(--$e.prev_length!=0);if($e.match_available=0,$e.match_length=ee-1,$e.strstart++,st&&(lt($e,!1),$e.strm.avail_out===0))return pe}else if($e.match_available){if((st=g._tr_tally($e,0,$e.window[$e.strstart-1]))&&lt($e,!1),$e.strstart++,$e.lookahead--,$e.strm.avail_out===0)return pe}else $e.match_available=1,$e.strstart++,$e.lookahead--}return $e.match_available&&(st=g._tr_tally($e,0,$e.window[$e.strstart-1]),$e.match_available=0),$e.insert=$e.strstart<ee-1?$e.strstart:ee-1,Bt===q?(lt($e,!0),$e.strm.avail_out===0?Ge:Te):$e.last_lit&&(lt($e,!1),$e.strm.avail_out===0)?pe:xe}function zt($e,Bt,Qe,st,at){this.good_length=$e,this.max_lazy=Bt,this.nice_length=Qe,this.max_chain=st,this.func=at}function ur(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=K,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new m.Buf16(2*se),this.dyn_dtree=new m.Buf16(2*(2*J+1)),this.bl_tree=new m.Buf16(2*(2*re+1)),bt(this.dyn_ltree),bt(this.dyn_dtree),bt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new m.Buf16(oe+1),this.heap=new m.Buf16(2*Q+1),bt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new m.Buf16(2*Q+1),bt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function dr($e){var Bt;return $e&&$e.state?($e.total_in=$e.total_out=0,$e.data_type=V,(Bt=$e.state).pending=0,Bt.pending_out=0,Bt.wrap<0&&(Bt.wrap=-Bt.wrap),Bt.status=Bt.wrap?le:_e,$e.adler=Bt.wrap===2?0:1,Bt.last_flush=D,g._tr_init(Bt),j):Ce($e,G)}function fr($e){var Bt=dr($e);return Bt===j&&(function(Qe){Qe.window_size=2*Qe.w_size,bt(Qe.head),Qe.max_lazy_match=d[Qe.level].max_lazy,Qe.good_match=d[Qe.level].good_length,Qe.nice_match=d[Qe.level].nice_length,Qe.max_chain_length=d[Qe.level].max_chain,Qe.strstart=0,Qe.block_start=0,Qe.lookahead=0,Qe.insert=0,Qe.match_length=Qe.prev_length=ee-1,Qe.match_available=0,Qe.ins_h=0})($e.state),Bt}function Ft($e,Bt,Qe,st,at,pt){if(!$e)return G;var sr=1;if(Bt===H&&(Bt=6),st<0?(sr=0,st=-st):st>15&&(sr=2,st-=16),at<1||at>Z||Qe!==K||st<8||st>15||Bt<0||Bt>9||pt<0||pt>W)return Ce($e,G);st===8&&(st=9);var Ee=new ur;return $e.state=Ee,Ee.strm=$e,Ee.wrap=sr,Ee.gzhead=null,Ee.w_bits=st,Ee.w_size=1<<Ee.w_bits,Ee.w_mask=Ee.w_size-1,Ee.hash_bits=at+7,Ee.hash_size=1<<Ee.hash_bits,Ee.hash_mask=Ee.hash_size-1,Ee.hash_shift=~~((Ee.hash_bits+ee-1)/ee),Ee.window=new m.Buf8(2*Ee.w_size),Ee.head=new m.Buf16(Ee.hash_size),Ee.prev=new m.Buf16(Ee.w_size),Ee.lit_bufsize=1<<at+6,Ee.pending_buf_size=4*Ee.lit_bufsize,Ee.pending_buf=new m.Buf8(Ee.pending_buf_size),Ee.d_buf=1*Ee.lit_bufsize,Ee.l_buf=3*Ee.lit_bufsize,Ee.level=Bt,Ee.strategy=pt,Ee.method=Qe,fr($e)}return d=[new zt(0,0,0,0,(function($e,Bt){var Qe=65535;for(Qe>$e.pending_buf_size-5&&(Qe=$e.pending_buf_size-5);;){if($e.lookahead<=1){if(ar($e),$e.lookahead===0&&Bt===D)return pe;if($e.lookahead===0)break}$e.strstart+=$e.lookahead,$e.lookahead=0;var st=$e.block_start+Qe;if(($e.strstart===0||$e.strstart>=st)&&($e.lookahead=$e.strstart-st,$e.strstart=st,lt($e,!1),$e.strm.avail_out===0)||$e.strstart-$e.block_start>=$e.w_size-ce&&(lt($e,!1),$e.strm.avail_out===0))return pe}return $e.insert=0,Bt===q?(lt($e,!0),$e.strm.avail_out===0?Ge:Te):($e.strstart>$e.block_start&&(lt($e,!1),$e.strm.avail_out),pe)})),new zt(4,4,8,4,ht),new zt(4,5,16,8,ht),new zt(4,6,32,32,ht),new zt(4,4,16,16,gt),new zt(8,16,32,32,gt),new zt(8,16,128,128,gt),new zt(8,32,128,256,gt),new zt(32,128,258,1024,gt),new zt(32,258,258,4096,gt)],deflate.deflateInit=function($e,Bt){return Ft($e,Bt,K,15,8,0)},deflate.deflateInit2=Ft,deflate.deflateReset=fr,deflate.deflateResetKeep=dr,deflate.deflateSetHeader=function($e,Bt){return $e&&$e.state?$e.state.wrap!==2?G:($e.state.gzhead=Bt,j):G},deflate.deflate=function($e,Bt){var Qe,st,at,pt;if(!$e||!$e.state||Bt>5||Bt<0)return $e?Ce($e,G):G;if(st=$e.state,!$e.output||!$e.input&&$e.avail_in!==0||st.status===we&&Bt!==q)return Ce($e,$e.avail_out===0?-5:G);if(st.strm=$e,Qe=st.last_flush,st.last_flush=Bt,st.status===le)if(st.wrap===2)$e.adler=0,ir(st,31),ir(st,139),ir(st,8),st.gzhead?(ir(st,(st.gzhead.text?1:0)+(st.gzhead.hcrc?2:0)+(st.gzhead.extra?4:0)+(st.gzhead.name?8:0)+(st.gzhead.comment?16:0)),ir(st,255&st.gzhead.time),ir(st,st.gzhead.time>>8&255),ir(st,st.gzhead.time>>16&255),ir(st,st.gzhead.time>>24&255),ir(st,st.level===9?2:st.strategy>=2||st.level<2?4:0),ir(st,255&st.gzhead.os),st.gzhead.extra&&st.gzhead.extra.length&&(ir(st,255&st.gzhead.extra.length),ir(st,st.gzhead.extra.length>>8&255)),st.gzhead.hcrc&&($e.adler=$($e.adler,st.pending_buf,st.pending,0)),st.gzindex=0,st.status=69):(ir(st,0),ir(st,0),ir(st,0),ir(st,0),ir(st,0),ir(st,st.level===9?2:st.strategy>=2||st.level<2?4:0),ir(st,3),st.status=_e);else{var sr=K+(st.w_bits-8<<4)<<8;sr|=(st.strategy>=2||st.level<2?0:st.level<6?1:st.level===6?2:3)<<6,st.strstart!==0&&(sr|=32),sr+=31-sr%31,st.status=_e,Ye(st,sr),st.strstart!==0&&(Ye(st,$e.adler>>>16),Ye(st,65535&$e.adler)),$e.adler=1}if(st.status===69)if(st.gzhead.extra){for(at=st.pending;st.gzindex<(65535&st.gzhead.extra.length)&&(st.pending!==st.pending_buf_size||(st.gzhead.hcrc&&st.pending>at&&($e.adler=$($e.adler,st.pending_buf,st.pending-at,at)),Mt($e),at=st.pending,st.pending!==st.pending_buf_size));)ir(st,255&st.gzhead.extra[st.gzindex]),st.gzindex++;st.gzhead.hcrc&&st.pending>at&&($e.adler=$($e.adler,st.pending_buf,st.pending-at,at)),st.gzindex===st.gzhead.extra.length&&(st.gzindex=0,st.status=73)}else st.status=73;if(st.status===73)if(st.gzhead.name){at=st.pending;do{if(st.pending===st.pending_buf_size&&(st.gzhead.hcrc&&st.pending>at&&($e.adler=$($e.adler,st.pending_buf,st.pending-at,at)),Mt($e),at=st.pending,st.pending===st.pending_buf_size)){pt=1;break}pt=st.gzindex<st.gzhead.name.length?255&st.gzhead.name.charCodeAt(st.gzindex++):0,ir(st,pt)}while(pt!==0);st.gzhead.hcrc&&st.pending>at&&($e.adler=$($e.adler,st.pending_buf,st.pending-at,at)),pt===0&&(st.gzindex=0,st.status=91)}else st.status=91;if(st.status===91)if(st.gzhead.comment){at=st.pending;do{if(st.pending===st.pending_buf_size&&(st.gzhead.hcrc&&st.pending>at&&($e.adler=$($e.adler,st.pending_buf,st.pending-at,at)),Mt($e),at=st.pending,st.pending===st.pending_buf_size)){pt=1;break}pt=st.gzindex<st.gzhead.comment.length?255&st.gzhead.comment.charCodeAt(st.gzindex++):0,ir(st,pt)}while(pt!==0);st.gzhead.hcrc&&st.pending>at&&($e.adler=$($e.adler,st.pending_buf,st.pending-at,at)),pt===0&&(st.status=de)}else st.status=de;if(st.status===de&&(st.gzhead.hcrc?(st.pending+2>st.pending_buf_size&&Mt($e),st.pending+2<=st.pending_buf_size&&(ir(st,255&$e.adler),ir(st,$e.adler>>8&255),$e.adler=0,st.status=_e)):st.status=_e),st.pending!==0){if(Mt($e),$e.avail_out===0)return st.last_flush=-1,j}else if($e.avail_in===0&&Oe(Bt)<=Oe(Qe)&&Bt!==q)return Ce($e,-5);if(st.status===we&&$e.avail_in!==0)return Ce($e,-5);if($e.avail_in!==0||st.lookahead!==0||Bt!==D&&st.status!==we){var Ee=st.strategy===2?(function(ze,ct){for(var ft;;){if(ze.lookahead===0&&(ar(ze),ze.lookahead===0)){if(ct===D)return pe;break}if(ze.match_length=0,ft=g._tr_tally(ze,0,ze.window[ze.strstart]),ze.lookahead--,ze.strstart++,ft&&(lt(ze,!1),ze.strm.avail_out===0))return pe}return ze.insert=0,ct===q?(lt(ze,!0),ze.strm.avail_out===0?Ge:Te):ze.last_lit&&(lt(ze,!1),ze.strm.avail_out===0)?pe:xe})(st,Bt):st.strategy===3?(function(ze,ct){for(var ft,pr,fn,vn,En=ze.window;;){if(ze.lookahead<=ae){if(ar(ze),ze.lookahead<=ae&&ct===D)return pe;if(ze.lookahead===0)break}if(ze.match_length=0,ze.lookahead>=ee&&ze.strstart>0&&(pr=En[fn=ze.strstart-1])===En[++fn]&&pr===En[++fn]&&pr===En[++fn]){vn=ze.strstart+ae;do;while(pr===En[++fn]&&pr===En[++fn]&&pr===En[++fn]&&pr===En[++fn]&&pr===En[++fn]&&pr===En[++fn]&&pr===En[++fn]&&pr===En[++fn]&&fn<vn);ze.match_length=ae-(vn-fn),ze.match_length>ze.lookahead&&(ze.match_length=ze.lookahead)}if(ze.match_length>=ee?(ft=g._tr_tally(ze,1,ze.match_length-ee),ze.lookahead-=ze.match_length,ze.strstart+=ze.match_length,ze.match_length=0):(ft=g._tr_tally(ze,0,ze.window[ze.strstart]),ze.lookahead--,ze.strstart++),ft&&(lt(ze,!1),ze.strm.avail_out===0))return pe}return ze.insert=0,ct===q?(lt(ze,!0),ze.strm.avail_out===0?Ge:Te):ze.last_lit&&(lt(ze,!1),ze.strm.avail_out===0)?pe:xe})(st,Bt):d[st.level].func(st,Bt);if(Ee!==Ge&&Ee!==Te||(st.status=we),Ee===pe||Ee===Ge)return $e.avail_out===0&&(st.last_flush=-1),j;if(Ee===xe&&(Bt===1?g._tr_align(st):Bt!==5&&(g._tr_stored_block(st,0,0,!1),Bt===3&&(bt(st.head),st.lookahead===0&&(st.strstart=0,st.block_start=0,st.insert=0))),Mt($e),$e.avail_out===0))return st.last_flush=-1,j}return Bt!==q?j:st.wrap<=0?1:(st.wrap===2?(ir(st,255&$e.adler),ir(st,$e.adler>>8&255),ir(st,$e.adler>>16&255),ir(st,$e.adler>>24&255),ir(st,255&$e.total_in),ir(st,$e.total_in>>8&255),ir(st,$e.total_in>>16&255),ir(st,$e.total_in>>24&255)):(Ye(st,$e.adler>>>16),Ye(st,65535&$e.adler)),Mt($e),st.wrap>0&&(st.wrap=-st.wrap),st.pending!==0?j:1)},deflate.deflateEnd=function($e){var Bt;return $e&&$e.state?(Bt=$e.state.status)!==le&&Bt!==69&&Bt!==73&&Bt!==91&&Bt!==de&&Bt!==_e&&Bt!==we?Ce($e,G):($e.state=null,Bt===_e?Ce($e,-3):j):G},deflate.deflateSetDictionary=function($e,Bt){var Qe,st,at,pt,sr,Ee,ze,ct,ft=Bt.length;if(!$e||!$e.state||(pt=(Qe=$e.state).wrap)===2||pt===1&&Qe.status!==le||Qe.lookahead)return G;for(pt===1&&($e.adler=w($e.adler,Bt,ft,0)),Qe.wrap=0,ft>=Qe.w_size&&(pt===0&&(bt(Qe.head),Qe.strstart=0,Qe.block_start=0,Qe.insert=0),ct=new m.Buf8(Qe.w_size),m.arraySet(ct,Bt,ft-Qe.w_size,Qe.w_size,0),Bt=ct,ft=Qe.w_size),sr=$e.avail_in,Ee=$e.next_in,ze=$e.input,$e.avail_in=ft,$e.next_in=0,$e.input=Bt,ar(Qe);Qe.lookahead>=ee;){st=Qe.strstart,at=Qe.lookahead-(ee-1);do Qe.ins_h=(Qe.ins_h<<Qe.hash_shift^Qe.window[st+ee-1])&Qe.hash_mask,Qe.prev[st&Qe.w_mask]=Qe.head[Qe.ins_h],Qe.head[Qe.ins_h]=st,st++;while(--at);Qe.strstart=st,Qe.lookahead=ee-1,ar(Qe)}return Qe.strstart+=Qe.lookahead,Qe.block_start=Qe.strstart,Qe.insert=Qe.lookahead,Qe.lookahead=0,Qe.match_length=Qe.prev_length=ee-1,Qe.match_available=0,$e.next_in=Ee,$e.input=ze,$e.avail_in=sr,Qe.wrap=pt,j},deflate.deflateInfo="pako deflate (from Nodeca project)",deflate}var strings={},hasRequiredStrings,zstream,hasRequiredZstream,hasRequiredDeflate;function requireStrings(){if(hasRequiredStrings)return strings;hasRequiredStrings=1;var d=requireCommon(),m=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch{m=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{g=!1}for(var w=new d.Buf8(256),$=0;$<256;$++)w[$]=$>=252?6:$>=248?5:$>=240?4:$>=224?3:$>=192?2:1;function I(D,q){if(q<65534&&(D.subarray&&g||!D.subarray&&m))return String.fromCharCode.apply(null,d.shrinkBuf(D,q));for(var j="",G=0;G<q;G++)j+=String.fromCharCode(D[G]);return j}return w[254]=w[254]=1,strings.string2buf=function(D){var q,j,G,H,W,V=D.length,K=0;for(H=0;H<V;H++)(64512&(j=D.charCodeAt(H)))==55296&&H+1<V&&(64512&(G=D.charCodeAt(H+1)))==56320&&(j=65536+(j-55296<<10)+(G-56320),H++),K+=j<128?1:j<2048?2:j<65536?3:4;for(q=new d.Buf8(K),W=0,H=0;W<K;H++)(64512&(j=D.charCodeAt(H)))==55296&&H+1<V&&(64512&(G=D.charCodeAt(H+1)))==56320&&(j=65536+(j-55296<<10)+(G-56320),H++),j<128?q[W++]=j:j<2048?(q[W++]=192|j>>>6,q[W++]=128|63&j):j<65536?(q[W++]=224|j>>>12,q[W++]=128|j>>>6&63,q[W++]=128|63&j):(q[W++]=240|j>>>18,q[W++]=128|j>>>12&63,q[W++]=128|j>>>6&63,q[W++]=128|63&j);return q},strings.buf2binstring=function(D){return I(D,D.length)},strings.binstring2buf=function(D){for(var q=new d.Buf8(D.length),j=0,G=q.length;j<G;j++)q[j]=D.charCodeAt(j);return q},strings.buf2string=function(D,q){var j,G,H,W,V=q||D.length,K=new Array(2*V);for(G=0,j=0;j<V;)if((H=D[j++])<128)K[G++]=H;else if((W=w[H])>4)K[G++]=65533,j+=W-1;else{for(H&=W===2?31:W===3?15:7;W>1&&j<V;)H=H<<6|63&D[j++],W--;W>1?K[G++]=65533:H<65536?K[G++]=H:(H-=65536,K[G++]=55296|H>>10&1023,K[G++]=56320|1023&H)}return I(K,G)},strings.utf8border=function(D,q){var j;for((q=q||D.length)>D.length&&(q=D.length),j=q-1;j>=0&&(192&D[j])==128;)j--;return j<0||j===0?q:j+w[D[j]]>q?j:q},strings}function requireZstream(){return hasRequiredZstream?zstream:(hasRequiredZstream=1,zstream=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0})}function requireDeflate(){if(hasRequiredDeflate)return deflate$1;hasRequiredDeflate=1;var d=requireDeflate$1(),m=requireCommon(),g=requireStrings(),w=requireMessages(),$=requireZstream(),I=Object.prototype.toString,D=0,q=-1,j=0,G=8;function H(V){if(!(this instanceof H))return new H(V);this.options=m.assign({level:q,method:G,chunkSize:16384,windowBits:15,memLevel:8,strategy:j,to:""},V||{});var K=this.options;K.raw&&K.windowBits>0?K.windowBits=-K.windowBits:K.gzip&&K.windowBits>0&&K.windowBits<16&&(K.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $,this.strm.avail_out=0;var Z=d.deflateInit2(this.strm,K.level,K.method,K.windowBits,K.memLevel,K.strategy);if(Z!==D)throw new Error(w[Z]);if(K.header&&d.deflateSetHeader(this.strm,K.header),K.dictionary){var Q;if(Q=typeof K.dictionary=="string"?g.string2buf(K.dictionary):I.call(K.dictionary)==="[object ArrayBuffer]"?new Uint8Array(K.dictionary):K.dictionary,(Z=d.deflateSetDictionary(this.strm,Q))!==D)throw new Error(w[Z]);this._dict_set=!0}}function W(V,K){var Z=new H(K);if(Z.push(V,!0),Z.err)throw Z.msg||w[Z.err];return Z.result}return H.prototype.push=function(V,K){var Z,Q,J=this.strm,re=this.options.chunkSize;if(this.ended)return!1;Q=K===~~K?K:K===!0?4:0,typeof V=="string"?J.input=g.string2buf(V):I.call(V)==="[object ArrayBuffer]"?J.input=new Uint8Array(V):J.input=V,J.next_in=0,J.avail_in=J.input.length;do{if(J.avail_out===0&&(J.output=new m.Buf8(re),J.next_out=0,J.avail_out=re),(Z=d.deflate(J,Q))!==1&&Z!==D)return this.onEnd(Z),this.ended=!0,!1;J.avail_out!==0&&(J.avail_in!==0||Q!==4&&Q!==2)||(this.options.to==="string"?this.onData(g.buf2binstring(m.shrinkBuf(J.output,J.next_out))):this.onData(m.shrinkBuf(J.output,J.next_out)))}while((J.avail_in>0||J.avail_out===0)&&Z!==1);return Q===4?(Z=d.deflateEnd(this.strm),this.onEnd(Z),this.ended=!0,Z===D):Q!==2||(this.onEnd(D),J.avail_out=0,!0)},H.prototype.onData=function(V){this.chunks.push(V)},H.prototype.onEnd=function(V){V===D&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=m.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.msg=this.strm.msg},deflate$1.Deflate=H,deflate$1.deflate=W,deflate$1.deflateRaw=function(V,K){return(K=K||{}).raw=!0,W(V,K)},deflate$1.gzip=function(V,K){return(K=K||{}).gzip=!0,W(V,K)},deflate$1}var inflate$1={},inflate={},inffast,hasRequiredInffast,inftrees,hasRequiredInftrees,hasRequiredInflate$1,constants,hasRequiredConstants,gzheader,hasRequiredGzheader,hasRequiredInflate,pako_1,hasRequiredPako;function requireInffast(){return hasRequiredInffast?inffast:(hasRequiredInffast=1,inffast=function(d,m){var g,w,$,I,D,q,j,G,H,W,V,K,Z,Q,J,re,se,oe,ee,ae,ce,le,de,_e,we;g=d.state,w=d.next_in,_e=d.input,$=w+(d.avail_in-5),I=d.next_out,we=d.output,D=I-(m-d.avail_out),q=I+(d.avail_out-257),j=g.dmax,G=g.wsize,H=g.whave,W=g.wnext,V=g.window,K=g.hold,Z=g.bits,Q=g.lencode,J=g.distcode,re=(1<<g.lenbits)-1,se=(1<<g.distbits)-1;e:do{Z<15&&(K+=_e[w++]<<Z,Z+=8,K+=_e[w++]<<Z,Z+=8),oe=Q[K&re];t:for(;;){if(K>>>=ee=oe>>>24,Z-=ee,(ee=oe>>>16&255)===0)we[I++]=65535&oe;else{if(!(16&ee)){if(64&ee){if(32&ee){g.mode=12;break e}d.msg="invalid literal/length code",g.mode=30;break e}oe=Q[(65535&oe)+(K&(1<<ee)-1)];continue t}for(ae=65535&oe,(ee&=15)&&(Z<ee&&(K+=_e[w++]<<Z,Z+=8),ae+=K&(1<<ee)-1,K>>>=ee,Z-=ee),Z<15&&(K+=_e[w++]<<Z,Z+=8,K+=_e[w++]<<Z,Z+=8),oe=J[K&se];;){if(K>>>=ee=oe>>>24,Z-=ee,16&(ee=oe>>>16&255)){if(ce=65535&oe,Z<(ee&=15)&&(K+=_e[w++]<<Z,(Z+=8)<ee&&(K+=_e[w++]<<Z,Z+=8)),(ce+=K&(1<<ee)-1)>j){d.msg="invalid distance too far back",g.mode=30;break e}if(K>>>=ee,Z-=ee,ce>(ee=I-D)){if((ee=ce-ee)>H&&g.sane){d.msg="invalid distance too far back",g.mode=30;break e}if(le=0,de=V,W===0){if(le+=G-ee,ee<ae){ae-=ee;do we[I++]=V[le++];while(--ee);le=I-ce,de=we}}else if(W<ee){if(le+=G+W-ee,(ee-=W)<ae){ae-=ee;do we[I++]=V[le++];while(--ee);if(le=0,W<ae){ae-=ee=W;do we[I++]=V[le++];while(--ee);le=I-ce,de=we}}}else if(le+=W-ee,ee<ae){ae-=ee;do we[I++]=V[le++];while(--ee);le=I-ce,de=we}for(;ae>2;)we[I++]=de[le++],we[I++]=de[le++],we[I++]=de[le++],ae-=3;ae&&(we[I++]=de[le++],ae>1&&(we[I++]=de[le++]))}else{le=I-ce;do we[I++]=we[le++],we[I++]=we[le++],we[I++]=we[le++],ae-=3;while(ae>2);ae&&(we[I++]=we[le++],ae>1&&(we[I++]=we[le++]))}break}if(64&ee){d.msg="invalid distance code",g.mode=30;break e}oe=J[(65535&oe)+(K&(1<<ee)-1)]}}break}}while(w<$&&I<q);w-=ae=Z>>3,K&=(1<<(Z-=ae<<3))-1,d.next_in=w,d.next_out=I,d.avail_in=w<$?$-w+5:5-(w-$),d.avail_out=I<q?q-I+257:257-(I-q),g.hold=K,g.bits=Z},inffast)}function requireInftrees(){if(hasRequiredInftrees)return inftrees;hasRequiredInftrees=1;var d=requireCommon(),m=15,g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],w=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],$=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],I=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return inftrees=function(D,q,j,G,H,W,V,K){var Z,Q,J,re,se,oe,ee,ae,ce,le=K.bits,de=0,_e=0,we=0,pe=0,xe=0,Ge=0,Te=0,Ce=0,Oe=0,bt=0,Mt=null,lt=0,ir=new d.Buf16(16),Ye=new d.Buf16(16),xt=null,ar=0;for(de=0;de<=m;de++)ir[de]=0;for(_e=0;_e<G;_e++)ir[q[j+_e]]++;for(xe=le,pe=m;pe>=1&&ir[pe]===0;pe--);if(xe>pe&&(xe=pe),pe===0)return H[W++]=20971520,H[W++]=20971520,K.bits=1,0;for(we=1;we<pe&&ir[we]===0;we++);for(xe<we&&(xe=we),Ce=1,de=1;de<=m;de++)if(Ce<<=1,(Ce-=ir[de])<0)return-1;if(Ce>0&&(D===0||pe!==1))return-1;for(Ye[1]=0,de=1;de<m;de++)Ye[de+1]=Ye[de]+ir[de];for(_e=0;_e<G;_e++)q[j+_e]!==0&&(V[Ye[q[j+_e]]++]=_e);if(D===0?(Mt=xt=V,oe=19):D===1?(Mt=g,lt-=257,xt=w,ar-=257,oe=256):(Mt=$,xt=I,oe=-1),bt=0,_e=0,de=we,se=W,Ge=xe,Te=0,J=-1,re=(Oe=1<<xe)-1,D===1&&Oe>852||D===2&&Oe>592)return 1;for(;;){ee=de-Te,V[_e]<oe?(ae=0,ce=V[_e]):V[_e]>oe?(ae=xt[ar+V[_e]],ce=Mt[lt+V[_e]]):(ae=96,ce=0),Z=1<<de-Te,we=Q=1<<Ge;do H[se+(bt>>Te)+(Q-=Z)]=ee<<24|ae<<16|ce;while(Q!==0);for(Z=1<<de-1;bt&Z;)Z>>=1;if(Z!==0?(bt&=Z-1,bt+=Z):bt=0,_e++,--ir[de]==0){if(de===pe)break;de=q[j+V[_e]]}if(de>xe&&(bt&re)!==J){for(Te===0&&(Te=xe),se+=we,Ce=1<<(Ge=de-Te);Ge+Te<pe&&!((Ce-=ir[Ge+Te])<=0);)Ge++,Ce<<=1;if(Oe+=1<<Ge,D===1&&Oe>852||D===2&&Oe>592)return 1;H[J=bt&re]=xe<<24|Ge<<16|se-W}}return bt!==0&&(H[se+bt]=de-Te<<24|64<<16),K.bits=xe,0}}function requireInflate$1(){if(hasRequiredInflate$1)return inflate;hasRequiredInflate$1=1;var d=requireCommon(),m=requireAdler32(),g=requireCrc32(),w=requireInffast(),$=requireInftrees(),I=1,D=2,q=0,j=-2,G=1,H=12,W=30,V=852,K=592;function Z(_e){return(_e>>>24&255)+(_e>>>8&65280)+((65280&_e)<<8)+((255&_e)<<24)}function Q(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function J(_e){var we;return _e&&_e.state?(we=_e.state,_e.total_in=_e.total_out=we.total=0,_e.msg="",we.wrap&&(_e.adler=1&we.wrap),we.mode=G,we.last=0,we.havedict=0,we.dmax=32768,we.head=null,we.hold=0,we.bits=0,we.lencode=we.lendyn=new d.Buf32(V),we.distcode=we.distdyn=new d.Buf32(K),we.sane=1,we.back=-1,q):j}function re(_e){var we;return _e&&_e.state?((we=_e.state).wsize=0,we.whave=0,we.wnext=0,J(_e)):j}function se(_e,we){var pe,xe;return _e&&_e.state?(xe=_e.state,we<0?(pe=0,we=-we):(pe=1+(we>>4),we<48&&(we&=15)),we&&(we<8||we>15)?j:(xe.window!==null&&xe.wbits!==we&&(xe.window=null),xe.wrap=pe,xe.wbits=we,re(_e))):j}function oe(_e,we){var pe,xe;return _e?(xe=new Q,_e.state=xe,xe.window=null,(pe=se(_e,we))!==q&&(_e.state=null),pe):j}var ee,ae,ce=!0;function le(_e){if(ce){var we;for(ee=new d.Buf32(512),ae=new d.Buf32(32),we=0;we<144;)_e.lens[we++]=8;for(;we<256;)_e.lens[we++]=9;for(;we<280;)_e.lens[we++]=7;for(;we<288;)_e.lens[we++]=8;for($(I,_e.lens,0,288,ee,0,_e.work,{bits:9}),we=0;we<32;)_e.lens[we++]=5;$(D,_e.lens,0,32,ae,0,_e.work,{bits:5}),ce=!1}_e.lencode=ee,_e.lenbits=9,_e.distcode=ae,_e.distbits=5}function de(_e,we,pe,xe){var Ge,Te=_e.state;return Te.window===null&&(Te.wsize=1<<Te.wbits,Te.wnext=0,Te.whave=0,Te.window=new d.Buf8(Te.wsize)),xe>=Te.wsize?(d.arraySet(Te.window,we,pe-Te.wsize,Te.wsize,0),Te.wnext=0,Te.whave=Te.wsize):((Ge=Te.wsize-Te.wnext)>xe&&(Ge=xe),d.arraySet(Te.window,we,pe-xe,Ge,Te.wnext),(xe-=Ge)?(d.arraySet(Te.window,we,pe-xe,xe,0),Te.wnext=xe,Te.whave=Te.wsize):(Te.wnext+=Ge,Te.wnext===Te.wsize&&(Te.wnext=0),Te.whave<Te.wsize&&(Te.whave+=Ge))),0}return inflate.inflateReset=re,inflate.inflateReset2=se,inflate.inflateResetKeep=J,inflate.inflateInit=function(_e){return oe(_e,15)},inflate.inflateInit2=oe,inflate.inflate=function(_e,we){var pe,xe,Ge,Te,Ce,Oe,bt,Mt,lt,ir,Ye,xt,ar,ht,gt,zt,ur,dr,fr,Ft,$e,Bt,Qe,st,at=0,pt=new d.Buf8(4),sr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!_e||!_e.state||!_e.output||!_e.input&&_e.avail_in!==0)return j;(pe=_e.state).mode===H&&(pe.mode=13),Ce=_e.next_out,Ge=_e.output,bt=_e.avail_out,Te=_e.next_in,xe=_e.input,Oe=_e.avail_in,Mt=pe.hold,lt=pe.bits,ir=Oe,Ye=bt,Bt=q;e:for(;;)switch(pe.mode){case G:if(pe.wrap===0){pe.mode=13;break}for(;lt<16;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}if(2&pe.wrap&&Mt===35615){pe.check=0,pt[0]=255&Mt,pt[1]=Mt>>>8&255,pe.check=g(pe.check,pt,2,0),Mt=0,lt=0,pe.mode=2;break}if(pe.flags=0,pe.head&&(pe.head.done=!1),!(1&pe.wrap)||(((255&Mt)<<8)+(Mt>>8))%31){_e.msg="incorrect header check",pe.mode=W;break}if((15&Mt)!=8){_e.msg="unknown compression method",pe.mode=W;break}if(lt-=4,$e=8+(15&(Mt>>>=4)),pe.wbits===0)pe.wbits=$e;else if($e>pe.wbits){_e.msg="invalid window size",pe.mode=W;break}pe.dmax=1<<$e,_e.adler=pe.check=1,pe.mode=512&Mt?10:H,Mt=0,lt=0;break;case 2:for(;lt<16;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}if(pe.flags=Mt,(255&pe.flags)!=8){_e.msg="unknown compression method",pe.mode=W;break}if(57344&pe.flags){_e.msg="unknown header flags set",pe.mode=W;break}pe.head&&(pe.head.text=Mt>>8&1),512&pe.flags&&(pt[0]=255&Mt,pt[1]=Mt>>>8&255,pe.check=g(pe.check,pt,2,0)),Mt=0,lt=0,pe.mode=3;case 3:for(;lt<32;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}pe.head&&(pe.head.time=Mt),512&pe.flags&&(pt[0]=255&Mt,pt[1]=Mt>>>8&255,pt[2]=Mt>>>16&255,pt[3]=Mt>>>24&255,pe.check=g(pe.check,pt,4,0)),Mt=0,lt=0,pe.mode=4;case 4:for(;lt<16;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}pe.head&&(pe.head.xflags=255&Mt,pe.head.os=Mt>>8),512&pe.flags&&(pt[0]=255&Mt,pt[1]=Mt>>>8&255,pe.check=g(pe.check,pt,2,0)),Mt=0,lt=0,pe.mode=5;case 5:if(1024&pe.flags){for(;lt<16;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}pe.length=Mt,pe.head&&(pe.head.extra_len=Mt),512&pe.flags&&(pt[0]=255&Mt,pt[1]=Mt>>>8&255,pe.check=g(pe.check,pt,2,0)),Mt=0,lt=0}else pe.head&&(pe.head.extra=null);pe.mode=6;case 6:if(1024&pe.flags&&((xt=pe.length)>Oe&&(xt=Oe),xt&&(pe.head&&($e=pe.head.extra_len-pe.length,pe.head.extra||(pe.head.extra=new Array(pe.head.extra_len)),d.arraySet(pe.head.extra,xe,Te,xt,$e)),512&pe.flags&&(pe.check=g(pe.check,xe,xt,Te)),Oe-=xt,Te+=xt,pe.length-=xt),pe.length))break e;pe.length=0,pe.mode=7;case 7:if(2048&pe.flags){if(Oe===0)break e;xt=0;do $e=xe[Te+xt++],pe.head&&$e&&pe.length<65536&&(pe.head.name+=String.fromCharCode($e));while($e&&xt<Oe);if(512&pe.flags&&(pe.check=g(pe.check,xe,xt,Te)),Oe-=xt,Te+=xt,$e)break e}else pe.head&&(pe.head.name=null);pe.length=0,pe.mode=8;case 8:if(4096&pe.flags){if(Oe===0)break e;xt=0;do $e=xe[Te+xt++],pe.head&&$e&&pe.length<65536&&(pe.head.comment+=String.fromCharCode($e));while($e&&xt<Oe);if(512&pe.flags&&(pe.check=g(pe.check,xe,xt,Te)),Oe-=xt,Te+=xt,$e)break e}else pe.head&&(pe.head.comment=null);pe.mode=9;case 9:if(512&pe.flags){for(;lt<16;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}if(Mt!==(65535&pe.check)){_e.msg="header crc mismatch",pe.mode=W;break}Mt=0,lt=0}pe.head&&(pe.head.hcrc=pe.flags>>9&1,pe.head.done=!0),_e.adler=pe.check=0,pe.mode=H;break;case 10:for(;lt<32;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}_e.adler=pe.check=Z(Mt),Mt=0,lt=0,pe.mode=11;case 11:if(pe.havedict===0)return _e.next_out=Ce,_e.avail_out=bt,_e.next_in=Te,_e.avail_in=Oe,pe.hold=Mt,pe.bits=lt,2;_e.adler=pe.check=1,pe.mode=H;case H:if(we===5||we===6)break e;case 13:if(pe.last){Mt>>>=7&lt,lt-=7&lt,pe.mode=27;break}for(;lt<3;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}switch(pe.last=1&Mt,lt-=1,3&(Mt>>>=1)){case 0:pe.mode=14;break;case 1:if(le(pe),pe.mode=20,we===6){Mt>>>=2,lt-=2;break e}break;case 2:pe.mode=17;break;case 3:_e.msg="invalid block type",pe.mode=W}Mt>>>=2,lt-=2;break;case 14:for(Mt>>>=7&lt,lt-=7&lt;lt<32;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}if((65535&Mt)!=(Mt>>>16^65535)){_e.msg="invalid stored block lengths",pe.mode=W;break}if(pe.length=65535&Mt,Mt=0,lt=0,pe.mode=15,we===6)break e;case 15:pe.mode=16;case 16:if(xt=pe.length){if(xt>Oe&&(xt=Oe),xt>bt&&(xt=bt),xt===0)break e;d.arraySet(Ge,xe,Te,xt,Ce),Oe-=xt,Te+=xt,bt-=xt,Ce+=xt,pe.length-=xt;break}pe.mode=H;break;case 17:for(;lt<14;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}if(pe.nlen=257+(31&Mt),Mt>>>=5,lt-=5,pe.ndist=1+(31&Mt),Mt>>>=5,lt-=5,pe.ncode=4+(15&Mt),Mt>>>=4,lt-=4,pe.nlen>286||pe.ndist>30){_e.msg="too many length or distance symbols",pe.mode=W;break}pe.have=0,pe.mode=18;case 18:for(;pe.have<pe.ncode;){for(;lt<3;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}pe.lens[sr[pe.have++]]=7&Mt,Mt>>>=3,lt-=3}for(;pe.have<19;)pe.lens[sr[pe.have++]]=0;if(pe.lencode=pe.lendyn,pe.lenbits=7,Qe={bits:pe.lenbits},Bt=$(0,pe.lens,0,19,pe.lencode,0,pe.work,Qe),pe.lenbits=Qe.bits,Bt){_e.msg="invalid code lengths set",pe.mode=W;break}pe.have=0,pe.mode=19;case 19:for(;pe.have<pe.nlen+pe.ndist;){for(;zt=(at=pe.lencode[Mt&(1<<pe.lenbits)-1])>>>16&255,ur=65535&at,!((gt=at>>>24)<=lt);){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}if(ur<16)Mt>>>=gt,lt-=gt,pe.lens[pe.have++]=ur;else{if(ur===16){for(st=gt+2;lt<st;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}if(Mt>>>=gt,lt-=gt,pe.have===0){_e.msg="invalid bit length repeat",pe.mode=W;break}$e=pe.lens[pe.have-1],xt=3+(3&Mt),Mt>>>=2,lt-=2}else if(ur===17){for(st=gt+3;lt<st;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}lt-=gt,$e=0,xt=3+(7&(Mt>>>=gt)),Mt>>>=3,lt-=3}else{for(st=gt+7;lt<st;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}lt-=gt,$e=0,xt=11+(127&(Mt>>>=gt)),Mt>>>=7,lt-=7}if(pe.have+xt>pe.nlen+pe.ndist){_e.msg="invalid bit length repeat",pe.mode=W;break}for(;xt--;)pe.lens[pe.have++]=$e}}if(pe.mode===W)break;if(pe.lens[256]===0){_e.msg="invalid code -- missing end-of-block",pe.mode=W;break}if(pe.lenbits=9,Qe={bits:pe.lenbits},Bt=$(I,pe.lens,0,pe.nlen,pe.lencode,0,pe.work,Qe),pe.lenbits=Qe.bits,Bt){_e.msg="invalid literal/lengths set",pe.mode=W;break}if(pe.distbits=6,pe.distcode=pe.distdyn,Qe={bits:pe.distbits},Bt=$(D,pe.lens,pe.nlen,pe.ndist,pe.distcode,0,pe.work,Qe),pe.distbits=Qe.bits,Bt){_e.msg="invalid distances set",pe.mode=W;break}if(pe.mode=20,we===6)break e;case 20:pe.mode=21;case 21:if(Oe>=6&&bt>=258){_e.next_out=Ce,_e.avail_out=bt,_e.next_in=Te,_e.avail_in=Oe,pe.hold=Mt,pe.bits=lt,w(_e,Ye),Ce=_e.next_out,Ge=_e.output,bt=_e.avail_out,Te=_e.next_in,xe=_e.input,Oe=_e.avail_in,Mt=pe.hold,lt=pe.bits,pe.mode===H&&(pe.back=-1);break}for(pe.back=0;zt=(at=pe.lencode[Mt&(1<<pe.lenbits)-1])>>>16&255,ur=65535&at,!((gt=at>>>24)<=lt);){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}if(zt&&!(240&zt)){for(dr=gt,fr=zt,Ft=ur;zt=(at=pe.lencode[Ft+((Mt&(1<<dr+fr)-1)>>dr)])>>>16&255,ur=65535&at,!(dr+(gt=at>>>24)<=lt);){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}Mt>>>=dr,lt-=dr,pe.back+=dr}if(Mt>>>=gt,lt-=gt,pe.back+=gt,pe.length=ur,zt===0){pe.mode=26;break}if(32&zt){pe.back=-1,pe.mode=H;break}if(64&zt){_e.msg="invalid literal/length code",pe.mode=W;break}pe.extra=15&zt,pe.mode=22;case 22:if(pe.extra){for(st=pe.extra;lt<st;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}pe.length+=Mt&(1<<pe.extra)-1,Mt>>>=pe.extra,lt-=pe.extra,pe.back+=pe.extra}pe.was=pe.length,pe.mode=23;case 23:for(;zt=(at=pe.distcode[Mt&(1<<pe.distbits)-1])>>>16&255,ur=65535&at,!((gt=at>>>24)<=lt);){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}if(!(240&zt)){for(dr=gt,fr=zt,Ft=ur;zt=(at=pe.distcode[Ft+((Mt&(1<<dr+fr)-1)>>dr)])>>>16&255,ur=65535&at,!(dr+(gt=at>>>24)<=lt);){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}Mt>>>=dr,lt-=dr,pe.back+=dr}if(Mt>>>=gt,lt-=gt,pe.back+=gt,64&zt){_e.msg="invalid distance code",pe.mode=W;break}pe.offset=ur,pe.extra=15&zt,pe.mode=24;case 24:if(pe.extra){for(st=pe.extra;lt<st;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}pe.offset+=Mt&(1<<pe.extra)-1,Mt>>>=pe.extra,lt-=pe.extra,pe.back+=pe.extra}if(pe.offset>pe.dmax){_e.msg="invalid distance too far back",pe.mode=W;break}pe.mode=25;case 25:if(bt===0)break e;if(xt=Ye-bt,pe.offset>xt){if((xt=pe.offset-xt)>pe.whave&&pe.sane){_e.msg="invalid distance too far back",pe.mode=W;break}xt>pe.wnext?(xt-=pe.wnext,ar=pe.wsize-xt):ar=pe.wnext-xt,xt>pe.length&&(xt=pe.length),ht=pe.window}else ht=Ge,ar=Ce-pe.offset,xt=pe.length;xt>bt&&(xt=bt),bt-=xt,pe.length-=xt;do Ge[Ce++]=ht[ar++];while(--xt);pe.length===0&&(pe.mode=21);break;case 26:if(bt===0)break e;Ge[Ce++]=pe.length,bt--,pe.mode=21;break;case 27:if(pe.wrap){for(;lt<32;){if(Oe===0)break e;Oe--,Mt|=xe[Te++]<<lt,lt+=8}if(Ye-=bt,_e.total_out+=Ye,pe.total+=Ye,Ye&&(_e.adler=pe.check=pe.flags?g(pe.check,Ge,Ye,Ce-Ye):m(pe.check,Ge,Ye,Ce-Ye)),Ye=bt,(pe.flags?Mt:Z(Mt))!==pe.check){_e.msg="incorrect data check",pe.mode=W;break}Mt=0,lt=0}pe.mode=28;case 28:if(pe.wrap&&pe.flags){for(;lt<32;){if(Oe===0)break e;Oe--,Mt+=xe[Te++]<<lt,lt+=8}if(Mt!==(4294967295&pe.total)){_e.msg="incorrect length check",pe.mode=W;break}Mt=0,lt=0}pe.mode=29;case 29:Bt=1;break e;case W:Bt=-3;break e;case 31:return-4;default:return j}return _e.next_out=Ce,_e.avail_out=bt,_e.next_in=Te,_e.avail_in=Oe,pe.hold=Mt,pe.bits=lt,(pe.wsize||Ye!==_e.avail_out&&pe.mode<W&&(pe.mode<27||we!==4))&&de(_e,_e.output,_e.next_out,Ye-_e.avail_out),ir-=_e.avail_in,Ye-=_e.avail_out,_e.total_in+=ir,_e.total_out+=Ye,pe.total+=Ye,pe.wrap&&Ye&&(_e.adler=pe.check=pe.flags?g(pe.check,Ge,Ye,_e.next_out-Ye):m(pe.check,Ge,Ye,_e.next_out-Ye)),_e.data_type=pe.bits+(pe.last?64:0)+(pe.mode===H?128:0)+(pe.mode===20||pe.mode===15?256:0),(ir===0&&Ye===0||we===4)&&Bt===q&&(Bt=-5),Bt},inflate.inflateEnd=function(_e){if(!_e||!_e.state)return j;var we=_e.state;return we.window&&(we.window=null),_e.state=null,q},inflate.inflateGetHeader=function(_e,we){var pe;return _e&&_e.state&&2&(pe=_e.state).wrap?(pe.head=we,we.done=!1,q):j},inflate.inflateSetDictionary=function(_e,we){var pe,xe=we.length;return _e&&_e.state?(pe=_e.state).wrap!==0&&pe.mode!==11?j:pe.mode===11&&m(1,we,xe,0)!==pe.check?-3:de(_e,we,xe,xe)?(pe.mode=31,-4):(pe.havedict=1,q):j},inflate.inflateInfo="pako inflate (from Nodeca project)",inflate}function requireConstants(){return hasRequiredConstants?constants:(hasRequiredConstants=1,constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8})}function requireGzheader(){return hasRequiredGzheader?gzheader:(hasRequiredGzheader=1,gzheader=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1})}function requireInflate(){if(hasRequiredInflate)return inflate$1;hasRequiredInflate=1;var d=requireInflate$1(),m=requireCommon(),g=requireStrings(),w=requireConstants(),$=requireMessages(),I=requireZstream(),D=requireGzheader(),q=Object.prototype.toString;function j(H){if(!(this instanceof j))return new j(H);this.options=m.assign({chunkSize:16384,windowBits:0,to:""},H||{});var W=this.options;W.raw&&W.windowBits>=0&&W.windowBits<16&&(W.windowBits=-W.windowBits,W.windowBits===0&&(W.windowBits=-15)),!(W.windowBits>=0&&W.windowBits<16)||H&&H.windowBits||(W.windowBits+=32),W.windowBits>15&&W.windowBits<48&&(15&W.windowBits||(W.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new I,this.strm.avail_out=0;var V=d.inflateInit2(this.strm,W.windowBits);if(V!==w.Z_OK)throw new Error($[V]);if(this.header=new D,d.inflateGetHeader(this.strm,this.header),W.dictionary&&(typeof W.dictionary=="string"?W.dictionary=g.string2buf(W.dictionary):q.call(W.dictionary)==="[object ArrayBuffer]"&&(W.dictionary=new Uint8Array(W.dictionary)),W.raw&&(V=d.inflateSetDictionary(this.strm,W.dictionary))!==w.Z_OK))throw new Error($[V])}function G(H,W){var V=new j(W);if(V.push(H,!0),V.err)throw V.msg||$[V.err];return V.result}return j.prototype.push=function(H,W){var V,K,Z,Q,J,re=this.strm,se=this.options.chunkSize,oe=this.options.dictionary,ee=!1;if(this.ended)return!1;K=W===~~W?W:W===!0?w.Z_FINISH:w.Z_NO_FLUSH,typeof H=="string"?re.input=g.binstring2buf(H):q.call(H)==="[object ArrayBuffer]"?re.input=new Uint8Array(H):re.input=H,re.next_in=0,re.avail_in=re.input.length;do{if(re.avail_out===0&&(re.output=new m.Buf8(se),re.next_out=0,re.avail_out=se),(V=d.inflate(re,w.Z_NO_FLUSH))===w.Z_NEED_DICT&&oe&&(V=d.inflateSetDictionary(this.strm,oe)),V===w.Z_BUF_ERROR&&ee===!0&&(V=w.Z_OK,ee=!1),V!==w.Z_STREAM_END&&V!==w.Z_OK)return this.onEnd(V),this.ended=!0,!1;re.next_out&&(re.avail_out!==0&&V!==w.Z_STREAM_END&&(re.avail_in!==0||K!==w.Z_FINISH&&K!==w.Z_SYNC_FLUSH)||(this.options.to==="string"?(Z=g.utf8border(re.output,re.next_out),Q=re.next_out-Z,J=g.buf2string(re.output,Z),re.next_out=Q,re.avail_out=se-Q,Q&&m.arraySet(re.output,re.output,Z,Q,0),this.onData(J)):this.onData(m.shrinkBuf(re.output,re.next_out)))),re.avail_in===0&&re.avail_out===0&&(ee=!0)}while((re.avail_in>0||re.avail_out===0)&&V!==w.Z_STREAM_END);return V===w.Z_STREAM_END&&(K=w.Z_FINISH),K===w.Z_FINISH?(V=d.inflateEnd(this.strm),this.onEnd(V),this.ended=!0,V===w.Z_OK):K!==w.Z_SYNC_FLUSH||(this.onEnd(w.Z_OK),re.avail_out=0,!0)},j.prototype.onData=function(H){this.chunks.push(H)},j.prototype.onEnd=function(H){H===w.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=m.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.msg=this.strm.msg},inflate$1.Inflate=j,inflate$1.inflate=G,inflate$1.inflateRaw=function(H,W){return(W=W||{}).raw=!0,G(H,W)},inflate$1.ungzip=G,inflate$1}function requirePako(){if(hasRequiredPako)return pako_1;hasRequiredPako=1;var d={};return(0,requireCommon().assign)(d,requireDeflate(),requireInflate(),requireConstants()),pako_1=d}(function(d){(function(){var m={};function g(){typeof process<"u"||console.log.apply(console,arguments)}d.exports=m,(function(w,$){(function(){var I=(function(){function j(G){this.message="JPEG error: "+G}return j.prototype=new Error,j.prototype.name="JpegError",j.constructor=j,j})(),D=(function(){var j=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),G=4017,H=799,W=3406,V=2276,K=1567,Z=3784,Q=5793,J=2896;function re(de){de==null&&(de={}),de.w==null&&(de.w=-1),this.V=de.n,this.N=de.w}function se(de,_e){for(var we,pe,xe,Ge=0,Te=[],Ce=16;Ce>0&&!de[Ce-1];)Ce--;Te.push({children:[],index:0});var Oe=Te[0];for(we=0;we<Ce;we++){for(pe=0;pe<de[we];pe++){for((Oe=Te.pop()).children[Oe.index]=_e[Ge];Oe.index>0;)Oe=Te.pop();for(Oe.index++,Te.push(Oe);Te.length<=we;)Te.push(xe={children:[],index:0}),Oe.children[Oe.index]=xe.children,Oe=xe;Ge++}we+1<Ce&&(Te.push(xe={children:[],index:0}),Oe.children[Oe.index]=xe.children,Oe=xe)}return Te[0].children}function oe(de,_e,we){return 64*((de.P+1)*_e+we)}function ee(de,_e,we,pe,xe,Ge,Te,Ce,Oe,bt){bt==null&&(bt=!1);var Mt,lt,ir,Ye,xt,ar,ht,gt,zt,ur,dr,fr=we.m,Ft=we.Z,$e=_e,Bt=0,Qe=0,st=0,at=0,pt=0,sr=0;function Ee(){if(Qe>0)return Qe--,Bt>>Qe&1;if((Bt=de[_e++])===255){var bn=de[_e++];if(bn){if(bn===220&&bt){var $n=q(de,_e+=2);if(_e+=2,$n>0&&$n!==we.s)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",$n)}else if(bn===217){if(bt){var xn=8*pt;if(xn>0&&xn<we.s/10)throw new DNLMarkerError("Found EOI marker (0xFFD9) while parsing scan data, possibly caused by incorrect `scanLines` parameter",xn)}throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data")}throw new I("unexpected marker")}}return Qe=7,Bt>>>7}function ze(bn){for(var $n=bn;;){switch(typeof($n=$n[Ee()])){case"number":return $n;case"object":continue}throw new I("invalid huffman sequence")}}function ct(bn){for(var $n=0;bn>0;)$n=$n<<1|Ee(),bn--;return $n}function ft(bn){if(bn===1)return Ee()===1?1:-1;var $n=ct(bn);return $n>=1<<bn-1?$n:$n+(-1<<bn)+1}function pr(bn,$n,xn,ti,Cn){var On=xn%fr;pt=(xn/fr|0)*bn.A+ti;var si=On*bn.h+Cn;$n(bn,oe(bn,pt,si))}function fn(bn,$n,xn){pt=xn/bn.P|0;var ti=xn%bn.P;$n(bn,oe(bn,pt,ti))}var vn=pe.length;for(ht=Ft?Ge===0?Ce===0?function(bn,$n){var xn=ze(bn.J),ti=xn===0?0:ft(xn)<<Oe;bn.D[$n]=bn.Q+=ti}:function(bn,$n){bn.D[$n]|=Ee()<<Oe}:Ce===0?function(bn,$n){if(st>0)st--;else for(var xn=Ge,ti=Te;xn<=ti;){var Cn=ze(bn.i),On=15&Cn,si=Cn>>4;if(On!==0){var Tn=j[xn+=si];bn.D[$n+Tn]=ft(On)*(1<<Oe),xn++}else{if(si<15){st=ct(si)+(1<<si)-1;break}xn+=16}}}:function(bn,$n){for(var xn,ti,Cn=Ge,On=Te,si=0;Cn<=On;){var Tn=$n+j[Cn],or=bn.D[Tn]<0?-1:1;switch(at){case 0:if(si=(ti=ze(bn.i))>>4,(xn=15&ti)==0)si<15?(st=ct(si)+(1<<si),at=4):(si=16,at=1);else{if(xn!==1)throw new I("invalid ACn encoding");Mt=ft(xn),at=si?2:3}continue;case 1:case 2:bn.D[Tn]?bn.D[Tn]+=or*(Ee()<<Oe):--si==0&&(at=at===2?3:0);break;case 3:bn.D[Tn]?bn.D[Tn]+=or*(Ee()<<Oe):(bn.D[Tn]=Mt<<Oe,at=0);break;case 4:bn.D[Tn]&&(bn.D[Tn]+=or*(Ee()<<Oe))}Cn++}at===4&&--st==0&&(at=0)}:function(bn,$n){var xn=ze(bn.J),ti=xn===0?0:ft(xn),Cn=1;for(bn.D[$n]=bn.Q+=ti;Cn<64;){var On=ze(bn.i),si=15&On,Tn=On>>4;if(si!==0){var or=j[Cn+=Tn];bn.D[$n+or]=ft(si),Cn++}else{if(Tn<15)break;Cn+=16}}},zt=vn===1?pe[0].P*pe[0].c:fr*we.R;sr<=zt;){var En=xe?Math.min(zt-sr,xe):zt;if(En>0){for(ir=0;ir<vn;ir++)pe[ir].Q=0;if(st=0,vn===1)for(lt=pe[0],ar=0;ar<En;ar++)fn(lt,ht,sr),sr++;else for(ar=0;ar<En;ar++){for(ir=0;ir<vn;ir++)for(ur=(lt=pe[ir]).h,dr=lt.A,Ye=0;Ye<dr;Ye++)for(xt=0;xt<ur;xt++)pr(lt,ht,sr,Ye,xt);sr++}}if(Qe=0,!(gt=le(de,_e))||(gt.u&&(_e=gt.offset),!(gt.M>=65488&&gt.M<=65495)))break;_e+=2}return _e-$e}function ae(de,_e,we){var pe,xe,Ge,Te,Ce,Oe,bt,Mt,lt,ir,Ye,xt,ar,ht,gt,zt,ur,dr=de.$,fr=de.D;if(!dr)throw new I("missing required Quantization Table.");for(var Ft=0;Ft<64;Ft+=8)lt=fr[_e+Ft],ir=fr[_e+Ft+1],Ye=fr[_e+Ft+2],xt=fr[_e+Ft+3],ar=fr[_e+Ft+4],ht=fr[_e+Ft+5],gt=fr[_e+Ft+6],zt=fr[_e+Ft+7],lt*=dr[Ft],ir|Ye|xt|ar|ht|gt|zt?(ir*=dr[Ft+1],Ye*=dr[Ft+2],xt*=dr[Ft+3],ar*=dr[Ft+4],ht*=dr[Ft+5],gt*=dr[Ft+6],zt*=dr[Ft+7],xe=(pe=(pe=Q*lt+128>>8)+(xe=Q*ar+128>>8)+1>>1)-xe,ur=(Ge=Ye)*Z+(Te=gt)*K+128>>8,Ge=Ge*K-Te*Z+128>>8,bt=(Ce=(Ce=J*(ir-zt)+128>>8)+(bt=ht<<4)+1>>1)-bt,Oe=(Mt=(Mt=J*(ir+zt)+128>>8)+(Oe=xt<<4)+1>>1)-Oe,Te=(pe=pe+(Te=ur)+1>>1)-Te,Ge=(xe=xe+Ge+1>>1)-Ge,ur=Ce*V+Mt*W+2048>>12,Ce=Ce*W-Mt*V+2048>>12,Mt=ur,ur=Oe*H+bt*G+2048>>12,Oe=Oe*G-bt*H+2048>>12,bt=ur,we[Ft]=pe+Mt,we[Ft+7]=pe-Mt,we[Ft+1]=xe+bt,we[Ft+6]=xe-bt,we[Ft+2]=Ge+Oe,we[Ft+5]=Ge-Oe,we[Ft+3]=Te+Ce,we[Ft+4]=Te-Ce):(ur=Q*lt+512>>10,we[Ft]=ur,we[Ft+1]=ur,we[Ft+2]=ur,we[Ft+3]=ur,we[Ft+4]=ur,we[Ft+5]=ur,we[Ft+6]=ur,we[Ft+7]=ur);for(var $e=0;$e<8;++$e)lt=we[$e],(ir=we[$e+8])|(Ye=we[$e+16])|(xt=we[$e+24])|(ar=we[$e+32])|(ht=we[$e+40])|(gt=we[$e+48])|(zt=we[$e+56])?(xe=(pe=4112+((pe=Q*lt+2048>>12)+(xe=Q*ar+2048>>12)+1>>1))-xe,ur=(Ge=Ye)*Z+(Te=gt)*K+2048>>12,Ge=Ge*K-Te*Z+2048>>12,Te=ur,bt=(Ce=(Ce=J*(ir-zt)+2048>>12)+(bt=ht)+1>>1)-bt,Oe=(Mt=(Mt=J*(ir+zt)+2048>>12)+(Oe=xt)+1>>1)-Oe,ur=Ce*V+Mt*W+2048>>12,Ce=Ce*W-Mt*V+2048>>12,Mt=ur,ur=Oe*H+bt*G+2048>>12,Oe=Oe*G-bt*H+2048>>12,(lt=(pe=pe+Te+1>>1)+Mt)<16?lt=0:lt>=4080?lt=255:lt>>=4,(ir=(xe=xe+Ge+1>>1)+(bt=ur))<16?ir=0:ir>=4080?ir=255:ir>>=4,(Ye=(Ge=xe-Ge)+Oe)<16?Ye=0:Ye>=4080?Ye=255:Ye>>=4,(xt=(Te=pe-Te)+Ce)<16?xt=0:xt>=4080?xt=255:xt>>=4,(ar=Te-Ce)<16?ar=0:ar>=4080?ar=255:ar>>=4,(ht=Ge-Oe)<16?ht=0:ht>=4080?ht=255:ht>>=4,(gt=xe-bt)<16?gt=0:gt>=4080?gt=255:gt>>=4,(zt=pe-Mt)<16?zt=0:zt>=4080?zt=255:zt>>=4,fr[_e+$e]=lt,fr[_e+$e+8]=ir,fr[_e+$e+16]=Ye,fr[_e+$e+24]=xt,fr[_e+$e+32]=ar,fr[_e+$e+40]=ht,fr[_e+$e+48]=gt,fr[_e+$e+56]=zt):(ur=(ur=Q*lt+8192>>14)<-2040?0:ur>=2024?255:ur+2056>>4,fr[_e+$e]=ur,fr[_e+$e+8]=ur,fr[_e+$e+16]=ur,fr[_e+$e+24]=ur,fr[_e+$e+32]=ur,fr[_e+$e+40]=ur,fr[_e+$e+48]=ur,fr[_e+$e+56]=ur)}function ce(de,_e){for(var we=_e.P,pe=_e.c,xe=new Int16Array(64),Ge=0;Ge<pe;Ge++)for(var Te=0;Te<we;Te++)ae(_e,oe(_e,Ge,Te),xe);return _e.D}function le(de,_e,we){we==null&&(we=_e);var pe=de.length-1,xe=we<_e?we:_e;if(_e>=pe)return null;var Ge=q(de,_e);if(Ge>=65472&&Ge<=65534)return{u:null,M:Ge,offset:_e};for(var Te=q(de,xe);!(Te>=65472&&Te<=65534);){if(++xe>=pe)return null;Te=q(de,xe)}return{u:Ge.toString(16),M:Te,offset:xe}}return re.prototype={parse(de,_e){_e==null&&(_e={});var we,pe,xe=_e.F,Ge=0,Te=null,Ce=null,Oe=0;function bt(){var mr=q(de,Ge),yn=(Ge+=2)+mr-2,Dt=le(de,yn,Ge);Dt&&Dt.u&&(yn=Dt.offset);var wn=de.subarray(Ge,yn);return Ge+=wn.length,wn}function Mt(mr){for(var yn=Math.ceil(mr.o/8/mr.X),Dt=Math.ceil(mr.s/8/mr.B),wn=0;wn<mr.W.length;wn++){fn=mr.W[wn];var ii=Math.ceil(Math.ceil(mr.o/8)*fn.h/mr.X),Ze=Math.ceil(Math.ceil(mr.s/8)*fn.A/mr.B),_n=yn*fn.h,hn=64*(Dt*fn.A)*(_n+1);fn.D=new Int16Array(hn),fn.P=ii,fn.c=Ze}mr.m=yn,mr.R=Dt}var lt=[],ir=[],Ye=[],xt=q(de,Ge);if(Ge+=2,xt!==65496)throw new I("SOI not found");xt=q(de,Ge),Ge+=2;e:for(;xt!==65497;){var ar,ht,gt;switch(xt){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var zt=bt();xt===65504&&zt[0]===74&&zt[1]===70&&zt[2]===73&&zt[3]===70&&zt[4]===0&&(Te={version:{d:zt[5],T:zt[6]},K:zt[7],j:zt[8]<<8|zt[9],H:zt[10]<<8|zt[11],S:zt[12],I:zt[13],C:zt.subarray(14,14+3*zt[12]*zt[13])}),xt===65518&&zt[0]===65&&zt[1]===100&&zt[2]===111&&zt[3]===98&&zt[4]===101&&(Ce={version:zt[5]<<8|zt[6],k:zt[7]<<8|zt[8],q:zt[9]<<8|zt[10],a:zt[11]});break;case 65499:for(var ur=q(de,Ge)+(Ge+=2)-2;Ge<ur;){var dr=de[Ge++],fr=new Uint16Array(64);if(dr>>4){if(dr>>4!=1)throw new I("DQT - invalid table spec");for(ht=0;ht<64;ht++)fr[j[ht]]=q(de,Ge),Ge+=2}else for(ht=0;ht<64;ht++)fr[j[ht]]=de[Ge++];lt[15&dr]=fr}break;case 65472:case 65473:case 65474:if(we)throw new I("Only single frame JPEGs supported");Ge+=2,(we={}).G=xt===65473,we.Z=xt===65474,we.precision=de[Ge++];var Ft,$e=q(de,Ge),Bt=0,Qe=0;Ge+=2,we.s=xe||$e,we.o=q(de,Ge),Ge+=2,we.W=[],we._={};var st=de[Ge++];for(ar=0;ar<st;ar++){Ft=de[Ge];var at=de[Ge+1]>>4,pt=15&de[Ge+1];Bt<at&&(Bt=at),Qe<pt&&(Qe=pt);var sr=de[Ge+2];gt=we.W.push({h:at,A:pt,L:sr,$:null}),we._[Ft]=gt-1,Ge+=3}we.X=Bt,we.B=Qe,Mt(we);break;case 65476:var Ee=q(de,Ge);for(Ge+=2,ar=2;ar<Ee;){var ze=de[Ge++],ct=new Uint8Array(16),ft=0;for(ht=0;ht<16;ht++,Ge++)ft+=ct[ht]=de[Ge];var pr=new Uint8Array(ft);for(ht=0;ht<ft;ht++,Ge++)pr[ht]=de[Ge];ar+=17+ft,(ze>>4?ir:Ye)[15&ze]=se(ct,pr)}break;case 65501:pe=q(de,Ge+=2),Ge+=2;break;case 65498:var fn,vn=++Oe==1&&!xe;Ge+=2;var En=de[Ge++],bn=[];for(ar=0;ar<En;ar++){var $n=de[Ge++],xn=we._[$n];(fn=we.W[xn]).index=$n;var ti=de[Ge++];fn.J=Ye[ti>>4],fn.i=ir[15&ti],bn.push(fn)}var Cn=de[Ge++],On=de[Ge++],si=de[Ge++];try{var Tn=ee(de,Ge,we,bn,pe,Cn,On,si>>4,15&si,vn);Ge+=Tn}catch(mr){if(mr instanceof DNLMarkerError)return this.parse(de,{F:mr.s});if(mr instanceof EOIMarkerError)break e;throw mr}break;case 65500:Ge+=4;break;case 65535:de[Ge]!==255&&Ge--;break;default:var or=le(de,Ge-2,Ge-3);if(or&&or.u){Ge=or.offset;break}if(Ge>=de.length-1)break e;throw new I("JpegImage.parse - unknown marker: "+xt.toString(16))}xt=q(de,Ge),Ge+=2}for(this.width=we.o,this.height=we.s,this.g=Te,this.b=Ce,this.W=[],ar=0;ar<we.W.length;ar++){var kn=lt[(fn=we.W[ar]).L];kn&&(fn.$=kn),this.W.push({index:fn.index,e:ce(0,fn),l:fn.h/we.X,t:fn.A/we.B,P:fn.P,c:fn.c})}this.p=this.W.length},Y(de,_e,we){we==null&&(we=!1);var pe,xe,Ge,Te,Ce,Oe,bt,Mt,lt,ir,Ye,xt,ar=this.width/de,ht=this.height/_e,gt=0,zt=this.W.length,ur=de*_e*zt,dr=new Uint8ClampedArray(ur),fr=new Uint32Array(de),Ft=4294967288;for(bt=0;bt<zt;bt++){if(xe=(pe=this.W[bt]).l*ar,Ge=pe.t*ht,gt=bt,Ye=pe.e,Te=pe.P+1<<3,xe!==xt){for(Ce=0;Ce<de;Ce++)Mt=0|Ce*xe,fr[Ce]=(Mt&Ft)<<3|7&Mt;xt=xe}for(Oe=0;Oe<_e;Oe++)for(ir=Te*((Mt=0|Oe*Ge)&Ft)|(7&Mt)<<3,Ce=0;Ce<de;Ce++)dr[gt]=Ye[ir+fr[Ce]],gt+=zt}var $e=this.V;if(we||zt!==4||$e||($e=new Int32Array([-256,255,-256,255,-256,255,-256,255])),$e)for(bt=0;bt<ur;)for(Mt=0,lt=0;Mt<zt;Mt++,bt++,lt+=2)dr[bt]=(dr[bt]*$e[lt]>>8)+$e[lt+1];return dr},get f(){return this.b?!!this.b.a:this.p===3?this.N!==0&&(this.W[0].index!==82||this.W[1].index!==71||this.W[2].index!==66):this.N===1},z:function(de){for(var _e,we,pe,xe=0,Ge=de.length;xe<Ge;xe+=3)_e=de[xe],we=de[xe+1],pe=de[xe+2],de[xe]=_e-179.456+1.402*pe,de[xe+1]=_e+135.459-.344*we-.714*pe,de[xe+2]=_e-226.816+1.772*we;return de},O:function(de){for(var _e,we,pe,xe,Ge=0,Te=0,Ce=de.length;Te<Ce;Te+=4)_e=de[Te],we=de[Te+1],pe=de[Te+2],xe=de[Te+3],de[Ge++]=we*(-660635669420364e-19*we+.000437130475926232*pe-54080610064599e-18*_e+.00048449797120281*xe-.154362151871126)-122.67195406894+pe*(-.000957964378445773*pe+.000817076911346625*_e-.00477271405408747*xe+1.53380253221734)+_e*(.000961250184130688*_e-.00266257332283933*xe+.48357088451265)+xe*(-.000336197177618394*xe+.484791561490776),de[Ge++]=107.268039397724+we*(219927104525741e-19*we-.000640992018297945*pe+.000659397001245577*_e+.000426105652938837*xe-.176491792462875)+pe*(-.000778269941513683*pe+.00130872261408275*_e+.000770482631801132*xe-.151051492775562)+_e*(.00126935368114843*_e-.00265090189010898*xe+.25802910206845)+xe*(-.000318913117588328*xe-.213742400323665),de[Ge++]=we*(-.000570115196973677*we-263409051004589e-19*pe+.0020741088115012*_e-.00288260236853442*xe+.814272968359295)-20.810012546947+pe*(-153496057440975e-19*pe-.000132689043961446*_e+.000560833691242812*xe-.195152027534049)+_e*(.00174418132927582*_e-.00255243321439347*xe+.116935020465145)+xe*(-.000343531996510555*xe+.24165260232407);return de.subarray(0,Ge)},r:function(de){for(var _e,we,pe,xe=0,Ge=de.length;xe<Ge;xe+=4)_e=de[xe],we=de[xe+1],pe=de[xe+2],de[xe]=434.456-_e-1.402*pe,de[xe+1]=119.541-_e+.344*we+.714*pe,de[xe+2]=481.816-_e-1.772*we;return de},U:function(de){for(var _e,we,pe,xe,Ge=0,Te=0,Ce=de.length;Te<Ce;Te+=4)_e=de[Te],we=de[Te+1],pe=de[Te+2],xe=de[Te+3],de[Ge++]=255+_e*(-6747147073602441e-20*_e+.0008379262121013727*we+.0002894718188643294*pe+.003264231057537806*xe-1.1185611867203937)+we*(26374107616089405e-21*we-8626949158638572e-20*pe-.0002748769067499491*xe-.02155688794978967)+pe*(-3878099212869363e-20*pe-.0003267808279485286*xe+.0686742238595345)-xe*(.0003361971776183937*xe+.7430659151342254),de[Ge++]=255+_e*(.00013596372813588848*_e+.000924537132573585*we+.00010567359618683593*pe+.0004791864687436512*xe-.3109689587515875)+we*(-.00023545346108370344*we+.0002702845253534714*pe+.0020200308977307156*xe-.7488052167015494)+pe*(6834815998235662e-20*pe+.00015168452363460973*xe-.09751927774728933)-xe*(.0003189131175883281*xe+.7364883807733168),de[Ge++]=255+_e*(13598650411385307e-21*_e+.00012423956175490851*we+.0004751985097583589*pe-36729317476630422e-22*xe-.05562186980264034)+we*(.00016141380598724676*we+.0009692239130725186*pe+.0007782692450036253*xe-.44015232367526463)+pe*(5068882914068769e-22*pe+.0017778369011375071*xe-.7591454649749609)-xe*(.0003435319965105553*xe+.7063770186160144);return de.subarray(0,Ge)},getData:function(de){var _e=de.width,we=de.height,pe=de.forceRGB,xe=de.isSourcePDF;if(this.p>4)throw new I("Unsupported color mode");var Ge=this.Y(_e,we,xe);if(this.p===1&&pe){for(var Te=Ge.length,Ce=new Uint8ClampedArray(3*Te),Oe=0,bt=0;bt<Te;bt++){var Mt=Ge[bt];Ce[Oe++]=Mt,Ce[Oe++]=Mt,Ce[Oe++]=Mt}return Ce}if(this.p===3&&this.f)return this.z(Ge);if(this.p===4){if(this.f)return pe?this.O(Ge):this.r(Ge);if(pe)return this.U(Ge)}return Ge}},re})();function q(j,G){return j[G]<<8|j[G+1]}w.JpegDecoder=D})(),w.encodeImage=function(I,D,q,j){var G={t256:[D],t257:[q],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[q],t279:[D*q*4],t282:[[72,1]],t283:[[72,1]],t284:[1],t286:[[0,1]],t287:[[0,1]],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(j)for(var H in j)G[H]=j[H];var W=new Uint8Array(w.encode([G])),V=new Uint8Array(I),K=new Uint8Array(1e3+D*q*4);for(H=0;H<W.length;H++)K[H]=W[H];for(H=0;H<V.length;H++)K[1e3+H]=V[H];return K.buffer},w.encode=function(I){var D=new Uint8Array(2e4),q=4,j=w._binBE;D[0]=D[1]=77,j.writeUshort(D,2,42);var G=8;j.writeUint(D,q,G),q+=4;for(var H=0;H<I.length;H++){var W=w._writeIFD(j,w._types.basic,D,G,I[H]);G=W[1],H<I.length-1&&(3&G&&(G+=4-(3&G)),j.writeUint(D,W[0],G))}return D.slice(0,G).buffer},w.decode=function(I,D){D==null&&(D={parseMN:!0,debug:!1});var q=new Uint8Array(I),j=0,G=w._binBE.readASCII(q,j,2);j+=2;var H=G=="II"?w._binLE:w._binBE;H.readUshort(q,j),j+=2;var W=H.readUint(q,j);j+=4;for(var V=[];;){var K=H.readUshort(q,W),Z=H.readUshort(q,W+4);if(K!=0&&(Z<1||13<Z)){g("error in TIFF");break}if(w._readIFD(H,q,W,V,0,D),(W=H.readUint(q,W+2+12*K))==0)break}return V},w.decodeImage=function(I,D,q){if(!D.data){var j=new Uint8Array(I),G=w._binBE.readASCII(j,0,2);if(D.t256!=null){D.isLE=G=="II",D.width=D.t256[0],D.height=D.t257[0];var H=D.t259?D.t259[0]:1,W=D.t266?D.t266[0]:1;D.t284&&D.t284[0]==2&&g("PlanarConfiguration 2 should not be used!"),H==7&&D.t258&&D.t258.length>3&&(D.t258=D.t258.slice(0,3));var V=D.t277?D.t277[0]:1,K=(D.t258?D.t258[0]:1)*V;H==1&&D.t279!=null&&D.t278&&D.t262[0]==32803&&(K=Math.round(8*D.t279[0]/(D.width*D.t278[0]))),D.t50885&&D.t50885[0]==4&&(K=3*D.t258[0]);var Z=8*Math.ceil(D.width*K/8),Q=D.t273;(Q==null||D.t322)&&(Q=D.t324);var J=D.t279;H==1&&Q.length==1&&(J=[D.height*(Z>>>3)]),(J==null||D.t322)&&(J=D.t325);var re=new Uint8Array(D.height*(Z>>>3)),se=0;if(D.t322!=null){var oe=D.t322[0],ee=D.t323[0],ae=Math.floor((D.width+oe-1)/oe),ce=Math.floor((D.height+ee-1)/ee),le=new Uint8Array(0|Math.ceil(oe*ee*K/8));console.log("====",ae,ce);for(var de=0;de<ce;de++)for(var _e=0;_e<ae;_e++){var we=de*ae+_e;le.fill(0),w.decode._decompress(D,q,j,Q[we],J[we],H,le,0,W,oe,ee),H==6?re=le:w._copyTile(le,0|Math.ceil(oe*K/8),ee,re,0|Math.ceil(D.width*K/8),D.height,0|Math.ceil(_e*oe*K/8),de*ee)}se=8*re.length}else{if(Q==null)return;var pe=D.t278?D.t278[0]:D.height;for(pe=Math.min(pe,D.height),we=0;we<Q.length;we++)w.decode._decompress(D,q,j,Q[we],J[we],H,re,0|Math.ceil(se/8),W,D.width,pe),se+=Z*pe;se=Math.min(se,8*re.length)}D.data=new Uint8Array(re.buffer,0,0|Math.ceil(se/8))}}},w.decode._decompress=function(I,D,q,j,G,H,W,V,K,Z,Q){if(I.t271&&I.t271[0]=="Panasonic"&&I.t45&&I.t45[0]==6&&(H=34316),H==1)for(var J=0;J<G;J++)W[V+J]=q[j+J];else if(H==2)w.decode._decodeG2(q,j,G,W,V,Z,K);else if(H==3)w.decode._decodeG3(q,j,G,W,V,Z,K,!!I.t292&&!(1&~I.t292[0]));else if(H==4)w.decode._decodeG4(q,j,G,W,V,Z,K);else if(H==5)w.decode._decodeLZW(q,j,G,W,V,8);else if(H==6)w.decode._decodeOldJPEG(I,q,j,G,W,V);else if(H==7||H==34892)w.decode._decodeNewJPEG(I,q,j,G,W,V);else if(H==8||H==32946){var re=new Uint8Array(q.buffer,j+2,G-6),se=$.inflateRaw(re);V+se.length<=W.length&&W.set(se,V)}else H==9?w.decode._decodeVC5(q,j,G,W,V,I.t33422):H==32767?w.decode._decodeARW(I,q,j,G,W,V):H==32773?w.decode._decodePackBits(q,j,G,W,V):H==32809?w.decode._decodeThunder(q,j,G,W,V):H==34316?w.decode._decodePanasonic(I,q,j,G,W,V):H==34713?w.decode._decodeNikon(I,D,q,j,G,W,V):H==34676?w.decode._decodeLogLuv32(I,q,j,G,W,V):g("Unknown compression",H);var oe=I.t258?Math.min(32,I.t258[0]):1,ee=I.t277?I.t277[0]:1,ae=oe*ee>>>3,ce=Math.ceil(oe*ee*Z/8);if(oe==16&&!I.isLE&&I.t33422==null)for(var le=0;le<Q;le++)for(var de=V+le*ce,_e=1;_e<ce;_e+=2){var we=W[de+_e];W[de+_e]=W[de+_e-1],W[de+_e-1]=we}if(I.t317&&I.t317[0]==2)for(le=0;le<Q;le++){var pe=V+le*ce;if(oe==16)for(J=ae;J<ce;J+=2){var xe=(W[pe+J+1]<<8|W[pe+J])+(W[pe+J-ae+1]<<8|W[pe+J-ae]);W[pe+J]=255&xe,W[pe+J+1]=xe>>>8&255}else if(ee==3)for(J=3;J<ce;J+=3)W[pe+J]=W[pe+J]+W[pe+J-3]&255,W[pe+J+1]=W[pe+J+1]+W[pe+J-2]&255,W[pe+J+2]=W[pe+J+2]+W[pe+J-1]&255;else for(J=ae;J<ce;J++)W[pe+J]=W[pe+J]+W[pe+J-ae]&255}},w.decode._decodePanasonic=function(I,D,q,j,G,H){var W,V,K,Z,Q,J,re,se,oe=D.buffer,ee=I.t2[0],ae=I.t3[0],ce=I.t10[0],le=I.t45[0],de=0,_e=0,we=0,pe=0,xe=le==6?new Uint32Array(18):new Uint8Array(16),Ge=[0,0],Te=[0,0],Ce=0,Oe=new Uint8Array(16384),bt=new Uint16Array(G.buffer);function Mt(sr){if(we==0){var Ee=new Uint8Array(oe,q+_e+8184,8200),ze=new Uint8Array(oe,q+_e,8184);Oe.set(Ee),Oe.set(ze,Ee.length),_e+=16384}if(le!=5)return(Oe[pe=(we=we-sr&131071)>>3^16368]|Oe[pe+1]<<8)>>(7&we)&~(-1<<sr);for(W=0;W<16;W++)xe[W]=Oe[we++],we&=16383}function lt(sr){return Oe[we+15-sr]}function ir(){Ge[0]=0,Ge[1]=0,Te[0]=0,Te[1]=0}if(le==7)throw le;if(le==6){var Ye=ce==12,xt=Ye?function(){xe[0]=lt(0)<<4|lt(1)>>4,xe[1]=4095&((15&lt(1))<<8|lt(2)),xe[2]=lt(3)>>6&3,xe[3]=(63&lt(3))<<2|lt(4)>>6,xe[4]=(63&lt(4))<<2|lt(5)>>6,xe[5]=(63&lt(5))<<2|lt(6)>>6,xe[6]=lt(6)>>4&3,xe[7]=(15&lt(6))<<4|lt(7)>>4,xe[8]=(15&lt(7))<<4|lt(8)>>4,xe[9]=(15&lt(8))<<4|lt(9)>>4,xe[10]=lt(9)>>2&3,xe[11]=(3&lt(9))<<6|lt(10)>>2,xe[12]=(3&lt(10))<<6|lt(11)>>2,xe[13]=(3&lt(11))<<6|lt(12)>>2,xe[14]=3&lt(12),xe[15]=lt(13),xe[16]=lt(14),xe[17]=lt(15),we+=16,pe=0}:function(){xe[0]=lt(0)<<6|lt(1)>>2,xe[1]=16383&((3&lt(1))<<12|lt(2)<<4|lt(3)>>4),xe[2]=lt(3)>>2&3,xe[3]=(3&lt(3))<<8|lt(4),xe[4]=lt(5)<<2|lt(6)>>6,xe[5]=(63&lt(6))<<4|lt(7)>>4,xe[6]=lt(7)>>2&3,xe[7]=(3&lt(7))<<8|lt(8),xe[8]=lt(9)<<2&1020|lt(10)>>6,xe[9]=1023&(lt(10)<<4|lt(11)>>4),xe[10]=lt(11)>>2&3,xe[11]=(3&lt(11))<<8|lt(12),xe[12]=1023&(lt(13)<<2&1020|lt(14)>>6),xe[13]=1023&(lt(14)<<4|lt(15)>>4),we+=16,pe=0},ar=Ye?14:11,ht=Ye?128:512,gt=Ye?2048:8192,zt=Ye?16383:65535,ur=Ye?4095:16383,dr=ee/ar,fr=16*dr,Ft=Ye?18:14;for(J=0;J<ae-15;J+=16){var $e=Math.min(16,ae-J),Bt=fr*$e;for(Oe=new Uint8Array(oe,q+de,Bt),we=0,de+=Bt,se=0,re=0;se<$e;se++,re=0){Ce=(J+se)*ee;for(var Qe=0;Qe<dr;Qe++)for(xt(),ir(),K=0,Q=0,W=0;W<ar;W++){if(Z=1&W,W%3==2){var st=pe<Ft?xe[pe++]:0;st==3&&(st=4),Q=ht<<st,K=1<<st}var at=pe<Ft?xe[pe++]:0;Ge[Z]?(at*=K,Q<gt&&Te[Z]>Q&&(at+=Te[Z]-Q),Te[Z]=at):(Ge[Z]=at,at?Te[Z]=at:at=Te[Z]),bt[Ce+re++]=at-15<=zt?at-15&zt:at+2147483633>>31&ur}}}}else if(le==5){var pt=ce==12?10:9;for(J=0;J<ae;J++)for(re=0;re<ee;re+=pt)Mt(0),ce==12?(bt[Ce++]=((15&xe[1])<<8)+xe[0],bt[Ce++]=16*xe[2]+(xe[1]>>4),bt[Ce++]=((15&xe[4])<<8)+xe[3],bt[Ce++]=16*xe[5]+(xe[4]>>4),bt[Ce++]=((15&xe[7])<<8)+xe[6],bt[Ce++]=16*xe[8]+(xe[7]>>4),bt[Ce++]=((15&xe[10])<<8)+xe[9],bt[Ce++]=16*xe[11]+(xe[10]>>4),bt[Ce++]=((15&xe[13])<<8)+xe[12],bt[Ce++]=16*xe[14]+(xe[13]>>4)):ce==14&&(bt[Ce++]=xe[0]+((63&xe[1])<<8),bt[Ce++]=(xe[1]>>6)+4*xe[2]+((15&xe[3])<<10),bt[Ce++]=(xe[3]>>4)+16*xe[4]+((3&xe[5])<<12),bt[Ce++]=((252&xe[5])>>2)+(xe[6]<<6),bt[Ce++]=xe[7]+((63&xe[8])<<8),bt[Ce++]=(xe[8]>>6)+4*xe[9]+((15&xe[10])<<10),bt[Ce++]=(xe[10]>>4)+16*xe[11]+((3&xe[12])<<12),bt[Ce++]=((252&xe[12])>>2)+(xe[13]<<6),bt[Ce++]=xe[14]+((63&xe[15])<<8))}else{if(le!=4)throw le;for(J=0;J<ae;J++)for(re=0;re<ee;re++)Z=1&(W=re%14),W==0&&ir(),W%3==2&&(K=4>>3-Mt(2)),Te[Z]?(V=Mt(8))!=0&&(Ge[Z]-=128<<K,(Ge[Z]<0||K==4)&&(Ge[Z]&=~(-1<<K)),Ge[Z]+=V<<K):(Te[Z]=Mt(8),(Te[Z]||W>11)&&(Ge[Z]=Te[Z]<<4|Mt(4))),bt[Ce++]=Ge[1&re]}},w.decode._decodeVC5=(function(){var I,D,q,j=[1,0,1,0,2,2,1,1,3,7,1,2,5,25,1,3,6,48,1,4,6,54,1,5,7,111,1,8,7,99,1,6,7,105,12,0,7,107,1,7,8,209,20,0,8,212,1,9,8,220,1,10,9,393,1,11,9,394,32,0,9,416,1,12,9,427,1,13,10,887,1,18,10,784,1,14,10,790,1,15,10,835,60,0,10,852,1,16,10,885,1,17,11,1571,1,19,11,1668,1,20,11,1669,100,0,11,1707,1,21,11,1772,1,22,12,3547,1,29,12,3164,1,24,12,3166,1,25,12,3140,1,23,12,3413,1,26,12,3537,1,27,12,3539,1,28,13,7093,1,35,13,6283,1,30,13,6331,1,31,13,6335,180,0,13,6824,1,32,13,7072,1,33,13,7077,320,0,13,7076,1,34,14,12565,1,36,14,12661,1,37,14,12669,1,38,14,13651,1,39,14,14184,1,40,15,28295,1,46,15,28371,1,47,15,25320,1,42,15,25336,1,43,15,25128,1,41,15,27300,1,44,15,28293,1,45,16,50259,1,48,16,50643,1,49,16,50675,1,50,16,56740,1,53,16,56584,1,51,16,56588,1,52,17,113483,1,61,17,113482,1,60,17,101285,1,55,17,101349,1,56,17,109205,1,57,17,109207,1,58,17,100516,1,54,17,113171,1,59,18,202568,1,62,18,202696,1,63,18,218408,1,64,18,218412,1,65,18,226340,1,66,18,226356,1,67,18,226358,1,68,19,402068,1,69,19,405138,1,70,19,405394,1,71,19,436818,1,72,19,436826,1,73,19,452714,1,75,19,452718,1,76,19,452682,1,74,20,804138,1,77,20,810279,1,78,20,810790,1,79,20,873638,1,80,20,873654,1,81,20,905366,1,82,20,905430,1,83,20,905438,1,84,21,1608278,1,85,21,1620557,1,86,21,1621582,1,87,21,1621583,1,88,21,1747310,1,89,21,1810734,1,90,21,1810735,1,91,21,1810863,1,92,21,1810879,1,93,22,3621725,1,99,22,3621757,1,100,22,3241112,1,94,22,3494556,1,95,22,3494557,1,96,22,3494622,1,97,22,3494623,1,98,23,6482227,1,102,23,6433117,1,101,23,6989117,1,103,23,6989119,1,105,23,6989118,1,104,23,7243449,1,106,23,7243512,1,107,24,13978233,1,111,24,12964453,1,109,24,12866232,1,108,24,14486897,1,113,24,13978232,1,110,24,14486896,1,112,24,14487026,1,114,24,14487027,1,115,25,25732598,1,225,25,25732597,1,189,25,25732596,1,188,25,25732595,1,203,25,25732594,1,202,25,25732593,1,197,25,25732592,1,207,25,25732591,1,169,25,25732590,1,223,25,25732589,1,159,25,25732522,1,235,25,25732579,1,152,25,25732575,1,192,25,25732489,1,179,25,25732573,1,201,25,25732472,1,172,25,25732576,1,149,25,25732488,1,178,25,25732566,1,120,25,25732571,1,219,25,25732577,1,150,25,25732487,1,127,25,25732506,1,211,25,25732548,1,125,25,25732588,1,158,25,25732486,1,247,25,25732467,1,238,25,25732508,1,163,25,25732552,1,228,25,25732603,1,183,25,25732513,1,217,25,25732587,1,168,25,25732520,1,122,25,25732484,1,128,25,25732562,1,249,25,25732505,1,187,25,25732504,1,186,25,25732483,1,136,25,25928905,1,181,25,25732560,1,255,25,25732500,1,230,25,25732482,1,135,25,25732555,1,233,25,25732568,1,222,25,25732583,1,145,25,25732481,1,134,25,25732586,1,167,25,25732521,1,248,25,25732518,1,209,25,25732480,1,243,25,25732512,1,216,25,25732509,1,164,25,25732547,1,140,25,25732479,1,157,25,25732544,1,239,25,25732574,1,191,25,25732564,1,251,25,25732478,1,156,25,25732546,1,139,25,25732498,1,242,25,25732557,1,133,25,25732477,1,162,25,25732515,1,213,25,25732584,1,165,25,25732514,1,212,25,25732476,1,227,25,25732494,1,198,25,25732531,1,236,25,25732530,1,234,25,25732529,1,117,25,25732528,1,215,25,25732527,1,124,25,25732526,1,123,25,25732525,1,254,25,25732524,1,253,25,25732523,1,148,25,25732570,1,218,25,25732580,1,146,25,25732581,1,147,25,25732569,1,224,25,25732533,1,143,25,25732540,1,184,25,25732541,1,185,25,25732585,1,166,25,25732556,1,132,25,25732485,1,129,25,25732563,1,250,25,25732578,1,151,25,25732501,1,119,25,25732502,1,193,25,25732536,1,176,25,25732496,1,245,25,25732553,1,229,25,25732516,1,206,25,25732582,1,144,25,25732517,1,208,25,25732558,1,137,25,25732543,1,241,25,25732466,1,237,25,25732507,1,190,25,25732542,1,240,25,25732551,1,131,25,25732554,1,232,25,25732565,1,252,25,25732475,1,171,25,25732493,1,205,25,25732492,1,204,25,25732491,1,118,25,25732490,1,214,25,25928904,1,180,25,25732549,1,126,25,25732602,1,182,25,25732539,1,175,25,25732545,1,141,25,25732559,1,138,25,25732537,1,177,25,25732534,1,153,25,25732503,1,194,25,25732606,1,160,25,25732567,1,121,25,25732538,1,174,25,25732497,1,246,25,25732550,1,130,25,25732572,1,200,25,25732474,1,170,25,25732511,1,221,25,25732601,1,196,25,25732532,1,142,25,25732519,1,210,25,25732495,1,199,25,25732605,1,155,25,25732535,1,154,25,25732499,1,244,25,25732510,1,220,25,25732600,1,195,25,25732607,1,161,25,25732604,1,231,25,25732473,1,173,25,25732599,1,226,26,51465122,1,116,26,51465123,0,1],G=[3,3,3,3,2,2,2,1,1,1];function H(se){var oe=se[1],ee=se[0][oe>>>3]>>>7-(7&oe)&1;return se[1]++,ee}function W(se,oe){if(I==null){I={};for(var ee=0;ee<j.length;ee+=4)I[j[ee+1]]=j.slice(ee,ee+4)}for(var ae=H(se),ce=I[ae];ce==null;)ae=ae<<1|H(se),ce=I[ae];var le=ce[3];le!=0&&(le=H(se)==0?le:-le),oe[0]=ce[2],oe[1]=le}function V(se,oe){for(var ee=0;ee<oe;ee++)1&~se||se++,se>>>=1;return se}function K(se,oe){return se>>oe}function Z(se,oe,ee,ae,ce,le){oe[ee]=K(K(11*se[ce]-4*se[ce+le]+se[ce+le+le]+4,3)+se[ae],1),oe[ee+le]=K(K(5*se[ce]+4*se[ce+le]-se[ce+le+le]+4,3)-se[ae],1)}function Q(se,oe,ee,ae,ce,le){var de=se[ce-le]-se[ce+le],_e=se[ce],we=se[ae];oe[ee]=K(K(de+4,3)+_e+we,1),oe[ee+le]=K(K(4-de,3)+_e-we,1)}function J(se,oe,ee,ae,ce,le){oe[ee]=K(K(5*se[ce]+4*se[ce-le]-se[ce-le-le]+4,3)+se[ae],1),oe[ee+le]=K(K(11*se[ce]-4*se[ce-le]+se[ce-le-le]+4,3)-se[ae],1)}function re(se){return se=q[se=se<0?0:se>4095?4095:se]>>>2}return function(se,oe,ee,ae,ce,le){ae=new Uint16Array(ae.buffer);var de,_e,we,pe,xe,Ge,Te,Ce,Oe=Date.now(),bt=w._binBE,Mt=oe+ee;oe+=4;for(var lt=le[0]==1;oe<Mt;){var ir=bt.readShort(se,oe),Ye=bt.readUshort(se,oe+2);if(oe+=4,ir==12)dr=Ye;else if(ir==20)de=Ye;else if(ir==21)_e=Ye;else if(ir==48)we=Ye;else if(ir==53)pe=Ye;else if(ir!=35){if(ir==62)xe=Ye;else if(ir!=101){if(ir==109)Ge=Ye;else if(ir!=84){if(ir!=106){if(ir!=107){if(ir!=108){if(ir!=102){if(ir==104)xn=Ye;else if(ir!=105){var xt=ir<0?-ir:ir,ar=65280&xt,ht=0;if(24576&xt&&(8192&xt?(ht=65535&Ye,ht+=(255&xt)<<16):ht=65535&Ye),24576&~xt){if(xt==16388)oe+=4*ht;else if(ar!=8192&&ar!=8448&&ar!=9216)throw xt.toString(16)}else{if(Te==null){Te=[];for(var gt=0;gt<4;gt++)Te[gt]=new Int16Array((de>>>1)*(_e>>>1));for(Ce=new Int16Array((de>>>1)*(_e>>>1)),D=new Int16Array(1024),gt=0;gt<1024;gt++){var zt=gt-512,ur=Math.abs(zt),dr=Math.floor(768*ur*ur*ur/16581375)+ur;D[gt]=Math.sign(zt)*dr}for(q=new Uint16Array(4096),gt=0;gt<4096;gt++){var fr=gt,Ft=65535*(Math.pow(113,fr/4095)-1)/112;q[gt]=Math.min(Ft,65535)}}var $e=Te[xe],Bt=V(de,1+G[we]),Qe=V(_e,1+G[we]);if(we==0)for(var st=0;st<Qe;st++)for(var at=0;at<Bt;at++){var pt=oe+2*(st*Bt+at);$e[st*(de>>>1)+at]=se[pt]<<8|se[pt+1]}else{var sr=[se,8*oe],Ee=[],ze=0,ct=Bt*Qe,ft=[0,0],pr=0;for(Ye=0;ze<ct;)for(W(sr,ft),pr=ft[0],Ye=ft[1];pr>0;)Ee[ze++]=Ye,pr--;var fn=(we-1)%3,vn=fn!=1?Bt:0,En=fn!=0?Qe:0;for(st=0;st<Qe;st++){var bn=(st+En)*(de>>>1)+vn,$n=st*Bt;for(at=0;at<Bt;at++)$e[bn+at]=D[Ee[$n+at]+512]*pe}if(fn==2){var xn=de>>>1,ti=2*Bt,Cn=2*Qe;for(st=0;st<Qe;st++)for(at=0;at<ti;at++){gt=2*st*xn+at;var On=Qe*xn+(Tn=st*xn+at);st==0?Z($e,Ce,gt,On,Tn,xn):st==Qe-1?J($e,Ce,gt,On,Tn,xn):Q($e,Ce,gt,On,Tn,xn)}var si=$e;for($e=Ce,Ce=si,st=0;st<Cn;st++)for(at=0;at<Bt;at++){var Tn;gt=st*xn+2*at,On=Bt+(Tn=st*xn+at),at==0?Z($e,Ce,gt,On,Tn,1):at==Bt-1?J($e,Ce,gt,On,Tn,1):Q($e,Ce,gt,On,Tn,1)}si=$e,$e=Ce,Ce=si;for(var or=[],kn=2-~~((we-1)/3),mr=0;mr<3;mr++)or[mr]=Ge>>14-2*mr&3;var yn=or[kn];if(yn!=0)for(st=0;st<Cn;st++)for(at=0;at<ti;at++)$e[gt=st*xn+at]=$e[gt]<<yn}}if(we==9&&xe==3){var Dt=Te[0],wn=Te[1],ii=Te[2],Ze=Te[3];for(st=0;st<_e;st+=2)for(at=0;at<de;at+=2){var _n=st*de+at,hn=Dt[pt=(st>>>1)*(de>>>1)+(at>>>1)],cr=wn[pt]-2048,gn=ii[pt]-2048,mn=Ze[pt]-2048,ri=(cr<<1)+hn,An=(gn<<1)+hn,ei=hn+mn,oi=hn-mn;lt?(ae[_n]=re(ei),ae[_n+1]=re(An),ae[_n+de]=re(ri),ae[_n+de+1]=re(oi)):(ae[_n]=re(ri),ae[_n+1]=re(ei),ae[_n+de]=re(oi),ae[_n+de+1]=re(An))}}oe+=4*ht}}}}}}}}}}console.log(Date.now()-Oe)}})(),w.decode._decodeLogLuv32=function(I,D,q,j,G,H){for(var W=I.width,V=4*W,K=0,Z=new Uint8Array(V);K<j;){for(var Q=0;Q<V;){var J=D[q+K];if(K++,J<128){for(var re=0;re<J;re++)Z[Q+re]=D[q+K+re];Q+=J,K+=J}else{for(J-=126,re=0;re<J;re++)Z[Q+re]=D[q+K];Q+=J,K++}}for(var se=0;se<W;se++)G[H+0]=Z[se],G[H+1]=Z[se+W],G[H+2]=Z[se+2*W],G[H+4]=Z[se+3*W],H+=6}},w.decode._ljpeg_diff=function(I,D,q){var j,G,H=w.decode._getbithuff;return j=H(I,D,q[0],q),(G=H(I,D,j,0))&1<<j-1||(G-=(1<<j)-1),G},w.decode._decodeARW=function(I,D,q,j,G,H){var W=I.t256[0],V=I.t257[0],K=I.t258[0],Z=I.isLE?w._binLE:w._binBE;if(W*V==j||W*V*1.5==j)if(W*V*1.5!=j){var Q,J,re,se,oe,ee,ae,ce,le=new Uint16Array(16),de=new Uint8Array(W+1);for(Oe=0;Oe<V;Oe++){for(var _e=0;_e<W;_e++)de[_e]=D[q++];for(ce=0,Ce=0;Ce<W-30;ce+=16){for(J=2047&(Q=Z.readUint(de,ce)),re=2047&Q>>>11,se=15&Q>>>22,oe=15&Q>>>26,ee=0;ee<4&&128<<ee<=J-re;ee++);for(ae=30,we=0;we<16;we++)we==se?le[we]=J:we==oe?le[we]=re:(le[we]=((Z.readUshort(de,ce+(ae>>3))>>>(7&ae)&127)<<ee)+re,le[we]>2047&&(le[we]=2047),ae+=7);for(we=0;we<16;we++,Ce+=2)ht=le[we]<<1,w.decode._putsF(G,(Oe*W+Ce)*K,ht<<16-K);Ce-=1&Ce?1:31}}}else for(var we=0;we<j;we+=3){var pe=D[q+we+0],xe=D[q+we+1],Ge=D[q+we+2];G[H+we]=xe<<4|pe>>>4,G[H+we+1]=pe<<4|Ge>>>4,G[H+we+2]=Ge<<4|xe>>>4}else{V+=8;var Te,Ce,Oe,bt=[q,0,0,0],Mt=new Uint16Array(32770),lt=[3857,3856,3599,3342,3085,2828,2571,2314,2057,1800,1543,1286,1029,772,771,768,514,513],ir=0,Ye=w.decode._ljpeg_diff;for(Mt[0]=15,Te=we=0;we<18;we++)for(var xt=32768>>>(lt[we]>>>8),ar=0;ar<xt;ar++)Mt[++Te]=lt[we];for(Ce=W;Ce--;)for(Oe=0;Oe<V+1;Oe+=2)if(Oe==V&&(Oe=1),ir+=Ye(D,bt,Mt),Oe<V){var ht=4095&ir;w.decode._putsF(G,(Oe*W+Ce)*K,ht<<16-K)}}},w.decode._decodeNikon=function(I,D,q,j,G,H,W){var V=[[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,5,4,3,6,2,7,1,0,8,9,11,10,12],[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,57,90,56,39,22,5,4,3,2,1,0,11,12,12],[0,0,1,4,2,3,1,2,0,0,0,0,0,0,0,0,0,5,4,6,3,7,2,8,1,9,0,10,11,12],[0,0,1,4,3,1,1,1,1,1,2,0,0,0,0,0,0,5,6,4,7,8,3,9,2,1,0,10,11,12,13,14],[0,0,1,5,1,1,1,1,1,1,1,2,0,0,0,0,0,8,92,75,58,41,7,6,5,4,3,2,1,0,13,14],[0,0,1,4,2,2,3,1,2,0,0,0,0,0,0,0,0,7,6,8,5,9,4,10,3,11,12,2,0,1,13,14]],K=I.t256[0],Z=I.t257[0],Q=I.t258[0],J=0,re=0,se=w.decode._make_decoder,oe=w.decode._getbithuff,ee=D[0].exifIFD.makerNote,ae=ee.t150?ee.t150:ee.t140,ce=0,le=ae[ce++],de=ae[ce++];le!=73&&de!=88||(ce+=2110),le==70&&(J=2),Q==14&&(J+=3);for(var _e=[[0,0],[0,0]],we=I.isLE?w._binLE:w._binBE,pe=0;pe<2;pe++)for(var xe=0;xe<2;xe++)_e[pe][xe]=we.readShort(ae,ce),ce+=2;var Ge,Te,Ce,Oe,bt,Mt=1<<Q&32767,lt=0,ir=we.readShort(ae,ce);ce+=2,ir>1&&(lt=Math.floor(Mt/(ir-1))),le==68&&de==32&&lt>0&&(re=we.readShort(ae,562));var Ye=[0,0],xt=se(V[J]),ar=[j,0,0,0];for(Ge=0;Ge<Z;Ge++)for(re&&Ge==re&&(xt=se(V[J+1])),Te=0;Te<K;Te++){pe=oe(q,ar,xt[0],xt),(bt=1+(oe(q,ar,(Ce=15&pe)-(Oe=pe>>>4),0)<<1)<<Oe>>>1)&1<<Ce-1||(bt-=(1<<Ce)-(Oe==0?1:0)),Te<2?Ye[Te]=_e[1&Ge][Te]+=bt:Ye[1&Te]+=bt;var ht=Math.min(Math.max(Ye[1&Te],0),(1<<Q)-1),gt=(Ge*K+Te)*Q;w.decode._putsF(H,gt,ht<<16-Q)}},w.decode._putsF=function(I,D,q){q<<=8-(7&D);var j=D>>>3;I[j]|=q>>>16,I[j+1]|=q>>>8,I[j+2]|=q},w.decode._getbithuff=function(I,D,q,j){var G;w.decode._get_byte;var H=D[0],W=D[1],V=D[2],K=D[3];if(q==0||V<0)return 0;for(;!K&&V<q&&(G=I[H++])!=-1&&!(K=0);)W=(W<<8)+G,V+=8;if(G=W<<32-V>>>32-q,j?(V-=j[G+1]>>>8,G=255&j[G+1]):V-=q,V<0)throw"e";return D[0]=H,D[1]=W,D[2]=V,D[3]=K,G},w.decode._make_decoder=function(I){var D,q,j,G,H,W=[];for(D=16;D!=0&&!I[D];D--);var V=17;for(W[0]=D,j=q=1;q<=D;q++)for(G=0;G<I[q];G++,++V)for(H=0;H<1<<D-q;H++)j<=1<<D&&(W[j++]=q<<8|I[V]);return W},w.decode._decodeNewJPEG=function(I,D,q,j,G,H){j=Math.min(j,D.length-q);var W=I.t347,V=W?W.length:0,K=new Uint8Array(V+j);if(W){for(var Z=0,Q=0;Q<V-1&&(W[Q]!=255||W[Q+1]!=217);Q++)K[Z++]=W[Q];var J=D[q],re=D[q+1];for(J==255&&re==216||(K[Z++]=J,K[Z++]=re),Q=2;Q<j;Q++)K[Z++]=D[q+Q]}else for(Q=0;Q<j;Q++)K[Q]=D[q+Q];if(I.t262[0]==32803||I.t259[0]==7&&I.t262[0]==34892){var se=I.t258[0],oe=w.LosslessJpegDecode(K),ee=oe.length;if(se==16)if(I.isLE)for(Q=0;Q<ee;Q++)G[H+(Q<<1)]=255&oe[Q],G[H+(Q<<1)+1]=oe[Q]>>>8;else for(Q=0;Q<ee;Q++)G[H+(Q<<1)]=oe[Q]>>>8,G[H+(Q<<1)+1]=255&oe[Q];else if(se==14||se==12||se==10){var ae=16-se;for(Q=0;Q<ee;Q++)w.decode._putsF(G,Q*se,oe[Q]<<ae)}else{if(se!=8)throw new Error("unsupported bit depth "+se);for(Q=0;Q<ee;Q++)G[H+Q]=oe[Q]}}else{var ce=new w.JpegDecoder;ce.parse(K);var le=ce.getData({width:ce.width,height:ce.height,forceRGB:!0,isSourcePDF:!1});for(Q=0;Q<le.length;Q++)G[H+Q]=le[Q]}I.t262[0]==6&&(I.t262[0]=2)},w.decode._decodeOldJPEGInit=function(I,D,q,j){var G,H,W,V,K,Z=216,Q=0,J=0,re=!1,se=I.t513,oe=se?se[0]:0,ee=I.t514,ae=ee?ee[0]:0,ce=I.t324||I.t273||se,le=I.t530,de=0,_e=0,we=I.t277?I.t277[0]:1,pe=I.t515;if(ce&&(J=ce[0],re=ce.length>1),!re){if(D[q]==255&&D[q+1]==Z)return{jpegOffset:q};if(se!=null&&(D[q+oe]==255&&D[q+oe+1]==Z?Q=q+oe:g("JPEGInterchangeFormat does not point to SOI"),ee==null?g("JPEGInterchangeFormatLength field is missing"):(oe>=J||oe+ae<=J)&&g("JPEGInterchangeFormatLength field value is invalid"),Q!=null))return{jpegOffset:Q}}if(le!=null&&(de=le[0],_e=le[1]),se!=null&&ee!=null)if(ae>=2&&oe+ae<=J){for(G=D[q+oe+ae-2]==255&&D[q+oe+ae-1]==Z?new Uint8Array(ae-2):new Uint8Array(ae),W=0;W<G.length;W++)G[W]=D[q+oe+W];g("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else g("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(G==null){var xe=0,Ge=[];Ge[xe++]=255,Ge[xe++]=Z;var Te=I.t519;if(Te==null)throw new Error("JPEGQTables tag is missing");for(W=0;W<Te.length;W++)for(Ge[xe++]=255,Ge[xe++]=219,Ge[xe++]=0,Ge[xe++]=67,Ge[xe++]=W,V=0;V<64;V++)Ge[xe++]=D[q+Te[W]+V];for(K=0;K<2;K++){var Ce=I[K==0?"t520":"t521"];if(Ce==null)throw new Error((K==0?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(W=0;W<Ce.length;W++){Ge[xe++]=255,Ge[xe++]=196;var Oe=19;for(V=0;V<16;V++)Oe+=D[q+Ce[W]+V];for(Ge[xe++]=Oe>>>8,Ge[xe++]=255&Oe,Ge[xe++]=W|K<<4,V=0;V<16;V++)Ge[xe++]=D[q+Ce[W]+V];for(V=0;V<Oe;V++)Ge[xe++]=D[q+Ce[W]+16+V]}}if(Ge[xe++]=255,Ge[xe++]=192,Ge[xe++]=0,Ge[xe++]=8+3*we,Ge[xe++]=8,Ge[xe++]=I.height>>>8&255,Ge[xe++]=255&I.height,Ge[xe++]=I.width>>>8&255,Ge[xe++]=255&I.width,Ge[xe++]=we,we==1)Ge[xe++]=1,Ge[xe++]=17,Ge[xe++]=0;else for(W=0;W<3;W++)Ge[xe++]=W+1,Ge[xe++]=W!=0?17:(15&de)<<4|15&_e,Ge[xe++]=W;pe!=null&&pe[0]!=0&&(Ge[xe++]=255,Ge[xe++]=221,Ge[xe++]=0,Ge[xe++]=4,Ge[xe++]=pe[0]>>>8&255,Ge[xe++]=255&pe[0]),G=new Uint8Array(Ge)}var bt=-1;for(W=0;W<G.length-1;){if(G[W]==255&&G[W+1]==192){bt=W;break}W++}if(bt==-1){var Mt=new Uint8Array(G.length+10+3*we);Mt.set(G);var lt=G.length;if(bt=G.length,(G=Mt)[lt++]=255,G[lt++]=192,G[lt++]=0,G[lt++]=8+3*we,G[lt++]=8,G[lt++]=I.height>>>8&255,G[lt++]=255&I.height,G[lt++]=I.width>>>8&255,G[lt++]=255&I.width,G[lt++]=we,we==1)G[lt++]=1,G[lt++]=17,G[lt++]=0;else for(W=0;W<3;W++)G[lt++]=W+1,G[lt++]=W!=0?17:(15&de)<<4|15&_e,G[lt++]=W}if(D[J]==255&&D[J+1]==218){var ir=D[J+2]<<8|D[J+3];for((H=new Uint8Array(ir+2))[0]=D[J],H[1]=D[J+1],H[2]=D[J+2],H[3]=D[J+3],W=0;W<ir-2;W++)H[W+4]=D[J+W+4]}else{var Ye=0;if((H=new Uint8Array(8+2*we))[Ye++]=255,H[Ye++]=218,H[Ye++]=0,H[Ye++]=6+2*we,H[Ye++]=we,we==1)H[Ye++]=1,H[Ye++]=0;else for(W=0;W<3;W++)H[Ye++]=W+1,H[Ye++]=W<<4|W;H[Ye++]=0,H[Ye++]=63,H[Ye++]=0}return{jpegOffset:q,tables:G,sosMarker:H,sofPosition:bt}},w.decode._decodeOldJPEG=function(I,D,q,j,G,H){var W,V,K,Z,Q=w.decode._decodeOldJPEGInit(I,D,q,j);if(Q.jpegOffset!=null)for(W=q+j-Q.jpegOffset,K=new Uint8Array(W),se=0;se<W;se++)K[se]=D[Q.jpegOffset+se];else{for(V=Q.tables.length,(K=new Uint8Array(V+Q.sosMarker.length+j+2)).set(Q.tables),Z=V,K[Q.sofPosition+5]=I.height>>>8&255,K[Q.sofPosition+6]=255&I.height,K[Q.sofPosition+7]=I.width>>>8&255,K[Q.sofPosition+8]=255&I.width,D[q]==255&&D[q+1]==SOS||(K.set(Q.sosMarker,Z),Z+=sosMarker.length),se=0;se<j;se++)K[Z++]=D[q+se];K[Z++]=255,K[Z++]=EOI}var J=new w.JpegDecoder;J.parse(K);for(var re=J.getData({width:J.width,height:J.height,forceRGB:!0,isSourcePDF:!1}),se=0;se<re.length;se++)G[H+se]=re[se];I.t262&&I.t262[0]==6&&(I.t262[0]=2)},w.decode._decodePackBits=function(I,D,q,j,G){for(var H=new Int8Array(I.buffer),W=new Int8Array(j.buffer),V=D+q;D<V;){var K=H[D];if(D++,K>=0&&K<128)for(var Z=0;Z<K+1;Z++)W[G]=H[D],G++,D++;if(K>=-127&&K<0){for(Z=0;Z<1-K;Z++)W[G]=H[D],G++;D++}}return G},w.decode._decodeThunder=function(I,D,q,j,G){for(var H=[0,1,0,-1],W=[0,1,2,3,0,-3,-2,-1],V=D+q,K=2*G,Z=0;D<V;){var Q=I[D],J=Q>>>6,re=63&Q;if(D++,J==3&&(Z=15&re,j[K>>>1]|=Z<<4*(1-K&1),K++),J==0)for(var se=0;se<re;se++)j[K>>>1]|=Z<<4*(1-K&1),K++;if(J==2)for(se=0;se<2;se++)(oe=re>>>3*(1-se)&7)!=4&&(Z+=W[oe],j[K>>>1]|=Z<<4*(1-K&1),K++);if(J==1)for(se=0;se<3;se++){var oe;(oe=re>>>2*(2-se)&3)!=2&&(Z+=H[oe],j[K>>>1]|=Z<<4*(1-K&1),K++)}}},w.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3},w.decode._lens=(function(){var I=function(K,Z,Q,J){for(var re=0;re<Z.length;re++)K[Z[re]]=Q+re*J},D="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",q="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",j="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",G="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",H="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";D=D.split(","),q=q.split(","),j=j.split(","),G=G.split(","),H=H.split(",");var W={},V={};return I(W,D,0,1),I(W,j,64,64),I(W,H,1792,64),I(V,q,0,1),I(V,G,64,64),I(V,H,1792,64),[W,V]})(),w.decode._decodeG4=function(I,D,q,j,G,H,W){for(var V=w.decode,K=D<<3,Z=0,Q="",J=[],re=[],se=0;se<H;se++)re.push(0);re=V._makeDiff(re);for(var oe=0,ee=0,ae=0,ce=0,le=0,de=0,_e="",we=0,pe=8*Math.ceil(H/8);K>>>3<D+q;){ae=V._findDiff(re,oe+(oe==0?0:1),1-le),ce=V._findDiff(re,ae,le);var xe=0;if(W==1&&(xe=I[K>>>3]>>>7-(7&K)&1),W==2&&(xe=I[K>>>3]>>>(7&K)&1),K++,Q+=xe,_e=="H"){if(V._lens[le][Q]!=null){var Ge=V._lens[le][Q];Q="",Z+=Ge,Ge<64&&(V._addNtimes(J,Z,le),oe+=Z,le=1-le,Z=0,--we==0&&(_e=""))}}else Q=="0001"&&(Q="",V._addNtimes(J,ce-oe,le),oe=ce),Q=="001"&&(Q="",_e="H",we=2),V._dmap[Q]!=null&&(ee=ae+V._dmap[Q],V._addNtimes(J,ee-oe,le),oe=ee,Q="",le=1-le);J.length==H&&_e==""&&(V._writeBits(J,j,8*G+de*pe),le=0,de++,oe=0,re=V._makeDiff(J),J=[])}},w.decode._findDiff=function(I,D,q){for(var j=0;j<I.length;j+=2)if(I[j]>=D&&I[j+1]==q)return I[j]},w.decode._makeDiff=function(I){var D=[];I[0]==1&&D.push(0,1);for(var q=1;q<I.length;q++)I[q-1]!=I[q]&&D.push(q,I[q]);return D.push(I.length,0,I.length,1),D},w.decode._decodeG2=function(I,D,q,j,G,H,W){for(var V=w.decode,K=D<<3,Z=0,Q="",J=[],re=0,se=0,oe=8*Math.ceil(H/8);K>>>3<D+q;){var ee=0;W==1&&(ee=I[K>>>3]>>>7-(7&K)&1),W==2&&(ee=I[K>>>3]>>>(7&K)&1),K++,Q+=ee,(Z=V._lens[re][Q])!=null&&(V._addNtimes(J,Z,re),Q="",Z<64&&(re=1-re),J.length==H&&(V._writeBits(J,j,8*G+se*oe),J=[],se++,re=0,7&K&&(K+=8-(7&K)),Z>=64&&(K+=8)))}},w.decode._decodeG3=function(I,D,q,j,G,H,W,V){for(var K=w.decode,Z=D<<3,Q=0,J="",re=[],se=[],oe=0;oe<H;oe++)re.push(0);for(var ee=0,ae=0,ce=0,le=0,de=0,_e=-1,we="",pe=0,xe=!0,Ge=8*Math.ceil(H/8);Z>>>3<D+q;){ce=K._findDiff(se,ee+(ee==0?0:1),1-de),le=K._findDiff(se,ce,de);var Te=0;if(W==1&&(Te=I[Z>>>3]>>>7-(7&Z)&1),W==2&&(Te=I[Z>>>3]>>>(7&Z)&1),Z++,J+=Te,xe){if(K._lens[de][J]!=null){var Ce=K._lens[de][J];J="",Q+=Ce,Ce<64&&(K._addNtimes(re,Q,de),de=1-de,Q=0)}}else we=="H"?K._lens[de][J]!=null&&(Ce=K._lens[de][J],J="",Q+=Ce,Ce<64&&(K._addNtimes(re,Q,de),ee+=Q,de=1-de,Q=0,--pe==0&&(we=""))):(J=="0001"&&(J="",K._addNtimes(re,le-ee,de),ee=le),J=="001"&&(J="",we="H",pe=2),K._dmap[J]!=null&&(ae=ce+K._dmap[J],K._addNtimes(re,ae-ee,de),ee=ae,J="",de=1-de));J.endsWith("000000000001")&&(_e>=0&&K._writeBits(re,j,8*G+_e*Ge),V&&(W==1&&(xe=(I[Z>>>3]>>>7-(7&Z)&1)==1),W==2&&(xe=(I[Z>>>3]>>>(7&Z)&1)==1),Z++),J="",de=0,_e++,ee=0,se=K._makeDiff(re),re=[])}re.length==H&&K._writeBits(re,j,8*G+_e*Ge)},w.decode._addNtimes=function(I,D,q){for(var j=0;j<D;j++)I.push(q)},w.decode._writeBits=function(I,D,q){for(var j=0;j<I.length;j++)D[q+j>>>3]|=I[j]<<7-(q+j&7)},w.decode._decodeLZW=w.decode._decodeLZW=(function(){var I,D,q,j,G=0,H=0,W=0,V=0,K=function(){var oe=I>>>3,ee=(D[oe]<<16|D[oe+1]<<8|D[oe+2])>>>24-(7&I)-H&(1<<H)-1;return I+=H,ee},Z=new Uint32Array(16384),Q=0,J=function(oe){H=oe+1,G=V+1},re=function(oe){for(var ee=oe<<2,ae=Z[ee+2],ce=j+ae-1;ee!=65535;)q[ce--]=Z[ee],ee=Z[ee+1];j+=ae},se=function(oe,ee){var ae=G<<2,ce=oe<<2;Z[ae]=Z[3+(ee<<2)],Z[ae+1]=ce,Z[ae+2]=Z[ce+2]+1,Z[ae+3]=Z[ce+3],++G+1==1<<H&&H!=12&&H++};return function(oe,ee,ae,ce,le,de){I=ee<<3,D=oe,q=ce,j=le;var _e=ee+ae<<3,we=0,pe=0;for((function(xe){if(xe!=Q){Q=xe,V=1+(W=1<<xe);for(var Ge=0;Ge<V+1;Ge++)Z[4*Ge]=Z[4*Ge+3]=Ge,Z[4*Ge+1]=65535,Z[4*Ge+2]=1}})(de),J(de);I<_e&&(we=K())!=V;){if(we==W){if(J(de),(we=K())==V)break;re(we)}else we<G?(re(we),se(pe,we)):(se(pe,pe),re(G-1));pe=we}return j}})(),w.tags={},w._types=(function(){var I=new Array(250);return I.fill(0),{basic:{main:I=I.concat([0,0,0,0,4,3,3,3,3,3,0,0,3,0,0,0,3,0,0,2,2,2,2,4,3,0,0,3,4,4,3,3,5,5,3,2,5,5,0,0,0,0,4,4,0,0,3,3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,2,2,3,5,5,3,0,3,3,4,4,4,3,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),rest:{33432:2,33434:5,33437:5,34665:4,34850:3,34853:4,34855:3,34864:3,34866:4,36864:7,36867:2,36868:2,37121:7,37377:10,37378:5,37380:10,37381:5,37383:3,37384:3,37385:3,37386:5,37510:7,37520:2,37521:2,37522:2,40960:7,40961:3,40962:4,40963:4,40965:4,41486:5,41487:5,41488:3,41985:3,41986:3,41987:3,41988:5,41989:3,41990:3,41993:3,41994:3,41995:7,41996:3,42032:2,42033:2,42034:5,42036:2,42037:2,59932:7}},gps:{main:[1,2,5,2,5,1,5,5,0,9],rest:{18:2,29:2}}}})(),w._readIFD=function(I,D,q,j,G,H){var W=I.readUshort(D,q);q+=2;var V={};H.debug&&g("   ".repeat(G),j.length-1,">>>----------------");for(var K=0;K<W;K++){var Z=I.readUshort(D,q);q+=2;var Q=I.readUshort(D,q);q+=2;var J=I.readUint(D,q);q+=4;var re=I.readUint(D,q);q+=4;var se=[];if(Q==1||Q==7){var oe=J<5?q-4:re;oe+J>D.buffer.byteLength&&(J=D.buffer.byteLength-oe),se=new Uint8Array(D.buffer,oe,J)}if(Q==2){var ee=J<5?q-4:re,ae=D[ee],ce=Math.max(0,Math.min(J-1,D.length-ee));ae<128||ce==0?se.push(I.readASCII(D,ee,ce)):se=new Uint8Array(D.buffer,ee,ce)}if(Q==3)for(var le=0;le<J;le++)se.push(I.readUshort(D,(J<3?q-4:re)+2*le));if(Q==4||Q==13)for(le=0;le<J;le++)se.push(I.readUint(D,(J<2?q-4:re)+4*le));if(Q==5||Q==10){var de=Q==5?I.readUint:I.readInt;for(le=0;le<J;le++)se.push([de(D,re+8*le),de(D,re+8*le+4)])}if(Q==8)for(le=0;le<J;le++)se.push(I.readShort(D,(J<3?q-4:re)+2*le));if(Q==9)for(le=0;le<J;le++)se.push(I.readInt(D,(J<2?q-4:re)+4*le));if(Q==11)for(le=0;le<J;le++)se.push(I.readFloat(D,re+4*le));if(Q==12)for(le=0;le<J;le++)se.push(I.readDouble(D,re+8*le));if(J==0||se.length!=0){if(H.debug&&g("   ".repeat(G),Z,Q,w.tags[Z],se),V["t"+Z]=se,!(Z==330&&V.t272&&V.t272[0]=="DSLR-A100")){if(Z==330||Z==34665||Z==34853||Z==50740&&I.readUshort(D,I.readUint(se,0))<300||Z==61440){var _e=Z==50740?[I.readUint(se,0)]:se,we=[];for(le=0;le<_e.length;le++)w._readIFD(I,D,_e[le],we,G+1,H);Z==330&&(V.subIFD=we),Z==34665&&(V.exifIFD=we[0]),Z==34853&&(V.gpsiIFD=we[0]),Z==50740&&(V.dngPrvt=we[0]),Z==61440&&(V.fujiIFD=we[0])}}if(Z==37500&&H.parseMN){var pe=se;if(I.readASCII(pe,0,5)=="Nikon")V.makerNote=w.decode(pe.slice(10).buffer)[0];else if(I.readASCII(pe,0,5)=="OLYMP"||I.readASCII(pe,0,9)=="OM SYSTEM"){var xe=[8208,8224,8240,8256,8272],Ge=[];w._readIFD(I,pe,pe[1]==77?16:pe[5]==85?12:8,Ge,G+1,H);var Te=V.makerNote=Ge.pop();for(le=0;le<xe.length;le++){var Ce="t"+xe[le];Te[Ce]!=null&&(w._readIFD(I,pe,Te[Ce][0],Ge,G+1,H),Te[Ce]=Ge.pop())}Te.t12288&&(w._readIFD(I,Te.t12288,0,Ge,G+1,H),Te.t12288=Ge.pop())}else I.readUshort(D,re)<300&&I.readUshort(D,re+4)<=12&&(Ge=[],w._readIFD(I,D,re,Ge,G+1,H),V.makerNote=Ge[0])}}else if(g(Z,"unknown TIFF tag type: ",Q,"num:",J),K==0)return}return j.push(V),H.debug&&g("   ".repeat(G),"<<<---------------"),q},w._writeIFD=function(I,D,q,j,G){var H=Object.keys(G),W=H.length;G.exifIFD&&W--,G.gpsiIFD&&W--,I.writeUshort(q,j,W);for(var V=(j+=2)+12*W+4,K=0;K<H.length;K++){var Z=H[K];if(Z!="t34665"&&Z!="t34853"){Z=="exifIFD"&&(Z="t34665"),Z=="gpsiIFD"&&(Z="t34853");var Q=parseInt(Z.slice(1)),J=D.main[Q];if(J==null&&(J=D.rest[Q]),J==null||J==0)throw new Error("unknown type of tag: "+Q);var re=G[Z];Q==34665&&(re=[V],V=w._writeIFD(I,D,q,V,G.exifIFD)[1]),Q==34853&&(re=[V],V=w._writeIFD(I,w._types.gps,q,V,G.gpsiIFD)[1]),J==2&&(re=re[0]+"\0");var se=re.length;I.writeUshort(q,j,Q),j+=2,I.writeUshort(q,j,J),j+=2,I.writeUint(q,j,se);var oe=[-1,1,1,2,4,8,0,1,0,4,8,0,8][J]*se,ee=j+=4;if(oe>4&&(I.writeUint(q,j,V),ee=V),J==1||J==7)for(var ae=0;ae<se;ae++)q[ee+ae]=re[ae];else if(J==2)I.writeASCII(q,ee,re);else if(J==3)for(ae=0;ae<se;ae++)I.writeUshort(q,ee+2*ae,re[ae]);else if(J==4)for(ae=0;ae<se;ae++)I.writeUint(q,ee+4*ae,re[ae]);else if(J==5||J==10){var ce=J==5?I.writeUint:I.writeInt;for(ae=0;ae<se;ae++){var le=re[ae],de=le[0],_e=le[1];if(de==null)throw"e";ce(q,ee+8*ae,de),ce(q,ee+8*ae+4,_e)}}else if(J==9)for(ae=0;ae<se;ae++)I.writeInt(q,ee+4*ae,re[ae]);else{if(J!=12)throw J;for(ae=0;ae<se;ae++)I.writeDouble(q,ee+8*ae,re[ae])}oe>4&&(V+=oe+=1&oe),j+=4}}return[j,V]},w.toRGBA8=function(I,D){function q(vn){return vn<.0031308?12.92*vn:1.055*Math.pow(vn,1/2.4)-.055}var j=I.width,G=I.height,H=j*G,W=I.data,V=new Uint8Array(4*H),K=I.t262?I.t262[0]:2,Z=I.t258?Math.min(32,I.t258[0]):1;I.t262==null&&Z==1&&(K=0);var Q=I.t277?I.t277[0]:I.t258?I.t258.length:[1,1,3,1,1,4,3][K],J=I.t339?I.t339[0]:null;if(K==1&&Z==32&&J!=3)throw"e";var re=Math.ceil(Q*Z*j/8);if(K==0){D=1/256;for(var se=0;se<G;se++){var oe=se*re,ee=se*j;if(Z==1)for(var ae=0;ae<j;ae++){var ce=ee+ae<<2,le=W[oe+(ae>>3)]>>7-(7&ae)&1;V[ce]=V[ce+1]=V[ce+2]=255*(1-le),V[ce+3]=255}if(Z==4)for(ae=0;ae<j;ae++)ce=ee+ae<<2,le=W[oe+(ae>>1)]>>4-4*(1&ae)&15,V[ce]=V[ce+1]=V[ce+2]=17*(15-le),V[ce+3]=255;if(Z==8)for(ae=0;ae<j;ae++)ce=ee+ae<<2,le=W[oe+ae],V[ce]=V[ce+1]=V[ce+2]=255-le,V[ce+3]=255;if(Z==16)for(ae=0;ae<j;ae++)ce=ee+ae<<2,le=W[(_e=oe+2*ae)+1]<<8|W[_e],V[ce]=V[ce+1]=V[ce+2]=Math.min(255,255-~~(le*D)),V[ce+3]=255}}else if(K==1){D==null&&(D=1/256);var de=3&W.length?null:new Float32Array(W.buffer);for(se=0;se<G;se++){if(oe=se*re,ee=se*j,Z==1)for(ae=0;ae<j;ae++)ce=ee+ae<<2,le=W[oe+(ae>>3)]>>7-(7&ae)&1,V[ce]=V[ce+1]=V[ce+2]=255*le,V[ce+3]=255;if(Z==2)for(ae=0;ae<j;ae++)ce=ee+ae<<2,le=W[oe+(ae>>2)]>>6-2*(3&ae)&3,V[ce]=V[ce+1]=V[ce+2]=85*le,V[ce+3]=255;if(Z==8)for(ae=0;ae<j;ae++)ce=ee+ae<<2,le=W[oe+ae*Q],V[ce]=V[ce+1]=V[ce+2]=le,V[ce+3]=255;if(Z==16)for(ae=0;ae<j;ae++)ce=ee+ae<<2,le=W[(_e=oe+2*ae)+1]<<8|W[_e],V[ce]=V[ce+1]=V[ce+2]=Math.min(255,~~(le*D)),V[ce+3]=255;if(Z==32)for(ae=0;ae<j;ae++){var _e;ce=ee+ae<<2,le=de[_e=(oe>>>2)+ae],V[ce]=V[ce+1]=V[ce+2]=~~(.5+255*le),V[ce+3]=255}}}else if(K==2)if(Z==8){if(Q==1)for(ae=0;ae<H;ae++)V[4*ae]=V[4*ae+1]=V[4*ae+2]=W[ae],V[4*ae+3]=255;if(Q==3)for(ae=0;ae<H;ae++){var we=3*ae;V[ce=ae<<2]=W[we],V[ce+1]=W[we+1],V[ce+2]=W[we+2],V[ce+3]=255}if(Q>=4)for(ae=0;ae<H;ae++)we=ae*Q,V[ce=ae<<2]=W[we],V[ce+1]=W[we+1],V[ce+2]=W[we+2],V[ce+3]=W[we+3]}else if(Z==16){if(Q==4)for(ae=0;ae<H;ae++)we=8*ae+1,V[ce=ae<<2]=W[we],V[ce+1]=W[we+2],V[ce+2]=W[we+4],V[ce+3]=W[we+6];if(Q==3)for(ae=0;ae<H;ae++)we=6*ae+1,V[ce=ae<<2]=W[we],V[ce+1]=W[we+2],V[ce+2]=W[we+4],V[ce+3]=255}else{if(Z!=32)throw Z;var pe=new Float32Array(W.buffer),xe=0;for(ae=0;ae<pe.length;ae++)xe=Math.min(xe,pe[ae]);if(xe<0)for(ae=0;ae<W.length;ae+=4){var Ge=W[ae];W[ae]=W[ae+3],W[ae+3]=Ge,Ge=W[ae+1],W[ae+1]=W[ae+2],W[ae+2]=Ge}var Te=[];for(ae=0;ae<65536;ae++)Te.push(q(ae/65535));for(ae=0;ae<pe.length;ae++){var Ce=Math.max(0,Math.min(1,pe[ae]));pe[ae]=Te[~~(.5+65535*Ce)]}if(Q==3)for(ae=0;ae<H;ae++)we=3*ae,V[ce=ae<<2]=~~(.5+255*pe[we]),V[ce+1]=~~(.5+255*pe[we+1]),V[ce+2]=~~(.5+255*pe[we+2]),V[ce+3]=255;else{if(Q!=4)throw Q;for(ae=0;ae<H;ae++)we=4*ae,V[ce=ae<<2]=~~(.5+255*pe[we]),V[ce+1]=~~(.5+255*pe[we+1]),V[ce+2]=~~(.5+255*pe[we+2]),V[ce+3]=~~(.5+255*pe[we+3])}}else if(K==3){var Oe=I.t320,bt=1<<Z,Mt=Z==8&&Q>1&&I.t338&&I.t338[0]!=0;for(se=0;se<G;se++)for(var lt=0;lt<j;lt++){ce=(ae=se*j+lt)<<2;var ir=0,Ye=se*re;if(Z==1)ir=W[Ye+(lt>>>3)]>>>7-(7&lt)&1;else if(Z==2)ir=W[Ye+(lt>>>2)]>>>6-2*(3&lt)&3;else if(Z==4)ir=W[Ye+(lt>>>1)]>>>4-4*(1&lt)&15;else{if(Z!=8)throw Z;ir=W[Ye+lt*Q]}V[ce]=Oe[ir]>>8,V[ce+1]=Oe[bt+ir]>>8,V[ce+2]=Oe[bt+bt+ir]>>8,V[ce+3]=Mt?W[Ye+lt*Q+1]:255}}else if(K==5){var xt=Q>4?1:0;for(ae=0;ae<H;ae++){ce=ae<<2;var ar=ae*Q;if(window.UDOC){var ht=W[ar],gt=W[ar+1],zt=W[ar+2],ur=W[ar+3],dr=UDOC.C.cmykToRgb([ht*(1/255),gt*(1/255),zt*(1/255),ur*(1/255)]);V[ce]=~~(.5+255*dr[0]),V[ce+1]=~~(.5+255*dr[1]),V[ce+2]=~~(.5+255*dr[2])}else ht=255-W[ar],gt=255-W[ar+1],zt=255-W[ar+2],ur=(255-W[ar+3])*(1/255),V[ce]=~~(ht*ur+.5),V[ce+1]=~~(gt*ur+.5),V[ce+2]=~~(zt*ur+.5);V[ce+3]=255*(1-xt)+W[ar+4]*xt}}else if(K==6&&I.t278){var fr=I.t278[0];for(se=0;se<G;se+=fr){ae=se*j;for(var Ft=fr*j,$e=0;$e<Ft;$e++){ce=4*(ae+$e),zt=W[(ar=3*ae+4*($e>>>1))+(1&$e)];var Bt=W[ar+2]-128,Qe=W[ar+3]-128,st=zt+((Qe>>2)+(Qe>>3)+(Qe>>5)),at=zt-((Bt>>2)+(Bt>>4)+(Bt>>5))-((Qe>>1)+(Qe>>3)+(Qe>>4)+(Qe>>5)),pt=zt+(Bt+(Bt>>1)+(Bt>>2)+(Bt>>6));V[ce]=Math.max(0,Math.min(255,st)),V[ce+1]=Math.max(0,Math.min(255,at)),V[ce+2]=Math.max(0,Math.min(255,pt)),V[ce+3]=255}}}else if(K==32845)for(se=0;se<G;se++)for(lt=0;lt<j;lt++){ce=4*(se*j+lt);var sr=W[(ar=6*(se*j+lt))+1]<<8|W[ar],Ee=(sr=Math.pow(2,(sr+.5)/256-64),(W[ar+3]+.5)/410),ze=(W[ar+5]+.5)/410,ct=9*Ee/(6*Ee-16*ze+12),ft=4*ze/(6*Ee-16*ze+12),pr=ct*sr/ft,fn=(1-ct-ft)*sr/ft;st=2.69*pr-1.276*(zt=sr)-.414*fn,at=-1.022*pr+1.978*zt+.044*fn,pt=.061*pr-.224*zt+1.163*fn,V[ce]=255*q(Math.min(st,1)),V[ce+1]=255*q(Math.min(at,1)),V[ce+2]=255*q(Math.min(pt,1)),V[ce+3]=255}else g("Unknown Photometric interpretation: "+K);return V},w.replaceIMG=function(I){I==null&&(I=document.getElementsByTagName("img"));for(var D=["tif","tiff","dng","cr2","nef"],q=0;q<I.length;q++){var j=I[q],G=j.getAttribute("src");if(G!=null){var H=G.split(".").pop().toLowerCase();if(D.indexOf(H)!=-1){var W=new XMLHttpRequest;w._xhrs.push(W),w._imgs.push(j),W.open("GET",G),W.responseType="arraybuffer",W.onload=w._imgLoaded,W.send()}}}},w._xhrs=[],w._imgs=[],w._imgLoaded=function(I){var D=w._xhrs.indexOf(I.target),q=w._imgs[D];w._xhrs.splice(D,1),w._imgs.splice(D,1),q.setAttribute("src",w.bufferToURI(I.target.response))},w.bufferToURI=function(I){var D=w.decode(I),q=D,j=0,G=q[0];D[0].subIFD&&(q=q.concat(D[0].subIFD));for(var H=0;H<q.length;H++){var W=q[H];if(!(W.t258==null||W.t258.length<3)){var V=W.t256*W.t257;V>j&&(j=V,G=W)}}w.decodeImage(I,G,D);var K=w.toRGBA8(G),Z=G.width,Q=G.height,J=document.createElement("canvas");J.width=Z,J.height=Q;var re=J.getContext("2d"),se=new ImageData(new Uint8ClampedArray(K.buffer),Z,Q);return re.putImageData(se,0,0),J.toDataURL()},w._binBE={nextZero:function(I,D){for(;I[D]!=0;)D++;return D},readUshort:function(I,D){return I[D]<<8|I[D+1]},readShort:function(I,D){var q=w._binBE.ui8;return q[0]=I[D+1],q[1]=I[D+0],w._binBE.i16[0]},readInt:function(I,D){var q=w._binBE.ui8;return q[0]=I[D+3],q[1]=I[D+2],q[2]=I[D+1],q[3]=I[D+0],w._binBE.i32[0]},readUint:function(I,D){var q=w._binBE.ui8;return q[0]=I[D+3],q[1]=I[D+2],q[2]=I[D+1],q[3]=I[D+0],w._binBE.ui32[0]},readASCII:function(I,D,q){for(var j="",G=0;G<q;G++)j+=String.fromCharCode(I[D+G]);return j},readFloat:function(I,D){for(var q=w._binBE.ui8,j=0;j<4;j++)q[j]=I[D+3-j];return w._binBE.fl32[0]},readDouble:function(I,D){for(var q=w._binBE.ui8,j=0;j<8;j++)q[j]=I[D+7-j];return w._binBE.fl64[0]},writeUshort:function(I,D,q){I[D]=q>>8&255,I[D+1]=255&q},writeInt:function(I,D,q){var j=w._binBE.ui8;w._binBE.i32[0]=q,I[D+3]=j[0],I[D+2]=j[1],I[D+1]=j[2],I[D+0]=j[3]},writeUint:function(I,D,q){I[D]=q>>24&255,I[D+1]=q>>16&255,I[D+2]=q>>8&255,I[D+3]=255&q},writeASCII:function(I,D,q){for(var j=0;j<q.length;j++)I[D+j]=q.charCodeAt(j)},writeDouble:function(I,D,q){w._binBE.fl64[0]=q;for(var j=0;j<8;j++)I[D+j]=w._binBE.ui8[7-j]}},w._binBE.ui8=new Uint8Array(8),w._binBE.i16=new Int16Array(w._binBE.ui8.buffer),w._binBE.i32=new Int32Array(w._binBE.ui8.buffer),w._binBE.ui32=new Uint32Array(w._binBE.ui8.buffer),w._binBE.fl32=new Float32Array(w._binBE.ui8.buffer),w._binBE.fl64=new Float64Array(w._binBE.ui8.buffer),w._binLE={nextZero:w._binBE.nextZero,readUshort:function(I,D){return I[D+1]<<8|I[D]},readShort:function(I,D){var q=w._binBE.ui8;return q[0]=I[D+0],q[1]=I[D+1],w._binBE.i16[0]},readInt:function(I,D){var q=w._binBE.ui8;return q[0]=I[D+0],q[1]=I[D+1],q[2]=I[D+2],q[3]=I[D+3],w._binBE.i32[0]},readUint:function(I,D){var q=w._binBE.ui8;return q[0]=I[D+0],q[1]=I[D+1],q[2]=I[D+2],q[3]=I[D+3],w._binBE.ui32[0]},readASCII:w._binBE.readASCII,readFloat:function(I,D){for(var q=w._binBE.ui8,j=0;j<4;j++)q[j]=I[D+j];return w._binBE.fl32[0]},readDouble:function(I,D){for(var q=w._binBE.ui8,j=0;j<8;j++)q[j]=I[D+j];return w._binBE.fl64[0]},writeUshort:function(I,D,q){I[D]=255&q,I[D+1]=q>>8&255},writeInt:function(I,D,q){var j=w._binBE.ui8;w._binBE.i32[0]=q,I[D+0]=j[0],I[D+1]=j[1],I[D+2]=j[2],I[D+3]=j[3]},writeUint:function(I,D,q){I[D]=q>>>0&255,I[D+1]=q>>>8&255,I[D+2]=q>>>16&255,I[D+3]=q>>>24&255},writeASCII:w._binBE.writeASCII},w._copyTile=function(I,D,q,j,G,H,W,V){for(var K=Math.min(D,G-W),Z=Math.min(q,H-V),Q=0;Q<Z;Q++)for(var J=(V+Q)*G+W,re=Q*D,se=0;se<K;se++)j[J+se]=I[re+se]},w.LosslessJpegDecode=(function(){var I,D;function q(){return I[D++]}function j(){return I[D++]<<8|I[D++]}function G(oe){for(var ee=q(),ae=[0,0,0,255],ce=[],le=0;le<16;le++)ce[le]=q();for(le=0;le<16;le++)for(var de=0;de<ce[le];de++)ae[H(ae,0,le+1,1)+3]=q();var _e=new Uint8Array(256);for(oe[ee]=[new Uint8Array(ae),_e],le=0;le<256;le++){for(var we=8,pe=le,xe=0;ae[xe+3]==255&&we!=0;)xe=ae[xe+(pe>>--we&1)];_e[le]=xe}}function H(oe,ee,ae,ce){if(oe[ee+3]!=255)return 0;if(ae==0)return ee;for(var le=0;le<2;le++){oe[ee+le]==0&&(oe[ee+le]=oe.length,oe.push(0,0,ce,255));var de=H(oe,oe[ee+le],ae-1,ce+1);if(de!=0)return de}return 0}function W(oe){for(var ee=oe.b,ae=oe.f;ee<25&&oe.a<oe.d;){var ce=oe.data[oe.a++];ce!=255||oe.c||oe.a++,ae=ae<<8|ce,ee+=8}if(ee<0)throw"e";oe.b=ee,oe.f=ae}function V(oe,ee){return ee.b<oe&&W(ee),ee.f>>(ee.b-=oe)&65535>>16-oe}function K(oe,ee){var ae=oe[0],ce=0,le=255;ee.b<16&&W(ee);var de=ee.f>>ee.b-8&255;for(le=ae[(ce=oe[1][de])+3],ee.b-=ae[ce+2];le==255;)le=ae[(ce=ae[ce+(ee.f>>--ee.b&1)])+3];return le}function Z(oe,ee){return oe<32768>>16-ee&&(oe+=1-(1<<ee)),oe}function Q(oe,ee){var ae=K(oe,ee);return ae==0?0:ae==16?-32768:Z(V(ae,ee),ae)}function J(oe,ee,ae,ce,le,de){for(var _e=0,we=0;we<de;we++){for(var pe=we*ee,xe=0;xe<ee;xe+=le){_e++;for(var Ge=0;Ge<le;Ge++)oe[pe+xe+Ge]=Q(ce[Ge],ae)}if(ae.e!=0&&_e%ae.e==0&&we!=0){for(var Te=ae.a,Ce=ae.data;Ce[Te]!=255||!(208<=Ce[Te+1]&&Ce[Te+1]<=215);)Te--;ae.a=Te+2,ae.f=0,ae.b=0}}}function re(oe,ee){return Z(V(oe,ee),oe)}function se(oe,ee,ae,ce,le,de,_e,we){for(var pe=ae*_e,xe=le;xe<de;xe++)oe[xe]+=1<<we-1;for(var Ge=_e;Ge<pe;Ge+=_e)for(xe=le;xe<de;xe++)oe[Ge+xe]+=oe[Ge+xe-_e];for(var Te=1;Te<ce;Te++){var Ce=Te*pe;for(xe=le;xe<de;xe++)oe[Ce+xe]+=oe[Ce+xe-pe];for(Ge=_e;Ge<pe;Ge+=_e)for(xe=le;xe<de;xe++){var Oe=Ce+Ge+xe,bt=Oe-pe,Mt=oe[Oe-_e],lt=0;if(ee==0)lt=0;else if(ee==1)lt=Mt;else if(ee==2)lt=oe[bt];else if(ee==3)lt=oe[bt-_e];else if(ee==4)lt=Mt+(oe[bt]-oe[bt-_e]);else if(ee==5)lt=Mt+(oe[bt]-oe[bt-_e]>>>1);else if(ee==6)lt=oe[bt]+(Mt-oe[bt-_e]>>>1);else{if(ee!=7)throw ee;lt=Mt+oe[bt]>>>1}oe[Oe]+=lt}}}return function(oe){if(I=oe,D=0,j()!=65496)throw"e";for(var ee=[],ae=0,ce=0,le=0,de=[],_e=[],we=[],pe=0,xe=0,Ge=0;;){var Te=j();if(Te!=65535){var Ce=j();if(Te==65475){ce=q(),xe=j(),Ge=j(),pe=q();for(var Oe=0;Oe<pe;Oe++){var bt=q(),Mt=q();if(q()!=0)throw"e";ee[bt]=[Oe,Mt>>4,15&Mt]}}else if(Te==65476)for(var lt=D+Ce-2;D<lt;)G(_e);else{if(Te==65498){for(D++,Oe=0;Oe<pe;Oe++){var ir=ee[q()];we[ir[0]]=_e[q()>>>4],de[ir[0]]=ir.slice(1)}ae=q(),D+=2;break}Te==65501?le=j():D+=Ce-2}}else D--}var Ye=new(ce>8?Uint16Array:Uint8Array)(xe*Ge*pe),xt={b:0,f:0,c:ae==8,a:D,data:I,d:I.length,e:le};if(xt.c)(function(pr,fn,vn,En,bn){for(var $n=I.length-D,xn=0;xn<$n;xn+=4){var ti=I[D+xn];I[D+xn]=I[D+xn+3],I[D+xn+3]=ti,ti=I[D+xn+1],I[D+xn+1]=I[D+xn+2],I[D+xn+2]=ti}for(var Cn=0;Cn<bn;Cn++)for(var On=32768,si=32768,Tn=0;Tn<fn;Tn+=2){var or=K(En,vn),kn=K(En,vn);or!=0&&(On+=re(or,vn)),kn!=0&&(si+=re(kn,vn)),pr[Cn*fn+Tn]=65535&On,pr[Cn*fn+Tn+1]=65535&si}})(Ye,Ge*pe,xt,we[0],xe);else{var ar=[],ht=0,gt=0;for(Oe=0;Oe<pe;Oe++){var zt=de[Oe];(pt=zt[0])>ht&&(ht=pt),(at=zt[1])>gt&&(gt=at),ar.push(pt*at)}if(ht!=1||gt!=1){if(pe!=3||ar[1]!=1||ar[2]!=1||ht!=2||gt!=1&&gt!=2)throw"e";var ur=[],dr=0;for(Oe=0;Oe<pe;Oe++){for(var fr=0;fr<ar[Oe];fr++)ur.push(we[Oe]);dr+=ar[Oe]}var Ft=Ge/ht,$e=xe/gt,Bt=Ft*$e;J(Ye,Ft*dr,xt,ur,dr,$e),se(Ye,ae,Ft,$e,dr-2,dr,dr,ce);var Qe=new Uint16Array(Bt*ar[0]);if(ht==2&&gt==2){for(Oe=0;Oe<Bt;Oe++)Qe[4*Oe]=Ye[6*Oe],Qe[4*Oe+1]=Ye[6*Oe+1],Qe[4*Oe+2]=Ye[6*Oe+2],Qe[4*Oe+3]=Ye[6*Oe+3];for(se(Qe,ae,4*Ft,$e,0,1,1,ce),Oe=0;Oe<Bt;Oe++)Ye[6*Oe]=Qe[4*Oe],Ye[6*Oe+1]=Qe[4*Oe+1],Ye[6*Oe+2]=Qe[4*Oe+2],Ye[6*Oe+3]=Qe[4*Oe+3]}if(ht==2&&gt==1){for(Oe=0;Oe<Bt;Oe++)Qe[2*Oe]=Ye[4*Oe],Qe[2*Oe+1]=Ye[4*Oe+1];for(se(Qe,ae,2*Ft,$e,0,1,1,ce),Oe=0;Oe<Bt;Oe++)Ye[4*Oe]=Qe[2*Oe],Ye[4*Oe+1]=Qe[2*Oe+1]}for(var st=Ye.slice(0),at=0;at<xe;at++)if(gt==2)for(var pt=0;pt<Ge;pt++){var sr=((at>>>1)*Ft+(pt>>>1))*dr,Ee=2*(1&at)+(1&pt);Ye[ze=(at*Ge+pt)*pe]=st[sr+Ee],Ye[ze+1]=st[sr+4],Ye[ze+2]=st[sr+5]}else for(pt=0;pt<Ge;pt++){var ze;sr=(at*Ft+(pt>>>1))*dr,Ee=1&pt,Ye[ze=(at*Ge+pt)*pe]=st[sr+Ee],Ye[ze+1]=st[sr+2],Ye[ze+2]=st[sr+3]}}else if(J(Ye,Ge*pe,xt,we,pe,xe),le==0)se(Ye,ae,Ge,xe,0,pe,pe,ce);else{var ct=Math.floor(le/Ge);for(at=0;at<xe;at+=ct){var ft=Ye.slice(at*Ge*pe,(at+ct)*Ge*pe);se(ft,ae,Ge,ct,0,pe,pe,ce),Ye.set(ft,at*Ge*pe)}}}return Ye}})(),(function(){var I=2,D=4,q=5,j=6,G=7,H=12,W=13,V=14,K=15,Z=17;function Q(de){var _e={c:new Int8Array(2<<de.u)};return(function(we,pe,xe){var Ge=[pe,3*pe+18,5*pe+67,7*pe+276,xe];we.o=pe,we.w=(Ge[4]+2*pe)/(2*pe+1)+1|0,we.v=Math.ceil(Math.log2(we.w)),we.t=9,(function(Te,Ce){for(var Oe=-Ce[4],bt=0;Oe<=Ce[4];bt++,Oe++)Te[bt]=Oe<=-276?-4:Oe<=-67?-3:Oe<=-18?-2:Oe<-0?-1:Oe<=Ce[0]?0:Oe<Ce[1]?1:Oe<Ce[2]?2:Oe<Ce[3]?3:4})(we.c,Ge)})(_e,0,de.g),_e}function J(de){for(var _e=[[],[],[]],we=Math.max(2,de.w+32>>>6),pe=0;pe<3;pe++)for(var xe=0;xe<41;xe++)_e[pe][xe]=[we,1];return _e}function re(de,_e){var we=0,pe=8-de.a;if(de.j,de.a,_e){if(_e>=pe)do we<<=pe,_e-=pe,we|=de[de.j]&(1<<pe)-1,de.j++,pe=8;while(_e>=8);_e&&(we<<=_e,pe-=_e,we|=de[de.j]>>>pe&(1<<_e)-1),de.a=8-pe}return we}function se(de,_e,we,pe,xe,Ge,Te,Ce){Ce==null&&(Ce=0);var Oe,bt,Mt,lt,ir,Ye,xt=Ge+1,ar=xt%2,ht=0,gt=pe[xe],zt=pe[xe-1],ur=pe[xe-2][xt],dr=zt[xt-1],fr=zt[xt],Ft=zt[xt+1],$e=gt[xt-1],Bt=gt[xt+1],Qe=Math.abs;if(ar&&(Mt=Qe(Ft-fr),lt=Qe(ur-fr),ir=Qe(dr-fr)),ar){if(Ye=(Ye=Mt>ir&&lt<Mt?ur+dr:Mt<ir&&lt<ir?ur+Ft:Ft+dr)+2*fr>>>2,Ce)return void(gt[xt]=Ye);Oe=_e.t*_e.c[de.g+fr-ur]+_e.c[de.g+dr-fr]}else Ye=fr>dr&&fr>Ft||fr<dr&&fr<Ft?Bt+$e+2*fr>>>2:$e+Bt>>>1,Oe=_e.t*_e.c[de.g+fr-dr]+_e.c[de.g+dr-$e];bt=Qe(Oe);var st=(function(pt){for(var sr=-1,Ee=0;!Ee;sr++)Ee=pt[pt.j]>>>7-pt.a&1,pt.a++,pt.a&=7,pt.a||pt.j++;return sr})(we);if(st<de.n-_e.v-1){var at=(function(pt,sr){var Ee=0;if(sr<pt)for(;Ee<=14&&sr<<++Ee<pt;);return Ee})(Te[bt][0],Te[bt][1]);ht=re(we,at)+(st<<at)}else ht=re(we,_e.v)+1;ht=1&ht?-1-(ht>>>1):ht>>>1,Te[bt][0]+=Qe(ht),Te[bt][1]==de.f&&(Te[bt][0]>>>=1,Te[bt][1]>>>=1),Te[bt][1]++,Ye=Oe<0?Ye-ht:Ye+ht,de.i&&(Ye<0?Ye+=_e.w:Ye>de.g&&(Ye-=_e.w)),gt[xt]=Ye>=0?Math.min(Ye,de.g):0}function oe(de,_e,we){for(var pe=de[0].length,xe=_e;xe<=we;xe++)de[xe][0]=de[xe-1][1],de[xe][pe-1]=de[xe-1][pe-2]}function ee(de){oe(de,G,H),oe(de,I,D),oe(de,K,Z)}function ae(de,_e,we,pe,xe,Ge,Te,Ce,Oe,bt,Mt,lt,ir){for(var Ye=0,xt=1,ar=xe<W&&xe>D;xt<de.m;)Ye<de.m&&(se(de,_e,we,pe,xe,Ye,Te[Oe],de.h&&(ar&&bt||!ar&&(Mt||(Ye&lt)==ir))),se(de,_e,we,pe,Ge,Ye,Te[Oe],de.h&&(!ar&&bt||ar&&(Mt||(Ye&lt)==ir))),Ye+=2),Ye>8&&(se(de,_e,we,pe,xe,xt,Ce[Oe]),se(de,_e,we,pe,Ge,xt,Ce[Oe]),xt+=2);ee(pe)}function ce(de,_e,we,pe,xe,Ge){ae(de,_e,we,pe,I,G,xe,Ge,0,0,1,0,8),ae(de,_e,we,pe,8,K,xe,Ge,1,0,1,0,8),ae(de,_e,we,pe,3,9,xe,Ge,2,1,0,3,0),ae(de,_e,we,pe,10,16,xe,Ge,0,0,0,3,2),ae(de,_e,we,pe,D,11,xe,Ge,1,0,0,3,2),ae(de,_e,we,pe,H,Z,xe,Ge,2,1,0,3,0)}function le(de,_e,we,pe,xe,Ge){var Te=Ge.length,Ce=de.l;xe+1==de.s&&(Ce=de.e-xe*de.l);for(var Oe=6*de.e*pe+xe*de.l,bt=0;bt<6;bt++){for(var Mt=0;Mt<Ce;Mt++){var lt,ir=Ge[bt%Te][Mt%Te];lt=ir==0?I+(bt>>>1):ir==2?K+(bt>>>1):G+bt;var Ye=de.h?(2*Mt/3&2147483646|Mt%3&1)+(Mt%3>>>1):Mt>>>1;_e[Oe+Mt]=we[lt][Ye+1]}Oe+=de.e}}w._decompressRAF=function(de,_e){var we=(function(xt){var ar=w._binBE.readUshort,ht={b:ar(xt,0),i:xt[2],C:xt[3],u:xt[4],q:ar(xt,5),k:ar(xt,7),e:ar(xt,9),l:ar(xt,11),s:xt[13],d:ar(xt,14)};if(ht.b!=18771||ht.i>1||ht.q<6||ht.q%6||ht.e<768||ht.e%24||ht.l!=768||ht.k<ht.l||ht.k%ht.l||ht.k-ht.e>=ht.l||ht.s>16||ht.s!=ht.k/ht.l||ht.s!=Math.ceil(ht.e/ht.l)||ht.d!=ht.q/6||ht.u!=12&&ht.u!=14&&ht.u!=16||ht.C!=16&&ht.C!=0)throw"Invalid data";if(ht.i==0)throw"Not implemented. We need this file!";return ht.h=ht.C==16,ht.m=0|(ht.h?2*ht.l/3:ht.l>>>1),ht.A=ht.m+2,ht.f=64,ht.g=(1<<ht.u)-1,ht.n=4*ht.u,ht})(de),pe=(function(xt,ar){var ht=new Array(ar.s),gt=4*ar.s,zt=16+gt;12&gt&&(zt+=16-(12&gt));for(var ur=0,dr=16;ur<ar.s;dr+=4){var fr=w._binBE.readUint(xt,dr);ht[ur]=xt.slice(zt,zt+fr),ht[ur].j=0,ht[ur].a=0,zt+=fr,ur++}if(zt!=xt.length)throw"Invalid data";return ht})(de,we),xe=Q(we),Ge=new Int16Array(we.e*we.q);_e==null&&(_e=we.h?[[1,1,0,1,1,2],[1,1,2,1,1,0],[2,0,1,0,2,1],[1,1,2,1,1,0],[1,1,0,1,1,2],[0,2,1,2,0,1]]:[[0,1],[3,2]]);for(var Te=[[0,3],[1,D],[q,11],[j,H],[W,16],[V,Z]],Ce=[],Oe=0;Oe<18;Oe++)Ce[Oe]=new Uint16Array(we.A);for(var bt=0;bt<we.s;bt++){var Mt=J(xe),lt=J(xe);for(Oe=0;Oe<18;Oe++)for(var ir=0;ir<we.A;ir++)Ce[Oe][ir]=0;for(var Ye=0;Ye<we.d;Ye++){for(ce(we,xe,pe[bt],Ce,Mt,lt),Oe=0;Oe<6;Oe++)for(ir=0;ir<we.A;ir++)Ce[Te[Oe][0]][ir]=Ce[Te[Oe][1]][ir];for(le(we,Ge,Ce,Ye,bt,_e),Oe=I;Oe<18;Oe++)if([q,j,W,V].indexOf(Oe)==-1)for(ir=0;ir<we.A;ir++)Ce[Oe][ir]=0;ee(Ce)}}return Ge}})()})(m,typeof commonjsRequire=="function"?requirePako():self.pako)})()})(UTIF);var UTIFExports=UTIF.exports,utif=getDefaultExportFromCjs(UTIFExports),util$1,objectUtil;function getDimensionValue(d){return typeof d=="number"?d:d instanceof Uint8Array?d[0]:typeof d[0]=="string"?parseInt(d[0]):d[0]}function tiff(){return{mime:"image/tiff",encode:d=>{const m=utif.encodeImage(d.data,d.width,d.height);return Buffer.from(m)},decode:d=>{const m=utif.decode(d),g=m[0];if(!g)throw new Error("No page found in TIFF");if(!g.t256)throw new Error("No image width found in TIFF");if(!g.t257)throw new Error("No image height found in TIFF");m.forEach(($=>{utif.decodeImage(d,$)}));const w=utif.toRGBA8(g);return{data:Buffer.from(w),width:getDimensionValue(g.t256),height:getDimensionValue(g.t257)}}}}(function(d){d.assertEqual=m=>m,d.assertIs=function(m){},d.assertNever=function(m){throw new Error},d.arrayToEnum=m=>{const g={};for(const w of m)g[w]=w;return g},d.getValidEnumValues=m=>{const g=d.objectKeys(m).filter(($=>typeof m[m[$]]!="number")),w={};for(const $ of g)w[$]=m[$];return d.objectValues(w)},d.objectValues=m=>d.objectKeys(m).map((function(g){return m[g]})),d.objectKeys=typeof Object.keys=="function"?m=>Object.keys(m):m=>{const g=[];for(const w in m)Object.prototype.hasOwnProperty.call(m,w)&&g.push(w);return g},d.find=(m,g)=>{for(const w of m)if(g(w))return w},d.isInteger=typeof Number.isInteger=="function"?m=>Number.isInteger(m):m=>typeof m=="number"&&isFinite(m)&&Math.floor(m)===m,d.joinValues=function(m,g=" | "){return m.map((w=>typeof w=="string"?`'${w}'`:w)).join(g)},d.jsonStringifyReplacer=(m,g)=>typeof g=="bigint"?g.toString():g})(util$1||(util$1={})),(function(d){d.mergeShapes=(m,g)=>({...m,...g})})(objectUtil||(objectUtil={}));const ZodParsedType=util$1.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=d=>{switch(typeof d){case"undefined":return ZodParsedType.undefined;case"string":return ZodParsedType.string;case"number":return isNaN(d)?ZodParsedType.nan:ZodParsedType.number;case"boolean":return ZodParsedType.boolean;case"function":return ZodParsedType.function;case"bigint":return ZodParsedType.bigint;case"symbol":return ZodParsedType.symbol;case"object":return Array.isArray(d)?ZodParsedType.array:d===null?ZodParsedType.null:d.then&&typeof d.then=="function"&&d.catch&&typeof d.catch=="function"?ZodParsedType.promise:typeof Map<"u"&&d instanceof Map?ZodParsedType.map:typeof Set<"u"&&d instanceof Set?ZodParsedType.set:typeof Date<"u"&&d instanceof Date?ZodParsedType.date:ZodParsedType.object;default:return ZodParsedType.unknown}},ZodIssueCode=util$1.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),quotelessJson=d=>JSON.stringify(d,null,2).replace(/"([^"]+)":/g,"$1:");class ZodError extends Error{constructor(m){super(),this.issues=[],this.addIssue=w=>{this.issues=[...this.issues,w]},this.addIssues=(w=[])=>{this.issues=[...this.issues,...w]};const g=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,g):this.__proto__=g,this.name="ZodError",this.issues=m}get errors(){return this.issues}format(m){const g=m||function(I){return I.message},w={_errors:[]},$=I=>{for(const D of I.issues)if(D.code==="invalid_union")D.unionErrors.map($);else if(D.code==="invalid_return_type")$(D.returnTypeError);else if(D.code==="invalid_arguments")$(D.argumentsError);else if(D.path.length===0)w._errors.push(g(D));else{let q=w,j=0;for(;j<D.path.length;){const G=D.path[j];j===D.path.length-1?(q[G]=q[G]||{_errors:[]},q[G]._errors.push(g(D))):q[G]=q[G]||{_errors:[]},q=q[G],j++}}};return $(this),w}static assert(m){if(!(m instanceof ZodError))throw new Error(`Not a ZodError: ${m}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,util$1.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(m=(g=>g.message)){const g={},w=[];for(const $ of this.issues)$.path.length>0?(g[$.path[0]]=g[$.path[0]]||[],g[$.path[0]].push(m($))):w.push(m($));return{formErrors:w,fieldErrors:g}}get formErrors(){return this.flatten()}}ZodError.create=d=>new ZodError(d);const errorMap=(d,m)=>{let g;switch(d.code){case ZodIssueCode.invalid_type:g=d.received===ZodParsedType.undefined?"Required":`Expected ${d.expected}, received ${d.received}`;break;case ZodIssueCode.invalid_literal:g=`Invalid literal value, expected ${JSON.stringify(d.expected,util$1.jsonStringifyReplacer)}`;break;case ZodIssueCode.unrecognized_keys:g=`Unrecognized key(s) in object: ${util$1.joinValues(d.keys,", ")}`;break;case ZodIssueCode.invalid_union:g="Invalid input";break;case ZodIssueCode.invalid_union_discriminator:g=`Invalid discriminator value. Expected ${util$1.joinValues(d.options)}`;break;case ZodIssueCode.invalid_enum_value:g=`Invalid enum value. Expected ${util$1.joinValues(d.options)}, received '${d.received}'`;break;case ZodIssueCode.invalid_arguments:g="Invalid function arguments";break;case ZodIssueCode.invalid_return_type:g="Invalid function return type";break;case ZodIssueCode.invalid_date:g="Invalid date";break;case ZodIssueCode.invalid_string:typeof d.validation=="object"?"includes"in d.validation?(g=`Invalid input: must include "${d.validation.includes}"`,typeof d.validation.position=="number"&&(g=`${g} at one or more positions greater than or equal to ${d.validation.position}`)):"startsWith"in d.validation?g=`Invalid input: must start with "${d.validation.startsWith}"`:"endsWith"in d.validation?g=`Invalid input: must end with "${d.validation.endsWith}"`:util$1.assertNever(d.validation):g=d.validation!=="regex"?`Invalid ${d.validation}`:"Invalid";break;case ZodIssueCode.too_small:g=d.type==="array"?`Array must contain ${d.exact?"exactly":d.inclusive?"at least":"more than"} ${d.minimum} element(s)`:d.type==="string"?`String must contain ${d.exact?"exactly":d.inclusive?"at least":"over"} ${d.minimum} character(s)`:d.type==="number"?`Number must be ${d.exact?"exactly equal to ":d.inclusive?"greater than or equal to ":"greater than "}${d.minimum}`:d.type==="date"?`Date must be ${d.exact?"exactly equal to ":d.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(d.minimum))}`:"Invalid input";break;case ZodIssueCode.too_big:g=d.type==="array"?`Array must contain ${d.exact?"exactly":d.inclusive?"at most":"less than"} ${d.maximum} element(s)`:d.type==="string"?`String must contain ${d.exact?"exactly":d.inclusive?"at most":"under"} ${d.maximum} character(s)`:d.type==="number"?`Number must be ${d.exact?"exactly":d.inclusive?"less than or equal to":"less than"} ${d.maximum}`:d.type==="bigint"?`BigInt must be ${d.exact?"exactly":d.inclusive?"less than or equal to":"less than"} ${d.maximum}`:d.type==="date"?`Date must be ${d.exact?"exactly":d.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(d.maximum))}`:"Invalid input";break;case ZodIssueCode.custom:g="Invalid input";break;case ZodIssueCode.invalid_intersection_types:g="Intersection results could not be merged";break;case ZodIssueCode.not_multiple_of:g=`Number must be a multiple of ${d.multipleOf}`;break;case ZodIssueCode.not_finite:g="Number must be finite";break;default:g=m.defaultError,util$1.assertNever(d)}return{message:g}};let overrideErrorMap=errorMap;function setErrorMap(d){overrideErrorMap=d}function getErrorMap(){return overrideErrorMap}const makeIssue=d=>{const{data:m,path:g,errorMaps:w,issueData:$}=d,I=[...g,...$.path||[]],D={...$,path:I};if($.message!==void 0)return{...$,path:I,message:$.message};let q="";const j=w.filter((G=>!!G)).slice().reverse();for(const G of j)q=G(D,{data:m,defaultError:q}).message;return{...$,path:I,message:q}},EMPTY_PATH=[];function addIssueToContext(d,m){const g=getErrorMap(),w=makeIssue({issueData:m,data:d.data,path:d.path,errorMaps:[d.common.contextualErrorMap,d.schemaErrorMap,g,g===errorMap?void 0:errorMap].filter(($=>!!$))});d.common.issues.push(w)}class ParseStatus{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(m,g){const w=[];for(const $ of g){if($.status==="aborted")return INVALID;$.status==="dirty"&&m.dirty(),w.push($.value)}return{status:m.value,value:w}}static async mergeObjectAsync(m,g){const w=[];for(const $ of g){const I=await $.key,D=await $.value;w.push({key:I,value:D})}return ParseStatus.mergeObjectSync(m,w)}static mergeObjectSync(m,g){const w={};for(const $ of g){const{key:I,value:D}=$;if(I.status==="aborted"||D.status==="aborted")return INVALID;I.status==="dirty"&&m.dirty(),D.status==="dirty"&&m.dirty(),I.value==="__proto__"||D.value===void 0&&!$.alwaysSet||(w[I.value]=D.value)}return{status:m.value,value:w}}}const INVALID=Object.freeze({status:"aborted"}),DIRTY=d=>({status:"dirty",value:d}),OK=d=>({status:"valid",value:d}),isAborted=d=>d.status==="aborted",isDirty=d=>d.status==="dirty",isValid=d=>d.status==="valid",isAsync=d=>typeof Promise<"u"&&d instanceof Promise;function __classPrivateFieldGet(d,m,g,w){if(typeof m=="function"?d!==m||!0:!m.has(d))throw new TypeError("Cannot read private member from an object whose class did not declare it");return m.get(d)}function __classPrivateFieldSet(d,m,g,w,$){if(typeof m=="function"?d!==m||!0:!m.has(d))throw new TypeError("Cannot write private member to an object whose class did not declare it");return m.set(d,g),g}var errorUtil,_ZodEnum_cache,_ZodNativeEnum_cache;typeof SuppressedError=="function"&&SuppressedError,(function(d){d.errToObj=m=>typeof m=="string"?{message:m}:m||{},d.toString=m=>typeof m=="string"?m:m?.message})(errorUtil||(errorUtil={}));class ParseInputLazyPath{constructor(m,g,w,$){this._cachedPath=[],this.parent=m,this.data=g,this._path=w,this._key=$}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const handleResult=(d,m)=>{if(isValid(m))return{success:!0,data:m.value};if(!d.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const g=new ZodError(d.common.issues);return this._error=g,this._error}}};function processCreateParams(d){if(!d)return{};const{errorMap:m,invalid_type_error:g,required_error:w,description:$}=d;if(m&&(g||w))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return m?{errorMap:m,description:$}:{errorMap:(I,D)=>{var q,j;const{message:G}=d;return I.code==="invalid_enum_value"?{message:G??D.defaultError}:D.data===void 0?{message:(q=G??w)!==null&&q!==void 0?q:D.defaultError}:I.code!=="invalid_type"?{message:D.defaultError}:{message:(j=G??g)!==null&&j!==void 0?j:D.defaultError}},description:$}}class ZodType{constructor(m){this.spa=this.safeParseAsync,this._def=m,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(m){return getParsedType(m.data)}_getOrReturnCtx(m,g){return g||{common:m.parent.common,data:m.data,parsedType:getParsedType(m.data),schemaErrorMap:this._def.errorMap,path:m.path,parent:m.parent}}_processInputParams(m){return{status:new ParseStatus,ctx:{common:m.parent.common,data:m.data,parsedType:getParsedType(m.data),schemaErrorMap:this._def.errorMap,path:m.path,parent:m.parent}}}_parseSync(m){const g=this._parse(m);if(isAsync(g))throw new Error("Synchronous parse encountered promise.");return g}_parseAsync(m){const g=this._parse(m);return Promise.resolve(g)}parse(m,g){const w=this.safeParse(m,g);if(w.success)return w.data;throw w.error}safeParse(m,g){var w;const $={common:{issues:[],async:(w=g?.async)!==null&&w!==void 0&&w,contextualErrorMap:g?.errorMap},path:g?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:m,parsedType:getParsedType(m)},I=this._parseSync({data:m,path:$.path,parent:$});return handleResult($,I)}async parseAsync(m,g){const w=await this.safeParseAsync(m,g);if(w.success)return w.data;throw w.error}async safeParseAsync(m,g){const w={common:{issues:[],contextualErrorMap:g?.errorMap,async:!0},path:g?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:m,parsedType:getParsedType(m)},$=this._parse({data:m,path:w.path,parent:w}),I=await(isAsync($)?$:Promise.resolve($));return handleResult(w,I)}refine(m,g){const w=$=>typeof g=="string"||g===void 0?{message:g}:typeof g=="function"?g($):g;return this._refinement((($,I)=>{const D=m($),q=()=>I.addIssue({code:ZodIssueCode.custom,...w($)});return typeof Promise<"u"&&D instanceof Promise?D.then((j=>!!j||(q(),!1))):!!D||(q(),!1)}))}refinement(m,g){return this._refinement(((w,$)=>!!m(w)||($.addIssue(typeof g=="function"?g(w,$):g),!1)))}_refinement(m){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"refinement",refinement:m}})}superRefine(m){return this._refinement(m)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(m){return ZodUnion.create([this,m],this._def)}and(m){return ZodIntersection.create(this,m,this._def)}transform(m){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"transform",transform:m}})}default(m){const g=typeof m=="function"?m:()=>m;return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:g,typeName:ZodFirstPartyTypeKind.ZodDefault})}brand(){return new ZodBranded({typeName:ZodFirstPartyTypeKind.ZodBranded,type:this,...processCreateParams(this._def)})}catch(m){const g=typeof m=="function"?m:()=>m;return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:g,typeName:ZodFirstPartyTypeKind.ZodCatch})}describe(m){return new this.constructor({...this._def,description:m})}pipe(m){return ZodPipeline.create(this,m)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const cuidRegex=/^c[^\s-]{8,}$/i,cuid2Regex=/^[0-9a-z]+$/,ulidRegex=/^[0-9A-HJKMNP-TV-Z]{26}$/,uuidRegex=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,nanoidRegex=/^[a-z0-9_-]{21}$/i,durationRegex=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,emailRegex=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_emojiRegex="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let emojiRegex;const ipv4Regex=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6Regex=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64Regex=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,dateRegexSource="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",dateRegex=new RegExp(`^${dateRegexSource}$`);function timeRegexSource(d){let m="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return d.precision?m=`${m}\\.\\d{${d.precision}}`:d.precision==null&&(m=`${m}(\\.\\d+)?`),m}function timeRegex(d){return new RegExp(`^${timeRegexSource(d)}$`)}function datetimeRegex(d){let m=`${dateRegexSource}T${timeRegexSource(d)}`;const g=[];return g.push(d.local?"Z?":"Z"),d.offset&&g.push("([+-]\\d{2}:?\\d{2})"),m=`${m}(${g.join("|")})`,new RegExp(`^${m}$`)}function isValidIP(d,m){return!(m!=="v4"&&m||!ipv4Regex.test(d))||!(m!=="v6"&&m||!ipv6Regex.test(d))}class ZodString extends ZodType{_parse(m){if(this._def.coerce&&(m.data=String(m.data)),this._getType(m)!==ZodParsedType.string){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.string,received:$.parsedType}),INVALID}const g=new ParseStatus;let w;for(const $ of this._def.checks)if($.kind==="min")m.data.length<$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:$.value,type:"string",inclusive:!0,exact:!1,message:$.message}),g.dirty());else if($.kind==="max")m.data.length>$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:$.value,type:"string",inclusive:!0,exact:!1,message:$.message}),g.dirty());else if($.kind==="length"){const I=m.data.length>$.value,D=m.data.length<$.value;(I||D)&&(w=this._getOrReturnCtx(m,w),I?addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:$.value,type:"string",inclusive:!0,exact:!0,message:$.message}):D&&addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:$.value,type:"string",inclusive:!0,exact:!0,message:$.message}),g.dirty())}else if($.kind==="email")emailRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"email",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="emoji")emojiRegex||(emojiRegex=new RegExp(_emojiRegex,"u")),emojiRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"emoji",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="uuid")uuidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"uuid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="nanoid")nanoidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"nanoid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="cuid")cuidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"cuid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="cuid2")cuid2Regex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"cuid2",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="ulid")ulidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"ulid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="url")try{new URL(m.data)}catch{w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"url",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()}else $.kind==="regex"?($.regex.lastIndex=0,$.regex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"regex",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty())):$.kind==="trim"?m.data=m.data.trim():$.kind==="includes"?m.data.includes($.value,$.position)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:{includes:$.value,position:$.position},message:$.message}),g.dirty()):$.kind==="toLowerCase"?m.data=m.data.toLowerCase():$.kind==="toUpperCase"?m.data=m.data.toUpperCase():$.kind==="startsWith"?m.data.startsWith($.value)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:{startsWith:$.value},message:$.message}),g.dirty()):$.kind==="endsWith"?m.data.endsWith($.value)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:{endsWith:$.value},message:$.message}),g.dirty()):$.kind==="datetime"?datetimeRegex($).test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:"datetime",message:$.message}),g.dirty()):$.kind==="date"?dateRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:"date",message:$.message}),g.dirty()):$.kind==="time"?timeRegex($).test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:"time",message:$.message}),g.dirty()):$.kind==="duration"?durationRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"duration",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()):$.kind==="ip"?isValidIP(m.data,$.version)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"ip",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()):$.kind==="base64"?base64Regex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"base64",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()):util$1.assertNever($);return{status:g.value,value:m.data}}_regex(m,g,w){return this.refinement(($=>m.test($)),{validation:g,code:ZodIssueCode.invalid_string,...errorUtil.errToObj(w)})}_addCheck(m){return new ZodString({...this._def,checks:[...this._def.checks,m]})}email(m){return this._addCheck({kind:"email",...errorUtil.errToObj(m)})}url(m){return this._addCheck({kind:"url",...errorUtil.errToObj(m)})}emoji(m){return this._addCheck({kind:"emoji",...errorUtil.errToObj(m)})}uuid(m){return this._addCheck({kind:"uuid",...errorUtil.errToObj(m)})}nanoid(m){return this._addCheck({kind:"nanoid",...errorUtil.errToObj(m)})}cuid(m){return this._addCheck({kind:"cuid",...errorUtil.errToObj(m)})}cuid2(m){return this._addCheck({kind:"cuid2",...errorUtil.errToObj(m)})}ulid(m){return this._addCheck({kind:"ulid",...errorUtil.errToObj(m)})}base64(m){return this._addCheck({kind:"base64",...errorUtil.errToObj(m)})}ip(m){return this._addCheck({kind:"ip",...errorUtil.errToObj(m)})}datetime(m){var g,w;return typeof m=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:m}):this._addCheck({kind:"datetime",precision:m?.precision===void 0?null:m?.precision,offset:(g=m?.offset)!==null&&g!==void 0&&g,local:(w=m?.local)!==null&&w!==void 0&&w,...errorUtil.errToObj(m?.message)})}date(m){return this._addCheck({kind:"date",message:m})}time(m){return typeof m=="string"?this._addCheck({kind:"time",precision:null,message:m}):this._addCheck({kind:"time",precision:m?.precision===void 0?null:m?.precision,...errorUtil.errToObj(m?.message)})}duration(m){return this._addCheck({kind:"duration",...errorUtil.errToObj(m)})}regex(m,g){return this._addCheck({kind:"regex",regex:m,...errorUtil.errToObj(g)})}includes(m,g){return this._addCheck({kind:"includes",value:m,position:g?.position,...errorUtil.errToObj(g?.message)})}startsWith(m,g){return this._addCheck({kind:"startsWith",value:m,...errorUtil.errToObj(g)})}endsWith(m,g){return this._addCheck({kind:"endsWith",value:m,...errorUtil.errToObj(g)})}min(m,g){return this._addCheck({kind:"min",value:m,...errorUtil.errToObj(g)})}max(m,g){return this._addCheck({kind:"max",value:m,...errorUtil.errToObj(g)})}length(m,g){return this._addCheck({kind:"length",value:m,...errorUtil.errToObj(g)})}nonempty(m){return this.min(1,errorUtil.errToObj(m))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((m=>m.kind==="datetime"))}get isDate(){return!!this._def.checks.find((m=>m.kind==="date"))}get isTime(){return!!this._def.checks.find((m=>m.kind==="time"))}get isDuration(){return!!this._def.checks.find((m=>m.kind==="duration"))}get isEmail(){return!!this._def.checks.find((m=>m.kind==="email"))}get isURL(){return!!this._def.checks.find((m=>m.kind==="url"))}get isEmoji(){return!!this._def.checks.find((m=>m.kind==="emoji"))}get isUUID(){return!!this._def.checks.find((m=>m.kind==="uuid"))}get isNANOID(){return!!this._def.checks.find((m=>m.kind==="nanoid"))}get isCUID(){return!!this._def.checks.find((m=>m.kind==="cuid"))}get isCUID2(){return!!this._def.checks.find((m=>m.kind==="cuid2"))}get isULID(){return!!this._def.checks.find((m=>m.kind==="ulid"))}get isIP(){return!!this._def.checks.find((m=>m.kind==="ip"))}get isBase64(){return!!this._def.checks.find((m=>m.kind==="base64"))}get minLength(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m}get maxLength(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m}}function floatSafeRemainder(d,m){const g=(d.toString().split(".")[1]||"").length,w=(m.toString().split(".")[1]||"").length,$=g>w?g:w;return parseInt(d.toFixed($).replace(".",""))%parseInt(m.toFixed($).replace(".",""))/Math.pow(10,$)}ZodString.create=d=>{var m;return new ZodString({checks:[],typeName:ZodFirstPartyTypeKind.ZodString,coerce:(m=d?.coerce)!==null&&m!==void 0&&m,...processCreateParams(d)})};class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(m){if(this._def.coerce&&(m.data=Number(m.data)),this._getType(m)!==ZodParsedType.number){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.number,received:$.parsedType}),INVALID}let g;const w=new ParseStatus;for(const $ of this._def.checks)$.kind==="int"?util$1.isInteger(m.data)||(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:"integer",received:"float",message:$.message}),w.dirty()):$.kind==="min"?($.inclusive?m.data<$.value:m.data<=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_small,minimum:$.value,type:"number",inclusive:$.inclusive,exact:!1,message:$.message}),w.dirty()):$.kind==="max"?($.inclusive?m.data>$.value:m.data>=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_big,maximum:$.value,type:"number",inclusive:$.inclusive,exact:!1,message:$.message}),w.dirty()):$.kind==="multipleOf"?floatSafeRemainder(m.data,$.value)!==0&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.not_multiple_of,multipleOf:$.value,message:$.message}),w.dirty()):$.kind==="finite"?Number.isFinite(m.data)||(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.not_finite,message:$.message}),w.dirty()):util$1.assertNever($);return{status:w.value,value:m.data}}gte(m,g){return this.setLimit("min",m,!0,errorUtil.toString(g))}gt(m,g){return this.setLimit("min",m,!1,errorUtil.toString(g))}lte(m,g){return this.setLimit("max",m,!0,errorUtil.toString(g))}lt(m,g){return this.setLimit("max",m,!1,errorUtil.toString(g))}setLimit(m,g,w,$){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:m,value:g,inclusive:w,message:errorUtil.toString($)}]})}_addCheck(m){return new ZodNumber({...this._def,checks:[...this._def.checks,m]})}int(m){return this._addCheck({kind:"int",message:errorUtil.toString(m)})}positive(m){return this._addCheck({kind:"min",value:0,inclusive:!1,message:errorUtil.toString(m)})}negative(m){return this._addCheck({kind:"max",value:0,inclusive:!1,message:errorUtil.toString(m)})}nonpositive(m){return this._addCheck({kind:"max",value:0,inclusive:!0,message:errorUtil.toString(m)})}nonnegative(m){return this._addCheck({kind:"min",value:0,inclusive:!0,message:errorUtil.toString(m)})}multipleOf(m,g){return this._addCheck({kind:"multipleOf",value:m,message:errorUtil.toString(g)})}finite(m){return this._addCheck({kind:"finite",message:errorUtil.toString(m)})}safe(m){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:errorUtil.toString(m)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:errorUtil.toString(m)})}get minValue(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m}get maxValue(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m}get isInt(){return!!this._def.checks.find((m=>m.kind==="int"||m.kind==="multipleOf"&&util$1.isInteger(m.value)))}get isFinite(){let m=null,g=null;for(const w of this._def.checks){if(w.kind==="finite"||w.kind==="int"||w.kind==="multipleOf")return!0;w.kind==="min"?(g===null||w.value>g)&&(g=w.value):w.kind==="max"&&(m===null||w.value<m)&&(m=w.value)}return Number.isFinite(g)&&Number.isFinite(m)}}ZodNumber.create=d=>new ZodNumber({checks:[],typeName:ZodFirstPartyTypeKind.ZodNumber,coerce:d?.coerce||!1,...processCreateParams(d)});class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(m){if(this._def.coerce&&(m.data=BigInt(m.data)),this._getType(m)!==ZodParsedType.bigint){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.bigint,received:$.parsedType}),INVALID}let g;const w=new ParseStatus;for(const $ of this._def.checks)$.kind==="min"?($.inclusive?m.data<$.value:m.data<=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_small,type:"bigint",minimum:$.value,inclusive:$.inclusive,message:$.message}),w.dirty()):$.kind==="max"?($.inclusive?m.data>$.value:m.data>=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_big,type:"bigint",maximum:$.value,inclusive:$.inclusive,message:$.message}),w.dirty()):$.kind==="multipleOf"?m.data%$.value!==BigInt(0)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.not_multiple_of,multipleOf:$.value,message:$.message}),w.dirty()):util$1.assertNever($);return{status:w.value,value:m.data}}gte(m,g){return this.setLimit("min",m,!0,errorUtil.toString(g))}gt(m,g){return this.setLimit("min",m,!1,errorUtil.toString(g))}lte(m,g){return this.setLimit("max",m,!0,errorUtil.toString(g))}lt(m,g){return this.setLimit("max",m,!1,errorUtil.toString(g))}setLimit(m,g,w,$){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:m,value:g,inclusive:w,message:errorUtil.toString($)}]})}_addCheck(m){return new ZodBigInt({...this._def,checks:[...this._def.checks,m]})}positive(m){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:errorUtil.toString(m)})}negative(m){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:errorUtil.toString(m)})}nonpositive(m){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:errorUtil.toString(m)})}nonnegative(m){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:errorUtil.toString(m)})}multipleOf(m,g){return this._addCheck({kind:"multipleOf",value:m,message:errorUtil.toString(g)})}get minValue(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m}get maxValue(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m}}ZodBigInt.create=d=>{var m;return new ZodBigInt({checks:[],typeName:ZodFirstPartyTypeKind.ZodBigInt,coerce:(m=d?.coerce)!==null&&m!==void 0&&m,...processCreateParams(d)})};class ZodBoolean extends ZodType{_parse(m){if(this._def.coerce&&(m.data=!!m.data),this._getType(m)!==ZodParsedType.boolean){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.boolean,received:g.parsedType}),INVALID}return OK(m.data)}}ZodBoolean.create=d=>new ZodBoolean({typeName:ZodFirstPartyTypeKind.ZodBoolean,coerce:d?.coerce||!1,...processCreateParams(d)});class ZodDate extends ZodType{_parse(m){if(this._def.coerce&&(m.data=new Date(m.data)),this._getType(m)!==ZodParsedType.date){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.date,received:$.parsedType}),INVALID}if(isNaN(m.data.getTime()))return addIssueToContext(this._getOrReturnCtx(m),{code:ZodIssueCode.invalid_date}),INVALID;const g=new ParseStatus;let w;for(const $ of this._def.checks)$.kind==="min"?m.data.getTime()<$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_small,message:$.message,inclusive:!0,exact:!1,minimum:$.value,type:"date"}),g.dirty()):$.kind==="max"?m.data.getTime()>$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_big,message:$.message,inclusive:!0,exact:!1,maximum:$.value,type:"date"}),g.dirty()):util$1.assertNever($);return{status:g.value,value:new Date(m.data.getTime())}}_addCheck(m){return new ZodDate({...this._def,checks:[...this._def.checks,m]})}min(m,g){return this._addCheck({kind:"min",value:m.getTime(),message:errorUtil.toString(g)})}max(m,g){return this._addCheck({kind:"max",value:m.getTime(),message:errorUtil.toString(g)})}get minDate(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m!=null?new Date(m):null}get maxDate(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m!=null?new Date(m):null}}ZodDate.create=d=>new ZodDate({checks:[],coerce:d?.coerce||!1,typeName:ZodFirstPartyTypeKind.ZodDate,...processCreateParams(d)});class ZodSymbol extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.symbol){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.symbol,received:g.parsedType}),INVALID}return OK(m.data)}}ZodSymbol.create=d=>new ZodSymbol({typeName:ZodFirstPartyTypeKind.ZodSymbol,...processCreateParams(d)});class ZodUndefined extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.undefined){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.undefined,received:g.parsedType}),INVALID}return OK(m.data)}}ZodUndefined.create=d=>new ZodUndefined({typeName:ZodFirstPartyTypeKind.ZodUndefined,...processCreateParams(d)});class ZodNull extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.null){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.null,received:g.parsedType}),INVALID}return OK(m.data)}}ZodNull.create=d=>new ZodNull({typeName:ZodFirstPartyTypeKind.ZodNull,...processCreateParams(d)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(m){return OK(m.data)}}ZodAny.create=d=>new ZodAny({typeName:ZodFirstPartyTypeKind.ZodAny,...processCreateParams(d)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(m){return OK(m.data)}}ZodUnknown.create=d=>new ZodUnknown({typeName:ZodFirstPartyTypeKind.ZodUnknown,...processCreateParams(d)});class ZodNever extends ZodType{_parse(m){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.never,received:g.parsedType}),INVALID}}ZodNever.create=d=>new ZodNever({typeName:ZodFirstPartyTypeKind.ZodNever,...processCreateParams(d)});class ZodVoid extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.undefined){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.void,received:g.parsedType}),INVALID}return OK(m.data)}}ZodVoid.create=d=>new ZodVoid({typeName:ZodFirstPartyTypeKind.ZodVoid,...processCreateParams(d)});class ZodArray extends ZodType{_parse(m){const{ctx:g,status:w}=this._processInputParams(m),$=this._def;if(g.parsedType!==ZodParsedType.array)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:g.parsedType}),INVALID;if($.exactLength!==null){const D=g.data.length>$.exactLength.value,q=g.data.length<$.exactLength.value;(D||q)&&(addIssueToContext(g,{code:D?ZodIssueCode.too_big:ZodIssueCode.too_small,minimum:q?$.exactLength.value:void 0,maximum:D?$.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:$.exactLength.message}),w.dirty())}if($.minLength!==null&&g.data.length<$.minLength.value&&(addIssueToContext(g,{code:ZodIssueCode.too_small,minimum:$.minLength.value,type:"array",inclusive:!0,exact:!1,message:$.minLength.message}),w.dirty()),$.maxLength!==null&&g.data.length>$.maxLength.value&&(addIssueToContext(g,{code:ZodIssueCode.too_big,maximum:$.maxLength.value,type:"array",inclusive:!0,exact:!1,message:$.maxLength.message}),w.dirty()),g.common.async)return Promise.all([...g.data].map(((D,q)=>$.type._parseAsync(new ParseInputLazyPath(g,D,g.path,q))))).then((D=>ParseStatus.mergeArray(w,D)));const I=[...g.data].map(((D,q)=>$.type._parseSync(new ParseInputLazyPath(g,D,g.path,q))));return ParseStatus.mergeArray(w,I)}get element(){return this._def.type}min(m,g){return new ZodArray({...this._def,minLength:{value:m,message:errorUtil.toString(g)}})}max(m,g){return new ZodArray({...this._def,maxLength:{value:m,message:errorUtil.toString(g)}})}length(m,g){return new ZodArray({...this._def,exactLength:{value:m,message:errorUtil.toString(g)}})}nonempty(m){return this.min(1,m)}}function deepPartialify(d){if(d instanceof ZodObject){const m={};for(const g in d.shape){const w=d.shape[g];m[g]=ZodOptional.create(deepPartialify(w))}return new ZodObject({...d._def,shape:()=>m})}return d instanceof ZodArray?new ZodArray({...d._def,type:deepPartialify(d.element)}):d instanceof ZodOptional?ZodOptional.create(deepPartialify(d.unwrap())):d instanceof ZodNullable?ZodNullable.create(deepPartialify(d.unwrap())):d instanceof ZodTuple?ZodTuple.create(d.items.map((m=>deepPartialify(m)))):d}ZodArray.create=(d,m)=>new ZodArray({type:d,minLength:null,maxLength:null,exactLength:null,typeName:ZodFirstPartyTypeKind.ZodArray,...processCreateParams(m)});class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const m=this._def.shape(),g=util$1.objectKeys(m);return this._cached={shape:m,keys:g}}_parse(m){if(this._getType(m)!==ZodParsedType.object){const j=this._getOrReturnCtx(m);return addIssueToContext(j,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:j.parsedType}),INVALID}const{status:g,ctx:w}=this._processInputParams(m),{shape:$,keys:I}=this._getCached(),D=[];if(!(this._def.catchall instanceof ZodNever&&this._def.unknownKeys==="strip"))for(const j in w.data)I.includes(j)||D.push(j);const q=[];for(const j of I){const G=$[j],H=w.data[j];q.push({key:{status:"valid",value:j},value:G._parse(new ParseInputLazyPath(w,H,w.path,j)),alwaysSet:j in w.data})}if(this._def.catchall instanceof ZodNever){const j=this._def.unknownKeys;if(j==="passthrough")for(const G of D)q.push({key:{status:"valid",value:G},value:{status:"valid",value:w.data[G]}});else if(j==="strict")D.length>0&&(addIssueToContext(w,{code:ZodIssueCode.unrecognized_keys,keys:D}),g.dirty());else if(j!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const j=this._def.catchall;for(const G of D){const H=w.data[G];q.push({key:{status:"valid",value:G},value:j._parse(new ParseInputLazyPath(w,H,w.path,G)),alwaysSet:G in w.data})}}return w.common.async?Promise.resolve().then((async()=>{const j=[];for(const G of q){const H=await G.key,W=await G.value;j.push({key:H,value:W,alwaysSet:G.alwaysSet})}return j})).then((j=>ParseStatus.mergeObjectSync(g,j))):ParseStatus.mergeObjectSync(g,q)}get shape(){return this._def.shape()}strict(m){return errorUtil.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...m!==void 0?{errorMap:(g,w)=>{var $,I,D,q;const j=(D=(I=($=this._def).errorMap)===null||I===void 0?void 0:I.call($,g,w).message)!==null&&D!==void 0?D:w.defaultError;return g.code==="unrecognized_keys"?{message:(q=errorUtil.errToObj(m).message)!==null&&q!==void 0?q:j}:{message:j}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(m){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...m})})}merge(m){return new ZodObject({unknownKeys:m._def.unknownKeys,catchall:m._def.catchall,shape:()=>({...this._def.shape(),...m._def.shape()}),typeName:ZodFirstPartyTypeKind.ZodObject})}setKey(m,g){return this.augment({[m]:g})}catchall(m){return new ZodObject({...this._def,catchall:m})}pick(m){const g={};return util$1.objectKeys(m).forEach((w=>{m[w]&&this.shape[w]&&(g[w]=this.shape[w])})),new ZodObject({...this._def,shape:()=>g})}omit(m){const g={};return util$1.objectKeys(this.shape).forEach((w=>{m[w]||(g[w]=this.shape[w])})),new ZodObject({...this._def,shape:()=>g})}deepPartial(){return deepPartialify(this)}partial(m){const g={};return util$1.objectKeys(this.shape).forEach((w=>{const $=this.shape[w];m&&!m[w]?g[w]=$:g[w]=$.optional()})),new ZodObject({...this._def,shape:()=>g})}required(m){const g={};return util$1.objectKeys(this.shape).forEach((w=>{if(m&&!m[w])g[w]=this.shape[w];else{let $=this.shape[w];for(;$ instanceof ZodOptional;)$=$._def.innerType;g[w]=$}})),new ZodObject({...this._def,shape:()=>g})}keyof(){return createZodEnum(util$1.objectKeys(this.shape))}}ZodObject.create=(d,m)=>new ZodObject({shape:()=>d,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(m)}),ZodObject.strictCreate=(d,m)=>new ZodObject({shape:()=>d,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(m)}),ZodObject.lazycreate=(d,m)=>new ZodObject({shape:d,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(m)});class ZodUnion extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m),w=this._def.options;if(g.common.async)return Promise.all(w.map((async $=>{const I={...g,common:{...g.common,issues:[]},parent:null};return{result:await $._parseAsync({data:g.data,path:g.path,parent:I}),ctx:I}}))).then((function($){for(const D of $)if(D.result.status==="valid")return D.result;for(const D of $)if(D.result.status==="dirty")return g.common.issues.push(...D.ctx.common.issues),D.result;const I=$.map((D=>new ZodError(D.ctx.common.issues)));return addIssueToContext(g,{code:ZodIssueCode.invalid_union,unionErrors:I}),INVALID}));{let $;const I=[];for(const q of w){const j={...g,common:{...g.common,issues:[]},parent:null},G=q._parseSync({data:g.data,path:g.path,parent:j});if(G.status==="valid")return G;G.status!=="dirty"||$||($={result:G,ctx:j}),j.common.issues.length&&I.push(j.common.issues)}if($)return g.common.issues.push(...$.ctx.common.issues),$.result;const D=I.map((q=>new ZodError(q)));return addIssueToContext(g,{code:ZodIssueCode.invalid_union,unionErrors:D}),INVALID}}get options(){return this._def.options}}ZodUnion.create=(d,m)=>new ZodUnion({options:d,typeName:ZodFirstPartyTypeKind.ZodUnion,...processCreateParams(m)});const getDiscriminator=d=>d instanceof ZodLazy?getDiscriminator(d.schema):d instanceof ZodEffects?getDiscriminator(d.innerType()):d instanceof ZodLiteral?[d.value]:d instanceof ZodEnum?d.options:d instanceof ZodNativeEnum?util$1.objectValues(d.enum):d instanceof ZodDefault?getDiscriminator(d._def.innerType):d instanceof ZodUndefined?[void 0]:d instanceof ZodNull?[null]:d instanceof ZodOptional?[void 0,...getDiscriminator(d.unwrap())]:d instanceof ZodNullable?[null,...getDiscriminator(d.unwrap())]:d instanceof ZodBranded||d instanceof ZodReadonly?getDiscriminator(d.unwrap()):d instanceof ZodCatch?getDiscriminator(d._def.innerType):[];class ZodDiscriminatedUnion extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m);if(g.parsedType!==ZodParsedType.object)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:g.parsedType}),INVALID;const w=this.discriminator,$=g.data[w],I=this.optionsMap.get($);return I?g.common.async?I._parseAsync({data:g.data,path:g.path,parent:g}):I._parseSync({data:g.data,path:g.path,parent:g}):(addIssueToContext(g,{code:ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[w]}),INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(m,g,w){const $=new Map;for(const I of g){const D=getDiscriminator(I.shape[m]);if(!D.length)throw new Error(`A discriminator value for key \`${m}\` could not be extracted from all schema options`);for(const q of D){if($.has(q))throw new Error(`Discriminator property ${String(m)} has duplicate value ${String(q)}`);$.set(q,I)}}return new ZodDiscriminatedUnion({typeName:ZodFirstPartyTypeKind.ZodDiscriminatedUnion,discriminator:m,options:g,optionsMap:$,...processCreateParams(w)})}}function mergeValues(d,m){const g=getParsedType(d),w=getParsedType(m);if(d===m)return{valid:!0,data:d};if(g===ZodParsedType.object&&w===ZodParsedType.object){const $=util$1.objectKeys(m),I=util$1.objectKeys(d).filter((q=>$.indexOf(q)!==-1)),D={...d,...m};for(const q of I){const j=mergeValues(d[q],m[q]);if(!j.valid)return{valid:!1};D[q]=j.data}return{valid:!0,data:D}}if(g===ZodParsedType.array&&w===ZodParsedType.array){if(d.length!==m.length)return{valid:!1};const $=[];for(let I=0;I<d.length;I++){const D=mergeValues(d[I],m[I]);if(!D.valid)return{valid:!1};$.push(D.data)}return{valid:!0,data:$}}return g===ZodParsedType.date&&w===ZodParsedType.date&&+d==+m?{valid:!0,data:d}:{valid:!1}}class ZodIntersection extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m),$=(I,D)=>{if(isAborted(I)||isAborted(D))return INVALID;const q=mergeValues(I.value,D.value);return q.valid?((isDirty(I)||isDirty(D))&&g.dirty(),{status:g.value,value:q.data}):(addIssueToContext(w,{code:ZodIssueCode.invalid_intersection_types}),INVALID)};return w.common.async?Promise.all([this._def.left._parseAsync({data:w.data,path:w.path,parent:w}),this._def.right._parseAsync({data:w.data,path:w.path,parent:w})]).then((([I,D])=>$(I,D))):$(this._def.left._parseSync({data:w.data,path:w.path,parent:w}),this._def.right._parseSync({data:w.data,path:w.path,parent:w}))}}ZodIntersection.create=(d,m,g)=>new ZodIntersection({left:d,right:m,typeName:ZodFirstPartyTypeKind.ZodIntersection,...processCreateParams(g)});class ZodTuple extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.array)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:w.parsedType}),INVALID;if(w.data.length<this._def.items.length)return addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),INVALID;!this._def.rest&&w.data.length>this._def.items.length&&(addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),g.dirty());const $=[...w.data].map(((I,D)=>{const q=this._def.items[D]||this._def.rest;return q?q._parse(new ParseInputLazyPath(w,I,w.path,D)):null})).filter((I=>!!I));return w.common.async?Promise.all($).then((I=>ParseStatus.mergeArray(g,I))):ParseStatus.mergeArray(g,$)}get items(){return this._def.items}rest(m){return new ZodTuple({...this._def,rest:m})}}ZodTuple.create=(d,m)=>{if(!Array.isArray(d))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:d,typeName:ZodFirstPartyTypeKind.ZodTuple,rest:null,...processCreateParams(m)})};class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.object)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:w.parsedType}),INVALID;const $=[],I=this._def.keyType,D=this._def.valueType;for(const q in w.data)$.push({key:I._parse(new ParseInputLazyPath(w,q,w.path,q)),value:D._parse(new ParseInputLazyPath(w,w.data[q],w.path,q)),alwaysSet:q in w.data});return w.common.async?ParseStatus.mergeObjectAsync(g,$):ParseStatus.mergeObjectSync(g,$)}get element(){return this._def.valueType}static create(m,g,w){return new ZodRecord(g instanceof ZodType?{keyType:m,valueType:g,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(w)}:{keyType:ZodString.create(),valueType:m,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(g)})}}class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.map)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.map,received:w.parsedType}),INVALID;const $=this._def.keyType,I=this._def.valueType,D=[...w.data.entries()].map((([q,j],G)=>({key:$._parse(new ParseInputLazyPath(w,q,w.path,[G,"key"])),value:I._parse(new ParseInputLazyPath(w,j,w.path,[G,"value"]))})));if(w.common.async){const q=new Map;return Promise.resolve().then((async()=>{for(const j of D){const G=await j.key,H=await j.value;if(G.status==="aborted"||H.status==="aborted")return INVALID;G.status!=="dirty"&&H.status!=="dirty"||g.dirty(),q.set(G.value,H.value)}return{status:g.value,value:q}}))}{const q=new Map;for(const j of D){const G=j.key,H=j.value;if(G.status==="aborted"||H.status==="aborted")return INVALID;G.status!=="dirty"&&H.status!=="dirty"||g.dirty(),q.set(G.value,H.value)}return{status:g.value,value:q}}}}ZodMap.create=(d,m,g)=>new ZodMap({valueType:m,keyType:d,typeName:ZodFirstPartyTypeKind.ZodMap,...processCreateParams(g)});class ZodSet extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.set)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.set,received:w.parsedType}),INVALID;const $=this._def;$.minSize!==null&&w.data.size<$.minSize.value&&(addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:$.minSize.value,type:"set",inclusive:!0,exact:!1,message:$.minSize.message}),g.dirty()),$.maxSize!==null&&w.data.size>$.maxSize.value&&(addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:$.maxSize.value,type:"set",inclusive:!0,exact:!1,message:$.maxSize.message}),g.dirty());const I=this._def.valueType;function D(j){const G=new Set;for(const H of j){if(H.status==="aborted")return INVALID;H.status==="dirty"&&g.dirty(),G.add(H.value)}return{status:g.value,value:G}}const q=[...w.data.values()].map(((j,G)=>I._parse(new ParseInputLazyPath(w,j,w.path,G))));return w.common.async?Promise.all(q).then((j=>D(j))):D(q)}min(m,g){return new ZodSet({...this._def,minSize:{value:m,message:errorUtil.toString(g)}})}max(m,g){return new ZodSet({...this._def,maxSize:{value:m,message:errorUtil.toString(g)}})}size(m,g){return this.min(m,g).max(m,g)}nonempty(m){return this.min(1,m)}}ZodSet.create=(d,m)=>new ZodSet({valueType:d,minSize:null,maxSize:null,typeName:ZodFirstPartyTypeKind.ZodSet,...processCreateParams(m)});class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(m){const{ctx:g}=this._processInputParams(m);if(g.parsedType!==ZodParsedType.function)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.function,received:g.parsedType}),INVALID;function w(q,j){return makeIssue({data:q,path:g.path,errorMaps:[g.common.contextualErrorMap,g.schemaErrorMap,getErrorMap(),errorMap].filter((G=>!!G)),issueData:{code:ZodIssueCode.invalid_arguments,argumentsError:j}})}function $(q,j){return makeIssue({data:q,path:g.path,errorMaps:[g.common.contextualErrorMap,g.schemaErrorMap,getErrorMap(),errorMap].filter((G=>!!G)),issueData:{code:ZodIssueCode.invalid_return_type,returnTypeError:j}})}const I={errorMap:g.common.contextualErrorMap},D=g.data;if(this._def.returns instanceof ZodPromise){const q=this;return OK((async function(...j){const G=new ZodError([]),H=await q._def.args.parseAsync(j,I).catch((K=>{throw G.addIssue(w(j,K)),G})),W=await Reflect.apply(D,this,H);return await q._def.returns._def.type.parseAsync(W,I).catch((K=>{throw G.addIssue($(W,K)),G}))}))}{const q=this;return OK((function(...j){const G=q._def.args.safeParse(j,I);if(!G.success)throw new ZodError([w(j,G.error)]);const H=Reflect.apply(D,this,G.data),W=q._def.returns.safeParse(H,I);if(!W.success)throw new ZodError([$(H,W.error)]);return W.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...m){return new ZodFunction({...this._def,args:ZodTuple.create(m).rest(ZodUnknown.create())})}returns(m){return new ZodFunction({...this._def,returns:m})}implement(m){return this.parse(m)}strictImplement(m){return this.parse(m)}static create(m,g,w){return new ZodFunction({args:m||ZodTuple.create([]).rest(ZodUnknown.create()),returns:g||ZodUnknown.create(),typeName:ZodFirstPartyTypeKind.ZodFunction,...processCreateParams(w)})}}class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(m){const{ctx:g}=this._processInputParams(m);return this._def.getter()._parse({data:g.data,path:g.path,parent:g})}}ZodLazy.create=(d,m)=>new ZodLazy({getter:d,typeName:ZodFirstPartyTypeKind.ZodLazy,...processCreateParams(m)});class ZodLiteral extends ZodType{_parse(m){if(m.data!==this._def.value){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{received:g.data,code:ZodIssueCode.invalid_literal,expected:this._def.value}),INVALID}return{status:"valid",value:m.data}}get value(){return this._def.value}}function createZodEnum(d,m){return new ZodEnum({values:d,typeName:ZodFirstPartyTypeKind.ZodEnum,...processCreateParams(m)})}ZodLiteral.create=(d,m)=>new ZodLiteral({value:d,typeName:ZodFirstPartyTypeKind.ZodLiteral,...processCreateParams(m)});class ZodEnum extends ZodType{constructor(){super(...arguments),_ZodEnum_cache.set(this,void 0)}_parse(m){if(typeof m.data!="string"){const g=this._getOrReturnCtx(m),w=this._def.values;return addIssueToContext(g,{expected:util$1.joinValues(w),received:g.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodEnum_cache)||__classPrivateFieldSet(this,_ZodEnum_cache,new Set(this._def.values)),!__classPrivateFieldGet(this,_ZodEnum_cache).has(m.data)){const g=this._getOrReturnCtx(m),w=this._def.values;return addIssueToContext(g,{received:g.data,code:ZodIssueCode.invalid_enum_value,options:w}),INVALID}return OK(m.data)}get options(){return this._def.values}get enum(){const m={};for(const g of this._def.values)m[g]=g;return m}get Values(){const m={};for(const g of this._def.values)m[g]=g;return m}get Enum(){const m={};for(const g of this._def.values)m[g]=g;return m}extract(m,g=this._def){return ZodEnum.create(m,{...this._def,...g})}exclude(m,g=this._def){return ZodEnum.create(this.options.filter((w=>!m.includes(w))),{...this._def,...g})}}_ZodEnum_cache=new WeakMap,ZodEnum.create=createZodEnum;class ZodNativeEnum extends ZodType{constructor(){super(...arguments),_ZodNativeEnum_cache.set(this,void 0)}_parse(m){const g=util$1.getValidEnumValues(this._def.values),w=this._getOrReturnCtx(m);if(w.parsedType!==ZodParsedType.string&&w.parsedType!==ZodParsedType.number){const $=util$1.objectValues(g);return addIssueToContext(w,{expected:util$1.joinValues($),received:w.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodNativeEnum_cache)||__classPrivateFieldSet(this,_ZodNativeEnum_cache,new Set(util$1.getValidEnumValues(this._def.values))),!__classPrivateFieldGet(this,_ZodNativeEnum_cache).has(m.data)){const $=util$1.objectValues(g);return addIssueToContext(w,{received:w.data,code:ZodIssueCode.invalid_enum_value,options:$}),INVALID}return OK(m.data)}get enum(){return this._def.values}}_ZodNativeEnum_cache=new WeakMap,ZodNativeEnum.create=(d,m)=>new ZodNativeEnum({values:d,typeName:ZodFirstPartyTypeKind.ZodNativeEnum,...processCreateParams(m)});class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(m){const{ctx:g}=this._processInputParams(m);if(g.parsedType!==ZodParsedType.promise&&g.common.async===!1)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.promise,received:g.parsedType}),INVALID;const w=g.parsedType===ZodParsedType.promise?g.data:Promise.resolve(g.data);return OK(w.then(($=>this._def.type.parseAsync($,{path:g.path,errorMap:g.common.contextualErrorMap}))))}}ZodPromise.create=(d,m)=>new ZodPromise({type:d,typeName:ZodFirstPartyTypeKind.ZodPromise,...processCreateParams(m)});class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ZodFirstPartyTypeKind.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(m){const{status:g,ctx:w}=this._processInputParams(m),$=this._def.effect||null,I={addIssue:D=>{addIssueToContext(w,D),D.fatal?g.abort():g.dirty()},get path(){return w.path}};if(I.addIssue=I.addIssue.bind(I),$.type==="preprocess"){const D=$.transform(w.data,I);if(w.common.async)return Promise.resolve(D).then((async q=>{if(g.value==="aborted")return INVALID;const j=await this._def.schema._parseAsync({data:q,path:w.path,parent:w});return j.status==="aborted"?INVALID:j.status==="dirty"||g.value==="dirty"?DIRTY(j.value):j}));{if(g.value==="aborted")return INVALID;const q=this._def.schema._parseSync({data:D,path:w.path,parent:w});return q.status==="aborted"?INVALID:q.status==="dirty"||g.value==="dirty"?DIRTY(q.value):q}}if($.type==="refinement"){const D=q=>{const j=$.refinement(q,I);if(w.common.async)return Promise.resolve(j);if(j instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return q};if(w.common.async===!1){const q=this._def.schema._parseSync({data:w.data,path:w.path,parent:w});return q.status==="aborted"?INVALID:(q.status==="dirty"&&g.dirty(),D(q.value),{status:g.value,value:q.value})}return this._def.schema._parseAsync({data:w.data,path:w.path,parent:w}).then((q=>q.status==="aborted"?INVALID:(q.status==="dirty"&&g.dirty(),D(q.value).then((()=>({status:g.value,value:q.value}))))))}if($.type==="transform"){if(w.common.async===!1){const D=this._def.schema._parseSync({data:w.data,path:w.path,parent:w});if(!isValid(D))return D;const q=$.transform(D.value,I);if(q instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:g.value,value:q}}return this._def.schema._parseAsync({data:w.data,path:w.path,parent:w}).then((D=>isValid(D)?Promise.resolve($.transform(D.value,I)).then((q=>({status:g.value,value:q}))):D))}util$1.assertNever($)}}ZodEffects.create=(d,m,g)=>new ZodEffects({schema:d,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:m,...processCreateParams(g)}),ZodEffects.createWithPreprocess=(d,m,g)=>new ZodEffects({schema:m,effect:{type:"preprocess",transform:d},typeName:ZodFirstPartyTypeKind.ZodEffects,...processCreateParams(g)});class ZodOptional extends ZodType{_parse(m){return this._getType(m)===ZodParsedType.undefined?OK(void 0):this._def.innerType._parse(m)}unwrap(){return this._def.innerType}}ZodOptional.create=(d,m)=>new ZodOptional({innerType:d,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(m)});class ZodNullable extends ZodType{_parse(m){return this._getType(m)===ZodParsedType.null?OK(null):this._def.innerType._parse(m)}unwrap(){return this._def.innerType}}ZodNullable.create=(d,m)=>new ZodNullable({innerType:d,typeName:ZodFirstPartyTypeKind.ZodNullable,...processCreateParams(m)});class ZodDefault extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m);let w=g.data;return g.parsedType===ZodParsedType.undefined&&(w=this._def.defaultValue()),this._def.innerType._parse({data:w,path:g.path,parent:g})}removeDefault(){return this._def.innerType}}ZodDefault.create=(d,m)=>new ZodDefault({innerType:d,typeName:ZodFirstPartyTypeKind.ZodDefault,defaultValue:typeof m.default=="function"?m.default:()=>m.default,...processCreateParams(m)});class ZodCatch extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m),w={...g,common:{...g.common,issues:[]}},$=this._def.innerType._parse({data:w.data,path:w.path,parent:{...w}});return isAsync($)?$.then((I=>({status:"valid",value:I.status==="valid"?I.value:this._def.catchValue({get error(){return new ZodError(w.common.issues)},input:w.data})}))):{status:"valid",value:$.status==="valid"?$.value:this._def.catchValue({get error(){return new ZodError(w.common.issues)},input:w.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(d,m)=>new ZodCatch({innerType:d,typeName:ZodFirstPartyTypeKind.ZodCatch,catchValue:typeof m.catch=="function"?m.catch:()=>m.catch,...processCreateParams(m)});class ZodNaN extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.nan){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.nan,received:g.parsedType}),INVALID}return{status:"valid",value:m.data}}}ZodNaN.create=d=>new ZodNaN({typeName:ZodFirstPartyTypeKind.ZodNaN,...processCreateParams(d)});const BRAND=Symbol("zod_brand");class ZodBranded extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m),w=g.data;return this._def.type._parse({data:w,path:g.path,parent:g})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.common.async)return(async()=>{const $=await this._def.in._parseAsync({data:w.data,path:w.path,parent:w});return $.status==="aborted"?INVALID:$.status==="dirty"?(g.dirty(),DIRTY($.value)):this._def.out._parseAsync({data:$.value,path:w.path,parent:w})})();{const $=this._def.in._parseSync({data:w.data,path:w.path,parent:w});return $.status==="aborted"?INVALID:$.status==="dirty"?(g.dirty(),{status:"dirty",value:$.value}):this._def.out._parseSync({data:$.value,path:w.path,parent:w})}}static create(m,g){return new ZodPipeline({in:m,out:g,typeName:ZodFirstPartyTypeKind.ZodPipeline})}}class ZodReadonly extends ZodType{_parse(m){const g=this._def.innerType._parse(m),w=$=>(isValid($)&&($.value=Object.freeze($.value)),$);return isAsync(g)?g.then(($=>w($))):w(g)}unwrap(){return this._def.innerType}}function custom(d,m={},g){return d?ZodAny.create().superRefine(((w,$)=>{var I,D;if(!d(w)){const q=typeof m=="function"?m(w):typeof m=="string"?{message:m}:m,j=(D=(I=q.fatal)!==null&&I!==void 0?I:g)===null||D===void 0||D,G=typeof q=="string"?{message:q}:q;$.addIssue({code:"custom",...G,fatal:j})}})):ZodAny.create()}ZodReadonly.create=(d,m)=>new ZodReadonly({innerType:d,typeName:ZodFirstPartyTypeKind.ZodReadonly,...processCreateParams(m)});const late={object:ZodObject.lazycreate};var ZodFirstPartyTypeKind;(function(d){d.ZodString="ZodString",d.ZodNumber="ZodNumber",d.ZodNaN="ZodNaN",d.ZodBigInt="ZodBigInt",d.ZodBoolean="ZodBoolean",d.ZodDate="ZodDate",d.ZodSymbol="ZodSymbol",d.ZodUndefined="ZodUndefined",d.ZodNull="ZodNull",d.ZodAny="ZodAny",d.ZodUnknown="ZodUnknown",d.ZodNever="ZodNever",d.ZodVoid="ZodVoid",d.ZodArray="ZodArray",d.ZodObject="ZodObject",d.ZodUnion="ZodUnion",d.ZodDiscriminatedUnion="ZodDiscriminatedUnion",d.ZodIntersection="ZodIntersection",d.ZodTuple="ZodTuple",d.ZodRecord="ZodRecord",d.ZodMap="ZodMap",d.ZodSet="ZodSet",d.ZodFunction="ZodFunction",d.ZodLazy="ZodLazy",d.ZodLiteral="ZodLiteral",d.ZodEnum="ZodEnum",d.ZodEffects="ZodEffects",d.ZodNativeEnum="ZodNativeEnum",d.ZodOptional="ZodOptional",d.ZodNullable="ZodNullable",d.ZodDefault="ZodDefault",d.ZodCatch="ZodCatch",d.ZodPromise="ZodPromise",d.ZodBranded="ZodBranded",d.ZodPipeline="ZodPipeline",d.ZodReadonly="ZodReadonly"})(ZodFirstPartyTypeKind||(ZodFirstPartyTypeKind={}));const instanceOfType=(d,m={message:`Input not instance of ${d.name}`})=>custom((g=>g instanceof d),m),stringType=ZodString.create,numberType=ZodNumber.create,nanType=ZodNaN.create,bigIntType=ZodBigInt.create,booleanType=ZodBoolean.create,dateType=ZodDate.create,symbolType=ZodSymbol.create,undefinedType=ZodUndefined.create,nullType=ZodNull.create,anyType=ZodAny.create,unknownType=ZodUnknown.create,neverType=ZodNever.create,voidType=ZodVoid.create,arrayType=ZodArray.create,objectType=ZodObject.create,strictObjectType=ZodObject.strictCreate,unionType=ZodUnion.create,discriminatedUnionType=ZodDiscriminatedUnion.create,intersectionType=ZodIntersection.create,tupleType=ZodTuple.create,recordType=ZodRecord.create,mapType=ZodMap.create,setType=ZodSet.create,functionType=ZodFunction.create,lazyType=ZodLazy.create,literalType=ZodLiteral.create,enumType=ZodEnum.create,nativeEnumType=ZodNativeEnum.create,promiseType=ZodPromise.create,effectsType=ZodEffects.create,optionalType=ZodOptional.create,nullableType=ZodNullable.create,preprocessType=ZodEffects.createWithPreprocess,pipelineType=ZodPipeline.create,ostring=()=>stringType().optional(),onumber=()=>numberType().optional(),oboolean=()=>booleanType().optional(),coerce={string:d=>ZodString.create({...d,coerce:!0}),number:d=>ZodNumber.create({...d,coerce:!0}),boolean:d=>ZodBoolean.create({...d,coerce:!0}),bigint:d=>ZodBigInt.create({...d,coerce:!0}),date:d=>ZodDate.create({...d,coerce:!0})},NEVER=INVALID;var z=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap,getErrorMap,makeIssue,EMPTY_PATH,addIssueToContext,ParseStatus,INVALID,DIRTY,OK,isAborted,isDirty,isValid,isAsync,get util(){return util$1},get objectUtil(){return objectUtil},ZodParsedType,getParsedType,ZodType,datetimeRegex,ZodString,ZodNumber,ZodBigInt,ZodBoolean,ZodDate,ZodSymbol,ZodUndefined,ZodNull,ZodAny,ZodUnknown,ZodNever,ZodVoid,ZodArray,ZodObject,ZodUnion,ZodDiscriminatedUnion,ZodIntersection,ZodTuple,ZodRecord,ZodMap,ZodSet,ZodFunction,ZodLazy,ZodLiteral,ZodEnum,ZodNativeEnum,ZodPromise,ZodEffects,ZodTransformer:ZodEffects,ZodOptional,ZodNullable,ZodDefault,ZodCatch,ZodNaN,BRAND,ZodBranded,ZodPipeline,ZodReadonly,custom,Schema:ZodType,ZodSchema:ZodType,late,get ZodFirstPartyTypeKind(){return ZodFirstPartyTypeKind},coerce,any:anyType,array:arrayType,bigint:bigIntType,boolean:booleanType,date:dateType,discriminatedUnion:discriminatedUnionType,effect:effectsType,enum:enumType,function:functionType,instanceof:instanceOfType,intersection:intersectionType,lazy:lazyType,literal:literalType,map:mapType,nan:nanType,nativeEnum:nativeEnumType,never:neverType,null:nullType,nullable:nullableType,number:numberType,object:objectType,oboolean,onumber,optional:optionalType,ostring,pipeline:pipelineType,preprocess:preprocessType,promise:promiseType,record:recordType,set:setType,strictObject:strictObjectType,string:stringType,symbol:symbolType,transformer:effectsType,tuple:tupleType,undefined:undefinedType,union:unionType,unknown:unknownType,void:voidType,NEVER,ZodIssueCode,quotelessJson,ZodError}),Edge,Edge2;Edge2=Edge||(Edge={}),Edge2[Edge2.EXTEND=1]="EXTEND",Edge2[Edge2.WRAP=2]="WRAP",Edge2[Edge2.CROP=3]="CROP";const JimpClassSchema=z.object({bitmap:z.object({data:z.union([z.instanceof(Buffer),z.instanceof(Uint8Array)]),width:z.number(),height:z.number()})}),BlitOptionsSchemaComplex=z.object({src:JimpClassSchema,x:z.number().optional(),y:z.number().optional(),srcX:z.number().optional(),srcY:z.number().optional(),srcW:z.number().optional(),srcH:z.number().optional()}),BlitOptionsSchema=z.union([JimpClassSchema,BlitOptionsSchemaComplex]),methods$h={blit(d,m){const g=BlitOptionsSchema.parse(m);let{src:w,x:$=0,y:I=0,srcX:D=0,srcY:q=0,srcW:j=w.bitmap.width,srcH:G=w.bitmap.height}="bitmap"in g?{src:g}:g;if(!("bitmap"in w))throw new Error("The source must be a Jimp image");if(typeof $!="number"||typeof I!="number")throw new Error("x and y must be numbers");$=Math.round($),I=Math.round(I),D=Math.round(D),q=Math.round(q),j=Math.round(j),G=Math.round(G);const H=d.bitmap.width,W=d.bitmap.height;return scan(w,D,q,j,G,(function(V,K,Z){const Q=$+V-D,J=I+K-q;if(Q>=0&&J>=0&&H-Q>0&&W-J>0){const re=d.getPixelIndex(Q,J),se={r:w.bitmap.data[Z]||0,g:w.bitmap.data[Z+1]||0,b:w.bitmap.data[Z+2]||0,a:w.bitmap.data[Z+3]||0},oe={r:d.bitmap.data[re]||0,g:d.bitmap.data[re+1]||0,b:d.bitmap.data[re+2]||0,a:d.bitmap.data[re+3]||0};d.bitmap.data[re]=(se.a*(se.r-oe.r)-oe.r+255>>8)+oe.r,d.bitmap.data[re+1]=(se.a*(se.g-oe.g)-oe.g+255>>8)+oe.g,d.bitmap.data[re+2]=(se.a*(se.b-oe.b)-oe.b+255>>8)+oe.b,d.bitmap.data[re+3]=limit255(oe.a+se.a)}})),d}},mulTable=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1],shgTable=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18],methods$g={blur(d,m){if(typeof m!="number")throw new Error("r must be a number");if(m<1)throw new Error("r must be greater than 0");let g,w,$,I,D,q,j,G,H,W,V,K,Z;const Q=d.bitmap.width-1,J=d.bitmap.height-1,re=m+1,se=mulTable[m],oe=shgTable[m],ee=[],ae=[],ce=[],le=[],de=[],_e=[];let we=2;for(;we-- >0;){for(K=0,Z=0,q=0;q<d.bitmap.height;q++){for(g=d.bitmap.data[Z]*re,w=d.bitmap.data[Z+1]*re,$=d.bitmap.data[Z+2]*re,I=d.bitmap.data[Z+3]*re,j=1;j<=m;j++)G=Z+((j>Q?Q:j)<<2),g+=d.bitmap.data[G++],w+=d.bitmap.data[G++],$+=d.bitmap.data[G++],I+=d.bitmap.data[G];for(D=0;D<d.bitmap.width;D++)ee[K]=g,ae[K]=w,ce[K]=$,le[K]=I,q===0&&(de[D]=((G=D+re)<Q?G:Q)<<2,_e[D]=(G=D-m)>0?G<<2:0),H=Z+de[D],W=Z+_e[D],g+=d.bitmap.data[H++]-d.bitmap.data[W++],w+=d.bitmap.data[H++]-d.bitmap.data[W++],$+=d.bitmap.data[H++]-d.bitmap.data[W++],I+=d.bitmap.data[H]-d.bitmap.data[W++],K++;Z+=d.bitmap.width<<2}for(D=0;D<d.bitmap.width;D++){for(V=D,g=ee[V]*re,w=ae[V]*re,$=ce[V]*re,I=le[V]*re,j=1;j<=m;j++)V+=j>J?0:d.bitmap.width,g+=ee[V],w+=ae[V],$+=ce[V],I+=le[V];for(K=D<<2,q=0;q<d.bitmap.height;q++)d.bitmap.data[K]=limit255(g*se>>>oe),d.bitmap.data[K+1]=limit255(w*se>>>oe),d.bitmap.data[K+2]=limit255($*se>>>oe),d.bitmap.data[K+3]=limit255(I*se>>>oe),D===0&&(de[q]=((G=q+re)<J?G:J)*d.bitmap.width,_e[q]=(G=q-m)>0?G*d.bitmap.width:0),H=D+de[q],W=D+_e[q],g+=ee[H]-ee[W],w+=ae[H]-ae[W],$+=ce[H]-ce[W],I+=le[H]-le[W],K+=d.bitmap.width<<2}}return d},gaussian(d,m){if(typeof m!="number")throw new Error("r must be a number");if(m<1)throw new Error("r must be greater than 0");const g=Math.ceil(2.57*m),w=2*g+1,$=m*m*2,I=$*Math.PI,D=[];for(let q=0;q<w;q++){const j=[];for(let G=0;G<w;G++){const H=(G-g)**2+(q-g)**2;j[G]=Math.exp(-H/$)/I}D.push(j)}for(let q=0;q<d.bitmap.height;q++)for(let j=0;j<d.bitmap.width;j++){let G=0,H=0,W=0,V=0,K=0;for(let Z=0;Z<w;Z++){for(let J=0;J<w;J++){const re=Math.min(d.bitmap.width-1,Math.max(0,J+j-g)),se=Math.min(d.bitmap.height-1,Math.max(0,Z+q-g)),oe=D[Z][J],ee=se*d.bitmap.width+re<<2;G+=d.bitmap.data[ee]*oe,H+=d.bitmap.data[ee+1]*oe,W+=d.bitmap.data[ee+2]*oe,V+=d.bitmap.data[ee+3]*oe,K+=oe}const Q=q*d.bitmap.width+j<<2;d.bitmap.data[Q]=Math.round(G/K),d.bitmap.data[Q+1]=Math.round(H/K),d.bitmap.data[Q+2]=Math.round(W/K),d.bitmap.data[Q+3]=Math.round(V/K)}}return d}},CircleOptionsSchema=z.object({x:z.number().optional(),y:z.number().optional(),radius:z.number().min(0).optional()}),methods$f={circle(d,m={}){const g=CircleOptionsSchema.parse(m),w=g.radius||(d.bitmap.width>d.bitmap.height?d.bitmap.height:d.bitmap.width)/2,$=typeof g.x=="number"?g.x:d.bitmap.width/2,I=typeof g.y=="number"?g.y:d.bitmap.height/2;return d.scan(((D,q,j)=>{const G=Math.sqrt(Math.pow(D-$,2)+Math.pow(q-I,2));w-G<=0?d.bitmap.data[j+3]=0:w-G<1&&(d.bitmap.data[j+3]=255*(w-G))})),d}},ConvolutionMatrixSchema=z.array(z.number()).min(1).array(),ConvolutionComplexOptionsSchema=z.object({kernel:ConvolutionMatrixSchema,edgeHandling:z.nativeEnum(Edge).optional()}),ConvolutionOptionsSchema=z.union([ConvolutionMatrixSchema,ConvolutionComplexOptionsSchema]),ConvoluteComplexOptionsSchema=z.object({kernel:ConvolutionMatrixSchema,x:z.number().optional(),y:z.number().optional(),w:z.number().optional(),h:z.number().optional()}),ConvoluteOptionsSchema=z.union([ConvolutionMatrixSchema,ConvoluteComplexOptionsSchema]),PixelateSize=z.number().min(1).max(1/0),PixelateComplexOptionsSchema=z.object({size:PixelateSize,x:z.number().optional(),y:z.number().optional(),w:z.number().optional(),h:z.number().optional()}),PixelateOptionsSchema=z.union([PixelateSize,PixelateComplexOptionsSchema]);function applyKernel(d,m,g,w){const $=[0,0,0,0],I=(m.length-1)/2;for(let D=0;D<m.length;D+=1)for(let q=0;q<m[D].length;q+=1){const j=d.getPixelIndex(g+D-I,w+q-I);$[0]+=d.bitmap.data[j]*m[D][q],$[1]+=d.bitmap.data[j+1]*m[D][q],$[2]+=d.bitmap.data[j+2]*m[D][q],$[3]+=d.bitmap.data[j+3]*m[D][q]}return $}function mix(d,m,g=50){return{r:(m.r-d.r)*(g/100)+d.r,g:(m.g-d.g)*(g/100)+d.g,b:(m.b-d.b)*(g/100)+d.b}}const HueActionSchema=z.object({apply:z.literal("hue"),params:z.tuple([z.number().min(-360).max(360)])}),SpinActionSchema=z.object({apply:z.literal("spin"),params:z.tuple([z.number().min(-360).max(360)])}),LightenActionSchema=z.object({apply:z.literal("lighten"),params:z.tuple([z.number().min(0).max(100)]).optional()}),RGBColorSchema=z.object({r:z.number().min(0).max(255),g:z.number().min(0).max(255),b:z.number().min(0).max(255)}),MixActionSchema=z.object({apply:z.literal("mix"),params:z.union([z.tuple([RGBColorSchema]),z.tuple([RGBColorSchema,z.number().min(0).max(100)])])}),TintActionSchema=z.object({apply:z.literal("tint"),params:z.tuple([z.number().min(0).max(100)]).optional()}),ShadeActionSchema=z.object({apply:z.literal("shade"),params:z.tuple([z.number().min(0).max(100)]).optional()}),XorActionSchema=z.object({apply:z.literal("xor"),params:z.tuple([RGBColorSchema])}),RedActionSchema=z.object({apply:z.literal("red"),params:z.tuple([z.number().min(-255).max(255)])}),GreenActionSchema=z.object({apply:z.literal("green"),params:z.tuple([z.number().min(-255).max(255)])}),BlueActionSchema=z.object({apply:z.literal("blue"),params:z.tuple([z.number().min(-255).max(255)])}),BrightenActionSchema=z.object({apply:z.literal("brighten"),params:z.tuple([z.number().min(0).max(100)]).optional()}),DarkenActionSchema=z.object({apply:z.literal("darken"),params:z.tuple([z.number().min(0).max(100)]).optional()}),DesaturateActionSchema=z.object({apply:z.literal("desaturate"),params:z.tuple([z.number().min(0).max(100)]).optional()}),SaturateActionSchema=z.object({apply:z.literal("saturate"),params:z.tuple([z.number().min(0).max(100)]).optional()}),GrayscaleActionSchema=z.object({apply:z.literal("greyscale"),params:z.tuple([]).optional()}),ColorActionNameSchema=z.union([HueActionSchema,SpinActionSchema,LightenActionSchema,MixActionSchema,TintActionSchema,ShadeActionSchema,XorActionSchema,RedActionSchema,GreenActionSchema,BlueActionSchema,BrightenActionSchema,DarkenActionSchema,DesaturateActionSchema,SaturateActionSchema,GrayscaleActionSchema]);function histogram(d){const m={r:new Array(256).fill(0),g:new Array(256).fill(0),b:new Array(256).fill(0)};return d.scan(((g,w,$)=>{m.r[d.bitmap.data[$+0]]++,m.g[d.bitmap.data[$+1]]++,m.b[d.bitmap.data[$+2]]++})),m}const normalizeValue=function(d,m,g){return 255*(d-m)/(g-m)},getBounds=function(d){return[d.findIndex((m=>m>0)),255-d.slice().reverse().findIndex((m=>m>0))]},methods$e={normalize(d){const m=histogram(d),g={r:getBounds(m.r),g:getBounds(m.g),b:getBounds(m.b)};return d.scan(((w,$,I)=>{const D=d.bitmap.data[I+0],q=d.bitmap.data[I+1],j=d.bitmap.data[I+2];d.bitmap.data[I+0]=normalizeValue(D,g.r[0],g.r[1]),d.bitmap.data[I+1]=normalizeValue(q,g.g[0],g.g[1]),d.bitmap.data[I+2]=normalizeValue(j,g.b[0],g.b[1])})),d},invert:d=>(d.scan(((m,g,w)=>{d.bitmap.data[w]=255-d.bitmap.data[w],d.bitmap.data[w+1]=255-d.bitmap.data[w+1],d.bitmap.data[w+2]=255-d.bitmap.data[w+2]})),d),brightness(d,m){if(typeof m!="number")throw new Error("val must be numbers");return d.scan(((g,w,$)=>{d.bitmap.data[$]=limit255(d.bitmap.data[$]*m),d.bitmap.data[$+1]=limit255(d.bitmap.data[$+1]*m),d.bitmap.data[$+2]=limit255(d.bitmap.data[$+2]*m)})),d},contrast(d,m){if(typeof m!="number")throw new Error("val must be numbers");if(m<-1||m>1)throw new Error("val must be a number between -1 and +1");const g=(m+1)/(1-m);function w($){return($=Math.floor(g*($-127)+127))<0?0:$>255?255:$}return d.scan((($,I,D)=>{d.bitmap.data[D]=w(d.bitmap.data[D]),d.bitmap.data[D+1]=w(d.bitmap.data[D+1]),d.bitmap.data[D+2]=w(d.bitmap.data[D+2])})),d},posterize(d,m){if(typeof m!="number")throw new Error("n must be numbers");return m<2&&(m=2),d.scan(((g,w,$)=>{const I=d.bitmap.data[$],D=d.bitmap.data[$+1],q=d.bitmap.data[$+2];d.bitmap.data[$]=Math.floor(I/255*(m-1))/(m-1)*255,d.bitmap.data[$+1]=Math.floor(D/255*(m-1))/(m-1)*255,d.bitmap.data[$+2]=Math.floor(q/255*(m-1))/(m-1)*255})),d},greyscale:d=>(d.scan(((m,g,w)=>{const $=.2126*d.bitmap.data[w]+.7152*d.bitmap.data[w+1]+.0722*d.bitmap.data[w+2];d.bitmap.data[w]=$,d.bitmap.data[w+1]=$,d.bitmap.data[w+2]=$})),d),opacity(d,m){if(typeof m!="number")throw new Error("f must be a number");if(m<0||m>1)throw new Error("f must be a number from 0 to 1");return d.scan(((g,w,$)=>{const I=d.bitmap.data[$+3]*m;d.bitmap.data[$+3]=I})),d},sepia:d=>(d.scan(((m,g,w)=>{let $=d.bitmap.data[w],I=d.bitmap.data[w+1],D=d.bitmap.data[w+2];$=.393*$+.769*I+.189*D,I=.349*$+.686*I+.168*D,D=.272*$+.534*I+.131*D,d.bitmap.data[w]=$<255?$:255,d.bitmap.data[w+1]=I<255?I:255,d.bitmap.data[w+2]=D<255?D:255})),d),fade(d,m){if(typeof m!="number")throw new Error("f must be a number");if(m<0||m>1)throw new Error("f must be a number from 0 to 1");return this.opacity(d,1-m)},convolution(d,m){const g=ConvolutionOptionsSchema.parse(m),{kernel:w,edgeHandling:$=Edge.EXTEND}="kernel"in g?g:{kernel:g,edgeHandling:void 0};if(!w[0])throw new Error("kernel must be a matrix");const I=Buffer.from(d.bitmap.data),D=w.length,q=w[0].length,j=Math.floor(D/2),G=Math.floor(q/2),H=-j,W=-G;let V,K,Z,Q,J,re,se,oe,ee,ae;return d.scan(((ce,le,de)=>{Q=0,Z=0,K=0;for(let _e=H;_e<=j;_e++)for(let we=W;we<=G;we++)oe=ce+we,ee=le+_e,V=w[_e+j][we+G],ae=d.getPixelIndex(oe,ee,$),ae===-1?(se=0,re=0,J=0):(J=d.bitmap.data[ae+0],re=d.bitmap.data[ae+1],se=d.bitmap.data[ae+2]),K+=V*J,Z+=V*re,Q+=V*se;K<0&&(K=0),Z<0&&(Z=0),Q<0&&(Q=0),K>255&&(K=255),Z>255&&(Z=255),Q>255&&(Q=255),I[de+0]=K,I[de+1]=Z,I[de+2]=Q})),d.bitmap.data=I,d},opaque:d=>(d.scan(((m,g,w)=>{d.bitmap.data[w+3]=255})),d),pixelate(d,m){const g=PixelateOptionsSchema.parse(m),{size:w,x:$=0,y:I=0,w:D=d.bitmap.width-$,h:q=d.bitmap.height-I}=typeof g=="number"?{size:g}:g,j=[[1/16,2/16,1/16],[2/16,.25,2/16],[1/16,2/16,1/16]],G=clone(d);return scan(G,$,I,D,q,((H,W,V)=>{H=w*Math.floor(H/w),W=w*Math.floor(W/w);const K=applyKernel(G,j,H,W);d.bitmap.data[V]=K[0],d.bitmap.data[V+1]=K[1],d.bitmap.data[V+2]=K[2],d.bitmap.data[V+3]=K[3]})),d},convolute(d,m){const g=ConvoluteOptionsSchema.parse(m),{kernel:w,x:$=0,y:I=0,w:D=d.bitmap.width-$,h:q=d.bitmap.height-I}="kernel"in g?g:{kernel:g},j=clone(d);return scan(j,$,I,D,q,((G,H,W)=>{const V=applyKernel(j,w,G,H);d.bitmap.data[W]=limit255(V[0]),d.bitmap.data[W+1]=limit255(V[1]),d.bitmap.data[W+2]=limit255(V[2]),d.bitmap.data[W+3]=limit255(V[3])})),d},color(d,m){if(!m||!Array.isArray(m))throw new Error("actions must be an array");return m.forEach((g=>ColorActionNameSchema.parse(g))),m=m.map((g=>(g.apply!=="xor"&&g.apply!=="mix"||(g.params[0]=tinycolor(g.params[0]).toRgb()),g))),d.scan(((g,w,$)=>{let I={r:d.bitmap.data[$],g:d.bitmap.data[$+1],b:d.bitmap.data[$+2]};const D=(q,j)=>limit255(I[q]+j);m.forEach((q=>{if(q.apply==="mix")I=mix(I,q.params[0],q.params[1]);else if(q.apply==="tint")I=mix(I,{r:255,g:255,b:255},q.params?.[0]);else if(q.apply==="shade")I=mix(I,{r:0,g:0,b:0},q.params?.[0]);else if(q.apply==="xor")I={r:I.r^q.params[0].r,g:I.g^q.params[0].g,b:I.b^q.params[0].b};else if(q.apply==="red")I.r=D("r",q.params[0]);else if(q.apply==="green")I.g=D("g",q.params[0]);else if(q.apply==="blue")I.b=D("b",q.params[0]);else{q.apply==="hue"&&(q.apply="spin");const j=tinycolor(I),G=j[q.apply].bind(j);if(!G)throw new Error("action "+q.apply+" not supported");I=G(...q.params||[]).toRgb()}})),d.bitmap.data[$]=I.r,d.bitmap.data[$+1]=I.g,d.bitmap.data[$+2]=I.b})),d}};var lib$1={},ieee754={read:function(d,m,g,w,$){var I,D,q=8*$-w-1,j=(1<<q)-1,G=j>>1,H=-7,W=g?$-1:0,V=g?-1:1,K=d[m+W];for(W+=V,I=K&(1<<-H)-1,K>>=-H,H+=q;H>0;I=256*I+d[m+W],W+=V,H-=8);for(D=I&(1<<-H)-1,I>>=-H,H+=w;H>0;D=256*D+d[m+W],W+=V,H-=8);if(I===0)I=1-G;else{if(I===j)return D?NaN:1/0*(K?-1:1);D+=Math.pow(2,w),I-=G}return(K?-1:1)*D*Math.pow(2,I-w)},write:function(d,m,g,w,$,I){var D,q,j,G=8*I-$-1,H=(1<<G)-1,W=H>>1,V=$===23?Math.pow(2,-24)-Math.pow(2,-77):0,K=w?0:I-1,Z=w?1:-1,Q=m<0||m===0&&1/m<0?1:0;for(m=Math.abs(m),isNaN(m)||m===1/0?(q=isNaN(m)?1:0,D=H):(D=Math.floor(Math.log(m)/Math.LN2),m*(j=Math.pow(2,-D))<1&&(D--,j*=2),(m+=D+W>=1?V/j:V*Math.pow(2,1-W))*j>=2&&(D++,j/=2),D+W>=H?(q=0,D=H):D+W>=1?(q=(m*j-1)*Math.pow(2,$),D+=W):(q=m*Math.pow(2,W-1)*Math.pow(2,$),D=0));$>=8;d[g+K]=255&q,K+=Z,q/=256,$-=8);for(D=D<<$|q,G+=$;G>0;d[g+K]=255&D,K+=Z,D/=256,G-=8);d[g+K-Z]|=128*Q}};(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.AnsiStringType=d.StringType=d.BufferType=d.Uint8ArrayType=d.IgnoreType=d.Float80_LE=d.Float80_BE=d.Float64_LE=d.Float64_BE=d.Float32_LE=d.Float32_BE=d.Float16_LE=d.Float16_BE=d.INT64_BE=d.UINT64_BE=d.INT64_LE=d.UINT64_LE=d.INT32_LE=d.INT32_BE=d.INT24_BE=d.INT24_LE=d.INT16_LE=d.INT16_BE=d.INT8=d.UINT32_BE=d.UINT32_LE=d.UINT24_BE=d.UINT24_LE=d.UINT16_BE=d.UINT16_LE=d.UINT8=void 0;const m=ieee754;function g($){return new DataView($.buffer,$.byteOffset)}d.UINT8={len:1,get:($,I)=>g($).getUint8(I),put:($,I,D)=>(g($).setUint8(I,D),I+1)},d.UINT16_LE={len:2,get:($,I)=>g($).getUint16(I,!0),put:($,I,D)=>(g($).setUint16(I,D,!0),I+2)},d.UINT16_BE={len:2,get:($,I)=>g($).getUint16(I),put:($,I,D)=>(g($).setUint16(I,D),I+2)},d.UINT24_LE={len:3,get($,I){const D=g($);return D.getUint8(I)+(D.getUint16(I+1,!0)<<8)},put($,I,D){const q=g($);return q.setUint8(I,255&D),q.setUint16(I+1,D>>8,!0),I+3}},d.UINT24_BE={len:3,get($,I){const D=g($);return(D.getUint16(I)<<8)+D.getUint8(I+2)},put($,I,D){const q=g($);return q.setUint16(I,D>>8),q.setUint8(I+2,255&D),I+3}},d.UINT32_LE={len:4,get:($,I)=>g($).getUint32(I,!0),put:($,I,D)=>(g($).setUint32(I,D,!0),I+4)},d.UINT32_BE={len:4,get:($,I)=>g($).getUint32(I),put:($,I,D)=>(g($).setUint32(I,D),I+4)},d.INT8={len:1,get:($,I)=>g($).getInt8(I),put:($,I,D)=>(g($).setInt8(I,D),I+1)},d.INT16_BE={len:2,get:($,I)=>g($).getInt16(I),put:($,I,D)=>(g($).setInt16(I,D),I+2)},d.INT16_LE={len:2,get:($,I)=>g($).getInt16(I,!0),put:($,I,D)=>(g($).setInt16(I,D,!0),I+2)},d.INT24_LE={len:3,get($,I){const D=d.UINT24_LE.get($,I);return D>8388607?D-16777216:D},put($,I,D){const q=g($);return q.setUint8(I,255&D),q.setUint16(I+1,D>>8,!0),I+3}},d.INT24_BE={len:3,get($,I){const D=d.UINT24_BE.get($,I);return D>8388607?D-16777216:D},put($,I,D){const q=g($);return q.setUint16(I,D>>8),q.setUint8(I+2,255&D),I+3}},d.INT32_BE={len:4,get:($,I)=>g($).getInt32(I),put:($,I,D)=>(g($).setInt32(I,D),I+4)},d.INT32_LE={len:4,get:($,I)=>g($).getInt32(I,!0),put:($,I,D)=>(g($).setInt32(I,D,!0),I+4)},d.UINT64_LE={len:8,get:($,I)=>g($).getBigUint64(I,!0),put:($,I,D)=>(g($).setBigUint64(I,D,!0),I+8)},d.INT64_LE={len:8,get:($,I)=>g($).getBigInt64(I,!0),put:($,I,D)=>(g($).setBigInt64(I,D,!0),I+8)},d.UINT64_BE={len:8,get:($,I)=>g($).getBigUint64(I),put:($,I,D)=>(g($).setBigUint64(I,D),I+8)},d.INT64_BE={len:8,get:($,I)=>g($).getBigInt64(I),put:($,I,D)=>(g($).setBigInt64(I,D),I+8)},d.Float16_BE={len:2,get($,I){return m.read($,I,!1,10,this.len)},put($,I,D){return m.write($,D,I,!1,10,this.len),I+this.len}},d.Float16_LE={len:2,get($,I){return m.read($,I,!0,10,this.len)},put($,I,D){return m.write($,D,I,!0,10,this.len),I+this.len}},d.Float32_BE={len:4,get:($,I)=>g($).getFloat32(I),put:($,I,D)=>(g($).setFloat32(I,D),I+4)},d.Float32_LE={len:4,get:($,I)=>g($).getFloat32(I,!0),put:($,I,D)=>(g($).setFloat32(I,D,!0),I+4)},d.Float64_BE={len:8,get:($,I)=>g($).getFloat64(I),put:($,I,D)=>(g($).setFloat64(I,D),I+8)},d.Float64_LE={len:8,get:($,I)=>g($).getFloat64(I,!0),put:($,I,D)=>(g($).setFloat64(I,D,!0),I+8)},d.Float80_BE={len:10,get($,I){return m.read($,I,!1,63,this.len)},put($,I,D){return m.write($,D,I,!1,63,this.len),I+this.len}},d.Float80_LE={len:10,get($,I){return m.read($,I,!0,63,this.len)},put($,I,D){return m.write($,D,I,!0,63,this.len),I+this.len}},d.IgnoreType=class{constructor($){this.len=$}get($,I){}},d.Uint8ArrayType=class{constructor($){this.len=$}get($,I){return $.subarray(I,I+this.len)}},d.BufferType=class{constructor($){this.len=$}get($,I){return Buffer.from($.subarray(I,I+this.len))}},d.StringType=class{constructor($,I){this.len=$,this.encoding=I}get($,I){return Buffer.from($).toString(this.encoding,I,I+this.len)}};class w{constructor(I){this.len=I}static decode(I,D,q){let j="";for(let G=D;G<q;++G)j+=w.codePointToString(w.singleByteDecoder(I[G]));return j}static inRange(I,D,q){return D<=I&&I<=q}static codePointToString(I){return I<=65535?String.fromCharCode(I):(I-=65536,String.fromCharCode(55296+(I>>10),56320+(1023&I)))}static singleByteDecoder(I){if(w.inRange(I,0,127))return I;const D=w.windows1252[I-128];if(D===null)throw Error("invaliding encoding");return D}get(I,D=0){return w.decode(I,D,D+this.len)}}d.AnsiStringType=w,w.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]})(lib$1);var core$1={},ReadStreamTokenizer$1={},AbstractTokenizer$1={},lib={},EndOfFileStream={};(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.EndOfStreamError=d.defaultMessages=void 0,d.defaultMessages="End-Of-Stream";class m extends Error{constructor(){super(d.defaultMessages)}}d.EndOfStreamError=m})(EndOfFileStream);var StreamReader={},Deferred$1={};Object.defineProperty(Deferred$1,"__esModule",{value:!0}),Deferred$1.Deferred=void 0;class Deferred{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise(((m,g)=>{this.reject=g,this.resolve=m}))}}Deferred$1.Deferred=Deferred,(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.StreamReader=d.EndOfStreamError=void 0;const m=EndOfFileStream,g=Deferred$1;var w=EndOfFileStream;Object.defineProperty(d,"EndOfStreamError",{enumerable:!0,get:function(){return w.EndOfStreamError}}),d.StreamReader=class{constructor($){if(this.s=$,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!$.read||!$.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",(()=>this.reject(new m.EndOfStreamError))),this.s.once("error",(I=>this.reject(I))),this.s.once("close",(()=>this.reject(new Error("Stream closed"))))}async peek($,I,D){const q=await this.read($,I,D);return this.peekQueue.push($.subarray(I,I+q)),q}async read($,I,D){if(D===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new m.EndOfStreamError;let q=D,j=0;for(;this.peekQueue.length>0&&q>0;){const G=this.peekQueue.pop();if(!G)throw new Error("peekData should be defined");const H=Math.min(G.length,q);$.set(G.subarray(0,H),I+j),j+=H,q-=H,H<G.length&&this.peekQueue.push(G.subarray(H))}for(;q>0&&!this.endOfStream;){const G=Math.min(q,1048576),H=await this.readFromStream($,I+j,G);if(j+=H,H<G)break;q-=H}return j}async readFromStream($,I,D){const q=this.s.read(D);if(q)return $.set(q,I),q.length;{const j={buffer:$,offset:I,length:D,deferred:new g.Deferred};return this.deferred=j.deferred,this.s.once("readable",(()=>{this.readDeferred(j)})),j.deferred.promise}}readDeferred($){const I=this.s.read($.length);I?($.buffer.set(I,$.offset),$.deferred.resolve(I.length),this.deferred=null):this.s.once("readable",(()=>{this.readDeferred($)}))}reject($){this.endOfStream=!0,this.deferred&&(this.deferred.reject($),this.deferred=null)}}})(StreamReader),(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.StreamReader=d.EndOfStreamError=void 0;var m=EndOfFileStream;Object.defineProperty(d,"EndOfStreamError",{enumerable:!0,get:function(){return m.EndOfStreamError}});var g=StreamReader;Object.defineProperty(d,"StreamReader",{enumerable:!0,get:function(){return g.StreamReader}})})(lib),Object.defineProperty(AbstractTokenizer$1,"__esModule",{value:!0}),AbstractTokenizer$1.AbstractTokenizer=void 0;const peek_readable_1$2=lib;class AbstractTokenizer{constructor(m){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=m||{}}async readToken(m,g=this.position){const w=Buffer.alloc(m.len);if(await this.readBuffer(w,{position:g})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(w,0)}async peekToken(m,g=this.position){const w=Buffer.alloc(m.len);if(await this.peekBuffer(w,{position:g})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(w,0)}async readNumber(m){if(await this.readBuffer(this.numBuffer,{length:m.len})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(this.numBuffer,0)}async peekNumber(m){if(await this.peekBuffer(this.numBuffer,{length:m.len})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(this.numBuffer,0)}async ignore(m){if(this.fileInfo.size!==void 0){const g=this.fileInfo.size-this.position;if(m>g)return this.position+=g,g}return this.position+=m,m}async close(){}normalizeOptions(m,g){if(g&&g.position!==void 0&&g.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return g?{mayBeLess:g.mayBeLess===!0,offset:g.offset?g.offset:0,length:g.length?g.length:m.length-(g.offset?g.offset:0),position:g.position?g.position:this.position}:{mayBeLess:!1,offset:0,length:m.length,position:this.position}}}AbstractTokenizer$1.AbstractTokenizer=AbstractTokenizer,Object.defineProperty(ReadStreamTokenizer$1,"__esModule",{value:!0}),ReadStreamTokenizer$1.ReadStreamTokenizer=void 0;const AbstractTokenizer_1$1=AbstractTokenizer$1,peek_readable_1$1=lib,maxBufferSize=256e3;class ReadStreamTokenizer extends AbstractTokenizer_1$1.AbstractTokenizer{constructor(m,g){super(g),this.streamReader=new peek_readable_1$1.StreamReader(m)}async getFileInfo(){return this.fileInfo}async readBuffer(m,g){const w=this.normalizeOptions(m,g),$=w.position-this.position;if($>0)return await this.ignore($),this.readBuffer(m,g);if($<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(w.length===0)return 0;const I=await this.streamReader.read(m,w.offset,w.length);if(this.position+=I,(!g||!g.mayBeLess)&&I<w.length)throw new peek_readable_1$1.EndOfStreamError;return I}async peekBuffer(m,g){const w=this.normalizeOptions(m,g);let $=0;if(w.position){const I=w.position-this.position;if(I>0){const D=new Uint8Array(w.length+I);return $=await this.peekBuffer(D,{mayBeLess:w.mayBeLess}),m.set(D.subarray(I),w.offset),$-I}if(I<0)throw new Error("Cannot peek from a negative offset in a stream")}if(w.length>0){try{$=await this.streamReader.peek(m,w.offset,w.length)}catch(I){if(g&&g.mayBeLess&&I instanceof peek_readable_1$1.EndOfStreamError)return 0;throw I}if(!w.mayBeLess&&$<w.length)throw new peek_readable_1$1.EndOfStreamError}return $}async ignore(m){const g=Math.min(maxBufferSize,m),w=new Uint8Array(g);let $=0;for(;$<m;){const I=m-$,D=await this.readBuffer(w,{length:Math.min(g,I)});if(D<0)return D;$+=D}return $}}ReadStreamTokenizer$1.ReadStreamTokenizer=ReadStreamTokenizer;var BufferTokenizer$1={};Object.defineProperty(BufferTokenizer$1,"__esModule",{value:!0}),BufferTokenizer$1.BufferTokenizer=void 0;const peek_readable_1=lib,AbstractTokenizer_1=AbstractTokenizer$1;class BufferTokenizer extends AbstractTokenizer_1.AbstractTokenizer{constructor(m,g){super(g),this.uint8Array=m,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:m.length}async readBuffer(m,g){if(g&&g.position){if(g.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=g.position}const w=await this.peekBuffer(m,g);return this.position+=w,w}async peekBuffer(m,g){const w=this.normalizeOptions(m,g),$=Math.min(this.uint8Array.length-w.position,w.length);if(!w.mayBeLess&&$<w.length)throw new peek_readable_1.EndOfStreamError;return m.set(this.uint8Array.subarray(w.position,w.position+$),w.offset),$}async close(){}}BufferTokenizer$1.BufferTokenizer=BufferTokenizer,(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.fromBuffer=d.fromStream=d.EndOfStreamError=void 0;const m=ReadStreamTokenizer$1,g=BufferTokenizer$1;var w=lib;Object.defineProperty(d,"EndOfStreamError",{enumerable:!0,get:function(){return w.EndOfStreamError}}),d.fromStream=function($,I){return I=I||{},new m.ReadStreamTokenizer($,I)},d.fromBuffer=function($,I){return new g.BufferTokenizer($,I)}})(core$1);var util={stringToBytes:d=>[...d].map((m=>m.charCodeAt(0))),tarHeaderChecksumMatches:(d,m=0)=>{const g=parseInt(d.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(g))return!1;let w=256;for(let $=m;$<m+148;$++)w+=d[$];for(let $=m+156;$<m+512;$++)w+=d[$];return g===w},uint32SyncSafeToken:{get:(d,m)=>127&d[m+3]|d[m+2]<<7|d[m+1]<<14|d[m]<<21,len:4}},supported$1={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]};const Token=lib$1,strtok3=core$1,{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=util,supported=supported$1,minimumBytes=4100;async function fromStream(d){const m=await strtok3.fromStream(d);try{return await fromTokenizer(m)}finally{await m.close()}}async function fromBuffer(d){if(!(d instanceof Uint8Array||d instanceof ArrayBuffer||Buffer.isBuffer(d)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof d}\``);const m=d instanceof Buffer?d:Buffer.from(d);if(m&&m.length>1)return fromTokenizer(strtok3.fromBuffer(m))}function _check(d,m,g){g={offset:0,...g};for(const[w,$]of m.entries())if(g.mask){if($!==(g.mask[w]&d[w+g.offset]))return!1}else if($!==d[w+g.offset])return!1;return!0}async function fromTokenizer(d){try{return _fromTokenizer(d)}catch(m){if(!(m instanceof strtok3.EndOfStreamError))throw m}}async function _fromTokenizer(d){let m=Buffer.alloc(minimumBytes);const g=($,I)=>_check(m,$,I),w=($,I)=>g(stringToBytes($),I);if(d.fileInfo.size||(d.fileInfo.size=Number.MAX_SAFE_INTEGER),await d.peekBuffer(m,{length:12,mayBeLess:!0}),g([66,77]))return{ext:"bmp",mime:"image/bmp"};if(g([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(g([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(g([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(g([37,33]))return await d.peekBuffer(m,{length:24,mayBeLess:!0}),w("PS-Adobe-",{offset:2})&&w(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(g([31,160])||g([31,157]))return{ext:"Z",mime:"application/x-compress"};if(g([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(g([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(g([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(g([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(w("ID3")){await d.ignore(6);const $=await d.readToken(uint32SyncSafeToken);return d.position+$>d.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await d.ignore($),fromTokenizer(d))}if(w("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((m[0]===67||m[0]===70)&&g([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(g([71,73,70]))return{ext:"gif",mime:"image/gif"};if(w("FLIF"))return{ext:"flif",mime:"image/flif"};if(w("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(w("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(w("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(w("FORM"))return{ext:"aif",mime:"audio/aiff"};if(w("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(g([80,75,3,4])){try{for(;d.position+30<d.fileInfo.size;){await d.readBuffer(m,{length:30});const $={compressedSize:m.readUInt32LE(18),uncompressedSize:m.readUInt32LE(22),filenameLength:m.readUInt16LE(26),extraFieldLength:m.readUInt16LE(28)};if($.filename=await d.readToken(new Token.StringType($.filenameLength,"utf-8")),await d.ignore($.extraFieldLength),$.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if($.filename.endsWith(".rels")||$.filename.endsWith(".xml"))switch($.filename.split("/")[0]){case"_rels":default:break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}if($.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if($.filename.startsWith("3D/")&&$.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if($.filename==="mimetype"&&$.compressedSize===$.uncompressedSize)switch(await d.readToken(new Token.StringType($.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"}}if($.compressedSize===0){let I=-1;for(;I<0&&d.position<d.fileInfo.size;)await d.peekBuffer(m,{mayBeLess:!0}),I=m.indexOf("504B0304",0,"hex"),await d.ignore(I>=0?I:m.length)}else await d.ignore($.compressedSize)}}catch($){if(!($ instanceof strtok3.EndOfStreamError))throw $}return{ext:"zip",mime:"application/zip"}}if(w("OggS")){await d.ignore(28);const $=Buffer.alloc(8);return await d.readBuffer($),_check($,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check($,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check($,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check($,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check($,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check($,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(g([80,75])&&(m[2]===3||m[2]===5||m[2]===7)&&(m[3]===4||m[3]===6||m[3]===8))return{ext:"zip",mime:"application/zip"};if(w("ftyp",{offset:4})&&96&m[8]){const $=m.toString("binary",8,12).replace("\0"," ").trim();switch($){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return $.startsWith("3g")?$.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(w("MThd"))return{ext:"mid",mime:"audio/midi"};if(w("wOFF")&&(g([0,1,0,0],{offset:4})||w("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(w("wOF2")&&(g([0,1,0,0],{offset:4})||w("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(g([212,195,178,161])||g([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(w("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(w("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(w("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(g([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(w("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(w("%PDF")){await d.ignore(1350);const $=10485760,I=Buffer.alloc(Math.min($,d.fileInfo.size));return await d.readBuffer(I,{mayBeLess:!0}),I.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(g([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(g([73,73,42,0]))return w("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:g([28,0,254,0],{offset:8})||g([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:g([8,0,0,0],{offset:4})&&(g([45,0,254,0],{offset:8})||g([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(m=Buffer.alloc(24),await d.peekBuffer(m),(g([16,251,134,1],{offset:4})||g([8,0,0,0],{offset:4}))&&g([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(g([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(w("MAC "))return{ext:"ape",mime:"audio/ape"};if(g([26,69,223,163])){async function $(){const j=await d.peekNumber(Token.UINT8);let G=128,H=0;for(;!(j&G)&&G!==0;)++H,G>>=1;const W=Buffer.alloc(H+1);return await d.readBuffer(W),W}async function I(){const j=await $(),G=await $();G[0]^=128>>G.length-1;const H=Math.min(6,G.length);return{id:j.readUIntBE(0,j.length),len:G.readUIntBE(G.length-H,H)}}async function D(j,G){for(;G>0;){const H=await I();if(H.id===17026)return d.readToken(new Token.StringType(H.len,"utf-8"));await d.ignore(H.len),--G}}const q=await I();switch(await D(0,q.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(g([82,73,70,70])){if(g([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(g([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(g([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(w("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(g([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(w("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(w("MSCF")||w("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(g([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(g([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(g([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(g([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(w("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(w("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(g([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(w("IMPM"))return{ext:"it",mime:"audio/x-it"};if(w("-lh0-",{offset:2})||w("-lh1-",{offset:2})||w("-lh2-",{offset:2})||w("-lh3-",{offset:2})||w("-lh4-",{offset:2})||w("-lh5-",{offset:2})||w("-lh6-",{offset:2})||w("-lh7-",{offset:2})||w("-lzs-",{offset:2})||w("-lz4-",{offset:2})||w("-lz5-",{offset:2})||w("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(g([0,0,1,186])){if(g([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(g([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(w("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(g([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(w("<?xml "))return{ext:"xml",mime:"application/xml"};if(g([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(g([82,97,114,33,26,7])&&(m[6]===0||m[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(w("solid "))return{ext:"stl",mime:"model/stl"};if(w("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(w("!<arch>"))return await d.ignore(8),await d.readToken(new Token.StringType(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(g([137,80,78,71,13,10,26,10])){async function $(){return{length:await d.readToken(Token.INT32_BE),type:await d.readToken(new Token.StringType(4,"binary"))}}await d.ignore(8);do{const I=await $();if(I.length<0)return;switch(I.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await d.ignore(I.length+4)}}while(d.position+8<d.fileInfo.size);return{ext:"png",mime:"image/png"}}if(g([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(g([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(g([102,114,101,101],{offset:4})||g([109,100,97,116],{offset:4})||g([109,111,111,118],{offset:4})||g([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(g([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(w("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(g([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(g([48,38,178,117,142,102,207,17,166,217])){async function $(){const I=Buffer.alloc(16);return await d.readBuffer(I),{id:I,size:Number(await d.readToken(Token.UINT64_LE))}}for(await d.ignore(30);d.position+24<d.fileInfo.size;){const I=await $();let D=I.size-24;if(_check(I.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const q=Buffer.alloc(16);if(D-=await d.readBuffer(q),_check(q,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(q,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await d.ignore(D)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(g([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((g([126,16,4])||g([126,24,4]))&&g([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(g([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(g([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await d.ignore(20),await d.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(g([255,10])||g([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(g([0,0,1,186])||g([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(g([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(g([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(g([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(g([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await d.peekBuffer(m,{length:Math.min(256,d.fileInfo.size),mayBeLess:!0}),w("BEGIN:")){if(w("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(w("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(w("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(w("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(w("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(g([4,0,0,0])&&m.length>=16){const $=m.readUInt32LE(12);if($>12&&m.length>=$+16)try{const I=m.slice(16,$+16).toString();if(JSON.parse(I).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(g([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(w("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(g([71],{offset:4})&&(g([71],{offset:192})||g([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(g([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(g([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(g([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(g([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(g([76,80],{offset:34})&&(g([0,0,1],{offset:8})||g([1,0,2],{offset:8})||g([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(g([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await d.peekBuffer(m,{length:Math.min(512,d.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(m))return{ext:"tar",mime:"application/x-tar"};if(g([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(w("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(m.length>=2&&g([255,224],{offset:0,mask:[255,224]})){if(g([16],{offset:1,mask:[22]}))return g([8],{offset:1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(g([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(g([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(g([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream=readableStream=>new Promise(((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",(async()=>{const d=new stream.PassThrough;let m;m=stream.pipeline?stream.pipeline(readableStream,d,(()=>{})):readableStream.pipe(d);const g=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const w=await fromBuffer(g);d.fileType=w}catch(w){reject(w)}resolve(m)}))})),fileType={fromStream,fromTokenizer,fromBuffer,stream};Object.defineProperty(fileType,"extensions",{get:()=>new Set(supported.extensions)}),Object.defineProperty(fileType,"mimeTypes",{get:()=>new Set(supported.mimeTypes)});var core=fileType,fileType$1=getDefaultExportFromCjs(core);function to(d,m){return d.then((function(g){return[null,g]})).catch((function(g){return[g,void 0]}))}const writeFile=async()=>{throw new Error("Not supported")};function Mime$1(){this._types=Object.create(null),this._extensions=Object.create(null);for(let d=0;d<arguments.length;d++)this.define(arguments[d]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}Mime$1.prototype.define=function(d,m){for(let g in d){let w=d[g].map((function($){return $.toLowerCase()}));g=g.toLowerCase();for(let $=0;$<w.length;$++){const I=w[$];if(I[0]!=="*"){if(!m&&I in this._types)throw new Error('Attempt to change mapping for "'+I+'" extension from "'+this._types[I]+'" to "'+g+'". Pass `force=true` to allow this, otherwise remove "'+I+'" from the list of extensions for "'+g+'".');this._types[I]=g}}if(m||!this._extensions[g]){const $=w[0];this._extensions[g]=$[0]!=="*"?$:$.substr(1)}}},Mime$1.prototype.getType=function(d){let m=(d=String(d)).replace(/^.*[/\\]/,"").toLowerCase(),g=m.replace(/^.*\./,"").toLowerCase(),w=m.length<d.length;return(g.length<m.length-1||!w)&&this._types[g]||null},Mime$1.prototype.getExtension=function(d){return(d=/^\s*([^;\s]*)/.test(d)&&RegExp.$1)&&this._extensions[d.toLowerCase()]||null};var Mime_1=Mime$1,standard={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};let Mime=Mime_1;var lite=new Mime(standard),mime=getDefaultExportFromCjs(lite),HorizontalAlign,HorizontalAlign2,VerticalAlign,VerticalAlign2,BlendMode,BlendMode2;function srcOver(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a;return{r:(d.r*d.a+m.r*m.a*(1-d.a))/w,g:(d.g*d.a+m.g*m.a*(1-d.a))/w,b:(d.b*d.a+m.b*m.a*(1-d.a))/w,a:w}}function dstOver(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a;return{r:(m.r*m.a+d.r*d.a*(1-m.a))/w,g:(m.g*m.a+d.g*d.a*(1-m.a))/w,b:(m.b*m.a+d.b*d.a*(1-m.a))/w,a:w}}function multiply(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,q=m.r*m.a,j=m.g*m.a,G=m.b*m.a;return{r:($*q+$*(1-m.a)+q*(1-d.a))/w,g:(I*j+I*(1-m.a)+j*(1-d.a))/w,b:(D*G+D*(1-m.a)+G*(1-d.a))/w,a:w}}function add(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a;return{r:($+m.r*m.a)/w,g:(I+m.g*m.a)/w,b:(D+m.b*m.a)/w,a:w}}function screen(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,q=m.r*m.a,j=m.g*m.a,G=m.b*m.a;return{r:($*m.a+q*d.a-$*q+$*(1-m.a)+q*(1-d.a))/w,g:(I*m.a+j*d.a-I*j+I*(1-m.a)+j*(1-d.a))/w,b:(D*m.a+G*d.a-D*G+D*(1-m.a)+G*(1-d.a))/w,a:w}}function overlay(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,q=m.r*m.a,j=m.g*m.a,G=m.b*m.a;return{r:(2*q<=m.a?2*$*q+$*(1-m.a)+q*(1-d.a):$*(1+m.a)+q*(1+d.a)-2*q*$-m.a*d.a)/w,g:(2*j<=m.a?2*I*j+I*(1-m.a)+j*(1-d.a):I*(1+m.a)+j*(1+d.a)-2*j*I-m.a*d.a)/w,b:(2*G<=m.a?2*D*G+D*(1-m.a)+G*(1-d.a):D*(1+m.a)+G*(1+d.a)-2*G*D-m.a*d.a)/w,a:w}}function darken(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,q=m.r*m.a,j=m.g*m.a,G=m.b*m.a;return{r:(Math.min($*m.a,q*d.a)+$*(1-m.a)+q*(1-d.a))/w,g:(Math.min(I*m.a,j*d.a)+I*(1-m.a)+j*(1-d.a))/w,b:(Math.min(D*m.a,G*d.a)+D*(1-m.a)+G*(1-d.a))/w,a:w}}function lighten(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,q=m.r*m.a,j=m.g*m.a,G=m.b*m.a;return{r:(Math.max($*m.a,q*d.a)+$*(1-m.a)+q*(1-d.a))/w,g:(Math.max(I*m.a,j*d.a)+I*(1-m.a)+j*(1-d.a))/w,b:(Math.max(D*m.a,G*d.a)+D*(1-m.a)+G*(1-d.a))/w,a:w}}function hardLight(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,q=m.r*m.a,j=m.g*m.a,G=m.b*m.a;return{r:(2*$<=d.a?2*$*q+$*(1-m.a)+q*(1-d.a):$*(1+m.a)+q*(1+d.a)-2*q*$-m.a*d.a)/w,g:(2*I<=d.a?2*I*j+I*(1-m.a)+j*(1-d.a):I*(1+m.a)+j*(1+d.a)-2*j*I-m.a*d.a)/w,b:(2*D<=d.a?2*D*G+D*(1-m.a)+G*(1-d.a):D*(1+m.a)+G*(1+d.a)-2*G*D-m.a*d.a)/w,a:w}}function difference(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,q=m.r*m.a,j=m.g*m.a,G=m.b*m.a;return{r:($+q-2*Math.min($*m.a,q*d.a))/w,g:(I+j-2*Math.min(I*m.a,j*d.a))/w,b:(D+G-2*Math.min(D*m.a,G*d.a))/w,a:w}}function exclusion(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,q=m.r*m.a,j=m.g*m.a,G=m.b*m.a;return{r:($*m.a+q*d.a-2*$*q+$*(1-m.a)+q*(1-d.a))/w,g:(I*m.a+j*d.a-2*I*j+I*(1-m.a)+j*(1-d.a))/w,b:(D*m.a+G*d.a-2*D*G+D*(1-m.a)+G*(1-d.a))/w,a:w}}HorizontalAlign2=HorizontalAlign||(HorizontalAlign={}),HorizontalAlign2[HorizontalAlign2.LEFT=1]="LEFT",HorizontalAlign2[HorizontalAlign2.CENTER=2]="CENTER",HorizontalAlign2[HorizontalAlign2.RIGHT=4]="RIGHT",VerticalAlign2=VerticalAlign||(VerticalAlign={}),VerticalAlign2[VerticalAlign2.TOP=8]="TOP",VerticalAlign2[VerticalAlign2.MIDDLE=16]="MIDDLE",VerticalAlign2[VerticalAlign2.BOTTOM=32]="BOTTOM",BlendMode2=BlendMode||(BlendMode={}),BlendMode2.SRC_OVER="srcOver",BlendMode2.DST_OVER="dstOver",BlendMode2.MULTIPLY="multiply",BlendMode2.ADD="add",BlendMode2.SCREEN="screen",BlendMode2.OVERLAY="overlay",BlendMode2.DARKEN="darken",BlendMode2.LIGHTEN="lighten",BlendMode2.HARD_LIGHT="hardLight",BlendMode2.DIFFERENCE="difference",BlendMode2.EXCLUSION="exclusion";const names=[srcOver,dstOver,multiply,add,screen,overlay,darken,lighten,hardLight,difference,exclusion];var compositeModes=Object.freeze({__proto__:null,add,darken,difference,dstOver,exclusion,hardLight,lighten,multiply,names,overlay,screen,srcOver});function composite(d,m,g=0,w=0,$={}){if(!(m instanceof d.constructor))throw new Error("The source must be a Jimp image");if(typeof g!="number"||typeof w!="number")throw new Error("x and y must be numbers");const{mode:I=BlendMode.SRC_OVER}=$;let{opacitySource:D=1,opacityDest:q=1}=$;(typeof D!="number"||D<0||D>1)&&(D=1),(typeof q!="number"||q<0||q>1)&&(q=1);const j=compositeModes[I];return g=Math.round(g),w=Math.round(w),q!==1&&d.scan(((G,H,W)=>{const V=d.bitmap.data[W+3]*q;d.bitmap.data[W+3]=V})),m.scan(((G,H,W)=>{const V=d.getPixelIndex(g+G,w+H,Edge.CROP);if(V===-1)return;const K=j({r:m.bitmap.data[W+0]/255,g:m.bitmap.data[W+1]/255,b:m.bitmap.data[W+2]/255,a:m.bitmap.data[W+3]/255},{r:d.bitmap.data[V+0]/255,g:d.bitmap.data[V+1]/255,b:d.bitmap.data[V+2]/255,a:d.bitmap.data[V+3]/255},D);d.bitmap.data[V+0]=limit255(255*K.r),d.bitmap.data[V+1]=limit255(255*K.g),d.bitmap.data[V+2]=limit255(255*K.b),d.bitmap.data[V+3]=limit255(255*K.a)})),d}var jpeg$1={parseSections:function(d,m){var g,w;for(d.setBigEndian(!0);d.remainingLength()>0&&w!==218;){if(d.nextUInt8()!==255)throw new Error("Invalid JPEG section offset");g=(w=d.nextUInt8())>=208&&w<=217||w===218?0:d.nextUInt16()-2,m(w,d.branch(0,g)),d.skip(g)}},getSizeFromSOFSection:function(d){return d.skip(1),{height:d.nextUInt16(),width:d.nextUInt16()}},getSectionName:function(d){var m,g;switch(d){case 216:m="SOI";break;case 196:m="DHT";break;case 219:m="DQT";break;case 221:m="DRI";break;case 218:m="SOS";break;case 254:m="COM";break;case 217:m="EOI";break;default:d>=224&&d<=239?(m="APP",g=d-224):d>=192&&d<=207&&d!==196&&d!==200&&d!==204?(m="SOF",g=d-192):d>=208&&d<=215&&(m="RST",g=d-208)}var w={name:m};return typeof g=="number"&&(w.index=g),w}};function readExifValue(d,m){switch(d){case 1:return m.nextUInt8();case 3:case 8:return m.nextUInt16();case 4:case 9:return m.nextUInt32();case 5:return[m.nextUInt32(),m.nextUInt32()];case 6:return m.nextInt8();case 10:return[m.nextInt32(),m.nextInt32()];case 11:return m.nextFloat();case 12:return m.nextDouble();default:throw new Error("Invalid format while decoding: "+d)}}function getBytesPerComponent(d){switch(d){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function readExifTag(d,m){var g,w,$=m.nextUInt16(),I=m.nextUInt16(),D=getBytesPerComponent(I),q=m.nextUInt32(),j=D*q;if(j>4&&(m=d.openWithOffset(m.nextUInt32())),I===2){var G=(g=m.nextString(q)).indexOf("\0");G!==-1&&(g=g.substr(0,G))}else if(I===7)g=m.nextBuffer(q);else if(I!==0)for(g=[],w=0;w<q;++w)g.push(readExifValue(I,m));return j<4&&m.skip(4-j),[$,g,I]}function readIFDSection(d,m,g){var w,$,I=m.nextUInt16();for($=0;$<I;++$)g((w=readExifTag(d,m))[0],w[1],w[2])}function readHeader(d){if(d.nextString(6)!=="Exif\0\0")throw new Error("Invalid EXIF header");var m=d.mark(),g=d.nextUInt16();if(g===18761)d.setBigEndian(!1);else{if(g!==19789)throw new Error("Invalid TIFF header");d.setBigEndian(!0)}if(d.nextUInt16()!==42)throw new Error("Invalid TIFF data");return m}var exif$2={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(d,m){var g,w,$,I;try{g=readHeader(d)}catch{return!1}var D=g.openWithOffset(d.nextUInt32()),q=this.IFD0;readIFDSection(g,D,(function(Z,Q,J){switch(Z){case 34853:$=Q[0];break;case 34665:w=Q[0];break;default:m(q,Z,Q,J)}}));var j=D.nextUInt32();if(j!==0){var G=g.openWithOffset(j);readIFDSection(g,G,m.bind(null,this.IFD1))}if($){var H=g.openWithOffset($);readIFDSection(g,H,m.bind(null,this.GPSIFD))}if(w){var W=g.openWithOffset(w),V=this.InteropIFD;readIFDSection(g,W,(function(Z,Q,J){Z===40965?I=Q[0]:m(V,Z,Q,J)}))}if(I){var K=g.openWithOffset(I);readIFDSection(g,K,m.bind(null,this.InteropIFD))}return!0}};function parseNumber(d){return parseInt(d,10)}var hours=3600,minutes=60;function parseDateTimeParts(d,m){d=d.map(parseNumber),m=m.map(parseNumber);var g=d[0],w=d[1]-1,$=d[2],I=m[0],D=m[1],q=m[2];return Date.UTC(g,w,$,I,D,q,0)/1e3}function parseDateWithTimezoneFormat(d){var m=d.substr(0,10).split("-"),g=d.substr(11,8).split(":"),w=d.substr(19,6).split(":").map(parseNumber),$=w[0]*hours+w[1]*minutes,I=parseDateTimeParts(m,g);if(typeof(I-=$)=="number"&&!isNaN(I))return I}function parseDateWithSpecFormat(d){var m=d.split(" "),g=parseDateTimeParts(m[0].split(":"),m[1].split(":"));if(typeof g=="number"&&!isNaN(g))return g}function parseExifDate(d){var m=d.length===19&&d.charAt(4)===":";return d.length===25&&d.charAt(10)==="T"?parseDateWithTimezoneFormat(d):m?parseDateWithSpecFormat(d):void 0}var date$1={parseDateWithSpecFormat,parseDateWithTimezoneFormat,parseExifDate},exif$1=exif$2,date=date$1,degreeTags=[{section:exif$1.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:exif$1.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],dateTags=[{section:exif$1.SubIFD,type:306,name:"ModifyDate"},{section:exif$1.SubIFD,type:36867,name:"DateTimeOriginal"},{section:exif$1.SubIFD,type:36868,name:"CreateDate"},{section:exif$1.SubIFD,type:306,name:"ModifyDate"}],simplify$1={castDegreeValues:function(d,m){degreeTags.forEach((function(g){var w=d(g);if(w){var $=d({section:g.section,type:g.refType,name:g.refName})===g.posVal?1:-1,I=(w[0]+w[1]/60+w[2]/3600)*$;m(g,I)}}))},castDateValues:function(d,m){dateTags.forEach((function(g){var w=d(g);if(w){var $=date.parseExifDate(w);$!==void 0&&m(g,$)}}))},simplifyValue:function(d,m){return Array.isArray(d)&&(d=d.map((function(g){return m===10||m===5?g[0]/g[1]:g}))).length===1&&(d=d[0]),d}},exifTags,hasRequiredExifTags;function requireExifTags(){return hasRequiredExifTags?exifTags:(hasRequiredExifTags=1,exifTags={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}})}var jpeg=jpeg$1,exif=exif$2,simplify=simplify$1;function ExifResult(d,m,g,w,$,I,D){this.startMarker=d,this.tags=m,this.imageSize=g,this.thumbnailOffset=w,this.thumbnailLength=$,this.thumbnailType=I,this.app1Offset=D}function Parser$1(d){this.stream=d,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}ExifResult.prototype={hasThumbnail:function(d){return!(!this.thumbnailOffset||!this.thumbnailLength)&&(typeof d!="string"||(d.toLowerCase().trim()==="image/jpeg"?this.thumbnailType===6:d.toLowerCase().trim()==="image/tiff"&&this.thumbnailType===1))},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var d,m=this._getThumbnailStream();return jpeg.parseSections(m,(function(g,w){jpeg.getSectionName(g).name==="SOF"&&(d=jpeg.getSizeFromSOFSection(w))})),d}},Parser$1.prototype={enableBinaryFields:function(d){return this.flags.readBinaryTags=!!d,this},enablePointers:function(d){return this.flags.hidePointers=!d,this},enableTagNames:function(d){return this.flags.resolveTagNames=!!d,this},enableImageSize:function(d){return this.flags.imageSize=!!d,this},enableReturnTags:function(d){return this.flags.returnTags=!!d,this},enableSimpleValues:function(d){return this.flags.simplifyValues=!!d,this},parse:function(){var d,m,g,w,$,I,D,q,j,G=this.stream.mark(),H=G.openWithOffset(0),W=this.flags;return W.resolveTagNames&&(D=requireExifTags()),W.resolveTagNames?(d={},q=function(V){return d[V.name]},j=function(V,K){d[V.name]=K}):(d=[],q=function(V){var K;for(K=0;K<d.length;++K)if(d[K].type===V.type&&d[K].section===V.section)return d.value},j=function(V,K){var Z;for(Z=0;Z<d.length;++Z)if(d[Z].type===V.type&&d[Z].section===V.section)return void(d.value=K)}),jpeg.parseSections(H,(function(V,K){var Z=K.offsetFrom(G);V===225?exif.parseTags(K,(function(Q,J,re,se){if(W.readBinaryTags||se!==7){if(J===513){if(g=re[0],W.hidePointers)return}else if(J===514){if(w=re[0],W.hidePointers)return}else if(J===259&&($=re[0],W.hidePointers))return;if(W.returnTags)if(W.simplifyValues&&(re=simplify.simplifyValue(re,se)),W.resolveTagNames){var oe=(Q===exif.GPSIFD?D.gps:D.exif)[J];oe||(oe=D.exif[J]),d.hasOwnProperty(oe)||(d[oe]=re)}else d.push({section:Q,type:J,value:re})}}))&&(I=Z):W.imageSize&&jpeg.getSectionName(V).name==="SOF"&&(m=jpeg.getSizeFromSOFSection(K))})),W.simplifyValues&&(simplify.castDegreeValues(q,j),simplify.castDateValues(q,j)),new ExifResult(G,d,m,g,w,$,I)}};var parser=Parser$1,domBufferstream,hasRequiredDomBufferstream,bufferstream,hasRequiredBufferstream;function requireDomBufferstream(){if(hasRequiredDomBufferstream)return domBufferstream;function d(m,g,w,$,I,D){this.global=I,g=g||0,w=w||m.byteLength-g,this.arrayBuffer=m.slice(g,g+w),this.view=new I.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian($),this.offset=0,this.parentOffset=(D||0)+g}return hasRequiredDomBufferstream=1,d.prototype={setBigEndian:function(m){this.littleEndian=!m},nextUInt8:function(){var m=this.view.getUint8(this.offset);return this.offset+=1,m},nextInt8:function(){var m=this.view.getInt8(this.offset);return this.offset+=1,m},nextUInt16:function(){var m=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,m},nextUInt32:function(){var m=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,m},nextInt16:function(){var m=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,m},nextInt32:function(){var m=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,m},nextFloat:function(){var m=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,m},nextDouble:function(){var m=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,m},nextBuffer:function(m){var g=this.arrayBuffer.slice(this.offset,this.offset+m);return this.offset+=m,g},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(m){var g=this.arrayBuffer.slice(this.offset,this.offset+m);return g=String.fromCharCode.apply(null,new this.global.Uint8Array(g)),this.offset+=m,g},mark:function(){var m=this;return{openWithOffset:function(g){return g=(g||0)+this.offset,new d(m.arrayBuffer,g,m.arrayBuffer.byteLength-g,!m.littleEndian,m.global,m.parentOffset)},offset:this.offset,getParentOffset:function(){return m.parentOffset}}},offsetFrom:function(m){return this.parentOffset+this.offset-(m.offset+m.getParentOffset())},skip:function(m){this.offset+=m},branch:function(m,g){return g=typeof g=="number"?g:this.arrayBuffer.byteLength-(this.offset+m),new d(this.arrayBuffer,this.offset+m,g,!this.littleEndian,this.global,this.parentOffset)}},domBufferstream=d}function requireBufferstream(){if(hasRequiredBufferstream)return bufferstream;function d(m,g,w,$){this.buffer=m,this.offset=g||0,w=typeof w=="number"?w:m.length,this.endPosition=this.offset+w,this.setBigEndian($)}return hasRequiredBufferstream=1,d.prototype={setBigEndian:function(m){this.bigEndian=!!m},nextUInt8:function(){var m=this.buffer.readUInt8(this.offset);return this.offset+=1,m},nextInt8:function(){var m=this.buffer.readInt8(this.offset);return this.offset+=1,m},nextUInt16:function(){var m=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,m},nextUInt32:function(){var m=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,m},nextInt16:function(){var m=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,m},nextInt32:function(){var m=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,m},nextFloat:function(){var m=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,m},nextDouble:function(){var m=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,m},nextBuffer:function(m){var g=this.buffer.slice(this.offset,this.offset+m);return this.offset+=m,g},remainingLength:function(){return this.endPosition-this.offset},nextString:function(m){var g=this.buffer.toString("utf8",this.offset,this.offset+m);return this.offset+=m,g},mark:function(){var m=this;return{openWithOffset:function(g){return g=(g||0)+this.offset,new d(m.buffer,g,m.endPosition-g,m.bigEndian)},offset:this.offset}},offsetFrom:function(m){return this.offset-m.offset},skip:function(m){this.offset+=m},branch:function(m,g){return g=typeof g=="number"?g:this.endPosition-(this.offset+m),new d(this.buffer,this.offset+m,g,this.bigEndian)}},bufferstream=d}var Parser=parser;function getGlobal(){return(0,eval)("this")}var exifParser={create:function(d,m){if(d instanceof(m=m||getGlobal()).ArrayBuffer){var g=requireDomBufferstream();return new Parser(new g(d,0,d.byteLength,!0,m))}var w=requireBufferstream();return new Parser(new w(d,0,d.length,!0))}},EXIFParser=getDefaultExportFromCjs(exifParser);function getExifOrientation(d){const m=d._exif;return m&&m.tags&&m.tags.Orientation||1}function getExifOrientationTransformation(d){const m=d.bitmap.width,g=d.bitmap.height;switch(getExifOrientation(d)){case 1:default:return null;case 2:return function(w,$){return[m-w-1,$]};case 3:return function(w,$){return[m-w-1,g-$-1]};case 4:return function(w,$){return[w,g-$-1]};case 5:return function(w,$){return[$,w]};case 6:return function(w,$){return[$,g-w-1]};case 7:return function(w,$){return[m-$-1,g-w-1]};case 8:return function(w,$){return[m-$-1,w]}}}function transformBitmap(d,m,g,w){const $=d.bitmap.data,I=d.bitmap.width,D=Buffer.alloc($.length);for(let q=0;q<m;q++)for(let j=0;j<g;j++){const[G,H]=w(q,j),W=m*j+q<<2,V=I*H+G<<2,K=$.readUInt32BE(V);D.writeUInt32BE(K,W)}d.bitmap.data=D,d.bitmap.width=m,d.bitmap.height=g,d._exif.tags.Orientation=1}function exifRotate(d){if(getExifOrientation(d)<2)return;const m=getExifOrientationTransformation(d),g=getExifOrientation(d)>4,w=g?d.bitmap.height:d.bitmap.width,$=g?d.bitmap.width:d.bitmap.height;m&&transformBitmap(d,w,$,m)}async function attemptExifRotate(d,m){try{d._exif=EXIFParser.create(m).parse(),exifRotate(d)}catch{}}var __defProp$2=Object.defineProperty,__defNormalProp$2=(d,m,g)=>m in d?__defProp$2(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__publicField$2=(d,m,g)=>__defNormalProp$2(d,typeof m!="symbol"?m+"":m,g);const emptyBitmap={data:Buffer.alloc(0),width:0,height:0};function bufferFromArrayBuffer(d){const m=Buffer.alloc(d.byteLength),g=new Uint8Array(d);for(let w=0;w<m.length;++w)m[w]=g[w];return m}function createJimp({plugins:d,formats:m}={}){const g=d||[],w=(m||[]).map((I=>I())),$=class{constructor(I=emptyBitmap){if(__publicField$2(this,"bitmap",emptyBitmap),__publicField$2(this,"background",0),__publicField$2(this,"formats",[]),__publicField$2(this,"mime"),this.formats=w,"data"in I)this.bitmap=I;else if(this.bitmap={data:Buffer.alloc(I.width*I.height*4),width:I.width,height:I.height},I.color){this.background=typeof I.color=="string"?cssColorToHex(I.color):I.color;for(let D=0;D<this.bitmap.data.length;D+=4)this.bitmap.data.writeUInt32BE(this.background,D)}for(const D of g)for(const q in D)this[q]=(...j)=>{const G=D[q]?.(this,...j);return typeof G=="object"&&"bitmap"in G?(this.bitmap=G.bitmap,this):G}}static async read(I,D){if(Buffer.isBuffer(I)||I instanceof ArrayBuffer)return this.fromBuffer(I);const[q,j]=await to(fetch(I));if(q)throw new Error(`Could not load Buffer from URL: ${I}`);if(!j.ok)throw new Error(`HTTP Status ${j.status} for url ${I}`);const[G,H]=await to(j.arrayBuffer());if(G)throw new Error(`Could not load Buffer from ${I}`);const W=bufferFromArrayBuffer(H);return this.fromBuffer(W,D)}static fromBitmap(I){let D;if(I.data instanceof Buffer&&(D=Buffer.from(I.data)),(I.data instanceof Uint8Array||I.data instanceof Uint8ClampedArray)&&(D=Buffer.from(I.data.buffer)),Array.isArray(I.data)&&(D=Buffer.concat(I.data.map((q=>Buffer.from(q.toString(16).padStart(8,"0"),"hex"))))),!D)throw new Error("data must be a Buffer");if(typeof I.height!="number"||typeof I.width!="number")throw new Error("bitmap must have width and height");return new $({height:I.height,width:I.width,data:D})}static async fromBuffer(I,D){const q=I instanceof ArrayBuffer?bufferFromArrayBuffer(I):I,j=await fileType$1.fromBuffer(q);if(!j||!j.mime)throw new Error("Could not find MIME for Buffer");const G=w.find((W=>W.mime===j.mime));if(!G||!G.decode)throw new Error(`Mime type ${j.mime} does not support decoding`);const H=new $(await G.decode(q,D?.[G.mime]));return H.mime=j.mime,attemptExifRotate(H,q),H}inspect(){return"<Jimp "+(this.bitmap===emptyBitmap?"pending...":this.bitmap.width+"x"+this.bitmap.height)+">"}toString(){return"[object Jimp]"}get width(){return this.bitmap.width}get height(){return this.bitmap.height}async getBuffer(I,D){const q=this.formats.find((G=>G.mime===I));if(!q||!q.encode)throw new Error(`Unsupported MIME type: ${I}`);let j;return q.hasAlpha?j=this:(j=new $({width:this.bitmap.width,height:this.bitmap.height,color:this.background}),composite(j,this)),q.encode(j.bitmap,D)}async getBase64(I,D){return"data:"+I+";base64,"+(await this.getBuffer(I,D)).toString("base64")}async write(I,D){const q=mime.getType(I);await writeFile(I,await this.getBuffer(q,D))}clone(){return new $({...this.bitmap,data:Buffer.from(this.bitmap.data)})}getPixelIndex(I,D,q){let j,G;if(q||(q=Edge.EXTEND),typeof I!="number"||typeof D!="number")throw new Error("x and y must be numbers");j=I=Math.round(I),G=D=Math.round(D),q===Edge.EXTEND&&(I<0&&(j=0),I>=this.bitmap.width&&(j=this.bitmap.width-1),D<0&&(G=0),D>=this.bitmap.height&&(G=this.bitmap.height-1)),q===Edge.WRAP&&(I<0&&(j=this.bitmap.width+I),I>=this.bitmap.width&&(j=I%this.bitmap.width),D<0&&(G=this.bitmap.height+D),D>=this.bitmap.height&&(G=D%this.bitmap.height));let H=this.bitmap.width*G+j<<2;return(j<0||j>=this.bitmap.width)&&(H=-1),(G<0||G>=this.bitmap.height)&&(H=-1),H}getPixelColor(I,D){if(typeof I!="number"||typeof D!="number")throw new Error("x and y must be numbers");const q=this.getPixelIndex(I,D);return this.bitmap.data.readUInt32BE(q)}setPixelColor(I,D,q){if(typeof I!="number"||typeof D!="number"||typeof q!="number")throw new Error("hex, x and y must be numbers");const j=this.getPixelIndex(D,q);return this.bitmap.data.writeUInt32BE(I,j),this}hasAlpha(){const{width:I,height:D,data:q}=this.bitmap,j=I*D<<2;for(let G=3;G<j;G+=4)if(q[G]!==255)return!0;return!1}composite(I,D=0,q=0,j={}){return composite(this,I,D,q,j)}scan(I,D,q,j,G){return scan(this,I,D,q,j,G)}scanIterator(I=0,D=0,q=this.bitmap.width,j=this.bitmap.height){if(typeof I!="number"||typeof D!="number")throw new Error("x and y must be numbers");if(typeof q!="number"||typeof j!="number")throw new Error("w and h must be numbers");return scanIterator(this,I,D,q,j)}};return $}var ResizeStrategy,ResizeStrategy2;function Resize(d,m,g,w,$,I,D){this.widthOriginal=Math.abs(Math.floor(d)||0),this.heightOriginal=Math.abs(Math.floor(m)||0),this.targetWidth=Math.abs(Math.floor(g)||0),this.targetHeight=Math.abs(Math.floor(w)||0),this.colorChannels=$?4:3,this.interpolationPass=!!I,this.resizeCallback=typeof D=="function"?D:function(){},this.targetWidthMultipliedByChannels=this.targetWidth*this.colorChannels,this.originalWidthMultipliedByChannels=this.widthOriginal*this.colorChannels,this.originalHeightMultipliedByChannels=this.heightOriginal*this.colorChannels,this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal,this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight,this.initialize()}ResizeStrategy2=ResizeStrategy||(ResizeStrategy={}),ResizeStrategy2.NEAREST_NEIGHBOR="nearestNeighbor",ResizeStrategy2.BILINEAR="bilinearInterpolation",ResizeStrategy2.BICUBIC="bicubicInterpolation",ResizeStrategy2.HERMITE="hermiteInterpolation",ResizeStrategy2.BEZIER="bezierInterpolation",Resize.prototype.initialize=function(){if(!(this.widthOriginal>0&&this.heightOriginal>0&&this.targetWidth>0&&this.targetHeight>0))throw console.log(this),new Error("Invalid settings specified for the resizer.");this.configurePasses()},Resize.prototype.configurePasses=function(){this.widthOriginal===this.targetWidth?this.resizeWidth=this.bypassResizer:(this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth,this.ratioWeightWidthPass<1&&this.interpolationPass?(this.initializeFirstPassBuffers(!0),this.resizeWidth=this.colorChannels===4?this.resizeWidthInterpolatedRGBA:this.resizeWidthInterpolatedRGB):(this.initializeFirstPassBuffers(!1),this.resizeWidth=this.colorChannels===4?this.resizeWidthRGBA:this.resizeWidthRGB)),this.heightOriginal===this.targetHeight?this.resizeHeight=this.bypassResizer:(this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight,this.ratioWeightHeightPass<1&&this.interpolationPass?(this.initializeSecondPassBuffers(!0),this.resizeHeight=this.resizeHeightInterpolated):(this.initializeSecondPassBuffers(!1),this.resizeHeight=this.colorChannels===4?this.resizeHeightRGBA:this.resizeHeightRGB))},Resize.prototype._resizeWidthInterpolatedRGBChannels=function(d,m){const g=m?4:3,w=this.ratioWeightWidthPass,$=this.widthBuffer;let I,D,q=0,j=0,G=0,H=0,W=0;for(I=0;q<1/3;I+=g,q+=w)for(j=I,G=0;j<this.widthPassResultSize;G+=this.originalWidthMultipliedByChannels,j+=this.targetWidthMultipliedByChannels)$[j]=d[G],$[j+1]=d[G+1],$[j+2]=d[G+2],m&&($[j+3]=d[G+3]);for(q-=1/3,D=this.widthOriginal-1;q<D;I+=g,q+=w)for(W=q%1,H=1-W,j=I,G=Math.floor(q)*g;j<this.widthPassResultSize;G+=this.originalWidthMultipliedByChannels,j+=this.targetWidthMultipliedByChannels)$[j+0]=d[G+0]*H+d[G+g+0]*W,$[j+1]=d[G+1]*H+d[G+g+1]*W,$[j+2]=d[G+2]*H+d[G+g+2]*W,m&&($[j+3]=d[G+3]*H+d[G+g+3]*W);for(D=this.originalWidthMultipliedByChannels-g;I<this.targetWidthMultipliedByChannels;I+=g)for(j=I,G=D;j<this.widthPassResultSize;G+=this.originalWidthMultipliedByChannels,j+=this.targetWidthMultipliedByChannels)$[j]=d[G],$[j+1]=d[G+1],$[j+2]=d[G+2],m&&($[j+3]=d[G+3]);return $},Resize.prototype._resizeWidthRGBChannels=function(d,m){const g=m?4:3,w=this.ratioWeightWidthPass,$=1/w,I=this.originalWidthMultipliedByChannels-g+1,D=this.targetWidthMultipliedByChannels-g+1,q=this.outputWidthWorkBench,j=this.widthBuffer,G=this.outputWidthWorkBenchOpaquePixelsCount;let H=0,W=0,V=0,K=0,Z=0,Q=0,J=0,re=1,se=0,oe=0,ee=0,ae=0;do{for(Z=0;Z<this.originalHeightMultipliedByChannels;)q[Z++]=0,q[Z++]=0,q[Z++]=0,m&&(q[Z++]=0,G[Z/g-1]=0);H=w;do{for(W=1+V-K,re=Math.min(H,W),Z=0,Q=V;Z<this.originalHeightMultipliedByChannels;Q+=I)se=d[Q],oe=d[++Q],ee=d[++Q],ae=m?d[++Q]:255,q[Z++]+=(ae?se:0)*re,q[Z++]+=(ae?oe:0)*re,q[Z++]+=(ae?ee:0)*re,m&&(q[Z++]+=ae*re,G[Z/g-1]+=ae?re:0);if(!(H>=W)){K+=H;break}V+=g,K=V,H-=W}while(H>0&&V<this.originalWidthMultipliedByChannels);for(Z=0,Q=J;Z<this.originalHeightMultipliedByChannels;Q+=D)H=m?G[Z/g]:1,re=m?H?1/H:0:$,j[Q]=q[Z++]*re,j[++Q]=q[Z++]*re,j[++Q]=q[Z++]*re,m&&(j[++Q]=q[Z++]*$);J+=g}while(J<this.targetWidthMultipliedByChannels);return j},Resize.prototype._resizeHeightRGBChannels=function(d,m){const g=this.ratioWeightHeightPass,w=1/g,$=this.outputHeightWorkBench,I=this.heightBuffer,D=this.outputHeightWorkBenchOpaquePixelsCount;let q=0,j=0,G=0,H=0,W=0,V=0,K=0,Z=1,Q=0,J=0,re=0,se=0;do{for(W=0;W<this.targetWidthMultipliedByChannels;)$[W++]=0,$[W++]=0,$[W++]=0,m&&($[W++]=0,D[W/4-1]=0);q=g;do{for(j=1+G-H,Z=Math.min(q,j),K=G,W=0;W<this.targetWidthMultipliedByChannels;)Q=d[K++],J=d[K++],re=d[K++],se=m?d[K++]:255,$[W++]+=(se?Q:0)*Z,$[W++]+=(se?J:0)*Z,$[W++]+=(se?re:0)*Z,m&&($[W++]+=se*Z,D[W/4-1]+=se?Z:0);if(!(q>=j)){H+=q;break}G=K,H=G,q-=j}while(q>0&&G<this.widthPassResultSize);for(W=0;W<this.targetWidthMultipliedByChannels;)q=m?D[W/4]:1,Z=m?q?1/q:0:w,I[V++]=Math.round($[W++]*Z),I[V++]=Math.round($[W++]*Z),I[V++]=Math.round($[W++]*Z),m&&(I[V++]=Math.round($[W++]*w))}while(V<this.finalResultSize);return I},Resize.prototype.resizeWidthInterpolatedRGB=function(d){return this._resizeWidthInterpolatedRGBChannels(d,!1)},Resize.prototype.resizeWidthInterpolatedRGBA=function(d){return this._resizeWidthInterpolatedRGBChannels(d,!0)},Resize.prototype.resizeWidthRGB=function(d){return this._resizeWidthRGBChannels(d,!1)},Resize.prototype.resizeWidthRGBA=function(d){return this._resizeWidthRGBChannels(d,!0)},Resize.prototype.resizeHeightInterpolated=function(d){const m=this.ratioWeightHeightPass,g=this.heightBuffer;let w,$=0,I=0,D=0,q=0,j=0,G=0,H=0;for(;$<1/3;$+=m)for(D=0;D<this.targetWidthMultipliedByChannels;)g[I++]=Math.round(d[D++]);for($-=1/3,w=this.heightOriginal-1;$<w;$+=m)for(H=$%1,G=1-H,q=Math.floor($)*this.targetWidthMultipliedByChannels,j=q+this.targetWidthMultipliedByChannels,D=0;D<this.targetWidthMultipliedByChannels;++D)g[I++]=Math.round(d[q++]*G+d[j++]*H);for(;I<this.finalResultSize;)for(D=0,q=w*this.targetWidthMultipliedByChannels;D<this.targetWidthMultipliedByChannels;++D)g[I++]=Math.round(d[q++]);return g},Resize.prototype.resizeHeightRGB=function(d){return this._resizeHeightRGBChannels(d,!1)},Resize.prototype.resizeHeightRGBA=function(d){return this._resizeHeightRGBChannels(d,!0)},Resize.prototype.resize=function(d){this.resizeCallback(this.resizeHeight(this.resizeWidth(d)))},Resize.prototype.bypassResizer=function(d){return d},Resize.prototype.initializeFirstPassBuffers=function(d){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize),d||(this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels),this.colorChannels>3&&(this.outputWidthWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.heightOriginal)))},Resize.prototype.initializeSecondPassBuffers=function(d){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize),d||(this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels),this.colorChannels>3&&(this.outputHeightWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.targetWidth)))},Resize.prototype.generateFloatBuffer=function(d){try{return new Float32Array(d)}catch(m){return console.error(m),[]}},Resize.prototype.generateFloat64Buffer=function(d){try{return new Float64Array(d)}catch(m){return console.error(m),[]}},Resize.prototype.generateUint8Buffer=function(d){try{return new Uint8Array(d)}catch(m){return console.error(m),[]}};const operations={nearestNeighbor(d,m){const g=d.width,w=d.height,$=m.width,I=m.height,D=d.data,q=m.data;for(let j=0;j<I;j++)for(let G=0;G<$;G++){let H=4*(j*$+G),W=4*(Math.floor(j*w/I)*g+Math.floor(G*g/$));q[H++]=D[W++],q[H++]=D[W++],q[H++]=D[W++],q[H++]=D[W++]}},bilinearInterpolation(d,m){const g=d.width,w=d.height,$=m.width,I=m.height,D=d.data,q=m.data,j=function(H,W,V,K,Z){return W===K?V:Math.round((H-W)*Z+(K-H)*V)},G=function(H,W,V,K,Z,Q,J,re){let se=4*(J*g+K)+W,oe=4*(J*g+Z)+W;const ee=j(V,K,D[se],Z,D[oe]);if(re===J)q[H+W]=ee;else{se=4*(re*g+K)+W,oe=4*(re*g+Z)+W;const ae=j(V,K,D[se],Z,D[oe]);q[H+W]=j(Q,J,ee,re,ae)}};for(let H=0;H<I;H++)for(let W=0;W<$;W++){const V=4*(H*$+W),K=W*g/$,Z=Math.floor(K),Q=Math.min(Math.ceil(K),g-1),J=H*w/I,re=Math.floor(J),se=Math.min(Math.ceil(J),w-1);G(V,0,K,Z,Q,J,re,se),G(V,1,K,Z,Q,J,re,se),G(V,2,K,Z,Q,J,re,se),G(V,3,K,Z,Q,J,re,se)}},_interpolate2D(d,m,g,w){const $=d.data,I=m.data,D=d.width,q=d.height,j=m.width,G=m.height,H=Math.max(1,Math.floor(D/j)),W=j*H,V=Math.max(1,Math.floor(q/G)),K=G*V,Z=Buffer.alloc(W*q*4);for(let re=0;re<q;re++)for(let se=0;se<W;se++){const oe=se*(D-1)/W,ee=Math.floor(oe),ae=oe-ee,ce=4*(re*D+ee),le=4*(re*W+se);for(let de=0;de<4;de++){const _e=ce+de,we=ee>0?$[_e-4]:2*$[_e]-$[_e+4],pe=$[_e],xe=$[_e+4],Ge=ee<D-2?$[_e+8]:2*$[_e+4]-$[_e];Z[le+de]=w(we,pe,xe,Ge,ae)}}const Q=Buffer.alloc(W*K*4);for(let re=0;re<K;re++)for(let se=0;se<W;se++){const oe=re*(q-1)/K,ee=Math.floor(oe),ae=oe-ee,ce=4*(ee*W+se),le=4*(re*W+se);for(let de=0;de<4;de++){const _e=ce+de,we=ee>0?Z[_e-4*W]:2*Z[_e]-Z[_e+4*W],pe=Z[_e],xe=Z[_e+4*W],Ge=ee<q-2?Z[_e+8*W]:2*Z[_e+4*W]-Z[_e];Q[le+de]=w(we,pe,xe,Ge,ae)}}const J=H*V;if(J>1)for(let re=0;re<G;re++)for(let se=0;se<j;se++){let oe=0,ee=0,ae=0,ce=0,le=0;for(let _e=0;_e<V;_e++){const we=re*V+_e;for(let pe=0;pe<H;pe++){const xe=4*(we*W+(se*H+pe)),Ge=Q[xe+3];Ge&&(oe+=Q[xe],ee+=Q[xe+1],ae+=Q[xe+2],le++),ce+=Ge}}const de=4*(re*j+se);I[de]=le?Math.round(oe/le):0,I[de+1]=le?Math.round(ee/le):0,I[de+2]=le?Math.round(ae/le):0,I[de+3]=Math.round(ce/J)}else m.data=Q},bicubicInterpolation(d,m,g){return this._interpolate2D(d,m,g,(function(w,$,I,D,q){const j=D-I-w+$,G=w-$-j,H=I-w,W=$;return Math.max(0,Math.min(255,j*(q*q*q)+G*(q*q)+H*q+W))}))},hermiteInterpolation(d,m,g){return this._interpolate2D(d,m,g,(function(w,$,I,D,q){const j=$,G=.5*(I-w),H=w-2.5*$+2*I-.5*D,W=.5*(D-w)+1.5*($-I);return Math.max(0,Math.min(255,Math.round(((W*q+H)*q+G)*q+j)))}))},bezierInterpolation(d,m,g){return this._interpolate2D(d,m,g,(function(w,$,I,D,q){const j=1-q,G=$*j*j*j,H=3*($+(I-w)/4)*j*j*q,W=3*(I-(D-$)/4)*j*q*q,V=I*q*q*q;return Math.max(0,Math.min(255,Math.round(G+H+W+V)))}))}},ResizeOptionsSchema=z.union([z.object({w:z.number().min(0),h:z.number().min(0).optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),z.object({w:z.number().min(0).optional(),h:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()})]),ScaleToFitOptionsSchema=z.object({w:z.number().min(0),h:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()}),ScaleComplexOptionsSchema=z.object({f:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$d={resize(d,m){const{mode:g}=ResizeOptionsSchema.parse(m);let w,$;if(typeof m.w=="number")w=m.w,$=m.h??d.bitmap.height*(w/d.bitmap.width);else{if(typeof m.h!="number")throw new Error("w must be a number");$=m.h,w=m.w??d.bitmap.width*($/d.bitmap.height)}if(w=Math.round(w)||1,$=Math.round($)||1,g&&typeof operations[g]=="function"){const I={data:Buffer.alloc(w*$*4),width:w,height:$};operations[g](d.bitmap,I),d.bitmap=I}else new Resize(d.bitmap.width,d.bitmap.height,w,$,!0,!0,(I=>{d.bitmap.data=Buffer.from(I),d.bitmap.width=w,d.bitmap.height=$})).resize(d.bitmap.data);return d},scale(d,m){const{f:g,mode:w}=typeof m=="number"?{f:m}:ScaleComplexOptionsSchema.parse(m),$=d.bitmap.width*g,I=d.bitmap.height*g;return this.resize(d,{w:$,h:I,mode:w})},scaleToFit(d,m){const{h:g,w,mode:$}=ScaleToFitOptionsSchema.parse(m),I=w/g>d.bitmap.width/d.bitmap.height?g/d.bitmap.height:w/d.bitmap.width;return this.scale(d,{f:I,mode:$})}},ContainOptionsSchema=z.object({w:z.number(),h:z.number(),align:z.number().optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$c={contain(d,m){const{w:g,h:w,align:$=HorizontalAlign.CENTER|VerticalAlign.MIDDLE,mode:I}=ContainOptionsSchema.parse(m),D=7&$,q=$>>3;if((D===0||D&D-1)&&(q===0||q&q-1))throw new Error("only use one flag per alignment direction");const j=D>>1,G=q>>1,H=g/w>d.bitmap.width/d.bitmap.height?w/d.bitmap.height:g/d.bitmap.width,W=methods$d.scale(clone(d),{f:H,mode:I});return(d=methods$d.resize(d,{w:g,h:w,mode:I})).scan(((V,K,Z)=>{d.bitmap.data.writeUInt32BE(d.background,Z)})),d=methods$h.blit(d,{src:W,x:(d.bitmap.width-W.bitmap.width)/2*j,y:(d.bitmap.height-W.bitmap.height)/2*G})}},CropOptionsSchema=z.object({x:z.number(),y:z.number(),w:z.number(),h:z.number()}),AutocropComplexOptionsSchema=z.object({tolerance:z.number().min(0).max(1).optional(),cropOnlyFrames:z.boolean().optional(),cropSymmetric:z.boolean().optional(),leaveBorder:z.number().optional(),ignoreSides:z.object({north:z.boolean().optional(),south:z.boolean().optional(),east:z.boolean().optional(),west:z.boolean().optional()}).optional()}),methods$b={crop(d,m){let{x:g,y:w,w:$,h:I}=CropOptionsSchema.parse(m);if(g=Math.round(g),w=Math.round(w),$=Math.round($),I=Math.round(I),g===0&&$===d.bitmap.width){const D=$*w+g<<2,q=D+(I*$<<2);d.bitmap.data=d.bitmap.data.slice(D,q)}else{const D=Buffer.allocUnsafe($*I*4);let q=0;scan(d,g,w,$,I,(function(j,G,H){const W=d.bitmap.data.readUInt32BE(H);D.writeUInt32BE(W,q),q+=4})),d.bitmap.data=D}return d.bitmap.width=$,d.bitmap.height=I,d},autocrop(d,m={}){const{tolerance:g=2e-4,cropOnlyFrames:w=!0,cropSymmetric:$=!1,leaveBorder:I=0,ignoreSides:D}=typeof m=="number"?{tolerance:m}:AutocropComplexOptionsSchema.parse(m),q=d.bitmap.width,j=d.bitmap.height,G={north:!1,south:!1,east:!1,west:!1,...D};let H=d.getPixelColor(0,0);const W=intToRGBA$1(H);let V=0,K=0,Z=0,Q=0;if(H=d.getPixelColor(0,0),!G.north)e:for(let oe=0;oe<j-1;oe++){for(let ee=0;ee<q;ee++)if(colorDiff(W,intToRGBA$1(d.getPixelColor(ee,oe)))>g)break e;V++}if(H=d.getPixelColor(q,0),!G.west)e:for(let oe=0;oe<q-1;oe++){for(let ee=0+V;ee<j;ee++)if(colorDiff(W,intToRGBA$1(d.getPixelColor(oe,ee)))>g)break e;Q++}if(H=d.getPixelColor(0,j),!G.south)e:for(let oe=j-1;oe>=V+1;oe--){for(let ee=q-K-1;ee>=0;ee--)if(colorDiff(W,intToRGBA$1(d.getPixelColor(ee,oe)))>g)break e;Z++}if(H=d.getPixelColor(q,j),!G.east)e:for(let oe=q-1;oe>=0+Q+1;oe--){for(let ee=j-1;ee>=0+V;ee--)if(colorDiff(W,intToRGBA$1(d.getPixelColor(oe,ee)))>g)break e;K++}let J=!1;if(Q-=I,K-=I,V-=I,Z-=I,$){const oe=Math.min(K,Q),ee=Math.min(V,Z);Q=oe,K=oe,V=ee,Z=ee}Q=Q>=0?Q:0,K=K>=0?K:0,V=V>=0?V:0,Z=Z>=0?Z:0;const re=q-(Q+K),se=j-(Z+V);return J=w?K!==0&&V!==0&&Q!==0&&Z!==0:K!==0||V!==0||Q!==0||Z!==0,J&&this.crop(d,{x:Q,y:V,w:re,h:se}),d}},CoverOptionsSchema=z.object({w:z.number(),h:z.number(),align:z.number().optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$a={cover(d,m){const{w:g,h:w,align:$=HorizontalAlign.CENTER|VerticalAlign.MIDDLE,mode:I}=CoverOptionsSchema.parse(m),D=7&$,q=$>>3;if((D===0||D&D-1)&&(q===0||q&q-1))throw new Error("only use one flag per alignment direction");const j=D>>1,G=q>>1,H=g/w>d.bitmap.width/d.bitmap.height?g/d.bitmap.width:w/d.bitmap.height;return d=methods$d.scale(d,{f:H,mode:I}),d=methods$b.crop(d,{x:(d.bitmap.width-g)/2*j,y:(d.bitmap.height-w)/2*G,w:g,h:w})}},DisplaceOptionsSchema=z.object({map:JimpClassSchema,offset:z.number()}),methods$9={displace(d,m){const{map:g,offset:w}=DisplaceOptionsSchema.parse(m),$=clone(d);return d.scan(((I,D,q)=>{let j=g.bitmap.data[q]/256*w;j=Math.round(j);const G=d.getPixelIndex(I+j,D);d.bitmap.data[G]=$.bitmap.data[q],d.bitmap.data[G+1]=$.bitmap.data[q+1],d.bitmap.data[G+2]=$.bitmap.data[q+2]})),d}},methods$8={dither(d){const m=[1,9,3,11,13,5,15,7,4,12,2,10,16,8,14,6];return d.scan(((g,w,$)=>{const I=m[((3&w)<<2)+g%4];d.bitmap.data[$]=Math.min(d.bitmap.data[$]+I,255),d.bitmap.data[$+1]=Math.min(d.bitmap.data[$+1]+I,255),d.bitmap.data[$+2]=Math.min(d.bitmap.data[$+2]+I,255)})),d}},FisheyeOptionsSchema=z.object({radius:z.number().min(0).optional()}),methods$7={fisheye(d,m={}){const{radius:g=2.5}=FisheyeOptionsSchema.parse(m),w=clone(d),{width:$,height:I}=w.bitmap;return w.scan(((D,q)=>{const j=D/$,G=q/I,H=Math.sqrt(Math.pow(j-.5,2)+Math.pow(G-.5,2)),W=2*Math.pow(H,g),V=(j-.5)/H,K=(G-.5)/H,Z=Math.round((W*V+.5)*$),Q=Math.round((W*K+.5)*I),J=w.getPixelColor(Z,Q);d.setPixelColor(J,D,q)})),d.setPixelColor(w.getPixelColor($/2,I/2),$/2,I/2),d}},FlipOptionsSchema=z.object({horizontal:z.boolean().optional(),vertical:z.boolean().optional()}),methods$6={flip(d,m){const{horizontal:g,vertical:w}=FlipOptionsSchema.parse(m),$=Buffer.alloc(d.bitmap.data.length);return d.scan(((I,D,q)=>{const j=g?d.bitmap.width-1-I:I,G=w?d.bitmap.height-1-D:D,H=d.bitmap.width*G+j<<2,W=d.bitmap.data.readUInt32BE(q);$.writeUInt32BE(W,H)})),d.bitmap.data=Buffer.from($),d}};function Converter$1(d,m){if(!(d&&m&&d.length&&m.length))throw new Error("Bad alphabet");this.srcAlphabet=d,this.dstAlphabet=m}Converter$1.prototype.convert=function(d){var m,g,w,$={},I=this.srcAlphabet.length,D=this.dstAlphabet.length,q=d.length,j=typeof d=="string"?"":[];if(!this.isValid(d))throw new Error('Number "'+d+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return d;for(m=0;m<q;m++)$[m]=this.srcAlphabet.indexOf(d[m]);do{for(g=0,w=0,m=0;m<q;m++)(g=g*I+$[m])>=D?($[w++]=parseInt(g/D,10),g%=D):w>0&&($[w++]=0);q=w,j=this.dstAlphabet.slice(g,g+1).concat(j)}while(w!==0);return j},Converter$1.prototype.isValid=function(d){for(var m=0;m<d.length;++m)if(this.srcAlphabet.indexOf(d[m])===-1)return!1;return!0};var converter=Converter$1,Converter=converter;function anyBase(d,m){var g=new Converter(d,m);return function(w){return g.convert(w)}}anyBase.BIN="01",anyBase.OCT="01234567",anyBase.DEC="0123456789",anyBase.HEX="0123456789abcdef";var anyBase_1=anyBase,anyBase$1=getDefaultExportFromCjs(anyBase_1),__defProp$1=Object.defineProperty,__defNormalProp$1=(d,m,g)=>m in d?__defProp$1(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__publicField$1=(d,m,g)=>__defNormalProp$1(d,typeof m!="symbol"?m+"":m,g);class ImagePHash{constructor(m,g){__publicField$1(this,"size"),__publicField$1(this,"smallerSize"),this.size=m||32,this.smallerSize=g||8,initCoefficients(this.size)}distance(m,g){let w=0;for(let $=0;$<m.length;$++)m[$]!==g[$]&&w++;return w/m.length}getHash(m){m=methods$d.resize(clone(m),{w:this.size,h:this.size}),m=methods$e.greyscale(m);const g=[];for(let q=0;q<m.bitmap.width;q++){const j=[];for(let G=0;G<m.bitmap.height;G++)j[G]=intToRGBA(m.getPixelColor(q,G)).b;g[q]=j}const w=applyDCT(g,this.size);let $=0;for(let q=0;q<this.smallerSize;q++)for(let j=0;j<this.smallerSize;j++)$+=w[q][j];const I=$/(this.smallerSize*this.smallerSize);let D="";for(let q=0;q<this.smallerSize;q++)for(let j=0;j<this.smallerSize;j++)D+=w[q][j]>I?"1":"0";return D}}function intToRGBA(d){const m=255&d,g=255&(d>>>=8),w=255&(d>>>=8);return{r:255&(d>>>=8),g:w,b:g,a:m}}const c$1=[];function initCoefficients(d){for(let m=1;m<d;m++)c$1[m]=1;c$1[0]=1/Math.sqrt(2)}function applyDCT(d,m){const g=m,w=[];for(let $=0;$<g;$++){const I=[];for(let D=0;D<g;D++){let q=0;for(let j=0;j<g;j++)for(let G=0;G<g;G++)q+=Math.cos((2*j+1)/(2*g)*$*Math.PI)*Math.cos((2*G+1)/(2*g)*D*Math.PI)*d[j][G];q*=c$1[$]*c$1[D]/4,I[D]=q,w[$]=I}}return w}const alphabet="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_",maxHashLength=[NaN,NaN];for(let d=2;d<65;d++){const m=anyBase$1(anyBase$1.BIN,alphabet.slice(0,d))(new Array(65).join("1"));maxHashLength.push(m.length)}const methods$5={pHash:d=>new ImagePHash().getHash(d),hash(d,m=64){if(m<2||m>64)throw new Error("base must be a number between 2 and 64");const g=alphabet.slice(0,m),w=this.pHash(d),$=maxHashLength[m];return anyBase$1(anyBase$1.BIN,g)(w).padStart($,"0")},distanceFromHash(d,m){const g=new ImagePHash,w=g.getHash(d);return g.distance(w,m)}},MaskOptionsObjectSchema=z.object({src:JimpClassSchema,x:z.number().optional(),y:z.number().optional()}),MaskOptionsSchema=z.union([JimpClassSchema,MaskOptionsObjectSchema]),methods$4={mask(d,m){let g,w,$;MaskOptionsSchema.parse(m),"bitmap"in m?(g=m,w=0,$=0):(g=m.src,w=m.x??0,$=m.y??0),w=Math.round(w),$=Math.round($);const I=d.bitmap.width,D=d.bitmap.height;return g.scan((function(q,j,G){const H=w+q,W=$+j;if(H>=0&&W>=0&&H<I&&W<D){const V=d.getPixelIndex(H,W),{data:K}=g.bitmap,Z=(K[G+0]+K[G+1]+K[G+2])/3;d.bitmap.data[V+3]*=Z/255}})),d}};function measureText(d,m){let g=0;for(let w=0;w<m.length;w++){const $=m[w],I=d.chars[$];if(I){const D=d.kernings[$],q=m[w+1],j=D&&q&&D[q]&&D[q]||0;g+=(I.xadvance||0)+j}}return g}function splitLines(d,m,g){const w=m.replace(/[\r\n]+/g,` 
`).split(" "),$=[];let I=[],D=0;return w.forEach((q=>{if(measureText(d,q+(w.length>1?" ":""))>g){const H=q[Symbol.iterator]();let W="";for(const V of H){const K=[...I,W+V].join(" "),Z=measureText(d,K);Z<g?W+=V:Z>g?($.push([...I,W]),I=[],W=V):($.push([...I,W+V]),I=[],W="")}return}const j=[...I,q].join(" "),G=measureText(d,j);G<=g&&!q.includes(`
`)?(G>D&&(D=G),I.push(q)):($.push(I),I=[q.replace(`
`,"")])})),$.push(I),{lines:$,longestLine:D}}function measureTextHeight(d,m,g){const{lines:w}=splitLines(d,m,g);return w.length*d.common.lineHeight}const PrintOptionsSchema=z.object({x:z.number(),y:z.number(),text:z.union([z.union([z.string(),z.number()]),z.object({text:z.union([z.string(),z.number()]),alignmentX:z.nativeEnum(HorizontalAlign).optional(),alignmentY:z.nativeEnum(VerticalAlign).optional()})]),maxWidth:z.number().optional(),maxHeight:z.number().optional(),cb:z.function(z.tuple([z.object({x:z.number(),y:z.number()})])).optional()});function xOffsetBasedOnAlignment(d,m,g,w){return w===HorizontalAlign.LEFT?0:w===HorizontalAlign.CENTER?(g-measureText(d,m))/2:g-measureText(d,m)}function drawCharacter(d,m,g,w,$){if($.width>0&&$.height>0){const I=m.pages[$.page];I&&(d=methods$h.blit(d,{src:I,x:g+$.xoffset,y:w+$.yoffset,srcX:$.x,srcY:$.y,srcW:$.width,srcH:$.height}))}return d}function printText(d,m,g,w,$,I){for(let D=0;D<$.length;D++){const q=$[D];let j;j=m.chars[q]?q:/\s/.test(q)?"":"?";const G=m.chars[j]||{xadvance:void 0},H=m.kernings[j];G&&drawCharacter(d,m,g,w,G);const W=$[D+1];g+=(H&&W&&H[W]&&H[W]||0)+(G.xadvance||I)}}const methods$3={print(d,{font:m,...g}){let w,$,{x:I,y:D,text:q,maxWidth:j=1/0,maxHeight:G=1/0,cb:H=(()=>{})}=PrintOptionsSchema.parse(g);typeof q=="object"&&q.text!==null&&q.text!==void 0?(w=q.alignmentX||HorizontalAlign.LEFT,$=q.alignmentY||VerticalAlign.TOP,{text:q}=q):(w=HorizontalAlign.LEFT,$=VerticalAlign.TOP,q=q.toString()),typeof q=="number"&&(q=q.toString()),G!==1/0&&$===VerticalAlign.BOTTOM?D+=G-measureTextHeight(m,q,j):G!==1/0&&$===VerticalAlign.MIDDLE&&(D+=G/2-measureTextHeight(m,q,j)/2);const W=Object.entries(m.chars).find((Z=>Z[1].xadvance))?.[1].xadvance;if(typeof W!="number")throw new Error("Could not find default character width");const{lines:V,longestLine:K}=splitLines(m,q,j);return V.forEach((Z=>{const Q=Z.join(" "),J=xOffsetBasedOnAlignment(m,Q,j,w);printText(d,m,I+J,D,Q,W),D+=m.common.lineHeight})),H.bind(d)({x:I+K,y:D}),d}},RotateOptionsSchema=z.union([z.number(),z.object({deg:z.number(),mode:z.union([z.boolean(),z.nativeEnum(ResizeStrategy)]).optional()})]);function createIdxTranslationFunction(d){return function(m,g){return g*d+m<<2}}function matrixRotate(d,m){if(Math.abs(m)%90!=0)throw new Error("Unsupported matrix rotation degree");const g=d.bitmap.width,w=d.bitmap.height;let $;switch(m){case 90:case-270:$=90;break;case 180:case-180:$=180;break;case 270:case-90:$=-90;break;default:throw new Error("Unsupported matrix rotation degree")}const I=$===180?g:w,D=$===180?w:g,q=Buffer.alloc(d.bitmap.data.length),j=createIdxTranslationFunction(g),G=createIdxTranslationFunction(I);for(let H=0;H<g;H++)for(let W=0;W<w;W++){const V=j(H,W),K=d.bitmap.data.readUInt32BE(V);let Z;switch($){case 90:Z=G(W,g-H-1);break;case-90:Z=G(w-W-1,H);break;case 180:Z=G(g-H-1,w-W-1);break;default:throw new Error("Unsupported matrix rotation angle")}q.writeUInt32BE(K,Z)}d.bitmap.data=q,d.bitmap.width=I,d.bitmap.height=D}function createTranslationFunction(d,m){return function(g,w){return{x:g+d,y:w+m}}}function advancedRotate(d,m,g){const w=m*Math.PI/180,$=Math.cos(w),I=Math.sin(w);let D=d.bitmap.width,q=d.bitmap.height;if(g===!0||typeof g=="string"){D=Math.ceil(Math.abs(d.bitmap.width*$)+Math.abs(d.bitmap.height*I))+1,q=Math.ceil(Math.abs(d.bitmap.width*I)+Math.abs(d.bitmap.height*$))+1,D%2!=0&&D++,q%2!=0&&q++;const K=clone(d);d.scan(((Q,J,re)=>{d.bitmap.data.writeUInt32BE(d.background,re)}));const Z=Math.max(D,q,d.bitmap.width,d.bitmap.height);d=composite(d=methods$d.resize(d,{h:Z,w:Z,mode:g===!0?void 0:g}),K,d.bitmap.width/2-K.bitmap.width/2,d.bitmap.height/2-K.bitmap.height/2)}const j=d.bitmap.width,G=d.bitmap.height,H=Buffer.alloc(d.bitmap.data.length),W=createTranslationFunction(-j/2,-G/2),V=createTranslationFunction(j/2+.5,G/2+.5);for(let K=1;K<=G;K++)for(let Z=1;Z<=j;Z++){const Q=W(Z,K),J=V($*Q.x-I*Q.y,$*Q.y+I*Q.x),re=j*(K-1)+Z-1<<2;if(J.x>=0&&J.x<j&&J.y>=0&&J.y<G){const se=j*(0|J.y)+J.x<<2,oe=d.bitmap.data.readUInt32BE(se);H.writeUInt32BE(oe,re)}else H.writeUInt32BE(d.background,re)}if(d.bitmap.data=H,g===!0||typeof g=="string"){const K=Math.max(j/2-D/2,0),Z=Math.max(G/2-q/2,0);d=methods$b.crop(d,{x:K,y:Z,w:D,h:q})}}const methods$2={rotate(d,m){const g=RotateOptionsSchema.parse(m),w=typeof g=="number"?{deg:g}:g,{mode:$=!0}=w;let{deg:I}=w;return I%=360,I%360==0||(I%90==0&&($||d.bitmap.width===d.bitmap.height||I%180==0)?matrixRotate(d,I):advancedRotate(d,I,$)),d}},ThresholdOptionsSchema=z.object({max:z.number().min(0).max(255),replace:z.number().min(0).max(255).optional(),autoGreyscale:z.boolean().optional()}),methods$1={threshold(d,m){let{max:g,replace:w=255,autoGreyscale:$=!0}=ThresholdOptionsSchema.parse(m);return g=limit255(g),w=limit255(w),$&&methods$e.greyscale(d),d.scan(((I,D,q)=>{const j=d.bitmap.data[q]<g?d.bitmap.data[q]:w;d.bitmap.data[q]=j,d.bitmap.data[q+1]=j,d.bitmap.data[q+2]=j})),d}};var __defProp=Object.defineProperty,__defNormalProp=(d,m,g)=>m in d?__defProp(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__export=(d,m)=>{for(var g in m)__defProp(d,g,{get:m[g],enumerable:!0})},__publicField=(d,m,g)=>(__defNormalProp(d,typeof m!="symbol"?m+"":m,g),g),constants_exports={};__export(constants_exports,{bt709:()=>bt709_exports});var bt709_exports={};__export(bt709_exports,{Y:()=>Y,x:()=>x$1,y:()=>y$1});var Y=(d=>(d[d.RED=.2126]="RED",d[d.GREEN=.7152]="GREEN",d[d.BLUE=.0722]="BLUE",d[d.WHITE=1]="WHITE",d))(Y||{}),x$1=(d=>(d[d.RED=.64]="RED",d[d.GREEN=.3]="GREEN",d[d.BLUE=.15]="BLUE",d[d.WHITE=.3127]="WHITE",d))(x$1||{}),y$1=(d=>(d[d.RED=.33]="RED",d[d.GREEN=.6]="GREEN",d[d.BLUE=.06]="BLUE",d[d.WHITE=.329]="WHITE",d))(y$1||{}),conversion_exports={};function correctGamma(d){return d>.04045?((d+.055)/1.055)**2.4:d/12.92}function rgb2xyz(d,m,g){return{x:.4124*(d=correctGamma(d/255))+.3576*(m=correctGamma(m/255))+.1805*(g=correctGamma(g/255)),y:.2126*d+.7152*m+.0722*g,z:.0193*d+.1192*m+.9505*g}}__export(conversion_exports,{lab2rgb:()=>lab2rgb,lab2xyz:()=>lab2xyz,rgb2hsl:()=>rgb2hsl,rgb2lab:()=>rgb2lab,rgb2xyz:()=>rgb2xyz,xyz2lab:()=>xyz2lab,xyz2rgb:()=>xyz2rgb});var arithmetic_exports={};function degrees2radians(d){return d*(Math.PI/180)}function max3(d,m,g){let w=d;return w<m&&(w=m),w<g&&(w=g),w}function min3(d,m,g){let w=d;return w>m&&(w=m),w>g&&(w=g),w}function intInRange(d,m,g){return d>g&&(d=g),d<m&&(d=m),0|d}function inRange0to255Rounded(d){return(d=Math.round(d))>255?d=255:d<0&&(d=0),d}function inRange0to255(d){return d>255?d=255:d<0&&(d=0),d}function stableSort(d,m){const g=typeof d[0];let w;if(g==="number"||g==="string"){const $=Object.create(null);for(let I=0,D=d.length;I<D;I++){const q=d[I];$[q]||$[q]===0||($[q]=I)}w=d.sort(((I,D)=>m(I,D)||$[I]-$[D]))}else{const $=d.slice(0);w=d.sort(((I,D)=>m(I,D)||$.indexOf(I)-$.indexOf(D)))}return w}function rgb2hsl(d,m,g){const w=min3(d,m,g),$=max3(d,m,g),I=$-w,D=(w+$)/510;let q=0;D>0&&D<1&&(q=I/(D<.5?$+w:510-$-w));let j=0;return I>0&&(j=$===d?(m-g)/I:$===m?2+(g-d)/I:4+(d-m)/I,j*=60,j<0&&(j+=360)),{h:j,s:q,l:D}}__export(arithmetic_exports,{degrees2radians:()=>degrees2radians,inRange0to255:()=>inRange0to255,inRange0to255Rounded:()=>inRange0to255Rounded,intInRange:()=>intInRange,max3:()=>max3,min3:()=>min3,stableSort:()=>stableSort});var refX=.95047,refY=1,refZ=1.08883;function pivot(d){return d>.008856?d**(1/3):7.787*d+16/116}function xyz2lab(d,m,g){if(d=pivot(d/refX),m=pivot(m/refY),g=pivot(g/refZ),116*m-16<0)throw new Error("xxx");return{L:Math.max(0,116*m-16),a:500*(d-m),b:200*(m-g)}}function rgb2lab(d,m,g){const w=rgb2xyz(d,m,g);return xyz2lab(w.x,w.y,w.z)}var refX2=.95047,refY2=1,refZ2=1.08883;function pivot2(d){return d>.206893034?d**3:(d-16/116)/7.787}function lab2xyz(d,m,g){const w=(d+16)/116,$=w-g/200;return{x:refX2*pivot2(m/500+w),y:refY2*pivot2(w),z:refZ2*pivot2($)}}function correctGamma2(d){return d>.0031308?1.055*d**(1/2.4)-.055:12.92*d}function xyz2rgb(d,m,g){const w=correctGamma2(3.2406*d+-1.5372*m+-.4986*g),$=correctGamma2(-.9689*d+1.8758*m+.0415*g),I=correctGamma2(.0557*d+-.204*m+1.057*g);return{r:inRange0to255Rounded(255*w),g:inRange0to255Rounded(255*$),b:inRange0to255Rounded(255*I)}}function lab2rgb(d,m,g){const w=lab2xyz(d,m,g);return xyz2rgb(w.x,w.y,w.z)}var distance_exports={};__export(distance_exports,{AbstractDistanceCalculator:()=>AbstractDistanceCalculator,AbstractEuclidean:()=>AbstractEuclidean,AbstractManhattan:()=>AbstractManhattan,CIE94GraphicArts:()=>CIE94GraphicArts,CIE94Textiles:()=>CIE94Textiles,CIEDE2000:()=>CIEDE2000,CMetric:()=>CMetric,Euclidean:()=>Euclidean,EuclideanBT709:()=>EuclideanBT709,EuclideanBT709NoAlpha:()=>EuclideanBT709NoAlpha,Manhattan:()=>Manhattan,ManhattanBT709:()=>ManhattanBT709,ManhattanNommyde:()=>ManhattanNommyde,PNGQuant:()=>PNGQuant});var AbstractDistanceCalculator=class{constructor(){__publicField(this,"_maxDistance"),__publicField(this,"_whitePoint"),this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(d,m,g,w){this._whitePoint={r:d>0?255/d:0,g:m>0?255/m:0,b:g>0?255/g:0,a:w>0?255/w:0},this._maxDistance=this.calculateRaw(d,m,g,w,0,0,0,0)}calculateNormalized(d,m){return this.calculateRaw(d.r,d.g,d.b,d.a,m.r,m.g,m.b,m.a)/this._maxDistance}},AbstractCIE94=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,q){const j=rgb2lab(inRange0to255(d*this._whitePoint.r),inRange0to255(m*this._whitePoint.g),inRange0to255(g*this._whitePoint.b)),G=rgb2lab(inRange0to255($*this._whitePoint.r),inRange0to255(I*this._whitePoint.g),inRange0to255(D*this._whitePoint.b)),H=j.L-G.L,W=j.a-G.a,V=j.b-G.b,K=Math.sqrt(j.a*j.a+j.b*j.b),Z=K-Math.sqrt(G.a*G.a+G.b*G.b);let Q=W*W+V*V-Z*Z;Q=Q<0?0:Math.sqrt(Q);const J=(q-w)*this._whitePoint.a*this._kA;return Math.sqrt((H/this._Kl)**2+(Z/(1+this._K1*K))**2+(Q/(1+this._K2*K))**2+J**2)}},CIE94Textiles=class extends AbstractCIE94{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=12.5/255}},CIE94GraphicArts=class extends AbstractCIE94{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=25/255}},_CIEDE2000=class extends AbstractDistanceCalculator{_setDefaults(){}static _calculatehp(d,m){const g=Math.atan2(d,m);return g>=0?g:g+_CIEDE2000._deg360InRad}static _calculateRT(d,m){const g=m**7,w=2*Math.sqrt(g/(g+_CIEDE2000._pow25to7)),$=_CIEDE2000._deg30InRad*Math.exp(-(((d-_CIEDE2000._deg275InRad)/_CIEDE2000._deg25InRad)**2));return-Math.sin(2*$)*w}static _calculateT(d){return 1-.17*Math.cos(d-_CIEDE2000._deg30InRad)+.24*Math.cos(2*d)+.32*Math.cos(3*d+_CIEDE2000._deg6InRad)-.2*Math.cos(4*d-_CIEDE2000._deg63InRad)}static _calculate_ahp(d,m,g,w){const $=g+w;return d===0?$:m<=_CIEDE2000._deg180InRad?$/2:$<_CIEDE2000._deg360InRad?($+_CIEDE2000._deg360InRad)/2:($-_CIEDE2000._deg360InRad)/2}static _calculate_dHp(d,m,g,w){let $;return $=d===0?0:m<=_CIEDE2000._deg180InRad?g-w:g<=w?g-w+_CIEDE2000._deg360InRad:g-w-_CIEDE2000._deg360InRad,2*Math.sqrt(d)*Math.sin($/2)}calculateRaw(d,m,g,w,$,I,D,q){const j=rgb2lab(inRange0to255(d*this._whitePoint.r),inRange0to255(m*this._whitePoint.g),inRange0to255(g*this._whitePoint.b)),G=rgb2lab(inRange0to255($*this._whitePoint.r),inRange0to255(I*this._whitePoint.g),inRange0to255(D*this._whitePoint.b)),H=(q-w)*this._whitePoint.a*_CIEDE2000._kA,W=this.calculateRawInLab(j,G);return Math.sqrt(W+H*H)}calculateRawInLab(d,m){const g=d.L,w=d.a,$=d.b,I=m.L,D=m.a,q=m.b,j=((Math.sqrt(w*w+$*$)+Math.sqrt(D*D+q*q))/2)**7,G=.5*(1-Math.sqrt(j/(j+_CIEDE2000._pow25to7))),H=(1+G)*w,W=(1+G)*D,V=Math.sqrt(H*H+$*$),K=Math.sqrt(W*W+q*q),Z=V*K,Q=_CIEDE2000._calculatehp($,H),J=_CIEDE2000._calculatehp(q,W),re=Math.abs(Q-J),se=I-g,oe=K-V,ee=_CIEDE2000._calculate_dHp(Z,re,J,Q),ae=_CIEDE2000._calculate_ahp(Z,re,Q,J),ce=(V+K)/2,le=((g+I)/2-50)**2,de=oe/(1+.045*ce),_e=ee/(1+.015*_CIEDE2000._calculateT(ae)*ce);return(se/(1+.015*le/Math.sqrt(20+le)))**2+de**2+_e**2+_CIEDE2000._calculateRT(ae,ce)*de*_e}},CIEDE2000=_CIEDE2000;__publicField(CIEDE2000,"_kA",25/255),__publicField(CIEDE2000,"_pow25to7",25**7),__publicField(CIEDE2000,"_deg360InRad",degrees2radians(360)),__publicField(CIEDE2000,"_deg180InRad",degrees2radians(180)),__publicField(CIEDE2000,"_deg30InRad",degrees2radians(30)),__publicField(CIEDE2000,"_deg6InRad",degrees2radians(6)),__publicField(CIEDE2000,"_deg63InRad",degrees2radians(63)),__publicField(CIEDE2000,"_deg275InRad",degrees2radians(275)),__publicField(CIEDE2000,"_deg25InRad",degrees2radians(25));var CMetric=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,q){const j=(d+$)/2*this._whitePoint.r,G=(d-$)*this._whitePoint.r,H=(m-I)*this._whitePoint.g,W=(g-D)*this._whitePoint.b,V=((512+j)*G*G>>8)+4*H*H+((767-j)*W*W>>8),K=(q-w)*this._whitePoint.a;return Math.sqrt(V+K*K)}_setDefaults(){}},AbstractEuclidean=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,q){const j=$-d,G=I-m,H=D-g,W=q-w;return Math.sqrt(this._kR*j*j+this._kG*G*G+this._kB*H*H+this._kA*W*W)}},Euclidean=class extends AbstractEuclidean{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},EuclideanBT709=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},EuclideanBT709NoAlpha=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=0}},AbstractManhattan=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,q){let j=$-d,G=I-m,H=D-g,W=q-w;return j<0&&(j=0-j),G<0&&(G=0-G),H<0&&(H=0-H),W<0&&(W=0-W),this._kR*j+this._kG*G+this._kB*H+this._kA*W}},Manhattan=class extends AbstractManhattan{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},ManhattanNommyde=class extends AbstractManhattan{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}},ManhattanBT709=class extends AbstractManhattan{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},PNGQuant=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,q){const j=(q-w)*this._whitePoint.a;return this._colordifferenceCh(d*this._whitePoint.r,$*this._whitePoint.r,j)+this._colordifferenceCh(m*this._whitePoint.g,I*this._whitePoint.g,j)+this._colordifferenceCh(g*this._whitePoint.b,D*this._whitePoint.b,j)}_colordifferenceCh(d,m,g){const w=d-m,$=w+g;return w*w+$*$}_setDefaults(){}},palette_exports={};__export(palette_exports,{AbstractPaletteQuantizer:()=>AbstractPaletteQuantizer,ColorHistogram:()=>ColorHistogram,NeuQuant:()=>NeuQuant,NeuQuantFloat:()=>NeuQuantFloat,RGBQuant:()=>RGBQuant,WuColorCube:()=>WuColorCube,WuQuant:()=>WuQuant});var AbstractPaletteQuantizer=class{quantizeSync(){for(const d of this.quantize())if(d.palette)return d.palette;throw new Error("unreachable")}},Point=class{constructor(){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),__publicField(this,"uint32"),__publicField(this,"rgba"),this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}static createByQuadruplet(d){const m=new Point;return m.r=0|d[0],m.g=0|d[1],m.b=0|d[2],m.a=0|d[3],m._loadUINT32(),m._loadQuadruplet(),m}static createByRGBA(d,m,g,w){const $=new Point;return $.r=0|d,$.g=0|m,$.b=0|g,$.a=0|w,$._loadUINT32(),$._loadQuadruplet(),$}static createByUint32(d){const m=new Point;return m.uint32=d>>>0,m._loadRGBA(),m._loadQuadruplet(),m}from(d){this.r=d.r,this.g=d.g,this.b=d.b,this.a=d.a,this.uint32=d.uint32,this.rgba[0]=d.r,this.rgba[1]=d.g,this.rgba[2]=d.b,this.rgba[3]=d.a}getLuminosity(d){let m=this.r,g=this.g,w=this.b;return d&&(m=Math.min(255,255-this.a+this.a*m/255),g=Math.min(255,255-this.a+this.a*g/255),w=Math.min(255,255-this.a+this.a*w/255)),.2126*m+.7152*g+.0722*w}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=255&this.uint32,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}},PointContainer=class{constructor(){__publicField(this,"_pointArray"),__publicField(this,"_width"),__publicField(this,"_height"),this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(d){this._width=d}setHeight(d){this._height=d}getPointArray(){return this._pointArray}clone(){const d=new PointContainer;d._width=this._width,d._height=this._height;for(let m=0,g=this._pointArray.length;m<g;m++)d._pointArray[m]=Point.createByUint32(0|this._pointArray[m].uint32);return d}toUint32Array(){const d=this._pointArray.length,m=new Uint32Array(d);for(let g=0;g<d;g++)m[g]=this._pointArray[g].uint32;return m}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(d){const m=d.naturalWidth,g=d.naturalHeight,w=document.createElement("canvas");return w.width=m,w.height=g,w.getContext("2d").drawImage(d,0,0,m,g,0,0,m,g),PointContainer.fromHTMLCanvasElement(w)}static fromHTMLCanvasElement(d){const m=d.width,g=d.height,w=d.getContext("2d").getImageData(0,0,m,g);return PointContainer.fromImageData(w)}static fromImageData(d){const m=d.width,g=d.height;return PointContainer.fromUint8Array(d.data,m,g)}static fromUint8Array(d,m,g){switch(Object.prototype.toString.call(d)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:d=new Uint8Array(d)}const w=new Uint32Array(d.buffer);return PointContainer.fromUint32Array(w,m,g)}static fromUint32Array(d,m,g){const w=new PointContainer;w._width=m,w._height=g;for(let $=0,I=d.length;$<I;$++)w._pointArray[$]=Point.createByUint32(0|d[$]);return w}static fromBuffer(d,m,g){const w=new Uint32Array(d.buffer,d.byteOffset,d.byteLength/Uint32Array.BYTES_PER_ELEMENT);return PointContainer.fromUint32Array(w,m,g)}},hueGroups=10;function hueGroup(d,m){const g=360/m;for(let w=1,$=g-g/2;w<m;w++,$+=g)if(d>=$&&d<$+g)return w;return 0}var Palette=class{constructor(){__publicField(this,"_pointContainer"),__publicField(this,"_pointArray",[]),__publicField(this,"_i32idx",{}),this._pointContainer=new PointContainer,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(d){this._pointArray.push(d),this._pointContainer.setWidth(this._pointArray.length)}has(d){for(let m=this._pointArray.length-1;m>=0;m--)if(d.uint32===this._pointArray[m].uint32)return!0;return!1}getNearestColor(d,m){return this._pointArray[0|this._getNearestIndex(d,m)]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(d){return typeof this._i32idx[d]=="number"?this._i32idx[d]:-1}_getNearestIndex(d,m){let g=this._nearestPointFromCache(""+m.uint32);if(g>=0)return g;let w=Number.MAX_VALUE;g=0;for(let $=0,I=this._pointArray.length;$<I;$++){const D=this._pointArray[$],q=d.calculateRaw(m.r,m.g,m.b,m.a,D.r,D.g,D.b,D.a);q<w&&(w=q,g=$)}return this._i32idx[m.uint32]=g,g}sort(){this._i32idx={},this._pointArray.sort(((d,m)=>{const g=rgb2hsl(d.r,d.g,d.b),w=rgb2hsl(m.r,m.g,m.b),$=d.r===d.g&&d.g===d.b?0:1+hueGroup(g.h,hueGroups),I=(m.r===m.g&&m.g===m.b?0:1+hueGroup(w.h,hueGroups))-$;if(I)return-I;const D=d.getLuminosity(!0),q=m.getLuminosity(!0);if(q-D!=0)return q-D;const j=(100*w.s|0)-(100*g.s|0);return j?-j:0}))}},utils_exports={};__export(utils_exports,{HueStatistics:()=>HueStatistics,Palette:()=>Palette,Point:()=>Point,PointContainer:()=>PointContainer,ProgressTracker:()=>ProgressTracker,arithmetic:()=>arithmetic_exports});var HueGroup=class{constructor(){__publicField(this,"num",0),__publicField(this,"cols",[])}},HueStatistics=class{constructor(d,m){__publicField(this,"_numGroups"),__publicField(this,"_minCols"),__publicField(this,"_stats"),__publicField(this,"_groupsFull"),this._numGroups=d,this._minCols=m,this._stats=[];for(let g=0;g<=d;g++)this._stats[g]=new HueGroup;this._groupsFull=0}check(d){this._groupsFull===this._numGroups+1&&(this.check=()=>{});const m=255&d,g=d>>>8&255,w=d>>>16&255,$=m===g&&g===w?0:1+hueGroup(rgb2hsl(m,g,w).h,this._numGroups),I=this._stats[$],D=this._minCols;I.num++,I.num>D||(I.num===D&&this._groupsFull++,I.num<=D&&this._stats[$].cols.push(d))}injectIntoDictionary(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d[g]?d[g]++:d[g]=1}))}injectIntoArray(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d.indexOf(g)===-1&&d.push(g)}))}},_ProgressTracker=class{constructor(d,m){__publicField(this,"progress"),__publicField(this,"_step"),__publicField(this,"_range"),__publicField(this,"_last"),__publicField(this,"_progressRange"),this._range=d,this._progressRange=m,this._step=Math.max(1,this._range/(_ProgressTracker.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(d){return d-this._last>=this._step&&(this._last=d,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0)}},ProgressTracker=_ProgressTracker;__publicField(ProgressTracker,"steps",100);var networkBiasShift=3,Neuron=class{constructor(d){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift,this.g>>networkBiasShift,this.b>>networkBiasShift,this.a>>networkBiasShift)}subtract(d,m,g,w){this.r-=0|d,this.g-=0|m,this.b-=0|g,this.a-=0|w}},_NeuQuant=class extends AbstractPaletteQuantizer{constructor(d,m=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new Neuron((d<<networkBiasShift+8)/this._networkSize|0),this._freq[d]=_NeuQuant._initialBias/this._networkSize|0,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuant._minpicturebytes&&(d=1);const g=30+(d-1)/3|0,w=m/d|0;let $,I=w/_NeuQuant._nCycles|0,D=_NeuQuant._initAlpha,q=(this._networkSize>>3)*_NeuQuant._radiusBias,j=q>>_NeuQuant._radiusBiasShift;j<=1&&(j=0);for(let H=0;H<j;H++)this._radPower[H]=D*((j*j-H*H)*_NeuQuant._radBias/(j*j))>>>0;$=m<_NeuQuant._minpicturebytes?1:m%_NeuQuant._prime1!=0?_NeuQuant._prime1:m%_NeuQuant._prime2!=0?_NeuQuant._prime2:m%_NeuQuant._prime3!=0?_NeuQuant._prime3:_NeuQuant._prime4;const G=new ProgressTracker(w,99);for(let H=0,W=0;H<w;){G.shouldNotify(H)&&(yield{progress:G.progress});const V=this._pointArray[W],K=V.b<<networkBiasShift,Z=V.g<<networkBiasShift,Q=V.r<<networkBiasShift,J=V.a<<networkBiasShift,re=this._contest(K,Z,Q,J);if(this._alterSingle(D,re,K,Z,Q,J),j!==0&&this._alterNeighbour(j,re,K,Z,Q,J),W+=$,W>=m&&(W-=m),H++,I===0&&(I=1),H%I==0){D-=D/g|0,q-=q/_NeuQuant._radiusDecrease|0,j=q>>_NeuQuant._radiusBiasShift,j<=1&&(j=0);for(let se=0;se<j;se++)this._radPower[se]=D*((j*j-se*se)*_NeuQuant._radBias/(j*j))>>>0}}}_buildPalette(){const d=new Palette;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let q=m+d;q>this._networkSize&&(q=this._networkSize);let j=m+1,G=m-1,H=1;for(;j<q||G>D;){const W=this._radPower[H++]/_NeuQuant._alphaRadBias;if(j<q){const V=this._network[j++];V.subtract(W*(V.r-$),W*(V.g-w),W*(V.b-g),W*(V.a-I))}if(G>D){const V=this._network[G--];V.subtract(W*(V.r-$),W*(V.g-w),W*(V.b-g),W*(V.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuant._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift;let I=2147483647,D=I,q=-1,j=q;for(let G=0;G<this._networkSize;G++){const H=this._network[G],W=this._distance.calculateNormalized(H,{r:g,g:m,b:d,a:w})*$|0;W<I&&(I=W,q=G);const V=W-(this._bias[G]>>_NeuQuant._initialBiasShift-networkBiasShift);V<D&&(D=V,j=G);const K=this._freq[G]>>_NeuQuant._betaShift;this._freq[G]-=K,this._bias[G]+=K<<_NeuQuant._gammaShift}return this._freq[q]+=_NeuQuant._beta,this._bias[q]-=_NeuQuant._betaGamma,j}},NeuQuant=_NeuQuant;__publicField(NeuQuant,"_prime1",499),__publicField(NeuQuant,"_prime2",491),__publicField(NeuQuant,"_prime3",487),__publicField(NeuQuant,"_prime4",503),__publicField(NeuQuant,"_minpicturebytes",_NeuQuant._prime4),__publicField(NeuQuant,"_nCycles",100),__publicField(NeuQuant,"_initialBiasShift",16),__publicField(NeuQuant,"_initialBias",1<<_NeuQuant._initialBiasShift),__publicField(NeuQuant,"_gammaShift",10),__publicField(NeuQuant,"_betaShift",10),__publicField(NeuQuant,"_beta",_NeuQuant._initialBias>>_NeuQuant._betaShift),__publicField(NeuQuant,"_betaGamma",_NeuQuant._initialBias<<_NeuQuant._gammaShift-_NeuQuant._betaShift),__publicField(NeuQuant,"_radiusBiasShift",6),__publicField(NeuQuant,"_radiusBias",1<<_NeuQuant._radiusBiasShift),__publicField(NeuQuant,"_radiusDecrease",30),__publicField(NeuQuant,"_alphaBiasShift",10),__publicField(NeuQuant,"_initAlpha",1<<_NeuQuant._alphaBiasShift),__publicField(NeuQuant,"_radBiasShift",8),__publicField(NeuQuant,"_radBias",1<<_NeuQuant._radBiasShift),__publicField(NeuQuant,"_alphaRadBiasShift",_NeuQuant._alphaBiasShift+_NeuQuant._radBiasShift),__publicField(NeuQuant,"_alphaRadBias",1<<_NeuQuant._alphaRadBiasShift);var networkBiasShift2=3,NeuronFloat=class{constructor(d){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift2,this.g>>networkBiasShift2,this.b>>networkBiasShift2,this.a>>networkBiasShift2)}subtract(d,m,g,w){this.r-=d,this.g-=m,this.b-=g,this.a-=w}},_NeuQuantFloat=class extends AbstractPaletteQuantizer{constructor(d,m=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new NeuronFloat((d<<networkBiasShift2+8)/this._networkSize),this._freq[d]=_NeuQuantFloat._initialBias/this._networkSize,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuantFloat._minpicturebytes&&(d=1);const g=30+(d-1)/3,w=m/d;let $,I=w/_NeuQuantFloat._nCycles|0,D=_NeuQuantFloat._initAlpha,q=(this._networkSize>>3)*_NeuQuantFloat._radiusBias,j=q>>_NeuQuantFloat._radiusBiasShift;j<=1&&(j=0);for(let H=0;H<j;H++)this._radPower[H]=D*((j*j-H*H)*_NeuQuantFloat._radBias/(j*j));$=m<_NeuQuantFloat._minpicturebytes?1:m%_NeuQuantFloat._prime1!=0?_NeuQuantFloat._prime1:m%_NeuQuantFloat._prime2!=0?_NeuQuantFloat._prime2:m%_NeuQuantFloat._prime3!=0?_NeuQuantFloat._prime3:_NeuQuantFloat._prime4;const G=new ProgressTracker(w,99);for(let H=0,W=0;H<w;){G.shouldNotify(H)&&(yield{progress:G.progress});const V=this._pointArray[W],K=V.b<<networkBiasShift2,Z=V.g<<networkBiasShift2,Q=V.r<<networkBiasShift2,J=V.a<<networkBiasShift2,re=this._contest(K,Z,Q,J);if(this._alterSingle(D,re,K,Z,Q,J),j!==0&&this._alterNeighbour(j,re,K,Z,Q,J),W+=$,W>=m&&(W-=m),H++,I===0&&(I=1),H%I==0){D-=D/g,q-=q/_NeuQuantFloat._radiusDecrease,j=q>>_NeuQuantFloat._radiusBiasShift,j<=1&&(j=0);for(let se=0;se<j;se++)this._radPower[se]=D*((j*j-se*se)*_NeuQuantFloat._radBias/(j*j))}}}_buildPalette(){const d=new Palette;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let q=m+d;q>this._networkSize&&(q=this._networkSize);let j=m+1,G=m-1,H=1;for(;j<q||G>D;){const W=this._radPower[H++]/_NeuQuantFloat._alphaRadBias;if(j<q){const V=this._network[j++];V.subtract(W*(V.r-$),W*(V.g-w),W*(V.b-g),W*(V.a-I))}if(G>D){const V=this._network[G--];V.subtract(W*(V.r-$),W*(V.g-w),W*(V.b-g),W*(V.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuantFloat._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift2;let I=2147483647,D=I,q=-1,j=q;for(let G=0;G<this._networkSize;G++){const H=this._network[G],W=this._distance.calculateNormalized(H,{r:g,g:m,b:d,a:w})*$;W<I&&(I=W,q=G);const V=W-(this._bias[G]>>_NeuQuantFloat._initialBiasShift-networkBiasShift2);V<D&&(D=V,j=G);const K=this._freq[G]>>_NeuQuantFloat._betaShift;this._freq[G]-=K,this._bias[G]+=K<<_NeuQuantFloat._gammaShift}return this._freq[q]+=_NeuQuantFloat._beta,this._bias[q]-=_NeuQuantFloat._betaGamma,j}},NeuQuantFloat=_NeuQuantFloat;__publicField(NeuQuantFloat,"_prime1",499),__publicField(NeuQuantFloat,"_prime2",491),__publicField(NeuQuantFloat,"_prime3",487),__publicField(NeuQuantFloat,"_prime4",503),__publicField(NeuQuantFloat,"_minpicturebytes",_NeuQuantFloat._prime4),__publicField(NeuQuantFloat,"_nCycles",100),__publicField(NeuQuantFloat,"_initialBiasShift",16),__publicField(NeuQuantFloat,"_initialBias",1<<_NeuQuantFloat._initialBiasShift),__publicField(NeuQuantFloat,"_gammaShift",10),__publicField(NeuQuantFloat,"_betaShift",10),__publicField(NeuQuantFloat,"_beta",_NeuQuantFloat._initialBias>>_NeuQuantFloat._betaShift),__publicField(NeuQuantFloat,"_betaGamma",_NeuQuantFloat._initialBias<<_NeuQuantFloat._gammaShift-_NeuQuantFloat._betaShift),__publicField(NeuQuantFloat,"_radiusBiasShift",6),__publicField(NeuQuantFloat,"_radiusBias",1<<_NeuQuantFloat._radiusBiasShift),__publicField(NeuQuantFloat,"_radiusDecrease",30),__publicField(NeuQuantFloat,"_alphaBiasShift",10),__publicField(NeuQuantFloat,"_initAlpha",1<<_NeuQuantFloat._alphaBiasShift),__publicField(NeuQuantFloat,"_radBiasShift",8),__publicField(NeuQuantFloat,"_radBias",1<<_NeuQuantFloat._radBiasShift),__publicField(NeuQuantFloat,"_alphaRadBiasShift",_NeuQuantFloat._alphaBiasShift+_NeuQuantFloat._radBiasShift),__publicField(NeuQuantFloat,"_alphaRadBias",1<<_NeuQuantFloat._alphaRadBiasShift);var _ColorHistogram=class{constructor(d,m){__publicField(this,"_method"),__publicField(this,"_hueStats"),__publicField(this,"_histogram"),__publicField(this,"_initColors"),__publicField(this,"_minHueCols"),this._method=d,this._minHueCols=m<<2,this._initColors=m<<2,this._hueStats=new HueStatistics(_ColorHistogram._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(d){switch(this._method){case 1:this._colorStats1D(d);break;case 2:this._colorStats2D(d)}}getImportanceSortedColorsIDXI32(){const d=stableSort(Object.keys(this._histogram),((g,w)=>this._histogram[w]-this._histogram[g]));if(d.length===0)return[];let m;switch(this._method){case 1:const g=Math.min(d.length,this._initColors),w=d[g-1],$=this._histogram[w];m=d.slice(0,g);let I=g;const D=d.length;for(;I<D&&this._histogram[d[I]]===$;)m.push(d[I++]);this._hueStats.injectIntoArray(m);break;case 2:m=d;break;default:throw new Error("Incorrect method")}return m.map((g=>+g))}_colorStats1D(d){const m=this._histogram,g=d.getPointArray(),w=g.length;for(let $=0;$<w;$++){const I=g[$].uint32;this._hueStats.check(I),I in m?m[I]++:m[I]=1}}_colorStats2D(d){const m=d.getWidth(),g=d.getHeight(),w=d.getPointArray(),$=_ColorHistogram._boxSize[0],I=_ColorHistogram._boxSize[1],D=$*I,q=this._makeBoxes(m,g,$,I),j=this._histogram;q.forEach((G=>{let H=Math.round(G.w*G.h/D)*_ColorHistogram._boxPixels;H<2&&(H=2);const W={};this._iterateBox(G,m,(V=>{const K=w[V].uint32;this._hueStats.check(K),K in j?j[K]++:K in W?++W[K]>=H&&(j[K]=W[K]):W[K]=1}))})),this._hueStats.injectIntoDictionary(j)}_iterateBox(d,m,g){const w=d,$=w.y*m+w.x,I=(w.y+w.h-1)*m+(w.x+w.w-1),D=m-w.w+1;let q=0,j=$;do g.call(this,j),j+=++q%w.w==0?D:1;while(j<=I)}_makeBoxes(d,m,g,w){const $=d%g,I=m%w,D=d-$,q=m-I,j=[];for(let G=0;G<m;G+=w)for(let H=0;H<d;H+=g)j.push({x:H,y:G,w:H===D?$:g,h:G===q?I:w});return j}},ColorHistogram=_ColorHistogram;__publicField(ColorHistogram,"_boxSize",[64,64]),__publicField(ColorHistogram,"_boxPixels",2),__publicField(ColorHistogram,"_hueGroups",10);var RemovedColor=class{constructor(d,m,g){__publicField(this,"index"),__publicField(this,"color"),__publicField(this,"distance"),this.index=d,this.color=m,this.distance=g}},RGBQuant=class extends AbstractPaletteQuantizer{constructor(d,m=256,g=2){super(),__publicField(this,"_colors"),__publicField(this,"_initialDistance"),__publicField(this,"_distanceIncrement"),__publicField(this,"_histogram"),__publicField(this,"_distance"),this._distance=d,this._colors=m,this._histogram=new ColorHistogram(g,m),this._initialDistance=.01,this._distanceIncrement=.005}sample(d){this._histogram.sample(d)}*quantize(){const d=this._histogram.getImportanceSortedColorsIDXI32();if(d.length===0)throw new Error("No colors in image");yield*this._buildPalette(d)}*_buildPalette(d){const m=new Palette,g=m.getPointContainer().getPointArray(),w=new Array(d.length);for(let H=0;H<d.length;H++)g.push(Point.createByUint32(d[H])),w[H]=1;const $=g.length,I=[];let D=$,q=this._initialDistance;const j=new ProgressTracker(D-this._colors,99);for(;D>this._colors;){I.length=0;for(let H=0;H<$;H++){if(j.shouldNotify($-D)&&(yield{progress:j.progress}),w[H]===0)continue;const W=g[H];for(let V=H+1;V<$;V++){if(w[V]===0)continue;const K=g[V],Z=this._distance.calculateNormalized(W,K);Z<q&&(I.push(new RemovedColor(V,K,Z)),w[V]=0,D--)}}q+=D>3*this._colors?this._initialDistance:this._distanceIncrement}if(D<this._colors){stableSort(I,((W,V)=>V.distance-W.distance));let H=0;for(;D<this._colors&&H<I.length;)w[I[H].index]=1,D++,H++}let G=g.length;for(let H=G-1;H>=0;H--)w[H]===0&&(H!==G-1&&(g[H]=g[G-1]),--G);g.length=G,m.sort(),yield{palette:m,progress:100}}};function createArray1D(d){const m=[];for(let g=0;g<d;g++)m[g]=0;return m}function createArray4D(d,m,g,w){const $=new Array(d);for(let I=0;I<d;I++){$[I]=new Array(m);for(let D=0;D<m;D++){$[I][D]=new Array(g);for(let q=0;q<g;q++){$[I][D][q]=new Array(w);for(let j=0;j<w;j++)$[I][D][q][j]=0}}}return $}function createArray3D(d,m,g){const w=new Array(d);for(let $=0;$<d;$++){w[$]=new Array(m);for(let I=0;I<m;I++){w[$][I]=new Array(g);for(let D=0;D<g;D++)w[$][I][D]=0}}return w}function fillArray3D(d,m,g,w,$){for(let I=0;I<m;I++){d[I]=[];for(let D=0;D<g;D++){d[I][D]=[];for(let q=0;q<w;q++)d[I][D][q]=$}}}function fillArray1D(d,m,g){for(let w=0;w<m;w++)d[w]=g}var WuColorCube=class{constructor(){__publicField(this,"redMinimum"),__publicField(this,"redMaximum"),__publicField(this,"greenMinimum"),__publicField(this,"greenMaximum"),__publicField(this,"blueMinimum"),__publicField(this,"blueMaximum"),__publicField(this,"volume"),__publicField(this,"alphaMinimum"),__publicField(this,"alphaMaximum")}},_WuQuant=class extends AbstractPaletteQuantizer{constructor(d,m=256,g=5){super(),__publicField(this,"_reds"),__publicField(this,"_greens"),__publicField(this,"_blues"),__publicField(this,"_alphas"),__publicField(this,"_sums"),__publicField(this,"_weights"),__publicField(this,"_momentsRed"),__publicField(this,"_momentsGreen"),__publicField(this,"_momentsBlue"),__publicField(this,"_momentsAlpha"),__publicField(this,"_moments"),__publicField(this,"_table"),__publicField(this,"_pixels"),__publicField(this,"_cubes"),__publicField(this,"_colors"),__publicField(this,"_significantBitsPerChannel"),__publicField(this,"_maxSideIndex"),__publicField(this,"_alphaMaxSideIndex"),__publicField(this,"_sideSize"),__publicField(this,"_alphaSideSize"),__publicField(this,"_distance"),this._distance=d,this._setQuality(g),this._initialize(m)}sample(d){const m=d.getPointArray();for(let g=0,w=m.length;g<w;g++)this._addColor(m[g]);this._pixels=this._pixels.concat(m)}*quantize(){yield*this._preparePalette();const d=new Palette;for(let m=0;m<this._colors;m++)if(this._sums[m]>0){const g=this._sums[m],w=this._reds[m]/g,$=this._greens[m]/g,I=this._blues[m]/g,D=this._alphas[m]/g,q=Point.createByRGBA(0|w,0|$,0|I,0|D);d.add(q)}d.sort(),yield{palette:d,progress:100}}*_preparePalette(){yield*this._calculateMoments();let d=0;const m=createArray1D(this._colors);for(let D=1;D<this._colors;++D){this._cut(this._cubes[d],this._cubes[D])?(m[d]=this._cubes[d].volume>1?this._calculateVariance(this._cubes[d]):0,m[D]=this._cubes[D].volume>1?this._calculateVariance(this._cubes[D]):0):(m[d]=0,D--),d=0;let q=m[0];for(let j=1;j<=D;++j)m[j]>q&&(q=m[j],d=j);if(q<=0){this._colors=D+1;break}}const g=[],w=[],$=[],I=[];for(let D=0;D<this._colors;++D){const q=_WuQuant._volume(this._cubes[D],this._weights);q>0?(g[D]=_WuQuant._volume(this._cubes[D],this._momentsRed)/q|0,w[D]=_WuQuant._volume(this._cubes[D],this._momentsGreen)/q|0,$[D]=_WuQuant._volume(this._cubes[D],this._momentsBlue)/q|0,I[D]=_WuQuant._volume(this._cubes[D],this._momentsAlpha)/q|0):(g[D]=0,w[D]=0,$[D]=0,I[D]=0)}this._reds=createArray1D(this._colors+1),this._greens=createArray1D(this._colors+1),this._blues=createArray1D(this._colors+1),this._alphas=createArray1D(this._colors+1),this._sums=createArray1D(this._colors+1);for(let D=0,q=this._pixels.length;D<q;D++){const j=this._pixels[D];let G=-1,H=Number.MAX_VALUE;for(let W=0;W<this._colors;W++){const V=g[W],K=w[W],Z=$[W],Q=I[W],J=this._distance.calculateRaw(V,K,Z,Q,j.r,j.g,j.b,j.a);J<H&&(H=J,G=W)}this._reds[G]+=j.r,this._greens[G]+=j.g,this._blues[G]+=j.b,this._alphas[G]+=j.a,this._sums[G]++}}_addColor(d){const m=8-this._significantBitsPerChannel,g=1+(d.r>>m),w=1+(d.g>>m),$=1+(d.b>>m),I=1+(d.a>>m);this._weights[I][g][w][$]++,this._momentsRed[I][g][w][$]+=d.r,this._momentsGreen[I][g][w][$]+=d.g,this._momentsBlue[I][g][w][$]+=d.b,this._momentsAlpha[I][g][w][$]+=d.a,this._moments[I][g][w][$]+=this._table[d.r]+this._table[d.g]+this._table[d.b]+this._table[d.a]}*_calculateMoments(){const d=[],m=[],g=[],w=[],$=[],I=[],D=createArray3D(this._sideSize,this._sideSize,this._sideSize),q=createArray3D(this._sideSize,this._sideSize,this._sideSize),j=createArray3D(this._sideSize,this._sideSize,this._sideSize),G=createArray3D(this._sideSize,this._sideSize,this._sideSize),H=createArray3D(this._sideSize,this._sideSize,this._sideSize),W=createArray3D(this._sideSize,this._sideSize,this._sideSize);let V=0;const K=new ProgressTracker(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let Z=1;Z<=this._alphaMaxSideIndex;++Z){fillArray3D(D,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(q,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(j,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(G,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(H,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(W,this._sideSize,this._sideSize,this._sideSize,0);for(let Q=1;Q<=this._maxSideIndex;++Q,++V){K.shouldNotify(V)&&(yield{progress:K.progress}),fillArray1D(d,this._sideSize,0),fillArray1D(m,this._sideSize,0),fillArray1D(g,this._sideSize,0),fillArray1D(w,this._sideSize,0),fillArray1D($,this._sideSize,0),fillArray1D(I,this._sideSize,0);for(let J=1;J<=this._maxSideIndex;++J){let re=0,se=0,oe=0,ee=0,ae=0,ce=0;for(let le=1;le<=this._maxSideIndex;++le)re+=this._weights[Z][Q][J][le],se+=this._momentsRed[Z][Q][J][le],oe+=this._momentsGreen[Z][Q][J][le],ee+=this._momentsBlue[Z][Q][J][le],ae+=this._momentsAlpha[Z][Q][J][le],ce+=this._moments[Z][Q][J][le],d[le]+=re,m[le]+=se,g[le]+=oe,w[le]+=ee,$[le]+=ae,I[le]+=ce,D[Q][J][le]=D[Q-1][J][le]+d[le],q[Q][J][le]=q[Q-1][J][le]+m[le],j[Q][J][le]=j[Q-1][J][le]+g[le],G[Q][J][le]=G[Q-1][J][le]+w[le],H[Q][J][le]=H[Q-1][J][le]+$[le],W[Q][J][le]=W[Q-1][J][le]+I[le],this._weights[Z][Q][J][le]=this._weights[Z-1][Q][J][le]+D[Q][J][le],this._momentsRed[Z][Q][J][le]=this._momentsRed[Z-1][Q][J][le]+q[Q][J][le],this._momentsGreen[Z][Q][J][le]=this._momentsGreen[Z-1][Q][J][le]+j[Q][J][le],this._momentsBlue[Z][Q][J][le]=this._momentsBlue[Z-1][Q][J][le]+G[Q][J][le],this._momentsAlpha[Z][Q][J][le]=this._momentsAlpha[Z-1][Q][J][le]+H[Q][J][le],this._moments[Z][Q][J][le]=this._moments[Z-1][Q][J][le]+W[Q][J][le]}}}}static _volumeFloat(d,m){return m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMaximum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum])}static _volume(d,m){return 0|_WuQuant._volumeFloat(d,m)}static _top(d,m,g,w){let $;switch(m){case _WuQuant._alpha:$=w[g][d.redMaximum][d.greenMaximum][d.blueMaximum]-w[g][d.redMaximum][d.greenMinimum][d.blueMaximum]-w[g][d.redMinimum][d.greenMaximum][d.blueMaximum]+w[g][d.redMinimum][d.greenMinimum][d.blueMaximum]-(w[g][d.redMaximum][d.greenMaximum][d.blueMinimum]-w[g][d.redMaximum][d.greenMinimum][d.blueMinimum]-w[g][d.redMinimum][d.greenMaximum][d.blueMinimum]+w[g][d.redMinimum][d.greenMinimum][d.blueMinimum]);break;case _WuQuant._red:$=w[d.alphaMaximum][g][d.greenMaximum][d.blueMaximum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMaximum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMaximum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMaximum]-(w[d.alphaMaximum][g][d.greenMaximum][d.blueMinimum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMinimum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMinimum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMinimum]);break;case _WuQuant._green:$=w[d.alphaMaximum][d.redMaximum][g][d.blueMaximum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMaximum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMaximum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMaximum]-(w[d.alphaMaximum][d.redMaximum][g][d.blueMinimum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMinimum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMinimum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMinimum]);break;case _WuQuant._blue:$=w[d.alphaMaximum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMaximum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMaximum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMaximum][d.redMinimum][d.greenMinimum][g]-(w[d.alphaMinimum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMinimum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMinimum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMinimum][d.redMinimum][d.greenMinimum][g]);break;default:throw new Error("impossible")}return 0|$}static _bottom(d,m,g){switch(m){case _WuQuant._alpha:return-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant._red:return-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant._green:return-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant._blue:return-g[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);default:return 0}}_calculateVariance(d){const m=_WuQuant._volume(d,this._momentsRed),g=_WuQuant._volume(d,this._momentsGreen),w=_WuQuant._volume(d,this._momentsBlue),$=_WuQuant._volume(d,this._momentsAlpha);return _WuQuant._volumeFloat(d,this._moments)-(m*m+g*g+w*w+$*$)/_WuQuant._volume(d,this._weights)}_maximize(d,m,g,w,$,I,D,q,j){const G=0|_WuQuant._bottom(d,m,this._momentsRed),H=0|_WuQuant._bottom(d,m,this._momentsGreen),W=0|_WuQuant._bottom(d,m,this._momentsBlue),V=0|_WuQuant._bottom(d,m,this._momentsAlpha),K=0|_WuQuant._bottom(d,m,this._weights);let Z=0,Q=-1;for(let J=g;J<w;++J){let re=G+_WuQuant._top(d,m,J,this._momentsRed),se=H+_WuQuant._top(d,m,J,this._momentsGreen),oe=W+_WuQuant._top(d,m,J,this._momentsBlue),ee=V+_WuQuant._top(d,m,J,this._momentsAlpha),ae=K+_WuQuant._top(d,m,J,this._weights);if(ae!==0){let ce=re*re+se*se+oe*oe+ee*ee,le=ce/ae;re=$-re,se=I-se,oe=D-oe,ee=q-ee,ae=j-ae,ae!==0&&(ce=re*re+se*se+oe*oe+ee*ee,le+=ce/ae,le>Z&&(Z=le,Q=J))}}return{max:Z,position:Q}}_cut(d,m){let g;const w=_WuQuant._volume(d,this._momentsRed),$=_WuQuant._volume(d,this._momentsGreen),I=_WuQuant._volume(d,this._momentsBlue),D=_WuQuant._volume(d,this._momentsAlpha),q=_WuQuant._volume(d,this._weights),j=this._maximize(d,_WuQuant._red,d.redMinimum+1,d.redMaximum,w,$,I,D,q),G=this._maximize(d,_WuQuant._green,d.greenMinimum+1,d.greenMaximum,w,$,I,D,q),H=this._maximize(d,_WuQuant._blue,d.blueMinimum+1,d.blueMaximum,w,$,I,D,q),W=this._maximize(d,_WuQuant._alpha,d.alphaMinimum+1,d.alphaMaximum,w,$,I,D,q);if(W.max>=j.max&&W.max>=G.max&&W.max>=H.max){if(g=_WuQuant._alpha,W.position<0)return!1}else g=j.max>=W.max&&j.max>=G.max&&j.max>=H.max?_WuQuant._red:G.max>=W.max&&G.max>=j.max&&G.max>=H.max?_WuQuant._green:_WuQuant._blue;switch(m.redMaximum=d.redMaximum,m.greenMaximum=d.greenMaximum,m.blueMaximum=d.blueMaximum,m.alphaMaximum=d.alphaMaximum,g){case _WuQuant._red:m.redMinimum=d.redMaximum=j.position,m.greenMinimum=d.greenMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant._green:m.greenMinimum=d.greenMaximum=G.position,m.redMinimum=d.redMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant._blue:m.blueMinimum=d.blueMaximum=H.position,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant._alpha:m.alphaMinimum=d.alphaMaximum=W.position,m.blueMinimum=d.blueMinimum,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum}return d.volume=(d.redMaximum-d.redMinimum)*(d.greenMaximum-d.greenMinimum)*(d.blueMaximum-d.blueMinimum)*(d.alphaMaximum-d.alphaMinimum),m.volume=(m.redMaximum-m.redMinimum)*(m.greenMaximum-m.greenMinimum)*(m.blueMaximum-m.blueMinimum)*(m.alphaMaximum-m.alphaMinimum),!0}_initialize(d){this._colors=d,this._cubes=[];for(let m=0;m<d;m++)this._cubes[m]=new WuColorCube;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let m=0;m<256;++m)this._table[m]=m*m;this._pixels=[]}_setQuality(d=5){this._significantBitsPerChannel=d,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}},WuQuant=_WuQuant;__publicField(WuQuant,"_alpha",3),__publicField(WuQuant,"_red",2),__publicField(WuQuant,"_green",1),__publicField(WuQuant,"_blue",0);var image_exports={};__export(image_exports,{AbstractImageQuantizer:()=>AbstractImageQuantizer,ErrorDiffusionArray:()=>ErrorDiffusionArray,ErrorDiffusionArrayKernel:()=>ErrorDiffusionArrayKernel,ErrorDiffusionRiemersma:()=>ErrorDiffusionRiemersma,NearestColor:()=>NearestColor});var AbstractImageQuantizer=class{quantizeSync(d,m){for(const g of this.quantize(d,m))if(g.pointContainer)return g.pointContainer;throw new Error("unreachable")}},NearestColor=class extends AbstractImageQuantizer{constructor(d){super(),__publicField(this,"_distance"),this._distance=d}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=new ProgressTracker($,99);for(let D=0;D<$;D++){I.shouldNotify(D)&&(yield{progress:I.progress});for(let q=0,j=D*w;q<w;q++,j++){const G=g[j];G.from(m.getNearestColor(this._distance,G))}}yield{pointContainer:d,progress:100}}},ErrorDiffusionArrayKernel=(d=>(d[d.FloydSteinberg=0]="FloydSteinberg",d[d.FalseFloydSteinberg=1]="FalseFloydSteinberg",d[d.Stucki=2]="Stucki",d[d.Atkinson=3]="Atkinson",d[d.Jarvis=4]="Jarvis",d[d.Burkes=5]="Burkes",d[d.Sierra=6]="Sierra",d[d.TwoSierra=7]="TwoSierra",d[d.SierraLite=8]="SierraLite",d))(ErrorDiffusionArrayKernel||{}),ErrorDiffusionArray=class extends AbstractImageQuantizer{constructor(d,m,g=!0,w=0,$=!1){super(),__publicField(this,"_minColorDistance"),__publicField(this,"_serpentine"),__publicField(this,"_kernel"),__publicField(this,"_calculateErrorLikeGIMP"),__publicField(this,"_distance"),this._setKernel(m),this._distance=d,this._minColorDistance=w,this._serpentine=g,this._calculateErrorLikeGIMP=$}*quantize(d,m){const g=d.getPointArray(),w=new Point,$=d.getWidth(),I=d.getHeight(),D=[];let q=1,j=1;for(const H of this._kernel){const W=H[2]+1;j<W&&(j=W)}for(let H=0;H<j;H++)this._fillErrorLine(D[H]=[],$);const G=new ProgressTracker(I,99);for(let H=0;H<I;H++){G.shouldNotify(H)&&(yield{progress:G.progress}),this._serpentine&&(q*=-1);const W=H*$,V=q===1?0:$-1,K=q===1?$:-1;this._fillErrorLine(D[0],$),D.push(D.shift());const Z=D[0];for(let Q=V,J=W+V;Q!==K;Q+=q,J+=q){const re=g[J],se=Z[Q];w.from(re);const oe=Point.createByRGBA(inRange0to255Rounded(re.r+se[0]),inRange0to255Rounded(re.g+se[1]),inRange0to255Rounded(re.b+se[2]),inRange0to255Rounded(re.a+se[3])),ee=m.getNearestColor(this._distance,oe);if(re.from(ee),this._minColorDistance&&this._distance.calculateNormalized(w,ee)<this._minColorDistance)continue;let ae,ce,le,de;this._calculateErrorLikeGIMP?(ae=oe.r-ee.r,ce=oe.g-ee.g,le=oe.b-ee.b,de=oe.a-ee.a):(ae=w.r-ee.r,ce=w.g-ee.g,le=w.b-ee.b,de=w.a-ee.a);const _e=q===1?0:this._kernel.length-1,we=q===1?this._kernel.length:-1;for(let pe=_e;pe!==we;pe+=q){const xe=this._kernel[pe][1]*q,Ge=this._kernel[pe][2];if(xe+Q>=0&&xe+Q<$&&Ge+H>=0&&Ge+H<I){const Te=this._kernel[pe][0],Ce=D[Ge][xe+Q];Ce[0]+=ae*Te,Ce[1]+=ce*Te,Ce[2]+=le*Te,Ce[3]+=de*Te}}}}yield{pointContainer:d,progress:100}}_fillErrorLine(d,m){d.length>m&&(d.length=m);const g=d.length;for(let w=0;w<g;w++){const $=d[w];$[0]=$[1]=$[2]=$[3]=0}for(let w=g;w<m;w++)d[w]=[0,0,0,0]}_setKernel(d){switch(d){case 0:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case 1:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case 2:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case 3:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case 4:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case 5:this._kernel=[[.25,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[.25,0,1],[4/32,1,1],[2/32,2,1]];break;case 6:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case 7:this._kernel=[[.25,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case 8:this._kernel=[[.5,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw new Error(`ErrorDiffusionArray: unknown kernel = ${d}`)}}};function*hilbertCurve(d,m,g){const w=Math.max(d,m),$={width:d,height:m,level:Math.floor(Math.log(w)/Math.log(2)+1),callback:g,tracker:new ProgressTracker(d*m,99),index:0,x:0,y:0};yield*walkHilbert($,1),visit($,0)}function*walkHilbert(d,m){if(!(d.level<1)){switch(d.tracker.shouldNotify(d.index)&&(yield{progress:d.tracker.progress}),d.level--,m){case 2:yield*walkHilbert(d,1),visit(d,3),yield*walkHilbert(d,2),visit(d,4),yield*walkHilbert(d,2),visit(d,2),yield*walkHilbert(d,4);break;case 3:yield*walkHilbert(d,4),visit(d,2),yield*walkHilbert(d,3),visit(d,1),yield*walkHilbert(d,3),visit(d,3),yield*walkHilbert(d,1);break;case 1:yield*walkHilbert(d,2),visit(d,4),yield*walkHilbert(d,1),visit(d,3),yield*walkHilbert(d,1),visit(d,1),yield*walkHilbert(d,3);break;case 4:yield*walkHilbert(d,3),visit(d,1),yield*walkHilbert(d,4),visit(d,2),yield*walkHilbert(d,4),visit(d,4),yield*walkHilbert(d,2)}d.level++}}function visit(d,m){switch(d.x>=0&&d.x<d.width&&d.y>=0&&d.y<d.height&&(d.callback(d.x,d.y),d.index++),m){case 2:d.x--;break;case 3:d.x++;break;case 1:d.y--;break;case 4:d.y++}}var ErrorDiffusionRiemersma=class extends AbstractImageQuantizer{constructor(d,m=16,g=1){super(),__publicField(this,"_distance"),__publicField(this,"_weights"),__publicField(this,"_errorQueueSize"),this._distance=d,this._errorQueueSize=m,this._weights=ErrorDiffusionRiemersma._createWeights(g,m)}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=[];let D=0;for(let q=0;q<this._errorQueueSize;q++)I[q]={r:0,g:0,b:0,a:0};yield*hilbertCurve(w,$,((q,j)=>{const G=g[q+j*w];let{r:H,g:W,b:V,a:K}=G;for(let re=0;re<this._errorQueueSize;re++){const se=this._weights[re],oe=I[(re+D)%this._errorQueueSize];H+=oe.r*se,W+=oe.g*se,V+=oe.b*se,K+=oe.a*se}const Z=Point.createByRGBA(inRange0to255Rounded(H),inRange0to255Rounded(W),inRange0to255Rounded(V),inRange0to255Rounded(K)),Q=m.getNearestColor(this._distance,Z);D=(D+1)%this._errorQueueSize;const J=(D+this._errorQueueSize-1)%this._errorQueueSize;I[J].r=G.r-Q.r,I[J].g=G.g-Q.g,I[J].b=G.b-Q.b,I[J].a=G.a-Q.a,G.from(Q)})),yield{pointContainer:d,progress:100}}static _createWeights(d,m){const g=[],w=Math.exp(Math.log(m)/(m-1));for(let $=0,I=1;$<m;$++)g[$]=(I+.5|0)/m*d,I*=w;return g}},quality_exports={};__export(quality_exports,{ssim:()=>ssim});var K1=.01,K2=.03;function ssim(d,m){if(d.getHeight()!==m.getHeight()||d.getWidth()!==m.getWidth())throw new Error("Images have different sizes!");const g=(255*K1)**2,w=(255*K2)**2;let $=0,I=0;return iterate(d,m,((D,q,j,G)=>{let H=0,W=0,V=0;for(let Z=0;Z<D.length;Z++)W+=(D[Z]-j)**2,V+=(q[Z]-G)**2,H+=(D[Z]-j)*(q[Z]-G);const K=D.length-1;W/=K,V/=K,H/=K,I+=(2*j*G+g)*(2*H+w)/((j**2+G**2+g)*(W+V+w)),$++})),I/$}function iterate(d,m,g){const w=d.getWidth(),$=d.getHeight();for(let I=0;I<$;I+=8)for(let D=0;D<w;D+=8){const q=Math.min(8,w-D),j=Math.min(8,$-I),G=calculateLumaValuesForWindow(d,D,I,q,j),H=calculateLumaValuesForWindow(m,D,I,q,j);g(G,H,calculateAverageLuma(G),calculateAverageLuma(H))}}function calculateLumaValuesForWindow(d,m,g,w,$){const I=d.getPointArray(),D=[];let q=0;for(let j=g;j<g+$;j++){const G=j*d.getWidth();for(let H=m;H<m+w;H++){const W=I[G+H];D[q]=.2126*W.r+.7152*W.g+.0722*W.b,q++}}return D}function calculateAverageLuma(d){let m=0;for(const g of d)m+=g;return m/d.length}function buildPaletteSync(d,{colorDistanceFormula:m,paletteQuantization:g,colors:w}={}){const $=paletteQuantizationToPaletteQuantizer(colorDistanceFormulaToColorDistance(m),g,w);return d.forEach((I=>$.sample(I))),$.quantizeSync()}function applyPaletteSync(d,m,{colorDistanceFormula:g,imageQuantization:w}={}){return imageQuantizationToImageQuantizer(colorDistanceFormulaToColorDistance(g),w).quantizeSync(d,m)}function colorDistanceFormulaToColorDistance(d="euclidean-bt709"){switch(d){case"cie94-graphic-arts":return new CIE94GraphicArts;case"cie94-textiles":return new CIE94Textiles;case"ciede2000":return new CIEDE2000;case"color-metric":return new CMetric;case"euclidean":return new Euclidean;case"euclidean-bt709":return new EuclideanBT709;case"euclidean-bt709-noalpha":return new EuclideanBT709NoAlpha;case"manhattan":return new Manhattan;case"manhattan-bt709":return new ManhattanBT709;case"manhattan-nommyde":return new ManhattanNommyde;case"pngquant":return new PNGQuant;default:throw new Error(`Unknown colorDistanceFormula ${d}`)}}function imageQuantizationToImageQuantizer(d,m="floyd-steinberg"){switch(m){case"nearest":return new NearestColor(d);case"riemersma":return new ErrorDiffusionRiemersma(d);case"floyd-steinberg":return new ErrorDiffusionArray(d,0);case"false-floyd-steinberg":return new ErrorDiffusionArray(d,1);case"stucki":return new ErrorDiffusionArray(d,2);case"atkinson":return new ErrorDiffusionArray(d,3);case"jarvis":return new ErrorDiffusionArray(d,4);case"burkes":return new ErrorDiffusionArray(d,5);case"sierra":return new ErrorDiffusionArray(d,6);case"two-sierra":return new ErrorDiffusionArray(d,7);case"sierra-lite":return new ErrorDiffusionArray(d,8);default:throw new Error(`Unknown imageQuantization ${m}`)}}function paletteQuantizationToPaletteQuantizer(d,m="wuquant",g=256){switch(m){case"neuquant":return new NeuQuant(d,g);case"rgbquant":return new RGBQuant(d,g);case"wuquant":return new WuQuant(d,g);case"neuquant-float":return new NeuQuantFloat(d,g);default:throw new Error(`Unknown paletteQuantization ${m}`)}}/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cie94.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ciede2000.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cmetric.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * common.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * constants.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ditherErrorDiffusionArray.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * euclidean.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * helper.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * hueStatistics.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2rgb.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2xyz.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * manhattanNeuQuant.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * nearestColor.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * palette.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pngQuant.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * point.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pointContainer.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2hsl.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2lab.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2xyz.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ssim.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * wuQuant.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2lab.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2rgb.ts - part of Image Quantization Library
 *//**
 * @preserve
 * MIT License
 *
 * Copyright 2015-2018 Igor Bezkrovnyi
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * riemersma.ts - part of Image Quantization Library
 *//**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * colorHistogram.ts - part of Image Quantization Library
 *//**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * neuquant.ts - part of Image Quantization Library
 *//**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgbquant.ts - part of Image Quantization Library
 */typeof setImmediate=="function"?setImmediate:typeof process<"u"&&process?.nextTick;const QuantizeOptionsSchema=z.object({colors:z.number().optional(),colorDistanceFormula:z.union([z.literal("cie94-textiles"),z.literal("cie94-graphic-arts"),z.literal("ciede2000"),z.literal("color-metric"),z.literal("euclidean"),z.literal("euclidean-bt709-noalpha"),z.literal("euclidean-bt709"),z.literal("manhattan"),z.literal("manhattan-bt709"),z.literal("manhattan-nommyde"),z.literal("pngquant")]).optional(),paletteQuantization:z.union([z.literal("neuquant"),z.literal("neuquant-float"),z.literal("rgbquant"),z.literal("wuquant")]).optional(),imageQuantization:z.union([z.literal("nearest"),z.literal("riemersma"),z.literal("floyd-steinberg"),z.literal("false-floyd-steinberg"),z.literal("stucki"),z.literal("atkinson"),z.literal("jarvis"),z.literal("burkes"),z.literal("sierra"),z.literal("two-sierra"),z.literal("sierra-lite")]).optional()}),methods={quantize(d,m){const{colors:g,colorDistanceFormula:w,paletteQuantization:$,imageQuantization:I}=QuantizeOptionsSchema.parse(m),D=utils_exports.PointContainer.fromUint8Array(d.bitmap.data,d.bitmap.width,d.bitmap.height),q=applyPaletteSync(D,buildPaletteSync([D],{colors:g,colorDistanceFormula:w,paletteQuantization:$}),{colorDistanceFormula:w,imageQuantization:I});return d.bitmap.data=Buffer.from(q.toUint8Array()),d}};var parseBmfontAscii=function(d){if(!d)throw new Error("no data provided");var m={pages:[],chars:[],kernings:[]},g=(d=d.toString().trim()).split(/\r\n?|\n/g);if(g.length===0)throw new Error("no data in BMFont file");for(var w=0;w<g.length;w++){var $=splitLine(g[w],w);if($)if($.key==="page"){if(typeof $.data.id!="number")throw new Error("malformed file at line "+w+" -- needs page id=N");if(typeof $.data.file!="string")throw new Error("malformed file at line "+w+' -- needs page file="path"');m.pages[$.data.id]=$.data.file}else $.key==="chars"||$.key==="kernings"||($.key==="char"?m.chars.push($.data):$.key==="kerning"?m.kernings.push($.data):m[$.key]=$.data)}return m};function splitLine(d,m){if(!(d=d.replace(/\t+/g," ").trim()))return null;var g=d.indexOf(" ");if(g===-1)throw new Error("no named row at line "+m);var w=d.substring(0,g);d=(d=(d=(d=d.substring(g+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map((function(j){return j.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)}));for(var $=[],I=0;I<d.length;I++){var D=d[I];I===0?$.push({key:D[0],data:""}):I===d.length-1?$[$.length-1].data=parseData(D[0]):($[$.length-1].data=parseData(D[0]),$.push({key:D[1],data:""}))}var q={key:w,data:{}};return $.forEach((function(j){q.data[j.key]=j.data})),q}function parseData(d){return d&&d.length!==0?d.indexOf('"')===0||d.indexOf("'")===0?d.substring(1,d.length-1):d.indexOf(",")!==-1?parseIntList$1(d):parseInt(d,10):""}function parseIntList$1(d){return d.split(",").map((function(m){return parseInt(m,10)}))}getDefaultExportFromCjs(parseBmfontAscii);var GLYPH_DESIGNER_ERROR="chasrset",parseAttribs=function(d){for(var m in d=Object.assign({},d),GLYPH_DESIGNER_ERROR in d&&(d.charset=d[GLYPH_DESIGNER_ERROR],delete d[GLYPH_DESIGNER_ERROR]),d)m!=="face"&&m!=="charset"&&(d[m]=m==="padding"||m==="spacing"?parseIntList(d[m]):parseInt(d[m],10));return d};function parseIntList(d){return d.split(",").map((function(m){return parseInt(m,10)}))}var xmlParseFromString=self.DOMParser!==void 0?function(d){return new self.DOMParser().parseFromString(d,"application/xml")}:self.ActiveXObject!==void 0&&new self.ActiveXObject("Microsoft.XMLDOM")?function(d){var m=new self.ActiveXObject("Microsoft.XMLDOM");return m.async="false",m.loadXML(d),m}:function(d){var m=document.createElement("div");return m.innerHTML=d,m},parseAttributes=parseAttribs,parseFromString=xmlParseFromString,NAME_MAP={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"},browser=function(d){d=d.toString();var m=parseFromString(d),g={pages:[],chars:[],kernings:[]};["info","common"].forEach((function(G){var H=m.getElementsByTagName(G)[0];H&&(g[G]=parseAttributes(getAttribs(H)))}));var w=m.getElementsByTagName("pages")[0];if(!w)throw new Error("malformed file -- no <pages> element");for(var $=w.getElementsByTagName("page"),I=0;I<$.length;I++){var D=$[I],q=parseInt(D.getAttribute("id"),10),j=D.getAttribute("file");if(isNaN(q))throw new Error('malformed file -- page "id" attribute is NaN');if(!j)throw new Error('malformed file -- needs page "file" attribute');g.pages[parseInt(q,10)]=j}return["chars","kernings"].forEach((function(G){var H=m.getElementsByTagName(G)[0];if(H)for(var W=G.substring(0,G.length-1),V=H.getElementsByTagName(W),K=0;K<V.length;K++){var Z=V[K];g[G].push(parseAttributes(getAttribs(Z)))}})),g};function getAttribs(d){return getAttribList(d).reduce((function(m,g){return m[mapName(g.nodeName)]=g.nodeValue,m}),{})}function getAttribList(d){for(var m=[],g=0;g<d.attributes.length;g++)m.push(d.attributes[g]);return m}function mapName(d){return NAME_MAP[d.toLowerCase()]||d}getDefaultExportFromCjs(browser);var HEADER$1=[66,77,70],parseBmfontBinary=function(d){if(d.length<6)throw new Error("invalid buffer length for BMFont");var m=HEADER$1.every((function(I,D){return d.readUInt8(D)===I}));if(!m)throw new Error("BMFont missing BMF byte header");var g=3;if(d.readUInt8(g++)>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var w={kernings:[],chars:[]},$=0;$<5;$++)g+=readBlock(w,d,g);return w};function readBlock(d,m,g){if(g>m.length-1)return 0;var w=m.readUInt8(g++),$=m.readInt32LE(g);switch(g+=4,w){case 1:d.info=readInfo(m,g);break;case 2:d.common=readCommon(m,g);break;case 3:d.pages=readPages(m,g,$);break;case 4:d.chars=readChars(m,g,$);break;case 5:d.kernings=readKernings(m,g,$)}return 5+$}function readInfo(d,m){var g={};g.size=d.readInt16LE(m);var w=d.readUInt8(m+2);return g.smooth=w>>7&1,g.unicode=w>>6&1,g.italic=w>>5&1,g.bold=w>>4&1,w>>3&1&&(g.fixedHeight=1),g.charset=d.readUInt8(m+3)||"",g.stretchH=d.readUInt16LE(m+4),g.aa=d.readUInt8(m+6),g.padding=[d.readInt8(m+7),d.readInt8(m+8),d.readInt8(m+9),d.readInt8(m+10)],g.spacing=[d.readInt8(m+11),d.readInt8(m+12)],g.outline=d.readUInt8(m+13),g.face=readStringNT(d,m+14),g}function readCommon(d,m){var g={};return g.lineHeight=d.readUInt16LE(m),g.base=d.readUInt16LE(m+2),g.scaleW=d.readUInt16LE(m+4),g.scaleH=d.readUInt16LE(m+6),g.pages=d.readUInt16LE(m+8),d.readUInt8(m+10),g.packed=0,g.alphaChnl=d.readUInt8(m+11),g.redChnl=d.readUInt8(m+12),g.greenChnl=d.readUInt8(m+13),g.blueChnl=d.readUInt8(m+14),g}function readPages(d,m,g){for(var w=[],$=readNameNT(d,m),I=$.length+1,D=g/I,q=0;q<D;q++)w[q]=d.slice(m,m+$.length).toString("utf8"),m+=I;return w}function readChars(d,m,g){for(var w=[],$=g/20,I=0;I<$;I++){var D={},q=20*I;D.id=d.readUInt32LE(m+0+q),D.x=d.readUInt16LE(m+4+q),D.y=d.readUInt16LE(m+6+q),D.width=d.readUInt16LE(m+8+q),D.height=d.readUInt16LE(m+10+q),D.xoffset=d.readInt16LE(m+12+q),D.yoffset=d.readInt16LE(m+14+q),D.xadvance=d.readInt16LE(m+16+q),D.page=d.readUInt8(m+18+q),D.chnl=d.readUInt8(m+19+q),w[I]=D}return w}function readKernings(d,m,g){for(var w=[],$=g/10,I=0;I<$;I++){var D={},q=10*I;D.first=d.readUInt32LE(m+0+q),D.second=d.readUInt32LE(m+4+q),D.amount=d.readInt16LE(m+8+q),w[I]=D}return w}function readNameNT(d,m){for(var g=m;g<d.length&&d[g]!==0;g++);return d.slice(m,g)}function readStringNT(d,m){return readNameNT(d,m).toString("utf8")}getDefaultExportFromCjs(parseBmfontBinary);function e(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}const t=d=>{if(!d)return null;const m={};switch(d.type){case"ELEMENT":{let g={};const w=E(d.value.attributes),$=t(d.value.children);if(w&&(g=Object.assign(g,w)),$){const I=r(d.value.children);g=Object.assign(g,I)}m[d.value.type]=g;break}case"ATTRIBUTE":{const g=d.value;m[g.name]=g.value;break}case"CONTENT":return{content:d.value}}return m},r=d=>d&&Array.isArray(d)&&d.length!==0?n(d)?{content:d[0].value}:{children:d.map(t)}:null,n=d=>d&&Array.isArray(d)&&d.length===1&&d[0].type==="CONTENT",E=d=>d&&Array.isArray(d)?d.map(t).reduce(((m,g)=>Object.assign(m,g)),{}):null;var s={convert:d=>t(d.value.children[0])},a={Token:(d,m)=>({type:d,value:m}),TOKEN_TYPE:{OPEN_BRACKET:"OPEN_BRACKET",ELEMENT_TYPE:"ELEMENT_TYPE",CLOSE_ELEMENT:"CLOSE_ELEMENT",ATTRIB_NAME:"ATTRIB_NAME",ATTRIB_VALUE:"ATTRIB_VALUE",ASSIGN:"ASSIGN",CLOSE_BRACKET:"CLOSE_BRACKET",CONTENT:"CONTENT",EOF:"EOF"}};const{Token:T,TOKEN_TYPE:u}=a,c=T("EOF"),l=d=>d===" "||d===`
`||d==="\r"||d==="	",o=d=>d.replace(/'/g,'"');var N={createLexer:function(d){let m=null,g=(W=>{let V=0;for(;V<W.length&&l(W[V]);)V++;return((K,Z)=>{if(K.startsWith("<?xml",Z)){const Q=K.length;for(;Z<Q;)if(K[Z]!=="?")Z++;else{if(K[Z+1]===">")return Z+2;Z++}}return Z})(W,V)})(d),w=[];const $=()=>d[g],I=()=>m!==c&&g<d.length,D=W=>W==='"'||W==="'",q=()=>{for(;I()&&l(d[g]);)g++},j=W=>{if(I()){if(d[g]==="<"){let V="<";return g++,I()&&d[g]==="/"?(g++,V="</"):I()&&d[g]==="!"&&d[g+1]==="-"&&d[g+2]==="-"&&(g++,g++,g++,V="<!--"),V}if($()==="/"){let V="/";return g++,I()&&$()===">"&&(g++,V="/>"),V}if(d[g]==="="||d[g]===">"){const V=d[g];return g++,V}}return G(!!W)},G=W=>{const V=W?/[^>=<]/u:/[a-zA-Z0-9_:-]/;let K=g;for(;I()&&d[g].match(V);)g++;return o(d.substring(K,g))},H=()=>{const W=g;q();const V=g-W;if(I())if(m&&m.type===u.OPEN_BRACKET){q();const K=j(!1);m=T(u.ELEMENT_TYPE,K),w.push(K)}else if(m&&m.type===u.ASSIGN){I()&&D($())&&g++;let K=g;for(;I()&&!D($());)g++;const Z=o(d.substring(K,g));g++,m=T(u.ATTRIB_VALUE,Z)}else{q();let K=j(!0);switch(K){case"=":m=m.type===u.ATTRIB_NAME?T(u.ASSIGN):T(u.CONTENT,K);break;case"</":{const Z=g;for(;d[g]!==">";)g++;m=T(u.CLOSE_ELEMENT,d.substring(Z,g)),g++,w.pop();break}case"/>":{const Z=w.pop();m=T(u.CLOSE_ELEMENT,Z);break}case"<!--":{const Z=["!","-","-"];for(;I()&&(Z[2]!==">"||Z[1]!=="-"||Z[0]!=="-");)Z.shift(),Z.push(d[g]),g++;return H()}case">":m=T(u.CLOSE_BRACKET);break;case"<":m=T(u.OPEN_BRACKET);break;default:if(K&&K.length>0){if(m.type===u.CLOSE_BRACKET){let Z="";$()!=="<"&&(Z=G(!0)),m=T(u.CONTENT,K+Z)}else if(m.type!==u.ATTRIB_NAME&&m.type!==u.CONTENT)m.type===u.CLOSE_ELEMENT?(K=" ".repeat(V)+K,m=T(u.CONTENT,K)):m=T(u.ATTRIB_NAME,K);else{const Z=" ".repeat(V)+K;m=T(u.CONTENT,Z)}break}{const Z='Unknown Syntax : "'+d[g]+'"';throw new Error(Z)}}}else m=c;return m};return{peek:$,next:H,hasNext:I}}};const{createLexer:i}=N,{Token:p,TOKEN_TYPE:O}=a,[A,f,C,h]=["ROOT","ELEMENT","ATTRIBUTE","CONTENT"],_=(d,m)=>({type:d,value:m}),L=d=>_(h,d),y=(d,m,g)=>_(f,{type:d,attributes:m,children:g}),v=(d,m)=>_(C,{name:d,value:m}),S=(d,m)=>{const g=[];for(;d.hasNext();){const w=d.next();switch(w.type){case O.OPEN_BRACKET:{const $=d.next(),[I,D]=R(d);let q=[];D.type!==O.CLOSE_ELEMENT&&(q=S(d,$)),q&&q.length>0&&q[0].type===O.CONTENT&&(q=b(q)),g.push(y($.value,I,q));break}case O.CLOSE_ELEMENT:if(w.value===m.value)return g;break;case O.CONTENT:g.push(L(w.value));break;case O.EOF:return g;default:throw new Error(`Unknown Lexem type: ${w.type} "${w.value}, scoping element: ${m.value}"`)}}return g},R=d=>{const m=[];let g=d.peek();if(!d.hasNext()||g&&g.type===O.CLOSE_BRACKET||g&&g.type===O.CLOSE_ELEMENT)return[m,g];for(g=d.next();d.hasNext()&&g&&g.type!==O.CLOSE_BRACKET&&g.type!==O.CLOSE_ELEMENT;){const w=g;d.next();const $=d.next(),I=v(w.value,$.value);m.push(I),g=d.next()}return[m,g]};function b(d){let m=[],g="";return d.forEach((w=>{w.type===O.CONTENT?g+=w.value:(g.length&&(m.push(L(g)),g=""),m.push(w))})),g.length&&m.push(L(g)),m}var B={transpile:function(d,m){const g=(w=>_(A,{children:S(w,p(A,"ROOT"))}))(i(d));return m?m.convert(g):g}};const M=s,{transpile:x}=B;var k=e({convertXML:function(d,m){return x(d,m||M)},createAST:function(d){return x(d)}}),simpleXmlToJson_min=k,xmlPackage=getDefaultExportFromCjs(simpleXmlToJson_min);const{convertXML}=xmlPackage;createJimp({formats:[png]});Buffer.from([66,77,70,3]);var pixelmatch_1=pixelmatch;const defaultOptions={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffColorAlt:null,diffMask:!1};function pixelmatch(d,m,g,w,$,I){if(!isPixelData(d)||!isPixelData(m)||g&&!isPixelData(g))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(d.length!==m.length||g&&g.length!==d.length)throw new Error("Image sizes do not match.");if(d.length!==w*$*4)throw new Error("Image data size does not match width/height.");I=Object.assign({},defaultOptions,I);const D=w*$,q=new Uint32Array(d.buffer,d.byteOffset,D),j=new Uint32Array(m.buffer,m.byteOffset,D);let G=!0;for(let V=0;V<D;V++)if(q[V]!==j[V]){G=!1;break}if(G){if(g&&!I.diffMask)for(let V=0;V<D;V++)drawGrayPixel(d,4*V,I.alpha,g);return 0}const H=35215*I.threshold*I.threshold;let W=0;for(let V=0;V<$;V++)for(let K=0;K<w;K++){const Z=4*(V*w+K),Q=colorDelta(d,m,Z,Z);Math.abs(Q)>H?I.includeAA||!antialiased(d,K,V,w,$,m)&&!antialiased(m,K,V,w,$,d)?(g&&drawPixel(g,Z,...Q<0&&I.diffColorAlt||I.diffColor),W++):g&&!I.diffMask&&drawPixel(g,Z,...I.aaColor):g&&(I.diffMask||drawGrayPixel(d,Z,I.alpha,g))}return W}function isPixelData(d){return ArrayBuffer.isView(d)&&d.constructor.BYTES_PER_ELEMENT===1}function antialiased(d,m,g,w,$,I){const D=Math.max(m-1,0),q=Math.max(g-1,0),j=Math.min(m+1,w-1),G=Math.min(g+1,$-1),H=4*(g*w+m);let W,V,K,Z,Q=m===D||m===j||g===q||g===G?1:0,J=0,re=0;for(let se=D;se<=j;se++)for(let oe=q;oe<=G;oe++){if(se===m&&oe===g)continue;const ee=colorDelta(d,d,H,4*(oe*w+se),!0);if(ee===0){if(Q++,Q>2)return!1}else ee<J?(J=ee,W=se,V=oe):ee>re&&(re=ee,K=se,Z=oe)}return J!==0&&re!==0&&(hasManySiblings(d,W,V,w,$)&&hasManySiblings(I,W,V,w,$)||hasManySiblings(d,K,Z,w,$)&&hasManySiblings(I,K,Z,w,$))}function hasManySiblings(d,m,g,w,$){const I=Math.max(m-1,0),D=Math.max(g-1,0),q=Math.min(m+1,w-1),j=Math.min(g+1,$-1),G=4*(g*w+m);let H=m===I||m===q||g===D||g===j?1:0;for(let W=I;W<=q;W++)for(let V=D;V<=j;V++){if(W===m&&V===g)continue;const K=4*(V*w+W);if(d[G]===d[K]&&d[G+1]===d[K+1]&&d[G+2]===d[K+2]&&d[G+3]===d[K+3]&&H++,H>2)return!0}return!1}function colorDelta(d,m,g,w,$){let I=d[g+0],D=d[g+1],q=d[g+2],j=d[g+3],G=m[w+0],H=m[w+1],W=m[w+2],V=m[w+3];if(j===V&&I===G&&D===H&&q===W)return 0;j<255&&(j/=255,I=blend(I,j),D=blend(D,j),q=blend(q,j)),V<255&&(V/=255,G=blend(G,V),H=blend(H,V),W=blend(W,V));const K=rgb2y(I,D,q),Z=rgb2y(G,H,W),Q=K-Z;if($)return Q;const J=rgb2i(I,D,q)-rgb2i(G,H,W),re=rgb2q(I,D,q)-rgb2q(G,H,W),se=.5053*Q*Q+.299*J*J+.1957*re*re;return K>Z?-se:se}function rgb2y(d,m,g){return .29889531*d+.58662247*m+.11448223*g}function rgb2i(d,m,g){return .59597799*d-.2741761*m-.32180189*g}function rgb2q(d,m,g){return .21147017*d-.52261711*m+.31114694*g}function blend(d,m){return 255+(d-255)*m}function drawPixel(d,m,g,w,$){d[m+0]=g,d[m+1]=w,d[m+2]=$,d[m+3]=255}function drawGrayPixel(d,m,g,w){const $=blend(rgb2y(d[m+0],d[m+1],d[m+2]),g*d[m+3]/255);drawPixel(w,m,$,$,$)}getDefaultExportFromCjs(pixelmatch_1);const defaultPlugins=[methods$h,methods$g,methods$f,methods$e,methods$c,methods$a,methods$b,methods$9,methods$8,methods$7,methods$6,methods$5,methods$4,methods$3,methods$d,methods$2,methods$1,methods],defaultFormats=[bmp,msBmp,gif,jpeg$2,png,tiff];bmp().mime,gif().mime,jpeg$2().mime,png().mime,tiff().mime;const Jimp=createJimp({formats:defaultFormats,plugins:defaultPlugins}),imageLimits={maxMemoryUsageInMB:1024,maxResolutionInMP:100};async function preprocessTensor(d,m,g,w,$){const{width:I,height:D,normalized:q}=d.input;let j=m;return j=await normalizeTensor(j,g,w,!q,$),j=await resizeTensor(j,I,D,$),j}async function loadToTensor(d,{width:m,height:g,crop:w,normalized:$,abortSignal:I}){var D=new Float32Array(g*m*3*d.length);for(let G=0;G<d.length;G++){I?.throwIfAborted();let H=d[G];const W=await Jimp.fromBuffer(H,{"image/jpeg":imageLimits});if(w){const se=coordsScaler({x:W.width,y:W.height}),{x:oe,y:ee,height:ae,width:ce}=toTopLeftCoords(se(w));I?.throwIfAborted(),W.crop({x:oe,y:ee,w:ce,h:ae})}I?.throwIfAborted(),W.resize({w:m,h:g});var q=W.bitmap.data;const[V,K,Z]=new Array(new Array,new Array,new Array);for(let se=0;se<q.length;se+=4)I?.throwIfAborted(),V.push(q[se]),K.push(q[se+1]),Z.push(q[se+2]);const Q=V.concat(K).concat(Z);let J,re=Q.length;if($)for(J=0;J<re;J++)I?.throwIfAborted(),D[G*re+J]=Q[J]/255}I?.throwIfAborted();var j=new He("float32",D,[d.length,3,g,m]);return D=new Float32Array(0),j}async function normalizeTensor(d,m,g,w=!1,$){$?.throwIfAborted();const I=await d.getData(),D=d.dims;for(let j=0;j<D[2];j++)for(let G=0;G<D[3];G++)for(let H=0;H<D[1];H++){$?.throwIfAborted();let W=H*D[2]*D[3]+j*D[3]+G;I[W]=(I[W]-m[H])/g[H],w&&(I[W]=Math.min(I[W]*255,255))}$?.throwIfAborted();const q=new He(d.type,I,D);return d.dispose(),q}function output2BB(d,m,g,w,$){let I=[],D=[];const q=d.length;let j=m.length/q;for(let G=0;G<g;G++){let H=[],W=[],V=m.slice(G*j*q,(G+1)*j*q);for(let K=0;K<V.length;K+=q){$?.throwIfAborted();const Z=ee=>d.includes(ee)?V[K+d.indexOf(ee)]:void 0,Q={sx:Z("sx"),sy:Z("sy"),ex:Z("ex"),ey:Z("ey"),cx:Z("cx"),cy:Z("cy"),w:Z("w"),h:Z("h"),score:Z("score")},[J,re]=match$1.case({cx:"number",ex:"number"},({cx:ee,ex:ae})=>[ee,2*(ae-ee)]).case({cx:"number",sx:"number"},({sx:ee,cx:ae})=>[ae,2*(ae-ee)]).case({cx:"number",w:"number"},({cx:ee,w:ae})=>[ee,ae]).case({ex:"number",sx:"number"},({sx:ee,ex:ae})=>[(ee+ae)/2,ae-ee]).case({ex:"number",w:"number"},({ex:ee,w:ae})=>[ee-ae/2,ae]).case({sx:"number",w:"number"},({sx:ee,w:ae})=>[ee+ae/2,ae]).default(()=>{throw new Error(`Could not get center point x coord and width. Check your protocol's inference.detection.output.shape. Available atoms: ${JSON.stringify(Q)}`)})(Q),[se,oe]=match$1.case({cy:"number",ey:"number"},({cy:ee,ey:ae})=>[ee,2*(ae-ee)]).case({cy:"number",sy:"number"},({sy:ee,cy:ae})=>[ae,2*(ae-ee)]).case({cy:"number",h:"number"},({cy:ee,h:ae})=>[ee,ae]).case({ey:"number",sy:"number"},({sy:ee,ey:ae})=>[(ee+ae)/2,ae-ee]).case({ey:"number",h:"number"},({ey:ee,h:ae})=>[ee-ae/2,ae]).case({sy:"number",h:"number"},({sy:ee,h:ae})=>[ee+ae/2,ae]).default(()=>{throw new Error(`Could not get center point y coord and height. Check your protocol's inference.detection.output.shape. Available atoms: ${JSON.stringify(Q)}`)})(Q);if(J==0&&se==0&&re==0&&oe==0)break;if(Q.score===void 0)throw new Error("Could not get score. Check your protocol's inference.detection.output.shape.");Q.score>w&&(H.push([J,se,re,oe]),W.push(Q.score))}I.push(H),D.push(W)}return[I,D]}async function resizeTensor(d,m,g,w){w?.throwIfAborted();const $=await d.getData(),I=d.dims,D=new Float32Array(g*m*3),q=[1,3,g,m],j=I[3]/m,G=I[2]/g;for(let W=0;W<m;W++)for(let V=0;V<g;V++)for(let K=0;K<3;K++){w?.throwIfAborted();const Z=K*g*m+V*m+W,Q=K*I[2]*I[3]+Math.floor(V*G)*I[3]+Math.floor(W*j);D[Z]=$[Q]}return w?.throwIfAborted(),new He(d.type,D,q)}be.wasm.numThreads=1;be.wasm.wasmPaths={"ort-wasm-simd-threaded.wasm":"/ort-wasm-simd-threaded.wasm"};const TARGETWIDTH=640,TARGETHEIGHT=640,NUMCONF=.437,STD=[.229,.224,.225],MEAN=[.485,.456,.406];async function loadModel(d,m=!1,g){g??=()=>{};const w=await fetchHttpRequest(d,{cacheAs:"model",onProgress:g}).then(I=>I.arrayBuffer()).then(I=>new Uint8Array(I)),$=Fp.create(w,{executionProviders:m?["webgpu"]:[]});if(!$)throw new Error("Impossible de charger le modÃ¨le ONNX");return $}async function infer({abortSignal:d,...m},g,w,$,I=!1,D=!0){if(D&&console.warn("webgpu not implemented yet, using wasm"),!w)throw new Error("Model not loaded");let q=-1;I||(q=Date.now()),m={...m,input:{width:TARGETWIDTH,height:TARGETHEIGHT,name:w.inputNames[0],normalized:!0,...m?.input},output:{name:"output0",...m?.output}};let j;j=await loadToTensor(g,{...m.input,abortSignal:d});const G=await w.run({[m.input.name]:j}),H=output2BB(m.output.shape,G[m.output.name].data,g.length,NUMCONF,d),[W,V]=H;return[W,V,q,j]}async function classify(d,m,g,w){const $=d.input.name??g.inputNames[0],I=await preprocessTensor(d,m,MEAN,STD,w),D=await g.run({[$]:I});w?.throwIfAborted();const q=await D[Object.keys(D)[0]].getData(!0).then(j=>[...j.values()]);return m.dispose(),q}const centeredBoundingBox=type({x:"number",y:"number",w:"number",h:"number"}),topLeftBoundingBox=type({x:"number",y:"number",width:"number",height:"number"});type({x:"number > 0",y:"number > 0",width:"number > 0",height:"number > 0"});type.or(centeredBoundingBox,topLeftBoundingBox);function coordsScaler({x:d,y:m}){return({x:g,y:w,...$})=>{const[I,D]=[g*d,w*m];return"width"in $&&"height"in $?{x:I,y:D,width:$.width*d,height:$.height*m}:"w"in $&&"h"in $?{x:I,y:D,w:$.w*d,h:$.h*m}:{x:I,y:D,...$}}}function toTopLeftCoords({x:d,y:m,w:g,h:w}){return{x:d-g/2,y:m-w/2,width:g,height:w}}async function cropImage(d,m,g,w="0px"){const $=await createImageBitmap(new Blob([d],{type:m})),I=coordsScaler({x:$.width,y:$.height})(toTopLeftCoords(g)),{inPixels:D}=parseCropPadding(w),q={x:D($.width),y:D($.height)};try{const j=await createImageBitmap($,clamp(I.x-q.x,0,$.width),clamp(I.y-q.y,0,$.height),clamp(I.width+2*q.x,1,$.width),clamp(I.height+2*q.y,1,$.height)),G=new OffscreenCanvas(j.width,j.height);return G.getContext("2d")?.drawImage(j,0,0),{cropped:await G.convertToBlob({type:["image/png","image/jpeg"].includes(m)?m:"image/png"}).then(W=>W.arrayBuffer()),original:d}}catch(j){throw new Error(`Couldn't crop with ${JSON.stringify({boundingBox:I,padding:w})}: ${j}`,{cause:j})}finally{$.close()}}function parseCropPadding(d){const m=d.match(/(\d+)(px|%)/);if(!m)throw new Error(`Invalid crop padding: ${d}`);const[g,w]=[Number.parseInt(m[1],10),m[2]];return{withUnit:d,unitless:g,unit:w,inPixels:$=>w==="px"?g:Math.round($*g/100)}}const MetadataRecord=type({"[string]":{value:[type.or("null",MetadataRuntimeValue.boolean,MetadataRuntimeValue.integer,MetadataRuntimeValue.float,MetadataRuntimeValue.string,"string.date.iso",MetadataRuntimeValue.location,MetadataRuntimeValue.boundingbox),"@","Valeur de la mÃ©tadonnÃ©e"],"valueLabel?":["string","@","Label de la valeur de la mÃ©tadonnÃ©e. Existe pour les mÃ©tadonnÃ©es de type enum, contient dans ce cas le label associÃ© Ã  la clÃ© de l'option de l'enum choisie"],confidence:["number","@","Confiance dans la valeur de la mÃ©tadonnÃ©e, entre 0 et 1"],manuallyModified:["boolean","@","La valeur de la mÃ©tadonnÃ©e a Ã©tÃ© modifiÃ©e manuellement"],alternatives:type({"[string]":["number","@","Confiance dans cette valeur alternative de la mÃ©tadonnÃ©e, entre 0 et 1."]}).describe("Autres valeurs possibles. Les clÃ©s de l'objet sont les autres valeurs possibles pour cette mÃ©tadonnÃ©e (converties en texte via JSON), les valeurs de l'objet sont les confiances associÃ©es Ã  ces alternatives.")}}),Analysis=type({observations:type({"[string]":{label:["string","@","Label de l'observation"],images:type({id:["string","@","ID de l'image"],filename:["string","@","Nom du fichier utilisÃ© pour cette image"],contentType:["string","@","Type de contenu de l'image, au format MIME (exemple: image/jpeg)"],sequence:["number","@","NumÃ©ro de sÃ©quence de l'image dans l'archive .zip. Unique Ã  l'entiÃ¨retÃ© de l'export"],metadata:MetadataRecord,exportedAs:type({original:["string","@","Chemin vers l'image originale"],cropped:["string","@","Chemin vers l'image recadrÃ©e"]}).describe("Chemins dans l'archive .zip vers l'image exportÃ©e")}).array(),metadata:MetadataRecord,protocolMetadata:MetadataRecord.describe("MÃ©tadonnÃ©es dÃ©finies par le protocole. Les clÃ©s de l'objet sont les identifiants des mÃ©tadonnÃ©es, sans le prÃ©fixe qui identifie leur protocole de provenance")}}).describe("Associe l'ID d'une observation Ã  son label et les valeurs de ses mÃ©tadonnÃ©es"),protocol:Protocol$1.describe("Le protocole utilisÃ© pour cette session d'analyse")});function toMetadataRecord(d){return mapValues(d,({value:m,...g})=>({value:m instanceof Date?m.toISOString():m,...g}))}function toCSV(d,m,g=";"){const w=$=>`"${$?.replace(/"/g,'""')??""}"`;return[d.map(w).join(g),...m.map($=>d.map(I=>w($[I])).join(g))].join(`
`)}swarp.generateResultsZip(async({protocolId:d,include:m,cropPadding:g,jsonSchemaURL:w},$)=>{const I=await openDatabase$1(),D=await I.get("Protocol",d).then(Schemas.Protocol.assert);if(!D)throw new Error(`Protocol with ID ${d} not found`);const q=D.exports??{images:{cropped:FilepathTemplate.assert("cropped/{{sequence}}.{{extension image.filename}}"),original:FilepathTemplate.assert("original/{{sequence}}.{{extension image.filename}}")},metadata:{json:"analysis.json",csv:"metadata.csv"}},j=await I.getAll("Observation"),G=await I.getAll("Image"),H=await I.getAll("Metadata").then(oe=>Object.fromEntries(oe.map(ee=>[ee.id,ee]))),W=await I.getAll("MetadataOption").then(oe=>{const ee={};for(const ae of oe)ee[ae.metadataId]||(ee[ae.metadataId]=[]),ee[ae.metadataId].push(ae);return ee});let V={},K=1;j.sort(compareBy(oe=>oe.label+oe.id));for(const{id:oe,label:ee,images:ae,metadataOverrides:ce}of j){const le=await observationMetadata(I,{images:ae,metadataOverrides:MetadataValues.assert(ce)}).then(de=>addValueLabels(de,W));V[oe]={label:ee,metadata:toMetadataRecord(le),protocolMetadata:toMetadataRecord(protocolMetadataValues(D,le)),images:[]};for(const de of ae.sort()){if(!G.some(Ge=>Ge.id===de))continue;const _e=Schemas.Image.assert(G.find(Ge=>Ge.id===de)),we=await addValueLabels(_e.metadata,W),pe={..._e,metadata:toMetadataRecord(we),protocolMetadata:toMetadataRecord(protocolMetadataValues(D,we))},xe={observation:V[oe],image:pe,sequence:K};V[oe].images.push({...pe,sequence:K,exportedAs:{original:q.images.original.render(xe),cropped:q.images.cropped.render(xe)}}),K++}}const Z=[...new Set(j.flatMap(oe=>Object.keys(V[oe.id].metadata)))];let Q=[],J=1,re=0;if(m!=="metadataonly"){J+=j.flatMap(oe=>oe.images).length;for(const[oe,ee]of j.flatMap(ae=>ae.images.map(ce=>[ae,ce]))){const ae=G.find(Ce=>Ce.id===ee);if(!ae)continue;const ce=MetadataValues.assert({...ae.metadata,...oe.metadataOverrides}),{contentType:le,filename:de}=Schemas.Image.assert(ae),_e=ce[D.crop?.metadata??"crop"]?.value;if(!ae.fileId)continue;const we=await I.get("ImageFile",ae.fileId);if(!we)continue;const{cropped:pe,original:xe}=_e?await cropImage(we.bytes,le,_e,g):{cropped:we.bytes,original:we.bytes};let Ge,Te;try{le==="image/jpeg"?Te=addExifMetadata(pe,Object.values(H),ce):Te=new Uint8Array(pe),m==="full"&&(le==="image/jpeg"?Ge=addExifMetadata(xe,Object.values(H),ce):Ge=new Uint8Array(xe))}catch(Ce){console.error(Ce),$({warning:["exif-write-error",{filename:we.filename}]}),Ge=new Uint8Array(xe),Te=new Uint8Array(pe)}Q.push({imageId:ee,croppedBytes:Te,originalBytes:Ge,contentType:le,filename:de}),re++,$({progress:re/J})}}const se=await new Promise((oe,ee)=>zip({[q.metadata.json]:strToU8(stringifyWithToplevelOrdering("json",w.toString(),Analysis.assert({observations:V,protocol:{...D,exports:{...D.exports,images:{original:q.images.original.toJSON(),cropped:q.images.cropped.toJSON()}}}}),["protocol","observations"])),[q.metadata.csv]:strToU8(toCSV(["Identifiant","Observation",...Z.filter(ae=>!!H[ae]?.label).flatMap(ae=>[metadataPrettyKey(H[ae]),`${metadataPrettyKey(H[ae])}: Confiance`])],j.map(ae=>({Identifiant:ae.id,Observation:ae.label,...Object.fromEntries(Object.entries(V[ae.id].metadata).flatMap(([ce,{value:le,confidence:de,valueLabel:_e}])=>[[metadataPrettyKey(H[ce]),metadataPrettyValue("en",H[ce],le,_e)],[`${metadataPrettyKey(H[ce])}: Confiance`,de.toString()]]))})))),...m==="metadataonly"?{}:Object.fromEntries(Object.values(V).flatMap(({images:ae})=>ae).flatMap(({exportedAs:ae,id:ce})=>{const le=Q.find(de=>de.imageId===ce);return le?[[ae.cropped,[le.croppedBytes,{level:0}]],[ae.original,[le.originalBytes,{level:0}]]].filter(([,[de]])=>de!==void 0):[]}))},{comment:`Generated by C.i.g.a.l.e on ${new Date().toISOString()}`},(ae,ce)=>{ae&&ee(ae),oe(ce)}));return $({progress:1}),se.buffer});let inferenceSessions=new Map;swarp.loadModel(async({task:d,request:m,classmapping:g,protocolId:w,webgpu:$},I)=>{const D=progressSplitter("model",.9,"classmapping");function q(W,V){return typeof V=="string"?V:[W,V.method,V.url,Object.entries(V.headers).sort(([K],[Z])=>K.localeCompare(Z)).map(([K,Z])=>`${K}:${Z}`)].join("|")}const j=q(w,m),G=inferenceSessions.get(d);if(G&&G.id===j)return console.debug(`Model ${d} already loaded with ID ${j}`),!0;console.debug(`Loading model for task ${d} with ID ${j}`);const H={id:j,onnx:await loadModel(m,$,({transferred:W,total:V})=>{I(D("model",W/V))})};return g&&(H.classmapping=await fetchHttpRequest(g,{cacheAs:"model",onProgress({transferred:W,total:V}){I(D("classmapping",W/V))}}).then(W=>W.text()).then(W=>W.split(/\r?\n/).filter(Boolean))),console.debug(`Model ${d} loaded successfully with ID ${j}`),inferenceSessions.set(d,H),!0});swarp.isModelLoaded(async d=>inferenceSessions.has(d));swarp.inferBoundingBoxes(async({fileId:d,taskSettings:m},g,w)=>{const $=inferenceSessions.get("detection")?.onnx;if(!$)throw new Error("ModÃ¨le de dÃ©tection non chargÃ©");const I=await openDatabase$1();w.abortSignal?.throwIfAborted();const D=await I.get("ImageFile",d);if(!D)throw new Error(`Fichier avec l'ID ${d} non trouvÃ©`);const[[q],[j]]=await infer({...m,abortSignal:w.abortSignal},[D.bytes],$);return{boxes:q,scores:j}});swarp.classify(async({imageId:d,metadataIds:m,taskSettings:g},w,$)=>{$.abortSignal?.throwIfAborted();const I=await openDatabase$1(),D=Schemas.Image.assert(await I.get("Image",d));$.abortSignal?.throwIfAborted();const q=inferenceSessions.get("classification");if(!q)return{scores:[]};const{classmapping:j,onnx:G}=q;if(!j)throw new Error("Le modÃ¨le de classification n'a pas de classmapping associÃ©");if($.abortSignal?.throwIfAborted(),!D.fileId)throw new Error(`Image ${d} has no ImageFile`);const H=await I.get("ImageFile",D.fileId);if(!H)throw new Error(`Fichier avec l'ID ${D.fileId} non trouvÃ©`);const W=D.metadata[m.cropbox]?.value??{x:.5,y:.5,w:1,h:1};console.debug("Classifying image",D.id,"with cropbox",W);const V=await loadToTensor([H.bytes],{...g.input,normalized:!0,crop:W,abortSignal:$.abortSignal}),K=await classify(g,V,G,$.abortSignal);$.abortSignal?.throwIfAborted();const Z=K.map((Q,J)=>({confidence:Q,value:j[J]})).sort((Q,J)=>J.confidence-Q.confidence).slice(0,100);if($.abortSignal?.throwIfAborted(),Z.length){const[Q,...J]=Z,re={subjectId:d,...Q,alternatives:J};await storeMetadataValue({db:I,...re,metadataId:m.target,abortSignal:$.abortSignal})}else throw new Error("No species detected");return{scores:K}});const richTypes={Date:!0,RegExp:!0,String:!0,Number:!0};function diff(d,m,g={cyclesFix:!0},w=[]){let $=[];const I=Array.isArray(d);for(const q in d){const j=d[q],G=I?+q:q;if(!(q in m)){$.push({type:"REMOVE",path:[G],oldValue:d[q]});continue}const H=m[q],W=typeof j=="object"&&typeof H=="object"&&Array.isArray(j)===Array.isArray(H);j&&H&&W&&!richTypes[Object.getPrototypeOf(j)?.constructor?.name]&&(!g.cyclesFix||!w.includes(j))?$.push.apply($,diff(j,H,g,g.cyclesFix?w.concat([j]):[]).map(V=>(V.path.unshift(G),V))):j!==H&&!(Number.isNaN(j)&&Number.isNaN(H))&&!(W&&(isNaN(j)?j+""==H+"":+j==+H))&&$.push({path:[G],type:"CHANGE",value:H,oldValue:j})}const D=Array.isArray(m);for(const q in m)q in d||$.push({type:"CREATE",path:[D?+q:q],value:m[q]});return $}async function toExportedProtocol(d,m){const g=await d.getAll("MetadataOption",metadataOptionsKeyRange(m.id,null));return ExportedProtocol.assert({...omit(m,"dirty"),exports:{...m.exports,...m.exports?{images:{cropped:m.exports.images.cropped.toJSON(),original:m.exports.images.original.toJSON()}}:{}},metadata:Object.fromEntries(await d.getAll("Metadata").then(w=>w.filter($=>m.metadata.includes($.id)).map($=>[$.id,{...omit($,"id"),options:g.filter(({id:I})=>metadataOptionsKeyRange(m.id,$.id).includes(I)).map(I=>omit(I,"id","metadataId"))}])))})}async function compareProtocolWithUpstream(d,m,{onProgress:g}={}){const w=await d.get("Protocol",m).then(Protocol$1.assert);if(await g?.(0),!w?.source)return[];const[$,I]=await Promise.all([fetchHttpRequest(w.source).then(Q=>Q.json()).then(Q=>ExportedProtocol(Q)),toExportedProtocol(d,w)]);if($ instanceof ArkErrors)return console.warn("Remote protocol is invalid",$),[];const D=new Set([...keys($.metadata),...keys(I.metadata)]),q=sum([...D].map(Q=>{const J=I.metadata[Q],re=$.metadata[Q];if(!J||!re)return 0;const se=J.options?.map(ee=>ee.key)??[],oe=re.options?.map(ee=>ee.key)??[];return new Set([...se,...oe]).size}));let j=0;const G={fetchAndConvert:250,microdiff:25,options:q,postProcess:2},H=async(Q=1)=>{j+=Q,g?.(j/sum(Object.values(G)))};await H(G.fetchAndConvert);const W={description:"",key:"",label:"",__deleted:!0};for(const Q of D){if(!$.metadata[Q]||!I.metadata[Q])continue;const J=$.metadata[Q].options??[],re=[],se=I.metadata[Q].options??[],oe=[],ee=[...new Set([...J.map(ae=>ae.key),...se.map(ae=>ae.key)])].sort();for(const ae of ee){const ce=J.find(de=>de.key===ae),le=se.find(de=>de.key===ae);oe.push(le??W),re.push(ce??W),await H()}$.metadata[Q].options=re,I.metadata[Q].options=oe}const V=diff($,I,{cyclesFix:!0});await H(G.microdiff);let K=structuredClone(V);const Z=(Q,J)=>Q.length>=J.length&&range(0,J.length).every(re=>Q[re]===J[re]);for(const{path:Q,type:J}of V){const re=Q.at(-1),se=Q.slice(0,-1);if(re==="__deleted"){if(J==="CREATE"){const oe=se;K=K.filter(ee=>!Z(ee.path,oe)),K.push({type:"REMOVE",path:[...se],oldValue:fromEntries(V.filter(ee=>Z(ee.path,oe)).filter(ee=>ee.path.at(-1)!=="__deleted").map(ee=>[ee.path.at(-1)?.toString()??"",ee.oldValue]))})}else if(J==="REMOVE"){const oe=se;K=K.filter(ee=>!Z(ee.path,oe)),K.push({type:"CREATE",path:[...se],value:fromEntries(V.filter(ee=>Z(ee.path,oe)).filter(ee=>ee.path.at(-1)!=="__deleted").map(ee=>[ee.path.at(-1)?.toString()??"",ee.value]))})}}}return await H(G.postProcess),K}swarp.importProtocol(async({contents:d,isJSON:m},g)=>{const w=(G,H)=>{g(H?{phase:G,detail:H}:{phase:G})};w("parsing"),console.time("Parsing protocol");let $=m?JSON.parse(d):YAML.parse(d);console.timeEnd("Parsing protocol"),console.info(`Importing protocol ${$.id}`),console.info($),w("input-validation"),console.time("Validating protocol");const I=ExportedProtocol.assert($);console.timeEnd("Validating protocol");const q=(await openDatabase$1()).transaction(["Protocol","Metadata","MetadataOption"],"readwrite");w("write-protocol"),console.time("Storing Protocol"),q.objectStore("Protocol").put({...I,metadata:Object.keys(I.metadata)}),console.timeEnd("Storing Protocol");for(const[G,H]of Object.entries(I.metadata)){if(typeof H=="string")continue;w("write-metadata",H.label||G),console.time(`Storing Metadata ${G}`),q.objectStore("Metadata").put({id:G,...omit(H,"options")}),console.timeEnd(`Storing Metadata ${G}`),console.time(`Storing Metadata Options for ${G}`);const W=H.options?.length??0;let V=0;for(const K of H.options??[])V++,V%1e3===0&&w("write-metadata-options",`${H.label||G} > ${K.label||K.key} (${V}/${W})`),q.objectStore("MetadataOption").put({id:metadataOptionId(namespacedMetadataId(I.id,G),K.key),metadataId:namespacedMetadataId(I.id,G),...K});console.timeEnd(`Storing Metadata Options for ${G}`)}w("output-validation"),console.time("Validating protocol after storing");const j=ExportedProtocol.assert(I);return console.timeEnd("Validating protocol after storing"),pick(j,"id","name","version")});swarp.diffProtocolWithRemote(async({protocolId:d},m)=>{const g=await openDatabase$1(),w=await g.get("Protocol",d);if(!w)throw new Error(`Protocol with ID ${d} not found`);const $=await compareProtocolWithUpstream(g,d,{onProgress:m});return w.dirty=$.length>0,await g.put("Protocol",w),{dirty:w.dirty,changes:$}});swarp.start();
