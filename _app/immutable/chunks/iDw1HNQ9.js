import{o as p,a as h}from"./BXq8bD8b.js";import{s as i}from"./CuKI1hs9.js";import{C as f,x as l,f as r}from"./Don2Ydo1.js";import{c as s}from"./Bd7_h5c3.js";import{u as n}from"./BPJfxdhi.js";import{g}from"./08d27X49.js";const m={general:"Général",observations:"Observations",navigation:"Navigation",cropping:"Recadrage",debugmode:"Debug mode",classification:"Classification"};function u(a,e){p(()=>{for(const[t,o]of f(e)){if(t in n.keybinds){console.warn(`Keybind ${t} already defined, not overriding.`);continue}n.keybinds[t]={group:m[o.debug?"debugmode":a],...o}}}),h(()=>{for(const t of l(e))delete n.keybinds[t]})}const d={"crop/box/create":r({imageId:"string",box:s}),"crop/box/delete":r({imageId:"string",box:s}),"crop/box/edit":r({imageId:"string",before:s,after:s}),"classify/enum/edit":r({observationId:"string",metadataId:"string",before:{key:"string"},after:{key:"string"}})},b={"crop/box/create":a=>({op:"crop/box/delete",data:a}),"crop/box/delete":a=>({op:"crop/box/create",data:a}),"crop/box/edit":({imageId:a,before:e,after:t})=>({op:"crop/box/edit",data:{imageId:a,before:t,after:e}}),"classify/enum/edit":({observationId:a,metadataId:e,before:t,after:o})=>({op:"classify/enum/edit",data:{observationId:a,metadataId:e,before:o,after:t}})};class y{stack=[];graveyard=[];handlers={};depth=100;#e({data:e,op:t}){const o=this.handlers[t];if(!o)throw new Error(`No handler for undo operation ${t}`);return o(i(e))}push(e,t){const o=i(t);if(!d[e].allows(o)){console.error("Invalid undo operation data",{op:e,data:o},d[e](o));return}this.graveyard=[],this.stack.push({op:e,data:o}),this.stack.length>this.depth&&this.stack.shift()}pop(){const e=this.stack.pop();if(!e){console.warn("Undo stack is empty");return}return this.graveyard.push(e),this.#e(e)}rewind(){const e=this.graveyard.pop();if(!e){console.warn("Redo stack is empty");return}const{op:t,data:o}=e;return this.#e(b[t](o))}clear(){this.stack=[],this.graveyard=[]}on(e,t){p(()=>{this.handlers[e]=t}),h(()=>{delete this.handlers[e]})}initialize(e){this.stack=[],this.graveyard=[],this.depth=e,this.handlers={};const t=g("main");u("general",{"$mod+z":{help:t(30),do:async()=>c.pop()},"$mod+Shift+z":{help:t(358),do:async()=>c.rewind()}})}}const c=new y;export{u as d,c as u};
