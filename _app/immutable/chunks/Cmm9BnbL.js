import"./DsnmJJEf.js";import{p as I,b as M,g as t,u as r}from"./BwdvgNQo.js";import{p as C,s as O,r as S}from"./CKH9F0ww.js";import{t as k}from"./Bd7_h5c3.js";import{C as p}from"./CUiAmgj5.js";import{a as x,t as _}from"./Don2Ydo1.js";import{i as j}from"./CEoeiZ5P.js";import{u as a}from"./BPJfxdhi.js";function E(f,e){I(e,!0);const h=C(e,"highlighted",3,!1),b=S(e,["$$slots","$$events","$$legacy","observation","images","highlighted"]),d=r(()=>e.images.flatMap(({metadataErrors:i,id:u})=>{const n=a.erroredImages.get(u);return n?[n]:Object.entries(i).flatMap(([o,s])=>{const v=_.Metadata.getFromState(o);return s.map(m=>`${m.kind} sur ${v?.label||o}: ${m.message}`)})})),l=r(()=>e.images.some(({id:i})=>a.queuedImages.has(i))?"queued":e.images.some(({id:i})=>a.loadingImages.has(i))?"loading":t(d).length>0?"errored":"ok"),c=r(()=>{if(t(l)==="errored")return t(d).join(`
`);if(j())return`${e.observation.id} @ ${e.observation.addedAt.toISOString()} [${e.observation.sessionId}]`}),g=r(()=>e.images.length>0?e.images[0]:void 0);{let i=r(()=>t(g)?.fileId?a.getPreviewURL(t(g).fileId):void 0),u=r(()=>t(g)?.dimensions),n=r(()=>a.selection.includes(e.observation.id)),o=r(()=>e.images.map(s=>a.cropMetadataValueOf(s)?.value).filter(x).map(s=>k(s)));p(f,O({get id(){return e.observation.id},get title(){return e.observation.label},get image(){return t(i)},get dimensions(){return t(u)},get selected(){return t(n)},get stacksize(){return e.observation.images.length},boxes:"apply-first",get tooltip(){return t(c)},get status(){return t(l)},get highlighted(){return h()}},()=>b,{get boundingBoxes(){return t(o)}}))}M()}export{E as C};
