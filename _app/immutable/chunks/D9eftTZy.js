import{i as M,f as l,a5 as h,L as g,x as T,a6 as O,m as w,t as b,I as N,a7 as $,l as S,a8 as E,c as s}from"./Don2Ydo1.js";import{s as I}from"./BeqcFVE5.js";import{c as C}from"./ilbmOuwU.js";import{m as x}from"./BhEwWWID.js";import{a as V}from"./CEoeiZ5P.js";function k(e,o){return M(e,o?.in).getFullYear()}function A(e,{language:o,type:r,valueLabel:c,boundingBoxPrecision:a=2}){if(e===null)return"";switch(r){case"boolean":switch(o){case"fr":return e?"Oui":"Non";default:return e?"Yes":"No"}case"date":return e instanceof Date?g(e,"Ppp"):e.toString();case"enum":return c||e.toString();case"location":{const{latitude:t,longitude:n}=l({latitude:"number",longitude:"number"}).assert(e);return`${t}, ${n}`}case"boundingbox":{const{x:t,y:n,w:d,h:i}=l({x:"number",y:"number",h:"number",w:"number"}).assert(e),u=m=>a==="unbounded"?m.toString():h(m,a),f=(m,D)=>`(${u(m)}, ${u(D)})`,p=f(t,n),y=f(t+d,n+i);switch(o){case"fr":return`Boîte de ${p} à ${y}`;default:return`Box from ${p} to ${y}`}}case"float":case"integer":return Intl.NumberFormat(o).format(l("number").assert(e));default:return e.toString()}}function B({language:e,type:o,options:r=[],tolerances:c}){const a=c?{giga:-9,mega:-6,kilo:-3,hecto:-2,deca:-1,unit:0,deci:1,centi:2,milli:3,micro:6,nano:9}[c.decimal]:void 0,t=d=>h(d,a),n=d=>A(d,{type:o,language:e,valueLabel:r.find(i=>i.key===d?.toString())?.label,boundingBoxPrecision:a});return d=>I(o,d,{boolean:n,string:n,enum:n,integer:i=>n(t(i)),float:i=>n(t(i)),boundingbox:i=>n(w(i,t)),location:i=>n(w(i,t)),date:i=>{switch(c?.dates){case"year":return`Année ${k(i)}`;case"month":return g(i,"MMMM yyyy");case"day":return new Intl.DateTimeFormat(e,{dateStyle:"long"}).format(i);case"hour":return new Intl.DateTimeFormat(e,{year:"numeric",month:"long",day:"numeric",hour:"numeric"}).format(i);case"minute":return new Intl.DateTimeFormat(e,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).format(i);default:throw new Error(`Invalid date tolerance: ${c?.dates} (expected ${T(O.dates).join(", ")})`)}}})}function F({type:e,options:o=[]}){return(r,c)=>I(e,[r,c],{boolean:(a,t)=>Number(a)-Number(t),integer:(a,t)=>a-t,float:(a,t)=>a-t,date:(a,t)=>C(new Date(a),new Date(t)),string:(a,t)=>a.localeCompare(t),location:(a,t)=>a.latitude-t.latitude||a.longitude-t.longitude,boundingbox:(a,t)=>a.x-t.x||a.y-t.y||a.w-t.w||a.h-t.h,enum:(a,t)=>{const n=o.find(i=>i.key===a),d=o.find(i=>i.key===t);return n?.index!==void 0&&d?.index!==void 0?n.index-d.index:n?-1:d?1:a.toString().localeCompare(t.toString())}})}function v({metadata:e,options:o=[]}){const r=F({type:e.type,options:o});return(c,a)=>{const t=c.metadata[e.id]?.value??null,n=a.metadata[e.id]?.value??null;return t===null&&n===null?0:t===null?-1:n===null?1:r(t,n)}}async function G(e){const o=r=>E(e.direction,r);switch(e.field){case"id":return o(s("id"));case"name":return o(s(r=>r.name));case"metadataConfidence":{if(!e.metadata)throw new Error("Tried to sort by metadata confidence without specifying metadata ID");return o(s(r=>r.metadata?.[e.metadata]?.confidence??0))}case"metadataValue":{if(!e.metadata)throw new Error("Tried to sort by metadata value without specifying metadata ID");const r=$(e.metadata);if(!r.namespace)throw new Error(`Tried to sort by metadata value with non-namespaced metadata ID ${JSON.stringify(e.metadata)}`);return o(v({metadata:await b.Metadata.getOrThrow(e.metadata),options:await S("MetadataOption",x(r.namespace,r.id))}))}}}async function P(e){if(e.field==="none")return null;if(!e.metadata)throw new Error(`tried to group by ${e.field} without specifying metadata ID`);const o=await b.Metadata.getOrThrow(e.metadata),r=o.label||N(o.id);switch(e.field){case"metadataPresence":return c=>c.metadata[e.metadata]!==void 0?[0,`Avec ${r}`]:[1,`Sans ${r}`];case"metadataConfidence":return c=>{const a=c.metadata[e.metadata]?.confidence;return a>=.75?[0,`${r}: confiance à 75%-100%`]:a>=.5?[1,`${r}: confiance à 50%-75%`]:a>=.25?[2,`${r}: confiance à 25%-50%`]:a!==void 0?[3,`${r}: confiance à 0%-25%`]:[4,`Sans ${r}`]};case"metadataValue":{const c=$(e.metadata);if(!c.namespace)throw new Error(`Tried to group by metadata value with non-namespaced metadata ID ${JSON.stringify(e.metadata)}`);const a=await S("MetadataOption",x(c.namespace,c.id)),t=B({type:o.type,language:V().language,tolerances:e.tolerances,options:a});return n=>{const d=n.metadata[e.metadata]?.value;if(d===void 0)return[a.length,`Sans ${r}`];const i=t(d);return[a.find(u=>u.key===d.toString())?.index??i,`${r} = ${i}`]}}}}async function j({sortSettings:e,groupSettings:o}){const r=await G(e),c=await P(o),a=s(t=>{if(!c)return 0;const[n]=c(t);return n});return(t,n)=>{const d=a(t,n);return d!==0?d:r(t,n)}}export{P as a,G as b,j as g};
