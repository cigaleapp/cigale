import"./DsnmJJEf.js";import{o as We}from"./BXq8bD8b.js";import{aq as ve,aR as Ge,g as a,as as re,b1 as Je,p as Ue,ao as me,u as E,H as z,a as L,b as Ve,ap as C,ar as M,J as A,G as J,C as we,D as ye,I as Qe,at as Ae,F as Ze,b2 as et}from"./BwdvgNQo.js";import{s as ce}from"./HTLptRgQ.js";import{s as tt}from"./CuKI1hs9.js";import{p as st,i as oe}from"./CKH9F0ww.js";import{e as Se}from"./CuPIRSst.js";import{s as Te}from"./DYy3QkOc.js";import{t as ot,f as it}from"./BjiNJ5CV.js";import{a as Ee,t as rt}from"./C6sIn56-.js";import{b as nt,s as pe,c as Le}from"./08d27X49.js";import{b as lt}from"./DB45Zn9a.js";import{w as at}from"./2OzU4e1W.js";import{S as ct,u as x}from"./BPJfxdhi.js";import{A as ht}from"./CMG_9Ef3.js";import{A as dt}from"./xJVponh6.js";import{D as ut}from"./DBaFXsNm.js";import{B as mt}from"./LNwaZJFt.js";import{B as pt}from"./DfpvCGjf.js";import{a as _t,c as Ce,C as vt,o as ft,v as gt}from"./Don2Ydo1.js";import{a as bt,b as yt}from"./D9eftTZy.js";import{d as St}from"./DfkTl275.js";import{d as Et}from"./iDw1HNQ9.js";import{L as xt}from"./72YJCPe-.js";import{d as wt}from"./BOvN9V9s.js";import{b as At}from"./YI6rRCuH.js";import{i as Me}from"./CEoeiZ5P.js";import{t as ke}from"./BYqiwRWy.js";import{R as Tt}from"./DWCXZatK.js";class Lt{constructor(){this._listeners=new Map,this.on=this.addEventListener,this.off=this.removeEventListener,this.emit=this.dispatchEvent}addEventListener(e,t){const s=this._listeners.get(e)??new Set;return this._listeners.set(e,s),s.add(t),this}removeEventListener(e,t){var s;return(s=this._listeners.get(e))==null||s.delete(t),this}dispatchEvent(e,...t){let s=!0;for(const o of this._listeners.get(e)??[])s=o(...t)!==!1&&s;return s}unbindAllListeners(){this._listeners.clear()}}const Re=(l,e="px")=>typeof l=="number"?l+e:l,N=({style:l},e,t)=>{if(typeof e=="object")for(const[s,o]of Object.entries(e))o!==void 0&&(l[s]=Re(o));else t!==void 0&&(l[e]=Re(t))},Be=(l=0,e=0,t=0,s=0)=>{const o={x:l,y:e,width:t,height:s,top:e,left:l,right:l+t,bottom:e+s};return{...o,toJSON:()=>JSON.stringify(o)}},Ct=l=>{let e,t=-1,s=!1;return{next:(...o)=>{e=o,s||(s=!0,t=requestAnimationFrame(()=>{l(...e),s=!1}))},cancel:()=>{cancelAnimationFrame(t),s=!1}}},Ie=(l,e,t="touch")=>{switch(t){case"center":{const s=e.left+e.width/2,o=e.top+e.height/2;return s>=l.left&&s<=l.right&&o>=l.top&&o<=l.bottom}case"cover":return e.left>=l.left&&e.top>=l.top&&e.right<=l.right&&e.bottom<=l.bottom;case"touch":return l.right>=e.left&&l.left<=e.right&&l.bottom>=e.top&&l.top<=e.bottom}},Mt=()=>matchMedia("(hover: none), (pointer: coarse)").matches,kt=()=>"safari"in window,xe=l=>Array.isArray(l)?l:[l],He=l=>(e,t,s,o={})=>{(e instanceof HTMLCollection||e instanceof NodeList)&&(e=Array.from(e)),t=xe(t),e=xe(e);for(const i of e)if(i)for(const n of t)i[l](n,s,{capture:!1,...o})},X=He("addEventListener"),B=He("removeEventListener"),_e=l=>{var e;const{clientX:t,clientY:s,target:o}=((e=l.touches)==null?void 0:e[0])??l;return{x:t,y:s,target:o}},ie=(l,e=document)=>xe(l).map(t=>typeof t=="string"?Array.from(e.querySelectorAll(t)):t instanceof Element?t:null).flat().filter(Boolean),Rt=(l,e)=>e.some(t=>typeof t=="number"?l.button===t:typeof t=="object"?t.button!==l.button?!1:t.modifiers.every(s=>{switch(s){case"alt":return l.altKey;case"ctrl":return l.ctrlKey||l.metaKey;case"shift":return l.shiftKey}}):!1),{abs:U,max:De,min:Oe,ceil:Ke}=Math,Pe=(l=[])=>({stored:l,selected:[],touched:[],changed:{added:[],removed:[]}}),je=class extends Lt{constructor(e){var t,s,o,i,n;super(),this._selection=Pe(),this._targetBoundaryScrolled=!0,this._selectables=[],this._areaLocation={y1:0,x2:0,y2:0,x1:0},this._areaRect=Be(),this._singleClick=!0,this._scrollAvailable=!0,this._scrollingActive=!1,this._scrollSpeed={x:0,y:0},this._scrollDelta={x:0,y:0},this._lastMousePosition={x:0,y:0},this.enable=this._toggleStartEvents,this.disable=this._toggleStartEvents.bind(this,!1),this._options={selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,startAreas:["html"],boundaries:["html"],container:"body",...e,behaviour:{overlap:"invert",intersect:"touch",triggers:[0],...e.behaviour,startThreshold:(t=e.behaviour)!=null&&t.startThreshold?typeof e.behaviour.startThreshold=="number"?e.behaviour.startThreshold:{x:10,y:10,...e.behaviour.startThreshold}:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,...(s=e.behaviour)==null?void 0:s.scrolling,startScrollMargins:{x:0,y:0,...(i=(o=e.behaviour)==null?void 0:o.scrolling)==null?void 0:i.startScrollMargins}}},features:{range:!0,touch:!0,deselectOnBlur:!1,...e.features,singleTap:{allow:!0,intersect:"native",...(n=e.features)==null?void 0:n.singleTap}}};for(const m of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))typeof this[m]=="function"&&(this[m]=this[m].bind(this));const{document:r,selectionAreaClass:h,selectionContainerClass:u}=this._options;this._area=r.createElement("div"),this._clippingElement=r.createElement("div"),this._clippingElement.appendChild(this._area),this._area.classList.add(h),u&&this._clippingElement.classList.add(u),N(this._area,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),N(this._clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this._frame=Ct(m=>{this._recalculateSelectionAreaRect(),this._updateElementSelection(),this._emitEvent("move",m),this._redrawSelectionArea()}),this.enable()}_toggleStartEvents(e=!0){const{document:t,features:s}=this._options,o=e?X:B;o(t,"mousedown",this._onTapStart),s.touch&&o(t,"touchstart",this._onTapStart,{passive:!1})}_onTapStart(e,t=!1){const{x:s,y:o,target:i}=_e(e),{document:n,startAreas:r,boundaries:h,features:u,behaviour:m}=this._options,d=i.getBoundingClientRect();if(e instanceof MouseEvent&&!Rt(e,m.triggers))return;const y=ie(r,n),w=ie(h,n);this._targetElement=w.find(k=>Ie(k.getBoundingClientRect(),d));const f=e.composedPath(),v=y.find(k=>f.includes(k));if(this._targetBoundary=w.find(k=>f.includes(k)),!this._targetElement||!v||!this._targetBoundary||!t&&this._emitEvent("beforestart",e)===!1)return;this._areaLocation={x1:s,y1:o,x2:0,y2:0};const p=n.scrollingElement??n.body;this._scrollDelta={x:p.scrollLeft,y:p.scrollTop},this._singleClick=!0,this.clearSelection(!1,!0),X(n,["touchmove","mousemove"],this._delayedTapMove,{passive:!1}),X(n,["mouseup","touchcancel","touchend"],this._onTapStop),X(n,"scroll",this._onScroll),u.deselectOnBlur&&(this._targetBoundaryScrolled=!1,X(this._targetBoundary,"scroll",this._onStartAreaScroll))}_onSingleTap(e){const{singleTap:{intersect:t},range:s}=this._options.features,o=_e(e);let i;if(t==="native")i=o.target;else if(t==="touch"){this.resolveSelectables();const{x:r,y:h}=o;i=this._selectables.find(u=>{const{right:m,left:d,top:y,bottom:w}=u.getBoundingClientRect();return r<m&&r>d&&h<w&&h>y})}if(!i)return;for(this.resolveSelectables();!this._selectables.includes(i);)if(i.parentElement)i=i.parentElement;else{this._targetBoundaryScrolled||this.clearSelection();return}const{stored:n}=this._selection;if(this._emitEvent("start",e),e.shiftKey&&s&&this._latestElement){const r=this._latestElement,[h,u]=r.compareDocumentPosition(i)&4?[i,r]:[r,i],m=[...this._selectables.filter(d=>d.compareDocumentPosition(h)&4&&d.compareDocumentPosition(u)&2),h,u];this.select(m),this._latestElement=r}else n.includes(i)&&(n.length===1||e.ctrlKey||n.every(r=>this._selection.stored.includes(r)))?this.deselect(i):(this.select(i),this._latestElement=i)}_delayedTapMove(e){const{container:t,document:s,behaviour:{startThreshold:o}}=this._options,{x1:i,y1:n}=this._areaLocation,{x:r,y:h}=_e(e);if(typeof o=="number"&&U(r+h-(i+n))>=o||typeof o=="object"&&U(r-i)>=o.x||U(h-n)>=o.y){if(B(s,["mousemove","touchmove"],this._delayedTapMove,{passive:!1}),this._emitEvent("beforedrag",e)===!1){B(s,["mouseup","touchcancel","touchend"],this._onTapStop);return}X(s,["mousemove","touchmove"],this._onTapMove,{passive:!1}),N(this._area,"display","block"),ie(t,s)[0].appendChild(this._clippingElement),this.resolveSelectables(),this._singleClick=!1,this._targetRect=this._targetElement.getBoundingClientRect(),this._scrollAvailable=this._targetElement.scrollHeight!==this._targetElement.clientHeight||this._targetElement.scrollWidth!==this._targetElement.clientWidth,this._scrollAvailable&&(X(this._targetElement,"wheel",this._wheelScroll,{passive:!1}),X(this._options.document,"keydown",this._keyboardScroll,{passive:!1}),this._selectables=this._selectables.filter(u=>this._targetElement.contains(u))),this._setupSelectionArea(),this._emitEvent("start",e),this._onTapMove(e)}this._handleMoveEvent(e)}_setupSelectionArea(){const{_clippingElement:e,_targetElement:t,_area:s}=this,o=this._targetRect=t.getBoundingClientRect();this._scrollAvailable?(N(e,{top:o.top,left:o.left,width:o.width,height:o.height}),N(s,{marginTop:-o.top,marginLeft:-o.left})):(N(e,{top:0,left:0,width:"100%",height:"100%"}),N(s,{marginTop:0,marginLeft:0}))}_onTapMove(e){const{_scrollSpeed:t,_areaLocation:s,_options:o,_frame:i}=this,{speedDivider:n}=o.behaviour.scrolling,r=this._targetElement,{x:h,y:u}=_e(e);if(s.x2=h,s.y2=u,this._lastMousePosition.x=h,this._lastMousePosition.y=u,this._scrollAvailable&&!this._scrollingActive&&(t.y||t.x)){this._scrollingActive=!0;const m=()=>{if(!t.x&&!t.y){this._scrollingActive=!1;return}const{scrollTop:d,scrollLeft:y}=r;t.y&&(r.scrollTop+=Ke(t.y/n),s.y1-=r.scrollTop-d),t.x&&(r.scrollLeft+=Ke(t.x/n),s.x1-=r.scrollLeft-y),i.next(e),requestAnimationFrame(m)};requestAnimationFrame(m)}else i.next(e);this._handleMoveEvent(e)}_handleMoveEvent(e){const{features:t}=this._options;(t.touch&&Mt()||this._scrollAvailable&&kt())&&e.preventDefault()}_onScroll(){const{_scrollDelta:e,_options:{document:t}}=this,{scrollTop:s,scrollLeft:o}=t.scrollingElement??t.body;this._areaLocation.x1+=e.x-o,this._areaLocation.y1+=e.y-s,e.x=o,e.y=s,this._setupSelectionArea(),this._frame.next(null)}_onStartAreaScroll(){this._targetBoundaryScrolled=!0,B(this._targetElement,"scroll",this._onStartAreaScroll)}_wheelScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,s=e.deltaY?e.deltaY>0?1:-1:0,o=e.deltaX?e.deltaX>0?1:-1:0;this._scrollSpeed.y+=s*t,this._scrollSpeed.x+=o*t,this._onTapMove(e),e.preventDefault()}_keyboardScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,s=e.key==="ArrowLeft"?-1:e.key==="ArrowRight"?1:0,o=e.key==="ArrowUp"?-1:e.key==="ArrowDown"?1:0;this._scrollSpeed.x+=Math.sign(s)*t,this._scrollSpeed.y+=Math.sign(o)*t,e.preventDefault(),this._onTapMove({clientX:this._lastMousePosition.x,clientY:this._lastMousePosition.y,preventDefault:()=>{}})}_recalculateSelectionAreaRect(){const{_scrollSpeed:e,_areaLocation:t,_targetElement:s,_options:o}=this,{scrollTop:i,scrollHeight:n,clientHeight:r,scrollLeft:h,scrollWidth:u,clientWidth:m}=s,d=this._targetRect,{x1:y,y1:w}=t;let{x2:f,y2:v}=t;const{behaviour:{scrolling:{startScrollMargins:p}}}=o;f<d.left+p.x?(e.x=h?-U(d.left-f+p.x):0,f=f<d.left?d.left:f):f>d.right-p.x?(e.x=u-h-m?U(d.left+d.width-f-p.x):0,f=f>d.right?d.right:f):e.x=0,v<d.top+p.y?(e.y=i?-U(d.top-v+p.y):0,v=v<d.top?d.top:v):v>d.bottom-p.y?(e.y=n-i-r?U(d.top+d.height-v-p.y):0,v=v>d.bottom?d.bottom:v):e.y=0;const k=Oe(y,f),q=Oe(w,v),he=De(y,f),fe=De(w,v);this._areaRect=Be(k,q,he-k,fe-q)}_redrawSelectionArea(){const{x:e,y:t,width:s,height:o}=this._areaRect,{style:i}=this._area;i.left=`${e}px`,i.top=`${t}px`,i.width=`${s}px`,i.height=`${o}px`}_onTapStop(e,t){var s;const{document:o,features:i}=this._options,{_singleClick:n}=this;B(this._targetElement,"scroll",this._onStartAreaScroll),B(o,["mousemove","touchmove"],this._delayedTapMove),B(o,["touchmove","mousemove"],this._onTapMove),B(o,["mouseup","touchcancel","touchend"],this._onTapStop),B(o,"scroll",this._onScroll),this._keepSelection(),e&&n&&i.singleTap.allow?this._onSingleTap(e):!n&&!t&&(this._updateElementSelection(),this._emitEvent("stop",e)),this._scrollSpeed.x=0,this._scrollSpeed.y=0,B(this._targetElement,"wheel",this._wheelScroll,{passive:!0}),B(this._options.document,"keydown",this._keyboardScroll,{passive:!0}),this._clippingElement.remove(),(s=this._frame)==null||s.cancel(),N(this._area,"display","none")}_updateElementSelection(){const{_selectables:e,_options:t,_selection:s,_areaRect:o}=this,{stored:i,selected:n,touched:r}=s,{intersect:h,overlap:u}=t.behaviour,m=u==="invert",d=[],y=[],w=[];for(let v=0;v<e.length;v++){const p=e[v];if(Ie(o,p.getBoundingClientRect(),h)){if(n.includes(p))i.includes(p)&&!r.includes(p)&&r.push(p);else if(m&&i.includes(p)){w.push(p);continue}else y.push(p);d.push(p)}}m&&y.push(...i.filter(v=>!n.includes(v)));const f=u==="keep";for(let v=0;v<n.length;v++){const p=n[v];!d.includes(p)&&!(f&&i.includes(p))&&w.push(p)}s.selected=d,s.changed={added:y,removed:w},this._latestElement=void 0}_emitEvent(e,t){return this.emit(e,{event:t,store:this._selection,selection:this})}_keepSelection(){const{_options:e,_selection:t}=this,{selected:s,changed:o,touched:i,stored:n}=t,r=s.filter(h=>!n.includes(h));switch(e.behaviour.overlap){case"drop":{t.stored=[...r,...n.filter(h=>!i.includes(h))];break}case"invert":{t.stored=[...r,...n.filter(h=>!o.removed.includes(h))];break}case"keep":{t.stored=[...n,...s.filter(h=>!n.includes(h))];break}}}trigger(e,t=!0){this._onTapStart(e,t)}resolveSelectables(){this._selectables=ie(this._options.selectables,this._options.document)}clearSelection(e=!0,t=!1){const{selected:s,stored:o,changed:i}=this._selection;i.added=[],i.removed.push(...s,...e?o:[]),t||(this._emitEvent("move",null),this._emitEvent("stop",null)),this._selection=Pe(e?[]:o)}getSelection(){return this._selection.stored}getSelectionArea(){return this._area}getSelectables(){return this._selectables}setAreaLocation(e){Object.assign(this._areaLocation,e),this._redrawSelectionArea()}getAreaLocation(){return this._areaLocation}cancel(e=!1){this._onTapStop(null,!e)}destroy(){this.cancel(),this.disable(),this._clippingElement.remove(),super.unbindAllListeners()}select(e,t=!1){const{changed:s,selected:o,stored:i}=this._selection,n=ie(e,this._options.document).filter(r=>!o.includes(r)&&!i.includes(r));return i.push(...n),o.push(...n),s.added.push(...n),s.removed=[],this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)),n}deselect(e,t=!1){const{selected:s,stored:o,changed:i}=this._selection,n=ie(e,this._options.document).filter(r=>s.includes(r)||o.includes(r));this._selection.stored=o.filter(r=>!n.includes(r)),this._selection.selected=s.filter(r=>!n.includes(r)),this._selection.changed.added=[],this._selection.changed.removed.push(...n.filter(r=>!i.removed.includes(r))),this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null))}};je.version="3.9.0";let Bt=je;class It{imagesContainer;#t=ve(Ge([]));get selection(){return a(this.#t)}set selection(e){re(this.#t,e,!0)}#e;shiftSelectionAnchor;setSelection(e){if(!this.#e)return;const t=e.map(o=>this.imagesContainer?.querySelector(`[data-selectable][data-id="${o}"]`)).filter(o=>o!=null);this.#e.clearSelection(!0,!0);const s=this.#e.select(t,!0);return this.selection=s.map(o=>o.dataset.id).filter(o=>o!==void 0),s}refreshSelectables(){this.#e&&this.#e.resolveSelectables()}destroy(){this.#e?.destroy()}constructor(e,t=[],{ondeadclick:s}={}){if(this.selection=t,this.imagesContainer=e,!this.imagesContainer)return;const o=this.imagesContainer.parentElement??this.imagesContainer;this.#e=new Bt({selectables:"[data-selectable]",boundaries:o,startAreas:"[data-starts-selection]",selectionAreaClass:"viselect-selection-area",behaviour:{overlap:"keep"},features:{deselectOnBlur:!0}}),this.#e.on("start",({event:i})=>{i&&!i.ctrlKey&&!i.metaKey&&!i.shiftKey&&(this.selection=[])}),this.#e.on("move",({store:{changed:i}})=>{const n=qe(i.removed),r=qe(i.added);this.selection=[...this.selection.filter(h=>!n.includes(h)),...r]}),this.#e.on("stop",({event:i,store:{changed:n}})=>{n.added.length>0||n.removed.length>0||s?.(i)})}}function qe(l){return l.filter(e=>e instanceof HTMLElement).map(e=>e.dataset.id).filter(_t)}function Dt(l,e){let t=null;function s(i={}){o(),t=new MutationObserver(n=>{n.forEach(r=>i[`on${r.type}`]?.(r))}),t.observe(l,i)}function o(){t?.disconnect(),t=null}return s(e),{update:s,destroy:o}}function Ot(l,e){let t=null;function s(i={}){o(),t=new ResizeObserver((n,r)=>{i.onresize?.(n,r)}),t.observe(l)}function o(){t?.disconnect(),t=null}return s(e),{update:s,destroy:o}}var Kt=z('<header class="svelte-1rb1ldh"><!> <h2 class="svelte-1rb1ldh"> </h2> <p class="svelte-1rb1ldh"> </p> <div class="actions svelte-1rb1ldh"><!></div></header>'),Pt=z("<div><!></div>"),qt=z("<div><!></div> <!>",1),Ht=z('<div class="items svelte-1rb1ldh" data-starts-selection=""></div>'),jt=z('<section class="group svelte-1rb1ldh" role="region"><!> <!></section>'),zt=z('<div class="groups"></div>'),Ft=z('<div class="loading svelte-1rb1ldh"><!> <p> </p></div>'),$t=z('<div class="debug svelte-1rb1ldh"><code> <br/> selection <!> <br/> queued <!> <br/> loading <!> <br/> errored <!> <br/> preview urls <!> <br/></code></div>'),Nt=z('<section class="images svelte-1rb1ldh" data-testid="observations-area"><!> <!></section>');function Ss(l,e){const t=Je();Ue(e,!0);let s=st(e,"unroll",19,()=>["",[]]);const o=E(()=>et(s(),2)),i=E(()=>a(o)[0]),n=E(()=>a(o)[1]),r=new ct;at([()=>a(y)],()=>{r.clear()});let h=ve(void 0),u;We(()=>{if(a(h))return u?.destroy(),u=new It(a(h),x.selection,{ondeadclick:e.onemptyclick}),u.setSelection(x.selection),x.setSelection=c=>{if(!u){console.error("dragselect not initialized");return}u.setSelection(c)},()=>{u?.destroy(),x.setSelection=void 0}}),me(()=>{x.selection=[...new Set(u?.selection??[])]});const m=E(()=>nt("main"));Et("observations",{"$mod+a":{help:a(m)(168),when:({target:c})=>!(c instanceof HTMLInputElement),do:()=>{u?.setSelection(e.items.map(c=>c.id))}},"$mod+d":{help:a(m)(167),when:({target:c})=>!(c instanceof HTMLInputElement),do:()=>{x.selection=[],u?.setSelection([])}}});function d({id:c,virtual:_=!1}){return _?`${c}_virtual`:c}me(()=>{const c=a(h)?.querySelector(`[data-id="${e.highlight}"]`);c&&(c.style.scrollMarginTop="10vh",c.scrollIntoView({behavior:"instant",block:"start",inline:"nearest"}))});let y=ve(void 0);const w=E(()=>x.currentSession?.group[e.zone]??x.currentSession?.group.global);me(()=>{a(w)&&bt(a(w)).then(c=>{re(y,c,!0)}).catch(c=>{console.error("couldnt set grouper",c),ke.error(a(m)(416)),re(y,null)})});let f=ve(void 0);const v=E(()=>x.currentSession?.sort[e.zone]??x.currentSession?.sort.global);me(()=>{a(v)&&yt(a(v)).then(c=>{re(f,c,!0)}).catch(c=>{console.error("couldnt set sorter",c),ke.error(a(m)(417)),re(f,Ce("id"),!0)})});const p=E(()=>{if(a(y)===void 0||a(f)===void 0)return;const c={};if(a(y))for(const _ of e.items){const[b,g]=a(y)(_);c[g]??={items:[],sortKey:b},c[g].items.push(_)}else c[""]={items:e.items,sortKey:0};return vt(c).map(([_,{items:b,sortKey:g}])=>({label:_,sortKey:g,items:b.sort(a(f))})).sort(Ce(({sortKey:_})=>_))});function k(){const _=[...[...a(h)?.querySelectorAll(".item-unroll-container.unrolled")??[]]].map(b=>b.getBoundingClientRect());a(h)?.querySelectorAll(".item-unroll-container.unrolled").forEach(b=>{if(!(b instanceof HTMLElement))return;const g=b.getBoundingClientRect(),I=_.filter(({y:S})=>S===g.y),F=_.filter(({x:S})=>S===g.x);b.dataset.roundCornerTop=F.every(({y:S})=>S>=g.y).toString(),b.dataset.roundCornerBottom=F.every(({y:S})=>S<=g.y).toString(),b.dataset.roundCornerLeft=I.every(({x:S})=>S>=g.x).toString(),b.dataset.roundCornerRight=I.every(({x:S})=>S<=g.x).toString()})}var q=Nt(),he=M(q);{var fe=c=>{var _=zt();Se(_,21,()=>a(p),({label:b,items:g,sortKey:I})=>I,(b,g,I,F)=>{let S=()=>a(g).label,V=()=>a(g).items,T=()=>a(g).sortKey;var R=jt(),$=M(R);{var ge=Y=>{var D=Kt(),Z=M(D);{let O=E(()=>r.has(T())?"Développer le groupe":"Réduire le groupe");mt(Z,{get help(){return a(O)},onclick:async()=>{r.has(T())?r.delete(T()):r.add(T())},children:(H,K)=>{var P=we(),ae=ye(P);{var G=j=>{dt(j,{})},ue=E(()=>r.has(T())),se=j=>{ht(j,{})};oe(ae,j=>{a(ue)?j(G):j(se,!1)})}L(H,P)},$$slots:{default:!0}})}var W=C(Z,2),ne=M(W,!0);A(W);var ee=C(W,2),te=M(ee,!0);A(ee);var le=C(ee,2),be=M(le);{const O=K=>{ut(K,{})};let H=E(()=>a(m)(340));pt(be,{dangerous:!0,get help(){return a(H)},onclick:async()=>{await ft(["Image","Observation","ImageFile","ImagePreviewFile"],{},async K=>{for(const{id:P}of V())At(P,"Cancelled by user"),await wt(P,{notFoundOk:!0,recursive:!0}),await St(P,K,!0)})},_w_snippet_0:O,children:(K,P)=>{{let ae=E(()=>[O]),G=E(()=>a(m).c(15));Tt(K,{get t(){return a(ae)},get x(){return a(G)}})}},$$slots:{_w_snippet_0:!0,default:!0}})}A(le),A(D),Ee(D,(O,H)=>rt?.(O,H),()=>Me()?`sort key = ${T()}`:void 0),J((O,H)=>{pe(D,"aria-expanded",O),pe(D,"aria-controls",`${t}-group-${T()??""}`),ce(ne,S()),ce(te,H)},[()=>!r.has(T()),()=>gt(V().length,a(m).p(331),a(m)._.p)]),L(Y,D)};oe($,Y=>{S()&&Y(ge)})}var de=C($,2);{var Q=Y=>{var D=Ht();Se(D,21,V,Z=>d(Z),(Z,W)=>{const ne=E(()=>a(i)===a(W).id);var ee=qt(),te=ye(ee);let le;var be=M(te);Te(be,()=>e.item,()=>a(W).data,()=>a(W)),A(te);var O=C(te,2);{var H=K=>{var P=we(),ae=ye(P);Se(ae,17,()=>a(n),G=>d(G),(G,ue)=>{var se=Pt();let j;var Ye=M(se);Te(Ye,()=>e.item,()=>a(ue).data,()=>a(ue)),A(se),J(()=>j=Le(se,1,"item-unroll-container svelte-1rb1ldh",null,j,{unrolled:a(ne)})),L(G,se)}),L(K,P)};oe(O,K=>{a(ne)&&K(H)})}J(()=>le=Le(te,1,"item-unroll-container svelte-1rb1ldh",null,le,{unrolled:a(ne)})),L(Z,ee)}),A(D),L(Y,D)},Xe=E(()=>!r.has(T()));oe(de,Y=>{a(Xe)&&Y(Q)})}A(R),J(()=>{pe(R,"aria-label",S()),pe(R,"id",`${t}-group-${T()??""}`)}),L(b,R)}),A(_),ot(1,_,()=>it,()=>({duration:200})),L(c,_)},ze=c=>{var _=Ft(),b=M(_);xt(b,{loading:!0});var g=C(b,2),I=M(g,!0);A(g),A(_),J(F=>ce(I,F),[()=>a(m)(418)]),L(c,_)};oe(he,c=>{a(p)?c(fe):c(ze,!1)})}var Fe=C(he,2);{var $e=c=>{var _=$t();{const R=($,ge=Qe)=>{Ae();var de=Ze();J(Q=>ce(de,`{
				${Q??""}
				}`),[()=>[...tt(ge())].map(Q=>(Q.length>10?"…":"")+Q.slice(-10)).join(" ")]),L($,de)};var b=M(_),g=M(b),I=C(g,3);R(I,()=>x.selection);var F=C(I,4);R(F,()=>x.queuedImages);var S=C(F,4);R(S,()=>x.loadingImages);var V=C(S,4);{let $=E(()=>x.erroredImages.keys());R(V,()=>a($))}var T=C(V,4);{let $=E(()=>x.previewURLs.keys());R(T,()=>a($))}Ae(2),A(b),A(_),J(()=>ce(g,`session ${x.currentSessionId??""} `))}L(c,_)},Ne=E(()=>Me()&&e.items.length>0);oe(Fe,c=>{a(Ne)&&c($e)})}A(q),lt(q,c=>re(h,c),()=>a(h)),Ee(q,(c,_)=>Ot?.(c,_),()=>({onresize(){k()}})),Ee(q,(c,_)=>Dt?.(c,_),()=>({childList:!0,subtree:!0,onchildList(){a(h)&&(u?.refreshSelectables(),u?.setSelection(x.selection),k())}})),L(l,q),Ve()}export{Ss as A};
