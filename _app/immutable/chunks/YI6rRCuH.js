import{ao as Xe}from"./BwdvgNQo.js";import{s as Ue}from"./CuKI1hs9.js";import{at as Rt,t as O,a1 as mt,b as _e,au as pt,l as Lt,V as Bt,S as Tt,f as de,av as Gt,aw as Ye,ac as Mt,ax as Ot,ay as kt,o as Nt,az as Ut,A as _t,m as Ce,C as $e,R as Qe,aA as zt,aB as Vt,v as ze,$ as Ht,aC as jt,e as Wt}from"./Don2Ydo1.js";import{e as qt,a as Jt,f as Xt,b as ve}from"./BhEwWWID.js";import{a as Yt}from"./Xiow3_xo.js";import{u as v}from"./BPJfxdhi.js";import{m as $t,n as xt,r as ht,s as gt,h as Me,e as Se,g as Qt}from"./DfkTl275.js";import{g as Zt}from"./Bd7_h5c3.js";import{t as _}from"./BYqiwRWy.js";import{g as ye}from"./08d27X49.js";import{f as dt}from"./YICrNYhN.js";import{a as Kt}from"./CEoeiZ5P.js";import{u as ei}from"./iDw1HNQ9.js";Map.groupBy??=function(e,i){const r=new Map;let a=0;for(const s of e){const c=i(s,a++),m=r.get(c);m?m.push(s):r.set(c,[s])}return r};const rn=Symbol("SWARPC procedures");class ti extends Error{constructor(e){super(`Request was cancelled: ${e}`),this.name="RequestCancelledError"}}function on(t,e="debug",i,r){const a=Ze.slice(Ze.indexOf(e));if(r&&i){const s={rqid:r,nid:i};return{debug:a.includes("debug")?Q("debug",t,s):()=>{},info:a.includes("info")?Q("info",t,s):()=>{},warn:a.includes("warn")?Q("warn",t,s):()=>{},error:a.includes("error")?Q("error",t,s):()=>{}}}return{debug:a.includes("debug")?Q("debug",t,i):()=>{},info:a.includes("info")?Q("info",t,i):()=>{},warn:a.includes("warn")?Q("warn",t,i):()=>{},error:a.includes("error")?Q("error",t,i):()=>{}}}const Ze=["debug","info","warn","error"],ii=["debug","info","warn","error","log"];function Q(t,e,i){if(i===void 0||typeof i=="string"){const r=i??null;return(a,...s)=>Ke(t,e,{nid:r,rqid:a},...s)}return(...r)=>Ke(t,e,i,...r)}const ni=ii.reduce((t,e)=>(t[e]=console[e],t),{});function Ke(t,e,{rqid:i,nid:r},...a){const s=[`[SWARPC ${e}]`,i?`%c${i}%c`:"",r?`%c@ ${r}%c`:""].filter(Boolean).join(" "),c=[];return i&&c.push("color: cyan","color: inherit"),r&&c.push("color: hotpink","color: inherit"),ni[t](s,...c,...a)}const ai=[MessagePort,ReadableStream,WritableStream,TransformStream,ArrayBuffer];function et(t){return t==null?[]:typeof t=="object"?ArrayBuffer.isView(t)||t instanceof ArrayBuffer?[t]:ai.some(e=>t instanceof e)?[t]:Array.isArray(t)?t.flatMap(et):Object.values(t).flatMap(et):[]}function sn(t){return t.length===0?[]:t}function ln(t){return t.filter(e=>e.status==="fulfilled")}function fn(t){return t.filter(e=>e.status==="rejected")}async function ri(t,e,i){if(!v.currentProtocol)throw new Error("Aucun protocole sélectionné");if(!v.classificationMetadataId){console.warn("No metadata with neural inference defined, not analyzing image. Configure neural inference on a enum metadata (set metadata.<your metadata id>.infer.neural) if this was not intentional.");return}const r=Ue(oi(v.currentProtocol,v.selectedClassificationModel)),{cancel:a,request:s}=t.classify.cancelable({imageId:e,taskSettings:r,metadataIds:{cropbox:v.cropMetadataId,target:v.classificationMetadataId}});i?.set(e,a);try{await s}catch(c){if(c instanceof ti||!v.currentSessionId)throw c;await qt({db:mt(),subjectId:e,sessionId:v.currentSessionId,metadataId:v.classificationMetadataId},{kind:"inference",message:c instanceof Error?c.message:String(c),stack:c instanceof Error?c.stack??"":"",ignored:!1,details:{taskSettings:r,image:await O.Image.get(e),fullError:Rt(c)}})}await O.Image.refresh(v.currentSessionId)}function oi(t,e){const i=Yt(t,O.Metadata.state)?.infer;if(!i)throw new Error(`Current protocol ${t.id} has no metadata with inference settings`);if(!("neural"in i))throw new Error(`Current protocol ${t.id} has no metadata with neural inference settings`);return i.neural[e]}var Pe,tt;function si(){return tt||(tt=1,Pe={parseSections:function(t,e){var i,r;for(t.setBigEndian(!0);t.remainingLength()>0&&r!==218;){if(t.nextUInt8()!==255)throw new Error("Invalid JPEG section offset");r=t.nextUInt8(),r>=208&&r<=217||r===218?i=0:i=t.nextUInt16()-2,e(r,t.branch(0,i)),t.skip(i)}},getSizeFromSOFSection:function(t){return t.skip(1),{height:t.nextUInt16(),width:t.nextUInt16()}},getSectionName:function(t){var e,i;switch(t){case 216:e="SOI";break;case 196:e="DHT";break;case 219:e="DQT";break;case 221:e="DRI";break;case 218:e="SOS";break;case 254:e="COM";break;case 217:e="EOI";break;default:t>=224&&t<=239?(e="APP",i=t-224):t>=192&&t<=207&&t!==196&&t!==200&&t!==204?(e="SOF",i=t-192):t>=208&&t<=215&&(e="RST",i=t-208);break}var r={name:e};return typeof i=="number"&&(r.index=i),r}}),Pe}var Ie,it;function St(){if(it)return Ie;it=1;function t(s,c){switch(s){case 1:return c.nextUInt8();case 3:return c.nextUInt16();case 4:return c.nextUInt32();case 5:return[c.nextUInt32(),c.nextUInt32()];case 6:return c.nextInt8();case 8:return c.nextUInt16();case 9:return c.nextUInt32();case 10:return[c.nextInt32(),c.nextInt32()];case 11:return c.nextFloat();case 12:return c.nextDouble();default:throw new Error("Invalid format while decoding: "+s)}}function e(s){switch(s){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function i(s,c){var m=c.nextUInt16(),h=c.nextUInt16(),P=e(h),y=c.nextUInt32(),u=P*y,S,g;if(u>4&&(c=s.openWithOffset(c.nextUInt32())),h===2){S=c.nextString(y);var C=S.indexOf("\0");C!==-1&&(S=S.substr(0,C))}else if(h===7)S=c.nextBuffer(y);else if(h!==0)for(S=[],g=0;g<y;++g)S.push(t(h,c));return u<4&&c.skip(4-u),[m,S,h]}function r(s,c,m){var h=c.nextUInt16(),P,y;for(y=0;y<h;++y)P=i(s,c),m(P[0],P[1],P[2])}function a(s){var c=s.nextString(6);if(c!=="Exif\0\0")throw new Error("Invalid EXIF header");var m=s.mark(),h=s.nextUInt16();if(h===18761)s.setBigEndian(!1);else if(h===19789)s.setBigEndian(!0);else throw new Error("Invalid TIFF header");if(s.nextUInt16()!==42)throw new Error("Invalid TIFF data");return m}return Ie={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(s,c){var m;try{m=a(s)}catch{return!1}var h,P,y,u=m.openWithOffset(s.nextUInt32()),S=this.IFD0;r(m,u,function(F,A,n){switch(F){case 34853:P=A[0];break;case 34665:h=A[0];break;default:c(S,F,A,n);break}});var g=u.nextUInt32();if(g!==0){var C=m.openWithOffset(g);r(m,C,c.bind(null,this.IFD1))}if(P){var b=m.openWithOffset(P);r(m,b,c.bind(null,this.GPSIFD))}if(h){var T=m.openWithOffset(h),L=this.InteropIFD;r(m,T,function(F,A,n){F===40965?y=A[0]:c(L,F,A,n)})}if(y){var G=m.openWithOffset(y);r(m,G,c.bind(null,this.InteropIFD))}return!0}},Ie}var be,nt;function li(){if(nt)return be;nt=1;function t(m){return parseInt(m,10)}var e=3600,i=60;function r(m,h){m=m.map(t),h=h.map(t);var P=m[0],y=m[1]-1,u=m[2],S=h[0],g=h[1],C=h[2],b=Date.UTC(P,y,u,S,g,C,0),T=b/1e3;return T}function a(m){var h=m.substr(0,10).split("-"),P=m.substr(11,8).split(":"),y=m.substr(19,6),u=y.split(":").map(t),S=u[0]*e+u[1]*i,g=r(h,P);if(g-=S,typeof g=="number"&&!isNaN(g))return g}function s(m){var h=m.split(" "),P=h[0].split(":"),y=h[1].split(":"),u=r(P,y);if(typeof u=="number"&&!isNaN(u))return u}function c(m){var h=m.length===19&&m.charAt(4)===":",P=m.length===25&&m.charAt(10)==="T";if(P)return a(m);if(h)return s(m)}return be={parseDateWithSpecFormat:s,parseDateWithTimezoneFormat:a,parseExifDate:c},be}var De,at;function fi(){if(at)return De;at=1;var t=St(),e=li(),i=[{section:t.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:t.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],r=[{section:t.SubIFD,type:306,name:"ModifyDate"},{section:t.SubIFD,type:36867,name:"DateTimeOriginal"},{section:t.SubIFD,type:36868,name:"CreateDate"},{section:t.SubIFD,type:306,name:"ModifyDate"}];return De={castDegreeValues:function(a,s){i.forEach(function(c){var m=a(c);if(m){var h=a({section:c.section,type:c.refType,name:c.refName}),P=h===c.posVal?1:-1,y=(m[0]+m[1]/60+m[2]/3600)*P;s(c,y)}})},castDateValues:function(a,s){r.forEach(function(c){var m=a(c);if(m){var h=e.parseExifDate(m);typeof h<"u"&&s(c,h)}})},simplifyValue:function(a,s){return Array.isArray(a)&&(a=a.map(function(c){return s===10||s===5?c[0]/c[1]:c}),a.length===1&&(a=a[0])),a}},De}var Ee,rt;function ci(){return rt||(rt=1,Ee={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}}),Ee}var Ae,ot;function ui(){if(ot)return Ae;ot=1;var t=si(),e=St(),i=fi();function r(s,c,m,h,P,y,u){this.startMarker=s,this.tags=c,this.imageSize=m,this.thumbnailOffset=h,this.thumbnailLength=P,this.thumbnailType=y,this.app1Offset=u}r.prototype={hasThumbnail:function(s){return!this.thumbnailOffset||!this.thumbnailLength?!1:typeof s!="string"?!0:s.toLowerCase().trim()==="image/jpeg"?this.thumbnailType===6:s.toLowerCase().trim()==="image/tiff"?this.thumbnailType===1:!1},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var s=this._getThumbnailStream(),c;return t.parseSections(s,function(m,h){t.getSectionName(m).name==="SOF"&&(c=t.getSizeFromSOFSection(h))}),c}};function a(s){this.stream=s,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}return a.prototype={enableBinaryFields:function(s){return this.flags.readBinaryTags=!!s,this},enablePointers:function(s){return this.flags.hidePointers=!s,this},enableTagNames:function(s){return this.flags.resolveTagNames=!!s,this},enableImageSize:function(s){return this.flags.imageSize=!!s,this},enableReturnTags:function(s){return this.flags.returnTags=!!s,this},enableSimpleValues:function(s){return this.flags.simplifyValues=!!s,this},parse:function(){var s=this.stream.mark(),c=s.openWithOffset(0),m=this.flags,h,P,y,u,S,g,C,b,T;return m.resolveTagNames&&(C=ci()),m.resolveTagNames?(h={},b=function(L){return h[L.name]},T=function(L,G){h[L.name]=G}):(h=[],b=function(L){var G;for(G=0;G<h.length;++G)if(h[G].type===L.type&&h[G].section===L.section)return h.value},T=function(L,G){var F;for(F=0;F<h.length;++F)if(h[F].type===L.type&&h[F].section===L.section){h.value=G;return}}),t.parseSections(c,function(L,G){var F,A=G.offsetFrom(s);L===225?(F=e.parseTags(G,function(n,o,l,p){if(!(!m.readBinaryTags&&p===7)){if(o===513){if(y=l[0],m.hidePointers)return}else if(o===514){if(u=l[0],m.hidePointers)return}else if(o===259&&(S=l[0],m.hidePointers))return;if(m.returnTags)if(m.simplifyValues&&(l=i.simplifyValue(l,p)),m.resolveTagNames){var x=n===e.GPSIFD?C.gps:C.exif,f=x[o];f||(f=C.exif[o]),h.hasOwnProperty(f)||(h[f]=l)}else h.push({section:n,type:o,value:l})}}),F&&(g=A)):m.imageSize&&t.getSectionName(L).name==="SOF"&&(P=t.getSizeFromSOFSection(G))}),m.simplifyValues&&(i.castDegreeValues(b,T),i.castDateValues(b,T)),new r(s,h,P,y,u,S,g)}},Ae=a,Ae}var we,st;function mi(){if(st)return we;st=1;function t(e,i,r,a,s,c){this.global=s,i=i||0,r=r||e.byteLength-i,this.arrayBuffer=e.slice(i,i+r),this.view=new s.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian(a),this.offset=0,this.parentOffset=(c||0)+i}return t.prototype={setBigEndian:function(e){this.littleEndian=!e},nextUInt8:function(){var e=this.view.getUint8(this.offset);return this.offset+=1,e},nextInt8:function(){var e=this.view.getInt8(this.offset);return this.offset+=1,e},nextUInt16:function(){var e=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,e},nextUInt32:function(){var e=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},nextInt16:function(){var e=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},nextInt32:function(){var e=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},nextFloat:function(){var e=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},nextDouble:function(){var e=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},nextBuffer:function(e){var i=this.arrayBuffer.slice(this.offset,this.offset+e);return this.offset+=e,i},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(e){var i=this.arrayBuffer.slice(this.offset,this.offset+e);return i=String.fromCharCode.apply(null,new this.global.Uint8Array(i)),this.offset+=e,i},mark:function(){var e=this;return{openWithOffset:function(i){return i=(i||0)+this.offset,new t(e.arrayBuffer,i,e.arrayBuffer.byteLength-i,!e.littleEndian,e.global,e.parentOffset)},offset:this.offset,getParentOffset:function(){return e.parentOffset}}},offsetFrom:function(e){return this.parentOffset+this.offset-(e.offset+e.getParentOffset())},skip:function(e){this.offset+=e},branch:function(e,i){return i=typeof i=="number"?i:this.arrayBuffer.byteLength-(this.offset+e),new t(this.arrayBuffer,this.offset+e,i,!this.littleEndian,this.global,this.parentOffset)}},we=t,we}var Fe,lt;function pi(){if(lt)return Fe;lt=1;function t(e,i,r,a){this.buffer=e,this.offset=i||0,r=typeof r=="number"?r:e.length,this.endPosition=this.offset+r,this.setBigEndian(a)}return t.prototype={setBigEndian:function(e){this.bigEndian=!!e},nextUInt8:function(){var e=this.buffer.readUInt8(this.offset);return this.offset+=1,e},nextInt8:function(){var e=this.buffer.readInt8(this.offset);return this.offset+=1,e},nextUInt16:function(){var e=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,e},nextUInt32:function(){var e=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,e},nextInt16:function(){var e=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,e},nextInt32:function(){var e=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,e},nextFloat:function(){var e=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,e},nextDouble:function(){var e=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,e},nextBuffer:function(e){var i=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i},remainingLength:function(){return this.endPosition-this.offset},nextString:function(e){var i=this.buffer.toString("utf8",this.offset,this.offset+e);return this.offset+=e,i},mark:function(){var e=this;return{openWithOffset:function(i){return i=(i||0)+this.offset,new t(e.buffer,i,e.endPosition-i,e.bigEndian)},offset:this.offset}},offsetFrom:function(e){return this.offset-e.offset},skip:function(e){this.offset+=e},branch:function(e,i){return i=typeof i=="number"?i:this.endPosition-(this.offset+e),new t(this.buffer,this.offset+e,i,this.bigEndian)}},Fe=t,Fe}var Re,ft;function xi(){if(ft)return Re;ft=1;var t=ui();function e(){return(0,eval)("this")}return Re={create:function(i,r){if(r=r||e(),i instanceof r.ArrayBuffer){var a=mi();return new t(new a(i,0,i.byteLength,!0,r))}else{var s=pi();return new t(new s(i,0,i.length,!0))}}},Re}var hi=xi(),ge={exports:{}},ct;function gi(){return ct||(ct=1,(function(t,e){(function(){var i={};i.version="1.0.4",i.remove=function(n){var o=!1;if(n.slice(0,2)!="ÿØ")if(n.slice(0,23)=="data:image/jpeg;base64,"||n.slice(0,22)=="data:image/jpg;base64,")n=S(n.split(",")[1]),o=!0;else throw new Error("Given data is not jpeg.");var l=T(n),p=l.filter(function(f){return!(f.slice(0,2)=="ÿá"&&f.slice(4,10)=="Exif\0\0")}),x=p.join("");return o&&(x="data:image/jpeg;base64,"+u(x)),x},i.insert=function(n,o){var l=!1;if(n.slice(0,6)!="Exif\0\0")throw new Error("Given data is not exif.");if(o.slice(0,2)!="ÿØ")if(o.slice(0,23)=="data:image/jpeg;base64,"||o.slice(0,22)=="data:image/jpg;base64,")o=S(o.split(",")[1]),l=!0;else throw new Error("Given data is not jpeg.");var p="ÿá"+g(">H",[n.length+2])+n,x=T(o),f=G(x,p);return l&&(f="data:image/jpeg;base64,"+u(f)),f},i.load=function(n){var o;if(typeof n=="string")if(n.slice(0,2)=="ÿØ")o=n;else if(n.slice(0,23)=="data:image/jpeg;base64,"||n.slice(0,22)=="data:image/jpg;base64,")o=S(n.split(",")[1]);else if(n.slice(0,4)=="Exif")o=n.slice(6);else throw new Error("'load' gots invalid file data.");else throw new Error("'load' gots invalid type argument.");var l={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},p=new y(o);if(p.tiftag===null)return l;p.tiftag.slice(0,2)=="II"?p.endian_mark="<":p.endian_mark=">";var x=C(p.endian_mark+"L",p.tiftag.slice(4,8))[0];l["0th"]=p.get_ifd(x,"0th");var f=l["0th"].first_ifd_pointer;if(delete l["0th"].first_ifd_pointer,34665 in l["0th"]&&(x=l["0th"][34665],l.Exif=p.get_ifd(x,"Exif")),34853 in l["0th"]&&(x=l["0th"][34853],l.GPS=p.get_ifd(x,"GPS")),40965 in l.Exif&&(x=l.Exif[40965],l.Interop=p.get_ifd(x,"Interop")),f!="\0\0\0\0"&&(x=C(p.endian_mark+"L",f)[0],l["1st"]=p.get_ifd(x,"1st"),513 in l["1st"]&&514 in l["1st"])){var d=l["1st"][513]+l["1st"][514],E=p.tiftag.slice(l["1st"][513],d);l.thumbnail=E}return l},i.dump=function(n){var o=8,l=r(n),p="Exif\0\0MM\0*\0\0\0\b",x=!1,f=!1,d=!1,E=!1,D,I,R,w,q;"0th"in l?D=l["0th"]:D={},"Exif"in l&&Object.keys(l.Exif).length||"Interop"in l&&Object.keys(l.Interop).length?(D[34665]=1,x=!0,I=l.Exif,"Interop"in l&&Object.keys(l.Interop).length?(I[40965]=1,d=!0,R=l.Interop):Object.keys(I).indexOf(i.ExifIFD.InteroperabilityTag.toString())>-1&&delete I[40965]):Object.keys(D).indexOf(i.ImageIFD.ExifTag.toString())>-1&&delete D[34665],"GPS"in l&&Object.keys(l.GPS).length?(D[i.ImageIFD.GPSTag]=1,f=!0,w=l.GPS):Object.keys(D).indexOf(i.ImageIFD.GPSTag.toString())>-1&&delete D[i.ImageIFD.GPSTag],"1st"in l&&"thumbnail"in l&&l.thumbnail!=null&&(E=!0,l["1st"][513]=1,l["1st"][514]=1,q=l["1st"]);var X=P(D,"0th",0),M=X[0].length+x*12+f*12+4+X[1].length,z,te="",k=0,V,ie="",H=0,ne,K="",ae=0,Y,he="",ee;if(x&&(z=P(I,"Exif",M),k=z[0].length+d*12+z[1].length),f&&(V=P(w,"GPS",M+k),ie=V.join(""),H=ie.length),d){var re=M+k+H;ne=P(R,"Interop",re),K=ne.join(""),ae=K.length}if(E){var re=M+k+H+ae;if(Y=P(q,"1st",re),ee=a(l.thumbnail),ee.length>64e3)throw new Error("Given thumbnail is too large. max 64kB")}var se="",We="",qe="",Je="\0\0\0\0";if(x){var $=o+M,le=g(">L",[$]),fe=34665,ce=g(">H",[fe]),ue=g(">H",[F.Long]),me=g(">L",[1]);se=ce+ue+me+le}if(f){var $=o+M+k,le=g(">L",[$]),fe=34853,ce=g(">H",[fe]),ue=g(">H",[F.Long]),me=g(">L",[1]);We=ce+ue+me+le}if(d){var $=o+M+k+H,le=g(">L",[$]),fe=40965,ce=g(">H",[fe]),ue=g(">H",[F.Long]),me=g(">L",[1]);qe=ce+ue+me+le}if(E){var $=o+M+k+H+ae;Je=g(">L",[$]);var Et=$+Y[0].length+24+4+Y[1].length,At="\0\0\0\0"+g(">L",[Et]),wt="\0\0\0\0"+g(">L",[ee.length]);he=Y[0]+At+wt+"\0\0\0\0"+Y[1]+ee}var Ft=X[0]+se+We+Je+X[1];return x&&(te=z[0]+qe+z[1]),p+Ft+te+ie+K+he};function r(n){return JSON.parse(JSON.stringify(n))}function a(n){for(var o=T(n);"ÿà"<=o[1].slice(0,2)&&o[1].slice(0,2)<="ÿï";)o=[o[0]].concat(o.slice(2));return o.join("")}function s(n){return g(">"+b("B",n.length),n)}function c(n){return g(">"+b("H",n.length),n)}function m(n){return g(">"+b("L",n.length),n)}function h(n,o,l){var p="",x="",f,d,E,D;if(o=="Byte")f=n.length,f<=4?x=s(n)+b("\0",4-f):(x=g(">L",[l]),p=s(n));else if(o=="Short")f=n.length,f<=2?x=c(n)+b("\0\0",2-f):(x=g(">L",[l]),p=c(n));else if(o=="Long")f=n.length,f<=1?x=m(n):(x=g(">L",[l]),p=m(n));else if(o=="Ascii")d=n+"\0",f=d.length,f>4?(x=g(">L",[l]),p=d):x=d+b("\0",4-f);else if(o=="Rational"){if(typeof n[0]=="number")f=1,E=n[0],D=n[1],d=g(">L",[E])+g(">L",[D]);else{f=n.length,d="";for(var I=0;I<f;I++)E=n[I][0],D=n[I][1],d+=g(">L",[E])+g(">L",[D])}x=g(">L",[l]),p=d}else if(o=="SRational"){if(typeof n[0]=="number")f=1,E=n[0],D=n[1],d=g(">l",[E])+g(">l",[D]);else{f=n.length,d="";for(var I=0;I<f;I++)E=n[I][0],D=n[I][1],d+=g(">l",[E])+g(">l",[D])}x=g(">L",[l]),p=d}else o=="Undefined"&&(f=n.length,f>4?(x=g(">L",[l]),p=n):x=n+b("\0",4-f));var R=g(">L",[f]);return[R,x,p]}function P(n,o,l){var p=8,x=Object.keys(n).length,f=g(">H",[x]),d;["0th","1st"].indexOf(o)>-1?d=2+x*12+4:d=2+x*12;var E="",D="",I;for(var I in n)if(typeof I=="string"&&(I=parseInt(I)),!(o=="0th"&&[34665,34853].indexOf(I)>-1)){{if(o=="Exif"&&I==40965)continue;if(o=="1st"&&[513,514].indexOf(I)>-1)continue}var R=n[I],w=g(">H",[I]),q=A[o][I].type,X=g(">H",[F[q]]);typeof R=="number"&&(R=[R]);var M=p+d+l+D.length,z=h(R,q,M),te=z[0],k=z[1],V=z[2];E+=w+X+te+k,D+=V}return[f+E,D]}function y(n){var o,l;if(n.slice(0,2)=="ÿØ")o=T(n),l=L(o),l?this.tiftag=l.slice(10):this.tiftag=null;else if(["II","MM"].indexOf(n.slice(0,2))>-1)this.tiftag=n;else if(n.slice(0,4)=="Exif")this.tiftag=n.slice(6);else throw new Error("Given file is neither JPEG nor TIFF.")}if(y.prototype={get_ifd:function(n,o){var l={},p=C(this.endian_mark+"H",this.tiftag.slice(n,n+2))[0],x=n+2,f;["0th","1st"].indexOf(o)>-1?f="Image":f=o;for(var d=0;d<p;d++){n=x+12*d;var E=C(this.endian_mark+"H",this.tiftag.slice(n,n+2))[0],D=C(this.endian_mark+"H",this.tiftag.slice(n+2,n+4))[0],I=C(this.endian_mark+"L",this.tiftag.slice(n+4,n+8))[0],R=this.tiftag.slice(n+8,n+12),w=[D,I,R];E in A[f]&&(l[E]=this.convert_value(w))}return o=="0th"&&(n=x+12*p,l.first_ifd_pointer=this.tiftag.slice(n,n+4)),l},convert_value:function(n){var o=null,l=n[0],p=n[1],x=n[2],f;if(l==1)p>4?(f=C(this.endian_mark+"L",x)[0],o=C(this.endian_mark+b("B",p),this.tiftag.slice(f,f+p))):o=C(this.endian_mark+b("B",p),x.slice(0,p));else if(l==2)p>4?(f=C(this.endian_mark+"L",x)[0],o=this.tiftag.slice(f,f+p-1)):o=x.slice(0,p-1);else if(l==3)p>2?(f=C(this.endian_mark+"L",x)[0],o=C(this.endian_mark+b("H",p),this.tiftag.slice(f,f+p*2))):o=C(this.endian_mark+b("H",p),x.slice(0,p*2));else if(l==4)p>1?(f=C(this.endian_mark+"L",x)[0],o=C(this.endian_mark+b("L",p),this.tiftag.slice(f,f+p*4))):o=C(this.endian_mark+b("L",p),x);else if(l==5)if(f=C(this.endian_mark+"L",x)[0],p>1){o=[];for(var d=0;d<p;d++)o.push([C(this.endian_mark+"L",this.tiftag.slice(f+d*8,f+4+d*8))[0],C(this.endian_mark+"L",this.tiftag.slice(f+4+d*8,f+8+d*8))[0]])}else o=[C(this.endian_mark+"L",this.tiftag.slice(f,f+4))[0],C(this.endian_mark+"L",this.tiftag.slice(f+4,f+8))[0]];else if(l==7)p>4?(f=C(this.endian_mark+"L",x)[0],o=this.tiftag.slice(f,f+p)):o=x.slice(0,p);else if(l==9)p>1?(f=C(this.endian_mark+"L",x)[0],o=C(this.endian_mark+b("l",p),this.tiftag.slice(f,f+p*4))):o=C(this.endian_mark+b("l",p),x);else if(l==10)if(f=C(this.endian_mark+"L",x)[0],p>1){o=[];for(var d=0;d<p;d++)o.push([C(this.endian_mark+"l",this.tiftag.slice(f+d*8,f+4+d*8))[0],C(this.endian_mark+"l",this.tiftag.slice(f+4+d*8,f+8+d*8))[0]])}else o=[C(this.endian_mark+"l",this.tiftag.slice(f,f+4))[0],C(this.endian_mark+"l",this.tiftag.slice(f+4,f+8))[0]];else throw new Error("Exif might be wrong. Got incorrect value type to decode. type:"+l);return o instanceof Array&&o.length==1?o[0]:o}},typeof window<"u"&&typeof window.btoa=="function")var u=window.btoa;if(typeof u>"u")var u=function(o){for(var l="",p,x,f,d,E,D,I,R=0,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";R<o.length;)p=o.charCodeAt(R++),x=o.charCodeAt(R++),f=o.charCodeAt(R++),d=p>>2,E=(p&3)<<4|x>>4,D=(x&15)<<2|f>>6,I=f&63,isNaN(x)?D=I=64:isNaN(f)&&(I=64),l=l+w.charAt(d)+w.charAt(E)+w.charAt(D)+w.charAt(I);return l};if(typeof window<"u"&&typeof window.atob=="function")var S=window.atob;if(typeof S>"u")var S=function(o){var l="",p,x,f,d,E,D,I,R=0,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(o=o.replace(/[^A-Za-z0-9\+\/\=]/g,"");R<o.length;)d=w.indexOf(o.charAt(R++)),E=w.indexOf(o.charAt(R++)),D=w.indexOf(o.charAt(R++)),I=w.indexOf(o.charAt(R++)),p=d<<2|E>>4,x=(E&15)<<4|D>>2,f=(D&3)<<6|I,l=l+String.fromCharCode(p),D!=64&&(l=l+String.fromCharCode(x)),I!=64&&(l=l+String.fromCharCode(f));return l};function g(n,o){if(!(o instanceof Array))throw new Error("'pack' error. Got invalid type argument.");if(n.length-1!=o.length)throw new Error("'pack' error. "+(n.length-1)+" marks, "+o.length+" elements.");var l;if(n[0]=="<")l=!0;else if(n[0]==">")l=!1;else throw new Error("");for(var p="",x=1,f=null,d=null,E=null;d=n[x];){if(d.toLowerCase()=="b"){if(f=o[x-1],d=="b"&&f<0&&(f+=256),f>255||f<0)throw new Error("'pack' error.");E=String.fromCharCode(f)}else if(d=="H"){if(f=o[x-1],f>65535||f<0)throw new Error("'pack' error.");E=String.fromCharCode(Math.floor(f%65536/256))+String.fromCharCode(f%256),l&&(E=E.split("").reverse().join(""))}else if(d.toLowerCase()=="l"){if(f=o[x-1],d=="l"&&f<0&&(f+=4294967296),f>4294967295||f<0)throw new Error("'pack' error.");E=String.fromCharCode(Math.floor(f/16777216))+String.fromCharCode(Math.floor(f%16777216/65536))+String.fromCharCode(Math.floor(f%65536/256))+String.fromCharCode(f%256),l&&(E=E.split("").reverse().join(""))}else throw new Error("'pack' error.");p+=E,x+=1}return p}function C(n,o){if(typeof o!="string")throw new Error("'unpack' error. Got invalid type argument.");for(var l=0,p=1;p<n.length;p++)if(n[p].toLowerCase()=="b")l+=1;else if(n[p].toLowerCase()=="h")l+=2;else if(n[p].toLowerCase()=="l")l+=4;else throw new Error("'unpack' error. Got invalid mark.");if(l!=o.length)throw new Error("'unpack' error. Mismatch between symbol and string length. "+l+":"+o.length);var x;if(n[0]=="<")x=!0;else if(n[0]==">")x=!1;else throw new Error("'unpack' error.");for(var f=[],d=0,E=1,D=null,I=null,R=null,w="";I=n[E];){if(I.toLowerCase()=="b")R=1,w=o.slice(d,d+R),D=w.charCodeAt(0),I=="b"&&D>=128&&(D-=256);else if(I=="H")R=2,w=o.slice(d,d+R),x&&(w=w.split("").reverse().join("")),D=w.charCodeAt(0)*256+w.charCodeAt(1);else if(I.toLowerCase()=="l")R=4,w=o.slice(d,d+R),x&&(w=w.split("").reverse().join("")),D=w.charCodeAt(0)*16777216+w.charCodeAt(1)*65536+w.charCodeAt(2)*256+w.charCodeAt(3),I=="l"&&D>=2147483648&&(D-=4294967296);else throw new Error("'unpack' error. "+I);f.push(D),d+=R,E+=1}return f}function b(n,o){for(var l="",p=0;p<o;p++)l+=n;return l}function T(n){if(n.slice(0,2)!="ÿØ")throw new Error("Given data isn't JPEG.");for(var o=2,l=["ÿØ"];;){if(n.slice(o,o+2)=="ÿÚ"){l.push(n.slice(o));break}else{var p=C(">H",n.slice(o+2,o+4))[0],x=o+p+2;l.push(n.slice(o,x)),o=x}if(o>=n.length)throw new Error("Wrong JPEG data.")}return l}function L(n){for(var o,l=0;l<n.length;l++)if(o=n[l],o.slice(0,2)=="ÿá"&&o.slice(4,10)=="Exif\0\0")return o;return null}function G(n,o){var l=!1,p=[];return n.forEach(function(x,f){x.slice(0,2)=="ÿá"&&x.slice(4,10)=="Exif\0\0"&&(l?p.unshift(f):(n[f]=o,l=!0))}),p.forEach(function(x){n.splice(x,1)}),!l&&o&&(n=[n[0],o].concat(n.slice(1))),n.join("")}var F={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},A={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};A["0th"]=A.Image,A["1st"]=A.Image,i.TAGS=A,i.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},i.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},i.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},i.InteropIFD={InteroperabilityIndex:1},i.GPSHelper={degToDmsRational:function(n){var o=Math.abs(n),l=o%1*60,p=l%1*60,x=Math.floor(o),f=Math.floor(l),d=Math.round(p*100);return[[x,1],[f,1],[d,100]]},dmsRationalToDeg:function(n,o){var l=o==="S"||o==="W"?-1:1,p=n[0][0]/n[0][1]+n[1][0]/n[1][1]/60+n[2][0]/n[2][1]/3600;return p*l}},t.exports&&(e=t.exports=i),e.piexif=i})()})(ge,ge.exports)),ge.exports}gi();async function di(t,e,i,r){const a=await O.Session.get(t);if(!a)throw new Error(`Session ${t} introuvable`);const s=await O.Protocol.get(a.protocol);if(!s)throw new Error(`Protocole ${a.protocol} introuvable`);const c=await O.Metadata.list().then(y=>y.filter(u=>s.metadata.includes(u.id))),m=_e("js"),h=await Si(i.slice(0,65635),(c??[]).map(({infer:y,type:u,id:S})=>pt.case([{exif:"string"},"|",{latitude:{exif:"string"},longitude:{exif:"string"}}],g=>({key:S,infer:g,type:u})).default(()=>{})(y)).filter(y=>y!==void 0)).catch(y=>(console.warn(y),r.type==="image/jpeg"&&_.warn(m(488,[r.name,y?.toString()??m(85)])),{})),P=await Lt("Image").then(y=>y.filter(u=>u.fileId===e));for(const{id:y}of P)for(const[u,{value:S,confidence:g}]of Object.entries(h))await Jt({db:mt(),subjectId:y,sessionId:a.id,metadataId:Bt(u,s.id),value:S,confidence:g})}async function Si(t,e){const i=hi.create(t).enableImageSize(!1).parse();if(!i)return{};console.debug("Starting EXIF Extraction",{extractionPlan:e,exif:i});const r=pt.case({type:'"location"',infer:{latitude:{exif:"string"},longitude:{exif:"string"}}},({infer:a})=>{if(a.longitude.exif in i.tags&&a.latitude.exif in i.tags)return{confidence:1,alternatives:{},value:{longitude:Le(i.tags[a.longitude.exif],"float"),latitude:Le(i.tags[a.latitude.exif],"float")}}}).case({type:Tt.MetadataTypeSchema,infer:{exif:"string"}},({infer:a,type:s})=>{if(a.exif in i.tags)return{confidence:1,alternatives:{},value:Le(i.tags[a.exif],s)}}).default(()=>{});return Object.fromEntries(e.map(({key:a,...s})=>[a,r(s)]).filter(([,a])=>a!==void 0&&!de({latitude:"number.NaN",longitude:"number.NaN"}).allows(a.value)&&!Number.isNaN(a.value)))}function Le(t,e){switch(e){case"string":return t?.toString()??"";case"boolean":return!!t;case"date":if(typeof t!="number")throw new Error("Date value must be a number");if(Number.isNaN(t))throw new Error("Date value is invalid");return new Date(t*1e3);case"boundingbox":throw new Error("Bounding box not supported in EXIF");case"enum":if(typeof t!="string")throw new Error("Enum value must be a string");return t;case"integer":case"float":return Number(t);default:throw new Error(`Unknown type ${e}`)}}const cn=["image/jpeg","application/zip","image/png","image/tiff",".cr2",".rw2",".dng",".crw",".raw",".cr3"];async function yi(t,e){const i=ye("main");if(!v.currentProtocol){_.error(i(34));return}const r=await t.arrayBuffer();if(r.byteLength>$t.maxMemoryUsageInMB*Math.pow(2,20)){_.error(xt());return}const[[a,s],c]=await ht({source:t});await gt({id:e,resizedBytes:c,originalBytes:r,contentType:t.type,filename:t.name,width:a,height:s}),await O.Image.set({id:Me(e,0),sessionId:v.currentSessionId,filename:t.name,addedAt:dt(Date.now()),contentType:t.type,dimensions:{width:a,height:s},fileId:e,metadata:{}}),v.processing.removeFile(e),await di(v.currentSessionId,e,r,t).catch(m=>{console.error(m);const h=ye("main");_.error(h(86,[t.name]))})}async function Ci(t,e,i){const r=ye("main");if(!v.currentProtocol){_.error(r(34));return}const a=Ue(v.cropModels.at(v.selectedCropModel));if(!a)return;const s=await O.Image.get(Me(i,0));if(!s)throw new Error(`Image ${i} not found in database`);if(!s.fileId)throw new Error(`Image ${i} has no associated ImageFile in database`);const c=t.inferBoundingBoxes.cancelable({fileId:s.fileId,taskSettings:a});e?.set(s.fileId,c.cancel);const{boxes:m,scores:h}=await c.request.catch(S=>/(maxMemoryUsageInMB|maxResolutionInMP) limit exceeded/.test(S?.toString())?Promise.reject(new Error(xt())):Promise.reject(S));let[P]=m,[y]=h;if(!P||!y){await O.Image.update(s.id,"boundingBoxesAnalyzed",!0);return}const u=([S,g,C,b])=>Zt(a.input)({x:S,y:g,w:C,h:b});for(let S=0;S<m.length;S++)await O.Image.set({...s,id:Me(s.fileId,S),addedAt:dt(S===0?s.addedAt:Date.now()),boundingBoxesAnalyzed:!0,metadata:{...Xt(s.metadata),[v.cropMetadataId]:{value:JSON.stringify(u(m[S])),confidence:h[S],alternatives:{},manuallyModified:!1}}})}async function un(){const t=_e("js");if(Notification.permission==="default")try{await Notification.requestPermission()}catch(e){console.error("Notification permission request failed",e)}else Notification.permission==="denied"&&_.error(t(501))}async function vi(t,e){Pi()&&new Notification(t,e)}function Pi(){return Notification.permission==="granted"&&Kt().notifications}var N=Uint8Array,oe=Uint16Array,Ii=Int32Array,yt=new N([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ct=new N([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bi=new N([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vt=function(t,e){for(var i=new oe(31),r=0;r<31;++r)i[r]=e+=1<<t[r-1];for(var a=new Ii(i[30]),r=1;r<30;++r)for(var s=i[r];s<i[r+1];++s)a[s]=s-i[r]<<5|r;return{b:i,r:a}},Pt=vt(yt,2),It=Pt.b,Di=Pt.r;It[28]=258,Di[258]=28;var Ei=vt(Ct,0),Ai=Ei.b,Oe=new oe(32768);for(var B=0;B<32768;++B){var Z=(B&43690)>>1|(B&21845)<<1;Z=(Z&52428)>>2|(Z&13107)<<2,Z=(Z&61680)>>4|(Z&3855)<<4,Oe[B]=((Z&65280)>>8|(Z&255)<<8)>>1}var pe=(function(t,e,i){for(var r=t.length,a=0,s=new oe(e);a<r;++a)t[a]&&++s[t[a]-1];var c=new oe(e);for(a=1;a<e;++a)c[a]=c[a-1]+s[a-1]<<1;var m;if(i){m=new oe(1<<e);var h=15-e;for(a=0;a<r;++a)if(t[a])for(var P=a<<4|t[a],y=e-t[a],u=c[t[a]-1]++<<y,S=u|(1<<y)-1;u<=S;++u)m[Oe[u]>>h]=P}else for(m=new oe(r),a=0;a<r;++a)t[a]&&(m[a]=Oe[c[t[a]-1]++]>>15-t[a]);return m}),xe=new N(288);for(var B=0;B<144;++B)xe[B]=8;for(var B=144;B<256;++B)xe[B]=9;for(var B=256;B<280;++B)xe[B]=7;for(var B=280;B<288;++B)xe[B]=8;var bt=new N(32);for(var B=0;B<32;++B)bt[B]=5;var wi=pe(xe,9,1),Fi=pe(bt,5,1),Be=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},j=function(t,e,i){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(e&7)&i},Te=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(e&7)},Ri=function(t){return(t+7)/8|0},Ve=function(t,e,i){return(e==null||e<0)&&(e=0),(i==null||i>t.length)&&(i=t.length),new N(t.subarray(e,i))},Li=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],U=function(t,e,i){var r=new Error(e||Li[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,U),!i)throw r;return r},Bi=function(t,e,i,r){var a=t.length,s=r?r.length:0;if(!a||e.f&&!e.l)return i||new N(0);var c=!i,m=c||e.i!=2,h=e.i;c&&(i=new N(a*3));var P=function(ee){var re=i.length;if(ee>re){var se=new N(Math.max(re*2,ee));se.set(i),i=se}},y=e.f||0,u=e.p||0,S=e.b||0,g=e.l,C=e.d,b=e.m,T=e.n,L=a*8;do{if(!g){y=j(t,u,1);var G=j(t,u+1,3);if(u+=3,G)if(G==1)g=wi,C=Fi,b=9,T=5;else if(G==2){var o=j(t,u,31)+257,l=j(t,u+10,15)+4,p=o+j(t,u+5,31)+1;u+=14;for(var x=new N(p),f=new N(19),d=0;d<l;++d)f[bi[d]]=j(t,u+d*3,7);u+=l*3;for(var E=Be(f),D=(1<<E)-1,I=pe(f,E,1),d=0;d<p;){var R=I[j(t,u,D)];u+=R&15;var F=R>>4;if(F<16)x[d++]=F;else{var w=0,q=0;for(F==16?(q=3+j(t,u,3),u+=2,w=x[d-1]):F==17?(q=3+j(t,u,7),u+=3):F==18&&(q=11+j(t,u,127),u+=7);q--;)x[d++]=w}}var X=x.subarray(0,o),M=x.subarray(o);b=Be(X),T=Be(M),g=pe(X,b,1),C=pe(M,T,1)}else U(1);else{var F=Ri(u)+4,A=t[F-4]|t[F-3]<<8,n=F+A;if(n>a){h&&U(0);break}m&&P(S+A),i.set(t.subarray(F,n),S),e.b=S+=A,e.p=u=n*8,e.f=y;continue}if(u>L){h&&U(0);break}}m&&P(S+131072);for(var z=(1<<b)-1,te=(1<<T)-1,k=u;;k=u){var w=g[Te(t,u)&z],V=w>>4;if(u+=w&15,u>L){h&&U(0);break}if(w||U(2),V<256)i[S++]=V;else if(V==256){k=u,g=null;break}else{var ie=V-254;if(V>264){var d=V-257,H=yt[d];ie=j(t,u,(1<<H)-1)+It[d],u+=H}var ne=C[Te(t,u)&te],K=ne>>4;ne||U(3),u+=ne&15;var M=Ai[K];if(K>3){var H=Ct[K];M+=Te(t,u)&(1<<H)-1,u+=H}if(u>L){h&&U(0);break}m&&P(S+131072);var ae=S+ie;if(S<M){var Y=s-M,he=Math.min(M,ae);for(Y+S<0&&U(3);S<he;++S)i[S]=r[Y+S]}for(;S<ae;++S)i[S]=i[S-M]}}e.l=g,e.p=k,e.b=S,e.f=y,g&&(y=1,e.m=b,e.d=C,e.n=T)}while(!y);return S!=i.length&&c?Ve(i,0,S):i.subarray(0,S)},Ti=new N(0),J=function(t,e){return t[e]|t[e+1]<<8},W=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},Ge=function(t,e){return W(t,e)+W(t,e+4)*4294967296};function Gi(t,e){return Bi(t,{i:2},e&&e.out,e&&e.dictionary)}var ke=typeof TextDecoder<"u"&&new TextDecoder,Mi=0;try{ke.decode(Ti,{stream:!0}),Mi=1}catch{}var Oi=function(t){for(var e="",i=0;;){var r=t[i++],a=(r>127)+(r>223)+(r>239);if(i+a>t.length)return{s:e,r:Ve(t,i-1)};a?a==3?(r=((r&15)<<18|(t[i++]&63)<<12|(t[i++]&63)<<6|t[i++]&63)-65536,e+=String.fromCharCode(55296|r>>10,56320|r&1023)):a&1?e+=String.fromCharCode((r&31)<<6|t[i++]&63):e+=String.fromCharCode((r&15)<<12|(t[i++]&63)<<6|t[i++]&63):e+=String.fromCharCode(r)}};function Dt(t,e){if(e){for(var i="",r=0;r<t.length;r+=16384)i+=String.fromCharCode.apply(null,t.subarray(r,r+16384));return i}else{if(ke)return ke.decode(t);var a=Oi(t),s=a.s,i=a.r;return i.length&&U(8),s}}var ki=function(t,e){return e+30+J(t,e+26)+J(t,e+28)},Ni=function(t,e,i){var r=J(t,e+28),a=Dt(t.subarray(e+46,e+46+r),!(J(t,e+8)&2048)),s=e+46+r,c=W(t,e+20),m=i&&c==4294967295?Ui(t,s):[c,W(t,e+24),W(t,e+42)],h=m[0],P=m[1],y=m[2];return[J(t,e+10),h,P,a,s+J(t,e+30)+J(t,e+32),y]},Ui=function(t,e){for(;J(t,e)!=1;e+=4+J(t,e+2));return[Ge(t,e+12),Ge(t,e+4),Ge(t,e+20)]};function ut(t,e){for(var i={},r=t.length-22;W(t,r)!=101010256;--r)(!r||t.length-r>65558)&&U(13);var a=J(t,r+8);if(!a)return{};var s=W(t,r+16),c=s==4294967295||a==65535;if(c){var m=W(t,r-12);c=W(t,m)==101075792,c&&(a=W(t,m+32),s=W(t,m+48))}for(var h=e&&e.filter,P=0;P<a;++P){var y=Ni(t,s,c),u=y[0],S=y[1],g=y[2],C=y[3],b=y[4],T=y[5],L=ki(t,T);s=b,(!h||h({name:C,size:S,originalSize:g,compression:u}))&&(u?u==8?i[C]=Gi(t.subarray(L,L+S),{out:new N(g)}):U(14,"unknown compression type "+u):i[C]=Ve(t,L,L+S))}return i}const _i=de({observations:de.Record("string",kt).describe("Associe l'ID d'une observation à son label et les valeurs de ses métadonnées"),session:Gt.omit("metadata").and({metadata:Ye(Ot),protocolMetadata:Ye(Mt).default(()=>({}))}).describe("La session d'analyse"),files:de.Record("string","string").describe("Associe une référence de fichier à son chemin dans le .zip d'exportation. Les références de fichiers sont les valeurs des métadonnées de type 'file'").default(()=>({}))});async function mn(t){await Nt(["Session","Observation","Image","ImageFile","ImagePreviewFile"],{mode:"readwrite"},async e=>{e.objectStore("Session").delete(t);const i=await e.objectStore("Observation").index("sessionId").getAll(t);for(const a of i)e.objectStore("Observation").delete(a.id);const r=await e.objectStore("Image").index("sessionId").getAll(t);for(const a of r)e.objectStore("Image").delete(a.id),e.objectStore("ImageFile").delete(Se(a.id)),e.objectStore("ImagePreviewFile").delete(Se(a.id))})}async function zi(t){v.setCurrentSession(t),v.clearPreviewURLs(),ei.clear();const e=_e("js");je(i=>i.cancelAll(e(513))),await O.initialize(t)}async function Vi(t,e){const i=new Uint8Array(await t.arrayBuffer()),r=ut(i,{filter:({name:u})=>u===Vt}),a=ye("main");if(Object.keys(r).length===0){v.processing.removeFile(e),_.error(a(32,[t.name]));return}const[s]=Object.values(r).map(u=>Dt(u)).map(Ut).map(u=>u?_i(u):void 0);if(s===void 0){v.processing.removeFile(e),_.error(a(113,[t.name]));return}if(s instanceof _t){v.processing.removeFile(e),_.error(a(93,[t.name,s.summary]));return}const{session:c,observations:m}=s;let h;if(v.currentSession)if(v.currentSession.protocol!==c.protocol){v.processing.removeFile(e),_.error(a(364,[t.name,c.protocol,v.currentSession.protocol]));return}else h=v.currentSession;else{_.info(a(363));const u=await O.Session.add({...c,name:c.name||`Import de ${t.name}`,description:c.description||`Importée depuis ${t.name}`,protocol:c.protocol,createdAt:new Date().toISOString(),openedAt:new Date().toISOString(),metadata:Ce(c.metadata??{},({value:S,...g})=>({...g,value:ve(S)}))});await zi(u.id),h=u}const P=Object.values(m).flatMap(u=>u.images).map(u=>({id:u.id,name:u.exportedAs.original}));v.processing.files.push(...P);const y=ut(i,{filter:({name:u})=>P.some(S=>S.name===u)});if(Object.keys(y).length===0){v.processing.removeFile(e),v.processing.files=v.processing.files.filter(u=>!P.find(S=>S.id===u.id)),_.error(a(38,[t.name]));return}for(const[u,S]of $e(y)){const g=P.find(A=>A.name===u)?.id;if(!g)continue;const C=$e(m).map(([A,n])=>({id:A,...n})).find(A=>A.images.some(n=>n.exportedAs.original===u));if(!C){v.processing.removeFile(g);continue}const b=C.images.find(A=>A.exportedAs.original===u);if(!b){v.processing.removeFile(g);continue}await O.Observation.set({...Qe(C,"id","label"),sessionId:h.id,images:C.images.map(A=>A.id),addedAt:new Date().toISOString(),metadataOverrides:Ce(C.metadata,A=>({value:ve(A.value),confidence:A.confidence,manuallyModified:A.manuallyModified,alternatives:A.alternatives}))});const T=zt(S),[[L,G],F]=await ht({source:new File([T],b.filename,{type:b.contentType})});await gt({id:Se(b.id),sessionId:h.id,resizedBytes:F,originalBytes:T,contentType:b.contentType,filename:b.filename,width:L,height:G}),await O.Image.set({...Qe(b,"id","filename","contentType"),sessionId:h.id,dimensions:{width:L,height:G},fileId:Se(b.id),boundingBoxesAnalyzed:!0,addedAt:new Date().toISOString(),metadata:Ce(b.metadata,A=>({value:ve(A.value),confidence:A.confidence,manuallyModified:A.manuallyModified,alternatives:A.alternatives}))}),v.processing.removeFile(b.id)}v.processing.removeFile(e)}let Ne;class Hi{constructor({swarpc:e,cancellers:i,parallelism:r=1}){this.swarpc=e,this.cancellers=i,this.parallelism=r,this.tasks=[],this.taskIds=new Set,this.abortController=new AbortController,Xe(()=>{this.start().finally(()=>this.logWarning(null,"Processing queue mainloop exited"))}),Xe(()=>{this.log(null,"Progress is",v.processing.done,"/",v.processing.total)})}async start(){for(this.log(null,`Starting processing queue mainloop with up to ${this.parallelism} concurrent tasks`);;){for(;this.tasks.length>0;)await new Promise((e,i)=>{this.abortController.signal.addEventListener("abort",()=>{e(void 0)}),Promise.allSettled(Ht(this.parallelism).map(async()=>this.pop())).then(r=>{r.some(a=>a.status==="rejected")?i(r.filter(a=>a.status==="rejected").map(a=>a.reason)):e(void 0),v.processing.done+=r.length,this.tasks.length===0&&this.#e()})});await new Promise(e=>setTimeout(e,100))}}log(e,i,...r){console.debug(`[ProcessingQueue] ${e?e+": ":""}${i}`,...r)}logWarning(e,i,...r){console.warn(`[ProcessingQueue] ${e?e+": ":""}${i}`,...r)}#e(){this.log(null,"Queue was drained"),v.loadingImages.clear(),v.queuedImages.clear(),document.dispatchEvent(new CustomEvent("processing-queue-drained")),setTimeout(()=>{v.processing.reset()},500)}taskSubjectId(e){if(e.importing)return e.importing.id;if(e.detection)return e.detection.fileId;if(e.classification)return e.classification.imageId;throw new Error("Task must have either importing, detection or classification")}taskId(e){return this.taskSubjectId(e)}push(e){const i=this.taskId(e);if(this.taskIds.has(i)){this.logWarning(i,"Task already in queue, skipping.",e);return}this.log(i,"push",e),this.tasks.push(e),this.taskIds.add(this.taskId(e)),v.processing.total++,v.queuedImages.add(this.taskSubjectId(e)),e.importing&&v.processing.files.push({name:e.importing.file.name,id:e.importing.id,addedAt:new Date})}cancel(e,i){this.log(e,"cancel",i),this.abortController.abort(e),this.cancellers?.get(e)?.(i),this.tasks=this.tasks.filter(a=>this.taskSubjectId(a)!==e),v.processing.removeFile(e),v.queuedImages.delete(e),v.loadingImages.delete(e),v.processing.total--}cancelAll(e){if(!this.cancellers)throw new Error("No cancellers map set, cannot cancel all tasks.");for(const i of this.cancellers.keys())this.cancel(i,e)}async pop(){const e=this.tasks.shift();if(!e){this.logWarning(null,"No task to pop, queue is empty");return}this.log(this.taskId(e),"pop",Ue(e)),this.taskIds.delete(this.taskId(e)),v.queuedImages.delete(this.taskSubjectId(e)),v.loadingImages.add(this.taskSubjectId(e));const{detection:i,classification:r,importing:a}=e;v.processing.task=a?"import":i?"detection":"classification";try{if(a){const{file:s,id:c}=a;jt(s.type)?await Vi(s,c):await yi(s,c)}else i?await Ci(this.swarpc,this.cancellers,i.fileId):r&&await ri(this.swarpc,r.imageId,this.cancellers);v.processing.removeFile(this.taskSubjectId(e))}catch(s){v.erroredImages.set(this.taskSubjectId(e),Wt(s))}finally{v.loadingImages.delete(this.taskSubjectId(e))}}}function pn(t){He(t.map(e=>({importing:{file:e,id:Qt()}})),{title:"Import des images terminé",body:ze(t.length,["1 image importée","# images importées"]),tag:"import-complete"})}function xn(t){He(t.map(e=>({detection:{fileId:e}})),{title:"Détection terminée",body:ze(t.length,["1 image traitée","# images traitées"]),tag:"detection-complete"})}function hn(t){He(t.map(e=>({classification:{imageId:e}})),{title:"Classification terminée",body:ze(t.length,["1 image classée","# images classées"]),tag:"classification-complete"})}function gn(t,e){je(i=>i.cancel(t,e))}function He(t,{title:e,...i}){Promise.all(t.map(r=>je(a=>a.push(r)))).then(()=>{t.length!==0&&vi(e,{icon:"/icon.png",badge:"/badge.png",...i})})}function ji(t){if(!t)throw new Error("Processing queue not initialized. Call initializeProcessingQueue first.")}function dn(t){Ne??=new Hi({parallelism:Math.ceil(navigator.hardwareConcurrency/2),...t})}function je(t){return ji(Ne),t(Ne)}export{cn as A,ti as R,oi as a,gn as b,hn as c,xn as d,mn as e,vi as f,on as g,et as h,pn as i,sn as j,fn as k,ln as l,un as m,Pi as n,dn as o,zi as s,rn as z};
