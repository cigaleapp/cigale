import"./DsnmJJEf.js";import{a as W,b as E,c as Q,s as X}from"./08d27X49.js";import{f as Y,a as C,p as Z,H,ap as v,b as tt,as as B,g as t,aq as at,u as n,ar as c,J as p,aL as et,G as ot}from"./BwdvgNQo.js";import{e as st,s as rt}from"./HTLptRgQ.js";import{s as it}from"./DYy3QkOc.js";import{c as nt}from"./CxwMZO45.js";import{t as lt,f as dt}from"./BjiNJ5CV.js";import{e as pt}from"./ft-thZGf.js";import{V as mt}from"./BCMEp0xP.js";import{A as ct}from"./BsYyX4S0.js";import{C as ut}from"./D0DqjGxz.js";import{D as vt}from"./DBaFXsNm.js";import{r as ft}from"./CKH9F0ww.js";import{i as J}from"./BDV6zAFm.js";import{p as l}from"./BzM0mbGE.js";import{B as I}from"./LNwaZJFt.js";import{d as T,H as ht,I as q,J as _t,K as gt,e as bt}from"./Don2Ydo1.js";import{I as z}from"./BWUfZxGx.js";import{g as O}from"./DyfjURbU.js";import{t as U}from"./BYqiwRWy.js";import{r as jt}from"./BRmTdaxr.js";var wt=Y('<svg><path fill="currentColor" d="m18.031 16.617l4.283 4.282l-1.415 1.415l-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9s9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617m-2.006-.742A6.98 6.98 0 0 0 18 11c0-3.867-3.133-7-7-7s-7 3.133-7 7s3.133 7 7 7a6.98 6.98 0 0 0 4.875-1.975z"></path></svg>');function yt(d,o){const r=ft(o,["$$slots","$$events","$$legacy"]);var m=wt();W(m,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...r})),C(d,m)}async function $t(d,o){const r=l.data.options??[],m=structuredClone(r.find(f=>f.key===d));if(!m)throw pt(404,`Option avec clé ${d} introuvable`);l.data.options=r.filter(f=>f.key!==d);const u=l.route.id==="/(app)/protocols/[id]/metadata/[metadata]/options/[option]"&&l.params.option===d;u&&await O("/(app)/protocols/[id]/metadata/[metadata]/options",{id:l.params.id??"",metadata:l.params.metadata??""}),U.withUndo("info",`Option ${o||d} supprimée`,{async commit(){await ht("MetadataOption",m.id)},async undo(){await J(T("Metadata",l.data.metadata.id,"options")),u&&await O("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:l.params.id??"",metadata:l.params.metadata??"",option:d})}})}var kt=H('<div><a class="svelte-puhjjd"> </a> <div class="delete svelte-puhjjd"><!></div></div>'),It=H('<div class="aside-and-main svelte-puhjjd"><aside class="svelte-puhjjd"><search class="svelte-puhjjd"><!> <!> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></search> <form class="new-option svelte-puhjjd"><!> <!></form> <nav class="svelte-puhjjd"><!></nav></aside> <div class="content svelte-puhjjd"><!></div></div>');function Wt(d,o){Z(o,!0);const r=n(()=>E("main"));let m=n(()=>l.data.options??[]),u=at("");const f=n(()=>t(m).filter(e=>[e.key,e.label].some(a=>!t(u)||a.toLowerCase().includes(t(u).toLowerCase()))));async function V(e){e.preventDefault();const a=e.currentTarget.elements.item(0);if(!a?.value)return;let i=_t(a.value).replaceAll("-","_");t(m).find(s=>s.key===i)&&(i+="_"+t(m).filter(s=>s.key.startsWith(i)).length);try{await gt("MetadataOption",{id:`${o.data.metadata.id}:${i}`,metadataId:o.data.metadata.id,key:i,label:a.value,description:""}),a.value="",await J(T("Metadata",o.data.metadata.id,"options")),await O("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:o.data.protocol.id,metadata:q(o.data.metadata.id),option:i})}catch(s){U.error(bt(s,"Impossible de créer l'option"))}}var _=It(),w=c(_),y=c(w),x=c(y);yt(x,{});var M=v(x,2);{let e=n(()=>t(r)(300)),a=n(()=>t(r)(301));z(M,{discreet:!0,get label(){return t(e)},get placeholder(){return t(a)},onblur:()=>{},get value(){return t(u)},set value(i){B(u,i,!0)}})}var $=v(M,2);{let e=n(()=>t(r)(302));nt($,()=>({"--font-size":"0.7em"})),I($.lastChild,{onclick:()=>B(u,""),get help(){return t(e)},children:(a,i)=>{ut(a,{})},$$slots:{default:!0}}),p($)}p(y);var g=v(y,2),A=c(g);{let e=n(()=>t(r)(303)),a=n(()=>t(r)(304));z(A,{discreet:!0,get label(){return t(e)},get placeholder(){return t(a)},value:"",onblur:()=>{}})}var F=v(A,2);{let e=n(()=>t(r)(305));I(F,{submits:!0,get help(){return t(e)},onclick:()=>{},children:(a,i)=>{ct(a,{})},$$slots:{default:!0}})}p(g);var D=v(g,2),G=c(D);mt(G,{get items(){return t(f)},children:et,$$slots:{default:(e,a)=>{const i=n(()=>a.item),s=n(()=>{const{key:h,label:k}=t(i);return{key:h,label:k}});var b=kt();let P;var j=c(b),N=c(j,!0);p(j);var R=v(j,2),S=c(R);{let h=n(()=>t(r)(306,[t(s).label||t(s).key]));I(S,{dangerous:!0,get help(){return t(h)},onclick:async()=>$t(t(s).key,t(s).label),children:(k,Ct)=>{vt(k,{})},$$slots:{default:!0}})}p(R),p(b),ot(h=>{P=Q(b,1,"navlink svelte-puhjjd",null,P,{active:l.params.option===t(s).key}),X(j,"href",h),rt(N,t(s).label)},[()=>jt("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:o.data.protocol.id,metadata:q(o.data.metadata.id),option:t(s).key})]),C(e,b)}}}),p(D),p(w);var L=v(w,2),K=c(L);it(K,()=>o.children),p(L),p(_),st("submit",g,V),lt(1,_,()=>dt,()=>({duration:100})),C(d,_),tt()}export{Wt as _,$t as o};
