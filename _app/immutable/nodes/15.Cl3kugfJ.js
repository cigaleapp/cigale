import{g as Ha}from"../chunks/D9eftTZy.js";import{t as Ye,f as za,r as Ve,ap as Xe,m as Bt,a1 as Be,a as Fa,aq as Xt,$ as Ta,D as Qt,ar as La,R as qa}from"../chunks/Don2Ydo1.js";import{e as Qe,h as Na,j as Ua,k as At,d as Ga}from"../chunks/DfkTl275.js";import{u as v}from"../chunks/BPJfxdhi.js";import"../chunks/DsnmJJEf.js";import{f as Ae,a as m,aq as N,g as e,as as x,aR as me,u as i,p as Et,ao as ot,H as O,bI as Wa,ar as p,ap as u,I as Ze,J as f,G as W,b as jt,aI as Ja,at as Me,D as se,C as et,b2 as ea,F as tt}from"../chunks/BwdvgNQo.js";import{d as ua,e as Vt,b as fe,s as be,r as Ya}from"../chunks/HTLptRgQ.js";import{s as We}from"../chunks/CuKI1hs9.js";import{r as Se,p as Dt,i as te,s as Za}from"../chunks/CKH9F0ww.js";import{c as Ka}from"../chunks/CxwMZO45.js";import{e as De,i as ta}from"../chunks/CuPIRSst.js";import{h as Xa}from"../chunks/CrbDnXoH.js";import{c as aa}from"../chunks/CaPT1Hnn.js";import{a as He,t as ze,K as ra}from"../chunks/C6sIn56-.js";import{a as Ce,c as qe,s as Ke,d as Le,b as Qa}from"../chunks/08d27X49.js";import{b as ha}from"../chunks/DB45Zn9a.js";import{w as va}from"../chunks/2OzU4e1W.js";import{A as er}from"../chunks/BAWXbWKH.js";import{C as tr,A as ar,a as St,b as rr}from"../chunks/CUcmaFVW.js";import{A as ir}from"../chunks/k3WAnOGP.js";import{A as sr}from"../chunks/xJVponh6.js";import{C as or}from"../chunks/Bf6VYV6I.js";import{D as ia}from"../chunks/DBaFXsNm.js";import{F as nr}from"../chunks/BbsYXVtf.js";import{S as lr}from"../chunks/BUsPvKjg.js";import{w as cr,b as Pt,t as Fe,d as dr,e as Te,F as ur,f as hr}from"../chunks/Bd7_h5c3.js";import{B as Je}from"../chunks/LNwaZJFt.js";import{B as Ct}from"../chunks/DfpvCGjf.js";import{B as Ot}from"../chunks/DgJA6oA6.js";import{C as vr}from"../chunks/BPQ-1h3f.js";import{C as mr}from"../chunks/BlwUordC.js";import{i as sa,a as oa,s as fr,t as gr}from"../chunks/CEoeiZ5P.js";import{u as ye,d as pr}from"../chunks/iDw1HNQ9.js";import{L as br}from"../chunks/DkW1Bdbi.js";import{h as _r,a as wr}from"../chunks/BeqcFVE5.js";import{d as $t,a as st}from"../chunks/BhEwWWID.js";import{O as xr}from"../chunks/gmcJWo7k.js";import{g as ce}from"../chunks/DyfjURbU.js";import{P as na}from"../chunks/BRQ5Qhft.js";import{s as yr}from"../chunks/DYy3QkOc.js";import{s as kr}from"../chunks/B2RSv_jY.js";import{S as Ir}from"../chunks/qerflRe8.js";import{t as la}from"../chunks/BYqiwRWy.js";import{T as Mr}from"../chunks/BxmDjSVm.js";import{R as pe}from"../chunks/DWCXZatK.js";import{f as Ar}from"../chunks/YICrNYhN.js";async function Sr({parent:C}){if(await C(),!v.currentSessionId)throw new Error("Aucune session active");const r=v.currentSession?.group.crop??v.currentSession?.group.global,d=v.currentSession?.sort.crop??v.currentSession?.sort.global,o=await Ye.Image.list("sessionId",v.currentSessionId);if(d&&r){const y=await Ha({sortSettings:d,groupSettings:r}),M=({id:l,filename:R,metadata:X})=>({id:l,metadata:X,name:R});o.sort((l,R)=>y(M(l),M(R))),console.info(`Sorted ${o.length} images for crop gallery navigation`)}return{sortedFileIds:o.map(y=>y.fileId??Qe(y.id))}}const hs=Object.freeze(Object.defineProperty({__proto__:null,load:Sr},Symbol.toStringTag,{value:"Module"}));var Cr=Ae('<svg><path fill="currentColor" d="M2.5 7a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m0 10a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m10 0a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m-3-10a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0m0 10a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0m10 0a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0M16 11V8h-3V6h3V3h2v3h3v2h-3v3z"></path></svg>');function Or(C,r){const d=Se(r,["$$slots","$$events","$$legacy"]);var o=Cr();Ce(o,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...d})),m(C,o)}var $r=Ae('<svg><path fill="currentColor" d="M16 7h-5a6 6 0 1 0 0 12h9v2h-9a8 8 0 1 1 0-16h5V1l6 5l-6 5z"></path></svg>');function Br(C,r){const d=Se(r,["$$slots","$$events","$$legacy"]);var o=$r();Ce(o,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...d})),m(C,o)}var Vr=Ae('<svg><path fill="currentColor" d="M11 5.07A7.005 7.005 0 0 0 5.07 11H7v2H5.07A7 7 0 0 0 11 18.93V17h2v1.93A7 7 0 0 0 18.93 13H17v-2h1.93A7 7 0 0 0 13 5.07V7h-2zM3.055 11A9.004 9.004 0 0 1 11 3.055V1h2v2.055A9.004 9.004 0 0 1 20.945 11H23v2h-2.055A9.004 9.004 0 0 1 13 20.945V23h-2v-2.055A9.004 9.004 0 0 1 3.055 13H1v-2zM14 12a2 2 0 1 1-4 0a2 2 0 0 1 4 0"></path></svg>');function Dr(C,r){const d=Se(r,["$$slots","$$events","$$legacy"]);var o=Vr();Ce(o,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...d})),m(C,o)}var Pr=Ae('<svg><path fill="currentColor" d="M13 19.938A8.004 8.004 0 0 0 19.938 13H17v-2h2.938A8.004 8.004 0 0 0 13 4.062V7h-2V4.062A8.004 8.004 0 0 0 4.062 11H7v2H4.062A8.004 8.004 0 0 0 11 19.938V17h2zM12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m0-8a2 2 0 1 1 0-4a2 2 0 0 1 0 4"></path></svg>');function Er(C,r){const d=Se(r,["$$slots","$$events","$$legacy"]);var o=Pr();Ce(o,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...d})),m(C,o)}var jr=Ae('<svg><path fill="currentColor" d="M18 11V8l4 4l-4 4v-3h-5v5h3l-4 4l-4-4h3v-5H6v3l-4-4l4-4v3h5V6H8l4-4l4 4h-3v5z"></path></svg>');function Rr(C,r){const d=Se(r,["$$slots","$$events","$$legacy"]);var o=jr();Ce(o,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...d})),m(C,o)}var Hr=Ae('<svg><path fill="currentColor" d="M12.5 2a.5.5 0 0 0-.5.5V12h-2V4.5a.5.5 0 0 0-1 0V14H7c-.38-1.62-1.358-2.56-2.405-2.678A89 89 0 0 0 6.166 15.1c.86 1.962 1.725 3.422 2.838 4.399C10.078 20.442 11.459 21 13.5 21a5.5 5.5 0 0 0 5.5-5.5V7a.5.5 0 0 0-1 0v5h-2V4a.5.5 0 0 0-1 0v8h-2V2.5a.5.5 0 0 0-.5-.5M21 15.5a7.5 7.5 0 0 1-7.5 7.5c-2.458 0-4.328-.692-5.816-1.998c-1.45-1.274-2.459-3.064-3.35-5.1c-.93-2.127-1.444-3.422-1.724-4.178c-.357-.964.136-2.312 1.476-2.406a4.02 4.02 0 0 1 2.914.94V4.5a2.5 2.5 0 0 1 3.04-2.442a2.5 2.5 0 0 1 4.79-.467A2.502 2.502 0 0 1 18 4v.55q.243-.05.5-.05A2.5 2.5 0 0 1 21 7z"></path></svg>');function zr(C,r){const d=Se(r,["$$slots","$$events","$$legacy"]);var o=Hr();Ce(o,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...d})),m(C,o)}var Fr=Ae('<svg><path fill="currentColor" d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2v2a8 8 0 1 0 5.135 1.865L15 8V2h6l-2.447 2.447A9.98 9.98 0 0 1 22 12"></path></svg>');function ca(C,r){const d=Se(r,["$$slots","$$events","$$legacy"]);var o=Fr();Ce(o,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...d})),m(C,o)}var Tr=Ae('<svg><path fill="currentColor" d="M20 16h2v6h-6v-2H8v2H2v-6h2V8H2V2h6v2h8V2h6v6h-2zm-2 0V8h-2V6H8v2H6v8h2v2h8v-2zM4 4v2h2V4zm0 14v2h2v-2zM18 4v2h2V4zm0 14v2h2v-2z"></path></svg>');function Lr(C,r){const d=Se(r,["$$slots","$$events","$$legacy"]);var o=Tr();Ce(o,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...d})),m(C,o)}const da={origin:{x:0,y:0},scale:1,panning:!1,panStart:{x:0,y:0,zoomOrigin:{x:0,y:0}}};function qr({naturalWidth:C,naturalHeight:r,clientWidth:d,clientHeight:o,clientTop:y,clientLeft:M},l){const R=C/r,X=d/o;let[Q,de]=R<X?[o*R,o]:[d,d/R];return l&&(Q*=l.scale,de*=l.scale),{width:Q,height:de,x:(l?.origin.x??0)+M+(d-Q)/2,y:(l?.origin.y??0)+y+(o-de)/2}}class Nr{limits={x:0,y:0,width:0,height:0};#e=N("clickanddrag");get createMode(){return e(this.#e)}set createMode(r){x(this.#e,r,!0)}setCreateMode(r){this.createMode=r}#t=N(me({x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}}));get clickanddrag(){return e(this.#t)}set clickanddrag(r){x(this.#t,r,!0)}#a=N(me([]));get points(){return e(this.#a)}set points(r){x(this.#a,r,!0)}#r=i(()=>this.createMode==="clickanddrag"?za({x:"number > 0",y:"number > 0",width:"number > 0",height:"number > 0"}).allows(this.clickanddrag):this.createMode=="2point"?this.points.length>=2:this.createMode==="4point"?this.points.length>=4:!1);get ready(){return e(this.#r)}set ready(r){x(this.#r,r)}clamp(r){return{x:Ve(r.x,this.limits.x,this.limits.width),y:Ve(r.y,this.limits.y,this.limits.height),width:Ve(r.width,0,this.limits.width-r.x),height:Ve(r.height,0,this.limits.height-r.y)}}#i=i(()=>this.createMode==="clickanddrag"?this.clickanddrag.x:this.createMode==="off"?0:Math.min(...this.points.map(r=>r.x)));get x(){return e(this.#i)}set x(r){x(this.#i,r)}#s=i(()=>this.createMode==="clickanddrag"?this.clickanddrag.y:this.createMode==="off"?0:Math.min(...this.points.map(r=>r.y)));get y(){return e(this.#s)}set y(r){x(this.#s,r)}#o=i(()=>this.createMode==="clickanddrag"?this.clickanddrag.width:this.createMode==="off"?0:Math.max(...this.points.map(r=>r.x))-this.x);get width(){return e(this.#o)}set width(r){x(this.#o,r)}#n=i(()=>this.createMode==="clickanddrag"?this.clickanddrag.height:this.createMode==="off"?0:Math.max(...this.points.map(r=>r.y))-this.y);get height(){return e(this.#n)}set height(r){x(this.#n,r)}registerPoint(r,d){if(this.createMode!=="off"){if(this.createMode==="clickanddrag"){this.clickanddrag={...this.clickanddrag,x:r,y:d};return}this.points.push({x:r,y:d})}}registerMovement(r,d){if(this.createMode!=="clickanddrag")return;const{width:o,height:y}=this.clickanddrag;(o<=0||y<=0)&&(this.clickanddrag.dragDirection={x:Xe(r),y:Xe(d)});const{x:M,y:l}=this.clickanddrag.dragDirection;M>0&&l>0&&(this.clickanddrag.width+=r,this.clickanddrag.height+=d),M<0&&l<0&&(this.clickanddrag.x+=r,this.clickanddrag.y+=d,this.clickanddrag.width-=r,this.clickanddrag.height-=d),M<0&&l>0&&(this.clickanddrag.x+=r,this.clickanddrag.height+=d,this.clickanddrag.width-=r),M>0&&l<0&&(this.clickanddrag.y+=d,this.clickanddrag.width+=r,this.clickanddrag.height-=d)}rect(){return this.clamp({x:this.x,y:this.y,width:this.width,height:this.height})}reset(){this.clickanddrag={x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}},this.points=[]}constructor({limits:r}){this.limits=r,this.clickanddrag={x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}},this.points=[]}}var Ur=O("(<!>) × [<!>]",1),Gr=O(" <!><br/>",1),Wr=O("<!> <br/> &nbsp;&nbsp;&nbsp;dir <!>",1),Jr=O(" <!> <br/>",1),Yr=O("<br/> <!>",1),Zr=O('<code class="debug">bbs <br/> <!> <!></code>'),Kr=O('<div class="boundingbox-point new svelte-rvd0k3"></div>'),Xr=O('<div class="boundingbox new svelte-rvd0k3"></div>'),Qr=O("<div></div>"),ei=O("<div></div>"),ti=O("<div><!> <!> <!> <!> <!> <!> <!> <!></div>"),ai=O("<div><!> <!> <!></div>");function ri(C,r){Et(r,!0);let d=Dt(r,"disabled",3,!1),o=N(me(r.boundingBoxes));va(()=>r.boundingBoxes,n=>{x(o,n,!0)});let y=N(me(r.imageElement.clientWidth)),M=N(me(r.imageElement.clientHeight)),l=N(me(r.imageElement.clientLeft)),R=N(me(r.imageElement.clientTop)),X=N(me(r.imageElement.naturalWidth)),Q=N(me(r.imageElement.naturalHeight)),de=N(void 0);const ue=async()=>{r.imageElement&&((n=>{x(y,n.clientWidth,!0),x(M,n.clientHeight,!0),x(l,n.clientLeft,!0),x(R,n.clientTop,!0),x(X,n.naturalWidth,!0),x(Q,n.naturalHeight,!0)})(r.imageElement),await Ja())};ot(()=>{r.imageElement.addEventListener("load",ue);const n=new ResizeObserver(async(E,I)=>{if(!r.imageElement){I.disconnect();return}await ue()}),k=new MutationObserver(async(E,I)=>{if(!r.imageElement){I.disconnect();return}await ue()});return n.observe(r.imageElement),k.observe(r.imageElement,{attributes:!0,attributeFilter:["src"]}),()=>{n.disconnect(),k.disconnect()}});const D=i(()=>qr({clientHeight:e(M),clientWidth:e(y),naturalHeight:e(Q),naturalWidth:e(X),clientTop:e(R),clientLeft:e(l)},r.zoom)),F=i(()=>Pt({x:e(D).width,y:e(D).height})),ge=i(()=>Pt({x:1/e(D).width,y:1/e(D).height})),J=i(()=>Bt(e(o),e(F)));let ae=N(!1),P=i(()=>new Nr({limits:{x:0,y:0,width:e(D).width,height:e(D).height}}));ot(()=>e(P).setCreateMode(r.createMode));let he=N(""),z=me({topleft:!1,topright:!1,bottomleft:!1,bottomright:!1,get left(){return this.topleft&&this.bottomleft},set left(n){this.topleft=n,this.bottomleft=n},get right(){return this.topright&&this.bottomright},set right(n){this.topright=n,this.bottomright=n},get top(){return this.topleft&&this.topright},set top(n){this.topleft=n,this.topright=n},get bottom(){return this.bottomleft&&this.bottomright},set bottom(n){this.bottomleft=n,this.bottomright=n},setAll(n){this.topleft=n,this.topright=n,this.bottomleft=n,this.bottomright=n},isAll(n){return this.topleft===n&&this.topright===n&&this.bottomleft===n&&this.bottomright===n}});var U=ai();Vt("mousemove",Wa,({target:n})=>{n instanceof Element&&e(ae)&&r.createMode==="clickanddrag"&&n.closest(".change-area")!==e(de)&&(console.warn("Dragging has gone outside change area, bailing out. Target is",n),z.setAll(!1),x(ae,!1),e(P).reset())});let Ne,oe;var Ue=p(U);{var at=n=>{var k=Zr();Le(k,"",{},{color:"red"});{const re=(S,A=Ze,H=Ze)=>{Me();var Y=tt();W((ie,L)=>be(Y,`${ie??""} ${L??""}`),[()=>Math.round(A()),()=>Math.round(H())]),m(S,Y)},g=(S,A)=>{let H=()=>A?.().x,Y=()=>A?.().y,ie=()=>A?.().width,L=()=>A?.().height;Me();var q=Ur(),ne=u(se(q));re(ne,H,Y);var _e=u(ne,2);re(_e,ie,L),Me(),m(S,q)};var E=u(p(k),3);De(E,17,()=>Object.entries(e(J)),([S,A])=>S,(S,A)=>{var H=i(()=>ea(e(A),2));let Y=()=>e(H)[0],ie=()=>e(H)[1];Me();var L=Gr(),q=se(L),ne=u(q);g(ne,ie),Me(),W(()=>be(q,`@${Y()??""} `)),m(S,L)});var I=u(E),$=u(I);{var b=S=>{var A=Wr(),H=se(A);g(H,()=>e(P).clickanddrag);var Y=u(H,4);re(Y,()=>e(P).clickanddrag.dragDirection.x,()=>e(P).clickanddrag.dragDirection.y),m(S,A)},_=S=>{var A=tt("off");m(S,A)},T=S=>{var A=Yr(),H=u(se(A),2);De(H,17,()=>e(P).points,ta,(Y,ie,L)=>{let q=()=>e(ie).x,ne=()=>e(ie).y;Me();var _e=Jr(),ve=se(_e);ve.nodeValue=`#${L} `;var Z=u(ve);re(Z,q,ne),Me(2),m(Y,_e)}),m(S,A)};te($,S=>{r.createMode==="clickanddrag"?S(b):r.createMode==="off"?S(_,1):S(T,!1)})}f(k),W(()=>be(I,` create ${e(P).ready?"ready ":""} `))}m(n,k)},Pe=i(()=>sa());te(Ue,n=>{e(Pe)&&n(at)})}var Ee=u(Ue,2);{var je=n=>{var k=et(),E=se(k);De(E,17,()=>e(P).points,ta,(I,$)=>{let b=()=>e($).x,_=()=>e($).y;var T=et(),re=se(T);{var g=S=>{var A=Kr();let H;W(()=>H=Le(A,"",H,{left:`${b()??""}px`,top:`${_()??""}px`})),m(S,A)};te(re,S=>{b()!==0&&_()!==0&&S(g)})}m(I,T)}),m(n,k)},nt=n=>{var k=Xr();let E;W(()=>E=Le(k,"",E,{left:`${e(P).x??""}px`,top:`${e(P).y??""}px`,width:`${e(P).width??""}px`,height:`${e(P).height??""}px`})),m(n,k)};te(Ee,n=>{r.createMode==="2point"||r.createMode==="4point"?n(je):e(ae)&&r.createMode==="clickanddrag"&&n(nt,1)})}var rt=u(Ee,2);De(rt,17,()=>Object.entries(e(J)).filter(([n])=>Qe(n)===r.imageFileID),([n,k])=>n,(n,k)=>{var E=i(()=>ea(e(k),2));let I=()=>e(E)[0],$=()=>e(E)[1];var b=ti();let _,T;{const q=(_e,ve=Ze)=>{var Z=Qr();let ke;W(()=>ke=qe(Z,1,`side ${ve()??""}`,"svelte-rvd0k3",ke,{draggable:r.transformable,dragging:z[ve()]&&e(he)===I()})),fe("mousedown",Z,Oe=>{Oe.button===0&&(d()||r.transformable&&(x(he,I(),!0),z[ve()]=!0,Oe.stopPropagation()))}),m(_e,Z)},ne=(_e,ve=Ze)=>{var Z=ei();let ke;W(()=>ke=qe(Z,1,`corner ${ve()??""}`,"svelte-rvd0k3",ke,{draggable:r.transformable,dragging:z[ve()]&&e(he)===I()})),fe("mousedown",Z,Oe=>{Oe.button===0&&(d()||r.transformable&&(x(he,I(),!0),z[ve()]=!0,Oe.stopPropagation()))}),m(_e,Z)};var re=p(b);q(re,()=>"top");var g=u(re,2);q(g,()=>"bottom");var S=u(g,2);q(S,()=>"left");var A=u(S,2);q(A,()=>"right");var H=u(A,2);ne(H,()=>"topleft");var Y=u(H,2);ne(Y,()=>"topright");var ie=u(Y,2);ne(ie,()=>"bottomleft");var L=u(ie,2);ne(L,()=>"bottomright"),f(b)}W(()=>{_=qe(b,1,"boundingbox svelte-rvd0k3",null,_,{movable:r.movable,precise:!r.movable&&!r.transformable}),Ke(b,"data-image",I()),T=Le(b,"",T,{left:`${$().x??""}px`,top:`${$().y??""}px`,width:`${$().width??""}px`,height:`${$().height??""}px`})}),fe("mousedown",b,({button:q})=>{q===0&&(d()||(x(he,I(),!0),r.movable&&z.setAll(!0)))}),m(n,b)}),f(U),ha(U,n=>x(de,n),()=>e(de)),W(n=>{Ne=qe(U,1,"change-area svelte-rvd0k3",null,Ne,n),oe=Le(U,"",oe,{left:`${e(D).x??""}px`,top:`${e(D).y??""}px`,width:`${e(D).width??""}px`,height:`${e(D).height??""}px`,cursor:r.cursor})},[()=>({debug:sa(),precise:!r.movable&&!r.transformable})]),fe("mouseup",U,async({button:n})=>{if(!d()&&n===0){if(z.setAll(!1),e(ae)&&e(P).ready){const k=e(ge)(e(P).rect()),E=await r.oncreate?.(k);E&&(e(o)[E]=k),e(P).reset(),x(ae,!1)}else r.onchange?.(e(he),e(o)[e(he)]);x(he,"")}}),fe("mousedown",U,({clientX:n,clientY:k,currentTarget:E,button:I})=>{if(d()||I!==0||r.createMode==="off")return;const{left:$,top:b}=E.getBoundingClientRect(),[_,T]=[n-$,k-b];(r.movable||r.transformable)&&Object.values(e(J)).some(re=>cr(re,{x:_,y:T}))||(x(ae,!0),e(P).registerPoint(_,T))}),fe("mousemove",U,({movementX:n,movementY:k,button:E})=>{if(d()||E!==0)return;const{x:I,y:$}=e(ge)({x:n,y:k,w:0,h:0});if(e(ae)&&r.createMode==="clickanddrag"){e(P).registerMovement(n,k);return}const b=e(o)[e(he)];if(z.isAll(!0)){b.x+=I,b.y+=$;return}if(z.left){b.x+=I,b.width-=I;return}if(z.right){b.width+=I;return}if(z.top){b.y+=$,b.height-=$;return}if(z.bottom){b.height+=$;return}z.topleft&&(b.x+=I,b.y+=$,b.width-=I,b.height-=$),z.topright&&(b.y+=$,b.width+=I,b.height-=$),z.bottomleft&&(b.x+=I,b.width-=I,b.height+=$),z.bottomright&&(b.width+=I,b.height+=$)}),m(C,U),jt()}ua(["mouseup","mousedown","mousemove"]);var ii=O("<!><!>",1);function si(C,r){Et(r,!0);const d=Dt(r,"final",3,"et"),o=Dt(r,"key",3,(l,R)=>R);var y=et(),M=se(y);De(M,19,()=>r.items,(l,R)=>o()(l,R),(l,R,X)=>{var Q=ii(),de=se(Q);yr(de,()=>r.children,()=>e(R),()=>e(X));var ue=u(de);{var D=ge=>{var J=tt(", ");m(ge,J)},F=ge=>{var J=tt();W(()=>be(J,` ${d()??""} `)),m(ge,J)};te(ue,ge=>{e(X)<r.items.length-2?ge(D):e(X)===r.items.length-2&&ge(F,1)})}m(l,Q)}),m(C,y),jt()}var oi=O('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <p class="loading svelte-1kbovmw"> </p>',1),ni=O("<br/>"),li=O('<p class="coucou svelte-1kbovmw" aria-hidden="true"><!></p>'),ci=O("<button><!></button>"),di=O('<div class="status svelte-1kbovmw"><!></div>'),ui=O('<h1 class="svelte-1kbovmw"><!> <!></h1>'),hi=O('<h1 class="svelte-1kbovmw"><code>Image introuvable</code></h1>'),vi=O('<div class="confidence-icon svelte-1kbovmw"><!></div>'),mi=O('<span class="sep svelte-1kbovmw">&middot;</span> <!>',1),fi=O('<li><!> <div class="text svelte-1kbovmw"><p class="index"><!></p> <p class="dimensions svelte-1kbovmw"><code> </code> <!></p></div> <div class="actions svelte-1kbovmw"><!> <!> <!></div></li>'),gi=O('<li class="boxes-list-hint svelte-1kbovmw"><p class="svelte-1kbovmw"><!> <!></p> <p class="svelte-1kbovmw"> </p></li>'),pi=O('<code class="svelte-1kbovmw"> </code>'),bi=O('<!> <div class="layout svelte-1kbovmw"><main class="crop-surface svelte-1kbovmw"><div class="behind-image svelte-1kbovmw"><!></div> <img data-testid="crop-subject-image" alt="" class="svelte-1kbovmw"/> <!></main> <aside class="toolbar svelte-1kbovmw"><!> <button class="svelte-1kbovmw"><!></button> <button class="svelte-1kbovmw"><!></button></aside> <aside class="info svelte-1kbovmw"><section class="top svelte-1kbovmw"><section class="preactions svelte-1kbovmw"><!> <!></section> <section class="filename"><!></section> <section class="actions svelte-1kbovmw"><!> <!></section></section> <section class="boxes svelte-1kbovmw"><ul class="svelte-1kbovmw"><!> <!></ul></section> <section class="progress svelte-1kbovmw"><div class="bar svelte-1kbovmw"><p class="svelte-1kbovmw"><!></p> <!></div> <div class="bar svelte-1kbovmw"><p class="svelte-1kbovmw"><!></p> <!></div></section> <nav class="svelte-1kbovmw"><div class="navigation svelte-1kbovmw"><!> <code class="numbers svelte-1kbovmw"> <div class="separator svelte-1kbovmw">⁄</div> </code> <!></div> <div class="continue svelte-1kbovmw"><span class="auto svelte-1kbovmw"><!></span> <!></div></nav></aside></div>',1);function vs(C,r){Et(r,!0);const d=i(()=>r.data.sortedFileIds),o=i(()=>r.params.image),y=i(()=>At(e(o),Ye.Image.state.filter(t=>t.sessionId===v.currentSessionId))),M=i(()=>e(y).at(0)),l=i(()=>Qa("main"));kr({title:e(l)(141,[e(M)?.filename??"..."])});let R=N(async()=>{}),X=N("Glisser-recadrer");const Q=[{name:"Glisser-recadrer",help:"Cliquer et glisser pour créer une boîte de recadrage",icon:Lr,shortcut:"r",transformable:!0,createMode:"clickanddrag",movable:!0,cursor:"crosshair"},{name:"2 points",help:"Cliquer sur les 2 coins pour créer une boîte de recadrage",icon:Dr,shortcut:"z",transformable:!1,createMode:"2point",movable:!1,cursor:"crosshair"},{name:"4 points",help:"Cliquer sur les 4 extrémités pour créer une boîte de recadrage",icon:Or,shortcut:"Shift+z",transformable:!1,createMode:"4point",movable:!1,cursor:"crosshair"},{name:"Déplacer",help:"Cliquer et glisser pour déplacer la boîte de recadrage",icon:Rr,shortcut:"v",transformable:!1,createMode:"off",movable:!0,cursor:"pointer"},{name:"Main",help:"Cliquer et glisser pour se déplacer dans l'image",icon:zr,shortcut:"h",transformable:!1,createMode:"off",movable:!1,cursor:"grab"}],de=i(()=>Q.filter(({createMode:t})=>t!=="off"));let ue=i(()=>Q.find(({name:t})=>t===e(X))||Q[0]),D=i(()=>r.params.from?Ye.Observation.getFromState(r.params.from)?.images.find(t=>t.fileId===r.params.image):"");const F=i(()=>Object.fromEntries(e(y).map(({id:t,metadata:a})=>[t,a[v.cropMetadataId]?.value]).filter(([,t])=>t!==void 0).map(([t,a])=>[t,wr("boundingbox",a)]))),ge=i(()=>v.getPreviewURL(e(o))),J=i(()=>{const t=e(d).indexOf(e(o))-1;if(!(t<0))return e(d).at(t)}),ae=i(()=>{const t=e(d).indexOf(e(o))+1;if(!(t>=e(d).length))return e(d).at(t)}),P=i(()=>{const t=e(d).slice(e(d).indexOf(e(o))+1).filter(a=>!oe(a)).at(0);return t||e(d).find(a=>!oe(a))}),he=i(()=>e(d).filter(Ne).length),z=i(()=>e(d).filter(oe).length),U=i(()=>Object.fromEntries(e(y).map(t=>{if(!t.metadata[v.cropMetadataId])return[t.id,void 0];const{alternatives:a,value:s,confidence:c,manuallyModified:h}=t.metadata[v.cropMetadataId];if(a&&Object.entries(a).length>0){const[[w,B]]=Object.entries(a);return[t.id,{value:JSON.parse(w),confidence:B}]}return h?[t.id,void 0]:[t.id,{value:s,confidence:c}]})));function Ne(t){return At(t).every(a=>v.cropMetadataId in a.metadata)}function oe(t){return t?At(t).every(Ue):!1}function Ue(t){return v.cropMetadataValueOf(t)?.confirmed}async function at(t,a){if(!v.currentSessionId||!v.cropMetadataId)return;let s=v.cropMetadataValueOf(t);s||(s={confidence:1,manuallyModified:!0,value:ur,alternatives:{},confirmed:!0}),await st({db:Be(),sessionId:v.currentSessionId,metadataId:v.cropMetadataId,subjectId:t.id,type:"boundingbox",...s,confirmed:a})}async function Pe(t){for(const a of e(y))await at(a,t)}async function Ee(t){const a=e(U)[t];if(!a){la.error(e(l)(110,[t]));return}v.currentSessionId&&(await st({db:Be(),sessionId:v.currentSessionId,subjectId:t,metadataId:v.cropMetadataId,type:"boundingbox",manuallyModified:!1,...a}),v.classificationMetadataId&&await $t({db:Be(),sessionId:v.currentSessionId,metadataId:v.classificationMetadataId,subjectId:t}))}const je=i(()=>Object.fromEntries(e(y).map(t=>{const a=e(U)[t.id]?.value,s=t.metadata[v.cropMetadataId]?.value;return[t.id,a&&_r("boundingbox",s)&&!hr(a,s)]}))),nt=i(()=>Object.values(e(U)).every(t=>!t)||Object.values(e(je)).some(Boolean));async function rt(){if(Object.values(e(U)).every(t=>!t))for(const{id:t}of e(y))await n(t);else for(const{id:t}of e(y))await Ee(t)}ye.on("crop/box/create",async({imageId:t})=>{Qe(t)===e(o)&&await n(t,{skipUndo:!0})}),ye.on("crop/box/edit",async({imageId:t,before:a})=>{Qe(t)===e(o)&&await k(t,Fe(a),!1,!1)}),ye.on("crop/box/delete",async({imageId:t,box:a})=>{Qe(t)===e(o)&&await k(null,Fe(a),!1,!1)});async function n(t,{skipUndo:a=!1}={}){a||ye.push("crop/box/delete",{imageId:t,box:e(F)[t]}),e(y).length===1?await $t({db:Be(),sessionId:v.currentSession?.id,metadataId:v.cropMetadataId,subjectId:t}):await Ye.Image.remove(t)}async function k(t,a,s=!0,c=!0){if(!v.currentSessionId)return null;const h=t?e(y).find(G=>G.id===t):void 0;if(t&&!h)return la.error(e(l)(450,[t])),null;if(!a)return h&&await at(h,!0),t;const w=s&&e(y).filter(Ue).length===e(y).length-1,B=oa().cropAutoNext&&dr(a)&&(e(ue).createMode!=="clickanddrag"||!Ne(e(o)));if(v.classificationMetadataId){const G=h?.metadata[v.classificationMetadataId];G&&!G.manuallyModified&&await $t({db:Be(),sessionId:v.currentSessionId,metadataId:v.classificationMetadataId,subjectId:h.id})}let V="";return t?(c&&ye.push("crop/box/edit",{imageId:t,before:e(F)[t],after:Te(a)}),await st({db:Be(),sessionId:v.currentSessionId,metadataId:v.cropMetadataId,subjectId:t,type:"boundingbox",value:Te(a),confidence:1,alternatives:e(U)[t]?[e(U)[t]]:[],manuallyModified:!0})):e(y).length===1&&e(M)&&!e(M).metadata[v.cropMetadataId]?(V=e(M).id,c&&ye.push("crop/box/create",{imageId:V,box:Te(a)}),await st({db:Be(),sessionId:v.currentSessionId,metadataId:v.cropMetadataId,subjectId:V,type:"boundingbox",value:Te(a),confidence:1,manuallyModified:!0,alternatives:[]})):(V=Na(e(o),Math.max(...e(y).map(({id:G})=>Ua(G).subindex).filter(Fa))+1),c&&ye.push("crop/box/create",{imageId:V,box:Te(a)}),await Ye.Image.set({id:V,sessionId:v.currentSessionId,filename:e(M)?.filename??"",addedAt:Ar(e(M)?.addedAt??new Date),contentType:e(M)?.contentType??"",dimensions:We(e(M)?.dimensions)??{width:0,height:0},fileId:e(o),metadata:{[v.cropMetadataId]:{value:JSON.stringify(Te(a)),confidence:1,manuallyModified:!0,confirmed:!0,alternatives:{}}}})),x(S,!1),await Pe(!0),_.manual||(_.imageId=V||t),w&&await e(R)(),B&&(e(P)?await ce("/(app)/(sidepanel)/crop/[image]",{image:e(P)}):await ce("/(app)/(sidepanel)/classify")),V}async function E(){const t=e(y).map(a=>[a,e(F)[a.id]]);for(const[a,s]of t)await k(a.id,s?Fe(s):void 0);e(P)?await ce("/(app)/(sidepanel)/crop/[image]",{image:e(P)}):await ce("/(app)/(sidepanel)/classify")}async function I(){const t=We(e(ae));await Ga(e(o)),t?await ce("/(app)/(sidepanel)/crop/[image]",{image:t}):await ce("/(app)/(sidepanel)/import")}function $(t){if(!e(M))return[0,0];const a=Pt({x:e(M).dimensions.width,y:e(M).dimensions.height}),{w:s,h:c}=Bt(a(t),Math.round);return[s,c]}function b(){v.imagePreviouslyOpenedInCropper=e(o),r.params.from?ce("/(app)/(sidepanel)/classify/[observation]",{observation:r.params.from}):ce("/crop")}ot(()=>{v.imageOpenedInCropper=e(o)});let _=me({imageId:null,manual:!1});pr("cropping",{ArrowLeft:{help:e(l)(101),when:()=>!!e(J),do:()=>ce("/(app)/(sidepanel)/crop/[image]",{image:e(J)})},"Shift+Space":{help:e(l)(101),when:()=>!!e(J),do:()=>ce("/(app)/(sidepanel)/crop/[image]",{image:e(J)})},ArrowRight:{help:e(l)(102),when:()=>!!e(ae),do:()=>ce("/(app)/(sidepanel)/crop/[image]",{image:e(ae)})},Space:{help:e(l)(68),do:E},"$mod+Delete":{help:e(l)(156),do:I},Escape:{help:e(l)(136),do:b},a:{help:e(l)(26),do:async()=>gr("cropAutoNext")},Delete:{help:e(l)(154),when:()=>!!_.imageId,async do(){_.imageId&&(await n(_.imageId),_.manual?_.imageId=null:_.imageId=e(y).toReversed().find(t=>t.id in e(F))?.id??null)}},f:{help:e(l)(46),when:()=>!!_,do(){_&&(_.imageId===e(D)?x(D,""):_.imageId&&x(D,_.imageId))}},u:{help:e(l)(145),when:()=>!!e(je)[e(o)],do:()=>{e(je)[e(o)]&&Ee(e(o))}},"$mod+u":{help:e(l)(146),when:()=>Object.keys(e(F)).length>0,do:rt},ArrowUp:{help:e(l)(117),when:()=>!oe(e(o)),do:()=>Pe(!0)},ArrowDown:{help:e(l)(119),when:()=>oe(e(o)),do:()=>Pe(!1)},"+":{help:e(l)(174),do:()=>{e(g).scale=Ve(1,e(g).scale+4*e(A),10)}},"-":{help:e(l)(80),do:()=>{e(g).scale=Ve(1,e(g).scale-4*e(A),10)}},Digit0:{help:e(l)(148),do:()=>{e(g).origin={x:0,y:0},e(g).scale=1}},...Xt(Q.map(t=>[t.shortcut,{help:`Choisir l'outil ${t.name}`,do:()=>{x(X,t.name,!0)}}])),",":{help:e(l)(159),do:()=>{const t=Object.keys(e(F)),s=(t.indexOf(_.imageId??"")-1+t.length)%t.length;_.imageId=t[s]}},";":{help:e(l)(160),do:()=>{const t=Object.keys(e(F)),s=(t.indexOf(_.imageId??"")+1)%t.length;_.imageId=t[s]}},...Xt(Ta(1,10).map(t=>[`Digit${t}`,{help:`Sélectionner la boîte #${t}`,when:()=>Object.keys(e(F)).length>=t,do:()=>{const a=Object.keys(e(F))[t-1];_.imageId===a?(_.imageId=null,_.manual=!1):(_.imageId=a,_.manual=!0)}}])),"d e v +":{help:e(l)(467),async do(){const[t,a,s,c]=(prompt("Coords? (x space y space w space h, ∈ [0, 1])")??La("Prompt annulé")).split(" ").map(Number.parseFloat);await k(null,Fe({x:t,y:a,w:s,h:c}))}}}),ot(()=>{_.imageId&&document.querySelector(".boxes li.selected")?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})});let T=N(void 0),re=N(!0);va(()=>e(o),(t,a)=>{a&&v.cropperZoomStates.set(a,We(e(g))),x(g,We(v.cropperZoomStates.get(t))??da,!0)});let g=N(me({...da})),S=i(()=>e(y).every(({metadata:t})=>!t[v.cropMetadataId]?.manuallyModified));const A=i(()=>e(g).scale*.1);var H=bi(),Y=se(H);tr(Y,{get show(){return e(R)},set show(t){x(R,t,!0)}});var ie=u(Y,2),L=p(ie),q=p(L),ne=p(q);{var _e=t=>{var a=oi(),s=se(a);Ka(s,()=>({"--size":"2em"})),br(s.lastChild,{}),f(s);var c=u(s,2),h=p(c,!0);f(c),W(w=>be(h,w),[()=>e(l)(51)]),m(t,a)},ve=t=>{var a=li();{const c=h=>{var w=ni();m(h,w)};var s=p(a);{let h=i(()=>[c]),w=i(()=>e(l).c(175));pe(s,{get t(){return e(h)},get x(){return e(w)}})}f(a)}m(t,a)};te(ne,t=>{e(re)?t(_e):t(ve,!1)})}f(q);var Z=u(q,2);let ke;ha(Z,t=>x(T,t),()=>e(T));var Oe=u(Z,2);{var ma=t=>{{let a=i(()=>Bt(e(D)?qa(e(F),e(D)):e(F),Fe)),s=i(()=>e(g).panning?e(ue).name==="Main"?"grabbing":"move":e(ue).cursor);ri(t,Za(()=>e(ue),{get imageElement(){return e(T)},get zoom(){return e(g)},get imageFileID(){return e(o)},get boundingBoxes(){return e(a)},get disabled(){return e(g).panning},get cursor(){return e(s)},onchange:(c,h)=>k(c,h),oncreate:c=>k(null,c)}))}};te(Oe,t=>{e(T)&&t(ma)})}f(L);var lt=u(L,2),Rt=p(lt);De(Rt,17,()=>Q,t=>t.name,(t,a)=>{var s=ci();let c;var h=p(s);aa(h,()=>e(a).icon,(w,B)=>{B(w,{})}),f(s),He(s,(w,B)=>ze?.(w,B),()=>({text:`${e(a).name}: ${e(a).help}`,keyboard:e(a).shortcut,placement:"right"})),W(w=>{Ke(s,"aria-label",w),c=qe(s,1,"svelte-1kbovmw",null,c,{active:e(a).name===e(X)})},[()=>e(l)(57,[e(a).name])]),fe("click",s,()=>{x(X,e(a).name,!0)}),m(t,s)});var Re=u(Rt,2),fa=p(Re);er(fa,{}),f(Re),He(Re,(t,a)=>ze?.(t,a),()=>({text:"Annuler",keyboard:"$mod+z",placement:"right"}));var Ge=u(Re,2),ga=p(Ge);Br(ga,{}),f(Ge),He(Ge,(t,a)=>ze?.(t,a),()=>({text:"Rétablir",keyboard:"$mod+Shift+z",placement:"right"})),f(lt);var Ht=u(lt,2),ct=p(Ht),dt=p(ct),zt=p(dt);{var pa=t=>{{const a=h=>{ir(h,{})},s=h=>{ra(h,{shortcut:"Escape"})};let c=i(()=>e(l)(451));Ct(t,{inline:!0,onclick:b,get help(){return e(c)},_w_snippet_1:a,_w_snippet_2:s,children:(h,w)=>{{let B=i(()=>[a,s]),V=i(()=>e(l).c(452));pe(h,{get t(){return e(B)},get x(){return e(V)}})}},$$slots:{_w_snippet_1:!0,_w_snippet_2:!0,default:!0}})}},ba=t=>{{const a=c=>{nr(c,{})},s=c=>{ra(c,{shortcut:"Escape"})};Ct(t,{inline:!0,onclick:b,_w_snippet_3:a,_w_snippet_4:s,children:(c,h)=>{{let w=i(()=>[a,s]),B=i(()=>e(l).c(1));pe(c,{get t(){return e(w)},get x(){return e(B)}})}},$$slots:{_w_snippet_3:!0,_w_snippet_4:!0,default:!0}})}};te(zt,t=>{r.params.from?t(pa):t(ba,!1)})}var _a=u(zt,2);{const t=a=>{ia(a,{})};Ct(_a,{dangerous:!0,onclick:I,help:{text:"Supprimer cette image et passer à la suivante",keyboard:"$mod+Delete"},_w_snippet_5:t,children:(a,s)=>{{let c=i(()=>[t]),h=i(()=>e(l).c(15));pe(a,{get t(){return e(c)},get x(){return e(h)}})}},$$slots:{_w_snippet_5:!0,default:!0}})}f(dt);var ut=u(dt,2),wa=p(ut);{var xa=t=>{var a=ui(),s=p(a);xr(s,{get text(){return e(M).filename}});var c=u(s,2);{var h=B=>{var V=di(),G=p(V);St(G,{}),f(V),He(V,(ee,we)=>ze?.(ee,we),()=>"Recadrage confirmé"),m(B,V)},w=i(()=>oe(e(o)));te(c,B=>{e(w)&&B(h)})}f(a),m(t,a)},ya=t=>{var a=hi();m(t,a)};te(wa,t=>{e(M)?t(xa):t(ya,!1)})}f(ut);var Ft=u(ut,2),Tt=p(Ft);{const t=c=>{ca(c,{})};let a=i(()=>e(l)(146)),s=i(()=>!e(nt));Ot(Tt,{keyboard:"$mod+U",get help(){return e(a)},onclick:rt,get disabled(){return e(s)},_w_snippet_6:t,children:(c,h)=>{{let w=i(()=>[t]),B=i(()=>e(l).c(11));pe(c,{get t(){return e(w)},get x(){return e(B)}})}},$$slots:{_w_snippet_6:!0,default:!0}})}var ka=u(Tt,2);{let t=i(()=>oe(e(o))?"ArrowDown":"ArrowUp"),a=i(()=>oe(e(o))?"Marquer le recadrage comme non confirmé":"Marquer le recadrage comme confirmé");Ot(ka,{get keyboard(){return e(t)},onclick:()=>Pe(!oe(e(o))),get help(){return e(a)},children:(s,c)=>{var h=et(),w=se(h);{var B=ee=>{const we=le=>{rr(le,{})};{let le=i(()=>[we]),xe=i(()=>e(l).c(7));pe(ee,{get t(){return e(le)},get x(){return e(xe)}})}},V=i(()=>oe(e(o))),G=ee=>{const we=le=>{St(le,{})};{let le=i(()=>[we]),xe=i(()=>e(l).c(18));pe(ee,{get t(){return e(le)},get x(){return e(xe)}})}};te(w,ee=>{e(V)?ee(B):ee(G,!1)})}m(s,h)},$$slots:{default:!0}})}f(Ft),f(ct);var ht=u(ct,2),Lt=p(ht),qt=p(Lt);De(qt,19,()=>e(y).filter(({id:t})=>t in e(F)),t=>t.id,(t,a,s)=>{const c=i(()=>e(F)[e(a).id]),h=i(()=>e(U)[e(a).id]),w=i(()=>{const[j,K]=$(e(c));return{w:j,h:K}}),B=i(()=>e(D)===e(a).id);var V=fi();let G;var ee=p(V);{var we=j=>{{let K=i(()=>Fe(e(c))),Ie=i(()=>v.getPreviewURL(e(a).fileId));mr(j,{get dimensions(){return e(M).dimensions},get box(){return e(K)},get src(){return e(Ie)},class:"thumb"})}};te(ee,j=>{e(a).fileId&&e(M)&&j(we)})}var le=u(ee,2),xe=p(le),_t=p(xe);{let j=i(()=>e(l).c(43)),K=i(()=>[e(s)+1]);pe(_t,{get x(){return e(j)},get a(){return e(K)}})}f(xe);var wt=u(xe,2),$e=p(wt),xt=p($e);f($e),He($e,(j,K)=>ze?.(j,K),()=>"Dimensions de l'image recadrée (en pixels)");var yt=u($e,2);{var kt=j=>{var K=mi(),Ie=u(se(K),2);vr(Ie,{get value(){return e(h).confidence},children:(It,_i)=>{var Mt=vi(),Ra=p(Mt);lr(Ra,{}),f(Mt),m(It,Mt)},$$slots:{default:!0}}),m(j,K)};te(yt,j=>{e(h)&&!e(a).metadata[v.cropMetadataId].manuallyModified&&j(kt)})}f(wt),f(le);var Yt=u(le,2),Zt=p(Yt);{var Pa=j=>{{let K=i(()=>e(B)?"Réafficher les autres boîtes":"Masquer les autres boîtes");Je(j,{get help(){return e(K)},keyboard:"F",onclick:()=>x(D,e(B)?"":e(a).id),get crossout(){return e(B)},children:(Ie,It)=>{Er(Ie,{})},$$slots:{default:!0}})}},Ea=i(()=>Object.values(e(F)).length>1);te(Zt,j=>{e(Ea)&&j(Pa)})}var Kt=u(Zt,2);{let j=i(()=>e(h)?`Revenir au recadrage d'origine 
									(${$(e(h).value).join(" × ")}, ${Qt(e(h).confidence)} de confiance)`:"Recadrage d'origine indisponible"),K=i(()=>!e(je)[e(a).id]);Je(Kt,{get help(){return e(j)},keyboard:"u",get disabled(){return e(K)},onclick:()=>Ee(e(a).id),children:(Ie,It)=>{ca(Ie,{})},$$slots:{default:!0}})}var ja=u(Kt,2);{let j=i(()=>e(l)(154));Je(ja,{get help(){return e(j)},keyboard:"Delete",onclick:async()=>n(e(a).id),children:(K,Ie)=>{ia(K,{})},$$slots:{default:!0}})}f(Yt),f(V),W(()=>{G=qe(V,1,"svelte-1kbovmw",null,G,{unfocused:e(D)&&e(D)!==e(a).id,selected:_.imageId===e(a).id}),be(xt,`${e(w).w??""}×${e(w).h??""}`)}),m(t,V)});var Ia=u(qt,2);{var Ma=t=>{var a=gi(),s=p(a),c=p(s);Xa(c,()=>"Pour créer une nouvelle boîte,<wbr /> utilisez les outils");var h=u(c,2);si(h,{get items(){return e(de)},key:G=>G.name,final:"ou",children:(G,ee)=>{let we=()=>ee?.().icon,le=()=>ee?.().help,xe=()=>ee?.().shortcut;Mr(G,{get text(){return le()},get keyboard(){return xe()},children:(_t,wt)=>{var $e=et(),xt=se($e);aa(xt,we,(yt,kt)=>{kt(yt,{})}),m(_t,$e)},$$slots:{default:!0}})},$$slots:{default:!0}}),f(s);var w=u(s,2),B=p(w,!0);f(w),f(a),W(V=>be(B,V),[()=>e(l)(201)]),m(t,a)};te(Ia,t=>{e(S)&&t(Ma)})}f(Lt),f(ht);var vt=u(ht,2);{const t=(a,s=Ze)=>{var c=pi(),h=p(c,!0);f(c),W(w=>be(h,w),[()=>Qt(s()/e(d).length)]),m(a,c)};var mt=p(vt),ft=p(mt);{const a=c=>{or(c,{})},s=c=>{t(c,()=>e(he))};var Aa=p(ft);{let c=i(()=>[a,s]),h=i(()=>e(l).c(4));pe(Aa,{get t(){return e(c)},get x(){return e(h)}})}f(ft)}var Sa=u(ft,2);{let a=i(()=>e(he)/e(d).length);na(Sa,{alwaysActive:!0,get progress(){return e(a)}})}f(mt);var Nt=u(mt,2),gt=p(Nt);{const a=c=>{St(c,{})},s=c=>{t(c,()=>e(z))};var Ca=p(gt);{let c=i(()=>[a,s]),h=i(()=>e(l).c(9));pe(Ca,{get t(){return e(c)},get x(){return e(h)}})}f(gt)}var Oa=u(gt,2);{let a=i(()=>e(z)/e(d).length);na(Oa,{alwaysActive:!0,get progress(){return e(a)}})}f(Nt),f(vt)}var Ut=u(vt,2),pt=p(Ut),Gt=p(pt);{let t=i(()=>!e(J)),a=i(()=>e(l)(101));Je(Gt,{get disabled(){return e(t)},get help(){return e(a)},keyboard:"ArrowLeft",onclick:()=>{e(J)&&ce("/(app)/(sidepanel)/crop/[image]",{image:e(J)})},children:(s,c)=>{ar(s,{})},$$slots:{default:!0}})}var bt=u(Gt,2),Wt=p(bt),$a=u(Wt,2);f(bt);var Ba=u(bt,2);{let t=i(()=>!e(ae)),a=i(()=>e(l)(102));Je(Ba,{get disabled(){return e(t)},get help(){return e(a)},keyboard:"ArrowRight",onclick:()=>{e(ae)&&ce("/(app)/(sidepanel)/crop/[image]",{image:e(ae)})},children:(s,c)=>{sr(s,{})},$$slots:{default:!0}})}f(pt);var Jt=u(pt,2),it=p(Jt);{const t=a=>{var s=()=>oa().cropAutoNext,c=h=>fr("cropAutoNext",h);{let h=i(()=>e(l)(39));Ir(a,{get value(){return s()},set value(w){c(w)},get label(){return e(h)}})}};var Va=p(it);{let a=i(()=>[t]),s=i(()=>e(l).c(0));pe(Va,{get t(){return e(a)},get x(){return e(s)}})}f(it),He(it,(a,s)=>ze?.(a,s),()=>({text:"Passer automatiquement à l'image suivante quand celle-ci est recadrée",keyboard:"A"}))}var Da=u(it,2);{let t=i(()=>e(l)(118));Ot(Da,{onclick:E,keyboard:"Space",get help(){return e(t)},children:(a,s)=>{Me();var c=tt();W(h=>be(c,h),[()=>e(l)(68)]),m(a,c)},$$slots:{default:!0}})}f(Jt),f(Ut),f(Ht),f(ie),W((t,a,s)=>{Ke(Z,"src",e(ge)),ke=Le(Z,"",ke,{scale:e(g).scale,translate:`${e(g).origin.x??""}px ${e(g).origin.y??""}px`}),Ke(Re,"aria-label",t),Ke(Ge,"aria-label",a),be(Wt,`${s??""} `),be($a,` ${e(d).length??""}`)},[()=>e(l)(30),()=>e(l)(358),()=>e(d).indexOf(e(o))+1]),fe("mousedown",L,async t=>{e(ue).name!=="Main"&&t.button!==1||(t.preventDefault(),e(g).panning=!0,e(g).panStart={x:t.clientX,y:t.clientY,zoomOrigin:We(e(g).origin)})}),fe("mouseup",L,async({button:t})=>{e(ue).name!=="Main"&&t!==1||(e(g).panning=!1)}),fe("mousemove",L,async({clientX:t,clientY:a})=>{e(g).panning&&(e(g).origin.x=e(g).panStart.zoomOrigin.x+(t-e(g).panStart.x),e(g).origin.y=e(g).panStart.zoomOrigin.y+(a-e(g).panStart.y))}),Vt("wheel",L,async t=>{t.preventDefault();let a=e(T).getBoundingClientRect(),s=(t.clientX-a.x)/e(g).scale,c=(t.clientY-a.y)/e(g).scale;e(g).scale=Ve(1,e(g).scale-Xe(t.deltaY)*2*e(A),10),e(g).scale>1?(e(g).origin.x+=Xe(t.deltaY)*e(A)*(s*2-e(T).offsetWidth),e(g).origin.y+=Xe(t.deltaY)*e(A)*(c*2-e(T).offsetHeight)):e(g).origin={x:0,y:0}}),Vt("load",Z,()=>{x(re,!1)}),Ya(Z),fe("click",Re,()=>ye.pop()),fe("click",Ge,()=>ye.rewind()),m(C,H),jt()}ua(["mousedown","mouseup","mousemove","click"]);export{vs as component,hs as universal};
