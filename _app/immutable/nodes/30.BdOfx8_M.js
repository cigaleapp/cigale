import{L as ut,d as _t,t as M,c as gt,p as Y,a as ht,aa as wt,v as bt}from"../chunks/Don2Ydo1.js";import{l as yt}from"../chunks/DfkTl275.js";import{u as E}from"../chunks/BPJfxdhi.js";import"../chunks/DsnmJJEf.js";import{p as Z,H as P,g as t,u as n,ar as v,J as i,a as u,b as tt,F as k,G as y,f as $t,ap as x,D as St,at as xt}from"../chunks/BwdvgNQo.js";import{s as $}from"../chunks/HTLptRgQ.js";import{p as Pt,r as et,i as at}from"../chunks/CKH9F0ww.js";import{c as It}from"../chunks/CxwMZO45.js";import{e as K}from"../chunks/CuPIRSst.js";import{t as Mt,f as Dt}from"../chunks/BjiNJ5CV.js";import{a as st,b as At,s as Ct}from"../chunks/08d27X49.js";import{A as Q}from"../chunks/BsYyX4S0.js";import{B as kt}from"../chunks/DfpvCGjf.js";import{B as W}from"../chunks/DgJA6oA6.js";import{C as X}from"../chunks/oavC55LJ.js";import{a as zt,t as Bt}from"../chunks/C6sIn56-.js";import{f as Rt}from"../chunks/CTNR6MTR.js";import{p as Ht,a as Ot,b as Ft}from"../chunks/Xiow3_xo.js";import{g as R}from"../chunks/DyfjURbU.js";import{s as H,i as Tt}from"../chunks/YI6rRCuH.js";import{s as Ut}from"../chunks/B2RSv_jY.js";import{t as jt}from"../chunks/BYqiwRWy.js";import{R as q}from"../chunks/DWCXZatK.js";var Lt=P("<time><!></time>");function Vt(c,s){Z(s,!0);const e=Pt(s,"show",3,"absolute"),d=et(s,["$$slots","$$events","$$legacy","value","show"]),g=n(()=>typeof s.value=="string"?new Date(s.value):s.value),I=n(()=>ut(t(g),"PPpp")),S=n(()=>Rt(t(g),{addSuffix:!0}));var h=Lt();st(h,l=>({...d,datetime:l}),[()=>t(g).toISOString()]);var D=v(h);{var O=l=>{var m=k();y(()=>$(m,t(I))),u(l,m)},z=l=>{var m=k();y(()=>$(m,t(S))),u(l,m)},B=l=>{var m=k();y(()=>$(m,`${t(I)??""} (${t(S)??""})`)),u(l,m)};at(D,l=>{e()==="absolute"?l(O):e()=="relative"?l(z,1):l(B,!1)})}i(h),zt(h,(l,m)=>Bt?.(l,m),()=>e()==="relative"?t(I):void 0),u(c,h),tt()}async function qt({depends:c}){return c(_t("Session","")),{sessions:await Gt()}}async function Et(c){const s=await Y("Image","sessionId",c),e=[...new Set(s.map(d=>d.fileId).filter(ht))].slice(0,4);return await Promise.all(e.map(async d=>{E.hasPreviewURL(d)||await yt(d,"global")})),e.map(d=>E.getPreviewURL(d))}async function Gt(){const c=await M.Session.list();c.sort(gt("openedAt")),c.reverse();for(const s of c)s.protocol=await M.Protocol.get(s.protocol),s.thumbs=await Et(s.id),s.counts={images:await Y("Image","sessionId",s.id).then(e=>e.length)};return c}const xe=Object.freeze(Object.defineProperty({__proto__:null,load:qt},Symbol.toStringTag,{value:"Module"}));var Jt=$t('<svg><path fill="currentColor" d="M22 4a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1zM4 15h3.416a5.001 5.001 0 0 0 9.168 0H20v4H4zM4 5h16v8h-5a3 3 0 1 1-6 0H4zm12 4h-3V6h-2v3H8l4 4.5z"></path></svg>');function Nt(c,s){const e=et(s,["$$slots","$$events","$$legacy"]);var d=Jt();st(d,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e})),u(c,d)}var Kt=P('<img class="svelte-1266fsb"/>'),Qt=P('<em class="unavailable"> </em>'),Wt=P('<div class="content svelte-1266fsb"><div class="gallery svelte-1266fsb"></div> <header class="svelte-1266fsb"><p class="protocol svelte-1266fsb"><!></p> <h2 class="svelte-1266fsb"> </h2> <p class="date svelte-1266fsb"><!></p></header> <footer class="svelte-1266fsb"><!></footer></div>'),Xt=P('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Yt=P('<div class="content new svelte-1266fsb"><!></div>'),Zt=P('<main class="svelte-1266fsb"><header class="svelte-1266fsb"><h1> </h1> <section class="actions svelte-1266fsb"><!> <!></section></header> <section class="sessions svelte-1266fsb"></section></main>');function Pe(c,s){Z(s,!0);const e=n(()=>At("main"));Ut({title:t(e)(368)});const d=n(()=>s.data.sessions),g=n(()=>M.Protocol.state[0]);async function I(){if(!t(g)){jt.error(t(e)(369));return}const o=Ot(t(g),M.Metadata.state),a=Ft(t(g),M.Metadata.state),w=t(g).exports?.images.mtime,{id:p}=await M.Session.add({name:`Session du ${Intl.DateTimeFormat().format(new Date)}`,description:"",protocol:t(g).id,createdAt:new Date().toISOString(),openedAt:new Date().toISOString(),metadata:{},fullscreenClassifier:{layout:"top-bottom",...wt(o!==void 0,{focusedMetadata:o?.id??""})},group:{global:{field:"none"},crop:a?{field:"metadataPresence",metadata:a.id}:{field:"none"},classify:o?{field:"metadataConfidence",metadata:o.id}:{field:"none"}},sort:{global:w?{field:"metadataValue",direction:"asc",metadata:w}:{field:"name",direction:"asc"}}});await H(p),await R("/(app)/sessions/[id]",{id:p})}var S=Zt(),h=v(S),D=v(h),O=v(D,!0);i(D);var z=x(D,2),B=v(z);{const o=a=>{Nt(a,{})};W(B,{onclick:async()=>{const a=await Ht({accept:"application/zip",multiple:!1});await H(null),Tt(a),await R("/import")},_w_snippet_0:o,children:(a,w)=>{{let p=n(()=>[o]),_=n(()=>t(e).c(370));q(a,{get t(){return t(p)},get x(){return t(_)}})}},$$slots:{_w_snippet_0:!0,default:!0}})}var l=x(B,2);{const o=a=>{Q(a,{})};W(l,{testid:"new-session",onclick:async()=>{await I()},_w_snippet_1:o,children:(a,w)=>{{let p=n(()=>[o]),_=n(()=>t(e).c(371));q(a,{get t(){return t(p)},get x(){return t(_)}})}},$$slots:{_w_snippet_1:!0,default:!0}})}i(z),i(h);var m=x(h,2);K(m,21,()=>t(d),({createdAt:o,id:a,name:w,protocol:p,counts:_,thumbs:A})=>a,(o,a)=>{let w=()=>t(a).createdAt,p=()=>t(a).id,_=()=>t(a).name,A=()=>t(a).protocol,ot=()=>t(a).counts,rt=()=>t(a).thumbs;var G=Xt(),F=St(G);{let it=n(()=>t(e)(372)),nt=n(()=>t(e)(411));It(F,()=>({"--card-border":E.currentSessionId===p()?"var(--bg-primary)":""})),X(F.lastChild,{get tooltip(){return t(it)},get loading(){return t(nt)},onclick:async()=>{await H(p()),await R("/import")},children:(lt,te)=>{var T=Wt(),U=v(T);K(U,20,rt,r=>r,(r,f)=>{var b=Kt();y(()=>Ct(b,"src",f)),u(r,b)}),i(U);var j=x(U,2),L=v(j),ct=v(L);{var dt=r=>{var f=k();y(()=>$(f,A().name)),u(r,f)},mt=r=>{var f=Qt(),b=v(f,!0);i(f),y(C=>$(b,C),[()=>t(e)(373)]),u(r,f)};at(ct,r=>{A()?r(dt):r(mt,!1)})}i(L);var V=x(L,2),pt=v(V,!0);i(V);var J=x(V,2);{const r=f=>{Vt(f,{show:"relative",get value(){return w()}})};var ft=v(J);{let f=n(()=>[r]),b=n(()=>t(e).c(375)),C=n(()=>[bt(ot().images,t(e).p(374),t(e)._.p)]);q(ft,{get t(){return t(f)},get x(){return t(b)},get a(){return t(C)}})}i(J)}i(j);var N=x(j,2),vt=v(N);kt(vt,{fills:!0,onclick:async r=>{r.stopPropagation(),await H(p()),await R("/(app)/sessions/[id]",{id:p()})},children:(r,f)=>{xt();var b=k();y(C=>$(b,C),[()=>t(e)(376)]),u(r,b)},$$slots:{default:!0}}),i(N),i(T),y(()=>$(pt,_())),u(lt,T)},$$slots:{default:!0}}),i(F)}u(o,G)},o=>{{let a=n(()=>t(e)(377));X(o,{testid:"new-session-card",get tooltip(){return t(a)},onclick:async()=>{await I()},children:(w,p)=>{var _=Yt(),A=v(_);Q(A,{}),i(_),u(w,_)},$$slots:{default:!0}})}}),i(m),i(S),y(o=>$(O,o),[()=>t(e)(368)]),Mt(1,S,()=>Dt,()=>({duration:100})),u(c,S),tt()}export{Pe as component,xe as universal};
