import{_ as S,a as qt,g as Q,d as Rt,s as jt}from"../chunks/ByTqR5TD.js";import{j as Dt,y as lt,z as it,n as W,t as ft,l as Ht,B as Tt,A as St,s as Nt,e as Ut,d as Kt,r as gt}from"../chunks/D9uJnc4X.js";import{e as $t}from"../chunks/Bnkbztsd.js";import{m as Gt}from"../chunks/B5Ge56Uk.js";import{e as Jt}from"../chunks/DvdFYW7d.js";import"../chunks/DsnmJJEf.js";import{f as kt,a as m,p as Qt,c as $,d as st,g as t,u as e,aa as V,b as Wt,ay as v,az as u,b9 as Xt,r as d,aE as Yt,e as Zt,a9 as te,n as ht}from"../chunks/Bn_ZbADV.js";import{a as z,e as ee}from"../chunks/C0Q0tU0C.js";import{r as Pt,i as nt}from"../chunks/dHQvgpC_.js";import{e as ae}from"../chunks/WunZNVQx.js";import{t as re,f as oe}from"../chunks/D4q3eRn6.js";import{R as F}from"../chunks/DHI2XP9K.js";import{V as se}from"../chunks/DjqTWGhU.js";import{A as ne}from"../chunks/62pvB83o.js";import{D as le}from"../chunks/tQ5xpUhk.js";import{F as bt,E as wt}from"../chunks/OduuzoPe.js";import{I as ie}from"../chunks/DccYDYZA.js";import{p as w}from"../chunks/CEIzszct.js";import{B as yt}from"../chunks/r5lbXpLP.js";import{B as de}from"../chunks/BxDhQTq4.js";import{F as H}from"../chunks/D6ia_63r.js";import{I as xt}from"../chunks/01ygbV9Q.js";import{g as It}from"../chunks/BIF72yv3.js";import{o as ve}from"../chunks/La6mmiFH.js";import{i as ce}from"../chunks/yVjYDlYc.js";import{t as Mt}from"../chunks/Dw8a8pSN.js";async function pe({parent:y,params:l}){const s=S(Dt("js"));if(!l.id)throw $t(400,"Protocol ID is required");const{protocol:p,metadata:L}=await y(),A=await lt("MetadataOption",it(W(l.id,l.metadata),l.option));A||$t(404,s.t(371));const P=await Promise.all(Jt(A.cascade??{}).map(async([x,I])=>{const O=W(l.id,x),f=await ft.Metadata.get(O);if(!f)return{metadataId:O};let R;return f.type==="enum"&&(R=await lt("MetadataOption",it(O,I))),{metadataId:O,metadata:f,option:R,value:I}})),N=await Promise.all(p.metadata.flatMap(async x=>{const I=await ft.Metadata.get(W(l.id,x));return I?I.type!=="enum"?[]:(await Ht("MetadataOption",Gt(l.id,x))).filter(f=>f.cascade?.[l.metadata]===A.key).map(f=>({value:f.key,metadataId:I.id,metadata:I,option:f})):[]})).then(x=>x.flat());return{protocol:p,metadata:L,option:A,cascades:P,reverseCascades:N}}const ta=Object.freeze(Object.defineProperty({__proto__:null,load:pe},Symbol.toStringTag,{value:"Module"}));var me=kt('<svg><path fill="currentColor" d="M5 14V5h2v7h7.586V6.586L21 13l-6.414 6.414V14z"></path></svg>');function ue(y,l){const s=Pt(l,["$$slots","$$events","$$legacy"]);var p=me();qt(p,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),m(y,p)}var _e=kt('<svg><path fill="currentColor" d="M14 5H5v2h7v7.586H6.586L13 21l6.414-6.414H14z"></path></svg>');function fe(y,l){const s=Pt(l,["$$slots","$$events","$$legacy"]);var p=_e();qt(p,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),m(y,p)}function T(y){return S(Q("main")),async l=>{if(S(Q("main")),!w.params.metadata||!w.params.option||!w.params.id)return;const s=await lt("MetadataOption",it(Tt(w.params.metadata,w.params.id),w.params.option));if(s){try{await y(s,l)}catch(p){p instanceof St&&Mt.error(`Valeur invalide : ${p.summary}`)}await Nt("MetadataOption",s).catch(p=>{const L=S(Q("main"));Mt.error(L.t(251,[Ut(p)]))}),await ce(Kt("Metadata",W(w.params.id,w.params.metadata),"options"))}}}var ge=$('<textarea rows="10"></textarea>'),$e=$('<img class="svelte-128nasq"/>'),he=$('<p class="label-help svelte-128nasq"><!></p>'),be=$('<div class="row svelte-128nasq"><dt class="svelte-128nasq"> </dt> <!> <dd class="svelte-128nasq"> </dd> <!></div>'),we=$('<p class="empty svelte-128nasq"> </p>'),ye=$('<dl class="cascades svelte-128nasq"></dl>'),xe=$('<p class="label-help svelte-128nasq"><!></p>'),Ie=$(" <!>",1),Me=$('<li class="svelte-128nasq"><!></li>'),qe=$('<ul class="reverse-cascades svelte-128nasq"><!></ul>'),ke=$('<div class="split svelte-128nasq"><div class="left svelte-128nasq"><!> <!> <!> <!></div> <div class="right svelte-128nasq"><!> <!></div></div> <h3 class="svelte-128nasq"> </h3> <p class="svelte-128nasq"> </p> <div class="split svelte-128nasq"><div class="left svelte-128nasq"><!></div> <div class="right svelte-128nasq"><!></div></div> <div class="danger"><!></div>',1);function ea(y,l){Qt(l,!0);const s=e(()=>S(Q("main"))),p=e(()=>l.data.cascades),L=e(()=>l.data.reverseCascades),A=e(()=>l.data.metadata),P=e(()=>l.data.option),N=e(()=>t(P).key),x=e(()=>t(P).label),I=e(()=>t(P).description),O=e(()=>t(P).learnMore),f=e(()=>t(P).image);var R=ke(),U=st(R),X=v(U),dt=v(X);{let i=e(()=>t(s).t(352));H(dt,{get label(){return t(i)},children:(n,_)=>{{let a=e(()=>t(s).t(353)),r=e(()=>T((o,c)=>{o.key=c}));xt(n,{get value(){return t(N)},get label(){return t(a)},discreet:!0,get onblur(){return t(r)}})}}})}var vt=u(dt,2);{let i=e(()=>t(s).t(354));H(vt,{get label(){return t(i)},children:(n,_)=>{{let a=e(()=>t(s).t(355)),r=e(()=>T((o,c)=>{o.label=c}));xt(n,{get value(){return t(x)},get label(){return t(a)},discreet:!0,get onblur(){return t(r)}})}}})}var ct=u(vt,2);{let i=e(()=>t(s).t(302));H(ct,{get label(){return t(i)},children:(n,_)=>{var a=ge();Xt(a);var r=e(()=>T((o,{target:c})=>{c instanceof HTMLTextAreaElement&&(o.description=c.value)}));V(()=>Rt(a,t(I))),ee("blur",a,function(...o){t(r)?.apply(this,o)}),m(n,a)}})}var Ot=u(ct,2);{let i=e(()=>t(s).t(86)),n=e(()=>t(O)??""),_=e(()=>T((a,r)=>{r?a.learnMore=r:delete a.learnMore}));bt(Ot,{get label(){return t(i)},get value(){return t(n)},get onblur(){return t(_)}})}d(X);var pt=u(X,2),mt=v(pt);{let i=e(()=>t(s).t(356)),n=e(()=>t(f)??""),_=e(()=>T((a,r)=>{r?a.image=r:delete a.image}));bt(mt,{get Icon(){return ie},check:!0,get label(){return t(i)},get value(){return t(n)},get onblur(){return t(_)}})}var Bt=u(mt,2);{var Ct=i=>{var n=$e();V(()=>jt(n,"src",t(f))),m(i,n)};nt(Bt,i=>{t(f)&&i(Ct)})}d(pt),d(U);var Y=u(U,2),Vt=v(Y,!0);d(Y);var Z=u(Y,2),zt=v(Z,!0);d(Z);var tt=u(Z,2),et=v(tt),At=v(et);H(At,{get Icon(){return fe},composite:!0,label:n=>{const _=(a,r=ht)=>{var o=he(),c=v(o);{let M=e(()=>[l.data.metadata.label,l.data.option.label]);F(c,{get x(){return r()},n:!0,get a(){return t(M)}})}d(o),m(a,o)};{let a=e(()=>[_]),r=e(()=>t(s).cx(359));F(n,{get t(){return t(a)},get x(){return t(r)}})}},children:(n,_)=>{var a=ye();ae(a,21,()=>t(p),({metadataId:r,metadata:o,option:c,value:M})=>r,(r,o,c,M)=>{let g=()=>t(o).metadataId,K=()=>t(o).metadata,h=()=>t(o).option,at=()=>t(o).value;const E=e(()=>gt(g()));var q=be(),b=v(q),B=v(b,!0);d(b);var G=u(b,2);ne(G,{});var j=u(G,2),k=v(j,!0);d(j);var C=u(j,2);{var J=D=>{{let rt=e(()=>t(s).t(360,[h().label||h().key]));yt(D,{get help(){return t(rt)},onclick:()=>It("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:w.params.id??"",metadata:t(E),option:h().key}),children:(ot,Lt)=>{wt(ot,{})},$$slots:{default:!0}})}};nt(C,D=>{h()&&D(J)})}d(q),V(()=>{z(B,K()?.label||t(E)),z(k,h()?.label||h()?.key||at())}),m(r,q)},r=>{var o=we(),c=v(o,!0);d(o),V(M=>z(c,M),[()=>t(s).t(361)]),m(r,o)}),d(a),m(n,a)}}),d(et);var ut=u(et,2),Et=v(ut);H(Et,{get Icon(){return ue},composite:!0,label:n=>{const _=(a,r=ht)=>{var o=xe(),c=v(o);{let M=e(()=>[t(A).label,l.data.option.label]);F(c,{get x(){return r()},n:!0,get a(){return t(M)}})}d(o),m(a,o)};{let a=e(()=>[_]),r=e(()=>t(s).cx(362));F(n,{get t(){return t(a)},get x(){return t(r)}})}},children:(n,_)=>{var a=qe(),r=v(a);se(r,{get items(){return t(L)},children:Yt,$$slots:{default:(o,c)=>{const M=e(()=>c.item),g=e(()=>{const{metadataId:E,metadata:q,option:b,value:B}=t(M);return{metadataId:E,metadata:q,option:b,value:B}}),K=e(()=>gt(t(g).metadataId));var h=Me();{const E=q=>{var b=Zt(),B=st(b);{var G=k=>{var C=Ie(),J=st(C),D=u(J);{let rt=e(()=>t(s).t(360,[t(g).option.label||t(g).option.key]));yt(D,{get help(){return t(rt)},onclick:()=>It("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:w.params.id??"",metadata:t(K),option:t(g).option.key}),children:(ot,Lt)=>{wt(ot,{})},$$slots:{default:!0}})}V(()=>z(J,`${(t(g).option.label||t(g).option.key)??""} `)),m(k,C)},j=k=>{var C=te();V(()=>z(C,t(g).value)),m(k,C)};nt(B,k=>{t(g).option?k(G):k(j,!1)})}m(q,b)};var at=v(h);{let q=e(()=>[E]),b=e(()=>t(s).cx(363)),B=e(()=>[t(g).metadata?.label||t(K)]);F(at,{get t(){return t(q)},get x(){return t(b)},get a(){return t(B)}})}d(h)}m(o,h)}}}),d(a),m(n,a)}}),d(ut),d(tt);var _t=u(tt,2),Ft=v(_t);{const i=n=>{le(n,{})};de(Ft,{danger:!0,onclick:async()=>{await ve(t(N),t(x))},_w_snippet_3:i,children:(n,_)=>{{let a=e(()=>[i]),r=e(()=>t(s).cx(364));F(n,{get t(){return t(a)},get x(){return t(r)}})}},$$slots:{_w_snippet_3:!0,default:!0}})}d(_t),V((i,n)=>{z(Vt,i),z(zt,n)},[()=>t(s).t(357),()=>t(s).t(358)]),re(1,U,()=>oe,()=>({duration:100})),m(y,R),Wt()}export{ea as component,ta as universal};
