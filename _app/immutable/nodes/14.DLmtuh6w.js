import"../chunks/DsnmJJEf.js";import{o as F}from"../chunks/BXq8bD8b.js";import{p as P,g as s,u as n,b as k,ao as L,H as z,a as y,ar as b,ap as w,I as j,J as v,at as R,F as q,G as O}from"../chunks/BwdvgNQo.js";import{s as M}from"../chunks/HTLptRgQ.js";import{p as D,s as G,r as V,i as H}from"../chunks/CKH9F0ww.js";import{c as J}from"../chunks/CxwMZO45.js";import{t as U,f as E}from"../chunks/BjiNJ5CV.js";import{w as K}from"../chunks/2OzU4e1W.js";import{A as N}from"../chunks/BgBcKoa6.js";import{B as Q}from"../chunks/DgJA6oA6.js";import{t as W}from"../chunks/Bd7_h5c3.js";import{C as X}from"../chunks/CUiAmgj5.js";import{i as Y}from"../chunks/CEoeiZ5P.js";import{u as a}from"../chunks/BPJfxdhi.js";import{a as C,t as x,G as Z,h as $}from"../chunks/Don2Ydo1.js";import{f as ee,d as te}from"../chunks/DfkTl275.js";import{L as ae}from"../chunks/72YJCPe-.js";import{a as re}from"../chunks/BxRil6yI.js";import{d as se}from"../chunks/BOvN9V9s.js";import{g as S}from"../chunks/DyfjURbU.js";import{d as A,b as ie}from"../chunks/YI6rRCuH.js";import{s as oe}from"../chunks/B2RSv_jY.js";import{b as ne}from"../chunks/08d27X49.js";function me(h,e){P(e,!0);const l=D(e,"highlighted",3,!1),f=V(e,["$$slots","$$events","$$legacy","fileId","images","highlighted"]),m=n(()=>a.queuedImages.has(e.fileId)?"queued":a.loadingImages.has(e.fileId)?"loading":e.images.some(d=>a.erroredImages.has(d.id))?"errored":"ok"),p=n(()=>{if(s(m)==="errored")return e.images.map(({id:d})=>a.erroredImages.get(d)).filter(C).join("; ");if(Y())return`${e.fileId} @ ${e.images[0]?.addedAt.toISOString()} [${e.images[0]?.sessionId}]`});{let d=n(()=>a.getPreviewURL(e.fileId)),I=n(()=>a.selection.includes(e.fileId)),r=n(()=>e.images.map(t=>a.cropMetadataValueOf(t)?.value).filter(C).map(t=>W(t)));X(h,G({get id(){return e.fileId},get title(){return e.images[0].filename},get image(){return s(d)},get dimensions(){return e.images[0].dimensions},get selected(){return s(I)},boxes:"show-all",get tooltip(){return s(p)},get status(){return s(m)},get highlighted(){return l()}},()=>f,{get boundingBoxes(){return s(r)}}))}k()}var de=z('<div class="empty svelte-zhpjun"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <p> </p> <!></div>'),le=z('<section class="observations svelte-zhpjun"><!> <!></section>');function Fe(h,e){P(e,!0);const l=n(()=>ne("main"));oe({title:s(l)(138)});const f=n(()=>[...Z(x.Image.state,r=>r.fileId??"").entries()].map(([r,t])=>({id:r,sessionId:t[0].sessionId,addedAt:new Date($(t.map(o=>o.addedAt.getTime()))),name:t[0].filename,virtual:!1,metadata:re(t.map(o=>o.metadata),{definitions:x.Metadata.state,options:{}}),data:t})));L(()=>{a.imageOpenedInCropper=""}),F(()=>{A(x.Image.state.map(({fileId:r})=>r).filter(C).filter(r=>!ee(a.currentProtocol,r)))}),K(()=>a.imagePreviouslyOpenedInCropper,()=>{a.setSelection?.([a.imagePreviouslyOpenedInCropper])});var m=le(),p=b(m);N(p,{get items(){return s(f)},zone:"crop",item:(t,o=j,g)=>{let i=()=>g?.().id;{let _=n(()=>i()===a.imagePreviouslyOpenedInCropper),u=n(()=>s(l)(29));me(t,{get fileId(){return i()},get images(){return o()},boxes:"show-all",get highlighted(){return s(_)},get loadingStatusText(){return s(u)},onretry:()=>{a.erroredImages.delete(i()),A([i()])},ondelete:async()=>{ie(i(),"Cancelled by user"),a.processing.removeFile(i()),await se(i()),await te(i())},onclick:async(T,c)=>{c({status:"loading",loadingStatusText:"Ouvertureâ€¦"}),await S("/(app)/(sidepanel)/crop/[image]",{image:i()})}})}},$$slots:{item:!0}});var d=w(p,2);{var I=r=>{var t=de(),o=b(t);J(o,()=>({"--size":"6em"})),ae(o.lastChild,{variant:"empty"}),v(o);var g=w(o,2),i=b(g,!0);v(g);var _=w(g,2);Q(_,{onclick:()=>S("/import"),children:(u,T)=>{R();var c=q();O(B=>M(c,B),[()=>s(l)(103)]),y(u,c)},$$slots:{default:!0}}),v(t),O(u=>M(i,u),[()=>s(l)(37)]),y(r,t)};H(d,r=>{s(f).length||r(I)})}v(m),U(1,m,()=>E,()=>({duration:100})),y(h,m),k()}export{Fe as component};
