import{e as wt}from"../chunks/ft-thZGf.js";import{Y as ct,O as vt,n as Y,b as zt,C as Ht,t as xt,l as Nt,V as Ut,A as Gt,K as Jt,e as Yt,d as Qt,I as It}from"../chunks/Don2Ydo1.js";import{m as Wt}from"../chunks/BhEwWWID.js";import"../chunks/DsnmJJEf.js";import{f as Xt,a as _,p as Zt,H as $,D as lt,G as D,b as te,g as t,u as e,ar as u,ap as m,aL as ee,I as qt,C as ae,J as i,aK as re,F as se}from"../chunks/BwdvgNQo.js";import{e as oe,s as M}from"../chunks/HTLptRgQ.js";import{r as ne,i as it}from"../chunks/CKH9F0ww.js";import{e as Mt,i as le}from"../chunks/CuPIRSst.js";import{t as ie,f as de}from"../chunks/BjiNJ5CV.js";import{a as ue,g as dt,b as ce,e as ve,s as me}from"../chunks/08d27X49.js";import{V as pe}from"../chunks/BCMEp0xP.js";import{A as _e}from"../chunks/Cyizp9nt.js";import{C as fe}from"../chunks/Bgm-Cmsg.js";import{D as ge}from"../chunks/DBaFXsNm.js";import{F as kt,E as Pt}from"../chunks/D5nc91ck.js";import{I as $e}from"../chunks/T09AO1QC.js";import{I as he}from"../chunks/Cut1VsNn.js";import{p as w}from"../chunks/BzM0mbGE.js";import{B as ut}from"../chunks/LNwaZJFt.js";import{B as be}from"../chunks/DgJA6oA6.js";import{F as z}from"../chunks/CfpiF-ni.js";import{I as J}from"../chunks/BWUfZxGx.js";import{g as Ot}from"../chunks/DyfjURbU.js";import{o as ye}from"../chunks/CxaIuY-w.js";import{i as we}from"../chunks/BDV6zAFm.js";import{t as Ct}from"../chunks/BYqiwRWy.js";import{R as E}from"../chunks/DWCXZatK.js";async function xe({parent:R,params:d}){if(!d.id)throw wt(400,"Protocol ID is required");const{protocol:s,metadata:k}=await R(),h=await ct("MetadataOption",vt(Y(d.id,d.metadata),d.option)),T=zt("js");h||wt(404,T(499));const F=await Promise.all(Ht(h.cascade??{}).map(async([x,I])=>{const V=Y(d.id,x),g=await xt.Metadata.get(V);if(!g)return{metadataId:V};let j;return g.type==="enum"&&(j=await ct("MetadataOption",vt(V,I))),{metadataId:V,metadata:g,option:j,value:I}})),H=await Promise.all(s.metadata.flatMap(async x=>{const I=await xt.Metadata.get(Y(d.id,x));return I?I.type!=="enum"?[]:(await Nt("MetadataOption",Wt(d.id,x))).filter(g=>g.cascade?.[d.metadata]===h.key).map(g=>({value:g.key,metadataId:I.id,metadata:I,option:g})):[]})).then(x=>x.flat());return{protocol:s,metadata:k,option:h,cascades:F,reverseCascades:H}}const ca=Object.freeze(Object.defineProperty({__proto__:null,load:xe},Symbol.toStringTag,{value:"Module"}));var Ie=Xt('<svg><path fill="currentColor" d="M5 14V5h2v7h7.586V6.586L21 13l-6.414 6.414V14z"></path></svg>');function qe(R,d){const s=ne(d,["$$slots","$$events","$$legacy"]);var k=Ie();ue(k,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),_(R,k)}function C(R){return dt("main"),async d=>{if(!w.params.metadata||!w.params.option||!w.params.id)return;const s=await ct("MetadataOption",vt(Ut(w.params.metadata,w.params.id),w.params.option));if(!s)return;const k=dt("main");try{await R(s,d)}catch(h){h instanceof Gt&&Ct.error(k(362,[h.summary]))}await Jt("MetadataOption",s).catch(h=>{const T=dt("main");Ct.error(T(224,[Yt(h)]))}),await we(Qt("Metadata",Y(w.params.id,w.params.metadata),"options"))}}var Me=$('<textarea rows="10"></textarea>'),ke=$('<img class="svelte-128nasq"/>'),Pe=$('<li class="svelte-128nasq"><!> <!></li>'),Oe=$('<p class="label-help svelte-128nasq"><!></p>'),Ce=$('<div class="row svelte-128nasq"><dt class="svelte-128nasq"> </dt> <!> <dd class="svelte-128nasq"> </dd> <!></div>'),Re=$('<p class="empty svelte-128nasq"> </p>'),Fe=$('<dl class="cascades svelte-128nasq"></dl>'),Ve=$('<p class="label-help svelte-128nasq"><!></p>'),Ae=$(" <!>",1),Be=$('<li class="svelte-128nasq"><!></li>'),De=$('<ul class="reverse-cascades svelte-128nasq"><!></ul>'),Le=$('<div class="split svelte-128nasq"><div class="left svelte-128nasq"><!> <!> <!> <!></div> <div class="right svelte-128nasq"><!> <!></div></div> <h3 class="svelte-128nasq"> </h3> <p class="svelte-128nasq"> </p> <ul class="synonyms svelte-128nasq"><!> <li class="new svelte-128nasq"><!></li></ul> <h3 class="svelte-128nasq"> </h3> <p class="svelte-128nasq"> </p> <div class="split svelte-128nasq"><div class="left svelte-128nasq"><!></div> <div class="right svelte-128nasq"><!></div></div> <div class="danger"><!></div>',1);function va(R,d){Zt(d,!0);const s=e(()=>ce("main")),k=e(()=>d.data.cascades),h=e(()=>d.data.reverseCascades),T=e(()=>d.data.metadata),F=e(()=>d.data.option),H=e(()=>t(F).key),x=e(()=>t(F).label),I=e(()=>t(F).description),V=e(()=>t(F).learnMore),g=e(()=>t(F).image);var j=Le(),N=lt(j),Q=u(N),mt=u(Q);{let l=e(()=>t(s)(308));z(mt,{get label(){return t(l)},children:(o,c)=>{{let a=e(()=>t(s)(309)),r=e(()=>C((n,v)=>{n.key=v}));J(o,{get value(){return t(H)},get label(){return t(a)},discreet:!0,get onblur(){return t(r)}})}},$$slots:{default:!0}})}var pt=m(mt,2);{let l=e(()=>t(s)(310));z(pt,{get label(){return t(l)},children:(o,c)=>{{let a=e(()=>t(s)(311)),r=e(()=>C((n,v)=>{n.label=v}));J(o,{get value(){return t(x)},get label(){return t(a)},discreet:!0,get onblur(){return t(r)}})}},$$slots:{default:!0}})}var _t=m(pt,2);{let l=e(()=>t(s)(260));z(_t,{get label(){return t(l)},children:(o,c)=>{var a=Me();re(a);var r=e(()=>C((n,{target:v})=>{v instanceof HTMLTextAreaElement&&(n.description=v.value)}));D(()=>ve(a,t(I))),oe("blur",a,function(...n){t(r)?.apply(this,n)}),_(o,a)},$$slots:{default:!0}})}var Rt=m(_t,2);{let l=e(()=>t(s)(83)),o=e(()=>t(V)??""),c=e(()=>C((a,r)=>{r?a.learnMore=r:delete a.learnMore}));kt(Rt,{get label(){return t(l)},get value(){return t(o)},get onblur(){return t(c)}})}i(Q);var ft=m(Q,2),gt=u(ft);{let l=e(()=>t(s)(312)),o=e(()=>t(g)??""),c=e(()=>C((a,r)=>{r?a.image=r:delete a.image}));kt(gt,{get Icon(){return $e},check:!0,get label(){return t(l)},get value(){return t(o)},get onblur(){return t(c)}})}var Ft=m(gt,2);{var Vt=l=>{var o=ke();D(()=>me(o,"src",t(g))),_(l,o)};it(Ft,l=>{t(g)&&l(Vt)})}i(ft),i(N);var W=m(N,2),At=u(W,!0);i(W);var X=m(W,2),Bt=u(X,!0);i(X);var Z=m(X,2),$t=u(Z);Mt($t,17,()=>d.data.option.synonyms??[],le,(l,o,c)=>{var a=Pe(),r=u(a);{let v=e(()=>t(s)(346)),f=e(()=>C((p,P)=>{P?p.synonyms[c]=P:p.synonyms.splice(c,1)}));J(r,{get value(){return t(o)},get label(){return t(v)},discreet:!0,get onblur(){return t(f)}})}var n=m(r,2);{let v=e(()=>t(s)(347)),f=e(()=>C(p=>{p.synonyms.splice(c,1)}));ut(n,{get help(){return t(v)},get onclick(){return t(f)},children:(p,P)=>{he(p,{})},$$slots:{default:!0}})}i(a),_(l,a)});var ht=m($t,2),Dt=u(ht);{let l=e(()=>t(s)(346)),o=e(()=>t(s)(348)),c=e(()=>C((a,r)=>{r&&(a.synonyms||(a.synonyms=[]),a.synonyms.push(r))}));J(Dt,{get label(){return t(l)},get placeholder(){return t(o)},discreet:!0,get onblur(){return t(c)}})}i(ht),i(Z);var tt=m(Z,2),Lt=u(tt,!0);i(tt);var et=m(tt,2),Et=u(et,!0);i(et);var at=m(et,2),rt=u(at),Tt=u(rt);z(Tt,{get Icon(){return fe},composite:!0,label:o=>{const c=(a,r=qt)=>{var n=Oe(),v=u(n);{let f=e(()=>[d.data.metadata.label,d.data.option.label]);E(v,{get x(){return r()},n:!0,get a(){return t(f)}})}i(n),_(a,n)};{let a=e(()=>[c]),r=e(()=>t(s).c(315));E(o,{get t(){return t(a)},get x(){return t(r)}})}},children:(o,c)=>{var a=Fe();Mt(a,21,()=>t(k),({metadataId:r,metadata:n,option:v,value:f})=>r,(r,n,v,f)=>{let p=()=>t(n).metadataId,P=()=>t(n).metadata,b=()=>t(n).option,st=()=>t(n).value;const L=e(()=>It(p()));var q=Ce(),y=u(q),A=u(y,!0);i(y);var U=m(y,2);_e(U,{});var K=m(U,2),O=u(K,!0);i(K);var B=m(K,2);{var G=S=>{{let ot=e(()=>t(s)(316,[b().label||b().key]));ut(S,{get help(){return t(ot)},onclick:()=>Ot("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:w.params.id??"",metadata:t(L),option:b().key}),children:(nt,St)=>{Pt(nt,{})},$$slots:{default:!0}})}};it(B,S=>{b()&&S(G)})}i(q),D(()=>{M(A,P()?.label||t(L)),M(O,b()?.label||b()?.key||st())}),_(r,q)},r=>{var n=Re(),v=u(n,!0);i(n),D(f=>M(v,f),[()=>t(s)(317)]),_(r,n)}),i(a),_(o,a)},$$slots:{label:!0,default:!0}}),i(rt);var bt=m(rt,2),jt=u(bt);z(jt,{get Icon(){return qe},composite:!0,label:o=>{const c=(a,r=qt)=>{var n=Ve(),v=u(n);{let f=e(()=>[t(T).label,d.data.option.label]);E(v,{get x(){return r()},n:!0,get a(){return t(f)}})}i(n),_(a,n)};{let a=e(()=>[c]),r=e(()=>t(s).c(318));E(o,{get t(){return t(a)},get x(){return t(r)}})}},children:(o,c)=>{var a=De(),r=u(a);pe(r,{get items(){return t(h)},children:ee,$$slots:{default:(n,v)=>{const f=e(()=>v.item),p=e(()=>{const{metadataId:L,metadata:q,option:y,value:A}=t(f);return{metadataId:L,metadata:q,option:y,value:A}}),P=e(()=>It(t(p).metadataId));var b=Be();{const L=q=>{var y=ae(),A=lt(y);{var U=O=>{var B=Ae(),G=lt(B),S=m(G);{let ot=e(()=>t(s)(316,[t(p).option.label||t(p).option.key]));ut(S,{get help(){return t(ot)},onclick:()=>Ot("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:w.params.id??"",metadata:t(P),option:t(p).option.key}),children:(nt,St)=>{Pt(nt,{})},$$slots:{default:!0}})}D(()=>M(G,`${(t(p).option.label||t(p).option.key)??""} `)),_(O,B)},K=O=>{var B=se();D(()=>M(B,t(p).value)),_(O,B)};it(A,O=>{t(p).option?O(U):O(K,!1)})}_(q,y)};var st=u(b);{let q=e(()=>[L]),y=e(()=>t(s).c(319)),A=e(()=>[t(p).metadata?.label||t(P)]);E(st,{get t(){return t(q)},get x(){return t(y)},get a(){return t(A)}})}i(b)}_(n,b)}}}),i(a),_(o,a)},$$slots:{label:!0,default:!0}}),i(bt),i(at);var yt=m(at,2),Kt=u(yt);{const l=o=>{ge(o,{})};be(Kt,{danger:!0,onclick:async()=>{await ye(t(H),t(x))},_w_snippet_3:l,children:(o,c)=>{{let a=e(()=>[l]),r=e(()=>t(s).c(320));E(o,{get t(){return t(a)},get x(){return t(r)}})}},$$slots:{_w_snippet_3:!0,default:!0}})}i(yt),D((l,o,c,a)=>{M(At,l),M(Bt,o),M(Lt,c),M(Et,a)},[()=>t(s)(344),()=>t(s)(345),()=>t(s)(313),()=>t(s)(314)]),ie(1,N,()=>de,()=>({duration:100})),_(R,j),te()}export{va as component,ca as universal};
