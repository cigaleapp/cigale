import{e as Ge}from"../chunks/ft-thZGf.js";import{t as A,b as He,d as _e,a as Ue,a1 as Ve,I as le,a2 as Xe,n as Ke,J as Qe,e as Ye}from"../chunks/Don2Ydo1.js";import{m as Ze,e as et}from"../chunks/Xiow3_xo.js";import"../chunks/DsnmJJEf.js";import{f as he,a as g,H as M,D as X,g as e,u as s,ap as m,ar as c,J as d,p as tt,I as de,G as q,b as at,C as Be,as as G,aq as ce,L as rt,aJ as ot,at as st,F as nt}from"../chunks/BwdvgNQo.js";import{s as H,e as it}from"../chunks/HTLptRgQ.js";import{s as lt}from"../chunks/DYy3QkOc.js";import{r as ge,i as E}from"../chunks/CKH9F0ww.js";import{e as dt}from"../chunks/CuPIRSst.js";import{c as ct}from"../chunks/CaPT1Hnn.js";import{e as vt}from"../chunks/BJ3bLQVA.js";import{a as K,t as Q}from"../chunks/C6sIn56-.js";import{a as oe,d as ve,c as ae,C as mt,b as ft,s as Ce}from"../chunks/08d27X49.js";import{t as N,f as j}from"../chunks/BjiNJ5CV.js";import{b as pt}from"../chunks/DB45Zn9a.js";import{A as Oe}from"../chunks/BsYyX4S0.js";import{A as Ae}from"../chunks/k3WAnOGP.js";import{A as ut}from"../chunks/G4wa9As3.js";import{C as _t}from"../chunks/Bf6VYV6I.js";import{D as ze}from"../chunks/DBaFXsNm.js";import{F as ht}from"../chunks/0FVT5fxA.js";import{I as gt}from"../chunks/Dd2ii0q1.js";import{L as $t}from"../chunks/Cwb1OXsJ.js";import{M as wt,S as bt}from"../chunks/BohlEgEy.js";import{i as It}from"../chunks/BDV6zAFm.js";import{p as C}from"../chunks/BzM0mbGE.js";import{B as xt}from"../chunks/CrYFLP04.js";import{B as U}from"../chunks/LNwaZJFt.js";import{B as me}from"../chunks/DfpvCGjf.js";import{I as Pt}from"../chunks/DGHPOcQf.js";import{I as fe}from"../chunks/BWUfZxGx.js";import{S as yt}from"../chunks/BK9RD9Zy.js";import{S as kt}from"../chunks/BUsPvKjg.js";import{g as V}from"../chunks/DyfjURbU.js";import{s as Mt}from"../chunks/B2RSv_jY.js";import{u as Re}from"../chunks/BPJfxdhi.js";import{t as re}from"../chunks/BYqiwRWy.js";import{u as Fe}from"../chunks/B6HkNRPu.js";import{R as pe}from"../chunks/DWCXZatK.js";import{r as ue}from"../chunks/BRmTdaxr.js";async function St({params:S,depends:u}){const _=await A.Protocol.get(S.id);console.info("Loaded protocol from load function",_);const r=He("js");_||Ge(404,r(493,[S.id])),u(_e("Protocol",S.id)),_.metadata.map(O=>u(_e("Metadata",O)));const{metadataOrder:h}=_;return{..._,metadataDefinitions:await Promise.all(_.metadata.toSorted(Ze({metadataOrder:h})).map(async O=>A.Metadata.get(O))).then(O=>O.filter(Ue))}}const Ra=Object.freeze(Object.defineProperty({__proto__:null,load:St},Symbol.toStringTag,{value:"Module"}));var Dt=he('<svg><path fill="currentColor" d="m4.836 12l6.207 6.207l1.414-1.414L7.664 12l4.793-4.793l-1.414-1.414zm5.65 0l6.207 6.207l1.414-1.414L13.314 12l4.793-4.793l-1.414-1.414z"></path></svg>');function Lt(S,u){const _=ge(u,["$$slots","$$events","$$legacy"]);var r=Dt();oe(r,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",..._})),g(S,r)}var Bt=he('<svg><path fill="currentColor" d="m19.164 12l-6.207-6.207l-1.414 1.414L16.336 12l-4.793 4.793l1.414 1.414zm-5.65 0L7.307 5.793L5.893 7.207L10.686 12l-4.793 4.793l1.414 1.414z"></path></svg>');function Ct(S,u){const _=ge(u,["$$slots","$$events","$$legacy"]);var r=Bt();oe(r,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",..._})),g(S,r)}var Ot=he('<svg><path fill="currentColor" d="m10.904 2.1l9.9 1.414l1.414 9.9l-9.192 9.192a1 1 0 0 1-1.415 0l-9.9-9.9a1 1 0 0 1 0-1.413zm.707 2.122L3.833 12l8.485 8.485l7.779-7.778l-1.061-7.425zm2.122 6.363a2 2 0 1 1 2.828-2.828a2 2 0 0 1-2.828 2.829"></path></svg>');function At(S,u){const _=ge(u,["$$slots","$$events","$$legacy"]);var r=Ot();oe(r,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",..._})),g(S,r)}var zt=M("<span><!></span>"),Rt=M("<span><!></span>"),Ft=M("<span><!></span>"),qt=M("<!> <!>",1);function Nt(S,u){const _=s(()=>u.metadata.label),r=s(()=>u.metadata.infer);var h=qt(),O=X(h);{var Y=k=>{var p=zt();ve(p,"",{},{color:"var(--fg-error)"});var b=c(p);yt(b,{}),d(p),K(p,(z,R)=>Q?.(z,R),()=>"Métadonnée technique"),g(k,p)};E(O,k=>{e(_)||k(Y)})}var J=m(O,2);{var Z=k=>{var p=Rt();ve(p,"",{},{color:"var(--fg-primary)"});var b=c(p);kt(b,{}),d(p),K(p,(z,R)=>Q?.(z,R),()=>"Inférence par réseau neuronal"),g(k,p)},T=k=>{var p=Ft();ve(p,"",{},{color:"var(--fg-primary)"});var b=c(p);At(b,{}),d(p),K(p,(z,R)=>Q?.(z,R),()=>"exif"in e(r)?`Inféré à partir du champ EXIF ${e(r).exif}`:`Inféré à partir des coordonnées GPS EXIF (latitude: ${e(r).latitude.exif}, longitude: ${e(r).longitude.exif})`),g(k,p)};E(J,k=>{e(r)&&"neural"in e(r)?k(Z):e(r)&&("exif"in e(r)||"latitude"in e(r)&&"exif"in e(r).latitude)&&k(T,1)})}g(S,h)}var jt=M('<span class="badge svelte-1efdthw"> </span>'),Et=M('<div class="menu-icon svelte-1efdthw"><!></div> <!>',1),Jt=M('<header class="svelte-1efdthw"><div class="top-actions svelte-1efdthw"><!> <!></div> <h1 class="svelte-1efdthw"><!></h1> <code class="subtitle svelte-1efdthw"><!></code> <section class="actions svelte-1efdthw"><!> <!></section></header>'),Tt=M('<header class="svelte-1efdthw"><!></header>'),Wt=M('<div class="navlink svelte-1efdthw"><div class="menu-icon svelte-1efdthw"><!></div></div>'),Gt=M('<form class="navlink svelte-1efdthw"><div class="menu-icon standin svelte-1efdthw"></div> <!> <!></form>'),Ht=M('<a><div class="menu-icon svelte-1efdthw"> </div> <div class="datatype-icon svelte-1efdthw"><!></div></a>'),Ut=M('<div class="menu-icon standin svelte-1efdthw"></div> <a class="svelte-1efdthw"> <!></a> <div class="action svelte-1efdthw"><!></div>',1),Vt=M("<div><!></div>"),Xt=M('<div class="sidebar-and-main svelte-1efdthw"><aside><!> <!> <nav class="svelte-1efdthw"><!> <!> <!> <!> <!> <!> <nav class="metadata svelte-1efdthw"></nav></nav> <div class="collapse-toggle"><!></div></aside> <main><!></main></div>');function Fa(S,u){tt(u,!0);const _=(t,a=de,n=de,o=de,i)=>{let f=rt(()=>ot(i?.(),void 0));const I=s(()=>n()===""?n():ue(`/(app)/protocols/[id]/${n()}`,{id:e(h)}));var x=Be(),W=X(x);vt(W,()=>e(I)?"a":"span",!1,(F,D)=>{K(F,(w,B)=>Q?.(w,B),()=>e(b)?{text:a(),placement:"right"}:void 0),oe(F,w=>({href:e(I)||void 0,class:"navlink",[mt]:w}),[()=>({active:n()&&C.route.id?.startsWith(`/(app)/protocols/[id]/${n()}`)})],void 0,void 0,"svelte-1efdthw");var P=Et(),l=X(P),v=c(l);ct(v,o,(w,B)=>{B(w,{})}),d(l);var y=m(l),$=m(y);{var L=w=>{var B=jt(),Le=c(B,!0);d(B),q(()=>H(Le,e(f))),g(w,B)};E($,w=>{e(f)!==void 0&&w(L)})}q(()=>H(y,` ${a()??""} `)),g(D,P)}),g(t,x)},r=s(()=>ft("main"));Mt({title:e(r)(213,[C.params.id])});let h=s(()=>u.data.id),O=s(()=>u.data.name),Y=s(()=>u.data.version),J=s(()=>u.data.metadata),Z=s(()=>u.data.metadataDefinitions),T=s(()=>u.data.metadataOrder),k=ce(void 0),p=ce(null),b=ce(!1);async function z(t){t.preventDefault();const a=t.currentTarget.elements.item(0);if(!a?.value)return;const n=a.value.trim();try{let o=Ke(e(h),Qe(n).replaceAll("-","_"));e(J).includes(o)&&(o=`${o}_${e(J).filter(f=>f.startsWith(o)).length+1}`),await A.Metadata.set({id:o,label:n,description:"",type:"string",mergeMethod:"none",required:!1}),await A.Protocol.update(e(h),"metadata",[o,...e(J)]),e(T)&&await A.Protocol.update(e(h),"metadataOrder",[o,...e(T)]),await It(_e("Protocol",e(h)));const i=le(o);a.value="",e(p)?.children.item(e(J).length-1)?.scrollIntoView({behavior:"smooth",block:"end"}),re.success(e(r)(361,[i])),await V("/(app)/protocols/[id]/metadata/[metadata]/infos",{id:e(h),metadata:i})}catch(o){re.error(Ye(o,"Impossible de créer la métadonnée"))}}async function R(t){const a=structuredClone(e(T)),n=le(t.id),o=Fe((i,f)=>{f==="undo"?(i.metadata.push(t.id),a&&(i.metadataOrder=a)):(i.metadata=i.metadata.filter(I=>I!==t.id),i.metadataOrder&&(i.metadataOrder=i.metadataOrder.filter(I=>I!==t.id)))});await o("remove"),re.withUndo("success",`Métadonnée ${n} supprimée`,{undo:async()=>o("undo"),commit:async()=>A.Metadata.remove(t.id)})}async function qe(t,a){if(!t){a(e(h));return}await A.Protocol.update(e(h),"id",t),await A.Protocol.remove(e(h)),G(h,t),C.route?.id&&await V(C.route.id,{...C.params,id:t})}var ee=Xt(),te=c(ee);let $e;var we=c(te);{var Ne=t=>{var a=Jt(),n=c(a),o=c(n);{const l=v=>{Ae(v,{})};me(o,{onclick:()=>V("/protocols"),_w_snippet_0:l,children:(v,y)=>{{let $=s(()=>[l]),L=s(()=>e(r).c(214));pe(v,{get t(){return e($)},get x(){return e(L)}})}},$$slots:{_w_snippet_0:!0,default:!0}})}var i=m(o,2);{let l=s(()=>e(r)(215));xt(i,{get tooltip(){return e(l)},children:(v,y)=>{st();var $=nt();q(L=>H($,L),[()=>e(r)(216)]),g(v,$)}})}d(n);var f=m(n,2),I=c(f);{let l=s(()=>e(r)(208)),v=s(()=>Fe((y,$)=>{y.name=$}));fe(I,{get label(){return e(l)},discreet:!0,get value(){return e(O)},get onblur(){return e(v)}})}d(f);var x=m(f,2),W=c(x);{let l=s(()=>e(r)(217));fe(W,{get label(){return e(l)},discreet:!0,get value(){return e(h)},onblur:qe})}d(x);var F=m(x,2),D=c(F);{const l=v=>{bt(v,{})};me(D,{onclick:async()=>{await et(Ve(),ue("/"),e(h)).catch(v=>re.error(v))},_w_snippet_1:l,children:(v,y)=>{{let $=s(()=>[l]),L=s(()=>e(r).c(218));pe(v,{get t(){return e($)},get x(){return e(L)}})}},$$slots:{_w_snippet_1:!0,default:!0}})}var P=m(D,2);{const l=y=>{ze(y,{})};let v=s(()=>e(h)===Re.currentProtocolId&&Re.processing.total>0);me(P,{dangerous:!0,get disabled(){return e(v)},onclick:()=>e(k)?.(),_w_snippet_2:l,children:(y,$)=>{{let L=s(()=>[l]),w=s(()=>e(r).c(15));pe(y,{get t(){return e(L)},get x(){return e(w)}})}},$$slots:{_w_snippet_2:!0,default:!0}})}d(F),d(a),N(1,a,()=>j),g(t,a)},je=t=>{var a=Tt(),n=c(a);{let o=s(()=>e(r)(219));U(n,{get help(){return e(o)},tooltipParams:{placement:"right"},onclick:()=>V("/protocols"),children:(i,f)=>{Ae(i,{})},$$slots:{default:!0}})}d(a),N(1,a,()=>j),g(t,a)};E(we,t=>{e(b)?t(je,!1):t(Ne)})}var be=m(we,2);wt(be,{get id(){return e(h)},ondelete:()=>V("/protocols"),get open(){return e(k)},set open(t){G(k,t,!0)}});var se=m(be,2),Ie=c(se);_(Ie,()=>"Informations",()=>"infos",()=>gt);var xe=m(Ie,2);_(xe,()=>"Versionnage",()=>"versioning",()=>ut,()=>e(Y)?`v${e(Y)}`:void 0);var Pe=m(xe,2);_(Pe,()=>"Exports",()=>"exports",()=>ht);var ye=m(Pe,2);_(ye,()=>"Recadrage",()=>"cropping",()=>_t);var ke=m(ye,2);_(ke,()=>"Métadonnées",()=>"",()=>$t,()=>e(Z).length);var Me=m(ke,2);{var Ee=t=>{var a=Wt(),n=c(a),o=c(n);{let i=s(()=>e(r)(220));U(o,{get help(){return e(i)},tooltipParams:{placement:"right"},onclick:()=>G(b,!1),children:(f,I)=>{Oe(f,{})},$$slots:{default:!0}})}d(n),d(a),N(1,a,()=>j),g(t,a)},Je=t=>{var a=Gt(),n=m(c(a),2);{let i=s(()=>e(r)(221));fe(n,{get label(){return e(i)},value:"",discreet:!0,placeholder:{idle:"Nouvelle métadonnée…",focused:"Nom de la métadonnée"},onblur:()=>{}})}var o=m(n,2);{let i=s(()=>e(r)(222));U(o,{get help(){return e(i)},submits:!0,onclick:()=>{},children:(f,I)=>{Oe(f,{})},$$slots:{default:!0}})}d(a),it("submit",a,z),N(1,a,()=>j),g(t,a)};E(Me,t=>{e(b)?t(Ee):t(Je,!1)})}var ne=m(Me,2);dt(ne,21,()=>e(Z),t=>t.id,(t,a)=>{const n=s(()=>le(e(a).id)),o=s(()=>e(a).label||e(n)),i=s(()=>ue(C.route.id?.includes("/protocols/[id]/metadata/[metadata]/")?C.route.id:"/(app)/protocols/[id]/metadata/[metadata]/infos",{...C.params,id:e(h),metadata:e(n)}));var f=Vt();let I;var x=c(f);{var W=D=>{var P=Ht();let l;var v=c(P),y=c(v,!0);d(v);var $=m(v,2),L=c($);Pt(L,{tooltip:!1,get type(){return e(a).type}}),d($),d(P),K(P,(w,B)=>Q?.(w,B),()=>({text:e(o),placement:"right"})),q((w,B)=>{l=ae(P,1,"navlink svelte-1efdthw",null,l,w),Ce(P,"href",e(i)),H(y,B)},[()=>({active:C.url.pathname.includes(`metadata/${e(n)}/`)}),()=>Xe(e(o)).slice(0,2)]),N(1,P,()=>j),g(D,P)},F=D=>{var P=Ut(),l=m(X(P),2),v=c(l),y=m(v);Nt(y,{get metadata(){return e(a)}}),d(l);var $=m(l,2),L=c($);{let w=s(()=>e(r)(223));U(L,{dangerous:!0,get help(){return e(w)},onclick:async()=>R(e(a)),children:(B,Le)=>{ze(B,{})},$$slots:{default:!0}})}d($),q(()=>{Ce(l,"href",e(i)),H(v,`${(e(a).label||e(n))??""} `)}),N(1,l,()=>j),g(D,P)};E(x,D=>{e(b)?D(W):D(F,!1)})}d(f),q(D=>I=ae(f,1,"navlink svelte-1efdthw",null,I,D),[()=>({active:C.url.pathname.includes(`metadata/${e(n)}/`)})]),g(t,f)}),d(ne),pt(ne,t=>G(p,t),()=>e(p)),d(se);var Se=m(se,2),Te=c(Se);{let t=s(()=>e(b)?"Déplier":"Replier");U(Te,{get help(){return e(t)},onclick:()=>{G(b,!e(b))},children:(a,n)=>{var o=Be(),i=X(o);{var f=x=>{Ct(x,{})},I=x=>{Lt(x,{})};E(i,x=>{e(b)?x(f):x(I,!1)})}g(a,o)},$$slots:{default:!0}})}d(Se),d(te);var ie=m(te,2);let De;var We=c(ie);lt(We,()=>u.children),d(ie),d(ee),q(t=>{$e=ae(te,1,"svelte-1efdthw",null,$e,{collapsed:e(b)}),De=ae(ie,1,"svelte-1efdthw",null,De,t)},[()=>({padded:!C.route.id?.startsWith("/(app)/protocols/[id]/metadata/")})]),N(1,ee,()=>j,()=>({duration:100})),g(S,ee),at()}export{Fa as component,Ra as universal};
