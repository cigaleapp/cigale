name: Build

env:
  ELECTRON_SKIP_BINARY_DOWNLOAD: 'true'

on:
  workflow_call:
    inputs:
      debug:
        required: false
        type: boolean
        default: true
        description: Build with debug info (non-minified + sourcemaps)
    outputs:
      artifact:
        description: The build artifact name
        value: ${{ jobs.app.outputs.artifact }}

jobs:
  app:
    runs-on: ubuntu-latest
    name: App
    outputs:
      artifact: ${{ steps.artifact.outputs.name }}
    steps:
      - uses: actions/checkout@v6
      - uses: oven-sh/setup-bun@v2
        with:
          bun-version-file: .bun-version
      - name: Install dependencies
        run: bun install --frozen-lockfile
      - if: inputs.debug
        name: Build
        run: bun run build
      - if: ${{ !inputs.debug }}
        name: Build (without minification)
        run: bun run build
        env:
          DEBUG: 'true'
      - name: Determine artifact name
        id: artifact
        run: echo "name=build-${{ inputs.debug && 'minified' || 'full' }}-${{ github.sha }}" >> $GITHUB_OUTPUT
      - name: Upload build as artifact
        uses: actions/upload-artifact@v6
        with:
          name: ${{ steps.artifact.outputs.name }}
          include-hidden-files: true
          path: |
            public
            .svelte-kit
