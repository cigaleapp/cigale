import"./DsnmJJEf.js";import{f as J,a as C,p as K,c as T,aA as v,b as Q,i as L,g as t,s as X,u as n,az as c,r as p,aF as Y,ab as Z}from"./CKFr55HY.js";import{e as tt,a as at}from"./BSJa-gCr.js";import{s as et}from"./BnT1n4qy.js";import{c as ot}from"./Eu4gtx6U.js";import{a as st,_ as rt,g as it,b as nt,s as lt}from"./B0sfP6zc.js";import{t as dt,f as pt}from"./CQ7DZjSk.js";import{e as mt}from"./D6WmM5W6.js";import{V as ct}from"./B1WHLvY0.js";import{A as ut}from"./uMHR5rlx.js";import{B as I,C as vt}from"./EISLmZ-s.js";import{D as ft}from"./C9aioxm5.js";import{r as ht}from"./BnINZmlg.js";import{i as U}from"./CJ0dtI1a.js";import{p as l}from"./CFsItWt6.js";import{d as V,h as _t,r as F,s as gt,e as bt}from"./BfjK8oC1.js";import{I as R}from"./D4mJ-AV5.js";import{g as O,a as wt}from"./bCylyxMO.js";import{t as q}from"./C4Cali0V.js";import{b as jt}from"./BmYW83mJ.js";var yt=J('<svg><path fill="currentColor" d="m18.031 16.617l4.283 4.282l-1.415 1.415l-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9s9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617m-2.006-.742A6.98 6.98 0 0 0 18 11c0-3.867-3.133-7-7-7s-7 3.133-7 7s3.133 7 7 7a6.98 6.98 0 0 0 4.875-1.975z"></path></svg>');function $t(d,o){const r=ht(o,["$$slots","$$events","$$legacy"]);var m=yt();st(m,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...r})),C(d,m)}async function kt(d,o){const r=l.data.options??[],m=structuredClone(r.find(f=>f.key===d));if(!m)throw mt(404,`Option avec clé ${d} introuvable`);l.data.options=r.filter(f=>f.key!==d);const u=l.route.id==="/(app)/protocols/[id]/metadata/[metadata]/options/[option]"&&l.params.option===d;u&&await O("/(app)/protocols/[id]/metadata/[metadata]/options",{id:l.params.id??"",metadata:l.params.metadata??""}),q.withUndo("info",`Option ${o||d} supprimée`,{async commit(){await _t("MetadataOption",m.id)},async undo(){await U(V("Metadata",l.data.metadata.id,"options")),u&&await O("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:l.params.id??"",metadata:l.params.metadata??"",option:d})}})}var It=T('<div><a class="svelte-puhjjd"> </a> <div class="delete svelte-puhjjd"><!></div></div>'),Ct=T('<div class="aside-and-main svelte-puhjjd"><aside class="svelte-puhjjd"><search class="svelte-puhjjd"><!> <!> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></search> <form class="new-option svelte-puhjjd"><!> <!></form> <nav class="svelte-puhjjd"><!></nav></aside> <div class="content svelte-puhjjd"><!></div></div>');function Jt(d,o){K(o,!0);const r=n(()=>rt(it("main")));let m=n(()=>l.data.options??[]),u=X("");const f=n(()=>t(m).filter(e=>[e.key,e.label].some(a=>!t(u)||a.toLowerCase().includes(t(u).toLowerCase()))));async function N(e){e.preventDefault();const a=e.currentTarget.elements.item(0);if(!a?.value)return;let i=jt(a.value).replaceAll("-","_");t(m).find(s=>s.key===i)&&(i+="_"+t(m).filter(s=>s.key.startsWith(i)).length);try{await gt("MetadataOption",{id:`${o.data.metadata.id}:${i}`,metadataId:o.data.metadata.id,key:i,label:a.value,description:""}),a.value="",await U(V("Metadata",o.data.metadata.id,"options")),await O("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:o.data.protocol.id,metadata:F(o.data.metadata.id),option:i})}catch(s){q.error(bt(s,"Impossible de créer l'option"))}}var _=Ct(),j=c(_),y=c(j),A=c(y);$t(A,{});var M=v(A,2);{let e=n(()=>t(r).t(344)),a=n(()=>t(r).t(345));R(M,{discreet:!0,get label(){return t(e)},get placeholder(){return t(a)},onblur:()=>{},get value(){return t(u)},set value(i){L(u,i,!0)}})}var $=v(M,2);{let e=n(()=>t(r).t(346));ot($,()=>({"--font-size":"0.7em"})),I($.lastChild,{onclick:()=>L(u,""),get help(){return t(e)},children:(a,i)=>{vt(a,{})},$$slots:{default:!0}}),p($)}p(y);var g=v(y,2),x=c(g);{let e=n(()=>t(r).t(347)),a=n(()=>t(r).t(348));R(x,{discreet:!0,get label(){return t(e)},get placeholder(){return t(a)},value:"",onblur:()=>{}})}var S=v(x,2);{let e=n(()=>t(r).t(349));I(S,{submits:!0,get help(){return t(e)},onclick:()=>{},children:(a,i)=>{ut(a,{})},$$slots:{default:!0}})}p(g);var D=v(g,2),W=c(D);ct(W,{get items(){return t(f)},children:Y,$$slots:{default:(e,a)=>{const i=n(()=>a.item),s=n(()=>{const{key:h,label:k}=t(i);return{key:h,label:k}});var b=It();let z;var w=c(b),G=c(w,!0);p(w);var B=v(w,2),H=c(B);{let h=n(()=>t(r).t(350,[t(s).label||t(s).key]));I(H,{dangerous:!0,get help(){return t(h)},onclick:async()=>kt(t(s).key,t(s).label),children:(k,Ot)=>{ft(k,{})},$$slots:{default:!0}})}p(B),p(b),Z(h=>{z=nt(b,1,"navlink svelte-puhjjd",null,z,{active:l.params.option===t(s).key}),lt(w,"href",h),at(G,t(s).label)},[()=>wt("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:o.data.protocol.id,metadata:F(o.data.metadata.id),option:t(s).key})]),C(e,b)}}}),p(D),p(j);var P=v(j,2),E=c(P);et(E,()=>o.children),p(P),p(_),tt("submit",g,N),dt(1,_,()=>pt,()=>({duration:100})),C(d,_),Q()}export{Jt as _,kt as o};
