import{h as Ju}from"./CKFr55HY.js";import{f as Yu,_ as Qu}from"./B0sfP6zc.js";import{_ as ui}from"./PPVm8Dsz.js";import{c as oo,k as Xu,u as Zu,e as el,B as ao,C as li}from"./BmYW83mJ.js";class Fr extends Error{constructor(e,r){super(e),this.name="DevalueError",this.path=r.join("")}}function ci(t){return Object(t)!==t}const tl=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function rl(t){const e=Object.getPrototypeOf(t);return e===Object.prototype||e===null||Object.getPrototypeOf(e)===null||Object.getOwnPropertyNames(e).sort().join("\0")===tl}function nl(t){return Object.prototype.toString.call(t).slice(8,-1)}function il(t){switch(t){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return t<" "?`\\u${t.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function Ie(t){let e="",r=0;const n=t.length;for(let i=0;i<n;i+=1){const s=t[i],l=il(s);l&&(e+=t.slice(r,i)+l,r=i+1)}return`"${r===0?t:e+t.slice(r)}"`}function sl(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.getOwnPropertyDescriptor(t,e).enumerable)}const ol=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;function di(t){return ol.test(t)?"."+t:"["+JSON.stringify(t)+"]"}function al(t){const e=new DataView(t);let r="";for(let n=0;n<t.byteLength;n++)r+=String.fromCharCode(e.getUint8(n));return cl(r)}function ul(t){const e=ll(t),r=new ArrayBuffer(e.length),n=new DataView(r);for(let i=0;i<r.byteLength;i++)n.setUint8(i,e.charCodeAt(i));return r}const uo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function ll(t){t.length%4===0&&(t=t.replace(/==?$/,""));let e="",r=0,n=0;for(let i=0;i<t.length;i++)r<<=6,r|=uo.indexOf(t[i]),n+=6,n===24&&(e+=String.fromCharCode((r&16711680)>>16),e+=String.fromCharCode((r&65280)>>8),e+=String.fromCharCode(r&255),r=n=0);return n===12?(r>>=4,e+=String.fromCharCode(r)):n===18&&(r>>=2,e+=String.fromCharCode((r&65280)>>8),e+=String.fromCharCode(r&255)),e}function cl(t){let e="";for(let r=0;r<t.length;r+=3){const n=[void 0,void 0,void 0,void 0];n[0]=t.charCodeAt(r)>>2,n[1]=(t.charCodeAt(r)&3)<<4,t.length>r+1&&(n[1]|=t.charCodeAt(r+1)>>4,n[2]=(t.charCodeAt(r+1)&15)<<2),t.length>r+2&&(n[2]|=t.charCodeAt(r+2)>>6,n[3]=t.charCodeAt(r+2)&63);for(let i=0;i<n.length;i++)typeof n[i]>"u"?e+="=":e+=uo[n[i]]}return e}const Dn=-1,lo=-2,co=-3,ho=-4,fo=-5,En=-6;function dl(t,e){return hl(JSON.parse(t),e)}function hl(t,e){if(typeof t=="number")return i(t,!0);if(!Array.isArray(t)||t.length===0)throw new Error("Invalid input");const r=t,n=Array(r.length);function i(s,l=!1){if(s===Dn)return;if(s===co)return NaN;if(s===ho)return 1/0;if(s===fo)return-1/0;if(s===En)return-0;if(l||typeof s!="number")throw new Error("Invalid input");if(s in n)return n[s];const u=r[s];if(!u||typeof u!="object")n[s]=u;else if(Array.isArray(u))if(typeof u[0]=="string"){const f=u[0],d=e?.[f];if(d){let h=u[1];return typeof h!="number"&&(h=r.push(u[1])-1),n[s]=d(i(h))}switch(f){case"Date":n[s]=new Date(u[1]);break;case"Set":const h=new Set;n[s]=h;for(let a=1;a<u.length;a+=1)h.add(i(u[a]));break;case"Map":const p=new Map;n[s]=p;for(let a=1;a<u.length;a+=2)p.set(i(u[a]),i(u[a+1]));break;case"RegExp":n[s]=new RegExp(u[1],u[2]);break;case"Object":n[s]=Object(u[1]);break;case"BigInt":n[s]=BigInt(u[1]);break;case"null":const c=Object.create(null);n[s]=c;for(let a=1;a<u.length;a+=2)c[u[a]]=i(u[a+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const a=globalThis[f],o=new a(i(u[1]));n[s]=u[2]!==void 0?o.subarray(u[2],u[3]):o;break}case"ArrayBuffer":{const a=u[1],o=ul(a);n[s]=o;break}case"Temporal.Duration":case"Temporal.Instant":case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.PlainMonthDay":case"Temporal.PlainYearMonth":case"Temporal.ZonedDateTime":{const a=f.slice(9);n[s]=Temporal[a].from(u[1]);break}case"URL":{const a=new URL(u[1]);n[s]=a;break}case"URLSearchParams":{const a=new URLSearchParams(u[1]);n[s]=a;break}default:throw new Error(`Unknown type ${f}`)}}else{const f=new Array(u.length);n[s]=f;for(let d=0;d<u.length;d+=1){const h=u[d];h!==lo&&(f[d]=i(h))}}else{const f={};n[s]=f;for(const d in u){if(d==="__proto__")throw new Error("Cannot parse an object with a `__proto__` property");const h=u[d];f[d]=i(h)}}return n[s]}return i(0)}function fl(t,e){const r=[],n=new Map,i=[];if(e)for(const d of Object.getOwnPropertyNames(e))i.push({key:d,fn:e[d]});const s=[];let l=0;function u(d){if(typeof d=="function")throw new Fr("Cannot stringify a function",s);if(d===void 0)return Dn;if(Number.isNaN(d))return co;if(d===1/0)return ho;if(d===-1/0)return fo;if(d===0&&1/d<0)return En;if(n.has(d))return n.get(d);const h=l++;n.set(d,h);for(const{key:c,fn:a}of i){const o=a(d);if(o)return r[h]=`["${c}",${u(o)}]`,h}let p="";if(ci(d))p=Kr(d);else{const c=nl(d);switch(c){case"Number":case"String":case"Boolean":p=`["Object",${Kr(d)}]`;break;case"BigInt":p=`["BigInt",${d}]`;break;case"Date":p=`["Date","${!isNaN(d.getDate())?d.toISOString():""}"]`;break;case"URL":p=`["URL",${Ie(d.toString())}]`;break;case"URLSearchParams":p=`["URLSearchParams",${Ie(d.toString())}]`;break;case"RegExp":const{source:o,flags:g}=d;p=g?`["RegExp",${Ie(o)},"${g}"]`:`["RegExp",${Ie(o)}]`;break;case"Array":p="[";for(let m=0;m<d.length;m+=1)m>0&&(p+=","),m in d?(s.push(`[${m}]`),p+=u(d[m]),s.pop()):p+=lo;p+="]";break;case"Set":p='["Set"';for(const m of d)p+=`,${u(m)}`;p+="]";break;case"Map":p='["Map"';for(const[m,b]of d)s.push(`.get(${ci(m)?Kr(m):"..."})`),p+=`,${u(m)},${u(b)}`,s.pop();p+="]";break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const m=d;p='["'+c+'",'+u(m.buffer);const b=d.byteOffset,v=b+d.byteLength;if(b>0||v!==m.buffer.byteLength){const w=+/(\d+)/.exec(c)[1]/8;p+=`,${b/w},${v/w}`}p+="]";break}case"ArrayBuffer":{p=`["ArrayBuffer","${al(d)}"]`;break}case"Temporal.Duration":case"Temporal.Instant":case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.PlainMonthDay":case"Temporal.PlainYearMonth":case"Temporal.ZonedDateTime":p=`["${c}",${Ie(d.toString())}]`;break;default:if(!rl(d))throw new Fr("Cannot stringify arbitrary non-POJOs",s);if(sl(d).length>0)throw new Fr("Cannot stringify POJOs with symbolic keys",s);if(Object.getPrototypeOf(d)===null){p='["null"';for(const m in d)s.push(di(m)),p+=`,${Ie(m)},${u(d[m])}`,s.pop();p+="]"}else{p="{";let m=!1;for(const b in d)m&&(p+=","),m=!0,s.push(di(b)),p+=`${Ie(b)}:${u(d[b])}`,s.pop();p+="}"}}}return r[h]=p,h}const f=u(t);return f<0?`${f}`:`[${r.join(",")}]`}function Kr(t){const e=typeof t;return e==="string"?Ie(t):t instanceof String?Ie(t.toString()):t===void 0?Dn.toString():t===0&&1/t<0?En.toString():e==="bigint"?`["BigInt","${t}"]`:String(t)}function pl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}const an=(t,e)=>e.some(r=>t instanceof r);let hi,fi;function ml(){return hi||(hi=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function gl(){return fi||(fi=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const un=new WeakMap,jr=new WeakMap,Or=new WeakMap;function yl(t){const e=new Promise((r,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",l)},s=()=>{r(He(t.result)),i()},l=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",l)});return Or.set(e,t),e}function bl(t){if(un.has(t))return;const e=new Promise((r,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",l),t.removeEventListener("abort",l)},s=()=>{r(),i()},l=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",l),t.addEventListener("abort",l)});un.set(t,e)}let ln={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return un.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return He(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function po(t){ln=t(ln)}function vl(t){return gl().includes(t)?function(...e){return t.apply(cn(this),e),He(this.request)}:function(...e){return He(t.apply(cn(this),e))}}function xl(t){return typeof t=="function"?vl(t):(t instanceof IDBTransaction&&bl(t),an(t,ml())?new Proxy(t,ln):t)}function He(t){if(t instanceof IDBRequest)return yl(t);if(jr.has(t))return jr.get(t);const e=xl(t);return e!==t&&(jr.set(t,e),Or.set(e,t)),e}const cn=t=>Or.get(t);function wl(t,e,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){const l=indexedDB.open(t,e),u=He(l);return n&&l.addEventListener("upgradeneeded",f=>{n(He(l.result),f.oldVersion,f.newVersion,He(l.transaction),f)}),r&&l.addEventListener("blocked",f=>r(f.oldVersion,f.newVersion,f)),u.then(f=>{s&&f.addEventListener("close",()=>s()),i&&f.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const kl=["get","getKey","getAll","getAllKeys","count"],Sl=["put","add","delete","clear"],Ur=new Map;function pi(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ur.get(e))return Ur.get(e);const r=e.replace(/FromIndex$/,""),n=e!==r,i=Sl.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||kl.includes(r)))return;const s=async function(l,...u){const f=this.transaction(l,i?"readwrite":"readonly");let d=f.store;return n&&(d=d.index(u.shift())),(await Promise.all([d[r](...u),i&&f.done]))[0]};return Ur.set(e,s),s}po(t=>({...t,get:(e,r,n)=>pi(e,r)||t.get(e,r,n),has:(e,r)=>!!pi(e,r)||t.has(e,r)}));const _l=["continue","continuePrimaryKey","advance"],mi={},dn=new WeakMap,mo=new WeakMap,Pl={get(t,e){if(!_l.includes(e))return t[e];let r=mi[e];return r||(r=mi[e]=function(...n){dn.set(this,mo.get(this)[e](...n))}),r}};async function*Il(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const r=new Proxy(e,Pl);for(mo.set(r,e),Or.set(r,cn(e));e;)yield r,e=await(dn.get(r)||e.continue()),dn.delete(r)}function gi(t,e){return e===Symbol.asyncIterator&&an(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&an(t,[IDBIndex,IDBObjectStore])}po(t=>({...t,get(e,r,n){return gi(e,r)?Il:t.get(e,r,n)},has(e,r){return gi(e,r)||t.has(e,r)}}));const Cl="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let go=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=Cl[r[t]&63];return e};const yi=((t,e)=>new RegExp(t,e));Object.assign(yi,{cast:yi});const Ct=t=>Array.isArray(t)?t:[t],Ol=(t,e)=>{const r=[[],[]];for(const n of t)e(n)?r[0].push(n):r[1].push(n);return r},yo=Array,Re=(t,e)=>t.includes(e),Al=(t,e=0)=>[...new Array(t)].map((r,n)=>n+e),q=(t,e,r)=>t===void 0?e===void 0?[]:Array.isArray(e)?e:[e]:(Array.isArray(e)?t.push(...e):t.push(e),t),Ue=(t,e)=>e==null?t??[]:t==null?Ct(e):t.concat(e),Ml=(...t)=>t.reduce(Ue,[]),ze=(t,e,r)=>{if(t===void 0)return Array.isArray(e)?e:[e];const n=r?.isEqual??((i,s)=>i===s);for(const i of Ct(e))t.some(s=>n(s,i))||t.push(i);return t},Nl=(t,e)=>t.reduce((r,n)=>{const i=n[e];return r[i]=q(r[i],n),r},{}),it=(t,e,r)=>t.length===e.length&&t.every(r?.isEqual?(n,i)=>r.isEqual(n,e[i]):(n,i)=>n===e[i]),We=(t,e)=>ge(t)===e,ge=t=>{const e=typeof t;return e==="object"?t===null?"null":"object":e==="function"?"object":e},Ce={boolean:"boolean",null:"null",undefined:"undefined",bigint:"a bigint",number:"a number",object:"an object",string:"a string",symbol:"a symbol"},Dl={...Ce,function:"a function"};class El extends Error{}const Y=t=>st(t,El),st=(t,e=Error)=>{throw new e(t)};class Ll extends Error{name="ParseError"}const _=t=>st(t,Ll),bo=t=>` ${t}`,$l="​",F=(t,e)=>{const r={},n=Array.isArray(t);let i=!1;for(const[s,l]of Object.entries(t).entries()){const u=n?e(s,l[1]):e(...l,s);i||=typeof u[0]=="number";const f=Array.isArray(u[0])||u.length===0?u:[u];for(const[d,h]of f)typeof d=="object"?r[d.group]=q(r[d.group],h):r[d]=h}return i?Object.values(r):r},vo=Object.entries,Se=(t,e)=>t in e,Ln=(t,e)=>e in t;class Rl{constructor(e){Object.assign(this,e)}}const Tl=class{};class xo extends Tl{}const Bl=(t,e)=>{const r={},n={};let i;for(i in t)i in e?r[i]=t[i]:n[i]=t[i];return[r,n]},wo=(t,e)=>Bl(t,e)[1],Ot=t=>Object.keys(t).length===0,mr=t=>[...Object.entries(t),...Object.getOwnPropertySymbols(t).map(e=>[e,t[e]])],ql=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),Fl=t=>{const e=Object.keys(t).sort(),r={};for(let n=0;n<e.length;n++)r[e[n]]=t[e[n]];return r},be=bo(`unset${$l}`),Kl=t=>Object.values(t).filter(e=>typeof e=="number"?!0:typeof t[e]!="number"),ko={Array,Boolean,Date,Error,Function,Map,Number,Promise,RegExp,Set,String,WeakMap,WeakSet},So=globalThis.File??Blob,_o={ArrayBuffer,Blob,File:So,FormData,Headers,Request,Response,URL},jl={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array},ot={...ko,..._o,...jl,String,Number,Boolean},$n=t=>{let e=Object.getPrototypeOf(t);for(;e?.constructor&&(!Se(e.constructor.name,ot)||!(t instanceof ot[e.constructor.name]));)e=Object.getPrototypeOf(e);const r=e?.constructor?.name;if(!(r===void 0||r==="Object"))return r},hn=t=>typeof t=="object"&&t!==null?$n(t)??"object":ge(t),re=Array.isArray,Ul={Array:"an array",Function:"a function",Date:"a Date",RegExp:"a RegExp",Error:"an Error",Map:"a Map",Set:"a Set",String:"a String object",Number:"a Number object",Boolean:"a Boolean object",Promise:"a Promise",WeakMap:"a WeakMap",WeakSet:"a WeakSet"},Hl={ArrayBuffer:"an ArrayBuffer instance",Blob:"a Blob instance",File:"a File instance",FormData:"a FormData instance",Headers:"a Headers instance",Request:"a Request instance",Response:"a Response instance",URL:"a URL instance"},zl={Int8Array:"an Int8Array",Uint8Array:"a Uint8Array",Uint8ClampedArray:"a Uint8ClampedArray",Int16Array:"an Int16Array",Uint16Array:"a Uint16Array",Int32Array:"an Int32Array",Uint32Array:"a Uint32Array",Float32Array:"a Float32Array",Float64Array:"a Float64Array",BigInt64Array:"a BigInt64Array",BigUint64Array:"a BigUint64Array"},Vl={...Ul,...Hl,...zl},Rn=t=>{const e=Object(t).name??null;return e&&Se(e,ot)&&ot[e]===t?e:null},bi=(t,e)=>{let r=t.prototype;for(;r!==null;){if(r===e.prototype)return!0;r=Object.getPrototypeOf(r)}return!1},Gl=t=>Po(t,new Map),Po=(t,e)=>{if(typeof t!="object"||t===null)return t;if(e?.has(t))return e.get(t);const r=Rn(t.constructor);if(r==="Date")return new Date(t.getTime());if(r&&r!=="Array")return t;const n=Array.isArray(t)?t.slice():Object.create(Object.getPrototypeOf(t)),i=Object.getOwnPropertyDescriptors(t);if(e){e.set(t,n);for(const s in i){const l=i[s];"get"in l||"set"in l||(l.value=Po(l.value,e))}}return Object.defineProperties(n,i),n},Wl=t=>{let e=be;return()=>e===be?e=t():e},Ar=t=>typeof t=="function"&&t.length===0,Jl=class extends Function{constructor(...t){const e=t.slice(0,-1),r=t.at(-1);try{super(...e,r)}catch(n){return Y(`Encountered an unexpected error while compiling your definition:
                Message: ${n} 
                Source: (${t.slice(0,-1)}) => {
                    ${t.at(-1)}
                }`)}}};class Ke{constructor(e,...[r]){return Object.assign(Object.setPrototypeOf(e.bind(r?.bind??this),this.constructor.prototype),r?.attach)}}const Yl=Wl(()=>{try{return new Function("return false")()}catch{return!0}});class _e{constructor(){}}var Ql={};const Xl=()=>{try{return((new Error().stack?.split(`
`)[2]?.trim()||"").match(/\(?(.+?)(?::\d+:\d+)?\)?$/)?.[1]||"unknown").replace(/^file:\/\//,"")}catch{return"unknown"}},Zl=Ql??{},ec={fileName:Xl,env:Zl},tc=t=>t[0].toUpperCase()+t.slice(1),Io=t=>new RegExp(rc(t),typeof t=="string"?"":t.flags),rc=t=>`^(?:${typeof t=="string"?t:t.source})$`,Te={negativeLookahead:t=>`(?!${t})`,nonCapturingGroup:t=>`(?:${t})`},wt="\\",Mr={" ":1,"\n":1,"	":1},nc=/^-0\.?0*$/.source,Co=/[1-9]\d*/.source,ic=/\.\d+/.source,sc=/\.\d*[1-9]/.source,Oo=t=>Io(Te.negativeLookahead(nc)+Te.nonCapturingGroup("-?"+Te.nonCapturingGroup(Te.nonCapturingGroup("0|"+Co)+Te.nonCapturingGroup(t.decimalPattern)+"?")+(t.allowDecimalOnly?"|"+t.decimalPattern:"")+"?")),vi=Oo({decimalPattern:sc,allowDecimalOnly:!1}),oc=vi.test.bind(vi),fn=Oo({decimalPattern:ic,allowDecimalOnly:!0});fn.test.bind(fn);const ac=/^-?\d*\.?\d*$/,uc=t=>t.length!==0&&ac.test(t),gr=Io(Te.negativeLookahead("^-0$")+"-?"+Te.nonCapturingGroup(Te.nonCapturingGroup("0|"+Co))),lc=gr.test.bind(gr),pn=/^-?\d+$/,cc=pn.test.bind(pn),Ao={number:"a number",bigint:"a bigint",integer:"an integer"},Mo=(t,e)=>`'${t}' was parsed as ${Ao[e]} but could not be narrowed to a literal value. Avoid unnecessary leading or trailing zeros and other abnormal notation`,dc=(t,e)=>e==="number"?oc(t):lc(t),hc=(t,e)=>e==="number"?Number(t):Number.parseInt(t),fc=(t,e)=>e==="number"?uc(t):cc(t),pc=(t,e)=>Tn(t,"number",e),mc=(t,e)=>Tn(t,"number",{...e,strict:!0}),gc=(t,e)=>Tn(t,"integer",e),Tn=(t,e,r)=>{const n=hc(t,e);return!Number.isNaN(n)&&fc(t,e)?r?.strict?dc(t,e)?n:_(Mo(t,e)):n:r?.errorOnFail?_(r?.errorOnFail===!0?`Failed to parse ${Ao[e]} from '${t}'`:r?.errorOnFail):void 0},yc=t=>{if(t[t.length-1]!=="n")return;const e=t.slice(0,-1);let r;try{r=BigInt(e)}catch{return}if(gr.test(e))return r;if(pn.test(e))return _(Mo(t,"bigint"))},bc="0.50.0",vc={version:bc,filename:ec.fileName(),FileConstructor:So},At=vc,xi=new Map,Hr=Object.create(null),mn=t=>{const e=xi.get(t);if(e)return e;let r=xc(t);return Hr[r]?r=`${r}${Hr[r]++}`:Hr[r]=1,At[r]=t,xi.set(t,r),r},St=t=>/^[$A-Z_a-z][\w$]*$/.test(t),xc=t=>{switch(typeof t){case"object":{if(t===null)break;const e=$n(t)??"object";return e[0].toLowerCase()+e.slice(1)}case"function":return St(t.name)?t.name:"fn";case"symbol":return t.description&&St(t.description)?t.description:"symbol"}return Y(`Unexpected attempt to register serializable value of type ${ge(t)}`)},Bn=t=>typeof t=="string"?JSON.stringify(t):typeof t=="bigint"?`${t}n`:`${t}`,wc=(t,e={})=>kt(t,{onUndefined:"$ark.undefined",onBigInt:r=>`$ark.bigint-${r}`,...e},[]),B=(t,e)=>{switch(ge(t)){case"object":const r=t,n=r.constructor.name;return n==="Object"||n==="Array"?e?.quoteKeys===!1?yr(r,e?.indent??0,""):JSON.stringify(kt(r,at,[]),null,e?.indent):yr(r,e?.indent??0,"");case"symbol":return at.onSymbol(t);default:return Bn(t)}},yr=(t,e,r)=>{if(typeof t=="function")return at.onFunction(t);if(typeof t!="object"||t===null)return Bn(t);const n=r+" ".repeat(e);if(Array.isArray(t)){if(t.length===0)return"[]";const s=t.map(l=>yr(l,e,n)).join(`,
`+n);return e?`[
${n}${s}
${r}]`:`[${s}]`}const i=t.constructor.name;if(i==="Object"){const s=mr(t).map(([l,u])=>{const f=typeof l=="symbol"?at.onSymbol(l):St(l)?l:JSON.stringify(l),d=yr(u,e,n);return`${n}${f}: ${d}`});return s.length===0?"{}":e?`{
${s.join(`,
`)}
${r}}`:`{${s.join(", ")}}`}return t instanceof Date?Mt(t):"expression"in t&&typeof t.expression=="string"?t.expression:i},at={onCycle:()=>"(cycle)",onSymbol:t=>`Symbol(${mn(t)})`,onFunction:t=>`Function(${mn(t)})`},kt=(t,e,r)=>{switch(ge(t)){case"object":{const n=t;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();if(typeof n=="function")return at.onFunction(n);if(r.includes(n))return"(cycle)";const i=[...r,n];if(Array.isArray(n))return n.map(l=>kt(l,e,i));if(n instanceof Date)return n.toDateString();const s={};for(const l in n)s[l]=kt(n[l],e,i);for(const l of Object.getOwnPropertySymbols(n))s[e.onSymbol?.(l)??l.toString()]=kt(n[l],e,i);return s}case"symbol":return at.onSymbol(t);case"bigint":return e.onBigInt?.(t)??`${t}n`;case"undefined":return e.onUndefined??"undefined";case"string":return t.replaceAll("\\","\\\\");default:return t}},Mt=t=>{const e=t.getFullYear(),r=t.getMonth(),n=t.getDate(),i=t.getHours(),s=t.getMinutes(),l=t.getSeconds(),u=t.getMilliseconds();if(r===0&&n===1&&i===0&&s===0&&l===0&&u===0)return`${e}`;const f=`${kc[r]} ${n}, ${e}`;if(i===0&&s===0&&l===0&&u===0)return f;let d=t.toLocaleTimeString();const h=d.endsWith(" AM")||d.endsWith(" PM")?d.slice(-3):"";return h&&(d=d.slice(0,-h.length)),u?d+=`.${_c(u,3)}`:Sc.test(d)&&(d=d.slice(0,-3)),`${d+h}, ${f}`},kc=["January","February","March","April","May","June","July","August","September","October","November","December"],Sc=/:\d\d:00$/,_c=(t,e)=>String(t).padStart(e,"0"),No=(t,e,...[r])=>{const n=r?.stringifySymbol??B;let i=t;switch(typeof e){case"string":i=St(e)?t===""?e:`${t}.${e}`:`${t}[${JSON.stringify(e)}]`;break;case"number":i=`${t}[${e}]`;break;case"symbol":i=`${t}[${n(e)}]`;break;default:r?.stringifyNonKey?i=`${t}[${r.stringifyNonKey(e)}]`:_(`${B(e)} must be a PropertyKey or stringifyNonKey must be passed to options`)}return i},Nt=(t,...e)=>t.reduce((r,n)=>No(r,n,...e),"");class Do extends yo{cache={};constructor(...e){super(),this.push(...e)}toJSON(){if(this.cache.json)return this.cache.json;this.cache.json=[];for(let e=0;e<this.length;e++)this.cache.json.push(typeof this[e]=="symbol"?B(this[e]):this[e]);return this.cache.json}stringify(){return this.cache.stringify?this.cache.stringify:this.cache.stringify=Nt(this)}stringifyAncestors(){if(this.cache.stringifyAncestors)return this.cache.stringifyAncestors;let e="";const r=[e];for(const n of this)e=No(e,n),r.push(e);return this.cache.stringifyAncestors=r}}class Eo{chars;i;def;constructor(e){this.def=e,this.chars=[...e],this.i=0}shift(){return this.chars[this.i++]??""}get lookahead(){return this.chars[this.i]??""}get nextLookahead(){return this.chars[this.i+1]??""}get length(){return this.chars.length}shiftUntil(e){let r="";for(;this.lookahead&&!e(this,r);)r+=this.shift();return r}shiftUntilEscapable(e){let r="";for(;this.lookahead;)if(this.lookahead===wt)this.shift(),e(this,r)?r+=this.shift():this.lookahead===wt?r+=this.shift():r+=`${wt}${this.shift()}`;else{if(e(this,r))break;r+=this.shift()}return r}shiftUntilLookahead(e){return typeof e=="string"?this.shiftUntil(r=>r.lookahead===e):this.shiftUntil(r=>r.lookahead in e)}shiftUntilNonWhitespace(){return this.shiftUntil(()=>!(this.lookahead in Mr))}jumpToIndex(e){this.i=e<0?this.length+e:e}jumpForward(e){this.i+=e}get location(){return this.i}get unscanned(){return this.chars.slice(this.i,this.length).join("")}get scanned(){return this.chars.slice(0,this.i).join("")}sliceChars(e,r){return this.chars.slice(e,r).join("")}lookaheadIs(e){return this.lookahead===e}lookaheadIsIn(e){return this.lookahead in e}}const Pc=(t,e)=>`Unmatched ${t}${e===""?"":` before ${e}`}`,Lo=t=>`Missing ${t}`;let gn="$ark",Ic=2;for(;gn in globalThis;)gn=`$ark${Ic++}`;const $o=gn;globalThis[$o]=At;const A=At,Cc=t=>`${$o}.${t}`,oe=t=>Cc(mn(t));class Ro extends xo{argNames;body="";constructor(...e){super(),this.argNames=e;for(const r of e){if(r in this)throw new Error(`Arg name '${r}' would overwrite an existing property on FunctionBody`);this[r]=r}}indentation=0;indent(){return this.indentation+=4,this}dedent(){return this.indentation-=4,this}prop(e,r=!1){return To(e,r)}index(e,r=!1){return Bo(`${e}`,r)}line(e){return this.body+=`${" ".repeat(this.indentation)}${e}
`,this}const(e,r){return this.line(`const ${e} = ${r}`),this}let(e,r){return this.line(`let ${e} = ${r}`)}set(e,r){return this.line(`${e} = ${r}`)}if(e,r){return this.block(`if (${e})`,r)}elseIf(e,r){return this.block(`else if (${e})`,r)}else(e){return this.block("else",e)}for(e,r,n=0){return this.block(`for (let i = ${n}; ${e}; i++)`,r)}forIn(e,r){return this.block(`for (const k in ${e})`,r)}block(e,r,n=""){return this.line(`${e} {`),this.indent(),r(this),this.dedent(),this.line(`}${n}`)}return(e=""){return this.line(`return ${e}`)}write(e="anonymous",r=0){return`${e}(${this.argNames.join(", ")}) { ${r?this.body.split(`
`).map(n=>" ".repeat(r)+`${n}`).join(`
`):this.body} }`}compile(){return new Jl(...this.argNames,this.body)}}const Dt=t=>We(t,"object")||typeof t=="symbol"?oe(t):Bn(t),To=(t,e=!1)=>typeof t=="string"&&St(t)?`${e?"?":""}.${t}`:Bo(Oc(t),e),Oc=t=>typeof t=="symbol"?oe(t):JSON.stringify(t),Bo=(t,e=!1)=>`${e?"?.":""}[${t}]`;class zr extends Ro{traversalKind;optimistic;constructor(e){super("data","ctx"),this.traversalKind=e.kind,this.optimistic=e.optimistic===!0}invoke(e,r){const n=r?.arg??this.data,i=typeof e=="string"?!0:this.requiresContextFor(e),s=typeof e=="string"?e:e.id;return i?`${this.referenceToId(s,r)}(${n}, ${this.ctx})`:`${this.referenceToId(s,r)}(${n})`}referenceToId(e,r){const n=r?.kind??this.traversalKind,i=`this.${e}${n}`;return r?.bind?`${i}.bind(${r?.bind})`:i}requiresContextFor(e){return this.traversalKind==="Apply"||e.allowsRequiresContext}initializeErrorCount(){return this.const("errorCount","ctx.currentErrorCount")}returnIfFail(){return this.if("ctx.currentErrorCount > errorCount",()=>this.return())}returnIfFailFast(){return this.if("ctx.failFast && ctx.currentErrorCount > errorCount",()=>this.return())}traverseKey(e,r,n){const i=this.requiresContextFor(n);return i&&this.line(`${this.ctx}.path.push(${e})`),this.check(n,{arg:r}),i&&this.line(`${this.ctx}.path.pop()`),this}check(e,r){return this.traversalKind==="Allows"?this.if(`!${this.invoke(e,r)}`,()=>this.return(!1)):this.line(this.invoke(e,r))}}const qo=t=>F(t,(e,r)=>[e,re(r)?[...r]:r]),Oe=bo("arkKind"),D=(t,e)=>t?.[Oe]===e,se=t=>D(t,"root")||D(t,"constraint"),Ac=["unit","proto","domain"],Nr=["required","optional","index","sequence"],Fo=["pattern","divisor","exactLength","max","min","maxLength","minLength","before","after"],Ko=[...Fo,"structure","predicate"],qn=[...Ko,...Nr],Dr=["alias","union","morph","unit","intersection","proto","domain"],Mc=[...Dr,...qn],jo=F(qn,(t,e)=>[e,1]),Nc=F([...Nr,"undeclared"],(t,e)=>[e,1]),Uo=F(Mc,(t,e)=>[e,t]),fr=t=>typeof t=="string"&&t in Uo,br=t=>Uo[t],Fn=t=>Dr.slice(br(t)+1);[...Fn("union")];[...Fn("morph")];const Ve=t=>typeof t=="string"||typeof t=="boolean"||t===null?t:typeof t=="number"?Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t:Dt(t),Er=t=>{let e="{ ";for(const[r,n]of Object.entries(t))e+=`${r}: ${Dt(n)}, `;return e+" }"},z=t=>{const e=t;return e.hasAssociatedError&&(e.defaults.expected??=r=>"description"in r?r.description:e.defaults.description(r),e.defaults.actual??=r=>B(r),e.defaults.problem??=r=>`must be ${r.expected}${r.actual?` (was ${r.actual})`:""}`,e.defaults.message??=r=>{if(r.path.length===0)return r.problem;const n=`${r.propString} ${r.problem}`;return n[0]==="["?`value at ${n}`:n}),e};class Dc extends Error{name="ToJsonSchemaError";code;context;constructor(e,r){super(B(r,{quoteKeys:!1,indent:4})),this.code=e,this.context=r}hasCode(e){return this.code===e}}const Ec={dialect:"https://json-schema.org/draft/2020-12/schema",useRefs:!1,fallback:{arrayObject:t=>Q.throw("arrayObject",t),arrayPostfix:t=>Q.throw("arrayPostfix",t),defaultValue:t=>Q.throw("defaultValue",t),domain:t=>Q.throw("domain",t),morph:t=>Q.throw("morph",t),patternIntersection:t=>Q.throw("patternIntersection",t),predicate:t=>Q.throw("predicate",t),proto:t=>Q.throw("proto",t),symbolKey:t=>Q.throw("symbolKey",t),unit:t=>Q.throw("unit",t),date:t=>Q.throw("date",t)}},Q={Error:Dc,throw:(...t)=>{throw new Q.Error(...t)},throwInternalOperandError:(t,e)=>Y(`Unexpected JSON Schema input for ${t}: ${B(e)}`),defaultConfig:Ec};A.config??={};const yn=(t,e)=>{if(!e)return t;const r={...t};let n;for(n in e){const i={...t.keywords};if(n==="keywords"){for(const s in e[n]){const l=e.keywords[s];l!==void 0&&(i[s]=typeof l=="string"?{description:l}:l)}r.keywords=i}else n==="toJsonSchema"?r[n]=Ho(t.toJsonSchema,e.toJsonSchema):fr(n)?r[n]={...t[n],...e[n]}:r[n]=e[n]}return r},Ho=((t,e)=>{if(!t)return e??{};if(!e)return t;const r={...t};let n;for(n in e)n==="fallback"?r.fallback=Lc(t.fallback,e.fallback):r[n]=e[n];return r}),Lc=(t,e)=>{t=wi(t),e=wi(e);const r={};let n;for(n in Q.defaultConfig.fallback)r[n]=e[n]??e.default??t[n]??t.default??Q.defaultConfig.fallback[n];return r},wi=t=>typeof t=="function"?{default:t}:t??{};class ut extends xo{[Oe]="error";path;data;nodeConfig;input;ctx;constructor({prefixPath:e,relativePath:r,...n},i){super(),this.input=n,this.ctx=i,ql(this,n);const s=i.data;n.code==="union"&&(n.errors=n.errors.flatMap(u=>{const f=u.hasCode("union")?u.errors:[u];return!e&&!r?f:f.map(d=>d.transform(h=>({...h,path:Ml(e,h.path,r)})))})),this.nodeConfig=i.config[this.code];const l=[...n.path??i.path];r&&l.push(...r),e&&l.unshift(...e),this.path=new Do(...l),this.data="data"in n?n.data:s}transform(e){return new ut(e({data:this.data,path:this.path,...this.input}),this.ctx)}hasCode(e){return this.code===e}get propString(){return Nt(this.path)}get expected(){if(this.input.expected)return this.input.expected;const e=this.meta?.expected??this.nodeConfig.expected;return typeof e=="function"?e(this.input):e}get actual(){if(this.input.actual)return this.input.actual;const e=this.meta?.actual??this.nodeConfig.actual;return typeof e=="function"?e(this.data):e}get problem(){if(this.input.problem)return this.input.problem;const e=this.meta?.problem??this.nodeConfig.problem;return typeof e=="function"?e(this):e}get message(){if(this.input.message)return this.input.message;const e=this.meta?.message??this.nodeConfig.message;return typeof e=="function"?e(this):e}get flat(){return this.hasCode("intersection")?[...this.errors]:[this]}toJSON(){return{data:this.data,path:this.path,...this.input,expected:this.expected,actual:this.actual,problem:this.problem,message:this.message}}toString(){return this.message}throw(){throw this}}class qe extends yo{[Oe]="errors";ctx;constructor(e){super(),this.ctx=e}byPath=Object.create(null);get flatByPath(){return F(this.byPath,(e,r)=>[e,r.flat])}get flatProblemsByPath(){return F(this.byPath,(e,r)=>[e,r.flat.map(n=>n.problem)])}byAncestorPath=Object.create(null);count=0;mutable=this;throw(){throw this.toTraversalError()}toTraversalError(){return new $c(this)}add(e){const r=this.byPath[e.propString];if(r){if(e===r||r.hasCode("union")&&r.errors.length===0)return;const n=e.hasCode("union")&&e.errors.length===0?e:new ut({code:"intersection",errors:r.hasCode("intersection")?[...r.errors,e]:[r,e]},this.ctx),i=this.indexOf(r);this.mutable[i===-1?this.length:i]=n,this.byPath[e.propString]=n,this.addAncestorPaths(e)}else this.byPath[e.propString]=e,this.addAncestorPaths(e),this.mutable.push(e);this.count++}transform(e){const r=new qe(this.ctx);for(const n of this)r.add(e(n));return r}merge(e){for(const r of e)this.add(new ut({...r,path:[...this.ctx.path,...r.path]},this.ctx))}affectsPath(e){return this.length===0?!1:e.stringifyAncestors().some(r=>r in this.byPath)||e.stringify()in this.byAncestorPath}get summary(){return this.toString()}get issues(){return this}toJSON(){return[...this.map(e=>e.toJSON())]}toString(){return this.join(`
`)}addAncestorPaths(e){for(const r of e.path.stringifyAncestors())this.byAncestorPath[r]=q(this.byAncestorPath[r],e)}}class $c extends Error{name="TraversalError";constructor(e){e.length===1?super(e.summary):super(`
`+e.map(r=>`  • ${Rc(r)}`).join(`
`)),Object.defineProperty(this,"arkErrors",{value:e,enumerable:!1})}}const Rc=t=>t.toString().split(`
`).join(`
  `);class tt{path=[];errors=new qe(this);root;config;queuedMorphs=[];branches=[];seen={};constructor(e,r){this.root=e,this.config=r}get data(){let e=this.root;for(const r of this.path)e=e?.[r];return e}get propString(){return Nt(this.path)}reject(e){return this.error(e),!1}mustBe(e){return this.error(e),!1}error(e){const r=typeof e=="object"?e.code?e:{...e,code:"predicate"}:{code:"predicate",expected:e};return this.errorFromContext(r)}hasError(){return this.currentErrorCount!==0}get currentBranch(){return this.branches.at(-1)}queueMorphs(e){const r={path:new Do(...this.path),morphs:e};this.currentBranch?this.currentBranch.queuedMorphs.push(r):this.queuedMorphs.push(r)}finalize(e){return this.queuedMorphs.length&&(typeof this.root=="object"&&this.root!==null&&this.config.clone&&(this.root=this.config.clone(this.root)),this.applyQueuedMorphs()),this.hasError()?e?e(this.errors):this.errors:this.root}get currentErrorCount(){return this.currentBranch?this.currentBranch.error?1:0:this.errors.count}get failFast(){return this.branches.length!==0}pushBranch(){this.branches.push({error:void 0,queuedMorphs:[]})}popBranch(){return this.branches.pop()}get external(){return this}errorFromNodeContext(e){return this.errorFromContext(e)}errorFromContext(e){const r=new ut(e,this);return this.currentBranch?this.currentBranch.error=r:this.errors.add(r),r}applyQueuedMorphs(){for(;this.queuedMorphs.length;){const e=this.queuedMorphs;this.queuedMorphs=[];for(const{path:r,morphs:n}of e)this.errors.affectsPath(r)||this.applyMorphsAtPath(r,n)}}applyMorphsAtPath(e,r){const n=e.at(-1);let i;if(n!==void 0){i=this.root;for(let s=0;s<e.length-1;s++)i=i[e[s]]}for(const s of r){this.path=[...e];const l=se(s),u=s(i===void 0?this.root:i[n],this);if(u instanceof ut){this.errors.add(u);break}if(u instanceof qe){l||this.errors.merge(u),this.queuedMorphs=[];break}i===void 0?this.root=u:i[n]=u,this.applyQueuedMorphs()}}}const Ae=(t,e,r)=>{if(!r)return e();r.path.push(t);const n=e();return r.path.pop(),n};class zo extends Ke{attachments;$;onFail;includesTransform;includesContextualPredicate;isCyclic;allowsRequiresContext;rootApplyStrategy;contextFreeMorph;rootApply;referencesById;shallowReferences;flatRefs;flatMorphs;allows;get shallowMorphs(){return[]}constructor(e,r){super((i,s,l=this.onFail)=>s?(this.traverseApply(i,s),s.hasError()?s.errors:s.data):this.rootApply(i,l),{attach:e}),this.attachments=e,this.$=r,this.onFail=this.meta.onFail??this.$.resolvedConfig.onFail,this.includesTransform=this.hasKind("morph")||this.hasKind("structure")&&this.structuralMorph!==void 0||this.hasKind("sequence")&&this.inner.defaultables!==void 0,this.includesContextualPredicate=this.hasKind("predicate")&&this.inner.predicate.length!==1,this.isCyclic=this.kind==="alias",this.referencesById={[this.id]:this},this.shallowReferences=this.hasKind("structure")?[this,...this.children]:this.children.reduce((i,s)=>Fc(i,s.shallowReferences),[this]);const n=this.isStructural();this.flatRefs=[],this.flatMorphs=[];for(let i=0;i<this.children.length;i++){if(this.includesTransform||=this.children[i].includesTransform,this.includesContextualPredicate||=this.children[i].includesContextualPredicate,this.isCyclic||=this.children[i].isCyclic,!n){const s=this.children[i].flatRefs;for(let l=0;l<s.length;l++){const u=s[l];if(!this.flatRefs.some(f=>Vo(f,u))){this.flatRefs.push(u);for(const f of u.node.branches)(f.hasKind("morph")||f.hasKind("intersection")&&f.structure?.structuralMorph!==void 0)&&this.flatMorphs.push({path:u.path,propString:u.propString,node:f})}}}Object.assign(this.referencesById,this.children[i].referencesById)}this.flatRefs.sort((i,s)=>i.path.length>s.path.length?1:i.path.length<s.path.length?-1:i.propString>s.propString?1:i.propString<s.propString||i.node.expression<s.node.expression?-1:1),this.allowsRequiresContext=this.includesContextualPredicate||this.isCyclic,this.rootApplyStrategy=!this.allowsRequiresContext&&this.flatMorphs.length===0?this.shallowMorphs.length===0?"allows":this.shallowMorphs.every(i=>i.length===1||i.name==="$arkStructuralMorph")?this.hasKind("union")?this.branches.some(i=>i.shallowMorphs.length>1)?"contextual":"branchedOptimistic":this.shallowMorphs.length>1?"contextual":"optimistic":"contextual":"contextual",this.rootApply=this.createRootApply(),this.allows=this.allowsRequiresContext?i=>this.traverseAllows(i,new tt(i,this.$.resolvedConfig)):i=>this.traverseAllows(i)}createRootApply(){switch(this.rootApplyStrategy){case"allows":return(r,n)=>{if(this.allows(r))return r;const i=new tt(r,this.$.resolvedConfig);return this.traverseApply(r,i),i.finalize(n)};case"contextual":return(r,n)=>{const i=new tt(r,this.$.resolvedConfig);return this.traverseApply(r,i),i.finalize(n)};case"optimistic":this.contextFreeMorph=this.shallowMorphs[0];const e=this.$.resolvedConfig.clone;return(r,n)=>{if(this.allows(r))return this.contextFreeMorph(e&&(typeof r=="object"&&r!==null||typeof r=="function")?e(r):r);const i=new tt(r,this.$.resolvedConfig);return this.traverseApply(r,i),i.finalize(n)};case"branchedOptimistic":return this.createBranchedOptimisticRootApply();default:return this.rootApplyStrategy,Y(`Unexpected rootApplyStrategy ${this.rootApplyStrategy}`)}}compiledMeta=qc(this.metaJson);cacheGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}get description(){return this.cacheGetter("description",this.meta?.description??this.$.resolvedConfig[this.kind].description(this))}get references(){return Object.values(this.referencesById)}precedence=br(this.kind);precompilation;assert=(e,r)=>this(e,r,n=>n.throw());traverse(e,r){return this(e,r,null)}get in(){return this.cacheGetter("in",this.rawIn.isRoot()?this.$.finalize(this.rawIn):this.rawIn)}get rawIn(){return this.cacheGetter("rawIn",this.getIo("in"))}get out(){return this.cacheGetter("out",this.rawOut.isRoot()?this.$.finalize(this.rawOut):this.rawOut)}get rawOut(){return this.cacheGetter("rawOut",this.getIo("out"))}getIo(e){if(!this.includesTransform)return this;const r={};for(const[n,i]of this.innerEntries){const s=this.impl.keys[n];if(s.reduceIo)s.reduceIo(e,r,i);else if(s.child){const l=i;r[n]=re(l)?l.map(u=>e==="in"?u.rawIn:u.rawOut):e==="in"?l.rawIn:l.rawOut}else r[n]=i}return this.$.node(this.kind,r)}toJSON(){return this.json}toString(){return`Type<${this.expression}>`}equals(e){const r=se(e)?e:this.$.parseDefinition(e);return this.innerHash===r.innerHash}ifEquals(e){return this.equals(e)?this:void 0}hasKind(e){return this.kind===e}assertHasKind(e){return this.kind!==e&&st(`${this.kind} node was not of asserted kind ${e}`),this}hasKindIn(...e){return e.includes(this.kind)}assertHasKindIn(...e){return Re(e,this.kind)||st(`${this.kind} node was not one of asserted kinds ${e}`),this}isBasis(){return Re(Ac,this.kind)}isConstraint(){return Re(qn,this.kind)}isStructural(){return Re(Nr,this.kind)}isRefinement(){return Re(Ko,this.kind)}isRoot(){return Re(Dr,this.kind)}isUnknown(){return this.hasKind("intersection")&&this.children.length===0}isNever(){return this.hasKind("union")&&this.children.length===0}hasUnit(e){return this.hasKind("unit")&&this.allows(e)}hasOpenIntersection(){return this.impl.intersectionIsOpen}get nestableExpression(){return this.expression}select(e){const r=vt.normalize(e);return this._select(r)}_select(e){let r=vt.applyBoundary[e.boundary??"references"](this);return e.kind&&(r=r.filter(n=>n.kind===e.kind)),e.where&&(r=r.filter(e.where)),vt.applyMethod[e.method??"filter"](r,this,e)}transform(e,r){return this._transform(e,this._createTransformContext(r))}_createTransformContext(e){return{root:this,selected:void 0,seen:{},path:[],parseOptions:{prereduced:e?.prereduced??!1},undeclaredKeyHandling:void 0,...e}}_transform(e,r){const n=r.bindScope??this.$;if(r.seen[this.id])return this.$.lazilyResolve(r.seen[this.id]);if(r.shouldTransform?.(this,r)===!1)return this;let i;r.seen[this.id]=()=>i,this.hasKind("structure")&&this.undeclared!==r.undeclaredKeyHandling&&(r={...r,undeclaredKeyHandling:this.undeclared});const s=F(this.inner,(h,p)=>{if(!this.impl.keys[h].child)return[h,p];const c=p;if(!re(c)){const o=c._transform(e,r);return o?[h,o]:[]}if(c.length===0)return[h,p];const a=c.flatMap(o=>o._transform(e,r)??[]);return a.length?[h,a]:[]});delete r.seen[this.id];const l=Object.assign(s,{meta:this.meta}),u=r.selected&&!r.selected.includes(this)?l:e(this.kind,l,r);if(u===null)return null;if(se(u))return i=u;const f=Object.keys(u);return(f.length===0||f.length===1&&f[0]==="meta")&&!Ot(this.inner)?null:(this.kind==="required"||this.kind==="optional"||this.kind==="index")&&!("value"in u)?r.undeclaredKeyHandling?{...u,value:A.intrinsic.unknown}:null:(this.kind==="morph"&&(u.in??=A.intrinsic.unknown),i=n.node(this.kind,u,r.parseOptions))}configureReferences(e,r="references"){const n=vt.normalize(r),i=typeof e=="string"?(f,d)=>({...d,meta:{...d.meta,description:e}}):typeof e=="function"?(f,d)=>({...d,meta:e(d.meta)}):(f,d)=>({...d,meta:{...d.meta,...e}});if(n.boundary==="self")return this.$.node(this.kind,i(this.kind,{...this.inner,meta:this.meta}));const s=this._select(n),l=s&&Ct(s),u=n.boundary==="child"?(f,d)=>d.root.children.includes(f):n.boundary==="shallow"?f=>f.kind!=="structure":()=>!0;return this.$.finalize(this.transform(i,{shouldTransform:u,selected:l}))}}const vt={applyBoundary:{self:t=>[t],child:t=>[...t.children],shallow:t=>[...t.shallowReferences],references:t=>[...t.references]},applyMethod:{filter:t=>t,assertFilter:(t,e,r)=>(t.length===0&&st(ki(e,r)),t),find:t=>t[0],assertFind:(t,e,r)=>(t.length===0&&st(ki(e,r)),t[0])},normalize:t=>typeof t=="function"?{boundary:"references",method:"filter",where:t}:typeof t=="string"?Se(t,vt.applyBoundary)?{method:"filter",boundary:t}:{boundary:"references",method:"filter",kind:t}:{boundary:"references",method:"filter",...t}},ki=(t,e)=>`${t} had no references matching ${B(e)}.`,Tc=t=>Nt(t,{stringifyNonKey:e=>e.expression}),Bc=/"(\$ark\.[^"]+)"/g,qc=t=>JSON.stringify(t).replaceAll(Bc,"$1"),Be=(t,e)=>({path:t,node:e,propString:Tc(t)}),Vo=(t,e)=>t.propString===e.propString&&t.node.equals(e.node),Si=(t,e)=>ze(t,e,{isEqual:Vo}),Fc=(t,e)=>ze(t,e,{isEqual:(r,n)=>r.equals(n)});class N extends Array{static init(e,r,n,i){return new N({kind:e,l:r,r:n,path:i?.path??[],optional:i?.optional??!1})}add(e,r,n,i){return this.push({kind:e,l:r,r:n,path:i?.path??[],optional:i?.optional??!1}),this}get summary(){return this.describeReasons()}describeReasons(){if(this.length===1){const{path:e,l:r,r:n}=this[0],i=Nt(e);return Go(`Intersection${i&&` at ${i}`} of ${_i(r,n)}`)}return`The following intersections result in unsatisfiable types:
• ${this.map(({path:e,l:r,r:n})=>`${e}: ${_i(r,n)}`).join(`
• `)}`}throw(){return _(this.describeReasons())}invert(){const e=this.map(r=>({...r,l:r.r,r:r.l}));return e instanceof N?e:new N(...e)}withPrefixKey(e,r){return this.map(n=>({...n,path:[e,...n.path],optional:n.optional||r==="optional"}))}toNeverIfDisjoint(){return A.intrinsic.never}}const _i=(t,e)=>`${bn(t)} and ${bn(e)}`,bn=t=>se(t)?t.expression:re(t)?t.map(bn).join(" | ")||"never":String(t),Go=t=>`${t} results in an unsatisfiable type`,Je={},Me=(t,e,r)=>Z(t,e,{$:r,invert:!1,pipe:!1}),vn=(t,e,r)=>Z(t,e,{$:r,invert:!1,pipe:!0}),Z=((t,e,r)=>{const n=r.pipe?"|>":"&",i=`${t.hash}${n}${e.hash}`;if(Je[i]!==void 0)return Je[i];if(!r.pipe){const u=`${e.hash}${n}${t.hash}`;if(Je[u]!==void 0){const f=Je[u],d=f instanceof N?f.invert():f;return Je[i]=d,d}}const s=!r.pipe||!t.includesTransform&&!e.includesTransform;if(s&&t.equals(e))return t;let l=s?xn(t,e,r):t.hasKindIn(...Dr)?Kc(t,e,r):xn(t,e,r);return se(l)&&(t.equals(l)?l=t:e.equals(l)&&(l=e)),Je[i]=l,l}),xn=(t,e,r)=>{const n=t.precedence<e.precedence?t.kind:e.kind,i=t.impl.intersections[e.kind]??e.impl.intersections[t.kind];if(i===void 0)return null;if(n===t.kind)return i(t,e,r);{let s=i(e,t,{...r,invert:!r.invert});return s instanceof N&&(s=s.invert()),s}},Kc=(t,e,r)=>t.includesTransform||e.includesTransform?r.invert?Pi(e,t,r):Pi(t,e,r):xn(t,e,r),Pi=(t,e,r)=>t.distribute(n=>jc(n,e,r),n=>{const i=n.filter(se);if(i.length===0)return N.init("union",t.branches,e.branches);if(i.length<t.branches.length||!t.branches.every((l,u)=>l.rawIn.equals(i[u].rawIn)))return r.$.parseSchema(i);if(i.length===1)return i[0];const s={branches:i};return r.$.parseSchema(s)}),jc=(t,e,r)=>{if(t.hasKind("morph")){const i=[...t.morphs];if(t.lastMorphIfNode){const s=Z(t.lastMorphIfNode,e,r);if(s instanceof N)return s;i[i.length-1]=s}else i.push(e);return r.$.node("morph",{morphs:i,in:t.inner.in})}if(e.hasKind("morph")){const i=Z(t,e.rawIn,r);return i instanceof N?i:r.$.node("morph",{morphs:[e],in:i})}return r.$.node("morph",{morphs:[e],in:t})};class ct extends zo{constructor(e,r){super(e,r),Object.defineProperty(this,Oe,{value:"constraint",enumerable:!1})}impliedSiblings;intersect(e){return Me(this,e,this.$)}}class Lr extends ct{traverseApply=(e,r)=>{this.traverseAllows(e,r)||r.errorFromNodeContext(this.errorContext)};compile(e){e.traversalKind==="Allows"?e.return(this.compiledCondition):e.if(this.compiledNegation,()=>e.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return Er(this.errorContext)}}const le=t=>(e,r)=>{if(re(e)){if(e.length===0)return;const i=e.map(s=>r.$.node(t,s));return t==="predicate"?i:i.sort((s,l)=>s.hash<l.hash?-1:1)}const n=r.$.node(t,e);return n.hasOpenIntersection()?[n]:n},vr=t=>{const e=t.r.shift();if(!e){let n=t.l.length===0&&t.kind==="structure"?A.intrinsic.unknown.internal:t.ctx.$.node(t.kind,Object.assign(t.baseInner,Uc(t.l)),{prereduced:!0});for(const i of t.roots){if(n instanceof N)return n;n=Z(i,n,t.ctx)}return n}let r=!1;for(let n=0;n<t.l.length;n++){const i=Z(t.l[n],e,t.ctx);if(i!==null){if(i instanceof N)return i;if(i.isRoot())return t.roots.push(i),t.l.splice(n),vr(t);if(!r)t.l[n]=i,r=!0;else if(!t.l.includes(i))return Y(`Unexpectedly encountered multiple distinct intersection results for refinement ${e}`)}}if(r||t.l.push(e),t.kind==="intersection"&&e.impliedSiblings)for(const n of e.impliedSiblings)ze(t.r,n);return vr(t)},xr=t=>Object.entries(t).flatMap(([r,n])=>r in jo?n:[]).sort((r,n)=>r.precedence<n.precedence?-1:r.precedence>n.precedence?1:r.kind==="predicate"&&n.kind==="predicate"?0:r.hash<n.hash?-1:1),Uc=t=>{const e={};for(const r of t)if(r.hasOpenIntersection())e[r.kind]=q(e[r.kind],r);else{if(e[r.kind])return Y(`Unexpected intersection of closed refinements of kind ${r.kind}`);e[r.kind]=r}return e},Hc=(...t)=>_(zc(...t)),zc=(t,e,r)=>{const n=r.hasKind("morph")?"a morph":r.isUnknown()?"unknown":r.exclude(e).defaultShortDescription;return`${tc(t)} operand must be ${e.description} (was ${n})`},Vc=(t,e,r)=>new wr(t,e,r,r,null);class Wo extends Ke{}class wr extends Ke{[Oe]="generic";paramDefs;bodyDef;$;arg$;baseInstantiation;hkt;description;constructor(e,r,n,i,s){super((...l)=>{const u=F(this.names,(f,d)=>{const h=this.arg$.parse(l[f]);return h.extends(this.constraints[f])||_(Gc(d,this.constraints[f].expression,h.expression)),[d,h]});if(this.defIsLazy()){const f=this.bodyDef(u);return this.$.parse(f)}return this.$.parse(r,{args:u})}),this.paramDefs=e,this.bodyDef=r,this.$=n,this.arg$=i,this.hkt=s,this.description=s?new s().description??`a generic type for ${s.constructor.name}`:"a generic type",this.baseInstantiation=this(...this.constraints)}defIsLazy(){return this.bodyDef instanceof Wo}cacheGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}get json(){return this.cacheGetter("json",{params:this.params.map(e=>e[1].isUnknown()?e[0]:[e[0],e[1].json]),body:wc(this.bodyDef)})}get params(){return this.cacheGetter("params",this.paramDefs.map(e=>typeof e=="string"?[e,A.intrinsic.unknown]:[e[0],this.$.parse(e[1])]))}get names(){return this.cacheGetter("names",this.params.map(e=>e[0]))}get constraints(){return this.cacheGetter("constraints",this.params.map(e=>e[1]))}get internal(){return this}get referencesById(){return this.baseInstantiation.internal.referencesById}get references(){return this.baseInstantiation.internal.references}}const Gc=(t,e,r)=>`${t} must be assignable to ${e} (was ${r})`,Wc=z({kind:"predicate",hasAssociatedError:!0,collapsibleKey:"predicate",keys:{predicate:{}},normalize:t=>typeof t=="function"?{predicate:t}:t,defaults:{description:t=>`valid according to ${t.predicate.name||"an anonymous predicate"}`},intersectionIsOpen:!0,intersections:{predicate:()=>null}});class Jc extends ct{serializedPredicate=oe(this.predicate);compiledCondition=`${this.serializedPredicate}(data, ctx)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=null;expression=this.serializedPredicate;traverseAllows=this.predicate;errorContext={code:"predicate",description:this.description,meta:this.meta};compiledErrorContext=Er(this.errorContext);traverseApply=(e,r)=>{!this.predicate(e,r.external)&&!r.hasError()&&r.errorFromNodeContext(this.errorContext)};compile(e){if(e.traversalKind==="Allows"){e.return(this.compiledCondition);return}e.if(`${this.compiledNegation} && !ctx.hasError()`,()=>e.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}reduceJsonSchema(e,r){return r.fallback.predicate({code:"predicate",base:e,predicate:this.predicate})}}const Jo={implementation:Wc,Node:Jc},Yc=z({kind:"divisor",collapsibleKey:"rule",keys:{rule:{parse:t=>Number.isInteger(t)?t:_(Xc(t))}},normalize:t=>typeof t=="number"?{rule:t}:t,hasAssociatedError:!0,defaults:{description:t=>t.rule===1?"an integer":t.rule===2?"even":`a multiple of ${t.rule}`},intersections:{divisor:(t,e,r)=>r.$.node("divisor",{rule:Math.abs(t.rule*e.rule/Zc(t.rule,e.rule))})},obviatesBasisDescription:!0});class Qc extends Lr{traverseAllows=e=>e%this.rule===0;compiledCondition=`data % ${this.rule} === 0`;compiledNegation=`data % ${this.rule} !== 0`;impliedBasis=A.intrinsic.number.internal;expression=`% ${this.rule}`;reduceJsonSchema(e){return e.type="integer",this.rule===1||(e.multipleOf=this.rule),e}}const Yo={implementation:Yc,Node:Qc},Xc=t=>`divisor must be an integer (was ${t})`,Zc=(t,e)=>{let r,n=t,i=e;for(;i!==0;)r=i,i=n%i,n=r;return n};class dt extends Lr{boundOperandKind=nd[this.kind];compiledActual=this.boundOperandKind==="value"?"data":this.boundOperandKind==="length"?"data.length":"data.valueOf()";comparator=id(this.kind,this.exclusive);numericLimit=this.rule.valueOf();expression=`${this.comparator} ${this.rule}`;compiledCondition=`${this.compiledActual} ${this.comparator} ${this.numericLimit}`;compiledNegation=`${this.compiledActual} ${ed[this.comparator]} ${this.numericLimit}`;stringLimit=this.boundOperandKind==="date"?sd(this.numericLimit):`${this.numericLimit}`;limitKind=this.comparator[0]==="<"?"upper":"lower";isStricterThan(e){return(this.limitKind==="upper"?this.numericLimit<e.numericLimit:this.numericLimit>e.numericLimit)||this.numericLimit===e.numericLimit&&this.exclusive===!0&&!e.exclusive}overlapsRange(e){return!(this.isStricterThan(e)||this.numericLimit===e.numericLimit&&(this.exclusive||e.exclusive))}overlapIsUnit(e){return this.numericLimit===e.numericLimit&&!this.exclusive&&!e.exclusive}}const ed={"<":">=","<=":">",">":"<=",">=":"<"},td={min:"max",minLength:"maxLength",after:"before"},Qo={parse:t=>t||void 0},Xo=t=>e=>{if(typeof e=="number")return{rule:e};const{exclusive:r,...n}=e;return r?{...n,rule:t==="minLength"?n.rule+1:n.rule-1}:n},Zo=t=>e=>{if(typeof e=="number"||typeof e=="string"||e instanceof Date)return{rule:e};const{exclusive:r,...n}=e;if(!r)return n;const i=typeof n.rule=="number"?n.rule:typeof n.rule=="string"?new Date(n.rule).valueOf():n.rule.valueOf();return r?{...n,rule:t==="after"?i+1:i-1}:n},ea=t=>typeof t=="string"||typeof t=="number"?new Date(t):t,rd=(t,e)=>`${t} bound must be a positive integer (was ${e})`,Kn=t=>e=>((!Number.isInteger(e)||e<0)&&_(rd(t,e)),e),nd={min:"value",max:"value",minLength:"length",maxLength:"length",after:"date",before:"date"},id=(t,e)=>`${Se(t,td)?">":"<"}${e?"":"="}`,sd=t=>typeof t=="string"?t:new Date(t).toLocaleString(),od=t=>`Bounded expression ${t} must be exactly one of number, string, Array, or Date`,ad=z({kind:"after",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:ea,serialize:t=>t.toISOString()}},normalize:Zo("after"),defaults:{description:t=>`${t.collapsibleLimitString} or later`,actual:Mt},intersections:{after:(t,e)=>t.isStricterThan(e)?t:e}});class ud extends dt{impliedBasis=A.intrinsic.Date.internal;collapsibleLimitString=Mt(this.rule);traverseAllows=e=>e>=this.rule;reduceJsonSchema(e,r){return r.fallback.date({code:"date",base:e,after:this.rule})}}const ta={implementation:ad,Node:ud},ld=z({kind:"before",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:ea,serialize:t=>t.toISOString()}},normalize:Zo("before"),defaults:{description:t=>`${t.collapsibleLimitString} or earlier`,actual:Mt},intersections:{before:(t,e)=>t.isStricterThan(e)?t:e,after:(t,e,r)=>t.overlapsRange(e)?t.overlapIsUnit(e)?r.$.node("unit",{unit:t.rule}):null:N.init("range",t,e)}});class cd extends dt{collapsibleLimitString=Mt(this.rule);traverseAllows=e=>e<=this.rule;impliedBasis=A.intrinsic.Date.internal;reduceJsonSchema(e,r){return r.fallback.date({code:"date",base:e,before:this.rule})}}const ra={implementation:ld,Node:cd},dd=z({kind:"exactLength",collapsibleKey:"rule",keys:{rule:{parse:Kn("exactLength")}},normalize:t=>typeof t=="number"?{rule:t}:t,hasAssociatedError:!0,defaults:{description:t=>`exactly length ${t.rule}`,actual:t=>`${t.length}`},intersections:{exactLength:(t,e,r)=>N.init("unit",r.$.node("unit",{unit:t.rule}),r.$.node("unit",{unit:e.rule}),{path:["length"]}),minLength:(t,e)=>t.rule>=e.rule?t:N.init("range",t,e),maxLength:(t,e)=>t.rule<=e.rule?t:N.init("range",t,e)}});class hd extends Lr{traverseAllows=e=>e.length===this.rule;compiledCondition=`data.length === ${this.rule}`;compiledNegation=`data.length !== ${this.rule}`;impliedBasis=A.intrinsic.lengthBoundable.internal;expression=`== ${this.rule}`;reduceJsonSchema(e){switch(e.type){case"string":return e.minLength=this.rule,e.maxLength=this.rule,e;case"array":return e.minItems=this.rule,e.maxItems=this.rule,e;default:return Q.throwInternalOperandError("exactLength",e)}}}const na={implementation:dd,Node:hd},fd=z({kind:"max",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:Qo},normalize:t=>typeof t=="number"?{rule:t}:t,defaults:{description:t=>t.rule===0?t.exclusive?"negative":"non-positive":`${t.exclusive?"less than":"at most"} ${t.rule}`},intersections:{max:(t,e)=>t.isStricterThan(e)?t:e,min:(t,e,r)=>t.overlapsRange(e)?t.overlapIsUnit(e)?r.$.node("unit",{unit:t.rule}):null:N.init("range",t,e)},obviatesBasisDescription:!0});class pd extends dt{impliedBasis=A.intrinsic.number.internal;traverseAllows=this.exclusive?e=>e<this.rule:e=>e<=this.rule;reduceJsonSchema(e){return this.exclusive?e.exclusiveMaximum=this.rule:e.maximum=this.rule,e}}const ia={implementation:fd,Node:pd},md=z({kind:"maxLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Kn("maxLength")}},reduce:(t,e)=>t.rule===0?e.node("exactLength",t):void 0,normalize:Xo("maxLength"),defaults:{description:t=>`at most length ${t.rule}`,actual:t=>`${t.length}`},intersections:{maxLength:(t,e)=>t.isStricterThan(e)?t:e,minLength:(t,e,r)=>t.overlapsRange(e)?t.overlapIsUnit(e)?r.$.node("exactLength",{rule:t.rule}):null:N.init("range",t,e)}});class gd extends dt{impliedBasis=A.intrinsic.lengthBoundable.internal;traverseAllows=e=>e.length<=this.rule;reduceJsonSchema(e){switch(e.type){case"string":return e.maxLength=this.rule,e;case"array":return e.maxItems=this.rule,e;default:return Q.throwInternalOperandError("maxLength",e)}}}const sa={implementation:md,Node:gd},yd=z({kind:"min",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:Qo},normalize:t=>typeof t=="number"?{rule:t}:t,defaults:{description:t=>t.rule===0?t.exclusive?"positive":"non-negative":`${t.exclusive?"more than":"at least"} ${t.rule}`},intersections:{min:(t,e)=>t.isStricterThan(e)?t:e},obviatesBasisDescription:!0});class bd extends dt{impliedBasis=A.intrinsic.number.internal;traverseAllows=this.exclusive?e=>e>this.rule:e=>e>=this.rule;reduceJsonSchema(e){return this.exclusive?e.exclusiveMinimum=this.rule:e.minimum=this.rule,e}}const oa={implementation:yd,Node:bd},vd=z({kind:"minLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Kn("minLength")}},reduce:t=>t.rule===0?A.intrinsic.unknown:void 0,normalize:Xo("minLength"),defaults:{description:t=>t.rule===1?"non-empty":`at least length ${t.rule}`,actual:t=>t.length===0?"":`${t.length}`},intersections:{minLength:(t,e)=>t.isStricterThan(e)?t:e}});class xd extends dt{impliedBasis=A.intrinsic.lengthBoundable.internal;traverseAllows=e=>e.length>=this.rule;reduceJsonSchema(e){switch(e.type){case"string":return e.minLength=this.rule,e;case"array":return e.minItems=this.rule,e;default:return Q.throwInternalOperandError("minLength",e)}}}const aa={implementation:vd,Node:xd},wd={min:oa.implementation,max:ia.implementation,minLength:aa.implementation,maxLength:sa.implementation,exactLength:na.implementation,after:ta.implementation,before:ra.implementation},kd={min:oa.Node,max:ia.Node,minLength:aa.Node,maxLength:sa.Node,exactLength:na.Node,after:ta.Node,before:ra.Node},Sd=z({kind:"pattern",collapsibleKey:"rule",keys:{rule:{},flags:{}},normalize:t=>typeof t=="string"?{rule:t}:t instanceof RegExp?t.flags?{rule:t.source,flags:t.flags}:{rule:t.source}:t,obviatesBasisDescription:!0,obviatesBasisExpression:!0,hasAssociatedError:!0,intersectionIsOpen:!0,defaults:{description:t=>`matched by ${t.rule}`},intersections:{pattern:()=>null}});class _d extends Lr{instance=new RegExp(this.rule,this.flags);expression=`${this.instance}`;traverseAllows=this.instance.test.bind(this.instance);compiledCondition=`${this.expression}.test(data)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=A.intrinsic.string.internal;reduceJsonSchema(e,r){return e.pattern?r.fallback.patternIntersection({code:"patternIntersection",base:e,pattern:this.rule}):(e.pattern=this.rule,e)}}const ua={implementation:Sd,Node:_d},pr=(t,e)=>{const r=Pd(t);return e&&!e.includes(r)?_(`Root of kind ${r} should be one of ${e}`):r},Pd=t=>{if(D(t,"root"))return t.kind;if(typeof t=="string")return t[0]==="$"?"alias":t in Ce?"domain":"proto";if(typeof t=="function")return"proto";if(typeof t!="object"||t===null)return _(Ii(t));if("morphs"in t)return"morph";if("branches"in t||re(t))return"union";if("unit"in t)return"unit";if("reference"in t)return"alias";const e=Object.keys(t);return e.length===0||e.some(r=>r in jo)?"intersection":"proto"in t?"proto":"domain"in t?"domain":_(Ii(t))},Ii=t=>`${B(t)} is not a valid type schema`,Ci={},Id=t=>re(t)?t.map(e=>e.collapsibleJson):t.collapsibleJson,fe={};A.nodesByRegisteredId=fe;const la=t=>(Ci[t]??=0,`${t}${++Ci[t]}`),ca=t=>{const e=$r[t.kind],r=e.applyConfig?.(t.def,t.$.resolvedConfig)??t.def,n={},{meta:i,...s}=r,l=i===void 0?{}:typeof i=="string"?{description:i}:i,u=vo(s).sort(([d],[h])=>fr(d)?fr(h)?br(d)-br(h):1:fr(h)||d<h?-1:1).filter(([d,h])=>{if(d.startsWith("meta.")){const p=d.slice(5);return l[p]=h,!1}return!0});for(const d of u){const h=d[0],p=e.keys[h];if(!p)return _(`Key ${h} is not valid on ${t.kind} schema`);const c=p.parse?p.parse(d[1],t):d[1];c!==be&&(c!==void 0||p.preserveUndefined)&&(n[h]=c)}if(e.reduce&&!t.prereduced){const d=e.reduce(n,t.$);if(d)return d instanceof N?d.throw():Od(d,l)}return jn({id:t.id,kind:t.kind,inner:n,meta:l,$:t.$})},jn=({id:t,kind:e,inner:r,meta:n,$:i,ignoreCache:s})=>{const l=$r[e],u=vo(r),f=[];let d={};for(const[b,v]of u){const w=l.keys[b],y=w.serialize??(w.child?Id:Ve);if(d[b]=y(v),w.child===!0){const x=v;re(x)?f.push(...x):f.push(x)}else typeof w.child=="function"&&f.push(...w.child(v))}l.finalizeInnerJson&&(d=l.finalizeInnerJson(d));let h={...d},p={};Ot(n)||(p=F(n,(b,v)=>[b,b==="examples"?v:Ve(v)]),h.meta=qt(p,"description",!0)),d=qt(d,l.collapsibleKey,!1);const c=JSON.stringify({kind:e,...d});h=qt(h,l.collapsibleKey,!1);const a=qt(h,l.collapsibleKey,!0),o=JSON.stringify({kind:e,...h});if(i.nodesByHash[o]&&!s)return i.nodesByHash[o];const g={id:t,kind:e,impl:l,inner:r,innerEntries:u,innerJson:d,innerHash:c,meta:n,metaJson:p,json:h,hash:o,collapsibleJson:a,children:f};if(e!=="intersection")for(const b in r)b!=="in"&&b!=="out"&&(g[b]=r[b]);const m=new Lh[e](g,i);return i.nodesByHash[o]=m},Cd=(t,e)=>t.id===e?t:(se(fe[e])&&Y(`Unexpected attempt to overwrite node id ${e}`),jn({id:e,kind:t.kind,inner:t.inner,meta:t.meta,$:t.$,ignoreCache:!0})),Od=(t,e,r)=>jn({id:la(e.alias??t.kind),kind:t.kind,inner:t.inner,meta:e,$:t.$}),qt=(t,e,r)=>{const n=Object.keys(t);if(n.length===1&&n[0]===e){const i=t[e];if(r||We(i,"object")&&(Object.keys(i).length===1||Array.isArray(i)))return i}return t},wn=(t,e,r)=>{if(t.key!==e.key)return null;const n=t.key;let i=Z(t.value,e.value,r);const s=t.required||e.required?"required":"optional";if(i instanceof N)if(s==="optional")i=A.intrinsic.never.internal;else return i.withPrefixKey(t.key,t.required&&e.required?"required":"optional");if(s==="required")return r.$.node("required",{key:n,value:i});const l=t.hasDefault()?e.hasDefault()?t.default===e.default?t.default:_(ha(t.default,e.default)):t.default:e.hasDefault()?e.default:be;return r.$.node("optional",{key:n,value:i,default:l})};class da extends ct{required=this.kind==="required";optional=this.kind==="optional";impliedBasis=A.intrinsic.object.internal;serializedKey=Dt(this.key);compiledKey=typeof this.key=="string"?this.key:this.serializedKey;flatRefs=q(this.value.flatRefs.map(e=>Be([this.key,...e.path],e.node)),Be([this.key],this.value));_transform(e,r){r.path.push(this.key);const n=super._transform(e,r);return r.path.pop(),n}hasDefault(){return"default"in this.inner}traverseAllows=(e,r)=>this.key in e?Ae(this.key,()=>this.value.traverseAllows(e[this.key],r),r):this.optional;traverseApply=(e,r)=>{this.key in e?Ae(this.key,()=>this.value.traverseApply(e[this.key],r),r):this.hasKind("required")&&r.errorFromNodeContext(this.errorContext)};compile(e){e.if(`${this.serializedKey} in data`,()=>e.traverseKey(this.serializedKey,`data${e.prop(this.key)}`,this.value)),this.hasKind("required")&&e.else(()=>e.traversalKind==="Apply"?e.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`):e.return(!1)),e.traversalKind==="Allows"&&e.return(!0)}}const ha=(t,e)=>`Invalid intersection of default values ${B(t)} & ${B(e)}`,Ad=z({kind:"optional",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(t,e)=>e.$.parseSchema(t)},default:{preserveUndefined:!0}},normalize:t=>t,reduce:(t,e)=>{if(e.resolvedConfig.exactOptionalPropertyTypes===!1&&!t.value.allows(void 0))return e.node("optional",{...t,value:t.value.or(E.undefined)},{prereduced:!0})},defaults:{description:t=>`${t.compiledKey}?: ${t.value.description}`},intersections:{optional:wn}});class Md extends da{constructor(...e){super(...e),"default"in this.inner&&Hn(this.value,this.inner.default,this.key)}get rawIn(){const e=super.rawIn;return this.hasDefault()?this.$.node("optional",wo(e.inner,{default:!0}),{prereduced:!0}):e}get outProp(){if(!this.hasDefault())return this;const{default:e,...r}=this.inner;return this.cacheGetter("outProp",this.$.node("required",r,{prereduced:!0}))}expression=this.hasDefault()?`${this.compiledKey}: ${this.value.expression} = ${B(this.inner.default)}`:`${this.compiledKey}?: ${this.value.expression}`;defaultValueMorph=Dd(this);defaultValueMorphRef=this.defaultValueMorph&&oe(this.defaultValueMorph)}const Un={implementation:Ad,Node:Md},Nd={},Dd=t=>{if(!t.hasDefault())return;const e=`{${t.compiledKey}: ${t.value.id} = ${Ve(t.default)}}`;return Nd[e]??=fa(t.key,t.value,t.default)},fa=(t,e,r)=>{if(typeof r=="function")return e.includesTransform?(i,s)=>(Ae(t,()=>e(i[t]=r(),s),s),i):i=>(i[t]=r(),i);const n=e.includesTransform?e.assert(r):r;return We(n,"object")?(i,s)=>(Ae(t,()=>e(i[t]=r,s),s),i):i=>(i[t]=n,i)},Hn=(t,e,r)=>{const n=Ar(e);We(e,"object")&&!n&&_(Ed(r));const i=t.in(n?e():e);if(i instanceof qe){r===null&&_(`Default ${i.summary}`);const s=i.transform(l=>l.transform(u=>({...u,prefixPath:[r]})));_(`Default for ${s.summary}`)}return e},Ed=t=>`Non-primitive default ${t===null?"":typeof t=="number"?`for value at [${t}] `:`for ${Dt(t)} `}must be specified as a function like () => ({my: 'object'})`;class Et extends zo{constructor(e,r){super(e,r),Object.defineProperty(this,Oe,{value:"root",enumerable:!1})}get rawIn(){return super.rawIn}get rawOut(){return super.rawOut}get internal(){return this}get"~standard"(){return{vendor:"arktype",version:1,validate:e=>{const r=this(e);return r instanceof qe?r:{value:r}},toJSONSchema:e=>e.target&&e.target!=="draft-2020-12"?_(`JSONSchema target '${e.target}' is not supported (must be "draft-2020-12")`):e.io==="input"?this.rawIn.toJsonSchema():this.rawOut.toJsonSchema()}}as(){return this}brand(e){return e===""?_(Ld):this}readonly(){return this}branches=this.hasKind("union")?this.inner.branches:[this];distribute(e,r){const n=this.branches.map(e);return r?.(n)??n}get shortDescription(){return this.meta.description??this.defaultShortDescription}toJsonSchema(e={}){const r=Ho(this.$.resolvedConfig.toJsonSchema,e);r.useRefs||=this.isCyclic;const n=typeof r.dialect=="string"?{$schema:r.dialect}:{};return Object.assign(n,this.toJsonSchemaRecurse(r)),r.useRefs&&(n.$defs=F(this.references,(i,s)=>s.isRoot()&&!s.alwaysExpandJsonSchema?[s.id,s.toResolvedJsonSchema(r)]:[])),n}toJsonSchemaRecurse(e){return e.useRefs&&!this.alwaysExpandJsonSchema?{$ref:`#/$defs/${this.id}`}:this.toResolvedJsonSchema(e)}get alwaysExpandJsonSchema(){return this.isBasis()||this.kind==="alias"||this.hasKind("union")&&this.isBoolean}toResolvedJsonSchema(e){const r=this.innerToJsonSchema(e);return Object.assign(r,this.metaJson)}intersect(e){const r=this.$.parseDefinition(e),n=this.rawIntersect(r);return n instanceof N?n:this.$.finalize(n)}rawIntersect(e){return Me(this,e,this.$)}toNeverIfDisjoint(){return this}and(e){const r=this.intersect(e);return r instanceof N?r.throw():r}rawAnd(e){const r=this.rawIntersect(e);return r instanceof N?r.throw():r}or(e){const r=this.$.parseDefinition(e);return this.$.finalize(this.rawOr(r))}rawOr(e){const r=[...this.branches,...e.branches];return this.$.node("union",r)}map(e){return this.$.schema(this.applyStructuralOperation("map",[e]))}pick(...e){return this.$.schema(this.applyStructuralOperation("pick",e))}omit(...e){return this.$.schema(this.applyStructuralOperation("omit",e))}required(){return this.$.schema(this.applyStructuralOperation("required",[]))}partial(){return this.$.schema(this.applyStructuralOperation("partial",[]))}_keyof;keyof(){if(this._keyof)return this._keyof;const e=this.applyStructuralOperation("keyof",[]).reduce((r,n)=>r.intersect(n).toNeverIfDisjoint(),A.intrinsic.unknown.internal);return e.branches.length===0&&_(Go(`keyof ${this.expression}`)),this._keyof=this.$.finalize(e)}get props(){return this.branches.length!==1?_($d(this.expression)):[...this.applyStructuralOperation("props",[])[0]]}merge(e){const r=this.$.parseDefinition(e);return this.$.schema(r.distribute(n=>this.applyStructuralOperation("merge",[Oi(n)??_(Ai("merge",n.expression))])))}applyStructuralOperation(e,r){return this.distribute(n=>{if(n.equals(A.intrinsic.object)&&e!=="merge")return n;const i=Oi(n);if(i||_(Ai(e,n.expression)),e==="keyof")return i.keyof();if(e==="get")return i.get(...r);if(e==="props")return i.props;const s=e==="required"?"require":e==="partial"?"optionalize":e;return this.$.node("intersection",{domain:"object",structure:i[s](...r)})})}get(...e){return e[0]===void 0?this:this.$.schema(this.applyStructuralOperation("get",e))}extract(e){const r=this.$.parseDefinition(e);return this.$.schema(this.branches.filter(n=>n.extends(r)))}exclude(e){const r=this.$.parseDefinition(e);return this.$.schema(this.branches.filter(n=>!n.extends(r)))}array(){return this.$.schema(this.isUnknown()?{proto:Array}:{proto:Array,sequence:this},{prereduced:!0})}overlaps(e){return!(this.intersect(e)instanceof N)}extends(e){const r=this.intersect(e);return!(r instanceof N)&&this.equals(r)}ifExtends(e){return this.extends(e)?this:void 0}subsumes(e){return this.$.parseDefinition(e).extends(this)}configure(e,r="shallow"){return this.configureReferences(e,r)}describe(e,r="shallow"){return this.configure({description:e},r)}optional(){return[this,"?"]}default(e){return Hn(this,e,null),[this,"=",e]}from(e){return this.assert(e)}_pipe(...e){const r=e.reduce((n,i)=>n.rawPipeOnce(i),this);return this.$.finalize(r)}tryPipe(...e){const r=e.reduce((n,i)=>n.rawPipeOnce(D(i,"root")?i:((s,l)=>{try{return i(s,l)}catch(u){return l.error({code:"predicate",predicate:i,actual:`aborted due to error:
    ${u}
`})}})),this);return this.$.finalize(r)}pipe=Object.assign(this._pipe.bind(this),{try:this.tryPipe.bind(this)});to(e){return this.$.finalize(this.toNode(this.$.parseDefinition(e)))}toNode(e){const r=vn(this,e,this.$);return r instanceof N?r.throw():r}rawPipeOnce(e){return D(e,"root")?this.toNode(e):this.distribute(r=>r.hasKind("morph")?this.$.node("morph",{in:r.inner.in,morphs:[...r.morphs,e]}):this.$.node("morph",{in:r,morphs:[e]}),this.$.parseSchema)}narrow(e){return this.constrainOut("predicate",e)}constrain(e,r){return this._constrain("root",e,r)}constrainIn(e,r){return this._constrain("in",e,r)}constrainOut(e,r){return this._constrain("out",e,r)}_constrain(e,r,n){const i=this.$.node(r,n);if(i.isRoot())return i.isUnknown()?this:Y(`Unexpected constraint node ${i}`);const s=e==="root"?this:e==="in"?this.rawIn:this.rawOut;if(s.hasKind("morph")||i.impliedBasis&&!s.extends(i.impliedBasis))return Hc(r,i.impliedBasis,this);const l=this.$.node("intersection",{[i.kind]:i}),u=e==="out"?vn(this,l,this.$):Me(this,l,this.$);return u instanceof N&&u.throw(),this.$.finalize(u)}onUndeclaredKey(e){const r=typeof e=="string"?e:e.rule,n=typeof e=="string"?!1:e.deep;return this.$.finalize(this.transform((i,s)=>i==="structure"?r==="ignore"?wo(s,{undeclared:1}):{...s,undeclared:r}:s,n?void 0:{shouldTransform:i=>!Re(Nr,i.kind)}))}hasEqualMorphs(e){return!this.includesTransform&&!e.includesTransform?!0:!(!it(this.shallowMorphs,e.shallowMorphs)||!it(this.flatMorphs,e.flatMorphs,{isEqual:(r,n)=>r.propString===n.propString&&(r.node.hasKind("morph")&&n.node.hasKind("morph")?r.node.hasEqualMorphs(n.node):r.node.hasKind("intersection")&&n.node.hasKind("intersection")?r.node.structure?.structuralMorphRef===n.node.structure?.structuralMorphRef:!1)}))}onDeepUndeclaredKey(e){return this.onUndeclaredKey({rule:e,deep:!0})}filter(e){return this.constrainIn("predicate",e)}divisibleBy(e){return this.constrain("divisor",e)}matching(e){return this.constrain("pattern",e)}atLeast(e){return this.constrain("min",e)}atMost(e){return this.constrain("max",e)}moreThan(e){return this.constrain("min",Ye(e))}lessThan(e){return this.constrain("max",Ye(e))}atLeastLength(e){return this.constrain("minLength",e)}atMostLength(e){return this.constrain("maxLength",e)}moreThanLength(e){return this.constrain("minLength",Ye(e))}lessThanLength(e){return this.constrain("maxLength",Ye(e))}exactlyLength(e){return this.constrain("exactLength",e)}atOrAfter(e){return this.constrain("after",e)}atOrBefore(e){return this.constrain("before",e)}laterThan(e){return this.constrain("after",Ye(e))}earlierThan(e){return this.constrain("before",Ye(e))}}const Ld="Expected a non-empty brand name after #",Ye=t=>typeof t=="object"&&!(t instanceof Date)?{...t,exclusive:!0}:{rule:t,exclusive:!0},Ft=(t,e)=>D(e,"root")?D(t,"root")?t.extends(e):e.allows(t):D(t,"root")?t.hasUnit(e):e===t,Oi=t=>t.hasKind("morph")?null:t.hasKind("intersection")?t.inner.structure??(t.basis?.domain==="object"?t.$.bindReference(A.intrinsic.emptyStructure):null):t.isBasis()&&t.domain==="object"?t.$.bindReference(A.intrinsic.emptyStructure):null,$d=t=>`Props cannot be extracted from a union. Use .distribute to extract props from each branch instead. Received:
${t}`,Ai=(t,e)=>`${t} operand must be an object (was ${e})`,Lt=(t,e)=>F(Fn(t),(r,n)=>[n,e]),Rd=t=>typeof t=="string"?{reference:t}:t,Mi=t=>t instanceof N?A.intrinsic.never.internal:t,Td=z({kind:"alias",hasAssociatedError:!1,collapsibleKey:"reference",keys:{reference:{serialize:t=>t.startsWith("$")?t:`$ark.${t}`},resolve:{}},normalize:Rd,defaults:{description:t=>t.reference},intersections:{alias:(t,e,r)=>r.$.lazilyResolve(()=>Mi(Z(t.resolution,e.resolution,r)),`${t.reference}${r.pipe?"=>":"&"}${e.reference}`),...Lt("alias",(t,e,r)=>e.isUnknown()?t:e.isNever()?e:e.isBasis()&&!e.overlaps(A.intrinsic.object)?N.init("assignability",A.intrinsic.object,e):r.$.lazilyResolve(()=>Mi(Z(t.resolution,e,r)),`${t.reference}${r.pipe?"=>":"&"}${e.id}`))}});class Bd extends Et{expression=this.reference;structure=void 0;get resolution(){const e=this._resolve();return fe[this.id]=e}_resolve(){if(this.resolve)return this.resolve();if(this.reference[0]==="$")return this.$.resolveRoot(this.reference.slice(1));const e=this.reference;let r=fe[e];const n=[];for(;D(r,"context");){if(n.includes(r.id))return _(qd(r.id,n));n.push(r.id),r=fe[r.id]}return D(r,"root")?r:Y(`Unexpected resolution for reference ${this.reference}
Seen: [${n.join("->")}] 
Resolution: ${B(r)}`)}get resolutionId(){if(this.reference.includes("&")||this.reference.includes("=>"))return this.resolution.id;if(this.reference[0]!=="$")return this.reference;const e=this.reference.slice(1),r=this.$.resolutions[e];return typeof r=="string"?r:D(r,"root")?r.id:Y(`Unexpected resolution for reference ${this.reference}: ${B(r)}`)}get defaultShortDescription(){return Ce.object}innerToJsonSchema(e){return this.resolution.toJsonSchemaRecurse(e)}traverseAllows=(e,r)=>{const n=r.seen[this.reference];return n?.includes(e)?!0:(r.seen[this.reference]=q(n,e),this.resolution.traverseAllows(e,r))};traverseApply=(e,r)=>{const n=r.seen[this.reference];n?.includes(e)||(r.seen[this.reference]=q(n,e),this.resolution.traverseApply(e,r))};compile(e){const r=this.resolutionId;e.if(`ctx.seen.${r} && ctx.seen.${r}.includes(data)`,()=>e.return(!0)),e.if(`!ctx.seen.${r}`,()=>e.line(`ctx.seen.${r} = []`)),e.line(`ctx.seen.${r}.push(data)`),e.return(e.invoke(r))}}const qd=(t,e)=>`Alias '${t}' has a shallow resolution cycle: ${[...e,t].join("->")}`,zn={implementation:Td,Node:Bd};class Vn extends Et{traverseApply=(e,r)=>{this.traverseAllows(e,r)||r.errorFromNodeContext(this.errorContext)};get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return Er(this.errorContext)}compile(e){e.traversalKind==="Allows"?e.return(this.compiledCondition):e.if(this.compiledNegation,()=>e.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}}const Fd=z({kind:"domain",hasAssociatedError:!0,collapsibleKey:"domain",keys:{domain:{},numberAllowsNaN:{}},normalize:t=>typeof t=="string"?{domain:t}:Ln(t,"numberAllowsNaN")&&t.domain!=="number"?_(Gn.writeBadAllowNanMessage(t.domain)):t,applyConfig:(t,e)=>t.numberAllowsNaN===void 0&&t.domain==="number"&&e.numberAllowsNaN?{...t,numberAllowsNaN:!0}:t,defaults:{description:t=>Ce[t.domain],actual:t=>Number.isNaN(t)?"NaN":Ce[ge(t)]},intersections:{domain:(t,e)=>t.domain==="number"&&e.domain==="number"?t.numberAllowsNaN?e:t:N.init("domain",t,e)}});class Kd extends Vn{requiresNaNCheck=this.domain==="number"&&!this.numberAllowsNaN;traverseAllows=this.requiresNaNCheck?e=>typeof e=="number"&&!Number.isNaN(e):e=>ge(e)===this.domain;compiledCondition=this.domain==="object"?'((typeof data === "object" && data !== null) || typeof data === "function")':`typeof data === "${this.domain}"${this.requiresNaNCheck?" && !Number.isNaN(data)":""}`;compiledNegation=this.domain==="object"?'((typeof data !== "object" || data === null) && typeof data !== "function")':`typeof data !== "${this.domain}"${this.requiresNaNCheck?" || Number.isNaN(data)":""}`;expression=this.numberAllowsNaN?"number | NaN":this.domain;get nestableExpression(){return this.numberAllowsNaN?`(${this.expression})`:this.expression}get defaultShortDescription(){return Ce[this.domain]}innerToJsonSchema(e){return this.domain==="bigint"||this.domain==="symbol"?e.fallback.domain({code:"domain",base:{},domain:this.domain}):{type:this.domain}}}const Gn={implementation:Fd,Node:Kd,writeBadAllowNanMessage:t=>`numberAllowsNaN may only be specified with domain "number" (was ${t})`},jd=z({kind:"intersection",hasAssociatedError:!0,normalize:t=>{if(se(t))return t;const{structure:e,...r}=t,n=!!e,i=e??{},s=F(r,(l,u)=>Se(l,Nc)?(n&&_(`Flattened structure key ${l} cannot be specified alongside a root 'structure' key.`),i[l]=u,[]):[l,u]);return(D(i,"constraint")||!Ot(i))&&(s.structure=i),s},finalizeInnerJson:({structure:t,...e})=>We(t,"object")?{...t,...e}:e,keys:{domain:{child:!0,parse:(t,e)=>e.$.node("domain",t)},proto:{child:!0,parse:(t,e)=>e.$.node("proto",t)},structure:{child:!0,parse:(t,e)=>e.$.node("structure",t),serialize:t=>{if(!t.sequence?.minLength)return t.collapsibleJson;const{sequence:e,...r}=t.collapsibleJson,{minVariadicLength:n,...i}=e,s=i.variadic&&Object.keys(i).length===1?i.variadic:i;return{...r,sequence:s}}},divisor:{child:!0,parse:le("divisor")},max:{child:!0,parse:le("max")},min:{child:!0,parse:le("min")},maxLength:{child:!0,parse:le("maxLength")},minLength:{child:!0,parse:le("minLength")},exactLength:{child:!0,parse:le("exactLength")},before:{child:!0,parse:le("before")},after:{child:!0,parse:le("after")},pattern:{child:!0,parse:le("pattern")},predicate:{child:!0,parse:le("predicate")}},reduce:(t,e)=>Ni({},t,{$:e,invert:!1,pipe:!1}),defaults:{description:t=>{if(t.children.length===0)return"unknown";if(t.structure)return t.structure.description;const e=[];if(t.basis&&!t.prestructurals.some(r=>r.impl.obviatesBasisDescription)&&e.push(t.basis.description),t.prestructurals.length){const r=t.prestructurals.toSorted((n,i)=>n.kind==="min"&&i.kind==="max"?-1:0).map(n=>n.description);e.push(...r)}return t.inner.predicate&&e.push(...t.inner.predicate.map(r=>r.description)),e.join(" and ")},expected:t=>`  ◦ ${t.errors.map(e=>e.expected).join(`
  ◦ `)}`,problem:t=>`(${t.actual}) must be...
${t.expected}`},intersections:{intersection:(t,e,r)=>Ni(t.inner,e.inner,r),...Lt("intersection",(t,e,r)=>{if(t.children.length===0)return e;const{domain:n,proto:i,...s}=t.inner,l=i??n,u=l?Z(l,e,r):e;return u instanceof N?u:t?.basis?.equals(u)?t:t.$.node("intersection",{...s,[u.kind]:u},{prereduced:!0})})}});class Ud extends Et{basis=this.inner.domain??this.inner.proto??null;prestructurals=[];refinements=this.children.filter(e=>e.isRefinement()?(Re(Fo,e.kind)&&this.prestructurals.push(e),!0):!1);structure=this.inner.structure;expression=Hd(this);get shallowMorphs(){return this.inner.structure?.structuralMorph?[this.inner.structure.structuralMorph]:[]}get defaultShortDescription(){return this.basis?.defaultShortDescription??"present"}innerToJsonSchema(e){return this.children.reduce((r,n)=>n.isBasis()?n.toJsonSchemaRecurse(e):n.reduceJsonSchema(r,e),{})}traverseAllows=(e,r)=>this.children.every(n=>n.traverseAllows(e,r));traverseApply=(e,r)=>{const n=r.currentErrorCount;if(!(this.basis&&(this.basis.traverseApply(e,r),r.currentErrorCount>n))){if(this.prestructurals.length){for(let i=0;i<this.prestructurals.length-1;i++)if(this.prestructurals[i].traverseApply(e,r),r.failFast&&r.currentErrorCount>n)return;if(this.prestructurals.at(-1).traverseApply(e,r),r.currentErrorCount>n)return}if(!(this.structure&&(this.structure.traverseApply(e,r),r.currentErrorCount>n))&&this.inner.predicate){for(let i=0;i<this.inner.predicate.length-1;i++)if(this.inner.predicate[i].traverseApply(e,r),r.failFast&&r.currentErrorCount>n)return;this.inner.predicate.at(-1).traverseApply(e,r)}}};compile(e){if(e.traversalKind==="Allows"){for(const r of this.children)e.check(r);e.return(!0);return}if(e.initializeErrorCount(),this.basis&&(e.check(this.basis),this.children.length>1&&e.returnIfFail()),this.prestructurals.length){for(let r=0;r<this.prestructurals.length-1;r++)e.check(this.prestructurals[r]),e.returnIfFailFast();e.check(this.prestructurals.at(-1)),(this.structure||this.inner.predicate)&&e.returnIfFail()}if(this.structure&&(e.check(this.structure),this.inner.predicate&&e.returnIfFail()),this.inner.predicate){for(let r=0;r<this.inner.predicate.length-1;r++)e.check(this.inner.predicate[r]),e.returnIfFail();e.check(this.inner.predicate.at(-1))}}}const pa={implementation:jd,Node:Ud},Hd=t=>{if(t.structure?.expression)return t.structure.expression;const e=t.basis&&!t.prestructurals.some(i=>i.impl.obviatesBasisExpression)?t.basis.nestableExpression:"",r=t.prestructurals.map(i=>i.expression).join(" & "),n=`${e}${e?" ":""}${r}`;return n==="Array == 0"?"[]":n||"unknown"},Ni=(t,e,r)=>{const n={},i=t.proto??t.domain,s=e.proto??e.domain,l=i?s?Z(i,s,r):i:s;return l instanceof N?l:(l&&(n[l.kind]=l),vr({kind:"intersection",baseInner:n,l:xr(t),r:xr(e),roots:[],ctx:r}))},zd=z({kind:"morph",hasAssociatedError:!1,keys:{in:{child:!0,parse:(t,e)=>e.$.parseSchema(t)},morphs:{parse:Ct,serialize:t=>t.map(e=>D(e,"root")?e.json:oe(e))},declaredIn:{child:!1,serialize:t=>t.json},declaredOut:{child:!1,serialize:t=>t.json}},normalize:t=>t,defaults:{description:t=>`a morph from ${t.rawIn.description} to ${t.rawOut?.description??"unknown"}`},intersections:{morph:(t,e,r)=>{if(!t.hasEqualMorphs(e))return _(Gd(t.expression,e.expression));const n=Z(t.rawIn,e.rawIn,r);if(n instanceof N)return n;const i={morphs:t.morphs};if(t.declaredIn||e.declaredIn){const s=Z(t.rawIn,e.rawIn,r);if(s instanceof N)return s.throw();i.declaredIn=s}if(t.declaredOut||e.declaredOut){const s=Z(t.rawOut,e.rawOut,r);if(s instanceof N)return s.throw();i.declaredOut=s}return n.distribute(s=>r.$.node("morph",{...i,in:s}),r.$.parseSchema)},...Lt("morph",(t,e,r)=>{const n=t.inner.in?Z(t.inner.in,e,r):e;return n instanceof N?n:n.equals(t.inner.in)?t:r.$.node("morph",{...t.inner,in:n})})}});class Vd extends Et{serializedMorphs=this.morphs.map(oe);compiledMorphs=`[${this.serializedMorphs}]`;lastMorph=this.inner.morphs.at(-1);lastMorphIfNode=D(this.lastMorph,"root")?this.lastMorph:void 0;introspectableIn=this.inner.in;introspectableOut=this.lastMorphIfNode?Object.assign(this.referencesById,this.lastMorphIfNode.referencesById)&&this.lastMorphIfNode.rawOut:void 0;get shallowMorphs(){return Array.isArray(this.inner.in?.shallowMorphs)?[...this.inner.in.shallowMorphs,...this.morphs]:this.morphs}get rawIn(){return this.declaredIn??this.inner.in?.rawIn??A.intrinsic.unknown.internal}get rawOut(){return this.declaredOut??this.introspectableOut??A.intrinsic.unknown.internal}declareIn(e){return this.$.node("morph",{...this.inner,declaredIn:e})}declareOut(e){return this.$.node("morph",{...this.inner,declaredOut:e})}expression=`(In: ${this.rawIn.expression}) => ${this.lastMorphIfNode?"To":"Out"}<${this.rawOut.expression}>`;get defaultShortDescription(){return this.rawIn.meta.description??this.rawIn.defaultShortDescription}innerToJsonSchema(e){return e.fallback.morph({code:"morph",base:this.rawIn.toJsonSchemaRecurse(e),out:this.introspectableOut?.toJsonSchemaRecurse(e)??null})}compile(e){if(e.traversalKind==="Allows"){if(!this.introspectableIn)return;e.return(e.invoke(this.introspectableIn));return}this.introspectableIn&&e.line(e.invoke(this.introspectableIn)),e.line(`ctx.queueMorphs(${this.compiledMorphs})`)}traverseAllows=(e,r)=>!this.introspectableIn||this.introspectableIn.traverseAllows(e,r);traverseApply=(e,r)=>{this.introspectableIn&&this.introspectableIn.traverseApply(e,r),r.queueMorphs(this.morphs)};hasEqualMorphs(e){return it(this.morphs,e.morphs,{isEqual:(r,n)=>r===n||D(r,"root")&&D(n,"root")&&r.equals(n)})}}const ma={implementation:zd,Node:Vd},Gd=(t,e)=>`The intersection of distinct morphs at a single path is indeterminate:
Left: ${t}
Right: ${e}`,Wd=z({kind:"proto",hasAssociatedError:!0,collapsibleKey:"proto",keys:{proto:{serialize:t=>Rn(t)??Ve(t)},dateAllowsInvalid:{}},normalize:t=>{const e=typeof t=="string"?{proto:ot[t]}:typeof t=="function"?se(t)?t:{proto:t}:typeof t.proto=="string"?{...t,proto:ot[t.proto]}:t;return typeof e.proto!="function"&&_(kr.writeInvalidSchemaMessage(e.proto)),Ln(e,"dateAllowsInvalid")&&e.proto!==Date&&_(kr.writeBadInvalidDateMessage(e.proto)),e},applyConfig:(t,e)=>t.dateAllowsInvalid===void 0&&t.proto===Date&&e.dateAllowsInvalid?{...t,dateAllowsInvalid:!0}:t,defaults:{description:t=>t.builtinName?Vl[t.builtinName]:`an instance of ${t.proto.name}`,actual:t=>t instanceof Date&&t.toString()==="Invalid Date"?"an invalid Date":hn(t)},intersections:{proto:(t,e)=>t.proto===Date&&e.proto===Date?t.dateAllowsInvalid?e:t:bi(t.proto,e.proto)?t:bi(e.proto,t.proto)?e:N.init("proto",t,e),domain:(t,e)=>e.domain==="object"?t:N.init("domain",A.intrinsic.object.internal,e)}});class Jd extends Vn{builtinName=Rn(this.proto);serializedConstructor=this.json.proto;requiresInvalidDateCheck=this.proto===Date&&!this.dateAllowsInvalid;traverseAllows=this.requiresInvalidDateCheck?e=>e instanceof Date&&e.toString()!=="Invalid Date":e=>e instanceof this.proto;compiledCondition=`data instanceof ${this.serializedConstructor}${this.requiresInvalidDateCheck?' && data.toString() !== "Invalid Date"':""}`;compiledNegation=`!(${this.compiledCondition})`;innerToJsonSchema(e){switch(this.builtinName){case"Array":return{type:"array"};case"Date":return e.fallback.date?.({code:"date",base:{}})??e.fallback.proto({code:"proto",base:{},proto:this.proto});default:return e.fallback.proto({code:"proto",base:{},proto:this.proto})}}expression=this.dateAllowsInvalid?"Date | InvalidDate":this.proto.name;get nestableExpression(){return this.dateAllowsInvalid?`(${this.expression})`:this.expression}domain="object";get defaultShortDescription(){return this.description}}const kr={implementation:Wd,Node:Jd,writeBadInvalidDateMessage:t=>`dateAllowsInvalid may only be specified with constructor Date (was ${t.name})`,writeInvalidSchemaMessage:t=>`instanceOf operand must be a function (was ${ge(t)})`},Yd=z({kind:"union",hasAssociatedError:!0,collapsibleKey:"branches",keys:{ordered:{},branches:{child:!0,parse:(t,e)=>{const r=[];for(const n of t){const i=D(n,"root")?n.branches:e.$.parseSchema(n).branches;for(const s of i)if(s.hasKind("morph")){const l=r.findIndex(u=>u.hasKind("morph")&&u.hasEqualMorphs(s));if(l===-1)r.push(s);else{const u=r[l];r[l]=e.$.node("morph",{...u.inner,in:u.rawIn.rawOr(s.rawIn)})}}else r.push(s)}return e.def.ordered||r.sort((n,i)=>n.hash<i.hash?-1:1),r}}},normalize:t=>re(t)?{branches:t}:t,reduce:(t,e)=>{const r=ah(t);if(r.length===1)return r[0];if(r.length!==t.branches.length)return e.node("union",{...t,branches:r},{prereduced:!0})},defaults:{description:t=>t.distribute(e=>e.description,rt),expected:t=>{const e=Nl(t.errors,"propString"),r=Object.entries(e).map(([n,i])=>{const s=[];for(const f of i)ze(s,f.expected);const l=rt(s),u=i.every(f=>f.actual===i[0].actual)?i[0].actual:B(i[0].data);return`${n&&`${n} `}must be ${l}${u&&` (was ${u})`}`});return rt(r)},problem:t=>t.expected,message:t=>t.problem[0]==="["?`value at ${t.problem}`:t.problem},intersections:{union:(t,e,r)=>{if(t.isNever!==e.isNever)return N.init("presence",t,e);let n;return t.ordered?(e.ordered&&_(lh(t.expression,e.expression)),n=Vr(e.branches,t.branches,r),n instanceof N&&n.invert()):n=Vr(t.branches,e.branches,r),n instanceof N?n:r.$.parseSchema(t.ordered||e.ordered?{branches:n,ordered:!0}:{branches:n})},...Lt("union",(t,e,r)=>{const n=Vr(t.branches,[e],r);return n instanceof N?n:n.length===1?n[0]:r.$.parseSchema(t.ordered?{branches:n,ordered:!0}:{branches:n})})}});class Qd extends Et{isBoolean=this.branches.length===2&&this.branches[0].hasUnit(!1)&&this.branches[1].hasUnit(!0);get branchGroups(){const e=[];let r=-1;for(const n of this.branches){if(n.hasKind("unit")&&n.domain==="boolean"){r===-1?(r=e.length,e.push(n)):e[r]=A.intrinsic.boolean;continue}e.push(n)}return e}unitBranches=this.branches.filter(e=>e.rawIn.hasKind("unit"));discriminant=this.discriminate();discriminantJson=this.discriminant?ih(this.discriminant):null;expression=this.distribute(e=>e.nestableExpression,oh);createBranchedOptimisticRootApply(){return(e,r)=>{const n=this.traverseOptimistic(e);if(n!==be)return n;const i=new tt(e,this.$.resolvedConfig);return this.traverseApply(e,i),i.finalize(r)}}get shallowMorphs(){return this.branches.reduce((e,r)=>ze(e,r.shallowMorphs),[])}get defaultShortDescription(){return this.distribute(e=>e.defaultShortDescription,rt)}innerToJsonSchema(e){if(this.branchGroups.length===1&&this.branchGroups[0].equals(A.intrinsic.boolean))return{type:"boolean"};const r=this.branchGroups.map(n=>n.toJsonSchemaRecurse(e));return r.every(n=>Object.keys(n).length===1&&Ln(n,"const"))?{enum:r.map(n=>n.const)}:{anyOf:r}}traverseAllows=(e,r)=>this.branches.some(n=>n.traverseAllows(e,r));traverseApply=(e,r)=>{const n=[];for(let i=0;i<this.branches.length;i++){if(r.pushBranch(),this.branches[i].traverseApply(e,r),!r.hasError())return this.branches[i].includesTransform?r.queuedMorphs.push(...r.popBranch().queuedMorphs):r.popBranch();n.push(r.popBranch().error)}r.errorFromNodeContext({code:"union",errors:n,meta:this.meta})};traverseOptimistic=e=>{for(let r=0;r<this.branches.length;r++){const n=this.branches[r];if(n.traverseAllows(e))return n.contextFreeMorph?n.contextFreeMorph(e):e}return be};compile(e){if(!this.discriminant||this.unitBranches.length===this.branches.length&&this.branches.length===2)return this.compileIndiscriminable(e);let r=this.discriminant.optionallyChainedPropString;this.discriminant.kind==="domain"&&(r=`typeof ${r} === "object" ? ${r} === null ? "null" : "object" : typeof ${r} === "function" ? "object" : typeof ${r}`);const n=this.discriminant.cases,i=Object.keys(n),{optimistic:s}=e;if(e.optimistic=!1,e.block(`switch(${r})`,()=>{for(const h in n){const p=n[h],c=h==="default"?h:`case ${h}`;let a;p===!0?a=s?"data":"true":s?p.rootApplyStrategy==="branchedOptimistic"?a=e.invoke(p,{kind:"Optimistic"}):p.contextFreeMorph?a=`${e.invoke(p)} ? ${oe(p.contextFreeMorph)}(data) : "${be}"`:a=`${e.invoke(p)} ? data : "${be}"`:a=e.invoke(p),e.line(`${c}: return ${a}`)}return e}),e.traversalKind==="Allows"){e.return(s?`"${be}"`:!1);return}const l=rt(this.discriminant.kind==="domain"?i.map(h=>{const p=h.slice(1,-1);return p==="function"?Ce.object:Ce[p]}):i),u=this.discriminant.path.map(h=>typeof h=="symbol"?oe(h):JSON.stringify(h)),f=JSON.stringify(l),d=this.discriminant.kind==="domain"?`${rh}[${r}]`:`${nh}(${r})`;e.line(`ctx.errorFromNodeContext({
	code: "predicate",
	expected: ${f},
	actual: ${d},
	relativePath: [${u}],
	meta: ${this.compiledMeta}
})`)}compileIndiscriminable(e){if(e.traversalKind==="Apply"){e.const("errors","[]");for(const r of this.branches)e.line("ctx.pushBranch()").line(e.invoke(r)).if("!ctx.hasError()",()=>e.return(r.includesTransform?"ctx.queuedMorphs.push(...ctx.popBranch().queuedMorphs)":"ctx.popBranch()")).line("errors.push(ctx.popBranch().error)");e.line(`ctx.errorFromNodeContext({ code: "union", errors, meta: ${this.compiledMeta} })`)}else{const{optimistic:r}=e;e.optimistic=!1;for(const n of this.branches)e.if(`${e.invoke(n)}`,()=>e.return(r?n.contextFreeMorph?`${oe(n.contextFreeMorph)}(data)`:"data":!0));e.return(r?`"${be}"`:!1)}}get nestableExpression(){return this.isBoolean?"boolean":`(${this.expression})`}discriminate(){if(this.branches.length<2||this.isCyclic)return null;if(this.unitBranches.length===this.branches.length){const s=F(this.unitBranches,(l,u)=>[`${u.rawIn.serializedValue}`,u.hasKind("morph")?u:!0]);return{kind:"unit",path:[],optionallyChainedPropString:"data",cases:s}}const e=[];for(let s=0;s<this.branches.length-1;s++){const l=this.branches[s];for(let u=s+1;u<this.branches.length;u++){const f=this.branches[u],d=Me(l.rawIn,f.rawIn,l.$);if(d instanceof N)for(const h of d){if(!h.kind||h.optional)continue;let p,c;if(h.kind==="domain"){const o=h.l,g=h.r;p=`"${typeof o=="string"?o:o.domain}"`,c=`"${typeof g=="string"?g:g.domain}"`}else if(h.kind==="unit")p=h.l.serializedValue,c=h.r.serializedValue;else continue;const a=e.find(o=>it(o.path,h.path)&&o.kind===h.kind);a?(a.cases[p]?a.cases[p].branchIndices=ze(a.cases[p].branchIndices,s):a.cases[p]??={branchIndices:[s],condition:h.l},a.cases[c]?a.cases[c].branchIndices=ze(a.cases[c].branchIndices,u):a.cases[c]??={branchIndices:[u],condition:h.r}):e.push({kind:h.kind,cases:{[p]:{branchIndices:[s],condition:h.l},[c]:{branchIndices:[u],condition:h.r}},path:h.path})}}}const r=this.ordered?eh(e,this.branches):e;if(!r.length)return null;const n=Xd(r,this),i={};for(const s in n.best.cases){const l=Zd(n,s);if(l===null){i[s]=!0;continue}if(l.length===this.branches.length)return null;this.ordered&&l.sort((d,h)=>d.originalIndex-h.originalIndex);const u=l.map(d=>d.branch),f=u.length===1?u[0]:this.$.node("union",this.ordered?{branches:u,ordered:!0}:u);Object.assign(this.referencesById,f.referencesById),i[s]=f}if(n.defaultEntries.length){const s=n.defaultEntries.map(l=>l.branch);i.default=this.$.node("union",this.ordered?{branches:s,ordered:!0}:s,{prereduced:!0}),Object.assign(this.referencesById,i.default.referencesById)}return Object.assign(n.location,{cases:i})}}const Xd=(t,e)=>{const n=t.sort((l,u)=>l.path.length===u.path.length?Object.keys(u.cases).length-Object.keys(l.cases).length:l.path.length-u.path.length)[0],i={kind:n.kind,path:n.path,optionallyChainedPropString:ga(n.path)},s=e.branches.map((l,u)=>({originalIndex:u,branch:l}));return{best:n,location:i,defaultEntries:s,node:e}},Zd=(t,e)=>{const r=t.best.cases[e],n=th(r.condition,t.location.path,t.node.$);let i=[];const s=[];for(let l=0;l<t.defaultEntries.length;l++){const u=t.defaultEntries[l];if(r.branchIndices.includes(u.originalIndex)){const f=Di(t.node.branches[u.originalIndex],t.location);f===null?i=null:i?.push({originalIndex:u.originalIndex,branch:f})}else if(u.branch.hasKind("alias")&&n.hasKind("domain")&&n.domain==="object")i?.push(u);else{if(u.branch.rawIn.overlaps(n)){const f=Di(u.branch,t.location);i?.push({originalIndex:u.originalIndex,branch:f})}s.push(u)}}return t.defaultEntries=s,i},eh=(t,e)=>t.filter(n=>{const i=Object.values(n.cases).map(s=>s.branchIndices);for(let s=0;s<i.length-1;s++){const l=i[s];for(let u=s+1;u<i.length;u++){const f=i[u];for(const d of l)for(const h of f)if(d>h&&e[d].overlaps(e[h]))return!1}}return!0}),th=(t,e,r)=>{let n=t==="undefined"?r.node("unit",{unit:void 0}):t==="null"?r.node("unit",{unit:null}):t==="boolean"?r.units([!0,!1]):t;for(let i=e.length-1;i>=0;i--){const s=e[i];n=r.node("intersection",typeof s=="number"?{proto:"Array",sequence:[...Al(s).map(l=>({})),n]}:{domain:"object",required:[{key:s,value:n}]})}return n},ga=t=>t.reduce((e,r)=>e+To(r,!0),"data"),rh=oe(Dl),nh=oe(B),ya={implementation:Yd,Node:Qd},ih=t=>({kind:t.kind,path:t.path.map(e=>typeof e=="string"?e:Dt(e)),cases:F(t.cases,(e,r)=>[e,r===!0?r:r.hasKind("union")&&r.discriminantJson?r.discriminantJson:r.json])}),sh={delimiter:" | ",finalDelimiter:" | "},oh=t=>rt(t,sh),rt=(t,e)=>{const r=e?.delimiter??", ",n=e?.finalDelimiter??" or ";if(t.length===0)return"never";if(t.length===1)return t[0];if(t.length===2&&t[0]==="false"&&t[1]==="true"||t[0]==="true"&&t[1]==="false")return"boolean";const i={},s=t.filter(u=>i[u]?!1:i[u]=!0),l=s.pop();return`${s.join(r)}${s.length?n:""}${l}`},Vr=(t,e,r)=>{const n=e.map(()=>[]);for(let s=0;s<t.length;s++){let l={};for(let u=0;u<e.length;u++){if(n[u]===null)continue;if(t[s].equals(e[u])){n[u]=null,l={};break}const f=Z(t[s],e[u],r);if(!(f instanceof N)){if(f.equals(t[s])){n[u].push(t[s]),l={};break}f.equals(e[u])?n[u]=null:l[u]=f}}for(const u in l)n[u][s]=l[u]}const i=n.flatMap((s,l)=>s?.flatMap(u=>u.branches)??e[l]);return i.length===0?N.init("union",t,e):i},ah=({branches:t,ordered:e})=>{if(t.length<2)return t;const r=t.map(()=>!0);for(let n=0;n<t.length;n++)for(let i=n+1;i<t.length&&r[n]&&r[i];i++){if(t[n].equals(t[i])){r[i]=!1;continue}const s=Me(t[n].rawIn,t[i].rawIn,t[0].$);s instanceof N||(e||uh(t[n],t[i]),s.equals(t[n].rawIn)?r[n]=!!e:s.equals(t[i].rawIn)&&(r[i]=!1))}return t.filter((n,i)=>r[i])},uh=(t,e)=>{!t.includesTransform&&!e.includesTransform||(it(t.shallowMorphs,e.shallowMorphs)||_(Ei(t.expression,e.expression)),it(t.flatMorphs,e.flatMorphs,{isEqual:(r,n)=>r.propString===n.propString&&(r.node.hasKind("morph")&&n.node.hasKind("morph")?r.node.hasEqualMorphs(n.node):r.node.hasKind("intersection")&&n.node.hasKind("intersection")?r.node.structure?.structuralMorphRef===n.node.structure?.structuralMorphRef:!1)})||_(Ei(t.expression,e.expression)))},Di=(t,e)=>t.transform((r,n)=>r==="domain"||r==="unit"?null:n,{shouldTransform:(r,n)=>{const i=ga(n.path);return e.optionallyChainedPropString.startsWith(i)?r.hasKind("domain")&&r.domain==="object"||(r.hasKind("domain")||e.kind==="unit")&&i===e.optionallyChainedPropString?!0:r.children.length!==0&&r.kind!=="index":!1}}),Ei=(t,e)=>`An unordered union of a type including a morph and a type with overlapping input is indeterminate:
Left: ${t}
Right: ${e}`,lh=(t,e)=>`The intersection of two ordered unions is indeterminate:
Left: ${t}
Right: ${e}`,ch=z({kind:"unit",hasAssociatedError:!0,keys:{unit:{preserveUndefined:!0,serialize:t=>t instanceof Date?t.toISOString():Ve(t)}},normalize:t=>t,defaults:{description:t=>B(t.unit),problem:({expected:t,actual:e})=>`${t===e?`must be reference equal to ${t} (serialized to the same value)`:`must be ${t} (was ${e})`}`},intersections:{unit:(t,e)=>N.init("unit",t,e),...Lt("unit",(t,e)=>{if(e.allows(t.unit))return t;const r=e.hasKind("intersection")?e.basis:e;if(r){const n=r.hasKind("domain")?r:A.intrinsic.object;if(t.domain!==n.domain){const i=t.domain==="undefined"||t.domain==="null"||t.domain==="boolean"?t.domain:A.intrinsic[t.domain];return N.init("domain",i,n)}}return N.init("assignability",t,e.hasKind("intersection")?e.children.find(n=>!n.allows(t.unit)):e)})}});class dh extends Vn{compiledValue=this.json.unit;serializedValue=typeof this.unit=="string"||this.unit instanceof Date?JSON.stringify(this.compiledValue):`${this.compiledValue}`;compiledCondition=Li(this.unit,this.serializedValue);compiledNegation=Li(this.unit,this.serializedValue,"negated");expression=B(this.unit);domain=ge(this.unit);get defaultShortDescription(){return this.domain==="object"?Ce.object:this.description}innerToJsonSchema(e){return this.unit===null?{type:"null"}:A.intrinsic.jsonPrimitive.allows(this.unit)?{const:this.unit}:e.fallback.unit({code:"unit",base:{},unit:this.unit})}traverseAllows=this.unit instanceof Date?e=>e instanceof Date&&e.toISOString()===this.compiledValue:Number.isNaN(this.unit)?e=>Number.isNaN(e):e=>e===this.unit}const ba={implementation:ch,Node:dh},Li=(t,e,r)=>{if(t instanceof Date){const n=`data instanceof Date && data.toISOString() === ${e}`;return r?`!(${n})`:n}return Number.isNaN(t)?`${r?"!":""}Number.isNaN(data)`:`data ${r?"!":"="}== ${e}`},hh=z({kind:"index",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{signature:{child:!0,parse:(t,e)=>{const r=e.$.parseSchema(t);if(!r.extends(A.intrinsic.key))return _(mh(r.expression));const n=r.branches.filter(i=>i.hasKind("unit"));return n.length?_(ph(n.map(i=>B(i.unit)))):r}},value:{child:!0,parse:(t,e)=>e.$.parseSchema(t)}},normalize:t=>t,defaults:{description:t=>`[${t.signature.expression}]: ${t.value.description}`},intersections:{index:(t,e,r)=>{if(t.signature.equals(e.signature)){const n=Z(t.value,e.value,r),i=n instanceof N?A.intrinsic.never.internal:n;return r.$.node("index",{signature:t.signature,value:i})}return t.signature.extends(e.signature)&&t.value.subsumes(e.value)?e:e.signature.extends(t.signature)&&e.value.subsumes(t.value)?t:null}}});class fh extends ct{impliedBasis=A.intrinsic.object.internal;expression=`[${this.signature.expression}]: ${this.value.expression}`;flatRefs=q(this.value.flatRefs.map(e=>Be([this.signature,...e.path],e.node)),Be([this.signature],this.value));traverseAllows=(e,r)=>mr(e).every(n=>this.signature.traverseAllows(n[0],r)?Ae(n[0],()=>this.value.traverseAllows(n[1],r),r):!0);traverseApply=(e,r)=>{for(const n of mr(e))this.signature.traverseAllows(n[0],r)&&Ae(n[0],()=>this.value.traverseApply(n[1],r),r)};_transform(e,r){r.path.push(this.signature);const n=super._transform(e,r);return r.path.pop(),n}compile(){}}const va={implementation:hh,Node:fh},ph=t=>`Index keys ${t.join(", ")} should be specified as named props.`,mh=t=>`Indexed key definition '${t}' must be a string or symbol`,gh=z({kind:"required",hasAssociatedError:!0,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(t,e)=>e.$.parseSchema(t)}},normalize:t=>t,defaults:{description:t=>`${t.compiledKey}: ${t.value.description}`,expected:t=>t.missingValueDescription,actual:()=>"missing"},intersections:{required:wn,optional:wn}});class yh extends da{expression=`${this.compiledKey}: ${this.value.expression}`;errorContext=Object.freeze({code:"required",missingValueDescription:this.value.defaultShortDescription,relativePath:[this.key],meta:this.meta});compiledErrorContext=Er(this.errorContext)}const xa={implementation:gh,Node:yh},bh=z({kind:"sequence",hasAssociatedError:!1,collapsibleKey:"variadic",keys:{prefix:{child:!0,parse:(t,e)=>{if(t.length!==0)return t.map(r=>e.$.parseSchema(r))}},optionals:{child:!0,parse:(t,e)=>{if(t.length!==0)return t.map(r=>e.$.parseSchema(r))}},defaultables:{child:t=>t.map(e=>e[0]),parse:(t,e)=>{if(t.length!==0)return t.map(r=>{const n=e.$.parseSchema(r[0]);return Hn(n,r[1],null),[n,r[1]]})},serialize:t=>t.map(e=>[e[0].collapsibleJson,Ve(e[1])]),reduceIo:(t,e,r)=>{if(t==="in"){e.optionals=r.map(n=>n[0].rawIn);return}e.prefix=r.map(n=>n[0].rawOut)}},variadic:{child:!0,parse:(t,e)=>e.$.parseSchema(t,e)},minVariadicLength:{parse:t=>t===0?void 0:t},postfix:{child:!0,parse:(t,e)=>{if(t.length!==0)return t.map(r=>e.$.parseSchema(r))}}},normalize:t=>{if(typeof t=="string")return{variadic:t};if("variadic"in t||"prefix"in t||"defaultables"in t||"optionals"in t||"postfix"in t||"minVariadicLength"in t){if(t.postfix?.length){if(!t.variadic)return _(Sh);if(t.optionals?.length||t.defaultables?.length)return _(ka)}return t.minVariadicLength&&!t.variadic?_("minVariadicLength may not be specified without a variadic element"):t}return{variadic:t}},reduce:(t,e)=>{let r=t.minVariadicLength??0;const n=t.prefix?.slice()??[],i=t.defaultables?.slice()??[],s=t.optionals?.slice()??[],l=t.postfix?.slice()??[];if(t.variadic){for(;s.at(-1)?.equals(t.variadic);)s.pop();if(s.length===0&&i.length===0)for(;n.at(-1)?.equals(t.variadic);)n.pop(),r++;for(;l[0]?.equals(t.variadic);)l.shift(),r++}else s.length===0&&i.length===0&&n.push(...l.splice(0));if(r!==t.minVariadicLength||t.prefix&&t.prefix.length!==n.length)return e.node("sequence",{...t,prefix:n,defaultables:i,optionals:s,postfix:l,minVariadicLength:r},{prereduced:!0})},defaults:{description:t=>t.isVariadicOnly?`${t.variadic.nestableExpression}[]`:`[${t.tuple.map(r=>r.kind==="defaultables"?`${r.node.nestableExpression} = ${B(r.default)}`:r.kind==="optionals"?`${r.node.nestableExpression}?`:r.kind==="variadic"?`...${r.node.nestableExpression}[]`:r.node.expression).join(", ")}]`},intersections:{sequence:(t,e,r)=>{const n=xt({l:t.tuple,r:e.tuple,disjoint:new N,result:[],fixedVariants:[],ctx:r}),i=n.disjoint.length===0?[n,...n.fixedVariants]:n.fixedVariants;return i.length===0?n.disjoint:i.length===1?r.$.node("sequence",$i(i[0].result)):r.$.node("union",i.map(s=>({proto:Array,sequence:$i(s.result)})))}}});class vh extends ct{impliedBasis=A.intrinsic.Array.internal;tuple=kh(this.inner);prefixLength=this.prefix?.length??0;defaultablesLength=this.defaultables?.length??0;optionalsLength=this.optionals?.length??0;postfixLength=this.postfix?.length??0;defaultablesAndOptionals=[];prevariadic=this.tuple.filter(e=>e.kind==="defaultables"||e.kind==="optionals"?(this.defaultablesAndOptionals.push(e.node),!0):e.kind==="prefix");variadicOrPostfix=Ue(this.variadic&&[this.variadic],this.postfix);flatRefs=this.addFlatRefs();addFlatRefs(){return Si(this.flatRefs,this.prevariadic.flatMap((e,r)=>q(e.node.flatRefs.map(n=>Be([`${r}`,...n.path],n.node)),Be([`${r}`],e.node)))),Si(this.flatRefs,this.variadicOrPostfix.flatMap(e=>q(e.flatRefs.map(r=>Be([A.intrinsic.nonNegativeIntegerString.internal,...r.path],r.node)),Be([A.intrinsic.nonNegativeIntegerString.internal],e)))),this.flatRefs}isVariadicOnly=this.prevariadic.length+this.postfixLength===0;minVariadicLength=this.inner.minVariadicLength??0;minLength=this.prefixLength+this.minVariadicLength+this.postfixLength;minLengthNode=this.minLength===0?null:this.$.node("minLength",this.minLength);maxLength=this.variadic?null:this.tuple.length;maxLengthNode=this.maxLength===null?null:this.$.node("maxLength",this.maxLength);impliedSiblings=this.minLengthNode?this.maxLengthNode?[this.minLengthNode,this.maxLengthNode]:[this.minLengthNode]:this.maxLengthNode?[this.maxLengthNode]:[];defaultValueMorphs=wh(this);defaultValueMorphsReference=this.defaultValueMorphs.length?oe(this.defaultValueMorphs):void 0;elementAtIndex(e,r){if(r<this.prevariadic.length)return this.tuple[r];const n=e.length-this.postfixLength;return r>=n?{kind:"postfix",node:this.postfix[r-n]}:{kind:"variadic",node:this.variadic??Y(`Unexpected attempt to access index ${r} on ${this}`)}}traverseAllows=(e,r)=>{for(let n=0;n<e.length;n++)if(!this.elementAtIndex(e,n).node.traverseAllows(e[n],r))return!1;return!0};traverseApply=(e,r)=>{let n=0;for(;n<e.length;n++)Ae(n,()=>this.elementAtIndex(e,n).node.traverseApply(e[n],r),r)};get element(){return this.cacheGetter("element",this.$.node("union",this.children))}compile(e){if(this.prefix)for(const[r,n]of this.prefix.entries())e.traverseKey(`${r}`,`data[${r}]`,n);for(const[r,n]of this.defaultablesAndOptionals.entries()){const i=`${r+this.prefixLength}`;e.if(`${i} >= data.length`,()=>e.traversalKind==="Allows"?e.return(!0):e.return()),e.traverseKey(i,`data[${i}]`,n)}if(this.variadic&&(this.postfix&&e.const("firstPostfixIndex",`data.length${this.postfix?`- ${this.postfix.length}`:""}`),e.for(`i < ${this.postfix?"firstPostfixIndex":"data.length"}`,()=>e.traverseKey("i","data[i]",this.variadic),this.prevariadic.length),this.postfix))for(const[r,n]of this.postfix.entries()){const i=`firstPostfixIndex + ${r}`;e.traverseKey(i,`data[${i}]`,n)}e.traversalKind==="Allows"&&e.return(!0)}_transform(e,r){r.path.push(A.intrinsic.nonNegativeIntegerString.internal);const n=super._transform(e,r);return r.path.pop(),n}expression=this.description;reduceJsonSchema(e,r){if(this.prevariadic.length&&(e.prefixItems=this.prevariadic.map(n=>{const i=n.node.toJsonSchemaRecurse(r);if(n.kind==="defaultables"){const s=typeof n.default=="function"?n.default():n.default;i.default=A.intrinsic.jsonData.allows(s)?s:r.fallback.defaultValue({code:"defaultValue",base:i,value:s})}return i})),this.minLength&&(e.minItems=this.minLength),this.variadic){const n=Object.assign(e,{items:this.variadic.toJsonSchemaRecurse(r)});if(this.maxLength&&(n.maxItems=this.maxLength),this.postfix){const i=this.postfix.map(s=>s.toJsonSchemaRecurse(r));e=r.fallback.arrayPostfix({code:"arrayPostfix",base:n,elements:i})}}else e.items=!1,delete e.maxItems;return e}}const xh={},wh=t=>{if(!t.defaultables)return[];const e=[];let r="[";const n=t.prefixLength+t.defaultablesLength-1;for(let i=t.prefixLength;i<=n;i++){const[s,l]=t.defaultables[i-t.prefixLength];e.push(fa(i,s,l)),r+=`${i}: ${s.id} = ${Ve(l)}, `}return r+="]",xh[r]??=e},wa={implementation:bh,Node:vh},kh=t=>{const e=[];if(t.prefix)for(const r of t.prefix)e.push({kind:"prefix",node:r});if(t.defaultables)for(const[r,n]of t.defaultables)e.push({kind:"defaultables",node:r,default:n});if(t.optionals)for(const r of t.optionals)e.push({kind:"optionals",node:r});if(t.variadic&&e.push({kind:"variadic",node:t.variadic}),t.postfix)for(const r of t.postfix)e.push({kind:"postfix",node:r});return e},$i=t=>t.reduce((e,r)=>(r.kind==="variadic"?e.variadic=r.node:r.kind==="defaultables"?e.defaultables=q(e.defaultables,[[r.node,r.default]]):e[r.kind]=q(e[r.kind],r.node),e),{}),ka="A postfix required element cannot follow an optional or defaultable element",Sh="A postfix element requires a variadic element",xt=t=>{const[e,...r]=t.l,[n,...i]=t.r;if(!e||!n)return t;const s=r.at(-1)?.kind==="postfix",l=i.at(-1)?.kind==="postfix",u=e.kind==="prefix"||n.kind==="prefix"?"prefix":e.kind==="postfix"||n.kind==="postfix"?"postfix":e.kind==="variadic"&&n.kind==="variadic"?"variadic":s||l?"prefix":e.kind==="defaultables"||n.kind==="defaultables"?"defaultables":"optionals";if(e.kind==="prefix"&&n.kind==="variadic"&&l){const p=xt({...t,fixedVariants:[],r:i.map(c=>({...c,kind:"prefix"}))});p.disjoint.length===0&&t.fixedVariants.push(p)}else if(n.kind==="prefix"&&e.kind==="variadic"&&s){const p=xt({...t,fixedVariants:[],l:r.map(c=>({...c,kind:"prefix"}))});p.disjoint.length===0&&t.fixedVariants.push(p)}const f=Z(e.node,n.node,t.ctx);if(f instanceof N)if(u==="prefix"||u==="postfix")t.disjoint.push(...f.withPrefixKey(u==="prefix"?t.result.length:`-${r.length+1}`,Ri(e)&&Ri(n)?"required":"optional")),t.result=[...t.result,{kind:u,node:A.intrinsic.never.internal}];else return u==="optionals"||u==="defaultables"?t:xt({...t,fixedVariants:[],l:r.map(p=>({...p,kind:"prefix"})),r:r.map(p=>({...p,kind:"prefix"}))});else u==="defaultables"?(e.kind==="defaultables"&&n.kind==="defaultables"&&e.default!==n.default&&_(ha(e.default,n.default)),t.result=[...t.result,{kind:u,node:f,default:e.kind==="defaultables"?e.default:n.kind==="defaultables"?n.default:Y(`Unexpected defaultable intersection from ${e.kind} and ${n.kind} elements.`)}]):t.result=[...t.result,{kind:u,node:f}];const d=t.l.length,h=t.r.length;return(e.kind!=="variadic"||d>=h&&(n.kind==="variadic"||h===1))&&(t.l=r),(n.kind!=="variadic"||h>=d&&(e.kind==="variadic"||d===1))&&(t.r=i),xt(t)},Ri=t=>t.kind==="prefix"||t.kind==="postfix",Sa=t=>e=>{if(e.props.length||e.index){const r=e.index?.map(i=>i[t])??[];for(const i of e.props)r.push(i[t]);e.undeclared&&r.push(`+ (undeclared): ${e.undeclared}`);const n=`{ ${r.join(", ")} }`;return e.sequence?`${n} & ${e.sequence.description}`:n}return e.sequence?.description??"{}"},_h=Sa("description"),Ph=Sa("expression"),Ti=(t,e,r)=>{const n=t.required?"required":"optional";if(!e.signature.allows(t.key))return null;const i=Me(t.value,e.value,r);return i instanceof N?n==="optional"?r.node("optional",{key:t.key,value:A.intrinsic.never.internal}):i.withPrefixKey(t.key,t.kind):null},Ih=z({kind:"structure",hasAssociatedError:!1,normalize:t=>t,applyConfig:(t,e)=>!t.undeclared&&e.onUndeclaredKey!=="ignore"?{...t,undeclared:e.onUndeclaredKey}:t,keys:{required:{child:!0,parse:le("required"),reduceIo:(t,e,r)=>{e.required=q(e.required,r.map(n=>t==="in"?n.rawIn:n.rawOut))}},optional:{child:!0,parse:le("optional"),reduceIo:(t,e,r)=>{if(t==="in"){e.optional=r.map(n=>n.rawIn);return}for(const n of r)e[n.outProp.kind]=q(e[n.outProp.kind],n.outProp.rawOut)}},index:{child:!0,parse:le("index")},sequence:{child:!0,parse:le("sequence")},undeclared:{parse:t=>t==="ignore"?void 0:t,reduceIo:(t,e,r)=>{if(r==="reject"){e.undeclared="reject";return}t==="in"?delete e.undeclared:e.undeclared="reject"}}},defaults:{description:_h},intersections:{structure:(t,e,r)=>{const n={...t.inner},i={...e.inner},s=new N;if(t.undeclared){const f=t.keyof();for(const d of e.requiredKeys)f.allows(d)||s.add("presence",A.intrinsic.never.internal,e.propsByKey[d].value,{path:[d]});i.optional&&(i.optional=i.optional.filter(d=>f.allows(d.key))),i.index&&(i.index=i.index.flatMap(d=>{if(d.signature.extends(f))return d;const h=Me(f,d.signature,r.$);if(h instanceof N)return[];const p=kn(h,d.value,r.$);return p.required&&(i.required=Ue(i.required,p.required)),p.optional&&(i.optional=Ue(i.optional,p.optional)),p.index??[]}))}if(e.undeclared){const f=e.keyof();for(const d of t.requiredKeys)f.allows(d)||s.add("presence",t.propsByKey[d].value,A.intrinsic.never.internal,{path:[d]});n.optional&&(n.optional=n.optional.filter(d=>f.allows(d.key))),n.index&&(n.index=n.index.flatMap(d=>{if(d.signature.extends(f))return d;const h=Me(f,d.signature,r.$);if(h instanceof N)return[];const p=kn(h,d.value,r.$);return p.required&&(n.required=Ue(n.required,p.required)),p.optional&&(n.optional=Ue(n.optional,p.optional)),p.index??[]}))}const l={};(t.undeclared||e.undeclared)&&(l.undeclared=t.undeclared==="reject"||e.undeclared==="reject"?"reject":"delete");const u=vr({kind:"structure",baseInner:l,l:xr(n),r:xr(i),roots:[],ctx:r});return u instanceof N&&s.push(...u),s.length?s:u}},reduce:(t,e)=>{if(t.index){if(!(t.required||t.optional))return;let r=!1;const n=t.required??[],i=t.optional??[],s=[...i];for(const l of t.index){for(const u of n){const f=Ti(u,l,e);if(f instanceof N)return f}for(const[u,f]of i.entries()){const d=Ti(f,l,e);if(d instanceof N)return d;d!==null&&(s[u]=d,r=!0)}}if(r)return e.node("structure",{...t,optional:s},{prereduced:!0})}}});class Ch extends ct{impliedBasis=A.intrinsic.object.internal;impliedSiblings=this.children.flatMap(e=>e.impliedSiblings??[]);props=Ue(this.required,this.optional);propsByKey=F(this.props,(e,r)=>[r.key,r]);propsByKeyReference=oe(this.propsByKey);expression=Ph(this);requiredKeys=this.required?.map(e=>e.key)??[];optionalKeys=this.optional?.map(e=>e.key)??[];literalKeys=[...this.requiredKeys,...this.optionalKeys];_keyof;keyof(){if(this._keyof)return this._keyof;let e=this.$.units(this.literalKeys).branches;if(this.index)for(const{signature:r}of this.index)e=e.concat(r.branches);return this._keyof=this.$.node("union",e)}map(e){return this.$.node("structure",this.props.flatMap(e).reduce((r,n)=>{const i=this.propsByKey[n.key];if(se(n))return n.kind!=="required"&&n.kind!=="optional"?_(`Map result must have kind "required" or "optional" (was ${n.kind})`):(r[n.kind]=q(r[n.kind],n),r);const s=n.kind??i?.kind??"required",l=F(n,(u,f)=>u in Un.implementation.keys?[u,f]:[]);return r[s]=q(r[s],this.$.node(s,l)),r},{}))}assertHasKeys(e){const r=e.filter(n=>!Ft(n,this.keyof()));if(r.length)return _(Bi(this.expression,r))}get(e,...r){let n,i=!1;const s=Nh(e);if((typeof s=="string"||typeof s=="symbol")&&this.propsByKey[s]&&(n=this.propsByKey[s].value,i=this.propsByKey[s].required),this.index)for(const u of this.index)Ft(s,u.signature)&&(n=n?.and(u.value)??u.value);if(this.sequence&&Ft(s,A.intrinsic.nonNegativeIntegerString))if(D(s,"root"))this.sequence.variadic&&(n=n?.and(this.sequence.element)??this.sequence.element);else{const u=Number.parseInt(s);if(u<this.sequence.prevariadic.length){const f=this.sequence.prevariadic[u].node;n=n?.and(f)??f,i||=u<this.sequence.prefixLength}else if(this.sequence.variadic){const f=this.$.node("union",this.sequence.variadicOrPostfix);n=n?.and(f)??f}}if(!n)return this.sequence?.variadic&&D(s,"root")&&s.extends(A.intrinsic.number)?_(Dh(s.expression,this.sequence.expression)):_(Bi(this.expression,[s]));const l=n.get(...r);return i?l:l.or(A.intrinsic.undefined)}pick(...e){return this.assertHasKeys(e),this.$.node("structure",this.filterKeys("pick",e))}omit(...e){return this.assertHasKeys(e),this.$.node("structure",this.filterKeys("omit",e))}optionalize(){const{required:e,...r}=this.inner;return this.$.node("structure",{...r,optional:this.props.map(n=>n.hasKind("required")?this.$.node("optional",n.inner):n)})}require(){const{optional:e,...r}=this.inner;return this.$.node("structure",{...r,required:this.props.map(n=>n.hasKind("optional")?{key:n.key,value:n.value}:n)})}merge(e){const r=this.filterKeys("omit",[e.keyof()]);return e.required&&(r.required=q(r.required,e.required)),e.optional&&(r.optional=q(r.optional,e.optional)),e.index&&(r.index=q(r.index,e.index)),e.sequence&&(r.sequence=e.sequence),e.undeclared?r.undeclared=e.undeclared:delete r.undeclared,this.$.node("structure",r)}filterKeys(e,r){const n=qo(this.inner),i=s=>{const l=r.some(u=>Ft(s,u));return e==="pick"?l:!l};return n.required&&(n.required=n.required.filter(s=>i(s.key))),n.optional&&(n.optional=n.optional.filter(s=>i(s.key))),n.index&&(n.index=n.index.filter(s=>i(s.signature))),n}traverseAllows=(e,r)=>this._traverse("Allows",e,r);traverseApply=(e,r)=>this._traverse("Apply",e,r);_traverse=(e,r,n)=>{const i=n?.currentErrorCount??0;for(let s=0;s<this.props.length;s++)if(e==="Allows"){if(!this.props[s].traverseAllows(r,n))return!1}else if(this.props[s].traverseApply(r,n),n.failFast&&n.currentErrorCount>i)return!1;if(this.sequence){if(e==="Allows"){if(!this.sequence.traverseAllows(r,n))return!1}else if(this.sequence.traverseApply(r,n),n.failFast&&n.currentErrorCount>i)return!1}if(this.index||this.undeclared==="reject"){const s=Object.keys(r);s.push(...Object.getOwnPropertySymbols(r));for(let l=0;l<s.length;l++){const u=s[l];if(this.index){for(const f of this.index)if(f.signature.traverseAllows(u,n)){if(e==="Allows"){if(!Ae(u,()=>f.value.traverseAllows(r[u],n),n))return!1}else if(Ae(u,()=>f.value.traverseApply(r[u],n),n),n.failFast&&n.currentErrorCount>i)return!1}}if(this.undeclared==="reject"&&!this.declaresKey(u)&&(e==="Allows"||(n.errorFromNodeContext({code:"predicate",expected:"removed",actual:"",relativePath:[u],meta:this.meta}),n.failFast)))return!1}}return this.structuralMorph&&n&&!n.hasError()&&n.queueMorphs([this.structuralMorph]),!0};get defaultable(){return this.cacheGetter("defaultable",this.optional?.filter(e=>e.hasDefault())??[])}declaresKey=e=>e in this.propsByKey||this.index?.some(r=>r.signature.allows(e))||this.sequence!==void 0&&A.intrinsic.nonNegativeIntegerString.allows(e);_compileDeclaresKey(e){const r=[];if(this.props.length&&r.push(`k in ${this.propsByKeyReference}`),this.index)for(const n of this.index)r.push(e.invoke(n.signature,{kind:"Allows",arg:"k"}));return this.sequence&&r.push("$ark.intrinsic.nonNegativeIntegerString.allows(k)"),r.join(" || ")||"false"}get structuralMorph(){return this.cacheGetter("structuralMorph",Ah(this))}structuralMorphRef=this.structuralMorph&&oe(this.structuralMorph);compile(e){e.traversalKind==="Apply"&&e.initializeErrorCount();for(const r of this.props)e.check(r),e.traversalKind==="Apply"&&e.returnIfFailFast();if(this.sequence&&(e.check(this.sequence),e.traversalKind==="Apply"&&e.returnIfFailFast()),(this.index||this.undeclared==="reject")&&(e.const("keys","Object.keys(data)"),e.line("keys.push(...Object.getOwnPropertySymbols(data))"),e.for("i < keys.length",()=>this.compileExhaustiveEntry(e))),e.traversalKind==="Allows")return e.return(!0);this.structuralMorphRef&&e.if("ctx && !ctx.hasError()",()=>(e.line("ctx.queueMorphs(["),Mh(e,this),e.line("])")))}compileExhaustiveEntry(e){if(e.const("k","keys[i]"),this.index)for(const r of this.index)e.if(`${e.invoke(r.signature,{arg:"k",kind:"Allows"})}`,()=>e.traverseKey("k","data[k]",r.value));return this.undeclared==="reject"&&e.if(`!(${this._compileDeclaresKey(e)})`,()=>e.traversalKind==="Allows"?e.return(!1):e.line(`ctx.errorFromNodeContext({ code: "predicate", expected: "removed", actual: "", relativePath: [k], meta: ${this.compiledMeta} })`).if("ctx.failFast",()=>e.return())),e}reduceJsonSchema(e,r){switch(e.type){case"object":return this.reduceObjectJsonSchema(e,r);case"array":const n=this.sequence?.reduceJsonSchema(e,r)??e;return this.props.length||this.index?r.fallback.arrayObject({code:"arrayObject",base:n,object:this.reduceObjectJsonSchema({type:"object"},r)}):n;default:return Q.throwInternalOperandError("structure",e)}}reduceObjectJsonSchema(e,r){if(this.props.length){e.properties={};for(const n of this.props){const i=n.value.toJsonSchemaRecurse(r);if(typeof n.key=="symbol"){r.fallback.symbolKey({code:"symbolKey",base:e,key:n.key,value:i,optional:n.optional});continue}if(n.hasDefault()){const s=typeof n.default=="function"?n.default():n.default;i.default=A.intrinsic.jsonData.allows(s)?s:r.fallback.defaultValue({code:"defaultValue",base:i,value:s})}e.properties[n.key]=i}this.requiredKeys.length&&e.properties&&(e.required=this.requiredKeys.filter(n=>typeof n=="string"&&n in e.properties))}if(this.index)for(const n of this.index){const i=n.value.toJsonSchemaRecurse(r);if(n.signature.equals(A.intrinsic.string)){e.additionalProperties=i;continue}for(const s of n.signature.branches){if(!s.extends(A.intrinsic.string)){e=r.fallback.symbolKey({code:"symbolKey",base:e,key:null,value:i,optional:!1});continue}let l={type:"string"};if(s.hasKind("morph")&&(l=r.fallback.morph({code:"morph",base:s.rawIn.toJsonSchemaRecurse(r),out:s.rawOut.toJsonSchemaRecurse(r)})),!s.hasKind("intersection"))return Y(`Unexpected index branch kind ${s.kind}.`);const{pattern:u}=s.inner;if(u){const f=Object.assign(l,{pattern:u[0].rule});for(let d=1;d<u.length;d++)l=r.fallback.patternIntersection({code:"patternIntersection",base:f,pattern:u[d].rule});e.patternProperties??={},e.patternProperties[f.pattern]=i}}}return this.undeclared&&!e.additionalProperties&&(e.additionalProperties=!1),e}}const Gr={},Oh=t=>{let e="";for(let r=0;r<t.defaultable.length;r++)e+=t.defaultable[r].defaultValueMorphRef;if(t.sequence?.defaultValueMorphsReference&&(e+=t.sequence?.defaultValueMorphsReference),t.undeclared==="delete"){if(e+="delete !(",t.required)for(const r of t.required)e+=r.compiledKey+" | ";if(t.optional)for(const r of t.optional)e+=r.compiledKey+" | ";if(t.index)for(const r of t.index)e+=r.signature.id+" | ";if(t.sequence)if(t.sequence.maxLength===null)e+=E.nonNegativeIntegerString.id;else for(let r=0;r<t.sequence.tuple.length;r++)e+=r+" | ";e+=")"}return e},Ah=t=>{const e=Oh(t);if(!e)return;if(Gr[e])return Gr[e];const r=(n,i)=>{for(let s=0;s<t.defaultable.length;s++)t.defaultable[s].key in n||t.defaultable[s].defaultValueMorph(n,i);if(t.sequence?.defaultables)for(let s=n.length-t.sequence.prefixLength;s<t.sequence.defaultables.length;s++)t.sequence.defaultValueMorphs[s](n,i);if(t.undeclared==="delete")for(const s in n)t.declaresKey(s)||delete n[s];return n};return Gr[e]=r},Mh=(t,e)=>{const n=`(data${e.defaultable.some(i=>i.defaultValueMorph.length===2)||e.sequence?.defaultValueMorphs.some(i=>i.length===2)?", ctx":""})`;return t.block(`${n} => `,i=>{for(let s=0;s<e.defaultable.length;s++){const{serializedKey:l,defaultValueMorphRef:u}=e.defaultable[s];i.if(`!(${l} in data)`,f=>f.line(`${u}${n}`))}return e.sequence?.defaultables&&i.for(`i < ${e.sequence.defaultables.length}`,s=>s.set("data[i]",5),`data.length - ${e.sequence.prefixLength}`),e.undeclared==="delete"&&i.forIn("data",s=>s.if(`!(${e._compileDeclaresKey(s)})`,l=>l.line("delete data[k]"))),i.return("data")})},_a={implementation:Ih,Node:Ch},Nh=t=>(D(t,"root")&&t.hasKind("unit")&&(t=t.unit),typeof t=="number"&&(t=`${t}`),t),Dh=(t,e)=>`${t} is not allowed as an array index on ${e}. Use the 'nonNegativeIntegerString' keyword instead.`,kn=(t,e,r)=>{const[n,i]=Ol(t.branches,l=>l.hasKind("unit"));if(!n.length)return{index:r.node("index",{signature:t,value:e})};const s={};for(const l of n){const u=r.node("required",{key:l.unit,value:e});s[u.kind]=q(s[u.kind],u)}return i.length&&(s.index=r.node("index",{signature:i,value:e})),s},Eh=t=>D(t,"root")?t.expression:B(t),Bi=(t,e)=>`Key${e.length===1?"":"s"} ${e.map(Eh).join(", ")} ${e.length===1?"does":"do"} not exist on ${t}`,$r={...wd,alias:zn.implementation,domain:Gn.implementation,unit:ba.implementation,proto:kr.implementation,union:ya.implementation,morph:ma.implementation,intersection:pa.implementation,divisor:Yo.implementation,pattern:ua.implementation,predicate:Jo.implementation,required:xa.implementation,optional:Un.implementation,index:va.implementation,sequence:wa.implementation,structure:_a.implementation};A.defaultConfig=Fl(Object.assign(F($r,(t,e)=>[t,e.defaults]),{jitless:Yl(),clone:Gl,onUndeclaredKey:"ignore",exactOptionalPropertyTypes:!0,numberAllowsNaN:!1,dateAllowsInvalid:!1,onFail:null,keywords:{},toJsonSchema:Q.defaultConfig}));A.resolvedConfig=yn(A.defaultConfig,A.config);const Lh={...kd,alias:zn.Node,domain:Gn.Node,unit:ba.Node,proto:kr.Node,union:ya.Node,morph:ma.Node,intersection:pa.Node,divisor:Yo.Node,pattern:ua.Node,predicate:Jo.Node,required:xa.Node,optional:Un.Node,index:va.Node,sequence:wa.Node,structure:_a.Node};class Sn extends Rl{get[Oe](){return"module"}}const Pa=(t,e)=>new Sn(F(t,(r,n)=>[r,D(n,"module")?Pa(n,e):e.bindReference(n)])),$h=t=>re(t)?t:"branches"in t&&re(t.branches)?t.branches:void 0,Rh=(t,e)=>_(`Node of kind ${e} is not valid as a ${t} definition`),qi=t=>`#${t} duplicates public alias ${t}`,Wr={};A.ambient??={};let Fi;const Ia="function $",Th=t=>Ca(t,Oa(t)),Ca=(t,e)=>{const r=e.write(Ia,4),n=e.compile()();for(const i of t)i.precompilation||(i.traverseAllows=n[`${i.id}Allows`].bind(n),i.isRoot()&&!i.allowsRequiresContext&&(i.allows=i.traverseAllows),i.traverseApply=n[`${i.id}Apply`].bind(n),n[`${i.id}Optimistic`]&&(i.traverseOptimistic=n[`${i.id}Optimistic`].bind(n)),i.precompilation=r)},Oa=t=>new Ro().return(t.reduce((e,r)=>{const n=new zr({kind:"Allows"}).indent();r.compile(n);const i=n.write(`${r.id}Allows`),s=new zr({kind:"Apply"}).indent();r.compile(s);const l=s.write(`${r.id}Apply`),u=`${e}${i},
${l},
`;if(!r.hasKind("union"))return u;const f=new zr({kind:"Allows",optimistic:!0}).indent();r.compile(f);const d=f.write(`${r.id}Optimistic`);return`${u}${d},
`},`{
`)+"}");class Aa{config;resolvedConfig;name;get[Oe](){return"scope"}referencesById={};references=[];resolutions={};exportedNames=[];aliases={};resolved=!1;nodesByHash={};intrinsic;constructor(e,r){this.config=yn(A.config,r),this.resolvedConfig=yn(A.resolvedConfig,r),this.name=this.resolvedConfig.name??`anonymousScope${Object.keys(Wr).length}`,this.name in Wr&&_(`A Scope already named ${this.name} already exists`),Wr[this.name]=this;const n=Object.entries(e).map(i=>this.preparseOwnAliasEntry(...i));for(const[i,s]of n){let l=i;if(i[0]==="#"?(l=i.slice(1),l in this.aliases&&_(qi(l)),this.aliases[l]=s):(l in this.aliases&&_(qi(i)),this.aliases[l]=s,this.exportedNames.push(l)),!D(s,"module")&&!D(s,"generic")&&!Ar(s)){const u=this.preparseOwnDefinitionFormat(s,{alias:l});this.resolutions[l]=D(u,"root")?this.bindReference(u):this.createParseContext(u).id}}Fi??=this.node("union",{branches:["string","number","object","bigint","symbol",{unit:!0},{unit:!1},{unit:void 0},{unit:null}]},{prereduced:!0}),this.nodesByHash[Fi.hash]=this.node("intersection",{},{prereduced:!0}),this.intrinsic=A.intrinsic?F(A.intrinsic,(i,s)=>i.startsWith("json")?[]:[i,this.bindReference(s)]):{}}cacheGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}get internal(){return this}_json;get json(){return this._json||this.export(),this._json}defineSchema(e){return e}generic=(...e)=>{const r=this;return(n,i)=>new wr(e,i?new Wo(n):n,r,r,i??null)};units=(e,r)=>{const n=[];for(const s of e)n.includes(s)||n.push(s);const i=n.map(s=>this.node("unit",{unit:s},r));return this.node("union",i,{...r,prereduced:!0})};lazyResolutions=[];lazilyResolve(e,r){const n=this.node("alias",{reference:r??"synthetic",resolve:e},{prereduced:!0});return this.resolved||this.lazyResolutions.push(n),n}schema=(e,r)=>this.finalize(this.parseSchema(e,r));parseSchema=(e,r)=>this.node(pr(e),e,r);preparseNode(e,r,n){let i=typeof e=="string"?e:pr(r,e);if(se(r)&&r.kind===i)return r;if(i==="alias"&&!n?.prereduced){const{reference:u}=zn.implementation.normalize(r,this);if(u.startsWith("$")){const f=this.resolveRoot(u.slice(1));r=f,i=f.kind}}else if(i==="union"&&We(r,"object")){const u=$h(r);u?.length===1&&(r=u[0],i=pr(r))}if(se(r)&&r.kind===i)return r;const l=$r[i].normalize?.(r,this)??r;return se(l)?l.kind===i?l:Rh(i,l.kind):{...n,$:this,kind:i,def:l,prefix:n.alias??i}}bindReference(e){let r;return se(e)?r=e.$===this?e:new e.constructor(e.attachments,this):r=e.$===this?e:new wr(e.params,e.bodyDef,e.$,this,e.hkt),this.resolved||Object.assign(this.referencesById,r.referencesById),r}resolveRoot(e){return this.maybeResolveRoot(e)??_(Ea(e))}maybeResolveRoot(e){const r=this.maybeResolve(e);if(!D(r,"generic"))return r}maybeResolveSubalias(e){return _n(this.aliases,e)??_n(this.ambient,e)}get ambient(){return A.ambient}maybeResolve(e){const r=this.resolutions[e];if(r){if(typeof r!="string")return this.bindReference(r);const i=fe[r];if(D(i,"root"))return this.resolutions[e]=i;if(D(i,"context")){if(i.phase==="resolving")return this.node("alias",{reference:`$${e}`},{prereduced:!0});if(i.phase==="resolved")return Y(`Unexpected resolved context for was uncached by its scope: ${B(i)}`);i.phase="resolving";const s=this.bindReference(this.parseOwnDefinitionFormat(i.def,i));return i.phase="resolved",fe[s.id]=s,fe[i.id]=s,this.resolutions[e]=s}return Y(`Unexpected nodesById entry for ${r}: ${B(i)}`)}let n=this.aliases[e]??this.ambient?.[e];return n?(n=this.normalizeRootScopeValue(n),D(n,"generic")?this.resolutions[e]=this.bindReference(n):D(n,"module")?(n.root||_(La(e)),this.resolutions[e]=this.bindReference(n.root)):this.resolutions[e]=this.parse(n,{alias:e})):this.maybeResolveSubalias(e)}createParseContext(e){const r=e.id??la(e.prefix);return fe[r]=Object.assign(e,{[Oe]:"context",$:this,id:r,phase:"unresolved"})}traversal(e){return new tt(e,this.resolvedConfig)}import(...e){return new Sn(F(this.export(...e),(r,n)=>[`#${r}`,n]))}precompilation;_exportedResolutions;_exports;export(...e){if(!this._exports){this._exports={};for(const n of this.exportedNames){const i=this.aliases[n];this._exports[n]=D(i,"module")?Pa(i,this):Ki(this.maybeResolve(n))}for(const n of this.lazyResolutions)n.resolution;if(this._exportedResolutions=Da(this,this._exports),this._json=Na(this._exportedResolutions),Object.assign(this.resolutions,this._exportedResolutions),this.references=Object.values(this.referencesById),!this.resolvedConfig.jitless){const n=Oa(this.references);this.precompilation=n.write(Ia,4),Ca(this.references,n)}this.resolved=!0}const r=e.length?e:this.exportedNames;return new Sn(F(r,(n,i)=>[i,this._exports[i]]))}resolve(e){return this.export()[e]}node=(e,r,n={})=>{const i=this.preparseNode(e,r,n);if(se(i))return this.bindReference(i);const s=this.createParseContext(i),l=ca(s),u=this.bindReference(l);return fe[s.id]=u};parse=(e,r={})=>this.finalize(this.parseDefinition(e,r));parseDefinition(e,r={}){if(D(e,"root"))return this.bindReference(e);const n=this.preparseOwnDefinitionFormat(e,r);if(D(n,"root"))return this.bindReference(n);const i=this.createParseContext(n);fe[i.id]=i;let s=this.bindReference(this.parseOwnDefinitionFormat(e,i));return s.isCyclic&&(s=Cd(s,i.id)),fe[i.id]=s,s}finalize(e){return Ki(e),!e.precompilation&&!this.resolvedConfig.jitless&&Th(e.references),e}}class Ma extends Aa{parseOwnDefinitionFormat(e,r){return ca(r)}preparseOwnDefinitionFormat(e,r){return this.preparseNode(pr(e),e,r)}preparseOwnAliasEntry(e,r){return[e,r]}normalizeRootScopeValue(e){return e}}const Ki=t=>{const e=t.references.filter(r=>r.hasKind("alias"));for(const r of e){Object.assign(r.referencesById,r.resolution.referencesById);for(const n of t.references)r.id in n.referencesById&&Object.assign(n.referencesById,r.referencesById)}return t},Na=t=>F(t,(e,r)=>[e,D(r,"root")||D(r,"generic")?r.json:D(r,"module")?Na(r):Y(`Unexpected resolution ${B(r)}`)]),_n=(t,e)=>{const r=e.indexOf(".");if(r===-1)return;const n=e.slice(0,r),i=t[n];if(i===void 0)return;if(!D(i,"module"))return _(Bh(n));const s=e.slice(r+1),l=i[s];if(l===void 0)return _n(i,s);if(D(l,"root")||D(l,"generic"))return l;if(D(l,"module"))return l.root??_(La(e));Y(`Unexpected resolution for alias '${e}': ${B(l)}`)},Wn=(t,e)=>new Ma(t,e),$t=new Ma({}),Da=(t,e)=>{const r={};for(const n in e){const i=e[n];if(D(i,"module")){const s=Da(t,i),l=F(s,(u,f)=>[`${n}.${u}`,f]);Object.assign(r,l)}else D(i,"root")||D(i,"generic")?r[n]=i:Y(`Unexpected scope resolution ${B(i)}`)}return r},Ea=t=>`'${t}' is unresolvable`,Bh=t=>`'${t}' must reference a module to be accessed using dot syntax`,La=t=>`Reference to submodule '${t}' must specify an alias`;$t.export();const K=$t.schema,Jn=$t.node;$t.defineSchema;const Ne=$t.generic,$a="^(?:0|[1-9]\\d*)$",qh=new RegExp($a);oe(qh);const Ra=Wn({bigint:"bigint",boolean:[{unit:!1},{unit:!0}],false:{unit:!1},never:[],null:{unit:null},number:"number",object:"object",string:"string",symbol:"symbol",true:{unit:!0},unknown:{},undefined:{unit:void 0},Array,Date},{prereducedAliases:!0}).export();A.intrinsic={...Ra};const Ta=Wn({integer:{domain:"number",divisor:1},lengthBoundable:["string",Array],key:["string","symbol"],nonNegativeIntegerString:{domain:"string",pattern:$a}},{prereducedAliases:!0}).export();Object.assign(A.intrinsic,Ta);const Fh=Wn({jsonPrimitive:["string","number",{unit:!0},{unit:!1},{unit:null}],jsonObject:{domain:"object",index:{signature:"string",value:"$jsonData"}},jsonData:["$jsonPrimitive","$jsonObject"]},{prereducedAliases:!0}).export(),E={...Ra,...Ta,...Fh,emptyStructure:Jn("structure",{},{prereduced:!0})};A.intrinsic={...E};const Kh=t=>typeof t=="string"&&t[0]==="d"&&(t[1]==="'"||t[1]==='"')&&t.at(-1)===t[1],ji=t=>t.toString()!=="Invalid Date",jh=t=>t.slice(2,-1),Ba=t=>`'${t}' could not be parsed by the Date constructor`,Uh=(t,e)=>Hh(t,e),Hh=(t,e)=>{const r=new Date(t);if(ji(r))return r;const n=pc(t);if(n!==void 0){const i=new Date(n);if(ji(i))return i}return e?_(e===!0?Ba(t):e):void 0},Ui=(t,e)=>{const r=t.scanner.shiftUntilEscapable(Gh[Fa[e]]);if(t.scanner.lookahead==="")return t.error(Jh(r,e));if(t.scanner.shift(),e==="/"){try{new RegExp(r)}catch(n){_(String(n))}t.root=t.ctx.$.node("intersection",{domain:"string",pattern:r},{prereduced:!0})}else if(Se(e,qa))t.root=t.ctx.$.node("unit",{unit:r});else{const n=Uh(r,Ba(r));t.root=t.ctx.$.node("unit",{meta:r,unit:n})}},qa={"'":1,'"':1},zh={"/":1,"'":1,'"':1},Vh={"d'":"'",'d"':'"',"'":"'",'"':'"'},Fa={...Vh,"/":"/"},Gh={"'":t=>t.lookahead==="'",'"':t=>t.lookahead==='"',"/":t=>t.lookahead==="/"},Wh={'"':"double-quote","'":"single-quote","/":"forward slash"},Jh=(t,e)=>`${e}${t} requires a closing ${Wh[Fa[e]]}`,Yh=t=>`Private type references should not include '#'. Use '${t}' instead.`,Ka="Optional definitions like 'string?' are only valid as properties in an object or tuple",ja="Defaultable definitions like 'number = 0' are only valid as properties in an object or tuple",ht={"<":1,">":1,"=":1,"|":1,"&":1,")":1,"[":1,"%":1,",":1,":":1,"?":1,"#":1,...Mr},Qh=(t,e)=>t===">"?e[0]==="="?e[1]==="=":e.trimStart()===""||Se(e.trimStart()[0],ht):t==="="?e[0]!=="=":t===","||t==="?",Xh=(t,e,r)=>Ua(t,e,r,[]),Ua=(t,e,r,n)=>{const i=r.parseUntilFinalizer();return n.push(i.root),i.finalizer===">"?n.length!==e.params.length?r.error(Ha(t,e.names,n.map(s=>s.expression))):n:i.finalizer===","?Ua(t,e,r,n):i.error(Lo(">"))},Ha=(t,e,r)=>`${t}<${e.join(", ")}> requires exactly ${e.length} args (got ${r.length}${r.length===0?"":`: ${r.join(", ")}`})`,Hi=t=>{const e=t.scanner.shiftUntilLookahead(ht);e==="keyof"?t.addPrefix("keyof"):t.root=ef(t,e)},Zh=(t,e,r)=>{if(r.scanner.shiftUntilNonWhitespace(),r.scanner.shift()!=="<")return r.error(Ha(t,e.names,[]));const i=Xh(t,e,r);return e(...i)},ef=(t,e)=>tf(t,e)??rf(t,e)??t.error(e===""?t.scanner.lookahead==="#"?Yh(t.shiftedByOne().scanner.shiftUntilLookahead(ht)):za(t):Ea(e)),tf=(t,e)=>{if(t.ctx.args?.[e]){const n=t.ctx.args[e];return typeof n!="string"?n:t.ctx.$.node("alias",{reference:n},{prereduced:!0})}const r=t.ctx.$.maybeResolve(e);if(D(r,"root"))return r;if(r!==void 0)return D(r,"generic")?Zh(e,r,t):_(`Unexpected resolution ${B(r)}`)},rf=(t,e)=>{const r=mc(e);if(r!==void 0)return t.ctx.$.node("unit",{unit:r});const n=yc(e);if(n!==void 0)return t.ctx.$.node("unit",{unit:n})},za=t=>{const e=t.previousOperator();return e?Va(e,t.scanner.unscanned):nf(t.scanner.unscanned)},Va=(t,e="")=>`Token '${t}' requires a right operand${e?` before '${e}'`:""}`,nf=t=>`Expected an expression${t?` before '${t}'`:""}`,Ga=t=>t.scanner.lookahead===""?t.error(za(t)):t.scanner.lookahead==="("?t.shiftedByOne().reduceGroupOpen():t.scanner.lookaheadIsIn(zh)?Ui(t,t.scanner.shift()):t.scanner.lookaheadIsIn(Mr)?Ga(t.shiftedByOne()):t.scanner.lookahead==="d"&&t.scanner.nextLookahead in qa?Ui(t,`${t.scanner.shift()}${t.scanner.shift()}`):Hi(t),sf={">":!0,">=":!0},of={"<":!0,"<=":!0},Sr={"<":">",">":"<","<=":">=",">=":"<=","==":"=="},af=(t,e)=>`Left bounds are only valid when paired with right bounds (try ...${e}${t})`,Wa=t=>`Left-bounded expressions must specify their limits using < or <= (was ${t})`,uf=(t,e,r,n)=>`An expression may have at most one left bound (parsed ${t}${Sr[e]}, ${r}${Sr[n]})`,lf=(t,e)=>{const r=df(t,e);if(t.root.hasKind("unit")){if(typeof t.root.unit=="number"){t.reduceLeftBound(t.root.unit,r),t.unsetRoot();return}if(t.root.unit instanceof Date){const n=`d'${t.root.description??t.root.unit.toISOString()}'`;t.unsetRoot(),t.reduceLeftBound(n,r);return}}return ff(t,r)},cf={"<":1,">":1,"=":1},df=(t,e)=>t.scanner.lookaheadIs("=")?`${e}${t.scanner.shift()}`:e,zi=(t,e,r,n)=>r.extends(A.intrinsic.number)?typeof e!="number"?_(Pn(t,e,n)):t==="=="?["min","max"]:t[0]===">"?["min"]:["max"]:r.extends(A.intrinsic.lengthBoundable)?typeof e!="number"?_(Pn(t,e,n)):t==="=="?["exactLength"]:t[0]===">"?["minLength"]:["maxLength"]:r.extends(A.intrinsic.Date)?t==="=="?["after","before"]:t[0]===">"?["after"]:["before"]:_(od(r.expression)),hf=t=>({rule:Kh(t.limit)?jh(t.limit):t.limit,exclusive:t.comparator.length===1}),ff=(t,e)=>{const r=t.unsetRoot(),n=t.scanner.location;t.parseOperand();const i=t.unsetRoot(),s=t.scanner.sliceChars(n,t.scanner.location);if(t.root=r,!i.hasKind("unit")||typeof i.unit!="number"&&!(i.unit instanceof Date))return t.error(Pn(e,s,"right"));const l=i.unit,u=e.length===1,f=zi(e,typeof l=="number"?l:s,r,"right");for(const h of f)t.constrainRoot(h,e==="=="?{rule:l}:{rule:l,exclusive:u});if(!t.branches.leftBound)return;if(!Se(e,of))return t.error(Wa(e));const d=zi(t.branches.leftBound.comparator,t.branches.leftBound.limit,r,"left");t.constrainRoot(d[0],hf(t.branches.leftBound)),t.branches.leftBound=null},Pn=(t,e,r)=>`Comparator ${r==="left"?Sr[t]:t} must be ${r==="left"?"preceded":"followed"} by a corresponding literal (was ${e})`,pf=t=>{t.scanner.shiftUntilNonWhitespace();const e=t.scanner.shiftUntilLookahead(ht);t.root=t.root.brand(e)},mf=t=>{t.scanner.shiftUntilNonWhitespace();const e=t.scanner.shiftUntilLookahead(ht),r=gc(e,{errorOnFail:Vi(e)});r===0&&t.error(Vi(0)),t.root=t.root.constrain("divisor",r)},Vi=t=>`% operator must be followed by a non-zero integer literal (was ${t})`,Ja=t=>{const e=t.scanner.shift();return e===""?t.finalize(""):e==="["?t.scanner.shift()==="]"?t.setRoot(t.root.array()):t.error(gf):e==="|"?t.scanner.lookahead===">"?t.shiftedByOne().pushRootToBranch("|>"):t.pushRootToBranch(e):e==="&"?t.pushRootToBranch(e):e===")"?t.finalizeGroup():Qh(e,t.scanner.unscanned)?t.finalize(e):Se(e,cf)?lf(t,e):e==="%"?mf(t):e==="#"?pf(t):e in Mr?Ja(t):t.error(Yn(e))},Yn=(t,e="")=>`'${t}' is not allowed here${e&&` (should be ${e})`}`,gf="Missing expected ']'",yf=t=>{const e=t.unsetRoot();t.parseOperand();const r=t.unsetRoot();if(!r.hasKind("unit"))return t.error(bf(r.expression));const n=r.unit instanceof Date?()=>new Date(r.unit):r.unit;return[e,"=",n]},bf=t=>`Default value '${t}' must be a literal value`,Gi=(t,e)=>{const r=e.$.maybeResolveRoot(t);if(r)return r;if(t.endsWith("[]")){const s=e.$.maybeResolveRoot(t.slice(0,-2));if(s)return s.array()}const n=new Rr(new Eo(t),e),i=vf(n);return n.finalizer===">"&&_(Yn(">")),i},vf=t=>{t.parseOperand();let e=Qn(t).root;return e?(t.finalizer==="="?e=yf(t):t.finalizer==="?"&&(e=[e,"?"]),t.scanner.shiftUntilNonWhitespace(),t.scanner.lookahead&&_(Yn(t.scanner.lookahead)),e):Y(`Root was unexpectedly unset after parsing string '${t.scanner.scanned}'`)},Qn=t=>{for(;t.finalizer===void 0;)xf(t);return t},xf=t=>t.hasRoot()?t.parseOperator():t.parseOperand();class Rr{root;branches={prefixes:[],leftBound:null,intersection:null,union:null,pipe:null};finalizer;groups=[];scanner;ctx;constructor(e,r){this.scanner=e,this.ctx=r}error(e){return _(e)}hasRoot(){return this.root!==void 0}setRoot(e){this.root=e}unsetRoot(){const e=this.root;return this.root=void 0,e}constrainRoot(...e){this.root=this.root.constrain(e[0],e[1])}finalize(e){if(this.groups.length)return this.error(Lo(")"));this.finalizeBranches(),this.finalizer=e}reduceLeftBound(e,r){const n=Sr[r];if(!Se(n,sf))return this.error(Wa(r));if(this.branches.leftBound)return this.error(uf(this.branches.leftBound.limit,this.branches.leftBound.comparator,e,n));this.branches.leftBound={comparator:n,limit:e}}finalizeBranches(){if(this.assertRangeUnset(),this.branches.pipe){this.pushRootToBranch("|>"),this.root=this.branches.pipe;return}if(this.branches.union){this.pushRootToBranch("|"),this.root=this.branches.union;return}if(this.branches.intersection){this.pushRootToBranch("&"),this.root=this.branches.intersection;return}this.applyPrefixes()}finalizeGroup(){this.finalizeBranches();const e=this.groups.pop();if(!e)return this.error(Pc(")",this.scanner.unscanned));this.branches=e}addPrefix(e){this.branches.prefixes.push(e)}applyPrefixes(){for(;this.branches.prefixes.length;){const e=this.branches.prefixes.pop();this.root=e==="keyof"?this.root.keyof():Y(`Unexpected prefix '${e}'`)}}pushRootToBranch(e){this.assertRangeUnset(),this.applyPrefixes();const r=this.root;this.root=void 0,this.branches.intersection=this.branches.intersection?.rawAnd(r)??r,e!=="&"&&(this.branches.union=this.branches.union?.rawOr(this.branches.intersection)??this.branches.intersection,this.branches.intersection=null,e!=="|"&&(this.branches.pipe=this.branches.pipe?.rawPipeOnce(this.branches.union)??this.branches.union,this.branches.union=null))}parseUntilFinalizer(){return Qn(new Rr(this.scanner,this.ctx))}parseOperator(){return Ja(this)}parseOperand(){return Ga(this)}assertRangeUnset(){if(this.branches.leftBound)return this.error(af(this.branches.leftBound.limit,this.branches.leftBound.comparator))}reduceGroupOpen(){this.groups.push(this.branches),this.branches={prefixes:[],leftBound:null,union:null,intersection:null,pipe:null}}previousOperator(){return this.branches.leftBound?.comparator??this.branches.prefixes.at(-1)??(this.branches.intersection?"&":this.branches.union?"|":this.branches.pipe?"|>":void 0)}shiftedByOne(){return this.scanner.shift(),this}}const wf="An empty string is not a valid generic parameter name",In=(t,e,r)=>{t.shiftUntilNonWhitespace();const n=t.shiftUntilLookahead(ht);return n===""?t.lookahead===""&&e.length?e:_(wf):(t.shiftUntilNonWhitespace(),kf(t,n,e,r))},Wi="extends ",kf=(t,e,r,n)=>{if(t.shiftUntilNonWhitespace(),t.unscanned.startsWith(Wi))t.jumpForward(Wi.length);else return t.lookahead===","&&t.shift(),r.push(e),In(t,r,n);const i=Qn(new Rr(t,n));return r.push([e,i.root]),In(t,r,n)};class Sf extends Ke{constructor(e){const r={$:e,raw:e.fn};super((...n)=>{const i=n.indexOf(":"),s=i===-1?n.length-1:i-1,l=n.slice(0,s+1),u=e.parse(l).assertHasKind("intersection");let f=e.intrinsic.unknown;if(i!==-1){if(i!==n.length-2)return _(Pf);f=e.parse(n[i+1])}return d=>new _f(d,u,f)},{attach:r})}}class _f extends Ke{raw;params;returns;expression;constructor(e,r,n){const i=`typed ${e.name}`,s={[i]:(...u)=>{const f=r.assert(u),d=e(...f);return n.assert(d)}}[i];super(s),this.raw=e,this.params=r,this.returns=n;let l=r.expression;l[0]==="["&&l.at(-1)==="]"?l=l.slice(1,-1):l.endsWith("[]")&&(l=`...${l}`),this.expression=`(${l}) => ${n?.expression??"unknown"}`}}const Pf=`":" must be followed by exactly one return type e.g:
fn("string", ":", "number")(s => s.length)`;class If extends Ke{$;constructor(e){super((...r)=>new Kt(e)(...r),{bind:e}),this.$=e}in(e){return new Kt(this.$,e===void 0?void 0:this.$.parse(e))}at(e,r){return new Kt(this.$).at(e,r)}case(e,r){return new Kt(this.$).case(e,r)}}class Kt extends Ke{$;in;key;branches=[];constructor(e,r){super(n=>this.caseEntries(Object.entries(n).map(([i,s])=>i==="default"?[i,s]:[this.$.parse(i),s]))),this.$=e,this.in=r}at(e,r){return this.key&&_(Of),this.branches.length&&_(Cf),this.key=e,r?this.match(r):this}case(e,r){return this.caseEntry(this.$.parse(e),r)}caseEntry(e,r){const i=(this.key?this.$.parse({[this.key]:e}):e).pipe(r);return this.branches.push(i),this}match(e){return this(e)}strings(e){return this.caseEntries(Object.entries(e).map(([r,n])=>r==="default"?[r,n]:[this.$.node("unit",{unit:r}),n]))}caseEntries(e){for(let r=0;r<e.length;r++){const[n,i]=e[r];if(n==="default")return r!==e.length-1&&_("default may only be specified as the last key of a switch definition"),this.default(i);if(typeof i!="function")return _(`Value for case "${n}" must be a function (was ${ge(i)})`);this.caseEntry(n,i)}return this}default(e){typeof e=="function"&&this.case(E.unknown,e);const r={branches:this.branches,ordered:!0};(e==="never"||e==="assert")&&(r.meta={onFail:Ji});const n=this.$.node("union",r);if(!this.in)return this.$.finalize(n);let i=this.in.pipe(n);return(e==="never"||e==="assert")&&(i=i.configureReferences({onFail:Ji},"self")),this.$.finalize(i)}}const Ji=t=>t.throw(),Cf="A key matcher must be specified before the first case i.e. match.at('foo') or match.in<object>().at('bar')",Of="At most one key matcher may be specified per expression",Ya=(t,e)=>{if(re(t)){if(t[1]==="=")return[e.$.parseOwnDefinitionFormat(t[0],e),"=",t[2]];if(t[1]==="?")return[e.$.parseOwnDefinitionFormat(t[0],e),"?"]}return nu(t,e)},Af="Only required keys may make their values optional, e.g. { [mySymbol]: ['number', '?'] }",Mf="Only required keys may specify default values, e.g. { value: 'number = 0' }",Nf=(t,e)=>{let r;const n={},i=mr(t);for(const[l,u]of i){const f=Lf(l);if(f.kind==="spread"){if(!Ot(n))return _(Ef);const a=e.$.parseOwnDefinitionFormat(u,e);if(a.equals(E.object))continue;if(!a.hasKind("intersection")||!a.basis?.equals(E.object))return _($f(a.expression));r=a.structure;continue}if(f.kind==="undeclared"){u!=="reject"&&u!=="delete"&&u!=="ignore"&&_(Df(u)),n.undeclared=u;continue}const d=Ya(u,e),h=f;if(f.kind==="required"){re(d)?Jr(n,"optional",d[1]==="="?{key:f.normalized,value:d[0],default:d[2]}:{key:f.normalized,value:d[0]},e):Jr(n,"required",{key:f.normalized,value:d},e);continue}if(re(d)&&(d[1]==="?"&&_(Af),d[1]==="="&&_(Mf)),f.kind==="optional"){Jr(n,"optional",{key:f.normalized,value:d},e);continue}const p=e.$.parseOwnDefinitionFormat(h.normalized,e),c=kn(p,d,e.$);c.index&&(n.index=q(n.index,c.index)),c.required&&(n.required=q(n.required,c.required))}const s=e.$.node("structure",n);return e.$.parseSchema({domain:"object",structure:r?.merge(s)??s})},Jr=(t,e,r,n)=>{t[e]=q(t[e],n.$.node(e,r))},Df=t=>`Value of '+' key must be 'reject', 'delete', or 'ignore' (was ${B(t)})`,Ef="Spread operator may only be used as the first key in an object",Lf=t=>typeof t=="symbol"?{kind:"required",normalized:t}:t.at(-1)==="?"?t.at(-2)===wt?{kind:"required",normalized:`${t.slice(0,-2)}?`}:{kind:"optional",normalized:t.slice(0,-1)}:t[0]==="["&&t.at(-1)==="]"?{kind:"index",normalized:t.slice(1,-1)}:t[0]===wt&&t[1]==="["&&t.at(-1)==="]"?{kind:"required",normalized:t.slice(1)}:t==="..."?{kind:"spread"}:t==="+"?{kind:"undeclared"}:{kind:"required",normalized:t==="\\..."?"...":t==="\\+"?"+":t},$f=t=>`Spread operand must resolve to an object literal type (was ${t})`,Rf=(t,e)=>Vf(t)?eu[t[0]](t,e):Hf(t)?Za[t[1]](t,e):null,Tf=(t,e)=>e.$.parseOwnDefinitionFormat(t[1],e).keyof(),Yr=(t,e)=>{if(t[2]===void 0)return _(Va(t[1],""));const r=e.$.parseOwnDefinitionFormat(t[0],e),n=e.$.parseOwnDefinitionFormat(t[2],e);if(t[1]==="|")return e.$.node("union",{branches:[r,n]});const i=t[1]==="&"?Me(r,n,e.$):vn(r,n,e.$);return i instanceof N?i.throw():i},Bf=(t,e)=>e.$.parseOwnDefinitionFormat(t[0],e).array(),qf=(t,e)=>typeof t[2]!="function"?_(Qa("=>",t[2])):e.$.parseOwnDefinitionFormat(t[0],e).pipe(t[2]),Qa=(t,e)=>`${t===":"?"Narrow":"Morph"} expression requires a function following '${t}' (was ${typeof e})`,Ff=(t,e)=>typeof t[2]!="function"?_(Qa(":",t[2])):e.$.parseOwnDefinitionFormat(t[0],e).constrain("predicate",t[2]),Kf=(t,e)=>e.$.parseOwnDefinitionFormat(t[0],e).configure(t[2],t[3]),Xa=t=>t,jf=Xa({"[]":Bf,"?":()=>_(Ka)}),Uf=Xa({"|":Yr,"&":Yr,":":Ff,"=>":qf,"|>":Yr,"@":Kf,"=":()=>_(ja)}),Za={...jf,...Uf},Hf=t=>Za[t[1]]!==void 0,zf=t=>t,eu=zf({keyof:Tf,instanceof:(t,e)=>{if(typeof t[1]!="function")return _(Yi(hn(t[1])));const r=t.slice(1).map(n=>typeof n=="function"?e.$.node("proto",{proto:n}):_(Yi(hn(n))));return r.length===1?r[0]:e.$.node("union",{branches:r})},"===":(t,e)=>e.$.units(t.slice(1))}),Vf=t=>eu[t[0]]!==void 0,Yi=t=>`Expected a constructor following 'instanceof' operator (was ${t})`,Gf=(t,e)=>{let r=[{}],n=0;for(;n<t.length;){let i=!1;t[n]==="..."&&n<t.length-1&&(i=!0,n++);const s=Ya(t[n],e),[l,u,f]=re(s)?s:[s];if(n++,i){if(!l.extends(A.intrinsic.Array))return _(Yf(l.expression));r=r.flatMap(d=>l.distribute(h=>Jf(qo(d),h)))}else r=r.map(d=>u==="?"?tu(d,l):u==="="?Wf(d,l,f):Cn(d,l))}return e.$.parseSchema(r.map(i=>Ot(i)?{proto:Array,exactLength:0}:{proto:Array,sequence:i}))},Cn=(t,e)=>t.defaultables||t.optionals?_(t.variadic?ka:Qf):(t.variadic?t.postfix=q(t.postfix,e):t.prefix=q(t.prefix,e),t),tu=(t,e)=>t.variadic?_(ru):(t.optionals=q(t.optionals,e),t),Wf=(t,e,r)=>t.variadic?_(ru):t.optionals?_(Xf):(t.defaultables=q(t.defaultables,[[e,r]]),t),Qi=(t,e)=>(t.postfix&&_(Xi),t.variadic?t.variadic.equals(e)||_(Xi):t.variadic=e.internal,t),Jf=(t,e)=>{const r=e.select({method:"find",kind:"sequence"});if(!r)return Qi(t,A.intrinsic.unknown);if(r.prefix)for(const n of r.prefix)Cn(t,n);if(r.optionals)for(const n of r.optionals)tu(t,n);if(r.variadic&&Qi(t,r.variadic),r.postfix)for(const n of r.postfix)Cn(t,n);return t},Yf=t=>`Spread element must be an array (was ${t})`,Xi="A tuple may have at most one variadic element",Qf="A required element may not follow an optional element",ru="An optional element may not follow a variadic element",Xf="A defaultable element may not follow an optional element without a default",Zf={},nu=(t,e)=>{if(typeof t=="string"){if(e.args&&Object.keys(e.args).some(n=>t.includes(n)))return Gi(t,e);const r=Zf[e.$.name]??={};return r[t]??=Gi(t,e)}return We(t,"object")?ep(t,e):_(On(ge(t)))},ep=(t,e)=>{const r=$n(t);switch(r){case void 0:return D(t,"root")?t:Nf(t,e);case"Array":return tp(t,e);case"RegExp":return e.$.node("intersection",{domain:"string",pattern:t},{prereduced:!0});case"Function":{const n=Ar(t)?t():t;return D(n,"root")?n:_(On("Function"))}default:return _(On(r??B(t)))}},tp=(t,e)=>Rf(t,e)??Gf(t,e),On=t=>`Type definitions must be strings or objects (was ${t})`;class rp extends Ke{constructor(e){const r=Object.assign({errors:qe,hkt:_e,$:e,raw:e.parse,module:e.constructor.module,scope:e.constructor.scope,declare:e.declare,define:e.define,match:e.match,generic:e.generic,schema:e.schema,keywords:e.ambient,unit:e.unit,enumerated:e.enumerated,instanceOf:e.instanceOf,valueOf:e.valueOf,or:e.or,and:e.and,merge:e.merge,pipe:e.pipe,fn:e.fn},e.ambientAttachments);super((...n)=>{if(n.length===1)return e.parse(n[0]);if(n.length===2&&typeof n[0]=="string"&&n[0][0]==="<"&&n[0].at(-1)===">"){const i=n[0].slice(1,-1),s=e.parseGenericParams(i,{});return new wr(s,n[1],e,e,null)}return e.parse(n)},{attach:r})}}const _t=A;class Tr extends Aa{get ambientAttachments(){if(_t.typeAttachments)return this.cacheGetter("ambientAttachments",F(_t.typeAttachments,(e,r)=>[e,this.bindReference(r)]))}preparseOwnAliasEntry(e,r){const n=e.indexOf("<");if(n===-1){if(D(r,"module")||D(r,"generic"))return[e,r];const l=this.name==="ark"?e:e==="root"?this.name:`${this.name}.${e}`,u=this.resolvedConfig.keywords?.[l];return u&&(r=[r,"@",u]),[e,r]}e.at(-1)!==">"&&_("'>' must be the last character of a generic declaration in a scope");const i=e.slice(0,n),s=e.slice(n+1,-1);return[i,()=>{const l=this.parseGenericParams(s,{alias:i});return Vc(l,r,this)}]}parseGenericParams(e,r){return In(new Eo(e),[],this.createParseContext({...r,def:e,prefix:"generic"}))}normalizeRootScopeValue(e){return Ar(e)&&!D(e,"generic")?e():e}preparseOwnDefinitionFormat(e,r){return{...r,def:e,prefix:r.alias??"type"}}parseOwnDefinitionFormat(e,r){!(r.alias&&r.alias in this.aliases)&&!r.args&&(r.args={this:r.id});const i=nu(e,r);if(re(i)){if(i[1]==="=")return _(ja);if(i[1]==="?")return _(Ka)}return i}unit=e=>this.units([e]);valueOf=e=>this.units(Kl(e));enumerated=(...e)=>this.units(e);instanceOf=e=>this.node("proto",{proto:e},{prereduced:!0});or=(...e)=>this.schema(e.map(r=>this.parse(r)));and=(...e)=>e.reduce((r,n)=>r.and(this.parse(n)),this.intrinsic.unknown);merge=(...e)=>e.reduce((r,n)=>r.merge(this.parse(n)),this.intrinsic.object);pipe=(...e)=>this.intrinsic.unknown.pipe(...e);fn=new Sf(this);match=new If(this);declare=()=>({type:this.type});define(e){return e}type=new rp(this);static scope=((e,r={})=>new Tr(e,r));static module=((e,r={})=>this.scope(e,r).export())}const Pt=Object.assign(Tr.scope,{define:t=>t}),R=Tr;class np extends _e{description='merge an object\'s properties onto another like `Merge(User, { isAdmin: "true" })`'}const ip=Ne(["base",E.object],["props",E.object])(t=>t.base.merge(t.props),np),sp=R.module({Key:E.key,Merge:ip});class op extends _e{}const ap=Ne("element")(t=>{const e=t.element.exclude(E.Array),r=e.array();return e.rawOr(r).pipe(Ct).distribute(n=>n.assertHasKind("morph").declareOut(r),K)},op),up=R.module({root:E.Array,readonly:"root",index:E.nonNegativeIntegerString,liftFrom:ap},{name:"Array"}),An=K(["string",At.FileConstructor]),lp=An.rawOr(An.array()),Zi=K({meta:"an object representing parsed form data",domain:"object",index:{signature:"string",value:lp}}),cp=R.module({root:["instanceof",FormData],value:An,parsed:Zi,parse:K({in:FormData,morphs:t=>{const e={};for(const[r,n]of t)if(r in e){const i=e[r];typeof i=="string"||i instanceof At.FileConstructor?e[r]=[i,n]:i.push(n)}else e[r]=n;return e},declaredOut:Zi})},{name:"FormData"}),dp=R.module({Int8:["instanceof",Int8Array],Uint8:["instanceof",Uint8Array],Uint8Clamped:["instanceof",Uint8ClampedArray],Int16:["instanceof",Int16Array],Uint16:["instanceof",Uint16Array],Int32:["instanceof",Int32Array],Uint32:["instanceof",Uint32Array],Float32:["instanceof",Float32Array],Float64:["instanceof",Float64Array],BigInt64:["instanceof",BigInt64Array],BigUint64:["instanceof",BigUint64Array]},{name:"TypedArray"}),hp={Boolean:1,Number:1,String:1},fp=R.module({...F({...ko,..._o},(t,e)=>t in hp?[]:[t,["instanceof",e]]),Array:up,TypedArray:dp,FormData:cp}),pp=K({domain:{domain:"number",meta:"a number representing a Unix timestamp"},divisor:{rule:1,meta:"an integer representing a Unix timestamp"},min:{rule:-864e13,meta:"a Unix timestamp after -8640000000000000"},max:{rule:864e13,meta:"a Unix timestamp before 8640000000000000"},meta:"an integer representing a safe Unix timestamp"}),mp=K({domain:"number",divisor:1}),iu=R.module({root:E.number,integer:mp,epoch:pp,safe:K({domain:{domain:"number",numberAllowsNaN:!1},min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER}),NaN:["===",Number.NaN],Infinity:["===",Number.POSITIVE_INFINITY],NegativeInfinity:["===",Number.NEGATIVE_INFINITY]},{name:"number"}),j=(t,e,r)=>{const n={domain:"string",pattern:{rule:t.source,flags:t.flags,meta:e}};return r&&(n.meta={format:r}),Jn("intersection",n)},es=j(gr,"a well-formed integer string"),su=R.module({root:es,parse:K({in:es,morphs:(t,e)=>{const r=Number.parseInt(t);return Number.isSafeInteger(r)?r:e.error("an integer in the range Number.MIN_SAFE_INTEGER to Number.MAX_SAFE_INTEGER")},declaredOut:E.integer})},{name:"string.integer"}),gp=j(/^[\dA-Fa-f]+$/,"hex characters only"),yp=R.module({root:j(/^(?:[\d+/A-Za-z]{4})*(?:[\d+/A-Za-z]{2}==|[\d+/A-Za-z]{3}=)?$/,"base64-encoded"),url:j(/^(?:[\w-]{4})*(?:[\w-]{2}(?:==|%3D%3D)?|[\w-]{3}(?:=|%3D)?)?$/,"base64url-encoded")},{name:"string.base64"}),ts=j(/^[A-Z].*$/,"capitalized"),bp=R.module({root:K({in:"string",morphs:t=>t.charAt(0).toUpperCase()+t.slice(1),declaredOut:ts}),preformatted:ts},{name:"string.capitalize"}),vp=t=>{const e=t.replaceAll(/[ -]+/g,"");let r=0,n,i,s=!1;for(let l=e.length-1;l>=0;l--)n=e.substring(l,l+1),i=Number.parseInt(n,10),s?(i*=2,r+=i>=10?i%10+1:i):r+=i,s=!s;return!!(r%10===0&&e)},xp=/^(?:4\d{12}(?:\d{3,6})?|5[1-5]\d{14}|(222[1-9]|22[3-9]\d|2[3-6]\d{2}|27[01]\d|2720)\d{12}|6(?:011|5\d\d)\d{12,15}|3[47]\d{13}|3(?:0[0-5]|[68]\d)\d{11}|(?:2131|1800|35\d{3})\d{11}|6[27]\d{14}|^(81\d{14,17}))$/,wp=K({domain:"string",pattern:{meta:"a credit card number",rule:xp.source},predicate:{meta:"a credit card number",predicate:vp}}),kp=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))(T((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([,.]\d+(?!:))?)?(\17[0-5]\d([,.]\d+)?)?([Zz]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,Sp=t=>!Number.isNaN(new Date(t).valueOf()),rs=K({domain:"string",predicate:{meta:"a parsable date",predicate:Sp}}).assertHasKind("intersection"),ns=su.root.internal.narrow((t,e)=>{const r=Number.parseInt(t),n=iu.epoch(r);return n instanceof qe?(e.errors.merge(n),!1):!0}).configure({description:"an integer string representing a safe Unix timestamp"},"self").assertHasKind("intersection"),_p=R.module({root:ns,parse:K({in:ns,morphs:t=>new Date(t),declaredOut:E.Date})},{name:"string.date.epoch"}),is=j(kp,"an ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ) date").internal.assertHasKind("intersection"),Pp=R.module({root:is,parse:K({in:is,morphs:t=>new Date(t),declaredOut:E.Date})},{name:"string.date.iso"}),Ip=R.module({root:rs,parse:K({declaredIn:rs,in:"string",morphs:(t,e)=>{const r=new Date(t);return Number.isNaN(r.valueOf())?e.error("a parsable date"):r},declaredOut:E.Date}),iso:Pp,epoch:_p},{name:"string.date"}),Cp=j(/^[\w%+.-]+@[\d.A-Za-z-]+\.[A-Za-z]{2,}$/,"an email address","email"),ss="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",$e=`(${ss}[.]){3}${ss}`,Op=new RegExp(`^${$e}$`),J="(?:[0-9a-fA-F]{1,4})",Ap=new RegExp(`^((?:${J}:){7}(?:${J}|:)|(?:${J}:){6}(?:${$e}|:${J}|:)|(?:${J}:){5}(?::${$e}|(:${J}){1,2}|:)|(?:${J}:){4}(?:(:${J}){0,1}:${$e}|(:${J}){1,3}|:)|(?:${J}:){3}(?:(:${J}){0,2}:${$e}|(:${J}){1,4}|:)|(?:${J}:){2}(?:(:${J}){0,3}:${$e}|(:${J}){1,5}|:)|(?:${J}:){1}(?:(:${J}){0,4}:${$e}|(:${J}){1,6}|:)|(?::((?::${J}){0,5}:${$e}|(?::${J}){1,7}|:)))(%[0-9a-zA-Z.]{1,})?$`),Mp=R.module({root:["v4 | v6","@","an IP address"],v4:j(Op,"an IPv4 address","ipv4"),v6:j(Ap,"an IPv6 address","ipv6")},{name:"string.ip"}),nt="a JSON string",ou=t=>{if(!(t instanceof SyntaxError))throw t;return`must be ${nt} (${t})`},Np=K({meta:nt,domain:"string",predicate:{meta:nt,predicate:(t,e)=>{try{return JSON.parse(t),!0}catch(r){return e.reject({code:"predicate",expected:nt,problem:ou(r)})}}}}),Dp=(t,e)=>{if(t.length===0)return e.error({code:"predicate",expected:nt,actual:"empty"});try{return JSON.parse(t)}catch(r){return e.error({code:"predicate",expected:nt,problem:ou(r)})}},Ep=R.module({root:Np,parse:K({meta:"safe JSON string parser",in:"string",morphs:Dp,declaredOut:E.jsonObject})},{name:"string.json"}),os=j(/^[a-z]*$/,"only lowercase letters"),Lp=R.module({root:K({in:"string",morphs:t=>t.toLowerCase(),declaredOut:os}),preformatted:os},{name:"string.lower"}),au=["NFC","NFD","NFKC","NFKD"],Rt=F(au,(t,e)=>[e,K({domain:"string",predicate:r=>r.normalize(e)===r,meta:`${e}-normalized unicode`})]),Br=F(au,(t,e)=>[e,K({in:"string",morphs:r=>r.normalize(e),declaredOut:Rt[e]})]),$p=R.module({root:Br.NFC,preformatted:Rt.NFC},{name:"string.normalize.NFC"}),Rp=R.module({root:Br.NFD,preformatted:Rt.NFD},{name:"string.normalize.NFD"}),Tp=R.module({root:Br.NFKC,preformatted:Rt.NFKC},{name:"string.normalize.NFKC"}),Bp=R.module({root:Br.NFKD,preformatted:Rt.NFKD},{name:"string.normalize.NFKD"}),qp=R.module({root:"NFC",NFC:$p,NFD:Rp,NFKC:Tp,NFKD:Bp},{name:"string.normalize"}),as=j(fn,"a well-formed numeric string"),Fp=R.module({root:as,parse:K({in:as,morphs:t=>Number.parseFloat(t),declaredOut:E.number})},{name:"string.numeric"}),us="a regex pattern",Kp=K({domain:"string",predicate:{meta:us,predicate:(t,e)=>{try{return new RegExp(t),!0}catch(r){return e.reject({code:"predicate",expected:us,problem:String(r)})}}},meta:{format:"regex"}}),jp=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*)(?:\.(?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*))*))?(?:\+([\dA-Za-z-]+(?:\.[\dA-Za-z-]+)*))?$/,Up=j(jp,"a semantic version (see https://semver.org/)"),ls=j(/^\S.*\S$|^\S?$/,"trimmed"),Hp=R.module({root:K({in:"string",morphs:t=>t.trim(),declaredOut:ls}),preformatted:ls},{name:"string.trim"}),cs=j(/^[A-Z]*$/,"only uppercase letters"),zp=R.module({root:K({in:"string",morphs:t=>t.toUpperCase(),declaredOut:cs}),preformatted:cs},{name:"string.upper"}),Vp=t=>URL.canParse(t),ds=K({domain:"string",predicate:{meta:"a URL string",predicate:Vp},meta:{format:"uri"}}),Gp=R.module({root:ds,parse:K({declaredIn:ds,in:"string",morphs:(t,e)=>{try{return new URL(t)}catch{return e.error("a URL string")}},declaredOut:K(URL)})},{name:"string.url"}),Wp=R.module({root:["versioned | nil | max","@",{description:"a UUID",format:"uuid"}],"#nil":"'00000000-0000-0000-0000-000000000000'","#max":"'ffffffff-ffff-ffff-ffff-ffffffffffff'","#versioned":/[\da-f]{8}-[\da-f]{4}-[1-8][\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}/i,v1:j(/^[\da-f]{8}-[\da-f]{4}-1[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv1"),v2:j(/^[\da-f]{8}-[\da-f]{4}-2[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv2"),v3:j(/^[\da-f]{8}-[\da-f]{4}-3[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv3"),v4:j(/^[\da-f]{8}-[\da-f]{4}-4[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv4"),v5:j(/^[\da-f]{8}-[\da-f]{4}-5[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv5"),v6:j(/^[\da-f]{8}-[\da-f]{4}-6[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv6"),v7:j(/^[\da-f]{8}-[\da-f]{4}-7[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv7"),v8:j(/^[\da-f]{8}-[\da-f]{4}-8[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv8")},{name:"string.uuid"}),Jp=R.module({root:E.string,alpha:j(/^[A-Za-z]*$/,"only letters"),alphanumeric:j(/^[\dA-Za-z]*$/,"only letters and digits 0-9"),hex:gp,base64:yp,capitalize:bp,creditCard:wp,date:Ip,digits:j(/^\d*$/,"only digits 0-9"),email:Cp,integer:su,ip:Mp,json:Ep,lower:Lp,normalize:qp,numeric:Fp,regex:Kp,semver:Up,trim:Hp,upper:zp,url:Gp,uuid:Wp},{name:"string"}),Yp=R.module({bigint:E.bigint,boolean:E.boolean,false:E.false,never:E.never,null:E.null,number:E.number,object:E.object,string:E.string,symbol:E.symbol,true:E.true,unknown:E.unknown,undefined:E.undefined}),Qp=R.module({root:E.unknown,any:E.unknown},{name:"unknown"}),Xp=R.module({root:E.jsonObject,stringify:Jn("morph",{in:E.jsonObject,morphs:t=>JSON.stringify(t),declaredOut:E.string})},{name:"object.json"}),Zp=R.module({root:E.object,json:Xp},{name:"object"});class em extends _e{description='instantiate an object from an index signature and corresponding value type like `Record("string", "number")`'}const tm=Ne(["K",E.key],"V")(t=>({domain:"object",index:{signature:t.K,value:t.V}}),em);class rm extends _e{description='pick a set of properties from an object like `Pick(User, "name | age")`'}const nm=Ne(["T",E.object],["K",E.key])(t=>t.T.pick(t.K),rm);class im extends _e{description='omit a set of properties from an object like `Omit(User, "age")`'}const sm=Ne(["T",E.object],["K",E.key])(t=>t.T.omit(t.K),im);class om extends _e{description="make all named properties of an object optional like `Partial(User)`"}const am=Ne(["T",E.object])(t=>t.T.partial(),om);class um extends _e{description="make all named properties of an object required like `Required(User)`"}const lm=Ne(["T",E.object])(t=>t.T.required(),um);class cm extends _e{description='exclude branches of a union like `Exclude("boolean", "true")`'}const dm=Ne("T","U")(t=>t.T.exclude(t.U),cm);class hm extends _e{description='extract branches of a union like `Extract("0 | false | 1", "number")`'}const fm=Ne("T","U")(t=>t.T.extract(t.U),hm),pm=R.module({Exclude:dm,Extract:fm,Omit:sm,Partial:am,Pick:nm,Record:tm,Required:lm}),je=Pt({...Yp,...pm,...fp,...sp,string:Jp,number:iu,object:Zp,unknown:Qp},{prereducedAliases:!0,name:"ark"}),X=je.export();Object.assign(_t.ambient,X);_t.typeAttachments={string:X.string.root,number:X.number.root,bigint:X.bigint,boolean:X.boolean,symbol:X.symbol,undefined:X.undefined,null:X.null,object:X.object.root,unknown:X.unknown.root,false:X.false,true:X.true,never:X.never,arrayIndex:X.Array.index,Key:X.Key,Record:X.Record,Array:X.Array.root,Date:X.Date};const I=Object.assign(je.type,_t.typeAttachments),ky=je.match;je.fn;je.generic;je.schema;je.define;je.declare;const mm={js:{fr:()=>ui(()=>import("./B_gCPjZH.js"),[],import.meta.url),en:()=>ui(()=>import("./D4wTKBGp.js"),[],import.meta.url)}},gm=(t,e)=>mm[t][e](),ym=["js"],bm="js",vm=Yu(bm,gm,ym);function Sy(t,e,r=n=>n===1?0:1){const n=r(t);return e[n].replace("#",Intl.NumberFormat().format(t))}function _y(t,e=0,{pad:r="none"}={}){let n=(t*100).toFixed(e);return e>0&&(n=n.replace(/\.?0+$/,"")),r!=="none"&&(n=n.padStart(2+e,r==="nbsp"?" ":"0")),n+"%"}function Py(t){const[e,r]=t.split("/",2);let n=r.replace(/^x-/,"");return["image","video","audio"].includes(e)&&(n=n.toUpperCase()),n}function xm(t,e=""){const n=Qu(vm("js")).t(88);let i=n;for(t instanceof Error&&("message"in t&&t.message&&(i=t.message||n),"cause"in t&&t.cause&&(i=xm(t.cause))),i=t?.toString()||n;i.startsWith("Error: ");)i=i.slice(7);return i||=n,e?`${e}: ${i}`:i}function wm(){return navigator.language.split("-")[0]==="fr"?"fr":"en"}function Iy(t){return t&&t.charAt(0).toUpperCase()+t.slice(1)}const ee=I(/^[\w._]+$/),Xn=ee.array().pipe(t=>[...new Set(t)]),hs=I("0 <= number <= 1.0001").pipe(t=>oo(t,0,1)),Ge=I(/https?:\/\/.+/),It=Ge.configure("L'URL à laquelle se situe le fichier. Effectue une requête GET sans en-têtes particuliers.","self").or({url:Ge.describe("L'URL de la requête"),"headers?":I({"[string]":"string"}).describe("Les en-têtes à ajouter dans la requête"),"method?":I.enumerated("GET","POST","PUT","DELETE").describe("La méthode de la requête (GET par défaut)")}).configure("Le requête HTTP pour obtenir le fichier, avec des en-têtes et une méthode personnalisable","self"),Zn=I({width:["number < 1024","@","Largeur en pixels du tenseur d'entrée du modèle"],height:["number < 1024","@","Hauteur en pixels du tenseur d'entrée du modèle"],"disposition?":I(['"CHW"',"@","Tenseurs de la forme [3, H, W]"]).or(I(['"1CHW"',"@","Tenseurs de la forme [1, 3, H, W]"])),normalized:["boolean","@","Si les valeurs des pixels doivent être normalisées entre 0 et 1. Sinon, elles sont entre 0 et 255"],"name?":["string","@","Nom de l'input du modèle à utiliser. Par défaut, prend la première input"]}),ei=I({width:"number > 0",height:"number > 0"}).pipe(({width:t,height:e})=>({width:t,height:e,aspectRatio:t/e})),uu=I("string.base64 == 28","@","Hash SHA-1 encodé en base 64"),lu=6048e5,Cy=864e5,km=6e4,Sm=36e5,_m=1e3,Oy=43200,Ay=1440,fs=Symbol.for("constructDateFrom");function te(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&fs in t?t[fs](e):t instanceof Date?new t.constructor(e):new Date(e)}function ne(t,e){return te(e||t,t)}function cu(t,e,r){const n=ne(t,r?.in);return isNaN(e)?te(r?.in||t,NaN):(e&&n.setDate(n.getDate()+e),n)}let du={};function Tt(){return du}function My(t){du=t}function Fe(t,e){const r=Tt(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,i=ne(t,e?.in),s=i.getDay(),l=(s<n?7:0)+s-n;return i.setDate(i.getDate()-l),i.setHours(0,0,0,0),i}function lt(t,e){return Fe(t,{...e,weekStartsOn:1})}function Pm(t,e){const r=ne(t,e?.in),n=r.getFullYear(),i=te(r,0);i.setFullYear(n+1,0,4),i.setHours(0,0,0,0);const s=lt(i),l=te(r,0);l.setFullYear(n,0,4),l.setHours(0,0,0,0);const u=lt(l);return r.getTime()>=s.getTime()?n+1:r.getTime()>=u.getTime()?n:n-1}function hu(t){const e=ne(t),r=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return r.setUTCFullYear(e.getFullYear()),+t-+r}function Im(t,e){const r=Pm(t,e),n=te(t,0);return n.setFullYear(r,0,4),n.setHours(0,0,0,0),lt(n)}function Cm(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Om(t){return!(!Cm(t)&&typeof t!="number"||isNaN(+ne(t)))}const Am={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Mm=(t,e,r)=>{let n;const i=Am[t];return typeof i=="string"?n=i:e===1?n=i.one:n=i.other.replace("{{count}}",e.toString()),r?.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function Qr(t){return(e={})=>{const r=e.width?String(e.width):t.defaultWidth;return t.formats[r]||t.formats[t.defaultWidth]}}const Nm={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Dm={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Em={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Lm={date:Qr({formats:Nm,defaultWidth:"full"}),time:Qr({formats:Dm,defaultWidth:"full"}),dateTime:Qr({formats:Em,defaultWidth:"full"})},$m={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Rm=(t,e,r,n)=>$m[t];function pt(t){return(e,r)=>{const n=r?.context?String(r.context):"standalone";let i;if(n==="formatting"&&t.formattingValues){const l=t.defaultFormattingWidth||t.defaultWidth,u=r?.width?String(r.width):l;i=t.formattingValues[u]||t.formattingValues[l]}else{const l=t.defaultWidth,u=r?.width?String(r.width):t.defaultWidth;i=t.values[u]||t.values[l]}const s=t.argumentCallback?t.argumentCallback(e):e;return i[s]}}const Tm={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Bm={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},qm={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Fm={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Km={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},jm={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Um=(t,e)=>{const r=Number(t),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},Hm={ordinalNumber:Um,era:pt({values:Tm,defaultWidth:"wide"}),quarter:pt({values:Bm,defaultWidth:"wide",argumentCallback:t=>t-1}),month:pt({values:qm,defaultWidth:"wide"}),day:pt({values:Fm,defaultWidth:"wide"}),dayPeriod:pt({values:Km,defaultWidth:"wide",formattingValues:jm,defaultFormattingWidth:"wide"})};function mt(t){return(e,r={})=>{const n=r.width,i=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth],s=e.match(i);if(!s)return null;const l=s[0],u=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth],f=Array.isArray(u)?Vm(u,p=>p.test(l)):zm(u,p=>p.test(l));let d;d=t.valueCallback?t.valueCallback(f):f,d=r.valueCallback?r.valueCallback(d):d;const h=e.slice(l.length);return{value:d,rest:h}}}function zm(t,e){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e(t[r]))return r}function Vm(t,e){for(let r=0;r<t.length;r++)if(e(t[r]))return r}function Gm(t){return(e,r={})=>{const n=e.match(t.matchPattern);if(!n)return null;const i=n[0],s=e.match(t.parsePattern);if(!s)return null;let l=t.valueCallback?t.valueCallback(s[0]):s[0];l=r.valueCallback?r.valueCallback(l):l;const u=e.slice(i.length);return{value:l,rest:u}}}const Wm=/^(\d+)(th|st|nd|rd)?/i,Jm=/\d+/i,Ym={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Qm={any:[/^b/i,/^(a|c)/i]},Xm={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Zm={any:[/1/i,/2/i,/3/i,/4/i]},eg={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},tg={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},rg={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},ng={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ig={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},sg={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},og={ordinalNumber:Gm({matchPattern:Wm,parsePattern:Jm,valueCallback:t=>parseInt(t,10)}),era:mt({matchPatterns:Ym,defaultMatchWidth:"wide",parsePatterns:Qm,defaultParseWidth:"any"}),quarter:mt({matchPatterns:Xm,defaultMatchWidth:"wide",parsePatterns:Zm,defaultParseWidth:"any",valueCallback:t=>t+1}),month:mt({matchPatterns:eg,defaultMatchWidth:"wide",parsePatterns:tg,defaultParseWidth:"any"}),day:mt({matchPatterns:rg,defaultMatchWidth:"wide",parsePatterns:ng,defaultParseWidth:"any"}),dayPeriod:mt({matchPatterns:ig,defaultMatchWidth:"any",parsePatterns:sg,defaultParseWidth:"any"})},ag={code:"en-US",formatDistance:Mm,formatLong:Lm,formatRelative:Rm,localize:Hm,match:og,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ug(t,e){const r=ne(t,e?.in),n=+lt(r)-+Im(r);return Math.round(n/lu)+1}function fu(t,e){const r=ne(t,e?.in),n=r.getFullYear(),i=Tt(),s=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,l=te(e?.in||t,0);l.setFullYear(n+1,0,s),l.setHours(0,0,0,0);const u=Fe(l,e),f=te(e?.in||t,0);f.setFullYear(n,0,s),f.setHours(0,0,0,0);const d=Fe(f,e);return+r>=+u?n+1:+r>=+d?n:n-1}function lg(t,e){const r=Tt(),n=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,i=fu(t,e),s=te(e?.in||t,0);return s.setFullYear(i,0,n),s.setHours(0,0,0,0),Fe(s,e)}function cg(t,e){const r=ne(t,e?.in),n=+Fe(r,e)-+lg(r,e);return Math.round(n/lu)+1}const ps=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},pu=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},dg=(t,e)=>{const r=t.match(/(P+)(p+)?/)||[],n=r[1],i=r[2];if(!i)return ps(t,e);let s;switch(n){case"P":s=e.dateTime({width:"short"});break;case"PP":s=e.dateTime({width:"medium"});break;case"PPP":s=e.dateTime({width:"long"});break;case"PPPP":default:s=e.dateTime({width:"full"});break}return s.replace("{{date}}",ps(n,e)).replace("{{time}}",pu(i,e))},ms={p:pu,P:dg},hg=/^D+$/,fg=/^Y+$/,pg=["D","DD","YY","YYYY"];function mg(t){return hg.test(t)}function gg(t){return fg.test(t)}function gs(t,e,r){const n=yg(t,e,r);if(console.warn(n),pg.includes(t))throw new RangeError(n)}function yg(t,e,r){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}function bg(){return Object.assign({},Tt())}function vg(t,e){const r=ne(t,e?.in).getDay();return r===0?7:r}function xg(t,e){const r=wg(e)?new e(0):te(e,0);return r.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),r.setHours(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),r}function wg(t){return typeof t=="function"&&t.prototype?.constructor===t}const kg=10;class mu{subPriority=0;validate(e,r){return!0}}class Sg extends mu{constructor(e,r,n,i,s){super(),this.value=e,this.validateValue=r,this.setValue=n,this.priority=i,s&&(this.subPriority=s)}validate(e,r){return this.validateValue(e,this.value,r)}set(e,r,n){return this.setValue(e,r,this.value,n)}}class _g extends mu{priority=kg;subPriority=-1;constructor(e,r){super(),this.context=e||(n=>te(r,n))}set(e,r){return r.timestampIsSet?e:te(e,xg(e,this.context))}}class T{run(e,r,n,i){const s=this.parse(e,r,n,i);return s?{setter:new Sg(s.value,this.validate,this.set,this.priority,this.subPriority),rest:s.rest}:null}validate(e,r,n){return!0}}class Pg extends T{priority=140;parse(e,r,n){switch(r){case"G":case"GG":case"GGG":return n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"});case"GGGGG":return n.era(e,{width:"narrow"});case"GGGG":default:return n.era(e,{width:"wide"})||n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"})}}set(e,r,n){return r.era=n,e.setFullYear(n,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["R","u","t","T"]}const G={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},ve={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function W(t,e){return t&&{value:e(t.value),rest:t.rest}}function U(t,e){const r=e.match(t);return r?{value:parseInt(r[0],10),rest:e.slice(r[0].length)}:null}function xe(t,e){const r=e.match(t);if(!r)return null;if(r[0]==="Z")return{value:0,rest:e.slice(1)};const n=r[1]==="+"?1:-1,i=r[2]?parseInt(r[2],10):0,s=r[3]?parseInt(r[3],10):0,l=r[5]?parseInt(r[5],10):0;return{value:n*(i*Sm+s*km+l*_m),rest:e.slice(r[0].length)}}function gu(t){return U(G.anyDigitsSigned,t)}function H(t,e){switch(t){case 1:return U(G.singleDigit,e);case 2:return U(G.twoDigits,e);case 3:return U(G.threeDigits,e);case 4:return U(G.fourDigits,e);default:return U(new RegExp("^\\d{1,"+t+"}"),e)}}function _r(t,e){switch(t){case 1:return U(G.singleDigitSigned,e);case 2:return U(G.twoDigitsSigned,e);case 3:return U(G.threeDigitsSigned,e);case 4:return U(G.fourDigitsSigned,e);default:return U(new RegExp("^-?\\d{1,"+t+"}"),e)}}function ti(t){switch(t){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function yu(t,e){const r=e>0,n=r?e:1-e;let i;if(n<=50)i=t||100;else{const s=n+50,l=Math.trunc(s/100)*100,u=t>=s%100;i=t+l-(u?100:0)}return r?i:1-i}function bu(t){return t%400===0||t%4===0&&t%100!==0}class Ig extends T{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(e,r,n){const i=s=>({year:s,isTwoDigitYear:r==="yy"});switch(r){case"y":return W(H(4,e),i);case"yo":return W(n.ordinalNumber(e,{unit:"year"}),i);default:return W(H(r.length,e),i)}}validate(e,r){return r.isTwoDigitYear||r.year>0}set(e,r,n){const i=e.getFullYear();if(n.isTwoDigitYear){const l=yu(n.year,i);return e.setFullYear(l,0,1),e.setHours(0,0,0,0),e}const s=!("era"in r)||r.era===1?n.year:1-n.year;return e.setFullYear(s,0,1),e.setHours(0,0,0,0),e}}class Cg extends T{priority=130;parse(e,r,n){const i=s=>({year:s,isTwoDigitYear:r==="YY"});switch(r){case"Y":return W(H(4,e),i);case"Yo":return W(n.ordinalNumber(e,{unit:"year"}),i);default:return W(H(r.length,e),i)}}validate(e,r){return r.isTwoDigitYear||r.year>0}set(e,r,n,i){const s=fu(e,i);if(n.isTwoDigitYear){const u=yu(n.year,s);return e.setFullYear(u,0,i.firstWeekContainsDate),e.setHours(0,0,0,0),Fe(e,i)}const l=!("era"in r)||r.era===1?n.year:1-n.year;return e.setFullYear(l,0,i.firstWeekContainsDate),e.setHours(0,0,0,0),Fe(e,i)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]}class Og extends T{priority=130;parse(e,r){return _r(r==="R"?4:r.length,e)}set(e,r,n){const i=te(e,0);return i.setFullYear(n,0,4),i.setHours(0,0,0,0),lt(i)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]}class Ag extends T{priority=130;parse(e,r){return _r(r==="u"?4:r.length,e)}set(e,r,n){return e.setFullYear(n,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]}class Mg extends T{priority=120;parse(e,r,n){switch(r){case"Q":case"QQ":return H(r.length,e);case"Qo":return n.ordinalNumber(e,{unit:"quarter"});case"QQQ":return n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(e,{width:"wide",context:"formatting"})||n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"})}}validate(e,r){return r>=1&&r<=4}set(e,r,n){return e.setMonth((n-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]}class Ng extends T{priority=120;parse(e,r,n){switch(r){case"q":case"qq":return H(r.length,e);case"qo":return n.ordinalNumber(e,{unit:"quarter"});case"qqq":return n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(e,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(e,{width:"wide",context:"standalone"})||n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"})}}validate(e,r){return r>=1&&r<=4}set(e,r,n){return e.setMonth((n-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]}class Dg extends T{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(e,r,n){const i=s=>s-1;switch(r){case"M":return W(U(G.month,e),i);case"MM":return W(H(2,e),i);case"Mo":return W(n.ordinalNumber(e,{unit:"month"}),i);case"MMM":return n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(e,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(e,{width:"wide",context:"formatting"})||n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"})}}validate(e,r){return r>=0&&r<=11}set(e,r,n){return e.setMonth(n,1),e.setHours(0,0,0,0),e}}class Eg extends T{priority=110;parse(e,r,n){const i=s=>s-1;switch(r){case"L":return W(U(G.month,e),i);case"LL":return W(H(2,e),i);case"Lo":return W(n.ordinalNumber(e,{unit:"month"}),i);case"LLL":return n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(e,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(e,{width:"wide",context:"standalone"})||n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"})}}validate(e,r){return r>=0&&r<=11}set(e,r,n){return e.setMonth(n,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]}function Lg(t,e,r){const n=ne(t,r?.in),i=cg(n,r)-e;return n.setDate(n.getDate()-i*7),ne(n,r?.in)}class $g extends T{priority=100;parse(e,r,n){switch(r){case"w":return U(G.week,e);case"wo":return n.ordinalNumber(e,{unit:"week"});default:return H(r.length,e)}}validate(e,r){return r>=1&&r<=53}set(e,r,n,i){return Fe(Lg(e,n,i),i)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]}function Rg(t,e,r){const n=ne(t,r?.in),i=ug(n,r)-e;return n.setDate(n.getDate()-i*7),n}class Tg extends T{priority=100;parse(e,r,n){switch(r){case"I":return U(G.week,e);case"Io":return n.ordinalNumber(e,{unit:"week"});default:return H(r.length,e)}}validate(e,r){return r>=1&&r<=53}set(e,r,n){return lt(Rg(e,n))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]}const Bg=[31,28,31,30,31,30,31,31,30,31,30,31],qg=[31,29,31,30,31,30,31,31,30,31,30,31];class Fg extends T{priority=90;subPriority=1;parse(e,r,n){switch(r){case"d":return U(G.date,e);case"do":return n.ordinalNumber(e,{unit:"date"});default:return H(r.length,e)}}validate(e,r){const n=e.getFullYear(),i=bu(n),s=e.getMonth();return i?r>=1&&r<=qg[s]:r>=1&&r<=Bg[s]}set(e,r,n){return e.setDate(n),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]}class Kg extends T{priority=90;subpriority=1;parse(e,r,n){switch(r){case"D":case"DD":return U(G.dayOfYear,e);case"Do":return n.ordinalNumber(e,{unit:"date"});default:return H(r.length,e)}}validate(e,r){const n=e.getFullYear();return bu(n)?r>=1&&r<=366:r>=1&&r<=365}set(e,r,n){return e.setMonth(0,n),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]}function ri(t,e,r){const n=Tt(),i=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,s=ne(t,r?.in),l=s.getDay(),f=(e%7+7)%7,d=7-i,h=e<0||e>6?e-(l+d)%7:(f+d)%7-(l+d)%7;return cu(s,h,r)}class jg extends T{priority=90;parse(e,r,n){switch(r){case"E":case"EE":case"EEE":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEE":default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}validate(e,r){return r>=0&&r<=6}set(e,r,n,i){return e=ri(e,n,i),e.setHours(0,0,0,0),e}incompatibleTokens=["D","i","e","c","t","T"]}class Ug extends T{priority=90;parse(e,r,n,i){const s=l=>{const u=Math.floor((l-1)/7)*7;return(l+i.weekStartsOn+6)%7+u};switch(r){case"e":case"ee":return W(H(r.length,e),s);case"eo":return W(n.ordinalNumber(e,{unit:"day"}),s);case"eee":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeeee":return n.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeee":default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}validate(e,r){return r>=0&&r<=6}set(e,r,n,i){return e=ri(e,n,i),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]}class Hg extends T{priority=90;parse(e,r,n,i){const s=l=>{const u=Math.floor((l-1)/7)*7;return(l+i.weekStartsOn+6)%7+u};switch(r){case"c":case"cc":return W(H(r.length,e),s);case"co":return W(n.ordinalNumber(e,{unit:"day"}),s);case"ccc":return n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"ccccc":return n.day(e,{width:"narrow",context:"standalone"});case"cccccc":return n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"cccc":default:return n.day(e,{width:"wide",context:"standalone"})||n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"})}}validate(e,r){return r>=0&&r<=6}set(e,r,n,i){return e=ri(e,n,i),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]}function zg(t,e,r){const n=ne(t,r?.in),i=vg(n,r),s=e-i;return cu(n,s,r)}class Vg extends T{priority=90;parse(e,r,n){const i=s=>s===0?7:s;switch(r){case"i":case"ii":return H(r.length,e);case"io":return n.ordinalNumber(e,{unit:"day"});case"iii":return W(n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),i);case"iiiii":return W(n.day(e,{width:"narrow",context:"formatting"}),i);case"iiiiii":return W(n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),i);case"iiii":default:return W(n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),i)}}validate(e,r){return r>=1&&r<=7}set(e,r,n){return e=zg(e,n),e.setHours(0,0,0,0),e}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]}class Gg extends T{priority=80;parse(e,r,n){switch(r){case"a":case"aa":case"aaa":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,r,n){return e.setHours(ti(n),0,0,0),e}incompatibleTokens=["b","B","H","k","t","T"]}class Wg extends T{priority=80;parse(e,r,n){switch(r){case"b":case"bb":case"bbb":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,r,n){return e.setHours(ti(n),0,0,0),e}incompatibleTokens=["a","B","H","k","t","T"]}class Jg extends T{priority=80;parse(e,r,n){switch(r){case"B":case"BB":case"BBB":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,r,n){return e.setHours(ti(n),0,0,0),e}incompatibleTokens=["a","b","t","T"]}class Yg extends T{priority=70;parse(e,r,n){switch(r){case"h":return U(G.hour12h,e);case"ho":return n.ordinalNumber(e,{unit:"hour"});default:return H(r.length,e)}}validate(e,r){return r>=1&&r<=12}set(e,r,n){const i=e.getHours()>=12;return i&&n<12?e.setHours(n+12,0,0,0):!i&&n===12?e.setHours(0,0,0,0):e.setHours(n,0,0,0),e}incompatibleTokens=["H","K","k","t","T"]}class Qg extends T{priority=70;parse(e,r,n){switch(r){case"H":return U(G.hour23h,e);case"Ho":return n.ordinalNumber(e,{unit:"hour"});default:return H(r.length,e)}}validate(e,r){return r>=0&&r<=23}set(e,r,n){return e.setHours(n,0,0,0),e}incompatibleTokens=["a","b","h","K","k","t","T"]}class Xg extends T{priority=70;parse(e,r,n){switch(r){case"K":return U(G.hour11h,e);case"Ko":return n.ordinalNumber(e,{unit:"hour"});default:return H(r.length,e)}}validate(e,r){return r>=0&&r<=11}set(e,r,n){return e.getHours()>=12&&n<12?e.setHours(n+12,0,0,0):e.setHours(n,0,0,0),e}incompatibleTokens=["h","H","k","t","T"]}class Zg extends T{priority=70;parse(e,r,n){switch(r){case"k":return U(G.hour24h,e);case"ko":return n.ordinalNumber(e,{unit:"hour"});default:return H(r.length,e)}}validate(e,r){return r>=1&&r<=24}set(e,r,n){const i=n<=24?n%24:n;return e.setHours(i,0,0,0),e}incompatibleTokens=["a","b","h","H","K","t","T"]}class e0 extends T{priority=60;parse(e,r,n){switch(r){case"m":return U(G.minute,e);case"mo":return n.ordinalNumber(e,{unit:"minute"});default:return H(r.length,e)}}validate(e,r){return r>=0&&r<=59}set(e,r,n){return e.setMinutes(n,0,0),e}incompatibleTokens=["t","T"]}class t0 extends T{priority=50;parse(e,r,n){switch(r){case"s":return U(G.second,e);case"so":return n.ordinalNumber(e,{unit:"second"});default:return H(r.length,e)}}validate(e,r){return r>=0&&r<=59}set(e,r,n){return e.setSeconds(n,0),e}incompatibleTokens=["t","T"]}class r0 extends T{priority=30;parse(e,r){const n=i=>Math.trunc(i*Math.pow(10,-r.length+3));return W(H(r.length,e),n)}set(e,r,n){return e.setMilliseconds(n),e}incompatibleTokens=["t","T"]}class n0 extends T{priority=10;parse(e,r){switch(r){case"X":return xe(ve.basicOptionalMinutes,e);case"XX":return xe(ve.basic,e);case"XXXX":return xe(ve.basicOptionalSeconds,e);case"XXXXX":return xe(ve.extendedOptionalSeconds,e);case"XXX":default:return xe(ve.extended,e)}}set(e,r,n){return r.timestampIsSet?e:te(e,e.getTime()-hu(e)-n)}incompatibleTokens=["t","T","x"]}class i0 extends T{priority=10;parse(e,r){switch(r){case"x":return xe(ve.basicOptionalMinutes,e);case"xx":return xe(ve.basic,e);case"xxxx":return xe(ve.basicOptionalSeconds,e);case"xxxxx":return xe(ve.extendedOptionalSeconds,e);case"xxx":default:return xe(ve.extended,e)}}set(e,r,n){return r.timestampIsSet?e:te(e,e.getTime()-hu(e)-n)}incompatibleTokens=["t","T","X"]}class s0 extends T{priority=40;parse(e){return gu(e)}set(e,r,n){return[te(e,n*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"}class o0 extends T{priority=20;parse(e){return gu(e)}set(e,r,n){return[te(e,n),{timestampIsSet:!0}]}incompatibleTokens="*"}const a0={G:new Pg,y:new Ig,Y:new Cg,R:new Og,u:new Ag,Q:new Mg,q:new Ng,M:new Dg,L:new Eg,w:new $g,I:new Tg,d:new Fg,D:new Kg,E:new jg,e:new Ug,c:new Hg,i:new Vg,a:new Gg,b:new Wg,B:new Jg,h:new Yg,H:new Qg,K:new Xg,k:new Zg,m:new e0,s:new t0,S:new r0,X:new n0,x:new i0,t:new s0,T:new o0},u0=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,l0=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,c0=/^'([^]*?)'?$/,d0=/''/g,h0=/\S/,f0=/[a-zA-Z]/;function p0(t,e,r,n){const i=()=>te(r,NaN),s=bg(),l=s.locale??ag,u=s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,f=s.weekStartsOn??s.locale?.options?.weekStartsOn??0;if(!e)return t?i():ne(r,n?.in);const d={firstWeekContainsDate:u,weekStartsOn:f,locale:l},h=[new _g(n?.in,r)],p=e.match(l0).map(m=>{const b=m[0];if(b in ms){const v=ms[b];return v(m,l.formatLong)}return m}).join("").match(u0),c=[];for(let m of p){gg(m)&&gs(m,e,t),mg(m)&&gs(m,e,t);const b=m[0],v=a0[b];if(v){const{incompatibleTokens:w}=v;if(Array.isArray(w)){const x=c.find(k=>w.includes(k.token)||k.token===b);if(x)throw new RangeError(`The format string mustn't contain \`${x.fullToken}\` and \`${m}\` at the same time`)}else if(v.incompatibleTokens==="*"&&c.length>0)throw new RangeError(`The format string mustn't contain \`${m}\` and any other token at the same time`);c.push({token:b,fullToken:m});const y=v.run(t,m,l.match,d);if(!y)return i();h.push(y.setter),t=y.rest}else{if(b.match(f0))throw new RangeError("Format string contains an unescaped latin alphabet character `"+b+"`");if(m==="''"?m="'":b==="'"&&(m=m0(m)),t.indexOf(m)===0)t=t.slice(m.length);else return i()}}if(t.length>0&&h0.test(t))return i();const a=h.map(m=>m.priority).sort((m,b)=>b-m).filter((m,b,v)=>v.indexOf(m)===b).map(m=>h.filter(b=>b.priority===m).sort((b,v)=>v.subPriority-b.subPriority)).map(m=>m[0]);let o=ne(r,n?.in);if(isNaN(+o))return i();const g={};for(const m of a){if(!m.validate(o,d))return i();const b=m.set(o,g,d);Array.isArray(b)?(o=b[0],Object.assign(g,b[1])):o=b}return o}function m0(t){return t.match(c0)[1].replace(d0,"'")}function g0(t){return y0(t,"yyyy-MM-dd","yyyy-MM-dd'T'HH:mm:ss","yyyy-MM-dd'T'HH:mm:ssXXX")}function y0(t,...e){for(const r of e)try{const n=p0(t,r,new Date);if(Om(n))return n}catch{continue}}const b0={InteropIndex:1,InteropVersion:2,ProcessingSoftware:11,SubfileType:254,OldSubfileType:255,ImageWidth:256,ImageHeight:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Thresholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,MinSampleValue:280,MaxSampleValue:281,XResolution:282,YResolution:283,PlanarConfiguration:284,PageName:285,XPosition:286,YPosition:287,FreeOffsets:288,FreeByteCounts:289,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,PageNumber:297,ColorResponseUnit:300,TransferFunction:301,Software:305,ModifyDate:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,BadFaxLines:326,CleanFaxData:327,ConsecutiveBadFaxLines:328,SubIFD:330,InkSet:332,InkNames:333,NumberofInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,GlobalParametersIFD:400,ProfileType:401,FaxProfile:402,CodingMethods:403,VersionYear:404,ModeNumber:405,Decode:433,DefaultImageColor:434,T82Options:435,JPEGProc:512,ThumbnailOffset:513,ThumbnailLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,StripRowCounts:559,ApplicationNotes:700,USPTOMiscellaneous:999,RelatedImageFileFormat:4096,RelatedImageWidth:4097,RelatedImageHeight:4098,Rating:18246,XP_DIP_XML:18247,StitchInfo:18248,RatingPercent:18249,ImageID:32781,WangTag1:32931,WangAnnotation:32932,WangTag3:32933,WangTag4:32934,Matteing:32995,DataType:32996,ImageDepth:32997,TileDepth:32998,Model2:33405,CFARepeatPatternDim:33421,CFAPattern2:33422,BatteryLevel:33423,KodakIFD:33424,Copyright:33432,ExposureTime:33434,FNumber:33437,MDFileTag:33445,MDScalePixel:33446,MDColorTable:33447,MDLabName:33448,MDSampleInfo:33449,MDPrepDate:33450,MDPrepTime:33451,MDFileUnits:33452,PixelScale:33550,AdventScale:33589,AdventRevision:33590,UIC1Tag:33628,UIC2Tag:33629,UIC3Tag:33630,UIC4Tag:33631,"IPTC-NAA":33723,IntergraphPacketData:33918,IntergraphFlagRegisters:33919,IntergraphMatrix:33920,INGRReserved:33921,ModelTiePoint:33922,Site:34016,ColorSequence:34017,IT8Header:34018,RasterPadding:34019,BitsPerRunLength:34020,BitsPerExtendedRunLength:34021,ColorTable:34022,ImageColorIndicator:34023,BackgroundColorIndicator:34024,ImageColorValue:34025,BackgroundColorValue:34026,PixelIntensityRange:34027,TransparencyIndicator:34028,ColorCharacterization:34029,HCUsage:34030,TrapIndicator:34031,CMYKEquivalent:34032,SEMInfo:34118,AFCP_IPTC:34152,PixelMagicJBIGOptions:34232,ModelTransform:34264,WB_GRGBLevels:34306,LeafData:34310,PhotoshopSettings:34377,ExifOffset:34665,ICC_Profile:34675,TIFF_FXExtensions:34687,MultiProfiles:34688,SharedData:34689,T88Options:34690,ImageLayer:34732,GeoTiffDirectory:34735,GeoTiffDoubleParams:34736,GeoTiffAsciiParams:34737,ExposureProgram:34850,SpectralSensitivity:34852,GPSInfo:34853,ISO:34855,"Opto-ElectricConvFactor":34856,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,FaxRecvParams:34908,FaxSubAddress:34909,FaxRecvTime:34910,LeafSubIFD:34954,ExifVersion:36864,DateTimeOriginal:36867,CreateDate:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureCompensation:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,SubjectArea:37396,ExposureIndex:37397,"TIFF-EPStandardID":37398,SensingMethod:37399,CIP3DataFile:37434,CIP3Sheet:37435,CIP3Side:37436,StoNits:37439,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,MSDocumentText:37679,MSPropertySetStorage:37680,MSDocumentTextPosition:37681,ImageSourceData:37724,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,FlashpixVersion:40960,ColorSpace:40961,ExifImageWidth:40962,ExifImageHeight:40963,RelatedSoundFile:40964,InteropOffset:40965,SubjectLocation:41492,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFormat:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,OwnerName:42032,SerialNumber:42033,LensInfo:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,GDALMetadata:42112,GDALNoData:42113,Gamma:42240,ExpandSoftware:44992,ExpandLens:44993,ExpandFilm:44994,ExpandFilterLens:44995,ExpandScanner:44996,ExpandFlashLamp:44997,PixelFormat:48129,Transformation:48130,Uncompressed:48131,ImageType:48132,WidthResolution:48258,HeightResolution:48259,ImageOffset:48320,ImageByteCount:48321,AlphaOffset:48322,AlphaByteCount:48323,ImageDataDiscard:48324,AlphaDataDiscard:48325,OceScanjobDesc:50215,OceApplicationSelector:50216,OceIDNumber:50217,OceImageLogic:50218,Annotations:50255,PrintIM:50341,USPTOOriginalContentType:50560,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,DNGLensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,RawImageSegmentation:50752,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,AliasLayerMetadata:50784,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,PanasonicTitle:50898,PanasonicTitle2:50899,CameraCalibrationSig:50931,ProfileCalibrationSig:50932,ProfileIFD:50933,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041,TimeCodes:51043,FrameRate:51044,TStop:51058,ReelName:51081,OriginalDefaultFinalSize:51089,OriginalBestQualitySize:51090,OriginalDefaultCropSize:51091,CameraLabel:51105,ProfileHueSatMapEncoding:51107,ProfileLookTableEncoding:51108,BaselineExposureOffset:51109,DefaultBlackRender:51110,NewRawImageDigest:51111,RawToPreviewGain:51112,DefaultUserCrop:51125,Padding:59932,OffsetSchema:59933,Lens:65002,KDC_IFD:65024,RawFile:65100,Converter:65101,Exposure:65105,Shadows:65106,Brightness:65107,Smoothness:65111,MoireFilter:65112},v0={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},x0={...b0,...v0};function Ny(t,e){return`${t}:${e}`}function Dy(t){const e=t.split(":");if(e.length<2)throw new Error(`Invalid metadata option ID: ${t}`);const r=e.slice(0,-1).join(":"),n=e[e.length-1];return{metadataId:r,key:n}}const Ee={string:{label:"texte",help:"du texte"},boolean:{label:"booléen",help:"vrai ou faux"},integer:{label:"entier",help:"un entier"},float:{label:"nombre",help:"un nombre, potentiellement à virgule"},enum:{label:"énumération",help:"un ensemble de valeur fixes"},date:{label:"date",help:"une date"},location:{label:"localisation",help:"un objet avec deux nombres, `latitude` et `longitude`"},boundingbox:{label:"région d'image",help:"un objet représentant une région rectangulaire au format YOLO"}},vu=I.or(I("'string'","@",Ee.string.help),I("'boolean'","@",Ee.boolean.help),I("'integer'","@",Ee.integer.help),I("'float'","@",Ee.float.help),I("'enum'","@",Ee.enum.help),I("'date'","@",Ee.date.help),I("'location'","@",Ee.location.help),I("'boundingbox'","@",Ee.boundingbox.help)),Le={string:I("string"),boolean:I("boolean"),integer:I("number"),float:I("number"),enum:I("string"),date:I("Date"),location:I({latitude:"number",longitude:"number"}),boundingbox:I({x:"number",y:"number",w:"number",h:"number"})},w0=I.or(Le.string,Le.boolean,Le.integer,Le.float,Le.enum,Le.date,Le.location,Le.boundingbox),Pr=I({value:I("string.json").pipe(t=>{let e=JSON.parse(t);return typeof e=="string"&&(e=g0(e)??e),e},w0),confidence:hs.default(1),manuallyModified:I("boolean").describe("Si la valeur a été modifiée manuellement").default(!1),alternatives:{"[string.json]":hs}}),xu=Pt({ID:ee}).type({"[ID]":Pr}),Qe={min:{label:"Minimum",help:"Choisir la valeur avec la meilleure confiance, et prendre la plus petite valeur en cas d'ambuiguité"},max:{label:"Maximum",help:"Choisir la valeur avec la meilleure confiance, et prendre la plus grande valeur en cas d'ambuiguité"},average:{label:"Moyenne",help:"Prend la moyenne des valeurs"},median:{label:"Médiane",help:"Prend la médiane des valeurs"},union:{label:"Union",help:"Spécifique aux boîtes de recadrage: fusionne les boîtes de recadrage en la plus petite boîte englobant toutes les boîtes"},none:{label:"Aucune",help:"Ne pas fusionner"}},k0=I.or(I('"min"',"@",Qe.min.help),I('"max"',"@",Qe.max.help),I('"average"',"@",Qe.average.help),I('"median"',"@",Qe.median.help),I('"none"',"@",Qe.none.help),I('"union"',"@",Qe.union.help)),wu=I({key:[ee,"@","Identifiant unique pour cette option"],label:["string","@","Nom de l'option, affichable dans une interface utilisateur"],description:["string","@","Description (optionnelle) de cette option"],"image?":Ge,"learnMore?":Ge.describe("Lien pour en savoir plus sur cette option de l'énumération en particulier"),"cascade?":Pt({ID:ee}).type({"[ID]":"ID"}).describe('Objet contenant pour clés des identifiants d\'autres métadonnées, et pour valeurs la valeur à assigner à cette métadonnée si cette option est choisie. Le processus est récursif: Imaginons une métadonnée species ayant une option avec `{ key: "1", cascade: { genus: "2" } }`, une métadonnée genus ayant une option `{ key: "2", cascade: { family: "3" } }`. Si l\'option "1" de la métadonnée species est choisie, la métadonnée genus sera définie sur l\'option "2" et la métadonnée family sera à son tour définie sur l\'option "3".')}),S0=I.enumerated(...Xu(x0)),_0=I({neural:I({model:It.describe("Lien vers le modèle de classification utilisé pour inférer les métadonnées. Au format ONNX (.onnx) seulement, pour le moment."),classmapping:It.describe("Fichier texte contenant une clé de la métadonnée par ligne, dans le même ordre que les neurones de sortie du modèle."),"name?":["string","@","Nom du réseau à afficher dans l'interface. Particulièrement utile si il y a plusieurs réseaux"],input:Zn.describe("Configuration de l'entrée des modèles"),"output?":I({"name?":["string","@","Nom de l'output du modèle à utiliser. output0 par défaut"]})}).array()}).describe("Inférer depuis un modèle de réseau de neurones","self"),P0=I({exif:S0}).describe("Inférer depuis un champ EXIF","self"),Xr=I.or(P0,_0).describe("Comment inférer la valeur de cette métadonnée","self"),ku=I({id:ee.describe("Identifiant unique pour la métadonnée. On conseille de mettre une partie qui vous identifie dans cet identifiant, car il doit être globalement unique. Par exemple, mon-organisation.ma-métadonnée"),label:["string","@","Nom de la métadonnée"],mergeMethod:k0.configure("Méthode utiliser pour fusionner plusieurs différentes valeurs d'une métadonnée. Notamment utilisé pour calculer la valeur d'une métadonnée sur une Observation à partir de ses images","self"),required:["boolean","@","Si la métadonnée est obligatoire"],description:["string","@","Description, pour aider à comprendre la métadonnée"],learnMore:Ge.describe("Un lien pour en apprendre plus sur ce que cette métadonnée décrit").optional(),"options?":wu.array().pipe(t=>Zu(t,e=>e.key)).describe('Les options valides. Uniquement utile pour une métadonnée de type "enum"')}).and(I.or({type:"'location'","infer?":{latitude:Xr,longitude:Xr}},{type:vu.exclude('"location"'),"infer?":Xr}));function Su(t,e){return e=e.replace(/^.+__/,""),`${t}__${e}`}function Ey(t,e){return I0(e,t)?t:Su(e,t)}function I0(t,e){return e.startsWith(`${t}__`)}function C0(t){return t.replace(/^.+__/,"")}function O0(t){const e=t.split("__");if(!(e.length<2))return e.slice(0,-1).join("__")}function Ly(t){return{namespace:O0(t),id:C0(t)}}const _u=I({id:/\d+(_\d+)*/,filename:"string",addedAt:"string.date.iso.parse",dimensions:ei,metadata:xu,contentType:/\w+\/\w+/,fileId:ee.or("null").describe("ID vers l'objet ImageFile associé"),boundingBoxesAnalyzed:"boolean = false",sha1:uu.or("null").default(null)}),Pu=I({id:ee,label:"string",addedAt:"string.date.iso.parse",metadataOverrides:xu,images:Xn});var jt={exports:{}},Ut={exports:{}},pe={},ue={},ys;function ce(){if(ys)return ue;ys=1,ue.__esModule=!0,ue.extend=i,ue.indexOf=f,ue.escapeExpression=d,ue.isEmpty=h,ue.createFrame=p,ue.blockParams=c,ue.appendContextPath=a;var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},e=/[&<>"'`=]/g,r=/[&<>"'`=]/;function n(o){return t[o]}function i(o){for(var g=1;g<arguments.length;g++)for(var m in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],m)&&(o[m]=arguments[g][m]);return o}var s=Object.prototype.toString;ue.toString=s;var l=function(g){return typeof g=="function"};l(/x/)&&(ue.isFunction=l=function(o){return typeof o=="function"&&s.call(o)==="[object Function]"}),ue.isFunction=l;var u=Array.isArray||function(o){return o&&typeof o=="object"?s.call(o)==="[object Array]":!1};ue.isArray=u;function f(o,g){for(var m=0,b=o.length;m<b;m++)if(o[m]===g)return m;return-1}function d(o){if(typeof o!="string"){if(o&&o.toHTML)return o.toHTML();if(o==null)return"";if(!o)return o+"";o=""+o}return r.test(o)?o.replace(e,n):o}function h(o){return!o&&o!==0?!0:!!(u(o)&&o.length===0)}function p(o){var g=i({},o);return g._parent=o,g}function c(o,g){return o.path=g,o}function a(o,g){return(o?o+".":"")+g}return ue}var Ht={exports:{}},bs;function ye(){return bs||(bs=1,(function(t,e){e.__esModule=!0;var r=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function n(i,s){var l=s&&s.loc,u=void 0,f=void 0,d=void 0,h=void 0;l&&(u=l.start.line,f=l.end.line,d=l.start.column,h=l.end.column,i+=" - "+u+":"+d);for(var p=Error.prototype.constructor.call(this,i),c=0;c<r.length;c++)this[r[c]]=p[r[c]];Error.captureStackTrace&&Error.captureStackTrace(this,n);try{l&&(this.lineNumber=u,this.endLineNumber=f,Object.defineProperty?(Object.defineProperty(this,"column",{value:d,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:h,enumerable:!0})):(this.column=d,this.endColumn=h))}catch{}}n.prototype=new Error,e.default=n,t.exports=e.default})(Ht,Ht.exports)),Ht.exports}var gt={},zt={exports:{}},vs;function A0(){return vs||(vs=1,(function(t,e){e.__esModule=!0;var r=ce();e.default=function(n){n.registerHelper("blockHelperMissing",function(i,s){var l=s.inverse,u=s.fn;if(i===!0)return u(this);if(i===!1||i==null)return l(this);if(r.isArray(i))return i.length>0?(s.ids&&(s.ids=[s.name]),n.helpers.each(i,s)):l(this);if(s.data&&s.ids){var f=r.createFrame(s.data);f.contextPath=r.appendContextPath(s.data.contextPath,s.name),s={data:f}}return u(i,s)})},t.exports=e.default})(zt,zt.exports)),zt.exports}var Vt={exports:{}},xs;function M0(){return xs||(xs=1,(function(t,e){e.__esModule=!0;function r(l){return l&&l.__esModule?l:{default:l}}var n=ce(),i=ye(),s=r(i);e.default=function(l){l.registerHelper("each",function(u,f){if(!f)throw new s.default("Must pass iterator to #each");var d=f.fn,h=f.inverse,p=0,c="",a=void 0,o=void 0;f.data&&f.ids&&(o=n.appendContextPath(f.data.contextPath,f.ids[0])+"."),n.isFunction(u)&&(u=u.call(this)),f.data&&(a=n.createFrame(f.data));function g(y,x,k){a&&(a.key=y,a.index=x,a.first=x===0,a.last=!!k,o&&(a.contextPath=o+y)),c=c+d(u[y],{data:a,blockParams:n.blockParams([u[y],y],[o+y,null])})}if(u&&typeof u=="object")if(n.isArray(u))for(var m=u.length;p<m;p++)p in u&&g(p,p,p===u.length-1);else if(typeof Symbol=="function"&&u[Symbol.iterator]){for(var b=[],v=u[Symbol.iterator](),w=v.next();!w.done;w=v.next())b.push(w.value);u=b;for(var m=u.length;p<m;p++)g(p,p,p===u.length-1)}else(function(){var y=void 0;Object.keys(u).forEach(function(x){y!==void 0&&g(y,p-1),y=x,p++}),y!==void 0&&g(y,p-1,!0)})();return p===0&&(c=h(this)),c})},t.exports=e.default})(Vt,Vt.exports)),Vt.exports}var Gt={exports:{}},ws;function N0(){return ws||(ws=1,(function(t,e){e.__esModule=!0;function r(s){return s&&s.__esModule?s:{default:s}}var n=ye(),i=r(n);e.default=function(s){s.registerHelper("helperMissing",function(){if(arguments.length!==1)throw new i.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},t.exports=e.default})(Gt,Gt.exports)),Gt.exports}var Wt={exports:{}},ks;function D0(){return ks||(ks=1,(function(t,e){e.__esModule=!0;function r(l){return l&&l.__esModule?l:{default:l}}var n=ce(),i=ye(),s=r(i);e.default=function(l){l.registerHelper("if",function(u,f){if(arguments.length!=2)throw new s.default("#if requires exactly one argument");return n.isFunction(u)&&(u=u.call(this)),!f.hash.includeZero&&!u||n.isEmpty(u)?f.inverse(this):f.fn(this)}),l.registerHelper("unless",function(u,f){if(arguments.length!=2)throw new s.default("#unless requires exactly one argument");return l.helpers.if.call(this,u,{fn:f.inverse,inverse:f.fn,hash:f.hash})})},t.exports=e.default})(Wt,Wt.exports)),Wt.exports}var Jt={exports:{}},Ss;function E0(){return Ss||(Ss=1,(function(t,e){e.__esModule=!0,e.default=function(r){r.registerHelper("log",function(){for(var n=[void 0],i=arguments[arguments.length-1],s=0;s<arguments.length-1;s++)n.push(arguments[s]);var l=1;i.hash.level!=null?l=i.hash.level:i.data&&i.data.level!=null&&(l=i.data.level),n[0]=l,r.log.apply(r,n)})},t.exports=e.default})(Jt,Jt.exports)),Jt.exports}var Yt={exports:{}},_s;function L0(){return _s||(_s=1,(function(t,e){e.__esModule=!0,e.default=function(r){r.registerHelper("lookup",function(n,i,s){return n&&s.lookupProperty(n,i)})},t.exports=e.default})(Yt,Yt.exports)),Yt.exports}var Qt={exports:{}},Ps;function $0(){return Ps||(Ps=1,(function(t,e){e.__esModule=!0;function r(l){return l&&l.__esModule?l:{default:l}}var n=ce(),i=ye(),s=r(i);e.default=function(l){l.registerHelper("with",function(u,f){if(arguments.length!=2)throw new s.default("#with requires exactly one argument");n.isFunction(u)&&(u=u.call(this));var d=f.fn;if(n.isEmpty(u))return f.inverse(this);var h=f.data;return f.data&&f.ids&&(h=n.createFrame(f.data),h.contextPath=n.appendContextPath(f.data.contextPath,f.ids[0])),d(u,{data:h,blockParams:n.blockParams([u],[h&&h.contextPath])})})},t.exports=e.default})(Qt,Qt.exports)),Qt.exports}var Is;function Iu(){if(Is)return gt;Is=1,gt.__esModule=!0,gt.registerDefaultHelpers=g,gt.moveHelperToHooks=m;function t(b){return b&&b.__esModule?b:{default:b}}var e=A0(),r=t(e),n=M0(),i=t(n),s=N0(),l=t(s),u=D0(),f=t(u),d=E0(),h=t(d),p=L0(),c=t(p),a=$0(),o=t(a);function g(b){r.default(b),i.default(b),l.default(b),f.default(b),h.default(b),c.default(b),o.default(b)}function m(b,v,w){b.helpers[v]&&(b.hooks[v]=b.helpers[v],w||delete b.helpers[v])}return gt}var Xt={},Zt={exports:{}},Cs;function R0(){return Cs||(Cs=1,(function(t,e){e.__esModule=!0;var r=ce();e.default=function(n){n.registerDecorator("inline",function(i,s,l,u){var f=i;return s.partials||(s.partials={},f=function(d,h){var p=l.partials;l.partials=r.extend({},p,s.partials);var c=i(d,h);return l.partials=p,c}),s.partials[u.args[0]]=u.fn,f})},t.exports=e.default})(Zt,Zt.exports)),Zt.exports}var Os;function T0(){if(Os)return Xt;Os=1,Xt.__esModule=!0,Xt.registerDefaultDecorators=n;function t(i){return i&&i.__esModule?i:{default:i}}var e=R0(),r=t(e);function n(i){r.default(i)}return Xt}var er={exports:{}},As;function Cu(){return As||(As=1,(function(t,e){e.__esModule=!0;var r=ce(),n={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(s){if(typeof s=="string"){var l=r.indexOf(n.methodMap,s.toLowerCase());l>=0?s=l:s=parseInt(s,10)}return s},log:function(s){if(s=n.lookupLevel(s),typeof console<"u"&&n.lookupLevel(n.level)<=s){var l=n.methodMap[s];console[l]||(l="log");for(var u=arguments.length,f=Array(u>1?u-1:0),d=1;d<u;d++)f[d-1]=arguments[d];console[l].apply(console,f)}}};e.default=n,t.exports=e.default})(er,er.exports)),er.exports}var Xe={},tr={},Ms;function B0(){if(Ms)return tr;Ms=1,tr.__esModule=!0,tr.createNewLookupObject=e;var t=ce();function e(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return t.extend.apply(void 0,[Object.create(null)].concat(n))}return tr}var Ns;function Ou(){if(Ns)return Xe;Ns=1,Xe.__esModule=!0,Xe.createProtoAccessControl=s,Xe.resultIsAllowed=l,Xe.resetLoggedProperties=d;function t(h){return h&&h.__esModule?h:{default:h}}var e=B0(),r=Cu(),n=t(r),i=Object.create(null);function s(h){var p=Object.create(null);p.constructor=!1,p.__defineGetter__=!1,p.__defineSetter__=!1,p.__lookupGetter__=!1;var c=Object.create(null);return c.__proto__=!1,{properties:{whitelist:e.createNewLookupObject(c,h.allowedProtoProperties),defaultValue:h.allowProtoPropertiesByDefault},methods:{whitelist:e.createNewLookupObject(p,h.allowedProtoMethods),defaultValue:h.allowProtoMethodsByDefault}}}function l(h,p,c){return u(typeof h=="function"?p.methods:p.properties,c)}function u(h,p){return h.whitelist[p]!==void 0?h.whitelist[p]===!0:h.defaultValue!==void 0?h.defaultValue:(f(p),!1)}function f(h){i[h]!==!0&&(i[h]=!0,n.default.log("error",'Handlebars: Access has been denied to resolve the property "'+h+`" because it is not an "own property" of its parent.
You can add a runtime option to disable the check or this warning:
See https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details`))}function d(){Object.keys(i).forEach(function(h){delete i[h]})}return Xe}var Ds;function ni(){if(Ds)return pe;Ds=1,pe.__esModule=!0,pe.HandlebarsEnvironment=o;function t(m){return m&&m.__esModule?m:{default:m}}var e=ce(),r=ye(),n=t(r),i=Iu(),s=T0(),l=Cu(),u=t(l),f=Ou(),d="4.7.8";pe.VERSION=d;var h=8;pe.COMPILER_REVISION=h;var p=7;pe.LAST_COMPATIBLE_COMPILER_REVISION=p;var c={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};pe.REVISION_CHANGES=c;var a="[object Object]";function o(m,b,v){this.helpers=m||{},this.partials=b||{},this.decorators=v||{},i.registerDefaultHelpers(this),s.registerDefaultDecorators(this)}o.prototype={constructor:o,logger:u.default,log:u.default.log,registerHelper:function(b,v){if(e.toString.call(b)===a){if(v)throw new n.default("Arg not supported with multiple helpers");e.extend(this.helpers,b)}else this.helpers[b]=v},unregisterHelper:function(b){delete this.helpers[b]},registerPartial:function(b,v){if(e.toString.call(b)===a)e.extend(this.partials,b);else{if(typeof v>"u")throw new n.default('Attempting to register a partial called "'+b+'" as undefined');this.partials[b]=v}},unregisterPartial:function(b){delete this.partials[b]},registerDecorator:function(b,v){if(e.toString.call(b)===a){if(v)throw new n.default("Arg not supported with multiple decorators");e.extend(this.decorators,b)}else this.decorators[b]=v},unregisterDecorator:function(b){delete this.decorators[b]},resetLoggedPropertyAccesses:function(){f.resetLoggedProperties()}};var g=u.default.log;return pe.log=g,pe.createFrame=e.createFrame,pe.logger=u.default,pe}var rr={exports:{}},Es;function q0(){return Es||(Es=1,(function(t,e){e.__esModule=!0;function r(n){this.string=n}r.prototype.toString=r.prototype.toHTML=function(){return""+this.string},e.default=r,t.exports=e.default})(rr,rr.exports)),rr.exports}var Pe={},nr={},Ls;function F0(){if(Ls)return nr;Ls=1,nr.__esModule=!0,nr.wrapHelper=t;function t(e,r){if(typeof e!="function")return e;var n=function(){var s=arguments[arguments.length-1];return arguments[arguments.length-1]=r(s),e.apply(this,arguments)};return n}return nr}var $s;function K0(){if($s)return Pe;$s=1,Pe.__esModule=!0,Pe.checkRevision=h,Pe.template=p,Pe.wrapProgram=c,Pe.resolvePartial=a,Pe.invokePartial=o,Pe.noop=g;function t(y){return y&&y.__esModule?y:{default:y}}function e(y){if(y&&y.__esModule)return y;var x={};if(y!=null)for(var k in y)Object.prototype.hasOwnProperty.call(y,k)&&(x[k]=y[k]);return x.default=y,x}var r=ce(),n=e(r),i=ye(),s=t(i),l=ni(),u=Iu(),f=F0(),d=Ou();function h(y){var x=y&&y[0]||1,k=l.COMPILER_REVISION;if(!(x>=l.LAST_COMPATIBLE_COMPILER_REVISION&&x<=l.COMPILER_REVISION))if(x<l.LAST_COMPATIBLE_COMPILER_REVISION){var S=l.REVISION_CHANGES[k],O=l.REVISION_CHANGES[x];throw new s.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+S+") or downgrade your runtime to an older version ("+O+").")}else throw new s.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+y[1]+").")}function p(y,x){if(!x)throw new s.default("No environment passed to template");if(!y||!y.main)throw new s.default("Unknown template object: "+typeof y);y.main.decorator=y.main_d,x.VM.checkRevision(y.compiler);var k=y.compiler&&y.compiler[0]===7;function S(C,P,M){M.hash&&(P=n.extend({},P,M.hash),M.ids&&(M.ids[0]=!0)),C=x.VM.resolvePartial.call(this,C,P,M);var $=n.extend({},M,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),V=x.VM.invokePartial.call(this,C,P,$);if(V==null&&x.compile&&(M.partials[M.name]=x.compile(C,y.compilerOptions,x),V=M.partials[M.name](P,$)),V!=null){if(M.indent){for(var ae=V.split(`
`),de=0,ft=ae.length;de<ft&&!(!ae[de]&&de+1===ft);de++)ae[de]=M.indent+ae[de];V=ae.join(`
`)}return V}else throw new s.default("The partial "+M.name+" could not be compiled when running in runtime-only mode")}var O={strict:function(P,M,$){if(!P||!(M in P))throw new s.default('"'+M+'" not defined in '+P,{loc:$});return O.lookupProperty(P,M)},lookupProperty:function(P,M){var $=P[M];if($==null||Object.prototype.hasOwnProperty.call(P,M)||d.resultIsAllowed($,O.protoAccessControl,M))return $},lookup:function(P,M){for(var $=P.length,V=0;V<$;V++){var ae=P[V]&&O.lookupProperty(P[V],M);if(ae!=null)return P[V][M]}},lambda:function(P,M){return typeof P=="function"?P.call(M):P},escapeExpression:n.escapeExpression,invokePartial:S,fn:function(P){var M=y[P];return M.decorator=y[P+"_d"],M},programs:[],program:function(P,M,$,V,ae){var de=this.programs[P],ft=this.fn(P);return M||ae||V||$?de=c(this,P,ft,M,$,V,ae):de||(de=this.programs[P]=c(this,P,ft)),de},data:function(P,M){for(;P&&M--;)P=P._parent;return P},mergeIfNeeded:function(P,M){var $=P||M;return P&&M&&P!==M&&($=n.extend({},M,P)),$},nullContext:Object.seal({}),noop:x.VM.noop,compilerInfo:y.compiler};function L(C){var P=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],M=P.data;L._setup(P),!P.partial&&y.useData&&(M=m(C,M));var $=void 0,V=y.useBlockParams?[]:void 0;y.useDepths&&(P.depths?$=C!=P.depths[0]?[C].concat(P.depths):P.depths:$=[C]);function ae(de){return""+y.main(O,de,O.helpers,O.partials,M,V,$)}return ae=b(y.main,ae,O,P.depths||[],M,V),ae(C,P)}return L.isTop=!0,L._setup=function(C){if(C.partial)O.protoAccessControl=C.protoAccessControl,O.helpers=C.helpers,O.partials=C.partials,O.decorators=C.decorators,O.hooks=C.hooks;else{var P=n.extend({},x.helpers,C.helpers);v(P,O),O.helpers=P,y.usePartial&&(O.partials=O.mergeIfNeeded(C.partials,x.partials)),(y.usePartial||y.useDecorators)&&(O.decorators=n.extend({},x.decorators,C.decorators)),O.hooks={},O.protoAccessControl=d.createProtoAccessControl(C);var M=C.allowCallsToHelperMissing||k;u.moveHelperToHooks(O,"helperMissing",M),u.moveHelperToHooks(O,"blockHelperMissing",M)}},L._child=function(C,P,M,$){if(y.useBlockParams&&!M)throw new s.default("must pass block params");if(y.useDepths&&!$)throw new s.default("must pass parent depths");return c(O,C,y[C],P,0,M,$)},L}function c(y,x,k,S,O,L,C){function P(M){var $=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],V=C;return C&&M!=C[0]&&!(M===y.nullContext&&C[0]===null)&&(V=[M].concat(C)),k(y,M,y.helpers,y.partials,$.data||S,L&&[$.blockParams].concat(L),V)}return P=b(k,P,y,C,S,L),P.program=x,P.depth=C?C.length:0,P.blockParams=O||0,P}function a(y,x,k){return y?!y.call&&!k.name&&(k.name=y,y=k.partials[y]):k.name==="@partial-block"?y=k.data["partial-block"]:y=k.partials[k.name],y}function o(y,x,k){var S=k.data&&k.data["partial-block"];k.partial=!0,k.ids&&(k.data.contextPath=k.ids[0]||k.data.contextPath);var O=void 0;if(k.fn&&k.fn!==g&&(function(){k.data=l.createFrame(k.data);var L=k.fn;O=k.data["partial-block"]=function(P){var M=arguments.length<=1||arguments[1]===void 0?{}:arguments[1];return M.data=l.createFrame(M.data),M.data["partial-block"]=S,L(P,M)},L.partials&&(k.partials=n.extend({},k.partials,L.partials))})(),y===void 0&&O&&(y=O),y===void 0)throw new s.default("The partial "+k.name+" could not be found");if(y instanceof Function)return y(x,k)}function g(){return""}function m(y,x){return(!x||!("root"in x))&&(x=x?l.createFrame(x):{},x.root=y),x}function b(y,x,k,S,O,L){if(y.decorator){var C={};x=y.decorator(x,C,k,S&&S[0],O,L,S),n.extend(x,C)}return x}function v(y,x){Object.keys(y).forEach(function(k){var S=y[k];y[k]=w(S,x)})}function w(y,x){var k=x.lookupProperty;return f.wrapHelper(y,function(S){return n.extend({lookupProperty:k},S)})}return Pe}var ir={exports:{}},Rs;function Au(){return Rs||(Rs=1,(function(t,e){e.__esModule=!0,e.default=function(r){(function(){typeof globalThis!="object"&&(Object.prototype.__defineGetter__("__magic__",function(){return this}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__)})();var n=globalThis.Handlebars;r.noConflict=function(){return globalThis.Handlebars===r&&(globalThis.Handlebars=n),r}},t.exports=e.default})(ir,ir.exports)),ir.exports}var Ts;function j0(){return Ts||(Ts=1,(function(t,e){e.__esModule=!0;function r(v){return v&&v.__esModule?v:{default:v}}function n(v){if(v&&v.__esModule)return v;var w={};if(v!=null)for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(w[y]=v[y]);return w.default=v,w}var i=ni(),s=n(i),l=q0(),u=r(l),f=ye(),d=r(f),h=ce(),p=n(h),c=K0(),a=n(c),o=Au(),g=r(o);function m(){var v=new s.HandlebarsEnvironment;return p.extend(v,s),v.SafeString=u.default,v.Exception=d.default,v.Utils=p,v.escapeExpression=p.escapeExpression,v.VM=a,v.template=function(w){return a.template(w,v)},v}var b=m();b.create=m,g.default(b),b.default=b,e.default=b,t.exports=e.default})(Ut,Ut.exports)),Ut.exports}var sr={exports:{}},Bs;function Mu(){return Bs||(Bs=1,(function(t,e){e.__esModule=!0;var r={helpers:{helperExpression:function(i){return i.type==="SubExpression"||(i.type==="MustacheStatement"||i.type==="BlockStatement")&&!!(i.params&&i.params.length||i.hash)},scopedId:function(i){return/^\.|this\b/.test(i.original)},simpleId:function(i){return i.parts.length===1&&!r.helpers.scopedId(i)&&!i.depth}}};e.default=r,t.exports=e.default})(sr,sr.exports)),sr.exports}var Ze={},or={exports:{}},qs;function U0(){return qs||(qs=1,(function(t,e){e.__esModule=!0;var r=(function(){var n={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(u,f,d,h,p,c,a){var o=c.length-1;switch(p){case 1:return c[o-1];case 2:this.$=h.prepareProgram(c[o]);break;case 3:this.$=c[o];break;case 4:this.$=c[o];break;case 5:this.$=c[o];break;case 6:this.$=c[o];break;case 7:this.$=c[o];break;case 8:this.$=c[o];break;case 9:this.$={type:"CommentStatement",value:h.stripComment(c[o]),strip:h.stripFlags(c[o],c[o]),loc:h.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:c[o],value:c[o],loc:h.locInfo(this._$)};break;case 11:this.$=h.prepareRawBlock(c[o-2],c[o-1],c[o],this._$);break;case 12:this.$={path:c[o-3],params:c[o-2],hash:c[o-1]};break;case 13:this.$=h.prepareBlock(c[o-3],c[o-2],c[o-1],c[o],!1,this._$);break;case 14:this.$=h.prepareBlock(c[o-3],c[o-2],c[o-1],c[o],!0,this._$);break;case 15:this.$={open:c[o-5],path:c[o-4],params:c[o-3],hash:c[o-2],blockParams:c[o-1],strip:h.stripFlags(c[o-5],c[o])};break;case 16:this.$={path:c[o-4],params:c[o-3],hash:c[o-2],blockParams:c[o-1],strip:h.stripFlags(c[o-5],c[o])};break;case 17:this.$={path:c[o-4],params:c[o-3],hash:c[o-2],blockParams:c[o-1],strip:h.stripFlags(c[o-5],c[o])};break;case 18:this.$={strip:h.stripFlags(c[o-1],c[o-1]),program:c[o]};break;case 19:var g=h.prepareBlock(c[o-2],c[o-1],c[o],c[o],!1,this._$),m=h.prepareProgram([g],c[o-1].loc);m.chained=!0,this.$={strip:c[o-2].strip,program:m,chain:!0};break;case 20:this.$=c[o];break;case 21:this.$={path:c[o-1],strip:h.stripFlags(c[o-2],c[o])};break;case 22:this.$=h.prepareMustache(c[o-3],c[o-2],c[o-1],c[o-4],h.stripFlags(c[o-4],c[o]),this._$);break;case 23:this.$=h.prepareMustache(c[o-3],c[o-2],c[o-1],c[o-4],h.stripFlags(c[o-4],c[o]),this._$);break;case 24:this.$={type:"PartialStatement",name:c[o-3],params:c[o-2],hash:c[o-1],indent:"",strip:h.stripFlags(c[o-4],c[o]),loc:h.locInfo(this._$)};break;case 25:this.$=h.preparePartialBlock(c[o-2],c[o-1],c[o],this._$);break;case 26:this.$={path:c[o-3],params:c[o-2],hash:c[o-1],strip:h.stripFlags(c[o-4],c[o])};break;case 27:this.$=c[o];break;case 28:this.$=c[o];break;case 29:this.$={type:"SubExpression",path:c[o-3],params:c[o-2],hash:c[o-1],loc:h.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:c[o],loc:h.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:h.id(c[o-2]),value:c[o],loc:h.locInfo(this._$)};break;case 32:this.$=h.id(c[o-1]);break;case 33:this.$=c[o];break;case 34:this.$=c[o];break;case 35:this.$={type:"StringLiteral",value:c[o],original:c[o],loc:h.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(c[o]),original:Number(c[o]),loc:h.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:c[o]==="true",original:c[o]==="true",loc:h.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:h.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:h.locInfo(this._$)};break;case 40:this.$=c[o];break;case 41:this.$=c[o];break;case 42:this.$=h.preparePath(!0,c[o],this._$);break;case 43:this.$=h.preparePath(!1,c[o],this._$);break;case 44:c[o-2].push({part:h.id(c[o]),original:c[o],separator:c[o-1]}),this.$=c[o-2];break;case 45:this.$=[{part:h.id(c[o]),original:c[o]}];break;case 46:this.$=[];break;case 47:c[o-1].push(c[o]);break;case 48:this.$=[];break;case 49:c[o-1].push(c[o]);break;case 50:this.$=[];break;case 51:c[o-1].push(c[o]);break;case 58:this.$=[];break;case 59:c[o-1].push(c[o]);break;case 64:this.$=[];break;case 65:c[o-1].push(c[o]);break;case 70:this.$=[];break;case 71:c[o-1].push(c[o]);break;case 78:this.$=[];break;case 79:c[o-1].push(c[o]);break;case 82:this.$=[];break;case 83:c[o-1].push(c[o]);break;case 86:this.$=[];break;case 87:c[o-1].push(c[o]);break;case 90:this.$=[];break;case 91:c[o-1].push(c[o]);break;case 94:this.$=[];break;case 95:c[o-1].push(c[o]);break;case 98:this.$=[c[o]];break;case 99:c[o-1].push(c[o]);break;case 100:this.$=[c[o]];break;case 101:c[o-1].push(c[o]);break}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(u,f){throw new Error(u)},parse:function(u){var f=this,d=[0],h=[null],p=[],c=this.table,a="",o=0,g=0;this.lexer.setInput(u),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc>"u"&&(this.lexer.yylloc={});var m=this.lexer.yylloc;p.push(m);var b=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);function v(){var $;return $=f.lexer.lex()||1,typeof $!="number"&&($=f.symbols_[$]||$),$}for(var w,y,x,k,S={},O,L,C,P;;){if(y=d[d.length-1],this.defaultActions[y]?x=this.defaultActions[y]:((w===null||typeof w>"u")&&(w=v()),x=c[y]&&c[y][w]),typeof x>"u"||!x.length||!x[0]){var M="";{P=[];for(O in c[y])this.terminals_[O]&&O>2&&P.push("'"+this.terminals_[O]+"'");this.lexer.showPosition?M="Parse error on line "+(o+1)+`:
`+this.lexer.showPosition()+`
Expecting `+P.join(", ")+", got '"+(this.terminals_[w]||w)+"'":M="Parse error on line "+(o+1)+": Unexpected "+(w==1?"end of input":"'"+(this.terminals_[w]||w)+"'"),this.parseError(M,{text:this.lexer.match,token:this.terminals_[w]||w,line:this.lexer.yylineno,loc:m,expected:P})}}if(x[0]instanceof Array&&x.length>1)throw new Error("Parse Error: multiple actions possible at state: "+y+", token: "+w);switch(x[0]){case 1:d.push(w),h.push(this.lexer.yytext),p.push(this.lexer.yylloc),d.push(x[1]),w=null,g=this.lexer.yyleng,a=this.lexer.yytext,o=this.lexer.yylineno,m=this.lexer.yylloc;break;case 2:if(L=this.productions_[x[1]][1],S.$=h[h.length-L],S._$={first_line:p[p.length-(L||1)].first_line,last_line:p[p.length-1].last_line,first_column:p[p.length-(L||1)].first_column,last_column:p[p.length-1].last_column},b&&(S._$.range=[p[p.length-(L||1)].range[0],p[p.length-1].range[1]]),k=this.performAction.call(S,a,g,o,this.yy,x[1],h,p),typeof k<"u")return k;L&&(d=d.slice(0,-1*L*2),h=h.slice(0,-1*L),p=p.slice(0,-1*L)),d.push(this.productions_[x[1]][0]),h.push(S.$),p.push(S._$),C=c[d[d.length-2]][d[d.length-1]],d.push(C);break;case 3:return!0}}return!0}},i=(function(){var l={EOF:1,parseError:function(f,d){if(this.yy.parser)this.yy.parser.parseError(f,d);else throw new Error(f)},setInput:function(f){return this._input=f,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var f=this._input[0];this.yytext+=f,this.yyleng++,this.offset++,this.match+=f,this.matched+=f;var d=f.match(/(?:\r\n?|\n).*/g);return d?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),f},unput:function(f){var d=f.length,h=f.split(/(?:\r\n?|\n)/g);this._input=f+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-d-1),this.offset-=d;var p=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),h.length-1&&(this.yylineno-=h.length-1);var c=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:h?(h.length===p.length?this.yylloc.first_column:0)+p[p.length-h.length].length-h[0].length:this.yylloc.first_column-d},this.options.ranges&&(this.yylloc.range=[c[0],c[0]+this.yyleng-d]),this},more:function(){return this._more=!0,this},less:function(f){this.unput(this.match.slice(f))},pastInput:function(){var f=this.matched.substr(0,this.matched.length-this.match.length);return(f.length>20?"...":"")+f.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var f=this.match;return f.length<20&&(f+=this._input.substr(0,20-f.length)),(f.substr(0,20)+(f.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var f=this.pastInput(),d=new Array(f.length+1).join("-");return f+this.upcomingInput()+`
`+d+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var f,d,h,p,c;this._more||(this.yytext="",this.match="");for(var a=this._currentRules(),o=0;o<a.length&&(h=this._input.match(this.rules[a[o]]),!(h&&(!d||h[0].length>d[0].length)&&(d=h,p=o,!this.options.flex)));o++);return d?(c=d[0].match(/(?:\r\n?|\n).*/g),c&&(this.yylineno+=c.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+d[0].length},this.yytext+=d[0],this.match+=d[0],this.matches=d,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(d[0].length),this.matched+=d[0],f=this.performAction.call(this,this.yy,this,a[p],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),f||void 0):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var f=this.next();return typeof f<"u"?f:this.lex()},begin:function(f){this.conditionStack.push(f)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(f){this.begin(f)}};return l.options={},l.performAction=function(f,d,h,p){function c(a,o){return d.yytext=d.yytext.substring(a,d.yyleng-o+a)}switch(h){case 0:if(d.yytext.slice(-2)==="\\\\"?(c(0,1),this.begin("mu")):d.yytext.slice(-1)==="\\"?(c(0,1),this.begin("emu")):this.begin("mu"),d.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),this.conditionStack[this.conditionStack.length-1]==="raw"?15:(c(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(d.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return d.yytext=c(1,2).replace(/\\"/g,'"'),80;case 32:return d.yytext=c(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return d.yytext=d.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},l.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],l.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},l})();n.lexer=i;function s(){this.yy={}}return s.prototype=n,n.Parser=s,new s})();e.default=r,t.exports=e.default})(or,or.exports)),or.exports}var ar={exports:{}},ur={exports:{}},Fs;function Nu(){return Fs||(Fs=1,(function(t,e){e.__esModule=!0;function r(d){return d&&d.__esModule?d:{default:d}}var n=ye(),i=r(n);function s(){this.parents=[]}s.prototype={constructor:s,mutating:!1,acceptKey:function(h,p){var c=this.accept(h[p]);if(this.mutating){if(c&&!s.prototype[c.type])throw new i.default('Unexpected node type "'+c.type+'" found when accepting '+p+" on "+h.type);h[p]=c}},acceptRequired:function(h,p){if(this.acceptKey(h,p),!h[p])throw new i.default(h.type+" requires "+p)},acceptArray:function(h){for(var p=0,c=h.length;p<c;p++)this.acceptKey(h,p),h[p]||(h.splice(p,1),p--,c--)},accept:function(h){if(h){if(!this[h.type])throw new i.default("Unknown type: "+h.type,h);this.current&&this.parents.unshift(this.current),this.current=h;var p=this[h.type](h);if(this.current=this.parents.shift(),!this.mutating||p)return p;if(p!==!1)return h}},Program:function(h){this.acceptArray(h.body)},MustacheStatement:l,Decorator:l,BlockStatement:u,DecoratorBlock:u,PartialStatement:f,PartialBlockStatement:function(h){f.call(this,h),this.acceptKey(h,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:l,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(h){this.acceptArray(h.pairs)},HashPair:function(h){this.acceptRequired(h,"value")}};function l(d){this.acceptRequired(d,"path"),this.acceptArray(d.params),this.acceptKey(d,"hash")}function u(d){l.call(this,d),this.acceptKey(d,"program"),this.acceptKey(d,"inverse")}function f(d){this.acceptRequired(d,"name"),this.acceptArray(d.params),this.acceptKey(d,"hash")}e.default=s,t.exports=e.default})(ur,ur.exports)),ur.exports}var Ks;function H0(){return Ks||(Ks=1,(function(t,e){e.__esModule=!0;function r(h){return h&&h.__esModule?h:{default:h}}var n=Nu(),i=r(n);function s(){var h=arguments.length<=0||arguments[0]===void 0?{}:arguments[0];this.options=h}s.prototype=new i.default,s.prototype.Program=function(h){var p=!this.options.ignoreStandalone,c=!this.isRootSeen;this.isRootSeen=!0;for(var a=h.body,o=0,g=a.length;o<g;o++){var m=a[o],b=this.accept(m);if(b){var v=l(a,o,c),w=u(a,o,c),y=b.openStandalone&&v,x=b.closeStandalone&&w,k=b.inlineStandalone&&v&&w;b.close&&f(a,o,!0),b.open&&d(a,o,!0),p&&k&&(f(a,o),d(a,o)&&m.type==="PartialStatement"&&(m.indent=/([ \t]+$)/.exec(a[o-1].original)[1])),p&&y&&(f((m.program||m.inverse).body),d(a,o)),p&&x&&(f(a,o),d((m.inverse||m.program).body))}}return h},s.prototype.BlockStatement=s.prototype.DecoratorBlock=s.prototype.PartialBlockStatement=function(h){this.accept(h.program),this.accept(h.inverse);var p=h.program||h.inverse,c=h.program&&h.inverse,a=c,o=c;if(c&&c.chained)for(a=c.body[0].program;o.chained;)o=o.body[o.body.length-1].program;var g={open:h.openStrip.open,close:h.closeStrip.close,openStandalone:u(p.body),closeStandalone:l((a||p).body)};if(h.openStrip.close&&f(p.body,null,!0),c){var m=h.inverseStrip;m.open&&d(p.body,null,!0),m.close&&f(a.body,null,!0),h.closeStrip.open&&d(o.body,null,!0),!this.options.ignoreStandalone&&l(p.body)&&u(a.body)&&(d(p.body),f(a.body))}else h.closeStrip.open&&d(p.body,null,!0);return g},s.prototype.Decorator=s.prototype.MustacheStatement=function(h){return h.strip},s.prototype.PartialStatement=s.prototype.CommentStatement=function(h){var p=h.strip||{};return{inlineStandalone:!0,open:p.open,close:p.close}};function l(h,p,c){p===void 0&&(p=h.length);var a=h[p-1],o=h[p-2];if(!a)return c;if(a.type==="ContentStatement")return(o||!c?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(a.original)}function u(h,p,c){p===void 0&&(p=-1);var a=h[p+1],o=h[p+2];if(!a)return c;if(a.type==="ContentStatement")return(o||!c?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(a.original)}function f(h,p,c){var a=h[p==null?0:p+1];if(!(!a||a.type!=="ContentStatement"||!c&&a.rightStripped)){var o=a.value;a.value=a.value.replace(c?/^\s+/:/^[ \t]*\r?\n?/,""),a.rightStripped=a.value!==o}}function d(h,p,c){var a=h[p==null?h.length-1:p-1];if(!(!a||a.type!=="ContentStatement"||!c&&a.leftStripped)){var o=a.value;return a.value=a.value.replace(c?/\s+$/:/[ \t]+$/,""),a.leftStripped=a.value!==o,a.leftStripped}}e.default=s,t.exports=e.default})(ar,ar.exports)),ar.exports}var he={},js;function z0(){if(js)return he;js=1,he.__esModule=!0,he.SourceLocation=i,he.id=s,he.stripFlags=l,he.stripComment=u,he.preparePath=f,he.prepareMustache=d,he.prepareRawBlock=h,he.prepareBlock=p,he.prepareProgram=c,he.preparePartialBlock=a;function t(o){return o&&o.__esModule?o:{default:o}}var e=ye(),r=t(e);function n(o,g){if(g=g.path?g.path.original:g,o.path.original!==g){var m={loc:o.path.loc};throw new r.default(o.path.original+" doesn't match "+g,m)}}function i(o,g){this.source=o,this.start={line:g.first_line,column:g.first_column},this.end={line:g.last_line,column:g.last_column}}function s(o){return/^\[.*\]$/.test(o)?o.substring(1,o.length-1):o}function l(o,g){return{open:o.charAt(2)==="~",close:g.charAt(g.length-3)==="~"}}function u(o){return o.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function f(o,g,m){m=this.locInfo(m);for(var b=o?"@":"",v=[],w=0,y=0,x=g.length;y<x;y++){var k=g[y].part,S=g[y].original!==k;if(b+=(g[y].separator||"")+k,!S&&(k===".."||k==="."||k==="this")){if(v.length>0)throw new r.default("Invalid path: "+b,{loc:m});k===".."&&w++}else v.push(k)}return{type:"PathExpression",data:o,depth:w,parts:v,original:b,loc:m}}function d(o,g,m,b,v,w){var y=b.charAt(3)||b.charAt(2),x=y!=="{"&&y!=="&",k=/\*/.test(b);return{type:k?"Decorator":"MustacheStatement",path:o,params:g,hash:m,escaped:x,strip:v,loc:this.locInfo(w)}}function h(o,g,m,b){n(o,m),b=this.locInfo(b);var v={type:"Program",body:g,strip:{},loc:b};return{type:"BlockStatement",path:o.path,params:o.params,hash:o.hash,program:v,openStrip:{},inverseStrip:{},closeStrip:{},loc:b}}function p(o,g,m,b,v,w){b&&b.path&&n(o,b);var y=/\*/.test(o.open);g.blockParams=o.blockParams;var x=void 0,k=void 0;if(m){if(y)throw new r.default("Unexpected inverse block on decorator",m);m.chain&&(m.program.body[0].closeStrip=b.strip),k=m.strip,x=m.program}return v&&(v=x,x=g,g=v),{type:y?"DecoratorBlock":"BlockStatement",path:o.path,params:o.params,hash:o.hash,program:g,inverse:x,openStrip:o.strip,inverseStrip:k,closeStrip:b&&b.strip,loc:this.locInfo(w)}}function c(o,g){if(!g&&o.length){var m=o[0].loc,b=o[o.length-1].loc;m&&b&&(g={source:m.source,start:{line:m.start.line,column:m.start.column},end:{line:b.end.line,column:b.end.column}})}return{type:"Program",body:o,strip:{},loc:g}}function a(o,g,m,b){return n(o,m),{type:"PartialBlockStatement",name:o.path,params:o.params,hash:o.hash,program:g,openStrip:o.strip,closeStrip:m&&m.strip,loc:this.locInfo(b)}}return he}var Us;function V0(){if(Us)return Ze;Us=1,Ze.__esModule=!0,Ze.parseWithoutProcessing=h,Ze.parse=p;function t(c){if(c&&c.__esModule)return c;var a={};if(c!=null)for(var o in c)Object.prototype.hasOwnProperty.call(c,o)&&(a[o]=c[o]);return a.default=c,a}function e(c){return c&&c.__esModule?c:{default:c}}var r=U0(),n=e(r),i=H0(),s=e(i),l=z0(),u=t(l),f=ce();Ze.parser=n.default;var d={};f.extend(d,u);function h(c,a){if(c.type==="Program")return c;n.default.yy=d,d.locInfo=function(g){return new d.SourceLocation(a&&a.srcName,g)};var o=n.default.parse(c);return o}function p(c,a){var o=h(c,a),g=new s.default(a);return g.accept(o)}return Ze}var et={},Hs;function G0(){if(Hs)return et;Hs=1,et.__esModule=!0,et.Compiler=u,et.precompile=f,et.compile=d;function t(c){return c&&c.__esModule?c:{default:c}}var e=ye(),r=t(e),n=ce(),i=Mu(),s=t(i),l=[].slice;function u(){}u.prototype={compiler:u,equals:function(a){var o=this.opcodes.length;if(a.opcodes.length!==o)return!1;for(var g=0;g<o;g++){var m=this.opcodes[g],b=a.opcodes[g];if(m.opcode!==b.opcode||!h(m.args,b.args))return!1}o=this.children.length;for(var g=0;g<o;g++)if(!this.children[g].equals(a.children[g]))return!1;return!0},guid:0,compile:function(a,o){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=o,this.stringParams=o.stringParams,this.trackIds=o.trackIds,o.blockParams=o.blockParams||[],o.knownHelpers=n.extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},o.knownHelpers),this.accept(a)},compileProgram:function(a){var o=new this.compiler,g=o.compile(a,this.options),m=this.guid++;return this.usePartial=this.usePartial||g.usePartial,this.children[m]=g,this.useDepths=this.useDepths||g.useDepths,m},accept:function(a){if(!this[a.type])throw new r.default("Unknown type: "+a.type,a);this.sourceNode.unshift(a);var o=this[a.type](a);return this.sourceNode.shift(),o},Program:function(a){this.options.blockParams.unshift(a.blockParams);for(var o=a.body,g=o.length,m=0;m<g;m++)this.accept(o[m]);return this.options.blockParams.shift(),this.isSimple=g===1,this.blockParams=a.blockParams?a.blockParams.length:0,this},BlockStatement:function(a){p(a);var o=a.program,g=a.inverse;o=o&&this.compileProgram(o),g=g&&this.compileProgram(g);var m=this.classifySexpr(a);m==="helper"?this.helperSexpr(a,o,g):m==="simple"?(this.simpleSexpr(a),this.opcode("pushProgram",o),this.opcode("pushProgram",g),this.opcode("emptyHash"),this.opcode("blockValue",a.path.original)):(this.ambiguousSexpr(a,o,g),this.opcode("pushProgram",o),this.opcode("pushProgram",g),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(a){var o=a.program&&this.compileProgram(a.program),g=this.setupFullMustacheParams(a,o,void 0),m=a.path;this.useDecorators=!0,this.opcode("registerDecorator",g.length,m.original)},PartialStatement:function(a){this.usePartial=!0;var o=a.program;o&&(o=this.compileProgram(a.program));var g=a.params;if(g.length>1)throw new r.default("Unsupported number of partial arguments: "+g.length,a);g.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):g.push({type:"PathExpression",parts:[],depth:0}));var m=a.name.original,b=a.name.type==="SubExpression";b&&this.accept(a.name),this.setupFullMustacheParams(a,o,void 0,!0);var v=a.indent||"";this.options.preventIndent&&v&&(this.opcode("appendContent",v),v=""),this.opcode("invokePartial",b,m,v),this.opcode("append")},PartialBlockStatement:function(a){this.PartialStatement(a)},MustacheStatement:function(a){this.SubExpression(a),a.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(a){this.DecoratorBlock(a)},ContentStatement:function(a){a.value&&this.opcode("appendContent",a.value)},CommentStatement:function(){},SubExpression:function(a){p(a);var o=this.classifySexpr(a);o==="simple"?this.simpleSexpr(a):o==="helper"?this.helperSexpr(a):this.ambiguousSexpr(a)},ambiguousSexpr:function(a,o,g){var m=a.path,b=m.parts[0],v=o!=null||g!=null;this.opcode("getContext",m.depth),this.opcode("pushProgram",o),this.opcode("pushProgram",g),m.strict=!0,this.accept(m),this.opcode("invokeAmbiguous",b,v)},simpleSexpr:function(a){var o=a.path;o.strict=!0,this.accept(o),this.opcode("resolvePossibleLambda")},helperSexpr:function(a,o,g){var m=this.setupFullMustacheParams(a,o,g),b=a.path,v=b.parts[0];if(this.options.knownHelpers[v])this.opcode("invokeKnownHelper",m.length,v);else{if(this.options.knownHelpersOnly)throw new r.default("You specified knownHelpersOnly, but used the unknown helper "+v,a);b.strict=!0,b.falsy=!0,this.accept(b),this.opcode("invokeHelper",m.length,b.original,s.default.helpers.simpleId(b))}},PathExpression:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var o=a.parts[0],g=s.default.helpers.scopedId(a),m=!a.depth&&!g&&this.blockParamIndex(o);m?this.opcode("lookupBlockParam",m,a.parts):o?a.data?(this.options.data=!0,this.opcode("lookupData",a.depth,a.parts,a.strict)):this.opcode("lookupOnContext",a.parts,a.falsy,a.strict,g):this.opcode("pushContext")},StringLiteral:function(a){this.opcode("pushString",a.value)},NumberLiteral:function(a){this.opcode("pushLiteral",a.value)},BooleanLiteral:function(a){this.opcode("pushLiteral",a.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(a){var o=a.pairs,g=0,m=o.length;for(this.opcode("pushHash");g<m;g++)this.pushParam(o[g].value);for(;g--;)this.opcode("assignToHash",o[g].key);this.opcode("popHash")},opcode:function(a){this.opcodes.push({opcode:a,args:l.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(a){a&&(this.useDepths=!0)},classifySexpr:function(a){var o=s.default.helpers.simpleId(a.path),g=o&&!!this.blockParamIndex(a.path.parts[0]),m=!g&&s.default.helpers.helperExpression(a),b=!g&&(m||o);if(b&&!m){var v=a.path.parts[0],w=this.options;w.knownHelpers[v]?m=!0:w.knownHelpersOnly&&(b=!1)}return m?"helper":b?"ambiguous":"simple"},pushParams:function(a){for(var o=0,g=a.length;o<g;o++)this.pushParam(a[o])},pushParam:function(a){var o=a.value!=null?a.value:a.original||"";if(this.stringParams)o.replace&&(o=o.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),a.depth&&this.addDepth(a.depth),this.opcode("getContext",a.depth||0),this.opcode("pushStringParam",o,a.type),a.type==="SubExpression"&&this.accept(a);else{if(this.trackIds){var g=void 0;if(a.parts&&!s.default.helpers.scopedId(a)&&!a.depth&&(g=this.blockParamIndex(a.parts[0])),g){var m=a.parts.slice(1).join(".");this.opcode("pushId","BlockParam",g,m)}else o=a.original||o,o.replace&&(o=o.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",a.type,o)}this.accept(a)}},setupFullMustacheParams:function(a,o,g,m){var b=a.params;return this.pushParams(b),this.opcode("pushProgram",o),this.opcode("pushProgram",g),a.hash?this.accept(a.hash):this.opcode("emptyHash",m),b},blockParamIndex:function(a){for(var o=0,g=this.options.blockParams.length;o<g;o++){var m=this.options.blockParams[o],b=m&&n.indexOf(m,a);if(m&&b>=0)return[o,b]}}};function f(c,a,o){if(c==null||typeof c!="string"&&c.type!=="Program")throw new r.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+c);a=a||{},"data"in a||(a.data=!0),a.compat&&(a.useDepths=!0);var g=o.parse(c,a),m=new o.Compiler().compile(g,a);return new o.JavaScriptCompiler().compile(m,a)}function d(c,a,o){if(a===void 0&&(a={}),c==null||typeof c!="string"&&c.type!=="Program")throw new r.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+c);a=n.extend({},a),"data"in a||(a.data=!0),a.compat&&(a.useDepths=!0);var g=void 0;function m(){var v=o.parse(c,a),w=new o.Compiler().compile(v,a),y=new o.JavaScriptCompiler().compile(w,a,void 0,!0);return o.template(y)}function b(v,w){return g||(g=m()),g.call(this,v,w)}return b._setup=function(v){return g||(g=m()),g._setup(v)},b._child=function(v,w,y,x){return g||(g=m()),g._child(v,w,y,x)},b}function h(c,a){if(c===a)return!0;if(n.isArray(c)&&n.isArray(a)&&c.length===a.length){for(var o=0;o<c.length;o++)if(!h(c[o],a[o]))return!1;return!0}}function p(c){if(!c.path.parts){var a=c.path;c.path={type:"PathExpression",data:!1,depth:0,parts:[a.original+""],original:a.original+"",loc:a.loc}}}return et}var lr={exports:{}},cr={exports:{}},yt={},Zr={},dr={},hr={},zs;function W0(){if(zs)return hr;zs=1;var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return hr.encode=function(e){if(0<=e&&e<t.length)return t[e];throw new TypeError("Must be between 0 and 63: "+e)},hr.decode=function(e){var r=65,n=90,i=97,s=122,l=48,u=57,f=43,d=47,h=26,p=52;return r<=e&&e<=n?e-r:i<=e&&e<=s?e-i+h:l<=e&&e<=u?e-l+p:e==f?62:e==d?63:-1},hr}var Vs;function Du(){if(Vs)return dr;Vs=1;var t=W0(),e=5,r=1<<e,n=r-1,i=r;function s(u){return u<0?(-u<<1)+1:(u<<1)+0}function l(u){var f=(u&1)===1,d=u>>1;return f?-d:d}return dr.encode=function(f){var d="",h,p=s(f);do h=p&n,p>>>=e,p>0&&(h|=i),d+=t.encode(h);while(p>0);return d},dr.decode=function(f,d,h){var p=f.length,c=0,a=0,o,g;do{if(d>=p)throw new Error("Expected more digits in base 64 VLQ value.");if(g=t.decode(f.charCodeAt(d++)),g===-1)throw new Error("Invalid base64 digit: "+f.charAt(d-1));o=!!(g&i),g&=n,c=c+(g<<a),a+=e}while(o);h.value=l(c),h.rest=d},dr}var en={},Gs;function Bt(){return Gs||(Gs=1,(function(t){function e(y,x,k){if(x in y)return y[x];if(arguments.length===3)return k;throw new Error('"'+x+'" is a required argument.')}t.getArg=e;var r=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,n=/^data:.+\,.+$/;function i(y){var x=y.match(r);return x?{scheme:x[1],auth:x[2],host:x[3],port:x[4],path:x[5]}:null}t.urlParse=i;function s(y){var x="";return y.scheme&&(x+=y.scheme+":"),x+="//",y.auth&&(x+=y.auth+"@"),y.host&&(x+=y.host),y.port&&(x+=":"+y.port),y.path&&(x+=y.path),x}t.urlGenerate=s;function l(y){var x=y,k=i(y);if(k){if(!k.path)return y;x=k.path}for(var S=t.isAbsolute(x),O=x.split(/\/+/),L,C=0,P=O.length-1;P>=0;P--)L=O[P],L==="."?O.splice(P,1):L===".."?C++:C>0&&(L===""?(O.splice(P+1,C),C=0):(O.splice(P,2),C--));return x=O.join("/"),x===""&&(x=S?"/":"."),k?(k.path=x,s(k)):x}t.normalize=l;function u(y,x){y===""&&(y="."),x===""&&(x=".");var k=i(x),S=i(y);if(S&&(y=S.path||"/"),k&&!k.scheme)return S&&(k.scheme=S.scheme),s(k);if(k||x.match(n))return x;if(S&&!S.host&&!S.path)return S.host=x,s(S);var O=x.charAt(0)==="/"?x:l(y.replace(/\/+$/,"")+"/"+x);return S?(S.path=O,s(S)):O}t.join=u,t.isAbsolute=function(y){return y.charAt(0)==="/"||r.test(y)};function f(y,x){y===""&&(y="."),y=y.replace(/\/$/,"");for(var k=0;x.indexOf(y+"/")!==0;){var S=y.lastIndexOf("/");if(S<0||(y=y.slice(0,S),y.match(/^([^\/]+:\/)?\/*$/)))return x;++k}return Array(k+1).join("../")+x.substr(y.length+1)}t.relative=f;var d=(function(){var y=Object.create(null);return!("__proto__"in y)})();function h(y){return y}function p(y){return a(y)?"$"+y:y}t.toSetString=d?h:p;function c(y){return a(y)?y.slice(1):y}t.fromSetString=d?h:c;function a(y){if(!y)return!1;var x=y.length;if(x<9||y.charCodeAt(x-1)!==95||y.charCodeAt(x-2)!==95||y.charCodeAt(x-3)!==111||y.charCodeAt(x-4)!==116||y.charCodeAt(x-5)!==111||y.charCodeAt(x-6)!==114||y.charCodeAt(x-7)!==112||y.charCodeAt(x-8)!==95||y.charCodeAt(x-9)!==95)return!1;for(var k=x-10;k>=0;k--)if(y.charCodeAt(k)!==36)return!1;return!0}function o(y,x,k){var S=m(y.source,x.source);return S!==0||(S=y.originalLine-x.originalLine,S!==0)||(S=y.originalColumn-x.originalColumn,S!==0||k)||(S=y.generatedColumn-x.generatedColumn,S!==0)||(S=y.generatedLine-x.generatedLine,S!==0)?S:m(y.name,x.name)}t.compareByOriginalPositions=o;function g(y,x,k){var S=y.generatedLine-x.generatedLine;return S!==0||(S=y.generatedColumn-x.generatedColumn,S!==0||k)||(S=m(y.source,x.source),S!==0)||(S=y.originalLine-x.originalLine,S!==0)||(S=y.originalColumn-x.originalColumn,S!==0)?S:m(y.name,x.name)}t.compareByGeneratedPositionsDeflated=g;function m(y,x){return y===x?0:y===null?1:x===null?-1:y>x?1:-1}function b(y,x){var k=y.generatedLine-x.generatedLine;return k!==0||(k=y.generatedColumn-x.generatedColumn,k!==0)||(k=m(y.source,x.source),k!==0)||(k=y.originalLine-x.originalLine,k!==0)||(k=y.originalColumn-x.originalColumn,k!==0)?k:m(y.name,x.name)}t.compareByGeneratedPositionsInflated=b;function v(y){return JSON.parse(y.replace(/^\)]}'[^\n]*\n/,""))}t.parseSourceMapInput=v;function w(y,x,k){if(x=x||"",y&&(y[y.length-1]!=="/"&&x[0]!=="/"&&(y+="/"),x=y+x),k){var S=i(k);if(!S)throw new Error("sourceMapURL could not be parsed");if(S.path){var O=S.path.lastIndexOf("/");O>=0&&(S.path=S.path.substring(0,O+1))}x=u(s(S),x)}return l(x)}t.computeSourceURL=w})(en)),en}var tn={},Ws;function Eu(){if(Ws)return tn;Ws=1;var t=Bt(),e=Object.prototype.hasOwnProperty,r=typeof Map<"u";function n(){this._array=[],this._set=r?new Map:Object.create(null)}return n.fromArray=function(s,l){for(var u=new n,f=0,d=s.length;f<d;f++)u.add(s[f],l);return u},n.prototype.size=function(){return r?this._set.size:Object.getOwnPropertyNames(this._set).length},n.prototype.add=function(s,l){var u=r?s:t.toSetString(s),f=r?this.has(s):e.call(this._set,u),d=this._array.length;(!f||l)&&this._array.push(s),f||(r?this._set.set(s,d):this._set[u]=d)},n.prototype.has=function(s){if(r)return this._set.has(s);var l=t.toSetString(s);return e.call(this._set,l)},n.prototype.indexOf=function(s){if(r){var l=this._set.get(s);if(l>=0)return l}else{var u=t.toSetString(s);if(e.call(this._set,u))return this._set[u]}throw new Error('"'+s+'" is not in the set.')},n.prototype.at=function(s){if(s>=0&&s<this._array.length)return this._array[s];throw new Error("No element indexed by "+s)},n.prototype.toArray=function(){return this._array.slice()},tn.ArraySet=n,tn}var rn={},Js;function J0(){if(Js)return rn;Js=1;var t=Bt();function e(n,i){var s=n.generatedLine,l=i.generatedLine,u=n.generatedColumn,f=i.generatedColumn;return l>s||l==s&&f>=u||t.compareByGeneratedPositionsInflated(n,i)<=0}function r(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return r.prototype.unsortedForEach=function(i,s){this._array.forEach(i,s)},r.prototype.add=function(i){e(this._last,i)?(this._last=i,this._array.push(i)):(this._sorted=!1,this._array.push(i))},r.prototype.toArray=function(){return this._sorted||(this._array.sort(t.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},rn.MappingList=r,rn}var Ys;function Lu(){if(Ys)return Zr;Ys=1;var t=Du(),e=Bt(),r=Eu().ArraySet,n=J0().MappingList;function i(s){s||(s={}),this._file=e.getArg(s,"file",null),this._sourceRoot=e.getArg(s,"sourceRoot",null),this._skipValidation=e.getArg(s,"skipValidation",!1),this._sources=new r,this._names=new r,this._mappings=new n,this._sourcesContents=null}return i.prototype._version=3,i.fromSourceMap=function(l){var u=l.sourceRoot,f=new i({file:l.file,sourceRoot:u});return l.eachMapping(function(d){var h={generated:{line:d.generatedLine,column:d.generatedColumn}};d.source!=null&&(h.source=d.source,u!=null&&(h.source=e.relative(u,h.source)),h.original={line:d.originalLine,column:d.originalColumn},d.name!=null&&(h.name=d.name)),f.addMapping(h)}),l.sources.forEach(function(d){var h=d;u!==null&&(h=e.relative(u,d)),f._sources.has(h)||f._sources.add(h);var p=l.sourceContentFor(d);p!=null&&f.setSourceContent(d,p)}),f},i.prototype.addMapping=function(l){var u=e.getArg(l,"generated"),f=e.getArg(l,"original",null),d=e.getArg(l,"source",null),h=e.getArg(l,"name",null);this._skipValidation||this._validateMapping(u,f,d,h),d!=null&&(d=String(d),this._sources.has(d)||this._sources.add(d)),h!=null&&(h=String(h),this._names.has(h)||this._names.add(h)),this._mappings.add({generatedLine:u.line,generatedColumn:u.column,originalLine:f!=null&&f.line,originalColumn:f!=null&&f.column,source:d,name:h})},i.prototype.setSourceContent=function(l,u){var f=l;this._sourceRoot!=null&&(f=e.relative(this._sourceRoot,f)),u!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(f)]=u):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(f)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},i.prototype.applySourceMap=function(l,u,f){var d=u;if(u==null){if(l.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);d=l.file}var h=this._sourceRoot;h!=null&&(d=e.relative(h,d));var p=new r,c=new r;this._mappings.unsortedForEach(function(a){if(a.source===d&&a.originalLine!=null){var o=l.originalPositionFor({line:a.originalLine,column:a.originalColumn});o.source!=null&&(a.source=o.source,f!=null&&(a.source=e.join(f,a.source)),h!=null&&(a.source=e.relative(h,a.source)),a.originalLine=o.line,a.originalColumn=o.column,o.name!=null&&(a.name=o.name))}var g=a.source;g!=null&&!p.has(g)&&p.add(g);var m=a.name;m!=null&&!c.has(m)&&c.add(m)},this),this._sources=p,this._names=c,l.sources.forEach(function(a){var o=l.sourceContentFor(a);o!=null&&(f!=null&&(a=e.join(f,a)),h!=null&&(a=e.relative(h,a)),this.setSourceContent(a,o))},this)},i.prototype._validateMapping=function(l,u,f,d){if(u&&typeof u.line!="number"&&typeof u.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(l&&"line"in l&&"column"in l&&l.line>0&&l.column>=0&&!u&&!f&&!d)){if(l&&"line"in l&&"column"in l&&u&&"line"in u&&"column"in u&&l.line>0&&l.column>=0&&u.line>0&&u.column>=0&&f)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:l,source:f,original:u,name:d}))}},i.prototype._serializeMappings=function(){for(var l=0,u=1,f=0,d=0,h=0,p=0,c="",a,o,g,m,b=this._mappings.toArray(),v=0,w=b.length;v<w;v++){if(o=b[v],a="",o.generatedLine!==u)for(l=0;o.generatedLine!==u;)a+=";",u++;else if(v>0){if(!e.compareByGeneratedPositionsInflated(o,b[v-1]))continue;a+=","}a+=t.encode(o.generatedColumn-l),l=o.generatedColumn,o.source!=null&&(m=this._sources.indexOf(o.source),a+=t.encode(m-p),p=m,a+=t.encode(o.originalLine-1-d),d=o.originalLine-1,a+=t.encode(o.originalColumn-f),f=o.originalColumn,o.name!=null&&(g=this._names.indexOf(o.name),a+=t.encode(g-h),h=g)),c+=a}return c},i.prototype._generateSourcesContent=function(l,u){return l.map(function(f){if(!this._sourcesContents)return null;u!=null&&(f=e.relative(u,f));var d=e.toSetString(f);return Object.prototype.hasOwnProperty.call(this._sourcesContents,d)?this._sourcesContents[d]:null},this)},i.prototype.toJSON=function(){var l={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(l.file=this._file),this._sourceRoot!=null&&(l.sourceRoot=this._sourceRoot),this._sourcesContents&&(l.sourcesContent=this._generateSourcesContent(l.sources,l.sourceRoot)),l},i.prototype.toString=function(){return JSON.stringify(this.toJSON())},Zr.SourceMapGenerator=i,Zr}var bt={},nn={},Qs;function Y0(){return Qs||(Qs=1,(function(t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2;function e(r,n,i,s,l,u){var f=Math.floor((n-r)/2)+r,d=l(i,s[f],!0);return d===0?f:d>0?n-f>1?e(f,n,i,s,l,u):u==t.LEAST_UPPER_BOUND?n<s.length?n:-1:f:f-r>1?e(r,f,i,s,l,u):u==t.LEAST_UPPER_BOUND?f:r<0?-1:r}t.search=function(n,i,s,l){if(i.length===0)return-1;var u=e(-1,i.length,n,i,s,l||t.GREATEST_LOWER_BOUND);if(u<0)return-1;for(;u-1>=0&&s(i[u],i[u-1],!0)===0;)--u;return u}})(nn)),nn}var sn={},Xs;function Q0(){if(Xs)return sn;Xs=1;function t(n,i,s){var l=n[i];n[i]=n[s],n[s]=l}function e(n,i){return Math.round(n+Math.random()*(i-n))}function r(n,i,s,l){if(s<l){var u=e(s,l),f=s-1;t(n,u,l);for(var d=n[l],h=s;h<l;h++)i(n[h],d)<=0&&(f+=1,t(n,f,h));t(n,f+1,h);var p=f+1;r(n,i,s,p-1),r(n,i,p+1,l)}}return sn.quickSort=function(n,i){r(n,i,0,n.length-1)},sn}var Zs;function X0(){if(Zs)return bt;Zs=1;var t=Bt(),e=Y0(),r=Eu().ArraySet,n=Du(),i=Q0().quickSort;function s(d,h){var p=d;return typeof d=="string"&&(p=t.parseSourceMapInput(d)),p.sections!=null?new f(p,h):new l(p,h)}s.fromSourceMap=function(d,h){return l.fromSourceMap(d,h)},s.prototype._version=3,s.prototype.__generatedMappings=null,Object.defineProperty(s.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),s.prototype.__originalMappings=null,Object.defineProperty(s.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),s.prototype._charIsMappingSeparator=function(h,p){var c=h.charAt(p);return c===";"||c===","},s.prototype._parseMappings=function(h,p){throw new Error("Subclasses must implement _parseMappings")},s.GENERATED_ORDER=1,s.ORIGINAL_ORDER=2,s.GREATEST_LOWER_BOUND=1,s.LEAST_UPPER_BOUND=2,s.prototype.eachMapping=function(h,p,c){var a=p||null,o=c||s.GENERATED_ORDER,g;switch(o){case s.GENERATED_ORDER:g=this._generatedMappings;break;case s.ORIGINAL_ORDER:g=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var m=this.sourceRoot;g.map(function(b){var v=b.source===null?null:this._sources.at(b.source);return v=t.computeSourceURL(m,v,this._sourceMapURL),{source:v,generatedLine:b.generatedLine,generatedColumn:b.generatedColumn,originalLine:b.originalLine,originalColumn:b.originalColumn,name:b.name===null?null:this._names.at(b.name)}},this).forEach(h,a)},s.prototype.allGeneratedPositionsFor=function(h){var p=t.getArg(h,"line"),c={source:t.getArg(h,"source"),originalLine:p,originalColumn:t.getArg(h,"column",0)};if(c.source=this._findSourceIndex(c.source),c.source<0)return[];var a=[],o=this._findMapping(c,this._originalMappings,"originalLine","originalColumn",t.compareByOriginalPositions,e.LEAST_UPPER_BOUND);if(o>=0){var g=this._originalMappings[o];if(h.column===void 0)for(var m=g.originalLine;g&&g.originalLine===m;)a.push({line:t.getArg(g,"generatedLine",null),column:t.getArg(g,"generatedColumn",null),lastColumn:t.getArg(g,"lastGeneratedColumn",null)}),g=this._originalMappings[++o];else for(var b=g.originalColumn;g&&g.originalLine===p&&g.originalColumn==b;)a.push({line:t.getArg(g,"generatedLine",null),column:t.getArg(g,"generatedColumn",null),lastColumn:t.getArg(g,"lastGeneratedColumn",null)}),g=this._originalMappings[++o]}return a},bt.SourceMapConsumer=s;function l(d,h){var p=d;typeof d=="string"&&(p=t.parseSourceMapInput(d));var c=t.getArg(p,"version"),a=t.getArg(p,"sources"),o=t.getArg(p,"names",[]),g=t.getArg(p,"sourceRoot",null),m=t.getArg(p,"sourcesContent",null),b=t.getArg(p,"mappings"),v=t.getArg(p,"file",null);if(c!=this._version)throw new Error("Unsupported version: "+c);g&&(g=t.normalize(g)),a=a.map(String).map(t.normalize).map(function(w){return g&&t.isAbsolute(g)&&t.isAbsolute(w)?t.relative(g,w):w}),this._names=r.fromArray(o.map(String),!0),this._sources=r.fromArray(a,!0),this._absoluteSources=this._sources.toArray().map(function(w){return t.computeSourceURL(g,w,h)}),this.sourceRoot=g,this.sourcesContent=m,this._mappings=b,this._sourceMapURL=h,this.file=v}l.prototype=Object.create(s.prototype),l.prototype.consumer=s,l.prototype._findSourceIndex=function(d){var h=d;if(this.sourceRoot!=null&&(h=t.relative(this.sourceRoot,h)),this._sources.has(h))return this._sources.indexOf(h);var p;for(p=0;p<this._absoluteSources.length;++p)if(this._absoluteSources[p]==d)return p;return-1},l.fromSourceMap=function(h,p){var c=Object.create(l.prototype),a=c._names=r.fromArray(h._names.toArray(),!0),o=c._sources=r.fromArray(h._sources.toArray(),!0);c.sourceRoot=h._sourceRoot,c.sourcesContent=h._generateSourcesContent(c._sources.toArray(),c.sourceRoot),c.file=h._file,c._sourceMapURL=p,c._absoluteSources=c._sources.toArray().map(function(k){return t.computeSourceURL(c.sourceRoot,k,p)});for(var g=h._mappings.toArray().slice(),m=c.__generatedMappings=[],b=c.__originalMappings=[],v=0,w=g.length;v<w;v++){var y=g[v],x=new u;x.generatedLine=y.generatedLine,x.generatedColumn=y.generatedColumn,y.source&&(x.source=o.indexOf(y.source),x.originalLine=y.originalLine,x.originalColumn=y.originalColumn,y.name&&(x.name=a.indexOf(y.name)),b.push(x)),m.push(x)}return i(c.__originalMappings,t.compareByOriginalPositions),c},l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function u(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}l.prototype._parseMappings=function(h,p){for(var c=1,a=0,o=0,g=0,m=0,b=0,v=h.length,w=0,y={},x={},k=[],S=[],O,L,C,P,M;w<v;)if(h.charAt(w)===";")c++,w++,a=0;else if(h.charAt(w)===",")w++;else{for(O=new u,O.generatedLine=c,P=w;P<v&&!this._charIsMappingSeparator(h,P);P++);if(L=h.slice(w,P),C=y[L],C)w+=L.length;else{for(C=[];w<P;)n.decode(h,w,x),M=x.value,w=x.rest,C.push(M);if(C.length===2)throw new Error("Found a source, but no line and column");if(C.length===3)throw new Error("Found a source and line, but no column");y[L]=C}O.generatedColumn=a+C[0],a=O.generatedColumn,C.length>1&&(O.source=m+C[1],m+=C[1],O.originalLine=o+C[2],o=O.originalLine,O.originalLine+=1,O.originalColumn=g+C[3],g=O.originalColumn,C.length>4&&(O.name=b+C[4],b+=C[4])),S.push(O),typeof O.originalLine=="number"&&k.push(O)}i(S,t.compareByGeneratedPositionsDeflated),this.__generatedMappings=S,i(k,t.compareByOriginalPositions),this.__originalMappings=k},l.prototype._findMapping=function(h,p,c,a,o,g){if(h[c]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+h[c]);if(h[a]<0)throw new TypeError("Column must be greater than or equal to 0, got "+h[a]);return e.search(h,p,o,g)},l.prototype.computeColumnSpans=function(){for(var h=0;h<this._generatedMappings.length;++h){var p=this._generatedMappings[h];if(h+1<this._generatedMappings.length){var c=this._generatedMappings[h+1];if(p.generatedLine===c.generatedLine){p.lastGeneratedColumn=c.generatedColumn-1;continue}}p.lastGeneratedColumn=1/0}},l.prototype.originalPositionFor=function(h){var p={generatedLine:t.getArg(h,"line"),generatedColumn:t.getArg(h,"column")},c=this._findMapping(p,this._generatedMappings,"generatedLine","generatedColumn",t.compareByGeneratedPositionsDeflated,t.getArg(h,"bias",s.GREATEST_LOWER_BOUND));if(c>=0){var a=this._generatedMappings[c];if(a.generatedLine===p.generatedLine){var o=t.getArg(a,"source",null);o!==null&&(o=this._sources.at(o),o=t.computeSourceURL(this.sourceRoot,o,this._sourceMapURL));var g=t.getArg(a,"name",null);return g!==null&&(g=this._names.at(g)),{source:o,line:t.getArg(a,"originalLine",null),column:t.getArg(a,"originalColumn",null),name:g}}}return{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(h){return h==null}):!1},l.prototype.sourceContentFor=function(h,p){if(!this.sourcesContent)return null;var c=this._findSourceIndex(h);if(c>=0)return this.sourcesContent[c];var a=h;this.sourceRoot!=null&&(a=t.relative(this.sourceRoot,a));var o;if(this.sourceRoot!=null&&(o=t.urlParse(this.sourceRoot))){var g=a.replace(/^file:\/\//,"");if(o.scheme=="file"&&this._sources.has(g))return this.sourcesContent[this._sources.indexOf(g)];if((!o.path||o.path=="/")&&this._sources.has("/"+a))return this.sourcesContent[this._sources.indexOf("/"+a)]}if(p)return null;throw new Error('"'+a+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(h){var p=t.getArg(h,"source");if(p=this._findSourceIndex(p),p<0)return{line:null,column:null,lastColumn:null};var c={source:p,originalLine:t.getArg(h,"line"),originalColumn:t.getArg(h,"column")},a=this._findMapping(c,this._originalMappings,"originalLine","originalColumn",t.compareByOriginalPositions,t.getArg(h,"bias",s.GREATEST_LOWER_BOUND));if(a>=0){var o=this._originalMappings[a];if(o.source===c.source)return{line:t.getArg(o,"generatedLine",null),column:t.getArg(o,"generatedColumn",null),lastColumn:t.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},bt.BasicSourceMapConsumer=l;function f(d,h){var p=d;typeof d=="string"&&(p=t.parseSourceMapInput(d));var c=t.getArg(p,"version"),a=t.getArg(p,"sections");if(c!=this._version)throw new Error("Unsupported version: "+c);this._sources=new r,this._names=new r;var o={line:-1,column:0};this._sections=a.map(function(g){if(g.url)throw new Error("Support for url field in sections not implemented.");var m=t.getArg(g,"offset"),b=t.getArg(m,"line"),v=t.getArg(m,"column");if(b<o.line||b===o.line&&v<o.column)throw new Error("Section offsets must be ordered and non-overlapping.");return o=m,{generatedOffset:{generatedLine:b+1,generatedColumn:v+1},consumer:new s(t.getArg(g,"map"),h)}})}return f.prototype=Object.create(s.prototype),f.prototype.constructor=s,f.prototype._version=3,Object.defineProperty(f.prototype,"sources",{get:function(){for(var d=[],h=0;h<this._sections.length;h++)for(var p=0;p<this._sections[h].consumer.sources.length;p++)d.push(this._sections[h].consumer.sources[p]);return d}}),f.prototype.originalPositionFor=function(h){var p={generatedLine:t.getArg(h,"line"),generatedColumn:t.getArg(h,"column")},c=e.search(p,this._sections,function(o,g){var m=o.generatedLine-g.generatedOffset.generatedLine;return m||o.generatedColumn-g.generatedOffset.generatedColumn}),a=this._sections[c];return a?a.consumer.originalPositionFor({line:p.generatedLine-(a.generatedOffset.generatedLine-1),column:p.generatedColumn-(a.generatedOffset.generatedLine===p.generatedLine?a.generatedOffset.generatedColumn-1:0),bias:h.bias}):{source:null,line:null,column:null,name:null}},f.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(h){return h.consumer.hasContentsOfAllSources()})},f.prototype.sourceContentFor=function(h,p){for(var c=0;c<this._sections.length;c++){var a=this._sections[c],o=a.consumer.sourceContentFor(h,!0);if(o)return o}if(p)return null;throw new Error('"'+h+'" is not in the SourceMap.')},f.prototype.generatedPositionFor=function(h){for(var p=0;p<this._sections.length;p++){var c=this._sections[p];if(c.consumer._findSourceIndex(t.getArg(h,"source"))!==-1){var a=c.consumer.generatedPositionFor(h);if(a){var o={line:a.line+(c.generatedOffset.generatedLine-1),column:a.column+(c.generatedOffset.generatedLine===a.line?c.generatedOffset.generatedColumn-1:0)};return o}}}return{line:null,column:null}},f.prototype._parseMappings=function(h,p){this.__generatedMappings=[],this.__originalMappings=[];for(var c=0;c<this._sections.length;c++)for(var a=this._sections[c],o=a.consumer._generatedMappings,g=0;g<o.length;g++){var m=o[g],b=a.consumer._sources.at(m.source);b=t.computeSourceURL(a.consumer.sourceRoot,b,this._sourceMapURL),this._sources.add(b),b=this._sources.indexOf(b);var v=null;m.name&&(v=a.consumer._names.at(m.name),this._names.add(v),v=this._names.indexOf(v));var w={source:b,generatedLine:m.generatedLine+(a.generatedOffset.generatedLine-1),generatedColumn:m.generatedColumn+(a.generatedOffset.generatedLine===m.generatedLine?a.generatedOffset.generatedColumn-1:0),originalLine:m.originalLine,originalColumn:m.originalColumn,name:v};this.__generatedMappings.push(w),typeof w.originalLine=="number"&&this.__originalMappings.push(w)}i(this.__generatedMappings,t.compareByGeneratedPositionsDeflated),i(this.__originalMappings,t.compareByOriginalPositions)},bt.IndexedSourceMapConsumer=f,bt}var on={},eo;function Z0(){if(eo)return on;eo=1;var t=Lu().SourceMapGenerator,e=Bt(),r=/(\r?\n)/,n=10,i="$$$isSourceNode$$$";function s(l,u,f,d,h){this.children=[],this.sourceContents={},this.line=l??null,this.column=u??null,this.source=f??null,this.name=h??null,this[i]=!0,d!=null&&this.add(d)}return s.fromStringWithSourceMap=function(u,f,d){var h=new s,p=u.split(r),c=0,a=function(){var v=y(),w=y()||"";return v+w;function y(){return c<p.length?p[c++]:void 0}},o=1,g=0,m=null;return f.eachMapping(function(v){if(m!==null)if(o<v.generatedLine)b(m,a()),o++,g=0;else{var w=p[c]||"",y=w.substr(0,v.generatedColumn-g);p[c]=w.substr(v.generatedColumn-g),g=v.generatedColumn,b(m,y),m=v;return}for(;o<v.generatedLine;)h.add(a()),o++;if(g<v.generatedColumn){var w=p[c]||"";h.add(w.substr(0,v.generatedColumn)),p[c]=w.substr(v.generatedColumn),g=v.generatedColumn}m=v},this),c<p.length&&(m&&b(m,a()),h.add(p.splice(c).join(""))),f.sources.forEach(function(v){var w=f.sourceContentFor(v);w!=null&&(d!=null&&(v=e.join(d,v)),h.setSourceContent(v,w))}),h;function b(v,w){if(v===null||v.source===void 0)h.add(w);else{var y=d?e.join(d,v.source):v.source;h.add(new s(v.originalLine,v.originalColumn,y,w,v.name))}}},s.prototype.add=function(u){if(Array.isArray(u))u.forEach(function(f){this.add(f)},this);else if(u[i]||typeof u=="string")u&&this.children.push(u);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+u);return this},s.prototype.prepend=function(u){if(Array.isArray(u))for(var f=u.length-1;f>=0;f--)this.prepend(u[f]);else if(u[i]||typeof u=="string")this.children.unshift(u);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+u);return this},s.prototype.walk=function(u){for(var f,d=0,h=this.children.length;d<h;d++)f=this.children[d],f[i]?f.walk(u):f!==""&&u(f,{source:this.source,line:this.line,column:this.column,name:this.name})},s.prototype.join=function(u){var f,d,h=this.children.length;if(h>0){for(f=[],d=0;d<h-1;d++)f.push(this.children[d]),f.push(u);f.push(this.children[d]),this.children=f}return this},s.prototype.replaceRight=function(u,f){var d=this.children[this.children.length-1];return d[i]?d.replaceRight(u,f):typeof d=="string"?this.children[this.children.length-1]=d.replace(u,f):this.children.push("".replace(u,f)),this},s.prototype.setSourceContent=function(u,f){this.sourceContents[e.toSetString(u)]=f},s.prototype.walkSourceContents=function(u){for(var f=0,d=this.children.length;f<d;f++)this.children[f][i]&&this.children[f].walkSourceContents(u);for(var h=Object.keys(this.sourceContents),f=0,d=h.length;f<d;f++)u(e.fromSetString(h[f]),this.sourceContents[h[f]])},s.prototype.toString=function(){var u="";return this.walk(function(f){u+=f}),u},s.prototype.toStringWithSourceMap=function(u){var f={code:"",line:1,column:0},d=new t(u),h=!1,p=null,c=null,a=null,o=null;return this.walk(function(g,m){f.code+=g,m.source!==null&&m.line!==null&&m.column!==null?((p!==m.source||c!==m.line||a!==m.column||o!==m.name)&&d.addMapping({source:m.source,original:{line:m.line,column:m.column},generated:{line:f.line,column:f.column},name:m.name}),p=m.source,c=m.line,a=m.column,o=m.name,h=!0):h&&(d.addMapping({generated:{line:f.line,column:f.column}}),p=null,h=!1);for(var b=0,v=g.length;b<v;b++)g.charCodeAt(b)===n?(f.line++,f.column=0,b+1===v?(p=null,h=!1):h&&d.addMapping({source:m.source,original:{line:m.line,column:m.column},generated:{line:f.line,column:f.column},name:m.name})):f.column++}),this.walkSourceContents(function(g,m){d.setSourceContent(g,m)}),{code:f.code,map:d}},on.SourceNode=s,on}var to;function ey(){return to||(to=1,yt.SourceMapGenerator=Lu().SourceMapGenerator,yt.SourceMapConsumer=X0().SourceMapConsumer,yt.SourceNode=Z0().SourceNode),yt}var ro;function ty(){return ro||(ro=1,(function(t,e){e.__esModule=!0;var r=ce(),n=void 0;try{var i=ey();n=i.SourceNode}catch{}n||(n=function(u,f,d,h){this.src="",h&&this.add(h)},n.prototype={add:function(f){r.isArray(f)&&(f=f.join("")),this.src+=f},prepend:function(f){r.isArray(f)&&(f=f.join("")),this.src=f+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}});function s(u,f,d){if(r.isArray(u)){for(var h=[],p=0,c=u.length;p<c;p++)h.push(f.wrap(u[p],d));return h}else if(typeof u=="boolean"||typeof u=="number")return u+"";return u}function l(u){this.srcFile=u,this.source=[]}l.prototype={isEmpty:function(){return!this.source.length},prepend:function(f,d){this.source.unshift(this.wrap(f,d))},push:function(f,d){this.source.push(this.wrap(f,d))},merge:function(){var f=this.empty();return this.each(function(d){f.add(["  ",d,`
`])}),f},each:function(f){for(var d=0,h=this.source.length;d<h;d++)f(this.source[d])},empty:function(){var f=this.currentLocation||{start:{}};return new n(f.start.line,f.start.column,this.srcFile)},wrap:function(f){var d=arguments.length<=1||arguments[1]===void 0?this.currentLocation||{start:{}}:arguments[1];return f instanceof n?f:(f=s(f,this,d),new n(d.start.line,d.start.column,this.srcFile,f))},functionCall:function(f,d,h){return h=this.generateList(h),this.wrap([f,d?"."+d+"(":"(",h,")"])},quotedString:function(f){return'"'+(f+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(f){var d=this,h=[];Object.keys(f).forEach(function(c){var a=s(f[c],d);a!=="undefined"&&h.push([d.quotedString(c),":",a])});var p=this.generateList(h);return p.prepend("{"),p.add("}"),p},generateList:function(f){for(var d=this.empty(),h=0,p=f.length;h<p;h++)h&&d.add(","),d.add(s(f[h],this));return d},generateArray:function(f){var d=this.generateList(f);return d.prepend("["),d.add("]"),d}},e.default=l,t.exports=e.default})(cr,cr.exports)),cr.exports}var no;function ry(){return no||(no=1,(function(t,e){e.__esModule=!0;function r(c){return c&&c.__esModule?c:{default:c}}var n=ni(),i=ye(),s=r(i),l=ce(),u=ty(),f=r(u);function d(c){this.value=c}function h(){}h.prototype={nameLookup:function(a,o){return this.internalNameLookup(a,o)},depthedLookup:function(a){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(a),")"]},compilerInfo:function(){var a=n.COMPILER_REVISION,o=n.REVISION_CHANGES[a];return[a,o]},appendToBuffer:function(a,o,g){return l.isArray(a)||(a=[a]),a=this.source.wrap(a,o),this.environment.isSimple?["return ",a,";"]:g?["buffer += ",a,";"]:(a.appendToBuffer=!0,a)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(a,o){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",a,",",JSON.stringify(o),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(a,o,g,m){this.environment=a,this.options=o,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!m,this.name=this.environment.name,this.isChild=!!g,this.context=g||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(a,o),this.useDepths=this.useDepths||a.useDepths||a.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||a.useBlockParams;var b=a.opcodes,v=void 0,w=void 0,y=void 0,x=void 0;for(y=0,x=b.length;y<x;y++)v=b[y],this.source.currentLocation=v.loc,w=w||v.loc,this[v.opcode].apply(this,v.args);if(this.source.currentLocation=w,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new s.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),`;
`]),this.decorators.push("return fn;"),m?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend(`function(fn, props, container, depth0, data, blockParams, depths) {
`),this.decorators.push(`}
`),this.decorators=this.decorators.merge()));var k=this.createFunctionContext(m);if(this.isChild)return k;var S={compiler:this.compilerInfo(),main:k};this.decorators&&(S.main_d=this.decorators,S.useDecorators=!0);var O=this.context,L=O.programs,C=O.decorators;for(y=0,x=L.length;y<x;y++)L[y]&&(S[y]=L[y],C[y]&&(S[y+"_d"]=C[y],S.useDecorators=!0));return this.environment.usePartial&&(S.usePartial=!0),this.options.data&&(S.useData=!0),this.useDepths&&(S.useDepths=!0),this.useBlockParams&&(S.useBlockParams=!0),this.options.compat&&(S.compat=!0),m?S.compilerOptions=this.options:(S.compiler=JSON.stringify(S.compiler),this.source.currentLocation={start:{line:1,column:0}},S=this.objectLiteral(S),o.srcName?(S=S.toStringWithSourceMap({file:o.destName}),S.map=S.map&&S.map.toString()):S=S.toString()),S},preamble:function(){this.lastContext=0,this.source=new f.default(this.options.srcName),this.decorators=new f.default(this.options.srcName)},createFunctionContext:function(a){var o=this,g="",m=this.stackVars.concat(this.registers.list);m.length>0&&(g+=", "+m.join(", "));var b=0;Object.keys(this.aliases).forEach(function(y){var x=o.aliases[y];x.children&&x.referenceCount>1&&(g+=", alias"+ ++b+"="+y,x.children[0]="alias"+b)}),this.lookupPropertyFunctionIsUsed&&(g+=", "+this.lookupPropertyFunctionVarDeclaration());var v=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&v.push("blockParams"),this.useDepths&&v.push("depths");var w=this.mergeSource(g);return a?(v.push(w),Function.apply(this,v)):this.source.wrap(["function(",v.join(","),`) {
  `,w,"}"])},mergeSource:function(a){var o=this.environment.isSimple,g=!this.forceBuffer,m=void 0,b=void 0,v=void 0,w=void 0;return this.source.each(function(y){y.appendToBuffer?(v?y.prepend("  + "):v=y,w=y):(v&&(b?v.prepend("buffer += "):m=!0,w.add(";"),v=w=void 0),b=!0,o||(g=!1))}),g?v?(v.prepend("return "),w.add(";")):b||this.source.push('return "";'):(a+=", buffer = "+(m?"":this.initializeBuffer()),v?(v.prepend("return buffer + "),w.add(";")):this.source.push("return buffer;")),a&&this.source.prepend("var "+a.substring(2)+(m?"":`;
`)),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return`
      lookupProperty = container.lookupProperty || function(parent, propertyName) {
        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {
          return parent[propertyName];
        }
        return undefined
    }
    `.trim()},blockValue:function(a){var o=this.aliasable("container.hooks.blockHelperMissing"),g=[this.contextName(0)];this.setupHelperArgs(a,0,g);var m=this.popStack();g.splice(1,0,m),this.push(this.source.functionCall(o,"call",g))},ambiguousBlockValue:function(){var a=this.aliasable("container.hooks.blockHelperMissing"),o=[this.contextName(0)];this.setupHelperArgs("",0,o,!0),this.flushInline();var g=this.topStack();o.splice(1,0,g),this.pushSource(["if (!",this.lastHelper,") { ",g," = ",this.source.functionCall(a,"call",o),"}"])},appendContent:function(a){this.pendingContent?a=this.pendingContent+a:this.pendingLocation=this.source.currentLocation,this.pendingContent=a},append:function(){if(this.isInline())this.replaceStack(function(o){return[" != null ? ",o,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var a=this.popStack();this.pushSource(["if (",a," != null) { ",this.appendToBuffer(a,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(a){this.lastContext=a},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(a,o,g,m){var b=0;!m&&this.options.compat&&!this.lastContext?this.push(this.depthedLookup(a[b++])):this.pushContext(),this.resolvePath("context",a,b,o,g)},lookupBlockParam:function(a,o){this.useBlockParams=!0,this.push(["blockParams[",a[0],"][",a[1],"]"]),this.resolvePath("context",o,1)},lookupData:function(a,o,g){a?this.pushStackLiteral("container.data(data, "+a+")"):this.pushStackLiteral("data"),this.resolvePath("data",o,0,!0,g)},resolvePath:function(a,o,g,m,b){var v=this;if(this.options.strict||this.options.assumeObjects){this.push(p(this.options.strict&&b,this,o,g,a));return}for(var w=o.length;g<w;g++)this.replaceStack(function(y){var x=v.nameLookup(y,o[g],a);return m?[" && ",x]:[" != null ? ",x," : ",y]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(a,o){this.pushContext(),this.pushString(o),o!=="SubExpression"&&(typeof a=="string"?this.pushString(a):this.pushStackLiteral(a))},emptyHash:function(a){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(a?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var a=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(a.ids)),this.stringParams&&(this.push(this.objectLiteral(a.contexts)),this.push(this.objectLiteral(a.types))),this.push(this.objectLiteral(a.values))},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){a!=null?this.pushStackLiteral(this.programExpression(a)):this.pushStackLiteral(null)},registerDecorator:function(a,o){var g=this.nameLookup("decorators",o,"decorator"),m=this.setupHelperArgs(o,a);this.decorators.push(["fn = ",this.decorators.functionCall(g,"",["fn","props","container",m])," || fn;"])},invokeHelper:function(a,o,g){var m=this.popStack(),b=this.setupHelper(a,o),v=[];g&&v.push(b.name),v.push(m),this.options.strict||v.push(this.aliasable("container.hooks.helperMissing"));var w=["(",this.itemsSeparatedBy(v,"||"),")"],y=this.source.functionCall(w,"call",b.callParams);this.push(y)},itemsSeparatedBy:function(a,o){var g=[];g.push(a[0]);for(var m=1;m<a.length;m++)g.push(o,a[m]);return g},invokeKnownHelper:function(a,o){var g=this.setupHelper(a,o);this.push(this.source.functionCall(g.name,"call",g.callParams))},invokeAmbiguous:function(a,o){this.useRegister("helper");var g=this.popStack();this.emptyHash();var m=this.setupHelper(0,a,o),b=this.lastHelper=this.nameLookup("helpers",a,"helper"),v=["(","(helper = ",b," || ",g,")"];this.options.strict||(v[0]="(helper = ",v.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",v,m.paramsInit?["),(",m.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",m.callParams)," : helper))"])},invokePartial:function(a,o,g){var m=[],b=this.setupParams(o,1,m);a&&(o=this.popStack(),delete b.name),g&&(b.indent=JSON.stringify(g)),b.helpers="helpers",b.partials="partials",b.decorators="container.decorators",a?m.unshift(o):m.unshift(this.nameLookup("partials",o,"partial")),this.options.compat&&(b.depths="depths"),b=this.objectLiteral(b),m.push(b),this.push(this.source.functionCall("container.invokePartial","",m))},assignToHash:function(a){var o=this.popStack(),g=void 0,m=void 0,b=void 0;this.trackIds&&(b=this.popStack()),this.stringParams&&(m=this.popStack(),g=this.popStack());var v=this.hash;g&&(v.contexts[a]=g),m&&(v.types[a]=m),b&&(v.ids[a]=b),v.values[a]=o},pushId:function(a,o,g){a==="BlockParam"?this.pushStackLiteral("blockParams["+o[0]+"].path["+o[1]+"]"+(g?" + "+JSON.stringify("."+g):"")):a==="PathExpression"?this.pushString(o):a==="SubExpression"?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:h,compileChildren:function(a,o){for(var g=a.children,m=void 0,b=void 0,v=0,w=g.length;v<w;v++){m=g[v],b=new this.compiler;var y=this.matchExistingProgram(m);if(y==null){this.context.programs.push("");var x=this.context.programs.length;m.index=x,m.name="program"+x,this.context.programs[x]=b.compile(m,o,this.context,!this.precompile),this.context.decorators[x]=b.decorators,this.context.environments[x]=m,this.useDepths=this.useDepths||b.useDepths,this.useBlockParams=this.useBlockParams||b.useBlockParams,m.useDepths=this.useDepths,m.useBlockParams=this.useBlockParams}else m.index=y.index,m.name="program"+y.index,this.useDepths=this.useDepths||y.useDepths,this.useBlockParams=this.useBlockParams||y.useBlockParams}},matchExistingProgram:function(a){for(var o=0,g=this.context.environments.length;o<g;o++){var m=this.context.environments[o];if(m&&m.equals(a))return m}},programExpression:function(a){var o=this.environment.children[a],g=[o.index,"data",o.blockParams];return(this.useBlockParams||this.useDepths)&&g.push("blockParams"),this.useDepths&&g.push("depths"),"container.program("+g.join(", ")+")"},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},push:function(a){return a instanceof d||(a=this.source.wrap(a)),this.inlineStack.push(a),a},pushStackLiteral:function(a){this.push(new d(a))},pushSource:function(a){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),a&&this.source.push(a)},replaceStack:function(a){var o=["("],g=void 0,m=void 0,b=void 0;if(!this.isInline())throw new s.default("replaceStack on non-inline");var v=this.popStack(!0);if(v instanceof d)g=[v.value],o=["(",g],b=!0;else{m=!0;var w=this.incrStack();o=["((",this.push(w)," = ",v,")"],g=this.topStack()}var y=a.call(this,g);b||this.popStack(),m&&this.stackSlot--,this.push(o.concat(y,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;this.inlineStack=[];for(var o=0,g=a.length;o<g;o++){var m=a[o];if(m instanceof d)this.compileStack.push(m);else{var b=this.incrStack();this.pushSource([b," = ",m,";"]),this.compileStack.push(b)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var o=this.isInline(),g=(o?this.inlineStack:this.compileStack).pop();if(!a&&g instanceof d)return g.value;if(!o){if(!this.stackSlot)throw new s.default("Invalid stack pop");this.stackSlot--}return g},topStack:function(){var a=this.isInline()?this.inlineStack:this.compileStack,o=a[a.length-1];return o instanceof d?o.value:o},contextName:function(a){return this.useDepths&&a?"depths["+a+"]":"depth"+a},quotedString:function(a){return this.source.quotedString(a)},objectLiteral:function(a){return this.source.objectLiteral(a)},aliasable:function(a){var o=this.aliases[a];return o?(o.referenceCount++,o):(o=this.aliases[a]=this.source.wrap(a),o.aliasable=!0,o.referenceCount=1,o)},setupHelper:function(a,o,g){var m=[],b=this.setupHelperArgs(o,a,m,g),v=this.nameLookup("helpers",o,"helper"),w=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:m,paramsInit:b,name:v,callParams:[w].concat(m)}},setupParams:function(a,o,g){var m={},b=[],v=[],w=[],y=!g,x=void 0;y&&(g=[]),m.name=this.quotedString(a),m.hash=this.popStack(),this.trackIds&&(m.hashIds=this.popStack()),this.stringParams&&(m.hashTypes=this.popStack(),m.hashContexts=this.popStack());var k=this.popStack(),S=this.popStack();(S||k)&&(m.fn=S||"container.noop",m.inverse=k||"container.noop");for(var O=o;O--;)x=this.popStack(),g[O]=x,this.trackIds&&(w[O]=this.popStack()),this.stringParams&&(v[O]=this.popStack(),b[O]=this.popStack());return y&&(m.args=this.source.generateArray(g)),this.trackIds&&(m.ids=this.source.generateArray(w)),this.stringParams&&(m.types=this.source.generateArray(v),m.contexts=this.source.generateArray(b)),this.options.data&&(m.data="data"),this.useBlockParams&&(m.blockParams="blockParams"),m},setupHelperArgs:function(a,o,g,m){var b=this.setupParams(a,o,g);return b.loc=JSON.stringify(this.source.currentLocation),b=this.objectLiteral(b),m?(this.useRegister("options"),g.push("options"),["options=",b]):g?(g.push(b),""):b}},(function(){for(var c="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),a=h.RESERVED_WORDS={},o=0,g=c.length;o<g;o++)a[c[o]]=!0})(),h.isValidJavaScriptVariableName=function(c){return!h.RESERVED_WORDS[c]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(c)};function p(c,a,o,g,m){var b=a.popStack(),v=o.length;for(c&&v--;g<v;g++)b=a.nameLookup(b,o[g],m);return c?[a.aliasable("container.strict"),"(",b,", ",a.quotedString(o[g]),", ",JSON.stringify(a.source.currentLocation)," )"]:b}e.default=h,t.exports=e.default})(lr,lr.exports)),lr.exports}var io;function ny(){return io||(io=1,(function(t,e){e.__esModule=!0;function r(v){return v&&v.__esModule?v:{default:v}}var n=j0(),i=r(n),s=Mu(),l=r(s),u=V0(),f=G0(),d=ry(),h=r(d),p=Nu(),c=r(p),a=Au(),o=r(a),g=i.default.create;function m(){var v=g();return v.compile=function(w,y){return f.compile(w,y,v)},v.precompile=function(w,y){return f.precompile(w,y,v)},v.AST=l.default,v.Compiler=f.Compiler,v.JavaScriptCompiler=h.default,v.Parser=u.parser,v.parse=u.parse,v.parseWithoutProcessing=u.parseWithoutProcessing,v}var b=m();b.create=m,o.default(b),b.Visitor=c.default,b.default=b,e.default=b,t.exports=e.default})(jt,jt.exports)),jt.exports}var iy=ny();const ii=pl(iy),sy={cx:{help:"Coordonée X du point central"},cy:{help:"Coordonée Y du point central"},sy:{help:"Coordonée Y du point supérieur gauche"},sx:{help:"Coordonée X du point supérieur gauche"},ex:{help:"Coordonée X du point inférieur droit"},ey:{help:"Coordonée Y du point inférieur droit"},w:{help:"Largeur de la boîte englobante"},h:{help:"Hauteur de la boîte englobante"},score:{help:"Score de confiance de cette boîte, entre 0 et 1"},_:{help:"Autre valeur (ignorée par CIGALE)"}},$u=I.or(...el(sy).map(([t,{help:e}])=>I(`"${t}"`).describe(e,"self"))).array(),oy={suffix:{documentation:"Ajoute un suffixe à un nom de fichier, avant l'extension",usage:"{{ suffix 'filename.jpeg' '_example' }} -> 'filename_example.jpeg'",implementation:(t,e)=>{const[r,n]=li(t);return`${r}${e}.${n}`}},extension:{documentation:"Récupère l’extension d’un nom de fichier",usage:"{{ extension 'filename.jpeg' }} -> 'jpeg'",implementation:t=>li(t)[1]},fallback:{documentation:"Fournit une valeur de repli si la première est indéfinie",usage:"{{ fallback obj.does_not_exist 'Unknown' }} -> 'Unknown'",implementation:(t,e)=>t??e}};for(const[t,{implementation:e}]of Object.entries(oy))ii.registerHelper(t,e);const ay=t=>I.string.pipe(e=>{try{return{source:e,template:ii.compile(e,{noEscape:!0,assumeObjects:!0,knownHelpersOnly:!0,knownHelpers:{suffix:!0,extension:!0,fallback:!0}})}}catch(r){throw new Error(`Invalid template ${ao(e)}: ${r}`)}}).pipe(({source:e,template:r})=>({render(n){return n=t.assert(n),r(n)},toJSON:()=>e})),so=I.string.pipe(t=>{try{return{source:t,template:ii.compile(t,{noEscape:!0,assumeObjects:!0,knownHelpersOnly:!0,knownHelpers:{suffix:!0,extension:!0,fallback:!0}})}}catch(e){throw new Error(`Invalid template ${ao(t)}: ${e}`)}}).pipe(({source:t,template:e})=>({render(r){return e(r).replaceAll("\\","/")},toJSON:()=>t})),Ru=I({origin:Ge.describe("URL de l'instance BeamUp d'où proviennent les données")}),Tu=I({id:ee.describe("Identifiant unique pour le protocole. On conseille de mettre une partie qui vous identifie dans cet identifiant, car il doit être globalement unique. Par exemple, mon-organisation.mon-protocole"),dirty:I("boolean").describe("Si le protocole a été modifié depuis sa dernière exportation").default(!1),metadata:Xn,name:["string","@","Nom du protocole"],description:["string","@","Description du protocole"],"learnMore?":Ge.describe("Lien vers un site où l'on peut se renseigner sur ce protocole. Cela peut aussi être simplement un lien de téléchargement direct de ce fichier"),"version?":["number","@","Version actuelle du protocole"],"source?":It.describe(`Requête ou URL devant mener à un fichier JSON contenant la version la plus récente du protocole. Permet de proposer des mises à jour.
		
		Si le champ "version" n'existe pas (que ce soit dans le protocole local ou distant), aucune mise à jour ne sera proposée.`),authors:I({"email?":["string.email","@","Adresse email"],name:["string","@","Prénom Nom"]}).array().describe("Les auteurices ayant participé à l'élaboration du protocole"),"metadataOrder?":I(ee.array()).describe("L'ordre dans lequel les métadonnées doivent être présentées dans l'interface utilisateur. Les métadonnées non listées ici seront affichées après toutes celles listées ici"),"observations?":{"defaultLabel?":ay(I({images:_u.array(),observation:Pu})).describe("Label par défaut pour les observations. Template Handlebars, recevant une liste des images de l'observation à crééer (clé images) et l'observation elle-même (clé observation)")},"beamup?":Ru,crop:I({metadata:[ee,"@","Métadonnée associée à la boîte englobante"],"confirmationMetadata?":[ee,"@","Métadonnée associée au fait que la boîte englobante a été (humainement) confirmée"],padding:I(/^\d+(%|px)$/).describe("Pixels de marge à rajouter autour de la boîte englobante au moment d'exporter les images recadrées. Nombre suivi de 'px' pour un nombre de pixels fixe, ou de '%' pour un pourcentage des dimensions de chaque image.").default("0px"),"infer?":I({"name?":["string","@","Nom du réseau à afficher dans l'interface. Particulièrement utile si il y a plusieurs réseaux"],model:It.describe("Lien vers le modèle de détection utilisé pour inférer les boîtes englobantes. Au format ONNX (.onnx) seulement, pour le moment."),input:Zn.describe("Configuration de l'entrée du modèle"),output:I({"name?":["string","@","Nom de l'output du modèle à utiliser. output0 par défaut"],normalized:["boolean","@","Si les coordonnées des boîtes englobantes sont normalisées par rapport aux dimensions de l'image"],shape:$u.describe("Forme de sortie de chaque boîte englobante. Nécéssite obligatoirement d'avoir 'score'; 2 parmi 'cx', 'sx', 'ex', 'w'; et 2 parmi 'cy', 'sy', 'ey', 'h'. Si les boîtes contiennent d'autre valeurs, bien les mentionner avec '_', même quand c'est à la fin de la liste: cela permet de savoir quand on passe à la boîte suivante. Par exemple, [cx, cy, w, h, score, _] correspond à un modèle YOLO11 COCO")}).describe("Forme de la sortie du modèle de classification. Par exemple, shape: [cx, cy, w, h, score, _] et normalized: true correspond à un modèle YOLO11 COCO")}).array().describe("Configuration de l'inférence des boîtes englobantes")}).describe("Configuration de la partie recadrage"),exports:I({images:I({cropped:so.describe("Chemins des images recadrées"),original:so.describe("Chemins des images originales")}).describe(`Chemins où sauvegarder les images. Vous pouvez utiliser {{observation.metadata.identifiant.value}} pour insérer la valeur d'une métadonnée, {{image.filename}} pour le nom de fichier, {{observation.label}} pour le label (nom) de l'observation, et {{sequence}} pour un numéro d'image, commençant à 1. {{observation.metadata.identifiant.valueLabel}} peut être pratique pour obtenir le label associé au choix d'une métadonnée de type 'enum'. Enfin, il est possible de faire {{suffix image.filename "_exemple"}} pour ajouter "_exemple" à la fin d'un nom de fichier, mais avant son extension (par exemple: {{suffix image.filename "_cropped"}} donnera "IMG_1245_cropped.JPEG" si l'image avait pour nom de fichier "IMG_12345.JPEG"); Vous pouvez faire {{extension image.filename}} pour avoir l'extension d'un fichier, et {{fallback image.metadata.exemple "(Inconnnu)"}} pour utiliser "(Inconnu)" si image.metadata.example n'existe pas. Ce sont enfait des templates Handlebars, en savoir plus: https://handlebarsjs.com/guide/`),metadata:{json:I.string.describe("Chemin du fichier JSON contenant les résultats de l'analyse").pipe(t=>t.replaceAll("\\","/")),csv:I.string.describe("Chemin du fichier CSV contenant les résultats de l'analyse").pipe(t=>t.replaceAll("\\","/"))}}).describe("La structure du fichier .zip d'export pour ce protocole.").optional()}),$y=Tu.omit("metadata","dirty").in.and({metadata:{"[string]":ku.omit("id").describe("Métadonnée du protocole")}}).pipe(t=>({...t,metadata:Object.fromEntries(Object.entries(t.metadata).map(([e,r])=>[Su(t.id,e),r]))}));function uy(t){return t.slice(0,1).toLowerCase()+Math.random().toString(36).slice(2,9)}const Bu=De(["id"],I({id:ee,bytes:"ArrayBuffer",filename:"string",contentType:/\w+\/\w+/,dimensions:ei})),ly=De(["id"],I({id:ee,bytes:"ArrayBuffer",filename:"string",contentType:/\w+\/\w+/,dimensions:ei})),qu=De(["id","addedAt"],_u),Fu=De(["id","addedAt"],Pu),si=De("id",ku.omit("options")),cy=De(["id"],wu.and({id:[/\w+:\w+/,"@","ID of the form metadata_id:key"],metadataId:ee})),Ku=De("id",Tu),dy=De("id",I({id:'"defaults" | "user"',protocols:Xn,theme:I.enumerated("dark","light","auto"),gridSize:I.number.pipe(t=>t===10?1:oo(t,.5,2)),language:I.enumerated("fr","en").default(()=>{try{const t=localStorage.getItem("PARAGLIDE_LOCALE");if(t==="fr"||t==="en")return localStorage.removeItem("PARAGLIDE_LOCALE"),t}catch(t){t instanceof ReferenceError||console.warn("Error migrating from PARAGLIDE_LOCALE ",t)}try{return wm()}catch(t){return console.warn("Error getting navigator.language, defaulting to fr",t),"fr"}}),showInputHints:"boolean",showTechnicalMetadata:"boolean",cropAutoNext:"boolean = false",parallelism:I("number").default(()=>{try{return Math.ceil(navigator.hardwareConcurrency/3)}catch(t){return console.warn("Couldn't get navigator.hardwareConcurrency, defaulting to 1",t),1}}),gallerySort:I({direction:I.enumerated("asc","desc"),key:I.enumerated("filename","date")}).default(()=>({direction:"asc",key:"date"})),beamupPreferences:Pt({ID:ee}).type({"[ID]":{enable:"boolean",email:"string.email | null"}}).default(()=>({})),protocolModelSelections:Pt({ID:ee}).type({"[ID]":{"[ID]":"number.integer >= -1"}}).default(()=>({}))})),hy=De(["id"],I({id:ee,client:{version:"string"},protocol:Ku.pick("id","version").and({beamup:Ru}),metadata:si.pick("id","type"),subject:{"image?":qu.pick("id"),"observation?":Fu.pick("id"),contentHash:uu.or("null")},"file?":Bu.pick("id","filename","contentType","dimensions"),before:Pr,after:Pr,occurredAt:"string.date.iso.parse",email:"string.email | null"})),Ry={MetadataValue:Pr,ModelInput:Zn,ModelDetectionOutputShape:$u,MetadataType:vu,Metadata:si,HTTPRequest:It},fy=["ImageFile","ImagePreviewFile","MetadataOption","BeamupCorrection"];function Ir(t){return fy.every(e=>e!==t)}const ke={Image:qu,ImageFile:Bu,ImagePreviewFile:ly,Observation:Fu,Metadata:si,MetadataOption:cy,Protocol:Ku,Settings:dy,BeamupCorrection:hy};function De(t,e){const r=Array.isArray(t)?t.map(n=>n):[t];return e.configure({table:{indexes:r}})}const Cr=(t,e)=>typeof t=="object"&&"id"in t||typeof e=="object"&&"id"in e?Cr(t.id,e.id):typeof t=="number"&&typeof e=="number"?t-e:typeof t=="number"?-1:typeof e=="number"?1:/^\d+$/.test(t)&&/^\d+$/.test(e)?Number(t)-Number(e):t.localeCompare(e),ju=744,oi=`previews/pr-${ju}`,Uu=4,Mn=Object.keys(ke),ie=Ju({Image:[],Metadata:[],Observation:[],Protocol:[],Settings:[]}),qr={...Object.fromEntries(Mn.filter(Ir).map(t=>[t,py(t)])),async initialize(){for(const t of Mn)Ir(t)&&await qr[t].refresh()}};function py(t){return{get state(){return ie[t]},async refresh(){console.info(`refresh ${t}`),ie[t]=await this.list()},get:async e=>zu(t,e),getFromState:e=>ie[t].find(r=>r.id===e),async set(e){await Nn(t,e);const r=ke[t].assert(e),n=ie[t].findIndex(i=>i.id===e.id);return n!==-1?ie[t][n]=r:(ie[t].push(r),ie[t].sort(Cr)),r},async update(e,r,n){const i=`upd ${t} ${e} ${typeof r=="string"?r:"<Symbol>"} = ${n}`,s=await this.raw.get(e);if(!s)return console.error(`${i}: item not found`),!1;s[r]=n,await Nn(t,s);const l=ie[t].findIndex(u=>u.id===e);return l===-1?(console.debug(`${i}: item not found in reactive state, refetching entire list`),ie[t]=await this.list()):(console.debug(`${i}: updating state @ ${t}[${l}]`),ie[t][l]=ke[t].assert(s)),!0},async add(e){return this.set({...e,id:uy(t)})},async clear(){await Hu(t),ie[t]=[]},async remove(e){await Vu(t,e);const r=ie[t].findIndex(n=>n.id===e);r!==-1?(console.warn(`del ${t} ${e}: not found in reactive state, re-fetching`),ie[t]=await this.list()):delete ie[t][r]},async do(e){const r=`do ${t} #${go()}`;console.debug(r),await Wu([t],{},async n=>{await e(n.objectStore(t))})},list:async()=>ai(t),all:()=>Gu(t),count:async()=>await(await me()).count(t),raw:{async set(e){return await(await me()).put(t,e)},async get(e){return await(await me()).get(t,e)}}}}async function Nn(t,e){const r=await me();return ke[t].assert(e),await r.put(t,e).then(i=>i)}async function Hu(t){await(await me()).clear(t).then(r=>r)}async function zu(t,e){const r=await me(),n=ke[t];return await r.get(t,e).then(i=>i?n.assert(i):void 0)}async function ai(t,e=void 0){const r=await me(),n=ke[t];return await r.getAll(t,e).then(i=>i.map(s=>n.assert(s)).sort(Cr)).then(i=>i)}async function Vu(t,e){return await(await me()).delete(t,e).then(()=>ai(t)).then(n=>{console.debug(`delete ${t} ${e}: objects are now ${n.map(i=>i.id).join(", ")}`)})}async function*Gu(t,e=void 0){const r=await me(),n=ke[t],i=r.transaction(t).store,s=e?i.index(e).iterate():i.iterate();for await(const l of s)yield n.assert(l.value)}function my(t,e,...r){return["idb:/",t,e,...r].filter(Boolean).join("/")}async function Wu(t,{mode:e},r){e??="readwrite";const n=go(8);console.debug(`txn open ${n} tables ${t} mode ${e}`);const s=(await me()).transaction(t,e);s.id=n,await r(s),console.debug(`txn commit ${n} `),await s.done;for(const l of t.filter(Ir))await qr[l].refresh()}function gy(){if(!we)throw new Error("Database not initialized. Call openDatabase() first.");return we}async function me(){if(we)return we;const t=Object.entries(ke);return we=await wl(oi,Uu,{upgrade(e,r){const n=(i,s)=>{if(!s.meta.table)return;const l=s.meta.table.indexes[0],u=e.createObjectStore(i,{keyPath:l});for(const f of s.meta.table.indexes.slice(1))u.createIndex(f,f)};if(r===1)for(const i of e.objectStoreNames)e.deleteObjectStore(i);if(r===2){n("ImagePreviewFile",ke.ImagePreviewFile);return}if(r===3){n("BeamupCorrection",ke.BeamupCorrection);return}for(const[i,s]of t)n(i,s)}}),window.devalue={stringify:fl,parse:dl},window.DB=we,window.refreshDB=()=>{for(const e of Mn)Ir(e)&&qr[e].refresh()},we}function yy(){we&&(we.close(),we=void 0),indexedDB.deleteDatabase(oi)}let we;const Ty=Object.freeze(Object.defineProperty({__proto__:null,_tablesState:ie,clear:Hu,databaseHandle:gy,databaseName:oi,databaseRevision:Uu,dependencyURI:my,drop:Vu,get:zu,iterator:Gu,list:ai,nukeDatabase:yy,openDatabase:me,openTransaction:Wu,previewingPrNumber:ju,set:Nn,tables:qr},Symbol.toStringTag,{value:"Module"}));export{O0 as $,qe as A,Ny as B,Ey as C,pl as D,x0 as E,Ly as F,te as G,oy as H,ee as I,hu as J,Cy as K,ug as L,_0 as M,cg as N,Pm as O,fu as P,Tt as Q,ag as R,Om as S,ke as T,ms as U,gg as V,mg as W,gs as X,Dy as Y,uy as Z,Cr as _,yy as a,Ry as a0,Pr as a1,Le as a2,Tu as a3,My as a4,Qr as a5,pt as a6,mt as a7,Gm as a8,wm as a9,Uu as aa,oi as ab,sy as ac,$c as ad,p0 as ae,$y as af,Ay as ag,Oy as ah,ju as ai,Ty as aj,S0 as b,km as c,my as d,xm as e,go as f,I as g,Vu as h,I0 as i,vm as j,gy as k,ai as l,ky as m,Su as n,Wu as o,Ee as p,_y as q,C0 as r,Nn as s,qr as t,Iy as u,ne as v,Py as w,Sy as x,Qe as y,zu as z};
