const instanceOfAny=(d,m)=>m.some(g=>d instanceof g);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const transactionDoneMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(d){const m=new Promise((g,w)=>{const $=()=>{d.removeEventListener("success",I),d.removeEventListener("error",D)},I=()=>{g(wrap(d.result)),$()},D=()=>{w(d.error),$()};d.addEventListener("success",I),d.addEventListener("error",D)});return reverseTransformCache.set(m,d),m}function cacheDonePromiseForTransaction(d){if(transactionDoneMap.has(d))return;const m=new Promise((g,w)=>{const $=()=>{d.removeEventListener("complete",I),d.removeEventListener("error",D),d.removeEventListener("abort",D)},I=()=>{g(),$()},D=()=>{w(d.error||new DOMException("AbortError","AbortError")),$()};d.addEventListener("complete",I),d.addEventListener("error",D),d.addEventListener("abort",D)});transactionDoneMap.set(d,m)}let idbProxyTraps={get(d,m,g){if(d instanceof IDBTransaction){if(m==="done")return transactionDoneMap.get(d);if(m==="store")return g.objectStoreNames[1]?void 0:g.objectStore(g.objectStoreNames[0])}return wrap(d[m])},set(d,m,g){return d[m]=g,!0},has(d,m){return d instanceof IDBTransaction&&(m==="done"||m==="store")?!0:m in d}};function replaceTraps(d){idbProxyTraps=d(idbProxyTraps)}function wrapFunction(d){return getCursorAdvanceMethods().includes(d)?function(...m){return d.apply(unwrap(this),m),wrap(this.request)}:function(...m){return wrap(d.apply(unwrap(this),m))}}function transformCachableValue(d){return typeof d=="function"?wrapFunction(d):(d instanceof IDBTransaction&&cacheDonePromiseForTransaction(d),instanceOfAny(d,getIdbProxyableTypes())?new Proxy(d,idbProxyTraps):d)}function wrap(d){if(d instanceof IDBRequest)return promisifyRequest(d);if(transformCache.has(d))return transformCache.get(d);const m=transformCachableValue(d);return m!==d&&(transformCache.set(d,m),reverseTransformCache.set(m,d)),m}const unwrap=d=>reverseTransformCache.get(d);function openDB(d,m,{blocked:g,upgrade:w,blocking:$,terminated:I}={}){const D=indexedDB.open(d,m),F=wrap(D);return w&&D.addEventListener("upgradeneeded",U=>{w(wrap(D.result),U.oldVersion,U.newVersion,wrap(D.transaction),U)}),g&&D.addEventListener("blocked",U=>g(U.oldVersion,U.newVersion,U)),F.then(U=>{I&&U.addEventListener("close",()=>I()),$&&U.addEventListener("versionchange",q=>$(q.oldVersion,q.newVersion,q))}).catch(()=>{}),F}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(d,m){if(!(d instanceof IDBDatabase&&!(m in d)&&typeof m=="string"))return;if(cachedMethods.get(m))return cachedMethods.get(m);const g=m.replace(/FromIndex$/,""),w=m!==g,$=writeMethods.includes(g);if(!(g in(w?IDBIndex:IDBObjectStore).prototype)||!($||readMethods.includes(g)))return;const I=async function(D,...F){const U=this.transaction(D,$?"readwrite":"readonly");let q=U.store;return w&&(q=q.index(F.shift())),(await Promise.all([q[g](...F),$&&U.done]))[0]};return cachedMethods.set(m,I),I}replaceTraps(d=>({...d,get:(m,g,w)=>getMethod(m,g)||d.get(m,g,w),has:(m,g)=>!!getMethod(m,g)||d.has(m,g)}));const advanceMethodProps=["continue","continuePrimaryKey","advance"],methodMap={},advanceResults=new WeakMap,ittrProxiedCursorToOriginalProxy=new WeakMap,cursorIteratorTraps={get(d,m){if(!advanceMethodProps.includes(m))return d[m];let g=methodMap[m];return g||(g=methodMap[m]=function(...w){advanceResults.set(this,ittrProxiedCursorToOriginalProxy.get(this)[m](...w))}),g}};async function*iterate$2(...d){let m=this;if(m instanceof IDBCursor||(m=await m.openCursor(...d)),!m)return;m=m;const g=new Proxy(m,cursorIteratorTraps);for(ittrProxiedCursorToOriginalProxy.set(g,m),reverseTransformCache.set(g,unwrap(m));m;)yield g,m=await(advanceResults.get(g)||m.continue()),advanceResults.delete(g)}function isIteratorProp(d,m){return m===Symbol.asyncIterator&&instanceOfAny(d,[IDBIndex,IDBObjectStore,IDBCursor])||m==="iterate"&&instanceOfAny(d,[IDBIndex,IDBObjectStore])}replaceTraps(d=>({...d,get(m,g,w){return isIteratorProp(m,g)?iterate$2:d.get(m,g,w)},has(m,g){return isIteratorProp(m,g)||d.has(m,g)}}));Map.groupBy??=function(m,g){const w=new Map;let $=0;for(const I of m){const D=g(I,$++),F=w.get(D);F?F.push(I):w.set(D,[I])}return w};function createLogger(d,m="debug",g,w){const $=LOG_LEVELS.slice(LOG_LEVELS.indexOf(m));if(w&&g){const I={rqid:w,nid:g};return{debug:$.includes("debug")?logger$1("debug",d,I):()=>{},info:$.includes("info")?logger$1("info",d,I):()=>{},warn:$.includes("warn")?logger$1("warn",d,I):()=>{},error:$.includes("error")?logger$1("error",d,I):()=>{}}}return{debug:$.includes("debug")?logger$1("debug",d,g):()=>{},info:$.includes("info")?logger$1("info",d,g):()=>{},warn:$.includes("warn")?logger$1("warn",d,g):()=>{},error:$.includes("error")?logger$1("error",d,g):()=>{}}}const LOG_LEVELS=["debug","info","warn","error"],PATCHABLE_LOG_METHODS=["debug","info","warn","error","log"];function logger$1(d,m,g){if(g===void 0||typeof g=="string"){const w=g??null;return($,...I)=>log$1(d,m,{nid:w,rqid:$},...I)}return(...w)=>log$1(d,m,g,...w)}const originalConsole=PATCHABLE_LOG_METHODS.reduce((d,m)=>(d[m]=console[m],d),{});function log$1(d,m,{rqid:g,nid:w},...$){const I=[`[SWARPC ${m}]`,g?`%c${g}%c`:"",w?`%c@ ${w}%c`:""].filter(Boolean).join(" "),D=[];return g&&D.push("color: cyan","color: inherit"),w&&D.push("color: hotpink","color: inherit"),originalConsole[d](I,...D,...$)}function injectIntoConsoleGlobal(d,m){for(const g of PATCHABLE_LOG_METHODS)d.self.console[g]=logger$1(g,"server",m)}class MockedWorkerGlobalScope{constructor(){}}const SharedWorkerGlobalScope=globalThis.SharedWorkerGlobalScope??MockedWorkerGlobalScope,DedicatedWorkerGlobalScope=globalThis.DedicatedWorkerGlobalScope??MockedWorkerGlobalScope,ServiceWorkerGlobalScope=globalThis.ServiceWorkerGlobalScope??MockedWorkerGlobalScope;function scopeIsShared(d,m){return d instanceof SharedWorkerGlobalScope||m==="shared"}function scopeIsDedicated(d,m){return d instanceof DedicatedWorkerGlobalScope||m==="dedicated"}function scopeIsService(d,m){return d instanceof ServiceWorkerGlobalScope||m==="service"}function nodeIdFromScope(d,m){return scopeIsDedicated(d,m)||scopeIsShared(d,m)?d.name:"(SW)"}const regex$1=((d,m)=>new RegExp(d,m));Object.assign(regex$1,{cast:regex$1});const liftArray=d=>Array.isArray(d)?d:[d],spliterate=(d,m)=>{const g=[[],[]];for(const w of d)m(w)?g[0].push(w):g[1].push(w);return g},ReadonlyArray=Array,includes=(d,m)=>d.includes(m),range$1=(d,m=0)=>[...new Array(d)].map((g,w)=>w+m),append=(d,m,g)=>d===void 0?m===void 0?[]:Array.isArray(m)?m:[m]:(Array.isArray(m)?d.push(...m):d.push(m),d),conflatenate=(d,m)=>m==null?d??[]:d==null?liftArray(m):d.concat(m),conflatenateAll=(...d)=>d.reduce(conflatenate,[]),appendUnique=(d,m,g)=>{if(d===void 0)return Array.isArray(m)?m:[m];const w=g?.isEqual??(($,I)=>$===I);for(const $ of liftArray(m))d.some(I=>w(I,$))||d.push($);return d},groupBy$1=(d,m)=>d.reduce((g,w)=>{const $=w[m];return g[$]=append(g[$],w),g},{}),arrayEquals=(d,m,g)=>d.length===m.length&&d.every(g?.isEqual?(w,$)=>g.isEqual(w,m[$]):(w,$)=>w===m[$]),hasDomain=(d,m)=>domainOf(d)===m,domainOf=d=>{const m=typeof d;return m==="object"?d===null?"null":"object":m==="function"?"object":m},domainDescriptions={boolean:"boolean",null:"null",undefined:"undefined",bigint:"a bigint",number:"a number",object:"an object",string:"a string",symbol:"a symbol"},jsTypeOfDescriptions={...domainDescriptions,function:"a function"};class InternalArktypeError extends Error{}const throwInternalError=d=>throwError(d,InternalArktypeError),throwError=(d,m=Error)=>{throw new m(d)};class ParseError extends Error{name="ParseError"}const throwParseError=d=>throwError(d,ParseError),noSuggest=d=>` ${d}`,ZeroWidthSpace="â€‹",flatMorph=(d,m)=>{const g={},w=Array.isArray(d);let $=!1;for(const[I,D]of Object.entries(d).entries()){const F=w?m(I,D[1]):m(...D,I);$||=typeof F[0]=="number";const U=Array.isArray(F[0])||F.length===0?F:[F];for(const[q,j]of U)typeof q=="object"?g[q.group]=append(g[q.group],j):g[q]=j}return $?Object.values(g):g},entriesOf=Object.entries,isKeyOf=(d,m)=>d in m,hasKey=(d,m)=>m in d;class DynamicBase{constructor(m){Object.assign(this,m)}}const NoopBase=class{};class CastableBase extends NoopBase{}const splitByKeys=(d,m)=>{const g={},w={};let $;for($ in d)$ in m?g[$]=d[$]:w[$]=d[$];return[g,w]},omit$1=(d,m)=>splitByKeys(d,m)[1],isEmptyObject=d=>Object.keys(d).length===0,stringAndSymbolicEntriesOf=d=>[...Object.entries(d),...Object.getOwnPropertySymbols(d).map(m=>[m,d[m]])],defineProperties=(d,m)=>Object.defineProperties(d,Object.getOwnPropertyDescriptors(m)),withAlphabetizedKeys=d=>{const m=Object.keys(d).sort(),g={};for(let w=0;w<m.length;w++)g[m[w]]=d[m[w]];return g},unset=noSuggest(`unset${ZeroWidthSpace}`),enumValues=d=>Object.values(d).filter(m=>typeof m=="number"?!0:typeof d[m]!="number"),ecmascriptConstructors={Array,Boolean,Date,Error,Function,Map,Number,Promise,RegExp,Set,String,WeakMap,WeakSet},FileConstructor=globalThis.File??Blob,platformConstructors={ArrayBuffer,Blob,File:FileConstructor,FormData,Headers,Request,Response,URL},typedArrayConstructors={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array},builtinConstructors={...ecmascriptConstructors,...platformConstructors,...typedArrayConstructors,String,Number,Boolean},objectKindOf=d=>{let m=Object.getPrototypeOf(d);for(;m?.constructor&&(!isKeyOf(m.constructor.name,builtinConstructors)||!(d instanceof builtinConstructors[m.constructor.name]));)m=Object.getPrototypeOf(m);const g=m?.constructor?.name;if(!(g===void 0||g==="Object"))return g},objectKindOrDomainOf=d=>typeof d=="object"&&d!==null?objectKindOf(d)??"object":domainOf(d),isArray$1=Array.isArray,ecmascriptDescriptions={Array:"an array",Function:"a function",Date:"a Date",RegExp:"a RegExp",Error:"an Error",Map:"a Map",Set:"a Set",String:"a String object",Number:"a Number object",Boolean:"a Boolean object",Promise:"a Promise",WeakMap:"a WeakMap",WeakSet:"a WeakSet"},platformDescriptions={ArrayBuffer:"an ArrayBuffer instance",Blob:"a Blob instance",File:"a File instance",FormData:"a FormData instance",Headers:"a Headers instance",Request:"a Request instance",Response:"a Response instance",URL:"a URL instance"},typedArrayDescriptions={Int8Array:"an Int8Array",Uint8Array:"a Uint8Array",Uint8ClampedArray:"a Uint8ClampedArray",Int16Array:"an Int16Array",Uint16Array:"a Uint16Array",Int32Array:"an Int32Array",Uint32Array:"a Uint32Array",Float32Array:"a Float32Array",Float64Array:"a Float64Array",BigInt64Array:"a BigInt64Array",BigUint64Array:"a BigUint64Array"},objectKindDescriptions={...ecmascriptDescriptions,...platformDescriptions,...typedArrayDescriptions},getBuiltinNameOfConstructor=d=>{const m=Object(d).name??null;return m&&isKeyOf(m,builtinConstructors)&&builtinConstructors[m]===d?m:null},constructorExtends=(d,m)=>{let g=d.prototype;for(;g!==null;){if(g===m.prototype)return!0;g=Object.getPrototypeOf(g)}return!1},deepClone=d=>_clone(d,new Map),_clone=(d,m)=>{if(typeof d!="object"||d===null)return d;if(m?.has(d))return m.get(d);const g=getBuiltinNameOfConstructor(d.constructor);if(g==="Date")return new Date(d.getTime());if(g&&g!=="Array")return d;const w=Array.isArray(d)?d.slice():Object.create(Object.getPrototypeOf(d)),$=Object.getOwnPropertyDescriptors(d);if(m){m.set(d,w);for(const I in $){const D=$[I];"get"in D||"set"in D||(D.value=_clone(D.value,m))}}return Object.defineProperties(w,$),w},cached=d=>{let m=unset;return()=>m===unset?m=d():m},isThunk=d=>typeof d=="function"&&d.length===0,DynamicFunction=class extends Function{constructor(...d){const m=d.slice(0,-1),g=d.at(-1);try{super(...m,g)}catch(w){return throwInternalError(`Encountered an unexpected error while compiling your definition:
                Message: ${w} 
                Source: (${d.slice(0,-1)}) => {
                    ${d.at(-1)}
                }`)}}};class Callable{constructor(m,...[g]){return Object.assign(Object.setPrototypeOf(m.bind(g?.bind??this),this.constructor.prototype),g?.attach)}}const envHasCsp=cached(()=>{try{return new Function("return false")()}catch{return!0}});class Hkt{constructor(){}}var define_globalThis_process_env_default={};const fileName=()=>{try{return((new Error().stack?.split(`
`)[2]?.trim()||"").match(/\(?(.+?)(?::\d+:\d+)?\)?$/)?.[1]||"unknown").replace(/^file:\/\//,"")}catch{return"unknown"}},env=define_globalThis_process_env_default??{},isomorphic={fileName,env},capitalize$1=d=>d[0].toUpperCase()+d.slice(1),anchoredRegex=d=>new RegExp(anchoredSource(d),typeof d=="string"?"":d.flags),anchoredSource=d=>`^(?:${typeof d=="string"?d:d.source})$`,RegexPatterns={negativeLookahead:d=>`(?!${d})`,nonCapturingGroup:d=>`(?:${d})`},Backslash="\\",whitespaceChars={" ":1,"\n":1,"	":1},anchoredNegativeZeroPattern=/^-0\.?0*$/.source,positiveIntegerPattern=/[1-9]\d*/.source,looseDecimalPattern=/\.\d+/.source,strictDecimalPattern=/\.\d*[1-9]/.source,createNumberMatcher=d=>anchoredRegex(RegexPatterns.negativeLookahead(anchoredNegativeZeroPattern)+RegexPatterns.nonCapturingGroup("-?"+RegexPatterns.nonCapturingGroup(RegexPatterns.nonCapturingGroup("0|"+positiveIntegerPattern)+RegexPatterns.nonCapturingGroup(d.decimalPattern)+"?")+(d.allowDecimalOnly?"|"+d.decimalPattern:"")+"?")),wellFormedNumberMatcher=createNumberMatcher({decimalPattern:strictDecimalPattern,allowDecimalOnly:!1}),isWellFormedNumber=wellFormedNumberMatcher.test.bind(wellFormedNumberMatcher),numericStringMatcher=createNumberMatcher({decimalPattern:looseDecimalPattern,allowDecimalOnly:!0});numericStringMatcher.test.bind(numericStringMatcher);const numberLikeMatcher=/^-?\d*\.?\d*$/,isNumberLike=d=>d.length!==0&&numberLikeMatcher.test(d),wellFormedIntegerMatcher=anchoredRegex(RegexPatterns.negativeLookahead("^-0$")+"-?"+RegexPatterns.nonCapturingGroup(RegexPatterns.nonCapturingGroup("0|"+positiveIntegerPattern))),isWellFormedInteger=wellFormedIntegerMatcher.test.bind(wellFormedIntegerMatcher),integerLikeMatcher=/^-?\d+$/,isIntegerLike=integerLikeMatcher.test.bind(integerLikeMatcher),numericLiteralDescriptions={number:"a number",bigint:"a bigint",integer:"an integer"},writeMalformedNumericLiteralMessage=(d,m)=>`'${d}' was parsed as ${numericLiteralDescriptions[m]} but could not be narrowed to a literal value. Avoid unnecessary leading or trailing zeros and other abnormal notation`,isWellFormed=(d,m)=>m==="number"?isWellFormedNumber(d):isWellFormedInteger(d),parseKind=(d,m)=>m==="number"?Number(d):Number.parseInt(d),isKindLike=(d,m)=>m==="number"?isNumberLike(d):isIntegerLike(d),tryParseNumber=(d,m)=>parseNumeric(d,"number",m),tryParseWellFormedNumber=(d,m)=>parseNumeric(d,"number",{...m,strict:!0}),tryParseInteger=(d,m)=>parseNumeric(d,"integer",m),parseNumeric=(d,m,g)=>{const w=parseKind(d,m);return!Number.isNaN(w)&&isKindLike(d,m)?g?.strict?isWellFormed(d,m)?w:throwParseError(writeMalformedNumericLiteralMessage(d,m)):w:g?.errorOnFail?throwParseError(g?.errorOnFail===!0?`Failed to parse ${numericLiteralDescriptions[m]} from '${d}'`:g?.errorOnFail):void 0},tryParseWellFormedBigint=d=>{if(d[d.length-1]!=="n")return;const m=d.slice(0,-1);let g;try{g=BigInt(m)}catch{return}if(wellFormedIntegerMatcher.test(m))return g;if(integerLikeMatcher.test(m))return throwParseError(writeMalformedNumericLiteralMessage(d,"bigint"))},arkUtilVersion="0.50.0",initialRegistryContents={version:arkUtilVersion,filename:isomorphic.fileName(),FileConstructor},registry=initialRegistryContents,namesByResolution=new Map,nameCounts=Object.create(null),register=d=>{const m=namesByResolution.get(d);if(m)return m;let g=baseNameFor(d);return nameCounts[g]?g=`${g}${nameCounts[g]++}`:nameCounts[g]=1,registry[g]=d,namesByResolution.set(d,g),g},isDotAccessible=d=>/^[$A-Z_a-z][\w$]*$/.test(d),baseNameFor=d=>{switch(typeof d){case"object":{if(d===null)break;const m=objectKindOf(d)??"object";return m[0].toLowerCase()+m.slice(1)}case"function":return isDotAccessible(d.name)?d.name:"fn";case"symbol":return d.description&&isDotAccessible(d.description)?d.description:"symbol"}return throwInternalError(`Unexpected attempt to register serializable value of type ${domainOf(d)}`)},serializePrimitive=d=>typeof d=="string"?JSON.stringify(d):typeof d=="bigint"?`${d}n`:`${d}`,snapshot$1=(d,m={})=>_serialize(d,{onUndefined:"$ark.undefined",onBigInt:g=>`$ark.bigint-${g}`,...m},[]),printable=(d,m)=>{switch(domainOf(d)){case"object":const g=d,w=g.constructor.name;return w==="Object"||w==="Array"?m?.quoteKeys===!1?stringifyUnquoted(g,m?.indent??0,""):JSON.stringify(_serialize(g,printableOpts,[]),null,m?.indent):stringifyUnquoted(g,m?.indent??0,"");case"symbol":return printableOpts.onSymbol(d);default:return serializePrimitive(d)}},stringifyUnquoted=(d,m,g)=>{if(typeof d=="function")return printableOpts.onFunction(d);if(typeof d!="object"||d===null)return serializePrimitive(d);const w=g+" ".repeat(m);if(Array.isArray(d)){if(d.length===0)return"[]";const I=d.map(D=>stringifyUnquoted(D,m,w)).join(`,
`+w);return m?`[
${w}${I}
${g}]`:`[${I}]`}const $=d.constructor.name;if($==="Object"){const I=stringAndSymbolicEntriesOf(d).map(([D,F])=>{const U=typeof D=="symbol"?printableOpts.onSymbol(D):isDotAccessible(D)?D:JSON.stringify(D),q=stringifyUnquoted(F,m,w);return`${w}${U}: ${q}`});return I.length===0?"{}":m?`{
${I.join(`,
`)}
${g}}`:`{${I.join(", ")}}`}return d instanceof Date?describeCollapsibleDate(d):"expression"in d&&typeof d.expression=="string"?d.expression:$},printableOpts={onCycle:()=>"(cycle)",onSymbol:d=>`Symbol(${register(d)})`,onFunction:d=>`Function(${register(d)})`},_serialize=(d,m,g)=>{switch(domainOf(d)){case"object":{const w=d;if("toJSON"in w&&typeof w.toJSON=="function")return w.toJSON();if(typeof w=="function")return printableOpts.onFunction(w);if(g.includes(w))return"(cycle)";const $=[...g,w];if(Array.isArray(w))return w.map(D=>_serialize(D,m,$));if(w instanceof Date)return w.toDateString();const I={};for(const D in w)I[D]=_serialize(w[D],m,$);for(const D of Object.getOwnPropertySymbols(w))I[m.onSymbol?.(D)??D.toString()]=_serialize(w[D],m,$);return I}case"symbol":return printableOpts.onSymbol(d);case"bigint":return m.onBigInt?.(d)??`${d}n`;case"undefined":return m.onUndefined??"undefined";case"string":return d.replaceAll("\\","\\\\");default:return d}},describeCollapsibleDate=d=>{const m=d.getFullYear(),g=d.getMonth(),w=d.getDate(),$=d.getHours(),I=d.getMinutes(),D=d.getSeconds(),F=d.getMilliseconds();if(g===0&&w===1&&$===0&&I===0&&D===0&&F===0)return`${m}`;const U=`${months[g]} ${w}, ${m}`;if($===0&&I===0&&D===0&&F===0)return U;let q=d.toLocaleTimeString();const j=q.endsWith(" AM")||q.endsWith(" PM")?q.slice(-3):"";return j&&(q=q.slice(0,-j.length)),F?q+=`.${pad(F,3)}`:timeWithUnnecessarySeconds.test(q)&&(q=q.slice(0,-3)),`${q+j}, ${U}`},months=["January","February","March","April","May","June","July","August","September","October","November","December"],timeWithUnnecessarySeconds=/:\d\d:00$/,pad=(d,m)=>String(d).padStart(m,"0"),appendStringifiedKey=(d,m,...[g])=>{const w=g?.stringifySymbol??printable;let $=d;switch(typeof m){case"string":$=isDotAccessible(m)?d===""?m:`${d}.${m}`:`${d}[${JSON.stringify(m)}]`;break;case"number":$=`${d}[${m}]`;break;case"symbol":$=`${d}[${w(m)}]`;break;default:g?.stringifyNonKey?$=`${d}[${g.stringifyNonKey(m)}]`:throwParseError(`${printable(m)} must be a PropertyKey or stringifyNonKey must be passed to options`)}return $},stringifyPath=(d,...m)=>d.reduce((g,w)=>appendStringifiedKey(g,w,...m),"");class ReadonlyPath extends ReadonlyArray{cache={};constructor(...m){super(),this.push(...m)}toJSON(){if(this.cache.json)return this.cache.json;this.cache.json=[];for(let m=0;m<this.length;m++)this.cache.json.push(typeof this[m]=="symbol"?printable(this[m]):this[m]);return this.cache.json}stringify(){return this.cache.stringify?this.cache.stringify:this.cache.stringify=stringifyPath(this)}stringifyAncestors(){if(this.cache.stringifyAncestors)return this.cache.stringifyAncestors;let m="";const g=[m];for(const w of this)m=appendStringifiedKey(m,w),g.push(m);return this.cache.stringifyAncestors=g}}class Scanner{chars;i;def;constructor(m){this.def=m,this.chars=[...m],this.i=0}shift(){return this.chars[this.i++]??""}get lookahead(){return this.chars[this.i]??""}get nextLookahead(){return this.chars[this.i+1]??""}get length(){return this.chars.length}shiftUntil(m){let g="";for(;this.lookahead&&!m(this,g);)g+=this.shift();return g}shiftUntilEscapable(m){let g="";for(;this.lookahead;)if(this.lookahead===Backslash)this.shift(),m(this,g)?g+=this.shift():this.lookahead===Backslash?g+=this.shift():g+=`${Backslash}${this.shift()}`;else{if(m(this,g))break;g+=this.shift()}return g}shiftUntilLookahead(m){return typeof m=="string"?this.shiftUntil(g=>g.lookahead===m):this.shiftUntil(g=>g.lookahead in m)}shiftUntilNonWhitespace(){return this.shiftUntil(()=>!(this.lookahead in whitespaceChars))}jumpToIndex(m){this.i=m<0?this.length+m:m}jumpForward(m){this.i+=m}get location(){return this.i}get unscanned(){return this.chars.slice(this.i,this.length).join("")}get scanned(){return this.chars.slice(0,this.i).join("")}sliceChars(m,g){return this.chars.slice(m,g).join("")}lookaheadIs(m){return this.lookahead===m}lookaheadIsIn(m){return this.lookahead in m}}const writeUnmatchedGroupCloseMessage=(d,m)=>`Unmatched ${d}${m===""?"":` before ${m}`}`,writeUnclosedGroupMessage=d=>`Missing ${d}`;let _registryName="$ark",suffix=2;for(;_registryName in globalThis;)_registryName=`$ark${suffix++}`;const registryName=_registryName;globalThis[registryName]=registry;const $ark=registry,reference=d=>`${registryName}.${d}`,registeredReference=d=>reference(register(d));class CompiledFunction extends CastableBase{argNames;body="";constructor(...m){super(),this.argNames=m;for(const g of m){if(g in this)throw new Error(`Arg name '${g}' would overwrite an existing property on FunctionBody`);this[g]=g}}indentation=0;indent(){return this.indentation+=4,this}dedent(){return this.indentation-=4,this}prop(m,g=!1){return compileLiteralPropAccess(m,g)}index(m,g=!1){return indexPropAccess(`${m}`,g)}line(m){return this.body+=`${" ".repeat(this.indentation)}${m}
`,this}const(m,g){return this.line(`const ${m} = ${g}`),this}let(m,g){return this.line(`let ${m} = ${g}`)}set(m,g){return this.line(`${m} = ${g}`)}if(m,g){return this.block(`if (${m})`,g)}elseIf(m,g){return this.block(`else if (${m})`,g)}else(m){return this.block("else",m)}for(m,g,w=0){return this.block(`for (let i = ${w}; ${m}; i++)`,g)}forIn(m,g){return this.block(`for (const k in ${m})`,g)}block(m,g,w=""){return this.line(`${m} {`),this.indent(),g(this),this.dedent(),this.line(`}${w}`)}return(m=""){return this.line(`return ${m}`)}write(m="anonymous",g=0){return`${m}(${this.argNames.join(", ")}) { ${g?this.body.split(`
`).map(w=>" ".repeat(g)+`${w}`).join(`
`):this.body} }`}compile(){return new DynamicFunction(...this.argNames,this.body)}}const compileSerializedValue=d=>hasDomain(d,"object")||typeof d=="symbol"?registeredReference(d):serializePrimitive(d),compileLiteralPropAccess=(d,m=!1)=>typeof d=="string"&&isDotAccessible(d)?`${m?"?":""}.${d}`:indexPropAccess(serializeLiteralKey(d),m),serializeLiteralKey=d=>typeof d=="symbol"?registeredReference(d):JSON.stringify(d),indexPropAccess=(d,m=!1)=>`${m?"?.":""}[${d}]`;class NodeCompiler extends CompiledFunction{traversalKind;optimistic;constructor(m){super("data","ctx"),this.traversalKind=m.kind,this.optimistic=m.optimistic===!0}invoke(m,g){const w=g?.arg??this.data,$=typeof m=="string"?!0:this.requiresContextFor(m),I=typeof m=="string"?m:m.id;return $?`${this.referenceToId(I,g)}(${w}, ${this.ctx})`:`${this.referenceToId(I,g)}(${w})`}referenceToId(m,g){const w=g?.kind??this.traversalKind,$=`this.${m}${w}`;return g?.bind?`${$}.bind(${g?.bind})`:$}requiresContextFor(m){return this.traversalKind==="Apply"||m.allowsRequiresContext}initializeErrorCount(){return this.const("errorCount","ctx.currentErrorCount")}returnIfFail(){return this.if("ctx.currentErrorCount > errorCount",()=>this.return())}returnIfFailFast(){return this.if("ctx.failFast && ctx.currentErrorCount > errorCount",()=>this.return())}traverseKey(m,g,w){const $=this.requiresContextFor(w);return $&&this.line(`${this.ctx}.path.push(${m})`),this.check(w,{arg:g}),$&&this.line(`${this.ctx}.path.pop()`),this}check(m,g){return this.traversalKind==="Allows"?this.if(`!${this.invoke(m,g)}`,()=>this.return(!1)):this.line(this.invoke(m,g))}}const makeRootAndArrayPropertiesMutable=d=>flatMorph(d,(m,g)=>[m,isArray$1(g)?[...g]:g]),arkKind=noSuggest("arkKind"),hasArkKind=(d,m)=>d?.[arkKind]===m,isNode$1=d=>hasArkKind(d,"root")||hasArkKind(d,"constraint"),basisKinds=["unit","proto","domain"],structuralKinds=["required","optional","index","sequence"],prestructuralKinds=["pattern","divisor","exactLength","max","min","maxLength","minLength","before","after"],refinementKinds=[...prestructuralKinds,"structure","predicate"],constraintKinds=[...refinementKinds,...structuralKinds],rootKinds=["alias","union","morph","unit","intersection","proto","domain"],nodeKinds=[...rootKinds,...constraintKinds],constraintKeys=flatMorph(constraintKinds,(d,m)=>[m,1]),structureKeys=flatMorph([...structuralKinds,"undeclared"],(d,m)=>[m,1]),precedenceByKind=flatMorph(nodeKinds,(d,m)=>[m,d]),isNodeKind=d=>typeof d=="string"&&d in precedenceByKind,precedenceOfKind=d=>precedenceByKind[d],schemaKindsRightOf=d=>rootKinds.slice(precedenceOfKind(d)+1);[...schemaKindsRightOf("union")];[...schemaKindsRightOf("morph")];const defaultValueSerializer=d=>typeof d=="string"||typeof d=="boolean"||d===null?d:typeof d=="number"?Number.isNaN(d)?"NaN":d===Number.POSITIVE_INFINITY?"Infinity":d===Number.NEGATIVE_INFINITY?"-Infinity":d:compileSerializedValue(d),compileObjectLiteral=d=>{let m="{ ";for(const[g,w]of Object.entries(d))m+=`${g}: ${compileSerializedValue(w)}, `;return m+" }"},implementNode=d=>{const m=d;return m.hasAssociatedError&&(m.defaults.expected??=g=>"description"in g?g.description:m.defaults.description(g),m.defaults.actual??=g=>printable(g),m.defaults.problem??=g=>`must be ${g.expected}${g.actual?` (was ${g.actual})`:""}`,m.defaults.message??=g=>{if(g.path.length===0)return g.problem;const w=`${g.propString} ${g.problem}`;return w[0]==="["?`value at ${w}`:w}),m};class ToJsonSchemaError extends Error{name="ToJsonSchemaError";code;context;constructor(m,g){super(printable(g,{quoteKeys:!1,indent:4})),this.code=m,this.context=g}hasCode(m){return this.code===m}}const defaultConfig={dialect:"https://json-schema.org/draft/2020-12/schema",useRefs:!1,fallback:{arrayObject:d=>ToJsonSchema.throw("arrayObject",d),arrayPostfix:d=>ToJsonSchema.throw("arrayPostfix",d),defaultValue:d=>ToJsonSchema.throw("defaultValue",d),domain:d=>ToJsonSchema.throw("domain",d),morph:d=>ToJsonSchema.throw("morph",d),patternIntersection:d=>ToJsonSchema.throw("patternIntersection",d),predicate:d=>ToJsonSchema.throw("predicate",d),proto:d=>ToJsonSchema.throw("proto",d),symbolKey:d=>ToJsonSchema.throw("symbolKey",d),unit:d=>ToJsonSchema.throw("unit",d),date:d=>ToJsonSchema.throw("date",d)}},ToJsonSchema={Error:ToJsonSchemaError,throw:(...d)=>{throw new ToJsonSchema.Error(...d)},throwInternalOperandError:(d,m)=>throwInternalError(`Unexpected JSON Schema input for ${d}: ${printable(m)}`),defaultConfig};$ark.config??={};const mergeConfigs=(d,m)=>{if(!m)return d;const g={...d};let w;for(w in m){const $={...d.keywords};if(w==="keywords"){for(const I in m[w]){const D=m.keywords[I];D!==void 0&&($[I]=typeof D=="string"?{description:D}:D)}g.keywords=$}else w==="toJsonSchema"?g[w]=mergeToJsonSchemaConfigs(d.toJsonSchema,m.toJsonSchema):isNodeKind(w)?g[w]={...d[w],...m[w]}:g[w]=m[w]}return g},mergeToJsonSchemaConfigs=((d,m)=>{if(!d)return m??{};if(!m)return d;const g={...d};let w;for(w in m)w==="fallback"?g.fallback=mergeFallbacks(d.fallback,m.fallback):g[w]=m[w];return g}),mergeFallbacks=(d,m)=>{d=normalizeFallback(d),m=normalizeFallback(m);const g={};let w;for(w in ToJsonSchema.defaultConfig.fallback)g[w]=m[w]??m.default??d[w]??d.default??ToJsonSchema.defaultConfig.fallback[w];return g},normalizeFallback=d=>typeof d=="function"?{default:d}:d??{};class ArkError extends CastableBase{[arkKind]="error";path;data;nodeConfig;input;ctx;constructor({prefixPath:m,relativePath:g,...w},$){super(),this.input=w,this.ctx=$,defineProperties(this,w);const I=$.data;w.code==="union"&&(w.errors=w.errors.flatMap(F=>{const U=F.hasCode("union")?F.errors:[F];return!m&&!g?U:U.map(q=>q.transform(j=>({...j,path:conflatenateAll(m,j.path,g)})))})),this.nodeConfig=$.config[this.code];const D=[...w.path??$.path];g&&D.push(...g),m&&D.unshift(...m),this.path=new ReadonlyPath(...D),this.data="data"in w?w.data:I}transform(m){return new ArkError(m({data:this.data,path:this.path,...this.input}),this.ctx)}hasCode(m){return this.code===m}get propString(){return stringifyPath(this.path)}get expected(){if(this.input.expected)return this.input.expected;const m=this.meta?.expected??this.nodeConfig.expected;return typeof m=="function"?m(this.input):m}get actual(){if(this.input.actual)return this.input.actual;const m=this.meta?.actual??this.nodeConfig.actual;return typeof m=="function"?m(this.data):m}get problem(){if(this.input.problem)return this.input.problem;const m=this.meta?.problem??this.nodeConfig.problem;return typeof m=="function"?m(this):m}get message(){if(this.input.message)return this.input.message;const m=this.meta?.message??this.nodeConfig.message;return typeof m=="function"?m(this):m}get flat(){return this.hasCode("intersection")?[...this.errors]:[this]}toJSON(){return{data:this.data,path:this.path,...this.input,expected:this.expected,actual:this.actual,problem:this.problem,message:this.message}}toString(){return this.message}throw(){throw this}}class ArkErrors extends ReadonlyArray{[arkKind]="errors";ctx;constructor(m){super(),this.ctx=m}byPath=Object.create(null);get flatByPath(){return flatMorph(this.byPath,(m,g)=>[m,g.flat])}get flatProblemsByPath(){return flatMorph(this.byPath,(m,g)=>[m,g.flat.map(w=>w.problem)])}byAncestorPath=Object.create(null);count=0;mutable=this;throw(){throw this.toTraversalError()}toTraversalError(){return new TraversalError(this)}add(m){const g=this.byPath[m.propString];if(g){if(m===g||g.hasCode("union")&&g.errors.length===0)return;const w=m.hasCode("union")&&m.errors.length===0?m:new ArkError({code:"intersection",errors:g.hasCode("intersection")?[...g.errors,m]:[g,m]},this.ctx),$=this.indexOf(g);this.mutable[$===-1?this.length:$]=w,this.byPath[m.propString]=w,this.addAncestorPaths(m)}else this.byPath[m.propString]=m,this.addAncestorPaths(m),this.mutable.push(m);this.count++}transform(m){const g=new ArkErrors(this.ctx);for(const w of this)g.add(m(w));return g}merge(m){for(const g of m)this.add(new ArkError({...g,path:[...this.ctx.path,...g.path]},this.ctx))}affectsPath(m){return this.length===0?!1:m.stringifyAncestors().some(g=>g in this.byPath)||m.stringify()in this.byAncestorPath}get summary(){return this.toString()}get issues(){return this}toJSON(){return[...this.map(m=>m.toJSON())]}toString(){return this.join(`
`)}addAncestorPaths(m){for(const g of m.path.stringifyAncestors())this.byAncestorPath[g]=append(this.byAncestorPath[g],m)}}class TraversalError extends Error{name="TraversalError";constructor(m){m.length===1?super(m.summary):super(`
`+m.map(g=>`  â€¢ ${indent(g)}`).join(`
`)),Object.defineProperty(this,"arkErrors",{value:m,enumerable:!1})}}const indent=d=>d.toString().split(`
`).join(`
  `);class Traversal{path=[];errors=new ArkErrors(this);root;config;queuedMorphs=[];branches=[];seen={};constructor(m,g){this.root=m,this.config=g}get data(){let m=this.root;for(const g of this.path)m=m?.[g];return m}get propString(){return stringifyPath(this.path)}reject(m){return this.error(m),!1}mustBe(m){return this.error(m),!1}error(m){const g=typeof m=="object"?m.code?m:{...m,code:"predicate"}:{code:"predicate",expected:m};return this.errorFromContext(g)}hasError(){return this.currentErrorCount!==0}get currentBranch(){return this.branches.at(-1)}queueMorphs(m){const g={path:new ReadonlyPath(...this.path),morphs:m};this.currentBranch?this.currentBranch.queuedMorphs.push(g):this.queuedMorphs.push(g)}finalize(m){return this.queuedMorphs.length&&(typeof this.root=="object"&&this.root!==null&&this.config.clone&&(this.root=this.config.clone(this.root)),this.applyQueuedMorphs()),this.hasError()?m?m(this.errors):this.errors:this.root}get currentErrorCount(){return this.currentBranch?this.currentBranch.error?1:0:this.errors.count}get failFast(){return this.branches.length!==0}pushBranch(){this.branches.push({error:void 0,queuedMorphs:[]})}popBranch(){return this.branches.pop()}get external(){return this}errorFromNodeContext(m){return this.errorFromContext(m)}errorFromContext(m){const g=new ArkError(m,this);return this.currentBranch?this.currentBranch.error=g:this.errors.add(g),g}applyQueuedMorphs(){for(;this.queuedMorphs.length;){const m=this.queuedMorphs;this.queuedMorphs=[];for(const{path:g,morphs:w}of m)this.errors.affectsPath(g)||this.applyMorphsAtPath(g,w)}}applyMorphsAtPath(m,g){const w=m.at(-1);let $;if(w!==void 0){$=this.root;for(let I=0;I<m.length-1;I++)$=$[m[I]]}for(const I of g){this.path=[...m];const D=isNode$1(I),F=I($===void 0?this.root:$[w],this);if(F instanceof ArkError){this.errors.add(F);break}if(F instanceof ArkErrors){D||this.errors.merge(F),this.queuedMorphs=[];break}$===void 0?this.root=F:$[w]=F,this.applyQueuedMorphs()}}}const traverseKey=(d,m,g)=>{if(!g)return m();g.path.push(d);const w=m();return g.path.pop(),w};class BaseNode extends Callable{attachments;$;onFail;includesTransform;includesContextualPredicate;isCyclic;allowsRequiresContext;rootApplyStrategy;contextFreeMorph;rootApply;referencesById;shallowReferences;flatRefs;flatMorphs;allows;get shallowMorphs(){return[]}constructor(m,g){super(($,I,D=this.onFail)=>I?(this.traverseApply($,I),I.hasError()?I.errors:I.data):this.rootApply($,D),{attach:m}),this.attachments=m,this.$=g,this.onFail=this.meta.onFail??this.$.resolvedConfig.onFail,this.includesTransform=this.hasKind("morph")||this.hasKind("structure")&&this.structuralMorph!==void 0||this.hasKind("sequence")&&this.inner.defaultables!==void 0,this.includesContextualPredicate=this.hasKind("predicate")&&this.inner.predicate.length!==1,this.isCyclic=this.kind==="alias",this.referencesById={[this.id]:this},this.shallowReferences=this.hasKind("structure")?[this,...this.children]:this.children.reduce(($,I)=>appendUniqueNodes($,I.shallowReferences),[this]);const w=this.isStructural();this.flatRefs=[],this.flatMorphs=[];for(let $=0;$<this.children.length;$++){if(this.includesTransform||=this.children[$].includesTransform,this.includesContextualPredicate||=this.children[$].includesContextualPredicate,this.isCyclic||=this.children[$].isCyclic,!w){const I=this.children[$].flatRefs;for(let D=0;D<I.length;D++){const F=I[D];if(!this.flatRefs.some(U=>flatRefsAreEqual(U,F))){this.flatRefs.push(F);for(const U of F.node.branches)(U.hasKind("morph")||U.hasKind("intersection")&&U.structure?.structuralMorph!==void 0)&&this.flatMorphs.push({path:F.path,propString:F.propString,node:U})}}}Object.assign(this.referencesById,this.children[$].referencesById)}this.flatRefs.sort(($,I)=>$.path.length>I.path.length?1:$.path.length<I.path.length?-1:$.propString>I.propString?1:$.propString<I.propString||$.node.expression<I.node.expression?-1:1),this.allowsRequiresContext=this.includesContextualPredicate||this.isCyclic,this.rootApplyStrategy=!this.allowsRequiresContext&&this.flatMorphs.length===0?this.shallowMorphs.length===0?"allows":this.shallowMorphs.every($=>$.length===1||$.name==="$arkStructuralMorph")?this.hasKind("union")?this.branches.some($=>$.shallowMorphs.length>1)?"contextual":"branchedOptimistic":this.shallowMorphs.length>1?"contextual":"optimistic":"contextual":"contextual",this.rootApply=this.createRootApply(),this.allows=this.allowsRequiresContext?$=>this.traverseAllows($,new Traversal($,this.$.resolvedConfig)):$=>this.traverseAllows($)}createRootApply(){switch(this.rootApplyStrategy){case"allows":return(g,w)=>{if(this.allows(g))return g;const $=new Traversal(g,this.$.resolvedConfig);return this.traverseApply(g,$),$.finalize(w)};case"contextual":return(g,w)=>{const $=new Traversal(g,this.$.resolvedConfig);return this.traverseApply(g,$),$.finalize(w)};case"optimistic":this.contextFreeMorph=this.shallowMorphs[0];const m=this.$.resolvedConfig.clone;return(g,w)=>{if(this.allows(g))return this.contextFreeMorph(m&&(typeof g=="object"&&g!==null||typeof g=="function")?m(g):g);const $=new Traversal(g,this.$.resolvedConfig);return this.traverseApply(g,$),$.finalize(w)};case"branchedOptimistic":return this.createBranchedOptimisticRootApply();default:return this.rootApplyStrategy,throwInternalError(`Unexpected rootApplyStrategy ${this.rootApplyStrategy}`)}}compiledMeta=compileMeta(this.metaJson);cacheGetter(m,g){return Object.defineProperty(this,m,{value:g}),g}get description(){return this.cacheGetter("description",this.meta?.description??this.$.resolvedConfig[this.kind].description(this))}get references(){return Object.values(this.referencesById)}precedence=precedenceOfKind(this.kind);precompilation;assert=(m,g)=>this(m,g,w=>w.throw());traverse(m,g){return this(m,g,null)}get in(){return this.cacheGetter("in",this.rawIn.isRoot()?this.$.finalize(this.rawIn):this.rawIn)}get rawIn(){return this.cacheGetter("rawIn",this.getIo("in"))}get out(){return this.cacheGetter("out",this.rawOut.isRoot()?this.$.finalize(this.rawOut):this.rawOut)}get rawOut(){return this.cacheGetter("rawOut",this.getIo("out"))}getIo(m){if(!this.includesTransform)return this;const g={};for(const[w,$]of this.innerEntries){const I=this.impl.keys[w];if(I.reduceIo)I.reduceIo(m,g,$);else if(I.child){const D=$;g[w]=isArray$1(D)?D.map(F=>m==="in"?F.rawIn:F.rawOut):m==="in"?D.rawIn:D.rawOut}else g[w]=$}return this.$.node(this.kind,g)}toJSON(){return this.json}toString(){return`Type<${this.expression}>`}equals(m){const g=isNode$1(m)?m:this.$.parseDefinition(m);return this.innerHash===g.innerHash}ifEquals(m){return this.equals(m)?this:void 0}hasKind(m){return this.kind===m}assertHasKind(m){return this.kind!==m&&throwError(`${this.kind} node was not of asserted kind ${m}`),this}hasKindIn(...m){return m.includes(this.kind)}assertHasKindIn(...m){return includes(m,this.kind)||throwError(`${this.kind} node was not one of asserted kinds ${m}`),this}isBasis(){return includes(basisKinds,this.kind)}isConstraint(){return includes(constraintKinds,this.kind)}isStructural(){return includes(structuralKinds,this.kind)}isRefinement(){return includes(refinementKinds,this.kind)}isRoot(){return includes(rootKinds,this.kind)}isUnknown(){return this.hasKind("intersection")&&this.children.length===0}isNever(){return this.hasKind("union")&&this.children.length===0}hasUnit(m){return this.hasKind("unit")&&this.allows(m)}hasOpenIntersection(){return this.impl.intersectionIsOpen}get nestableExpression(){return this.expression}select(m){const g=NodeSelector.normalize(m);return this._select(g)}_select(m){let g=NodeSelector.applyBoundary[m.boundary??"references"](this);return m.kind&&(g=g.filter(w=>w.kind===m.kind)),m.where&&(g=g.filter(m.where)),NodeSelector.applyMethod[m.method??"filter"](g,this,m)}transform(m,g){return this._transform(m,this._createTransformContext(g))}_createTransformContext(m){return{root:this,selected:void 0,seen:{},path:[],parseOptions:{prereduced:m?.prereduced??!1},undeclaredKeyHandling:void 0,...m}}_transform(m,g){const w=g.bindScope??this.$;if(g.seen[this.id])return this.$.lazilyResolve(g.seen[this.id]);if(g.shouldTransform?.(this,g)===!1)return this;let $;g.seen[this.id]=()=>$,this.hasKind("structure")&&this.undeclared!==g.undeclaredKeyHandling&&(g={...g,undeclaredKeyHandling:this.undeclared});const I=flatMorph(this.inner,(j,G)=>{if(!this.impl.keys[j].child)return[j,G];const H=G;if(!isArray$1(H)){const Z=H._transform(m,g);return Z?[j,Z]:[]}if(H.length===0)return[j,G];const V=H.flatMap(Z=>Z._transform(m,g)??[]);return V.length?[j,V]:[]});delete g.seen[this.id];const D=Object.assign(I,{meta:this.meta}),F=g.selected&&!g.selected.includes(this)?D:m(this.kind,D,g);if(F===null)return null;if(isNode$1(F))return $=F;const U=Object.keys(F);return(U.length===0||U.length===1&&U[0]==="meta")&&!isEmptyObject(this.inner)?null:(this.kind==="required"||this.kind==="optional"||this.kind==="index")&&!("value"in F)?g.undeclaredKeyHandling?{...F,value:$ark.intrinsic.unknown}:null:(this.kind==="morph"&&(F.in??=$ark.intrinsic.unknown),$=w.node(this.kind,F,g.parseOptions))}configureReferences(m,g="references"){const w=NodeSelector.normalize(g),$=typeof m=="string"?(U,q)=>({...q,meta:{...q.meta,description:m}}):typeof m=="function"?(U,q)=>({...q,meta:m(q.meta)}):(U,q)=>({...q,meta:{...q.meta,...m}});if(w.boundary==="self")return this.$.node(this.kind,$(this.kind,{...this.inner,meta:this.meta}));const I=this._select(w),D=I&&liftArray(I),F=w.boundary==="child"?(U,q)=>q.root.children.includes(U):w.boundary==="shallow"?U=>U.kind!=="structure":()=>!0;return this.$.finalize(this.transform($,{shouldTransform:F,selected:D}))}}const NodeSelector={applyBoundary:{self:d=>[d],child:d=>[...d.children],shallow:d=>[...d.shallowReferences],references:d=>[...d.references]},applyMethod:{filter:d=>d,assertFilter:(d,m,g)=>(d.length===0&&throwError(writeSelectAssertionMessage(m,g)),d),find:d=>d[0],assertFind:(d,m,g)=>(d.length===0&&throwError(writeSelectAssertionMessage(m,g)),d[0])},normalize:d=>typeof d=="function"?{boundary:"references",method:"filter",where:d}:typeof d=="string"?isKeyOf(d,NodeSelector.applyBoundary)?{method:"filter",boundary:d}:{boundary:"references",method:"filter",kind:d}:{boundary:"references",method:"filter",...d}},writeSelectAssertionMessage=(d,m)=>`${d} had no references matching ${printable(m)}.`,typePathToPropString=d=>stringifyPath(d,{stringifyNonKey:m=>m.expression}),referenceMatcher=/"(\$ark\.[^"]+)"/g,compileMeta=d=>JSON.stringify(d).replaceAll(referenceMatcher,"$1"),flatRef=(d,m)=>({path:d,node:m,propString:typePathToPropString(d)}),flatRefsAreEqual=(d,m)=>d.propString===m.propString&&d.node.equals(m.node),appendUniqueFlatRefs=(d,m)=>appendUnique(d,m,{isEqual:flatRefsAreEqual}),appendUniqueNodes=(d,m)=>appendUnique(d,m,{isEqual:(g,w)=>g.equals(w)});class Disjoint extends Array{static init(m,g,w,$){return new Disjoint({kind:m,l:g,r:w,path:$?.path??[],optional:$?.optional??!1})}add(m,g,w,$){return this.push({kind:m,l:g,r:w,path:$?.path??[],optional:$?.optional??!1}),this}get summary(){return this.describeReasons()}describeReasons(){if(this.length===1){const{path:m,l:g,r:w}=this[0],$=stringifyPath(m);return writeUnsatisfiableExpressionError(`Intersection${$&&` at ${$}`} of ${describeReasons(g,w)}`)}return`The following intersections result in unsatisfiable types:
â€¢ ${this.map(({path:m,l:g,r:w})=>`${m}: ${describeReasons(g,w)}`).join(`
â€¢ `)}`}throw(){return throwParseError(this.describeReasons())}invert(){const m=this.map(g=>({...g,l:g.r,r:g.l}));return m instanceof Disjoint?m:new Disjoint(...m)}withPrefixKey(m,g){return this.map(w=>({...w,path:[m,...w.path],optional:w.optional||g==="optional"}))}toNeverIfDisjoint(){return $ark.intrinsic.never}}const describeReasons=(d,m)=>`${describeReason(d)} and ${describeReason(m)}`,describeReason=d=>isNode$1(d)?d.expression:isArray$1(d)?d.map(describeReason).join(" | ")||"never":String(d),writeUnsatisfiableExpressionError=d=>`${d} results in an unsatisfiable type`,intersectionCache={},intersectNodesRoot=(d,m,g)=>intersectOrPipeNodes(d,m,{$:g,invert:!1,pipe:!1}),pipeNodesRoot=(d,m,g)=>intersectOrPipeNodes(d,m,{$:g,invert:!1,pipe:!0}),intersectOrPipeNodes=((d,m,g)=>{const w=g.pipe?"|>":"&",$=`${d.hash}${w}${m.hash}`;if(intersectionCache[$]!==void 0)return intersectionCache[$];if(!g.pipe){const F=`${m.hash}${w}${d.hash}`;if(intersectionCache[F]!==void 0){const U=intersectionCache[F],q=U instanceof Disjoint?U.invert():U;return intersectionCache[$]=q,q}}const I=!g.pipe||!d.includesTransform&&!m.includesTransform;if(I&&d.equals(m))return d;let D=I?_intersectNodes(d,m,g):d.hasKindIn(...rootKinds)?_pipeNodes(d,m,g):_intersectNodes(d,m,g);return isNode$1(D)&&(d.equals(D)?D=d:m.equals(D)&&(D=m)),intersectionCache[$]=D,D}),_intersectNodes=(d,m,g)=>{const w=d.precedence<m.precedence?d.kind:m.kind,$=d.impl.intersections[m.kind]??m.impl.intersections[d.kind];if($===void 0)return null;if(w===d.kind)return $(d,m,g);{let I=$(m,d,{...g,invert:!g.invert});return I instanceof Disjoint&&(I=I.invert()),I}},_pipeNodes=(d,m,g)=>d.includesTransform||m.includesTransform?g.invert?pipeMorphed(m,d,g):pipeMorphed(d,m,g):_intersectNodes(d,m,g),pipeMorphed=(d,m,g)=>d.distribute(w=>_pipeMorphed(w,m,g),w=>{const $=w.filter(isNode$1);if($.length===0)return Disjoint.init("union",d.branches,m.branches);if($.length<d.branches.length||!d.branches.every((D,F)=>D.rawIn.equals($[F].rawIn)))return g.$.parseSchema($);if($.length===1)return $[0];const I={branches:$};return g.$.parseSchema(I)}),_pipeMorphed=(d,m,g)=>{if(d.hasKind("morph")){const $=[...d.morphs];if(d.lastMorphIfNode){const I=intersectOrPipeNodes(d.lastMorphIfNode,m,g);if(I instanceof Disjoint)return I;$[$.length-1]=I}else $.push(m);return g.$.node("morph",{morphs:$,in:d.inner.in})}if(m.hasKind("morph")){const $=intersectOrPipeNodes(d,m.rawIn,g);return $ instanceof Disjoint?$:g.$.node("morph",{morphs:[m],in:$})}return g.$.node("morph",{morphs:[m],in:d})};class BaseConstraint extends BaseNode{constructor(m,g){super(m,g),Object.defineProperty(this,arkKind,{value:"constraint",enumerable:!1})}impliedSiblings;intersect(m){return intersectNodesRoot(this,m,this.$)}}class InternalPrimitiveConstraint extends BaseConstraint{traverseApply=(m,g)=>{this.traverseAllows(m,g)||g.errorFromNodeContext(this.errorContext)};compile(m){m.traversalKind==="Allows"?m.return(this.compiledCondition):m.if(this.compiledNegation,()=>m.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return compileObjectLiteral(this.errorContext)}}const constraintKeyParser=d=>(m,g)=>{if(isArray$1(m)){if(m.length===0)return;const $=m.map(I=>g.$.node(d,I));return d==="predicate"?$:$.sort((I,D)=>I.hash<D.hash?-1:1)}const w=g.$.node(d,m);return w.hasOpenIntersection()?[w]:w},intersectConstraints=d=>{const m=d.r.shift();if(!m){let w=d.l.length===0&&d.kind==="structure"?$ark.intrinsic.unknown.internal:d.ctx.$.node(d.kind,Object.assign(d.baseInner,unflattenConstraints(d.l)),{prereduced:!0});for(const $ of d.roots){if(w instanceof Disjoint)return w;w=intersectOrPipeNodes($,w,d.ctx)}return w}let g=!1;for(let w=0;w<d.l.length;w++){const $=intersectOrPipeNodes(d.l[w],m,d.ctx);if($!==null){if($ instanceof Disjoint)return $;if($.isRoot())return d.roots.push($),d.l.splice(w),intersectConstraints(d);if(!g)d.l[w]=$,g=!0;else if(!d.l.includes($))return throwInternalError(`Unexpectedly encountered multiple distinct intersection results for refinement ${m}`)}}if(g||d.l.push(m),d.kind==="intersection"&&m.impliedSiblings)for(const w of m.impliedSiblings)appendUnique(d.r,w);return intersectConstraints(d)},flattenConstraints=d=>Object.entries(d).flatMap(([g,w])=>g in constraintKeys?w:[]).sort((g,w)=>g.precedence<w.precedence?-1:g.precedence>w.precedence?1:g.kind==="predicate"&&w.kind==="predicate"?0:g.hash<w.hash?-1:1),unflattenConstraints=d=>{const m={};for(const g of d)if(g.hasOpenIntersection())m[g.kind]=append(m[g.kind],g);else{if(m[g.kind])return throwInternalError(`Unexpected intersection of closed refinements of kind ${g.kind}`);m[g.kind]=g}return m},throwInvalidOperandError=(...d)=>throwParseError(writeInvalidOperandMessage(...d)),writeInvalidOperandMessage=(d,m,g)=>{const w=g.hasKind("morph")?"a morph":g.isUnknown()?"unknown":g.exclude(m).defaultShortDescription;return`${capitalize$1(d)} operand must be ${m.description} (was ${w})`},parseGeneric=(d,m,g)=>new GenericRoot(d,m,g,g,null);class LazyGenericBody extends Callable{}class GenericRoot extends Callable{[arkKind]="generic";paramDefs;bodyDef;$;arg$;baseInstantiation;hkt;description;constructor(m,g,w,$,I){super((...D)=>{const F=flatMorph(this.names,(U,q)=>{const j=this.arg$.parse(D[U]);return j.extends(this.constraints[U])||throwParseError(writeUnsatisfiedParameterConstraintMessage(q,this.constraints[U].expression,j.expression)),[q,j]});if(this.defIsLazy()){const U=this.bodyDef(F);return this.$.parse(U)}return this.$.parse(g,{args:F})}),this.paramDefs=m,this.bodyDef=g,this.$=w,this.arg$=$,this.hkt=I,this.description=I?new I().description??`a generic type for ${I.constructor.name}`:"a generic type",this.baseInstantiation=this(...this.constraints)}defIsLazy(){return this.bodyDef instanceof LazyGenericBody}cacheGetter(m,g){return Object.defineProperty(this,m,{value:g}),g}get json(){return this.cacheGetter("json",{params:this.params.map(m=>m[1].isUnknown()?m[0]:[m[0],m[1].json]),body:snapshot$1(this.bodyDef)})}get params(){return this.cacheGetter("params",this.paramDefs.map(m=>typeof m=="string"?[m,$ark.intrinsic.unknown]:[m[0],this.$.parse(m[1])]))}get names(){return this.cacheGetter("names",this.params.map(m=>m[0]))}get constraints(){return this.cacheGetter("constraints",this.params.map(m=>m[1]))}get internal(){return this}get referencesById(){return this.baseInstantiation.internal.referencesById}get references(){return this.baseInstantiation.internal.references}}const writeUnsatisfiedParameterConstraintMessage=(d,m,g)=>`${d} must be assignable to ${m} (was ${g})`,implementation$l=implementNode({kind:"predicate",hasAssociatedError:!0,collapsibleKey:"predicate",keys:{predicate:{}},normalize:d=>typeof d=="function"?{predicate:d}:d,defaults:{description:d=>`valid according to ${d.predicate.name||"an anonymous predicate"}`},intersectionIsOpen:!0,intersections:{predicate:()=>null}});class PredicateNode extends BaseConstraint{serializedPredicate=registeredReference(this.predicate);compiledCondition=`${this.serializedPredicate}(data, ctx)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=null;expression=this.serializedPredicate;traverseAllows=this.predicate;errorContext={code:"predicate",description:this.description,meta:this.meta};compiledErrorContext=compileObjectLiteral(this.errorContext);traverseApply=(m,g)=>{!this.predicate(m,g.external)&&!g.hasError()&&g.errorFromNodeContext(this.errorContext)};compile(m){if(m.traversalKind==="Allows"){m.return(this.compiledCondition);return}m.if(`${this.compiledNegation} && !ctx.hasError()`,()=>m.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}reduceJsonSchema(m,g){return g.fallback.predicate({code:"predicate",base:m,predicate:this.predicate})}}const Predicate={implementation:implementation$l,Node:PredicateNode},implementation$k=implementNode({kind:"divisor",collapsibleKey:"rule",keys:{rule:{parse:d=>Number.isInteger(d)?d:throwParseError(writeNonIntegerDivisorMessage(d))}},normalize:d=>typeof d=="number"?{rule:d}:d,hasAssociatedError:!0,defaults:{description:d=>d.rule===1?"an integer":d.rule===2?"even":`a multiple of ${d.rule}`},intersections:{divisor:(d,m,g)=>g.$.node("divisor",{rule:Math.abs(d.rule*m.rule/greatestCommonDivisor(d.rule,m.rule))})},obviatesBasisDescription:!0});class DivisorNode extends InternalPrimitiveConstraint{traverseAllows=m=>m%this.rule===0;compiledCondition=`data % ${this.rule} === 0`;compiledNegation=`data % ${this.rule} !== 0`;impliedBasis=$ark.intrinsic.number.internal;expression=`% ${this.rule}`;reduceJsonSchema(m){return m.type="integer",this.rule===1||(m.multipleOf=this.rule),m}}const Divisor={implementation:implementation$k,Node:DivisorNode},writeNonIntegerDivisorMessage=d=>`divisor must be an integer (was ${d})`,greatestCommonDivisor=(d,m)=>{let g,w=d,$=m;for(;$!==0;)g=$,$=w%$,w=g;return w};class BaseRange extends InternalPrimitiveConstraint{boundOperandKind=operandKindsByBoundKind[this.kind];compiledActual=this.boundOperandKind==="value"?"data":this.boundOperandKind==="length"?"data.length":"data.valueOf()";comparator=compileComparator(this.kind,this.exclusive);numericLimit=this.rule.valueOf();expression=`${this.comparator} ${this.rule}`;compiledCondition=`${this.compiledActual} ${this.comparator} ${this.numericLimit}`;compiledNegation=`${this.compiledActual} ${negatedComparators[this.comparator]} ${this.numericLimit}`;stringLimit=this.boundOperandKind==="date"?dateLimitToString(this.numericLimit):`${this.numericLimit}`;limitKind=this.comparator[0]==="<"?"upper":"lower";isStricterThan(m){return(this.limitKind==="upper"?this.numericLimit<m.numericLimit:this.numericLimit>m.numericLimit)||this.numericLimit===m.numericLimit&&this.exclusive===!0&&!m.exclusive}overlapsRange(m){return!(this.isStricterThan(m)||this.numericLimit===m.numericLimit&&(this.exclusive||m.exclusive))}overlapIsUnit(m){return this.numericLimit===m.numericLimit&&!this.exclusive&&!m.exclusive}}const negatedComparators={"<":">=","<=":">",">":"<=",">=":"<"},boundKindPairsByLower={min:"max",minLength:"maxLength",after:"before"},parseExclusiveKey={parse:d=>d||void 0},createLengthSchemaNormalizer=d=>m=>{if(typeof m=="number")return{rule:m};const{exclusive:g,...w}=m;return g?{...w,rule:d==="minLength"?w.rule+1:w.rule-1}:w},createDateSchemaNormalizer=d=>m=>{if(typeof m=="number"||typeof m=="string"||m instanceof Date)return{rule:m};const{exclusive:g,...w}=m;if(!g)return w;const $=typeof w.rule=="number"?w.rule:typeof w.rule=="string"?new Date(w.rule).valueOf():w.rule.valueOf();return g?{...w,rule:d==="after"?$+1:$-1}:w},parseDateLimit=d=>typeof d=="string"||typeof d=="number"?new Date(d):d,writeInvalidLengthBoundMessage=(d,m)=>`${d} bound must be a positive integer (was ${m})`,createLengthRuleParser=d=>m=>((!Number.isInteger(m)||m<0)&&throwParseError(writeInvalidLengthBoundMessage(d,m)),m),operandKindsByBoundKind={min:"value",max:"value",minLength:"length",maxLength:"length",after:"date",before:"date"},compileComparator=(d,m)=>`${isKeyOf(d,boundKindPairsByLower)?">":"<"}${m?"":"="}`,dateLimitToString=d=>typeof d=="string"?d:new Date(d).toLocaleString(),writeUnboundableMessage=d=>`Bounded expression ${d} must be exactly one of number, string, Array, or Date`,implementation$j=implementNode({kind:"after",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:parseDateLimit,serialize:d=>d.toISOString()}},normalize:createDateSchemaNormalizer("after"),defaults:{description:d=>`${d.collapsibleLimitString} or later`,actual:describeCollapsibleDate},intersections:{after:(d,m)=>d.isStricterThan(m)?d:m}});class AfterNode extends BaseRange{impliedBasis=$ark.intrinsic.Date.internal;collapsibleLimitString=describeCollapsibleDate(this.rule);traverseAllows=m=>m>=this.rule;reduceJsonSchema(m,g){return g.fallback.date({code:"date",base:m,after:this.rule})}}const After={implementation:implementation$j,Node:AfterNode},implementation$i=implementNode({kind:"before",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:parseDateLimit,serialize:d=>d.toISOString()}},normalize:createDateSchemaNormalizer("before"),defaults:{description:d=>`${d.collapsibleLimitString} or earlier`,actual:describeCollapsibleDate},intersections:{before:(d,m)=>d.isStricterThan(m)?d:m,after:(d,m,g)=>d.overlapsRange(m)?d.overlapIsUnit(m)?g.$.node("unit",{unit:d.rule}):null:Disjoint.init("range",d,m)}});class BeforeNode extends BaseRange{collapsibleLimitString=describeCollapsibleDate(this.rule);traverseAllows=m=>m<=this.rule;impliedBasis=$ark.intrinsic.Date.internal;reduceJsonSchema(m,g){return g.fallback.date({code:"date",base:m,before:this.rule})}}const Before={implementation:implementation$i,Node:BeforeNode},implementation$h=implementNode({kind:"exactLength",collapsibleKey:"rule",keys:{rule:{parse:createLengthRuleParser("exactLength")}},normalize:d=>typeof d=="number"?{rule:d}:d,hasAssociatedError:!0,defaults:{description:d=>`exactly length ${d.rule}`,actual:d=>`${d.length}`},intersections:{exactLength:(d,m,g)=>Disjoint.init("unit",g.$.node("unit",{unit:d.rule}),g.$.node("unit",{unit:m.rule}),{path:["length"]}),minLength:(d,m)=>d.rule>=m.rule?d:Disjoint.init("range",d,m),maxLength:(d,m)=>d.rule<=m.rule?d:Disjoint.init("range",d,m)}});class ExactLengthNode extends InternalPrimitiveConstraint{traverseAllows=m=>m.length===this.rule;compiledCondition=`data.length === ${this.rule}`;compiledNegation=`data.length !== ${this.rule}`;impliedBasis=$ark.intrinsic.lengthBoundable.internal;expression=`== ${this.rule}`;reduceJsonSchema(m){switch(m.type){case"string":return m.minLength=this.rule,m.maxLength=this.rule,m;case"array":return m.minItems=this.rule,m.maxItems=this.rule,m;default:return ToJsonSchema.throwInternalOperandError("exactLength",m)}}}const ExactLength={implementation:implementation$h,Node:ExactLengthNode},implementation$g=implementNode({kind:"max",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:parseExclusiveKey},normalize:d=>typeof d=="number"?{rule:d}:d,defaults:{description:d=>d.rule===0?d.exclusive?"negative":"non-positive":`${d.exclusive?"less than":"at most"} ${d.rule}`},intersections:{max:(d,m)=>d.isStricterThan(m)?d:m,min:(d,m,g)=>d.overlapsRange(m)?d.overlapIsUnit(m)?g.$.node("unit",{unit:d.rule}):null:Disjoint.init("range",d,m)},obviatesBasisDescription:!0});class MaxNode extends BaseRange{impliedBasis=$ark.intrinsic.number.internal;traverseAllows=this.exclusive?m=>m<this.rule:m=>m<=this.rule;reduceJsonSchema(m){return this.exclusive?m.exclusiveMaximum=this.rule:m.maximum=this.rule,m}}const Max={implementation:implementation$g,Node:MaxNode},implementation$f=implementNode({kind:"maxLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:createLengthRuleParser("maxLength")}},reduce:(d,m)=>d.rule===0?m.node("exactLength",d):void 0,normalize:createLengthSchemaNormalizer("maxLength"),defaults:{description:d=>`at most length ${d.rule}`,actual:d=>`${d.length}`},intersections:{maxLength:(d,m)=>d.isStricterThan(m)?d:m,minLength:(d,m,g)=>d.overlapsRange(m)?d.overlapIsUnit(m)?g.$.node("exactLength",{rule:d.rule}):null:Disjoint.init("range",d,m)}});class MaxLengthNode extends BaseRange{impliedBasis=$ark.intrinsic.lengthBoundable.internal;traverseAllows=m=>m.length<=this.rule;reduceJsonSchema(m){switch(m.type){case"string":return m.maxLength=this.rule,m;case"array":return m.maxItems=this.rule,m;default:return ToJsonSchema.throwInternalOperandError("maxLength",m)}}}const MaxLength={implementation:implementation$f,Node:MaxLengthNode},implementation$e=implementNode({kind:"min",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:parseExclusiveKey},normalize:d=>typeof d=="number"?{rule:d}:d,defaults:{description:d=>d.rule===0?d.exclusive?"positive":"non-negative":`${d.exclusive?"more than":"at least"} ${d.rule}`},intersections:{min:(d,m)=>d.isStricterThan(m)?d:m},obviatesBasisDescription:!0});class MinNode extends BaseRange{impliedBasis=$ark.intrinsic.number.internal;traverseAllows=this.exclusive?m=>m>this.rule:m=>m>=this.rule;reduceJsonSchema(m){return this.exclusive?m.exclusiveMinimum=this.rule:m.minimum=this.rule,m}}const Min={implementation:implementation$e,Node:MinNode},implementation$d=implementNode({kind:"minLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:createLengthRuleParser("minLength")}},reduce:d=>d.rule===0?$ark.intrinsic.unknown:void 0,normalize:createLengthSchemaNormalizer("minLength"),defaults:{description:d=>d.rule===1?"non-empty":`at least length ${d.rule}`,actual:d=>d.length===0?"":`${d.length}`},intersections:{minLength:(d,m)=>d.isStricterThan(m)?d:m}});class MinLengthNode extends BaseRange{impliedBasis=$ark.intrinsic.lengthBoundable.internal;traverseAllows=m=>m.length>=this.rule;reduceJsonSchema(m){switch(m.type){case"string":return m.minLength=this.rule,m;case"array":return m.minItems=this.rule,m;default:return ToJsonSchema.throwInternalOperandError("minLength",m)}}}const MinLength={implementation:implementation$d,Node:MinLengthNode},boundImplementationsByKind={min:Min.implementation,max:Max.implementation,minLength:MinLength.implementation,maxLength:MaxLength.implementation,exactLength:ExactLength.implementation,after:After.implementation,before:Before.implementation},boundClassesByKind={min:Min.Node,max:Max.Node,minLength:MinLength.Node,maxLength:MaxLength.Node,exactLength:ExactLength.Node,after:After.Node,before:Before.Node},implementation$c=implementNode({kind:"pattern",collapsibleKey:"rule",keys:{rule:{},flags:{}},normalize:d=>typeof d=="string"?{rule:d}:d instanceof RegExp?d.flags?{rule:d.source,flags:d.flags}:{rule:d.source}:d,obviatesBasisDescription:!0,obviatesBasisExpression:!0,hasAssociatedError:!0,intersectionIsOpen:!0,defaults:{description:d=>`matched by ${d.rule}`},intersections:{pattern:()=>null}});class PatternNode extends InternalPrimitiveConstraint{instance=new RegExp(this.rule,this.flags);expression=`${this.instance}`;traverseAllows=this.instance.test.bind(this.instance);compiledCondition=`${this.expression}.test(data)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=$ark.intrinsic.string.internal;reduceJsonSchema(m,g){return m.pattern?g.fallback.patternIntersection({code:"patternIntersection",base:m,pattern:this.rule}):(m.pattern=this.rule,m)}}const Pattern={implementation:implementation$c,Node:PatternNode},schemaKindOf=(d,m)=>{const g=discriminateRootKind(d);return m&&!m.includes(g)?throwParseError(`Root of kind ${g} should be one of ${m}`):g},discriminateRootKind=d=>{if(hasArkKind(d,"root"))return d.kind;if(typeof d=="string")return d[0]==="$"?"alias":d in domainDescriptions?"domain":"proto";if(typeof d=="function")return"proto";if(typeof d!="object"||d===null)return throwParseError(writeInvalidSchemaMessage(d));if("morphs"in d)return"morph";if("branches"in d||isArray$1(d))return"union";if("unit"in d)return"unit";if("reference"in d)return"alias";const m=Object.keys(d);return m.length===0||m.some(g=>g in constraintKeys)?"intersection":"proto"in d?"proto":"domain"in d?"domain":throwParseError(writeInvalidSchemaMessage(d))},writeInvalidSchemaMessage=d=>`${printable(d)} is not a valid type schema`,nodeCountsByPrefix={},serializeListableChild=d=>isArray$1(d)?d.map(m=>m.collapsibleJson):d.collapsibleJson,nodesByRegisteredId={};$ark.nodesByRegisteredId=nodesByRegisteredId;const registerNodeId=d=>(nodeCountsByPrefix[d]??=0,`${d}${++nodeCountsByPrefix[d]}`),parseNode=d=>{const m=nodeImplementationsByKind[d.kind],g=m.applyConfig?.(d.def,d.$.resolvedConfig)??d.def,w={},{meta:$,...I}=g,D=$===void 0?{}:typeof $=="string"?{description:$}:$,F=entriesOf(I).sort(([q],[j])=>isNodeKind(q)?isNodeKind(j)?precedenceOfKind(q)-precedenceOfKind(j):1:isNodeKind(j)||q<j?-1:1).filter(([q,j])=>{if(q.startsWith("meta.")){const G=q.slice(5);return D[G]=j,!1}return!0});for(const q of F){const j=q[0],G=m.keys[j];if(!G)return throwParseError(`Key ${j} is not valid on ${d.kind} schema`);const H=G.parse?G.parse(q[1],d):q[1];H!==unset&&(H!==void 0||G.preserveUndefined)&&(w[j]=H)}if(m.reduce&&!d.prereduced){const q=m.reduce(w,d.$);if(q)return q instanceof Disjoint?q.throw():withMeta(q,D)}return createNode$1({id:d.id,kind:d.kind,inner:w,meta:D,$:d.$})},createNode$1=({id:d,kind:m,inner:g,meta:w,$,ignoreCache:I})=>{const D=nodeImplementationsByKind[m],F=entriesOf(g),U=[];let q={};for(const[ie,re]of F){const se=D.keys[ie],X=se.serialize??(se.child?serializeListableChild:defaultValueSerializer);if(q[ie]=X(re),se.child===!0){const ne=re;isArray$1(ne)?U.push(...ne):U.push(ne)}else typeof se.child=="function"&&U.push(...se.child(re))}D.finalizeInnerJson&&(q=D.finalizeInnerJson(q));let j={...q},G={};isEmptyObject(w)||(G=flatMorph(w,(ie,re)=>[ie,ie==="examples"?re:defaultValueSerializer(re)]),j.meta=possiblyCollapse(G,"description",!0)),q=possiblyCollapse(q,D.collapsibleKey,!1);const H=JSON.stringify({kind:m,...q});j=possiblyCollapse(j,D.collapsibleKey,!1);const V=possiblyCollapse(j,D.collapsibleKey,!0),Z=JSON.stringify({kind:m,...j});if($.nodesByHash[Z]&&!I)return $.nodesByHash[Z];const Q={id:d,kind:m,impl:D,inner:g,innerEntries:F,innerJson:q,innerHash:H,meta:w,metaJson:G,json:j,hash:Z,collapsibleJson:V,children:U};if(m!=="intersection")for(const ie in g)ie!=="in"&&ie!=="out"&&(Q[ie]=g[ie]);const J=new nodeClassesByKind[m](Q,$);return $.nodesByHash[Z]=J},withId=(d,m)=>d.id===m?d:(isNode$1(nodesByRegisteredId[m])&&throwInternalError(`Unexpected attempt to overwrite node id ${m}`),createNode$1({id:m,kind:d.kind,inner:d.inner,meta:d.meta,$:d.$,ignoreCache:!0})),withMeta=(d,m,g)=>createNode$1({id:registerNodeId(m.alias??d.kind),kind:d.kind,inner:d.inner,meta:m,$:d.$}),possiblyCollapse=(d,m,g)=>{const w=Object.keys(d);if(w.length===1&&w[0]===m){const $=d[m];if(g||hasDomain($,"object")&&(Object.keys($).length===1||Array.isArray($)))return $}return d},intersectProps=(d,m,g)=>{if(d.key!==m.key)return null;const w=d.key;let $=intersectOrPipeNodes(d.value,m.value,g);const I=d.required||m.required?"required":"optional";if($ instanceof Disjoint)if(I==="optional")$=$ark.intrinsic.never.internal;else return $.withPrefixKey(d.key,d.required&&m.required?"required":"optional");if(I==="required")return g.$.node("required",{key:w,value:$});const D=d.hasDefault()?m.hasDefault()?d.default===m.default?d.default:throwParseError(writeDefaultIntersectionMessage(d.default,m.default)):d.default:m.hasDefault()?m.default:unset;return g.$.node("optional",{key:w,value:$,default:D})};class BaseProp extends BaseConstraint{required=this.kind==="required";optional=this.kind==="optional";impliedBasis=$ark.intrinsic.object.internal;serializedKey=compileSerializedValue(this.key);compiledKey=typeof this.key=="string"?this.key:this.serializedKey;flatRefs=append(this.value.flatRefs.map(m=>flatRef([this.key,...m.path],m.node)),flatRef([this.key],this.value));_transform(m,g){g.path.push(this.key);const w=super._transform(m,g);return g.path.pop(),w}hasDefault(){return"default"in this.inner}traverseAllows=(m,g)=>this.key in m?traverseKey(this.key,()=>this.value.traverseAllows(m[this.key],g),g):this.optional;traverseApply=(m,g)=>{this.key in m?traverseKey(this.key,()=>this.value.traverseApply(m[this.key],g),g):this.hasKind("required")&&g.errorFromNodeContext(this.errorContext)};compile(m){m.if(`${this.serializedKey} in data`,()=>m.traverseKey(this.serializedKey,`data${m.prop(this.key)}`,this.value)),this.hasKind("required")&&m.else(()=>m.traversalKind==="Apply"?m.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`):m.return(!1)),m.traversalKind==="Allows"&&m.return(!0)}}const writeDefaultIntersectionMessage=(d,m)=>`Invalid intersection of default values ${printable(d)} & ${printable(m)}`,implementation$b=implementNode({kind:"optional",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(d,m)=>m.$.parseSchema(d)},default:{preserveUndefined:!0}},normalize:d=>d,reduce:(d,m)=>{if(m.resolvedConfig.exactOptionalPropertyTypes===!1&&!d.value.allows(void 0))return m.node("optional",{...d,value:d.value.or(intrinsic.undefined)},{prereduced:!0})},defaults:{description:d=>`${d.compiledKey}?: ${d.value.description}`},intersections:{optional:intersectProps}});class OptionalNode extends BaseProp{constructor(...m){super(...m),"default"in this.inner&&assertDefaultValueAssignability(this.value,this.inner.default,this.key)}get rawIn(){const m=super.rawIn;return this.hasDefault()?this.$.node("optional",omit$1(m.inner,{default:!0}),{prereduced:!0}):m}get outProp(){if(!this.hasDefault())return this;const{default:m,...g}=this.inner;return this.cacheGetter("outProp",this.$.node("required",g,{prereduced:!0}))}expression=this.hasDefault()?`${this.compiledKey}: ${this.value.expression} = ${printable(this.inner.default)}`:`${this.compiledKey}?: ${this.value.expression}`;defaultValueMorph=getDefaultableMorph(this);defaultValueMorphRef=this.defaultValueMorph&&registeredReference(this.defaultValueMorph)}const Optional={implementation:implementation$b,Node:OptionalNode},defaultableMorphCache={},getDefaultableMorph=d=>{if(!d.hasDefault())return;const m=`{${d.compiledKey}: ${d.value.id} = ${defaultValueSerializer(d.default)}}`;return defaultableMorphCache[m]??=computeDefaultValueMorph(d.key,d.value,d.default)},computeDefaultValueMorph=(d,m,g)=>{if(typeof g=="function")return m.includesTransform?($,I)=>(traverseKey(d,()=>m($[d]=g(),I),I),$):$=>($[d]=g(),$);const w=m.includesTransform?m.assert(g):g;return hasDomain(w,"object")?($,I)=>(traverseKey(d,()=>m($[d]=g,I),I),$):$=>($[d]=w,$)},assertDefaultValueAssignability=(d,m,g)=>{const w=isThunk(m);hasDomain(m,"object")&&!w&&throwParseError(writeNonPrimitiveNonFunctionDefaultValueMessage(g));const $=d.in(w?m():m);if($ instanceof ArkErrors){g===null&&throwParseError(`Default ${$.summary}`);const I=$.transform(D=>D.transform(F=>({...F,prefixPath:[g]})));throwParseError(`Default for ${I.summary}`)}return m},writeNonPrimitiveNonFunctionDefaultValueMessage=d=>`Non-primitive default ${d===null?"":typeof d=="number"?`for value at [${d}] `:`for ${compileSerializedValue(d)} `}must be specified as a function like () => ({my: 'object'})`;class BaseRoot extends BaseNode{constructor(m,g){super(m,g),Object.defineProperty(this,arkKind,{value:"root",enumerable:!1})}get rawIn(){return super.rawIn}get rawOut(){return super.rawOut}get internal(){return this}get"~standard"(){return{vendor:"arktype",version:1,validate:m=>{const g=this(m);return g instanceof ArkErrors?g:{value:g}},toJSONSchema:m=>m.target&&m.target!=="draft-2020-12"?throwParseError(`JSONSchema target '${m.target}' is not supported (must be "draft-2020-12")`):m.io==="input"?this.rawIn.toJsonSchema():this.rawOut.toJsonSchema()}}as(){return this}brand(m){return m===""?throwParseError(emptyBrandNameMessage):this}readonly(){return this}branches=this.hasKind("union")?this.inner.branches:[this];distribute(m,g){const w=this.branches.map(m);return g?.(w)??w}get shortDescription(){return this.meta.description??this.defaultShortDescription}toJsonSchema(m={}){const g=mergeToJsonSchemaConfigs(this.$.resolvedConfig.toJsonSchema,m);g.useRefs||=this.isCyclic;const w=typeof g.dialect=="string"?{$schema:g.dialect}:{};return Object.assign(w,this.toJsonSchemaRecurse(g)),g.useRefs&&(w.$defs=flatMorph(this.references,($,I)=>I.isRoot()&&!I.alwaysExpandJsonSchema?[I.id,I.toResolvedJsonSchema(g)]:[])),w}toJsonSchemaRecurse(m){return m.useRefs&&!this.alwaysExpandJsonSchema?{$ref:`#/$defs/${this.id}`}:this.toResolvedJsonSchema(m)}get alwaysExpandJsonSchema(){return this.isBasis()||this.kind==="alias"||this.hasKind("union")&&this.isBoolean}toResolvedJsonSchema(m){const g=this.innerToJsonSchema(m);return Object.assign(g,this.metaJson)}intersect(m){const g=this.$.parseDefinition(m),w=this.rawIntersect(g);return w instanceof Disjoint?w:this.$.finalize(w)}rawIntersect(m){return intersectNodesRoot(this,m,this.$)}toNeverIfDisjoint(){return this}and(m){const g=this.intersect(m);return g instanceof Disjoint?g.throw():g}rawAnd(m){const g=this.rawIntersect(m);return g instanceof Disjoint?g.throw():g}or(m){const g=this.$.parseDefinition(m);return this.$.finalize(this.rawOr(g))}rawOr(m){const g=[...this.branches,...m.branches];return this.$.node("union",g)}map(m){return this.$.schema(this.applyStructuralOperation("map",[m]))}pick(...m){return this.$.schema(this.applyStructuralOperation("pick",m))}omit(...m){return this.$.schema(this.applyStructuralOperation("omit",m))}required(){return this.$.schema(this.applyStructuralOperation("required",[]))}partial(){return this.$.schema(this.applyStructuralOperation("partial",[]))}_keyof;keyof(){if(this._keyof)return this._keyof;const m=this.applyStructuralOperation("keyof",[]).reduce((g,w)=>g.intersect(w).toNeverIfDisjoint(),$ark.intrinsic.unknown.internal);return m.branches.length===0&&throwParseError(writeUnsatisfiableExpressionError(`keyof ${this.expression}`)),this._keyof=this.$.finalize(m)}get props(){return this.branches.length!==1?throwParseError(writeLiteralUnionEntriesMessage(this.expression)):[...this.applyStructuralOperation("props",[])[0]]}merge(m){const g=this.$.parseDefinition(m);return this.$.schema(g.distribute(w=>this.applyStructuralOperation("merge",[structureOf(w)??throwParseError(writeNonStructuralOperandMessage("merge",w.expression))])))}applyStructuralOperation(m,g){return this.distribute(w=>{if(w.equals($ark.intrinsic.object)&&m!=="merge")return w;const $=structureOf(w);if($||throwParseError(writeNonStructuralOperandMessage(m,w.expression)),m==="keyof")return $.keyof();if(m==="get")return $.get(...g);if(m==="props")return $.props;const I=m==="required"?"require":m==="partial"?"optionalize":m;return this.$.node("intersection",{domain:"object",structure:$[I](...g)})})}get(...m){return m[0]===void 0?this:this.$.schema(this.applyStructuralOperation("get",m))}extract(m){const g=this.$.parseDefinition(m);return this.$.schema(this.branches.filter(w=>w.extends(g)))}exclude(m){const g=this.$.parseDefinition(m);return this.$.schema(this.branches.filter(w=>!w.extends(g)))}array(){return this.$.schema(this.isUnknown()?{proto:Array}:{proto:Array,sequence:this},{prereduced:!0})}overlaps(m){return!(this.intersect(m)instanceof Disjoint)}extends(m){const g=this.intersect(m);return!(g instanceof Disjoint)&&this.equals(g)}ifExtends(m){return this.extends(m)?this:void 0}subsumes(m){return this.$.parseDefinition(m).extends(this)}configure(m,g="shallow"){return this.configureReferences(m,g)}describe(m,g="shallow"){return this.configure({description:m},g)}optional(){return[this,"?"]}default(m){return assertDefaultValueAssignability(this,m,null),[this,"=",m]}from(m){return this.assert(m)}_pipe(...m){const g=m.reduce((w,$)=>w.rawPipeOnce($),this);return this.$.finalize(g)}tryPipe(...m){const g=m.reduce((w,$)=>w.rawPipeOnce(hasArkKind($,"root")?$:((I,D)=>{try{return $(I,D)}catch(F){return D.error({code:"predicate",predicate:$,actual:`aborted due to error:
    ${F}
`})}})),this);return this.$.finalize(g)}pipe=Object.assign(this._pipe.bind(this),{try:this.tryPipe.bind(this)});to(m){return this.$.finalize(this.toNode(this.$.parseDefinition(m)))}toNode(m){const g=pipeNodesRoot(this,m,this.$);return g instanceof Disjoint?g.throw():g}rawPipeOnce(m){return hasArkKind(m,"root")?this.toNode(m):this.distribute(g=>g.hasKind("morph")?this.$.node("morph",{in:g.inner.in,morphs:[...g.morphs,m]}):this.$.node("morph",{in:g,morphs:[m]}),this.$.parseSchema)}narrow(m){return this.constrainOut("predicate",m)}constrain(m,g){return this._constrain("root",m,g)}constrainIn(m,g){return this._constrain("in",m,g)}constrainOut(m,g){return this._constrain("out",m,g)}_constrain(m,g,w){const $=this.$.node(g,w);if($.isRoot())return $.isUnknown()?this:throwInternalError(`Unexpected constraint node ${$}`);const I=m==="root"?this:m==="in"?this.rawIn:this.rawOut;if(I.hasKind("morph")||$.impliedBasis&&!I.extends($.impliedBasis))return throwInvalidOperandError(g,$.impliedBasis,this);const D=this.$.node("intersection",{[$.kind]:$}),F=m==="out"?pipeNodesRoot(this,D,this.$):intersectNodesRoot(this,D,this.$);return F instanceof Disjoint&&F.throw(),this.$.finalize(F)}onUndeclaredKey(m){const g=typeof m=="string"?m:m.rule,w=typeof m=="string"?!1:m.deep;return this.$.finalize(this.transform(($,I)=>$==="structure"?g==="ignore"?omit$1(I,{undeclared:1}):{...I,undeclared:g}:I,w?void 0:{shouldTransform:$=>!includes(structuralKinds,$.kind)}))}hasEqualMorphs(m){return!this.includesTransform&&!m.includesTransform?!0:!(!arrayEquals(this.shallowMorphs,m.shallowMorphs)||!arrayEquals(this.flatMorphs,m.flatMorphs,{isEqual:(g,w)=>g.propString===w.propString&&(g.node.hasKind("morph")&&w.node.hasKind("morph")?g.node.hasEqualMorphs(w.node):g.node.hasKind("intersection")&&w.node.hasKind("intersection")?g.node.structure?.structuralMorphRef===w.node.structure?.structuralMorphRef:!1)}))}onDeepUndeclaredKey(m){return this.onUndeclaredKey({rule:m,deep:!0})}filter(m){return this.constrainIn("predicate",m)}divisibleBy(m){return this.constrain("divisor",m)}matching(m){return this.constrain("pattern",m)}atLeast(m){return this.constrain("min",m)}atMost(m){return this.constrain("max",m)}moreThan(m){return this.constrain("min",exclusivizeRangeSchema(m))}lessThan(m){return this.constrain("max",exclusivizeRangeSchema(m))}atLeastLength(m){return this.constrain("minLength",m)}atMostLength(m){return this.constrain("maxLength",m)}moreThanLength(m){return this.constrain("minLength",exclusivizeRangeSchema(m))}lessThanLength(m){return this.constrain("maxLength",exclusivizeRangeSchema(m))}exactlyLength(m){return this.constrain("exactLength",m)}atOrAfter(m){return this.constrain("after",m)}atOrBefore(m){return this.constrain("before",m)}laterThan(m){return this.constrain("after",exclusivizeRangeSchema(m))}earlierThan(m){return this.constrain("before",exclusivizeRangeSchema(m))}}const emptyBrandNameMessage="Expected a non-empty brand name after #",exclusivizeRangeSchema=d=>typeof d=="object"&&!(d instanceof Date)?{...d,exclusive:!0}:{rule:d,exclusive:!0},typeOrTermExtends=(d,m)=>hasArkKind(m,"root")?hasArkKind(d,"root")?d.extends(m):m.allows(d):hasArkKind(d,"root")?d.hasUnit(m):m===d,structureOf=d=>d.hasKind("morph")?null:d.hasKind("intersection")?d.inner.structure??(d.basis?.domain==="object"?d.$.bindReference($ark.intrinsic.emptyStructure):null):d.isBasis()&&d.domain==="object"?d.$.bindReference($ark.intrinsic.emptyStructure):null,writeLiteralUnionEntriesMessage=d=>`Props cannot be extracted from a union. Use .distribute to extract props from each branch instead. Received:
${d}`,writeNonStructuralOperandMessage=(d,m)=>`${d} operand must be an object (was ${m})`,defineRightwardIntersections=(d,m)=>flatMorph(schemaKindsRightOf(d),(g,w)=>[w,m]),normalizeAliasSchema=d=>typeof d=="string"?{reference:d}:d,neverIfDisjoint=d=>d instanceof Disjoint?$ark.intrinsic.never.internal:d,implementation$a=implementNode({kind:"alias",hasAssociatedError:!1,collapsibleKey:"reference",keys:{reference:{serialize:d=>d.startsWith("$")?d:`$ark.${d}`},resolve:{}},normalize:normalizeAliasSchema,defaults:{description:d=>d.reference},intersections:{alias:(d,m,g)=>g.$.lazilyResolve(()=>neverIfDisjoint(intersectOrPipeNodes(d.resolution,m.resolution,g)),`${d.reference}${g.pipe?"=>":"&"}${m.reference}`),...defineRightwardIntersections("alias",(d,m,g)=>m.isUnknown()?d:m.isNever()?m:m.isBasis()&&!m.overlaps($ark.intrinsic.object)?Disjoint.init("assignability",$ark.intrinsic.object,m):g.$.lazilyResolve(()=>neverIfDisjoint(intersectOrPipeNodes(d.resolution,m,g)),`${d.reference}${g.pipe?"=>":"&"}${m.id}`))}});class AliasNode extends BaseRoot{expression=this.reference;structure=void 0;get resolution(){const m=this._resolve();return nodesByRegisteredId[this.id]=m}_resolve(){if(this.resolve)return this.resolve();if(this.reference[0]==="$")return this.$.resolveRoot(this.reference.slice(1));const m=this.reference;let g=nodesByRegisteredId[m];const w=[];for(;hasArkKind(g,"context");){if(w.includes(g.id))return throwParseError(writeShallowCycleErrorMessage(g.id,w));w.push(g.id),g=nodesByRegisteredId[g.id]}return hasArkKind(g,"root")?g:throwInternalError(`Unexpected resolution for reference ${this.reference}
Seen: [${w.join("->")}] 
Resolution: ${printable(g)}`)}get resolutionId(){if(this.reference.includes("&")||this.reference.includes("=>"))return this.resolution.id;if(this.reference[0]!=="$")return this.reference;const m=this.reference.slice(1),g=this.$.resolutions[m];return typeof g=="string"?g:hasArkKind(g,"root")?g.id:throwInternalError(`Unexpected resolution for reference ${this.reference}: ${printable(g)}`)}get defaultShortDescription(){return domainDescriptions.object}innerToJsonSchema(m){return this.resolution.toJsonSchemaRecurse(m)}traverseAllows=(m,g)=>{const w=g.seen[this.reference];return w?.includes(m)?!0:(g.seen[this.reference]=append(w,m),this.resolution.traverseAllows(m,g))};traverseApply=(m,g)=>{const w=g.seen[this.reference];w?.includes(m)||(g.seen[this.reference]=append(w,m),this.resolution.traverseApply(m,g))};compile(m){const g=this.resolutionId;m.if(`ctx.seen.${g} && ctx.seen.${g}.includes(data)`,()=>m.return(!0)),m.if(`!ctx.seen.${g}`,()=>m.line(`ctx.seen.${g} = []`)),m.line(`ctx.seen.${g}.push(data)`),m.return(m.invoke(g))}}const writeShallowCycleErrorMessage=(d,m)=>`Alias '${d}' has a shallow resolution cycle: ${[...m,d].join("->")}`,Alias$1={implementation:implementation$a,Node:AliasNode};class InternalBasis extends BaseRoot{traverseApply=(m,g)=>{this.traverseAllows(m,g)||g.errorFromNodeContext(this.errorContext)};get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return compileObjectLiteral(this.errorContext)}compile(m){m.traversalKind==="Allows"?m.return(this.compiledCondition):m.if(this.compiledNegation,()=>m.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}}const implementation$9=implementNode({kind:"domain",hasAssociatedError:!0,collapsibleKey:"domain",keys:{domain:{},numberAllowsNaN:{}},normalize:d=>typeof d=="string"?{domain:d}:hasKey(d,"numberAllowsNaN")&&d.domain!=="number"?throwParseError(Domain.writeBadAllowNanMessage(d.domain)):d,applyConfig:(d,m)=>d.numberAllowsNaN===void 0&&d.domain==="number"&&m.numberAllowsNaN?{...d,numberAllowsNaN:!0}:d,defaults:{description:d=>domainDescriptions[d.domain],actual:d=>Number.isNaN(d)?"NaN":domainDescriptions[domainOf(d)]},intersections:{domain:(d,m)=>d.domain==="number"&&m.domain==="number"?d.numberAllowsNaN?m:d:Disjoint.init("domain",d,m)}});class DomainNode extends InternalBasis{requiresNaNCheck=this.domain==="number"&&!this.numberAllowsNaN;traverseAllows=this.requiresNaNCheck?m=>typeof m=="number"&&!Number.isNaN(m):m=>domainOf(m)===this.domain;compiledCondition=this.domain==="object"?'((typeof data === "object" && data !== null) || typeof data === "function")':`typeof data === "${this.domain}"${this.requiresNaNCheck?" && !Number.isNaN(data)":""}`;compiledNegation=this.domain==="object"?'((typeof data !== "object" || data === null) && typeof data !== "function")':`typeof data !== "${this.domain}"${this.requiresNaNCheck?" || Number.isNaN(data)":""}`;expression=this.numberAllowsNaN?"number | NaN":this.domain;get nestableExpression(){return this.numberAllowsNaN?`(${this.expression})`:this.expression}get defaultShortDescription(){return domainDescriptions[this.domain]}innerToJsonSchema(m){return this.domain==="bigint"||this.domain==="symbol"?m.fallback.domain({code:"domain",base:{},domain:this.domain}):{type:this.domain}}}const Domain={implementation:implementation$9,Node:DomainNode,writeBadAllowNanMessage:d=>`numberAllowsNaN may only be specified with domain "number" (was ${d})`},implementation$8=implementNode({kind:"intersection",hasAssociatedError:!0,normalize:d=>{if(isNode$1(d))return d;const{structure:m,...g}=d,w=!!m,$=m??{},I=flatMorph(g,(D,F)=>isKeyOf(D,structureKeys)?(w&&throwParseError(`Flattened structure key ${D} cannot be specified alongside a root 'structure' key.`),$[D]=F,[]):[D,F]);return(hasArkKind($,"constraint")||!isEmptyObject($))&&(I.structure=$),I},finalizeInnerJson:({structure:d,...m})=>hasDomain(d,"object")?{...d,...m}:m,keys:{domain:{child:!0,parse:(d,m)=>m.$.node("domain",d)},proto:{child:!0,parse:(d,m)=>m.$.node("proto",d)},structure:{child:!0,parse:(d,m)=>m.$.node("structure",d),serialize:d=>{if(!d.sequence?.minLength)return d.collapsibleJson;const{sequence:m,...g}=d.collapsibleJson,{minVariadicLength:w,...$}=m,I=$.variadic&&Object.keys($).length===1?$.variadic:$;return{...g,sequence:I}}},divisor:{child:!0,parse:constraintKeyParser("divisor")},max:{child:!0,parse:constraintKeyParser("max")},min:{child:!0,parse:constraintKeyParser("min")},maxLength:{child:!0,parse:constraintKeyParser("maxLength")},minLength:{child:!0,parse:constraintKeyParser("minLength")},exactLength:{child:!0,parse:constraintKeyParser("exactLength")},before:{child:!0,parse:constraintKeyParser("before")},after:{child:!0,parse:constraintKeyParser("after")},pattern:{child:!0,parse:constraintKeyParser("pattern")},predicate:{child:!0,parse:constraintKeyParser("predicate")}},reduce:(d,m)=>intersectIntersections({},d,{$:m,invert:!1,pipe:!1}),defaults:{description:d=>{if(d.children.length===0)return"unknown";if(d.structure)return d.structure.description;const m=[];if(d.basis&&!d.prestructurals.some(g=>g.impl.obviatesBasisDescription)&&m.push(d.basis.description),d.prestructurals.length){const g=d.prestructurals.toSorted((w,$)=>w.kind==="min"&&$.kind==="max"?-1:0).map(w=>w.description);m.push(...g)}return d.inner.predicate&&m.push(...d.inner.predicate.map(g=>g.description)),m.join(" and ")},expected:d=>`  â—¦ ${d.errors.map(m=>m.expected).join(`
  â—¦ `)}`,problem:d=>`(${d.actual}) must be...
${d.expected}`},intersections:{intersection:(d,m,g)=>intersectIntersections(d.inner,m.inner,g),...defineRightwardIntersections("intersection",(d,m,g)=>{if(d.children.length===0)return m;const{domain:w,proto:$,...I}=d.inner,D=$??w,F=D?intersectOrPipeNodes(D,m,g):m;return F instanceof Disjoint?F:d?.basis?.equals(F)?d:d.$.node("intersection",{...I,[F.kind]:F},{prereduced:!0})})}});class IntersectionNode extends BaseRoot{basis=this.inner.domain??this.inner.proto??null;prestructurals=[];refinements=this.children.filter(m=>m.isRefinement()?(includes(prestructuralKinds,m.kind)&&this.prestructurals.push(m),!0):!1);structure=this.inner.structure;expression=writeIntersectionExpression(this);get shallowMorphs(){return this.inner.structure?.structuralMorph?[this.inner.structure.structuralMorph]:[]}get defaultShortDescription(){return this.basis?.defaultShortDescription??"present"}innerToJsonSchema(m){return this.children.reduce((g,w)=>w.isBasis()?w.toJsonSchemaRecurse(m):w.reduceJsonSchema(g,m),{})}traverseAllows=(m,g)=>this.children.every(w=>w.traverseAllows(m,g));traverseApply=(m,g)=>{const w=g.currentErrorCount;if(!(this.basis&&(this.basis.traverseApply(m,g),g.currentErrorCount>w))){if(this.prestructurals.length){for(let $=0;$<this.prestructurals.length-1;$++)if(this.prestructurals[$].traverseApply(m,g),g.failFast&&g.currentErrorCount>w)return;if(this.prestructurals.at(-1).traverseApply(m,g),g.currentErrorCount>w)return}if(!(this.structure&&(this.structure.traverseApply(m,g),g.currentErrorCount>w))&&this.inner.predicate){for(let $=0;$<this.inner.predicate.length-1;$++)if(this.inner.predicate[$].traverseApply(m,g),g.failFast&&g.currentErrorCount>w)return;this.inner.predicate.at(-1).traverseApply(m,g)}}};compile(m){if(m.traversalKind==="Allows"){for(const g of this.children)m.check(g);m.return(!0);return}if(m.initializeErrorCount(),this.basis&&(m.check(this.basis),this.children.length>1&&m.returnIfFail()),this.prestructurals.length){for(let g=0;g<this.prestructurals.length-1;g++)m.check(this.prestructurals[g]),m.returnIfFailFast();m.check(this.prestructurals.at(-1)),(this.structure||this.inner.predicate)&&m.returnIfFail()}if(this.structure&&(m.check(this.structure),this.inner.predicate&&m.returnIfFail()),this.inner.predicate){for(let g=0;g<this.inner.predicate.length-1;g++)m.check(this.inner.predicate[g]),m.returnIfFail();m.check(this.inner.predicate.at(-1))}}}const Intersection={implementation:implementation$8,Node:IntersectionNode},writeIntersectionExpression=d=>{if(d.structure?.expression)return d.structure.expression;const m=d.basis&&!d.prestructurals.some($=>$.impl.obviatesBasisExpression)?d.basis.nestableExpression:"",g=d.prestructurals.map($=>$.expression).join(" & "),w=`${m}${m?" ":""}${g}`;return w==="Array == 0"?"[]":w||"unknown"},intersectIntersections=(d,m,g)=>{const w={},$=d.proto??d.domain,I=m.proto??m.domain,D=$?I?intersectOrPipeNodes($,I,g):$:I;return D instanceof Disjoint?D:(D&&(w[D.kind]=D),intersectConstraints({kind:"intersection",baseInner:w,l:flattenConstraints(d),r:flattenConstraints(m),roots:[],ctx:g}))},implementation$7=implementNode({kind:"morph",hasAssociatedError:!1,keys:{in:{child:!0,parse:(d,m)=>m.$.parseSchema(d)},morphs:{parse:liftArray,serialize:d=>d.map(m=>hasArkKind(m,"root")?m.json:registeredReference(m))},declaredIn:{child:!1,serialize:d=>d.json},declaredOut:{child:!1,serialize:d=>d.json}},normalize:d=>d,defaults:{description:d=>`a morph from ${d.rawIn.description} to ${d.rawOut?.description??"unknown"}`},intersections:{morph:(d,m,g)=>{if(!d.hasEqualMorphs(m))return throwParseError(writeMorphIntersectionMessage(d.expression,m.expression));const w=intersectOrPipeNodes(d.rawIn,m.rawIn,g);if(w instanceof Disjoint)return w;const $={morphs:d.morphs};if(d.declaredIn||m.declaredIn){const I=intersectOrPipeNodes(d.rawIn,m.rawIn,g);if(I instanceof Disjoint)return I.throw();$.declaredIn=I}if(d.declaredOut||m.declaredOut){const I=intersectOrPipeNodes(d.rawOut,m.rawOut,g);if(I instanceof Disjoint)return I.throw();$.declaredOut=I}return w.distribute(I=>g.$.node("morph",{...$,in:I}),g.$.parseSchema)},...defineRightwardIntersections("morph",(d,m,g)=>{const w=d.inner.in?intersectOrPipeNodes(d.inner.in,m,g):m;return w instanceof Disjoint?w:w.equals(d.inner.in)?d:g.$.node("morph",{...d.inner,in:w})})}});class MorphNode extends BaseRoot{serializedMorphs=this.morphs.map(registeredReference);compiledMorphs=`[${this.serializedMorphs}]`;lastMorph=this.inner.morphs.at(-1);lastMorphIfNode=hasArkKind(this.lastMorph,"root")?this.lastMorph:void 0;introspectableIn=this.inner.in;introspectableOut=this.lastMorphIfNode?Object.assign(this.referencesById,this.lastMorphIfNode.referencesById)&&this.lastMorphIfNode.rawOut:void 0;get shallowMorphs(){return Array.isArray(this.inner.in?.shallowMorphs)?[...this.inner.in.shallowMorphs,...this.morphs]:this.morphs}get rawIn(){return this.declaredIn??this.inner.in?.rawIn??$ark.intrinsic.unknown.internal}get rawOut(){return this.declaredOut??this.introspectableOut??$ark.intrinsic.unknown.internal}declareIn(m){return this.$.node("morph",{...this.inner,declaredIn:m})}declareOut(m){return this.$.node("morph",{...this.inner,declaredOut:m})}expression=`(In: ${this.rawIn.expression}) => ${this.lastMorphIfNode?"To":"Out"}<${this.rawOut.expression}>`;get defaultShortDescription(){return this.rawIn.meta.description??this.rawIn.defaultShortDescription}innerToJsonSchema(m){return m.fallback.morph({code:"morph",base:this.rawIn.toJsonSchemaRecurse(m),out:this.introspectableOut?.toJsonSchemaRecurse(m)??null})}compile(m){if(m.traversalKind==="Allows"){if(!this.introspectableIn)return;m.return(m.invoke(this.introspectableIn));return}this.introspectableIn&&m.line(m.invoke(this.introspectableIn)),m.line(`ctx.queueMorphs(${this.compiledMorphs})`)}traverseAllows=(m,g)=>!this.introspectableIn||this.introspectableIn.traverseAllows(m,g);traverseApply=(m,g)=>{this.introspectableIn&&this.introspectableIn.traverseApply(m,g),g.queueMorphs(this.morphs)};hasEqualMorphs(m){return arrayEquals(this.morphs,m.morphs,{isEqual:(g,w)=>g===w||hasArkKind(g,"root")&&hasArkKind(w,"root")&&g.equals(w)})}}const Morph={implementation:implementation$7,Node:MorphNode},writeMorphIntersectionMessage=(d,m)=>`The intersection of distinct morphs at a single path is indeterminate:
Left: ${d}
Right: ${m}`,implementation$6=implementNode({kind:"proto",hasAssociatedError:!0,collapsibleKey:"proto",keys:{proto:{serialize:d=>getBuiltinNameOfConstructor(d)??defaultValueSerializer(d)},dateAllowsInvalid:{}},normalize:d=>{const m=typeof d=="string"?{proto:builtinConstructors[d]}:typeof d=="function"?isNode$1(d)?d:{proto:d}:typeof d.proto=="string"?{...d,proto:builtinConstructors[d.proto]}:d;return typeof m.proto!="function"&&throwParseError(Proto.writeInvalidSchemaMessage(m.proto)),hasKey(m,"dateAllowsInvalid")&&m.proto!==Date&&throwParseError(Proto.writeBadInvalidDateMessage(m.proto)),m},applyConfig:(d,m)=>d.dateAllowsInvalid===void 0&&d.proto===Date&&m.dateAllowsInvalid?{...d,dateAllowsInvalid:!0}:d,defaults:{description:d=>d.builtinName?objectKindDescriptions[d.builtinName]:`an instance of ${d.proto.name}`,actual:d=>d instanceof Date&&d.toString()==="Invalid Date"?"an invalid Date":objectKindOrDomainOf(d)},intersections:{proto:(d,m)=>d.proto===Date&&m.proto===Date?d.dateAllowsInvalid?m:d:constructorExtends(d.proto,m.proto)?d:constructorExtends(m.proto,d.proto)?m:Disjoint.init("proto",d,m),domain:(d,m)=>m.domain==="object"?d:Disjoint.init("domain",$ark.intrinsic.object.internal,m)}});class ProtoNode extends InternalBasis{builtinName=getBuiltinNameOfConstructor(this.proto);serializedConstructor=this.json.proto;requiresInvalidDateCheck=this.proto===Date&&!this.dateAllowsInvalid;traverseAllows=this.requiresInvalidDateCheck?m=>m instanceof Date&&m.toString()!=="Invalid Date":m=>m instanceof this.proto;compiledCondition=`data instanceof ${this.serializedConstructor}${this.requiresInvalidDateCheck?' && data.toString() !== "Invalid Date"':""}`;compiledNegation=`!(${this.compiledCondition})`;innerToJsonSchema(m){switch(this.builtinName){case"Array":return{type:"array"};case"Date":return m.fallback.date?.({code:"date",base:{}})??m.fallback.proto({code:"proto",base:{},proto:this.proto});default:return m.fallback.proto({code:"proto",base:{},proto:this.proto})}}expression=this.dateAllowsInvalid?"Date | InvalidDate":this.proto.name;get nestableExpression(){return this.dateAllowsInvalid?`(${this.expression})`:this.expression}domain="object";get defaultShortDescription(){return this.description}}const Proto={implementation:implementation$6,Node:ProtoNode,writeBadInvalidDateMessage:d=>`dateAllowsInvalid may only be specified with constructor Date (was ${d.name})`,writeInvalidSchemaMessage:d=>`instanceOf operand must be a function (was ${domainOf(d)})`},implementation$5=implementNode({kind:"union",hasAssociatedError:!0,collapsibleKey:"branches",keys:{ordered:{},branches:{child:!0,parse:(d,m)=>{const g=[];for(const w of d){const $=hasArkKind(w,"root")?w.branches:m.$.parseSchema(w).branches;for(const I of $)if(I.hasKind("morph")){const D=g.findIndex(F=>F.hasKind("morph")&&F.hasEqualMorphs(I));if(D===-1)g.push(I);else{const F=g[D];g[D]=m.$.node("morph",{...F.inner,in:F.rawIn.rawOr(I.rawIn)})}}else g.push(I)}return m.def.ordered||g.sort((w,$)=>w.hash<$.hash?-1:1),g}}},normalize:d=>isArray$1(d)?{branches:d}:d,reduce:(d,m)=>{const g=reduceBranches(d);if(g.length===1)return g[0];if(g.length!==d.branches.length)return m.node("union",{...d,branches:g},{prereduced:!0})},defaults:{description:d=>d.distribute(m=>m.description,describeBranches),expected:d=>{const m=groupBy$1(d.errors,"propString"),g=Object.entries(m).map(([w,$])=>{const I=[];for(const U of $)appendUnique(I,U.expected);const D=describeBranches(I),F=$.every(U=>U.actual===$[0].actual)?$[0].actual:printable($[0].data);return`${w&&`${w} `}must be ${D}${F&&` (was ${F})`}`});return describeBranches(g)},problem:d=>d.expected,message:d=>d.problem[0]==="["?`value at ${d.problem}`:d.problem},intersections:{union:(d,m,g)=>{if(d.isNever!==m.isNever)return Disjoint.init("presence",d,m);let w;return d.ordered?(m.ordered&&throwParseError(writeOrderedIntersectionMessage(d.expression,m.expression)),w=intersectBranches(m.branches,d.branches,g),w instanceof Disjoint&&w.invert()):w=intersectBranches(d.branches,m.branches,g),w instanceof Disjoint?w:g.$.parseSchema(d.ordered||m.ordered?{branches:w,ordered:!0}:{branches:w})},...defineRightwardIntersections("union",(d,m,g)=>{const w=intersectBranches(d.branches,[m],g);return w instanceof Disjoint?w:w.length===1?w[0]:g.$.parseSchema(d.ordered?{branches:w,ordered:!0}:{branches:w})})}});class UnionNode extends BaseRoot{isBoolean=this.branches.length===2&&this.branches[0].hasUnit(!1)&&this.branches[1].hasUnit(!0);get branchGroups(){const m=[];let g=-1;for(const w of this.branches){if(w.hasKind("unit")&&w.domain==="boolean"){g===-1?(g=m.length,m.push(w)):m[g]=$ark.intrinsic.boolean;continue}m.push(w)}return m}unitBranches=this.branches.filter(m=>m.rawIn.hasKind("unit"));discriminant=this.discriminate();discriminantJson=this.discriminant?discriminantToJson(this.discriminant):null;expression=this.distribute(m=>m.nestableExpression,expressBranches);createBranchedOptimisticRootApply(){return(m,g)=>{const w=this.traverseOptimistic(m);if(w!==unset)return w;const $=new Traversal(m,this.$.resolvedConfig);return this.traverseApply(m,$),$.finalize(g)}}get shallowMorphs(){return this.branches.reduce((m,g)=>appendUnique(m,g.shallowMorphs),[])}get defaultShortDescription(){return this.distribute(m=>m.defaultShortDescription,describeBranches)}innerToJsonSchema(m){if(this.branchGroups.length===1&&this.branchGroups[0].equals($ark.intrinsic.boolean))return{type:"boolean"};const g=this.branchGroups.map(w=>w.toJsonSchemaRecurse(m));return g.every(w=>Object.keys(w).length===1&&hasKey(w,"const"))?{enum:g.map(w=>w.const)}:{anyOf:g}}traverseAllows=(m,g)=>this.branches.some(w=>w.traverseAllows(m,g));traverseApply=(m,g)=>{const w=[];for(let $=0;$<this.branches.length;$++){if(g.pushBranch(),this.branches[$].traverseApply(m,g),!g.hasError())return this.branches[$].includesTransform?g.queuedMorphs.push(...g.popBranch().queuedMorphs):g.popBranch();w.push(g.popBranch().error)}g.errorFromNodeContext({code:"union",errors:w,meta:this.meta})};traverseOptimistic=m=>{for(let g=0;g<this.branches.length;g++){const w=this.branches[g];if(w.traverseAllows(m))return w.contextFreeMorph?w.contextFreeMorph(m):m}return unset};compile(m){if(!this.discriminant||this.unitBranches.length===this.branches.length&&this.branches.length===2)return this.compileIndiscriminable(m);let g=this.discriminant.optionallyChainedPropString;this.discriminant.kind==="domain"&&(g=`typeof ${g} === "object" ? ${g} === null ? "null" : "object" : typeof ${g} === "function" ? "object" : typeof ${g}`);const w=this.discriminant.cases,$=Object.keys(w),{optimistic:I}=m;if(m.optimistic=!1,m.block(`switch(${g})`,()=>{for(const j in w){const G=w[j],H=j==="default"?j:`case ${j}`;let V;G===!0?V=I?"data":"true":I?G.rootApplyStrategy==="branchedOptimistic"?V=m.invoke(G,{kind:"Optimistic"}):G.contextFreeMorph?V=`${m.invoke(G)} ? ${registeredReference(G.contextFreeMorph)}(data) : "${unset}"`:V=`${m.invoke(G)} ? data : "${unset}"`:V=m.invoke(G),m.line(`${H}: return ${V}`)}return m}),m.traversalKind==="Allows"){m.return(I?`"${unset}"`:!1);return}const D=describeBranches(this.discriminant.kind==="domain"?$.map(j=>{const G=j.slice(1,-1);return G==="function"?domainDescriptions.object:domainDescriptions[G]}):$),F=this.discriminant.path.map(j=>typeof j=="symbol"?registeredReference(j):JSON.stringify(j)),U=JSON.stringify(D),q=this.discriminant.kind==="domain"?`${serializedTypeOfDescriptions}[${g}]`:`${serializedPrintable}(${g})`;m.line(`ctx.errorFromNodeContext({
	code: "predicate",
	expected: ${U},
	actual: ${q},
	relativePath: [${F}],
	meta: ${this.compiledMeta}
})`)}compileIndiscriminable(m){if(m.traversalKind==="Apply"){m.const("errors","[]");for(const g of this.branches)m.line("ctx.pushBranch()").line(m.invoke(g)).if("!ctx.hasError()",()=>m.return(g.includesTransform?"ctx.queuedMorphs.push(...ctx.popBranch().queuedMorphs)":"ctx.popBranch()")).line("errors.push(ctx.popBranch().error)");m.line(`ctx.errorFromNodeContext({ code: "union", errors, meta: ${this.compiledMeta} })`)}else{const{optimistic:g}=m;m.optimistic=!1;for(const w of this.branches)m.if(`${m.invoke(w)}`,()=>m.return(g?w.contextFreeMorph?`${registeredReference(w.contextFreeMorph)}(data)`:"data":!0));m.return(g?`"${unset}"`:!1)}}get nestableExpression(){return this.isBoolean?"boolean":`(${this.expression})`}discriminate(){if(this.branches.length<2||this.isCyclic)return null;if(this.unitBranches.length===this.branches.length){const I=flatMorph(this.unitBranches,(D,F)=>[`${F.rawIn.serializedValue}`,F.hasKind("morph")?F:!0]);return{kind:"unit",path:[],optionallyChainedPropString:"data",cases:I}}const m=[];for(let I=0;I<this.branches.length-1;I++){const D=this.branches[I];for(let F=I+1;F<this.branches.length;F++){const U=this.branches[F],q=intersectNodesRoot(D.rawIn,U.rawIn,D.$);if(q instanceof Disjoint)for(const j of q){if(!j.kind||j.optional)continue;let G,H;if(j.kind==="domain"){const Z=j.l,Q=j.r;G=`"${typeof Z=="string"?Z:Z.domain}"`,H=`"${typeof Q=="string"?Q:Q.domain}"`}else if(j.kind==="unit")G=j.l.serializedValue,H=j.r.serializedValue;else continue;const V=m.find(Z=>arrayEquals(Z.path,j.path)&&Z.kind===j.kind);V?(V.cases[G]?V.cases[G].branchIndices=appendUnique(V.cases[G].branchIndices,I):V.cases[G]??={branchIndices:[I],condition:j.l},V.cases[H]?V.cases[H].branchIndices=appendUnique(V.cases[H].branchIndices,F):V.cases[H]??={branchIndices:[F],condition:j.r}):m.push({kind:j.kind,cases:{[G]:{branchIndices:[I],condition:j.l},[H]:{branchIndices:[F],condition:j.r}},path:j.path})}}}const g=this.ordered?viableOrderedCandidates(m,this.branches):m;if(!g.length)return null;const w=createCaseResolutionContext(g,this),$={};for(const I in w.best.cases){const D=resolveCase(w,I);if(D===null){$[I]=!0;continue}if(D.length===this.branches.length)return null;this.ordered&&D.sort((q,j)=>q.originalIndex-j.originalIndex);const F=D.map(q=>q.branch),U=F.length===1?F[0]:this.$.node("union",this.ordered?{branches:F,ordered:!0}:F);Object.assign(this.referencesById,U.referencesById),$[I]=U}if(w.defaultEntries.length){const I=w.defaultEntries.map(D=>D.branch);$.default=this.$.node("union",this.ordered?{branches:I,ordered:!0}:I,{prereduced:!0}),Object.assign(this.referencesById,$.default.referencesById)}return Object.assign(w.location,{cases:$})}}const createCaseResolutionContext=(d,m)=>{const w=d.sort((D,F)=>D.path.length===F.path.length?Object.keys(F.cases).length-Object.keys(D.cases).length:D.path.length-F.path.length)[0],$={kind:w.kind,path:w.path,optionallyChainedPropString:optionallyChainPropString(w.path)},I=m.branches.map((D,F)=>({originalIndex:F,branch:D}));return{best:w,location:$,defaultEntries:I,node:m}},resolveCase=(d,m)=>{const g=d.best.cases[m],w=discriminantCaseToNode(g.condition,d.location.path,d.node.$);let $=[];const I=[];for(let D=0;D<d.defaultEntries.length;D++){const F=d.defaultEntries[D];if(g.branchIndices.includes(F.originalIndex)){const U=pruneDiscriminant(d.node.branches[F.originalIndex],d.location);U===null?$=null:$?.push({originalIndex:F.originalIndex,branch:U})}else if(F.branch.hasKind("alias")&&w.hasKind("domain")&&w.domain==="object")$?.push(F);else{if(F.branch.rawIn.overlaps(w)){const U=pruneDiscriminant(F.branch,d.location);$?.push({originalIndex:F.originalIndex,branch:U})}I.push(F)}}return d.defaultEntries=I,$},viableOrderedCandidates=(d,m)=>d.filter(w=>{const $=Object.values(w.cases).map(I=>I.branchIndices);for(let I=0;I<$.length-1;I++){const D=$[I];for(let F=I+1;F<$.length;F++){const U=$[F];for(const q of D)for(const j of U)if(q>j&&m[q].overlaps(m[j]))return!1}}return!0}),discriminantCaseToNode=(d,m,g)=>{let w=d==="undefined"?g.node("unit",{unit:void 0}):d==="null"?g.node("unit",{unit:null}):d==="boolean"?g.units([!0,!1]):d;for(let $=m.length-1;$>=0;$--){const I=m[$];w=g.node("intersection",typeof I=="number"?{proto:"Array",sequence:[...range$1(I).map(D=>({})),w]}:{domain:"object",required:[{key:I,value:w}]})}return w},optionallyChainPropString=d=>d.reduce((m,g)=>m+compileLiteralPropAccess(g,!0),"data"),serializedTypeOfDescriptions=registeredReference(jsTypeOfDescriptions),serializedPrintable=registeredReference(printable),Union={implementation:implementation$5,Node:UnionNode},discriminantToJson=d=>({kind:d.kind,path:d.path.map(m=>typeof m=="string"?m:compileSerializedValue(m)),cases:flatMorph(d.cases,(m,g)=>[m,g===!0?g:g.hasKind("union")&&g.discriminantJson?g.discriminantJson:g.json])}),describeExpressionOptions={delimiter:" | ",finalDelimiter:" | "},expressBranches=d=>describeBranches(d,describeExpressionOptions),describeBranches=(d,m)=>{const g=m?.delimiter??", ",w=m?.finalDelimiter??" or ";if(d.length===0)return"never";if(d.length===1)return d[0];if(d.length===2&&d[0]==="false"&&d[1]==="true"||d[0]==="true"&&d[1]==="false")return"boolean";const $={},I=d.filter(F=>$[F]?!1:$[F]=!0),D=I.pop();return`${I.join(g)}${I.length?w:""}${D}`},intersectBranches=(d,m,g)=>{const w=m.map(()=>[]);for(let I=0;I<d.length;I++){let D={};for(let F=0;F<m.length;F++){if(w[F]===null)continue;if(d[I].equals(m[F])){w[F]=null,D={};break}const U=intersectOrPipeNodes(d[I],m[F],g);if(!(U instanceof Disjoint)){if(U.equals(d[I])){w[F].push(d[I]),D={};break}U.equals(m[F])?w[F]=null:D[F]=U}}for(const F in D)w[F][I]=D[F]}const $=w.flatMap((I,D)=>I?.flatMap(F=>F.branches)??m[D]);return $.length===0?Disjoint.init("union",d,m):$},reduceBranches=({branches:d,ordered:m})=>{if(d.length<2)return d;const g=d.map(()=>!0);for(let w=0;w<d.length;w++)for(let $=w+1;$<d.length&&g[w]&&g[$];$++){if(d[w].equals(d[$])){g[$]=!1;continue}const I=intersectNodesRoot(d[w].rawIn,d[$].rawIn,d[0].$);I instanceof Disjoint||(m||assertDeterminateOverlap(d[w],d[$]),I.equals(d[w].rawIn)?g[w]=!!m:I.equals(d[$].rawIn)&&(g[$]=!1))}return d.filter((w,$)=>g[$])},assertDeterminateOverlap=(d,m)=>{!d.includesTransform&&!m.includesTransform||(arrayEquals(d.shallowMorphs,m.shallowMorphs)||throwParseError(writeIndiscriminableMorphMessage(d.expression,m.expression)),arrayEquals(d.flatMorphs,m.flatMorphs,{isEqual:(g,w)=>g.propString===w.propString&&(g.node.hasKind("morph")&&w.node.hasKind("morph")?g.node.hasEqualMorphs(w.node):g.node.hasKind("intersection")&&w.node.hasKind("intersection")?g.node.structure?.structuralMorphRef===w.node.structure?.structuralMorphRef:!1)})||throwParseError(writeIndiscriminableMorphMessage(d.expression,m.expression)))},pruneDiscriminant=(d,m)=>d.transform((g,w)=>g==="domain"||g==="unit"?null:w,{shouldTransform:(g,w)=>{const $=optionallyChainPropString(w.path);return m.optionallyChainedPropString.startsWith($)?g.hasKind("domain")&&g.domain==="object"||(g.hasKind("domain")||m.kind==="unit")&&$===m.optionallyChainedPropString?!0:g.children.length!==0&&g.kind!=="index":!1}}),writeIndiscriminableMorphMessage=(d,m)=>`An unordered union of a type including a morph and a type with overlapping input is indeterminate:
Left: ${d}
Right: ${m}`,writeOrderedIntersectionMessage=(d,m)=>`The intersection of two ordered unions is indeterminate:
Left: ${d}
Right: ${m}`,implementation$4=implementNode({kind:"unit",hasAssociatedError:!0,keys:{unit:{preserveUndefined:!0,serialize:d=>d instanceof Date?d.toISOString():defaultValueSerializer(d)}},normalize:d=>d,defaults:{description:d=>printable(d.unit),problem:({expected:d,actual:m})=>`${d===m?`must be reference equal to ${d} (serialized to the same value)`:`must be ${d} (was ${m})`}`},intersections:{unit:(d,m)=>Disjoint.init("unit",d,m),...defineRightwardIntersections("unit",(d,m)=>{if(m.allows(d.unit))return d;const g=m.hasKind("intersection")?m.basis:m;if(g){const w=g.hasKind("domain")?g:$ark.intrinsic.object;if(d.domain!==w.domain){const $=d.domain==="undefined"||d.domain==="null"||d.domain==="boolean"?d.domain:$ark.intrinsic[d.domain];return Disjoint.init("domain",$,w)}}return Disjoint.init("assignability",d,m.hasKind("intersection")?m.children.find(w=>!w.allows(d.unit)):m)})}});class UnitNode extends InternalBasis{compiledValue=this.json.unit;serializedValue=typeof this.unit=="string"||this.unit instanceof Date?JSON.stringify(this.compiledValue):`${this.compiledValue}`;compiledCondition=compileEqualityCheck(this.unit,this.serializedValue);compiledNegation=compileEqualityCheck(this.unit,this.serializedValue,"negated");expression=printable(this.unit);domain=domainOf(this.unit);get defaultShortDescription(){return this.domain==="object"?domainDescriptions.object:this.description}innerToJsonSchema(m){return this.unit===null?{type:"null"}:$ark.intrinsic.jsonPrimitive.allows(this.unit)?{const:this.unit}:m.fallback.unit({code:"unit",base:{},unit:this.unit})}traverseAllows=this.unit instanceof Date?m=>m instanceof Date&&m.toISOString()===this.compiledValue:Number.isNaN(this.unit)?m=>Number.isNaN(m):m=>m===this.unit}const Unit={implementation:implementation$4,Node:UnitNode},compileEqualityCheck=(d,m,g)=>{if(d instanceof Date){const w=`data instanceof Date && data.toISOString() === ${m}`;return g?`!(${w})`:w}return Number.isNaN(d)?`${g?"!":""}Number.isNaN(data)`:`data ${g?"!":"="}== ${m}`},implementation$3=implementNode({kind:"index",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{signature:{child:!0,parse:(d,m)=>{const g=m.$.parseSchema(d);if(!g.extends($ark.intrinsic.key))return throwParseError(writeInvalidPropertyKeyMessage(g.expression));const w=g.branches.filter($=>$.hasKind("unit"));return w.length?throwParseError(writeEnumerableIndexBranches(w.map($=>printable($.unit)))):g}},value:{child:!0,parse:(d,m)=>m.$.parseSchema(d)}},normalize:d=>d,defaults:{description:d=>`[${d.signature.expression}]: ${d.value.description}`},intersections:{index:(d,m,g)=>{if(d.signature.equals(m.signature)){const w=intersectOrPipeNodes(d.value,m.value,g),$=w instanceof Disjoint?$ark.intrinsic.never.internal:w;return g.$.node("index",{signature:d.signature,value:$})}return d.signature.extends(m.signature)&&d.value.subsumes(m.value)?m:m.signature.extends(d.signature)&&m.value.subsumes(d.value)?d:null}}});class IndexNode extends BaseConstraint{impliedBasis=$ark.intrinsic.object.internal;expression=`[${this.signature.expression}]: ${this.value.expression}`;flatRefs=append(this.value.flatRefs.map(m=>flatRef([this.signature,...m.path],m.node)),flatRef([this.signature],this.value));traverseAllows=(m,g)=>stringAndSymbolicEntriesOf(m).every(w=>this.signature.traverseAllows(w[0],g)?traverseKey(w[0],()=>this.value.traverseAllows(w[1],g),g):!0);traverseApply=(m,g)=>{for(const w of stringAndSymbolicEntriesOf(m))this.signature.traverseAllows(w[0],g)&&traverseKey(w[0],()=>this.value.traverseApply(w[1],g),g)};_transform(m,g){g.path.push(this.signature);const w=super._transform(m,g);return g.path.pop(),w}compile(){}}const Index={implementation:implementation$3,Node:IndexNode},writeEnumerableIndexBranches=d=>`Index keys ${d.join(", ")} should be specified as named props.`,writeInvalidPropertyKeyMessage=d=>`Indexed key definition '${d}' must be a string or symbol`,implementation$2=implementNode({kind:"required",hasAssociatedError:!0,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(d,m)=>m.$.parseSchema(d)}},normalize:d=>d,defaults:{description:d=>`${d.compiledKey}: ${d.value.description}`,expected:d=>d.missingValueDescription,actual:()=>"missing"},intersections:{required:intersectProps,optional:intersectProps}});class RequiredNode extends BaseProp{expression=`${this.compiledKey}: ${this.value.expression}`;errorContext=Object.freeze({code:"required",missingValueDescription:this.value.defaultShortDescription,relativePath:[this.key],meta:this.meta});compiledErrorContext=compileObjectLiteral(this.errorContext)}const Required$1={implementation:implementation$2,Node:RequiredNode},implementation$1=implementNode({kind:"sequence",hasAssociatedError:!1,collapsibleKey:"variadic",keys:{prefix:{child:!0,parse:(d,m)=>{if(d.length!==0)return d.map(g=>m.$.parseSchema(g))}},optionals:{child:!0,parse:(d,m)=>{if(d.length!==0)return d.map(g=>m.$.parseSchema(g))}},defaultables:{child:d=>d.map(m=>m[0]),parse:(d,m)=>{if(d.length!==0)return d.map(g=>{const w=m.$.parseSchema(g[0]);return assertDefaultValueAssignability(w,g[1],null),[w,g[1]]})},serialize:d=>d.map(m=>[m[0].collapsibleJson,defaultValueSerializer(m[1])]),reduceIo:(d,m,g)=>{if(d==="in"){m.optionals=g.map(w=>w[0].rawIn);return}m.prefix=g.map(w=>w[0].rawOut)}},variadic:{child:!0,parse:(d,m)=>m.$.parseSchema(d,m)},minVariadicLength:{parse:d=>d===0?void 0:d},postfix:{child:!0,parse:(d,m)=>{if(d.length!==0)return d.map(g=>m.$.parseSchema(g))}}},normalize:d=>{if(typeof d=="string")return{variadic:d};if("variadic"in d||"prefix"in d||"defaultables"in d||"optionals"in d||"postfix"in d||"minVariadicLength"in d){if(d.postfix?.length){if(!d.variadic)return throwParseError(postfixWithoutVariadicMessage);if(d.optionals?.length||d.defaultables?.length)return throwParseError(postfixAfterOptionalOrDefaultableMessage)}return d.minVariadicLength&&!d.variadic?throwParseError("minVariadicLength may not be specified without a variadic element"):d}return{variadic:d}},reduce:(d,m)=>{let g=d.minVariadicLength??0;const w=d.prefix?.slice()??[],$=d.defaultables?.slice()??[],I=d.optionals?.slice()??[],D=d.postfix?.slice()??[];if(d.variadic){for(;I.at(-1)?.equals(d.variadic);)I.pop();if(I.length===0&&$.length===0)for(;w.at(-1)?.equals(d.variadic);)w.pop(),g++;for(;D[0]?.equals(d.variadic);)D.shift(),g++}else I.length===0&&$.length===0&&w.push(...D.splice(0));if(g!==d.minVariadicLength||d.prefix&&d.prefix.length!==w.length)return m.node("sequence",{...d,prefix:w,defaultables:$,optionals:I,postfix:D,minVariadicLength:g},{prereduced:!0})},defaults:{description:d=>d.isVariadicOnly?`${d.variadic.nestableExpression}[]`:`[${d.tuple.map(g=>g.kind==="defaultables"?`${g.node.nestableExpression} = ${printable(g.default)}`:g.kind==="optionals"?`${g.node.nestableExpression}?`:g.kind==="variadic"?`...${g.node.nestableExpression}[]`:g.node.expression).join(", ")}]`},intersections:{sequence:(d,m,g)=>{const w=_intersectSequences({l:d.tuple,r:m.tuple,disjoint:new Disjoint,result:[],fixedVariants:[],ctx:g}),$=w.disjoint.length===0?[w,...w.fixedVariants]:w.fixedVariants;return $.length===0?w.disjoint:$.length===1?g.$.node("sequence",sequenceTupleToInner($[0].result)):g.$.node("union",$.map(I=>({proto:Array,sequence:sequenceTupleToInner(I.result)})))}}});class SequenceNode extends BaseConstraint{impliedBasis=$ark.intrinsic.Array.internal;tuple=sequenceInnerToTuple(this.inner);prefixLength=this.prefix?.length??0;defaultablesLength=this.defaultables?.length??0;optionalsLength=this.optionals?.length??0;postfixLength=this.postfix?.length??0;defaultablesAndOptionals=[];prevariadic=this.tuple.filter(m=>m.kind==="defaultables"||m.kind==="optionals"?(this.defaultablesAndOptionals.push(m.node),!0):m.kind==="prefix");variadicOrPostfix=conflatenate(this.variadic&&[this.variadic],this.postfix);flatRefs=this.addFlatRefs();addFlatRefs(){return appendUniqueFlatRefs(this.flatRefs,this.prevariadic.flatMap((m,g)=>append(m.node.flatRefs.map(w=>flatRef([`${g}`,...w.path],w.node)),flatRef([`${g}`],m.node)))),appendUniqueFlatRefs(this.flatRefs,this.variadicOrPostfix.flatMap(m=>append(m.flatRefs.map(g=>flatRef([$ark.intrinsic.nonNegativeIntegerString.internal,...g.path],g.node)),flatRef([$ark.intrinsic.nonNegativeIntegerString.internal],m)))),this.flatRefs}isVariadicOnly=this.prevariadic.length+this.postfixLength===0;minVariadicLength=this.inner.minVariadicLength??0;minLength=this.prefixLength+this.minVariadicLength+this.postfixLength;minLengthNode=this.minLength===0?null:this.$.node("minLength",this.minLength);maxLength=this.variadic?null:this.tuple.length;maxLengthNode=this.maxLength===null?null:this.$.node("maxLength",this.maxLength);impliedSiblings=this.minLengthNode?this.maxLengthNode?[this.minLengthNode,this.maxLengthNode]:[this.minLengthNode]:this.maxLengthNode?[this.maxLengthNode]:[];defaultValueMorphs=getDefaultableMorphs(this);defaultValueMorphsReference=this.defaultValueMorphs.length?registeredReference(this.defaultValueMorphs):void 0;elementAtIndex(m,g){if(g<this.prevariadic.length)return this.tuple[g];const w=m.length-this.postfixLength;return g>=w?{kind:"postfix",node:this.postfix[g-w]}:{kind:"variadic",node:this.variadic??throwInternalError(`Unexpected attempt to access index ${g} on ${this}`)}}traverseAllows=(m,g)=>{for(let w=0;w<m.length;w++)if(!this.elementAtIndex(m,w).node.traverseAllows(m[w],g))return!1;return!0};traverseApply=(m,g)=>{let w=0;for(;w<m.length;w++)traverseKey(w,()=>this.elementAtIndex(m,w).node.traverseApply(m[w],g),g)};get element(){return this.cacheGetter("element",this.$.node("union",this.children))}compile(m){if(this.prefix)for(const[g,w]of this.prefix.entries())m.traverseKey(`${g}`,`data[${g}]`,w);for(const[g,w]of this.defaultablesAndOptionals.entries()){const $=`${g+this.prefixLength}`;m.if(`${$} >= data.length`,()=>m.traversalKind==="Allows"?m.return(!0):m.return()),m.traverseKey($,`data[${$}]`,w)}if(this.variadic&&(this.postfix&&m.const("firstPostfixIndex",`data.length${this.postfix?`- ${this.postfix.length}`:""}`),m.for(`i < ${this.postfix?"firstPostfixIndex":"data.length"}`,()=>m.traverseKey("i","data[i]",this.variadic),this.prevariadic.length),this.postfix))for(const[g,w]of this.postfix.entries()){const $=`firstPostfixIndex + ${g}`;m.traverseKey($,`data[${$}]`,w)}m.traversalKind==="Allows"&&m.return(!0)}_transform(m,g){g.path.push($ark.intrinsic.nonNegativeIntegerString.internal);const w=super._transform(m,g);return g.path.pop(),w}expression=this.description;reduceJsonSchema(m,g){if(this.prevariadic.length&&(m.prefixItems=this.prevariadic.map(w=>{const $=w.node.toJsonSchemaRecurse(g);if(w.kind==="defaultables"){const I=typeof w.default=="function"?w.default():w.default;$.default=$ark.intrinsic.jsonData.allows(I)?I:g.fallback.defaultValue({code:"defaultValue",base:$,value:I})}return $})),this.minLength&&(m.minItems=this.minLength),this.variadic){const w=Object.assign(m,{items:this.variadic.toJsonSchemaRecurse(g)});if(this.maxLength&&(w.maxItems=this.maxLength),this.postfix){const $=this.postfix.map(I=>I.toJsonSchemaRecurse(g));m=g.fallback.arrayPostfix({code:"arrayPostfix",base:w,elements:$})}}else m.items=!1,delete m.maxItems;return m}}const defaultableMorphsCache$1={},getDefaultableMorphs=d=>{if(!d.defaultables)return[];const m=[];let g="[";const w=d.prefixLength+d.defaultablesLength-1;for(let $=d.prefixLength;$<=w;$++){const[I,D]=d.defaultables[$-d.prefixLength];m.push(computeDefaultValueMorph($,I,D)),g+=`${$}: ${I.id} = ${defaultValueSerializer(D)}, `}return g+="]",defaultableMorphsCache$1[g]??=m},Sequence={implementation:implementation$1,Node:SequenceNode},sequenceInnerToTuple=d=>{const m=[];if(d.prefix)for(const g of d.prefix)m.push({kind:"prefix",node:g});if(d.defaultables)for(const[g,w]of d.defaultables)m.push({kind:"defaultables",node:g,default:w});if(d.optionals)for(const g of d.optionals)m.push({kind:"optionals",node:g});if(d.variadic&&m.push({kind:"variadic",node:d.variadic}),d.postfix)for(const g of d.postfix)m.push({kind:"postfix",node:g});return m},sequenceTupleToInner=d=>d.reduce((m,g)=>(g.kind==="variadic"?m.variadic=g.node:g.kind==="defaultables"?m.defaultables=append(m.defaultables,[[g.node,g.default]]):m[g.kind]=append(m[g.kind],g.node),m),{}),postfixAfterOptionalOrDefaultableMessage="A postfix required element cannot follow an optional or defaultable element",postfixWithoutVariadicMessage="A postfix element requires a variadic element",_intersectSequences=d=>{const[m,...g]=d.l,[w,...$]=d.r;if(!m||!w)return d;const I=g.at(-1)?.kind==="postfix",D=$.at(-1)?.kind==="postfix",F=m.kind==="prefix"||w.kind==="prefix"?"prefix":m.kind==="postfix"||w.kind==="postfix"?"postfix":m.kind==="variadic"&&w.kind==="variadic"?"variadic":I||D?"prefix":m.kind==="defaultables"||w.kind==="defaultables"?"defaultables":"optionals";if(m.kind==="prefix"&&w.kind==="variadic"&&D){const G=_intersectSequences({...d,fixedVariants:[],r:$.map(H=>({...H,kind:"prefix"}))});G.disjoint.length===0&&d.fixedVariants.push(G)}else if(w.kind==="prefix"&&m.kind==="variadic"&&I){const G=_intersectSequences({...d,fixedVariants:[],l:g.map(H=>({...H,kind:"prefix"}))});G.disjoint.length===0&&d.fixedVariants.push(G)}const U=intersectOrPipeNodes(m.node,w.node,d.ctx);if(U instanceof Disjoint)if(F==="prefix"||F==="postfix")d.disjoint.push(...U.withPrefixKey(F==="prefix"?d.result.length:`-${g.length+1}`,elementIsRequired(m)&&elementIsRequired(w)?"required":"optional")),d.result=[...d.result,{kind:F,node:$ark.intrinsic.never.internal}];else return F==="optionals"||F==="defaultables"?d:_intersectSequences({...d,fixedVariants:[],l:g.map(G=>({...G,kind:"prefix"})),r:g.map(G=>({...G,kind:"prefix"}))});else F==="defaultables"?(m.kind==="defaultables"&&w.kind==="defaultables"&&m.default!==w.default&&throwParseError(writeDefaultIntersectionMessage(m.default,w.default)),d.result=[...d.result,{kind:F,node:U,default:m.kind==="defaultables"?m.default:w.kind==="defaultables"?w.default:throwInternalError(`Unexpected defaultable intersection from ${m.kind} and ${w.kind} elements.`)}]):d.result=[...d.result,{kind:F,node:U}];const q=d.l.length,j=d.r.length;return(m.kind!=="variadic"||q>=j&&(w.kind==="variadic"||j===1))&&(d.l=g),(w.kind!=="variadic"||j>=q&&(m.kind==="variadic"||q===1))&&(d.r=$),_intersectSequences(d)},elementIsRequired=d=>d.kind==="prefix"||d.kind==="postfix",createStructuralWriter=d=>m=>{if(m.props.length||m.index){const g=m.index?.map($=>$[d])??[];for(const $ of m.props)g.push($[d]);m.undeclared&&g.push(`+ (undeclared): ${m.undeclared}`);const w=`{ ${g.join(", ")} }`;return m.sequence?`${w} & ${m.sequence.description}`:w}return m.sequence?.description??"{}"},structuralDescription=createStructuralWriter("description"),structuralExpression=createStructuralWriter("expression"),intersectPropsAndIndex=(d,m,g)=>{const w=d.required?"required":"optional";if(!m.signature.allows(d.key))return null;const $=intersectNodesRoot(d.value,m.value,g);return $ instanceof Disjoint?w==="optional"?g.node("optional",{key:d.key,value:$ark.intrinsic.never.internal}):$.withPrefixKey(d.key,d.kind):null},implementation=implementNode({kind:"structure",hasAssociatedError:!1,normalize:d=>d,applyConfig:(d,m)=>!d.undeclared&&m.onUndeclaredKey!=="ignore"?{...d,undeclared:m.onUndeclaredKey}:d,keys:{required:{child:!0,parse:constraintKeyParser("required"),reduceIo:(d,m,g)=>{m.required=append(m.required,g.map(w=>d==="in"?w.rawIn:w.rawOut))}},optional:{child:!0,parse:constraintKeyParser("optional"),reduceIo:(d,m,g)=>{if(d==="in"){m.optional=g.map(w=>w.rawIn);return}for(const w of g)m[w.outProp.kind]=append(m[w.outProp.kind],w.outProp.rawOut)}},index:{child:!0,parse:constraintKeyParser("index")},sequence:{child:!0,parse:constraintKeyParser("sequence")},undeclared:{parse:d=>d==="ignore"?void 0:d,reduceIo:(d,m,g)=>{if(g==="reject"){m.undeclared="reject";return}d==="in"?delete m.undeclared:m.undeclared="reject"}}},defaults:{description:structuralDescription},intersections:{structure:(d,m,g)=>{const w={...d.inner},$={...m.inner},I=new Disjoint;if(d.undeclared){const U=d.keyof();for(const q of m.requiredKeys)U.allows(q)||I.add("presence",$ark.intrinsic.never.internal,m.propsByKey[q].value,{path:[q]});$.optional&&($.optional=$.optional.filter(q=>U.allows(q.key))),$.index&&($.index=$.index.flatMap(q=>{if(q.signature.extends(U))return q;const j=intersectNodesRoot(U,q.signature,g.$);if(j instanceof Disjoint)return[];const G=normalizeIndex(j,q.value,g.$);return G.required&&($.required=conflatenate($.required,G.required)),G.optional&&($.optional=conflatenate($.optional,G.optional)),G.index??[]}))}if(m.undeclared){const U=m.keyof();for(const q of d.requiredKeys)U.allows(q)||I.add("presence",d.propsByKey[q].value,$ark.intrinsic.never.internal,{path:[q]});w.optional&&(w.optional=w.optional.filter(q=>U.allows(q.key))),w.index&&(w.index=w.index.flatMap(q=>{if(q.signature.extends(U))return q;const j=intersectNodesRoot(U,q.signature,g.$);if(j instanceof Disjoint)return[];const G=normalizeIndex(j,q.value,g.$);return G.required&&(w.required=conflatenate(w.required,G.required)),G.optional&&(w.optional=conflatenate(w.optional,G.optional)),G.index??[]}))}const D={};(d.undeclared||m.undeclared)&&(D.undeclared=d.undeclared==="reject"||m.undeclared==="reject"?"reject":"delete");const F=intersectConstraints({kind:"structure",baseInner:D,l:flattenConstraints(w),r:flattenConstraints($),roots:[],ctx:g});return F instanceof Disjoint&&I.push(...F),I.length?I:F}},reduce:(d,m)=>{if(d.index){if(!(d.required||d.optional))return;let g=!1;const w=d.required??[],$=d.optional??[],I=[...$];for(const D of d.index){for(const F of w){const U=intersectPropsAndIndex(F,D,m);if(U instanceof Disjoint)return U}for(const[F,U]of $.entries()){const q=intersectPropsAndIndex(U,D,m);if(q instanceof Disjoint)return q;q!==null&&(I[F]=q,g=!0)}}if(g)return m.node("structure",{...d,optional:I},{prereduced:!0})}}});class StructureNode extends BaseConstraint{impliedBasis=$ark.intrinsic.object.internal;impliedSiblings=this.children.flatMap(m=>m.impliedSiblings??[]);props=conflatenate(this.required,this.optional);propsByKey=flatMorph(this.props,(m,g)=>[g.key,g]);propsByKeyReference=registeredReference(this.propsByKey);expression=structuralExpression(this);requiredKeys=this.required?.map(m=>m.key)??[];optionalKeys=this.optional?.map(m=>m.key)??[];literalKeys=[...this.requiredKeys,...this.optionalKeys];_keyof;keyof(){if(this._keyof)return this._keyof;let m=this.$.units(this.literalKeys).branches;if(this.index)for(const{signature:g}of this.index)m=m.concat(g.branches);return this._keyof=this.$.node("union",m)}map(m){return this.$.node("structure",this.props.flatMap(m).reduce((g,w)=>{const $=this.propsByKey[w.key];if(isNode$1(w))return w.kind!=="required"&&w.kind!=="optional"?throwParseError(`Map result must have kind "required" or "optional" (was ${w.kind})`):(g[w.kind]=append(g[w.kind],w),g);const I=w.kind??$?.kind??"required",D=flatMorph(w,(F,U)=>F in Optional.implementation.keys?[F,U]:[]);return g[I]=append(g[I],this.$.node(I,D)),g},{}))}assertHasKeys(m){const g=m.filter(w=>!typeOrTermExtends(w,this.keyof()));if(g.length)return throwParseError(writeInvalidKeysMessage(this.expression,g))}get(m,...g){let w,$=!1;const I=indexerToKey(m);if((typeof I=="string"||typeof I=="symbol")&&this.propsByKey[I]&&(w=this.propsByKey[I].value,$=this.propsByKey[I].required),this.index)for(const F of this.index)typeOrTermExtends(I,F.signature)&&(w=w?.and(F.value)??F.value);if(this.sequence&&typeOrTermExtends(I,$ark.intrinsic.nonNegativeIntegerString))if(hasArkKind(I,"root"))this.sequence.variadic&&(w=w?.and(this.sequence.element)??this.sequence.element);else{const F=Number.parseInt(I);if(F<this.sequence.prevariadic.length){const U=this.sequence.prevariadic[F].node;w=w?.and(U)??U,$||=F<this.sequence.prefixLength}else if(this.sequence.variadic){const U=this.$.node("union",this.sequence.variadicOrPostfix);w=w?.and(U)??U}}if(!w)return this.sequence?.variadic&&hasArkKind(I,"root")&&I.extends($ark.intrinsic.number)?throwParseError(writeNumberIndexMessage(I.expression,this.sequence.expression)):throwParseError(writeInvalidKeysMessage(this.expression,[I]));const D=w.get(...g);return $?D:D.or($ark.intrinsic.undefined)}pick(...m){return this.assertHasKeys(m),this.$.node("structure",this.filterKeys("pick",m))}omit(...m){return this.assertHasKeys(m),this.$.node("structure",this.filterKeys("omit",m))}optionalize(){const{required:m,...g}=this.inner;return this.$.node("structure",{...g,optional:this.props.map(w=>w.hasKind("required")?this.$.node("optional",w.inner):w)})}require(){const{optional:m,...g}=this.inner;return this.$.node("structure",{...g,required:this.props.map(w=>w.hasKind("optional")?{key:w.key,value:w.value}:w)})}merge(m){const g=this.filterKeys("omit",[m.keyof()]);return m.required&&(g.required=append(g.required,m.required)),m.optional&&(g.optional=append(g.optional,m.optional)),m.index&&(g.index=append(g.index,m.index)),m.sequence&&(g.sequence=m.sequence),m.undeclared?g.undeclared=m.undeclared:delete g.undeclared,this.$.node("structure",g)}filterKeys(m,g){const w=makeRootAndArrayPropertiesMutable(this.inner),$=I=>{const D=g.some(F=>typeOrTermExtends(I,F));return m==="pick"?D:!D};return w.required&&(w.required=w.required.filter(I=>$(I.key))),w.optional&&(w.optional=w.optional.filter(I=>$(I.key))),w.index&&(w.index=w.index.filter(I=>$(I.signature))),w}traverseAllows=(m,g)=>this._traverse("Allows",m,g);traverseApply=(m,g)=>this._traverse("Apply",m,g);_traverse=(m,g,w)=>{const $=w?.currentErrorCount??0;for(let I=0;I<this.props.length;I++)if(m==="Allows"){if(!this.props[I].traverseAllows(g,w))return!1}else if(this.props[I].traverseApply(g,w),w.failFast&&w.currentErrorCount>$)return!1;if(this.sequence){if(m==="Allows"){if(!this.sequence.traverseAllows(g,w))return!1}else if(this.sequence.traverseApply(g,w),w.failFast&&w.currentErrorCount>$)return!1}if(this.index||this.undeclared==="reject"){const I=Object.keys(g);I.push(...Object.getOwnPropertySymbols(g));for(let D=0;D<I.length;D++){const F=I[D];if(this.index){for(const U of this.index)if(U.signature.traverseAllows(F,w)){if(m==="Allows"){if(!traverseKey(F,()=>U.value.traverseAllows(g[F],w),w))return!1}else if(traverseKey(F,()=>U.value.traverseApply(g[F],w),w),w.failFast&&w.currentErrorCount>$)return!1}}if(this.undeclared==="reject"&&!this.declaresKey(F)&&(m==="Allows"||(w.errorFromNodeContext({code:"predicate",expected:"removed",actual:"",relativePath:[F],meta:this.meta}),w.failFast)))return!1}}return this.structuralMorph&&w&&!w.hasError()&&w.queueMorphs([this.structuralMorph]),!0};get defaultable(){return this.cacheGetter("defaultable",this.optional?.filter(m=>m.hasDefault())??[])}declaresKey=m=>m in this.propsByKey||this.index?.some(g=>g.signature.allows(m))||this.sequence!==void 0&&$ark.intrinsic.nonNegativeIntegerString.allows(m);_compileDeclaresKey(m){const g=[];if(this.props.length&&g.push(`k in ${this.propsByKeyReference}`),this.index)for(const w of this.index)g.push(m.invoke(w.signature,{kind:"Allows",arg:"k"}));return this.sequence&&g.push("$ark.intrinsic.nonNegativeIntegerString.allows(k)"),g.join(" || ")||"false"}get structuralMorph(){return this.cacheGetter("structuralMorph",getPossibleMorph(this))}structuralMorphRef=this.structuralMorph&&registeredReference(this.structuralMorph);compile(m){m.traversalKind==="Apply"&&m.initializeErrorCount();for(const g of this.props)m.check(g),m.traversalKind==="Apply"&&m.returnIfFailFast();if(this.sequence&&(m.check(this.sequence),m.traversalKind==="Apply"&&m.returnIfFailFast()),(this.index||this.undeclared==="reject")&&(m.const("keys","Object.keys(data)"),m.line("keys.push(...Object.getOwnPropertySymbols(data))"),m.for("i < keys.length",()=>this.compileExhaustiveEntry(m))),m.traversalKind==="Allows")return m.return(!0);this.structuralMorphRef&&m.if("ctx && !ctx.hasError()",()=>(m.line("ctx.queueMorphs(["),precompileMorphs(m,this),m.line("])")))}compileExhaustiveEntry(m){if(m.const("k","keys[i]"),this.index)for(const g of this.index)m.if(`${m.invoke(g.signature,{arg:"k",kind:"Allows"})}`,()=>m.traverseKey("k","data[k]",g.value));return this.undeclared==="reject"&&m.if(`!(${this._compileDeclaresKey(m)})`,()=>m.traversalKind==="Allows"?m.return(!1):m.line(`ctx.errorFromNodeContext({ code: "predicate", expected: "removed", actual: "", relativePath: [k], meta: ${this.compiledMeta} })`).if("ctx.failFast",()=>m.return())),m}reduceJsonSchema(m,g){switch(m.type){case"object":return this.reduceObjectJsonSchema(m,g);case"array":const w=this.sequence?.reduceJsonSchema(m,g)??m;return this.props.length||this.index?g.fallback.arrayObject({code:"arrayObject",base:w,object:this.reduceObjectJsonSchema({type:"object"},g)}):w;default:return ToJsonSchema.throwInternalOperandError("structure",m)}}reduceObjectJsonSchema(m,g){if(this.props.length){m.properties={};for(const w of this.props){const $=w.value.toJsonSchemaRecurse(g);if(typeof w.key=="symbol"){g.fallback.symbolKey({code:"symbolKey",base:m,key:w.key,value:$,optional:w.optional});continue}if(w.hasDefault()){const I=typeof w.default=="function"?w.default():w.default;$.default=$ark.intrinsic.jsonData.allows(I)?I:g.fallback.defaultValue({code:"defaultValue",base:$,value:I})}m.properties[w.key]=$}this.requiredKeys.length&&m.properties&&(m.required=this.requiredKeys.filter(w=>typeof w=="string"&&w in m.properties))}if(this.index)for(const w of this.index){const $=w.value.toJsonSchemaRecurse(g);if(w.signature.equals($ark.intrinsic.string)){m.additionalProperties=$;continue}for(const I of w.signature.branches){if(!I.extends($ark.intrinsic.string)){m=g.fallback.symbolKey({code:"symbolKey",base:m,key:null,value:$,optional:!1});continue}let D={type:"string"};if(I.hasKind("morph")&&(D=g.fallback.morph({code:"morph",base:I.rawIn.toJsonSchemaRecurse(g),out:I.rawOut.toJsonSchemaRecurse(g)})),!I.hasKind("intersection"))return throwInternalError(`Unexpected index branch kind ${I.kind}.`);const{pattern:F}=I.inner;if(F){const U=Object.assign(D,{pattern:F[0].rule});for(let q=1;q<F.length;q++)D=g.fallback.patternIntersection({code:"patternIntersection",base:U,pattern:F[q].rule});m.patternProperties??={},m.patternProperties[U.pattern]=$}}}return this.undeclared&&!m.additionalProperties&&(m.additionalProperties=!1),m}}const defaultableMorphsCache={},constructStructuralMorphCacheKey=d=>{let m="";for(let g=0;g<d.defaultable.length;g++)m+=d.defaultable[g].defaultValueMorphRef;if(d.sequence?.defaultValueMorphsReference&&(m+=d.sequence?.defaultValueMorphsReference),d.undeclared==="delete"){if(m+="delete !(",d.required)for(const g of d.required)m+=g.compiledKey+" | ";if(d.optional)for(const g of d.optional)m+=g.compiledKey+" | ";if(d.index)for(const g of d.index)m+=g.signature.id+" | ";if(d.sequence)if(d.sequence.maxLength===null)m+=intrinsic.nonNegativeIntegerString.id;else for(let g=0;g<d.sequence.tuple.length;g++)m+=g+" | ";m+=")"}return m},getPossibleMorph=d=>{const m=constructStructuralMorphCacheKey(d);if(!m)return;if(defaultableMorphsCache[m])return defaultableMorphsCache[m];const g=(w,$)=>{for(let I=0;I<d.defaultable.length;I++)d.defaultable[I].key in w||d.defaultable[I].defaultValueMorph(w,$);if(d.sequence?.defaultables)for(let I=w.length-d.sequence.prefixLength;I<d.sequence.defaultables.length;I++)d.sequence.defaultValueMorphs[I](w,$);if(d.undeclared==="delete")for(const I in w)d.declaresKey(I)||delete w[I];return w};return defaultableMorphsCache[m]=g},precompileMorphs=(d,m)=>{const w=`(data${m.defaultable.some($=>$.defaultValueMorph.length===2)||m.sequence?.defaultValueMorphs.some($=>$.length===2)?", ctx":""})`;return d.block(`${w} => `,$=>{for(let I=0;I<m.defaultable.length;I++){const{serializedKey:D,defaultValueMorphRef:F}=m.defaultable[I];$.if(`!(${D} in data)`,U=>U.line(`${F}${w}`))}return m.sequence?.defaultables&&$.for(`i < ${m.sequence.defaultables.length}`,I=>I.set("data[i]",5),`data.length - ${m.sequence.prefixLength}`),m.undeclared==="delete"&&$.forIn("data",I=>I.if(`!(${m._compileDeclaresKey(I)})`,D=>D.line("delete data[k]"))),$.return("data")})},Structure={implementation,Node:StructureNode},indexerToKey=d=>(hasArkKind(d,"root")&&d.hasKind("unit")&&(d=d.unit),typeof d=="number"&&(d=`${d}`),d),writeNumberIndexMessage=(d,m)=>`${d} is not allowed as an array index on ${m}. Use the 'nonNegativeIntegerString' keyword instead.`,normalizeIndex=(d,m,g)=>{const[w,$]=spliterate(d.branches,D=>D.hasKind("unit"));if(!w.length)return{index:g.node("index",{signature:d,value:m})};const I={};for(const D of w){const F=g.node("required",{key:D.unit,value:m});I[F.kind]=append(I[F.kind],F)}return $.length&&(I.index=g.node("index",{signature:$,value:m})),I},typeKeyToString=d=>hasArkKind(d,"root")?d.expression:printable(d),writeInvalidKeysMessage=(d,m)=>`Key${m.length===1?"":"s"} ${m.map(typeKeyToString).join(", ")} ${m.length===1?"does":"do"} not exist on ${d}`,nodeImplementationsByKind={...boundImplementationsByKind,alias:Alias$1.implementation,domain:Domain.implementation,unit:Unit.implementation,proto:Proto.implementation,union:Union.implementation,morph:Morph.implementation,intersection:Intersection.implementation,divisor:Divisor.implementation,pattern:Pattern.implementation,predicate:Predicate.implementation,required:Required$1.implementation,optional:Optional.implementation,index:Index.implementation,sequence:Sequence.implementation,structure:Structure.implementation};$ark.defaultConfig=withAlphabetizedKeys(Object.assign(flatMorph(nodeImplementationsByKind,(d,m)=>[d,m.defaults]),{jitless:envHasCsp(),clone:deepClone,onUndeclaredKey:"ignore",exactOptionalPropertyTypes:!0,numberAllowsNaN:!1,dateAllowsInvalid:!1,onFail:null,keywords:{},toJsonSchema:ToJsonSchema.defaultConfig}));$ark.resolvedConfig=mergeConfigs($ark.defaultConfig,$ark.config);const nodeClassesByKind={...boundClassesByKind,alias:Alias$1.Node,domain:Domain.Node,unit:Unit.Node,proto:Proto.Node,union:Union.Node,morph:Morph.Node,intersection:Intersection.Node,divisor:Divisor.Node,pattern:Pattern.Node,predicate:Predicate.Node,required:Required$1.Node,optional:Optional.Node,index:Index.Node,sequence:Sequence.Node,structure:Structure.Node};class RootModule extends DynamicBase{get[arkKind](){return"module"}}const bindModule=(d,m)=>new RootModule(flatMorph(d,(g,w)=>[g,hasArkKind(w,"module")?bindModule(w,m):m.bindReference(w)])),schemaBranchesOf=d=>isArray$1(d)?d:"branches"in d&&isArray$1(d.branches)?d.branches:void 0,throwMismatchedNodeRootError=(d,m)=>throwParseError(`Node of kind ${m} is not valid as a ${d} definition`),writeDuplicateAliasError=d=>`#${d} duplicates public alias ${d}`,scopesByName={};$ark.ambient??={};let rawUnknownUnion;const rootScopeFnName="function $",precompile=d=>bindPrecompilation(d,precompileReferences(d)),bindPrecompilation=(d,m)=>{const g=m.write(rootScopeFnName,4),w=m.compile()();for(const $ of d)$.precompilation||($.traverseAllows=w[`${$.id}Allows`].bind(w),$.isRoot()&&!$.allowsRequiresContext&&($.allows=$.traverseAllows),$.traverseApply=w[`${$.id}Apply`].bind(w),w[`${$.id}Optimistic`]&&($.traverseOptimistic=w[`${$.id}Optimistic`].bind(w)),$.precompilation=g)},precompileReferences=d=>new CompiledFunction().return(d.reduce((m,g)=>{const w=new NodeCompiler({kind:"Allows"}).indent();g.compile(w);const $=w.write(`${g.id}Allows`),I=new NodeCompiler({kind:"Apply"}).indent();g.compile(I);const D=I.write(`${g.id}Apply`),F=`${m}${$},
${D},
`;if(!g.hasKind("union"))return F;const U=new NodeCompiler({kind:"Allows",optimistic:!0}).indent();g.compile(U);const q=U.write(`${g.id}Optimistic`);return`${F}${q},
`},`{
`)+"}");class BaseScope{config;resolvedConfig;name;get[arkKind](){return"scope"}referencesById={};references=[];resolutions={};exportedNames=[];aliases={};resolved=!1;nodesByHash={};intrinsic;constructor(m,g){this.config=mergeConfigs($ark.config,g),this.resolvedConfig=mergeConfigs($ark.resolvedConfig,g),this.name=this.resolvedConfig.name??`anonymousScope${Object.keys(scopesByName).length}`,this.name in scopesByName&&throwParseError(`A Scope already named ${this.name} already exists`),scopesByName[this.name]=this;const w=Object.entries(m).map($=>this.preparseOwnAliasEntry(...$));for(const[$,I]of w){let D=$;if($[0]==="#"?(D=$.slice(1),D in this.aliases&&throwParseError(writeDuplicateAliasError(D)),this.aliases[D]=I):(D in this.aliases&&throwParseError(writeDuplicateAliasError($)),this.aliases[D]=I,this.exportedNames.push(D)),!hasArkKind(I,"module")&&!hasArkKind(I,"generic")&&!isThunk(I)){const F=this.preparseOwnDefinitionFormat(I,{alias:D});this.resolutions[D]=hasArkKind(F,"root")?this.bindReference(F):this.createParseContext(F).id}}rawUnknownUnion??=this.node("union",{branches:["string","number","object","bigint","symbol",{unit:!0},{unit:!1},{unit:void 0},{unit:null}]},{prereduced:!0}),this.nodesByHash[rawUnknownUnion.hash]=this.node("intersection",{},{prereduced:!0}),this.intrinsic=$ark.intrinsic?flatMorph($ark.intrinsic,($,I)=>$.startsWith("json")?[]:[$,this.bindReference(I)]):{}}cacheGetter(m,g){return Object.defineProperty(this,m,{value:g}),g}get internal(){return this}_json;get json(){return this._json||this.export(),this._json}defineSchema(m){return m}generic=(...m)=>{const g=this;return(w,$)=>new GenericRoot(m,$?new LazyGenericBody(w):w,g,g,$??null)};units=(m,g)=>{const w=[];for(const I of m)w.includes(I)||w.push(I);const $=w.map(I=>this.node("unit",{unit:I},g));return this.node("union",$,{...g,prereduced:!0})};lazyResolutions=[];lazilyResolve(m,g){const w=this.node("alias",{reference:g??"synthetic",resolve:m},{prereduced:!0});return this.resolved||this.lazyResolutions.push(w),w}schema=(m,g)=>this.finalize(this.parseSchema(m,g));parseSchema=(m,g)=>this.node(schemaKindOf(m),m,g);preparseNode(m,g,w){let $=typeof m=="string"?m:schemaKindOf(g,m);if(isNode$1(g)&&g.kind===$)return g;if($==="alias"&&!w?.prereduced){const{reference:F}=Alias$1.implementation.normalize(g,this);if(F.startsWith("$")){const U=this.resolveRoot(F.slice(1));g=U,$=U.kind}}else if($==="union"&&hasDomain(g,"object")){const F=schemaBranchesOf(g);F?.length===1&&(g=F[0],$=schemaKindOf(g))}if(isNode$1(g)&&g.kind===$)return g;const D=nodeImplementationsByKind[$].normalize?.(g,this)??g;return isNode$1(D)?D.kind===$?D:throwMismatchedNodeRootError($,D.kind):{...w,$:this,kind:$,def:D,prefix:w.alias??$}}bindReference(m){let g;return isNode$1(m)?g=m.$===this?m:new m.constructor(m.attachments,this):g=m.$===this?m:new GenericRoot(m.params,m.bodyDef,m.$,this,m.hkt),this.resolved||Object.assign(this.referencesById,g.referencesById),g}resolveRoot(m){return this.maybeResolveRoot(m)??throwParseError(writeUnresolvableMessage(m))}maybeResolveRoot(m){const g=this.maybeResolve(m);if(!hasArkKind(g,"generic"))return g}maybeResolveSubalias(m){return maybeResolveSubalias(this.aliases,m)??maybeResolveSubalias(this.ambient,m)}get ambient(){return $ark.ambient}maybeResolve(m){const g=this.resolutions[m];if(g){if(typeof g!="string")return this.bindReference(g);const $=nodesByRegisteredId[g];if(hasArkKind($,"root"))return this.resolutions[m]=$;if(hasArkKind($,"context")){if($.phase==="resolving")return this.node("alias",{reference:`$${m}`},{prereduced:!0});if($.phase==="resolved")return throwInternalError(`Unexpected resolved context for was uncached by its scope: ${printable($)}`);$.phase="resolving";const I=this.bindReference(this.parseOwnDefinitionFormat($.def,$));return $.phase="resolved",nodesByRegisteredId[I.id]=I,nodesByRegisteredId[$.id]=I,this.resolutions[m]=I}return throwInternalError(`Unexpected nodesById entry for ${g}: ${printable($)}`)}let w=this.aliases[m]??this.ambient?.[m];return w?(w=this.normalizeRootScopeValue(w),hasArkKind(w,"generic")?this.resolutions[m]=this.bindReference(w):hasArkKind(w,"module")?(w.root||throwParseError(writeMissingSubmoduleAccessMessage(m)),this.resolutions[m]=this.bindReference(w.root)):this.resolutions[m]=this.parse(w,{alias:m})):this.maybeResolveSubalias(m)}createParseContext(m){const g=m.id??registerNodeId(m.prefix);return nodesByRegisteredId[g]=Object.assign(m,{[arkKind]:"context",$:this,id:g,phase:"unresolved"})}traversal(m){return new Traversal(m,this.resolvedConfig)}import(...m){return new RootModule(flatMorph(this.export(...m),(g,w)=>[`#${g}`,w]))}precompilation;_exportedResolutions;_exports;export(...m){if(!this._exports){this._exports={};for(const w of this.exportedNames){const $=this.aliases[w];this._exports[w]=hasArkKind($,"module")?bindModule($,this):bootstrapAliasReferences(this.maybeResolve(w))}for(const w of this.lazyResolutions)w.resolution;if(this._exportedResolutions=resolutionsOfModule(this,this._exports),this._json=resolutionsToJson(this._exportedResolutions),Object.assign(this.resolutions,this._exportedResolutions),this.references=Object.values(this.referencesById),!this.resolvedConfig.jitless){const w=precompileReferences(this.references);this.precompilation=w.write(rootScopeFnName,4),bindPrecompilation(this.references,w)}this.resolved=!0}const g=m.length?m:this.exportedNames;return new RootModule(flatMorph(g,(w,$)=>[$,this._exports[$]]))}resolve(m){return this.export()[m]}node=(m,g,w={})=>{const $=this.preparseNode(m,g,w);if(isNode$1($))return this.bindReference($);const I=this.createParseContext($),D=parseNode(I),F=this.bindReference(D);return nodesByRegisteredId[I.id]=F};parse=(m,g={})=>this.finalize(this.parseDefinition(m,g));parseDefinition(m,g={}){if(hasArkKind(m,"root"))return this.bindReference(m);const w=this.preparseOwnDefinitionFormat(m,g);if(hasArkKind(w,"root"))return this.bindReference(w);const $=this.createParseContext(w);nodesByRegisteredId[$.id]=$;let I=this.bindReference(this.parseOwnDefinitionFormat(m,$));return I.isCyclic&&(I=withId(I,$.id)),nodesByRegisteredId[$.id]=I,I}finalize(m){return bootstrapAliasReferences(m),!m.precompilation&&!this.resolvedConfig.jitless&&precompile(m.references),m}}class SchemaScope extends BaseScope{parseOwnDefinitionFormat(m,g){return parseNode(g)}preparseOwnDefinitionFormat(m,g){return this.preparseNode(schemaKindOf(m),m,g)}preparseOwnAliasEntry(m,g){return[m,g]}normalizeRootScopeValue(m){return m}}const bootstrapAliasReferences=d=>{const m=d.references.filter(g=>g.hasKind("alias"));for(const g of m){Object.assign(g.referencesById,g.resolution.referencesById);for(const w of d.references)g.id in w.referencesById&&Object.assign(w.referencesById,g.referencesById)}return d},resolutionsToJson=d=>flatMorph(d,(m,g)=>[m,hasArkKind(g,"root")||hasArkKind(g,"generic")?g.json:hasArkKind(g,"module")?resolutionsToJson(g):throwInternalError(`Unexpected resolution ${printable(g)}`)]),maybeResolveSubalias=(d,m)=>{const g=m.indexOf(".");if(g===-1)return;const w=m.slice(0,g),$=d[w];if($===void 0)return;if(!hasArkKind($,"module"))return throwParseError(writeNonSubmoduleDotMessage(w));const I=m.slice(g+1),D=$[I];if(D===void 0)return maybeResolveSubalias($,I);if(hasArkKind(D,"root")||hasArkKind(D,"generic"))return D;if(hasArkKind(D,"module"))return D.root??throwParseError(writeMissingSubmoduleAccessMessage(m));throwInternalError(`Unexpected resolution for alias '${m}': ${printable(D)}`)},schemaScope=(d,m)=>new SchemaScope(d,m),rootSchemaScope=new SchemaScope({}),resolutionsOfModule=(d,m)=>{const g={};for(const w in m){const $=m[w];if(hasArkKind($,"module")){const I=resolutionsOfModule(d,$),D=flatMorph(I,(F,U)=>[`${w}.${F}`,U]);Object.assign(g,D)}else hasArkKind($,"root")||hasArkKind($,"generic")?g[w]=$:throwInternalError(`Unexpected scope resolution ${printable($)}`)}return g},writeUnresolvableMessage=d=>`'${d}' is unresolvable`,writeNonSubmoduleDotMessage=d=>`'${d}' must reference a module to be accessed using dot syntax`,writeMissingSubmoduleAccessMessage=d=>`Reference to submodule '${d}' must specify an alias`;rootSchemaScope.export();const rootSchema=rootSchemaScope.schema,node=rootSchemaScope.node;rootSchemaScope.defineSchema;const genericNode=rootSchemaScope.generic,arrayIndexSource="^(?:0|[1-9]\\d*)$",arrayIndexMatcher=new RegExp(arrayIndexSource);registeredReference(arrayIndexMatcher);const intrinsicBases=schemaScope({bigint:"bigint",boolean:[{unit:!1},{unit:!0}],false:{unit:!1},never:[],null:{unit:null},number:"number",object:"object",string:"string",symbol:"symbol",true:{unit:!0},unknown:{},undefined:{unit:void 0},Array,Date},{prereducedAliases:!0}).export();$ark.intrinsic={...intrinsicBases};const intrinsicRoots=schemaScope({integer:{domain:"number",divisor:1},lengthBoundable:["string",Array],key:["string","symbol"],nonNegativeIntegerString:{domain:"string",pattern:arrayIndexSource}},{prereducedAliases:!0}).export();Object.assign($ark.intrinsic,intrinsicRoots);const intrinsicJson=schemaScope({jsonPrimitive:["string","number",{unit:!0},{unit:!1},{unit:null}],jsonObject:{domain:"object",index:{signature:"string",value:"$jsonData"}},jsonData:["$jsonPrimitive","$jsonObject"]},{prereducedAliases:!0}).export(),intrinsic={...intrinsicBases,...intrinsicRoots,...intrinsicJson,emptyStructure:node("structure",{},{prereduced:!0})};$ark.intrinsic={...intrinsic};const isDateLiteral=d=>typeof d=="string"&&d[0]==="d"&&(d[1]==="'"||d[1]==='"')&&d.at(-1)===d[1],isValidDate=d=>d.toString()!=="Invalid Date",extractDateLiteralSource=d=>d.slice(2,-1),writeInvalidDateMessage=d=>`'${d}' could not be parsed by the Date constructor`,tryParseDate=(d,m)=>maybeParseDate(d,m),maybeParseDate=(d,m)=>{const g=new Date(d);if(isValidDate(g))return g;const w=tryParseNumber(d);if(w!==void 0){const $=new Date(w);if(isValidDate($))return $}return m?throwParseError(m===!0?writeInvalidDateMessage(d):m):void 0},parseEnclosed=(d,m)=>{const g=d.scanner.shiftUntilEscapable(untilLookaheadIsClosing[enclosingTokens[m]]);if(d.scanner.lookahead==="")return d.error(writeUnterminatedEnclosedMessage(g,m));if(d.scanner.shift(),m==="/"){try{new RegExp(g)}catch(w){throwParseError(String(w))}d.root=d.ctx.$.node("intersection",{domain:"string",pattern:g},{prereduced:!0})}else if(isKeyOf(m,enclosingQuote))d.root=d.ctx.$.node("unit",{unit:g});else{const w=tryParseDate(g,writeInvalidDateMessage(g));d.root=d.ctx.$.node("unit",{meta:g,unit:w})}},enclosingQuote={"'":1,'"':1},enclosingChar={"/":1,"'":1,'"':1},enclosingLiteralTokens={"d'":"'",'d"':'"',"'":"'",'"':'"'},enclosingTokens={...enclosingLiteralTokens,"/":"/"},untilLookaheadIsClosing={"'":d=>d.lookahead==="'",'"':d=>d.lookahead==='"',"/":d=>d.lookahead==="/"},enclosingCharDescriptions={'"':"double-quote","'":"single-quote","/":"forward slash"},writeUnterminatedEnclosedMessage=(d,m)=>`${m}${d} requires a closing ${enclosingCharDescriptions[enclosingTokens[m]]}`,writePrefixedPrivateReferenceMessage=d=>`Private type references should not include '#'. Use '${d}' instead.`,shallowOptionalMessage="Optional definitions like 'string?' are only valid as properties in an object or tuple",shallowDefaultableMessage="Defaultable definitions like 'number = 0' are only valid as properties in an object or tuple",terminatingChars={"<":1,">":1,"=":1,"|":1,"&":1,")":1,"[":1,"%":1,",":1,":":1,"?":1,"#":1,...whitespaceChars},lookaheadIsFinalizing=(d,m)=>d===">"?m[0]==="="?m[1]==="=":m.trimStart()===""||isKeyOf(m.trimStart()[0],terminatingChars):d==="="?m[0]!=="=":d===","||d==="?",parseGenericArgs=(d,m,g)=>_parseGenericArgs(d,m,g,[]),_parseGenericArgs=(d,m,g,w)=>{const $=g.parseUntilFinalizer();return w.push($.root),$.finalizer===">"?w.length!==m.params.length?g.error(writeInvalidGenericArgCountMessage(d,m.names,w.map(I=>I.expression))):w:$.finalizer===","?_parseGenericArgs(d,m,g,w):$.error(writeUnclosedGroupMessage(">"))},writeInvalidGenericArgCountMessage=(d,m,g)=>`${d}<${m.join(", ")}> requires exactly ${m.length} args (got ${g.length}${g.length===0?"":`: ${g.join(", ")}`})`,parseUnenclosed=d=>{const m=d.scanner.shiftUntilLookahead(terminatingChars);m==="keyof"?d.addPrefix("keyof"):d.root=unenclosedToNode(d,m)},parseGenericInstantiation=(d,m,g)=>{if(g.scanner.shiftUntilNonWhitespace(),g.scanner.shift()!=="<")return g.error(writeInvalidGenericArgCountMessage(d,m.names,[]));const $=parseGenericArgs(d,m,g);return m(...$)},unenclosedToNode=(d,m)=>maybeParseReference(d,m)??maybeParseUnenclosedLiteral(d,m)??d.error(m===""?d.scanner.lookahead==="#"?writePrefixedPrivateReferenceMessage(d.shiftedByOne().scanner.shiftUntilLookahead(terminatingChars)):writeMissingOperandMessage(d):writeUnresolvableMessage(m)),maybeParseReference=(d,m)=>{if(d.ctx.args?.[m]){const w=d.ctx.args[m];return typeof w!="string"?w:d.ctx.$.node("alias",{reference:w},{prereduced:!0})}const g=d.ctx.$.maybeResolve(m);if(hasArkKind(g,"root"))return g;if(g!==void 0)return hasArkKind(g,"generic")?parseGenericInstantiation(m,g,d):throwParseError(`Unexpected resolution ${printable(g)}`)},maybeParseUnenclosedLiteral=(d,m)=>{const g=tryParseWellFormedNumber(m);if(g!==void 0)return d.ctx.$.node("unit",{unit:g});const w=tryParseWellFormedBigint(m);if(w!==void 0)return d.ctx.$.node("unit",{unit:w})},writeMissingOperandMessage=d=>{const m=d.previousOperator();return m?writeMissingRightOperandMessage(m,d.scanner.unscanned):writeExpressionExpectedMessage(d.scanner.unscanned)},writeMissingRightOperandMessage=(d,m="")=>`Token '${d}' requires a right operand${m?` before '${m}'`:""}`,writeExpressionExpectedMessage=d=>`Expected an expression${d?` before '${d}'`:""}`,parseOperand=d=>d.scanner.lookahead===""?d.error(writeMissingOperandMessage(d)):d.scanner.lookahead==="("?d.shiftedByOne().reduceGroupOpen():d.scanner.lookaheadIsIn(enclosingChar)?parseEnclosed(d,d.scanner.shift()):d.scanner.lookaheadIsIn(whitespaceChars)?parseOperand(d.shiftedByOne()):d.scanner.lookahead==="d"&&d.scanner.nextLookahead in enclosingQuote?parseEnclosed(d,`${d.scanner.shift()}${d.scanner.shift()}`):parseUnenclosed(d),minComparators={">":!0,">=":!0},maxComparators={"<":!0,"<=":!0},invertedComparators={"<":">",">":"<","<=":">=",">=":"<=","==":"=="},writeOpenRangeMessage=(d,m)=>`Left bounds are only valid when paired with right bounds (try ...${m}${d})`,writeUnpairableComparatorMessage=d=>`Left-bounded expressions must specify their limits using < or <= (was ${d})`,writeMultipleLeftBoundsMessage=(d,m,g,w)=>`An expression may have at most one left bound (parsed ${d}${invertedComparators[m]}, ${g}${invertedComparators[w]})`,parseBound=(d,m)=>{const g=shiftComparator(d,m);if(d.root.hasKind("unit")){if(typeof d.root.unit=="number"){d.reduceLeftBound(d.root.unit,g),d.unsetRoot();return}if(d.root.unit instanceof Date){const w=`d'${d.root.description??d.root.unit.toISOString()}'`;d.unsetRoot(),d.reduceLeftBound(w,g);return}}return parseRightBound(d,g)},comparatorStartChars={"<":1,">":1,"=":1},shiftComparator=(d,m)=>d.scanner.lookaheadIs("=")?`${m}${d.scanner.shift()}`:m,getBoundKinds=(d,m,g,w)=>g.extends($ark.intrinsic.number)?typeof m!="number"?throwParseError(writeInvalidLimitMessage(d,m,w)):d==="=="?["min","max"]:d[0]===">"?["min"]:["max"]:g.extends($ark.intrinsic.lengthBoundable)?typeof m!="number"?throwParseError(writeInvalidLimitMessage(d,m,w)):d==="=="?["exactLength"]:d[0]===">"?["minLength"]:["maxLength"]:g.extends($ark.intrinsic.Date)?d==="=="?["after","before"]:d[0]===">"?["after"]:["before"]:throwParseError(writeUnboundableMessage(g.expression)),openLeftBoundToRoot=d=>({rule:isDateLiteral(d.limit)?extractDateLiteralSource(d.limit):d.limit,exclusive:d.comparator.length===1}),parseRightBound=(d,m)=>{const g=d.unsetRoot(),w=d.scanner.location;d.parseOperand();const $=d.unsetRoot(),I=d.scanner.sliceChars(w,d.scanner.location);if(d.root=g,!$.hasKind("unit")||typeof $.unit!="number"&&!($.unit instanceof Date))return d.error(writeInvalidLimitMessage(m,I,"right"));const D=$.unit,F=m.length===1,U=getBoundKinds(m,typeof D=="number"?D:I,g,"right");for(const j of U)d.constrainRoot(j,m==="=="?{rule:D}:{rule:D,exclusive:F});if(!d.branches.leftBound)return;if(!isKeyOf(m,maxComparators))return d.error(writeUnpairableComparatorMessage(m));const q=getBoundKinds(d.branches.leftBound.comparator,d.branches.leftBound.limit,g,"left");d.constrainRoot(q[0],openLeftBoundToRoot(d.branches.leftBound)),d.branches.leftBound=null},writeInvalidLimitMessage=(d,m,g)=>`Comparator ${g==="left"?invertedComparators[d]:d} must be ${g==="left"?"preceded":"followed"} by a corresponding literal (was ${m})`,parseBrand=d=>{d.scanner.shiftUntilNonWhitespace();const m=d.scanner.shiftUntilLookahead(terminatingChars);d.root=d.root.brand(m)},parseDivisor=d=>{d.scanner.shiftUntilNonWhitespace();const m=d.scanner.shiftUntilLookahead(terminatingChars),g=tryParseInteger(m,{errorOnFail:writeInvalidDivisorMessage(m)});g===0&&d.error(writeInvalidDivisorMessage(0)),d.root=d.root.constrain("divisor",g)},writeInvalidDivisorMessage=d=>`% operator must be followed by a non-zero integer literal (was ${d})`,parseOperator=d=>{const m=d.scanner.shift();return m===""?d.finalize(""):m==="["?d.scanner.shift()==="]"?d.setRoot(d.root.array()):d.error(incompleteArrayTokenMessage):m==="|"?d.scanner.lookahead===">"?d.shiftedByOne().pushRootToBranch("|>"):d.pushRootToBranch(m):m==="&"?d.pushRootToBranch(m):m===")"?d.finalizeGroup():lookaheadIsFinalizing(m,d.scanner.unscanned)?d.finalize(m):isKeyOf(m,comparatorStartChars)?parseBound(d,m):m==="%"?parseDivisor(d):m==="#"?parseBrand(d):m in whitespaceChars?parseOperator(d):d.error(writeUnexpectedCharacterMessage(m))},writeUnexpectedCharacterMessage=(d,m="")=>`'${d}' is not allowed here${m&&` (should be ${m})`}`,incompleteArrayTokenMessage="Missing expected ']'",parseDefault=d=>{const m=d.unsetRoot();d.parseOperand();const g=d.unsetRoot();if(!g.hasKind("unit"))return d.error(writeNonLiteralDefaultMessage(g.expression));const w=g.unit instanceof Date?()=>new Date(g.unit):g.unit;return[m,"=",w]},writeNonLiteralDefaultMessage=d=>`Default value '${d}' must be a literal value`,parseString=(d,m)=>{const g=m.$.maybeResolveRoot(d);if(g)return g;if(d.endsWith("[]")){const I=m.$.maybeResolveRoot(d.slice(0,-2));if(I)return I.array()}const w=new RuntimeState(new Scanner(d),m),$=fullStringParse(w);return w.finalizer===">"&&throwParseError(writeUnexpectedCharacterMessage(">")),$},fullStringParse=d=>{d.parseOperand();let m=parseUntilFinalizer(d).root;return m?(d.finalizer==="="?m=parseDefault(d):d.finalizer==="?"&&(m=[m,"?"]),d.scanner.shiftUntilNonWhitespace(),d.scanner.lookahead&&throwParseError(writeUnexpectedCharacterMessage(d.scanner.lookahead)),m):throwInternalError(`Root was unexpectedly unset after parsing string '${d.scanner.scanned}'`)},parseUntilFinalizer=d=>{for(;d.finalizer===void 0;)next(d);return d},next=d=>d.hasRoot()?d.parseOperator():d.parseOperand();class RuntimeState{root;branches={prefixes:[],leftBound:null,intersection:null,union:null,pipe:null};finalizer;groups=[];scanner;ctx;constructor(m,g){this.scanner=m,this.ctx=g}error(m){return throwParseError(m)}hasRoot(){return this.root!==void 0}setRoot(m){this.root=m}unsetRoot(){const m=this.root;return this.root=void 0,m}constrainRoot(...m){this.root=this.root.constrain(m[0],m[1])}finalize(m){if(this.groups.length)return this.error(writeUnclosedGroupMessage(")"));this.finalizeBranches(),this.finalizer=m}reduceLeftBound(m,g){const w=invertedComparators[g];if(!isKeyOf(w,minComparators))return this.error(writeUnpairableComparatorMessage(g));if(this.branches.leftBound)return this.error(writeMultipleLeftBoundsMessage(this.branches.leftBound.limit,this.branches.leftBound.comparator,m,w));this.branches.leftBound={comparator:w,limit:m}}finalizeBranches(){if(this.assertRangeUnset(),this.branches.pipe){this.pushRootToBranch("|>"),this.root=this.branches.pipe;return}if(this.branches.union){this.pushRootToBranch("|"),this.root=this.branches.union;return}if(this.branches.intersection){this.pushRootToBranch("&"),this.root=this.branches.intersection;return}this.applyPrefixes()}finalizeGroup(){this.finalizeBranches();const m=this.groups.pop();if(!m)return this.error(writeUnmatchedGroupCloseMessage(")",this.scanner.unscanned));this.branches=m}addPrefix(m){this.branches.prefixes.push(m)}applyPrefixes(){for(;this.branches.prefixes.length;){const m=this.branches.prefixes.pop();this.root=m==="keyof"?this.root.keyof():throwInternalError(`Unexpected prefix '${m}'`)}}pushRootToBranch(m){this.assertRangeUnset(),this.applyPrefixes();const g=this.root;this.root=void 0,this.branches.intersection=this.branches.intersection?.rawAnd(g)??g,m!=="&"&&(this.branches.union=this.branches.union?.rawOr(this.branches.intersection)??this.branches.intersection,this.branches.intersection=null,m!=="|"&&(this.branches.pipe=this.branches.pipe?.rawPipeOnce(this.branches.union)??this.branches.union,this.branches.union=null))}parseUntilFinalizer(){return parseUntilFinalizer(new RuntimeState(this.scanner,this.ctx))}parseOperator(){return parseOperator(this)}parseOperand(){return parseOperand(this)}assertRangeUnset(){if(this.branches.leftBound)return this.error(writeOpenRangeMessage(this.branches.leftBound.limit,this.branches.leftBound.comparator))}reduceGroupOpen(){this.groups.push(this.branches),this.branches={prefixes:[],leftBound:null,union:null,intersection:null,pipe:null}}previousOperator(){return this.branches.leftBound?.comparator??this.branches.prefixes.at(-1)??(this.branches.intersection?"&":this.branches.union?"|":this.branches.pipe?"|>":void 0)}shiftedByOne(){return this.scanner.shift(),this}}const emptyGenericParameterMessage="An empty string is not a valid generic parameter name",parseGenericParamName=(d,m,g)=>{d.shiftUntilNonWhitespace();const w=d.shiftUntilLookahead(terminatingChars);return w===""?d.lookahead===""&&m.length?m:throwParseError(emptyGenericParameterMessage):(d.shiftUntilNonWhitespace(),_parseOptionalConstraint(d,w,m,g))},extendsToken="extends ",_parseOptionalConstraint=(d,m,g,w)=>{if(d.shiftUntilNonWhitespace(),d.unscanned.startsWith(extendsToken))d.jumpForward(extendsToken.length);else return d.lookahead===","&&d.shift(),g.push(m),parseGenericParamName(d,g,w);const $=parseUntilFinalizer(new RuntimeState(d,w));return g.push([m,$.root]),parseGenericParamName(d,g,w)};class InternalFnParser extends Callable{constructor(m){const g={$:m,raw:m.fn};super((...w)=>{const $=w.indexOf(":"),I=$===-1?w.length-1:$-1,D=w.slice(0,I+1),F=m.parse(D).assertHasKind("intersection");let U=m.intrinsic.unknown;if($!==-1){if($!==w.length-2)return throwParseError(badFnReturnTypeMessage);U=m.parse(w[$+1])}return q=>new InternalTypedFn(q,F,U)},{attach:g})}}class InternalTypedFn extends Callable{raw;params;returns;expression;constructor(m,g,w){const $=`typed ${m.name}`,I={[$]:(...F)=>{const U=g.assert(F),q=m(...U);return w.assert(q)}}[$];super(I),this.raw=m,this.params=g,this.returns=w;let D=g.expression;D[0]==="["&&D.at(-1)==="]"?D=D.slice(1,-1):D.endsWith("[]")&&(D=`...${D}`),this.expression=`(${D}) => ${w?.expression??"unknown"}`}}const badFnReturnTypeMessage=`":" must be followed by exactly one return type e.g:
fn("string", ":", "number")(s => s.length)`;class InternalMatchParser extends Callable{$;constructor(m){super((...g)=>new InternalChainedMatchParser(m)(...g),{bind:m}),this.$=m}in(m){return new InternalChainedMatchParser(this.$,m===void 0?void 0:this.$.parse(m))}at(m,g){return new InternalChainedMatchParser(this.$).at(m,g)}case(m,g){return new InternalChainedMatchParser(this.$).case(m,g)}}class InternalChainedMatchParser extends Callable{$;in;key;branches=[];constructor(m,g){super(w=>this.caseEntries(Object.entries(w).map(([$,I])=>$==="default"?[$,I]:[this.$.parse($),I]))),this.$=m,this.in=g}at(m,g){return this.key&&throwParseError(doubleAtMessage),this.branches.length&&throwParseError(chainedAtMessage),this.key=m,g?this.match(g):this}case(m,g){return this.caseEntry(this.$.parse(m),g)}caseEntry(m,g){const $=(this.key?this.$.parse({[this.key]:m}):m).pipe(g);return this.branches.push($),this}match(m){return this(m)}strings(m){return this.caseEntries(Object.entries(m).map(([g,w])=>g==="default"?[g,w]:[this.$.node("unit",{unit:g}),w]))}caseEntries(m){for(let g=0;g<m.length;g++){const[w,$]=m[g];if(w==="default")return g!==m.length-1&&throwParseError("default may only be specified as the last key of a switch definition"),this.default($);if(typeof $!="function")return throwParseError(`Value for case "${w}" must be a function (was ${domainOf($)})`);this.caseEntry(w,$)}return this}default(m){typeof m=="function"&&this.case(intrinsic.unknown,m);const g={branches:this.branches,ordered:!0};(m==="never"||m==="assert")&&(g.meta={onFail:throwOnDefault});const w=this.$.node("union",g);if(!this.in)return this.$.finalize(w);let $=this.in.pipe(w);return(m==="never"||m==="assert")&&($=$.configureReferences({onFail:throwOnDefault},"self")),this.$.finalize($)}}const throwOnDefault=d=>d.throw(),chainedAtMessage="A key matcher must be specified before the first case i.e. match.at('foo') or match.in<object>().at('bar')",doubleAtMessage="At most one key matcher may be specified per expression",parseProperty=(d,m)=>{if(isArray$1(d)){if(d[1]==="=")return[m.$.parseOwnDefinitionFormat(d[0],m),"=",d[2]];if(d[1]==="?")return[m.$.parseOwnDefinitionFormat(d[0],m),"?"]}return parseInnerDefinition(d,m)},invalidOptionalKeyKindMessage="Only required keys may make their values optional, e.g. { [mySymbol]: ['number', '?'] }",invalidDefaultableKeyKindMessage="Only required keys may specify default values, e.g. { value: 'number = 0' }",parseObjectLiteral=(d,m)=>{let g;const w={},$=stringAndSymbolicEntriesOf(d);for(const[D,F]of $){const U=preparseKey(D);if(U.kind==="spread"){if(!isEmptyObject(w))return throwParseError(nonLeadingSpreadError);const V=m.$.parseOwnDefinitionFormat(F,m);if(V.equals(intrinsic.object))continue;if(!V.hasKind("intersection")||!V.basis?.equals(intrinsic.object))return throwParseError(writeInvalidSpreadTypeMessage(V.expression));g=V.structure;continue}if(U.kind==="undeclared"){F!=="reject"&&F!=="delete"&&F!=="ignore"&&throwParseError(writeInvalidUndeclaredBehaviorMessage(F)),w.undeclared=F;continue}const q=parseProperty(F,m),j=U;if(U.kind==="required"){isArray$1(q)?appendNamedProp(w,"optional",q[1]==="="?{key:U.normalized,value:q[0],default:q[2]}:{key:U.normalized,value:q[0]},m):appendNamedProp(w,"required",{key:U.normalized,value:q},m);continue}if(isArray$1(q)&&(q[1]==="?"&&throwParseError(invalidOptionalKeyKindMessage),q[1]==="="&&throwParseError(invalidDefaultableKeyKindMessage)),U.kind==="optional"){appendNamedProp(w,"optional",{key:U.normalized,value:q},m);continue}const G=m.$.parseOwnDefinitionFormat(j.normalized,m),H=normalizeIndex(G,q,m.$);H.index&&(w.index=append(w.index,H.index)),H.required&&(w.required=append(w.required,H.required))}const I=m.$.node("structure",w);return m.$.parseSchema({domain:"object",structure:g?.merge(I)??I})},appendNamedProp=(d,m,g,w)=>{d[m]=append(d[m],w.$.node(m,g))},writeInvalidUndeclaredBehaviorMessage=d=>`Value of '+' key must be 'reject', 'delete', or 'ignore' (was ${printable(d)})`,nonLeadingSpreadError="Spread operator may only be used as the first key in an object",preparseKey=d=>typeof d=="symbol"?{kind:"required",normalized:d}:d.at(-1)==="?"?d.at(-2)===Backslash?{kind:"required",normalized:`${d.slice(0,-2)}?`}:{kind:"optional",normalized:d.slice(0,-1)}:d[0]==="["&&d.at(-1)==="]"?{kind:"index",normalized:d.slice(1,-1)}:d[0]===Backslash&&d[1]==="["&&d.at(-1)==="]"?{kind:"required",normalized:d.slice(1)}:d==="..."?{kind:"spread"}:d==="+"?{kind:"undeclared"}:{kind:"required",normalized:d==="\\..."?"...":d==="\\+"?"+":d},writeInvalidSpreadTypeMessage=d=>`Spread operand must resolve to an object literal type (was ${d})`,maybeParseTupleExpression=(d,m)=>isIndexZeroExpression(d)?indexZeroParsers[d[0]](d,m):isIndexOneExpression(d)?indexOneParsers[d[1]](d,m):null,parseKeyOfTuple=(d,m)=>m.$.parseOwnDefinitionFormat(d[1],m).keyof(),parseBranchTuple=(d,m)=>{if(d[2]===void 0)return throwParseError(writeMissingRightOperandMessage(d[1],""));const g=m.$.parseOwnDefinitionFormat(d[0],m),w=m.$.parseOwnDefinitionFormat(d[2],m);if(d[1]==="|")return m.$.node("union",{branches:[g,w]});const $=d[1]==="&"?intersectNodesRoot(g,w,m.$):pipeNodesRoot(g,w,m.$);return $ instanceof Disjoint?$.throw():$},parseArrayTuple=(d,m)=>m.$.parseOwnDefinitionFormat(d[0],m).array(),parseMorphTuple=(d,m)=>typeof d[2]!="function"?throwParseError(writeMalformedFunctionalExpressionMessage("=>",d[2])):m.$.parseOwnDefinitionFormat(d[0],m).pipe(d[2]),writeMalformedFunctionalExpressionMessage=(d,m)=>`${d===":"?"Narrow":"Morph"} expression requires a function following '${d}' (was ${typeof m})`,parseNarrowTuple=(d,m)=>typeof d[2]!="function"?throwParseError(writeMalformedFunctionalExpressionMessage(":",d[2])):m.$.parseOwnDefinitionFormat(d[0],m).constrain("predicate",d[2]),parseMetaTuple=(d,m)=>m.$.parseOwnDefinitionFormat(d[0],m).configure(d[2],d[3]),defineIndexOneParsers=d=>d,postfixParsers=defineIndexOneParsers({"[]":parseArrayTuple,"?":()=>throwParseError(shallowOptionalMessage)}),infixParsers=defineIndexOneParsers({"|":parseBranchTuple,"&":parseBranchTuple,":":parseNarrowTuple,"=>":parseMorphTuple,"|>":parseBranchTuple,"@":parseMetaTuple,"=":()=>throwParseError(shallowDefaultableMessage)}),indexOneParsers={...postfixParsers,...infixParsers},isIndexOneExpression=d=>indexOneParsers[d[1]]!==void 0,defineIndexZeroParsers=d=>d,indexZeroParsers=defineIndexZeroParsers({keyof:parseKeyOfTuple,instanceof:(d,m)=>{if(typeof d[1]!="function")return throwParseError(writeInvalidConstructorMessage(objectKindOrDomainOf(d[1])));const g=d.slice(1).map(w=>typeof w=="function"?m.$.node("proto",{proto:w}):throwParseError(writeInvalidConstructorMessage(objectKindOrDomainOf(w))));return g.length===1?g[0]:m.$.node("union",{branches:g})},"===":(d,m)=>m.$.units(d.slice(1))}),isIndexZeroExpression=d=>indexZeroParsers[d[0]]!==void 0,writeInvalidConstructorMessage=d=>`Expected a constructor following 'instanceof' operator (was ${d})`,parseTupleLiteral=(d,m)=>{let g=[{}],w=0;for(;w<d.length;){let $=!1;d[w]==="..."&&w<d.length-1&&($=!0,w++);const I=parseProperty(d[w],m),[D,F,U]=isArray$1(I)?I:[I];if(w++,$){if(!D.extends($ark.intrinsic.Array))return throwParseError(writeNonArraySpreadMessage(D.expression));g=g.flatMap(q=>D.distribute(j=>appendSpreadBranch(makeRootAndArrayPropertiesMutable(q),j)))}else g=g.map(q=>F==="?"?appendOptionalElement(q,D):F==="="?appendDefaultableElement(q,D,U):appendRequiredElement(q,D))}return m.$.parseSchema(g.map($=>isEmptyObject($)?{proto:Array,exactLength:0}:{proto:Array,sequence:$}))},appendRequiredElement=(d,m)=>d.defaultables||d.optionals?throwParseError(d.variadic?postfixAfterOptionalOrDefaultableMessage:requiredPostOptionalMessage):(d.variadic?d.postfix=append(d.postfix,m):d.prefix=append(d.prefix,m),d),appendOptionalElement=(d,m)=>d.variadic?throwParseError(optionalOrDefaultableAfterVariadicMessage):(d.optionals=append(d.optionals,m),d),appendDefaultableElement=(d,m,g)=>d.variadic?throwParseError(optionalOrDefaultableAfterVariadicMessage):d.optionals?throwParseError(defaultablePostOptionalMessage):(d.defaultables=append(d.defaultables,[[m,g]]),d),appendVariadicElement=(d,m)=>(d.postfix&&throwParseError(multipleVariadicMesage),d.variadic?d.variadic.equals(m)||throwParseError(multipleVariadicMesage):d.variadic=m.internal,d),appendSpreadBranch=(d,m)=>{const g=m.select({method:"find",kind:"sequence"});if(!g)return appendVariadicElement(d,$ark.intrinsic.unknown);if(g.prefix)for(const w of g.prefix)appendRequiredElement(d,w);if(g.optionals)for(const w of g.optionals)appendOptionalElement(d,w);if(g.variadic&&appendVariadicElement(d,g.variadic),g.postfix)for(const w of g.postfix)appendRequiredElement(d,w);return d},writeNonArraySpreadMessage=d=>`Spread element must be an array (was ${d})`,multipleVariadicMesage="A tuple may have at most one variadic element",requiredPostOptionalMessage="A required element may not follow an optional element",optionalOrDefaultableAfterVariadicMessage="An optional element may not follow a variadic element",defaultablePostOptionalMessage="A defaultable element may not follow an optional element without a default",parseCache={},parseInnerDefinition=(d,m)=>{if(typeof d=="string"){if(m.args&&Object.keys(m.args).some(w=>d.includes(w)))return parseString(d,m);const g=parseCache[m.$.name]??={};return g[d]??=parseString(d,m)}return hasDomain(d,"object")?parseObject(d,m):throwParseError(writeBadDefinitionTypeMessage(domainOf(d)))},parseObject=(d,m)=>{const g=objectKindOf(d);switch(g){case void 0:return hasArkKind(d,"root")?d:parseObjectLiteral(d,m);case"Array":return parseTuple(d,m);case"RegExp":return m.$.node("intersection",{domain:"string",pattern:d},{prereduced:!0});case"Function":{const w=isThunk(d)?d():d;return hasArkKind(w,"root")?w:throwParseError(writeBadDefinitionTypeMessage("Function"))}default:return throwParseError(writeBadDefinitionTypeMessage(g??printable(d)))}},parseTuple=(d,m)=>maybeParseTupleExpression(d,m)??parseTupleLiteral(d,m),writeBadDefinitionTypeMessage=d=>`Type definitions must be strings or objects (was ${d})`;class InternalTypeParser extends Callable{constructor(m){const g=Object.assign({errors:ArkErrors,hkt:Hkt,$:m,raw:m.parse,module:m.constructor.module,scope:m.constructor.scope,declare:m.declare,define:m.define,match:m.match,generic:m.generic,schema:m.schema,keywords:m.ambient,unit:m.unit,enumerated:m.enumerated,instanceOf:m.instanceOf,valueOf:m.valueOf,or:m.or,and:m.and,merge:m.merge,pipe:m.pipe,fn:m.fn},m.ambientAttachments);super((...w)=>{if(w.length===1)return m.parse(w[0]);if(w.length===2&&typeof w[0]=="string"&&w[0][0]==="<"&&w[0].at(-1)===">"){const $=w[0].slice(1,-1),I=m.parseGenericParams($,{});return new GenericRoot(I,w[1],m,m,null)}return m.parse(w)},{attach:g})}}const $arkTypeRegistry=$ark;class InternalScope extends BaseScope{get ambientAttachments(){if($arkTypeRegistry.typeAttachments)return this.cacheGetter("ambientAttachments",flatMorph($arkTypeRegistry.typeAttachments,(m,g)=>[m,this.bindReference(g)]))}preparseOwnAliasEntry(m,g){const w=m.indexOf("<");if(w===-1){if(hasArkKind(g,"module")||hasArkKind(g,"generic"))return[m,g];const D=this.name==="ark"?m:m==="root"?this.name:`${this.name}.${m}`,F=this.resolvedConfig.keywords?.[D];return F&&(g=[g,"@",F]),[m,g]}m.at(-1)!==">"&&throwParseError("'>' must be the last character of a generic declaration in a scope");const $=m.slice(0,w),I=m.slice(w+1,-1);return[$,()=>{const D=this.parseGenericParams(I,{alias:$});return parseGeneric(D,g,this)}]}parseGenericParams(m,g){return parseGenericParamName(new Scanner(m),[],this.createParseContext({...g,def:m,prefix:"generic"}))}normalizeRootScopeValue(m){return isThunk(m)&&!hasArkKind(m,"generic")?m():m}preparseOwnDefinitionFormat(m,g){return{...g,def:m,prefix:g.alias??"type"}}parseOwnDefinitionFormat(m,g){!(g.alias&&g.alias in this.aliases)&&!g.args&&(g.args={this:g.id});const $=parseInnerDefinition(m,g);if(isArray$1($)){if($[1]==="=")return throwParseError(shallowDefaultableMessage);if($[1]==="?")return throwParseError(shallowOptionalMessage)}return $}unit=m=>this.units([m]);valueOf=m=>this.units(enumValues(m));enumerated=(...m)=>this.units(m);instanceOf=m=>this.node("proto",{proto:m},{prereduced:!0});or=(...m)=>this.schema(m.map(g=>this.parse(g)));and=(...m)=>m.reduce((g,w)=>g.and(this.parse(w)),this.intrinsic.unknown);merge=(...m)=>m.reduce((g,w)=>g.merge(this.parse(w)),this.intrinsic.object);pipe=(...m)=>this.intrinsic.unknown.pipe(...m);fn=new InternalFnParser(this);match=new InternalMatchParser(this);declare=()=>({type:this.type});define(m){return m}type=new InternalTypeParser(this);static scope=((m,g={})=>new InternalScope(m,g));static module=((m,g={})=>this.scope(m,g).export())}const scope=Object.assign(InternalScope.scope,{define:d=>d}),Scope=InternalScope;class MergeHkt extends Hkt{description='merge an object\'s properties onto another like `Merge(User, { isAdmin: "true" })`'}const Merge=genericNode(["base",intrinsic.object],["props",intrinsic.object])(d=>d.base.merge(d.props),MergeHkt),arkBuiltins=Scope.module({Key:intrinsic.key,Merge});class liftFromHkt extends Hkt{}const liftFrom=genericNode("element")(d=>{const m=d.element.exclude(intrinsic.Array),g=m.array();return m.rawOr(g).pipe(liftArray).distribute(w=>w.assertHasKind("morph").declareOut(g),rootSchema)},liftFromHkt),arkArray=Scope.module({root:intrinsic.Array,readonly:"root",index:intrinsic.nonNegativeIntegerString,liftFrom},{name:"Array"}),value=rootSchema(["string",registry.FileConstructor]),parsedFormDataValue=value.rawOr(value.array()),parsed=rootSchema({meta:"an object representing parsed form data",domain:"object",index:{signature:"string",value:parsedFormDataValue}}),arkFormData=Scope.module({root:["instanceof",FormData],value,parsed,parse:rootSchema({in:FormData,morphs:d=>{const m={};for(const[g,w]of d)if(g in m){const $=m[g];typeof $=="string"||$ instanceof registry.FileConstructor?m[g]=[$,w]:$.push(w)}else m[g]=w;return m},declaredOut:parsed})},{name:"FormData"}),TypedArray=Scope.module({Int8:["instanceof",Int8Array],Uint8:["instanceof",Uint8Array],Uint8Clamped:["instanceof",Uint8ClampedArray],Int16:["instanceof",Int16Array],Uint16:["instanceof",Uint16Array],Int32:["instanceof",Int32Array],Uint32:["instanceof",Uint32Array],Float32:["instanceof",Float32Array],Float64:["instanceof",Float64Array],BigInt64:["instanceof",BigInt64Array],BigUint64:["instanceof",BigUint64Array]},{name:"TypedArray"}),omittedPrototypes={Boolean:1,Number:1,String:1},arkPrototypes=Scope.module({...flatMorph({...ecmascriptConstructors,...platformConstructors},(d,m)=>d in omittedPrototypes?[]:[d,["instanceof",m]]),Array:arkArray,TypedArray,FormData:arkFormData}),epoch$1=rootSchema({domain:{domain:"number",meta:"a number representing a Unix timestamp"},divisor:{rule:1,meta:"an integer representing a Unix timestamp"},min:{rule:-864e13,meta:"a Unix timestamp after -8640000000000000"},max:{rule:864e13,meta:"a Unix timestamp before 8640000000000000"},meta:"an integer representing a safe Unix timestamp"}),integer=rootSchema({domain:"number",divisor:1}),number=Scope.module({root:intrinsic.number,integer,epoch:epoch$1,safe:rootSchema({domain:{domain:"number",numberAllowsNaN:!1},min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER}),NaN:["===",Number.NaN],Infinity:["===",Number.POSITIVE_INFINITY],NegativeInfinity:["===",Number.NEGATIVE_INFINITY]},{name:"number"}),regexStringNode=(d,m,g)=>{const w={domain:"string",pattern:{rule:d.source,flags:d.flags,meta:m}};return g&&(w.meta={format:g}),node("intersection",w)},stringIntegerRoot=regexStringNode(wellFormedIntegerMatcher,"a well-formed integer string"),stringInteger=Scope.module({root:stringIntegerRoot,parse:rootSchema({in:stringIntegerRoot,morphs:(d,m)=>{const g=Number.parseInt(d);return Number.isSafeInteger(g)?g:m.error("an integer in the range Number.MIN_SAFE_INTEGER to Number.MAX_SAFE_INTEGER")},declaredOut:intrinsic.integer})},{name:"string.integer"}),hex=regexStringNode(/^[\dA-Fa-f]+$/,"hex characters only"),base64$1=Scope.module({root:regexStringNode(/^(?:[\d+/A-Za-z]{4})*(?:[\d+/A-Za-z]{2}==|[\d+/A-Za-z]{3}=)?$/,"base64-encoded"),url:regexStringNode(/^(?:[\w-]{4})*(?:[\w-]{2}(?:==|%3D%3D)?|[\w-]{3}(?:=|%3D)?)?$/,"base64url-encoded")},{name:"string.base64"}),preformattedCapitalize=regexStringNode(/^[A-Z].*$/,"capitalized"),capitalize=Scope.module({root:rootSchema({in:"string",morphs:d=>d.charAt(0).toUpperCase()+d.slice(1),declaredOut:preformattedCapitalize}),preformatted:preformattedCapitalize},{name:"string.capitalize"}),isLuhnValid=d=>{const m=d.replaceAll(/[ -]+/g,"");let g=0,w,$,I=!1;for(let D=m.length-1;D>=0;D--)w=m.substring(D,D+1),$=Number.parseInt(w,10),I?($*=2,g+=$>=10?$%10+1:$):g+=$,I=!I;return!!(g%10===0&&m)},creditCardMatcher=/^(?:4\d{12}(?:\d{3,6})?|5[1-5]\d{14}|(222[1-9]|22[3-9]\d|2[3-6]\d{2}|27[01]\d|2720)\d{12}|6(?:011|5\d\d)\d{12,15}|3[47]\d{13}|3(?:0[0-5]|[68]\d)\d{11}|(?:2131|1800|35\d{3})\d{11}|6[27]\d{14}|^(81\d{14,17}))$/,creditCard=rootSchema({domain:"string",pattern:{meta:"a credit card number",rule:creditCardMatcher.source},predicate:{meta:"a credit card number",predicate:isLuhnValid}}),iso8601Matcher=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))(T((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([,.]\d+(?!:))?)?(\17[0-5]\d([,.]\d+)?)?([Zz]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,isParsableDate=d=>!Number.isNaN(new Date(d).valueOf()),parsableDate=rootSchema({domain:"string",predicate:{meta:"a parsable date",predicate:isParsableDate}}).assertHasKind("intersection"),epochRoot=stringInteger.root.internal.narrow((d,m)=>{const g=Number.parseInt(d),w=number.epoch(g);return w instanceof ArkErrors?(m.errors.merge(w),!1):!0}).configure({description:"an integer string representing a safe Unix timestamp"},"self").assertHasKind("intersection"),epoch=Scope.module({root:epochRoot,parse:rootSchema({in:epochRoot,morphs:d=>new Date(d),declaredOut:intrinsic.Date})},{name:"string.date.epoch"}),isoRoot=regexStringNode(iso8601Matcher,"an ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ) date").internal.assertHasKind("intersection"),iso=Scope.module({root:isoRoot,parse:rootSchema({in:isoRoot,morphs:d=>new Date(d),declaredOut:intrinsic.Date})},{name:"string.date.iso"}),stringDate=Scope.module({root:parsableDate,parse:rootSchema({declaredIn:parsableDate,in:"string",morphs:(d,m)=>{const g=new Date(d);return Number.isNaN(g.valueOf())?m.error("a parsable date"):g},declaredOut:intrinsic.Date}),iso,epoch},{name:"string.date"}),email=regexStringNode(/^[\w%+.-]+@[\d.A-Za-z-]+\.[A-Za-z]{2,}$/,"an email address","email"),ipv4Segment="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",ipv4Address=`(${ipv4Segment}[.]){3}${ipv4Segment}`,ipv4Matcher=new RegExp(`^${ipv4Address}$`),ipv6Segment="(?:[0-9a-fA-F]{1,4})",ipv6Matcher=new RegExp(`^((?:${ipv6Segment}:){7}(?:${ipv6Segment}|:)|(?:${ipv6Segment}:){6}(?:${ipv4Address}|:${ipv6Segment}|:)|(?:${ipv6Segment}:){5}(?::${ipv4Address}|(:${ipv6Segment}){1,2}|:)|(?:${ipv6Segment}:){4}(?:(:${ipv6Segment}){0,1}:${ipv4Address}|(:${ipv6Segment}){1,3}|:)|(?:${ipv6Segment}:){3}(?:(:${ipv6Segment}){0,2}:${ipv4Address}|(:${ipv6Segment}){1,4}|:)|(?:${ipv6Segment}:){2}(?:(:${ipv6Segment}){0,3}:${ipv4Address}|(:${ipv6Segment}){1,5}|:)|(?:${ipv6Segment}:){1}(?:(:${ipv6Segment}){0,4}:${ipv4Address}|(:${ipv6Segment}){1,6}|:)|(?::((?::${ipv6Segment}){0,5}:${ipv4Address}|(?::${ipv6Segment}){1,7}|:)))(%[0-9a-zA-Z.]{1,})?$`),ip=Scope.module({root:["v4 | v6","@","an IP address"],v4:regexStringNode(ipv4Matcher,"an IPv4 address","ipv4"),v6:regexStringNode(ipv6Matcher,"an IPv6 address","ipv6")},{name:"string.ip"}),jsonStringDescription="a JSON string",writeJsonSyntaxErrorProblem=d=>{if(!(d instanceof SyntaxError))throw d;return`must be ${jsonStringDescription} (${d})`},jsonRoot=rootSchema({meta:jsonStringDescription,domain:"string",predicate:{meta:jsonStringDescription,predicate:(d,m)=>{try{return JSON.parse(d),!0}catch(g){return m.reject({code:"predicate",expected:jsonStringDescription,problem:writeJsonSyntaxErrorProblem(g)})}}}}),parseJson=(d,m)=>{if(d.length===0)return m.error({code:"predicate",expected:jsonStringDescription,actual:"empty"});try{return JSON.parse(d)}catch(g){return m.error({code:"predicate",expected:jsonStringDescription,problem:writeJsonSyntaxErrorProblem(g)})}},json$1=Scope.module({root:jsonRoot,parse:rootSchema({meta:"safe JSON string parser",in:"string",morphs:parseJson,declaredOut:intrinsic.jsonObject})},{name:"string.json"}),preformattedLower=regexStringNode(/^[a-z]*$/,"only lowercase letters"),lower=Scope.module({root:rootSchema({in:"string",morphs:d=>d.toLowerCase(),declaredOut:preformattedLower}),preformatted:preformattedLower},{name:"string.lower"}),normalizedForms=["NFC","NFD","NFKC","NFKD"],preformattedNodes=flatMorph(normalizedForms,(d,m)=>[m,rootSchema({domain:"string",predicate:g=>g.normalize(m)===g,meta:`${m}-normalized unicode`})]),normalizeNodes=flatMorph(normalizedForms,(d,m)=>[m,rootSchema({in:"string",morphs:g=>g.normalize(m),declaredOut:preformattedNodes[m]})]),NFC=Scope.module({root:normalizeNodes.NFC,preformatted:preformattedNodes.NFC},{name:"string.normalize.NFC"}),NFD=Scope.module({root:normalizeNodes.NFD,preformatted:preformattedNodes.NFD},{name:"string.normalize.NFD"}),NFKC=Scope.module({root:normalizeNodes.NFKC,preformatted:preformattedNodes.NFKC},{name:"string.normalize.NFKC"}),NFKD=Scope.module({root:normalizeNodes.NFKD,preformatted:preformattedNodes.NFKD},{name:"string.normalize.NFKD"}),normalize=Scope.module({root:"NFC",NFC,NFD,NFKC,NFKD},{name:"string.normalize"}),numericRoot=regexStringNode(numericStringMatcher,"a well-formed numeric string"),stringNumeric=Scope.module({root:numericRoot,parse:rootSchema({in:numericRoot,morphs:d=>Number.parseFloat(d),declaredOut:intrinsic.number})},{name:"string.numeric"}),regexPatternDescription="a regex pattern",regex=rootSchema({domain:"string",predicate:{meta:regexPatternDescription,predicate:(d,m)=>{try{return new RegExp(d),!0}catch(g){return m.reject({code:"predicate",expected:regexPatternDescription,problem:String(g)})}}},meta:{format:"regex"}}),semverMatcher=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*)(?:\.(?:0|[1-9]\d*|\d*[A-Za-z-][\dA-Za-z-]*))*))?(?:\+([\dA-Za-z-]+(?:\.[\dA-Za-z-]+)*))?$/,semver=regexStringNode(semverMatcher,"a semantic version (see https://semver.org/)"),preformattedTrim=regexStringNode(/^\S.*\S$|^\S?$/,"trimmed"),trim=Scope.module({root:rootSchema({in:"string",morphs:d=>d.trim(),declaredOut:preformattedTrim}),preformatted:preformattedTrim},{name:"string.trim"}),preformattedUpper=regexStringNode(/^[A-Z]*$/,"only uppercase letters"),upper=Scope.module({root:rootSchema({in:"string",morphs:d=>d.toUpperCase(),declaredOut:preformattedUpper}),preformatted:preformattedUpper},{name:"string.upper"}),isParsableUrl=d=>URL.canParse(d),urlRoot=rootSchema({domain:"string",predicate:{meta:"a URL string",predicate:isParsableUrl},meta:{format:"uri"}}),url=Scope.module({root:urlRoot,parse:rootSchema({declaredIn:urlRoot,in:"string",morphs:(d,m)=>{try{return new URL(d)}catch{return m.error("a URL string")}},declaredOut:rootSchema(URL)})},{name:"string.url"}),uuid=Scope.module({root:["versioned | nil | max","@",{description:"a UUID",format:"uuid"}],"#nil":"'00000000-0000-0000-0000-000000000000'","#max":"'ffffffff-ffff-ffff-ffff-ffffffffffff'","#versioned":/[\da-f]{8}-[\da-f]{4}-[1-8][\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}/i,v1:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-1[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv1"),v2:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-2[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv2"),v3:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-3[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv3"),v4:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-4[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv4"),v5:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-5[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv5"),v6:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-6[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv6"),v7:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-7[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv7"),v8:regexStringNode(/^[\da-f]{8}-[\da-f]{4}-8[\da-f]{3}-[89ab][\da-f]{3}-[\da-f]{12}$/i,"a UUIDv8")},{name:"string.uuid"}),string$1=Scope.module({root:intrinsic.string,alpha:regexStringNode(/^[A-Za-z]*$/,"only letters"),alphanumeric:regexStringNode(/^[\dA-Za-z]*$/,"only letters and digits 0-9"),hex,base64:base64$1,capitalize,creditCard,date:stringDate,digits:regexStringNode(/^\d*$/,"only digits 0-9"),email,integer:stringInteger,ip,json:json$1,lower,normalize,numeric:stringNumeric,regex,semver,trim,upper,url,uuid},{name:"string"}),arkTsKeywords=Scope.module({bigint:intrinsic.bigint,boolean:intrinsic.boolean,false:intrinsic.false,never:intrinsic.never,null:intrinsic.null,number:intrinsic.number,object:intrinsic.object,string:intrinsic.string,symbol:intrinsic.symbol,true:intrinsic.true,unknown:intrinsic.unknown,undefined:intrinsic.undefined}),unknown=Scope.module({root:intrinsic.unknown,any:intrinsic.unknown},{name:"unknown"}),json=Scope.module({root:intrinsic.jsonObject,stringify:node("morph",{in:intrinsic.jsonObject,morphs:d=>JSON.stringify(d),declaredOut:intrinsic.string})},{name:"object.json"}),object=Scope.module({root:intrinsic.object,json},{name:"object"});class RecordHkt extends Hkt{description='instantiate an object from an index signature and corresponding value type like `Record("string", "number")`'}const Record=genericNode(["K",intrinsic.key],"V")(d=>({domain:"object",index:{signature:d.K,value:d.V}}),RecordHkt);class PickHkt extends Hkt{description='pick a set of properties from an object like `Pick(User, "name | age")`'}const Pick=genericNode(["T",intrinsic.object],["K",intrinsic.key])(d=>d.T.pick(d.K),PickHkt);class OmitHkt extends Hkt{description='omit a set of properties from an object like `Omit(User, "age")`'}const Omit=genericNode(["T",intrinsic.object],["K",intrinsic.key])(d=>d.T.omit(d.K),OmitHkt);class PartialHkt extends Hkt{description="make all named properties of an object optional like `Partial(User)`"}const Partial=genericNode(["T",intrinsic.object])(d=>d.T.partial(),PartialHkt);class RequiredHkt extends Hkt{description="make all named properties of an object required like `Required(User)`"}const Required=genericNode(["T",intrinsic.object])(d=>d.T.required(),RequiredHkt);class ExcludeHkt extends Hkt{description='exclude branches of a union like `Exclude("boolean", "true")`'}const Exclude=genericNode("T","U")(d=>d.T.exclude(d.U),ExcludeHkt);class ExtractHkt extends Hkt{description='extract branches of a union like `Extract("0 | false | 1", "number")`'}const Extract=genericNode("T","U")(d=>d.T.extract(d.U),ExtractHkt),arkTsGenerics=Scope.module({Exclude,Extract,Omit,Partial,Pick,Record,Required}),ark=scope({...arkTsKeywords,...arkTsGenerics,...arkPrototypes,...arkBuiltins,string:string$1,number,object,unknown},{prereducedAliases:!0,name:"ark"}),keywords=ark.export();Object.assign($arkTypeRegistry.ambient,keywords);$arkTypeRegistry.typeAttachments={string:keywords.string.root,number:keywords.number.root,bigint:keywords.bigint,boolean:keywords.boolean,symbol:keywords.symbol,undefined:keywords.undefined,null:keywords.null,object:keywords.object.root,unknown:keywords.unknown.root,false:keywords.false,true:keywords.true,never:keywords.never,arrayIndex:keywords.Array.index,Key:keywords.Key,Record:keywords.Record,Array:keywords.Array.root,Date:keywords.Date};const type=Object.assign(ark.type,$arkTypeRegistry.typeAttachments),match$1=ark.match;ark.fn;ark.generic;ark.schema;ark.define;ark.declare;const PayloadInitializeSchema=type({by:'"sw&rpc"',functionName:'"#initialize"',isInitializeRequest:"true",localStorageData:"Record<string, unknown>",nodeId:"string"}),PayloadHeaderSchema=type("<Name extends string>",{by:'"sw&rpc"',functionName:"Name",requestId:"string >= 1"}),PayloadCoreSchema=type("<I, P, S>",{"input?":"I","progress?":"P","result?":"S","abort?":{reason:"string"},"error?":{message:"string"}}),PayloadSchema=type.scope({PayloadCoreSchema,PayloadHeaderSchema,PayloadInitializeSchema}).type("<Name extends string, I, P, S>",[["PayloadHeaderSchema<Name>","&","PayloadCoreSchema<I, P, S>"],"|","PayloadInitializeSchema"]),zImplementations=Symbol("SWARPC implementations"),zProcedures=Symbol("SWARPC procedures"),transferableClasses=[MessagePort,ReadableStream,WritableStream,TransformStream,ArrayBuffer];function findTransferables(d){return d==null?[]:typeof d=="object"?ArrayBuffer.isView(d)||d instanceof ArrayBuffer?[d]:transferableClasses.some(m=>d instanceof m)?[d]:Array.isArray(d)?d.flatMap(findTransferables):Object.values(d).flatMap(findTransferables):[]}class FauxLocalStorage{data;keysOrder;constructor(m){this.data=m,this.keysOrder=Object.keys(m)}setItem(m,g){this.hasItem(m)||this.keysOrder.push(m),this.data[m]=g}getItem(m){return this.data[m]}hasItem(m){return Object.hasOwn(this.data,m)}removeItem(m){this.hasItem(m)&&(delete this.data[m],this.keysOrder=this.keysOrder.filter(g=>g!==m))}clear(){this.data={},this.keysOrder=[]}key(m){return this.keysOrder[m]}get length(){return this.keysOrder.length}register(m){m.localStorage=this}}const abortControllers=new Map,abortedRequests=new Set;function Server(d,{loglevel:m="debug",scope:g,_scopeType:w}={}){g??=self;const $=nodeIdFromScope(g,w),I=createLogger("server",m,$),D={[zProcedures]:d,[zImplementations]:{},start:async()=>{}};for(const F in d)D[F]=(U=>{if(!D[zProcedures][F])throw new Error(`No procedure found for function name: ${F}`);D[zImplementations][F]=(q,j,G)=>(G.abortSignal?.throwIfAborted(),new Promise((H,V)=>{G.abortSignal?.addEventListener("abort",()=>{let{requestId:Z,reason:Q}=G.abortSignal.reason;I.debug(Z,`Aborted ${F} request: ${Q}`),V({aborted:Q})}),U(q,j,G).then(H).catch(V)}))});return D.start=async()=>{const F=await new Promise(j=>{if(!scopeIsShared(g,w))return j(void 0);I.debug(null,"Awaiting shared worker connection..."),g.addEventListener("connect",({ports:[G]})=>{I.debug(null,"Shared worker connected with port",G),j(G)})}),U=async(j,G)=>{const H=j?[]:findTransferables(G);F?F.postMessage(G,{transfer:H}):scopeIsDedicated(g,w)?g.postMessage(G,{transfer:H}):scopeIsService(g,w)&&await g.clients.matchAll().then(V=>{V.forEach(Z=>Z.postMessage(G,{transfer:H}))})},q=async j=>{if(PayloadInitializeSchema.allows(j.data)){const{localStorageData:se,nodeId:X}=j.data;I.debug(null,"Setting up faux localStorage",se),new FauxLocalStorage(se).register(g),injectIntoConsoleGlobal(g,X);return}const{requestId:G,functionName:H}=PayloadHeaderSchema(type.enumerated(...Object.keys(d))).assert(j.data);I.debug(G,`Received request for ${H}`,j.data);const{autotransfer:V="output-only",...Z}=D[zProcedures][H],Q=async se=>{abortedRequests.has(G)||await U(V!=="never",{by:"sw&rpc",functionName:H,requestId:G,...se})},J=async se=>Q({error:{message:"message"in se?se.message:String(se)}}),ie=D[zImplementations][H];if(!ie){await J("No implementation found");return}const re=PayloadSchema(type(`"${H}"`),Z.input,Z.progress,Z.success).assert(j.data);if("isInitializeRequest"in re)throw"Unreachable: #initialize request payload should've been handled already";if(re.abort){const se=abortControllers.get(G);se||await J("No abort controller found for request"),se?.abort(re.abort.reason);return}if(abortControllers.set(G,new AbortController),!re.input){await J("No input provided");return}try{const se=await ie(re.input,async X=>{await Q({progress:X})},{nodeId:$,abortSignal:abortControllers.get(G)?.signal,logger:createLogger("server",m,$,G)});I.debug(G,`Result for ${H}`,se),await Q({result:se})}catch(se){if("aborted"in se){I.debug(G,`Received abort error for ${H}`,se.aborted),abortedRequests.add(G),abortControllers.delete(G);return}I.info(G,`Error in ${H}`,se),await J(se)}finally{abortedRequests.delete(G)}};if(scopeIsShared(g,w)){if(!F)throw new Error("SharedWorker port not initialized");I.info(null,"Listening for shared worker messages on port",F),F.addEventListener("message",q),F.start()}else if(scopeIsDedicated(g,w))g.addEventListener("message",q);else if(scopeIsService(g,w))g.addEventListener("message",q);else throw new Error(`Unsupported worker scope ${g}`)},D}function errorMessage(d,m=""){const g="Erreur inattendue";let w=g;for(d instanceof Error&&("message"in d&&d.message&&(w=d.message||g),"cause"in d&&d.cause&&(w=errorMessage(d.cause))),w=d?.toString()||g;w.startsWith("Error: ");)w=w.slice(7);return w||=g,m?`${m}: ${w}`:w}function localeFromNavigator(){return navigator.language.split("-")[0]==="fr"?"fr":"en"}var tick=1,maxTick=65535,resolution=4,inc=function(){tick=tick+1&maxTick},timer=setInterval(inc,1e3/resolution|0);timer.unref&&timer.unref();function speedometer(d){var m=resolution*d,g=[0],w=1,$=tick-1&maxTick;return function(I){var D=tick-$&maxTick;for(D>m&&(D=m),$=tick;D--;)w===m&&(w=0),g[w]=g[w===0?m-1:w-1],w++;I&&(g[w-1]+=I);var F=g[w-1],U=g.length<m?0:g[w===m?0:w];return g.length<resolution?F:(F-U)*resolution/g.length}}class Progress{constructor(m,g=1e3){this.length=parseInt(m,10)||0,this.transferred=0,this.speed=0,this.streamSpeed=speedometer(this.speed||5e3),this.initial=!1,this.emitDelay=g,this.eventStart=0,this.percentage=0}getRemainingBytes(){return parseInt(this.length,10)-parseInt(this.transferred,10)}getEta(){return this.length>=this.transferred?this.getRemainingBytes()/this.speed*1e9:0}flow(m,g){const w=m.length;if(this.transferred+=w,this.speed=this.streamSpeed(w),this.percentage=Math.round(this.transferred/this.length*100),this.initial||(this.eventStart=Date.now(),this.initial=!0),this.length>=this.transferred||Date.now()-this.eventStart>this.emitDelay){this.eventStart=Date.now();const $={total:this.length,transferred:this.transferred,speed:this.speed,eta:this.getEta()};this.length&&($.remaining=this.getRemainingBytes(),$.percentage=this.percentage),g($)}}}function isFetchProgressSupported(){return typeof Response<"u"&&typeof ReadableStream<"u"}function fetchProgress({defaultSize:d=0,emitDelay:m=10,onProgress:g=()=>null,onComplete:w=()=>null,onError:$=()=>null}){return function(D){if(!isFetchProgressSupported())return D;const{body:F,headers:U,status:q}=D,j=U.get("content-length")||d,G=new Progress(j,m),H=F.getReader(),V=new ReadableStream({start(Z){function Q(){H.read().then(({done:J,value:ie})=>{if(J){w({}),Z.close();return}ie&&G.flow(ie,g),Z.enqueue(ie),Q()}).catch(J=>{$(J)})}Q()}});return new Response(V,{headers:U,status:q})}}function mapValues(d,m){return Object.fromEntries(Object.entries(d).map(([g,w])=>[g,m(w)]))}function keys(d){return Object.keys(d)}function fromEntries(d){return Object.fromEntries(d)}function entries(d){return Object.entries(d)}function oneOf(d,m){return m.includes(d)}function pick(d,...m){const g={};for(const w of m)g[w]=d[w];return g}function omit(d,...m){return fromEntries(entries(d).filter(([g])=>!oneOf(g,m)))}function safeJSONStringify(d){try{return JSON.stringify(d)}catch{return}}function clamp(d,m,g){return Math.max(m,Math.min(g,d))}function unique(d,m=g=>g){const g=new Set;return d.filter(w=>{const $=m(w);return g.has($)?!1:(g.add($),!0)})}function splitFilenameOnExtension(d){const m=d.match(/^([^.]+)\.(.+)$/);return m?[m[1],m[2]]:[d,""]}function compareBy(d){return(m,g)=>{const w=d(m),$=d(g);return w===$?0:typeof w=="string"&&typeof $=="string"?w.localeCompare($):typeof w=="number"&&typeof $=="number"?w-$:w.toString().localeCompare($.toString())}}function range(d,m=void 0){return m===void 0?Array.from({length:d},(g,w)=>w):Array.from({length:m-d},(g,w)=>w+d)}async function fetchHttpRequest(d,{cacheAs:m="",onProgress:g}={}){let w=new URL(typeof d=="string"?d:d.url);const $=typeof d=="string"?{headers:{}}:d;return m&&w.searchParams.set("x-cigale-cache-as",m),g?fetch(w,$).then(fetchProgress({onProgress:g})):fetch(w,$)}function sum(d){return[...d].reduce((m,g)=>m+g,0)}function avg(d){return sum(d)/d.length}function nonnull(d){return d!=null}function progressSplitter(...d){let m=[];for(let g=0;g<d.length;g+=2){const w=d[g],$=d[g+1]??1-sum(m.map(([,I])=>I));m.push([w,$])}return(g,w)=>{let $=0;const I=m.findIndex(([D])=>D===g);for(const[D,[F,U]]of m.entries())D<I&&($+=U),D===I&&($+=U*w);return $}}function groupBy(d,m,g){if("groupBy"in Map&&!g)return Map.groupBy(d,m);const w=new Map;for(const $ of d){const I=m($);w.has(I)||w.set(I,[]),w.get(I).push(g?g($):$)}return w}function propOrNothing(d,m){return nonnull(m)?{[d]:m}:{}}const ID=type(/^[\w._]+$/),References=ID.array().pipe(d=>[...new Set(d)]),Probability=type("0 <= number <= 1.0001").pipe(d=>clamp(d,0,1)),URLString=type(/https?:\/\/.+/),HTTPRequest=URLString.configure("L'URL Ã  laquelle se situe le fichier. Effectue une requÃªte GET sans en-tÃªtes particuliers.","self").or({url:URLString.describe("L'URL de la requÃªte"),"headers?":type({"[string]":"string"}).describe("Les en-tÃªtes Ã  ajouter dans la requÃªte"),"method?":type.enumerated("GET","POST","PUT","DELETE").describe("La mÃ©thode de la requÃªte (GET par dÃ©faut)")}).configure("Le requÃªte HTTP pour obtenir le fichier, avec des en-tÃªtes et une mÃ©thode personnalisable","self"),ModelInput=type({width:["number < 1024","@","Largeur en pixels du tenseur d'entrÃ©e du modÃ¨le"],height:["number < 1024","@","Hauteur en pixels du tenseur d'entrÃ©e du modÃ¨le"],"disposition?":type(['"CHW"',"@","Tenseurs de la forme [3, H, W]"]).or(type(['"1CHW"',"@","Tenseurs de la forme [1, 3, H, W]"])),normalized:["boolean","@","Si les valeurs des pixels doivent Ãªtre normalisÃ©es entre 0 et 1. Sinon, elles sont entre 0 et 255"],"name?":["string","@","Nom de l'input du modÃ¨le Ã  utiliser. Par dÃ©faut, prend la premiÃ¨re input"]}),Dimensions=type({width:"number > 0",height:"number > 0"}).pipe(({width:d,height:m})=>({width:d,height:m,aspectRatio:d/m})),SHA1Hash=type("string.base64 == 28","@","Hash SHA-1 encodÃ© en base 64"),millisecondsInWeek=6048e5,millisecondsInDay=864e5,millisecondsInMinute=6e4,millisecondsInHour=36e5,millisecondsInSecond=1e3,constructFromSymbol=Symbol.for("constructDateFrom");function constructFrom(d,m){return typeof d=="function"?d(m):d&&typeof d=="object"&&constructFromSymbol in d?d[constructFromSymbol](m):d instanceof Date?new d.constructor(m):new Date(m)}function toDate(d,m){return constructFrom(m||d,d)}function addDays(d,m,g){const w=toDate(d,g?.in);return isNaN(m)?constructFrom(g?.in||d,NaN):(m&&w.setDate(w.getDate()+m),w)}let defaultOptions$1={};function getDefaultOptions$1(){return defaultOptions$1}function startOfWeek(d,m){const g=getDefaultOptions$1(),w=m?.weekStartsOn??m?.locale?.options?.weekStartsOn??g.weekStartsOn??g.locale?.options?.weekStartsOn??0,$=toDate(d,m?.in),I=$.getDay(),D=(I<w?7:0)+I-w;return $.setDate($.getDate()-D),$.setHours(0,0,0,0),$}function startOfISOWeek(d,m){return startOfWeek(d,{...m,weekStartsOn:1})}function getISOWeekYear(d,m){const g=toDate(d,m?.in),w=g.getFullYear(),$=constructFrom(g,0);$.setFullYear(w+1,0,4),$.setHours(0,0,0,0);const I=startOfISOWeek($),D=constructFrom(g,0);D.setFullYear(w,0,4),D.setHours(0,0,0,0);const F=startOfISOWeek(D);return g.getTime()>=I.getTime()?w+1:g.getTime()>=F.getTime()?w:w-1}function getTimezoneOffsetInMilliseconds(d){const m=toDate(d),g=new Date(Date.UTC(m.getFullYear(),m.getMonth(),m.getDate(),m.getHours(),m.getMinutes(),m.getSeconds(),m.getMilliseconds()));return g.setUTCFullYear(m.getFullYear()),+d-+g}function normalizeDates(d,...m){const g=constructFrom.bind(null,m.find(w=>typeof w=="object"));return m.map(g)}function startOfDay(d,m){const g=toDate(d,m?.in);return g.setHours(0,0,0,0),g}function differenceInCalendarDays(d,m,g){const[w,$]=normalizeDates(g?.in,d,m),I=startOfDay(w),D=startOfDay($),F=+I-getTimezoneOffsetInMilliseconds(I),U=+D-getTimezoneOffsetInMilliseconds(D);return Math.round((F-U)/millisecondsInDay)}function startOfISOWeekYear(d,m){const g=getISOWeekYear(d,m),w=constructFrom(d,0);return w.setFullYear(g,0,4),w.setHours(0,0,0,0),startOfISOWeek(w)}function isDate(d){return d instanceof Date||typeof d=="object"&&Object.prototype.toString.call(d)==="[object Date]"}function isValid$1(d){return!(!isDate(d)&&typeof d!="number"||isNaN(+toDate(d)))}function startOfYear(d,m){const g=toDate(d,m?.in);return g.setFullYear(g.getFullYear(),0,1),g.setHours(0,0,0,0),g}const formatDistanceLocale={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},formatDistance=(d,m,g)=>{let w;const $=formatDistanceLocale[d];return typeof $=="string"?w=$:m===1?w=$.one:w=$.other.replace("{{count}}",m.toString()),g?.addSuffix?g.comparison&&g.comparison>0?"in "+w:w+" ago":w};function buildFormatLongFn(d){return(m={})=>{const g=m.width?String(m.width):d.defaultWidth;return d.formats[g]||d.formats[d.defaultWidth]}}const dateFormats={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},timeFormats={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},dateTimeFormats={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},formatLong={date:buildFormatLongFn({formats:dateFormats,defaultWidth:"full"}),time:buildFormatLongFn({formats:timeFormats,defaultWidth:"full"}),dateTime:buildFormatLongFn({formats:dateTimeFormats,defaultWidth:"full"})},formatRelativeLocale={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},formatRelative=(d,m,g,w)=>formatRelativeLocale[d];function buildLocalizeFn(d){return(m,g)=>{const w=g?.context?String(g.context):"standalone";let $;if(w==="formatting"&&d.formattingValues){const D=d.defaultFormattingWidth||d.defaultWidth,F=g?.width?String(g.width):D;$=d.formattingValues[F]||d.formattingValues[D]}else{const D=d.defaultWidth,F=g?.width?String(g.width):d.defaultWidth;$=d.values[F]||d.values[D]}const I=d.argumentCallback?d.argumentCallback(m):m;return $[I]}}const eraValues={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},quarterValues={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},monthValues={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},dayValues={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},dayPeriodValues={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},formattingDayPeriodValues={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ordinalNumber=(d,m)=>{const g=Number(d),w=g%100;if(w>20||w<10)switch(w%10){case 1:return g+"st";case 2:return g+"nd";case 3:return g+"rd"}return g+"th"},localize={ordinalNumber,era:buildLocalizeFn({values:eraValues,defaultWidth:"wide"}),quarter:buildLocalizeFn({values:quarterValues,defaultWidth:"wide",argumentCallback:d=>d-1}),month:buildLocalizeFn({values:monthValues,defaultWidth:"wide"}),day:buildLocalizeFn({values:dayValues,defaultWidth:"wide"}),dayPeriod:buildLocalizeFn({values:dayPeriodValues,defaultWidth:"wide",formattingValues:formattingDayPeriodValues,defaultFormattingWidth:"wide"})};function buildMatchFn(d){return(m,g={})=>{const w=g.width,$=w&&d.matchPatterns[w]||d.matchPatterns[d.defaultMatchWidth],I=m.match($);if(!I)return null;const D=I[0],F=w&&d.parsePatterns[w]||d.parsePatterns[d.defaultParseWidth],U=Array.isArray(F)?findIndex(F,G=>G.test(D)):findKey(F,G=>G.test(D));let q;q=d.valueCallback?d.valueCallback(U):U,q=g.valueCallback?g.valueCallback(q):q;const j=m.slice(D.length);return{value:q,rest:j}}}function findKey(d,m){for(const g in d)if(Object.prototype.hasOwnProperty.call(d,g)&&m(d[g]))return g}function findIndex(d,m){for(let g=0;g<d.length;g++)if(m(d[g]))return g}function buildMatchPatternFn(d){return(m,g={})=>{const w=m.match(d.matchPattern);if(!w)return null;const $=w[0],I=m.match(d.parsePattern);if(!I)return null;let D=d.valueCallback?d.valueCallback(I[0]):I[0];D=g.valueCallback?g.valueCallback(D):D;const F=m.slice($.length);return{value:D,rest:F}}}const matchOrdinalNumberPattern=/^(\d+)(th|st|nd|rd)?/i,parseOrdinalNumberPattern=/\d+/i,matchEraPatterns={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},parseEraPatterns={any:[/^b/i,/^(a|c)/i]},matchQuarterPatterns={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},parseQuarterPatterns={any:[/1/i,/2/i,/3/i,/4/i]},matchMonthPatterns={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},parseMonthPatterns={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},matchDayPatterns={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},parseDayPatterns={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},matchDayPeriodPatterns={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},parseDayPeriodPatterns={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},match={ordinalNumber:buildMatchPatternFn({matchPattern:matchOrdinalNumberPattern,parsePattern:parseOrdinalNumberPattern,valueCallback:d=>parseInt(d,10)}),era:buildMatchFn({matchPatterns:matchEraPatterns,defaultMatchWidth:"wide",parsePatterns:parseEraPatterns,defaultParseWidth:"any"}),quarter:buildMatchFn({matchPatterns:matchQuarterPatterns,defaultMatchWidth:"wide",parsePatterns:parseQuarterPatterns,defaultParseWidth:"any",valueCallback:d=>d+1}),month:buildMatchFn({matchPatterns:matchMonthPatterns,defaultMatchWidth:"wide",parsePatterns:parseMonthPatterns,defaultParseWidth:"any"}),day:buildMatchFn({matchPatterns:matchDayPatterns,defaultMatchWidth:"wide",parsePatterns:parseDayPatterns,defaultParseWidth:"any"}),dayPeriod:buildMatchFn({matchPatterns:matchDayPeriodPatterns,defaultMatchWidth:"any",parsePatterns:parseDayPeriodPatterns,defaultParseWidth:"any"})},enUS={code:"en-US",formatDistance,formatLong,formatRelative,localize,match,options:{weekStartsOn:0,firstWeekContainsDate:1}};function getDayOfYear(d,m){const g=toDate(d,m?.in);return differenceInCalendarDays(g,startOfYear(g))+1}function getISOWeek(d,m){const g=toDate(d,m?.in),w=+startOfISOWeek(g)-+startOfISOWeekYear(g);return Math.round(w/millisecondsInWeek)+1}function getWeekYear(d,m){const g=toDate(d,m?.in),w=g.getFullYear(),$=getDefaultOptions$1(),I=m?.firstWeekContainsDate??m?.locale?.options?.firstWeekContainsDate??$.firstWeekContainsDate??$.locale?.options?.firstWeekContainsDate??1,D=constructFrom(m?.in||d,0);D.setFullYear(w+1,0,I),D.setHours(0,0,0,0);const F=startOfWeek(D,m),U=constructFrom(m?.in||d,0);U.setFullYear(w,0,I),U.setHours(0,0,0,0);const q=startOfWeek(U,m);return+g>=+F?w+1:+g>=+q?w:w-1}function startOfWeekYear(d,m){const g=getDefaultOptions$1(),w=m?.firstWeekContainsDate??m?.locale?.options?.firstWeekContainsDate??g.firstWeekContainsDate??g.locale?.options?.firstWeekContainsDate??1,$=getWeekYear(d,m),I=constructFrom(m?.in||d,0);return I.setFullYear($,0,w),I.setHours(0,0,0,0),startOfWeek(I,m)}function getWeek(d,m){const g=toDate(d,m?.in),w=+startOfWeek(g,m)-+startOfWeekYear(g,m);return Math.round(w/millisecondsInWeek)+1}function addLeadingZeros(d,m){const g=d<0?"-":"",w=Math.abs(d).toString().padStart(m,"0");return g+w}const lightFormatters={y(d,m){const g=d.getFullYear(),w=g>0?g:1-g;return addLeadingZeros(m==="yy"?w%100:w,m.length)},M(d,m){const g=d.getMonth();return m==="M"?String(g+1):addLeadingZeros(g+1,2)},d(d,m){return addLeadingZeros(d.getDate(),m.length)},a(d,m){const g=d.getHours()/12>=1?"pm":"am";switch(m){case"a":case"aa":return g.toUpperCase();case"aaa":return g;case"aaaaa":return g[0];case"aaaa":default:return g==="am"?"a.m.":"p.m."}},h(d,m){return addLeadingZeros(d.getHours()%12||12,m.length)},H(d,m){return addLeadingZeros(d.getHours(),m.length)},m(d,m){return addLeadingZeros(d.getMinutes(),m.length)},s(d,m){return addLeadingZeros(d.getSeconds(),m.length)},S(d,m){const g=m.length,w=d.getMilliseconds(),$=Math.trunc(w*Math.pow(10,g-3));return addLeadingZeros($,m.length)}},dayPeriodEnum={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},formatters={G:function(d,m,g){const w=d.getFullYear()>0?1:0;switch(m){case"G":case"GG":case"GGG":return g.era(w,{width:"abbreviated"});case"GGGGG":return g.era(w,{width:"narrow"});case"GGGG":default:return g.era(w,{width:"wide"})}},y:function(d,m,g){if(m==="yo"){const w=d.getFullYear(),$=w>0?w:1-w;return g.ordinalNumber($,{unit:"year"})}return lightFormatters.y(d,m)},Y:function(d,m,g,w){const $=getWeekYear(d,w),I=$>0?$:1-$;if(m==="YY"){const D=I%100;return addLeadingZeros(D,2)}return m==="Yo"?g.ordinalNumber(I,{unit:"year"}):addLeadingZeros(I,m.length)},R:function(d,m){const g=getISOWeekYear(d);return addLeadingZeros(g,m.length)},u:function(d,m){const g=d.getFullYear();return addLeadingZeros(g,m.length)},Q:function(d,m,g){const w=Math.ceil((d.getMonth()+1)/3);switch(m){case"Q":return String(w);case"QQ":return addLeadingZeros(w,2);case"Qo":return g.ordinalNumber(w,{unit:"quarter"});case"QQQ":return g.quarter(w,{width:"abbreviated",context:"formatting"});case"QQQQQ":return g.quarter(w,{width:"narrow",context:"formatting"});case"QQQQ":default:return g.quarter(w,{width:"wide",context:"formatting"})}},q:function(d,m,g){const w=Math.ceil((d.getMonth()+1)/3);switch(m){case"q":return String(w);case"qq":return addLeadingZeros(w,2);case"qo":return g.ordinalNumber(w,{unit:"quarter"});case"qqq":return g.quarter(w,{width:"abbreviated",context:"standalone"});case"qqqqq":return g.quarter(w,{width:"narrow",context:"standalone"});case"qqqq":default:return g.quarter(w,{width:"wide",context:"standalone"})}},M:function(d,m,g){const w=d.getMonth();switch(m){case"M":case"MM":return lightFormatters.M(d,m);case"Mo":return g.ordinalNumber(w+1,{unit:"month"});case"MMM":return g.month(w,{width:"abbreviated",context:"formatting"});case"MMMMM":return g.month(w,{width:"narrow",context:"formatting"});case"MMMM":default:return g.month(w,{width:"wide",context:"formatting"})}},L:function(d,m,g){const w=d.getMonth();switch(m){case"L":return String(w+1);case"LL":return addLeadingZeros(w+1,2);case"Lo":return g.ordinalNumber(w+1,{unit:"month"});case"LLL":return g.month(w,{width:"abbreviated",context:"standalone"});case"LLLLL":return g.month(w,{width:"narrow",context:"standalone"});case"LLLL":default:return g.month(w,{width:"wide",context:"standalone"})}},w:function(d,m,g,w){const $=getWeek(d,w);return m==="wo"?g.ordinalNumber($,{unit:"week"}):addLeadingZeros($,m.length)},I:function(d,m,g){const w=getISOWeek(d);return m==="Io"?g.ordinalNumber(w,{unit:"week"}):addLeadingZeros(w,m.length)},d:function(d,m,g){return m==="do"?g.ordinalNumber(d.getDate(),{unit:"date"}):lightFormatters.d(d,m)},D:function(d,m,g){const w=getDayOfYear(d);return m==="Do"?g.ordinalNumber(w,{unit:"dayOfYear"}):addLeadingZeros(w,m.length)},E:function(d,m,g){const w=d.getDay();switch(m){case"E":case"EE":case"EEE":return g.day(w,{width:"abbreviated",context:"formatting"});case"EEEEE":return g.day(w,{width:"narrow",context:"formatting"});case"EEEEEE":return g.day(w,{width:"short",context:"formatting"});case"EEEE":default:return g.day(w,{width:"wide",context:"formatting"})}},e:function(d,m,g,w){const $=d.getDay(),I=($-w.weekStartsOn+8)%7||7;switch(m){case"e":return String(I);case"ee":return addLeadingZeros(I,2);case"eo":return g.ordinalNumber(I,{unit:"day"});case"eee":return g.day($,{width:"abbreviated",context:"formatting"});case"eeeee":return g.day($,{width:"narrow",context:"formatting"});case"eeeeee":return g.day($,{width:"short",context:"formatting"});case"eeee":default:return g.day($,{width:"wide",context:"formatting"})}},c:function(d,m,g,w){const $=d.getDay(),I=($-w.weekStartsOn+8)%7||7;switch(m){case"c":return String(I);case"cc":return addLeadingZeros(I,m.length);case"co":return g.ordinalNumber(I,{unit:"day"});case"ccc":return g.day($,{width:"abbreviated",context:"standalone"});case"ccccc":return g.day($,{width:"narrow",context:"standalone"});case"cccccc":return g.day($,{width:"short",context:"standalone"});case"cccc":default:return g.day($,{width:"wide",context:"standalone"})}},i:function(d,m,g){const w=d.getDay(),$=w===0?7:w;switch(m){case"i":return String($);case"ii":return addLeadingZeros($,m.length);case"io":return g.ordinalNumber($,{unit:"day"});case"iii":return g.day(w,{width:"abbreviated",context:"formatting"});case"iiiii":return g.day(w,{width:"narrow",context:"formatting"});case"iiiiii":return g.day(w,{width:"short",context:"formatting"});case"iiii":default:return g.day(w,{width:"wide",context:"formatting"})}},a:function(d,m,g){const $=d.getHours()/12>=1?"pm":"am";switch(m){case"a":case"aa":return g.dayPeriod($,{width:"abbreviated",context:"formatting"});case"aaa":return g.dayPeriod($,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return g.dayPeriod($,{width:"narrow",context:"formatting"});case"aaaa":default:return g.dayPeriod($,{width:"wide",context:"formatting"})}},b:function(d,m,g){const w=d.getHours();let $;switch(w===12?$=dayPeriodEnum.noon:w===0?$=dayPeriodEnum.midnight:$=w/12>=1?"pm":"am",m){case"b":case"bb":return g.dayPeriod($,{width:"abbreviated",context:"formatting"});case"bbb":return g.dayPeriod($,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return g.dayPeriod($,{width:"narrow",context:"formatting"});case"bbbb":default:return g.dayPeriod($,{width:"wide",context:"formatting"})}},B:function(d,m,g){const w=d.getHours();let $;switch(w>=17?$=dayPeriodEnum.evening:w>=12?$=dayPeriodEnum.afternoon:w>=4?$=dayPeriodEnum.morning:$=dayPeriodEnum.night,m){case"B":case"BB":case"BBB":return g.dayPeriod($,{width:"abbreviated",context:"formatting"});case"BBBBB":return g.dayPeriod($,{width:"narrow",context:"formatting"});case"BBBB":default:return g.dayPeriod($,{width:"wide",context:"formatting"})}},h:function(d,m,g){if(m==="ho"){let w=d.getHours()%12;return w===0&&(w=12),g.ordinalNumber(w,{unit:"hour"})}return lightFormatters.h(d,m)},H:function(d,m,g){return m==="Ho"?g.ordinalNumber(d.getHours(),{unit:"hour"}):lightFormatters.H(d,m)},K:function(d,m,g){const w=d.getHours()%12;return m==="Ko"?g.ordinalNumber(w,{unit:"hour"}):addLeadingZeros(w,m.length)},k:function(d,m,g){let w=d.getHours();return w===0&&(w=24),m==="ko"?g.ordinalNumber(w,{unit:"hour"}):addLeadingZeros(w,m.length)},m:function(d,m,g){return m==="mo"?g.ordinalNumber(d.getMinutes(),{unit:"minute"}):lightFormatters.m(d,m)},s:function(d,m,g){return m==="so"?g.ordinalNumber(d.getSeconds(),{unit:"second"}):lightFormatters.s(d,m)},S:function(d,m){return lightFormatters.S(d,m)},X:function(d,m,g){const w=d.getTimezoneOffset();if(w===0)return"Z";switch(m){case"X":return formatTimezoneWithOptionalMinutes(w);case"XXXX":case"XX":return formatTimezone(w);case"XXXXX":case"XXX":default:return formatTimezone(w,":")}},x:function(d,m,g){const w=d.getTimezoneOffset();switch(m){case"x":return formatTimezoneWithOptionalMinutes(w);case"xxxx":case"xx":return formatTimezone(w);case"xxxxx":case"xxx":default:return formatTimezone(w,":")}},O:function(d,m,g){const w=d.getTimezoneOffset();switch(m){case"O":case"OO":case"OOO":return"GMT"+formatTimezoneShort(w,":");case"OOOO":default:return"GMT"+formatTimezone(w,":")}},z:function(d,m,g){const w=d.getTimezoneOffset();switch(m){case"z":case"zz":case"zzz":return"GMT"+formatTimezoneShort(w,":");case"zzzz":default:return"GMT"+formatTimezone(w,":")}},t:function(d,m,g){const w=Math.trunc(+d/1e3);return addLeadingZeros(w,m.length)},T:function(d,m,g){return addLeadingZeros(+d,m.length)}};function formatTimezoneShort(d,m=""){const g=d>0?"-":"+",w=Math.abs(d),$=Math.trunc(w/60),I=w%60;return I===0?g+String($):g+String($)+m+addLeadingZeros(I,2)}function formatTimezoneWithOptionalMinutes(d,m){return d%60===0?(d>0?"-":"+")+addLeadingZeros(Math.abs(d)/60,2):formatTimezone(d,m)}function formatTimezone(d,m=""){const g=d>0?"-":"+",w=Math.abs(d),$=addLeadingZeros(Math.trunc(w/60),2),I=addLeadingZeros(w%60,2);return g+$+m+I}const dateLongFormatter=(d,m)=>{switch(d){case"P":return m.date({width:"short"});case"PP":return m.date({width:"medium"});case"PPP":return m.date({width:"long"});case"PPPP":default:return m.date({width:"full"})}},timeLongFormatter=(d,m)=>{switch(d){case"p":return m.time({width:"short"});case"pp":return m.time({width:"medium"});case"ppp":return m.time({width:"long"});case"pppp":default:return m.time({width:"full"})}},dateTimeLongFormatter=(d,m)=>{const g=d.match(/(P+)(p+)?/)||[],w=g[1],$=g[2];if(!$)return dateLongFormatter(d,m);let I;switch(w){case"P":I=m.dateTime({width:"short"});break;case"PP":I=m.dateTime({width:"medium"});break;case"PPP":I=m.dateTime({width:"long"});break;case"PPPP":default:I=m.dateTime({width:"full"});break}return I.replace("{{date}}",dateLongFormatter(w,m)).replace("{{time}}",timeLongFormatter($,m))},longFormatters={p:timeLongFormatter,P:dateTimeLongFormatter},dayOfYearTokenRE=/^D+$/,weekYearTokenRE=/^Y+$/,throwTokens=["D","DD","YY","YYYY"];function isProtectedDayOfYearToken(d){return dayOfYearTokenRE.test(d)}function isProtectedWeekYearToken(d){return weekYearTokenRE.test(d)}function warnOrThrowProtectedError(d,m,g){const w=message(d,m,g);if(console.warn(w),throwTokens.includes(d))throw new RangeError(w)}function message(d,m,g){const w=d[0]==="Y"?"years":"days of the month";return`Use \`${d.toLowerCase()}\` instead of \`${d}\` (in \`${m}\`) for formatting ${w} to the input \`${g}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const formattingTokensRegExp$1=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,longFormattingTokensRegExp$1=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,escapedStringRegExp$1=/^'([^]*?)'?$/,doubleQuoteRegExp$1=/''/g,unescapedLatinCharacterRegExp$1=/[a-zA-Z]/;function format(d,m,g){const w=getDefaultOptions$1(),$=w.locale??enUS,I=w.firstWeekContainsDate??w.locale?.options?.firstWeekContainsDate??1,D=w.weekStartsOn??w.locale?.options?.weekStartsOn??0,F=toDate(d,g?.in);if(!isValid$1(F))throw new RangeError("Invalid time value");let U=m.match(longFormattingTokensRegExp$1).map(j=>{const G=j[0];if(G==="p"||G==="P"){const H=longFormatters[G];return H(j,$.formatLong)}return j}).join("").match(formattingTokensRegExp$1).map(j=>{if(j==="''")return{isToken:!1,value:"'"};const G=j[0];if(G==="'")return{isToken:!1,value:cleanEscapedString$1(j)};if(formatters[G])return{isToken:!0,value:j};if(G.match(unescapedLatinCharacterRegExp$1))throw new RangeError("Format string contains an unescaped latin alphabet character `"+G+"`");return{isToken:!1,value:j}});$.localize.preprocessor&&(U=$.localize.preprocessor(F,U));const q={firstWeekContainsDate:I,weekStartsOn:D,locale:$};return U.map(j=>{if(!j.isToken)return j.value;const G=j.value;(isProtectedWeekYearToken(G)||isProtectedDayOfYearToken(G))&&warnOrThrowProtectedError(G,m,String(d));const H=formatters[G[0]];return H(F,G,$.localize,q)}).join("")}function cleanEscapedString$1(d){const m=d.match(escapedStringRegExp$1);return m?m[1].replace(doubleQuoteRegExp$1,"'"):d}function getDefaultOptions(){return Object.assign({},getDefaultOptions$1())}function getISODay(d,m){const g=toDate(d,m?.in).getDay();return g===0?7:g}function transpose(d,m){const g=isConstructor(m)?new m(0):constructFrom(m,0);return g.setFullYear(d.getFullYear(),d.getMonth(),d.getDate()),g.setHours(d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()),g}function isConstructor(d){return typeof d=="function"&&d.prototype?.constructor===d}const TIMEZONE_UNIT_PRIORITY=10;class Setter{subPriority=0;validate(m,g){return!0}}class ValueSetter extends Setter{constructor(m,g,w,$,I){super(),this.value=m,this.validateValue=g,this.setValue=w,this.priority=$,I&&(this.subPriority=I)}validate(m,g){return this.validateValue(m,this.value,g)}set(m,g,w){return this.setValue(m,g,this.value,w)}}class DateTimezoneSetter extends Setter{priority=TIMEZONE_UNIT_PRIORITY;subPriority=-1;constructor(m,g){super(),this.context=m||(w=>constructFrom(g,w))}set(m,g){return g.timestampIsSet?m:constructFrom(m,transpose(m,this.context))}}let Parser$3=class{run(m,g,w,$){const I=this.parse(m,g,w,$);return I?{setter:new ValueSetter(I.value,this.validate,this.set,this.priority,this.subPriority),rest:I.rest}:null}validate(m,g,w){return!0}};class EraParser extends Parser$3{priority=140;parse(m,g,w){switch(g){case"G":case"GG":case"GGG":return w.era(m,{width:"abbreviated"})||w.era(m,{width:"narrow"});case"GGGGG":return w.era(m,{width:"narrow"});case"GGGG":default:return w.era(m,{width:"wide"})||w.era(m,{width:"abbreviated"})||w.era(m,{width:"narrow"})}}set(m,g,w){return g.era=w,m.setFullYear(w,0,1),m.setHours(0,0,0,0),m}incompatibleTokens=["R","u","t","T"]}const numericPatterns={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},timezonePatterns={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function mapValue(d,m){return d&&{value:m(d.value),rest:d.rest}}function parseNumericPattern(d,m){const g=m.match(d);return g?{value:parseInt(g[0],10),rest:m.slice(g[0].length)}:null}function parseTimezonePattern(d,m){const g=m.match(d);if(!g)return null;if(g[0]==="Z")return{value:0,rest:m.slice(1)};const w=g[1]==="+"?1:-1,$=g[2]?parseInt(g[2],10):0,I=g[3]?parseInt(g[3],10):0,D=g[5]?parseInt(g[5],10):0;return{value:w*($*millisecondsInHour+I*millisecondsInMinute+D*millisecondsInSecond),rest:m.slice(g[0].length)}}function parseAnyDigitsSigned(d){return parseNumericPattern(numericPatterns.anyDigitsSigned,d)}function parseNDigits(d,m){switch(d){case 1:return parseNumericPattern(numericPatterns.singleDigit,m);case 2:return parseNumericPattern(numericPatterns.twoDigits,m);case 3:return parseNumericPattern(numericPatterns.threeDigits,m);case 4:return parseNumericPattern(numericPatterns.fourDigits,m);default:return parseNumericPattern(new RegExp("^\\d{1,"+d+"}"),m)}}function parseNDigitsSigned(d,m){switch(d){case 1:return parseNumericPattern(numericPatterns.singleDigitSigned,m);case 2:return parseNumericPattern(numericPatterns.twoDigitsSigned,m);case 3:return parseNumericPattern(numericPatterns.threeDigitsSigned,m);case 4:return parseNumericPattern(numericPatterns.fourDigitsSigned,m);default:return parseNumericPattern(new RegExp("^-?\\d{1,"+d+"}"),m)}}function dayPeriodEnumToHours(d){switch(d){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function normalizeTwoDigitYear(d,m){const g=m>0,w=g?m:1-m;let $;if(w<=50)$=d||100;else{const I=w+50,D=Math.trunc(I/100)*100,F=d>=I%100;$=d+D-(F?100:0)}return g?$:1-$}function isLeapYearIndex(d){return d%400===0||d%4===0&&d%100!==0}class YearParser extends Parser$3{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(m,g,w){const $=I=>({year:I,isTwoDigitYear:g==="yy"});switch(g){case"y":return mapValue(parseNDigits(4,m),$);case"yo":return mapValue(w.ordinalNumber(m,{unit:"year"}),$);default:return mapValue(parseNDigits(g.length,m),$)}}validate(m,g){return g.isTwoDigitYear||g.year>0}set(m,g,w){const $=m.getFullYear();if(w.isTwoDigitYear){const D=normalizeTwoDigitYear(w.year,$);return m.setFullYear(D,0,1),m.setHours(0,0,0,0),m}const I=!("era"in g)||g.era===1?w.year:1-w.year;return m.setFullYear(I,0,1),m.setHours(0,0,0,0),m}}class LocalWeekYearParser extends Parser$3{priority=130;parse(m,g,w){const $=I=>({year:I,isTwoDigitYear:g==="YY"});switch(g){case"Y":return mapValue(parseNDigits(4,m),$);case"Yo":return mapValue(w.ordinalNumber(m,{unit:"year"}),$);default:return mapValue(parseNDigits(g.length,m),$)}}validate(m,g){return g.isTwoDigitYear||g.year>0}set(m,g,w,$){const I=getWeekYear(m,$);if(w.isTwoDigitYear){const F=normalizeTwoDigitYear(w.year,I);return m.setFullYear(F,0,$.firstWeekContainsDate),m.setHours(0,0,0,0),startOfWeek(m,$)}const D=!("era"in g)||g.era===1?w.year:1-w.year;return m.setFullYear(D,0,$.firstWeekContainsDate),m.setHours(0,0,0,0),startOfWeek(m,$)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]}class ISOWeekYearParser extends Parser$3{priority=130;parse(m,g){return parseNDigitsSigned(g==="R"?4:g.length,m)}set(m,g,w){const $=constructFrom(m,0);return $.setFullYear(w,0,4),$.setHours(0,0,0,0),startOfISOWeek($)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]}class ExtendedYearParser extends Parser$3{priority=130;parse(m,g){return parseNDigitsSigned(g==="u"?4:g.length,m)}set(m,g,w){return m.setFullYear(w,0,1),m.setHours(0,0,0,0),m}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]}class QuarterParser extends Parser$3{priority=120;parse(m,g,w){switch(g){case"Q":case"QQ":return parseNDigits(g.length,m);case"Qo":return w.ordinalNumber(m,{unit:"quarter"});case"QQQ":return w.quarter(m,{width:"abbreviated",context:"formatting"})||w.quarter(m,{width:"narrow",context:"formatting"});case"QQQQQ":return w.quarter(m,{width:"narrow",context:"formatting"});case"QQQQ":default:return w.quarter(m,{width:"wide",context:"formatting"})||w.quarter(m,{width:"abbreviated",context:"formatting"})||w.quarter(m,{width:"narrow",context:"formatting"})}}validate(m,g){return g>=1&&g<=4}set(m,g,w){return m.setMonth((w-1)*3,1),m.setHours(0,0,0,0),m}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]}class StandAloneQuarterParser extends Parser$3{priority=120;parse(m,g,w){switch(g){case"q":case"qq":return parseNDigits(g.length,m);case"qo":return w.ordinalNumber(m,{unit:"quarter"});case"qqq":return w.quarter(m,{width:"abbreviated",context:"standalone"})||w.quarter(m,{width:"narrow",context:"standalone"});case"qqqqq":return w.quarter(m,{width:"narrow",context:"standalone"});case"qqqq":default:return w.quarter(m,{width:"wide",context:"standalone"})||w.quarter(m,{width:"abbreviated",context:"standalone"})||w.quarter(m,{width:"narrow",context:"standalone"})}}validate(m,g){return g>=1&&g<=4}set(m,g,w){return m.setMonth((w-1)*3,1),m.setHours(0,0,0,0),m}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]}class MonthParser extends Parser$3{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(m,g,w){const $=I=>I-1;switch(g){case"M":return mapValue(parseNumericPattern(numericPatterns.month,m),$);case"MM":return mapValue(parseNDigits(2,m),$);case"Mo":return mapValue(w.ordinalNumber(m,{unit:"month"}),$);case"MMM":return w.month(m,{width:"abbreviated",context:"formatting"})||w.month(m,{width:"narrow",context:"formatting"});case"MMMMM":return w.month(m,{width:"narrow",context:"formatting"});case"MMMM":default:return w.month(m,{width:"wide",context:"formatting"})||w.month(m,{width:"abbreviated",context:"formatting"})||w.month(m,{width:"narrow",context:"formatting"})}}validate(m,g){return g>=0&&g<=11}set(m,g,w){return m.setMonth(w,1),m.setHours(0,0,0,0),m}}class StandAloneMonthParser extends Parser$3{priority=110;parse(m,g,w){const $=I=>I-1;switch(g){case"L":return mapValue(parseNumericPattern(numericPatterns.month,m),$);case"LL":return mapValue(parseNDigits(2,m),$);case"Lo":return mapValue(w.ordinalNumber(m,{unit:"month"}),$);case"LLL":return w.month(m,{width:"abbreviated",context:"standalone"})||w.month(m,{width:"narrow",context:"standalone"});case"LLLLL":return w.month(m,{width:"narrow",context:"standalone"});case"LLLL":default:return w.month(m,{width:"wide",context:"standalone"})||w.month(m,{width:"abbreviated",context:"standalone"})||w.month(m,{width:"narrow",context:"standalone"})}}validate(m,g){return g>=0&&g<=11}set(m,g,w){return m.setMonth(w,1),m.setHours(0,0,0,0),m}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]}function setWeek(d,m,g){const w=toDate(d,g?.in),$=getWeek(w,g)-m;return w.setDate(w.getDate()-$*7),toDate(w,g?.in)}class LocalWeekParser extends Parser$3{priority=100;parse(m,g,w){switch(g){case"w":return parseNumericPattern(numericPatterns.week,m);case"wo":return w.ordinalNumber(m,{unit:"week"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=1&&g<=53}set(m,g,w,$){return startOfWeek(setWeek(m,w,$),$)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]}function setISOWeek(d,m,g){const w=toDate(d,g?.in),$=getISOWeek(w,g)-m;return w.setDate(w.getDate()-$*7),w}class ISOWeekParser extends Parser$3{priority=100;parse(m,g,w){switch(g){case"I":return parseNumericPattern(numericPatterns.week,m);case"Io":return w.ordinalNumber(m,{unit:"week"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=1&&g<=53}set(m,g,w){return startOfISOWeek(setISOWeek(m,w))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]}const DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],DAYS_IN_MONTH_LEAP_YEAR=[31,29,31,30,31,30,31,31,30,31,30,31];class DateParser extends Parser$3{priority=90;subPriority=1;parse(m,g,w){switch(g){case"d":return parseNumericPattern(numericPatterns.date,m);case"do":return w.ordinalNumber(m,{unit:"date"});default:return parseNDigits(g.length,m)}}validate(m,g){const w=m.getFullYear(),$=isLeapYearIndex(w),I=m.getMonth();return $?g>=1&&g<=DAYS_IN_MONTH_LEAP_YEAR[I]:g>=1&&g<=DAYS_IN_MONTH[I]}set(m,g,w){return m.setDate(w),m.setHours(0,0,0,0),m}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]}class DayOfYearParser extends Parser$3{priority=90;subpriority=1;parse(m,g,w){switch(g){case"D":case"DD":return parseNumericPattern(numericPatterns.dayOfYear,m);case"Do":return w.ordinalNumber(m,{unit:"date"});default:return parseNDigits(g.length,m)}}validate(m,g){const w=m.getFullYear();return isLeapYearIndex(w)?g>=1&&g<=366:g>=1&&g<=365}set(m,g,w){return m.setMonth(0,w),m.setHours(0,0,0,0),m}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]}function setDay(d,m,g){const w=getDefaultOptions$1(),$=g?.weekStartsOn??g?.locale?.options?.weekStartsOn??w.weekStartsOn??w.locale?.options?.weekStartsOn??0,I=toDate(d,g?.in),D=I.getDay(),U=(m%7+7)%7,q=7-$,j=m<0||m>6?m-(D+q)%7:(U+q)%7-(D+q)%7;return addDays(I,j,g)}class DayParser extends Parser$3{priority=90;parse(m,g,w){switch(g){case"E":case"EE":case"EEE":return w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"});case"EEEEE":return w.day(m,{width:"narrow",context:"formatting"});case"EEEEEE":return w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"});case"EEEE":default:return w.day(m,{width:"wide",context:"formatting"})||w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"})}}validate(m,g){return g>=0&&g<=6}set(m,g,w,$){return m=setDay(m,w,$),m.setHours(0,0,0,0),m}incompatibleTokens=["D","i","e","c","t","T"]}class LocalDayParser extends Parser$3{priority=90;parse(m,g,w,$){const I=D=>{const F=Math.floor((D-1)/7)*7;return(D+$.weekStartsOn+6)%7+F};switch(g){case"e":case"ee":return mapValue(parseNDigits(g.length,m),I);case"eo":return mapValue(w.ordinalNumber(m,{unit:"day"}),I);case"eee":return w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"});case"eeeee":return w.day(m,{width:"narrow",context:"formatting"});case"eeeeee":return w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"});case"eeee":default:return w.day(m,{width:"wide",context:"formatting"})||w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"})}}validate(m,g){return g>=0&&g<=6}set(m,g,w,$){return m=setDay(m,w,$),m.setHours(0,0,0,0),m}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]}class StandAloneLocalDayParser extends Parser$3{priority=90;parse(m,g,w,$){const I=D=>{const F=Math.floor((D-1)/7)*7;return(D+$.weekStartsOn+6)%7+F};switch(g){case"c":case"cc":return mapValue(parseNDigits(g.length,m),I);case"co":return mapValue(w.ordinalNumber(m,{unit:"day"}),I);case"ccc":return w.day(m,{width:"abbreviated",context:"standalone"})||w.day(m,{width:"short",context:"standalone"})||w.day(m,{width:"narrow",context:"standalone"});case"ccccc":return w.day(m,{width:"narrow",context:"standalone"});case"cccccc":return w.day(m,{width:"short",context:"standalone"})||w.day(m,{width:"narrow",context:"standalone"});case"cccc":default:return w.day(m,{width:"wide",context:"standalone"})||w.day(m,{width:"abbreviated",context:"standalone"})||w.day(m,{width:"short",context:"standalone"})||w.day(m,{width:"narrow",context:"standalone"})}}validate(m,g){return g>=0&&g<=6}set(m,g,w,$){return m=setDay(m,w,$),m.setHours(0,0,0,0),m}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]}function setISODay(d,m,g){const w=toDate(d,g?.in),$=getISODay(w,g),I=m-$;return addDays(w,I,g)}class ISODayParser extends Parser$3{priority=90;parse(m,g,w){const $=I=>I===0?7:I;switch(g){case"i":case"ii":return parseNDigits(g.length,m);case"io":return w.ordinalNumber(m,{unit:"day"});case"iii":return mapValue(w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"}),$);case"iiiii":return mapValue(w.day(m,{width:"narrow",context:"formatting"}),$);case"iiiiii":return mapValue(w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"}),$);case"iiii":default:return mapValue(w.day(m,{width:"wide",context:"formatting"})||w.day(m,{width:"abbreviated",context:"formatting"})||w.day(m,{width:"short",context:"formatting"})||w.day(m,{width:"narrow",context:"formatting"}),$)}}validate(m,g){return g>=1&&g<=7}set(m,g,w){return m=setISODay(m,w),m.setHours(0,0,0,0),m}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]}class AMPMParser extends Parser$3{priority=80;parse(m,g,w){switch(g){case"a":case"aa":case"aaa":return w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"});case"aaaaa":return w.dayPeriod(m,{width:"narrow",context:"formatting"});case"aaaa":default:return w.dayPeriod(m,{width:"wide",context:"formatting"})||w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"})}}set(m,g,w){return m.setHours(dayPeriodEnumToHours(w),0,0,0),m}incompatibleTokens=["b","B","H","k","t","T"]}class AMPMMidnightParser extends Parser$3{priority=80;parse(m,g,w){switch(g){case"b":case"bb":case"bbb":return w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"});case"bbbbb":return w.dayPeriod(m,{width:"narrow",context:"formatting"});case"bbbb":default:return w.dayPeriod(m,{width:"wide",context:"formatting"})||w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"})}}set(m,g,w){return m.setHours(dayPeriodEnumToHours(w),0,0,0),m}incompatibleTokens=["a","B","H","k","t","T"]}class DayPeriodParser extends Parser$3{priority=80;parse(m,g,w){switch(g){case"B":case"BB":case"BBB":return w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"});case"BBBBB":return w.dayPeriod(m,{width:"narrow",context:"formatting"});case"BBBB":default:return w.dayPeriod(m,{width:"wide",context:"formatting"})||w.dayPeriod(m,{width:"abbreviated",context:"formatting"})||w.dayPeriod(m,{width:"narrow",context:"formatting"})}}set(m,g,w){return m.setHours(dayPeriodEnumToHours(w),0,0,0),m}incompatibleTokens=["a","b","t","T"]}class Hour1to12Parser extends Parser$3{priority=70;parse(m,g,w){switch(g){case"h":return parseNumericPattern(numericPatterns.hour12h,m);case"ho":return w.ordinalNumber(m,{unit:"hour"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=1&&g<=12}set(m,g,w){const $=m.getHours()>=12;return $&&w<12?m.setHours(w+12,0,0,0):!$&&w===12?m.setHours(0,0,0,0):m.setHours(w,0,0,0),m}incompatibleTokens=["H","K","k","t","T"]}class Hour0to23Parser extends Parser$3{priority=70;parse(m,g,w){switch(g){case"H":return parseNumericPattern(numericPatterns.hour23h,m);case"Ho":return w.ordinalNumber(m,{unit:"hour"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=0&&g<=23}set(m,g,w){return m.setHours(w,0,0,0),m}incompatibleTokens=["a","b","h","K","k","t","T"]}class Hour0To11Parser extends Parser$3{priority=70;parse(m,g,w){switch(g){case"K":return parseNumericPattern(numericPatterns.hour11h,m);case"Ko":return w.ordinalNumber(m,{unit:"hour"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=0&&g<=11}set(m,g,w){return m.getHours()>=12&&w<12?m.setHours(w+12,0,0,0):m.setHours(w,0,0,0),m}incompatibleTokens=["h","H","k","t","T"]}class Hour1To24Parser extends Parser$3{priority=70;parse(m,g,w){switch(g){case"k":return parseNumericPattern(numericPatterns.hour24h,m);case"ko":return w.ordinalNumber(m,{unit:"hour"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=1&&g<=24}set(m,g,w){const $=w<=24?w%24:w;return m.setHours($,0,0,0),m}incompatibleTokens=["a","b","h","H","K","t","T"]}class MinuteParser extends Parser$3{priority=60;parse(m,g,w){switch(g){case"m":return parseNumericPattern(numericPatterns.minute,m);case"mo":return w.ordinalNumber(m,{unit:"minute"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=0&&g<=59}set(m,g,w){return m.setMinutes(w,0,0),m}incompatibleTokens=["t","T"]}class SecondParser extends Parser$3{priority=50;parse(m,g,w){switch(g){case"s":return parseNumericPattern(numericPatterns.second,m);case"so":return w.ordinalNumber(m,{unit:"second"});default:return parseNDigits(g.length,m)}}validate(m,g){return g>=0&&g<=59}set(m,g,w){return m.setSeconds(w,0),m}incompatibleTokens=["t","T"]}class FractionOfSecondParser extends Parser$3{priority=30;parse(m,g){const w=$=>Math.trunc($*Math.pow(10,-g.length+3));return mapValue(parseNDigits(g.length,m),w)}set(m,g,w){return m.setMilliseconds(w),m}incompatibleTokens=["t","T"]}class ISOTimezoneWithZParser extends Parser$3{priority=10;parse(m,g){switch(g){case"X":return parseTimezonePattern(timezonePatterns.basicOptionalMinutes,m);case"XX":return parseTimezonePattern(timezonePatterns.basic,m);case"XXXX":return parseTimezonePattern(timezonePatterns.basicOptionalSeconds,m);case"XXXXX":return parseTimezonePattern(timezonePatterns.extendedOptionalSeconds,m);case"XXX":default:return parseTimezonePattern(timezonePatterns.extended,m)}}set(m,g,w){return g.timestampIsSet?m:constructFrom(m,m.getTime()-getTimezoneOffsetInMilliseconds(m)-w)}incompatibleTokens=["t","T","x"]}class ISOTimezoneParser extends Parser$3{priority=10;parse(m,g){switch(g){case"x":return parseTimezonePattern(timezonePatterns.basicOptionalMinutes,m);case"xx":return parseTimezonePattern(timezonePatterns.basic,m);case"xxxx":return parseTimezonePattern(timezonePatterns.basicOptionalSeconds,m);case"xxxxx":return parseTimezonePattern(timezonePatterns.extendedOptionalSeconds,m);case"xxx":default:return parseTimezonePattern(timezonePatterns.extended,m)}}set(m,g,w){return g.timestampIsSet?m:constructFrom(m,m.getTime()-getTimezoneOffsetInMilliseconds(m)-w)}incompatibleTokens=["t","T","X"]}class TimestampSecondsParser extends Parser$3{priority=40;parse(m){return parseAnyDigitsSigned(m)}set(m,g,w){return[constructFrom(m,w*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"}class TimestampMillisecondsParser extends Parser$3{priority=20;parse(m){return parseAnyDigitsSigned(m)}set(m,g,w){return[constructFrom(m,w),{timestampIsSet:!0}]}incompatibleTokens="*"}const parsers={G:new EraParser,y:new YearParser,Y:new LocalWeekYearParser,R:new ISOWeekYearParser,u:new ExtendedYearParser,Q:new QuarterParser,q:new StandAloneQuarterParser,M:new MonthParser,L:new StandAloneMonthParser,w:new LocalWeekParser,I:new ISOWeekParser,d:new DateParser,D:new DayOfYearParser,E:new DayParser,e:new LocalDayParser,c:new StandAloneLocalDayParser,i:new ISODayParser,a:new AMPMParser,b:new AMPMMidnightParser,B:new DayPeriodParser,h:new Hour1to12Parser,H:new Hour0to23Parser,K:new Hour0To11Parser,k:new Hour1To24Parser,m:new MinuteParser,s:new SecondParser,S:new FractionOfSecondParser,X:new ISOTimezoneWithZParser,x:new ISOTimezoneParser,t:new TimestampSecondsParser,T:new TimestampMillisecondsParser},formattingTokensRegExp=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,longFormattingTokensRegExp=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,escapedStringRegExp=/^'([^]*?)'?$/,doubleQuoteRegExp=/''/g,notWhitespaceRegExp=/\S/,unescapedLatinCharacterRegExp=/[a-zA-Z]/;function parse$2(d,m,g,w){const $=()=>constructFrom(g,NaN),I=getDefaultOptions(),D=I.locale??enUS,F=I.firstWeekContainsDate??I.locale?.options?.firstWeekContainsDate??1,U=I.weekStartsOn??I.locale?.options?.weekStartsOn??0;if(!m)return d?$():toDate(g,w?.in);const q={firstWeekContainsDate:F,weekStartsOn:U,locale:D},j=[new DateTimezoneSetter(w?.in,g)],G=m.match(longFormattingTokensRegExp).map(J=>{const ie=J[0];if(ie in longFormatters){const re=longFormatters[ie];return re(J,D.formatLong)}return J}).join("").match(formattingTokensRegExp),H=[];for(let J of G){isProtectedWeekYearToken(J)&&warnOrThrowProtectedError(J,m,d),isProtectedDayOfYearToken(J)&&warnOrThrowProtectedError(J,m,d);const ie=J[0],re=parsers[ie];if(re){const{incompatibleTokens:se}=re;if(Array.isArray(se)){const ne=H.find(ce=>se.includes(ce.token)||ce.token===ie);if(ne)throw new RangeError(`The format string mustn't contain \`${ne.fullToken}\` and \`${J}\` at the same time`)}else if(re.incompatibleTokens==="*"&&H.length>0)throw new RangeError(`The format string mustn't contain \`${J}\` and any other token at the same time`);H.push({token:ie,fullToken:J});const X=re.run(d,J,D.match,q);if(!X)return $();j.push(X.setter),d=X.rest}else{if(ie.match(unescapedLatinCharacterRegExp))throw new RangeError("Format string contains an unescaped latin alphabet character `"+ie+"`");if(J==="''"?J="'":ie==="'"&&(J=cleanEscapedString(J)),d.indexOf(J)===0)d=d.slice(J.length);else return $()}}if(d.length>0&&notWhitespaceRegExp.test(d))return $();const V=j.map(J=>J.priority).sort((J,ie)=>ie-J).filter((J,ie,re)=>re.indexOf(J)===ie).map(J=>j.filter(ie=>ie.priority===J).sort((ie,re)=>re.subPriority-ie.subPriority)).map(J=>J[0]);let Z=toDate(g,w?.in);if(isNaN(+Z))return $();const Q={};for(const J of V){if(!J.validate(Z,q))return $();const ie=J.set(Z,Q,q);Array.isArray(ie)?(Z=ie[0],Object.assign(Q,ie[1])):Z=ie}return Z}function cleanEscapedString(d){return d.match(escapedStringRegExp)[1].replace(doubleQuoteRegExp,"'")}function minutesToMilliseconds(d){return Math.trunc(d*millisecondsInMinute)}function parseISOSafe(d){return tryParse(d,"yyyy-MM-dd","yyyy-MM-dd'T'HH:mm:ss","yyyy-MM-dd'T'HH:mm:ssXXX")}function tryParse(d,...m){for(const g of m)try{const w=parse$2(d,g,new Date);if(isValid$1(w))return w}catch{continue}}const EXIF_REGULAR_FIELDS={InteropIndex:1,InteropVersion:2,ProcessingSoftware:11,SubfileType:254,OldSubfileType:255,ImageWidth:256,ImageHeight:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Thresholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,MinSampleValue:280,MaxSampleValue:281,XResolution:282,YResolution:283,PlanarConfiguration:284,PageName:285,XPosition:286,YPosition:287,FreeOffsets:288,FreeByteCounts:289,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,PageNumber:297,ColorResponseUnit:300,TransferFunction:301,Software:305,ModifyDate:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,BadFaxLines:326,CleanFaxData:327,ConsecutiveBadFaxLines:328,SubIFD:330,InkSet:332,InkNames:333,NumberofInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,GlobalParametersIFD:400,ProfileType:401,FaxProfile:402,CodingMethods:403,VersionYear:404,ModeNumber:405,Decode:433,DefaultImageColor:434,T82Options:435,JPEGProc:512,ThumbnailOffset:513,ThumbnailLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,StripRowCounts:559,ApplicationNotes:700,USPTOMiscellaneous:999,RelatedImageFileFormat:4096,RelatedImageWidth:4097,RelatedImageHeight:4098,Rating:18246,XP_DIP_XML:18247,StitchInfo:18248,RatingPercent:18249,ImageID:32781,WangTag1:32931,WangAnnotation:32932,WangTag3:32933,WangTag4:32934,Matteing:32995,DataType:32996,ImageDepth:32997,TileDepth:32998,Model2:33405,CFARepeatPatternDim:33421,CFAPattern2:33422,BatteryLevel:33423,KodakIFD:33424,Copyright:33432,ExposureTime:33434,FNumber:33437,MDFileTag:33445,MDScalePixel:33446,MDColorTable:33447,MDLabName:33448,MDSampleInfo:33449,MDPrepDate:33450,MDPrepTime:33451,MDFileUnits:33452,PixelScale:33550,AdventScale:33589,AdventRevision:33590,UIC1Tag:33628,UIC2Tag:33629,UIC3Tag:33630,UIC4Tag:33631,"IPTC-NAA":33723,IntergraphPacketData:33918,IntergraphFlagRegisters:33919,IntergraphMatrix:33920,INGRReserved:33921,ModelTiePoint:33922,Site:34016,ColorSequence:34017,IT8Header:34018,RasterPadding:34019,BitsPerRunLength:34020,BitsPerExtendedRunLength:34021,ColorTable:34022,ImageColorIndicator:34023,BackgroundColorIndicator:34024,ImageColorValue:34025,BackgroundColorValue:34026,PixelIntensityRange:34027,TransparencyIndicator:34028,ColorCharacterization:34029,HCUsage:34030,TrapIndicator:34031,CMYKEquivalent:34032,SEMInfo:34118,AFCP_IPTC:34152,PixelMagicJBIGOptions:34232,ModelTransform:34264,WB_GRGBLevels:34306,LeafData:34310,PhotoshopSettings:34377,ExifOffset:34665,ICC_Profile:34675,TIFF_FXExtensions:34687,MultiProfiles:34688,SharedData:34689,T88Options:34690,ImageLayer:34732,GeoTiffDirectory:34735,GeoTiffDoubleParams:34736,GeoTiffAsciiParams:34737,ExposureProgram:34850,SpectralSensitivity:34852,GPSInfo:34853,ISO:34855,"Opto-ElectricConvFactor":34856,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,FaxRecvParams:34908,FaxSubAddress:34909,FaxRecvTime:34910,LeafSubIFD:34954,ExifVersion:36864,DateTimeOriginal:36867,CreateDate:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureCompensation:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,SubjectArea:37396,ExposureIndex:37397,"TIFF-EPStandardID":37398,SensingMethod:37399,CIP3DataFile:37434,CIP3Sheet:37435,CIP3Side:37436,StoNits:37439,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,MSDocumentText:37679,MSPropertySetStorage:37680,MSDocumentTextPosition:37681,ImageSourceData:37724,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,FlashpixVersion:40960,ColorSpace:40961,ExifImageWidth:40962,ExifImageHeight:40963,RelatedSoundFile:40964,InteropOffset:40965,SubjectLocation:41492,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFormat:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,OwnerName:42032,SerialNumber:42033,LensInfo:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,GDALMetadata:42112,GDALNoData:42113,Gamma:42240,ExpandSoftware:44992,ExpandLens:44993,ExpandFilm:44994,ExpandFilterLens:44995,ExpandScanner:44996,ExpandFlashLamp:44997,PixelFormat:48129,Transformation:48130,Uncompressed:48131,ImageType:48132,WidthResolution:48258,HeightResolution:48259,ImageOffset:48320,ImageByteCount:48321,AlphaOffset:48322,AlphaByteCount:48323,ImageDataDiscard:48324,AlphaDataDiscard:48325,OceScanjobDesc:50215,OceApplicationSelector:50216,OceIDNumber:50217,OceImageLogic:50218,Annotations:50255,PrintIM:50341,USPTOOriginalContentType:50560,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,DNGLensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,RawImageSegmentation:50752,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,AliasLayerMetadata:50784,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,PanasonicTitle:50898,PanasonicTitle2:50899,CameraCalibrationSig:50931,ProfileCalibrationSig:50932,ProfileIFD:50933,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041,TimeCodes:51043,FrameRate:51044,TStop:51058,ReelName:51081,OriginalDefaultFinalSize:51089,OriginalBestQualitySize:51090,OriginalDefaultCropSize:51091,CameraLabel:51105,ProfileHueSatMapEncoding:51107,ProfileLookTableEncoding:51108,BaselineExposureOffset:51109,DefaultBlackRender:51110,NewRawImageDigest:51111,RawToPreviewGain:51112,DefaultUserCrop:51125,Padding:59932,OffsetSchema:59933,Lens:65002,KDC_IFD:65024,RawFile:65100,Converter:65101,Exposure:65105,Shadows:65106,Brightness:65107,Smoothness:65111,MoireFilter:65112},EXIF_GPS_FIELDS={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},EXIF_FIELDS={...EXIF_REGULAR_FIELDS,...EXIF_GPS_FIELDS};function metadataOptionId(d,m){return`${d}:${m}`}function parseMetadataOptionId(d){const m=d.split(":");if(m.length<2)throw new Error(`Invalid metadata option ID: ${d}`);const g=m.slice(0,-1).join(":"),w=m[m.length-1];return{metadataId:g,key:w}}const METADATA_TYPES={string:{help:"du texte"},boolean:{help:"vrai ou faux"},integer:{help:"un entier"},float:{help:"un nombre, potentiellement Ã  virgule"},enum:{help:"un ensemble de valeur fixes"},date:{help:"une date"},location:{help:"un objet avec deux nombres, `latitude` et `longitude`"},boundingbox:{help:"un objet reprÃ©sentant une rÃ©gion rectangulaire au format YOLO"}},MetadataType=type.or(type("'string'","@",METADATA_TYPES.string.help),type("'boolean'","@",METADATA_TYPES.boolean.help),type("'integer'","@",METADATA_TYPES.integer.help),type("'float'","@",METADATA_TYPES.float.help),type("'enum'","@",METADATA_TYPES.enum.help),type("'date'","@",METADATA_TYPES.date.help),type("'location'","@",METADATA_TYPES.location.help),type("'boundingbox'","@",METADATA_TYPES.boundingbox.help)),MetadataRuntimeValue={string:type("string"),boolean:type("boolean"),integer:type("number"),float:type("number"),enum:type("string"),date:type("Date"),location:type({latitude:"number",longitude:"number"}),boundingbox:type({x:"number",y:"number",w:"number",h:"number"})},MetadataRuntimeValueAny=type.or(MetadataRuntimeValue.string,MetadataRuntimeValue.boolean,MetadataRuntimeValue.integer,MetadataRuntimeValue.float,MetadataRuntimeValue.enum,MetadataRuntimeValue.date,MetadataRuntimeValue.location,MetadataRuntimeValue.boundingbox),MetadataValue=type({value:type("string.json").pipe(d=>{let m=JSON.parse(d);return typeof m=="string"&&(m=parseISOSafe(m)??m),m},MetadataRuntimeValueAny),confidence:Probability.default(1),manuallyModified:type("boolean").describe("Si la valeur a Ã©tÃ© modifiÃ©e manuellement").default(!1),alternatives:{"[string.json]":Probability}}),MetadataValues=scope({ID}).type({"[ID]":MetadataValue}),METADATA_MERGE_METHODS={min:{help:"Choisir la valeur avec la meilleure confiance, et prendre la plus petite valeur en cas d'ambuiguitÃ©"},max:{help:"Choisir la valeur avec la meilleure confiance, et prendre la plus grande valeur en cas d'ambuiguitÃ©"},average:{help:"Prend la moyenne des valeurs"},median:{help:"Prend la mÃ©diane des valeurs"},union:{help:"SpÃ©cifique aux boÃ®tes de recadrage: fusionne les boÃ®tes de recadrage en la plus petite boÃ®te englobant toutes les boÃ®tes"},none:{help:"Ne pas fusionner"}},MetadataMergeMethod=type.or(type('"min"',"@",METADATA_MERGE_METHODS.min.help),type('"max"',"@",METADATA_MERGE_METHODS.max.help),type('"average"',"@",METADATA_MERGE_METHODS.average.help),type('"median"',"@",METADATA_MERGE_METHODS.median.help),type('"none"',"@",METADATA_MERGE_METHODS.none.help),type('"union"',"@",METADATA_MERGE_METHODS.union.help)),MetadataEnumVariant=type({key:[ID,"@","Identifiant unique pour cette option"],label:["string","@","Nom de l'option, affichable dans une interface utilisateur"],description:["string","@","Description (optionnelle) de cette option"],"image?":URLString,"learnMore?":URLString.describe("Lien pour en savoir plus sur cette option de l'Ã©numÃ©ration en particulier"),"cascade?":scope({ID}).type({"[ID]":"ID"}).describe('Objet contenant pour clÃ©s des identifiants d\'autres mÃ©tadonnÃ©es, et pour valeurs la valeur Ã  assigner Ã  cette mÃ©tadonnÃ©e si cette option est choisie. Le processus est rÃ©cursif: Imaginons une mÃ©tadonnÃ©e species ayant une option avec `{ key: "1", cascade: { genus: "2" } }`, une mÃ©tadonnÃ©e genus ayant une option `{ key: "2", cascade: { family: "3" } }`. Si l\'option "1" de la mÃ©tadonnÃ©e species est choisie, la mÃ©tadonnÃ©e genus sera dÃ©finie sur l\'option "2" et la mÃ©tadonnÃ©e family sera Ã  son tour dÃ©finie sur l\'option "3".')}),EXIFField=type.enumerated(...keys(EXIF_FIELDS)),MetadataInferOptionsNeural=type({neural:type({model:HTTPRequest.describe("Lien vers le modÃ¨le de classification utilisÃ© pour infÃ©rer les mÃ©tadonnÃ©es. Au format ONNX (.onnx) seulement, pour le moment."),classmapping:HTTPRequest.describe("Fichier texte contenant une clÃ© de la mÃ©tadonnÃ©e par ligne, dans le mÃªme ordre que les neurones de sortie du modÃ¨le."),"name?":["string","@","Nom du rÃ©seau Ã  afficher dans l'interface. ParticuliÃ¨rement utile si il y a plusieurs rÃ©seaux"],input:ModelInput.describe("Configuration de l'entrÃ©e des modÃ¨les"),"output?":type({"name?":["string","@","Nom de l'output du modÃ¨le Ã  utiliser. output0 par dÃ©faut"]})}).array()}).describe("InfÃ©rer depuis un modÃ¨le de rÃ©seau de neurones","self"),MetadataInferOptionsEXIF=type({exif:EXIFField}).describe("InfÃ©rer depuis un champ EXIF","self"),MetadataInferOptions=type.or(MetadataInferOptionsEXIF,MetadataInferOptionsNeural).describe("Comment infÃ©rer la valeur de cette mÃ©tadonnÃ©e","self"),Metadata$1=type({id:ID.describe("Identifiant unique pour la mÃ©tadonnÃ©e. On conseille de mettre une partie qui vous identifie dans cet identifiant, car il doit Ãªtre globalement unique. Par exemple, mon-organisation.ma-mÃ©tadonnÃ©e"),label:["string","@","Nom de la mÃ©tadonnÃ©e"],mergeMethod:MetadataMergeMethod.configure("MÃ©thode utiliser pour fusionner plusieurs diffÃ©rentes valeurs d'une mÃ©tadonnÃ©e. Notamment utilisÃ© pour calculer la valeur d'une mÃ©tadonnÃ©e sur une Observation Ã  partir de ses images","self"),required:["boolean","@","Si la mÃ©tadonnÃ©e est obligatoire"],description:["string","@","Description, pour aider Ã  comprendre la mÃ©tadonnÃ©e"],learnMore:URLString.describe("Un lien pour en apprendre plus sur ce que cette mÃ©tadonnÃ©e dÃ©crit").optional(),"options?":MetadataEnumVariant.array().pipe(d=>unique(d,m=>m.key)).describe('Les options valides. Uniquement utile pour une mÃ©tadonnÃ©e de type "enum"')}).and(type.or({type:"'location'","infer?":{latitude:MetadataInferOptions,longitude:MetadataInferOptions}},{type:MetadataType.exclude('"location"'),"infer?":MetadataInferOptions}));function namespacedMetadataId(d,m){return m=m.replace(/^.+__/,""),`${d}__${m}`}function ensureNamespacedMetadataId(d,m){return isNamespacedToProtocol(m,d)?d:namespacedMetadataId(m,d)}function isNamespacedToProtocol(d,m){return m.startsWith(`${d}__`)}function removeNamespaceFromMetadataId(d){return d.replace(/^.+__/,"")}function namespaceOfMetadataId(d){const m=d.split("__");if(!(m.length<2))return m.slice(0,-1).join("__")}const Image$2=type({id:/\d+(_\d+)*/,filename:"string",addedAt:"string.date.iso.parse",dimensions:Dimensions,metadata:MetadataValues,contentType:/\w+\/\w+/,fileId:ID.or("null").describe("ID vers l'objet ImageFile associÃ©"),boundingBoxesAnalyzed:"boolean = false",sha1:SHA1Hash.or("null").default(null)}),Observation$1=type({id:ID,label:"string",addedAt:"string.date.iso.parse",metadataOverrides:MetadataValues,images:References});function getDefaultExportFromCjs$1(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var handlebars={exports:{}},handlebars_runtime={exports:{}},base$1={},utils={},hasRequiredUtils;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1,utils.__esModule=!0,utils.extend=$,utils.indexOf=U,utils.escapeExpression=q,utils.isEmpty=j,utils.createFrame=G,utils.blockParams=H,utils.appendContextPath=V;var d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},m=/[&<>"'`=]/g,g=/[&<>"'`=]/;function w(Z){return d[Z]}function $(Z){for(var Q=1;Q<arguments.length;Q++)for(var J in arguments[Q])Object.prototype.hasOwnProperty.call(arguments[Q],J)&&(Z[J]=arguments[Q][J]);return Z}var I=Object.prototype.toString;utils.toString=I;var D=function(Q){return typeof Q=="function"};D(/x/)&&(utils.isFunction=D=function(Z){return typeof Z=="function"&&I.call(Z)==="[object Function]"}),utils.isFunction=D;var F=Array.isArray||function(Z){return Z&&typeof Z=="object"?I.call(Z)==="[object Array]":!1};utils.isArray=F;function U(Z,Q){for(var J=0,ie=Z.length;J<ie;J++)if(Z[J]===Q)return J;return-1}function q(Z){if(typeof Z!="string"){if(Z&&Z.toHTML)return Z.toHTML();if(Z==null)return"";if(!Z)return Z+"";Z=""+Z}return g.test(Z)?Z.replace(m,w):Z}function j(Z){return!Z&&Z!==0?!0:!!(F(Z)&&Z.length===0)}function G(Z){var Q=$({},Z);return Q._parent=Z,Q}function H(Z,Q){return Z.path=Q,Z}function V(Z,Q){return(Z?Z+".":"")+Q}return utils}var exception={exports:{}},hasRequiredException;function requireException(){return hasRequiredException||(hasRequiredException=1,(function(d,m){m.__esModule=!0;var g=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function w($,I){var D=I&&I.loc,F=void 0,U=void 0,q=void 0,j=void 0;D&&(F=D.start.line,U=D.end.line,q=D.start.column,j=D.end.column,$+=" - "+F+":"+q);for(var G=Error.prototype.constructor.call(this,$),H=0;H<g.length;H++)this[g[H]]=G[g[H]];Error.captureStackTrace&&Error.captureStackTrace(this,w);try{D&&(this.lineNumber=F,this.endLineNumber=U,Object.defineProperty?(Object.defineProperty(this,"column",{value:q,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:j,enumerable:!0})):(this.column=q,this.endColumn=j))}catch{}}w.prototype=new Error,m.default=w,d.exports=m.default})(exception,exception.exports)),exception.exports}var helpers$1={},blockHelperMissing={exports:{}},hasRequiredBlockHelperMissing;function requireBlockHelperMissing(){return hasRequiredBlockHelperMissing||(hasRequiredBlockHelperMissing=1,(function(d,m){m.__esModule=!0;var g=requireUtils();m.default=function(w){w.registerHelper("blockHelperMissing",function($,I){var D=I.inverse,F=I.fn;if($===!0)return F(this);if($===!1||$==null)return D(this);if(g.isArray($))return $.length>0?(I.ids&&(I.ids=[I.name]),w.helpers.each($,I)):D(this);if(I.data&&I.ids){var U=g.createFrame(I.data);U.contextPath=g.appendContextPath(I.data.contextPath,I.name),I={data:U}}return F($,I)})},d.exports=m.default})(blockHelperMissing,blockHelperMissing.exports)),blockHelperMissing.exports}var each={exports:{}},hasRequiredEach;function requireEach(){return hasRequiredEach||(hasRequiredEach=1,(function(d,m){m.__esModule=!0;function g(D){return D&&D.__esModule?D:{default:D}}var w=requireUtils(),$=requireException(),I=g($);m.default=function(D){D.registerHelper("each",function(F,U){if(!U)throw new I.default("Must pass iterator to #each");var q=U.fn,j=U.inverse,G=0,H="",V=void 0,Z=void 0;U.data&&U.ids&&(Z=w.appendContextPath(U.data.contextPath,U.ids[0])+"."),w.isFunction(F)&&(F=F.call(this)),U.data&&(V=w.createFrame(U.data));function Q(X,ne,ce){V&&(V.key=X,V.index=ne,V.first=ne===0,V.last=!!ce,Z&&(V.contextPath=Z+X)),H=H+q(F[X],{data:V,blockParams:w.blockParams([F[X],X],[Z+X,null])})}if(F&&typeof F=="object")if(w.isArray(F))for(var J=F.length;G<J;G++)G in F&&Q(G,G,G===F.length-1);else if(typeof Symbol=="function"&&F[Symbol.iterator]){for(var ie=[],re=F[Symbol.iterator](),se=re.next();!se.done;se=re.next())ie.push(se.value);F=ie;for(var J=F.length;G<J;G++)Q(G,G,G===F.length-1)}else(function(){var X=void 0;Object.keys(F).forEach(function(ne){X!==void 0&&Q(X,G-1),X=ne,G++}),X!==void 0&&Q(X,G-1,!0)})();return G===0&&(H=j(this)),H})},d.exports=m.default})(each,each.exports)),each.exports}var helperMissing={exports:{}},hasRequiredHelperMissing;function requireHelperMissing(){return hasRequiredHelperMissing||(hasRequiredHelperMissing=1,(function(d,m){m.__esModule=!0;function g(I){return I&&I.__esModule?I:{default:I}}var w=requireException(),$=g(w);m.default=function(I){I.registerHelper("helperMissing",function(){if(arguments.length!==1)throw new $.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},d.exports=m.default})(helperMissing,helperMissing.exports)),helperMissing.exports}var _if={exports:{}},hasRequired_if;function require_if(){return hasRequired_if||(hasRequired_if=1,(function(d,m){m.__esModule=!0;function g(D){return D&&D.__esModule?D:{default:D}}var w=requireUtils(),$=requireException(),I=g($);m.default=function(D){D.registerHelper("if",function(F,U){if(arguments.length!=2)throw new I.default("#if requires exactly one argument");return w.isFunction(F)&&(F=F.call(this)),!U.hash.includeZero&&!F||w.isEmpty(F)?U.inverse(this):U.fn(this)}),D.registerHelper("unless",function(F,U){if(arguments.length!=2)throw new I.default("#unless requires exactly one argument");return D.helpers.if.call(this,F,{fn:U.inverse,inverse:U.fn,hash:U.hash})})},d.exports=m.default})(_if,_if.exports)),_if.exports}var log={exports:{}},hasRequiredLog;function requireLog(){return hasRequiredLog||(hasRequiredLog=1,(function(d,m){m.__esModule=!0,m.default=function(g){g.registerHelper("log",function(){for(var w=[void 0],$=arguments[arguments.length-1],I=0;I<arguments.length-1;I++)w.push(arguments[I]);var D=1;$.hash.level!=null?D=$.hash.level:$.data&&$.data.level!=null&&(D=$.data.level),w[0]=D,g.log.apply(g,w)})},d.exports=m.default})(log,log.exports)),log.exports}var lookup$1={exports:{}},hasRequiredLookup;function requireLookup(){return hasRequiredLookup||(hasRequiredLookup=1,(function(d,m){m.__esModule=!0,m.default=function(g){g.registerHelper("lookup",function(w,$,I){return w&&I.lookupProperty(w,$)})},d.exports=m.default})(lookup$1,lookup$1.exports)),lookup$1.exports}var _with={exports:{}},hasRequired_with;function require_with(){return hasRequired_with||(hasRequired_with=1,(function(d,m){m.__esModule=!0;function g(D){return D&&D.__esModule?D:{default:D}}var w=requireUtils(),$=requireException(),I=g($);m.default=function(D){D.registerHelper("with",function(F,U){if(arguments.length!=2)throw new I.default("#with requires exactly one argument");w.isFunction(F)&&(F=F.call(this));var q=U.fn;if(w.isEmpty(F))return U.inverse(this);var j=U.data;return U.data&&U.ids&&(j=w.createFrame(U.data),j.contextPath=w.appendContextPath(U.data.contextPath,U.ids[0])),q(F,{data:j,blockParams:w.blockParams([F],[j&&j.contextPath])})})},d.exports=m.default})(_with,_with.exports)),_with.exports}var hasRequiredHelpers$1;function requireHelpers$1(){if(hasRequiredHelpers$1)return helpers$1;hasRequiredHelpers$1=1,helpers$1.__esModule=!0,helpers$1.registerDefaultHelpers=Q,helpers$1.moveHelperToHooks=J;function d(ie){return ie&&ie.__esModule?ie:{default:ie}}var m=requireBlockHelperMissing(),g=d(m),w=requireEach(),$=d(w),I=requireHelperMissing(),D=d(I),F=require_if(),U=d(F),q=requireLog(),j=d(q),G=requireLookup(),H=d(G),V=require_with(),Z=d(V);function Q(ie){g.default(ie),$.default(ie),D.default(ie),U.default(ie),j.default(ie),H.default(ie),Z.default(ie)}function J(ie,re,se){ie.helpers[re]&&(ie.hooks[re]=ie.helpers[re],se||delete ie.helpers[re])}return helpers$1}var decorators={},inline={exports:{}},hasRequiredInline;function requireInline(){return hasRequiredInline||(hasRequiredInline=1,(function(d,m){m.__esModule=!0;var g=requireUtils();m.default=function(w){w.registerDecorator("inline",function($,I,D,F){var U=$;return I.partials||(I.partials={},U=function(q,j){var G=D.partials;D.partials=g.extend({},G,I.partials);var H=$(q,j);return D.partials=G,H}),I.partials[F.args[0]]=F.fn,U})},d.exports=m.default})(inline,inline.exports)),inline.exports}var hasRequiredDecorators;function requireDecorators(){if(hasRequiredDecorators)return decorators;hasRequiredDecorators=1,decorators.__esModule=!0,decorators.registerDefaultDecorators=w;function d($){return $&&$.__esModule?$:{default:$}}var m=requireInline(),g=d(m);function w($){g.default($)}return decorators}var logger={exports:{}},hasRequiredLogger;function requireLogger(){return hasRequiredLogger||(hasRequiredLogger=1,(function(d,m){m.__esModule=!0;var g=requireUtils(),w={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(I){if(typeof I=="string"){var D=g.indexOf(w.methodMap,I.toLowerCase());D>=0?I=D:I=parseInt(I,10)}return I},log:function(I){if(I=w.lookupLevel(I),typeof console<"u"&&w.lookupLevel(w.level)<=I){var D=w.methodMap[I];console[D]||(D="log");for(var F=arguments.length,U=Array(F>1?F-1:0),q=1;q<F;q++)U[q-1]=arguments[q];console[D].apply(console,U)}}};m.default=w,d.exports=m.default})(logger,logger.exports)),logger.exports}var protoAccess={},createNewLookupObject={},hasRequiredCreateNewLookupObject;function requireCreateNewLookupObject(){if(hasRequiredCreateNewLookupObject)return createNewLookupObject;hasRequiredCreateNewLookupObject=1,createNewLookupObject.__esModule=!0,createNewLookupObject.createNewLookupObject=m;var d=requireUtils();function m(){for(var g=arguments.length,w=Array(g),$=0;$<g;$++)w[$]=arguments[$];return d.extend.apply(void 0,[Object.create(null)].concat(w))}return createNewLookupObject}var hasRequiredProtoAccess;function requireProtoAccess(){if(hasRequiredProtoAccess)return protoAccess;hasRequiredProtoAccess=1,protoAccess.__esModule=!0,protoAccess.createProtoAccessControl=I,protoAccess.resultIsAllowed=D,protoAccess.resetLoggedProperties=q;function d(j){return j&&j.__esModule?j:{default:j}}var m=requireCreateNewLookupObject(),g=requireLogger(),w=d(g),$=Object.create(null);function I(j){var G=Object.create(null);G.constructor=!1,G.__defineGetter__=!1,G.__defineSetter__=!1,G.__lookupGetter__=!1;var H=Object.create(null);return H.__proto__=!1,{properties:{whitelist:m.createNewLookupObject(H,j.allowedProtoProperties),defaultValue:j.allowProtoPropertiesByDefault},methods:{whitelist:m.createNewLookupObject(G,j.allowedProtoMethods),defaultValue:j.allowProtoMethodsByDefault}}}function D(j,G,H){return F(typeof j=="function"?G.methods:G.properties,H)}function F(j,G){return j.whitelist[G]!==void 0?j.whitelist[G]===!0:j.defaultValue!==void 0?j.defaultValue:(U(G),!1)}function U(j){$[j]!==!0&&($[j]=!0,w.default.log("error",'Handlebars: Access has been denied to resolve the property "'+j+`" because it is not an "own property" of its parent.
You can add a runtime option to disable the check or this warning:
See https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details`))}function q(){Object.keys($).forEach(function(j){delete $[j]})}return protoAccess}var hasRequiredBase$1;function requireBase$1(){if(hasRequiredBase$1)return base$1;hasRequiredBase$1=1,base$1.__esModule=!0,base$1.HandlebarsEnvironment=Z;function d(J){return J&&J.__esModule?J:{default:J}}var m=requireUtils(),g=requireException(),w=d(g),$=requireHelpers$1(),I=requireDecorators(),D=requireLogger(),F=d(D),U=requireProtoAccess(),q="4.7.8";base$1.VERSION=q;var j=8;base$1.COMPILER_REVISION=j;var G=7;base$1.LAST_COMPATIBLE_COMPILER_REVISION=G;var H={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};base$1.REVISION_CHANGES=H;var V="[object Object]";function Z(J,ie,re){this.helpers=J||{},this.partials=ie||{},this.decorators=re||{},$.registerDefaultHelpers(this),I.registerDefaultDecorators(this)}Z.prototype={constructor:Z,logger:F.default,log:F.default.log,registerHelper:function(ie,re){if(m.toString.call(ie)===V){if(re)throw new w.default("Arg not supported with multiple helpers");m.extend(this.helpers,ie)}else this.helpers[ie]=re},unregisterHelper:function(ie){delete this.helpers[ie]},registerPartial:function(ie,re){if(m.toString.call(ie)===V)m.extend(this.partials,ie);else{if(typeof re>"u")throw new w.default('Attempting to register a partial called "'+ie+'" as undefined');this.partials[ie]=re}},unregisterPartial:function(ie){delete this.partials[ie]},registerDecorator:function(ie,re){if(m.toString.call(ie)===V){if(re)throw new w.default("Arg not supported with multiple decorators");m.extend(this.decorators,ie)}else this.decorators[ie]=re},unregisterDecorator:function(ie){delete this.decorators[ie]},resetLoggedPropertyAccesses:function(){U.resetLoggedProperties()}};var Q=F.default.log;return base$1.log=Q,base$1.createFrame=m.createFrame,base$1.logger=F.default,base$1}var safeString={exports:{}},hasRequiredSafeString;function requireSafeString(){return hasRequiredSafeString||(hasRequiredSafeString=1,(function(d,m){m.__esModule=!0;function g(w){this.string=w}g.prototype.toString=g.prototype.toHTML=function(){return""+this.string},m.default=g,d.exports=m.default})(safeString,safeString.exports)),safeString.exports}var runtime={},wrapHelper={},hasRequiredWrapHelper;function requireWrapHelper(){if(hasRequiredWrapHelper)return wrapHelper;hasRequiredWrapHelper=1,wrapHelper.__esModule=!0,wrapHelper.wrapHelper=d;function d(m,g){if(typeof m!="function")return m;var w=function(){var I=arguments[arguments.length-1];return arguments[arguments.length-1]=g(I),m.apply(this,arguments)};return w}return wrapHelper}var hasRequiredRuntime;function requireRuntime(){if(hasRequiredRuntime)return runtime;hasRequiredRuntime=1,runtime.__esModule=!0,runtime.checkRevision=j,runtime.template=G,runtime.wrapProgram=H,runtime.resolvePartial=V,runtime.invokePartial=Z,runtime.noop=Q;function d(X){return X&&X.__esModule?X:{default:X}}function m(X){if(X&&X.__esModule)return X;var ne={};if(X!=null)for(var ce in X)Object.prototype.hasOwnProperty.call(X,ce)&&(ne[ce]=X[ce]);return ne.default=X,ne}var g=requireUtils(),w=m(g),$=requireException(),I=d($),D=requireBase$1(),F=requireHelpers$1(),U=requireWrapHelper(),q=requireProtoAccess();function j(X){var ne=X&&X[0]||1,ce=D.COMPILER_REVISION;if(!(ne>=D.LAST_COMPATIBLE_COMPILER_REVISION&&ne<=D.COMPILER_REVISION))if(ne<D.LAST_COMPATIBLE_COMPILER_REVISION){var oe=D.REVISION_CHANGES[ce],de=D.REVISION_CHANGES[ne];throw new I.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+oe+") or downgrade your runtime to an older version ("+de+").")}else throw new I.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+X[1]+").")}function G(X,ne){if(!ne)throw new I.default("No environment passed to template");if(!X||!X.main)throw new I.default("Unknown template object: "+typeof X);X.main.decorator=X.main_d,ne.VM.checkRevision(X.compiler);var ce=X.compiler&&X.compiler[0]===7;function oe(ge,fe,xe){xe.hash&&(fe=w.extend({},fe,xe.hash),xe.ids&&(xe.ids[0]=!0)),ge=ne.VM.resolvePartial.call(this,ge,fe,xe);var Fe=w.extend({},xe,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),Te=ne.VM.invokePartial.call(this,ge,fe,Fe);if(Te==null&&ne.compile&&(xe.partials[xe.name]=ne.compile(ge,X.compilerOptions,ne),Te=xe.partials[xe.name](fe,Fe)),Te!=null){if(xe.indent){for(var Oe=Te.split(`
`),Be=0,_t=Oe.length;Be<_t&&!(!Oe[Be]&&Be+1===_t);Be++)Oe[Be]=xe.indent+Oe[Be];Te=Oe.join(`
`)}return Te}else throw new I.default("The partial "+xe.name+" could not be compiled when running in runtime-only mode")}var de={strict:function(fe,xe,Fe){if(!fe||!(xe in fe))throw new I.default('"'+xe+'" not defined in '+fe,{loc:Fe});return de.lookupProperty(fe,xe)},lookupProperty:function(fe,xe){var Fe=fe[xe];if(Fe==null||Object.prototype.hasOwnProperty.call(fe,xe)||q.resultIsAllowed(Fe,de.protoAccessControl,xe))return Fe},lookup:function(fe,xe){for(var Fe=fe.length,Te=0;Te<Fe;Te++){var Oe=fe[Te]&&de.lookupProperty(fe[Te],xe);if(Oe!=null)return fe[Te][xe]}},lambda:function(fe,xe){return typeof fe=="function"?fe.call(xe):fe},escapeExpression:w.escapeExpression,invokePartial:oe,fn:function(fe){var xe=X[fe];return xe.decorator=X[fe+"_d"],xe},programs:[],program:function(fe,xe,Fe,Te,Oe){var Be=this.programs[fe],_t=this.fn(fe);return xe||Oe||Te||Fe?Be=H(this,fe,_t,xe,Fe,Te,Oe):Be||(Be=this.programs[fe]=H(this,fe,_t)),Be},data:function(fe,xe){for(;fe&&xe--;)fe=fe._parent;return fe},mergeIfNeeded:function(fe,xe){var Fe=fe||xe;return fe&&xe&&fe!==xe&&(Fe=w.extend({},xe,fe)),Fe},nullContext:Object.seal({}),noop:ne.VM.noop,compilerInfo:X.compiler};function me(ge){var fe=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],xe=fe.data;me._setup(fe),!fe.partial&&X.useData&&(xe=J(ge,xe));var Fe=void 0,Te=X.useBlockParams?[]:void 0;X.useDepths&&(fe.depths?Fe=ge!=fe.depths[0]?[ge].concat(fe.depths):fe.depths:Fe=[ge]);function Oe(Be){return""+X.main(de,Be,de.helpers,de.partials,xe,Te,Fe)}return Oe=ie(X.main,Oe,de,fe.depths||[],xe,Te),Oe(ge,fe)}return me.isTop=!0,me._setup=function(ge){if(ge.partial)de.protoAccessControl=ge.protoAccessControl,de.helpers=ge.helpers,de.partials=ge.partials,de.decorators=ge.decorators,de.hooks=ge.hooks;else{var fe=w.extend({},ne.helpers,ge.helpers);re(fe,de),de.helpers=fe,X.usePartial&&(de.partials=de.mergeIfNeeded(ge.partials,ne.partials)),(X.usePartial||X.useDecorators)&&(de.decorators=w.extend({},ne.decorators,ge.decorators)),de.hooks={},de.protoAccessControl=q.createProtoAccessControl(ge);var xe=ge.allowCallsToHelperMissing||ce;F.moveHelperToHooks(de,"helperMissing",xe),F.moveHelperToHooks(de,"blockHelperMissing",xe)}},me._child=function(ge,fe,xe,Fe){if(X.useBlockParams&&!xe)throw new I.default("must pass block params");if(X.useDepths&&!Fe)throw new I.default("must pass parent depths");return H(de,ge,X[ge],fe,0,xe,Fe)},me}function H(X,ne,ce,oe,de,me,ge){function fe(xe){var Fe=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],Te=ge;return ge&&xe!=ge[0]&&!(xe===X.nullContext&&ge[0]===null)&&(Te=[xe].concat(ge)),ce(X,xe,X.helpers,X.partials,Fe.data||oe,me&&[Fe.blockParams].concat(me),Te)}return fe=ie(ce,fe,X,ge,oe,me),fe.program=ne,fe.depth=ge?ge.length:0,fe.blockParams=de||0,fe}function V(X,ne,ce){return X?!X.call&&!ce.name&&(ce.name=X,X=ce.partials[X]):ce.name==="@partial-block"?X=ce.data["partial-block"]:X=ce.partials[ce.name],X}function Z(X,ne,ce){var oe=ce.data&&ce.data["partial-block"];ce.partial=!0,ce.ids&&(ce.data.contextPath=ce.ids[0]||ce.data.contextPath);var de=void 0;if(ce.fn&&ce.fn!==Q&&(function(){ce.data=D.createFrame(ce.data);var me=ce.fn;de=ce.data["partial-block"]=function(fe){var xe=arguments.length<=1||arguments[1]===void 0?{}:arguments[1];return xe.data=D.createFrame(xe.data),xe.data["partial-block"]=oe,me(fe,xe)},me.partials&&(ce.partials=w.extend({},ce.partials,me.partials))})(),X===void 0&&de&&(X=de),X===void 0)throw new I.default("The partial "+ce.name+" could not be found");if(X instanceof Function)return X(ne,ce)}function Q(){return""}function J(X,ne){return(!ne||!("root"in ne))&&(ne=ne?D.createFrame(ne):{},ne.root=X),ne}function ie(X,ne,ce,oe,de,me){if(X.decorator){var ge={};ne=X.decorator(ne,ge,ce,oe&&oe[0],de,me,oe),w.extend(ne,ge)}return ne}function re(X,ne){Object.keys(X).forEach(function(ce){var oe=X[ce];X[ce]=se(oe,ne)})}function se(X,ne){var ce=ne.lookupProperty;return U.wrapHelper(X,function(oe){return w.extend({lookupProperty:ce},oe)})}return runtime}var noConflict={exports:{}},hasRequiredNoConflict;function requireNoConflict(){return hasRequiredNoConflict||(hasRequiredNoConflict=1,(function(d,m){m.__esModule=!0,m.default=function(g){(function(){typeof globalThis!="object"&&(Object.prototype.__defineGetter__("__magic__",function(){return this}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__)})();var w=globalThis.Handlebars;g.noConflict=function(){return globalThis.Handlebars===g&&(globalThis.Handlebars=w),g}},d.exports=m.default})(noConflict,noConflict.exports)),noConflict.exports}var hasRequiredHandlebars_runtime;function requireHandlebars_runtime(){return hasRequiredHandlebars_runtime||(hasRequiredHandlebars_runtime=1,(function(d,m){m.__esModule=!0;function g(re){return re&&re.__esModule?re:{default:re}}function w(re){if(re&&re.__esModule)return re;var se={};if(re!=null)for(var X in re)Object.prototype.hasOwnProperty.call(re,X)&&(se[X]=re[X]);return se.default=re,se}var $=requireBase$1(),I=w($),D=requireSafeString(),F=g(D),U=requireException(),q=g(U),j=requireUtils(),G=w(j),H=requireRuntime(),V=w(H),Z=requireNoConflict(),Q=g(Z);function J(){var re=new I.HandlebarsEnvironment;return G.extend(re,I),re.SafeString=F.default,re.Exception=q.default,re.Utils=G,re.escapeExpression=G.escapeExpression,re.VM=V,re.template=function(se){return V.template(se,re)},re}var ie=J();ie.create=J,Q.default(ie),ie.default=ie,m.default=ie,d.exports=m.default})(handlebars_runtime,handlebars_runtime.exports)),handlebars_runtime.exports}var ast={exports:{}},hasRequiredAst;function requireAst(){return hasRequiredAst||(hasRequiredAst=1,(function(d,m){m.__esModule=!0;var g={helpers:{helperExpression:function($){return $.type==="SubExpression"||($.type==="MustacheStatement"||$.type==="BlockStatement")&&!!($.params&&$.params.length||$.hash)},scopedId:function($){return/^\.|this\b/.test($.original)},simpleId:function($){return $.parts.length===1&&!g.helpers.scopedId($)&&!$.depth}}};m.default=g,d.exports=m.default})(ast,ast.exports)),ast.exports}var base={},parser$2={exports:{}},hasRequiredParser$1;function requireParser$1(){return hasRequiredParser$1||(hasRequiredParser$1=1,(function(d,m){m.__esModule=!0;var g=(function(){var w={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(F,U,q,j,G,H,V){var Z=H.length-1;switch(G){case 1:return H[Z-1];case 2:this.$=j.prepareProgram(H[Z]);break;case 3:this.$=H[Z];break;case 4:this.$=H[Z];break;case 5:this.$=H[Z];break;case 6:this.$=H[Z];break;case 7:this.$=H[Z];break;case 8:this.$=H[Z];break;case 9:this.$={type:"CommentStatement",value:j.stripComment(H[Z]),strip:j.stripFlags(H[Z],H[Z]),loc:j.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:H[Z],value:H[Z],loc:j.locInfo(this._$)};break;case 11:this.$=j.prepareRawBlock(H[Z-2],H[Z-1],H[Z],this._$);break;case 12:this.$={path:H[Z-3],params:H[Z-2],hash:H[Z-1]};break;case 13:this.$=j.prepareBlock(H[Z-3],H[Z-2],H[Z-1],H[Z],!1,this._$);break;case 14:this.$=j.prepareBlock(H[Z-3],H[Z-2],H[Z-1],H[Z],!0,this._$);break;case 15:this.$={open:H[Z-5],path:H[Z-4],params:H[Z-3],hash:H[Z-2],blockParams:H[Z-1],strip:j.stripFlags(H[Z-5],H[Z])};break;case 16:this.$={path:H[Z-4],params:H[Z-3],hash:H[Z-2],blockParams:H[Z-1],strip:j.stripFlags(H[Z-5],H[Z])};break;case 17:this.$={path:H[Z-4],params:H[Z-3],hash:H[Z-2],blockParams:H[Z-1],strip:j.stripFlags(H[Z-5],H[Z])};break;case 18:this.$={strip:j.stripFlags(H[Z-1],H[Z-1]),program:H[Z]};break;case 19:var Q=j.prepareBlock(H[Z-2],H[Z-1],H[Z],H[Z],!1,this._$),J=j.prepareProgram([Q],H[Z-1].loc);J.chained=!0,this.$={strip:H[Z-2].strip,program:J,chain:!0};break;case 20:this.$=H[Z];break;case 21:this.$={path:H[Z-1],strip:j.stripFlags(H[Z-2],H[Z])};break;case 22:this.$=j.prepareMustache(H[Z-3],H[Z-2],H[Z-1],H[Z-4],j.stripFlags(H[Z-4],H[Z]),this._$);break;case 23:this.$=j.prepareMustache(H[Z-3],H[Z-2],H[Z-1],H[Z-4],j.stripFlags(H[Z-4],H[Z]),this._$);break;case 24:this.$={type:"PartialStatement",name:H[Z-3],params:H[Z-2],hash:H[Z-1],indent:"",strip:j.stripFlags(H[Z-4],H[Z]),loc:j.locInfo(this._$)};break;case 25:this.$=j.preparePartialBlock(H[Z-2],H[Z-1],H[Z],this._$);break;case 26:this.$={path:H[Z-3],params:H[Z-2],hash:H[Z-1],strip:j.stripFlags(H[Z-4],H[Z])};break;case 27:this.$=H[Z];break;case 28:this.$=H[Z];break;case 29:this.$={type:"SubExpression",path:H[Z-3],params:H[Z-2],hash:H[Z-1],loc:j.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:H[Z],loc:j.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:j.id(H[Z-2]),value:H[Z],loc:j.locInfo(this._$)};break;case 32:this.$=j.id(H[Z-1]);break;case 33:this.$=H[Z];break;case 34:this.$=H[Z];break;case 35:this.$={type:"StringLiteral",value:H[Z],original:H[Z],loc:j.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(H[Z]),original:Number(H[Z]),loc:j.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:H[Z]==="true",original:H[Z]==="true",loc:j.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:j.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:j.locInfo(this._$)};break;case 40:this.$=H[Z];break;case 41:this.$=H[Z];break;case 42:this.$=j.preparePath(!0,H[Z],this._$);break;case 43:this.$=j.preparePath(!1,H[Z],this._$);break;case 44:H[Z-2].push({part:j.id(H[Z]),original:H[Z],separator:H[Z-1]}),this.$=H[Z-2];break;case 45:this.$=[{part:j.id(H[Z]),original:H[Z]}];break;case 46:this.$=[];break;case 47:H[Z-1].push(H[Z]);break;case 48:this.$=[];break;case 49:H[Z-1].push(H[Z]);break;case 50:this.$=[];break;case 51:H[Z-1].push(H[Z]);break;case 58:this.$=[];break;case 59:H[Z-1].push(H[Z]);break;case 64:this.$=[];break;case 65:H[Z-1].push(H[Z]);break;case 70:this.$=[];break;case 71:H[Z-1].push(H[Z]);break;case 78:this.$=[];break;case 79:H[Z-1].push(H[Z]);break;case 82:this.$=[];break;case 83:H[Z-1].push(H[Z]);break;case 86:this.$=[];break;case 87:H[Z-1].push(H[Z]);break;case 90:this.$=[];break;case 91:H[Z-1].push(H[Z]);break;case 94:this.$=[];break;case 95:H[Z-1].push(H[Z]);break;case 98:this.$=[H[Z]];break;case 99:H[Z-1].push(H[Z]);break;case 100:this.$=[H[Z]];break;case 101:H[Z-1].push(H[Z]);break}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(F,U){throw new Error(F)},parse:function(F){var U=this,q=[0],j=[null],G=[],H=this.table,V="",Z=0,Q=0;this.lexer.setInput(F),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc>"u"&&(this.lexer.yylloc={});var J=this.lexer.yylloc;G.push(J);var ie=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);function re(){var Fe;return Fe=U.lexer.lex()||1,typeof Fe!="number"&&(Fe=U.symbols_[Fe]||Fe),Fe}for(var se,X,ne,ce,oe={},de,me,ge,fe;;){if(X=q[q.length-1],this.defaultActions[X]?ne=this.defaultActions[X]:((se===null||typeof se>"u")&&(se=re()),ne=H[X]&&H[X][se]),typeof ne>"u"||!ne.length||!ne[0]){var xe="";{fe=[];for(de in H[X])this.terminals_[de]&&de>2&&fe.push("'"+this.terminals_[de]+"'");this.lexer.showPosition?xe="Parse error on line "+(Z+1)+`:
`+this.lexer.showPosition()+`
Expecting `+fe.join(", ")+", got '"+(this.terminals_[se]||se)+"'":xe="Parse error on line "+(Z+1)+": Unexpected "+(se==1?"end of input":"'"+(this.terminals_[se]||se)+"'"),this.parseError(xe,{text:this.lexer.match,token:this.terminals_[se]||se,line:this.lexer.yylineno,loc:J,expected:fe})}}if(ne[0]instanceof Array&&ne.length>1)throw new Error("Parse Error: multiple actions possible at state: "+X+", token: "+se);switch(ne[0]){case 1:q.push(se),j.push(this.lexer.yytext),G.push(this.lexer.yylloc),q.push(ne[1]),se=null,Q=this.lexer.yyleng,V=this.lexer.yytext,Z=this.lexer.yylineno,J=this.lexer.yylloc;break;case 2:if(me=this.productions_[ne[1]][1],oe.$=j[j.length-me],oe._$={first_line:G[G.length-(me||1)].first_line,last_line:G[G.length-1].last_line,first_column:G[G.length-(me||1)].first_column,last_column:G[G.length-1].last_column},ie&&(oe._$.range=[G[G.length-(me||1)].range[0],G[G.length-1].range[1]]),ce=this.performAction.call(oe,V,Q,Z,this.yy,ne[1],j,G),typeof ce<"u")return ce;me&&(q=q.slice(0,-1*me*2),j=j.slice(0,-1*me),G=G.slice(0,-1*me)),q.push(this.productions_[ne[1]][0]),j.push(oe.$),G.push(oe._$),ge=H[q[q.length-2]][q[q.length-1]],q.push(ge);break;case 3:return!0}}return!0}},$=(function(){var D={EOF:1,parseError:function(U,q){if(this.yy.parser)this.yy.parser.parseError(U,q);else throw new Error(U)},setInput:function(U){return this._input=U,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var U=this._input[0];this.yytext+=U,this.yyleng++,this.offset++,this.match+=U,this.matched+=U;var q=U.match(/(?:\r\n?|\n).*/g);return q?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),U},unput:function(U){var q=U.length,j=U.split(/(?:\r\n?|\n)/g);this._input=U+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-q-1),this.offset-=q;var G=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),j.length-1&&(this.yylineno-=j.length-1);var H=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:j?(j.length===G.length?this.yylloc.first_column:0)+G[G.length-j.length].length-j[0].length:this.yylloc.first_column-q},this.options.ranges&&(this.yylloc.range=[H[0],H[0]+this.yyleng-q]),this},more:function(){return this._more=!0,this},less:function(U){this.unput(this.match.slice(U))},pastInput:function(){var U=this.matched.substr(0,this.matched.length-this.match.length);return(U.length>20?"...":"")+U.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var U=this.match;return U.length<20&&(U+=this._input.substr(0,20-U.length)),(U.substr(0,20)+(U.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var U=this.pastInput(),q=new Array(U.length+1).join("-");return U+this.upcomingInput()+`
`+q+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var U,q,j,G,H;this._more||(this.yytext="",this.match="");for(var V=this._currentRules(),Z=0;Z<V.length&&(j=this._input.match(this.rules[V[Z]]),!(j&&(!q||j[0].length>q[0].length)&&(q=j,G=Z,!this.options.flex)));Z++);return q?(H=q[0].match(/(?:\r\n?|\n).*/g),H&&(this.yylineno+=H.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:H?H[H.length-1].length-H[H.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+q[0].length},this.yytext+=q[0],this.match+=q[0],this.matches=q,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(q[0].length),this.matched+=q[0],U=this.performAction.call(this,this.yy,this,V[G],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),U||void 0):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var U=this.next();return typeof U<"u"?U:this.lex()},begin:function(U){this.conditionStack.push(U)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(U){this.begin(U)}};return D.options={},D.performAction=function(U,q,j,G){function H(V,Z){return q.yytext=q.yytext.substring(V,q.yyleng-Z+V)}switch(j){case 0:if(q.yytext.slice(-2)==="\\\\"?(H(0,1),this.begin("mu")):q.yytext.slice(-1)==="\\"?(H(0,1),this.begin("emu")):this.begin("mu"),q.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),this.conditionStack[this.conditionStack.length-1]==="raw"?15:(H(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(q.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return q.yytext=H(1,2).replace(/\\"/g,'"'),80;case 32:return q.yytext=H(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return q.yytext=q.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},D.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],D.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},D})();w.lexer=$;function I(){this.yy={}}return I.prototype=w,w.Parser=I,new I})();m.default=g,d.exports=m.default})(parser$2,parser$2.exports)),parser$2.exports}var whitespaceControl={exports:{}},visitor={exports:{}},hasRequiredVisitor;function requireVisitor(){return hasRequiredVisitor||(hasRequiredVisitor=1,(function(d,m){m.__esModule=!0;function g(q){return q&&q.__esModule?q:{default:q}}var w=requireException(),$=g(w);function I(){this.parents=[]}I.prototype={constructor:I,mutating:!1,acceptKey:function(j,G){var H=this.accept(j[G]);if(this.mutating){if(H&&!I.prototype[H.type])throw new $.default('Unexpected node type "'+H.type+'" found when accepting '+G+" on "+j.type);j[G]=H}},acceptRequired:function(j,G){if(this.acceptKey(j,G),!j[G])throw new $.default(j.type+" requires "+G)},acceptArray:function(j){for(var G=0,H=j.length;G<H;G++)this.acceptKey(j,G),j[G]||(j.splice(G,1),G--,H--)},accept:function(j){if(j){if(!this[j.type])throw new $.default("Unknown type: "+j.type,j);this.current&&this.parents.unshift(this.current),this.current=j;var G=this[j.type](j);if(this.current=this.parents.shift(),!this.mutating||G)return G;if(G!==!1)return j}},Program:function(j){this.acceptArray(j.body)},MustacheStatement:D,Decorator:D,BlockStatement:F,DecoratorBlock:F,PartialStatement:U,PartialBlockStatement:function(j){U.call(this,j),this.acceptKey(j,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:D,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(j){this.acceptArray(j.pairs)},HashPair:function(j){this.acceptRequired(j,"value")}};function D(q){this.acceptRequired(q,"path"),this.acceptArray(q.params),this.acceptKey(q,"hash")}function F(q){D.call(this,q),this.acceptKey(q,"program"),this.acceptKey(q,"inverse")}function U(q){this.acceptRequired(q,"name"),this.acceptArray(q.params),this.acceptKey(q,"hash")}m.default=I,d.exports=m.default})(visitor,visitor.exports)),visitor.exports}var hasRequiredWhitespaceControl;function requireWhitespaceControl(){return hasRequiredWhitespaceControl||(hasRequiredWhitespaceControl=1,(function(d,m){m.__esModule=!0;function g(j){return j&&j.__esModule?j:{default:j}}var w=requireVisitor(),$=g(w);function I(){var j=arguments.length<=0||arguments[0]===void 0?{}:arguments[0];this.options=j}I.prototype=new $.default,I.prototype.Program=function(j){var G=!this.options.ignoreStandalone,H=!this.isRootSeen;this.isRootSeen=!0;for(var V=j.body,Z=0,Q=V.length;Z<Q;Z++){var J=V[Z],ie=this.accept(J);if(ie){var re=D(V,Z,H),se=F(V,Z,H),X=ie.openStandalone&&re,ne=ie.closeStandalone&&se,ce=ie.inlineStandalone&&re&&se;ie.close&&U(V,Z,!0),ie.open&&q(V,Z,!0),G&&ce&&(U(V,Z),q(V,Z)&&J.type==="PartialStatement"&&(J.indent=/([ \t]+$)/.exec(V[Z-1].original)[1])),G&&X&&(U((J.program||J.inverse).body),q(V,Z)),G&&ne&&(U(V,Z),q((J.inverse||J.program).body))}}return j},I.prototype.BlockStatement=I.prototype.DecoratorBlock=I.prototype.PartialBlockStatement=function(j){this.accept(j.program),this.accept(j.inverse);var G=j.program||j.inverse,H=j.program&&j.inverse,V=H,Z=H;if(H&&H.chained)for(V=H.body[0].program;Z.chained;)Z=Z.body[Z.body.length-1].program;var Q={open:j.openStrip.open,close:j.closeStrip.close,openStandalone:F(G.body),closeStandalone:D((V||G).body)};if(j.openStrip.close&&U(G.body,null,!0),H){var J=j.inverseStrip;J.open&&q(G.body,null,!0),J.close&&U(V.body,null,!0),j.closeStrip.open&&q(Z.body,null,!0),!this.options.ignoreStandalone&&D(G.body)&&F(V.body)&&(q(G.body),U(V.body))}else j.closeStrip.open&&q(G.body,null,!0);return Q},I.prototype.Decorator=I.prototype.MustacheStatement=function(j){return j.strip},I.prototype.PartialStatement=I.prototype.CommentStatement=function(j){var G=j.strip||{};return{inlineStandalone:!0,open:G.open,close:G.close}};function D(j,G,H){G===void 0&&(G=j.length);var V=j[G-1],Z=j[G-2];if(!V)return H;if(V.type==="ContentStatement")return(Z||!H?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(V.original)}function F(j,G,H){G===void 0&&(G=-1);var V=j[G+1],Z=j[G+2];if(!V)return H;if(V.type==="ContentStatement")return(Z||!H?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(V.original)}function U(j,G,H){var V=j[G==null?0:G+1];if(!(!V||V.type!=="ContentStatement"||!H&&V.rightStripped)){var Z=V.value;V.value=V.value.replace(H?/^\s+/:/^[ \t]*\r?\n?/,""),V.rightStripped=V.value!==Z}}function q(j,G,H){var V=j[G==null?j.length-1:G-1];if(!(!V||V.type!=="ContentStatement"||!H&&V.leftStripped)){var Z=V.value;return V.value=V.value.replace(H?/\s+$/:/[ \t]+$/,""),V.leftStripped=V.value!==Z,V.leftStripped}}m.default=I,d.exports=m.default})(whitespaceControl,whitespaceControl.exports)),whitespaceControl.exports}var helpers={},hasRequiredHelpers;function requireHelpers(){if(hasRequiredHelpers)return helpers;hasRequiredHelpers=1,helpers.__esModule=!0,helpers.SourceLocation=$,helpers.id=I,helpers.stripFlags=D,helpers.stripComment=F,helpers.preparePath=U,helpers.prepareMustache=q,helpers.prepareRawBlock=j,helpers.prepareBlock=G,helpers.prepareProgram=H,helpers.preparePartialBlock=V;function d(Z){return Z&&Z.__esModule?Z:{default:Z}}var m=requireException(),g=d(m);function w(Z,Q){if(Q=Q.path?Q.path.original:Q,Z.path.original!==Q){var J={loc:Z.path.loc};throw new g.default(Z.path.original+" doesn't match "+Q,J)}}function $(Z,Q){this.source=Z,this.start={line:Q.first_line,column:Q.first_column},this.end={line:Q.last_line,column:Q.last_column}}function I(Z){return/^\[.*\]$/.test(Z)?Z.substring(1,Z.length-1):Z}function D(Z,Q){return{open:Z.charAt(2)==="~",close:Q.charAt(Q.length-3)==="~"}}function F(Z){return Z.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function U(Z,Q,J){J=this.locInfo(J);for(var ie=Z?"@":"",re=[],se=0,X=0,ne=Q.length;X<ne;X++){var ce=Q[X].part,oe=Q[X].original!==ce;if(ie+=(Q[X].separator||"")+ce,!oe&&(ce===".."||ce==="."||ce==="this")){if(re.length>0)throw new g.default("Invalid path: "+ie,{loc:J});ce===".."&&se++}else re.push(ce)}return{type:"PathExpression",data:Z,depth:se,parts:re,original:ie,loc:J}}function q(Z,Q,J,ie,re,se){var X=ie.charAt(3)||ie.charAt(2),ne=X!=="{"&&X!=="&",ce=/\*/.test(ie);return{type:ce?"Decorator":"MustacheStatement",path:Z,params:Q,hash:J,escaped:ne,strip:re,loc:this.locInfo(se)}}function j(Z,Q,J,ie){w(Z,J),ie=this.locInfo(ie);var re={type:"Program",body:Q,strip:{},loc:ie};return{type:"BlockStatement",path:Z.path,params:Z.params,hash:Z.hash,program:re,openStrip:{},inverseStrip:{},closeStrip:{},loc:ie}}function G(Z,Q,J,ie,re,se){ie&&ie.path&&w(Z,ie);var X=/\*/.test(Z.open);Q.blockParams=Z.blockParams;var ne=void 0,ce=void 0;if(J){if(X)throw new g.default("Unexpected inverse block on decorator",J);J.chain&&(J.program.body[0].closeStrip=ie.strip),ce=J.strip,ne=J.program}return re&&(re=ne,ne=Q,Q=re),{type:X?"DecoratorBlock":"BlockStatement",path:Z.path,params:Z.params,hash:Z.hash,program:Q,inverse:ne,openStrip:Z.strip,inverseStrip:ce,closeStrip:ie&&ie.strip,loc:this.locInfo(se)}}function H(Z,Q){if(!Q&&Z.length){var J=Z[0].loc,ie=Z[Z.length-1].loc;J&&ie&&(Q={source:J.source,start:{line:J.start.line,column:J.start.column},end:{line:ie.end.line,column:ie.end.column}})}return{type:"Program",body:Z,strip:{},loc:Q}}function V(Z,Q,J,ie){return w(Z,J),{type:"PartialBlockStatement",name:Z.path,params:Z.params,hash:Z.hash,program:Q,openStrip:Z.strip,closeStrip:J&&J.strip,loc:this.locInfo(ie)}}return helpers}var hasRequiredBase;function requireBase(){if(hasRequiredBase)return base;hasRequiredBase=1,base.__esModule=!0,base.parseWithoutProcessing=j,base.parse=G;function d(H){if(H&&H.__esModule)return H;var V={};if(H!=null)for(var Z in H)Object.prototype.hasOwnProperty.call(H,Z)&&(V[Z]=H[Z]);return V.default=H,V}function m(H){return H&&H.__esModule?H:{default:H}}var g=requireParser$1(),w=m(g),$=requireWhitespaceControl(),I=m($),D=requireHelpers(),F=d(D),U=requireUtils();base.parser=w.default;var q={};U.extend(q,F);function j(H,V){if(H.type==="Program")return H;w.default.yy=q,q.locInfo=function(Q){return new q.SourceLocation(V&&V.srcName,Q)};var Z=w.default.parse(H);return Z}function G(H,V){var Z=j(H,V),Q=new I.default(V);return Q.accept(Z)}return base}var compiler={},hasRequiredCompiler;function requireCompiler(){if(hasRequiredCompiler)return compiler;hasRequiredCompiler=1,compiler.__esModule=!0,compiler.Compiler=F,compiler.precompile=U,compiler.compile=q;function d(H){return H&&H.__esModule?H:{default:H}}var m=requireException(),g=d(m),w=requireUtils(),$=requireAst(),I=d($),D=[].slice;function F(){}F.prototype={compiler:F,equals:function(V){var Z=this.opcodes.length;if(V.opcodes.length!==Z)return!1;for(var Q=0;Q<Z;Q++){var J=this.opcodes[Q],ie=V.opcodes[Q];if(J.opcode!==ie.opcode||!j(J.args,ie.args))return!1}Z=this.children.length;for(var Q=0;Q<Z;Q++)if(!this.children[Q].equals(V.children[Q]))return!1;return!0},guid:0,compile:function(V,Z){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=Z,this.stringParams=Z.stringParams,this.trackIds=Z.trackIds,Z.blockParams=Z.blockParams||[],Z.knownHelpers=w.extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},Z.knownHelpers),this.accept(V)},compileProgram:function(V){var Z=new this.compiler,Q=Z.compile(V,this.options),J=this.guid++;return this.usePartial=this.usePartial||Q.usePartial,this.children[J]=Q,this.useDepths=this.useDepths||Q.useDepths,J},accept:function(V){if(!this[V.type])throw new g.default("Unknown type: "+V.type,V);this.sourceNode.unshift(V);var Z=this[V.type](V);return this.sourceNode.shift(),Z},Program:function(V){this.options.blockParams.unshift(V.blockParams);for(var Z=V.body,Q=Z.length,J=0;J<Q;J++)this.accept(Z[J]);return this.options.blockParams.shift(),this.isSimple=Q===1,this.blockParams=V.blockParams?V.blockParams.length:0,this},BlockStatement:function(V){G(V);var Z=V.program,Q=V.inverse;Z=Z&&this.compileProgram(Z),Q=Q&&this.compileProgram(Q);var J=this.classifySexpr(V);J==="helper"?this.helperSexpr(V,Z,Q):J==="simple"?(this.simpleSexpr(V),this.opcode("pushProgram",Z),this.opcode("pushProgram",Q),this.opcode("emptyHash"),this.opcode("blockValue",V.path.original)):(this.ambiguousSexpr(V,Z,Q),this.opcode("pushProgram",Z),this.opcode("pushProgram",Q),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(V){var Z=V.program&&this.compileProgram(V.program),Q=this.setupFullMustacheParams(V,Z,void 0),J=V.path;this.useDecorators=!0,this.opcode("registerDecorator",Q.length,J.original)},PartialStatement:function(V){this.usePartial=!0;var Z=V.program;Z&&(Z=this.compileProgram(V.program));var Q=V.params;if(Q.length>1)throw new g.default("Unsupported number of partial arguments: "+Q.length,V);Q.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):Q.push({type:"PathExpression",parts:[],depth:0}));var J=V.name.original,ie=V.name.type==="SubExpression";ie&&this.accept(V.name),this.setupFullMustacheParams(V,Z,void 0,!0);var re=V.indent||"";this.options.preventIndent&&re&&(this.opcode("appendContent",re),re=""),this.opcode("invokePartial",ie,J,re),this.opcode("append")},PartialBlockStatement:function(V){this.PartialStatement(V)},MustacheStatement:function(V){this.SubExpression(V),V.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(V){this.DecoratorBlock(V)},ContentStatement:function(V){V.value&&this.opcode("appendContent",V.value)},CommentStatement:function(){},SubExpression:function(V){G(V);var Z=this.classifySexpr(V);Z==="simple"?this.simpleSexpr(V):Z==="helper"?this.helperSexpr(V):this.ambiguousSexpr(V)},ambiguousSexpr:function(V,Z,Q){var J=V.path,ie=J.parts[0],re=Z!=null||Q!=null;this.opcode("getContext",J.depth),this.opcode("pushProgram",Z),this.opcode("pushProgram",Q),J.strict=!0,this.accept(J),this.opcode("invokeAmbiguous",ie,re)},simpleSexpr:function(V){var Z=V.path;Z.strict=!0,this.accept(Z),this.opcode("resolvePossibleLambda")},helperSexpr:function(V,Z,Q){var J=this.setupFullMustacheParams(V,Z,Q),ie=V.path,re=ie.parts[0];if(this.options.knownHelpers[re])this.opcode("invokeKnownHelper",J.length,re);else{if(this.options.knownHelpersOnly)throw new g.default("You specified knownHelpersOnly, but used the unknown helper "+re,V);ie.strict=!0,ie.falsy=!0,this.accept(ie),this.opcode("invokeHelper",J.length,ie.original,I.default.helpers.simpleId(ie))}},PathExpression:function(V){this.addDepth(V.depth),this.opcode("getContext",V.depth);var Z=V.parts[0],Q=I.default.helpers.scopedId(V),J=!V.depth&&!Q&&this.blockParamIndex(Z);J?this.opcode("lookupBlockParam",J,V.parts):Z?V.data?(this.options.data=!0,this.opcode("lookupData",V.depth,V.parts,V.strict)):this.opcode("lookupOnContext",V.parts,V.falsy,V.strict,Q):this.opcode("pushContext")},StringLiteral:function(V){this.opcode("pushString",V.value)},NumberLiteral:function(V){this.opcode("pushLiteral",V.value)},BooleanLiteral:function(V){this.opcode("pushLiteral",V.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(V){var Z=V.pairs,Q=0,J=Z.length;for(this.opcode("pushHash");Q<J;Q++)this.pushParam(Z[Q].value);for(;Q--;)this.opcode("assignToHash",Z[Q].key);this.opcode("popHash")},opcode:function(V){this.opcodes.push({opcode:V,args:D.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(V){V&&(this.useDepths=!0)},classifySexpr:function(V){var Z=I.default.helpers.simpleId(V.path),Q=Z&&!!this.blockParamIndex(V.path.parts[0]),J=!Q&&I.default.helpers.helperExpression(V),ie=!Q&&(J||Z);if(ie&&!J){var re=V.path.parts[0],se=this.options;se.knownHelpers[re]?J=!0:se.knownHelpersOnly&&(ie=!1)}return J?"helper":ie?"ambiguous":"simple"},pushParams:function(V){for(var Z=0,Q=V.length;Z<Q;Z++)this.pushParam(V[Z])},pushParam:function(V){var Z=V.value!=null?V.value:V.original||"";if(this.stringParams)Z.replace&&(Z=Z.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),V.depth&&this.addDepth(V.depth),this.opcode("getContext",V.depth||0),this.opcode("pushStringParam",Z,V.type),V.type==="SubExpression"&&this.accept(V);else{if(this.trackIds){var Q=void 0;if(V.parts&&!I.default.helpers.scopedId(V)&&!V.depth&&(Q=this.blockParamIndex(V.parts[0])),Q){var J=V.parts.slice(1).join(".");this.opcode("pushId","BlockParam",Q,J)}else Z=V.original||Z,Z.replace&&(Z=Z.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",V.type,Z)}this.accept(V)}},setupFullMustacheParams:function(V,Z,Q,J){var ie=V.params;return this.pushParams(ie),this.opcode("pushProgram",Z),this.opcode("pushProgram",Q),V.hash?this.accept(V.hash):this.opcode("emptyHash",J),ie},blockParamIndex:function(V){for(var Z=0,Q=this.options.blockParams.length;Z<Q;Z++){var J=this.options.blockParams[Z],ie=J&&w.indexOf(J,V);if(J&&ie>=0)return[Z,ie]}}};function U(H,V,Z){if(H==null||typeof H!="string"&&H.type!=="Program")throw new g.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+H);V=V||{},"data"in V||(V.data=!0),V.compat&&(V.useDepths=!0);var Q=Z.parse(H,V),J=new Z.Compiler().compile(Q,V);return new Z.JavaScriptCompiler().compile(J,V)}function q(H,V,Z){if(V===void 0&&(V={}),H==null||typeof H!="string"&&H.type!=="Program")throw new g.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+H);V=w.extend({},V),"data"in V||(V.data=!0),V.compat&&(V.useDepths=!0);var Q=void 0;function J(){var re=Z.parse(H,V),se=new Z.Compiler().compile(re,V),X=new Z.JavaScriptCompiler().compile(se,V,void 0,!0);return Z.template(X)}function ie(re,se){return Q||(Q=J()),Q.call(this,re,se)}return ie._setup=function(re){return Q||(Q=J()),Q._setup(re)},ie._child=function(re,se,X,ne){return Q||(Q=J()),Q._child(re,se,X,ne)},ie}function j(H,V){if(H===V)return!0;if(w.isArray(H)&&w.isArray(V)&&H.length===V.length){for(var Z=0;Z<H.length;Z++)if(!j(H[Z],V[Z]))return!1;return!0}}function G(H){if(!H.path.parts){var V=H.path;H.path={type:"PathExpression",data:!1,depth:0,parts:[V.original+""],original:V.original+"",loc:V.loc}}}return compiler}var javascriptCompiler={exports:{}},codeGen={exports:{}},sourceMap={},sourceMapGenerator={},base64Vlq={},base64={},hasRequiredBase64;function requireBase64(){if(hasRequiredBase64)return base64;hasRequiredBase64=1;var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return base64.encode=function(m){if(0<=m&&m<d.length)return d[m];throw new TypeError("Must be between 0 and 63: "+m)},base64.decode=function(m){var g=65,w=90,$=97,I=122,D=48,F=57,U=43,q=47,j=26,G=52;return g<=m&&m<=w?m-g:$<=m&&m<=I?m-$+j:D<=m&&m<=F?m-D+G:m==U?62:m==q?63:-1},base64}var hasRequiredBase64Vlq;function requireBase64Vlq(){if(hasRequiredBase64Vlq)return base64Vlq;hasRequiredBase64Vlq=1;var d=requireBase64(),m=5,g=1<<m,w=g-1,$=g;function I(F){return F<0?(-F<<1)+1:(F<<1)+0}function D(F){var U=(F&1)===1,q=F>>1;return U?-q:q}return base64Vlq.encode=function(U){var q="",j,G=I(U);do j=G&w,G>>>=m,G>0&&(j|=$),q+=d.encode(j);while(G>0);return q},base64Vlq.decode=function(U,q,j){var G=U.length,H=0,V=0,Z,Q;do{if(q>=G)throw new Error("Expected more digits in base 64 VLQ value.");if(Q=d.decode(U.charCodeAt(q++)),Q===-1)throw new Error("Invalid base64 digit: "+U.charAt(q-1));Z=!!(Q&$),Q&=w,H=H+(Q<<V),V+=m}while(Z);j.value=D(H),j.rest=q},base64Vlq}var util$2={},hasRequiredUtil;function requireUtil(){return hasRequiredUtil||(hasRequiredUtil=1,(function(d){function m(X,ne,ce){if(ne in X)return X[ne];if(arguments.length===3)return ce;throw new Error('"'+ne+'" is a required argument.')}d.getArg=m;var g=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,w=/^data:.+\,.+$/;function $(X){var ne=X.match(g);return ne?{scheme:ne[1],auth:ne[2],host:ne[3],port:ne[4],path:ne[5]}:null}d.urlParse=$;function I(X){var ne="";return X.scheme&&(ne+=X.scheme+":"),ne+="//",X.auth&&(ne+=X.auth+"@"),X.host&&(ne+=X.host),X.port&&(ne+=":"+X.port),X.path&&(ne+=X.path),ne}d.urlGenerate=I;function D(X){var ne=X,ce=$(X);if(ce){if(!ce.path)return X;ne=ce.path}for(var oe=d.isAbsolute(ne),de=ne.split(/\/+/),me,ge=0,fe=de.length-1;fe>=0;fe--)me=de[fe],me==="."?de.splice(fe,1):me===".."?ge++:ge>0&&(me===""?(de.splice(fe+1,ge),ge=0):(de.splice(fe,2),ge--));return ne=de.join("/"),ne===""&&(ne=oe?"/":"."),ce?(ce.path=ne,I(ce)):ne}d.normalize=D;function F(X,ne){X===""&&(X="."),ne===""&&(ne=".");var ce=$(ne),oe=$(X);if(oe&&(X=oe.path||"/"),ce&&!ce.scheme)return oe&&(ce.scheme=oe.scheme),I(ce);if(ce||ne.match(w))return ne;if(oe&&!oe.host&&!oe.path)return oe.host=ne,I(oe);var de=ne.charAt(0)==="/"?ne:D(X.replace(/\/+$/,"")+"/"+ne);return oe?(oe.path=de,I(oe)):de}d.join=F,d.isAbsolute=function(X){return X.charAt(0)==="/"||g.test(X)};function U(X,ne){X===""&&(X="."),X=X.replace(/\/$/,"");for(var ce=0;ne.indexOf(X+"/")!==0;){var oe=X.lastIndexOf("/");if(oe<0||(X=X.slice(0,oe),X.match(/^([^\/]+:\/)?\/*$/)))return ne;++ce}return Array(ce+1).join("../")+ne.substr(X.length+1)}d.relative=U;var q=(function(){var X=Object.create(null);return!("__proto__"in X)})();function j(X){return X}function G(X){return V(X)?"$"+X:X}d.toSetString=q?j:G;function H(X){return V(X)?X.slice(1):X}d.fromSetString=q?j:H;function V(X){if(!X)return!1;var ne=X.length;if(ne<9||X.charCodeAt(ne-1)!==95||X.charCodeAt(ne-2)!==95||X.charCodeAt(ne-3)!==111||X.charCodeAt(ne-4)!==116||X.charCodeAt(ne-5)!==111||X.charCodeAt(ne-6)!==114||X.charCodeAt(ne-7)!==112||X.charCodeAt(ne-8)!==95||X.charCodeAt(ne-9)!==95)return!1;for(var ce=ne-10;ce>=0;ce--)if(X.charCodeAt(ce)!==36)return!1;return!0}function Z(X,ne,ce){var oe=J(X.source,ne.source);return oe!==0||(oe=X.originalLine-ne.originalLine,oe!==0)||(oe=X.originalColumn-ne.originalColumn,oe!==0||ce)||(oe=X.generatedColumn-ne.generatedColumn,oe!==0)||(oe=X.generatedLine-ne.generatedLine,oe!==0)?oe:J(X.name,ne.name)}d.compareByOriginalPositions=Z;function Q(X,ne,ce){var oe=X.generatedLine-ne.generatedLine;return oe!==0||(oe=X.generatedColumn-ne.generatedColumn,oe!==0||ce)||(oe=J(X.source,ne.source),oe!==0)||(oe=X.originalLine-ne.originalLine,oe!==0)||(oe=X.originalColumn-ne.originalColumn,oe!==0)?oe:J(X.name,ne.name)}d.compareByGeneratedPositionsDeflated=Q;function J(X,ne){return X===ne?0:X===null?1:ne===null?-1:X>ne?1:-1}function ie(X,ne){var ce=X.generatedLine-ne.generatedLine;return ce!==0||(ce=X.generatedColumn-ne.generatedColumn,ce!==0)||(ce=J(X.source,ne.source),ce!==0)||(ce=X.originalLine-ne.originalLine,ce!==0)||(ce=X.originalColumn-ne.originalColumn,ce!==0)?ce:J(X.name,ne.name)}d.compareByGeneratedPositionsInflated=ie;function re(X){return JSON.parse(X.replace(/^\)]}'[^\n]*\n/,""))}d.parseSourceMapInput=re;function se(X,ne,ce){if(ne=ne||"",X&&(X[X.length-1]!=="/"&&ne[0]!=="/"&&(X+="/"),ne=X+ne),ce){var oe=$(ce);if(!oe)throw new Error("sourceMapURL could not be parsed");if(oe.path){var de=oe.path.lastIndexOf("/");de>=0&&(oe.path=oe.path.substring(0,de+1))}ne=F(I(oe),ne)}return D(ne)}d.computeSourceURL=se})(util$2)),util$2}var arraySet={},hasRequiredArraySet;function requireArraySet(){if(hasRequiredArraySet)return arraySet;hasRequiredArraySet=1;var d=requireUtil(),m=Object.prototype.hasOwnProperty,g=typeof Map<"u";function w(){this._array=[],this._set=g?new Map:Object.create(null)}return w.fromArray=function(I,D){for(var F=new w,U=0,q=I.length;U<q;U++)F.add(I[U],D);return F},w.prototype.size=function(){return g?this._set.size:Object.getOwnPropertyNames(this._set).length},w.prototype.add=function(I,D){var F=g?I:d.toSetString(I),U=g?this.has(I):m.call(this._set,F),q=this._array.length;(!U||D)&&this._array.push(I),U||(g?this._set.set(I,q):this._set[F]=q)},w.prototype.has=function(I){if(g)return this._set.has(I);var D=d.toSetString(I);return m.call(this._set,D)},w.prototype.indexOf=function(I){if(g){var D=this._set.get(I);if(D>=0)return D}else{var F=d.toSetString(I);if(m.call(this._set,F))return this._set[F]}throw new Error('"'+I+'" is not in the set.')},w.prototype.at=function(I){if(I>=0&&I<this._array.length)return this._array[I];throw new Error("No element indexed by "+I)},w.prototype.toArray=function(){return this._array.slice()},arraySet.ArraySet=w,arraySet}var mappingList={},hasRequiredMappingList;function requireMappingList(){if(hasRequiredMappingList)return mappingList;hasRequiredMappingList=1;var d=requireUtil();function m(w,$){var I=w.generatedLine,D=$.generatedLine,F=w.generatedColumn,U=$.generatedColumn;return D>I||D==I&&U>=F||d.compareByGeneratedPositionsInflated(w,$)<=0}function g(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return g.prototype.unsortedForEach=function($,I){this._array.forEach($,I)},g.prototype.add=function($){m(this._last,$)?(this._last=$,this._array.push($)):(this._sorted=!1,this._array.push($))},g.prototype.toArray=function(){return this._sorted||(this._array.sort(d.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},mappingList.MappingList=g,mappingList}var hasRequiredSourceMapGenerator;function requireSourceMapGenerator(){if(hasRequiredSourceMapGenerator)return sourceMapGenerator;hasRequiredSourceMapGenerator=1;var d=requireBase64Vlq(),m=requireUtil(),g=requireArraySet().ArraySet,w=requireMappingList().MappingList;function $(I){I||(I={}),this._file=m.getArg(I,"file",null),this._sourceRoot=m.getArg(I,"sourceRoot",null),this._skipValidation=m.getArg(I,"skipValidation",!1),this._sources=new g,this._names=new g,this._mappings=new w,this._sourcesContents=null}return $.prototype._version=3,$.fromSourceMap=function(D){var F=D.sourceRoot,U=new $({file:D.file,sourceRoot:F});return D.eachMapping(function(q){var j={generated:{line:q.generatedLine,column:q.generatedColumn}};q.source!=null&&(j.source=q.source,F!=null&&(j.source=m.relative(F,j.source)),j.original={line:q.originalLine,column:q.originalColumn},q.name!=null&&(j.name=q.name)),U.addMapping(j)}),D.sources.forEach(function(q){var j=q;F!==null&&(j=m.relative(F,q)),U._sources.has(j)||U._sources.add(j);var G=D.sourceContentFor(q);G!=null&&U.setSourceContent(q,G)}),U},$.prototype.addMapping=function(D){var F=m.getArg(D,"generated"),U=m.getArg(D,"original",null),q=m.getArg(D,"source",null),j=m.getArg(D,"name",null);this._skipValidation||this._validateMapping(F,U,q,j),q!=null&&(q=String(q),this._sources.has(q)||this._sources.add(q)),j!=null&&(j=String(j),this._names.has(j)||this._names.add(j)),this._mappings.add({generatedLine:F.line,generatedColumn:F.column,originalLine:U!=null&&U.line,originalColumn:U!=null&&U.column,source:q,name:j})},$.prototype.setSourceContent=function(D,F){var U=D;this._sourceRoot!=null&&(U=m.relative(this._sourceRoot,U)),F!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[m.toSetString(U)]=F):this._sourcesContents&&(delete this._sourcesContents[m.toSetString(U)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},$.prototype.applySourceMap=function(D,F,U){var q=F;if(F==null){if(D.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);q=D.file}var j=this._sourceRoot;j!=null&&(q=m.relative(j,q));var G=new g,H=new g;this._mappings.unsortedForEach(function(V){if(V.source===q&&V.originalLine!=null){var Z=D.originalPositionFor({line:V.originalLine,column:V.originalColumn});Z.source!=null&&(V.source=Z.source,U!=null&&(V.source=m.join(U,V.source)),j!=null&&(V.source=m.relative(j,V.source)),V.originalLine=Z.line,V.originalColumn=Z.column,Z.name!=null&&(V.name=Z.name))}var Q=V.source;Q!=null&&!G.has(Q)&&G.add(Q);var J=V.name;J!=null&&!H.has(J)&&H.add(J)},this),this._sources=G,this._names=H,D.sources.forEach(function(V){var Z=D.sourceContentFor(V);Z!=null&&(U!=null&&(V=m.join(U,V)),j!=null&&(V=m.relative(j,V)),this.setSourceContent(V,Z))},this)},$.prototype._validateMapping=function(D,F,U,q){if(F&&typeof F.line!="number"&&typeof F.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(D&&"line"in D&&"column"in D&&D.line>0&&D.column>=0&&!F&&!U&&!q)){if(D&&"line"in D&&"column"in D&&F&&"line"in F&&"column"in F&&D.line>0&&D.column>=0&&F.line>0&&F.column>=0&&U)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:D,source:U,original:F,name:q}))}},$.prototype._serializeMappings=function(){for(var D=0,F=1,U=0,q=0,j=0,G=0,H="",V,Z,Q,J,ie=this._mappings.toArray(),re=0,se=ie.length;re<se;re++){if(Z=ie[re],V="",Z.generatedLine!==F)for(D=0;Z.generatedLine!==F;)V+=";",F++;else if(re>0){if(!m.compareByGeneratedPositionsInflated(Z,ie[re-1]))continue;V+=","}V+=d.encode(Z.generatedColumn-D),D=Z.generatedColumn,Z.source!=null&&(J=this._sources.indexOf(Z.source),V+=d.encode(J-G),G=J,V+=d.encode(Z.originalLine-1-q),q=Z.originalLine-1,V+=d.encode(Z.originalColumn-U),U=Z.originalColumn,Z.name!=null&&(Q=this._names.indexOf(Z.name),V+=d.encode(Q-j),j=Q)),H+=V}return H},$.prototype._generateSourcesContent=function(D,F){return D.map(function(U){if(!this._sourcesContents)return null;F!=null&&(U=m.relative(F,U));var q=m.toSetString(U);return Object.prototype.hasOwnProperty.call(this._sourcesContents,q)?this._sourcesContents[q]:null},this)},$.prototype.toJSON=function(){var D={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(D.file=this._file),this._sourceRoot!=null&&(D.sourceRoot=this._sourceRoot),this._sourcesContents&&(D.sourcesContent=this._generateSourcesContent(D.sources,D.sourceRoot)),D},$.prototype.toString=function(){return JSON.stringify(this.toJSON())},sourceMapGenerator.SourceMapGenerator=$,sourceMapGenerator}var sourceMapConsumer={},binarySearch={},hasRequiredBinarySearch;function requireBinarySearch(){return hasRequiredBinarySearch||(hasRequiredBinarySearch=1,(function(d){d.GREATEST_LOWER_BOUND=1,d.LEAST_UPPER_BOUND=2;function m(g,w,$,I,D,F){var U=Math.floor((w-g)/2)+g,q=D($,I[U],!0);return q===0?U:q>0?w-U>1?m(U,w,$,I,D,F):F==d.LEAST_UPPER_BOUND?w<I.length?w:-1:U:U-g>1?m(g,U,$,I,D,F):F==d.LEAST_UPPER_BOUND?U:g<0?-1:g}d.search=function(w,$,I,D){if($.length===0)return-1;var F=m(-1,$.length,w,$,I,D||d.GREATEST_LOWER_BOUND);if(F<0)return-1;for(;F-1>=0&&I($[F],$[F-1],!0)===0;)--F;return F}})(binarySearch)),binarySearch}var quickSort={},hasRequiredQuickSort;function requireQuickSort(){if(hasRequiredQuickSort)return quickSort;hasRequiredQuickSort=1;function d(w,$,I){var D=w[$];w[$]=w[I],w[I]=D}function m(w,$){return Math.round(w+Math.random()*($-w))}function g(w,$,I,D){if(I<D){var F=m(I,D),U=I-1;d(w,F,D);for(var q=w[D],j=I;j<D;j++)$(w[j],q)<=0&&(U+=1,d(w,U,j));d(w,U+1,j);var G=U+1;g(w,$,I,G-1),g(w,$,G+1,D)}}return quickSort.quickSort=function(w,$){g(w,$,0,w.length-1)},quickSort}var hasRequiredSourceMapConsumer;function requireSourceMapConsumer(){if(hasRequiredSourceMapConsumer)return sourceMapConsumer;hasRequiredSourceMapConsumer=1;var d=requireUtil(),m=requireBinarySearch(),g=requireArraySet().ArraySet,w=requireBase64Vlq(),$=requireQuickSort().quickSort;function I(q,j){var G=q;return typeof q=="string"&&(G=d.parseSourceMapInput(q)),G.sections!=null?new U(G,j):new D(G,j)}I.fromSourceMap=function(q,j){return D.fromSourceMap(q,j)},I.prototype._version=3,I.prototype.__generatedMappings=null,Object.defineProperty(I.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),I.prototype.__originalMappings=null,Object.defineProperty(I.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),I.prototype._charIsMappingSeparator=function(j,G){var H=j.charAt(G);return H===";"||H===","},I.prototype._parseMappings=function(j,G){throw new Error("Subclasses must implement _parseMappings")},I.GENERATED_ORDER=1,I.ORIGINAL_ORDER=2,I.GREATEST_LOWER_BOUND=1,I.LEAST_UPPER_BOUND=2,I.prototype.eachMapping=function(j,G,H){var V=G||null,Z=H||I.GENERATED_ORDER,Q;switch(Z){case I.GENERATED_ORDER:Q=this._generatedMappings;break;case I.ORIGINAL_ORDER:Q=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var J=this.sourceRoot;Q.map(function(ie){var re=ie.source===null?null:this._sources.at(ie.source);return re=d.computeSourceURL(J,re,this._sourceMapURL),{source:re,generatedLine:ie.generatedLine,generatedColumn:ie.generatedColumn,originalLine:ie.originalLine,originalColumn:ie.originalColumn,name:ie.name===null?null:this._names.at(ie.name)}},this).forEach(j,V)},I.prototype.allGeneratedPositionsFor=function(j){var G=d.getArg(j,"line"),H={source:d.getArg(j,"source"),originalLine:G,originalColumn:d.getArg(j,"column",0)};if(H.source=this._findSourceIndex(H.source),H.source<0)return[];var V=[],Z=this._findMapping(H,this._originalMappings,"originalLine","originalColumn",d.compareByOriginalPositions,m.LEAST_UPPER_BOUND);if(Z>=0){var Q=this._originalMappings[Z];if(j.column===void 0)for(var J=Q.originalLine;Q&&Q.originalLine===J;)V.push({line:d.getArg(Q,"generatedLine",null),column:d.getArg(Q,"generatedColumn",null),lastColumn:d.getArg(Q,"lastGeneratedColumn",null)}),Q=this._originalMappings[++Z];else for(var ie=Q.originalColumn;Q&&Q.originalLine===G&&Q.originalColumn==ie;)V.push({line:d.getArg(Q,"generatedLine",null),column:d.getArg(Q,"generatedColumn",null),lastColumn:d.getArg(Q,"lastGeneratedColumn",null)}),Q=this._originalMappings[++Z]}return V},sourceMapConsumer.SourceMapConsumer=I;function D(q,j){var G=q;typeof q=="string"&&(G=d.parseSourceMapInput(q));var H=d.getArg(G,"version"),V=d.getArg(G,"sources"),Z=d.getArg(G,"names",[]),Q=d.getArg(G,"sourceRoot",null),J=d.getArg(G,"sourcesContent",null),ie=d.getArg(G,"mappings"),re=d.getArg(G,"file",null);if(H!=this._version)throw new Error("Unsupported version: "+H);Q&&(Q=d.normalize(Q)),V=V.map(String).map(d.normalize).map(function(se){return Q&&d.isAbsolute(Q)&&d.isAbsolute(se)?d.relative(Q,se):se}),this._names=g.fromArray(Z.map(String),!0),this._sources=g.fromArray(V,!0),this._absoluteSources=this._sources.toArray().map(function(se){return d.computeSourceURL(Q,se,j)}),this.sourceRoot=Q,this.sourcesContent=J,this._mappings=ie,this._sourceMapURL=j,this.file=re}D.prototype=Object.create(I.prototype),D.prototype.consumer=I,D.prototype._findSourceIndex=function(q){var j=q;if(this.sourceRoot!=null&&(j=d.relative(this.sourceRoot,j)),this._sources.has(j))return this._sources.indexOf(j);var G;for(G=0;G<this._absoluteSources.length;++G)if(this._absoluteSources[G]==q)return G;return-1},D.fromSourceMap=function(j,G){var H=Object.create(D.prototype),V=H._names=g.fromArray(j._names.toArray(),!0),Z=H._sources=g.fromArray(j._sources.toArray(),!0);H.sourceRoot=j._sourceRoot,H.sourcesContent=j._generateSourcesContent(H._sources.toArray(),H.sourceRoot),H.file=j._file,H._sourceMapURL=G,H._absoluteSources=H._sources.toArray().map(function(ce){return d.computeSourceURL(H.sourceRoot,ce,G)});for(var Q=j._mappings.toArray().slice(),J=H.__generatedMappings=[],ie=H.__originalMappings=[],re=0,se=Q.length;re<se;re++){var X=Q[re],ne=new F;ne.generatedLine=X.generatedLine,ne.generatedColumn=X.generatedColumn,X.source&&(ne.source=Z.indexOf(X.source),ne.originalLine=X.originalLine,ne.originalColumn=X.originalColumn,X.name&&(ne.name=V.indexOf(X.name)),ie.push(ne)),J.push(ne)}return $(H.__originalMappings,d.compareByOriginalPositions),H},D.prototype._version=3,Object.defineProperty(D.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function F(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}D.prototype._parseMappings=function(j,G){for(var H=1,V=0,Z=0,Q=0,J=0,ie=0,re=j.length,se=0,X={},ne={},ce=[],oe=[],de,me,ge,fe,xe;se<re;)if(j.charAt(se)===";")H++,se++,V=0;else if(j.charAt(se)===",")se++;else{for(de=new F,de.generatedLine=H,fe=se;fe<re&&!this._charIsMappingSeparator(j,fe);fe++);if(me=j.slice(se,fe),ge=X[me],ge)se+=me.length;else{for(ge=[];se<fe;)w.decode(j,se,ne),xe=ne.value,se=ne.rest,ge.push(xe);if(ge.length===2)throw new Error("Found a source, but no line and column");if(ge.length===3)throw new Error("Found a source and line, but no column");X[me]=ge}de.generatedColumn=V+ge[0],V=de.generatedColumn,ge.length>1&&(de.source=J+ge[1],J+=ge[1],de.originalLine=Z+ge[2],Z=de.originalLine,de.originalLine+=1,de.originalColumn=Q+ge[3],Q=de.originalColumn,ge.length>4&&(de.name=ie+ge[4],ie+=ge[4])),oe.push(de),typeof de.originalLine=="number"&&ce.push(de)}$(oe,d.compareByGeneratedPositionsDeflated),this.__generatedMappings=oe,$(ce,d.compareByOriginalPositions),this.__originalMappings=ce},D.prototype._findMapping=function(j,G,H,V,Z,Q){if(j[H]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+j[H]);if(j[V]<0)throw new TypeError("Column must be greater than or equal to 0, got "+j[V]);return m.search(j,G,Z,Q)},D.prototype.computeColumnSpans=function(){for(var j=0;j<this._generatedMappings.length;++j){var G=this._generatedMappings[j];if(j+1<this._generatedMappings.length){var H=this._generatedMappings[j+1];if(G.generatedLine===H.generatedLine){G.lastGeneratedColumn=H.generatedColumn-1;continue}}G.lastGeneratedColumn=1/0}},D.prototype.originalPositionFor=function(j){var G={generatedLine:d.getArg(j,"line"),generatedColumn:d.getArg(j,"column")},H=this._findMapping(G,this._generatedMappings,"generatedLine","generatedColumn",d.compareByGeneratedPositionsDeflated,d.getArg(j,"bias",I.GREATEST_LOWER_BOUND));if(H>=0){var V=this._generatedMappings[H];if(V.generatedLine===G.generatedLine){var Z=d.getArg(V,"source",null);Z!==null&&(Z=this._sources.at(Z),Z=d.computeSourceURL(this.sourceRoot,Z,this._sourceMapURL));var Q=d.getArg(V,"name",null);return Q!==null&&(Q=this._names.at(Q)),{source:Z,line:d.getArg(V,"originalLine",null),column:d.getArg(V,"originalColumn",null),name:Q}}}return{source:null,line:null,column:null,name:null}},D.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(j){return j==null}):!1},D.prototype.sourceContentFor=function(j,G){if(!this.sourcesContent)return null;var H=this._findSourceIndex(j);if(H>=0)return this.sourcesContent[H];var V=j;this.sourceRoot!=null&&(V=d.relative(this.sourceRoot,V));var Z;if(this.sourceRoot!=null&&(Z=d.urlParse(this.sourceRoot))){var Q=V.replace(/^file:\/\//,"");if(Z.scheme=="file"&&this._sources.has(Q))return this.sourcesContent[this._sources.indexOf(Q)];if((!Z.path||Z.path=="/")&&this._sources.has("/"+V))return this.sourcesContent[this._sources.indexOf("/"+V)]}if(G)return null;throw new Error('"'+V+'" is not in the SourceMap.')},D.prototype.generatedPositionFor=function(j){var G=d.getArg(j,"source");if(G=this._findSourceIndex(G),G<0)return{line:null,column:null,lastColumn:null};var H={source:G,originalLine:d.getArg(j,"line"),originalColumn:d.getArg(j,"column")},V=this._findMapping(H,this._originalMappings,"originalLine","originalColumn",d.compareByOriginalPositions,d.getArg(j,"bias",I.GREATEST_LOWER_BOUND));if(V>=0){var Z=this._originalMappings[V];if(Z.source===H.source)return{line:d.getArg(Z,"generatedLine",null),column:d.getArg(Z,"generatedColumn",null),lastColumn:d.getArg(Z,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},sourceMapConsumer.BasicSourceMapConsumer=D;function U(q,j){var G=q;typeof q=="string"&&(G=d.parseSourceMapInput(q));var H=d.getArg(G,"version"),V=d.getArg(G,"sections");if(H!=this._version)throw new Error("Unsupported version: "+H);this._sources=new g,this._names=new g;var Z={line:-1,column:0};this._sections=V.map(function(Q){if(Q.url)throw new Error("Support for url field in sections not implemented.");var J=d.getArg(Q,"offset"),ie=d.getArg(J,"line"),re=d.getArg(J,"column");if(ie<Z.line||ie===Z.line&&re<Z.column)throw new Error("Section offsets must be ordered and non-overlapping.");return Z=J,{generatedOffset:{generatedLine:ie+1,generatedColumn:re+1},consumer:new I(d.getArg(Q,"map"),j)}})}return U.prototype=Object.create(I.prototype),U.prototype.constructor=I,U.prototype._version=3,Object.defineProperty(U.prototype,"sources",{get:function(){for(var q=[],j=0;j<this._sections.length;j++)for(var G=0;G<this._sections[j].consumer.sources.length;G++)q.push(this._sections[j].consumer.sources[G]);return q}}),U.prototype.originalPositionFor=function(j){var G={generatedLine:d.getArg(j,"line"),generatedColumn:d.getArg(j,"column")},H=m.search(G,this._sections,function(Z,Q){var J=Z.generatedLine-Q.generatedOffset.generatedLine;return J||Z.generatedColumn-Q.generatedOffset.generatedColumn}),V=this._sections[H];return V?V.consumer.originalPositionFor({line:G.generatedLine-(V.generatedOffset.generatedLine-1),column:G.generatedColumn-(V.generatedOffset.generatedLine===G.generatedLine?V.generatedOffset.generatedColumn-1:0),bias:j.bias}):{source:null,line:null,column:null,name:null}},U.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(j){return j.consumer.hasContentsOfAllSources()})},U.prototype.sourceContentFor=function(j,G){for(var H=0;H<this._sections.length;H++){var V=this._sections[H],Z=V.consumer.sourceContentFor(j,!0);if(Z)return Z}if(G)return null;throw new Error('"'+j+'" is not in the SourceMap.')},U.prototype.generatedPositionFor=function(j){for(var G=0;G<this._sections.length;G++){var H=this._sections[G];if(H.consumer._findSourceIndex(d.getArg(j,"source"))!==-1){var V=H.consumer.generatedPositionFor(j);if(V){var Z={line:V.line+(H.generatedOffset.generatedLine-1),column:V.column+(H.generatedOffset.generatedLine===V.line?H.generatedOffset.generatedColumn-1:0)};return Z}}}return{line:null,column:null}},U.prototype._parseMappings=function(j,G){this.__generatedMappings=[],this.__originalMappings=[];for(var H=0;H<this._sections.length;H++)for(var V=this._sections[H],Z=V.consumer._generatedMappings,Q=0;Q<Z.length;Q++){var J=Z[Q],ie=V.consumer._sources.at(J.source);ie=d.computeSourceURL(V.consumer.sourceRoot,ie,this._sourceMapURL),this._sources.add(ie),ie=this._sources.indexOf(ie);var re=null;J.name&&(re=V.consumer._names.at(J.name),this._names.add(re),re=this._names.indexOf(re));var se={source:ie,generatedLine:J.generatedLine+(V.generatedOffset.generatedLine-1),generatedColumn:J.generatedColumn+(V.generatedOffset.generatedLine===J.generatedLine?V.generatedOffset.generatedColumn-1:0),originalLine:J.originalLine,originalColumn:J.originalColumn,name:re};this.__generatedMappings.push(se),typeof se.originalLine=="number"&&this.__originalMappings.push(se)}$(this.__generatedMappings,d.compareByGeneratedPositionsDeflated),$(this.__originalMappings,d.compareByOriginalPositions)},sourceMapConsumer.IndexedSourceMapConsumer=U,sourceMapConsumer}var sourceNode={},hasRequiredSourceNode;function requireSourceNode(){if(hasRequiredSourceNode)return sourceNode;hasRequiredSourceNode=1;var d=requireSourceMapGenerator().SourceMapGenerator,m=requireUtil(),g=/(\r?\n)/,w=10,$="$$$isSourceNode$$$";function I(D,F,U,q,j){this.children=[],this.sourceContents={},this.line=D??null,this.column=F??null,this.source=U??null,this.name=j??null,this[$]=!0,q!=null&&this.add(q)}return I.fromStringWithSourceMap=function(F,U,q){var j=new I,G=F.split(g),H=0,V=function(){var re=X(),se=X()||"";return re+se;function X(){return H<G.length?G[H++]:void 0}},Z=1,Q=0,J=null;return U.eachMapping(function(re){if(J!==null)if(Z<re.generatedLine)ie(J,V()),Z++,Q=0;else{var se=G[H]||"",X=se.substr(0,re.generatedColumn-Q);G[H]=se.substr(re.generatedColumn-Q),Q=re.generatedColumn,ie(J,X),J=re;return}for(;Z<re.generatedLine;)j.add(V()),Z++;if(Q<re.generatedColumn){var se=G[H]||"";j.add(se.substr(0,re.generatedColumn)),G[H]=se.substr(re.generatedColumn),Q=re.generatedColumn}J=re},this),H<G.length&&(J&&ie(J,V()),j.add(G.splice(H).join(""))),U.sources.forEach(function(re){var se=U.sourceContentFor(re);se!=null&&(q!=null&&(re=m.join(q,re)),j.setSourceContent(re,se))}),j;function ie(re,se){if(re===null||re.source===void 0)j.add(se);else{var X=q?m.join(q,re.source):re.source;j.add(new I(re.originalLine,re.originalColumn,X,se,re.name))}}},I.prototype.add=function(F){if(Array.isArray(F))F.forEach(function(U){this.add(U)},this);else if(F[$]||typeof F=="string")F&&this.children.push(F);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+F);return this},I.prototype.prepend=function(F){if(Array.isArray(F))for(var U=F.length-1;U>=0;U--)this.prepend(F[U]);else if(F[$]||typeof F=="string")this.children.unshift(F);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+F);return this},I.prototype.walk=function(F){for(var U,q=0,j=this.children.length;q<j;q++)U=this.children[q],U[$]?U.walk(F):U!==""&&F(U,{source:this.source,line:this.line,column:this.column,name:this.name})},I.prototype.join=function(F){var U,q,j=this.children.length;if(j>0){for(U=[],q=0;q<j-1;q++)U.push(this.children[q]),U.push(F);U.push(this.children[q]),this.children=U}return this},I.prototype.replaceRight=function(F,U){var q=this.children[this.children.length-1];return q[$]?q.replaceRight(F,U):typeof q=="string"?this.children[this.children.length-1]=q.replace(F,U):this.children.push("".replace(F,U)),this},I.prototype.setSourceContent=function(F,U){this.sourceContents[m.toSetString(F)]=U},I.prototype.walkSourceContents=function(F){for(var U=0,q=this.children.length;U<q;U++)this.children[U][$]&&this.children[U].walkSourceContents(F);for(var j=Object.keys(this.sourceContents),U=0,q=j.length;U<q;U++)F(m.fromSetString(j[U]),this.sourceContents[j[U]])},I.prototype.toString=function(){var F="";return this.walk(function(U){F+=U}),F},I.prototype.toStringWithSourceMap=function(F){var U={code:"",line:1,column:0},q=new d(F),j=!1,G=null,H=null,V=null,Z=null;return this.walk(function(Q,J){U.code+=Q,J.source!==null&&J.line!==null&&J.column!==null?((G!==J.source||H!==J.line||V!==J.column||Z!==J.name)&&q.addMapping({source:J.source,original:{line:J.line,column:J.column},generated:{line:U.line,column:U.column},name:J.name}),G=J.source,H=J.line,V=J.column,Z=J.name,j=!0):j&&(q.addMapping({generated:{line:U.line,column:U.column}}),G=null,j=!1);for(var ie=0,re=Q.length;ie<re;ie++)Q.charCodeAt(ie)===w?(U.line++,U.column=0,ie+1===re?(G=null,j=!1):j&&q.addMapping({source:J.source,original:{line:J.line,column:J.column},generated:{line:U.line,column:U.column},name:J.name})):U.column++}),this.walkSourceContents(function(Q,J){q.setSourceContent(Q,J)}),{code:U.code,map:q}},sourceNode.SourceNode=I,sourceNode}var hasRequiredSourceMap;function requireSourceMap(){return hasRequiredSourceMap||(hasRequiredSourceMap=1,sourceMap.SourceMapGenerator=requireSourceMapGenerator().SourceMapGenerator,sourceMap.SourceMapConsumer=requireSourceMapConsumer().SourceMapConsumer,sourceMap.SourceNode=requireSourceNode().SourceNode),sourceMap}var hasRequiredCodeGen;function requireCodeGen(){return hasRequiredCodeGen||(hasRequiredCodeGen=1,(function(d,m){m.__esModule=!0;var g=requireUtils(),w=void 0;try{var $=requireSourceMap();w=$.SourceNode}catch{}w||(w=function(F,U,q,j){this.src="",j&&this.add(j)},w.prototype={add:function(U){g.isArray(U)&&(U=U.join("")),this.src+=U},prepend:function(U){g.isArray(U)&&(U=U.join("")),this.src=U+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}});function I(F,U,q){if(g.isArray(F)){for(var j=[],G=0,H=F.length;G<H;G++)j.push(U.wrap(F[G],q));return j}else if(typeof F=="boolean"||typeof F=="number")return F+"";return F}function D(F){this.srcFile=F,this.source=[]}D.prototype={isEmpty:function(){return!this.source.length},prepend:function(U,q){this.source.unshift(this.wrap(U,q))},push:function(U,q){this.source.push(this.wrap(U,q))},merge:function(){var U=this.empty();return this.each(function(q){U.add(["  ",q,`
`])}),U},each:function(U){for(var q=0,j=this.source.length;q<j;q++)U(this.source[q])},empty:function(){var U=this.currentLocation||{start:{}};return new w(U.start.line,U.start.column,this.srcFile)},wrap:function(U){var q=arguments.length<=1||arguments[1]===void 0?this.currentLocation||{start:{}}:arguments[1];return U instanceof w?U:(U=I(U,this,q),new w(q.start.line,q.start.column,this.srcFile,U))},functionCall:function(U,q,j){return j=this.generateList(j),this.wrap([U,q?"."+q+"(":"(",j,")"])},quotedString:function(U){return'"'+(U+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(U){var q=this,j=[];Object.keys(U).forEach(function(H){var V=I(U[H],q);V!=="undefined"&&j.push([q.quotedString(H),":",V])});var G=this.generateList(j);return G.prepend("{"),G.add("}"),G},generateList:function(U){for(var q=this.empty(),j=0,G=U.length;j<G;j++)j&&q.add(","),q.add(I(U[j],this));return q},generateArray:function(U){var q=this.generateList(U);return q.prepend("["),q.add("]"),q}},m.default=D,d.exports=m.default})(codeGen,codeGen.exports)),codeGen.exports}var hasRequiredJavascriptCompiler;function requireJavascriptCompiler(){return hasRequiredJavascriptCompiler||(hasRequiredJavascriptCompiler=1,(function(d,m){m.__esModule=!0;function g(H){return H&&H.__esModule?H:{default:H}}var w=requireBase$1(),$=requireException(),I=g($),D=requireUtils(),F=requireCodeGen(),U=g(F);function q(H){this.value=H}function j(){}j.prototype={nameLookup:function(V,Z){return this.internalNameLookup(V,Z)},depthedLookup:function(V){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(V),")"]},compilerInfo:function(){var V=w.COMPILER_REVISION,Z=w.REVISION_CHANGES[V];return[V,Z]},appendToBuffer:function(V,Z,Q){return D.isArray(V)||(V=[V]),V=this.source.wrap(V,Z),this.environment.isSimple?["return ",V,";"]:Q?["buffer += ",V,";"]:(V.appendToBuffer=!0,V)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(V,Z){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",V,",",JSON.stringify(Z),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(V,Z,Q,J){this.environment=V,this.options=Z,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!J,this.name=this.environment.name,this.isChild=!!Q,this.context=Q||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(V,Z),this.useDepths=this.useDepths||V.useDepths||V.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||V.useBlockParams;var ie=V.opcodes,re=void 0,se=void 0,X=void 0,ne=void 0;for(X=0,ne=ie.length;X<ne;X++)re=ie[X],this.source.currentLocation=re.loc,se=se||re.loc,this[re.opcode].apply(this,re.args);if(this.source.currentLocation=se,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new I.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),`;
`]),this.decorators.push("return fn;"),J?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend(`function(fn, props, container, depth0, data, blockParams, depths) {
`),this.decorators.push(`}
`),this.decorators=this.decorators.merge()));var ce=this.createFunctionContext(J);if(this.isChild)return ce;var oe={compiler:this.compilerInfo(),main:ce};this.decorators&&(oe.main_d=this.decorators,oe.useDecorators=!0);var de=this.context,me=de.programs,ge=de.decorators;for(X=0,ne=me.length;X<ne;X++)me[X]&&(oe[X]=me[X],ge[X]&&(oe[X+"_d"]=ge[X],oe.useDecorators=!0));return this.environment.usePartial&&(oe.usePartial=!0),this.options.data&&(oe.useData=!0),this.useDepths&&(oe.useDepths=!0),this.useBlockParams&&(oe.useBlockParams=!0),this.options.compat&&(oe.compat=!0),J?oe.compilerOptions=this.options:(oe.compiler=JSON.stringify(oe.compiler),this.source.currentLocation={start:{line:1,column:0}},oe=this.objectLiteral(oe),Z.srcName?(oe=oe.toStringWithSourceMap({file:Z.destName}),oe.map=oe.map&&oe.map.toString()):oe=oe.toString()),oe},preamble:function(){this.lastContext=0,this.source=new U.default(this.options.srcName),this.decorators=new U.default(this.options.srcName)},createFunctionContext:function(V){var Z=this,Q="",J=this.stackVars.concat(this.registers.list);J.length>0&&(Q+=", "+J.join(", "));var ie=0;Object.keys(this.aliases).forEach(function(X){var ne=Z.aliases[X];ne.children&&ne.referenceCount>1&&(Q+=", alias"+ ++ie+"="+X,ne.children[0]="alias"+ie)}),this.lookupPropertyFunctionIsUsed&&(Q+=", "+this.lookupPropertyFunctionVarDeclaration());var re=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&re.push("blockParams"),this.useDepths&&re.push("depths");var se=this.mergeSource(Q);return V?(re.push(se),Function.apply(this,re)):this.source.wrap(["function(",re.join(","),`) {
  `,se,"}"])},mergeSource:function(V){var Z=this.environment.isSimple,Q=!this.forceBuffer,J=void 0,ie=void 0,re=void 0,se=void 0;return this.source.each(function(X){X.appendToBuffer?(re?X.prepend("  + "):re=X,se=X):(re&&(ie?re.prepend("buffer += "):J=!0,se.add(";"),re=se=void 0),ie=!0,Z||(Q=!1))}),Q?re?(re.prepend("return "),se.add(";")):ie||this.source.push('return "";'):(V+=", buffer = "+(J?"":this.initializeBuffer()),re?(re.prepend("return buffer + "),se.add(";")):this.source.push("return buffer;")),V&&this.source.prepend("var "+V.substring(2)+(J?"":`;
`)),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return`
      lookupProperty = container.lookupProperty || function(parent, propertyName) {
        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {
          return parent[propertyName];
        }
        return undefined
    }
    `.trim()},blockValue:function(V){var Z=this.aliasable("container.hooks.blockHelperMissing"),Q=[this.contextName(0)];this.setupHelperArgs(V,0,Q);var J=this.popStack();Q.splice(1,0,J),this.push(this.source.functionCall(Z,"call",Q))},ambiguousBlockValue:function(){var V=this.aliasable("container.hooks.blockHelperMissing"),Z=[this.contextName(0)];this.setupHelperArgs("",0,Z,!0),this.flushInline();var Q=this.topStack();Z.splice(1,0,Q),this.pushSource(["if (!",this.lastHelper,") { ",Q," = ",this.source.functionCall(V,"call",Z),"}"])},appendContent:function(V){this.pendingContent?V=this.pendingContent+V:this.pendingLocation=this.source.currentLocation,this.pendingContent=V},append:function(){if(this.isInline())this.replaceStack(function(Z){return[" != null ? ",Z,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var V=this.popStack();this.pushSource(["if (",V," != null) { ",this.appendToBuffer(V,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(V){this.lastContext=V},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(V,Z,Q,J){var ie=0;!J&&this.options.compat&&!this.lastContext?this.push(this.depthedLookup(V[ie++])):this.pushContext(),this.resolvePath("context",V,ie,Z,Q)},lookupBlockParam:function(V,Z){this.useBlockParams=!0,this.push(["blockParams[",V[0],"][",V[1],"]"]),this.resolvePath("context",Z,1)},lookupData:function(V,Z,Q){V?this.pushStackLiteral("container.data(data, "+V+")"):this.pushStackLiteral("data"),this.resolvePath("data",Z,0,!0,Q)},resolvePath:function(V,Z,Q,J,ie){var re=this;if(this.options.strict||this.options.assumeObjects){this.push(G(this.options.strict&&ie,this,Z,Q,V));return}for(var se=Z.length;Q<se;Q++)this.replaceStack(function(X){var ne=re.nameLookup(X,Z[Q],V);return J?[" && ",ne]:[" != null ? ",ne," : ",X]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(V,Z){this.pushContext(),this.pushString(Z),Z!=="SubExpression"&&(typeof V=="string"?this.pushString(V):this.pushStackLiteral(V))},emptyHash:function(V){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(V?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var V=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(V.ids)),this.stringParams&&(this.push(this.objectLiteral(V.contexts)),this.push(this.objectLiteral(V.types))),this.push(this.objectLiteral(V.values))},pushString:function(V){this.pushStackLiteral(this.quotedString(V))},pushLiteral:function(V){this.pushStackLiteral(V)},pushProgram:function(V){V!=null?this.pushStackLiteral(this.programExpression(V)):this.pushStackLiteral(null)},registerDecorator:function(V,Z){var Q=this.nameLookup("decorators",Z,"decorator"),J=this.setupHelperArgs(Z,V);this.decorators.push(["fn = ",this.decorators.functionCall(Q,"",["fn","props","container",J])," || fn;"])},invokeHelper:function(V,Z,Q){var J=this.popStack(),ie=this.setupHelper(V,Z),re=[];Q&&re.push(ie.name),re.push(J),this.options.strict||re.push(this.aliasable("container.hooks.helperMissing"));var se=["(",this.itemsSeparatedBy(re,"||"),")"],X=this.source.functionCall(se,"call",ie.callParams);this.push(X)},itemsSeparatedBy:function(V,Z){var Q=[];Q.push(V[0]);for(var J=1;J<V.length;J++)Q.push(Z,V[J]);return Q},invokeKnownHelper:function(V,Z){var Q=this.setupHelper(V,Z);this.push(this.source.functionCall(Q.name,"call",Q.callParams))},invokeAmbiguous:function(V,Z){this.useRegister("helper");var Q=this.popStack();this.emptyHash();var J=this.setupHelper(0,V,Z),ie=this.lastHelper=this.nameLookup("helpers",V,"helper"),re=["(","(helper = ",ie," || ",Q,")"];this.options.strict||(re[0]="(helper = ",re.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",re,J.paramsInit?["),(",J.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",J.callParams)," : helper))"])},invokePartial:function(V,Z,Q){var J=[],ie=this.setupParams(Z,1,J);V&&(Z=this.popStack(),delete ie.name),Q&&(ie.indent=JSON.stringify(Q)),ie.helpers="helpers",ie.partials="partials",ie.decorators="container.decorators",V?J.unshift(Z):J.unshift(this.nameLookup("partials",Z,"partial")),this.options.compat&&(ie.depths="depths"),ie=this.objectLiteral(ie),J.push(ie),this.push(this.source.functionCall("container.invokePartial","",J))},assignToHash:function(V){var Z=this.popStack(),Q=void 0,J=void 0,ie=void 0;this.trackIds&&(ie=this.popStack()),this.stringParams&&(J=this.popStack(),Q=this.popStack());var re=this.hash;Q&&(re.contexts[V]=Q),J&&(re.types[V]=J),ie&&(re.ids[V]=ie),re.values[V]=Z},pushId:function(V,Z,Q){V==="BlockParam"?this.pushStackLiteral("blockParams["+Z[0]+"].path["+Z[1]+"]"+(Q?" + "+JSON.stringify("."+Q):"")):V==="PathExpression"?this.pushString(Z):V==="SubExpression"?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:j,compileChildren:function(V,Z){for(var Q=V.children,J=void 0,ie=void 0,re=0,se=Q.length;re<se;re++){J=Q[re],ie=new this.compiler;var X=this.matchExistingProgram(J);if(X==null){this.context.programs.push("");var ne=this.context.programs.length;J.index=ne,J.name="program"+ne,this.context.programs[ne]=ie.compile(J,Z,this.context,!this.precompile),this.context.decorators[ne]=ie.decorators,this.context.environments[ne]=J,this.useDepths=this.useDepths||ie.useDepths,this.useBlockParams=this.useBlockParams||ie.useBlockParams,J.useDepths=this.useDepths,J.useBlockParams=this.useBlockParams}else J.index=X.index,J.name="program"+X.index,this.useDepths=this.useDepths||X.useDepths,this.useBlockParams=this.useBlockParams||X.useBlockParams}},matchExistingProgram:function(V){for(var Z=0,Q=this.context.environments.length;Z<Q;Z++){var J=this.context.environments[Z];if(J&&J.equals(V))return J}},programExpression:function(V){var Z=this.environment.children[V],Q=[Z.index,"data",Z.blockParams];return(this.useBlockParams||this.useDepths)&&Q.push("blockParams"),this.useDepths&&Q.push("depths"),"container.program("+Q.join(", ")+")"},useRegister:function(V){this.registers[V]||(this.registers[V]=!0,this.registers.list.push(V))},push:function(V){return V instanceof q||(V=this.source.wrap(V)),this.inlineStack.push(V),V},pushStackLiteral:function(V){this.push(new q(V))},pushSource:function(V){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),V&&this.source.push(V)},replaceStack:function(V){var Z=["("],Q=void 0,J=void 0,ie=void 0;if(!this.isInline())throw new I.default("replaceStack on non-inline");var re=this.popStack(!0);if(re instanceof q)Q=[re.value],Z=["(",Q],ie=!0;else{J=!0;var se=this.incrStack();Z=["((",this.push(se)," = ",re,")"],Q=this.topStack()}var X=V.call(this,Q);ie||this.popStack(),J&&this.stackSlot--,this.push(Z.concat(X,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var V=this.inlineStack;this.inlineStack=[];for(var Z=0,Q=V.length;Z<Q;Z++){var J=V[Z];if(J instanceof q)this.compileStack.push(J);else{var ie=this.incrStack();this.pushSource([ie," = ",J,";"]),this.compileStack.push(ie)}}},isInline:function(){return this.inlineStack.length},popStack:function(V){var Z=this.isInline(),Q=(Z?this.inlineStack:this.compileStack).pop();if(!V&&Q instanceof q)return Q.value;if(!Z){if(!this.stackSlot)throw new I.default("Invalid stack pop");this.stackSlot--}return Q},topStack:function(){var V=this.isInline()?this.inlineStack:this.compileStack,Z=V[V.length-1];return Z instanceof q?Z.value:Z},contextName:function(V){return this.useDepths&&V?"depths["+V+"]":"depth"+V},quotedString:function(V){return this.source.quotedString(V)},objectLiteral:function(V){return this.source.objectLiteral(V)},aliasable:function(V){var Z=this.aliases[V];return Z?(Z.referenceCount++,Z):(Z=this.aliases[V]=this.source.wrap(V),Z.aliasable=!0,Z.referenceCount=1,Z)},setupHelper:function(V,Z,Q){var J=[],ie=this.setupHelperArgs(Z,V,J,Q),re=this.nameLookup("helpers",Z,"helper"),se=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:J,paramsInit:ie,name:re,callParams:[se].concat(J)}},setupParams:function(V,Z,Q){var J={},ie=[],re=[],se=[],X=!Q,ne=void 0;X&&(Q=[]),J.name=this.quotedString(V),J.hash=this.popStack(),this.trackIds&&(J.hashIds=this.popStack()),this.stringParams&&(J.hashTypes=this.popStack(),J.hashContexts=this.popStack());var ce=this.popStack(),oe=this.popStack();(oe||ce)&&(J.fn=oe||"container.noop",J.inverse=ce||"container.noop");for(var de=Z;de--;)ne=this.popStack(),Q[de]=ne,this.trackIds&&(se[de]=this.popStack()),this.stringParams&&(re[de]=this.popStack(),ie[de]=this.popStack());return X&&(J.args=this.source.generateArray(Q)),this.trackIds&&(J.ids=this.source.generateArray(se)),this.stringParams&&(J.types=this.source.generateArray(re),J.contexts=this.source.generateArray(ie)),this.options.data&&(J.data="data"),this.useBlockParams&&(J.blockParams="blockParams"),J},setupHelperArgs:function(V,Z,Q,J){var ie=this.setupParams(V,Z,Q);return ie.loc=JSON.stringify(this.source.currentLocation),ie=this.objectLiteral(ie),J?(this.useRegister("options"),Q.push("options"),["options=",ie]):Q?(Q.push(ie),""):ie}},(function(){for(var H="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),V=j.RESERVED_WORDS={},Z=0,Q=H.length;Z<Q;Z++)V[H[Z]]=!0})(),j.isValidJavaScriptVariableName=function(H){return!j.RESERVED_WORDS[H]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(H)};function G(H,V,Z,Q,J){var ie=V.popStack(),re=Z.length;for(H&&re--;Q<re;Q++)ie=V.nameLookup(ie,Z[Q],J);return H?[V.aliasable("container.strict"),"(",ie,", ",V.quotedString(Z[Q]),", ",JSON.stringify(V.source.currentLocation)," )"]:ie}m.default=j,d.exports=m.default})(javascriptCompiler,javascriptCompiler.exports)),javascriptCompiler.exports}var hasRequiredHandlebars;function requireHandlebars(){return hasRequiredHandlebars||(hasRequiredHandlebars=1,(function(d,m){m.__esModule=!0;function g(re){return re&&re.__esModule?re:{default:re}}var w=requireHandlebars_runtime(),$=g(w),I=requireAst(),D=g(I),F=requireBase(),U=requireCompiler(),q=requireJavascriptCompiler(),j=g(q),G=requireVisitor(),H=g(G),V=requireNoConflict(),Z=g(V),Q=$.default.create;function J(){var re=Q();return re.compile=function(se,X){return U.compile(se,X,re)},re.precompile=function(se,X){return U.precompile(se,X,re)},re.AST=D.default,re.Compiler=U.Compiler,re.JavaScriptCompiler=j.default,re.Parser=F.parser,re.parse=F.parse,re.parseWithoutProcessing=F.parseWithoutProcessing,re}var ie=J();ie.create=J,Z.default(ie),ie.Visitor=H.default,ie.default=ie,m.default=ie,d.exports=m.default})(handlebars,handlebars.exports)),handlebars.exports}var handlebarsExports=requireHandlebars(),Handlebars=getDefaultExportFromCjs$1(handlebarsExports);const MODEL_DETECTION_OUTPUT_SHAPES={cx:{help:"CoordonÃ©e X du point central"},cy:{help:"CoordonÃ©e Y du point central"},sy:{help:"CoordonÃ©e Y du point supÃ©rieur gauche"},sx:{help:"CoordonÃ©e X du point supÃ©rieur gauche"},ex:{help:"CoordonÃ©e X du point infÃ©rieur droit"},ey:{help:"CoordonÃ©e Y du point infÃ©rieur droit"},w:{help:"Largeur de la boÃ®te englobante"},h:{help:"Hauteur de la boÃ®te englobante"},score:{help:"Score de confiance de cette boÃ®te, entre 0 et 1"},_:{help:"Autre valeur (ignorÃ©e par CIGALE)"}},ModelDetectionOutputShape=type.or(...entries(MODEL_DETECTION_OUTPUT_SHAPES).map(([d,{help:m}])=>type(`"${d}"`).describe(m,"self"))).array(),HANDLEBARS_HELPERS={suffix:{documentation:"Ajoute un suffixe Ã  un nom de fichier, avant l'extension",usage:"{{ suffix 'filename.jpeg' '_example' }} -> 'filename_example.jpeg'",implementation:(d,m)=>{const[g,w]=splitFilenameOnExtension(d);return`${g}${m}.${w}`}},extension:{documentation:"RÃ©cupÃ¨re lâ€™extension dâ€™un nom de fichier",usage:"{{ extension 'filename.jpeg' }} -> 'jpeg'",implementation:d=>splitFilenameOnExtension(d)[1]},fallback:{documentation:"Fournit une valeur de repli si la premiÃ¨re est indÃ©finie",usage:"{{ fallback obj.does_not_exist 'Unknown' }} -> 'Unknown'",implementation:(d,m)=>d??m}};for(const[d,{implementation:m}]of Object.entries(HANDLEBARS_HELPERS))Handlebars.registerHelper(d,m);const TemplatedString=d=>type.string.pipe(m=>{try{return{source:m,template:Handlebars.compile(m,{noEscape:!0,assumeObjects:!0,knownHelpersOnly:!0,knownHelpers:{suffix:!0,extension:!0,fallback:!0}})}}catch(g){throw new Error(`Invalid template ${safeJSONStringify(m)}: ${g}`)}}).pipe(({source:m,template:g})=>({render(w){return w=d.assert(w),g(w)},toJSON:()=>m})),FilepathTemplate=type.string.pipe(d=>{try{return{source:d,template:Handlebars.compile(d,{noEscape:!0,assumeObjects:!0,knownHelpersOnly:!0,knownHelpers:{suffix:!0,extension:!0,fallback:!0}})}}catch(m){throw new Error(`Invalid template ${safeJSONStringify(d)}: ${m}`)}}).pipe(({source:d,template:m})=>({render(g){return m(g).replaceAll("\\","/")},toJSON:()=>d})),BeamupSettings=type({origin:URLString.describe("URL de l'instance BeamUp d'oÃ¹ proviennent les donnÃ©es")}),Protocol$1=type({id:ID.describe("Identifiant unique pour le protocole. On conseille de mettre une partie qui vous identifie dans cet identifiant, car il doit Ãªtre globalement unique. Par exemple, mon-organisation.mon-protocole"),dirty:type("boolean").describe("Si le protocole a Ã©tÃ© modifiÃ© depuis sa derniÃ¨re exportation").default(!1),metadata:References,name:["string","@","Nom du protocole"],description:["string","@","Description du protocole"],"learnMore?":URLString.describe("Lien vers un site oÃ¹ l'on peut se renseigner sur ce protocole. Cela peut aussi Ãªtre simplement un lien de tÃ©lÃ©chargement direct de ce fichier"),"version?":["number","@","Version actuelle du protocole"],"source?":HTTPRequest.describe(`RequÃªte ou URL devant mener Ã  un fichier JSON contenant la version la plus rÃ©cente du protocole. Permet de proposer des mises Ã  jour.
		
		Si le champ "version" n'existe pas (que ce soit dans le protocole local ou distant), aucune mise Ã  jour ne sera proposÃ©e.`),authors:type({"email?":["string.email","@","Adresse email"],name:["string","@","PrÃ©nom Nom"]}).array().describe("Les auteurices ayant participÃ© Ã  l'Ã©laboration du protocole"),"metadataOrder?":type(ID.array()).describe("L'ordre dans lequel les mÃ©tadonnÃ©es doivent Ãªtre prÃ©sentÃ©es dans l'interface utilisateur. Les mÃ©tadonnÃ©es non listÃ©es ici seront affichÃ©es aprÃ¨s toutes celles listÃ©es ici"),"observations?":{"defaultLabel?":TemplatedString(type({images:Image$2.array(),observation:Observation$1})).describe("Label par dÃ©faut pour les observations. Template Handlebars, recevant une liste des images de l'observation Ã  crÃ©Ã©er (clÃ© images) et l'observation elle-mÃªme (clÃ© observation)")},"beamup?":BeamupSettings,crop:type({metadata:[ID,"@","MÃ©tadonnÃ©e associÃ©e Ã  la boÃ®te englobante"],"confirmationMetadata?":[ID,"@","MÃ©tadonnÃ©e associÃ©e au fait que la boÃ®te englobante a Ã©tÃ© (humainement) confirmÃ©e"],padding:type(/^\d+(%|px)$/).describe("Pixels de marge Ã  rajouter autour de la boÃ®te englobante au moment d'exporter les images recadrÃ©es. Nombre suivi de 'px' pour un nombre de pixels fixe, ou de '%' pour un pourcentage des dimensions de chaque image.").default("0px"),"infer?":type({"name?":["string","@","Nom du rÃ©seau Ã  afficher dans l'interface. ParticuliÃ¨rement utile si il y a plusieurs rÃ©seaux"],model:HTTPRequest.describe("Lien vers le modÃ¨le de dÃ©tection utilisÃ© pour infÃ©rer les boÃ®tes englobantes. Au format ONNX (.onnx) seulement, pour le moment."),input:ModelInput.describe("Configuration de l'entrÃ©e du modÃ¨le"),output:type({"name?":["string","@","Nom de l'output du modÃ¨le Ã  utiliser. output0 par dÃ©faut"],normalized:["boolean","@","Si les coordonnÃ©es des boÃ®tes englobantes sont normalisÃ©es par rapport aux dimensions de l'image"],shape:ModelDetectionOutputShape.describe("Forme de sortie de chaque boÃ®te englobante. NÃ©cÃ©ssite obligatoirement d'avoir 'score'; 2 parmi 'cx', 'sx', 'ex', 'w'; et 2 parmi 'cy', 'sy', 'ey', 'h'. Si les boÃ®tes contiennent d'autre valeurs, bien les mentionner avec '_', mÃªme quand c'est Ã  la fin de la liste: cela permet de savoir quand on passe Ã  la boÃ®te suivante. Par exemple, [cx, cy, w, h, score, _] correspond Ã  un modÃ¨le YOLO11 COCO")}).describe("Forme de la sortie du modÃ¨le de classification. Par exemple, shape: [cx, cy, w, h, score, _] et normalized: true correspond Ã  un modÃ¨le YOLO11 COCO")}).array().describe("Configuration de l'infÃ©rence des boÃ®tes englobantes")}).describe("Configuration de la partie recadrage"),exports:type({images:type({cropped:FilepathTemplate.describe("Chemins des images recadrÃ©es"),original:FilepathTemplate.describe("Chemins des images originales")}).describe(`Chemins oÃ¹ sauvegarder les images. Vous pouvez utiliser {{observation.metadata.identifiant.value}} pour insÃ©rer la valeur d'une mÃ©tadonnÃ©e, {{image.filename}} pour le nom de fichier, {{observation.label}} pour le label (nom) de l'observation, et {{sequence}} pour un numÃ©ro d'image, commenÃ§ant Ã  1. {{observation.metadata.identifiant.valueLabel}} peut Ãªtre pratique pour obtenir le label associÃ© au choix d'une mÃ©tadonnÃ©e de type 'enum'. Enfin, il est possible de faire {{suffix image.filename "_exemple"}} pour ajouter "_exemple" Ã  la fin d'un nom de fichier, mais avant son extension (par exemple: {{suffix image.filename "_cropped"}} donnera "IMG_1245_cropped.JPEG" si l'image avait pour nom de fichier "IMG_12345.JPEG"); Vous pouvez faire {{extension image.filename}} pour avoir l'extension d'un fichier, et {{fallback image.metadata.exemple "(Inconnnu)"}} pour utiliser "(Inconnu)" si image.metadata.example n'existe pas. Ce sont enfait des templates Handlebars, en savoir plus: https://handlebarsjs.com/guide/`),metadata:{json:type.string.describe("Chemin du fichier JSON contenant les rÃ©sultats de l'analyse").pipe(d=>d.replaceAll("\\","/")),csv:type.string.describe("Chemin du fichier CSV contenant les rÃ©sultats de l'analyse").pipe(d=>d.replaceAll("\\","/"))}}).describe("La structure du fichier .zip d'export pour ce protocole.").optional()}),ExportedProtocol=Protocol$1.omit("metadata","dirty").in.and({metadata:{"[string]":Metadata$1.omit("id").describe("MÃ©tadonnÃ©e du protocole")}}).pipe(d=>({...d,metadata:Object.fromEntries(Object.entries(d.metadata).map(([m,g])=>[namespacedMetadataId(d.id,m),g]))}));function generateId(d){return d.slice(0,1).toLowerCase()+Math.random().toString(36).slice(2,9)}const ImageFile=table(["id"],type({id:ID,bytes:"ArrayBuffer",filename:"string",contentType:/\w+\/\w+/,dimensions:Dimensions})),ImagePreviewFile=table(["id"],type({id:ID,bytes:"ArrayBuffer",filename:"string",contentType:/\w+\/\w+/,dimensions:Dimensions})),Image$1=table(["id","addedAt"],Image$2),Observation=table(["id","addedAt"],Observation$1),Metadata=table("id",Metadata$1.omit("options")),MetadataOption=table(["id"],MetadataEnumVariant.and({id:[/\w+:\w+/,"@","ID of the form metadata_id:key"],metadataId:ID})),Protocol=table("id",Protocol$1),Settings=table("id",type({id:'"defaults" | "user"',protocols:References,theme:type.enumerated("dark","light","auto"),gridSize:type.number.pipe(d=>d===10?1:clamp(d,.5,2)),language:type.enumerated("fr","en").default(()=>{try{const d=localStorage.getItem("PARAGLIDE_LOCALE");if(d==="fr"||d==="en")return localStorage.removeItem("PARAGLIDE_LOCALE"),d}catch(d){d instanceof ReferenceError||console.warn("Error migrating from PARAGLIDE_LOCALE ",d)}try{return localeFromNavigator()}catch(d){return console.warn("Error getting navigator.language, defaulting to fr",d),"fr"}}),showInputHints:"boolean",showTechnicalMetadata:"boolean",cropAutoNext:"boolean = false",parallelism:type("number").default(()=>{try{return Math.ceil(navigator.hardwareConcurrency/3)}catch(d){return console.warn("Couldn't get navigator.hardwareConcurrency, defaulting to 1",d),1}}),gallerySort:type({direction:type.enumerated("asc","desc"),key:type.enumerated("filename","date")}).default(()=>({direction:"asc",key:"date"})),beamupPreferences:scope({ID}).type({"[ID]":{enable:"boolean",email:"string.email | null"}}).default(()=>({})),protocolModelSelections:scope({ID}).type({"[ID]":{"[ID]":"number.integer >= -1"}}).default(()=>({}))})),BeamupCorrection=table(["id"],type({id:ID,client:{version:"string"},protocol:Protocol.pick("id","version").and({beamup:BeamupSettings}),metadata:Metadata.pick("id","type"),subject:{"image?":Image$1.pick("id"),"observation?":Observation.pick("id"),contentHash:SHA1Hash.or("null")},"file?":ImageFile.pick("id","filename","contentType","dimensions"),before:MetadataValue,after:MetadataValue,occurredAt:"string.date.iso.parse",email:"string.email | null"})),Schemas={MetadataValues,MetadataValue,Image:Image$1,ModelInput,ModelDetectionOutputShape,Metadata,Protocol,HTTPRequest},NO_REACTIVE_STATE_TABLES=["ImageFile","ImagePreviewFile","MetadataOption","BeamupCorrection"];function isReactiveTable(d){return NO_REACTIVE_STATE_TABLES.every(m=>m!==d)}const Tables={Image:Image$1,ImageFile,ImagePreviewFile,Observation,Metadata,MetadataOption,Protocol,Settings,BeamupCorrection};function table(d,m){const g=Array.isArray(d)?d.map(w=>w):[d];return m.configure({table:{indexes:g}})}const idComparator=(d,m)=>typeof d=="object"&&"id"in d||typeof m=="object"&&"id"in m?idComparator(d.id,m.id):typeof d=="number"&&typeof m=="number"?d-m:typeof d=="number"?-1:typeof m=="number"?1:/^\d+$/.test(d)&&/^\d+$/.test(m)?Number(d)-Number(m):d.localeCompare(m),PROCEDURES={init:{input:type({databaseName:"string",databaseRevision:"number.integer >= 1"}),progress:type("undefined"),success:type("undefined")},loadModel:{input:type({protocolId:"string",request:Schemas.HTTPRequest,"classmapping?":Schemas.HTTPRequest,task:'"classification" | "detection"',"webgpu?":"boolean"}),progress:type("0 <= number <= 1"),success:type("true")},isModelLoaded:{input:type('"classification" | "detection"'),progress:type({}),success:type("boolean")},inferBoundingBoxes:{input:type({fileId:"string",webgpu:"boolean = false",taskSettings:{input:Schemas.ModelInput,output:{"name?":"string",shape:Schemas.ModelDetectionOutputShape}}}),progress:type({}),success:type({boxes:type(["number","number","number","number"]).array(),scores:"number[]"})},classify:{input:type({imageId:"string","webgpu?":"boolean",metadataIds:{cropbox:"string",target:"string"},taskSettings:{input:Schemas.ModelInput,"output?":{name:"string"}},protocol:{id:"string","version?":"number","beamup?":{origin:"string.url"}}}),progress:type({}),success:type({scores:"number[]"})},importProtocol:{input:type({contents:"string",isJSON:"boolean = false"}),progress:type({phase:type.enumerated("parsing","filtering-builtin-metadata","input-validation","write-protocol","write-metadata","write-metadata-options","output-validation"),"detail?":"string"}),success:type({id:"string",name:"string","version?":"number | undefined"})},syncStoredCorrections:{input:type("object"),progress:type("number"),success:type({total:"number",failed:type({why:"string",ids:"string[]"}).array(),succeeded:"number"})},generateResultsZip:{input:type({protocolId:"string",include:type.enumerated("croppedonly","full","metadataonly"),cropPadding:/^\d+(px|%)$/,jsonSchemaURL:"string.url.parse"}),progress:type.or({progress:"number"},{warning:type.or(['"exif-write-error"',{filename:"string"}])}).pipe(d=>"progress"in d?{progress:d.progress,warning:void 0}:{progress:void 0,warning:d.warning}),success:type("ArrayBuffer")},diffProtocolWithRemote:{input:type({protocolId:"string"}),progress:type("0 <= number <= 1"),success:type({dirty:"boolean",changes:type.or({path:"(number|string)[]",type:'"CREATE"',value:"unknown"},{path:"(number|string)[]",type:'"CHANGE"',oldValue:"unknown",value:"unknown"},{path:"(number|string)[]",type:'"REMOVE"',oldValue:"unknown"}).array()})}};let _db,databaseParams;async function openDatabase$1(){if(!databaseParams)throw new Error("Database parameters not set, call swarp.init() first");return _db||(_db=await openDB(databaseParams.name,databaseParams.revision),_db)}const swarp=Server(PROCEDURES);swarp.init(async({databaseName:d,databaseRevision:m})=>{databaseParams={name:d,revision:m}});var ch2={},wk=(function(d,m,g,w,$){var I=new Worker(ch2[m]||(ch2[m]=URL.createObjectURL(new Blob([d+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return I.onmessage=function(D){var F=D.data,U=F.$e$;if(U){var q=new Error(U[0]);q.code=U[1],q.stack=U[2],$(q,null)}else $(null,F)},I.postMessage(g,w),I}),u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(d,m){for(var g=new u16(31),w=0;w<31;++w)g[w]=m+=1<<d[w-1];for(var $=new i32(g[30]),w=1;w<30;++w)for(var I=g[w];I<g[w+1];++I)$[I]=I-g[w]<<5|w;return{b:g,r:$}},_a$1=freb(fleb,2),fl$1=_a$1.b,revfl=_a$1.r;fl$1[28]=258,revfl[258]=28;var _b=freb(fdeb,0),revfd=_b.r,rev=new u16(32768);for(var i$1=0;i$1<32768;++i$1){var x$3=(i$1&43690)>>1|(i$1&21845)<<1;x$3=(x$3&52428)>>2|(x$3&13107)<<2,x$3=(x$3&61680)>>4|(x$3&3855)<<4,rev[i$1]=((x$3&65280)>>8|(x$3&255)<<8)>>1}var hMap=(function(d,m,g){for(var w=d.length,$=0,I=new u16(m);$<w;++$)d[$]&&++I[d[$]-1];var D=new u16(m);for($=1;$<m;++$)D[$]=D[$-1]+I[$-1]<<1;var F;if(g){F=new u16(1<<m);var U=15-m;for($=0;$<w;++$)if(d[$])for(var q=$<<4|d[$],j=m-d[$],G=D[d[$]-1]++<<j,H=G|(1<<j)-1;G<=H;++G)F[rev[G]>>U]=q}else for(F=new u16(w),$=0;$<w;++$)d[$]&&(F[$]=rev[D[d[$]-1]++]>>15-d[$]);return F}),flt=new u8(288);for(var i$1=0;i$1<144;++i$1)flt[i$1]=8;for(var i$1=144;i$1<256;++i$1)flt[i$1]=9;for(var i$1=256;i$1<280;++i$1)flt[i$1]=7;for(var i$1=280;i$1<288;++i$1)flt[i$1]=8;var fdt=new u8(32);for(var i$1=0;i$1<32;++i$1)fdt[i$1]=5;var flm=hMap(flt,9,0),fdm=hMap(fdt,5,0),shft=function(d){return(d+7)/8|0},slc=function(d,m,g){return(m==null||m<0)&&(m=0),(g==null||g>d.length)&&(g=d.length),new u8(d.subarray(m,g))},ec$1=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],err=function(d,m,g){var w=new Error(m||ec$1[d]);if(w.code=d,Error.captureStackTrace&&Error.captureStackTrace(w,err),!g)throw w;return w},wbits=function(d,m,g){g<<=m&7;var w=m/8|0;d[w]|=g,d[w+1]|=g>>8},wbits16=function(d,m,g){g<<=m&7;var w=m/8|0;d[w]|=g,d[w+1]|=g>>8,d[w+2]|=g>>16},hTree=function(d,m){for(var g=[],w=0;w<d.length;++w)d[w]&&g.push({s:w,f:d[w]});var $=g.length,I=g.slice();if(!$)return{t:et$1,l:0};if($==1){var D=new u8(g[0].s+1);return D[g[0].s]=1,{t:D,l:1}}g.sort(function(ne,ce){return ne.f-ce.f}),g.push({s:-1,f:25001});var F=g[0],U=g[1],q=0,j=1,G=2;for(g[0]={s:-1,f:F.f+U.f,l:F,r:U};j!=$-1;)F=g[g[q].f<g[G].f?q++:G++],U=g[q!=j&&g[q].f<g[G].f?q++:G++],g[j++]={s:-1,f:F.f+U.f,l:F,r:U};for(var H=I[0].s,w=1;w<$;++w)I[w].s>H&&(H=I[w].s);var V=new u16(H+1),Z=ln$1(g[j-1],V,0);if(Z>m){var w=0,Q=0,J=Z-m,ie=1<<J;for(I.sort(function(ce,oe){return V[oe.s]-V[ce.s]||ce.f-oe.f});w<$;++w){var re=I[w].s;if(V[re]>m)Q+=ie-(1<<Z-V[re]),V[re]=m;else break}for(Q>>=J;Q>0;){var se=I[w].s;V[se]<m?Q-=1<<m-V[se]++-1:++w}for(;w>=0&&Q;--w){var X=I[w].s;V[X]==m&&(--V[X],++Q)}Z=m}return{t:new u8(V),l:Z}},ln$1=function(d,m,g){return d.s==-1?Math.max(ln$1(d.l,m,g+1),ln$1(d.r,m,g+1)):m[d.s]=g},lc$1=function(d){for(var m=d.length;m&&!d[--m];);for(var g=new u16(++m),w=0,$=d[0],I=1,D=function(U){g[w++]=U},F=1;F<=m;++F)if(d[F]==$&&F!=m)++I;else{if(!$&&I>2){for(;I>138;I-=138)D(32754);I>2&&(D(I>10?I-11<<5|28690:I-3<<5|12305),I=0)}else if(I>3){for(D($),--I;I>6;I-=6)D(8304);I>2&&(D(I-3<<5|8208),I=0)}for(;I--;)D($);I=1,$=d[F]}return{c:g.subarray(0,w),n:m}},clen=function(d,m){for(var g=0,w=0;w<m.length;++w)g+=d[w]*m[w];return g},wfblk=function(d,m,g){var w=g.length,$=shft(m+2);d[$]=w&255,d[$+1]=w>>8,d[$+2]=d[$]^255,d[$+3]=d[$+1]^255;for(var I=0;I<w;++I)d[$+I+4]=g[I];return($+4+w)*8},wblk=function(d,m,g,w,$,I,D,F,U,q,j){wbits(m,j++,g),++$[256];for(var G=hTree($,15),H=G.t,V=G.l,Z=hTree(I,15),Q=Z.t,J=Z.l,ie=lc$1(H),re=ie.c,se=ie.n,X=lc$1(Q),ne=X.c,ce=X.n,oe=new u16(19),de=0;de<re.length;++de)++oe[re[de]&31];for(var de=0;de<ne.length;++de)++oe[ne[de]&31];for(var me=hTree(oe,7),ge=me.t,fe=me.l,xe=19;xe>4&&!ge[clim[xe-1]];--xe);var Fe=q+5<<3,Te=clen($,flt)+clen(I,fdt)+D,Oe=clen($,H)+clen(I,Q)+D+14+3*xe+clen(oe,ge)+2*oe[16]+3*oe[17]+7*oe[18];if(U>=0&&Fe<=Te&&Fe<=Oe)return wfblk(m,j,d.subarray(U,U+q));var Be,_t,Et,dt;if(wbits(m,j,1+(Oe<Te)),j+=2,Oe<Te){Be=hMap(H,V,0),_t=H,Et=hMap(Q,J,0),dt=Q;var Zt=hMap(ge,fe,0);wbits(m,j,se-257),wbits(m,j+5,ce-1),wbits(m,j+10,xe-4),j+=14;for(var de=0;de<xe;++de)wbits(m,j+3*de,ge[clim[de]]);j+=3*xe;for(var Ye=[re,ne],bt=0;bt<2;++bt)for(var Qt=Ye[bt],de=0;de<Qt.length;++de){var Vt=Qt[de]&31;wbits(m,j,Zt[Vt]),j+=ge[Vt],Vt>15&&(wbits(m,j,Qt[de]>>5&127),j+=Qt[de]>>12)}}else Be=flm,_t=flt,Et=fdm,dt=fdt;for(var de=0;de<F;++de){var ut=w[de];if(ut>255){var Vt=ut>>18&31;wbits16(m,j,Be[Vt+257]),j+=_t[Vt+257],Vt>7&&(wbits(m,j,ut>>23&31),j+=fleb[Vt]);var At=ut&31;wbits16(m,j,Et[At]),j+=dt[At],At>3&&(wbits16(m,j,ut>>5&8191),j+=fdeb[At])}else wbits16(m,j,Be[ut]),j+=_t[ut]}return wbits16(m,j,Be[256]),j+_t[256]},deo=new i32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),et$1=new u8(0),dflt=function(d,m,g,w,$,I){var D=I.z||d.length,F=new u8(w+D+5*(1+Math.ceil(D/7e3))+$),U=F.subarray(w,F.length-$),q=I.l,j=(I.r||0)&7;if(m){j&&(U[0]=I.r>>3);for(var G=deo[m-1],H=G>>13,V=G&8191,Z=(1<<g)-1,Q=I.p||new u16(32768),J=I.h||new u16(Z+1),ie=Math.ceil(g/3),re=2*ie,se=function(lt){return(d[lt]^d[lt+1]<<ie^d[lt+2]<<re)&Z},X=new i32(25e3),ne=new u16(288),ce=new u16(32),oe=0,de=0,me=I.i||0,ge=0,fe=I.w||0,xe=0;me+2<D;++me){var Fe=se(me),Te=me&32767,Oe=J[Fe];if(Q[Te]=Oe,J[Fe]=Te,fe<=me){var Be=D-me;if((oe>7e3||ge>24576)&&(Be>423||!q)){j=wblk(d,U,0,X,ne,ce,de,ge,xe,me-xe,j),ge=oe=de=0,xe=me;for(var _t=0;_t<286;++_t)ne[_t]=0;for(var _t=0;_t<30;++_t)ce[_t]=0}var Et=2,dt=0,Zt=V,Ye=Te-Oe&32767;if(Be>2&&Fe==se(me-Ye))for(var bt=Math.min(H,Be)-1,Qt=Math.min(32767,me),Vt=Math.min(258,Be);Ye<=Qt&&--Zt&&Te!=Oe;){if(d[me+Et]==d[me+Et-Ye]){for(var ut=0;ut<Vt&&d[me+ut]==d[me+ut-Ye];++ut);if(ut>Et){if(Et=ut,dt=Ye,ut>bt)break;for(var At=Math.min(Ye,ut-2),dr=0,_t=0;_t<At;++_t){var fr=me-Ye+_t&32767,pr=Q[fr],zt=fr-pr&32767;zt>dr&&(dr=zt,Oe=fr)}}}Te=Oe,Oe=Q[Te],Ye+=Te-Oe&32767}if(dt){X[ge++]=268435456|revfl[Et]<<18|revfd[dt];var Ce=revfl[Et]&31,Nt=revfd[dt]&31;de+=fleb[Ce]+fdeb[Nt],++ne[257+Ce],++ce[Nt],fe=me+Et,++oe}else X[ge++]=d[me],++ne[d[me]]}}for(me=Math.max(me,fe);me<D;++me)X[ge++]=d[me],++ne[d[me]];j=wblk(d,U,q,X,ne,ce,de,ge,xe,me-xe,j),q||(I.r=j&7|U[j/8|0]<<3,j-=7,I.h=J,I.p=Q,I.i=me,I.w=fe)}else{for(var me=I.w||0;me<D+q;me+=65535){var Xe=me+65535;Xe>=D&&(U[j/8|0]=q,Xe=D),j=wfblk(U,j+1,d.subarray(me,Xe))}I.i=D}return slc(F,0,w+shft(j)+$)},crct=(function(){for(var d=new Int32Array(256),m=0;m<256;++m){for(var g=m,w=9;--w;)g=(g&1&&-306674912)^g>>>1;d[m]=g}return d})(),crc=function(){var d=-1;return{p:function(m){for(var g=d,w=0;w<m.length;++w)g=crct[g&255^m[w]]^g>>>8;d=g},d:function(){return~d}}},dopt=function(d,m,g,w,$){if(!$&&($={l:1},m.dictionary)){var I=m.dictionary.subarray(-32768),D=new u8(I.length+d.length);D.set(I),D.set(d,I.length),d=D,$.w=I.length}return dflt(d,m.level==null?6:m.level,m.mem==null?$.l?Math.ceil(Math.max(8,Math.min(13,Math.log(d.length)))*1.5):20:12+m.mem,g,w,$)},mrg=function(d,m){var g={};for(var w in d)g[w]=d[w];for(var w in m)g[w]=m[w];return g},wcln=function(d,m,g){for(var w=d(),$=d.toString(),I=$.slice($.indexOf("[")+1,$.lastIndexOf("]")).replace(/\s+/g,"").split(","),D=0;D<w.length;++D){var F=w[D],U=I[D];if(typeof F=="function"){m+=";"+U+"=";var q=F.toString();if(F.prototype)if(q.indexOf("[native code]")!=-1){var j=q.indexOf(" ",8)+1;m+=q.slice(j,q.indexOf("(",j))}else{m+=q;for(var G in F.prototype)m+=";"+U+".prototype."+G+"="+F.prototype[G].toString()}else m+=q}else g[U]=F}return m},ch$1=[],cbfs=function(d){var m=[];for(var g in d)d[g].buffer&&m.push((d[g]=new d[g].constructor(d[g])).buffer);return m},wrkr=function(d,m,g,w){if(!ch$1[g]){for(var $="",I={},D=d.length-1,F=0;F<D;++F)$=wcln(d[F],$,I);ch$1[g]={c:wcln(d[D],$,I),e:I}}var U=mrg({},ch$1[g].e);return wk(ch$1[g].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+m.toString()+"}",g,U,cbfs(U),w)},bDflt=function(){return[u8,u16,i32,fleb,fdeb,clim,revfl,revfd,flm,flt,fdm,fdt,rev,deo,et$1,hMap,wbits,wbits16,hTree,ln$1,lc$1,clen,wfblk,wblk,shft,slc,dflt,dopt,deflateSync,pbf]},pbf=function(d){return postMessage(d,[d.buffer])},cbify=function(d,m,g,w,$,I){var D=wrkr(g,w,$,function(F,U){D.terminate(),I(F,U)});return D.postMessage([d,m],m.consume?[d.buffer]:[]),function(){D.terminate()}},wbytes=function(d,m,g){for(;g;++m)d[m]=g,g>>>=8};function deflate$2(d,m,g){return g||(g=m,m={}),typeof g!="function"&&err(7),cbify(d,m,[bDflt],function(w){return pbf(deflateSync(w.data[0],w.data[1]))},0,g)}function deflateSync(d,m){return dopt(d,m||{},0,0)}var fltn=function(d,m,g,w){for(var $ in d){var I=d[$],D=m+$,F=w;Array.isArray(I)&&(F=mrg(w,I[1]),I=I[0]),I instanceof u8?g[D]=[I,F]:(g[D+="/"]=[new u8(0),F],fltn(I,D,g,w))}},te$1=typeof TextEncoder<"u"&&new TextEncoder,td$1=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td$1.decode(et$1,{stream:!0}),tds=1}catch{}function strToU8(d,m){var g;if(te$1)return te$1.encode(d);for(var w=d.length,$=new u8(d.length+(d.length>>1)),I=0,D=function(q){$[I++]=q},g=0;g<w;++g){if(I+5>$.length){var F=new u8(I+8+(w-g<<1));F.set($),$=F}var U=d.charCodeAt(g);U<128||m?D(U):U<2048?(D(192|U>>6),D(128|U&63)):U>55295&&U<57344?(U=65536+(U&1047552)|d.charCodeAt(++g)&1023,D(240|U>>18),D(128|U>>12&63),D(128|U>>6&63),D(128|U&63)):(D(224|U>>12),D(128|U>>6&63),D(128|U&63))}return slc($,0,I)}var exfl=function(d){var m=0;if(d)for(var g in d){var w=d[g].length;w>65535&&err(9),m+=w+4}return m},wzh=function(d,m,g,w,$,I,D,F){var U=w.length,q=g.extra,j=F&&F.length,G=exfl(q);wbytes(d,m,D!=null?33639248:67324752),m+=4,D!=null&&(d[m++]=20,d[m++]=g.os),d[m]=20,m+=2,d[m++]=g.flag<<1|(I<0&&8),d[m++]=$&&8,d[m++]=g.compression&255,d[m++]=g.compression>>8;var H=new Date(g.mtime==null?Date.now():g.mtime),V=H.getFullYear()-1980;if((V<0||V>119)&&err(10),wbytes(d,m,V<<25|H.getMonth()+1<<21|H.getDate()<<16|H.getHours()<<11|H.getMinutes()<<5|H.getSeconds()>>1),m+=4,I!=-1&&(wbytes(d,m,g.crc),wbytes(d,m+4,I<0?-I-2:I),wbytes(d,m+8,g.size)),wbytes(d,m+12,U),wbytes(d,m+14,G),m+=16,D!=null&&(wbytes(d,m,j),wbytes(d,m+6,g.attrs),wbytes(d,m+10,D),m+=14),d.set(w,m),m+=U,G)for(var Z in q){var Q=q[Z],J=Q.length;wbytes(d,m,+Z),wbytes(d,m+2,J),d.set(Q,m+4),m+=4+J}return j&&(d.set(F,m),m+=j),m},wzf=function(d,m,g,w,$){wbytes(d,m,101010256),wbytes(d,m+8,g),wbytes(d,m+10,g),wbytes(d,m+12,w),wbytes(d,m+16,$)};function zip(d,m,g){g||(g=m,m={}),typeof g!="function"&&err(7);var w={};fltn(d,"",w,m);var $=Object.keys(w),I=$.length,D=0,F=0,U=I,q=new Array(I),j=[],G=function(){for(var J=0;J<j.length;++J)j[J]()},H=function(J,ie){mt(function(){g(J,ie)})};mt(function(){H=g});var V=function(){var J=new u8(F+22),ie=D,re=F-D;F=0;for(var se=0;se<U;++se){var X=q[se];try{var ne=X.c.length;wzh(J,F,X,X.f,X.u,ne);var ce=30+X.f.length+exfl(X.extra),oe=F+ce;J.set(X.c,oe),wzh(J,D,X,X.f,X.u,ne,F,X.m),D+=16+ce+(X.m?X.m.length:0),F=oe+ne}catch(de){return H(de,null)}}wzf(J,D,q.length,re,ie),H(null,J)};I||V();for(var Z=function(J){var ie=$[J],re=w[ie],se=re[0],X=re[1],ne=crc(),ce=se.length;ne.p(se);var oe=strToU8(ie),de=oe.length,me=X.comment,ge=me&&strToU8(me),fe=ge&&ge.length,xe=exfl(X.extra),Fe=X.level==0?0:8,Te=function(Oe,Be){if(Oe)G(),H(Oe,null);else{var _t=Be.length;q[J]=mrg(X,{size:ce,crc:ne.d(),c:Be,f:oe,m:ge,u:de!=ie.length||ge&&me.length!=fe,compression:Fe}),D+=30+de+xe+_t,F+=76+2*(de+xe)+(fe||0)+_t,--I||V()}};if(de>65535&&Te(err(11,0,1),null),!Fe)Te(null,se);else if(ce<16e4)try{Te(null,deflateSync(se,X))}catch(Oe){Te(Oe,null)}else j.push(deflate$2(se,X,Te))},Q=0;Q<U;++Q)Z(Q);return G}var mt=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(d){d()};const ALIAS=Symbol.for("yaml.alias"),DOC=Symbol.for("yaml.document"),MAP=Symbol.for("yaml.map"),PAIR=Symbol.for("yaml.pair"),SCALAR$1=Symbol.for("yaml.scalar"),SEQ=Symbol.for("yaml.seq"),NODE_TYPE=Symbol.for("yaml.node.type"),isAlias=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===ALIAS,isDocument=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===DOC,isMap=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===MAP,isPair=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===PAIR,isScalar$1=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===SCALAR$1,isSeq=d=>!!d&&typeof d=="object"&&d[NODE_TYPE]===SEQ;function isCollection$1(d){if(d&&typeof d=="object")switch(d[NODE_TYPE]){case MAP:case SEQ:return!0}return!1}function isNode(d){if(d&&typeof d=="object")switch(d[NODE_TYPE]){case ALIAS:case MAP:case SCALAR$1:case SEQ:return!0}return!1}const hasAnchor=d=>(isScalar$1(d)||isCollection$1(d))&&!!d.anchor,BREAK$1=Symbol("break visit"),SKIP$1=Symbol("skip children"),REMOVE$1=Symbol("remove node");function visit$3(d,m){const g=initVisitor(m);isDocument(d)?visit_(null,d.contents,g,Object.freeze([d]))===REMOVE$1&&(d.contents=null):visit_(null,d,g,Object.freeze([]))}visit$3.BREAK=BREAK$1;visit$3.SKIP=SKIP$1;visit$3.REMOVE=REMOVE$1;function visit_(d,m,g,w){const $=callVisitor(d,m,g,w);if(isNode($)||isPair($))return replaceNode(d,w,$),visit_(d,$,g,w);if(typeof $!="symbol"){if(isCollection$1(m)){w=Object.freeze(w.concat(m));for(let I=0;I<m.items.length;++I){const D=visit_(I,m.items[I],g,w);if(typeof D=="number")I=D-1;else{if(D===BREAK$1)return BREAK$1;D===REMOVE$1&&(m.items.splice(I,1),I-=1)}}}else if(isPair(m)){w=Object.freeze(w.concat(m));const I=visit_("key",m.key,g,w);if(I===BREAK$1)return BREAK$1;I===REMOVE$1&&(m.key=null);const D=visit_("value",m.value,g,w);if(D===BREAK$1)return BREAK$1;D===REMOVE$1&&(m.value=null)}}return $}async function visitAsync(d,m){const g=initVisitor(m);isDocument(d)?await visitAsync_(null,d.contents,g,Object.freeze([d]))===REMOVE$1&&(d.contents=null):await visitAsync_(null,d,g,Object.freeze([]))}visitAsync.BREAK=BREAK$1;visitAsync.SKIP=SKIP$1;visitAsync.REMOVE=REMOVE$1;async function visitAsync_(d,m,g,w){const $=await callVisitor(d,m,g,w);if(isNode($)||isPair($))return replaceNode(d,w,$),visitAsync_(d,$,g,w);if(typeof $!="symbol"){if(isCollection$1(m)){w=Object.freeze(w.concat(m));for(let I=0;I<m.items.length;++I){const D=await visitAsync_(I,m.items[I],g,w);if(typeof D=="number")I=D-1;else{if(D===BREAK$1)return BREAK$1;D===REMOVE$1&&(m.items.splice(I,1),I-=1)}}}else if(isPair(m)){w=Object.freeze(w.concat(m));const I=await visitAsync_("key",m.key,g,w);if(I===BREAK$1)return BREAK$1;I===REMOVE$1&&(m.key=null);const D=await visitAsync_("value",m.value,g,w);if(D===BREAK$1)return BREAK$1;D===REMOVE$1&&(m.value=null)}}return $}function initVisitor(d){return typeof d=="object"&&(d.Collection||d.Node||d.Value)?Object.assign({Alias:d.Node,Map:d.Node,Scalar:d.Node,Seq:d.Node},d.Value&&{Map:d.Value,Scalar:d.Value,Seq:d.Value},d.Collection&&{Map:d.Collection,Seq:d.Collection},d):d}function callVisitor(d,m,g,w){if(typeof g=="function")return g(d,m,w);if(isMap(m))return g.Map?.(d,m,w);if(isSeq(m))return g.Seq?.(d,m,w);if(isPair(m))return g.Pair?.(d,m,w);if(isScalar$1(m))return g.Scalar?.(d,m,w);if(isAlias(m))return g.Alias?.(d,m,w)}function replaceNode(d,m,g){const w=m[m.length-1];if(isCollection$1(w))w.items[d]=g;else if(isPair(w))d==="key"?w.key=g:w.value=g;else if(isDocument(w))w.contents=g;else{const $=isAlias(w)?"alias":"scalar";throw new Error(`Cannot replace node with ${$} parent`)}}const escapeChars={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},escapeTagName=d=>d.replace(/[!,[\]{}]/g,m=>escapeChars[m]);class Directives{constructor(m,g){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},Directives.defaultYaml,m),this.tags=Object.assign({},Directives.defaultTags,g)}clone(){const m=new Directives(this.yaml,this.tags);return m.docStart=this.docStart,m}atDocument(){const m=new Directives(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:Directives.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},Directives.defaultTags);break}return m}add(m,g){this.atNextDocument&&(this.yaml={explicit:Directives.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},Directives.defaultTags),this.atNextDocument=!1);const w=m.trim().split(/[ \t]+/),$=w.shift();switch($){case"%TAG":{if(w.length!==2&&(g(0,"%TAG directive should contain exactly two parts"),w.length<2))return!1;const[I,D]=w;return this.tags[I]=D,!0}case"%YAML":{if(this.yaml.explicit=!0,w.length!==1)return g(0,"%YAML directive should contain exactly one part"),!1;const[I]=w;if(I==="1.1"||I==="1.2")return this.yaml.version=I,!0;{const D=/^\d+\.\d+$/.test(I);return g(6,`Unsupported YAML version ${I}`,D),!1}}default:return g(0,`Unknown directive ${$}`,!0),!1}}tagName(m,g){if(m==="!")return"!";if(m[0]!=="!")return g(`Not a valid tag: ${m}`),null;if(m[1]==="<"){const D=m.slice(2,-1);return D==="!"||D==="!!"?(g(`Verbatim tags aren't resolved, so ${m} is invalid.`),null):(m[m.length-1]!==">"&&g("Verbatim tags must end with a >"),D)}const[,w,$]=m.match(/^(.*!)([^!]*)$/s);$||g(`The ${m} tag has no suffix`);const I=this.tags[w];if(I)try{return I+decodeURIComponent($)}catch(D){return g(String(D)),null}return w==="!"?m:(g(`Could not resolve tag: ${m}`),null)}tagString(m){for(const[g,w]of Object.entries(this.tags))if(m.startsWith(w))return g+escapeTagName(m.substring(w.length));return m[0]==="!"?m:`!<${m}>`}toString(m){const g=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],w=Object.entries(this.tags);let $;if(m&&w.length>0&&isNode(m.contents)){const I={};visit$3(m.contents,(D,F)=>{isNode(F)&&F.tag&&(I[F.tag]=!0)}),$=Object.keys(I)}else $=[];for(const[I,D]of w)I==="!!"&&D==="tag:yaml.org,2002:"||(!m||$.some(F=>F.startsWith(D)))&&g.push(`%TAG ${I} ${D}`);return g.join(`
`)}}Directives.defaultYaml={explicit:!1,version:"1.2"};Directives.defaultTags={"!!":"tag:yaml.org,2002:"};function anchorIsValid(d){if(/[\x00-\x19\s,[\]{}]/.test(d)){const g=`Anchor must not contain whitespace or control characters: ${JSON.stringify(d)}`;throw new Error(g)}return!0}function anchorNames(d){const m=new Set;return visit$3(d,{Value(g,w){w.anchor&&m.add(w.anchor)}}),m}function findNewAnchor(d,m){for(let g=1;;++g){const w=`${d}${g}`;if(!m.has(w))return w}}function createNodeAnchors(d,m){const g=[],w=new Map;let $=null;return{onAnchor:I=>{g.push(I),$??($=anchorNames(d));const D=findNewAnchor(m,$);return $.add(D),D},setAnchors:()=>{for(const I of g){const D=w.get(I);if(typeof D=="object"&&D.anchor&&(isScalar$1(D.node)||isCollection$1(D.node)))D.node.anchor=D.anchor;else{const F=new Error("Failed to resolve repeated object (this should not happen)");throw F.source=I,F}}},sourceObjects:w}}function applyReviver(d,m,g,w){if(w&&typeof w=="object")if(Array.isArray(w))for(let $=0,I=w.length;$<I;++$){const D=w[$],F=applyReviver(d,w,String($),D);F===void 0?delete w[$]:F!==D&&(w[$]=F)}else if(w instanceof Map)for(const $ of Array.from(w.keys())){const I=w.get($),D=applyReviver(d,w,$,I);D===void 0?w.delete($):D!==I&&w.set($,D)}else if(w instanceof Set)for(const $ of Array.from(w)){const I=applyReviver(d,w,$,$);I===void 0?w.delete($):I!==$&&(w.delete($),w.add(I))}else for(const[$,I]of Object.entries(w)){const D=applyReviver(d,w,$,I);D===void 0?delete w[$]:D!==I&&(w[$]=D)}return d.call(m,g,w)}function toJS(d,m,g){if(Array.isArray(d))return d.map((w,$)=>toJS(w,String($),g));if(d&&typeof d.toJSON=="function"){if(!g||!hasAnchor(d))return d.toJSON(m,g);const w={aliasCount:0,count:1,res:void 0};g.anchors.set(d,w),g.onCreate=I=>{w.res=I,delete g.onCreate};const $=d.toJSON(m,g);return g.onCreate&&g.onCreate($),$}return typeof d=="bigint"&&!g?.keep?Number(d):d}class NodeBase{constructor(m){Object.defineProperty(this,NODE_TYPE,{value:m})}clone(){const m=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(m.range=this.range.slice()),m}toJS(m,{mapAsMap:g,maxAliasCount:w,onAnchor:$,reviver:I}={}){if(!isDocument(m))throw new TypeError("A document argument is required");const D={anchors:new Map,doc:m,keep:!0,mapAsMap:g===!0,mapKeyWarned:!1,maxAliasCount:typeof w=="number"?w:100},F=toJS(this,"",D);if(typeof $=="function")for(const{count:U,res:q}of D.anchors.values())$(q,U);return typeof I=="function"?applyReviver(I,{"":F},"",F):F}}class Alias extends NodeBase{constructor(m){super(ALIAS),this.source=m,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(m,g){let w;g?.aliasResolveCache?w=g.aliasResolveCache:(w=[],visit$3(m,{Node:(I,D)=>{(isAlias(D)||hasAnchor(D))&&w.push(D)}}),g&&(g.aliasResolveCache=w));let $;for(const I of w){if(I===this)break;I.anchor===this.source&&($=I)}return $}toJSON(m,g){if(!g)return{source:this.source};const{anchors:w,doc:$,maxAliasCount:I}=g,D=this.resolve($,g);if(!D){const U=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(U)}let F=w.get(D);if(F||(toJS(D,null,g),F=w.get(D)),!F||F.res===void 0){const U="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(U)}if(I>=0&&(F.count+=1,F.aliasCount===0&&(F.aliasCount=getAliasCount($,D,w)),F.count*F.aliasCount>I)){const U="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(U)}return F.res}toString(m,g,w){const $=`*${this.source}`;if(m){if(anchorIsValid(this.source),m.options.verifyAliasOrder&&!m.anchors.has(this.source)){const I=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(I)}if(m.implicitKey)return`${$} `}return $}}function getAliasCount(d,m,g){if(isAlias(m)){const w=m.resolve(d),$=g&&w&&g.get(w);return $?$.count*$.aliasCount:0}else if(isCollection$1(m)){let w=0;for(const $ of m.items){const I=getAliasCount(d,$,g);I>w&&(w=I)}return w}else if(isPair(m)){const w=getAliasCount(d,m.key,g),$=getAliasCount(d,m.value,g);return Math.max(w,$)}return 1}const isScalarValue=d=>!d||typeof d!="function"&&typeof d!="object";class Scalar extends NodeBase{constructor(m){super(SCALAR$1),this.value=m}toJSON(m,g){return g?.keep?this.value:toJS(this.value,m,g)}toString(){return String(this.value)}}Scalar.BLOCK_FOLDED="BLOCK_FOLDED";Scalar.BLOCK_LITERAL="BLOCK_LITERAL";Scalar.PLAIN="PLAIN";Scalar.QUOTE_DOUBLE="QUOTE_DOUBLE";Scalar.QUOTE_SINGLE="QUOTE_SINGLE";const defaultTagPrefix="tag:yaml.org,2002:";function findTagObject(d,m,g){if(m){const w=g.filter(I=>I.tag===m),$=w.find(I=>!I.format)??w[0];if(!$)throw new Error(`Tag ${m} not found`);return $}return g.find(w=>w.identify?.(d)&&!w.format)}function createNode(d,m,g){if(isDocument(d)&&(d=d.contents),isNode(d))return d;if(isPair(d)){const G=g.schema[MAP].createNode?.(g.schema,null,g);return G.items.push(d),G}(d instanceof String||d instanceof Number||d instanceof Boolean||typeof BigInt<"u"&&d instanceof BigInt)&&(d=d.valueOf());const{aliasDuplicateObjects:w,onAnchor:$,onTagObj:I,schema:D,sourceObjects:F}=g;let U;if(w&&d&&typeof d=="object"){if(U=F.get(d),U)return U.anchor??(U.anchor=$(d)),new Alias(U.anchor);U={anchor:null,node:null},F.set(d,U)}m?.startsWith("!!")&&(m=defaultTagPrefix+m.slice(2));let q=findTagObject(d,m,D.tags);if(!q){if(d&&typeof d.toJSON=="function"&&(d=d.toJSON()),!d||typeof d!="object"){const G=new Scalar(d);return U&&(U.node=G),G}q=d instanceof Map?D[MAP]:Symbol.iterator in Object(d)?D[SEQ]:D[MAP]}I&&(I(q),delete g.onTagObj);const j=q?.createNode?q.createNode(g.schema,d,g):typeof q?.nodeClass?.from=="function"?q.nodeClass.from(g.schema,d,g):new Scalar(d);return m?j.tag=m:q.default||(j.tag=q.tag),U&&(U.node=j),j}function collectionFromPath(d,m,g){let w=g;for(let $=m.length-1;$>=0;--$){const I=m[$];if(typeof I=="number"&&Number.isInteger(I)&&I>=0){const D=[];D[I]=w,w=D}else w=new Map([[I,w]])}return createNode(w,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:d,sourceObjects:new Map})}const isEmptyPath=d=>d==null||typeof d=="object"&&!!d[Symbol.iterator]().next().done;class Collection extends NodeBase{constructor(m,g){super(m),Object.defineProperty(this,"schema",{value:g,configurable:!0,enumerable:!1,writable:!0})}clone(m){const g=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return m&&(g.schema=m),g.items=g.items.map(w=>isNode(w)||isPair(w)?w.clone(m):w),this.range&&(g.range=this.range.slice()),g}addIn(m,g){if(isEmptyPath(m))this.add(g);else{const[w,...$]=m,I=this.get(w,!0);if(isCollection$1(I))I.addIn($,g);else if(I===void 0&&this.schema)this.set(w,collectionFromPath(this.schema,$,g));else throw new Error(`Expected YAML collection at ${w}. Remaining path: ${$}`)}}deleteIn(m){const[g,...w]=m;if(w.length===0)return this.delete(g);const $=this.get(g,!0);if(isCollection$1($))return $.deleteIn(w);throw new Error(`Expected YAML collection at ${g}. Remaining path: ${w}`)}getIn(m,g){const[w,...$]=m,I=this.get(w,!0);return $.length===0?!g&&isScalar$1(I)?I.value:I:isCollection$1(I)?I.getIn($,g):void 0}hasAllNullValues(m){return this.items.every(g=>{if(!isPair(g))return!1;const w=g.value;return w==null||m&&isScalar$1(w)&&w.value==null&&!w.commentBefore&&!w.comment&&!w.tag})}hasIn(m){const[g,...w]=m;if(w.length===0)return this.has(g);const $=this.get(g,!0);return isCollection$1($)?$.hasIn(w):!1}setIn(m,g){const[w,...$]=m;if($.length===0)this.set(w,g);else{const I=this.get(w,!0);if(isCollection$1(I))I.setIn($,g);else if(I===void 0&&this.schema)this.set(w,collectionFromPath(this.schema,$,g));else throw new Error(`Expected YAML collection at ${w}. Remaining path: ${$}`)}}}const stringifyComment=d=>d.replace(/^(?!$)(?: $)?/gm,"#");function indentComment(d,m){return/^\n+$/.test(d)?d.substring(1):m?d.replace(/^(?! *$)/gm,m):d}const lineComment=(d,m,g)=>d.endsWith(`
`)?indentComment(g,m):g.includes(`
`)?`
`+indentComment(g,m):(d.endsWith(" ")?"":" ")+g,FOLD_FLOW="flow",FOLD_BLOCK="block",FOLD_QUOTED="quoted";function foldFlowLines(d,m,g="flow",{indentAtStart:w,lineWidth:$=80,minContentWidth:I=20,onFold:D,onOverflow:F}={}){if(!$||$<0)return d;$<I&&(I=0);const U=Math.max(1+I,1+$-m.length);if(d.length<=U)return d;const q=[],j={};let G=$-m.length;typeof w=="number"&&(w>$-Math.max(2,I)?q.push(0):G=$-w);let H,V,Z=!1,Q=-1,J=-1,ie=-1;g===FOLD_BLOCK&&(Q=consumeMoreIndentedLines(d,Q,m.length),Q!==-1&&(G=Q+U));for(let se;se=d[Q+=1];){if(g===FOLD_QUOTED&&se==="\\"){switch(J=Q,d[Q+1]){case"x":Q+=3;break;case"u":Q+=5;break;case"U":Q+=9;break;default:Q+=1}ie=Q}if(se===`
`)g===FOLD_BLOCK&&(Q=consumeMoreIndentedLines(d,Q,m.length)),G=Q+m.length+U,H=void 0;else{if(se===" "&&V&&V!==" "&&V!==`
`&&V!=="	"){const X=d[Q+1];X&&X!==" "&&X!==`
`&&X!=="	"&&(H=Q)}if(Q>=G)if(H)q.push(H),G=H+U,H=void 0;else if(g===FOLD_QUOTED){for(;V===" "||V==="	";)V=se,se=d[Q+=1],Z=!0;const X=Q>ie+1?Q-2:J-1;if(j[X])return d;q.push(X),j[X]=!0,G=X+U,H=void 0}else Z=!0}V=se}if(Z&&F&&F(),q.length===0)return d;D&&D();let re=d.slice(0,q[0]);for(let se=0;se<q.length;++se){const X=q[se],ne=q[se+1]||d.length;X===0?re=`
${m}${d.slice(0,ne)}`:(g===FOLD_QUOTED&&j[X]&&(re+=`${d[X]}\\`),re+=`
${m}${d.slice(X+1,ne)}`)}return re}function consumeMoreIndentedLines(d,m,g){let w=m,$=m+1,I=d[$];for(;I===" "||I==="	";)if(m<$+g)I=d[++m];else{do I=d[++m];while(I&&I!==`
`);w=m,$=m+1,I=d[$]}return w}const getFoldOptions=(d,m)=>({indentAtStart:m?d.indent.length:d.indentAtStart,lineWidth:d.options.lineWidth,minContentWidth:d.options.minContentWidth}),containsDocumentMarker=d=>/^(%|---|\.\.\.)/m.test(d);function lineLengthOverLimit(d,m,g){if(!m||m<0)return!1;const w=m-g,$=d.length;if($<=w)return!1;for(let I=0,D=0;I<$;++I)if(d[I]===`
`){if(I-D>w)return!0;if(D=I+1,$-D<=w)return!1}return!0}function doubleQuotedString(d,m){const g=JSON.stringify(d);if(m.options.doubleQuotedAsJSON)return g;const{implicitKey:w}=m,$=m.options.doubleQuotedMinMultiLineLength,I=m.indent||(containsDocumentMarker(d)?"  ":"");let D="",F=0;for(let U=0,q=g[U];q;q=g[++U])if(q===" "&&g[U+1]==="\\"&&g[U+2]==="n"&&(D+=g.slice(F,U)+"\\ ",U+=1,F=U,q="\\"),q==="\\")switch(g[U+1]){case"u":{D+=g.slice(F,U);const j=g.substr(U+2,4);switch(j){case"0000":D+="\\0";break;case"0007":D+="\\a";break;case"000b":D+="\\v";break;case"001b":D+="\\e";break;case"0085":D+="\\N";break;case"00a0":D+="\\_";break;case"2028":D+="\\L";break;case"2029":D+="\\P";break;default:j.substr(0,2)==="00"?D+="\\x"+j.substr(2):D+=g.substr(U,6)}U+=5,F=U+1}break;case"n":if(w||g[U+2]==='"'||g.length<$)U+=1;else{for(D+=g.slice(F,U)+`

`;g[U+2]==="\\"&&g[U+3]==="n"&&g[U+4]!=='"';)D+=`
`,U+=2;D+=I,g[U+2]===" "&&(D+="\\"),U+=1,F=U+1}break;default:U+=1}return D=F?D+g.slice(F):g,w?D:foldFlowLines(D,I,FOLD_QUOTED,getFoldOptions(m,!1))}function singleQuotedString(d,m){if(m.options.singleQuote===!1||m.implicitKey&&d.includes(`
`)||/[ \t]\n|\n[ \t]/.test(d))return doubleQuotedString(d,m);const g=m.indent||(containsDocumentMarker(d)?"  ":""),w="'"+d.replace(/'/g,"''").replace(/\n+/g,`$&
${g}`)+"'";return m.implicitKey?w:foldFlowLines(w,g,FOLD_FLOW,getFoldOptions(m,!1))}function quotedString(d,m){const{singleQuote:g}=m.options;let w;if(g===!1)w=doubleQuotedString;else{const $=d.includes('"'),I=d.includes("'");$&&!I?w=singleQuotedString:I&&!$?w=doubleQuotedString:w=g?singleQuotedString:doubleQuotedString}return w(d,m)}let blockEndNewlines;try{blockEndNewlines=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{blockEndNewlines=/\n+(?!\n|$)/g}function blockString({comment:d,type:m,value:g},w,$,I){const{blockQuote:D,commentString:F,lineWidth:U}=w.options;if(!D||/\n[\t ]+$/.test(g))return quotedString(g,w);const q=w.indent||(w.forceBlockIndent||containsDocumentMarker(g)?"  ":""),j=D==="literal"?!0:D==="folded"||m===Scalar.BLOCK_FOLDED?!1:m===Scalar.BLOCK_LITERAL?!0:!lineLengthOverLimit(g,U,q.length);if(!g)return j?`|
`:`>
`;let G,H;for(H=g.length;H>0;--H){const ne=g[H-1];if(ne!==`
`&&ne!=="	"&&ne!==" ")break}let V=g.substring(H);const Z=V.indexOf(`
`);Z===-1?G="-":g===V||Z!==V.length-1?(G="+",I&&I()):G="",V&&(g=g.slice(0,-V.length),V[V.length-1]===`
`&&(V=V.slice(0,-1)),V=V.replace(blockEndNewlines,`$&${q}`));let Q=!1,J,ie=-1;for(J=0;J<g.length;++J){const ne=g[J];if(ne===" ")Q=!0;else if(ne===`
`)ie=J;else break}let re=g.substring(0,ie<J?ie+1:J);re&&(g=g.substring(re.length),re=re.replace(/\n+/g,`$&${q}`));let X=(Q?q?"2":"1":"")+G;if(d&&(X+=" "+F(d.replace(/ ?[\r\n]+/g," ")),$&&$()),!j){const ne=g.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${q}`);let ce=!1;const oe=getFoldOptions(w,!0);D!=="folded"&&m!==Scalar.BLOCK_FOLDED&&(oe.onOverflow=()=>{ce=!0});const de=foldFlowLines(`${re}${ne}${V}`,q,FOLD_BLOCK,oe);if(!ce)return`>${X}
${q}${de}`}return g=g.replace(/\n+/g,`$&${q}`),`|${X}
${q}${re}${g}${V}`}function plainString(d,m,g,w){const{type:$,value:I}=d,{actualString:D,implicitKey:F,indent:U,indentStep:q,inFlow:j}=m;if(F&&I.includes(`
`)||j&&/[[\]{},]/.test(I))return quotedString(I,m);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(I))return F||j||!I.includes(`
`)?quotedString(I,m):blockString(d,m,g,w);if(!F&&!j&&$!==Scalar.PLAIN&&I.includes(`
`))return blockString(d,m,g,w);if(containsDocumentMarker(I)){if(U==="")return m.forceBlockIndent=!0,blockString(d,m,g,w);if(F&&U===q)return quotedString(I,m)}const G=I.replace(/\n+/g,`$&
${U}`);if(D){const H=Q=>Q.default&&Q.tag!=="tag:yaml.org,2002:str"&&Q.test?.test(G),{compat:V,tags:Z}=m.doc.schema;if(Z.some(H)||V?.some(H))return quotedString(I,m)}return F?G:foldFlowLines(G,U,FOLD_FLOW,getFoldOptions(m,!1))}function stringifyString(d,m,g,w){const{implicitKey:$,inFlow:I}=m,D=typeof d.value=="string"?d:Object.assign({},d,{value:String(d.value)});let{type:F}=d;F!==Scalar.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(D.value)&&(F=Scalar.QUOTE_DOUBLE);const U=j=>{switch(j){case Scalar.BLOCK_FOLDED:case Scalar.BLOCK_LITERAL:return $||I?quotedString(D.value,m):blockString(D,m,g,w);case Scalar.QUOTE_DOUBLE:return doubleQuotedString(D.value,m);case Scalar.QUOTE_SINGLE:return singleQuotedString(D.value,m);case Scalar.PLAIN:return plainString(D,m,g,w);default:return null}};let q=U(F);if(q===null){const{defaultKeyType:j,defaultStringType:G}=m.options,H=$&&j||G;if(q=U(H),q===null)throw new Error(`Unsupported default string type ${H}`)}return q}function createStringifyContext(d,m){const g=Object.assign({blockQuote:!0,commentString:stringifyComment,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},d.schema.toStringOptions,m);let w;switch(g.collectionStyle){case"block":w=!1;break;case"flow":w=!0;break;default:w=null}return{anchors:new Set,doc:d,flowCollectionPadding:g.flowCollectionPadding?" ":"",indent:"",indentStep:typeof g.indent=="number"?" ".repeat(g.indent):"  ",inFlow:w,options:g}}function getTagObject(d,m){if(m.tag){const $=d.filter(I=>I.tag===m.tag);if($.length>0)return $.find(I=>I.format===m.format)??$[0]}let g,w;if(isScalar$1(m)){w=m.value;let $=d.filter(I=>I.identify?.(w));if($.length>1){const I=$.filter(D=>D.test);I.length>0&&($=I)}g=$.find(I=>I.format===m.format)??$.find(I=>!I.format)}else w=m,g=d.find($=>$.nodeClass&&w instanceof $.nodeClass);if(!g){const $=w?.constructor?.name??(w===null?"null":typeof w);throw new Error(`Tag not resolved for ${$} value`)}return g}function stringifyProps(d,m,{anchors:g,doc:w}){if(!w.directives)return"";const $=[],I=(isScalar$1(d)||isCollection$1(d))&&d.anchor;I&&anchorIsValid(I)&&(g.add(I),$.push(`&${I}`));const D=d.tag??(m.default?null:m.tag);return D&&$.push(w.directives.tagString(D)),$.join(" ")}function stringify$3(d,m,g,w){if(isPair(d))return d.toString(m,g,w);if(isAlias(d)){if(m.doc.directives)return d.toString(m);if(m.resolvedAliases?.has(d))throw new TypeError("Cannot stringify circular structure without alias nodes");m.resolvedAliases?m.resolvedAliases.add(d):m.resolvedAliases=new Set([d]),d=d.resolve(m.doc)}let $;const I=isNode(d)?d:m.doc.createNode(d,{onTagObj:U=>$=U});$??($=getTagObject(m.doc.schema.tags,I));const D=stringifyProps(I,$,m);D.length>0&&(m.indentAtStart=(m.indentAtStart??0)+D.length+1);const F=typeof $.stringify=="function"?$.stringify(I,m,g,w):isScalar$1(I)?stringifyString(I,m,g,w):I.toString(m,g,w);return D?isScalar$1(I)||F[0]==="{"||F[0]==="["?`${D} ${F}`:`${D}
${m.indent}${F}`:F}function stringifyPair({key:d,value:m},g,w,$){const{allNullValues:I,doc:D,indent:F,indentStep:U,options:{commentString:q,indentSeq:j,simpleKeys:G}}=g;let H=isNode(d)&&d.comment||null;if(G){if(H)throw new Error("With simple keys, key nodes cannot have comments");if(isCollection$1(d)||!isNode(d)&&typeof d=="object"){const oe="With simple keys, collection cannot be used as a key value";throw new Error(oe)}}let V=!G&&(!d||H&&m==null&&!g.inFlow||isCollection$1(d)||(isScalar$1(d)?d.type===Scalar.BLOCK_FOLDED||d.type===Scalar.BLOCK_LITERAL:typeof d=="object"));g=Object.assign({},g,{allNullValues:!1,implicitKey:!V&&(G||!I),indent:F+U});let Z=!1,Q=!1,J=stringify$3(d,g,()=>Z=!0,()=>Q=!0);if(!V&&!g.inFlow&&J.length>1024){if(G)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");V=!0}if(g.inFlow){if(I||m==null)return Z&&w&&w(),J===""?"?":V?`? ${J}`:J}else if(I&&!G||m==null&&V)return J=`? ${J}`,H&&!Z?J+=lineComment(J,g.indent,q(H)):Q&&$&&$(),J;Z&&(H=null),V?(H&&(J+=lineComment(J,g.indent,q(H))),J=`? ${J}
${F}:`):(J=`${J}:`,H&&(J+=lineComment(J,g.indent,q(H))));let ie,re,se;isNode(m)?(ie=!!m.spaceBefore,re=m.commentBefore,se=m.comment):(ie=!1,re=null,se=null,m&&typeof m=="object"&&(m=D.createNode(m))),g.implicitKey=!1,!V&&!H&&isScalar$1(m)&&(g.indentAtStart=J.length+1),Q=!1,!j&&U.length>=2&&!g.inFlow&&!V&&isSeq(m)&&!m.flow&&!m.tag&&!m.anchor&&(g.indent=g.indent.substring(2));let X=!1;const ne=stringify$3(m,g,()=>X=!0,()=>Q=!0);let ce=" ";if(H||ie||re){if(ce=ie?`
`:"",re){const oe=q(re);ce+=`
${indentComment(oe,g.indent)}`}ne===""&&!g.inFlow?ce===`
`&&(ce=`

`):ce+=`
${g.indent}`}else if(!V&&isCollection$1(m)){const oe=ne[0],de=ne.indexOf(`
`),me=de!==-1,ge=g.inFlow??m.flow??m.items.length===0;if(me||!ge){let fe=!1;if(me&&(oe==="&"||oe==="!")){let xe=ne.indexOf(" ");oe==="&"&&xe!==-1&&xe<de&&ne[xe+1]==="!"&&(xe=ne.indexOf(" ",xe+1)),(xe===-1||de<xe)&&(fe=!0)}fe||(ce=`
${g.indent}`)}}else(ne===""||ne[0]===`
`)&&(ce="");return J+=ce+ne,g.inFlow?X&&w&&w():se&&!X?J+=lineComment(J,g.indent,q(se)):Q&&$&&$(),J}function warn(d,m){(d==="debug"||d==="warn")&&console.warn(m)}const MERGE_KEY="<<",merge={identify:d=>d===MERGE_KEY||typeof d=="symbol"&&d.description===MERGE_KEY,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new Scalar(Symbol(MERGE_KEY)),{addToJSMap:addMergeToJSMap}),stringify:()=>MERGE_KEY},isMergeKey=(d,m)=>(merge.identify(m)||isScalar$1(m)&&(!m.type||m.type===Scalar.PLAIN)&&merge.identify(m.value))&&d?.doc.schema.tags.some(g=>g.tag===merge.tag&&g.default);function addMergeToJSMap(d,m,g){if(g=d&&isAlias(g)?g.resolve(d.doc):g,isSeq(g))for(const w of g.items)mergeValue(d,m,w);else if(Array.isArray(g))for(const w of g)mergeValue(d,m,w);else mergeValue(d,m,g)}function mergeValue(d,m,g){const w=d&&isAlias(g)?g.resolve(d.doc):g;if(!isMap(w))throw new Error("Merge sources must be maps or map aliases");const $=w.toJSON(null,d,Map);for(const[I,D]of $)m instanceof Map?m.has(I)||m.set(I,D):m instanceof Set?m.add(I):Object.prototype.hasOwnProperty.call(m,I)||Object.defineProperty(m,I,{value:D,writable:!0,enumerable:!0,configurable:!0});return m}function addPairToJSMap(d,m,{key:g,value:w}){if(isNode(g)&&g.addToJSMap)g.addToJSMap(d,m,w);else if(isMergeKey(d,g))addMergeToJSMap(d,m,w);else{const $=toJS(g,"",d);if(m instanceof Map)m.set($,toJS(w,$,d));else if(m instanceof Set)m.add($);else{const I=stringifyKey(g,$,d),D=toJS(w,I,d);I in m?Object.defineProperty(m,I,{value:D,writable:!0,enumerable:!0,configurable:!0}):m[I]=D}}return m}function stringifyKey(d,m,g){if(m===null)return"";if(typeof m!="object")return String(m);if(isNode(d)&&g?.doc){const w=createStringifyContext(g.doc,{});w.anchors=new Set;for(const I of g.anchors.keys())w.anchors.add(I.anchor);w.inFlow=!0,w.inStringifyKey=!0;const $=d.toString(w);if(!g.mapKeyWarned){let I=JSON.stringify($);I.length>40&&(I=I.substring(0,36)+'..."'),warn(g.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${I}. Set mapAsMap: true to use object keys.`),g.mapKeyWarned=!0}return $}return JSON.stringify(m)}function createPair(d,m,g){const w=createNode(d,void 0,g),$=createNode(m,void 0,g);return new Pair(w,$)}class Pair{constructor(m,g=null){Object.defineProperty(this,NODE_TYPE,{value:PAIR}),this.key=m,this.value=g}clone(m){let{key:g,value:w}=this;return isNode(g)&&(g=g.clone(m)),isNode(w)&&(w=w.clone(m)),new Pair(g,w)}toJSON(m,g){const w=g?.mapAsMap?new Map:{};return addPairToJSMap(g,w,this)}toString(m,g,w){return m?.doc?stringifyPair(this,m,g,w):JSON.stringify(this)}}function stringifyCollection(d,m,g){return(m.inFlow??d.flow?stringifyFlowCollection:stringifyBlockCollection)(d,m,g)}function stringifyBlockCollection({comment:d,items:m},g,{blockItemPrefix:w,flowChars:$,itemIndent:I,onChompKeep:D,onComment:F}){const{indent:U,options:{commentString:q}}=g,j=Object.assign({},g,{indent:I,type:null});let G=!1;const H=[];for(let Z=0;Z<m.length;++Z){const Q=m[Z];let J=null;if(isNode(Q))!G&&Q.spaceBefore&&H.push(""),addCommentBefore(g,H,Q.commentBefore,G),Q.comment&&(J=Q.comment);else if(isPair(Q)){const re=isNode(Q.key)?Q.key:null;re&&(!G&&re.spaceBefore&&H.push(""),addCommentBefore(g,H,re.commentBefore,G))}G=!1;let ie=stringify$3(Q,j,()=>J=null,()=>G=!0);J&&(ie+=lineComment(ie,I,q(J))),G&&J&&(G=!1),H.push(w+ie)}let V;if(H.length===0)V=$.start+$.end;else{V=H[0];for(let Z=1;Z<H.length;++Z){const Q=H[Z];V+=Q?`
${U}${Q}`:`
`}}return d?(V+=`
`+indentComment(q(d),U),F&&F()):G&&D&&D(),V}function stringifyFlowCollection({items:d},m,{flowChars:g,itemIndent:w}){const{indent:$,indentStep:I,flowCollectionPadding:D,options:{commentString:F}}=m;w+=I;const U=Object.assign({},m,{indent:w,inFlow:!0,type:null});let q=!1,j=0;const G=[];for(let Z=0;Z<d.length;++Z){const Q=d[Z];let J=null;if(isNode(Q))Q.spaceBefore&&G.push(""),addCommentBefore(m,G,Q.commentBefore,!1),Q.comment&&(J=Q.comment);else if(isPair(Q)){const re=isNode(Q.key)?Q.key:null;re&&(re.spaceBefore&&G.push(""),addCommentBefore(m,G,re.commentBefore,!1),re.comment&&(q=!0));const se=isNode(Q.value)?Q.value:null;se?(se.comment&&(J=se.comment),se.commentBefore&&(q=!0)):Q.value==null&&re?.comment&&(J=re.comment)}J&&(q=!0);let ie=stringify$3(Q,U,()=>J=null);Z<d.length-1&&(ie+=","),J&&(ie+=lineComment(ie,w,F(J))),!q&&(G.length>j||ie.includes(`
`))&&(q=!0),G.push(ie),j=G.length}const{start:H,end:V}=g;if(G.length===0)return H+V;if(!q){const Z=G.reduce((Q,J)=>Q+J.length+2,2);q=m.options.lineWidth>0&&Z>m.options.lineWidth}if(q){let Z=H;for(const Q of G)Z+=Q?`
${I}${$}${Q}`:`
`;return`${Z}
${$}${V}`}else return`${H}${D}${G.join(" ")}${D}${V}`}function addCommentBefore({indent:d,options:{commentString:m}},g,w,$){if(w&&$&&(w=w.replace(/^\n+/,"")),w){const I=indentComment(m(w),d);g.push(I.trimStart())}}function findPair(d,m){const g=isScalar$1(m)?m.value:m;for(const w of d)if(isPair(w)&&(w.key===m||w.key===g||isScalar$1(w.key)&&w.key.value===g))return w}class YAMLMap extends Collection{static get tagName(){return"tag:yaml.org,2002:map"}constructor(m){super(MAP,m),this.items=[]}static from(m,g,w){const{keepUndefined:$,replacer:I}=w,D=new this(m),F=(U,q)=>{if(typeof I=="function")q=I.call(g,U,q);else if(Array.isArray(I)&&!I.includes(U))return;(q!==void 0||$)&&D.items.push(createPair(U,q,w))};if(g instanceof Map)for(const[U,q]of g)F(U,q);else if(g&&typeof g=="object")for(const U of Object.keys(g))F(U,g[U]);return typeof m.sortMapEntries=="function"&&D.items.sort(m.sortMapEntries),D}add(m,g){let w;isPair(m)?w=m:!m||typeof m!="object"||!("key"in m)?w=new Pair(m,m?.value):w=new Pair(m.key,m.value);const $=findPair(this.items,w.key),I=this.schema?.sortMapEntries;if($){if(!g)throw new Error(`Key ${w.key} already set`);isScalar$1($.value)&&isScalarValue(w.value)?$.value.value=w.value:$.value=w.value}else if(I){const D=this.items.findIndex(F=>I(w,F)<0);D===-1?this.items.push(w):this.items.splice(D,0,w)}else this.items.push(w)}delete(m){const g=findPair(this.items,m);return g?this.items.splice(this.items.indexOf(g),1).length>0:!1}get(m,g){const $=findPair(this.items,m)?.value;return(!g&&isScalar$1($)?$.value:$)??void 0}has(m){return!!findPair(this.items,m)}set(m,g){this.add(new Pair(m,g),!0)}toJSON(m,g,w){const $=w?new w:g?.mapAsMap?new Map:{};g?.onCreate&&g.onCreate($);for(const I of this.items)addPairToJSMap(g,$,I);return $}toString(m,g,w){if(!m)return JSON.stringify(this);for(const $ of this.items)if(!isPair($))throw new Error(`Map items must all be pairs; found ${JSON.stringify($)} instead`);return!m.allNullValues&&this.hasAllNullValues(!1)&&(m=Object.assign({},m,{allNullValues:!0})),stringifyCollection(this,m,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:m.indent||"",onChompKeep:w,onComment:g})}}const map={collection:"map",default:!0,nodeClass:YAMLMap,tag:"tag:yaml.org,2002:map",resolve(d,m){return isMap(d)||m("Expected a mapping for this tag"),d},createNode:(d,m,g)=>YAMLMap.from(d,m,g)};class YAMLSeq extends Collection{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(m){super(SEQ,m),this.items=[]}add(m){this.items.push(m)}delete(m){const g=asItemIndex(m);return typeof g!="number"?!1:this.items.splice(g,1).length>0}get(m,g){const w=asItemIndex(m);if(typeof w!="number")return;const $=this.items[w];return!g&&isScalar$1($)?$.value:$}has(m){const g=asItemIndex(m);return typeof g=="number"&&g<this.items.length}set(m,g){const w=asItemIndex(m);if(typeof w!="number")throw new Error(`Expected a valid index, not ${m}.`);const $=this.items[w];isScalar$1($)&&isScalarValue(g)?$.value=g:this.items[w]=g}toJSON(m,g){const w=[];g?.onCreate&&g.onCreate(w);let $=0;for(const I of this.items)w.push(toJS(I,String($++),g));return w}toString(m,g,w){return m?stringifyCollection(this,m,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(m.indent||"")+"  ",onChompKeep:w,onComment:g}):JSON.stringify(this)}static from(m,g,w){const{replacer:$}=w,I=new this(m);if(g&&Symbol.iterator in Object(g)){let D=0;for(let F of g){if(typeof $=="function"){const U=g instanceof Set?F:String(D++);F=$.call(g,U,F)}I.items.push(createNode(F,void 0,w))}}return I}}function asItemIndex(d){let m=isScalar$1(d)?d.value:d;return m&&typeof m=="string"&&(m=Number(m)),typeof m=="number"&&Number.isInteger(m)&&m>=0?m:null}const seq={collection:"seq",default:!0,nodeClass:YAMLSeq,tag:"tag:yaml.org,2002:seq",resolve(d,m){return isSeq(d)||m("Expected a sequence for this tag"),d},createNode:(d,m,g)=>YAMLSeq.from(d,m,g)},string={identify:d=>typeof d=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:d=>d,stringify(d,m,g,w){return m=Object.assign({actualString:!0},m),stringifyString(d,m,g,w)}},nullTag={identify:d=>d==null,createNode:()=>new Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new Scalar(null),stringify:({source:d},m)=>typeof d=="string"&&nullTag.test.test(d)?d:m.options.nullStr},boolTag={identify:d=>typeof d=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:d=>new Scalar(d[0]==="t"||d[0]==="T"),stringify({source:d,value:m},g){if(d&&boolTag.test.test(d)){const w=d[0]==="t"||d[0]==="T";if(m===w)return d}return m?g.options.trueStr:g.options.falseStr}};function stringifyNumber({format:d,minFractionDigits:m,tag:g,value:w}){if(typeof w=="bigint")return String(w);const $=typeof w=="number"?w:Number(w);if(!isFinite($))return isNaN($)?".nan":$<0?"-.inf":".inf";let I=JSON.stringify(w);if(!d&&m&&(!g||g==="tag:yaml.org,2002:float")&&/^\d/.test(I)){let D=I.indexOf(".");D<0&&(D=I.length,I+=".");let F=m-(I.length-D-1);for(;F-- >0;)I+="0"}return I}const floatNaN$1={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:d=>d.slice(-3).toLowerCase()==="nan"?NaN:d[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:stringifyNumber},floatExp$1={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:d=>parseFloat(d),stringify(d){const m=Number(d.value);return isFinite(m)?m.toExponential():stringifyNumber(d)}},float$1={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(d){const m=new Scalar(parseFloat(d)),g=d.indexOf(".");return g!==-1&&d[d.length-1]==="0"&&(m.minFractionDigits=d.length-g-1),m},stringify:stringifyNumber},intIdentify$2=d=>typeof d=="bigint"||Number.isInteger(d),intResolve$1=(d,m,g,{intAsBigInt:w})=>w?BigInt(d):parseInt(d.substring(m),g);function intStringify$1(d,m,g){const{value:w}=d;return intIdentify$2(w)&&w>=0?g+w.toString(m):stringifyNumber(d)}const intOct$1={identify:d=>intIdentify$2(d)&&d>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(d,m,g)=>intResolve$1(d,2,8,g),stringify:d=>intStringify$1(d,8,"0o")},int$1={identify:intIdentify$2,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(d,m,g)=>intResolve$1(d,0,10,g),stringify:stringifyNumber},intHex$1={identify:d=>intIdentify$2(d)&&d>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(d,m,g)=>intResolve$1(d,2,16,g),stringify:d=>intStringify$1(d,16,"0x")},schema$2=[map,seq,string,nullTag,boolTag,intOct$1,int$1,intHex$1,floatNaN$1,floatExp$1,float$1];function intIdentify$1(d){return typeof d=="bigint"||Number.isInteger(d)}const stringifyJSON=({value:d})=>JSON.stringify(d),jsonScalars=[{identify:d=>typeof d=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:d=>d,stringify:stringifyJSON},{identify:d=>d==null,createNode:()=>new Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:stringifyJSON},{identify:d=>typeof d=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:d=>d==="true",stringify:stringifyJSON},{identify:intIdentify$1,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(d,m,{intAsBigInt:g})=>g?BigInt(d):parseInt(d,10),stringify:({value:d})=>intIdentify$1(d)?d.toString():JSON.stringify(d)},{identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:d=>parseFloat(d),stringify:stringifyJSON}],jsonError={default:!0,tag:"",test:/^/,resolve(d,m){return m(`Unresolved plain scalar ${JSON.stringify(d)}`),d}},schema$1=[map,seq].concat(jsonScalars,jsonError),binary={identify:d=>d instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(d,m){if(typeof atob=="function"){const g=atob(d.replace(/[\n\r]/g,"")),w=new Uint8Array(g.length);for(let $=0;$<g.length;++$)w[$]=g.charCodeAt($);return w}else return m("This environment does not support reading binary tags; either Buffer or atob is required"),d},stringify({comment:d,type:m,value:g},w,$,I){if(!g)return"";const D=g;let F;if(typeof btoa=="function"){let U="";for(let q=0;q<D.length;++q)U+=String.fromCharCode(D[q]);F=btoa(U)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(m??(m=Scalar.BLOCK_LITERAL),m!==Scalar.QUOTE_DOUBLE){const U=Math.max(w.options.lineWidth-w.indent.length,w.options.minContentWidth),q=Math.ceil(F.length/U),j=new Array(q);for(let G=0,H=0;G<q;++G,H+=U)j[G]=F.substr(H,U);F=j.join(m===Scalar.BLOCK_LITERAL?`
`:" ")}return stringifyString({comment:d,type:m,value:F},w,$,I)}};function resolvePairs(d,m){if(isSeq(d))for(let g=0;g<d.items.length;++g){let w=d.items[g];if(!isPair(w)){if(isMap(w)){w.items.length>1&&m("Each pair must have its own sequence indicator");const $=w.items[0]||new Pair(new Scalar(null));if(w.commentBefore&&($.key.commentBefore=$.key.commentBefore?`${w.commentBefore}
${$.key.commentBefore}`:w.commentBefore),w.comment){const I=$.value??$.key;I.comment=I.comment?`${w.comment}
${I.comment}`:w.comment}w=$}d.items[g]=isPair(w)?w:new Pair(w)}}else m("Expected a sequence for this tag");return d}function createPairs(d,m,g){const{replacer:w}=g,$=new YAMLSeq(d);$.tag="tag:yaml.org,2002:pairs";let I=0;if(m&&Symbol.iterator in Object(m))for(let D of m){typeof w=="function"&&(D=w.call(m,String(I++),D));let F,U;if(Array.isArray(D))if(D.length===2)F=D[0],U=D[1];else throw new TypeError(`Expected [key, value] tuple: ${D}`);else if(D&&D instanceof Object){const q=Object.keys(D);if(q.length===1)F=q[0],U=D[F];else throw new TypeError(`Expected tuple with one key, not ${q.length} keys`)}else F=D;$.items.push(createPair(F,U,g))}return $}const pairs={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:resolvePairs,createNode:createPairs};class YAMLOMap extends YAMLSeq{constructor(){super(),this.add=YAMLMap.prototype.add.bind(this),this.delete=YAMLMap.prototype.delete.bind(this),this.get=YAMLMap.prototype.get.bind(this),this.has=YAMLMap.prototype.has.bind(this),this.set=YAMLMap.prototype.set.bind(this),this.tag=YAMLOMap.tag}toJSON(m,g){if(!g)return super.toJSON(m);const w=new Map;g?.onCreate&&g.onCreate(w);for(const $ of this.items){let I,D;if(isPair($)?(I=toJS($.key,"",g),D=toJS($.value,I,g)):I=toJS($,"",g),w.has(I))throw new Error("Ordered maps must not include duplicate keys");w.set(I,D)}return w}static from(m,g,w){const $=createPairs(m,g,w),I=new this;return I.items=$.items,I}}YAMLOMap.tag="tag:yaml.org,2002:omap";const omap={collection:"seq",identify:d=>d instanceof Map,nodeClass:YAMLOMap,default:!1,tag:"tag:yaml.org,2002:omap",resolve(d,m){const g=resolvePairs(d,m),w=[];for(const{key:$}of g.items)isScalar$1($)&&(w.includes($.value)?m(`Ordered maps must not include duplicate keys: ${$.value}`):w.push($.value));return Object.assign(new YAMLOMap,g)},createNode:(d,m,g)=>YAMLOMap.from(d,m,g)};function boolStringify({value:d,source:m},g){return m&&(d?trueTag:falseTag).test.test(m)?m:d?g.options.trueStr:g.options.falseStr}const trueTag={identify:d=>d===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new Scalar(!0),stringify:boolStringify},falseTag={identify:d=>d===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new Scalar(!1),stringify:boolStringify},floatNaN={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:d=>d.slice(-3).toLowerCase()==="nan"?NaN:d[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:stringifyNumber},floatExp={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:d=>parseFloat(d.replace(/_/g,"")),stringify(d){const m=Number(d.value);return isFinite(m)?m.toExponential():stringifyNumber(d)}},float={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(d){const m=new Scalar(parseFloat(d.replace(/_/g,""))),g=d.indexOf(".");if(g!==-1){const w=d.substring(g+1).replace(/_/g,"");w[w.length-1]==="0"&&(m.minFractionDigits=w.length)}return m},stringify:stringifyNumber},intIdentify=d=>typeof d=="bigint"||Number.isInteger(d);function intResolve(d,m,g,{intAsBigInt:w}){const $=d[0];if(($==="-"||$==="+")&&(m+=1),d=d.substring(m).replace(/_/g,""),w){switch(g){case 2:d=`0b${d}`;break;case 8:d=`0o${d}`;break;case 16:d=`0x${d}`;break}const D=BigInt(d);return $==="-"?BigInt(-1)*D:D}const I=parseInt(d,g);return $==="-"?-1*I:I}function intStringify(d,m,g){const{value:w}=d;if(intIdentify(w)){const $=w.toString(m);return w<0?"-"+g+$.substr(1):g+$}return stringifyNumber(d)}const intBin={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(d,m,g)=>intResolve(d,2,2,g),stringify:d=>intStringify(d,2,"0b")},intOct={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(d,m,g)=>intResolve(d,1,8,g),stringify:d=>intStringify(d,8,"0")},int={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(d,m,g)=>intResolve(d,0,10,g),stringify:stringifyNumber},intHex={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(d,m,g)=>intResolve(d,2,16,g),stringify:d=>intStringify(d,16,"0x")};class YAMLSet extends YAMLMap{constructor(m){super(m),this.tag=YAMLSet.tag}add(m){let g;isPair(m)?g=m:m&&typeof m=="object"&&"key"in m&&"value"in m&&m.value===null?g=new Pair(m.key,null):g=new Pair(m,null),findPair(this.items,g.key)||this.items.push(g)}get(m,g){const w=findPair(this.items,m);return!g&&isPair(w)?isScalar$1(w.key)?w.key.value:w.key:w}set(m,g){if(typeof g!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof g}`);const w=findPair(this.items,m);w&&!g?this.items.splice(this.items.indexOf(w),1):!w&&g&&this.items.push(new Pair(m))}toJSON(m,g){return super.toJSON(m,g,Set)}toString(m,g,w){if(!m)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},m,{allNullValues:!0}),g,w);throw new Error("Set items must all have null values")}static from(m,g,w){const{replacer:$}=w,I=new this(m);if(g&&Symbol.iterator in Object(g))for(let D of g)typeof $=="function"&&(D=$.call(g,D,D)),I.items.push(createPair(D,null,w));return I}}YAMLSet.tag="tag:yaml.org,2002:set";const set$2={collection:"map",identify:d=>d instanceof Set,nodeClass:YAMLSet,default:!1,tag:"tag:yaml.org,2002:set",createNode:(d,m,g)=>YAMLSet.from(d,m,g),resolve(d,m){if(isMap(d)){if(d.hasAllNullValues(!0))return Object.assign(new YAMLSet,d);m("Set items must all have null values")}else m("Expected a mapping for this tag");return d}};function parseSexagesimal(d,m){const g=d[0],w=g==="-"||g==="+"?d.substring(1):d,$=D=>m?BigInt(D):Number(D),I=w.replace(/_/g,"").split(":").reduce((D,F)=>D*$(60)+$(F),$(0));return g==="-"?$(-1)*I:I}function stringifySexagesimal(d){let{value:m}=d,g=D=>D;if(typeof m=="bigint")g=D=>BigInt(D);else if(isNaN(m)||!isFinite(m))return stringifyNumber(d);let w="";m<0&&(w="-",m*=g(-1));const $=g(60),I=[m%$];return m<60?I.unshift(0):(m=(m-I[0])/$,I.unshift(m%$),m>=60&&(m=(m-I[0])/$,I.unshift(m))),w+I.map(D=>String(D).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const intTime={identify:d=>typeof d=="bigint"||Number.isInteger(d),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(d,m,{intAsBigInt:g})=>parseSexagesimal(d,g),stringify:stringifySexagesimal},floatTime={identify:d=>typeof d=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:d=>parseSexagesimal(d,!1),stringify:stringifySexagesimal},timestamp={identify:d=>d instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(d){const m=d.match(timestamp.test);if(!m)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,g,w,$,I,D,F]=m.map(Number),U=m[7]?Number((m[7]+"00").substr(1,3)):0;let q=Date.UTC(g,w-1,$,I||0,D||0,F||0,U);const j=m[8];if(j&&j!=="Z"){let G=parseSexagesimal(j,!1);Math.abs(G)<30&&(G*=60),q-=6e4*G}return new Date(q)},stringify:({value:d})=>d?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""},schema=[map,seq,string,nullTag,trueTag,falseTag,intBin,intOct,int,intHex,floatNaN,floatExp,float,binary,merge,omap,pairs,set$2,intTime,floatTime,timestamp],schemas=new Map([["core",schema$2],["failsafe",[map,seq,string]],["json",schema$1],["yaml11",schema],["yaml-1.1",schema]]),tagsByName={binary,bool:boolTag,float:float$1,floatExp:floatExp$1,floatNaN:floatNaN$1,floatTime,int:int$1,intHex:intHex$1,intOct:intOct$1,intTime,map,merge,null:nullTag,omap,pairs,seq,set:set$2,timestamp},coreKnownTags={"tag:yaml.org,2002:binary":binary,"tag:yaml.org,2002:merge":merge,"tag:yaml.org,2002:omap":omap,"tag:yaml.org,2002:pairs":pairs,"tag:yaml.org,2002:set":set$2,"tag:yaml.org,2002:timestamp":timestamp};function getTags(d,m,g){const w=schemas.get(m);if(w&&!d)return g&&!w.includes(merge)?w.concat(merge):w.slice();let $=w;if(!$)if(Array.isArray(d))$=[];else{const I=Array.from(schemas.keys()).filter(D=>D!=="yaml11").map(D=>JSON.stringify(D)).join(", ");throw new Error(`Unknown schema "${m}"; use one of ${I} or define customTags array`)}if(Array.isArray(d))for(const I of d)$=$.concat(I);else typeof d=="function"&&($=d($.slice()));return g&&($=$.concat(merge)),$.reduce((I,D)=>{const F=typeof D=="string"?tagsByName[D]:D;if(!F){const U=JSON.stringify(D),q=Object.keys(tagsByName).map(j=>JSON.stringify(j)).join(", ");throw new Error(`Unknown custom tag ${U}; use one of ${q}`)}return I.includes(F)||I.push(F),I},[])}const sortMapEntriesByKey=(d,m)=>d.key<m.key?-1:d.key>m.key?1:0;class Schema{constructor({compat:m,customTags:g,merge:w,resolveKnownTags:$,schema:I,sortMapEntries:D,toStringDefaults:F}){this.compat=Array.isArray(m)?getTags(m,"compat"):m?getTags(null,m):null,this.name=typeof I=="string"&&I||"core",this.knownTags=$?coreKnownTags:{},this.tags=getTags(g,this.name,w),this.toStringOptions=F??null,Object.defineProperty(this,MAP,{value:map}),Object.defineProperty(this,SCALAR$1,{value:string}),Object.defineProperty(this,SEQ,{value:seq}),this.sortMapEntries=typeof D=="function"?D:D===!0?sortMapEntriesByKey:null}clone(){const m=Object.create(Schema.prototype,Object.getOwnPropertyDescriptors(this));return m.tags=this.tags.slice(),m}}function stringifyDocument(d,m){const g=[];let w=m.directives===!0;if(m.directives!==!1&&d.directives){const U=d.directives.toString(d);U?(g.push(U),w=!0):d.directives.docStart&&(w=!0)}w&&g.push("---");const $=createStringifyContext(d,m),{commentString:I}=$.options;if(d.commentBefore){g.length!==1&&g.unshift("");const U=I(d.commentBefore);g.unshift(indentComment(U,""))}let D=!1,F=null;if(d.contents){if(isNode(d.contents)){if(d.contents.spaceBefore&&w&&g.push(""),d.contents.commentBefore){const j=I(d.contents.commentBefore);g.push(indentComment(j,""))}$.forceBlockIndent=!!d.comment,F=d.contents.comment}const U=F?void 0:()=>D=!0;let q=stringify$3(d.contents,$,()=>F=null,U);F&&(q+=lineComment(q,"",I(F))),(q[0]==="|"||q[0]===">")&&g[g.length-1]==="---"?g[g.length-1]=`--- ${q}`:g.push(q)}else g.push(stringify$3(d.contents,$));if(d.directives?.docEnd)if(d.comment){const U=I(d.comment);U.includes(`
`)?(g.push("..."),g.push(indentComment(U,""))):g.push(`... ${U}`)}else g.push("...");else{let U=d.comment;U&&D&&(U=U.replace(/^\n+/,"")),U&&((!D||F)&&g[g.length-1]!==""&&g.push(""),g.push(indentComment(I(U),"")))}return g.join(`
`)+`
`}class Document{constructor(m,g,w){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,NODE_TYPE,{value:DOC});let $=null;typeof g=="function"||Array.isArray(g)?$=g:w===void 0&&g&&(w=g,g=void 0);const I=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},w);this.options=I;let{version:D}=I;w?._directives?(this.directives=w._directives.atDocument(),this.directives.yaml.explicit&&(D=this.directives.yaml.version)):this.directives=new Directives({version:D}),this.setSchema(D,w),this.contents=m===void 0?null:this.createNode(m,$,w)}clone(){const m=Object.create(Document.prototype,{[NODE_TYPE]:{value:DOC}});return m.commentBefore=this.commentBefore,m.comment=this.comment,m.errors=this.errors.slice(),m.warnings=this.warnings.slice(),m.options=Object.assign({},this.options),this.directives&&(m.directives=this.directives.clone()),m.schema=this.schema.clone(),m.contents=isNode(this.contents)?this.contents.clone(m.schema):this.contents,this.range&&(m.range=this.range.slice()),m}add(m){assertCollection(this.contents)&&this.contents.add(m)}addIn(m,g){assertCollection(this.contents)&&this.contents.addIn(m,g)}createAlias(m,g){if(!m.anchor){const w=anchorNames(this);m.anchor=!g||w.has(g)?findNewAnchor(g||"a",w):g}return new Alias(m.anchor)}createNode(m,g,w){let $;if(typeof g=="function")m=g.call({"":m},"",m),$=g;else if(Array.isArray(g)){const J=re=>typeof re=="number"||re instanceof String||re instanceof Number,ie=g.filter(J).map(String);ie.length>0&&(g=g.concat(ie)),$=g}else w===void 0&&g&&(w=g,g=void 0);const{aliasDuplicateObjects:I,anchorPrefix:D,flow:F,keepUndefined:U,onTagObj:q,tag:j}=w??{},{onAnchor:G,setAnchors:H,sourceObjects:V}=createNodeAnchors(this,D||"a"),Z={aliasDuplicateObjects:I??!0,keepUndefined:U??!1,onAnchor:G,onTagObj:q,replacer:$,schema:this.schema,sourceObjects:V},Q=createNode(m,j,Z);return F&&isCollection$1(Q)&&(Q.flow=!0),H(),Q}createPair(m,g,w={}){const $=this.createNode(m,null,w),I=this.createNode(g,null,w);return new Pair($,I)}delete(m){return assertCollection(this.contents)?this.contents.delete(m):!1}deleteIn(m){return isEmptyPath(m)?this.contents==null?!1:(this.contents=null,!0):assertCollection(this.contents)?this.contents.deleteIn(m):!1}get(m,g){return isCollection$1(this.contents)?this.contents.get(m,g):void 0}getIn(m,g){return isEmptyPath(m)?!g&&isScalar$1(this.contents)?this.contents.value:this.contents:isCollection$1(this.contents)?this.contents.getIn(m,g):void 0}has(m){return isCollection$1(this.contents)?this.contents.has(m):!1}hasIn(m){return isEmptyPath(m)?this.contents!==void 0:isCollection$1(this.contents)?this.contents.hasIn(m):!1}set(m,g){this.contents==null?this.contents=collectionFromPath(this.schema,[m],g):assertCollection(this.contents)&&this.contents.set(m,g)}setIn(m,g){isEmptyPath(m)?this.contents=g:this.contents==null?this.contents=collectionFromPath(this.schema,Array.from(m),g):assertCollection(this.contents)&&this.contents.setIn(m,g)}setSchema(m,g={}){typeof m=="number"&&(m=String(m));let w;switch(m){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new Directives({version:"1.1"}),w={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=m:this.directives=new Directives({version:m}),w={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,w=null;break;default:{const $=JSON.stringify(m);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${$}`)}}if(g.schema instanceof Object)this.schema=g.schema;else if(w)this.schema=new Schema(Object.assign(w,g));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:m,jsonArg:g,mapAsMap:w,maxAliasCount:$,onAnchor:I,reviver:D}={}){const F={anchors:new Map,doc:this,keep:!m,mapAsMap:w===!0,mapKeyWarned:!1,maxAliasCount:typeof $=="number"?$:100},U=toJS(this.contents,g??"",F);if(typeof I=="function")for(const{count:q,res:j}of F.anchors.values())I(j,q);return typeof D=="function"?applyReviver(D,{"":U},"",U):U}toJSON(m,g){return this.toJS({json:!0,jsonArg:m,mapAsMap:!1,onAnchor:g})}toString(m={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in m&&(!Number.isInteger(m.indent)||Number(m.indent)<=0)){const g=JSON.stringify(m.indent);throw new Error(`"indent" option must be a positive integer, not ${g}`)}return stringifyDocument(this,m)}}function assertCollection(d){if(isCollection$1(d))return!0;throw new Error("Expected a YAML collection as document contents")}class YAMLError extends Error{constructor(m,g,w,$){super(),this.name=m,this.code=w,this.message=$,this.pos=g}}class YAMLParseError extends YAMLError{constructor(m,g,w){super("YAMLParseError",m,g,w)}}class YAMLWarning extends YAMLError{constructor(m,g,w){super("YAMLWarning",m,g,w)}}const prettifyError=(d,m)=>g=>{if(g.pos[0]===-1)return;g.linePos=g.pos.map(F=>m.linePos(F));const{line:w,col:$}=g.linePos[0];g.message+=` at line ${w}, column ${$}`;let I=$-1,D=d.substring(m.lineStarts[w-1],m.lineStarts[w]).replace(/[\n\r]+$/,"");if(I>=60&&D.length>80){const F=Math.min(I-39,D.length-79);D="â€¦"+D.substring(F),I-=F-1}if(D.length>80&&(D=D.substring(0,79)+"â€¦"),w>1&&/^ *$/.test(D.substring(0,I))){let F=d.substring(m.lineStarts[w-2],m.lineStarts[w-1]);F.length>80&&(F=F.substring(0,79)+`â€¦
`),D=F+D}if(/[^ ]/.test(D)){let F=1;const U=g.linePos[1];U&&U.line===w&&U.col>$&&(F=Math.max(1,Math.min(U.col-$,80-I)));const q=" ".repeat(I)+"^".repeat(F);g.message+=`:

${D}
${q}
`}};function resolveProps(d,{flow:m,indicator:g,next:w,offset:$,onError:I,parentIndent:D,startOnNewline:F}){let U=!1,q=F,j=F,G="",H="",V=!1,Z=!1,Q=null,J=null,ie=null,re=null,se=null,X=null,ne=null;for(const de of d)switch(Z&&(de.type!=="space"&&de.type!=="newline"&&de.type!=="comma"&&I(de.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),Z=!1),Q&&(q&&de.type!=="comment"&&de.type!=="newline"&&I(Q,"TAB_AS_INDENT","Tabs are not allowed as indentation"),Q=null),de.type){case"space":!m&&(g!=="doc-start"||w?.type!=="flow-collection")&&de.source.includes("	")&&(Q=de),j=!0;break;case"comment":{j||I(de,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const me=de.source.substring(1)||" ";G?G+=H+me:G=me,H="",q=!1;break}case"newline":q?G?G+=de.source:(!X||g!=="seq-item-ind")&&(U=!0):H+=de.source,q=!0,V=!0,(J||ie)&&(re=de),j=!0;break;case"anchor":J&&I(de,"MULTIPLE_ANCHORS","A node can have at most one anchor"),de.source.endsWith(":")&&I(de.offset+de.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),J=de,ne??(ne=de.offset),q=!1,j=!1,Z=!0;break;case"tag":{ie&&I(de,"MULTIPLE_TAGS","A node can have at most one tag"),ie=de,ne??(ne=de.offset),q=!1,j=!1,Z=!0;break}case g:(J||ie)&&I(de,"BAD_PROP_ORDER",`Anchors and tags must be after the ${de.source} indicator`),X&&I(de,"UNEXPECTED_TOKEN",`Unexpected ${de.source} in ${m??"collection"}`),X=de,q=g==="seq-item-ind"||g==="explicit-key-ind",j=!1;break;case"comma":if(m){se&&I(de,"UNEXPECTED_TOKEN",`Unexpected , in ${m}`),se=de,q=!1,j=!1;break}default:I(de,"UNEXPECTED_TOKEN",`Unexpected ${de.type} token`),q=!1,j=!1}const ce=d[d.length-1],oe=ce?ce.offset+ce.source.length:$;return Z&&w&&w.type!=="space"&&w.type!=="newline"&&w.type!=="comma"&&(w.type!=="scalar"||w.source!=="")&&I(w.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),Q&&(q&&Q.indent<=D||w?.type==="block-map"||w?.type==="block-seq")&&I(Q,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:se,found:X,spaceBefore:U,comment:G,hasNewline:V,anchor:J,tag:ie,newlineAfterProp:re,end:oe,start:ne??oe}}function containsNewline(d){if(!d)return null;switch(d.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(d.source.includes(`
`))return!0;if(d.end){for(const m of d.end)if(m.type==="newline")return!0}return!1;case"flow-collection":for(const m of d.items){for(const g of m.start)if(g.type==="newline")return!0;if(m.sep){for(const g of m.sep)if(g.type==="newline")return!0}if(containsNewline(m.key)||containsNewline(m.value))return!0}return!1;default:return!0}}function flowIndentCheck(d,m,g){if(m?.type==="flow-collection"){const w=m.end[0];w.indent===d&&(w.source==="]"||w.source==="}")&&containsNewline(m)&&g(w,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function mapIncludes(d,m,g){const{uniqueKeys:w}=d.options;if(w===!1)return!1;const $=typeof w=="function"?w:(I,D)=>I===D||isScalar$1(I)&&isScalar$1(D)&&I.value===D.value;return m.some(I=>$(I.key,g))}const startColMsg="All mapping items must start at the same column";function resolveBlockMap({composeNode:d,composeEmptyNode:m},g,w,$,I){const D=I?.nodeClass??YAMLMap,F=new D(g.schema);g.atRoot&&(g.atRoot=!1);let U=w.offset,q=null;for(const j of w.items){const{start:G,key:H,sep:V,value:Z}=j,Q=resolveProps(G,{indicator:"explicit-key-ind",next:H??V?.[0],offset:U,onError:$,parentIndent:w.indent,startOnNewline:!0}),J=!Q.found;if(J){if(H&&(H.type==="block-seq"?$(U,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in H&&H.indent!==w.indent&&$(U,"BAD_INDENT",startColMsg)),!Q.anchor&&!Q.tag&&!V){q=Q.end,Q.comment&&(F.comment?F.comment+=`
`+Q.comment:F.comment=Q.comment);continue}(Q.newlineAfterProp||containsNewline(H))&&$(H??G[G.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else Q.found?.indent!==w.indent&&$(U,"BAD_INDENT",startColMsg);g.atKey=!0;const ie=Q.end,re=H?d(g,H,Q,$):m(g,ie,G,null,Q,$);g.schema.compat&&flowIndentCheck(w.indent,H,$),g.atKey=!1,mapIncludes(g,F.items,re)&&$(ie,"DUPLICATE_KEY","Map keys must be unique");const se=resolveProps(V??[],{indicator:"map-value-ind",next:Z,offset:re.range[2],onError:$,parentIndent:w.indent,startOnNewline:!H||H.type==="block-scalar"});if(U=se.end,se.found){J&&(Z?.type==="block-map"&&!se.hasNewline&&$(U,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),g.options.strict&&Q.start<se.found.offset-1024&&$(re.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const X=Z?d(g,Z,se,$):m(g,U,V,null,se,$);g.schema.compat&&flowIndentCheck(w.indent,Z,$),U=X.range[2];const ne=new Pair(re,X);g.options.keepSourceTokens&&(ne.srcToken=j),F.items.push(ne)}else{J&&$(re.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),se.comment&&(re.comment?re.comment+=`
`+se.comment:re.comment=se.comment);const X=new Pair(re);g.options.keepSourceTokens&&(X.srcToken=j),F.items.push(X)}}return q&&q<U&&$(q,"IMPOSSIBLE","Map comment with trailing content"),F.range=[w.offset,U,q??U],F}function resolveBlockSeq({composeNode:d,composeEmptyNode:m},g,w,$,I){const D=I?.nodeClass??YAMLSeq,F=new D(g.schema);g.atRoot&&(g.atRoot=!1),g.atKey&&(g.atKey=!1);let U=w.offset,q=null;for(const{start:j,value:G}of w.items){const H=resolveProps(j,{indicator:"seq-item-ind",next:G,offset:U,onError:$,parentIndent:w.indent,startOnNewline:!0});if(!H.found)if(H.anchor||H.tag||G)G&&G.type==="block-seq"?$(H.end,"BAD_INDENT","All sequence items must start at the same column"):$(U,"MISSING_CHAR","Sequence item without - indicator");else{q=H.end,H.comment&&(F.comment=H.comment);continue}const V=G?d(g,G,H,$):m(g,H.end,j,null,H,$);g.schema.compat&&flowIndentCheck(w.indent,G,$),U=V.range[2],F.items.push(V)}return F.range=[w.offset,U,q??U],F}function resolveEnd(d,m,g,w){let $="";if(d){let I=!1,D="";for(const F of d){const{source:U,type:q}=F;switch(q){case"space":I=!0;break;case"comment":{g&&!I&&w(F,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const j=U.substring(1)||" ";$?$+=D+j:$=j,D="";break}case"newline":$&&(D+=U),I=!0;break;default:w(F,"UNEXPECTED_TOKEN",`Unexpected ${q} at node end`)}m+=U.length}}return{comment:$,offset:m}}const blockMsg="Block collections are not allowed within flow collections",isBlock=d=>d&&(d.type==="block-map"||d.type==="block-seq");function resolveFlowCollection({composeNode:d,composeEmptyNode:m},g,w,$,I){const D=w.start.source==="{",F=D?"flow map":"flow sequence",U=I?.nodeClass??(D?YAMLMap:YAMLSeq),q=new U(g.schema);q.flow=!0;const j=g.atRoot;j&&(g.atRoot=!1),g.atKey&&(g.atKey=!1);let G=w.offset+w.start.source.length;for(let J=0;J<w.items.length;++J){const ie=w.items[J],{start:re,key:se,sep:X,value:ne}=ie,ce=resolveProps(re,{flow:F,indicator:"explicit-key-ind",next:se??X?.[0],offset:G,onError:$,parentIndent:w.indent,startOnNewline:!1});if(!ce.found){if(!ce.anchor&&!ce.tag&&!X&&!ne){J===0&&ce.comma?$(ce.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${F}`):J<w.items.length-1&&$(ce.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${F}`),ce.comment&&(q.comment?q.comment+=`
`+ce.comment:q.comment=ce.comment),G=ce.end;continue}!D&&g.options.strict&&containsNewline(se)&&$(se,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(J===0)ce.comma&&$(ce.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${F}`);else if(ce.comma||$(ce.start,"MISSING_CHAR",`Missing , between ${F} items`),ce.comment){let oe="";e:for(const de of re)switch(de.type){case"comma":case"space":break;case"comment":oe=de.source.substring(1);break e;default:break e}if(oe){let de=q.items[q.items.length-1];isPair(de)&&(de=de.value??de.key),de.comment?de.comment+=`
`+oe:de.comment=oe,ce.comment=ce.comment.substring(oe.length+1)}}if(!D&&!X&&!ce.found){const oe=ne?d(g,ne,ce,$):m(g,ce.end,X,null,ce,$);q.items.push(oe),G=oe.range[2],isBlock(ne)&&$(oe.range,"BLOCK_IN_FLOW",blockMsg)}else{g.atKey=!0;const oe=ce.end,de=se?d(g,se,ce,$):m(g,oe,re,null,ce,$);isBlock(se)&&$(de.range,"BLOCK_IN_FLOW",blockMsg),g.atKey=!1;const me=resolveProps(X??[],{flow:F,indicator:"map-value-ind",next:ne,offset:de.range[2],onError:$,parentIndent:w.indent,startOnNewline:!1});if(me.found){if(!D&&!ce.found&&g.options.strict){if(X)for(const xe of X){if(xe===me.found)break;if(xe.type==="newline"){$(xe,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}ce.start<me.found.offset-1024&&$(me.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else ne&&("source"in ne&&ne.source&&ne.source[0]===":"?$(ne,"MISSING_CHAR",`Missing space after : in ${F}`):$(me.start,"MISSING_CHAR",`Missing , or : between ${F} items`));const ge=ne?d(g,ne,me,$):me.found?m(g,me.end,X,null,me,$):null;ge?isBlock(ne)&&$(ge.range,"BLOCK_IN_FLOW",blockMsg):me.comment&&(de.comment?de.comment+=`
`+me.comment:de.comment=me.comment);const fe=new Pair(de,ge);if(g.options.keepSourceTokens&&(fe.srcToken=ie),D){const xe=q;mapIncludes(g,xe.items,de)&&$(oe,"DUPLICATE_KEY","Map keys must be unique"),xe.items.push(fe)}else{const xe=new YAMLMap(g.schema);xe.flow=!0,xe.items.push(fe);const Fe=(ge??de).range;xe.range=[de.range[0],Fe[1],Fe[2]],q.items.push(xe)}G=ge?ge.range[2]:me.end}}const H=D?"}":"]",[V,...Z]=w.end;let Q=G;if(V&&V.source===H)Q=V.offset+V.source.length;else{const J=F[0].toUpperCase()+F.substring(1),ie=j?`${J} must end with a ${H}`:`${J} in block collection must be sufficiently indented and end with a ${H}`;$(G,j?"MISSING_CHAR":"BAD_INDENT",ie),V&&V.source.length!==1&&Z.unshift(V)}if(Z.length>0){const J=resolveEnd(Z,Q,g.options.strict,$);J.comment&&(q.comment?q.comment+=`
`+J.comment:q.comment=J.comment),q.range=[w.offset,Q,J.offset]}else q.range=[w.offset,Q,Q];return q}function resolveCollection(d,m,g,w,$,I){const D=g.type==="block-map"?resolveBlockMap(d,m,g,w,I):g.type==="block-seq"?resolveBlockSeq(d,m,g,w,I):resolveFlowCollection(d,m,g,w,I),F=D.constructor;return $==="!"||$===F.tagName?(D.tag=F.tagName,D):($&&(D.tag=$),D)}function composeCollection(d,m,g,w,$){const I=w.tag,D=I?m.directives.tagName(I.source,H=>$(I,"TAG_RESOLVE_FAILED",H)):null;if(g.type==="block-seq"){const{anchor:H,newlineAfterProp:V}=w,Z=H&&I?H.offset>I.offset?H:I:H??I;Z&&(!V||V.offset<Z.offset)&&$(Z,"MISSING_CHAR","Missing newline after block sequence props")}const F=g.type==="block-map"?"map":g.type==="block-seq"?"seq":g.start.source==="{"?"map":"seq";if(!I||!D||D==="!"||D===YAMLMap.tagName&&F==="map"||D===YAMLSeq.tagName&&F==="seq")return resolveCollection(d,m,g,$,D);let U=m.schema.tags.find(H=>H.tag===D&&H.collection===F);if(!U){const H=m.schema.knownTags[D];if(H&&H.collection===F)m.schema.tags.push(Object.assign({},H,{default:!1})),U=H;else return H?$(I,"BAD_COLLECTION_TYPE",`${H.tag} used for ${F} collection, but expects ${H.collection??"scalar"}`,!0):$(I,"TAG_RESOLVE_FAILED",`Unresolved tag: ${D}`,!0),resolveCollection(d,m,g,$,D)}const q=resolveCollection(d,m,g,$,D,U),j=U.resolve?.(q,H=>$(I,"TAG_RESOLVE_FAILED",H),m.options)??q,G=isNode(j)?j:new Scalar(j);return G.range=q.range,G.tag=D,U?.format&&(G.format=U.format),G}function resolveBlockScalar(d,m,g){const w=m.offset,$=parseBlockScalarHeader(m,d.options.strict,g);if(!$)return{value:"",type:null,comment:"",range:[w,w,w]};const I=$.mode===">"?Scalar.BLOCK_FOLDED:Scalar.BLOCK_LITERAL,D=m.source?splitLines$1(m.source):[];let F=D.length;for(let Q=D.length-1;Q>=0;--Q){const J=D[Q][1];if(J===""||J==="\r")F=Q;else break}if(F===0){const Q=$.chomp==="+"&&D.length>0?`
`.repeat(Math.max(1,D.length-1)):"";let J=w+$.length;return m.source&&(J+=m.source.length),{value:Q,type:I,comment:$.comment,range:[w,J,J]}}let U=m.indent+$.indent,q=m.offset+$.length,j=0;for(let Q=0;Q<F;++Q){const[J,ie]=D[Q];if(ie===""||ie==="\r")$.indent===0&&J.length>U&&(U=J.length);else{J.length<U&&g(q+J.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),$.indent===0&&(U=J.length),j=Q,U===0&&!d.atRoot&&g(q,"BAD_INDENT","Block scalar values in collections must be indented");break}q+=J.length+ie.length+1}for(let Q=D.length-1;Q>=F;--Q)D[Q][0].length>U&&(F=Q+1);let G="",H="",V=!1;for(let Q=0;Q<j;++Q)G+=D[Q][0].slice(U)+`
`;for(let Q=j;Q<F;++Q){let[J,ie]=D[Q];q+=J.length+ie.length+1;const re=ie[ie.length-1]==="\r";if(re&&(ie=ie.slice(0,-1)),ie&&J.length<U){const X=`Block scalar lines must not be less indented than their ${$.indent?"explicit indentation indicator":"first line"}`;g(q-ie.length-(re?2:1),"BAD_INDENT",X),J=""}I===Scalar.BLOCK_LITERAL?(G+=H+J.slice(U)+ie,H=`
`):J.length>U||ie[0]==="	"?(H===" "?H=`
`:!V&&H===`
`&&(H=`

`),G+=H+J.slice(U)+ie,H=`
`,V=!0):ie===""?H===`
`?G+=`
`:H=`
`:(G+=H+ie,H=" ",V=!1)}switch($.chomp){case"-":break;case"+":for(let Q=F;Q<D.length;++Q)G+=`
`+D[Q][0].slice(U);G[G.length-1]!==`
`&&(G+=`
`);break;default:G+=`
`}const Z=w+$.length+m.source.length;return{value:G,type:I,comment:$.comment,range:[w,Z,Z]}}function parseBlockScalarHeader({offset:d,props:m},g,w){if(m[0].type!=="block-scalar-header")return w(m[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:$}=m[0],I=$[0];let D=0,F="",U=-1;for(let H=1;H<$.length;++H){const V=$[H];if(!F&&(V==="-"||V==="+"))F=V;else{const Z=Number(V);!D&&Z?D=Z:U===-1&&(U=d+H)}}U!==-1&&w(U,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${$}`);let q=!1,j="",G=$.length;for(let H=1;H<m.length;++H){const V=m[H];switch(V.type){case"space":q=!0;case"newline":G+=V.source.length;break;case"comment":g&&!q&&w(V,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),G+=V.source.length,j=V.source.substring(1);break;case"error":w(V,"UNEXPECTED_TOKEN",V.message),G+=V.source.length;break;default:{const Z=`Unexpected token in block scalar header: ${V.type}`;w(V,"UNEXPECTED_TOKEN",Z);const Q=V.source;Q&&typeof Q=="string"&&(G+=Q.length)}}}return{mode:I,indent:D,chomp:F,comment:j,length:G}}function splitLines$1(d){const m=d.split(/\n( *)/),g=m[0],w=g.match(/^( *)/),I=[w?.[1]?[w[1],g.slice(w[1].length)]:["",g]];for(let D=1;D<m.length;D+=2)I.push([m[D],m[D+1]]);return I}function resolveFlowScalar(d,m,g){const{offset:w,type:$,source:I,end:D}=d;let F,U;const q=(H,V,Z)=>g(w+H,V,Z);switch($){case"scalar":F=Scalar.PLAIN,U=plainValue(I,q);break;case"single-quoted-scalar":F=Scalar.QUOTE_SINGLE,U=singleQuotedValue(I,q);break;case"double-quoted-scalar":F=Scalar.QUOTE_DOUBLE,U=doubleQuotedValue(I,q);break;default:return g(d,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${$}`),{value:"",type:null,comment:"",range:[w,w+I.length,w+I.length]}}const j=w+I.length,G=resolveEnd(D,j,m,g);return{value:U,type:F,comment:G.comment,range:[w,j,G.offset]}}function plainValue(d,m){let g="";switch(d[0]){case"	":g="a tab character";break;case",":g="flow indicator character ,";break;case"%":g="directive indicator character %";break;case"|":case">":{g=`block scalar indicator ${d[0]}`;break}case"@":case"`":{g=`reserved character ${d[0]}`;break}}return g&&m(0,"BAD_SCALAR_START",`Plain value cannot start with ${g}`),foldLines(d)}function singleQuotedValue(d,m){return(d[d.length-1]!=="'"||d.length===1)&&m(d.length,"MISSING_CHAR","Missing closing 'quote"),foldLines(d.slice(1,-1)).replace(/''/g,"'")}function foldLines(d){let m,g;try{m=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),g=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{m=/(.*?)[ \t]*\r?\n/sy,g=/[ \t]*(.*?)[ \t]*\r?\n/sy}let w=m.exec(d);if(!w)return d;let $=w[1],I=" ",D=m.lastIndex;for(g.lastIndex=D;w=g.exec(d);)w[1]===""?I===`
`?$+=I:I=`
`:($+=I+w[1],I=" "),D=g.lastIndex;const F=/[ \t]*(.*)/sy;return F.lastIndex=D,w=F.exec(d),$+I+(w?.[1]??"")}function doubleQuotedValue(d,m){let g="";for(let w=1;w<d.length-1;++w){const $=d[w];if(!($==="\r"&&d[w+1]===`
`))if($===`
`){const{fold:I,offset:D}=foldNewline(d,w);g+=I,w=D}else if($==="\\"){let I=d[++w];const D=escapeCodes[I];if(D)g+=D;else if(I===`
`)for(I=d[w+1];I===" "||I==="	";)I=d[++w+1];else if(I==="\r"&&d[w+1]===`
`)for(I=d[++w+1];I===" "||I==="	";)I=d[++w+1];else if(I==="x"||I==="u"||I==="U"){const F={x:2,u:4,U:8}[I];g+=parseCharCode(d,w+1,F,m),w+=F}else{const F=d.substr(w-1,2);m(w-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${F}`),g+=F}}else if($===" "||$==="	"){const I=w;let D=d[w+1];for(;D===" "||D==="	";)D=d[++w+1];D!==`
`&&!(D==="\r"&&d[w+2]===`
`)&&(g+=w>I?d.slice(I,w+1):$)}else g+=$}return(d[d.length-1]!=='"'||d.length===1)&&m(d.length,"MISSING_CHAR",'Missing closing "quote'),g}function foldNewline(d,m){let g="",w=d[m+1];for(;(w===" "||w==="	"||w===`
`||w==="\r")&&!(w==="\r"&&d[m+2]!==`
`);)w===`
`&&(g+=`
`),m+=1,w=d[m+1];return g||(g=" "),{fold:g,offset:m}}const escapeCodes={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"Â…",_:"Â ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function parseCharCode(d,m,g,w){const $=d.substr(m,g),D=$.length===g&&/^[0-9a-fA-F]+$/.test($)?parseInt($,16):NaN;if(isNaN(D)){const F=d.substr(m-2,g+2);return w(m-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${F}`),F}return String.fromCodePoint(D)}function composeScalar(d,m,g,w){const{value:$,type:I,comment:D,range:F}=m.type==="block-scalar"?resolveBlockScalar(d,m,w):resolveFlowScalar(m,d.options.strict,w),U=g?d.directives.tagName(g.source,G=>w(g,"TAG_RESOLVE_FAILED",G)):null;let q;d.options.stringKeys&&d.atKey?q=d.schema[SCALAR$1]:U?q=findScalarTagByName(d.schema,$,U,g,w):m.type==="scalar"?q=findScalarTagByTest(d,$,m,w):q=d.schema[SCALAR$1];let j;try{const G=q.resolve($,H=>w(g??m,"TAG_RESOLVE_FAILED",H),d.options);j=isScalar$1(G)?G:new Scalar(G)}catch(G){const H=G instanceof Error?G.message:String(G);w(g??m,"TAG_RESOLVE_FAILED",H),j=new Scalar($)}return j.range=F,j.source=$,I&&(j.type=I),U&&(j.tag=U),q.format&&(j.format=q.format),D&&(j.comment=D),j}function findScalarTagByName(d,m,g,w,$){if(g==="!")return d[SCALAR$1];const I=[];for(const F of d.tags)if(!F.collection&&F.tag===g)if(F.default&&F.test)I.push(F);else return F;for(const F of I)if(F.test?.test(m))return F;const D=d.knownTags[g];return D&&!D.collection?(d.tags.push(Object.assign({},D,{default:!1,test:void 0})),D):($(w,"TAG_RESOLVE_FAILED",`Unresolved tag: ${g}`,g!=="tag:yaml.org,2002:str"),d[SCALAR$1])}function findScalarTagByTest({atKey:d,directives:m,schema:g},w,$,I){const D=g.tags.find(F=>(F.default===!0||d&&F.default==="key")&&F.test?.test(w))||g[SCALAR$1];if(g.compat){const F=g.compat.find(U=>U.default&&U.test?.test(w))??g[SCALAR$1];if(D.tag!==F.tag){const U=m.tagString(D.tag),q=m.tagString(F.tag),j=`Value may be parsed as either ${U} or ${q}`;I($,"TAG_RESOLVE_FAILED",j,!0)}}return D}function emptyScalarPosition(d,m,g){if(m){g??(g=m.length);for(let w=g-1;w>=0;--w){let $=m[w];switch($.type){case"space":case"comment":case"newline":d-=$.source.length;continue}for($=m[++w];$?.type==="space";)d+=$.source.length,$=m[++w];break}}return d}const CN={composeNode,composeEmptyNode};function composeNode(d,m,g,w){const $=d.atKey,{spaceBefore:I,comment:D,anchor:F,tag:U}=g;let q,j=!0;switch(m.type){case"alias":q=composeAlias(d,m,w),(F||U)&&w(m,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":q=composeScalar(d,m,U,w),F&&(q.anchor=F.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":q=composeCollection(CN,d,m,g,w),F&&(q.anchor=F.source.substring(1));break;default:{const G=m.type==="error"?m.message:`Unsupported token (type: ${m.type})`;w(m,"UNEXPECTED_TOKEN",G),q=composeEmptyNode(d,m.offset,void 0,null,g,w),j=!1}}return F&&q.anchor===""&&w(F,"BAD_ALIAS","Anchor cannot be an empty string"),$&&d.options.stringKeys&&(!isScalar$1(q)||typeof q.value!="string"||q.tag&&q.tag!=="tag:yaml.org,2002:str")&&w(U??m,"NON_STRING_KEY","With stringKeys, all keys must be strings"),I&&(q.spaceBefore=!0),D&&(m.type==="scalar"&&m.source===""?q.comment=D:q.commentBefore=D),d.options.keepSourceTokens&&j&&(q.srcToken=m),q}function composeEmptyNode(d,m,g,w,{spaceBefore:$,comment:I,anchor:D,tag:F,end:U},q){const j={type:"scalar",offset:emptyScalarPosition(m,g,w),indent:-1,source:""},G=composeScalar(d,j,F,q);return D&&(G.anchor=D.source.substring(1),G.anchor===""&&q(D,"BAD_ALIAS","Anchor cannot be an empty string")),$&&(G.spaceBefore=!0),I&&(G.comment=I,G.range[2]=U),G}function composeAlias({options:d},{offset:m,source:g,end:w},$){const I=new Alias(g.substring(1));I.source===""&&$(m,"BAD_ALIAS","Alias cannot be an empty string"),I.source.endsWith(":")&&$(m+g.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const D=m+g.length,F=resolveEnd(w,D,d.strict,$);return I.range=[m,D,F.offset],F.comment&&(I.comment=F.comment),I}function composeDoc(d,m,{offset:g,start:w,value:$,end:I},D){const F=Object.assign({_directives:m},d),U=new Document(void 0,F),q={atKey:!1,atRoot:!0,directives:U.directives,options:U.options,schema:U.schema},j=resolveProps(w,{indicator:"doc-start",next:$??I?.[0],offset:g,onError:D,parentIndent:0,startOnNewline:!0});j.found&&(U.directives.docStart=!0,$&&($.type==="block-map"||$.type==="block-seq")&&!j.hasNewline&&D(j.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),U.contents=$?composeNode(q,$,j,D):composeEmptyNode(q,j.end,w,null,j,D);const G=U.contents.range[2],H=resolveEnd(I,G,!1,D);return H.comment&&(U.comment=H.comment),U.range=[g,G,H.offset],U}function getErrorPos(d){if(typeof d=="number")return[d,d+1];if(Array.isArray(d))return d.length===2?d:[d[0],d[1]];const{offset:m,source:g}=d;return[m,m+(typeof g=="string"?g.length:1)]}function parsePrelude(d){let m="",g=!1,w=!1;for(let $=0;$<d.length;++$){const I=d[$];switch(I[0]){case"#":m+=(m===""?"":w?`

`:`
`)+(I.substring(1)||" "),g=!0,w=!1;break;case"%":d[$+1]?.[0]!=="#"&&($+=1),g=!1;break;default:g||(w=!0),g=!1}}return{comment:m,afterEmptyLine:w}}class Composer{constructor(m={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(g,w,$,I)=>{const D=getErrorPos(g);I?this.warnings.push(new YAMLWarning(D,w,$)):this.errors.push(new YAMLParseError(D,w,$))},this.directives=new Directives({version:m.version||"1.2"}),this.options=m}decorate(m,g){const{comment:w,afterEmptyLine:$}=parsePrelude(this.prelude);if(w){const I=m.contents;if(g)m.comment=m.comment?`${m.comment}
${w}`:w;else if($||m.directives.docStart||!I)m.commentBefore=w;else if(isCollection$1(I)&&!I.flow&&I.items.length>0){let D=I.items[0];isPair(D)&&(D=D.key);const F=D.commentBefore;D.commentBefore=F?`${w}
${F}`:w}else{const D=I.commentBefore;I.commentBefore=D?`${w}
${D}`:w}}g?(Array.prototype.push.apply(m.errors,this.errors),Array.prototype.push.apply(m.warnings,this.warnings)):(m.errors=this.errors,m.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:parsePrelude(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(m,g=!1,w=-1){for(const $ of m)yield*this.next($);yield*this.end(g,w)}*next(m){switch(m.type){case"directive":this.directives.add(m.source,(g,w,$)=>{const I=getErrorPos(m);I[0]+=g,this.onError(I,"BAD_DIRECTIVE",w,$)}),this.prelude.push(m.source),this.atDirectives=!0;break;case"document":{const g=composeDoc(this.options,this.directives,m,this.onError);this.atDirectives&&!g.directives.docStart&&this.onError(m,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(g,!1),this.doc&&(yield this.doc),this.doc=g,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(m.source);break;case"error":{const g=m.source?`${m.message}: ${JSON.stringify(m.source)}`:m.message,w=new YAMLParseError(getErrorPos(m),"UNEXPECTED_TOKEN",g);this.atDirectives||!this.doc?this.errors.push(w):this.doc.errors.push(w);break}case"doc-end":{if(!this.doc){const w="Unexpected doc-end without preceding document";this.errors.push(new YAMLParseError(getErrorPos(m),"UNEXPECTED_TOKEN",w));break}this.doc.directives.docEnd=!0;const g=resolveEnd(m.end,m.offset+m.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),g.comment){const w=this.doc.comment;this.doc.comment=w?`${w}
${g.comment}`:g.comment}this.doc.range[2]=g.offset;break}default:this.errors.push(new YAMLParseError(getErrorPos(m),"UNEXPECTED_TOKEN",`Unsupported token ${m.type}`))}}*end(m=!1,g=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(m){const w=Object.assign({_directives:this.directives},this.options),$=new Document(void 0,w);this.atDirectives&&this.onError(g,"MISSING_CHAR","Missing directives-end indicator line"),$.range=[0,g,g],this.decorate($,!1),yield $}}}function resolveAsScalar(d,m=!0,g){if(d){const w=($,I,D)=>{const F=typeof $=="number"?$:Array.isArray($)?$[0]:$.offset;if(g)g(F,I,D);else throw new YAMLParseError([F,F+1],I,D)};switch(d.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return resolveFlowScalar(d,m,w);case"block-scalar":return resolveBlockScalar({options:{strict:m}},d,w)}}return null}function createScalarToken(d,m){const{implicitKey:g=!1,indent:w,inFlow:$=!1,offset:I=-1,type:D="PLAIN"}=m,F=stringifyString({type:D,value:d},{implicitKey:g,indent:w>0?" ".repeat(w):"",inFlow:$,options:{blockQuote:!0,lineWidth:-1}}),U=m.end??[{type:"newline",offset:-1,indent:w,source:`
`}];switch(F[0]){case"|":case">":{const q=F.indexOf(`
`),j=F.substring(0,q),G=F.substring(q+1)+`
`,H=[{type:"block-scalar-header",offset:I,indent:w,source:j}];return addEndtoBlockProps(H,U)||H.push({type:"newline",offset:-1,indent:w,source:`
`}),{type:"block-scalar",offset:I,indent:w,props:H,source:G}}case'"':return{type:"double-quoted-scalar",offset:I,indent:w,source:F,end:U};case"'":return{type:"single-quoted-scalar",offset:I,indent:w,source:F,end:U};default:return{type:"scalar",offset:I,indent:w,source:F,end:U}}}function setScalarValue(d,m,g={}){let{afterKey:w=!1,implicitKey:$=!1,inFlow:I=!1,type:D}=g,F="indent"in d?d.indent:null;if(w&&typeof F=="number"&&(F+=2),!D)switch(d.type){case"single-quoted-scalar":D="QUOTE_SINGLE";break;case"double-quoted-scalar":D="QUOTE_DOUBLE";break;case"block-scalar":{const q=d.props[0];if(q.type!=="block-scalar-header")throw new Error("Invalid block scalar header");D=q.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:D="PLAIN"}const U=stringifyString({type:D,value:m},{implicitKey:$||F===null,indent:F!==null&&F>0?" ".repeat(F):"",inFlow:I,options:{blockQuote:!0,lineWidth:-1}});switch(U[0]){case"|":case">":setBlockScalarValue(d,U);break;case'"':setFlowScalarValue(d,U,"double-quoted-scalar");break;case"'":setFlowScalarValue(d,U,"single-quoted-scalar");break;default:setFlowScalarValue(d,U,"scalar")}}function setBlockScalarValue(d,m){const g=m.indexOf(`
`),w=m.substring(0,g),$=m.substring(g+1)+`
`;if(d.type==="block-scalar"){const I=d.props[0];if(I.type!=="block-scalar-header")throw new Error("Invalid block scalar header");I.source=w,d.source=$}else{const{offset:I}=d,D="indent"in d?d.indent:-1,F=[{type:"block-scalar-header",offset:I,indent:D,source:w}];addEndtoBlockProps(F,"end"in d?d.end:void 0)||F.push({type:"newline",offset:-1,indent:D,source:`
`});for(const U of Object.keys(d))U!=="type"&&U!=="offset"&&delete d[U];Object.assign(d,{type:"block-scalar",indent:D,props:F,source:$})}}function addEndtoBlockProps(d,m){if(m)for(const g of m)switch(g.type){case"space":case"comment":d.push(g);break;case"newline":return d.push(g),!0}return!1}function setFlowScalarValue(d,m,g){switch(d.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":d.type=g,d.source=m;break;case"block-scalar":{const w=d.props.slice(1);let $=m.length;d.props[0].type==="block-scalar-header"&&($-=d.props[0].source.length);for(const I of w)I.offset+=$;delete d.props,Object.assign(d,{type:g,source:m,end:w});break}case"block-map":case"block-seq":{const $={type:"newline",offset:d.offset+m.length,indent:d.indent,source:`
`};delete d.items,Object.assign(d,{type:g,source:m,end:[$]});break}default:{const w="indent"in d?d.indent:-1,$="end"in d&&Array.isArray(d.end)?d.end.filter(I=>I.type==="space"||I.type==="comment"||I.type==="newline"):[];for(const I of Object.keys(d))I!=="type"&&I!=="offset"&&delete d[I];Object.assign(d,{type:g,indent:w,source:m,end:$})}}}const stringify$2=d=>"type"in d?stringifyToken(d):stringifyItem(d);function stringifyToken(d){switch(d.type){case"block-scalar":{let m="";for(const g of d.props)m+=stringifyToken(g);return m+d.source}case"block-map":case"block-seq":{let m="";for(const g of d.items)m+=stringifyItem(g);return m}case"flow-collection":{let m=d.start.source;for(const g of d.items)m+=stringifyItem(g);for(const g of d.end)m+=g.source;return m}case"document":{let m=stringifyItem(d);if(d.end)for(const g of d.end)m+=g.source;return m}default:{let m=d.source;if("end"in d&&d.end)for(const g of d.end)m+=g.source;return m}}}function stringifyItem({start:d,key:m,sep:g,value:w}){let $="";for(const I of d)$+=I.source;if(m&&($+=stringifyToken(m)),g)for(const I of g)$+=I.source;return w&&($+=stringifyToken(w)),$}const BREAK=Symbol("break visit"),SKIP=Symbol("skip children"),REMOVE=Symbol("remove item");function visit$2(d,m){"type"in d&&d.type==="document"&&(d={start:d.start,value:d.value}),_visit(Object.freeze([]),d,m)}visit$2.BREAK=BREAK;visit$2.SKIP=SKIP;visit$2.REMOVE=REMOVE;visit$2.itemAtPath=(d,m)=>{let g=d;for(const[w,$]of m){const I=g?.[w];if(I&&"items"in I)g=I.items[$];else return}return g};visit$2.parentCollection=(d,m)=>{const g=visit$2.itemAtPath(d,m.slice(0,-1)),w=m[m.length-1][0],$=g?.[w];if($&&"items"in $)return $;throw new Error("Parent collection not found")};function _visit(d,m,g){let w=g(m,d);if(typeof w=="symbol")return w;for(const $ of["key","value"]){const I=m[$];if(I&&"items"in I){for(let D=0;D<I.items.length;++D){const F=_visit(Object.freeze(d.concat([[$,D]])),I.items[D],g);if(typeof F=="number")D=F-1;else{if(F===BREAK)return BREAK;F===REMOVE&&(I.items.splice(D,1),D-=1)}}typeof w=="function"&&$==="key"&&(w=w(m,d))}}return typeof w=="function"?w(m,d):w}const BOM="\uFEFF",DOCUMENT="",FLOW_END="",SCALAR="",isCollection=d=>!!d&&"items"in d,isScalar=d=>!!d&&(d.type==="scalar"||d.type==="single-quoted-scalar"||d.type==="double-quoted-scalar"||d.type==="block-scalar");function prettyToken(d){switch(d){case BOM:return"<BOM>";case DOCUMENT:return"<DOC>";case FLOW_END:return"<FLOW_END>";case SCALAR:return"<SCALAR>";default:return JSON.stringify(d)}}function tokenType(d){switch(d){case BOM:return"byte-order-mark";case DOCUMENT:return"doc-mode";case FLOW_END:return"flow-error-end";case SCALAR:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(d[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}var cst=Object.freeze({__proto__:null,BOM,DOCUMENT,FLOW_END,SCALAR,createScalarToken,isCollection,isScalar,prettyToken,resolveAsScalar,setScalarValue,stringify:stringify$2,tokenType,visit:visit$2});function isEmpty(d){switch(d){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const hexDigits=new Set("0123456789ABCDEFabcdef"),tagChars=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),flowIndicatorChars=new Set(",[]{}"),invalidAnchorChars=new Set(` ,[]{}
\r	`),isNotAnchorChar=d=>!d||invalidAnchorChars.has(d);class Lexer{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(m,g=!1){if(m){if(typeof m!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+m:m,this.lineEndPos=null}this.atEnd=!g;let w=this.next??"stream";for(;w&&(g||this.hasChars(1));)w=yield*this.parseNext(w)}atLineEnd(){let m=this.pos,g=this.buffer[m];for(;g===" "||g==="	";)g=this.buffer[++m];return!g||g==="#"||g===`
`?!0:g==="\r"?this.buffer[m+1]===`
`:!1}charAt(m){return this.buffer[this.pos+m]}continueScalar(m){let g=this.buffer[m];if(this.indentNext>0){let w=0;for(;g===" ";)g=this.buffer[++w+m];if(g==="\r"){const $=this.buffer[w+m+1];if($===`
`||!$&&!this.atEnd)return m+w+1}return g===`
`||w>=this.indentNext||!g&&!this.atEnd?m+w:-1}if(g==="-"||g==="."){const w=this.buffer.substr(m,3);if((w==="---"||w==="...")&&isEmpty(this.buffer[m+3]))return-1}return m}getLine(){let m=this.lineEndPos;return(typeof m!="number"||m!==-1&&m<this.pos)&&(m=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=m),m===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[m-1]==="\r"&&(m-=1),this.buffer.substring(this.pos,m))}hasChars(m){return this.pos+m<=this.buffer.length}setNext(m){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=m,null}peek(m){return this.buffer.substr(this.pos,m)}*parseNext(m){switch(m){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let m=this.getLine();if(m===null)return this.setNext("stream");if(m[0]===BOM&&(yield*this.pushCount(1),m=m.substring(1)),m[0]==="%"){let g=m.length,w=m.indexOf("#");for(;w!==-1;){const I=m[w-1];if(I===" "||I==="	"){g=w-1;break}else w=m.indexOf("#",w+1)}for(;;){const I=m[g-1];if(I===" "||I==="	")g-=1;else break}const $=(yield*this.pushCount(g))+(yield*this.pushSpaces(!0));return yield*this.pushCount(m.length-$),this.pushNewline(),"stream"}if(this.atLineEnd()){const g=yield*this.pushSpaces(!0);return yield*this.pushCount(m.length-g),yield*this.pushNewline(),"stream"}return yield DOCUMENT,yield*this.parseLineStart()}*parseLineStart(){const m=this.charAt(0);if(!m&&!this.atEnd)return this.setNext("line-start");if(m==="-"||m==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const g=this.peek(3);if((g==="---"||g==="...")&&isEmpty(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,g==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!isEmpty(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[m,g]=this.peek(2);if(!g&&!this.atEnd)return this.setNext("block-start");if((m==="-"||m==="?"||m===":")&&isEmpty(g)){const w=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=w,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const m=this.getLine();if(m===null)return this.setNext("doc");let g=yield*this.pushIndicators();switch(m[g]){case"#":yield*this.pushCount(m.length-g);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(isNotAnchorChar),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return g+=yield*this.parseBlockScalarHeader(),g+=yield*this.pushSpaces(!0),yield*this.pushCount(m.length-g),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let m,g,w=-1;do m=yield*this.pushNewline(),m>0?(g=yield*this.pushSpaces(!1),this.indentValue=w=g):g=0,g+=yield*this.pushSpaces(!0);while(m+g>0);const $=this.getLine();if($===null)return this.setNext("flow");if((w!==-1&&w<this.indentNext&&$[0]!=="#"||w===0&&($.startsWith("---")||$.startsWith("..."))&&isEmpty($[3]))&&!(w===this.indentNext-1&&this.flowLevel===1&&($[0]==="]"||$[0]==="}")))return this.flowLevel=0,yield FLOW_END,yield*this.parseLineStart();let I=0;for(;$[I]===",";)I+=yield*this.pushCount(1),I+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(I+=yield*this.pushIndicators(),$[I]){case void 0:return"flow";case"#":return yield*this.pushCount($.length-I),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(isNotAnchorChar),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const D=this.charAt(1);if(this.flowKey||isEmpty(D)||D===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const m=this.charAt(0);let g=this.buffer.indexOf(m,this.pos+1);if(m==="'")for(;g!==-1&&this.buffer[g+1]==="'";)g=this.buffer.indexOf("'",g+2);else for(;g!==-1;){let I=0;for(;this.buffer[g-1-I]==="\\";)I+=1;if(I%2===0)break;g=this.buffer.indexOf('"',g+1)}const w=this.buffer.substring(0,g);let $=w.indexOf(`
`,this.pos);if($!==-1){for(;$!==-1;){const I=this.continueScalar($+1);if(I===-1)break;$=w.indexOf(`
`,I)}$!==-1&&(g=$-(w[$-1]==="\r"?2:1))}if(g===-1){if(!this.atEnd)return this.setNext("quoted-scalar");g=this.buffer.length}return yield*this.pushToIndex(g+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let m=this.pos;for(;;){const g=this.buffer[++m];if(g==="+")this.blockScalarKeep=!0;else if(g>"0"&&g<="9")this.blockScalarIndent=Number(g)-1;else if(g!=="-")break}return yield*this.pushUntil(g=>isEmpty(g)||g==="#")}*parseBlockScalar(){let m=this.pos-1,g=0,w;e:for(let I=this.pos;w=this.buffer[I];++I)switch(w){case" ":g+=1;break;case`
`:m=I,g=0;break;case"\r":{const D=this.buffer[I+1];if(!D&&!this.atEnd)return this.setNext("block-scalar");if(D===`
`)break}default:break e}if(!w&&!this.atEnd)return this.setNext("block-scalar");if(g>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=g:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const I=this.continueScalar(m+1);if(I===-1)break;m=this.buffer.indexOf(`
`,I)}while(m!==-1);if(m===-1){if(!this.atEnd)return this.setNext("block-scalar");m=this.buffer.length}}let $=m+1;for(w=this.buffer[$];w===" ";)w=this.buffer[++$];if(w==="	"){for(;w==="	"||w===" "||w==="\r"||w===`
`;)w=this.buffer[++$];m=$-1}else if(!this.blockScalarKeep)do{let I=m-1,D=this.buffer[I];D==="\r"&&(D=this.buffer[--I]);const F=I;for(;D===" ";)D=this.buffer[--I];if(D===`
`&&I>=this.pos&&I+1+g>F)m=I;else break}while(!0);return yield SCALAR,yield*this.pushToIndex(m+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const m=this.flowLevel>0;let g=this.pos-1,w=this.pos-1,$;for(;$=this.buffer[++w];)if($===":"){const I=this.buffer[w+1];if(isEmpty(I)||m&&flowIndicatorChars.has(I))break;g=w}else if(isEmpty($)){let I=this.buffer[w+1];if($==="\r"&&(I===`
`?(w+=1,$=`
`,I=this.buffer[w+1]):g=w),I==="#"||m&&flowIndicatorChars.has(I))break;if($===`
`){const D=this.continueScalar(w+1);if(D===-1)break;w=Math.max(w,D-2)}}else{if(m&&flowIndicatorChars.has($))break;g=w}return!$&&!this.atEnd?this.setNext("plain-scalar"):(yield SCALAR,yield*this.pushToIndex(g+1,!0),m?"flow":"doc")}*pushCount(m){return m>0?(yield this.buffer.substr(this.pos,m),this.pos+=m,m):0}*pushToIndex(m,g){const w=this.buffer.slice(this.pos,m);return w?(yield w,this.pos+=w.length,w.length):(g&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(isNotAnchorChar))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const m=this.flowLevel>0,g=this.charAt(1);if(isEmpty(g)||m&&flowIndicatorChars.has(g))return m?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let m=this.pos+2,g=this.buffer[m];for(;!isEmpty(g)&&g!==">";)g=this.buffer[++m];return yield*this.pushToIndex(g===">"?m+1:m,!1)}else{let m=this.pos+1,g=this.buffer[m];for(;g;)if(tagChars.has(g))g=this.buffer[++m];else if(g==="%"&&hexDigits.has(this.buffer[m+1])&&hexDigits.has(this.buffer[m+2]))g=this.buffer[m+=3];else break;return yield*this.pushToIndex(m,!1)}}*pushNewline(){const m=this.buffer[this.pos];return m===`
`?yield*this.pushCount(1):m==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(m){let g=this.pos-1,w;do w=this.buffer[++g];while(w===" "||m&&w==="	");const $=g-this.pos;return $>0&&(yield this.buffer.substr(this.pos,$),this.pos=g),$}*pushUntil(m){let g=this.pos,w=this.buffer[g];for(;!m(w);)w=this.buffer[++g];return yield*this.pushToIndex(g,!1)}}class LineCounter{constructor(){this.lineStarts=[],this.addNewLine=m=>this.lineStarts.push(m),this.linePos=m=>{let g=0,w=this.lineStarts.length;for(;g<w;){const I=g+w>>1;this.lineStarts[I]<m?g=I+1:w=I}if(this.lineStarts[g]===m)return{line:g+1,col:1};if(g===0)return{line:0,col:m};const $=this.lineStarts[g-1];return{line:g,col:m-$+1}}}}function includesToken(d,m){for(let g=0;g<d.length;++g)if(d[g].type===m)return!0;return!1}function findNonEmptyIndex(d){for(let m=0;m<d.length;++m)switch(d[m].type){case"space":case"comment":case"newline":break;default:return m}return-1}function isFlowToken(d){switch(d?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function getPrevProps(d){switch(d.type){case"document":return d.start;case"block-map":{const m=d.items[d.items.length-1];return m.sep??m.start}case"block-seq":return d.items[d.items.length-1].start;default:return[]}}function getFirstKeyStartProps(d){if(d.length===0)return[];let m=d.length;e:for(;--m>=0;)switch(d[m].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;d[++m]?.type==="space";);return d.splice(m,d.length)}function fixFlowSeqItems(d){if(d.start.type==="flow-seq-start")for(const m of d.items)m.sep&&!m.value&&!includesToken(m.start,"explicit-key-ind")&&!includesToken(m.sep,"map-value-ind")&&(m.key&&(m.value=m.key),delete m.key,isFlowToken(m.value)?m.value.end?Array.prototype.push.apply(m.value.end,m.sep):m.value.end=m.sep:Array.prototype.push.apply(m.start,m.sep),delete m.sep)}let Parser$2=class{constructor(m){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Lexer,this.onNewLine=m}*parse(m,g=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const w of this.lexer.lex(m,g))yield*this.next(w);g||(yield*this.end())}*next(m){if(this.source=m,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=m.length;return}const g=tokenType(m);if(g)if(g==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=g,yield*this.step(),g){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+m.length);break;case"space":this.atNewLine&&m[0]===" "&&(this.indent+=m.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=m.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=m.length}else{const w=`Not a YAML token: ${m}`;yield*this.pop({type:"error",offset:this.offset,message:w,source:m}),this.offset+=m.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const m=this.peek(1);if(this.type==="doc-end"&&(!m||m.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!m)return yield*this.stream();switch(m.type){case"document":return yield*this.document(m);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(m);case"block-scalar":return yield*this.blockScalar(m);case"block-map":return yield*this.blockMap(m);case"block-seq":return yield*this.blockSequence(m);case"flow-collection":return yield*this.flowCollection(m);case"doc-end":return yield*this.documentEnd(m)}yield*this.pop()}peek(m){return this.stack[this.stack.length-m]}*pop(m){const g=m??this.stack.pop();if(!g)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield g;else{const w=this.peek(1);switch(g.type==="block-scalar"?g.indent="indent"in w?w.indent:0:g.type==="flow-collection"&&w.type==="document"&&(g.indent=0),g.type==="flow-collection"&&fixFlowSeqItems(g),w.type){case"document":w.value=g;break;case"block-scalar":w.props.push(g);break;case"block-map":{const $=w.items[w.items.length-1];if($.value){w.items.push({start:[],key:g,sep:[]}),this.onKeyLine=!0;return}else if($.sep)$.value=g;else{Object.assign($,{key:g,sep:[]}),this.onKeyLine=!$.explicitKey;return}break}case"block-seq":{const $=w.items[w.items.length-1];$.value?w.items.push({start:[],value:g}):$.value=g;break}case"flow-collection":{const $=w.items[w.items.length-1];!$||$.value?w.items.push({start:[],key:g,sep:[]}):$.sep?$.value=g:Object.assign($,{key:g,sep:[]});return}default:yield*this.pop(),yield*this.pop(g)}if((w.type==="document"||w.type==="block-map"||w.type==="block-seq")&&(g.type==="block-map"||g.type==="block-seq")){const $=g.items[g.items.length-1];$&&!$.sep&&!$.value&&$.start.length>0&&findNonEmptyIndex($.start)===-1&&(g.indent===0||$.start.every(I=>I.type!=="comment"||I.indent<g.indent))&&(w.type==="document"?w.end=$.start:w.items.push({start:$.start}),g.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const m={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&m.start.push(this.sourceToken),this.stack.push(m);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(m){if(m.value)return yield*this.lineEnd(m);switch(this.type){case"doc-start":{findNonEmptyIndex(m.start)!==-1?(yield*this.pop(),yield*this.step()):m.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":m.start.push(this.sourceToken);return}const g=this.startBlockValue(m);g?this.stack.push(g):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(m){if(this.type==="map-value-ind"){const g=getPrevProps(this.peek(2)),w=getFirstKeyStartProps(g);let $;m.end?($=m.end,$.push(this.sourceToken),delete m.end):$=[this.sourceToken];const I={type:"block-map",offset:m.offset,indent:m.indent,items:[{start:w,key:m,sep:$}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=I}else yield*this.lineEnd(m)}*blockScalar(m){switch(this.type){case"space":case"comment":case"newline":m.props.push(this.sourceToken);return;case"scalar":if(m.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let g=this.source.indexOf(`
`)+1;for(;g!==0;)this.onNewLine(this.offset+g),g=this.source.indexOf(`
`,g)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(m){const g=m.items[m.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,g.value){const w="end"in g.value?g.value.end:void 0;(Array.isArray(w)?w[w.length-1]:void 0)?.type==="comment"?w?.push(this.sourceToken):m.items.push({start:[this.sourceToken]})}else g.sep?g.sep.push(this.sourceToken):g.start.push(this.sourceToken);return;case"space":case"comment":if(g.value)m.items.push({start:[this.sourceToken]});else if(g.sep)g.sep.push(this.sourceToken);else{if(this.atIndentedComment(g.start,m.indent)){const $=m.items[m.items.length-2]?.value?.end;if(Array.isArray($)){Array.prototype.push.apply($,g.start),$.push(this.sourceToken),m.items.pop();return}}g.start.push(this.sourceToken)}return}if(this.indent>=m.indent){const w=!this.onKeyLine&&this.indent===m.indent,$=w&&(g.sep||g.explicitKey)&&this.type!=="seq-item-ind";let I=[];if($&&g.sep&&!g.value){const D=[];for(let F=0;F<g.sep.length;++F){const U=g.sep[F];switch(U.type){case"newline":D.push(F);break;case"space":break;case"comment":U.indent>m.indent&&(D.length=0);break;default:D.length=0}}D.length>=2&&(I=g.sep.splice(D[1]))}switch(this.type){case"anchor":case"tag":$||g.value?(I.push(this.sourceToken),m.items.push({start:I}),this.onKeyLine=!0):g.sep?g.sep.push(this.sourceToken):g.start.push(this.sourceToken);return;case"explicit-key-ind":!g.sep&&!g.explicitKey?(g.start.push(this.sourceToken),g.explicitKey=!0):$||g.value?(I.push(this.sourceToken),m.items.push({start:I,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(g.explicitKey)if(g.sep)if(g.value)m.items.push({start:[],key:null,sep:[this.sourceToken]});else if(includesToken(g.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:I,key:null,sep:[this.sourceToken]}]});else if(isFlowToken(g.key)&&!includesToken(g.sep,"newline")){const D=getFirstKeyStartProps(g.start),F=g.key,U=g.sep;U.push(this.sourceToken),delete g.key,delete g.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:D,key:F,sep:U}]})}else I.length>0?g.sep=g.sep.concat(I,this.sourceToken):g.sep.push(this.sourceToken);else if(includesToken(g.start,"newline"))Object.assign(g,{key:null,sep:[this.sourceToken]});else{const D=getFirstKeyStartProps(g.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:D,key:null,sep:[this.sourceToken]}]})}else g.sep?g.value||$?m.items.push({start:I,key:null,sep:[this.sourceToken]}):includesToken(g.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):g.sep.push(this.sourceToken):Object.assign(g,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const D=this.flowScalar(this.type);$||g.value?(m.items.push({start:I,key:D,sep:[]}),this.onKeyLine=!0):g.sep?this.stack.push(D):(Object.assign(g,{key:D,sep:[]}),this.onKeyLine=!0);return}default:{const D=this.startBlockValue(m);if(D){if(D.type==="block-seq"){if(!g.explicitKey&&g.sep&&!includesToken(g.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else w&&m.items.push({start:I});this.stack.push(D);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(m){const g=m.items[m.items.length-1];switch(this.type){case"newline":if(g.value){const w="end"in g.value?g.value.end:void 0;(Array.isArray(w)?w[w.length-1]:void 0)?.type==="comment"?w?.push(this.sourceToken):m.items.push({start:[this.sourceToken]})}else g.start.push(this.sourceToken);return;case"space":case"comment":if(g.value)m.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(g.start,m.indent)){const $=m.items[m.items.length-2]?.value?.end;if(Array.isArray($)){Array.prototype.push.apply($,g.start),$.push(this.sourceToken),m.items.pop();return}}g.start.push(this.sourceToken)}return;case"anchor":case"tag":if(g.value||this.indent<=m.indent)break;g.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==m.indent)break;g.value||includesToken(g.start,"seq-item-ind")?m.items.push({start:[this.sourceToken]}):g.start.push(this.sourceToken);return}if(this.indent>m.indent){const w=this.startBlockValue(m);if(w){this.stack.push(w);return}}yield*this.pop(),yield*this.step()}*flowCollection(m){const g=m.items[m.items.length-1];if(this.type==="flow-error-end"){let w;do yield*this.pop(),w=this.peek(1);while(w&&w.type==="flow-collection")}else if(m.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!g||g.sep?m.items.push({start:[this.sourceToken]}):g.start.push(this.sourceToken);return;case"map-value-ind":!g||g.value?m.items.push({start:[],key:null,sep:[this.sourceToken]}):g.sep?g.sep.push(this.sourceToken):Object.assign(g,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!g||g.value?m.items.push({start:[this.sourceToken]}):g.sep?g.sep.push(this.sourceToken):g.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const $=this.flowScalar(this.type);!g||g.value?m.items.push({start:[],key:$,sep:[]}):g.sep?this.stack.push($):Object.assign(g,{key:$,sep:[]});return}case"flow-map-end":case"flow-seq-end":m.end.push(this.sourceToken);return}const w=this.startBlockValue(m);w?this.stack.push(w):(yield*this.pop(),yield*this.step())}else{const w=this.peek(2);if(w.type==="block-map"&&(this.type==="map-value-ind"&&w.indent===m.indent||this.type==="newline"&&!w.items[w.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&w.type!=="flow-collection"){const $=getPrevProps(w),I=getFirstKeyStartProps($);fixFlowSeqItems(m);const D=m.end.splice(1,m.end.length);D.push(this.sourceToken);const F={type:"block-map",offset:m.offset,indent:m.indent,items:[{start:I,key:m,sep:D}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=F}else yield*this.lineEnd(m)}}flowScalar(m){if(this.onNewLine){let g=this.source.indexOf(`
`)+1;for(;g!==0;)this.onNewLine(this.offset+g),g=this.source.indexOf(`
`,g)+1}return{type:m,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(m){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const g=getPrevProps(m),w=getFirstKeyStartProps(g);return w.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:w,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const g=getPrevProps(m),w=getFirstKeyStartProps(g);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:w,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(m,g){return this.type!=="comment"||this.indent<=g?!1:m.every(w=>w.type==="newline"||w.type==="space")}*documentEnd(m){this.type!=="doc-mode"&&(m.end?m.end.push(this.sourceToken):m.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(m){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:m.end?m.end.push(this.sourceToken):m.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}};function parseOptions(d){const m=d.prettyErrors!==!1;return{lineCounter:d.lineCounter||m&&new LineCounter||null,prettyErrors:m}}function parseAllDocuments(d,m={}){const{lineCounter:g,prettyErrors:w}=parseOptions(m),$=new Parser$2(g?.addNewLine),I=new Composer(m),D=Array.from(I.compose($.parse(d)));if(w&&g)for(const F of D)F.errors.forEach(prettifyError(d,g)),F.warnings.forEach(prettifyError(d,g));return D.length>0?D:Object.assign([],{empty:!0},I.streamInfo())}function parseDocument(d,m={}){const{lineCounter:g,prettyErrors:w}=parseOptions(m),$=new Parser$2(g?.addNewLine),I=new Composer(m);let D=null;for(const F of I.compose($.parse(d),!0,d.length))if(!D)D=F;else if(D.options.logLevel!=="silent"){D.errors.push(new YAMLParseError(F.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return w&&g&&(D.errors.forEach(prettifyError(d,g)),D.warnings.forEach(prettifyError(d,g))),D}function parse$1(d,m,g){let w;typeof m=="function"?w=m:g===void 0&&m&&typeof m=="object"&&(g=m);const $=parseDocument(d,g);if(!$)return null;if($.warnings.forEach(I=>warn($.options.logLevel,I)),$.errors.length>0){if($.options.logLevel!=="silent")throw $.errors[0];$.errors=[]}return $.toJS(Object.assign({reviver:w},g))}function stringify$1(d,m,g){let w=null;if(typeof m=="function"||Array.isArray(m)?w=m:g===void 0&&m&&(g=m),typeof g=="string"&&(g=g.length),typeof g=="number"){const $=Math.round(g);g=$<1?void 0:$>8?{indent:8}:{indent:$}}if(d===void 0){const{keepUndefined:$}=g??m??{};if(!$)return}return isDocument(d)&&!w?d.toString(g):new Document(d,w,g).toString(g)}var YAML=Object.freeze({__proto__:null,Alias,CST:cst,Composer,Document,Lexer,LineCounter,Pair,Parser:Parser$2,Scalar,Schema,YAMLError,YAMLMap,YAMLParseError,YAMLSeq,YAMLWarning,isAlias,isCollection:isCollection$1,isDocument,isMap,isNode,isPair,isScalar:isScalar$1,isSeq,parse:parse$1,parseAllDocuments,parseDocument,stringify:stringify$1,visit:visit$3,visitAsync});function stringifyWithToplevelOrdering(d,m,g,w){let $=[...w];$=["$schema",...$];const I=(D,F)=>F===null||Array.isArray(F)||typeof F!="object"?F:Object.keys(F).every(U=>$.includes(U))?Object.fromEntries($.map(U=>[U,F[U]])):F;return JSON.stringify({$schema:m,...g},I,2)}var jpeg$3,hasRequiredJpeg;function requireJpeg(){return hasRequiredJpeg||(hasRequiredJpeg=1,jpeg$3={parseSections:function(d,m){var g,w;for(d.setBigEndian(!0);d.remainingLength()>0&&w!==218;){if(d.nextUInt8()!==255)throw new Error("Invalid JPEG section offset");w=d.nextUInt8(),w>=208&&w<=217||w===218?g=0:g=d.nextUInt16()-2,m(w,d.branch(0,g)),d.skip(g)}},getSizeFromSOFSection:function(d){return d.skip(1),{height:d.nextUInt16(),width:d.nextUInt16()}},getSectionName:function(d){var m,g;switch(d){case 216:m="SOI";break;case 196:m="DHT";break;case 219:m="DQT";break;case 221:m="DRI";break;case 218:m="SOS";break;case 254:m="COM";break;case 217:m="EOI";break;default:d>=224&&d<=239?(m="APP",g=d-224):d>=192&&d<=207&&d!==196&&d!==200&&d!==204?(m="SOF",g=d-192):d>=208&&d<=215&&(m="RST",g=d-208);break}var w={name:m};return typeof g=="number"&&(w.index=g),w}}),jpeg$3}var exif$3,hasRequiredExif;function requireExif(){if(hasRequiredExif)return exif$3;hasRequiredExif=1;function d(I,D){switch(I){case 1:return D.nextUInt8();case 3:return D.nextUInt16();case 4:return D.nextUInt32();case 5:return[D.nextUInt32(),D.nextUInt32()];case 6:return D.nextInt8();case 8:return D.nextUInt16();case 9:return D.nextUInt32();case 10:return[D.nextInt32(),D.nextInt32()];case 11:return D.nextFloat();case 12:return D.nextDouble();default:throw new Error("Invalid format while decoding: "+I)}}function m(I){switch(I){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function g(I,D){var F=D.nextUInt16(),U=D.nextUInt16(),q=m(U),j=D.nextUInt32(),G=q*j,H,V;if(G>4&&(D=I.openWithOffset(D.nextUInt32())),U===2){H=D.nextString(j);var Z=H.indexOf("\0");Z!==-1&&(H=H.substr(0,Z))}else if(U===7)H=D.nextBuffer(j);else if(U!==0)for(H=[],V=0;V<j;++V)H.push(d(U,D));return G<4&&D.skip(4-G),[F,H,U]}function w(I,D,F){var U=D.nextUInt16(),q,j;for(j=0;j<U;++j)q=g(I,D),F(q[0],q[1],q[2])}function $(I){var D=I.nextString(6);if(D!=="Exif\0\0")throw new Error("Invalid EXIF header");var F=I.mark(),U=I.nextUInt16();if(U===18761)I.setBigEndian(!1);else if(U===19789)I.setBigEndian(!0);else throw new Error("Invalid TIFF header");if(I.nextUInt16()!==42)throw new Error("Invalid TIFF data");return F}return exif$3={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(I,D){var F;try{F=$(I)}catch{return!1}var U,q,j,G=F.openWithOffset(I.nextUInt32()),H=this.IFD0;w(F,G,function(se,X,ne){switch(se){case 34853:q=X[0];break;case 34665:U=X[0];break;default:D(H,se,X,ne);break}});var V=G.nextUInt32();if(V!==0){var Z=F.openWithOffset(V);w(F,Z,D.bind(null,this.IFD1))}if(q){var Q=F.openWithOffset(q);w(F,Q,D.bind(null,this.GPSIFD))}if(U){var J=F.openWithOffset(U),ie=this.InteropIFD;w(F,J,function(se,X,ne){se===40965?j=X[0]:D(ie,se,X,ne)})}if(j){var re=F.openWithOffset(j);w(F,re,D.bind(null,this.InteropIFD))}return!0}},exif$3}var date$2,hasRequiredDate;function requireDate(){if(hasRequiredDate)return date$2;hasRequiredDate=1;function d(F){return parseInt(F,10)}var m=3600,g=60;function w(F,U){F=F.map(d),U=U.map(d);var q=F[0],j=F[1]-1,G=F[2],H=U[0],V=U[1],Z=U[2],Q=Date.UTC(q,j,G,H,V,Z,0),J=Q/1e3;return J}function $(F){var U=F.substr(0,10).split("-"),q=F.substr(11,8).split(":"),j=F.substr(19,6),G=j.split(":").map(d),H=G[0]*m+G[1]*g,V=w(U,q);if(V-=H,typeof V=="number"&&!isNaN(V))return V}function I(F){var U=F.split(" "),q=U[0].split(":"),j=U[1].split(":"),G=w(q,j);if(typeof G=="number"&&!isNaN(G))return G}function D(F){var U=F.length===19&&F.charAt(4)===":",q=F.length===25&&F.charAt(10)==="T";if(q)return $(F);if(U)return I(F)}return date$2={parseDateWithSpecFormat:I,parseDateWithTimezoneFormat:$,parseExifDate:D},date$2}var simplify$2,hasRequiredSimplify;function requireSimplify(){if(hasRequiredSimplify)return simplify$2;hasRequiredSimplify=1;var d=requireExif(),m=requireDate(),g=[{section:d.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:d.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],w=[{section:d.SubIFD,type:306,name:"ModifyDate"},{section:d.SubIFD,type:36867,name:"DateTimeOriginal"},{section:d.SubIFD,type:36868,name:"CreateDate"},{section:d.SubIFD,type:306,name:"ModifyDate"}];return simplify$2={castDegreeValues:function($,I){g.forEach(function(D){var F=$(D);if(F){var U=$({section:D.section,type:D.refType,name:D.refName}),q=U===D.posVal?1:-1,j=(F[0]+F[1]/60+F[2]/3600)*q;I(D,j)}})},castDateValues:function($,I){w.forEach(function(D){var F=$(D);if(F){var U=m.parseExifDate(F);typeof U<"u"&&I(D,U)}})},simplifyValue:function($,I){return Array.isArray($)&&($=$.map(function(D){return I===10||I===5?D[0]/D[1]:D}),$.length===1&&($=$[0])),$}},simplify$2}var exifTags$1,hasRequiredExifTags$1;function requireExifTags$1(){return hasRequiredExifTags$1||(hasRequiredExifTags$1=1,exifTags$1={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}}),exifTags$1}var parser$1,hasRequiredParser;function requireParser(){if(hasRequiredParser)return parser$1;hasRequiredParser=1;var d=requireJpeg(),m=requireExif(),g=requireSimplify();function w(I,D,F,U,q,j,G){this.startMarker=I,this.tags=D,this.imageSize=F,this.thumbnailOffset=U,this.thumbnailLength=q,this.thumbnailType=j,this.app1Offset=G}w.prototype={hasThumbnail:function(I){return!this.thumbnailOffset||!this.thumbnailLength?!1:typeof I!="string"?!0:I.toLowerCase().trim()==="image/jpeg"?this.thumbnailType===6:I.toLowerCase().trim()==="image/tiff"?this.thumbnailType===1:!1},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var I=this._getThumbnailStream(),D;return d.parseSections(I,function(F,U){d.getSectionName(F).name==="SOF"&&(D=d.getSizeFromSOFSection(U))}),D}};function $(I){this.stream=I,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}return $.prototype={enableBinaryFields:function(I){return this.flags.readBinaryTags=!!I,this},enablePointers:function(I){return this.flags.hidePointers=!I,this},enableTagNames:function(I){return this.flags.resolveTagNames=!!I,this},enableImageSize:function(I){return this.flags.imageSize=!!I,this},enableReturnTags:function(I){return this.flags.returnTags=!!I,this},enableSimpleValues:function(I){return this.flags.simplifyValues=!!I,this},parse:function(){var I=this.stream.mark(),D=I.openWithOffset(0),F=this.flags,U,q,j,G,H,V,Z,Q,J;return F.resolveTagNames&&(Z=requireExifTags$1()),F.resolveTagNames?(U={},Q=function(ie){return U[ie.name]},J=function(ie,re){U[ie.name]=re}):(U=[],Q=function(ie){var re;for(re=0;re<U.length;++re)if(U[re].type===ie.type&&U[re].section===ie.section)return U.value},J=function(ie,re){var se;for(se=0;se<U.length;++se)if(U[se].type===ie.type&&U[se].section===ie.section){U.value=re;return}}),d.parseSections(D,function(ie,re){var se,X=re.offsetFrom(I);ie===225?(se=m.parseTags(re,function(ne,ce,oe,de){if(!(!F.readBinaryTags&&de===7)){if(ce===513){if(j=oe[0],F.hidePointers)return}else if(ce===514){if(G=oe[0],F.hidePointers)return}else if(ce===259&&(H=oe[0],F.hidePointers))return;if(F.returnTags)if(F.simplifyValues&&(oe=g.simplifyValue(oe,de)),F.resolveTagNames){var me=ne===m.GPSIFD?Z.gps:Z.exif,ge=me[ce];ge||(ge=Z.exif[ce]),U.hasOwnProperty(ge)||(U[ge]=oe)}else U.push({section:ne,type:ce,value:oe})}}),se&&(V=X)):F.imageSize&&d.getSectionName(ie).name==="SOF"&&(q=d.getSizeFromSOFSection(re))}),F.simplifyValues&&(g.castDegreeValues(Q,J),g.castDateValues(Q,J)),new w(I,U,q,j,G,H,V)}},parser$1=$,parser$1}var domBufferstream$1,hasRequiredDomBufferstream$1;function requireDomBufferstream$1(){if(hasRequiredDomBufferstream$1)return domBufferstream$1;hasRequiredDomBufferstream$1=1;function d(m,g,w,$,I,D){this.global=I,g=g||0,w=w||m.byteLength-g,this.arrayBuffer=m.slice(g,g+w),this.view=new I.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian($),this.offset=0,this.parentOffset=(D||0)+g}return d.prototype={setBigEndian:function(m){this.littleEndian=!m},nextUInt8:function(){var m=this.view.getUint8(this.offset);return this.offset+=1,m},nextInt8:function(){var m=this.view.getInt8(this.offset);return this.offset+=1,m},nextUInt16:function(){var m=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,m},nextUInt32:function(){var m=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,m},nextInt16:function(){var m=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,m},nextInt32:function(){var m=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,m},nextFloat:function(){var m=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,m},nextDouble:function(){var m=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,m},nextBuffer:function(m){var g=this.arrayBuffer.slice(this.offset,this.offset+m);return this.offset+=m,g},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(m){var g=this.arrayBuffer.slice(this.offset,this.offset+m);return g=String.fromCharCode.apply(null,new this.global.Uint8Array(g)),this.offset+=m,g},mark:function(){var m=this;return{openWithOffset:function(g){return g=(g||0)+this.offset,new d(m.arrayBuffer,g,m.arrayBuffer.byteLength-g,!m.littleEndian,m.global,m.parentOffset)},offset:this.offset,getParentOffset:function(){return m.parentOffset}}},offsetFrom:function(m){return this.parentOffset+this.offset-(m.offset+m.getParentOffset())},skip:function(m){this.offset+=m},branch:function(m,g){return g=typeof g=="number"?g:this.arrayBuffer.byteLength-(this.offset+m),new d(this.arrayBuffer,this.offset+m,g,!this.littleEndian,this.global,this.parentOffset)}},domBufferstream$1=d,domBufferstream$1}var bufferstream$1,hasRequiredBufferstream$1;function requireBufferstream$1(){if(hasRequiredBufferstream$1)return bufferstream$1;hasRequiredBufferstream$1=1;function d(m,g,w,$){this.buffer=m,this.offset=g||0,w=typeof w=="number"?w:m.length,this.endPosition=this.offset+w,this.setBigEndian($)}return d.prototype={setBigEndian:function(m){this.bigEndian=!!m},nextUInt8:function(){var m=this.buffer.readUInt8(this.offset);return this.offset+=1,m},nextInt8:function(){var m=this.buffer.readInt8(this.offset);return this.offset+=1,m},nextUInt16:function(){var m=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,m},nextUInt32:function(){var m=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,m},nextInt16:function(){var m=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,m},nextInt32:function(){var m=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,m},nextFloat:function(){var m=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,m},nextDouble:function(){var m=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,m},nextBuffer:function(m){var g=this.buffer.slice(this.offset,this.offset+m);return this.offset+=m,g},remainingLength:function(){return this.endPosition-this.offset},nextString:function(m){var g=this.buffer.toString("utf8",this.offset,this.offset+m);return this.offset+=m,g},mark:function(){var m=this;return{openWithOffset:function(g){return g=(g||0)+this.offset,new d(m.buffer,g,m.endPosition-g,m.bigEndian)},offset:this.offset}},offsetFrom:function(m){return this.offset-m.offset},skip:function(m){this.offset+=m},branch:function(m,g){return g=typeof g=="number"?g:this.endPosition-(this.offset+m),new d(this.buffer,this.offset+m,g,this.bigEndian)}},bufferstream$1=d,bufferstream$1}var exifParser$1,hasRequiredExifParser;function requireExifParser(){if(hasRequiredExifParser)return exifParser$1;hasRequiredExifParser=1;var d=requireParser();function m(){return(0,eval)("this")}return exifParser$1={create:function(g,w){if(w=w||m(),g instanceof w.ArrayBuffer){var $=requireDomBufferstream$1();return new d(new $(g,0,g.byteLength,!0,w))}else{var I=requireBufferstream$1();return new d(new I(g,0,g.length,!0))}}},exifParser$1}requireExifParser();var piexif$1={exports:{}},hasRequiredPiexif;function requirePiexif(){return hasRequiredPiexif||(hasRequiredPiexif=1,(function(d,m){(function(){var g={};g.version="1.0.4",g.remove=function(ne){var ce=!1;if(ne.slice(0,2)!="Ã¿Ã˜")if(ne.slice(0,23)=="data:image/jpeg;base64,"||ne.slice(0,22)=="data:image/jpg;base64,")ne=H(ne.split(",")[1]),ce=!0;else throw new Error("Given data is not jpeg.");var oe=J(ne),de=oe.filter(function(ge){return!(ge.slice(0,2)=="Ã¿Ã¡"&&ge.slice(4,10)=="Exif\0\0")}),me=de.join("");return ce&&(me="data:image/jpeg;base64,"+G(me)),me},g.insert=function(ne,ce){var oe=!1;if(ne.slice(0,6)!="Exif\0\0")throw new Error("Given data is not exif.");if(ce.slice(0,2)!="Ã¿Ã˜")if(ce.slice(0,23)=="data:image/jpeg;base64,"||ce.slice(0,22)=="data:image/jpg;base64,")ce=H(ce.split(",")[1]),oe=!0;else throw new Error("Given data is not jpeg.");var de="Ã¿Ã¡"+V(">H",[ne.length+2])+ne,me=J(ce),ge=re(me,de);return oe&&(ge="data:image/jpeg;base64,"+G(ge)),ge},g.load=function(ne){var ce;if(typeof ne=="string")if(ne.slice(0,2)=="Ã¿Ã˜")ce=ne;else if(ne.slice(0,23)=="data:image/jpeg;base64,"||ne.slice(0,22)=="data:image/jpg;base64,")ce=H(ne.split(",")[1]);else if(ne.slice(0,4)=="Exif")ce=ne.slice(6);else throw new Error("'load' gots invalid file data.");else throw new Error("'load' gots invalid type argument.");var oe={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},de=new j(ce);if(de.tiftag===null)return oe;de.tiftag.slice(0,2)=="II"?de.endian_mark="<":de.endian_mark=">";var me=Z(de.endian_mark+"L",de.tiftag.slice(4,8))[0];oe["0th"]=de.get_ifd(me,"0th");var ge=oe["0th"].first_ifd_pointer;if(delete oe["0th"].first_ifd_pointer,34665 in oe["0th"]&&(me=oe["0th"][34665],oe.Exif=de.get_ifd(me,"Exif")),34853 in oe["0th"]&&(me=oe["0th"][34853],oe.GPS=de.get_ifd(me,"GPS")),40965 in oe.Exif&&(me=oe.Exif[40965],oe.Interop=de.get_ifd(me,"Interop")),ge!="\0\0\0\0"&&(me=Z(de.endian_mark+"L",ge)[0],oe["1st"]=de.get_ifd(me,"1st"),513 in oe["1st"]&&514 in oe["1st"])){var fe=oe["1st"][513]+oe["1st"][514],xe=de.tiftag.slice(oe["1st"][513],fe);oe.thumbnail=xe}return oe},g.dump=function(ne){var ce=8,oe=w(ne),de="Exif\0\0MM\0*\0\0\0\b",me=!1,ge=!1,fe=!1,xe=!1,Fe,Te,Oe,Be,_t;"0th"in oe?Fe=oe["0th"]:Fe={},"Exif"in oe&&Object.keys(oe.Exif).length||"Interop"in oe&&Object.keys(oe.Interop).length?(Fe[34665]=1,me=!0,Te=oe.Exif,"Interop"in oe&&Object.keys(oe.Interop).length?(Te[40965]=1,fe=!0,Oe=oe.Interop):Object.keys(Te).indexOf(g.ExifIFD.InteroperabilityTag.toString())>-1&&delete Te[40965]):Object.keys(Fe).indexOf(g.ImageIFD.ExifTag.toString())>-1&&delete Fe[34665],"GPS"in oe&&Object.keys(oe.GPS).length?(Fe[g.ImageIFD.GPSTag]=1,ge=!0,Be=oe.GPS):Object.keys(Fe).indexOf(g.ImageIFD.GPSTag.toString())>-1&&delete Fe[g.ImageIFD.GPSTag],"1st"in oe&&"thumbnail"in oe&&oe.thumbnail!=null&&(xe=!0,oe["1st"][513]=1,oe["1st"][514]=1,_t=oe["1st"]);var Et=q(Fe,"0th",0),dt=Et[0].length+me*12+ge*12+4+Et[1].length,Zt,Ye="",bt=0,Qt,Vt="",ut=0,At,dr="",fr=0,pr,zt="",Ce;if(me&&(Zt=q(Te,"Exif",dt),bt=Zt[0].length+fe*12+Zt[1].length),ge&&(Qt=q(Be,"GPS",dt+bt),Vt=Qt.join(""),ut=Vt.length),fe){var Nt=dt+bt+ut;At=q(Oe,"Interop",Nt),dr=At.join(""),fr=dr.length}if(xe){var Nt=dt+bt+ut+fr;if(pr=q(_t,"1st",Nt),Ce=$(oe.thumbnail),Ce.length>64e3)throw new Error("Given thumbnail is too large. max 64kB")}var Xe="",lt="",st="",yt="\0\0\0\0";if(me){var Yt=ce+dt,$e=V(">L",[Yt]),ze=34665,ft=V(">H",[ze]),ht=V(">H",[se.Long]),gr=V(">L",[1]);Xe=ft+ht+gr+$e}if(ge){var Yt=ce+dt+bt,$e=V(">L",[Yt]),ze=34853,ft=V(">H",[ze]),ht=V(">H",[se.Long]),gr=V(">L",[1]);lt=ft+ht+gr+$e}if(fe){var Yt=ce+dt+bt+ut,$e=V(">L",[Yt]),ze=40965,ft=V(">H",[ze]),ht=V(">H",[se.Long]),gr=V(">L",[1]);st=ft+ht+gr+$e}if(xe){var Yt=ce+dt+bt+ut+fr;yt=V(">L",[Yt]);var yr=Yt+pr[0].length+24+4+pr[1].length,li="\0\0\0\0"+V(">L",[yr]),fi="\0\0\0\0"+V(">L",[Ce.length]);zt=pr[0]+li+fi+"\0\0\0\0"+pr[1]+Ce}var ai=Et[0]+Xe+lt+yt+Et[1];return me&&(Ye=Zt[0]+st+Zt[1]),de+ai+Ye+Vt+dr+zt};function w(ne){return JSON.parse(JSON.stringify(ne))}function $(ne){for(var ce=J(ne);"Ã¿Ã "<=ce[1].slice(0,2)&&ce[1].slice(0,2)<="Ã¿Ã¯";)ce=[ce[0]].concat(ce.slice(2));return ce.join("")}function I(ne){return V(">"+Q("B",ne.length),ne)}function D(ne){return V(">"+Q("H",ne.length),ne)}function F(ne){return V(">"+Q("L",ne.length),ne)}function U(ne,ce,oe){var de="",me="",ge,fe,xe,Fe;if(ce=="Byte")ge=ne.length,ge<=4?me=I(ne)+Q("\0",4-ge):(me=V(">L",[oe]),de=I(ne));else if(ce=="Short")ge=ne.length,ge<=2?me=D(ne)+Q("\0\0",2-ge):(me=V(">L",[oe]),de=D(ne));else if(ce=="Long")ge=ne.length,ge<=1?me=F(ne):(me=V(">L",[oe]),de=F(ne));else if(ce=="Ascii")fe=ne+"\0",ge=fe.length,ge>4?(me=V(">L",[oe]),de=fe):me=fe+Q("\0",4-ge);else if(ce=="Rational"){if(typeof ne[0]=="number")ge=1,xe=ne[0],Fe=ne[1],fe=V(">L",[xe])+V(">L",[Fe]);else{ge=ne.length,fe="";for(var Te=0;Te<ge;Te++)xe=ne[Te][0],Fe=ne[Te][1],fe+=V(">L",[xe])+V(">L",[Fe])}me=V(">L",[oe]),de=fe}else if(ce=="SRational"){if(typeof ne[0]=="number")ge=1,xe=ne[0],Fe=ne[1],fe=V(">l",[xe])+V(">l",[Fe]);else{ge=ne.length,fe="";for(var Te=0;Te<ge;Te++)xe=ne[Te][0],Fe=ne[Te][1],fe+=V(">l",[xe])+V(">l",[Fe])}me=V(">L",[oe]),de=fe}else ce=="Undefined"&&(ge=ne.length,ge>4?(me=V(">L",[oe]),de=ne):me=ne+Q("\0",4-ge));var Oe=V(">L",[ge]);return[Oe,me,de]}function q(ne,ce,oe){var de=8,me=Object.keys(ne).length,ge=V(">H",[me]),fe;["0th","1st"].indexOf(ce)>-1?fe=2+me*12+4:fe=2+me*12;var xe="",Fe="",Te;for(var Te in ne)if(typeof Te=="string"&&(Te=parseInt(Te)),!(ce=="0th"&&[34665,34853].indexOf(Te)>-1)){{if(ce=="Exif"&&Te==40965)continue;if(ce=="1st"&&[513,514].indexOf(Te)>-1)continue}var Oe=ne[Te],Be=V(">H",[Te]),_t=X[ce][Te].type,Et=V(">H",[se[_t]]);typeof Oe=="number"&&(Oe=[Oe]);var dt=de+fe+oe+Fe.length,Zt=U(Oe,_t,dt),Ye=Zt[0],bt=Zt[1],Qt=Zt[2];xe+=Be+Et+Ye+bt,Fe+=Qt}return[ge+xe,Fe]}function j(ne){var ce,oe;if(ne.slice(0,2)=="Ã¿Ã˜")ce=J(ne),oe=ie(ce),oe?this.tiftag=oe.slice(10):this.tiftag=null;else if(["II","MM"].indexOf(ne.slice(0,2))>-1)this.tiftag=ne;else if(ne.slice(0,4)=="Exif")this.tiftag=ne.slice(6);else throw new Error("Given file is neither JPEG nor TIFF.")}if(j.prototype={get_ifd:function(ne,ce){var oe={},de=Z(this.endian_mark+"H",this.tiftag.slice(ne,ne+2))[0],me=ne+2,ge;["0th","1st"].indexOf(ce)>-1?ge="Image":ge=ce;for(var fe=0;fe<de;fe++){ne=me+12*fe;var xe=Z(this.endian_mark+"H",this.tiftag.slice(ne,ne+2))[0],Fe=Z(this.endian_mark+"H",this.tiftag.slice(ne+2,ne+4))[0],Te=Z(this.endian_mark+"L",this.tiftag.slice(ne+4,ne+8))[0],Oe=this.tiftag.slice(ne+8,ne+12),Be=[Fe,Te,Oe];xe in X[ge]&&(oe[xe]=this.convert_value(Be))}return ce=="0th"&&(ne=me+12*de,oe.first_ifd_pointer=this.tiftag.slice(ne,ne+4)),oe},convert_value:function(ne){var ce=null,oe=ne[0],de=ne[1],me=ne[2],ge;if(oe==1)de>4?(ge=Z(this.endian_mark+"L",me)[0],ce=Z(this.endian_mark+Q("B",de),this.tiftag.slice(ge,ge+de))):ce=Z(this.endian_mark+Q("B",de),me.slice(0,de));else if(oe==2)de>4?(ge=Z(this.endian_mark+"L",me)[0],ce=this.tiftag.slice(ge,ge+de-1)):ce=me.slice(0,de-1);else if(oe==3)de>2?(ge=Z(this.endian_mark+"L",me)[0],ce=Z(this.endian_mark+Q("H",de),this.tiftag.slice(ge,ge+de*2))):ce=Z(this.endian_mark+Q("H",de),me.slice(0,de*2));else if(oe==4)de>1?(ge=Z(this.endian_mark+"L",me)[0],ce=Z(this.endian_mark+Q("L",de),this.tiftag.slice(ge,ge+de*4))):ce=Z(this.endian_mark+Q("L",de),me);else if(oe==5)if(ge=Z(this.endian_mark+"L",me)[0],de>1){ce=[];for(var fe=0;fe<de;fe++)ce.push([Z(this.endian_mark+"L",this.tiftag.slice(ge+fe*8,ge+4+fe*8))[0],Z(this.endian_mark+"L",this.tiftag.slice(ge+4+fe*8,ge+8+fe*8))[0]])}else ce=[Z(this.endian_mark+"L",this.tiftag.slice(ge,ge+4))[0],Z(this.endian_mark+"L",this.tiftag.slice(ge+4,ge+8))[0]];else if(oe==7)de>4?(ge=Z(this.endian_mark+"L",me)[0],ce=this.tiftag.slice(ge,ge+de)):ce=me.slice(0,de);else if(oe==9)de>1?(ge=Z(this.endian_mark+"L",me)[0],ce=Z(this.endian_mark+Q("l",de),this.tiftag.slice(ge,ge+de*4))):ce=Z(this.endian_mark+Q("l",de),me);else if(oe==10)if(ge=Z(this.endian_mark+"L",me)[0],de>1){ce=[];for(var fe=0;fe<de;fe++)ce.push([Z(this.endian_mark+"l",this.tiftag.slice(ge+fe*8,ge+4+fe*8))[0],Z(this.endian_mark+"l",this.tiftag.slice(ge+4+fe*8,ge+8+fe*8))[0]])}else ce=[Z(this.endian_mark+"l",this.tiftag.slice(ge,ge+4))[0],Z(this.endian_mark+"l",this.tiftag.slice(ge+4,ge+8))[0]];else throw new Error("Exif might be wrong. Got incorrect value type to decode. type:"+oe);return ce instanceof Array&&ce.length==1?ce[0]:ce}},typeof window<"u"&&typeof window.btoa=="function")var G=window.btoa;if(typeof G>"u")var G=function(ce){for(var oe="",de,me,ge,fe,xe,Fe,Te,Oe=0,Be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";Oe<ce.length;)de=ce.charCodeAt(Oe++),me=ce.charCodeAt(Oe++),ge=ce.charCodeAt(Oe++),fe=de>>2,xe=(de&3)<<4|me>>4,Fe=(me&15)<<2|ge>>6,Te=ge&63,isNaN(me)?Fe=Te=64:isNaN(ge)&&(Te=64),oe=oe+Be.charAt(fe)+Be.charAt(xe)+Be.charAt(Fe)+Be.charAt(Te);return oe};if(typeof window<"u"&&typeof window.atob=="function")var H=window.atob;if(typeof H>"u")var H=function(ce){var oe="",de,me,ge,fe,xe,Fe,Te,Oe=0,Be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(ce=ce.replace(/[^A-Za-z0-9\+\/\=]/g,"");Oe<ce.length;)fe=Be.indexOf(ce.charAt(Oe++)),xe=Be.indexOf(ce.charAt(Oe++)),Fe=Be.indexOf(ce.charAt(Oe++)),Te=Be.indexOf(ce.charAt(Oe++)),de=fe<<2|xe>>4,me=(xe&15)<<4|Fe>>2,ge=(Fe&3)<<6|Te,oe=oe+String.fromCharCode(de),Fe!=64&&(oe=oe+String.fromCharCode(me)),Te!=64&&(oe=oe+String.fromCharCode(ge));return oe};function V(ne,ce){if(!(ce instanceof Array))throw new Error("'pack' error. Got invalid type argument.");if(ne.length-1!=ce.length)throw new Error("'pack' error. "+(ne.length-1)+" marks, "+ce.length+" elements.");var oe;if(ne[0]=="<")oe=!0;else if(ne[0]==">")oe=!1;else throw new Error("");for(var de="",me=1,ge=null,fe=null,xe=null;fe=ne[me];){if(fe.toLowerCase()=="b"){if(ge=ce[me-1],fe=="b"&&ge<0&&(ge+=256),ge>255||ge<0)throw new Error("'pack' error.");xe=String.fromCharCode(ge)}else if(fe=="H"){if(ge=ce[me-1],ge>65535||ge<0)throw new Error("'pack' error.");xe=String.fromCharCode(Math.floor(ge%65536/256))+String.fromCharCode(ge%256),oe&&(xe=xe.split("").reverse().join(""))}else if(fe.toLowerCase()=="l"){if(ge=ce[me-1],fe=="l"&&ge<0&&(ge+=4294967296),ge>4294967295||ge<0)throw new Error("'pack' error.");xe=String.fromCharCode(Math.floor(ge/16777216))+String.fromCharCode(Math.floor(ge%16777216/65536))+String.fromCharCode(Math.floor(ge%65536/256))+String.fromCharCode(ge%256),oe&&(xe=xe.split("").reverse().join(""))}else throw new Error("'pack' error.");de+=xe,me+=1}return de}function Z(ne,ce){if(typeof ce!="string")throw new Error("'unpack' error. Got invalid type argument.");for(var oe=0,de=1;de<ne.length;de++)if(ne[de].toLowerCase()=="b")oe+=1;else if(ne[de].toLowerCase()=="h")oe+=2;else if(ne[de].toLowerCase()=="l")oe+=4;else throw new Error("'unpack' error. Got invalid mark.");if(oe!=ce.length)throw new Error("'unpack' error. Mismatch between symbol and string length. "+oe+":"+ce.length);var me;if(ne[0]=="<")me=!0;else if(ne[0]==">")me=!1;else throw new Error("'unpack' error.");for(var ge=[],fe=0,xe=1,Fe=null,Te=null,Oe=null,Be="";Te=ne[xe];){if(Te.toLowerCase()=="b")Oe=1,Be=ce.slice(fe,fe+Oe),Fe=Be.charCodeAt(0),Te=="b"&&Fe>=128&&(Fe-=256);else if(Te=="H")Oe=2,Be=ce.slice(fe,fe+Oe),me&&(Be=Be.split("").reverse().join("")),Fe=Be.charCodeAt(0)*256+Be.charCodeAt(1);else if(Te.toLowerCase()=="l")Oe=4,Be=ce.slice(fe,fe+Oe),me&&(Be=Be.split("").reverse().join("")),Fe=Be.charCodeAt(0)*16777216+Be.charCodeAt(1)*65536+Be.charCodeAt(2)*256+Be.charCodeAt(3),Te=="l"&&Fe>=2147483648&&(Fe-=4294967296);else throw new Error("'unpack' error. "+Te);ge.push(Fe),fe+=Oe,xe+=1}return ge}function Q(ne,ce){for(var oe="",de=0;de<ce;de++)oe+=ne;return oe}function J(ne){if(ne.slice(0,2)!="Ã¿Ã˜")throw new Error("Given data isn't JPEG.");for(var ce=2,oe=["Ã¿Ã˜"];;){if(ne.slice(ce,ce+2)=="Ã¿Ãš"){oe.push(ne.slice(ce));break}else{var de=Z(">H",ne.slice(ce+2,ce+4))[0],me=ce+de+2;oe.push(ne.slice(ce,me)),ce=me}if(ce>=ne.length)throw new Error("Wrong JPEG data.")}return oe}function ie(ne){for(var ce,oe=0;oe<ne.length;oe++)if(ce=ne[oe],ce.slice(0,2)=="Ã¿Ã¡"&&ce.slice(4,10)=="Exif\0\0")return ce;return null}function re(ne,ce){var oe=!1,de=[];return ne.forEach(function(me,ge){me.slice(0,2)=="Ã¿Ã¡"&&me.slice(4,10)=="Exif\0\0"&&(oe?de.unshift(ge):(ne[ge]=ce,oe=!0))}),de.forEach(function(me){ne.splice(me,1)}),!oe&&ce&&(ne=[ne[0],ce].concat(ne.slice(1))),ne.join("")}var se={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},X={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};X["0th"]=X.Image,X["1st"]=X.Image,g.TAGS=X,g.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},g.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},g.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},g.InteropIFD={InteroperabilityIndex:1},g.GPSHelper={degToDmsRational:function(ne){var ce=Math.abs(ne),oe=ce%1*60,de=oe%1*60,me=Math.floor(ce),ge=Math.floor(oe),fe=Math.round(de*100);return[[me,1],[ge,1],[fe,100]]},dmsRationalToDeg:function(ne,ce){var oe=ce==="S"||ce==="W"?-1:1,de=ne[0][0]/ne[0][1]+ne[1][0]/ne[1][1]/60+ne[2][0]/ne[2][1]/3600;return de*oe}},d.exports&&(m=d.exports=g),m.piexif=g})()})(piexif$1,piexif$1.exports)),piexif$1.exports}var piexifExports=requirePiexif(),piexif=getDefaultExportFromCjs$1(piexifExports);const UNINITIALIZED=Symbol();var DEV=!1,is_array=Array.isArray,index_of=Array.prototype.indexOf,get_descriptor=Object.getOwnPropertyDescriptor,object_prototype=Object.prototype,array_prototype=Array.prototype,get_prototype_of=Object.getPrototypeOf;function run_all(d){for(var m=0;m<d.length;m++)d[m]()}function deferred(){var d,m,g=new Promise((w,$)=>{d=w,m=$});return{promise:g,resolve:d,reject:m}}const DERIVED=2,EFFECT=4,BLOCK_EFFECT=16,BRANCH_EFFECT=32,ROOT_EFFECT=64,BOUNDARY_EFFECT=128,CLEAN=1024,DIRTY$1=2048,MAYBE_DIRTY=4096,INERT=8192,DESTROYED=16384,EFFECT_RAN=32768,EAGER_EFFECT=1<<17,HEAD_EFFECT=1<<18,UNOWNED=256,DISCONNECTED=512,WAS_MARKED=32768,REACTION_IS_UPDATING=1<<21,ASYNC=1<<22,ERROR_VALUE=1<<23,STATE_SYMBOL=Symbol("$state"),STALE_REACTION=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function effect_update_depth_exceeded(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function state_descriptors_fixed(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function state_prototype_fixed(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function state_unsafe_mutation(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function equals(d){return d===this.v}let tracing_mode_flag=!1;const empty=[];function snapshot(d,m=!1,g=!1){return clone$1(d,new Map,"",empty,null,g)}function clone$1(d,m,g,w,$=null,I=!1){if(typeof d=="object"&&d!==null){var D=m.get(d);if(D!==void 0)return D;if(d instanceof Map)return new Map(d);if(d instanceof Set)return new Set(d);if(is_array(d)){var F=Array(d.length);m.set(d,F),$!==null&&m.set($,F);for(var U=0;U<d.length;U+=1){var q=d[U];U in d&&(F[U]=clone$1(q,m,g,w,null,I))}return F}if(get_prototype_of(d)===object_prototype){F={},m.set(d,F),$!==null&&m.set($,F);for(var j in d)F[j]=clone$1(d[j],m,g,w,null,I);return F}if(d instanceof Date)return structuredClone(d);if(typeof d.toJSON=="function"&&!I)return clone$1(d.toJSON(),m,g,w,d)}if(d instanceof EventTarget)return d;try{return structuredClone(d)}catch{return d}}function set_component_context(d){}function is_runes(){return!0}let micro_tasks=[];function run_micro_tasks(){var d=micro_tasks;micro_tasks=[],run_all(d)}function queue_micro_task(d){if(micro_tasks.length===0){var m=micro_tasks;queueMicrotask(()=>{m===micro_tasks&&run_micro_tasks()})}micro_tasks.push(d)}function handle_error(d){var m=active_effect;if(m===null)return active_reaction.f|=ERROR_VALUE,d;if((m.f&EFFECT_RAN)===0){if((m.f&BOUNDARY_EFFECT)===0)throw d;m.b.error(d)}else invoke_error_boundary(d,m)}function invoke_error_boundary(d,m){for(;m!==null;){if((m.f&BOUNDARY_EFFECT)!==0)try{m.b.error(d);return}catch(g){d=g}m=m.parent}throw d}const batches=new Set;let current_batch=null,batch_values=null,effect_pending_updates=new Set,queued_root_effects=[],last_scheduled_effect=null,is_flushing=!1;class Batch{committed=!1;current=new Map;previous=new Map;#r=new Set;#i=new Set;#e=0;#t=0;#a=null;#s=[];#o=[];skipped_effects=new Set;is_fork=!1;process(m){queued_root_effects=[],this.apply();var g={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const w of m)this.#l(w,g);this.is_fork||this.#u(),this.#t>0||this.is_fork?(this.#n(g.effects),this.#n(g.render_effects),this.#n(g.block_effects)):(current_batch=null,flush_queued_effects(g.render_effects),flush_queued_effects(g.effects)),batch_values=null}#l(m,g){m.f^=CLEAN;for(var w=m.first;w!==null;){var $=w.f,I=($&(BRANCH_EFFECT|ROOT_EFFECT))!==0,D=I&&($&CLEAN)!==0,F=D||($&INERT)!==0||this.skipped_effects.has(w);if((w.f&BOUNDARY_EFFECT)!==0&&w.b?.is_pending()&&(g={parent:g,effect:w,effects:[],render_effects:[],block_effects:[]}),!F&&w.fn!==null){I?w.f^=CLEAN:($&EFFECT)!==0?g.effects.push(w):is_dirty(w)&&((w.f&BLOCK_EFFECT)!==0&&g.block_effects.push(w),update_effect(w));var U=w.first;if(U!==null){w=U;continue}}var q=w.parent;for(w=w.next;w===null&&q!==null;)q===g.effect&&(this.#n(g.effects),this.#n(g.render_effects),this.#n(g.block_effects),g=g.parent),w=q.next,q=q.parent}}#n(m){for(const g of m)((g.f&DIRTY$1)!==0?this.#s:this.#o).push(g),set_signal_status(g,CLEAN)}capture(m,g){this.previous.has(m)||this.previous.set(m,g),this.current.set(m,m.v),batch_values?.set(m,m.v)}activate(){current_batch=this}deactivate(){current_batch=null,batch_values=null}flush(){if(this.activate(),queued_root_effects.length>0){if(flush_effects(),current_batch!==null&&current_batch!==this)return}else this.#e===0&&this.process([]);this.deactivate();for(const m of effect_pending_updates)if(effect_pending_updates.delete(m),m(),current_batch!==null)break}discard(){for(const m of this.#i)m(this);this.#i.clear()}#u(){if(this.#t===0){for(const m of this.#r)m();this.#r.clear()}this.#e===0&&this.#c()}#c(){if(batches.size>1){this.previous.clear();var m=batch_values,g=!0,w={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const $ of batches){if($===this){g=!1;continue}const I=[];for(const[F,U]of this.current){if($.current.has(F))if(g&&U!==$.current.get(F))$.current.set(F,U);else continue;I.push(F)}if(I.length===0)continue;const D=[...$.current.keys()].filter(F=>!this.current.has(F));if(D.length>0){const F=new Set,U=new Map;for(const q of I)mark_effects(q,D,F,U);if(queued_root_effects.length>0){current_batch=$,$.apply();for(const q of queued_root_effects)$.#l(q,w);queued_root_effects=[],$.deactivate()}}}current_batch=null,batch_values=m}this.committed=!0,batches.delete(this),this.#a?.resolve()}increment(m){this.#e+=1,m&&(this.#t+=1)}decrement(m){this.#e-=1,m&&(this.#t-=1),this.revive()}revive(){for(const m of this.#s)set_signal_status(m,DIRTY$1),schedule_effect(m);for(const m of this.#o)set_signal_status(m,MAYBE_DIRTY),schedule_effect(m);this.#s=[],this.#o=[],this.flush()}oncommit(m){this.#r.add(m)}ondiscard(m){this.#i.add(m)}settled(){return(this.#a??=deferred()).promise}static ensure(){if(current_batch===null){const m=current_batch=new Batch;batches.add(current_batch),Batch.enqueue(()=>{current_batch===m&&m.flush()})}return current_batch}static enqueue(m){queue_micro_task(m)}apply(){}}function flush_effects(){var d=is_updating_effect;is_flushing=!0;try{var m=0;for(set_is_updating_effect(!0);queued_root_effects.length>0;){var g=Batch.ensure();if(m++>1e3){var w,$;infinite_loop_guard()}g.process(queued_root_effects),old_values.clear()}}finally{is_flushing=!1,set_is_updating_effect(d),last_scheduled_effect=null}}function infinite_loop_guard(){try{effect_update_depth_exceeded()}catch(d){invoke_error_boundary(d,last_scheduled_effect)}}let eager_block_effects=null;function flush_queued_effects(d){var m=d.length;if(m!==0){for(var g=0;g<m;){var w=d[g++];if((w.f&(DESTROYED|INERT))===0&&is_dirty(w)&&(eager_block_effects=new Set,update_effect(w),w.deps===null&&w.first===null&&w.nodes_start===null&&(w.teardown===null&&w.ac===null?unlink_effect(w):w.fn=null),eager_block_effects?.size>0)){old_values.clear();for(const $ of eager_block_effects){if(($.f&(DESTROYED|INERT))!==0)continue;const I=[$];let D=$.parent;for(;D!==null;)eager_block_effects.has(D)&&(eager_block_effects.delete(D),I.push(D)),D=D.parent;for(let F=I.length-1;F>=0;F--){const U=I[F];(U.f&(DESTROYED|INERT))===0&&update_effect(U)}}eager_block_effects.clear()}}eager_block_effects=null}}function mark_effects(d,m,g,w){if(!g.has(d)&&(g.add(d),d.reactions!==null))for(const $ of d.reactions){const I=$.f;(I&DERIVED)!==0?mark_effects($,m,g,w):(I&(ASYNC|BLOCK_EFFECT))!==0&&(I&DIRTY$1)===0&&depends_on($,m,w)&&(set_signal_status($,DIRTY$1),schedule_effect($))}}function depends_on(d,m,g){const w=g.get(d);if(w!==void 0)return w;if(d.deps!==null)for(const $ of d.deps){if(m.includes($))return!0;if(($.f&DERIVED)!==0&&depends_on($,m,g))return g.set($,!0),!0}return g.set(d,!1),!1}function schedule_effect(d){for(var m=last_scheduled_effect=d;m.parent!==null;){m=m.parent;var g=m.f;if(is_flushing&&m===active_effect&&(g&BLOCK_EFFECT)!==0)return;if((g&(ROOT_EFFECT|BRANCH_EFFECT))!==0){if((g&CLEAN)===0)return;m.f^=CLEAN}}queued_root_effects.push(m)}function destroy_derived_effects(d){var m=d.effects;if(m!==null){d.effects=null;for(var g=0;g<m.length;g+=1)destroy_effect(m[g])}}function get_derived_parent_effect(d){for(var m=d.parent;m!==null;){if((m.f&DERIVED)===0)return m;m=m.parent}return null}function execute_derived(d){var m,g=active_effect;set_active_effect(get_derived_parent_effect(d));try{d.f&=~WAS_MARKED,destroy_derived_effects(d),m=update_reaction(d)}finally{set_active_effect(g)}return m}function update_derived(d){var m=execute_derived(d);if(d.equals(m)||(d.v=m,d.wv=increment_write_version()),!is_destroying_effect)if(batch_values!==null)batch_values.set(d,d.v);else{var g=(skip_reaction||(d.f&UNOWNED)!==0)&&d.deps!==null?MAYBE_DIRTY:CLEAN;set_signal_status(d,g)}}let eager_effects=new Set;const old_values=new Map;let eager_effects_deferred=!1;function source(d,m){var g={f:0,v:d,reactions:null,equals,rv:0,wv:0};return g}function state(d,m){const g=source(d);return push_reaction_value(g),g}function set$1(d,m,g=!1){active_reaction!==null&&(!untracking||(active_reaction.f&EAGER_EFFECT)!==0)&&is_runes()&&(active_reaction.f&(DERIVED|BLOCK_EFFECT|ASYNC|EAGER_EFFECT))!==0&&!current_sources?.includes(d)&&state_unsafe_mutation();let w=g?proxy(m):m;return internal_set(d,w)}function internal_set(d,m){if(!d.equals(m)){var g=d.v;is_destroying_effect?old_values.set(d,m):old_values.set(d,g),d.v=m;var w=Batch.ensure();w.capture(d,g),(d.f&DERIVED)!==0&&((d.f&DIRTY$1)!==0&&execute_derived(d),set_signal_status(d,(d.f&UNOWNED)===0?CLEAN:MAYBE_DIRTY)),d.wv=increment_write_version(),mark_reactions(d,DIRTY$1),active_effect!==null&&(active_effect.f&CLEAN)!==0&&(active_effect.f&(BRANCH_EFFECT|ROOT_EFFECT))===0&&(untracked_writes===null?set_untracked_writes([d]):untracked_writes.push(d)),!w.is_fork&&eager_effects.size>0&&!eager_effects_deferred&&flush_eager_effects()}return m}function flush_eager_effects(){eager_effects_deferred=!1;const d=Array.from(eager_effects);for(const m of d)(m.f&CLEAN)!==0&&set_signal_status(m,MAYBE_DIRTY),is_dirty(m)&&update_effect(m);eager_effects.clear()}function increment(d){set$1(d,d.v+1)}function mark_reactions(d,m){var g=d.reactions;if(g!==null)for(var w=g.length,$=0;$<w;$++){var I=g[$],D=I.f,F=(D&DIRTY$1)===0;F&&set_signal_status(I,m),(D&DERIVED)!==0?(D&WAS_MARKED)===0&&(I.f|=WAS_MARKED,mark_reactions(I,MAYBE_DIRTY)):F&&((D&BLOCK_EFFECT)!==0&&eager_block_effects!==null&&eager_block_effects.add(I),schedule_effect(I))}}function proxy(d){if(typeof d!="object"||d===null||STATE_SYMBOL in d)return d;const m=get_prototype_of(d);if(m!==object_prototype&&m!==array_prototype)return d;var g=new Map,w=is_array(d),$=state(0),I=update_version,D=F=>{if(update_version===I)return F();var U=active_reaction,q=update_version;set_active_reaction(null),set_update_version(I);var j=F();return set_active_reaction(U),set_update_version(q),j};return w&&g.set("length",state(d.length)),new Proxy(d,{defineProperty(F,U,q){(!("value"in q)||q.configurable===!1||q.enumerable===!1||q.writable===!1)&&state_descriptors_fixed();var j=g.get(U);return j===void 0?j=D(()=>{var G=state(q.value);return g.set(U,G),G}):set$1(j,q.value,!0),!0},deleteProperty(F,U){var q=g.get(U);if(q===void 0){if(U in F){const j=D(()=>state(UNINITIALIZED));g.set(U,j),increment($)}}else set$1(q,UNINITIALIZED),increment($);return!0},get(F,U,q){if(U===STATE_SYMBOL)return d;var j=g.get(U),G=U in F;if(j===void 0&&(!G||get_descriptor(F,U)?.writable)&&(j=D(()=>{var V=proxy(G?F[U]:UNINITIALIZED),Z=state(V);return Z}),g.set(U,j)),j!==void 0){var H=get$1(j);return H===UNINITIALIZED?void 0:H}return Reflect.get(F,U,q)},getOwnPropertyDescriptor(F,U){var q=Reflect.getOwnPropertyDescriptor(F,U);if(q&&"value"in q){var j=g.get(U);j&&(q.value=get$1(j))}else if(q===void 0){var G=g.get(U),H=G?.v;if(G!==void 0&&H!==UNINITIALIZED)return{enumerable:!0,configurable:!0,value:H,writable:!0}}return q},has(F,U){if(U===STATE_SYMBOL)return!0;var q=g.get(U),j=q!==void 0&&q.v!==UNINITIALIZED||Reflect.has(F,U);if(q!==void 0||active_effect!==null&&(!j||get_descriptor(F,U)?.writable)){q===void 0&&(q=D(()=>{var H=j?proxy(F[U]):UNINITIALIZED,V=state(H);return V}),g.set(U,q));var G=get$1(q);if(G===UNINITIALIZED)return!1}return j},set(F,U,q,j){var G=g.get(U),H=U in F;if(w&&U==="length")for(var V=q;V<G.v;V+=1){var Z=g.get(V+"");Z!==void 0?set$1(Z,UNINITIALIZED):V in F&&(Z=D(()=>state(UNINITIALIZED)),g.set(V+"",Z))}if(G===void 0)(!H||get_descriptor(F,U)?.writable)&&(G=D(()=>state(void 0)),set$1(G,proxy(q)),g.set(U,G));else{H=G.v!==UNINITIALIZED;var Q=D(()=>proxy(q));set$1(G,Q)}var J=Reflect.getOwnPropertyDescriptor(F,U);if(J?.set&&J.set.call(j,q),!H){if(w&&typeof U=="string"){var ie=g.get("length"),re=Number(U);Number.isInteger(re)&&re>=ie.v&&set$1(ie,re+1)}increment($)}return!0},ownKeys(F){get$1($);var U=Reflect.ownKeys(F).filter(G=>{var H=g.get(G);return H===void 0||H.v!==UNINITIALIZED});for(var[q,j]of g)j.v!==UNINITIALIZED&&!(q in F)&&U.push(q);return U},setPrototypeOf(){state_prototype_fixed()}})}var next_sibling_getter;function get_next_sibling(d){return next_sibling_getter.call(d)}function without_reactive_context(d){var m=active_reaction,g=active_effect;set_active_reaction(null),set_active_effect(null);try{return d()}finally{set_active_reaction(m),set_active_effect(g)}}function execute_effect_teardown(d){var m=d.teardown;if(m!==null){const g=is_destroying_effect,w=active_reaction;set_is_destroying_effect(!0),set_active_reaction(null);try{m.call(null)}finally{set_is_destroying_effect(g),set_active_reaction(w)}}}function destroy_effect_children(d,m=!1){var g=d.first;for(d.first=d.last=null;g!==null;){const $=g.ac;$!==null&&without_reactive_context(()=>{$.abort(STALE_REACTION)});var w=g.next;(g.f&ROOT_EFFECT)!==0?g.parent=null:destroy_effect(g,m),g=w}}function destroy_block_effect_children(d){for(var m=d.first;m!==null;){var g=m.next;(m.f&BRANCH_EFFECT)===0&&destroy_effect(m),m=g}}function destroy_effect(d,m=!0){var g=!1;(m||(d.f&HEAD_EFFECT)!==0)&&d.nodes_start!==null&&d.nodes_end!==null&&(remove_effect_dom(d.nodes_start,d.nodes_end),g=!0),destroy_effect_children(d,m&&!g),remove_reactions(d,0),set_signal_status(d,DESTROYED);var w=d.transitions;if(w!==null)for(const I of w)I.stop();execute_effect_teardown(d);var $=d.parent;$!==null&&$.first!==null&&unlink_effect(d),d.next=d.prev=d.teardown=d.ctx=d.deps=d.fn=d.nodes_start=d.nodes_end=d.ac=null}function remove_effect_dom(d,m){for(;d!==null;){var g=d===m?null:get_next_sibling(d);d.remove(),d=g}}function unlink_effect(d){var m=d.parent,g=d.prev,w=d.next;g!==null&&(g.next=w),w!==null&&(w.prev=g),m!==null&&(m.first===d&&(m.first=w),m.last===d&&(m.last=g))}let is_updating_effect=!1;function set_is_updating_effect(d){is_updating_effect=d}let is_destroying_effect=!1;function set_is_destroying_effect(d){is_destroying_effect=d}let active_reaction=null,untracking=!1;function set_active_reaction(d){active_reaction=d}let active_effect=null;function set_active_effect(d){active_effect=d}let current_sources=null;function push_reaction_value(d){active_reaction!==null&&(current_sources===null?current_sources=[d]:current_sources.push(d))}let new_deps=null,skipped_deps=0,untracked_writes=null;function set_untracked_writes(d){untracked_writes=d}let write_version=1,read_version=0,update_version=read_version;function set_update_version(d){update_version=d}let skip_reaction=!1;function increment_write_version(){return++write_version}function is_dirty(d){var m=d.f;if((m&DIRTY$1)!==0)return!0;if((m&MAYBE_DIRTY)!==0){var g=d.deps,w=(m&UNOWNED)!==0;if(m&DERIVED&&(d.f&=~WAS_MARKED),g!==null){var $,I,D=(m&DISCONNECTED)!==0,F=w&&active_effect!==null&&!skip_reaction,U=g.length;if((D||F)&&(active_effect===null||(active_effect.f&DESTROYED)===0)){var q=d,j=q.parent;for($=0;$<U;$++)I=g[$],(D||!I?.reactions?.includes(q))&&(I.reactions??=[]).push(q);D&&(q.f^=DISCONNECTED),F&&j!==null&&(j.f&UNOWNED)===0&&(q.f^=UNOWNED)}for($=0;$<U;$++)if(I=g[$],is_dirty(I)&&update_derived(I),I.wv>d.wv)return!0}(!w||active_effect!==null&&!skip_reaction)&&set_signal_status(d,CLEAN)}return!1}function schedule_possible_effect_self_invalidation(d,m,g=!0){var w=d.reactions;if(w!==null&&!current_sources?.includes(d))for(var $=0;$<w.length;$++){var I=w[$];(I.f&DERIVED)!==0?schedule_possible_effect_self_invalidation(I,m,!1):m===I&&(g?set_signal_status(I,DIRTY$1):(I.f&CLEAN)!==0&&set_signal_status(I,MAYBE_DIRTY),schedule_effect(I))}}function update_reaction(d){var m=new_deps,g=skipped_deps,w=untracked_writes,$=active_reaction,I=skip_reaction,D=current_sources,F=untracking,U=update_version,q=d.f;new_deps=null,skipped_deps=0,untracked_writes=null,skip_reaction=(q&UNOWNED)!==0&&(untracking||!is_updating_effect||active_reaction===null),active_reaction=(q&(BRANCH_EFFECT|ROOT_EFFECT))===0?d:null,current_sources=null,d.ctx,untracking=!1,update_version=++read_version,d.ac!==null&&(without_reactive_context(()=>{d.ac.abort(STALE_REACTION)}),d.ac=null);try{d.f|=REACTION_IS_UPDATING;var j=d.fn,G=j(),H=d.deps;if(new_deps!==null){var V;if(remove_reactions(d,skipped_deps),H!==null&&skipped_deps>0)for(H.length=skipped_deps+new_deps.length,V=0;V<new_deps.length;V++)H[skipped_deps+V]=new_deps[V];else d.deps=H=new_deps;if(!skip_reaction||(q&DERIVED)!==0&&d.reactions!==null)for(V=skipped_deps;V<H.length;V++)(H[V].reactions??=[]).push(d)}else H!==null&&skipped_deps<H.length&&(remove_reactions(d,skipped_deps),H.length=skipped_deps);if(is_runes()&&untracked_writes!==null&&!untracking&&H!==null&&(d.f&(DERIVED|MAYBE_DIRTY|DIRTY$1))===0)for(V=0;V<untracked_writes.length;V++)schedule_possible_effect_self_invalidation(untracked_writes[V],d);return $!==null&&$!==d&&(read_version++,untracked_writes!==null&&(w===null?w=untracked_writes:w.push(...untracked_writes))),(d.f&ERROR_VALUE)!==0&&(d.f^=ERROR_VALUE),G}catch(Z){return handle_error(Z)}finally{d.f^=REACTION_IS_UPDATING,new_deps=m,skipped_deps=g,untracked_writes=w,active_reaction=$,skip_reaction=I,current_sources=D,untracking=F,update_version=U}}function remove_reaction(d,m){let g=m.reactions;if(g!==null){var w=index_of.call(g,d);if(w!==-1){var $=g.length-1;$===0?g=m.reactions=null:(g[w]=g[$],g.pop())}}g===null&&(m.f&DERIVED)!==0&&(new_deps===null||!new_deps.includes(m))&&(set_signal_status(m,MAYBE_DIRTY),(m.f&(UNOWNED|DISCONNECTED))===0&&(m.f^=DISCONNECTED),destroy_derived_effects(m),remove_reactions(m,0))}function remove_reactions(d,m){var g=d.deps;if(g!==null)for(var w=m;w<g.length;w++)remove_reaction(d,g[w])}function update_effect(d){var m=d.f;if((m&DESTROYED)===0){set_signal_status(d,CLEAN);var g=active_effect,w=is_updating_effect;active_effect=d,is_updating_effect=!0;try{(m&BLOCK_EFFECT)!==0?destroy_block_effect_children(d):destroy_effect_children(d),execute_effect_teardown(d);var $=update_reaction(d);d.teardown=typeof $=="function"?$:null,d.wv=write_version;var I;DEV&&tracing_mode_flag&&(d.f&DIRTY$1)!==0&&d.deps}finally{is_updating_effect=w,active_effect=g}}}function get$1(d){var m=d.f,g=(m&DERIVED)!==0;if(active_reaction!==null&&!untracking){var w=active_effect!==null&&(active_effect.f&DESTROYED)!==0;if(!w&&!current_sources?.includes(d)){var $=active_reaction.deps;if((active_reaction.f&REACTION_IS_UPDATING)!==0)d.rv<read_version&&(d.rv=read_version,new_deps===null&&$!==null&&$[skipped_deps]===d?skipped_deps++:new_deps===null?new_deps=[d]:(!skip_reaction||!new_deps.includes(d))&&new_deps.push(d));else{(active_reaction.deps??=[]).push(d);var I=d.reactions;I===null?d.reactions=[active_reaction]:I.includes(active_reaction)||I.push(active_reaction)}}}else if(g&&d.deps===null&&d.effects===null){var D=d,F=D.parent;F!==null&&(F.f&UNOWNED)===0&&(D.f^=UNOWNED)}if(is_destroying_effect){if(old_values.has(d))return old_values.get(d);if(g){D=d;var U=D.v;return((D.f&CLEAN)===0&&D.reactions!==null||depends_on_old_values(D))&&(U=execute_derived(D)),old_values.set(D,U),U}}else if(g){if(D=d,batch_values?.has(D))return batch_values.get(D);is_dirty(D)&&update_derived(D)}if(batch_values?.has(d))return batch_values.get(d);if((d.f&ERROR_VALUE)!==0)throw d.v;return d.v}function depends_on_old_values(d){if(d.v===UNINITIALIZED)return!0;if(d.deps===null)return!1;for(const m of d.deps)if(old_values.has(m)||(m.f&DERIVED)!==0&&depends_on_old_values(m))return!0;return!1}const STATUS_MASK=-7169;function set_signal_status(d,m){d.f=d.f&STATUS_MASK|m}class DevalueError extends Error{constructor(m,g){super(m),this.name="DevalueError",this.path=g.join("")}}function is_primitive(d){return Object(d)!==d}const object_proto_names=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function is_plain_object(d){const m=Object.getPrototypeOf(d);return m===Object.prototype||m===null||Object.getPrototypeOf(m)===null||Object.getOwnPropertyNames(m).sort().join("\0")===object_proto_names}function get_type(d){return Object.prototype.toString.call(d).slice(8,-1)}function get_escaped_char(d){switch(d){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return d<" "?`\\u${d.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function stringify_string(d){let m="",g=0;const w=d.length;for(let $=0;$<w;$+=1){const I=d[$],D=get_escaped_char(I);D&&(m+=d.slice(g,$)+D,g=$+1)}return`"${g===0?d:m+d.slice(g)}"`}function enumerable_symbols(d){return Object.getOwnPropertySymbols(d).filter(m=>Object.getOwnPropertyDescriptor(d,m).enumerable)}const is_identifier=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;function stringify_key(d){return is_identifier.test(d)?"."+d:"["+JSON.stringify(d)+"]"}function encode64(d){const m=new DataView(d);let g="";for(let w=0;w<d.byteLength;w++)g+=String.fromCharCode(m.getUint8(w));return binaryToAscii(g)}function decode64(d){const m=asciiToBinary(d),g=new ArrayBuffer(m.length),w=new DataView(g);for(let $=0;$<g.byteLength;$++)w.setUint8($,m.charCodeAt($));return g}const KEY_STRING="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function asciiToBinary(d){d.length%4===0&&(d=d.replace(/==?$/,""));let m="",g=0,w=0;for(let $=0;$<d.length;$++)g<<=6,g|=KEY_STRING.indexOf(d[$]),w+=6,w===24&&(m+=String.fromCharCode((g&16711680)>>16),m+=String.fromCharCode((g&65280)>>8),m+=String.fromCharCode(g&255),g=w=0);return w===12?(g>>=4,m+=String.fromCharCode(g)):w===18&&(g>>=2,m+=String.fromCharCode((g&65280)>>8),m+=String.fromCharCode(g&255)),m}function binaryToAscii(d){let m="";for(let g=0;g<d.length;g+=3){const w=[void 0,void 0,void 0,void 0];w[0]=d.charCodeAt(g)>>2,w[1]=(d.charCodeAt(g)&3)<<4,d.length>g+1&&(w[1]|=d.charCodeAt(g+1)>>4,w[2]=(d.charCodeAt(g+1)&15)<<2),d.length>g+2&&(w[2]|=d.charCodeAt(g+2)>>6,w[3]=d.charCodeAt(g+2)&63);for(let $=0;$<w.length;$++)typeof w[$]>"u"?m+="=":m+=KEY_STRING[w[$]]}return m}const UNDEFINED=-1,HOLE=-2,NAN=-3,POSITIVE_INFINITY=-4,NEGATIVE_INFINITY=-5,NEGATIVE_ZERO=-6;function parse(d,m){return unflatten(JSON.parse(d),m)}function unflatten(d,m){if(typeof d=="number")return $(d,!0);if(!Array.isArray(d)||d.length===0)throw new Error("Invalid input");const g=d,w=Array(g.length);function $(I,D=!1){if(I===UNDEFINED)return;if(I===NAN)return NaN;if(I===POSITIVE_INFINITY)return 1/0;if(I===NEGATIVE_INFINITY)return-1/0;if(I===NEGATIVE_ZERO)return-0;if(D||typeof I!="number")throw new Error("Invalid input");if(I in w)return w[I];const F=g[I];if(!F||typeof F!="object")w[I]=F;else if(Array.isArray(F))if(typeof F[0]=="string"){const U=F[0],q=m?.[U];if(q){let j=F[1];return typeof j!="number"&&(j=g.push(F[1])-1),w[I]=q($(j))}switch(U){case"Date":w[I]=new Date(F[1]);break;case"Set":const j=new Set;w[I]=j;for(let V=1;V<F.length;V+=1)j.add($(F[V]));break;case"Map":const G=new Map;w[I]=G;for(let V=1;V<F.length;V+=2)G.set($(F[V]),$(F[V+1]));break;case"RegExp":w[I]=new RegExp(F[1],F[2]);break;case"Object":w[I]=Object(F[1]);break;case"BigInt":w[I]=BigInt(F[1]);break;case"null":const H=Object.create(null);w[I]=H;for(let V=1;V<F.length;V+=2)H[F[V]]=$(F[V+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const V=globalThis[U],Z=new V($(F[1]));w[I]=F[2]!==void 0?Z.subarray(F[2],F[3]):Z;break}case"ArrayBuffer":{const V=F[1],Z=decode64(V);w[I]=Z;break}case"Temporal.Duration":case"Temporal.Instant":case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.PlainMonthDay":case"Temporal.PlainYearMonth":case"Temporal.ZonedDateTime":{const V=U.slice(9);w[I]=Temporal[V].from(F[1]);break}case"URL":{const V=new URL(F[1]);w[I]=V;break}case"URLSearchParams":{const V=new URLSearchParams(F[1]);w[I]=V;break}default:throw new Error(`Unknown type ${U}`)}}else{const U=new Array(F.length);w[I]=U;for(let q=0;q<F.length;q+=1){const j=F[q];j!==HOLE&&(U[q]=$(j))}}else{const U={};w[I]=U;for(const q in F){if(q==="__proto__")throw new Error("Cannot parse an object with a `__proto__` property");const j=F[q];U[q]=$(j)}}return w[I]}return $(0)}function stringify(d,m){const g=[],w=new Map,$=[];if(m)for(const q of Object.getOwnPropertyNames(m))$.push({key:q,fn:m[q]});const I=[];let D=0;function F(q){if(typeof q=="function")throw new DevalueError("Cannot stringify a function",I);if(q===void 0)return UNDEFINED;if(Number.isNaN(q))return NAN;if(q===1/0)return POSITIVE_INFINITY;if(q===-1/0)return NEGATIVE_INFINITY;if(q===0&&1/q<0)return NEGATIVE_ZERO;if(w.has(q))return w.get(q);const j=D++;w.set(q,j);for(const{key:H,fn:V}of $){const Z=V(q);if(Z)return g[j]=`["${H}",${F(Z)}]`,j}let G="";if(is_primitive(q))G=stringify_primitive(q);else{const H=get_type(q);switch(H){case"Number":case"String":case"Boolean":G=`["Object",${stringify_primitive(q)}]`;break;case"BigInt":G=`["BigInt",${q}]`;break;case"Date":G=`["Date","${!isNaN(q.getDate())?q.toISOString():""}"]`;break;case"URL":G=`["URL",${stringify_string(q.toString())}]`;break;case"URLSearchParams":G=`["URLSearchParams",${stringify_string(q.toString())}]`;break;case"RegExp":const{source:Z,flags:Q}=q;G=Q?`["RegExp",${stringify_string(Z)},"${Q}"]`:`["RegExp",${stringify_string(Z)}]`;break;case"Array":G="[";for(let J=0;J<q.length;J+=1)J>0&&(G+=","),J in q?(I.push(`[${J}]`),G+=F(q[J]),I.pop()):G+=HOLE;G+="]";break;case"Set":G='["Set"';for(const J of q)G+=`,${F(J)}`;G+="]";break;case"Map":G='["Map"';for(const[J,ie]of q)I.push(`.get(${is_primitive(J)?stringify_primitive(J):"..."})`),G+=`,${F(J)},${F(ie)}`,I.pop();G+="]";break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const J=q;G='["'+H+'",'+F(J.buffer);const ie=q.byteOffset,re=ie+q.byteLength;if(ie>0||re!==J.buffer.byteLength){const se=+/(\d+)/.exec(H)[1]/8;G+=`,${ie/se},${re/se}`}G+="]";break}case"ArrayBuffer":{G=`["ArrayBuffer","${encode64(q)}"]`;break}case"Temporal.Duration":case"Temporal.Instant":case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.PlainMonthDay":case"Temporal.PlainYearMonth":case"Temporal.ZonedDateTime":G=`["${H}",${stringify_string(q.toString())}]`;break;default:if(!is_plain_object(q))throw new DevalueError("Cannot stringify arbitrary non-POJOs",I);if(enumerable_symbols(q).length>0)throw new DevalueError("Cannot stringify POJOs with symbolic keys",I);if(Object.getPrototypeOf(q)===null){G='["null"';for(const J in q)I.push(stringify_key(J)),G+=`,${stringify_string(J)},${F(q[J])}`,I.pop();G+="]"}else{G="{";let J=!1;for(const ie in q)J&&(G+=","),J=!0,I.push(stringify_key(ie)),G+=`${stringify_string(ie)}:${F(q[ie])}`,I.pop();G+="}"}}}return g[j]=G,j}const U=F(d);return U<0?`${U}`:`[${g.join(",")}]`}function stringify_primitive(d){const m=typeof d;return m==="string"?stringify_string(d):d instanceof String?stringify_string(d.toString()):d===void 0?UNDEFINED.toString():d===0&&1/d<0?NEGATIVE_ZERO.toString():m==="bigint"?`["BigInt","${d}"]`:String(d)}const urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let nanoid=(d=21)=>{let m="",g=crypto.getRandomValues(new Uint8Array(d|=0));for(;d--;)m+=urlAlphabet[g[d]&63];return m};const previewingPrNumber=744,databaseName=`previews/pr-${previewingPrNumber}`,databaseRevision=4,tableNames=Object.keys(Tables),_tablesState=proxy({Image:[],Metadata:[],Observation:[],Protocol:[],Settings:[]}),tables={...Object.fromEntries(tableNames.filter(isReactiveTable).map(d=>[d,wrangler(d)])),async initialize(){for(const d of tableNames)isReactiveTable(d)&&await tables[d].refresh()}};function wrangler(d){return{get state(){return _tablesState[d]},async refresh(){console.info(`refresh ${d}`),_tablesState[d]=await this.list()},get:async m=>get(d,m),getFromState:m=>_tablesState[d].find(g=>g.id===m),async set(m){await set(d,m);const g=Tables[d].assert(m),w=_tablesState[d].findIndex($=>$.id===m.id);return w!==-1?_tablesState[d][w]=g:(_tablesState[d].push(g),_tablesState[d].sort(idComparator)),g},async update(m,g,w){const $=`upd ${d} ${m} ${typeof g=="string"?g:"<Symbol>"} = ${w}`,I=await this.raw.get(m);if(!I)return console.error(`${$}: item not found`),!1;I[g]=w,await set(d,I);const D=_tablesState[d].findIndex(F=>F.id===m);return D===-1?(console.debug(`${$}: item not found in reactive state, refetching entire list`),_tablesState[d]=await this.list()):(console.debug(`${$}: updating state @ ${d}[${D}]`),_tablesState[d][D]=Tables[d].assert(I)),!0},async add(m){return this.set({...m,id:generateId(d)})},async clear(){await clear(d),_tablesState[d]=[]},async remove(m){await drop(d,m);const g=_tablesState[d].findIndex(w=>w.id===m);g!==-1?(console.warn(`del ${d} ${m}: not found in reactive state, re-fetching`),_tablesState[d]=await this.list()):delete _tablesState[d][g]},async do(m){const g=`do ${d} #${nanoid()}`;console.debug(g),await openTransaction([d],{},async w=>{await m(w.objectStore(d))})},list:async()=>list(d),all:()=>iterator(d),count:async()=>await(await openDatabase()).count(d),raw:{async set(m){return await(await openDatabase()).put(d,m)},async get(m){return await(await openDatabase()).get(d,m)}}}}async function set(d,m){const g=await openDatabase();return Tables[d].assert(m),await g.put(d,m).then($=>$)}async function clear(d){await(await openDatabase()).clear(d).then(g=>g)}async function get(d,m){const g=await openDatabase(),w=Tables[d];return await g.get(d,m).then($=>$?w.assert($):void 0)}async function list(d,m=void 0){const g=await openDatabase(),w=Tables[d];return await g.getAll(d,m).then($=>$.map(I=>w.assert(I)).sort(idComparator)).then($=>$)}async function drop(d,m){return await(await openDatabase()).delete(d,m).then(()=>list(d)).then(w=>{console.debug(`delete ${d} ${m}: objects are now ${w.map($=>$.id).join(", ")}`)})}async function*iterator(d,m=void 0){const g=await openDatabase(),w=Tables[d],$=g.transaction(d).store,I=m?$.index(m).iterate():$.iterate();for await(const D of I)yield w.assert(D.value)}function dependencyURI(d,m,...g){return["idb:/",d,m,...g].filter(Boolean).join("/")}async function openTransaction(d,{mode:m},g){m??="readwrite";const w=nanoid(8);console.debug(`txn open ${w} tables ${d} mode ${m}`);const I=(await openDatabase()).transaction(d,m);I.id=w,await g(I),console.debug(`txn commit ${w} `),await I.done;for(const D of d.filter(isReactiveTable))await tables[D].refresh()}function databaseHandle(){if(!_database)throw new Error("Database not initialized. Call openDatabase() first.");return _database}async function openDatabase(){if(_database)return _database;const d=Object.entries(Tables);return _database=await openDB(databaseName,databaseRevision,{upgrade(m,g){const w=($,I)=>{if(!I.meta.table)return;const D=I.meta.table.indexes[0],F=m.createObjectStore($,{keyPath:D});for(const U of I.meta.table.indexes.slice(1))F.createIndex(U,U)};if(g===1)for(const $ of m.objectStoreNames)m.deleteObjectStore($);if(g===2){w("ImagePreviewFile",Tables.ImagePreviewFile);return}if(g===3){w("BeamupCorrection",Tables.BeamupCorrection);return}for(const[$,I]of d)w($,I)}}),window.devalue={stringify,parse},window.DB=_database,window.refreshDB=()=>{for(const m of tableNames)isReactiveTable(m)&&tables[m].refresh()},_database}function nukeDatabase(){_database&&(_database.close(),_database=void 0),indexedDB.deleteDatabase(databaseName)}let _database;var idb_svelte=Object.freeze({__proto__:null,_tablesState,clear,databaseHandle,databaseName,databaseRevision,dependencyURI,drop,get,iterator,list,nukeDatabase,openDatabase,openTransaction,previewingPrNumber,set,tables});async function computeCascades({db:d,metadataId:m,confidence:g,value:w,alternatives:$}){return await Promise.all([{value:w,confidence:g},...$].map(async({confidence:I,value:D})=>{const F=await d.get("MetadataOption",metadataOptionId(m,D));if(!F?.cascade)return;const{cascade:U}=F;return{cascade:U,confidence:I}})).then(I=>{const D=groupBy(I.filter(nonnull).flatMap(({cascade:U,confidence:q})=>entries(U).map(([j,G])=>({optionId:metadataOptionId(j,G),confidence:q}))),U=>U.optionId,U=>U.confidence);return[...groupBy(D.entries(),([U])=>parseMetadataOptionId(U).metadataId,([U,q])=>({value:parseMetadataOptionId(U).key,confidence:sum(q)})).entries()].map(([U,q])=>{const[{value:j,confidence:G},...H]=q.toSorted(({confidence:V},{confidence:Z})=>Z-V);return{metadataId:U,value:j,confidence:G,alternatives:H}})})}function chunk(d,m){const g=[];for(let w=0;w<d.length;w+=m)g.push(d.slice(w,w+m));return g}const MAX_CORRECTIONS_PER_REQUEST=100,CHUNK_SIZE=MAX_CORRECTIONS_PER_REQUEST;async function sendCorrections({origin:d,corrections:m,onProgress:g}){const w=Array.isArray(m)?m:[m],$=w.length,I=chunk(w,CHUNK_SIZE);let D=0;for(const[F,U]of I.entries()){const q=await fetch(d+"/corrections",{method:"POST",body:JSON.stringify(U)});if(!q.ok)throw new Error(q.status+" "+await q.text());D+=U.length,await g?.(F,D,$)}}async function getSetting(d,m,{fallback:g}={}){const w=m?Tables.Settings.assert(await m.get("Settings","user")??await m.get("Settings","defaults")):await tables.Settings.get("user")??await tables.Settings.get("defaults");if(!w){if(g!==void 0)return g;throw new Error("Les rÃ©glages par dÃ©faut n'ont pas Ã©tÃ© initialisÃ©s. Rechargez la page.")}return w[d]}async function storeCorrection(d,m,g,w,$,I){const D=await getSetting("beamupPreferences",d);if(!D[m.id]?.enable)return;const F=await d.get("Image",g).catch(()=>{}),U=F?void 0:await d.get("Observation",g).catch(()=>{}),q=F?.fileId?await d.get("ImageFile",F.fileId):void 0,j=F?.sha1??await Promise.all((U?.images??[]).map(async G=>d.get("Image",G).catch(()=>{}).then(H=>H?.sha1))).then(G=>G.filter(nonnull).join(" "));await d.add("BeamupCorrection",snapshot({id:generateId("BeamupCorrection"),client:{version:"ac0ccf7aaa725c4cd32d23e833f44b204891973f"},protocol:pick(m,"id","version","beamup"),metadata:pick(w,"id","type"),email:D[m.id]?.email??null,subject:{[F?"image":"observation"]:{id:g},contentHash:j||null},...propOrNothing("file",q?pick(q,"id","filename","contentType","dimensions"):void 0),before:{...$,value:serializeMetadataValue($)},after:{...I,value:serializeMetadataValue(I)},occurredAt:new Date().toISOString()}))}async function syncCorrections(d,m){const g=await d.getAll("BeamupCorrection").then(w=>groupBy(w,$=>$.protocol.beamup.origin));for(const[w,$]of g.entries())await sendCorrections({origin:w,corrections:$.map(makeCorrection),onProgress(I,D){const F=I*CHUNK_SIZE,U=range(F,D-F).map(q=>$[q]?.id).filter(nonnull);m?.(U,void 0)}}).then(async()=>{for(const{id:I}of $)await d.delete("BeamupCorrection",I)}).catch(I=>{m?.($.map(D=>D.id),errorMessage(I))})}function makeCorrection({after:d,before:m,protocol:g,metadata:w,client:$,occurredAt:I,subject:D,email:F}){return{after:{alternatives:entries(d.alternatives).map(([U,q])=>({value:U,confidence:q})),type:w.type,value:d.value},before:{alternatives:entries(m.alternatives).map(([U,q])=>({value:U,confidence:q})),type:w.type,value:m.value},client_name:"Cigale",client_version:$.version,comment:null,done_at:I,metadata:w.id,protocol_id:g.id,protocol_version:g.version?.toString()??"non versioned",subject:D.image?.id??D.observation?.id??"",subject_type:D.image?"image":D.observation?"observation":"other",subject_content_hash:D.contentHash,user:F}}async function refreshTables(...d){try{const m=await Promise.resolve().then(function(){return idb_svelte});await Promise.all(d.map(g=>m.tables[g].refresh()))}catch(m){console.warn(`Cannot refresh tables ${d}:`,m)}}function serializeMetadataValue(d){return JSON.stringify(d instanceof Date&&isValid$1(d)?format(d,"yyyy-MM-dd'T'HH:mm:ss"):d)}async function storeMetadataValue({db:d,subjectId:m,metadataId:g,type:w,value:$,confidence:I=1,alternatives:D=[],manuallyModified:F=!1,cascadedFrom:U=[],abortSignal:q,protocol:j}){let G=null;if(!namespaceOfMetadataId(g))throw new Error(`Le metadataId ${g} n'est pas namespacÃ©`);q?.throwIfAborted();const H={value:serializeMetadataValue($),confidence:I,manuallyModified:F,alternatives:Object.fromEntries(D.map(re=>[serializeMetadataValue(re.value),re.confidence]))};H.alternatives=Object.fromEntries(Object.entries(H.alternatives).filter(([re])=>re!==H.value)),console.debug(`Store metadata ${g} = `,$,` in ${m}`,H);const V=await d.get("Metadata",g);if(!V)throw new Error(`MÃ©tadonnÃ©e inconnue avec l'ID ${g}`);if(w&&V.type!==w)throw new Error(`Type de mÃ©tadonnÃ©e incorrect: ${V.type} !== ${w}`);q?.throwIfAborted();const Z=await d.get("Image",m),Q=await d.get("Observation",m),J=await d.getAll("Image").then(re=>re.filter(({fileId:se})=>se===m));if(q?.throwIfAborted(),Z)g in Z.metadata&&(G=structuredClone(Z.metadata[g])),Z.metadata[g]=H,d.put("Image",Z);else if(Q){if(g in Q.metadataOverrides)G=structuredClone(Q.metadataOverrides[g]);else if(Q.images.length>0){const re=await d.getAll("Image").then(X=>X.filter(ne=>Q.images.includes(ne.id))),se=mergeMetadata(V,re.filter(X=>X.metadata[g]).map(X=>X.metadata[g]).map(Schemas.MetadataValue.assert));se&&(G={...se,value:serializeMetadataValue(se.value)})}Q.metadataOverrides[g]=H,d.put("Observation",Q)}else if(J)for(const{id:re}of J)await storeMetadataValue({db:d,subjectId:re,metadataId:g,value:$,confidence:I,manuallyModified:F,abortSignal:q,protocol:j});else throw new Error(`Aucune image ou observation avec l'ID ${m}`);q?.throwIfAborted();const ie=await computeCascades({db:d,metadataId:g,value:$,confidence:I,alternatives:D});for(const re of ie){if(q?.throwIfAborted(),U.includes(re.metadataId))throw new Error(`Boucle infinie de cascade dÃ©tectÃ©e pour ${re.metadataId} avec ${re.value}: ${U.join(" -> ")} -> ${g} -> ${re.metadataId}`);console.info(`Cascading metadata ${g} @ ${$} -> ${re.metadataId}  = ${re.value}`);const se=namespaceOfMetadataId(g);if(!se)throw new Error(`Metadata ${g} is not namespaced, cannot cascade onto ${re.metadataId}`);re.metadataId=ensureNamespacedMetadataId(re.metadataId,se),await storeMetadataValue({db:d,subjectId:m,manuallyModified:F,cascadedFrom:[...U,g],abortSignal:q,protocol:j,...re})}"beamup"in j&&G&&!G.manuallyModified&&F&&storeCorrection(databaseHandle(),j,m,V,MetadataValue.assert(G),H).catch(console.error),U.length===0&&await refreshTables(Z?"Image":"Observation")}async function observationMetadata(d,m){const g=await d.getAll("Image").then($=>$.filter(I=>m.images.includes(I.id)));return{...await mergeMetadataValues(d,g.map($=>Schemas.MetadataValues.assert($.metadata))),...m.metadataOverrides}}async function addValueLabels(d,m){return Object.fromEntries(Object.entries(d).map(([g,w])=>{const $=m[g];return $?[g,{...w,valueLabel:$?.find(I=>I.key===w.value.toString())?.label}]:[g,w]}))}async function mergeMetadataValues(d,m){if(m.length===1)return mapValues(m[0],$=>({...$,merged:!1}));const g={},w=new Set(m.flatMap($=>Object.keys($)));for(const $ of w){const I=Schemas.Metadata.assert(await d.get("Metadata",$));if(!I){console.warn(`Cannot merge metadata values for unknown key ${$}`);continue}const D=m.flatMap(U=>Object.entries(U).filter(([q])=>q===$).map(([,q])=>q)),F=mergeMetadata(I,D);F!=null&&(g[$]={...F,merged:new Set(D.map(U=>JSON.stringify(U.value))).size>1})}return g}function mergeMetadata(d,m){const g=(w,$)=>Object.fromEntries($.flatMap(I=>Object.keys(I.alternatives)).map(I=>[I,w($.flatMap(D=>D.alternatives[I]??null).filter(Boolean))]));switch(d.mergeMethod){case"average":return{value:mergeAverage(d.type,m.map(w=>w.value)),manuallyModified:m.some(w=>w.manuallyModified),confidence:avg(m.map(w=>w.confidence)),alternatives:g(avg,m)};case"max":case"min":return{value:mergeByMajority(d.type,m,d.mergeMethod==="max"?max:min),manuallyModified:m.some(w=>w.manuallyModified),confidence:max(m.map(w=>w.confidence)),alternatives:g(max,m)};case"median":return{value:mergeMedian(d.type,m.map(w=>w.value)),manuallyModified:m.some(w=>w.manuallyModified),confidence:median(m.map(w=>w.confidence)),alternatives:g(median,m)};case"union":return{value:mergeByUnion(d.type,m.map(w=>w.value)),manuallyModified:m.some(w=>w.manuallyModified),confidence:avg(m.map(w=>w.confidence)),alternatives:g(avg,m)};case"none":return null}}const max=d=>Math.max(...d),min=d=>Math.min(...d);function mergeByMajority(d,m,g){const w=Math.max(...m.map(I=>I.confidence)),$=m.filter(I=>I.confidence===w);try{return g($.map(I=>I.value))}catch(I){return console.error(I),$[0].value}}function mergeAverage(d,m){const g=w=>avg(toNumber(d,w));if(d==="boolean")return g(m)>.5;if(d==="integer")return Math.ceil(g(m));if(d==="float")return g(m);if(d==="date")return new Date(g(m));if(d==="location")return{latitude:avg(m.map(w=>w.latitude)),longitude:avg(m.map(w=>w.longitude))};throw new Error(`Impossible de fusionner en mode moyenne des valeurs de type ${d}`)}const median=d=>{const m=d.sort((w,$)=>w-$),g=Math.floor(m.length/2);return m.length%2===0?(m[g-1]+m[g])/2:m[g]};function mergeMedian(d,m){const g=w=>median(toNumber(d,w));if(d==="boolean")return g(m)>.5;if(d==="integer")return Math.ceil(g(m));if(d==="float")return g(m);if(d==="date")return new Date(g(m));if(d==="location")return{latitude:median(m.map(w=>w.latitude)),longitude:median(m.map(w=>w.longitude))};throw new Error(`Impossible de fusionner en mode mÃ©diane des valeurs de type ${d}`)}function mergeByUnion(d,m){if(!areType("boundingbox",d,m))throw new Error(`Impossible de fusionner en mode union des valeurs de type ${d}`);const g=Math.min(...m.map(D=>D.x)),w=Math.min(...m.map(D=>D.y)),$=Math.max(...m.map(D=>D.x+D.w)),I=Math.max(...m.map(D=>D.y+D.h));return{x:g,y:w,w:$-g,h:I-w}}function toNumber(d,m){if(d==="integer"||d==="float")return m;if(d==="boolean")return m.map(g=>g?1:0);if(d==="date")return m.map(g=>new Date(g).getTime());throw new Error(`Impossible de convertir des valeurs de type ${d} en nombre`)}function metadataPrettyValue(d,m,g,w=void 0){if(g===null)return"";switch(m.type){case"boolean":switch(d){case"fr":return g?"Oui":"Non";default:return g?"Yes":"No"}case"date":return g instanceof Date?format(g,"Ppp"):g.toString();case"enum":return w||g.toString();case"location":{const{latitude:$,longitude:I}=type({latitude:"number",longitude:"number"}).assert(g);return`${$}, ${I}`}case"boundingbox":{const{x:$,y:I,w:D,h:F}=type({x:"number",y:"number",h:"number",w:"number"}).assert(g);switch(d){case"fr":return`BoÃ®te de (${$}, ${I}) Ã  (${$+D}, ${I+F})`;default:return`Box from (${$}, ${I}) to (${$+D}, ${I+F})`}}case"float":case"integer":return Intl.NumberFormat(d).format(type("number").assert(g));default:return g.toString()}}function metadataPrettyKey(d){let m=d.label;switch(d.type){case"location":m+=" (latitude, longitude)"}return m}function isType(d,m,g){const w=$=>m===d&&(g===void 0||!($(g)instanceof type.errors));switch(d){case"boolean":return w(type("boolean"));case"integer":case"float":return w(type("number"));case"enum":return w(type("string | number"));case"date":return w(type("Date"));case"location":return w(type({latitude:"number",longitude:"number"}));case"boundingbox":return w(type({x:"number",y:"number",w:"number",h:"number"}));case"string":return w(type("string"));default:throw new Error(`Type inconnu: ${d}`)}}function areType(d,m,g){return g.every(w=>isType(d,m,w))}const METADATA_ZERO_VALUE={value:null,manuallyModified:!1,confidence:0,alternatives:{}};function protocolMetadataValues(d,m){return fromEntries(d.metadata.filter(g=>isNamespacedToProtocol(d.id,g)).map(g=>[removeNamespaceFromMetadataId(g),m[g]??METADATA_ZERO_VALUE]))}function metadataOptionsKeyRange(d,m){if(m){const g=ensureNamespacedMetadataId(m,d);return IDBKeyRange.bound(g+":",g+":ï¿¿")}else return IDBKeyRange.bound(namespacedMetadataId("",d),namespacedMetadataId("ï¿¿",d))}const TOAST_POOLS={default:{lifetime:3e3,capacity:3},exporter:{lifetime:1/0,capacity:1/0},protocolcreator:{lifetime:1/0,capacity:1/0}};class Toasts{#r=state();get pools(){return get$1(this.#r)}set pools(m){set$1(this.#r,m,!0)}#i=state();get currentPoolName(){return get$1(this.#i)}set currentPoolName(m){set$1(this.#i,m,!0)}constructor(m,g){this.currentPoolName=g,this.pools=mapValues(m,w=>({items:[],...w}))}get pool(){return this.pools[this.currentPoolName]}setCurrentPool(m){this.#e(m),this.freeze(this.currentPoolName),this.currentPoolName=m,this.unfreeze(this.currentPoolName)}items(m=void 0){return m&&this.#e(m),this.pools[m??this.currentPoolName].items}#e(m){if(!this.pools[m])throw new Error(`Toast pool ${m} does not exist`)}add(m,g,w){if(!g)return;const{labels:$,data:I,closed:D,action:F,lifetime:U="inferred",...q}=w??{},j={closed:D,action:F};if(Object.values(j).some(Boolean)&&!I)throw new Error("You must provide data if you're using callbacks");const G=nanoid(),H={addedAt:new Date,id:G,message:g.replaceAll(`
`,"; "),type:m,labels:$??{},callbacks:j,data:I??null,lifetime:U==="inferred"?this.#a(g):U,...q};return Number.isFinite(H.lifetime)&&this.#t(H),this.pools[this.currentPoolName].items=[...this.items().slice(0,this.pool.capacity-1),H],G}withUndo(m,g,{undo:w,commit:$,...I}){if(!g)return;const D=this;return this.add(m,g,{lifetime:4*this.#a(g),data:[],...I,closed:$,action:F=>{w(),D.remove(F.id,D.currentPoolName,{silent:!0})},labels:{action:"Annuler"}})}info(m,g){return this.add("info",m,g)}warn(m,g){return this.add("warning",m,g)}error(m,g){return this.add("error",m?.toString()??"Erreur inattendue",{...g,lifetime:g?.lifetime??"inferred"})}success(m,g){return this.add("success",m,g)}async remove(m,g,{silent:w=!1}={}){for(const[$,{items:I}]of entries(this.pools)){if(g&&g!==$)continue;const D=I.find(F=>F.id===m);if(!D)return;w||await D.callbacks.closed?.(D),this.pools[$].items=this.items($).filter(F=>F.id!==m)}}async clear(m=this.currentPoolName){const g=this.items(m);await Promise.all(g.map(w=>w.callbacks?.closed?w.callbacks.closed(w):Promise.resolve())),this.pools[m].items=[]}freeze(m=this.currentPoolName){for(const g of this.items(m).filter(w=>w.timeoutHandle))clearTimeout(g.timeoutHandle)}unfreeze(m=this.currentPoolName){for(const g of this.items(m).filter(w=>w.timeoutHandle))this.#t(g)}#t(m){m.timeoutHandle=setTimeout(()=>{this.remove(m.id)},m.lifetime)}#a(m){const g=m.split(" ").length+m.split(" ").length;return this.pool.lifetime+minutesToMilliseconds(g/300)}}new Toasts(TOAST_POOLS,"default");function serializeExifValue(d){return d instanceof Date?format(d,"yyyy:MM:dd HH:mm:ss"):Array.isArray(d)?d:d===void 0?"undefined":d===null?"null":typeof d=="object"&&d!==null?Object.entries(d).map(([m,g])=>`${m}=${g}`).join(";"):d?.toString()??""}function addExifMetadata(d,m,g){const w=Schemas.Metadata.and({infer:[{exif:"string"},"|",{latitude:{exif:"string"},longitude:{exif:"string"}}]}),$={GPS:{},Exif:{}},I=(q,j)=>{const G=Object.keys(EXIF_GPS_FIELDS).includes(q)?"GPS":"Exif",H=serializeExifValue(j);H!==void 0&&($[G][piexif[`${G}IFD`][q]]=H)};for(const q of m.map(j=>w(j))){if(q instanceof type.errors)continue;const j=g[q.id]?.value;j!==void 0&&(type({latitude:{exif:"string"},longitude:{exif:"string"}}).allows(q.infer)&&type({latitude:"number",longitude:"number"}).allows(j)?(q.infer.latitude.exif==="GPSLatitude"?(I("GPSLatitudeRef",j.latitude>=0?"N":"S"),I("GPSLatitude",piexif.GPSHelper.degToDmsRational(j.latitude))):I(q.infer.latitude.exif,j.latitude),q.infer.longitude.exif==="GPSLongitude"?(I("GPSLongitudeRef",j.longitude>=0?"E":"W"),I("GPSLongitude",piexif.GPSHelper.degToDmsRational(j.longitude))):I(q.infer.longitude.exif,j.longitude)):I(q.infer.exif,j))}let D="",F=32e3;for(let q=0;q<d.byteLength;q+=F){const j=d.slice(q,q+F);D+=String.fromCharCode(...new Uint8Array(j))}const U=piexif.insert(piexif.dump($),D);return new Uint8Array(Array.from(U).map(q=>q.charCodeAt(0)))}/*!
 * ONNX Runtime Web v1.23.0
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */var Ln=Object.defineProperty,Gp=Object.getOwnPropertyDescriptor,Hp=Object.getOwnPropertyNames,Fp=Object.prototype.hasOwnProperty,Wn=(d=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(d,{get:(m,g)=>(typeof require<"u"?require:m)[g]}):d)(function(d){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+d+'" is not supported')}),L$1=(d,m)=>()=>(d&&(m=d(d=0)),m),Wt=(d,m)=>{for(var g in m)Ln(d,g,{get:m[g],enumerable:!0})},qp=(d,m,g,w)=>{if(m&&typeof m=="object"||typeof m=="function")for(let $ of Hp(m))!Fp.call(d,$)&&$!==g&&Ln(d,$,{get:()=>m[$],enumerable:!(w=Gp(m,$))||w.enumerable});return d},Xt=d=>qp(Ln({},"__esModule",{value:!0}),d),wr,kt,Pt,jp,Qi,Gn=L$1(()=>{wr=new Map,kt=[],Pt=(d,m,g)=>{if(m&&typeof m.init=="function"&&typeof m.createInferenceSessionHandler=="function"){let w=wr.get(d);if(w===void 0)wr.set(d,{backend:m,priority:g});else{if(w.priority>g)return;if(w.priority===g&&w.backend!==m)throw new Error(`cannot register backend "${d}" using priority ${g}`)}if(g>=0){let $=kt.indexOf(d);$!==-1&&kt.splice($,1);for(let I=0;I<kt.length;I++)if(wr.get(kt[I]).priority<=g){kt.splice(I,0,d);return}kt.push(d)}return}throw new TypeError("not a valid backend")},jp=async d=>{let m=wr.get(d);if(!m)return"backend not found.";if(m.initialized)return m.backend;if(m.aborted)return m.error;{let g=!!m.initPromise;try{return g||(m.initPromise=m.backend.init(d)),await m.initPromise,m.initialized=!0,m.backend}catch(w){return g||(m.error=`${w}`,m.aborted=!0),m.error}finally{delete m.initPromise}}},Qi=async d=>{let m=d.executionProviders||[],g=m.map(U=>typeof U=="string"?U:U.name),w=g.length===0?kt:g,$,I=[],D=new Set;for(let U of w){let q=await jp(U);typeof q=="string"?I.push({name:U,err:q}):($||($=q),$===q&&D.add(U))}if(!$)throw new Error(`no available backend found. ERR: ${I.map(U=>`[${U.name}] ${U.err}`).join(", ")}`);for(let{name:U,err:q}of I)g.includes(U)&&console.warn(`removing requested execution provider "${U}" from session options because it is not available: ${q}`);let F=m.filter(U=>D.has(typeof U=="string"?U:U.name));return[$,new Proxy(d,{get:(U,q)=>q==="executionProviders"?F:Reflect.get(U,q)})]}}),Yi=L$1(()=>{Gn()}),Xi,Ji=L$1(()=>{Xi="1.23.0"}),ea,Ee,Hn=L$1(()=>{Ji(),ea="warning",Ee={wasm:{},webgl:{},webgpu:{},versions:{common:Xi},set logLevel(d){if(d!==void 0){if(typeof d!="string"||["verbose","info","warning","error","fatal"].indexOf(d)===-1)throw new Error(`Unsupported logging level: ${d}`);ea=d}},get logLevel(){return ea}},Object.defineProperty(Ee,"logLevel",{enumerable:!0})}),we,ta=L$1(()=>{Hn(),we=Ee}),ra,na,oa=L$1(()=>{ra=(d,m)=>{let g=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);g.width=d.dims[3],g.height=d.dims[2];let w=g.getContext("2d");if(w!=null){let $,I;m?.tensorLayout!==void 0&&m.tensorLayout==="NHWC"?($=d.dims[2],I=d.dims[3]):($=d.dims[3],I=d.dims[2]);let D=m?.format!==void 0?m.format:"RGB",F=m?.norm,U,q;F===void 0||F.mean===void 0?U=[255,255,255,255]:typeof F.mean=="number"?U=[F.mean,F.mean,F.mean,F.mean]:(U=[F.mean[0],F.mean[1],F.mean[2],0],F.mean[3]!==void 0&&(U[3]=F.mean[3])),F===void 0||F.bias===void 0?q=[0,0,0,0]:typeof F.bias=="number"?q=[F.bias,F.bias,F.bias,F.bias]:(q=[F.bias[0],F.bias[1],F.bias[2],0],F.bias[3]!==void 0&&(q[3]=F.bias[3]));let j=I*$,G=0,H=j,V=j*2,Z=-1;D==="RGBA"?(G=0,H=j,V=j*2,Z=j*3):D==="RGB"?(G=0,H=j,V=j*2):D==="RBG"&&(G=0,V=j,H=j*2);for(let Q=0;Q<I;Q++)for(let J=0;J<$;J++){let ie=(d.data[G++]-q[0])*U[0],re=(d.data[H++]-q[1])*U[1],se=(d.data[V++]-q[2])*U[2],X=Z===-1?255:(d.data[Z++]-q[3])*U[3];w.fillStyle="rgba("+ie+","+re+","+se+","+X+")",w.fillRect(J,Q,1,1)}if("toDataURL"in g)return g.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},na=(d,m)=>{let g=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),w;if(g!=null){let $,I,D;m?.tensorLayout!==void 0&&m.tensorLayout==="NHWC"?($=d.dims[2],I=d.dims[1],D=d.dims[3]):($=d.dims[3],I=d.dims[2],D=d.dims[1]);let F=m!==void 0&&m.format!==void 0?m.format:"RGB",U=m?.norm,q,j;U===void 0||U.mean===void 0?q=[255,255,255,255]:typeof U.mean=="number"?q=[U.mean,U.mean,U.mean,U.mean]:(q=[U.mean[0],U.mean[1],U.mean[2],255],U.mean[3]!==void 0&&(q[3]=U.mean[3])),U===void 0||U.bias===void 0?j=[0,0,0,0]:typeof U.bias=="number"?j=[U.bias,U.bias,U.bias,U.bias]:(j=[U.bias[0],U.bias[1],U.bias[2],0],U.bias[3]!==void 0&&(j[3]=U.bias[3]));let G=I*$;if(m!==void 0&&(m.format!==void 0&&D===4&&m.format!=="RGBA"||D===3&&m.format!=="RGB"&&m.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let H=4,V=0,Z=1,Q=2,J=3,ie=0,re=G,se=G*2,X=-1;F==="RGBA"?(ie=0,re=G,se=G*2,X=G*3):F==="RGB"?(ie=0,re=G,se=G*2):F==="RBG"&&(ie=0,se=G,re=G*2),w=g.createImageData($,I);for(let ne=0;ne<I*$;V+=H,Z+=H,Q+=H,J+=H,ne++)w.data[V]=(d.data[ie++]-j[0])*q[0],w.data[Z]=(d.data[re++]-j[1])*q[1],w.data[Q]=(d.data[se++]-j[2])*q[2],w.data[J]=X===-1?255:(d.data[X++]-j[3])*q[3]}else throw new Error("Can not access image data");return w}}),Fn,ia,aa,sa,ua,la,da=L$1(()=>{vr(),Fn=(d,m)=>{if(d===void 0)throw new Error("Image buffer must be defined");if(m.height===void 0||m.width===void 0)throw new Error("Image height and width must be defined");if(m.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:g,width:w}=m,$=m.norm??{mean:255,bias:0},I,D;typeof $.mean=="number"?I=[$.mean,$.mean,$.mean,$.mean]:I=[$.mean[0],$.mean[1],$.mean[2],$.mean[3]??255],typeof $.bias=="number"?D=[$.bias,$.bias,$.bias,$.bias]:D=[$.bias[0],$.bias[1],$.bias[2],$.bias[3]??0];let F=m.format!==void 0?m.format:"RGBA",U=m.tensorFormat!==void 0&&m.tensorFormat!==void 0?m.tensorFormat:"RGB",q=g*w,j=U==="RGBA"?new Float32Array(q*4):new Float32Array(q*3),G=4,H=0,V=1,Z=2,Q=3,J=0,ie=q,re=q*2,se=-1;F==="RGB"&&(G=3,H=0,V=1,Z=2,Q=-1),U==="RGBA"?se=q*3:U==="RBG"?(J=0,re=q,ie=q*2):U==="BGR"&&(re=0,ie=q,J=q*2);for(let X=0;X<q;X++,H+=G,Z+=G,V+=G,Q+=G)j[J++]=(d[H]+D[0])/I[0],j[ie++]=(d[V]+D[1])/I[1],j[re++]=(d[Z]+D[2])/I[2],se!==-1&&Q!==-1&&(j[se++]=(d[Q]+D[3])/I[3]);return U==="RGBA"?new De("float32",j,[1,4,g,w]):new De("float32",j,[1,3,g,w])},ia=async(d,m)=>{let g=typeof HTMLImageElement<"u"&&d instanceof HTMLImageElement,w=typeof ImageData<"u"&&d instanceof ImageData,$=typeof ImageBitmap<"u"&&d instanceof ImageBitmap,I=typeof d=="string",D,F=m??{},U=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},q=j=>typeof HTMLCanvasElement<"u"&&j instanceof HTMLCanvasElement||j instanceof OffscreenCanvas?j.getContext("2d"):null;if(g){let j=U();j.width=d.width,j.height=d.height;let G=q(j);if(G!=null){let H=d.height,V=d.width;if(m!==void 0&&m.resizedHeight!==void 0&&m.resizedWidth!==void 0&&(H=m.resizedHeight,V=m.resizedWidth),m!==void 0){if(F=m,m.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");F.tensorFormat="RGBA",F.height=H,F.width=V}else F.tensorFormat="RGBA",F.height=H,F.width=V;G.drawImage(d,0,0),D=G.getImageData(0,0,V,H).data}else throw new Error("Can not access image data")}else if(w){let j,G;if(m!==void 0&&m.resizedWidth!==void 0&&m.resizedHeight!==void 0?(j=m.resizedHeight,G=m.resizedWidth):(j=d.height,G=d.width),m!==void 0&&(F=m),F.format="RGBA",F.height=j,F.width=G,m!==void 0){let H=U();H.width=G,H.height=j;let V=q(H);if(V!=null)V.putImageData(d,0,0),D=V.getImageData(0,0,G,j).data;else throw new Error("Can not access image data")}else D=d.data}else if($){if(m===void 0)throw new Error("Please provide image config with format for Imagebitmap");let j=U();j.width=d.width,j.height=d.height;let G=q(j);if(G!=null){let H=d.height,V=d.width;return G.drawImage(d,0,0,V,H),D=G.getImageData(0,0,V,H).data,F.height=H,F.width=V,Fn(D,F)}else throw new Error("Can not access image data")}else{if(I)return new Promise((j,G)=>{let H=U(),V=q(H);if(!d||!V)return G();let Z=new Image;Z.crossOrigin="Anonymous",Z.src=d,Z.onload=()=>{H.width=Z.width,H.height=Z.height,V.drawImage(Z,0,0,H.width,H.height);let Q=V.getImageData(0,0,H.width,H.height);F.height=H.height,F.width=H.width,j(Fn(Q.data,F))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(D!==void 0)return Fn(D,F);throw new Error("Input data provided is not supported - aborted tensor creation")},aa=(d,m)=>{let{width:g,height:w,download:$,dispose:I}=m,D=[1,w,g,4];return new De({location:"texture",type:"float32",texture:d,dims:D,download:$,dispose:I})},sa=(d,m)=>{let{dataType:g,dims:w,download:$,dispose:I}=m;return new De({location:"gpu-buffer",type:g??"float32",gpuBuffer:d,dims:w,download:$,dispose:I})},ua=(d,m)=>{let{dataType:g,dims:w,download:$,dispose:I}=m;return new De({location:"ml-tensor",type:g??"float32",mlTensor:d,dims:w,download:$,dispose:I})},la=(d,m,g)=>new De({location:"cpu-pinned",type:d,data:m,dims:g??[m.length]})}),Ot,Jt,ca,pa,ma=L$1(()=>{Ot=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Jt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),ca=!1,pa=()=>{if(!ca){ca=!0;let d=typeof BigInt64Array<"u"&&BigInt64Array.from,m=typeof BigUint64Array<"u"&&BigUint64Array.from,g=globalThis.Float16Array,w=typeof g<"u"&&g.from;d&&(Ot.set("int64",BigInt64Array),Jt.set(BigInt64Array,"int64")),m&&(Ot.set("uint64",BigUint64Array),Jt.set(BigUint64Array,"uint64")),w?(Ot.set("float16",g),Jt.set(g,"float16")):Ot.set("float16",Uint16Array)}}}),fa,ha,ga=L$1(()=>{vr(),fa=d=>{let m=1;for(let g=0;g<d.length;g++){let w=d[g];if(typeof w!="number"||!Number.isSafeInteger(w))throw new TypeError(`dims[${g}] must be an integer, got: ${w}`);if(w<0)throw new RangeError(`dims[${g}] must be a non-negative integer, got: ${w}`);m*=w}return m},ha=(d,m)=>{switch(d.location){case"cpu":return new De(d.type,d.data,m);case"cpu-pinned":return new De({location:"cpu-pinned",data:d.data,type:d.type,dims:m});case"texture":return new De({location:"texture",texture:d.texture,type:d.type,dims:m});case"gpu-buffer":return new De({location:"gpu-buffer",gpuBuffer:d.gpuBuffer,type:d.type,dims:m});case"ml-tensor":return new De({location:"ml-tensor",mlTensor:d.mlTensor,type:d.type,dims:m});default:throw new Error(`tensorReshape: tensor location ${d.location} is not supported`)}}}),De,vr=L$1(()=>{oa(),da(),ma(),ga(),De=class{constructor(d,m,g){pa();let w,$;if(typeof d=="object"&&"location"in d)switch(this.dataLocation=d.location,w=d.type,$=d.dims,d.location){case"cpu-pinned":{let D=Ot.get(w);if(!D)throw new TypeError(`unsupported type "${w}" to create tensor from pinned buffer`);if(!(d.data instanceof D))throw new TypeError(`buffer should be of type ${D.name}`);this.cpuData=d.data;break}case"texture":{if(w!=="float32")throw new TypeError(`unsupported type "${w}" to create tensor from texture`);this.gpuTextureData=d.texture,this.downloader=d.download,this.disposer=d.dispose;break}case"gpu-buffer":{if(w!=="float32"&&w!=="float16"&&w!=="int32"&&w!=="int64"&&w!=="uint32"&&w!=="uint8"&&w!=="bool"&&w!=="uint4"&&w!=="int4")throw new TypeError(`unsupported type "${w}" to create tensor from gpu buffer`);this.gpuBufferData=d.gpuBuffer,this.downloader=d.download,this.disposer=d.dispose;break}case"ml-tensor":{if(w!=="float32"&&w!=="float16"&&w!=="int32"&&w!=="int64"&&w!=="uint32"&&w!=="uint64"&&w!=="int8"&&w!=="uint8"&&w!=="bool"&&w!=="uint4"&&w!=="int4")throw new TypeError(`unsupported type "${w}" to create tensor from MLTensor`);this.mlTensorData=d.mlTensor,this.downloader=d.download,this.disposer=d.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let D,F;if(typeof d=="string")if(w=d,F=g,d==="string"){if(!Array.isArray(m))throw new TypeError("A string tensor's data must be a string array.");D=m}else{let U=Ot.get(d);if(U===void 0)throw new TypeError(`Unsupported tensor type: ${d}.`);if(Array.isArray(m)){if(d==="float16"&&U===Uint16Array||d==="uint4"||d==="int4")throw new TypeError(`Creating a ${d} tensor from number array is not supported. Please use ${U.name} as data.`);d==="uint64"||d==="int64"?D=U.from(m,BigInt):D=U.from(m)}else if(m instanceof U)D=m;else if(m instanceof Uint8ClampedArray)if(d==="uint8")D=Uint8Array.from(m);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(d==="float16"&&m instanceof Uint16Array&&U!==Uint16Array)D=new globalThis.Float16Array(m.buffer,m.byteOffset,m.length);else throw new TypeError(`A ${w} tensor's data must be type of ${U}`)}else if(F=m,Array.isArray(d)){if(d.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let U=typeof d[0];if(U==="string")w="string",D=d;else if(U==="boolean")w="bool",D=Uint8Array.from(d);else throw new TypeError(`Invalid element type of data array: ${U}.`)}else if(d instanceof Uint8ClampedArray)w="uint8",D=Uint8Array.from(d);else{let U=Jt.get(d.constructor);if(U===void 0)throw new TypeError(`Unsupported type for tensor data: ${d.constructor}.`);w=U,D=d}if(F===void 0)F=[D.length];else if(!Array.isArray(F))throw new TypeError("A tensor's dims must be a number array");$=F,this.cpuData=D,this.dataLocation="cpu"}let I=fa($);if(this.cpuData&&I!==this.cpuData.length&&!((w==="uint4"||w==="int4")&&Math.ceil(I/2)===this.cpuData.length))throw new Error(`Tensor's size(${I}) does not match data length(${this.cpuData.length}).`);this.type=w,this.dims=$,this.size=I}static async fromImage(d,m){return ia(d,m)}static fromTexture(d,m){return aa(d,m)}static fromGpuBuffer(d,m){return sa(d,m)}static fromMLTensor(d,m){return ua(d,m)}static fromPinnedBuffer(d,m,g){return la(d,m,g)}toDataURL(d){return ra(this,d)}toImageData(d){return na(this,d)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(d){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let m=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=m,d&&this.disposer&&(this.disposer(),this.disposer=void 0),m}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(d){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return ha(this,d)}}}),qe,qn=L$1(()=>{vr(),qe=De}),$r,ya,Ne,Me,wt,vt,jn=L$1(()=>{Hn(),$r=(d,m)=>{(typeof Ee.trace>"u"?!Ee.wasm.trace:!Ee.trace)||console.timeStamp(`${d}::ORT::${m}`)},ya=(d,m)=>{let g=new Error().stack?.split(/\r\n|\r|\n/g)||[],w=!1;for(let $=0;$<g.length;$++){if(w&&!g[$].includes("TRACE_FUNC")){let I=`FUNC_${d}::${g[$].trim().split(" ")[1]}`;m&&(I+=`::${m}`),$r("CPU",I);return}g[$].includes("TRACE_FUNC")&&(w=!0)}},Ne=d=>{(typeof Ee.trace>"u"?!Ee.wasm.trace:!Ee.trace)||ya("BEGIN",d)},Me=d=>{(typeof Ee.trace>"u"?!Ee.wasm.trace:!Ee.trace)||ya("END",d)},wt=d=>{(typeof Ee.trace>"u"?!Ee.wasm.trace:!Ee.trace)||console.time(`ORT::${d}`)},vt=d=>{(typeof Ee.trace>"u"?!Ee.wasm.trace:!Ee.trace)||console.timeEnd(`ORT::${d}`)}}),xr,ba=L$1(()=>{Gn(),qn(),jn(),xr=class tp{constructor(m){this.handler=m}async run(m,g,w){Ne(),wt("InferenceSession.run");let $={},I={};if(typeof m!="object"||m===null||m instanceof qe||Array.isArray(m))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let D=!0;if(typeof g=="object"){if(g===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(g instanceof qe)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(g)){if(g.length===0)throw new TypeError("'fetches' cannot be an empty array.");D=!1;for(let q of g){if(typeof q!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(q)===-1)throw new RangeError(`'fetches' contains invalid output name: ${q}.`);$[q]=null}if(typeof w=="object"&&w!==null)I=w;else if(typeof w<"u")throw new TypeError("'options' must be an object.")}else{let q=!1,j=Object.getOwnPropertyNames(g);for(let G of this.outputNames)if(j.indexOf(G)!==-1){let H=g[G];(H===null||H instanceof qe)&&(q=!0,D=!1,$[G]=H)}if(q){if(typeof w=="object"&&w!==null)I=w;else if(typeof w<"u")throw new TypeError("'options' must be an object.")}else I=g}}else if(typeof g<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let q of this.inputNames)if(typeof m[q]>"u")throw new Error(`input '${q}' is missing in 'feeds'.`);if(D)for(let q of this.outputNames)$[q]=null;let F=await this.handler.run(m,$,I),U={};for(let q in F)if(Object.hasOwnProperty.call(F,q)){let j=F[q];j instanceof qe?U[q]=j:U[q]=new qe(j.type,j.data,j.dims)}return vt("InferenceSession.run"),Me(),U}async release(){return this.handler.dispose()}static async create(m,g,w,$){Ne(),wt("InferenceSession.create");let I,D={};if(typeof m=="string"){if(I=m,typeof g=="object"&&g!==null)D=g;else if(typeof g<"u")throw new TypeError("'options' must be an object.")}else if(m instanceof Uint8Array){if(I=m,typeof g=="object"&&g!==null)D=g;else if(typeof g<"u")throw new TypeError("'options' must be an object.")}else if(m instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&m instanceof SharedArrayBuffer){let j=m,G=0,H=m.byteLength;if(typeof g=="object"&&g!==null)D=g;else if(typeof g=="number"){if(G=g,!Number.isSafeInteger(G))throw new RangeError("'byteOffset' must be an integer.");if(G<0||G>=j.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${j.byteLength}).`);if(H=m.byteLength-G,typeof w=="number"){if(H=w,!Number.isSafeInteger(H))throw new RangeError("'byteLength' must be an integer.");if(H<=0||G+H>j.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${j.byteLength-G}].`);if(typeof $=="object"&&$!==null)D=$;else if(typeof $<"u")throw new TypeError("'options' must be an object.")}else if(typeof w<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof g<"u")throw new TypeError("'options' must be an object.");I=new Uint8Array(j,G,H)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[F,U]=await Qi(D),q=await F.createInferenceSessionHandler(I,U);return vt("InferenceSession.create"),Me(),new tp(q)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Kp,_a=L$1(()=>{ba(),Kp=xr}),wa=L$1(()=>{}),va=L$1(()=>{}),$a=L$1(()=>{}),xa=L$1(()=>{}),Kn={};Wt(Kn,{InferenceSession:()=>Kp,TRACE:()=>$r,TRACE_EVENT_BEGIN:()=>wt,TRACE_EVENT_END:()=>vt,TRACE_FUNC_BEGIN:()=>Ne,TRACE_FUNC_END:()=>Me,Tensor:()=>qe,env:()=>we,registerBackend:()=>Pt});var Ve=L$1(()=>{Yi(),ta(),_a(),qn(),wa(),va(),jn(),$a(),xa()}),Sr=L$1(()=>{}),Ia={};Wt(Ia,{default:()=>Zp});var Ta,Ca,Zp,Aa=L$1(()=>{Zn(),$t(),Tr(),Ta="ort-wasm-proxy-worker",Ca=globalThis.self?.name===Ta,Ca&&(self.onmessage=d=>{let{type:m,in:g}=d.data;try{switch(m){case"init-wasm":Cr(g.wasm).then(()=>{Ir(g).then(()=>{postMessage({type:m})},w=>{postMessage({type:m,err:w})})},w=>{postMessage({type:m,err:w})});break;case"init-ep":{let{epName:w,env:$}=g;Ar($,w).then(()=>{postMessage({type:m})},I=>{postMessage({type:m,err:I})});break}case"copy-from":{let{buffer:w}=g,$=er(w);postMessage({type:m,out:$});break}case"create":{let{model:w,options:$}=g;Er(w,$).then(I=>{postMessage({type:m,out:I})},I=>{postMessage({type:m,err:I})});break}case"release":kr(g),postMessage({type:m});break;case"run":{let{sessionId:w,inputIndices:$,inputs:I,outputIndices:D,options:F}=g;Pr(w,$,I,D,new Array(D.length).fill(null),F).then(U=>{U.some(q=>q[3]!=="cpu")?postMessage({type:m,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:m,out:U},zr([...I,...U]))},U=>{postMessage({type:m,err:U})});break}case"end-profiling":Or(g),postMessage({type:m});break;default:}}catch(w){postMessage({type:m,err:w})}}),Zp=Ca?null:d=>new Worker(d??Le,{type:"module",name:Ta})}),ka={};Wt(ka,{default:()=>Qp});var Ea,Qp,Yp,Pa=L$1(()=>{Ea=async function(d={}){var m,g,w=d,$=new Promise((pe,Ie)=>{m=pe,g=Ie}),I=typeof window=="object",D=typeof WorkerGlobalScope<"u",F=D&&self.name?.startsWith("em-pthread");w.mountExternalData=(pe,Ie)=>{pe.startsWith("./")&&(pe=pe.substring(2)),(w.Fb||(w.Fb=new Map)).set(pe,Ie)},w.unmountExternalData=()=>{delete w.Fb};var U=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let q=pe=>async(...Ie)=>{try{if(w.Gb)throw Error("Session already started");let Ge=w.Gb={ec:Ie[0],errors:[]},gt=await pe(...Ie);if(w.Gb!==Ge)throw Error("Session mismatch");w.Kb?.flush();let Lt=Ge.errors;if(0<Lt.length){let mr=await Promise.all(Lt);if(mr=mr.filter(ti=>ti),0<mr.length)throw Error(mr.join(`
`))}return gt}finally{w.Gb=null}};w.jsepInit=(pe,Ie)=>{if(pe==="webgpu"){[w.Kb,w.Vb,w.Zb,w.Lb,w.Yb,w.Ab,w.$b,w.bc,w.Wb,w.Xb,w.ac]=Ie;let Ge=w.Kb;w.jsepRegisterBuffer=(gt,Lt,mr,ti)=>Ge.registerBuffer(gt,Lt,mr,ti),w.jsepGetBuffer=gt=>Ge.getBuffer(gt),w.jsepCreateDownloader=(gt,Lt,mr)=>Ge.createDownloader(gt,Lt,mr),w.jsepOnCreateSession=gt=>{Ge.onCreateSession(gt)},w.jsepOnReleaseSession=gt=>{Ge.onReleaseSession(gt)},w.jsepOnRunStart=gt=>Ge.onRunStart(gt),w.cc=(gt,Lt)=>{Ge.upload(gt,Lt)}}else if(pe==="webnn"){let Ge=Ie[0];[w.oc,w.Ob,w.webnnEnsureTensor,w.Pb,w.webnnDownloadTensor,w.nc,w.webnnEnableTraceEvent]=Ie.slice(1),w.webnnReleaseTensorId=w.Ob,w.webnnUploadTensor=w.Pb,w.webnnRegisterMLContext=w.nc,w.webnnOnRunStart=gt=>Ge.onRunStart(gt),w.webnnOnRunEnd=Ge.onRunEnd.bind(Ge),w.webnnOnReleaseSession=gt=>{Ge.onReleaseSession(gt)},w.webnnCreateMLTensorDownloader=(gt,Lt)=>Ge.createMLTensorDownloader(gt,Lt),w.webnnRegisterMLTensor=(gt,Lt,mr,ti)=>Ge.registerMLTensor(gt,Lt,mr,ti),w.webnnCreateMLContext=gt=>Ge.createMLContext(gt),w.webnnRegisterMLConstant=(gt,Lt,mr,ti,oi,pi)=>Ge.registerMLConstant(gt,Lt,mr,ti,oi,w.Fb,pi),w.webnnRegisterGraphInput=Ge.registerGraphInput.bind(Ge),w.webnnIsGraphInput=Ge.isGraphInput.bind(Ge),w.webnnRegisterGraphOutput=Ge.registerGraphOutput.bind(Ge),w.webnnIsGraphOutput=Ge.isGraphOutput.bind(Ge),w.webnnCreateTemporaryTensor=Ge.createTemporaryTensor.bind(Ge),w.webnnIsGraphInputOutputTypeSupported=Ge.isGraphInputOutputTypeSupported.bind(Ge)}};let j=()=>{let pe=(Ie,Ge,gt)=>(...Lt)=>{let mr=Zi,ti=Ge?.();Lt=Ie(...Lt);let oi=Ge?.();return ti!==oi&&(Ie=oi,gt(ti),Ge=gt=null),Zi!=mr?new Promise((pi,mi)=>{Ho={resolve:pi,reject:mi}}):Lt};(()=>{for(let Ie of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])w[Ie]=pe(w[Ie],()=>w[Ie],Ge=>w[Ie]=Ge)})(),q!==void 0&&(w._OrtRun=q(w._OrtRun),w._OrtRunWithBinding=q(w._OrtRunWithBinding)),j=void 0};w.asyncInit=()=>{j?.()};var G,H,V=(pe,Ie)=>{throw Ie},Z=import.meta.url,Q="";if(I||D){try{Q=new URL(".",Z).href}catch{}D&&(H=pe=>{var Ie=new XMLHttpRequest;return Ie.open("GET",pe,!1),Ie.responseType="arraybuffer",Ie.send(null),new Uint8Array(Ie.response)}),G=async pe=>{if(Zt(pe))return new Promise((Ge,gt)=>{var Lt=new XMLHttpRequest;Lt.open("GET",pe,!0),Lt.responseType="arraybuffer",Lt.onload=()=>{Lt.status==200||Lt.status==0&&Lt.response?Ge(Lt.response):gt(Lt.status)},Lt.onerror=gt,Lt.send(null)});var Ie=await fetch(pe,{credentials:"same-origin"});if(Ie.ok)return Ie.arrayBuffer();throw Error(Ie.status+" : "+Ie.url)}}var J,ie,re,se,X,ne,ce,oe,de,me,ge,fe,xe,Fe,Te,Oe=console.log.bind(console),Be=console.error.bind(console),_t=Oe,Et=Be,dt=!1,Zt=pe=>pe.startsWith("file://");function Ye(){return ie.buffer!=X.buffer&&zt(),X}function bt(){return ie.buffer!=X.buffer&&zt(),ne}function Qt(){return ie.buffer!=X.buffer&&zt(),ce}function Vt(){return ie.buffer!=X.buffer&&zt(),oe}function ut(){return ie.buffer!=X.buffer&&zt(),de}function At(){return ie.buffer!=X.buffer&&zt(),me}function dr(){return ie.buffer!=X.buffer&&zt(),ge}function fr(){return ie.buffer!=X.buffer&&zt(),Fe}if(F){let pe=function(Ie){try{var Ge=Ie.data,gt=Ge.Db;if(gt==="load"){let Lt=[];self.onmessage=mr=>Lt.push(mr),self.startWorker=()=>{postMessage({Db:"loaded"});for(let mr of Lt)pe(mr);self.onmessage=pe};for(let mr of Ge.Sb)w[mr]&&!w[mr].proxy||(w[mr]=(...ti)=>{postMessage({Db:"callHandler",Rb:mr,args:ti})},mr=="print"&&(_t=w[mr]),mr=="printErr"&&(Et=w[mr]));ie=Ge.kc,zt(),Te(Ge.lc)}else if(gt==="run"){di(Ge.Bb),Yo(Ge.Bb,0,0,1,0,0),ki(),jo(Ge.Bb),pr||(Vc(),pr=!0);try{br(Ge.hc,Ge.Jb)}catch(Lt){if(Lt!="unwind")throw Lt}}else Ge.target!=="setimmediate"&&(gt==="checkMailbox"?pr&&Pn():gt&&(Et(`worker: received unknown command ${gt}`),Et(Ge)))}catch(Lt){throw Kc(),Lt}};var pr=!1;self.onunhandledrejection=Ie=>{throw Ie.reason||Ie},self.onmessage=pe}function zt(){var pe=ie.buffer;w.HEAP8=X=new Int8Array(pe),ce=new Int16Array(pe),w.HEAPU8=ne=new Uint8Array(pe),oe=new Uint16Array(pe),w.HEAP32=de=new Int32Array(pe),w.HEAPU32=me=new Uint32Array(pe),ge=new Float32Array(pe),Fe=new Float64Array(pe),fe=new BigInt64Array(pe),xe=new BigUint64Array(pe)}function Ce(){F?startWorker(w):ci.Da()}var Nt,Xe=0,lt=null;function st(){if(--Xe==0&&lt){var pe=lt;lt=null,pe()}}function yt(pe){throw Et(pe="Aborted("+pe+")"),dt=!0,pe=new WebAssembly.RuntimeError(pe+". Build with -sASSERTIONS for more info."),g(pe),pe}function Yt(){return{a:{L:$0,Aa:k0,b:It,$:Ei,A:hr,pa:ei,X:ri,Z:xi,qa:gi,na:wi,ga:Ii,ma:Ui,J:Ti,Y:Mi,V:Di,oa:Bi,W:Vi,va:Ni,E:Cn,Q:Tn,O:ap,D:op,v:lp,s:up,P:cp,z:yp,R:bp,ja:_p,T:wp,aa:vp,M:xp,F:Sp,ia:jo,sa:Ep,r:kp,Ca:$p,w:Cp,o:Tp,m:Mp,c:En,Ba:Op,n:Rp,j:Bp,u:Lp,p:zp,f:Up,t:Wp,l:Vp,e:e0,k:t0,h:r0,g:i0,d:n0,da:a0,ea:s0,fa:o0,ba:Oc,ca:Rc,N:Nc,xa:u0,ua:d0,i:f0,C:h0,G:p0,ta:c0,x:m0,ra:g0,U:y0,q:l0,y:b0,K:_0,S:w0,za:v0,ya:x0,ka:zc,la:Fc,_:ai,B:Uc,I:qc,ha:jc,H:Gc,a:ie,wa:li}}}class $e{name="ExitStatus";constructor(Ie){this.message=`Program terminated with exit(${Ie})`,this.status=Ie}}var ze=pe=>{pe.terminate(),pe.onmessage=()=>{}},ft=[],ht=pe=>{hi.length==0&&(cr(),yi(hi[0]));var Ie=hi.pop();if(!Ie)return 6;ui.push(Ie),bi[pe.Bb]=Ie,Ie.Bb=pe.Bb;var Ge={Db:"run",hc:pe.fc,Jb:pe.Jb,Bb:pe.Bb};return Ie.postMessage(Ge,pe.Nb),0},gr=0,yr=(pe,Ie,...Ge)=>{for(var gt=2*Ge.length,Lt=xu(),mr=Xo(8*gt),ti=mr>>>3,oi=0;oi<Ge.length;oi++){var pi=Ge[oi];typeof pi=="bigint"?(fe[ti+2*oi]=1n,fe[ti+2*oi+1]=pi):(fe[ti+2*oi]=0n,fr()[ti+2*oi+1>>>0]=pi)}return pe=Zc(pe,0,gt,mr,Ie),Vn(Lt),pe};function li(pe){if(F)return yr(0,1,pe);if(se=pe,!(0<gr)){for(var Ie of ui)ze(Ie);for(Ie of hi)ze(Ie);hi=[],ui=[],bi={},dt=!0}V(0,new $e(pe))}function fi(pe){if(F)return yr(1,0,pe);ai(pe)}var ai=pe=>{if(se=pe,F)throw fi(pe),"unwind";li(pe)},hi=[],ui=[],vi=[],bi={},_i=pe=>{var Ie=pe.Bb;delete bi[Ie],hi.push(pe),ui.splice(ui.indexOf(pe),1),pe.Bb=0,Qc(Ie)};function ki(){vi.forEach(pe=>pe())}var yi=pe=>new Promise(Ie=>{pe.onmessage=Lt=>{var mr=(Lt=Lt.data).Db;if(Lt.Hb&&Lt.Hb!=Qo()){var ti=bi[Lt.Hb];ti?ti.postMessage(Lt,Lt.Nb):Et(`Internal error! Worker sent a message "${mr}" to target pthread ${Lt.Hb}, but that thread no longer exists!`)}else mr==="checkMailbox"?Pn():mr==="spawnThread"?ht(Lt):mr==="cleanupThread"?_i(bi[Lt.ic]):mr==="loaded"?(pe.loaded=!0,Ie(pe)):Lt.target==="setimmediate"?pe.postMessage(Lt):mr==="callHandler"?w[Lt.Rb](...Lt.args):mr&&Et(`worker sent an unknown command ${mr}`)},pe.onerror=Lt=>{throw Et(`worker sent an error! ${Lt.filename}:${Lt.lineno}: ${Lt.message}`),Lt};var Ge,gt=[];for(Ge of[])w.propertyIsEnumerable(Ge)&&gt.push(Ge);pe.postMessage({Db:"load",Sb:gt,kc:ie,lc:re})});function cr(){var pe=new Worker((()=>{let Ie=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new Ie("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});hi.push(pe)}var di=pe=>{zt();var Ie=At()[pe+52>>>2>>>0];pe=At()[pe+56>>>2>>>0],Xc(Ie,Ie-pe),Vn(Ie)},br=(pe,Ie)=>{gr=0,pe=uf(pe,Ie),0<gr?se=pe:Jo(pe)};class ii{constructor(Ie){this.Ib=Ie-24}}function It(pe,Ie,Ge){var gt=new ii(pe>>>=0);throw Ie>>>=0,Ge>>>=0,At()[gt.Ib+16>>>2>>>0]=0,At()[gt.Ib+4>>>2>>>0]=Ie,At()[gt.Ib+8>>>2>>>0]=Ge,pe}function si(pe,Ie,Ge,gt){return F?yr(2,1,pe,Ie,Ge,gt):Ei(pe,Ie,Ge,gt)}function Ei(pe,Ie,Ge,gt){if(pe>>>=0,Ge>>>=0,gt>>>=0,U===void 0)return 6;var Lt=[];return F&&Lt.length===0?si(pe,Ie>>>=0,Ge,gt):(pe={fc:Ge,Bb:pe,Jb:gt,Nb:Lt},F?(pe.Db="spawnThread",postMessage(pe,Lt),0):ht(pe))}var Ue=typeof TextDecoder<"u"?new TextDecoder:void 0,ni=(pe,Ie=0,Ge=NaN)=>{var gt=(Ie>>>=0)+Ge;for(Ge=Ie;pe[Ge]&&!(Ge>=gt);)++Ge;if(16<Ge-Ie&&pe.buffer&&Ue)return Ue.decode(pe.buffer instanceof ArrayBuffer?pe.subarray(Ie,Ge):pe.slice(Ie,Ge));for(gt="";Ie<Ge;){var Lt=pe[Ie++];if(128&Lt){var mr=63&pe[Ie++];if((224&Lt)==192)gt+=String.fromCharCode((31&Lt)<<6|mr);else{var ti=63&pe[Ie++];65536>(Lt=(240&Lt)==224?(15&Lt)<<12|mr<<6|ti:(7&Lt)<<18|mr<<12|ti<<6|63&pe[Ie++])?gt+=String.fromCharCode(Lt):(Lt-=65536,gt+=String.fromCharCode(55296|Lt>>10,56320|1023&Lt))}}else gt+=String.fromCharCode(Lt)}return gt},_r=(pe,Ie)=>(pe>>>=0)?ni(bt(),pe,Ie):"";function hr(pe,Ie,Ge){return F?yr(3,1,pe,Ie,Ge):0}function ei(pe,Ie){if(F)return yr(4,1,pe,Ie)}function ri(pe,Ie){if(F)return yr(5,1,pe,Ie)}function xi(pe,Ie,Ge){if(F)return yr(6,1,pe,Ie,Ge)}function gi(pe,Ie,Ge){return F?yr(7,1,pe,Ie,Ge):0}function wi(pe,Ie){if(F)return yr(8,1,pe,Ie)}function Ii(pe,Ie,Ge){if(F)return yr(9,1,pe,Ie,Ge)}function Ui(pe,Ie,Ge,gt){if(F)return yr(10,1,pe,Ie,Ge,gt)}function Ti(pe,Ie,Ge,gt){if(F)return yr(11,1,pe,Ie,Ge,gt)}function Mi(pe,Ie,Ge,gt){if(F)return yr(12,1,pe,Ie,Ge,gt)}function Di(pe){if(F)return yr(13,1,pe)}function Bi(pe,Ie){if(F)return yr(14,1,pe,Ie)}function Vi(pe,Ie,Ge){if(F)return yr(15,1,pe,Ie,Ge)}var Ki,Ni=()=>yt(""),Oi=pe=>{for(var Ie="";bt()[pe>>>0];)Ie+=Ki[bt()[pe++>>>0]];return Ie},qi={},zi={},Ri=w.BindingError=class extends Error{constructor(pe){super(pe),this.name="BindingError"}};function Pi(pe,Ie,Ge={}){return(function(gt,Lt,mr={}){var ti=Lt.name;if(!gt)throw new Ri(`type "${ti}" must have a positive integer typeid pointer`);if(zi.hasOwnProperty(gt)){if(mr.Tb)return;throw new Ri(`Cannot register type '${ti}' twice`)}zi[gt]=Lt,qi.hasOwnProperty(gt)&&(Lt=qi[gt],delete qi[gt],Lt.forEach(oi=>oi()))})(pe,Ie,Ge)}var yn=(pe,Ie,Ge)=>{switch(Ie){case 1:return Ge?gt=>Ye()[gt>>>0]:gt=>bt()[gt>>>0];case 2:return Ge?gt=>Qt()[gt>>>1>>>0]:gt=>Vt()[gt>>>1>>>0];case 4:return Ge?gt=>ut()[gt>>>2>>>0]:gt=>At()[gt>>>2>>>0];case 8:return Ge?gt=>fe[gt>>>3]:gt=>xe[gt>>>3];default:throw new TypeError(`invalid integer width (${Ie}): ${pe}`)}};function Cn(pe,Ie,Ge){Ge>>>=0,Pi(pe>>>=0,{name:Ie=Oi(Ie>>>0),fromWireType:gt=>gt,toWireType:function(gt,Lt){if(typeof Lt!="bigint"&&typeof Lt!="number")throw Lt=Lt===null?"null":(gt=typeof Lt)=="object"||gt==="array"||gt==="function"?Lt.toString():""+Lt,new TypeError(`Cannot convert "${Lt}" to ${this.name}`);return typeof Lt=="number"&&(Lt=BigInt(Lt)),Lt},Cb:Wi,readValueFromPointer:yn(Ie,Ge,Ie.indexOf("u")==-1),Eb:null})}var Wi=8;function Tn(pe,Ie,Ge,gt){Pi(pe>>>=0,{name:Ie=Oi(Ie>>>0),fromWireType:function(Lt){return!!Lt},toWireType:function(Lt,mr){return mr?Ge:gt},Cb:Wi,readValueFromPointer:function(Lt){return this.fromWireType(bt()[Lt>>>0])},Eb:null})}var Sn=[],Gi=[];function En(pe){9<(pe>>>=0)&&--Gi[pe+1]==0&&(Gi[pe]=void 0,Sn.push(pe))}var Fi=pe=>{if(!pe)throw new Ri(`Cannot use deleted val. handle = ${pe}`);return Gi[pe]},Hi=pe=>{switch(pe){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let Ie=Sn.pop()||Gi.length;return Gi[Ie]=pe,Gi[Ie+1]=1,Ie}};function Lo(pe){return this.fromWireType(At()[pe>>>2>>>0])}var np={name:"emscripten::val",fromWireType:pe=>{var Ie=Fi(pe);return En(pe),Ie},toWireType:(pe,Ie)=>Hi(Ie),Cb:Wi,readValueFromPointer:Lo,Eb:null};function ap(pe){return Pi(pe>>>0,np)}var sp=(pe,Ie)=>{switch(Ie){case 4:return function(Ge){return this.fromWireType(dr()[Ge>>>2>>>0])};case 8:return function(Ge){return this.fromWireType(fr()[Ge>>>3>>>0])};default:throw new TypeError(`invalid float width (${Ie}): ${pe}`)}};function op(pe,Ie,Ge){Ge>>>=0,Pi(pe>>>=0,{name:Ie=Oi(Ie>>>0),fromWireType:gt=>gt,toWireType:(gt,Lt)=>Lt,Cb:Wi,readValueFromPointer:sp(Ie,Ge),Eb:null})}function lp(pe,Ie,Ge,gt,Lt){if(pe>>>=0,Ge>>>=0,Ie=Oi(Ie>>>0),Lt===-1&&(Lt=4294967295),Lt=oi=>oi,gt===0){var mr=32-8*Ge;Lt=oi=>oi<<mr>>>mr}var ti=Ie.includes("unsigned")?function(oi,pi){return pi>>>0}:function(oi,pi){return pi};Pi(pe,{name:Ie,fromWireType:Lt,toWireType:ti,Cb:Wi,readValueFromPointer:yn(Ie,Ge,gt!==0),Eb:null})}function up(pe,Ie,Ge){function gt(mr){var ti=At()[mr>>>2>>>0];return mr=At()[mr+4>>>2>>>0],new Lt(Ye().buffer,mr,ti)}var Lt=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][Ie];Pi(pe>>>=0,{name:Ge=Oi(Ge>>>0),fromWireType:gt,Cb:Wi,readValueFromPointer:gt},{Tb:!0})}var vn=(pe,Ie,Ge)=>{var gt=bt();if(Ie>>>=0,0<Ge){var Lt=Ie;Ge=Ie+Ge-1;for(var mr=0;mr<pe.length;++mr){var ti=pe.charCodeAt(mr);if(55296<=ti&&57343>=ti&&(ti=65536+((1023&ti)<<10)|1023&pe.charCodeAt(++mr)),127>=ti){if(Ie>=Ge)break;gt[Ie++>>>0]=ti}else{if(2047>=ti){if(Ie+1>=Ge)break;gt[Ie++>>>0]=192|ti>>6}else{if(65535>=ti){if(Ie+2>=Ge)break;gt[Ie++>>>0]=224|ti>>12}else{if(Ie+3>=Ge)break;gt[Ie++>>>0]=240|ti>>18,gt[Ie++>>>0]=128|ti>>12&63}gt[Ie++>>>0]=128|ti>>6&63}gt[Ie++>>>0]=128|63&ti}}gt[Ie>>>0]=0,pe=Ie-Lt}else pe=0;return pe},Fo=pe=>{for(var Ie=0,Ge=0;Ge<pe.length;++Ge){var gt=pe.charCodeAt(Ge);127>=gt?Ie++:2047>=gt?Ie+=2:55296<=gt&&57343>=gt?(Ie+=4,++Ge):Ie+=3}return Ie};function cp(pe,Ie){Pi(pe>>>=0,{name:Ie=Oi(Ie>>>0),fromWireType:function(Ge){for(var gt,Lt=At()[Ge>>>2>>>0],mr=Ge+4,ti=mr,oi=0;oi<=Lt;++oi){var pi=mr+oi;oi!=Lt&&bt()[pi>>>0]!=0||(ti=_r(ti,pi-ti),gt===void 0?gt=ti:(gt+="\0",gt+=ti),ti=pi+1)}return bn(Ge),gt},toWireType:function(Ge,gt){gt instanceof ArrayBuffer&&(gt=new Uint8Array(gt));var Lt=typeof gt=="string";if(!(Lt||ArrayBuffer.isView(gt)&&gt.BYTES_PER_ELEMENT==1))throw new Ri("Cannot pass non-string to std::string");var mr=Lt?Fo(gt):gt.length,ti=Un(4+mr+1),oi=ti+4;return At()[ti>>>2>>>0]=mr,Lt?vn(gt,oi,mr+1):bt().set(gt,oi>>>0),Ge!==null&&Ge.push(bn,ti),ti},Cb:Wi,readValueFromPointer:Lo,Eb(Ge){bn(Ge)}})}var Sc=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,dp=(pe,Ie)=>{for(var Ge=pe>>1,gt=Ge+Ie/2;!(Ge>=gt)&&Vt()[Ge>>>0];)++Ge;if(32<(Ge<<=1)-pe&&Sc)return Sc.decode(bt().slice(pe,Ge));for(Ge="",gt=0;!(gt>=Ie/2);++gt){var Lt=Qt()[pe+2*gt>>>1>>>0];if(Lt==0)break;Ge+=String.fromCharCode(Lt)}return Ge},fp=(pe,Ie,Ge)=>{if(Ge??=2147483647,2>Ge)return 0;var gt=Ie;Ge=(Ge-=2)<2*pe.length?Ge/2:pe.length;for(var Lt=0;Lt<Ge;++Lt){var mr=pe.charCodeAt(Lt);Qt()[Ie>>>1>>>0]=mr,Ie+=2}return Qt()[Ie>>>1>>>0]=0,Ie-gt},hp=pe=>2*pe.length,pp=(pe,Ie)=>{for(var Ge=0,gt="";!(Ge>=Ie/4);){var Lt=ut()[pe+4*Ge>>>2>>>0];if(Lt==0)break;++Ge,65536<=Lt?(Lt-=65536,gt+=String.fromCharCode(55296|Lt>>10,56320|1023&Lt)):gt+=String.fromCharCode(Lt)}return gt},mp=(pe,Ie,Ge)=>{if(Ie>>>=0,Ge??=2147483647,4>Ge)return 0;var gt=Ie;Ge=gt+Ge-4;for(var Lt=0;Lt<pe.length;++Lt){var mr=pe.charCodeAt(Lt);if(55296<=mr&&57343>=mr&&(mr=65536+((1023&mr)<<10)|1023&pe.charCodeAt(++Lt)),ut()[Ie>>>2>>>0]=mr,(Ie+=4)+4>Ge)break}return ut()[Ie>>>2>>>0]=0,Ie-gt},gp=pe=>{for(var Ie=0,Ge=0;Ge<pe.length;++Ge){var gt=pe.charCodeAt(Ge);55296<=gt&&57343>=gt&&++Ge,Ie+=4}return Ie};function yp(pe,Ie,Ge){if(pe>>>=0,Ie>>>=0,Ge=Oi(Ge>>>=0),Ie===2)var gt=dp,Lt=fp,mr=hp,ti=oi=>Vt()[oi>>>1>>>0];else Ie===4&&(gt=pp,Lt=mp,mr=gp,ti=oi=>At()[oi>>>2>>>0]);Pi(pe,{name:Ge,fromWireType:oi=>{for(var pi,mi=At()[oi>>>2>>>0],Si=oi+4,$i=0;$i<=mi;++$i){var Ai=oi+4+$i*Ie;$i!=mi&&ti(Ai)!=0||(Si=gt(Si,Ai-Si),pi===void 0?pi=Si:(pi+="\0",pi+=Si),Si=Ai+Ie)}return bn(oi),pi},toWireType:(oi,pi)=>{if(typeof pi!="string")throw new Ri(`Cannot pass non-string to C++ string type ${Ge}`);var mi=mr(pi),Si=Un(4+mi+Ie);return At()[Si>>>2>>>0]=mi/Ie,Lt(pi,Si+4,mi+Ie),oi!==null&&oi.push(bn,Si),Si},Cb:Wi,readValueFromPointer:Lo,Eb(oi){bn(oi)}})}function bp(pe,Ie){Pi(pe>>>=0,{Ub:!0,name:Ie=Oi(Ie>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function _p(pe){Yo(pe>>>0,!D,1,!I,131072,!1),ki()}var qo=pe=>{if(!dt)try{if(pe(),!(0<gr))try{F?Jo(se):ai(se)}catch(Ie){Ie instanceof $e||Ie=="unwind"||V(0,Ie)}}catch(Ie){Ie instanceof $e||Ie=="unwind"||V(0,Ie)}};function jo(pe){pe>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(ut(),pe>>>2,pe).value.then(Pn),pe+=128,Atomics.store(ut(),pe>>>2,1))}var Pn=()=>{var pe=Qo();pe&&(jo(pe),qo(Jc))};function wp(pe,Ie){(pe>>>=0)==Ie>>>0?setTimeout(Pn):F?postMessage({Hb:pe,Db:"checkMailbox"}):(pe=bi[pe])&&pe.postMessage({Db:"checkMailbox"})}var Go=[];function vp(pe,Ie,Ge,gt,Lt){for(Ie>>>=0,gt/=2,Go.length=gt,Ge=Lt>>>0>>>3,Lt=0;Lt<gt;Lt++)Go[Lt]=fe[Ge+2*Lt]?fe[Ge+2*Lt+1]:fr()[Ge+2*Lt+1>>>0];return(Ie?Zo[Ie]:E0[pe])(...Go)}var xp=()=>{gr=0};function Sp(pe){pe>>>=0,F?postMessage({Db:"cleanupThread",ic:pe}):_i(bi[pe])}function Ep(pe){}var Mn=(pe,Ie)=>{var Ge=zi[pe];if(Ge===void 0)throw pe=Wc(pe),Ge=Oi(pe),bn(pe),new Ri(`${Ie} has unknown type ${Ge}`);return Ge},Ec=(pe,Ie,Ge)=>{var gt=[];return pe=pe.toWireType(gt,Ge),gt.length&&(At()[Ie>>>2>>>0]=Hi(gt)),pe};function kp(pe,Ie,Ge){return Ie>>>=0,Ge>>>=0,pe=Fi(pe>>>0),Ie=Mn(Ie,"emval::as"),Ec(Ie,Ge,pe)}function $p(pe,Ie){return Ie>>>=0,pe=Fi(pe>>>0),(Ie=Mn(Ie,"emval::as")).toWireType(null,pe)}var On=pe=>{try{pe()}catch(Ie){yt(Ie)}},wn=0,Zi=null,kc=0,Rn=[],$c={},Ic={},Ip=0,Ho=null,Ap=[];function Ac(pe){return(function(Ie){if(!dt){if(wn===0){var Ge=!1,gt=!1;Ie((Lt=0)=>{if(!dt&&(kc=Lt,Ge=!0,gt)){wn=2,On(()=>Dh(Zi)),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.resume(),Lt=!1;try{var mr=(function(){var pi=ut()[Zi+8>>>2>>>0];return pi=ci[Ic[pi]],--gr,pi()})()}catch(pi){mr=pi,Lt=!0}var ti=!1;if(!Zi){var oi=Ho;oi&&(Ho=null,(Lt?oi.reject:oi.resolve)(mr),ti=!0)}if(Lt&&!ti)throw mr}}),gt=!0,Ge||(wn=1,Zi=(function(){var Lt=Un(65548),mr=Lt+12;At()[Lt>>>2>>>0]=mr,At()[Lt+4>>>2>>>0]=mr+65536,mr=Rn[0];var ti=$c[mr];return ti===void 0&&(ti=Ip++,$c[mr]=ti,Ic[ti]=mr),mr=ti,ut()[Lt+8>>>2>>>0]=mr,Lt})(),typeof MainLoop<"u"&&MainLoop.Qb&&MainLoop.pause(),On(()=>ih(Zi)))}else wn===2?(wn=0,On(ep),bn(Zi),Zi=null,Ap.forEach(qo)):yt(`invalid state: ${wn}`);return kc}})(Ie=>{pe().then(Ie)})}function Cp(pe){return pe>>>=0,Ac(async()=>{var Ie=await Fi(pe);return Hi(Ie)})}var Nn=[];function Tp(pe,Ie,Ge,gt){return Ge>>>=0,gt>>>=0,(pe=Nn[pe>>>0])(null,Ie=Fi(Ie>>>0),Ge,gt)}var Pp={},Dn=pe=>{var Ie=Pp[pe];return Ie===void 0?Oi(pe):Ie};function Mp(pe,Ie,Ge,gt,Lt){return Ge>>>=0,gt>>>=0,Lt>>>=0,(pe=Nn[pe>>>0])(Ie=Fi(Ie>>>0),Ie[Ge=Dn(Ge)],gt,Lt)}function Op(pe,Ie){return Ie>>>=0,(pe=Fi(pe>>>0))==Fi(Ie)}var Cc=()=>typeof globalThis=="object"?globalThis:Function("return this")();function Rp(pe){return(pe>>>=0)==0?Hi(Cc()):(pe=Dn(pe),Hi(Cc()[pe]))}var Np=pe=>{var Ie=Nn.length;return Nn.push(pe),Ie},Dp=(pe,Ie)=>{for(var Ge=Array(pe),gt=0;gt<pe;++gt)Ge[gt]=Mn(At()[Ie+4*gt>>>2>>>0],`parameter ${gt}`);return Ge};function Bp(pe,Ie,Ge){var gt=(Ie=Dp(pe,Ie>>>0)).shift();pe--;var Lt=`return function (obj, func, destructorsRef, args) {
`,mr=0,ti=[];Ge===0&&ti.push("obj");for(var oi=["retType"],pi=[gt],mi=0;mi<pe;++mi)ti.push(`arg${mi}`),oi.push(`argType${mi}`),pi.push(Ie[mi]),Lt+=`  var arg${mi} = argType${mi}.readValueFromPointer(args${mr?"+"+mr:""});
`,mr+=Ie[mi].Cb;return Lt+=`  var rv = ${Ge===1?"new func":"func.call"}(${ti.join(", ")});
`,gt.Ub||(oi.push("emval_returnValue"),pi.push(Ec),Lt+=`  return emval_returnValue(retType, destructorsRef, rv);
`),pe=new Function(...oi,Lt+`};
`)(...pi),Ge=`methodCaller<(${Ie.map(Si=>Si.name).join(", ")}) => ${gt.name}>`,Np(Object.defineProperty(pe,"name",{value:Ge}))}function Lp(pe){return pe=Dn(pe>>>0),Hi(w[pe])}function zp(pe,Ie){return Ie>>>=0,pe=Fi(pe>>>0),Ie=Fi(Ie),Hi(pe[Ie])}function Up(pe){9<(pe>>>=0)&&(Gi[pe+1]+=1)}function Wp(){return Hi([])}function Vp(pe){pe=Fi(pe>>>0);for(var Ie=Array(pe.length),Ge=0;Ge<pe.length;Ge++)Ie[Ge]=pe[Ge];return Hi(Ie)}function e0(pe){return Hi(Dn(pe>>>0))}function t0(){return Hi({})}function r0(pe){for(var Ie=Fi(pe>>>=0);Ie.length;){var Ge=Ie.pop();Ie.pop()(Ge)}En(pe)}function i0(pe,Ie,Ge){Ie>>>=0,Ge>>>=0,pe=Fi(pe>>>0),Ie=Fi(Ie),Ge=Fi(Ge),pe[Ie]=Ge}function n0(pe,Ie){return Ie>>>=0,pe=(pe=Mn(pe>>>0,"_emval_take_value")).readValueFromPointer(Ie),Hi(pe)}function a0(pe,Ie){pe=-9007199254740992>pe||9007199254740992<pe?NaN:Number(pe),Ie>>>=0,pe=new Date(1e3*pe),ut()[Ie>>>2>>>0]=pe.getUTCSeconds(),ut()[Ie+4>>>2>>>0]=pe.getUTCMinutes(),ut()[Ie+8>>>2>>>0]=pe.getUTCHours(),ut()[Ie+12>>>2>>>0]=pe.getUTCDate(),ut()[Ie+16>>>2>>>0]=pe.getUTCMonth(),ut()[Ie+20>>>2>>>0]=pe.getUTCFullYear()-1900,ut()[Ie+24>>>2>>>0]=pe.getUTCDay(),pe=(pe.getTime()-Date.UTC(pe.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,ut()[Ie+28>>>2>>>0]=pe}var Tc=pe=>pe%4==0&&(pe%100!=0||pe%400==0),Pc=[0,31,60,91,121,152,182,213,244,274,305,335],Mc=[0,31,59,90,120,151,181,212,243,273,304,334];function s0(pe,Ie){pe=-9007199254740992>pe||9007199254740992<pe?NaN:Number(pe),Ie>>>=0,pe=new Date(1e3*pe),ut()[Ie>>>2>>>0]=pe.getSeconds(),ut()[Ie+4>>>2>>>0]=pe.getMinutes(),ut()[Ie+8>>>2>>>0]=pe.getHours(),ut()[Ie+12>>>2>>>0]=pe.getDate(),ut()[Ie+16>>>2>>>0]=pe.getMonth(),ut()[Ie+20>>>2>>>0]=pe.getFullYear()-1900,ut()[Ie+24>>>2>>>0]=pe.getDay();var Ge=(Tc(pe.getFullYear())?Pc:Mc)[pe.getMonth()]+pe.getDate()-1|0;ut()[Ie+28>>>2>>>0]=Ge,ut()[Ie+36>>>2>>>0]=-60*pe.getTimezoneOffset(),Ge=new Date(pe.getFullYear(),6,1).getTimezoneOffset();var gt=new Date(pe.getFullYear(),0,1).getTimezoneOffset();pe=0|(Ge!=gt&&pe.getTimezoneOffset()==Math.min(gt,Ge)),ut()[Ie+32>>>2>>>0]=pe}function o0(pe){pe>>>=0;var Ie=new Date(ut()[pe+20>>>2>>>0]+1900,ut()[pe+16>>>2>>>0],ut()[pe+12>>>2>>>0],ut()[pe+8>>>2>>>0],ut()[pe+4>>>2>>>0],ut()[pe>>>2>>>0],0),Ge=ut()[pe+32>>>2>>>0],gt=Ie.getTimezoneOffset(),Lt=new Date(Ie.getFullYear(),6,1).getTimezoneOffset(),mr=new Date(Ie.getFullYear(),0,1).getTimezoneOffset(),ti=Math.min(mr,Lt);return 0>Ge?ut()[pe+32>>>2>>>0]=+(Lt!=mr&&ti==gt):0<Ge!=(ti==gt)&&(Lt=Math.max(mr,Lt),Ie.setTime(Ie.getTime()+6e4*((0<Ge?ti:Lt)-gt))),ut()[pe+24>>>2>>>0]=Ie.getDay(),Ge=(Tc(Ie.getFullYear())?Pc:Mc)[Ie.getMonth()]+Ie.getDate()-1|0,ut()[pe+28>>>2>>>0]=Ge,ut()[pe>>>2>>>0]=Ie.getSeconds(),ut()[pe+4>>>2>>>0]=Ie.getMinutes(),ut()[pe+8>>>2>>>0]=Ie.getHours(),ut()[pe+12>>>2>>>0]=Ie.getDate(),ut()[pe+16>>>2>>>0]=Ie.getMonth(),ut()[pe+20>>>2>>>0]=Ie.getYear(),pe=Ie.getTime(),BigInt(isNaN(pe)?-1:pe/1e3)}function Oc(pe,Ie,Ge,gt,Lt,mr,ti){return F?yr(16,1,pe,Ie,Ge,gt,Lt,mr,ti):-52}function Rc(pe,Ie,Ge,gt,Lt,mr){if(F)return yr(17,1,pe,Ie,Ge,gt,Lt,mr)}var kn={},l0=()=>performance.timeOrigin+performance.now();function Nc(pe,Ie){if(F)return yr(18,1,pe,Ie);if(kn[pe]&&(clearTimeout(kn[pe].id),delete kn[pe]),!Ie)return 0;var Ge=setTimeout(()=>{delete kn[pe],qo(()=>Yc(pe,performance.timeOrigin+performance.now()))},Ie);return kn[pe]={id:Ge,rc:Ie},0}function u0(pe,Ie,Ge,gt){pe>>>=0,Ie>>>=0,Ge>>>=0,gt>>>=0;var Lt=new Date().getFullYear(),mr=new Date(Lt,0,1).getTimezoneOffset();Lt=new Date(Lt,6,1).getTimezoneOffset();var ti=Math.max(mr,Lt);At()[pe>>>2>>>0]=60*ti,ut()[Ie>>>2>>>0]=+(mr!=Lt),pe=(Ie=oi=>{var pi=Math.abs(oi);return`UTC${0<=oi?"-":"+"}${String(Math.floor(pi/60)).padStart(2,"0")}${String(pi%60).padStart(2,"0")}`})(mr),Ie=Ie(Lt),Lt<mr?(vn(pe,Ge,17),vn(Ie,gt,17)):(vn(pe,gt,17),vn(Ie,Ge,17))}var c0=()=>Date.now();function d0(pe,Ie,Ge){return 0<=pe&&3>=pe?(pe===0?pe=Date.now():pe=performance.timeOrigin+performance.now(),fe[Ge>>>0>>>3]=BigInt(Math.round(1e6*pe)),0):28}var Wo=[],Dc=(pe,Ie)=>{Wo.length=0;for(var Ge;Ge=bt()[pe++>>>0];){var gt=Ge!=105;Ie+=(gt&=Ge!=112)&&Ie%8?4:0,Wo.push(Ge==112?At()[Ie>>>2>>>0]:Ge==106?fe[Ie>>>3]:Ge==105?ut()[Ie>>>2>>>0]:fr()[Ie>>>3>>>0]),Ie+=gt?8:4}return Wo};function f0(pe,Ie,Ge){return pe>>>=0,Ie=Dc(Ie>>>0,Ge>>>0),Zo[pe](...Ie)}function h0(pe,Ie,Ge){return pe>>>=0,Ie=Dc(Ie>>>0,Ge>>>0),Zo[pe](...Ie)}var p0=()=>{};function m0(pe,Ie){return Et(_r(pe>>>0,Ie>>>0))}var g0=()=>{throw gr+=1,"unwind"};function y0(){return 4294901760}var b0=()=>navigator.hardwareConcurrency;function _0(){return yt("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function w0(pe){pe>>>=0;var Ie=bt().length;if(pe<=Ie||4294901760<pe)return!1;for(var Ge=1;4>=Ge;Ge*=2){var gt=Ie*(1+.2/Ge);gt=Math.min(gt,pe+100663296);e:{gt=(Math.min(4294901760,65536*Math.ceil(Math.max(pe,gt)/65536))-ie.buffer.byteLength+65535)/65536|0;try{ie.grow(gt),zt();var Lt=1;break e}catch{}Lt=void 0}if(Lt)return!0}return!1}var Bn=()=>(yt("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),$n={},Bc=pe=>{pe.forEach(Ie=>{Bn()})};function v0(){var pe=Error().stack.toString().split(`
`);return pe[0]=="Error"&&pe.shift(),Bc(pe),$n.Mb=Bn(),$n.dc=pe,$n.Mb}function x0(pe,Ie,Ge){if(pe>>>=0,Ie>>>=0,$n.Mb==pe)var gt=$n.dc;else(gt=Error().stack.toString().split(`
`))[0]=="Error"&&gt.shift(),Bc(gt);for(var Lt=3;gt[Lt]&&Bn()!=pe;)++Lt;for(pe=0;pe<Ge&&gt[pe+Lt];++pe)ut()[Ie+4*pe>>>2>>>0]=Bn();return pe}var Vo,Ko={},Lc=()=>{if(!Vo){var pe,Ie={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(pe in Ko)Ko[pe]===void 0?delete Ie[pe]:Ie[pe]=Ko[pe];var Ge=[];for(pe in Ie)Ge.push(`${pe}=${Ie[pe]}`);Vo=Ge}return Vo};function zc(pe,Ie){if(F)return yr(19,1,pe,Ie);pe>>>=0,Ie>>>=0;var Ge,gt=0,Lt=0;for(Ge of Lc()){var mr=Ie+gt;At()[pe+Lt>>>2>>>0]=mr,gt+=vn(Ge,mr,1/0)+1,Lt+=4}return 0}function Fc(pe,Ie){if(F)return yr(20,1,pe,Ie);pe>>>=0,Ie>>>=0;var Ge=Lc();for(var gt of(At()[pe>>>2>>>0]=Ge.length,pe=0,Ge))pe+=Fo(gt)+1;return At()[Ie>>>2>>>0]=pe,0}function Uc(pe){return F?yr(21,1,pe):52}function qc(pe,Ie,Ge,gt){return F?yr(22,1,pe,Ie,Ge,gt):52}function jc(pe,Ie,Ge,gt){return F?yr(23,1,pe,Ie,Ge,gt):70}var S0=[null,[],[]];function Gc(pe,Ie,Ge,gt){if(F)return yr(24,1,pe,Ie,Ge,gt);Ie>>>=0,Ge>>>=0,gt>>>=0;for(var Lt=0,mr=0;mr<Ge;mr++){var ti=At()[Ie>>>2>>>0],oi=At()[Ie+4>>>2>>>0];Ie+=8;for(var pi=0;pi<oi;pi++){var mi=pe,Si=bt()[ti+pi>>>0],$i=S0[mi];Si===0||Si===10?((mi===1?_t:Et)(ni($i)),$i.length=0):$i.push(Si)}Lt+=oi}return At()[gt>>>2>>>0]=Lt,0}F||(function(){for(var pe=w.numThreads-1;pe--;)cr();ft.push(()=>{Xe++,(function(Ie){F?Ie():Promise.all(hi.map(yi)).then(Ie)})(()=>st())})})();for(var Hc=Array(256),zn=0;256>zn;++zn)Hc[zn]=String.fromCharCode(zn);Ki=Hc,Gi.push(0,1,void 0,1,null,1,!0,1,!1,1),w.count_emval_handles=()=>Gi.length/2-5-Sn.length,F||(ie=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),zt()),w.wasmBinary&&(J=w.wasmBinary),w.stackSave=()=>xu(),w.stackRestore=pe=>Vn(pe),w.stackAlloc=pe=>Xo(pe),w.setValue=function(pe,Ie,Ge="i8"){switch(Ge.endsWith("*")&&(Ge="*"),Ge){case"i1":case"i8":Ye()[pe>>>0]=Ie;break;case"i16":Qt()[pe>>>1>>>0]=Ie;break;case"i32":ut()[pe>>>2>>>0]=Ie;break;case"i64":fe[pe>>>3]=BigInt(Ie);break;case"float":dr()[pe>>>2>>>0]=Ie;break;case"double":fr()[pe>>>3>>>0]=Ie;break;case"*":At()[pe>>>2>>>0]=Ie;break;default:yt(`invalid type for setValue: ${Ge}`)}},w.getValue=function(pe,Ie="i8"){switch(Ie.endsWith("*")&&(Ie="*"),Ie){case"i1":case"i8":return Ye()[pe>>>0];case"i16":return Qt()[pe>>>1>>>0];case"i32":return ut()[pe>>>2>>>0];case"i64":return fe[pe>>>3];case"float":return dr()[pe>>>2>>>0];case"double":return fr()[pe>>>3>>>0];case"*":return At()[pe>>>2>>>0];default:yt(`invalid type for getValue: ${Ie}`)}},w.UTF8ToString=_r,w.stringToUTF8=vn,w.lengthBytesUTF8=Fo;var E0=[li,fi,si,hr,ei,ri,xi,gi,wi,Ii,Ui,Ti,Mi,Di,Bi,Vi,Oc,Rc,Nc,zc,Fc,Uc,qc,jc,Gc],Zo={892060:(pe,Ie,Ge,gt,Lt)=>{if(w===void 0||!w.Fb)return 1;if((pe=_r(Number(pe>>>0))).startsWith("./")&&(pe=pe.substring(2)),!(pe=w.Fb.get(pe)))return 2;if(Ie=Number(Ie>>>0),Ge=Number(Ge>>>0),gt=Number(gt>>>0),Ie+Ge>pe.byteLength)return 3;try{let mr=pe.subarray(Ie,Ie+Ge);switch(Lt){case 0:bt().set(mr,gt>>>0);break;case 1:w.mc?w.mc(gt,mr):w.cc(gt,mr);break;default:return 4}return 0}catch{return 4}},892884:(pe,Ie,Ge)=>{w.Pb(pe,bt().subarray(Ie>>>0,Ie+Ge>>>0))},892948:()=>w.oc(),892990:pe=>{w.Ob(pe)},893027:()=>{w.Wb()},893058:()=>{w.Xb()},893087:()=>{w.ac()},893112:pe=>w.Vb(pe),893145:pe=>w.Zb(pe),893177:(pe,Ie,Ge)=>{w.Lb(Number(pe),Number(Ie),Number(Ge),!0)},893240:(pe,Ie,Ge)=>{w.Lb(Number(pe),Number(Ie),Number(Ge))},893297:()=>typeof wasmOffsetConverter<"u",893354:pe=>{w.Ab("Abs",pe,void 0)},893405:pe=>{w.Ab("Neg",pe,void 0)},893456:pe=>{w.Ab("Floor",pe,void 0)},893509:pe=>{w.Ab("Ceil",pe,void 0)},893561:pe=>{w.Ab("Reciprocal",pe,void 0)},893619:pe=>{w.Ab("Sqrt",pe,void 0)},893671:pe=>{w.Ab("Exp",pe,void 0)},893722:pe=>{w.Ab("Erf",pe,void 0)},893773:pe=>{w.Ab("Sigmoid",pe,void 0)},893828:(pe,Ie,Ge)=>{w.Ab("HardSigmoid",pe,{alpha:Ie,beta:Ge})},893907:pe=>{w.Ab("Log",pe,void 0)},893958:pe=>{w.Ab("Sin",pe,void 0)},894009:pe=>{w.Ab("Cos",pe,void 0)},894060:pe=>{w.Ab("Tan",pe,void 0)},894111:pe=>{w.Ab("Asin",pe,void 0)},894163:pe=>{w.Ab("Acos",pe,void 0)},894215:pe=>{w.Ab("Atan",pe,void 0)},894267:pe=>{w.Ab("Sinh",pe,void 0)},894319:pe=>{w.Ab("Cosh",pe,void 0)},894371:pe=>{w.Ab("Asinh",pe,void 0)},894424:pe=>{w.Ab("Acosh",pe,void 0)},894477:pe=>{w.Ab("Atanh",pe,void 0)},894530:pe=>{w.Ab("Tanh",pe,void 0)},894582:pe=>{w.Ab("Not",pe,void 0)},894633:(pe,Ie,Ge)=>{w.Ab("Clip",pe,{min:Ie,max:Ge})},894702:pe=>{w.Ab("Clip",pe,void 0)},894754:(pe,Ie)=>{w.Ab("Elu",pe,{alpha:Ie})},894812:pe=>{w.Ab("Gelu",pe,void 0)},894864:pe=>{w.Ab("Relu",pe,void 0)},894916:(pe,Ie)=>{w.Ab("LeakyRelu",pe,{alpha:Ie})},894980:(pe,Ie)=>{w.Ab("ThresholdedRelu",pe,{alpha:Ie})},895050:(pe,Ie)=>{w.Ab("Cast",pe,{to:Ie})},895108:pe=>{w.Ab("Add",pe,void 0)},895159:pe=>{w.Ab("Sub",pe,void 0)},895210:pe=>{w.Ab("Mul",pe,void 0)},895261:pe=>{w.Ab("Div",pe,void 0)},895312:pe=>{w.Ab("Pow",pe,void 0)},895363:pe=>{w.Ab("Equal",pe,void 0)},895416:pe=>{w.Ab("Greater",pe,void 0)},895471:pe=>{w.Ab("GreaterOrEqual",pe,void 0)},895533:pe=>{w.Ab("Less",pe,void 0)},895585:pe=>{w.Ab("LessOrEqual",pe,void 0)},895644:(pe,Ie,Ge,gt,Lt)=>{w.Ab("ReduceMean",pe,{keepDims:!!Ie,noopWithEmptyAxes:!!Ge,axes:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},895819:(pe,Ie,Ge,gt,Lt)=>{w.Ab("ReduceMax",pe,{keepDims:!!Ie,noopWithEmptyAxes:!!Ge,axes:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},895993:(pe,Ie,Ge,gt,Lt)=>{w.Ab("ReduceMin",pe,{keepDims:!!Ie,noopWithEmptyAxes:!!Ge,axes:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},896167:(pe,Ie,Ge,gt,Lt)=>{w.Ab("ReduceProd",pe,{keepDims:!!Ie,noopWithEmptyAxes:!!Ge,axes:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},896342:(pe,Ie,Ge,gt,Lt)=>{w.Ab("ReduceSum",pe,{keepDims:!!Ie,noopWithEmptyAxes:!!Ge,axes:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},896516:(pe,Ie,Ge,gt,Lt)=>{w.Ab("ReduceL1",pe,{keepDims:!!Ie,noopWithEmptyAxes:!!Ge,axes:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},896689:(pe,Ie,Ge,gt,Lt)=>{w.Ab("ReduceL2",pe,{keepDims:!!Ie,noopWithEmptyAxes:!!Ge,axes:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},896862:(pe,Ie,Ge,gt,Lt)=>{w.Ab("ReduceLogSum",pe,{keepDims:!!Ie,noopWithEmptyAxes:!!Ge,axes:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},897039:(pe,Ie,Ge,gt,Lt)=>{w.Ab("ReduceSumSquare",pe,{keepDims:!!Ie,noopWithEmptyAxes:!!Ge,axes:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},897219:(pe,Ie,Ge,gt,Lt)=>{w.Ab("ReduceLogSumExp",pe,{keepDims:!!Ie,noopWithEmptyAxes:!!Ge,axes:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},897399:pe=>{w.Ab("Where",pe,void 0)},897452:(pe,Ie,Ge)=>{w.Ab("Transpose",pe,{perm:Ie?Array.from(ut().subarray(Number(Ie)>>>0,Number(Ge)>>>0)):[]})},897576:(pe,Ie,Ge,gt)=>{w.Ab("DepthToSpace",pe,{blocksize:Ie,mode:_r(Ge),format:gt?"NHWC":"NCHW"})},897709:(pe,Ie,Ge,gt)=>{w.Ab("DepthToSpace",pe,{blocksize:Ie,mode:_r(Ge),format:gt?"NHWC":"NCHW"})},897842:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li)=>{w.Ab("ConvTranspose",pe,{format:pi?"NHWC":"NCHW",autoPad:Ie,dilations:[Ge],group:gt,kernelShape:[Lt],pads:[mr,ti],strides:[oi],wIsConst:()=>!!Ye()[mi>>>0],outputPadding:Si?Array.from(ut().subarray(Number(Si)>>>0,Number($i)>>>0)):[],outputShape:Ai?Array.from(ut().subarray(Number(Ai)>>>0,Number(Ci)>>>0)):[],activation:_r(Li)})},898275:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci)=>{w.Ab("ConvTranspose",pe,{format:oi?"NHWC":"NCHW",autoPad:Ie,dilations:Array.from(ut().subarray(Number(Ge)>>>0,2+(Number(Ge)>>>0)>>>0)),group:gt,kernelShape:Array.from(ut().subarray(Number(Lt)>>>0,2+(Number(Lt)>>>0)>>>0)),pads:Array.from(ut().subarray(Number(mr)>>>0,4+(Number(mr)>>>0)>>>0)),strides:Array.from(ut().subarray(Number(ti)>>>0,2+(Number(ti)>>>0)>>>0)),wIsConst:()=>!!Ye()[pi>>>0],outputPadding:mi?Array.from(ut().subarray(Number(mi)>>>0,Number(Si)>>>0)):[],outputShape:$i?Array.from(ut().subarray(Number($i)>>>0,Number(Ai)>>>0)):[],activation:_r(Ci)})},898936:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li)=>{w.Ab("ConvTranspose",pe,{format:pi?"NHWC":"NCHW",autoPad:Ie,dilations:[Ge],group:gt,kernelShape:[Lt],pads:[mr,ti],strides:[oi],wIsConst:()=>!!Ye()[mi>>>0],outputPadding:Si?Array.from(ut().subarray(Number(Si)>>>0,Number($i)>>>0)):[],outputShape:Ai?Array.from(ut().subarray(Number(Ai)>>>0,Number(Ci)>>>0)):[],activation:_r(Li)})},899369:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci)=>{w.Ab("ConvTranspose",pe,{format:oi?"NHWC":"NCHW",autoPad:Ie,dilations:Array.from(ut().subarray(Number(Ge)>>>0,2+(Number(Ge)>>>0)>>>0)),group:gt,kernelShape:Array.from(ut().subarray(Number(Lt)>>>0,2+(Number(Lt)>>>0)>>>0)),pads:Array.from(ut().subarray(Number(mr)>>>0,4+(Number(mr)>>>0)>>>0)),strides:Array.from(ut().subarray(Number(ti)>>>0,2+(Number(ti)>>>0)>>>0)),wIsConst:()=>!!Ye()[pi>>>0],outputPadding:mi?Array.from(ut().subarray(Number(mi)>>>0,Number(Si)>>>0)):[],outputShape:$i?Array.from(ut().subarray(Number($i)>>>0,Number(Ai)>>>0)):[],activation:_r(Ci)})},900030:(pe,Ie)=>{w.Ab("GlobalAveragePool",pe,{format:Ie?"NHWC":"NCHW"})},900121:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci)=>{w.Ab("AveragePool",pe,{format:Ci?"NHWC":"NCHW",auto_pad:Ie,ceil_mode:Ge,count_include_pad:gt,storage_order:Lt,dilations:mr?Array.from(ut().subarray(Number(mr)>>>0,Number(ti)>>>0)):[],kernel_shape:oi?Array.from(ut().subarray(Number(oi)>>>0,Number(pi)>>>0)):[],pads:mi?Array.from(ut().subarray(Number(mi)>>>0,Number(Si)>>>0)):[],strides:$i?Array.from(ut().subarray(Number($i)>>>0,Number(Ai)>>>0)):[]})},900600:(pe,Ie)=>{w.Ab("GlobalAveragePool",pe,{format:Ie?"NHWC":"NCHW"})},900691:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci)=>{w.Ab("AveragePool",pe,{format:Ci?"NHWC":"NCHW",auto_pad:Ie,ceil_mode:Ge,count_include_pad:gt,storage_order:Lt,dilations:mr?Array.from(ut().subarray(Number(mr)>>>0,Number(ti)>>>0)):[],kernel_shape:oi?Array.from(ut().subarray(Number(oi)>>>0,Number(pi)>>>0)):[],pads:mi?Array.from(ut().subarray(Number(mi)>>>0,Number(Si)>>>0)):[],strides:$i?Array.from(ut().subarray(Number($i)>>>0,Number(Ai)>>>0)):[]})},901170:(pe,Ie)=>{w.Ab("GlobalMaxPool",pe,{format:Ie?"NHWC":"NCHW"})},901257:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci)=>{w.Ab("MaxPool",pe,{format:Ci?"NHWC":"NCHW",auto_pad:Ie,ceil_mode:Ge,count_include_pad:gt,storage_order:Lt,dilations:mr?Array.from(ut().subarray(Number(mr)>>>0,Number(ti)>>>0)):[],kernel_shape:oi?Array.from(ut().subarray(Number(oi)>>>0,Number(pi)>>>0)):[],pads:mi?Array.from(ut().subarray(Number(mi)>>>0,Number(Si)>>>0)):[],strides:$i?Array.from(ut().subarray(Number($i)>>>0,Number(Ai)>>>0)):[]})},901732:(pe,Ie)=>{w.Ab("GlobalMaxPool",pe,{format:Ie?"NHWC":"NCHW"})},901819:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci)=>{w.Ab("MaxPool",pe,{format:Ci?"NHWC":"NCHW",auto_pad:Ie,ceil_mode:Ge,count_include_pad:gt,storage_order:Lt,dilations:mr?Array.from(ut().subarray(Number(mr)>>>0,Number(ti)>>>0)):[],kernel_shape:oi?Array.from(ut().subarray(Number(oi)>>>0,Number(pi)>>>0)):[],pads:mi?Array.from(ut().subarray(Number(mi)>>>0,Number(Si)>>>0)):[],strides:$i?Array.from(ut().subarray(Number($i)>>>0,Number(Ai)>>>0)):[]})},902294:(pe,Ie,Ge,gt,Lt)=>{w.Ab("Gemm",pe,{alpha:Ie,beta:Ge,transA:gt,transB:Lt})},902398:pe=>{w.Ab("MatMul",pe,void 0)},902452:(pe,Ie,Ge,gt)=>{w.Ab("ArgMax",pe,{keepDims:!!Ie,selectLastIndex:!!Ge,axis:gt})},902560:(pe,Ie,Ge,gt)=>{w.Ab("ArgMin",pe,{keepDims:!!Ie,selectLastIndex:!!Ge,axis:gt})},902668:(pe,Ie)=>{w.Ab("Softmax",pe,{axis:Ie})},902731:(pe,Ie)=>{w.Ab("Concat",pe,{axis:Ie})},902791:(pe,Ie,Ge,gt,Lt)=>{w.Ab("Split",pe,{axis:Ie,numOutputs:Ge,splitSizes:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},902947:pe=>{w.Ab("Expand",pe,void 0)},903001:(pe,Ie)=>{w.Ab("Gather",pe,{axis:Number(Ie)})},903072:(pe,Ie)=>{w.Ab("GatherElements",pe,{axis:Number(Ie)})},903151:(pe,Ie)=>{w.Ab("GatherND",pe,{batch_dims:Number(Ie)})},903230:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si)=>{w.Ab("Resize",pe,{antialias:Ie,axes:Ge?Array.from(ut().subarray(Number(Ge)>>>0,Number(gt)>>>0)):[],coordinateTransformMode:_r(Lt),cubicCoeffA:mr,excludeOutside:ti,extrapolationValue:oi,keepAspectRatioPolicy:_r(pi),mode:_r(mi),nearestMode:_r(Si)})},903592:(pe,Ie,Ge,gt,Lt,mr,ti)=>{w.Ab("Slice",pe,{starts:Ie?Array.from(ut().subarray(Number(Ie)>>>0,Number(Ge)>>>0)):[],ends:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[],axes:mr?Array.from(ut().subarray(Number(mr)>>>0,Number(ti)>>>0)):[]})},903856:pe=>{w.Ab("Tile",pe,void 0)},903908:(pe,Ie,Ge)=>{w.Ab("InstanceNormalization",pe,{epsilon:Ie,format:Ge?"NHWC":"NCHW"})},904022:(pe,Ie,Ge)=>{w.Ab("InstanceNormalization",pe,{epsilon:Ie,format:Ge?"NHWC":"NCHW"})},904136:pe=>{w.Ab("Range",pe,void 0)},904189:(pe,Ie)=>{w.Ab("Einsum",pe,{equation:_r(Ie)})},904270:(pe,Ie,Ge,gt,Lt)=>{w.Ab("Pad",pe,{mode:Ie,value:Ge,pads:gt?Array.from(ut().subarray(Number(gt)>>>0,Number(Lt)>>>0)):[]})},904413:(pe,Ie,Ge,gt,Lt,mr)=>{w.Ab("BatchNormalization",pe,{epsilon:Ie,momentum:Ge,spatial:!!Lt,trainingMode:!!gt,format:mr?"NHWC":"NCHW"})},904582:(pe,Ie,Ge,gt,Lt,mr)=>{w.Ab("BatchNormalization",pe,{epsilon:Ie,momentum:Ge,spatial:!!Lt,trainingMode:!!gt,format:mr?"NHWC":"NCHW"})},904751:(pe,Ie,Ge)=>{w.Ab("CumSum",pe,{exclusive:Number(Ie),reverse:Number(Ge)})},904848:(pe,Ie,Ge)=>{w.Ab("DequantizeLinear",pe,{axis:Ie,blockSize:Ge})},904938:(pe,Ie,Ge,gt,Lt)=>{w.Ab("GridSample",pe,{align_corners:Ie,mode:_r(Ge),padding_mode:_r(gt),format:Lt?"NHWC":"NCHW"})},905108:(pe,Ie,Ge,gt,Lt)=>{w.Ab("GridSample",pe,{align_corners:Ie,mode:_r(Ge),padding_mode:_r(gt),format:Lt?"NHWC":"NCHW"})},905278:(pe,Ie)=>{w.Ab("ScatterND",pe,{reduction:_r(Ie)})},905363:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi)=>{w.Ab("Attention",pe,{numHeads:Ie,isUnidirectional:Ge,maskFilterValue:gt,scale:Lt,doRotary:mr,qkvHiddenSizes:ti?Array.from(ut().subarray(Number(oi)>>>0,Number(oi)+ti>>>0)):[],pastPresentShareBuffer:!!pi})},905635:pe=>{w.Ab("BiasAdd",pe,void 0)},905690:pe=>{w.Ab("BiasSplitGelu",pe,void 0)},905751:pe=>{w.Ab("FastGelu",pe,void 0)},905807:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji)=>{w.Ab("Conv",pe,{format:$i?"NHWC":"NCHW",auto_pad:Ie,dilations:Ge?Array.from(ut().subarray(Number(Ge)>>>0,Number(gt)>>>0)):[],group:Lt,kernel_shape:mr?Array.from(ut().subarray(Number(mr)>>>0,Number(ti)>>>0)):[],pads:oi?Array.from(ut().subarray(Number(oi)>>>0,Number(pi)>>>0)):[],strides:mi?Array.from(ut().subarray(Number(mi)>>>0,Number(Si)>>>0)):[],w_is_const:()=>!!Ye()[Number(Ai)>>>0],activation:_r(Ci),activation_params:Li?Array.from(dr().subarray(Number(Li)>>>0,Number(ji)>>>0)):[]})},906391:pe=>{w.Ab("Gelu",pe,void 0)},906443:(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi)=>{w.Ab("GroupQueryAttention",pe,{numHeads:Ie,kvNumHeads:Ge,scale:gt,softcap:Lt,doRotary:mr,rotaryInterleaved:ti,smoothSoftmax:oi,localWindowSize:pi})},906660:(pe,Ie,Ge,gt)=>{w.Ab("LayerNormalization",pe,{axis:Ie,epsilon:Ge,simplified:!!gt})},906771:(pe,Ie,Ge,gt)=>{w.Ab("LayerNormalization",pe,{axis:Ie,epsilon:Ge,simplified:!!gt})},906882:(pe,Ie,Ge,gt,Lt,mr)=>{w.Ab("MatMulNBits",pe,{k:Ie,n:Ge,accuracyLevel:gt,bits:Lt,blockSize:mr})},907009:(pe,Ie,Ge,gt,Lt,mr)=>{w.Ab("MultiHeadAttention",pe,{numHeads:Ie,isUnidirectional:Ge,maskFilterValue:gt,scale:Lt,doRotary:mr})},907168:(pe,Ie)=>{w.Ab("QuickGelu",pe,{alpha:Ie})},907232:(pe,Ie,Ge,gt,Lt)=>{w.Ab("RotaryEmbedding",pe,{interleaved:!!Ie,numHeads:Ge,rotaryEmbeddingDim:gt,scale:Lt})},907371:(pe,Ie,Ge)=>{w.Ab("SkipLayerNormalization",pe,{epsilon:Ie,simplified:!!Ge})},907473:(pe,Ie,Ge)=>{w.Ab("SkipLayerNormalization",pe,{epsilon:Ie,simplified:!!Ge})},907575:(pe,Ie,Ge,gt)=>{w.Ab("GatherBlockQuantized",pe,{gatherAxis:Ie,quantizeAxis:Ge,blockSize:gt})},907696:pe=>{w.$b(pe)},907730:(pe,Ie)=>w.bc(Number(pe),Number(Ie),w.Gb.ec,w.Gb.errors)};function k0(pe,Ie,Ge){return Ac(async()=>{await w.Yb(Number(pe),Number(Ie),Number(Ge))})}function $0(){return typeof wasmOffsetConverter<"u"}var ci=await(async function(){function pe(gt,Lt){return ci=gt.exports,ci=(function(){var mr=ci,ti={};for(let[oi,pi]of Object.entries(mr))ti[oi]=typeof pi=="function"?(...mi)=>{Rn.push(oi);try{return pi(...mi)}finally{dt||(Rn.pop(),Zi&&wn===1&&Rn.length===0&&(wn=0,gr+=1,On(oh),typeof Fibers<"u"&&Fibers.sc()))}}:pi;return ti})(),ci=(function(){var mr=ci,ti=pi=>mi=>pi(mi)>>>0,oi=pi=>()=>pi()>>>0;return(mr=Object.assign({},mr)).Ea=ti(mr.Ea),mr.gb=oi(mr.gb),mr.ib=ti(mr.ib),mr.tb=ti(mr.tb),mr.ub=oi(mr.ub),mr.__cxa_get_exception_ptr=ti(mr.__cxa_get_exception_ptr),mr})(),vi.push(ci.jb),re=Lt,st(),ci}Xe++;var Ie=Yt();if(w.instantiateWasm)return new Promise(gt=>{w.instantiateWasm(Ie,(Lt,mr)=>{gt(pe(Lt,mr))})});if(F)return new Promise(gt=>{Te=Lt=>{var mr=new WebAssembly.Instance(Lt,Yt());gt(pe(mr,Lt))}});Nt??=w.locateFile?w.locateFile?w.locateFile("ort-wasm-simd-threaded.jsep.wasm",Q):Q+"ort-wasm-simd-threaded.jsep.wasm":new URL(""+new URL("assets/ort-wasm-simd-threaded.jsep-CLmJQkb_.wasm",import.meta.url).href,import.meta.url).href;try{var Ge=await(async function(gt){var Lt=Nt;if(!J&&typeof WebAssembly.instantiateStreaming=="function"&&!Zt(Lt))try{var mr=fetch(Lt,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(mr,gt)}catch(ti){Et(`wasm streaming compile failed: ${ti}`),Et("falling back to ArrayBuffer instantiation")}return(async function(ti,oi){try{var pi=await(async function(mi){if(!J)try{var Si=await G(mi);return new Uint8Array(Si)}catch{}if(mi==Nt&&J)mi=new Uint8Array(J);else{if(!H)throw"both async and sync fetching of the wasm failed";mi=H(mi)}return mi})(ti);return await WebAssembly.instantiate(pi,oi)}catch(mi){Et(`failed to asynchronously prepare wasm: ${mi}`),yt(mi)}})(Lt,gt)})(Ie);return pe(Ge.instance,Ge.module)}catch(gt){return g(gt),Promise.reject(gt)}})(),Wc=pe=>(Wc=ci.Ea)(pe),Vc=()=>(Vc=ci.Fa)();w._OrtInit=(pe,Ie)=>(w._OrtInit=ci.Ga)(pe,Ie),w._OrtGetLastError=(pe,Ie)=>(w._OrtGetLastError=ci.Ha)(pe,Ie),w._OrtCreateSessionOptions=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi)=>(w._OrtCreateSessionOptions=ci.Ia)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi),w._OrtAppendExecutionProvider=(pe,Ie,Ge,gt,Lt)=>(w._OrtAppendExecutionProvider=ci.Ja)(pe,Ie,Ge,gt,Lt),w._OrtAddFreeDimensionOverride=(pe,Ie,Ge)=>(w._OrtAddFreeDimensionOverride=ci.Ka)(pe,Ie,Ge),w._OrtAddSessionConfigEntry=(pe,Ie,Ge)=>(w._OrtAddSessionConfigEntry=ci.La)(pe,Ie,Ge),w._OrtReleaseSessionOptions=pe=>(w._OrtReleaseSessionOptions=ci.Ma)(pe),w._OrtCreateSession=(pe,Ie,Ge)=>(w._OrtCreateSession=ci.Na)(pe,Ie,Ge),w._OrtReleaseSession=pe=>(w._OrtReleaseSession=ci.Oa)(pe),w._OrtGetInputOutputCount=(pe,Ie,Ge)=>(w._OrtGetInputOutputCount=ci.Pa)(pe,Ie,Ge),w._OrtGetInputOutputMetadata=(pe,Ie,Ge,gt)=>(w._OrtGetInputOutputMetadata=ci.Qa)(pe,Ie,Ge,gt),w._OrtFree=pe=>(w._OrtFree=ci.Ra)(pe),w._OrtCreateTensor=(pe,Ie,Ge,gt,Lt,mr)=>(w._OrtCreateTensor=ci.Sa)(pe,Ie,Ge,gt,Lt,mr),w._OrtGetTensorData=(pe,Ie,Ge,gt,Lt)=>(w._OrtGetTensorData=ci.Ta)(pe,Ie,Ge,gt,Lt),w._OrtReleaseTensor=pe=>(w._OrtReleaseTensor=ci.Ua)(pe),w._OrtCreateRunOptions=(pe,Ie,Ge,gt)=>(w._OrtCreateRunOptions=ci.Va)(pe,Ie,Ge,gt),w._OrtAddRunConfigEntry=(pe,Ie,Ge)=>(w._OrtAddRunConfigEntry=ci.Wa)(pe,Ie,Ge),w._OrtReleaseRunOptions=pe=>(w._OrtReleaseRunOptions=ci.Xa)(pe),w._OrtCreateBinding=pe=>(w._OrtCreateBinding=ci.Ya)(pe),w._OrtBindInput=(pe,Ie,Ge)=>(w._OrtBindInput=ci.Za)(pe,Ie,Ge),w._OrtBindOutput=(pe,Ie,Ge,gt)=>(w._OrtBindOutput=ci._a)(pe,Ie,Ge,gt),w._OrtClearBoundOutputs=pe=>(w._OrtClearBoundOutputs=ci.$a)(pe),w._OrtReleaseBinding=pe=>(w._OrtReleaseBinding=ci.ab)(pe),w._OrtRunWithBinding=(pe,Ie,Ge,gt,Lt)=>(w._OrtRunWithBinding=ci.bb)(pe,Ie,Ge,gt,Lt),w._OrtRun=(pe,Ie,Ge,gt,Lt,mr,ti,oi)=>(w._OrtRun=ci.cb)(pe,Ie,Ge,gt,Lt,mr,ti,oi),w._OrtEndProfiling=pe=>(w._OrtEndProfiling=ci.db)(pe),w._JsepOutput=(pe,Ie,Ge)=>(w._JsepOutput=ci.eb)(pe,Ie,Ge),w._JsepGetNodeName=pe=>(w._JsepGetNodeName=ci.fb)(pe);var Qo=()=>(Qo=ci.gb)(),bn=w._free=pe=>(bn=w._free=ci.hb)(pe),Un=w._malloc=pe=>(Un=w._malloc=ci.ib)(pe),Yo=(pe,Ie,Ge,gt,Lt,mr)=>(Yo=ci.kb)(pe,Ie,Ge,gt,Lt,mr),Kc=()=>(Kc=ci.lb)(),Zc=(pe,Ie,Ge,gt,Lt)=>(Zc=ci.mb)(pe,Ie,Ge,gt,Lt),Qc=pe=>(Qc=ci.nb)(pe),Jo=pe=>(Jo=ci.ob)(pe),Yc=(pe,Ie)=>(Yc=ci.pb)(pe,Ie),Jc=()=>(Jc=ci.qb)(),Xc=(pe,Ie)=>(Xc=ci.rb)(pe,Ie),Vn=pe=>(Vn=ci.sb)(pe),Xo=pe=>(Xo=ci.tb)(pe),xu=()=>(xu=ci.ub)(),uf=w.dynCall_ii=(pe,Ie)=>(uf=w.dynCall_ii=ci.vb)(pe,Ie);w.dynCall_vii=(pe,Ie,Ge)=>(w.dynCall_vii=ci.dynCall_vii)(pe,Ie,Ge),w.dynCall_iiiii=(pe,Ie,Ge,gt,Lt)=>(w.dynCall_iiiii=ci.dynCall_iiiii)(pe,Ie,Ge,gt,Lt),w.dynCall_iii=(pe,Ie,Ge)=>(w.dynCall_iii=ci.dynCall_iii)(pe,Ie,Ge),w.dynCall_iiiiii=(pe,Ie,Ge,gt,Lt,mr)=>(w.dynCall_iiiiii=ci.dynCall_iiiiii)(pe,Ie,Ge,gt,Lt,mr),w.dynCall_iiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi)=>(w.dynCall_iiiiiiii=ci.dynCall_iiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi),w.dynCall_iiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti)=>(w.dynCall_iiiiiii=ci.dynCall_iiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti),w.dynCall_vi=(pe,Ie)=>(w.dynCall_vi=ci.dynCall_vi)(pe,Ie),w.dynCall_iiii=(pe,Ie,Ge,gt)=>(w.dynCall_iiii=ci.dynCall_iiii)(pe,Ie,Ge,gt),w.dynCall_i=pe=>(w.dynCall_i=ci.dynCall_i)(pe),w.dynCall_viiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi)=>(w.dynCall_viiiiiiii=ci.dynCall_viiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi),w.dynCall_viii=(pe,Ie,Ge,gt)=>(w.dynCall_viii=ci.dynCall_viii)(pe,Ie,Ge,gt),w.dynCall_viijj=(pe,Ie,Ge,gt,Lt)=>(w.dynCall_viijj=ci.dynCall_viijj)(pe,Ie,Ge,gt,Lt),w.dynCall_viiiiii=(pe,Ie,Ge,gt,Lt,mr,ti)=>(w.dynCall_viiiiii=ci.dynCall_viiiiii)(pe,Ie,Ge,gt,Lt,mr,ti),w.dynCall_viiii=(pe,Ie,Ge,gt,Lt)=>(w.dynCall_viiii=ci.dynCall_viiii)(pe,Ie,Ge,gt,Lt),w.dynCall_viiiii=(pe,Ie,Ge,gt,Lt,mr)=>(w.dynCall_viiiii=ci.dynCall_viiiii)(pe,Ie,Ge,gt,Lt,mr),w.dynCall_vfiii=(pe,Ie,Ge,gt,Lt)=>(w.dynCall_vfiii=ci.dynCall_vfiii)(pe,Ie,Ge,gt,Lt),w.dynCall_viiiiff=(pe,Ie,Ge,gt,Lt,mr,ti)=>(w.dynCall_viiiiff=ci.dynCall_viiiiff)(pe,Ie,Ge,gt,Lt,mr,ti),w.dynCall_viiiiiff=(pe,Ie,Ge,gt,Lt,mr,ti,oi)=>(w.dynCall_viiiiiff=ci.dynCall_viiiiiff)(pe,Ie,Ge,gt,Lt,mr,ti,oi),w.dynCall_ffff=(pe,Ie,Ge,gt)=>(w.dynCall_ffff=ci.dynCall_ffff)(pe,Ie,Ge,gt),w.dynCall_viiff=(pe,Ie,Ge,gt,Lt)=>(w.dynCall_viiff=ci.dynCall_viiff)(pe,Ie,Ge,gt,Lt),w.dynCall_fffffff=(pe,Ie,Ge,gt,Lt,mr,ti)=>(w.dynCall_fffffff=ci.dynCall_fffffff)(pe,Ie,Ge,gt,Lt,mr,ti),w.dynCall_jjjjjjj=(pe,Ie,Ge,gt,Lt,mr,ti)=>(w.dynCall_jjjjjjj=ci.dynCall_jjjjjjj)(pe,Ie,Ge,gt,Lt,mr,ti),w.dynCall_jjjjjj=(pe,Ie,Ge,gt,Lt,mr)=>(w.dynCall_jjjjjj=ci.dynCall_jjjjjj)(pe,Ie,Ge,gt,Lt,mr),w.dynCall_iijjii=(pe,Ie,Ge,gt,Lt,mr)=>(w.dynCall_iijjii=ci.dynCall_iijjii)(pe,Ie,Ge,gt,Lt,mr),w.dynCall_viiiiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci)=>(w.dynCall_viiiiiiiiiiiii=ci.dynCall_viiiiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci),w.dynCall_viiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si)=>(w.dynCall_viiiiiiiiii=ci.dynCall_viiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si),w.dynCall_viiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i)=>(w.dynCall_viiiiiiiiiii=ci.dynCall_viiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i),w.dynCall_viiiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai)=>(w.dynCall_viiiiiiiiiiii=ci.dynCall_viiiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai),w.dynCall_viiiiiiiiiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji,_n,xn,In)=>(w.dynCall_viiiiiiiiiiiiiiiiii=ci.dynCall_viiiiiiiiiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji,_n,xn,In),w.dynCall_viiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi)=>(w.dynCall_viiiiiiiii=ci.dynCall_viiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi),w.dynCall_viiiiiiiiiiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji,_n,xn,In,vc)=>(w.dynCall_viiiiiiiiiiiiiiiiiii=ci.dynCall_viiiiiiiiiiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji,_n,xn,In,vc),w.dynCall_viiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi)=>(w.dynCall_viiiiiii=ci.dynCall_viiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi),w.dynCall_viiiiiiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji)=>(w.dynCall_viiiiiiiiiiiiiii=ci.dynCall_viiiiiiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji),w.dynCall_jiji=(pe,Ie,Ge,gt)=>(w.dynCall_jiji=ci.dynCall_jiji)(pe,Ie,Ge,gt),w.dynCall_v=pe=>(w.dynCall_v=ci.dynCall_v)(pe),w.dynCall_iidiiii=(pe,Ie,Ge,gt,Lt,mr,ti)=>(w.dynCall_iidiiii=ci.dynCall_iidiiii)(pe,Ie,Ge,gt,Lt,mr,ti),w.dynCall_iiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi)=>(w.dynCall_iiiiiiiii=ci.dynCall_iiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi),w.dynCall_iiij=(pe,Ie,Ge,gt)=>(w.dynCall_iiij=ci.dynCall_iiij)(pe,Ie,Ge,gt),w.dynCall_iiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi)=>(w.dynCall_iiiiiiiiii=ci.dynCall_iiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi),w.dynCall_iiiiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai)=>(w.dynCall_iiiiiiiiiiiii=ci.dynCall_iiiiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai),w.dynCall_iiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si)=>(w.dynCall_iiiiiiiiiii=ci.dynCall_iiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si),w.dynCall_ji=(pe,Ie)=>(w.dynCall_ji=ci.dynCall_ji)(pe,Ie),w.dynCall_iijii=(pe,Ie,Ge,gt,Lt)=>(w.dynCall_iijii=ci.dynCall_iijii)(pe,Ie,Ge,gt,Lt),w.dynCall_vij=(pe,Ie,Ge)=>(w.dynCall_vij=ci.dynCall_vij)(pe,Ie,Ge),w.dynCall_viiijii=(pe,Ie,Ge,gt,Lt,mr,ti)=>(w.dynCall_viiijii=ci.dynCall_viiijii)(pe,Ie,Ge,gt,Lt,mr,ti),w.dynCall_viijiiiiiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji,_n,xn)=>(w.dynCall_viijiiiiiiiiiiiiii=ci.dynCall_viijiiiiiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji,_n,xn),w.dynCall_viiiji=(pe,Ie,Ge,gt,Lt,mr)=>(w.dynCall_viiiji=ci.dynCall_viiiji)(pe,Ie,Ge,gt,Lt,mr),w.dynCall_fiii=(pe,Ie,Ge,gt)=>(w.dynCall_fiii=ci.dynCall_fiii)(pe,Ie,Ge,gt),w.dynCall_viijii=(pe,Ie,Ge,gt,Lt,mr)=>(w.dynCall_viijii=ci.dynCall_viijii)(pe,Ie,Ge,gt,Lt,mr),w.dynCall_viij=(pe,Ie,Ge,gt)=>(w.dynCall_viij=ci.dynCall_viij)(pe,Ie,Ge,gt),w.dynCall_jiij=(pe,Ie,Ge,gt)=>(w.dynCall_jiij=ci.dynCall_jiij)(pe,Ie,Ge,gt),w.dynCall_fi=(pe,Ie)=>(w.dynCall_fi=ci.dynCall_fi)(pe,Ie),w.dynCall_fii=(pe,Ie,Ge)=>(w.dynCall_fii=ci.dynCall_fii)(pe,Ie,Ge),w.dynCall_jii=(pe,Ie,Ge)=>(w.dynCall_jii=ci.dynCall_jii)(pe,Ie,Ge),w.dynCall_dii=(pe,Ie,Ge)=>(w.dynCall_dii=ci.dynCall_dii)(pe,Ie,Ge),w.dynCall_fiiii=(pe,Ie,Ge,gt,Lt)=>(w.dynCall_fiiii=ci.dynCall_fiiii)(pe,Ie,Ge,gt,Lt),w.dynCall_fif=(pe,Ie,Ge)=>(w.dynCall_fif=ci.dynCall_fif)(pe,Ie,Ge),w.dynCall_jfi=(pe,Ie,Ge)=>(w.dynCall_jfi=ci.dynCall_jfi)(pe,Ie,Ge),w.dynCall_viiiiiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li)=>(w.dynCall_viiiiiiiiiiiiii=ci.dynCall_viiiiiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li),w.dynCall_viiiiiiiiiiiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji,_n,xn,In,vc,I0)=>(w.dynCall_viiiiiiiiiiiiiiiiiiii=ci.dynCall_viiiiiiiiiiiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji,_n,xn,In,vc,I0),w.dynCall_viiiiiiiiiiiiiiii=(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji,_n)=>(w.dynCall_viiiiiiiiiiiiiiii=ci.dynCall_viiiiiiiiiiiiiiii)(pe,Ie,Ge,gt,Lt,mr,ti,oi,pi,mi,Si,$i,Ai,Ci,Li,ji,_n),w.dynCall_iif=(pe,Ie,Ge)=>(w.dynCall_iif=ci.dynCall_iif)(pe,Ie,Ge),w.dynCall_jiiii=(pe,Ie,Ge,gt,Lt)=>(w.dynCall_jiiii=ci.dynCall_jiiii)(pe,Ie,Ge,gt,Lt),w.dynCall_jiii=(pe,Ie,Ge,gt)=>(w.dynCall_jiii=ci.dynCall_jiii)(pe,Ie,Ge,gt),w.dynCall_viif=(pe,Ie,Ge,gt)=>(w.dynCall_viif=ci.dynCall_viif)(pe,Ie,Ge,gt),w.dynCall_viiij=(pe,Ie,Ge,gt,Lt)=>(w.dynCall_viiij=ci.dynCall_viiij)(pe,Ie,Ge,gt,Lt),w.dynCall_viiiijii=(pe,Ie,Ge,gt,Lt,mr,ti,oi)=>(w.dynCall_viiiijii=ci.dynCall_viiiijii)(pe,Ie,Ge,gt,Lt,mr,ti,oi),w.dynCall_iiiiij=(pe,Ie,Ge,gt,Lt,mr)=>(w.dynCall_iiiiij=ci.dynCall_iiiiij)(pe,Ie,Ge,gt,Lt,mr),w.dynCall_iiiiid=(pe,Ie,Ge,gt,Lt,mr)=>(w.dynCall_iiiiid=ci.dynCall_iiiiid)(pe,Ie,Ge,gt,Lt,mr),w.dynCall_iiiiijj=(pe,Ie,Ge,gt,Lt,mr,ti)=>(w.dynCall_iiiiijj=ci.dynCall_iiiiijj)(pe,Ie,Ge,gt,Lt,mr,ti),w.dynCall_iiiiiijj=(pe,Ie,Ge,gt,Lt,mr,ti,oi)=>(w.dynCall_iiiiiijj=ci.dynCall_iiiiiijj)(pe,Ie,Ge,gt,Lt,mr,ti,oi);var ih=pe=>(ih=ci.wb)(pe),oh=()=>(oh=ci.xb)(),Dh=pe=>(Dh=ci.yb)(pe),ep=()=>(ep=ci.zb)();return(function pe(){if(0<Xe)lt=pe;else if(F)m(w),Ce();else{for(;0<ft.length;)ft.shift()(w);0<Xe?lt=pe:(w.calledRun=!0,dt||(Ce(),m(w)))}})(),w.PTR_SIZE=4,$},Qp=Ea,Yp=globalThis.self?.name?.startsWith("em-pthread"),Yp&&Ea()}),Da,Yn,Xp,Le,Ba,Qn,Jp,em,Ma,tm,Oa,Ra,za,Ua,Tr=L$1(()=>{Sr(),Da=typeof location>"u"?void 0:location.origin,Yn=import.meta.url>"file:"&&import.meta.url<"file;",Xp=()=>{{if(Yn){let d=URL;return new URL(new d("ort.bundle.min.mjs",import.meta.url).href,Da).href}return import.meta.url}},Le=Xp(),Ba=()=>{if(Le&&!Le.startsWith("blob:"))return Le.substring(0,Le.lastIndexOf("/")+1)},Qn=(d,m)=>{try{let g=m??Le;return(g?new URL(d,g):new URL(d)).origin===Da}catch{return!1}},Jp=(d,m)=>{let g=m??Le;try{return(g?new URL(d,g):new URL(d)).href}catch{return}},em=(d,m)=>`${m??"./"}${d}`,Ma=async d=>{let m=await(await fetch(d,{credentials:"same-origin"})).blob();return URL.createObjectURL(m)},tm=async d=>(await import(d)).default,Oa=(Aa(),Xt(Ia)).default,Ra=async()=>{if(!Le)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Qn(Le))return[void 0,Oa()];let d=await Ma(Le);return[d,Oa(d)]},za=(Pa(),Xt(ka)).default,Ua=async(d,m,g,w)=>{let $=za&&!(d||m);if($)if(Le)$=Qn(Le);else if(w&&!g)$=!0;else throw new Error("cannot determine the script source URL.");if($)return[void 0,za];{let I="ort-wasm-simd-threaded.jsep.mjs",D=d??Jp(I,m),F=g&&D&&!Qn(D,m),U=F?await Ma(D):D??em(I,m);return[F?U:void 0,await tm(U)]}}}),Xn,Jn,Dr,Na,rm,nm,om,Cr,_e,$t=L$1(()=>{Tr(),Jn=!1,Dr=!1,Na=!1,rm=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},nm=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},om=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Cr=async d=>{if(Jn)return Promise.resolve();if(Dr)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Na)throw new Error("previous call to 'initializeWebAssembly()' failed.");Dr=!0;let m=d.initTimeout,g=d.numThreads;if(d.simd!==!1){if(d.simd==="relaxed"){if(!om())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!nm())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let w=rm();g>1&&!w&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+g+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),d.numThreads=g=1);let $=d.wasmPaths,I=typeof $=="string"?$:void 0,D=$?.mjs,F=D?.href??D,U=$?.wasm,q=U?.href??U,j=d.wasmBinary,[G,H]=await Ua(F,I,g>1,!!j||!!q),V=!1,Z=[];if(m>0&&Z.push(new Promise(Q=>{setTimeout(()=>{V=!0,Q()},m)})),Z.push(new Promise((Q,J)=>{let ie={numThreads:g};if(j)ie.wasmBinary=j;else if(q||I)ie.locateFile=re=>q??I+re;else if(F&&F.indexOf("blob:")!==0)ie.locateFile=re=>new URL(re,F).href;else if(G){let re=Ba();re&&(ie.locateFile=se=>re+se)}H(ie).then(re=>{Dr=!1,Jn=!0,Xn=re,Q(),G&&URL.revokeObjectURL(G)},re=>{Dr=!1,Na=!0,J(re)})})),await Promise.race(Z),V)throw new Error(`WebAssembly backend initializing failed due to timeout: ${m}ms`)},_e=()=>{if(Jn&&Xn)return Xn;throw new Error("WebAssembly is not initialized yet.")}}),We,tr,ye,Br=L$1(()=>{$t(),We=(d,m)=>{let g=_e(),w=g.lengthBytesUTF8(d)+1,$=g._malloc(w);return g.stringToUTF8(d,$,w),m.push($),$},tr=(d,m,g,w)=>{if(typeof d=="object"&&d!==null){if(g.has(d))throw new Error("Circular reference in options");g.add(d)}Object.entries(d).forEach(([$,I])=>{let D=m?m+$:$;if(typeof I=="object")tr(I,D+".",g,w);else if(typeof I=="string"||typeof I=="number")w(D,I.toString());else if(typeof I=="boolean")w(D,I?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof I}`)})},ye=d=>{let m=_e(),g=m.stackSave();try{let w=m.PTR_SIZE,$=m.stackAlloc(2*w);m._OrtGetLastError($,$+w);let I=Number(m.getValue($,w===4?"i32":"i64")),D=m.getValue($+w,"*"),F=D?m.UTF8ToString(D):"";throw new Error(`${d} ERROR_CODE: ${I}, ERROR_MESSAGE: ${F}`)}finally{m.stackRestore(g)}}}),Va,La=L$1(()=>{$t(),Br(),Va=d=>{let m=_e(),g=0,w=[],$=d||{};try{if(d?.logSeverityLevel===void 0)$.logSeverityLevel=2;else if(typeof d.logSeverityLevel!="number"||!Number.isInteger(d.logSeverityLevel)||d.logSeverityLevel<0||d.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${d.logSeverityLevel}`);if(d?.logVerbosityLevel===void 0)$.logVerbosityLevel=0;else if(typeof d.logVerbosityLevel!="number"||!Number.isInteger(d.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${d.logVerbosityLevel}`);d?.terminate===void 0&&($.terminate=!1);let I=0;return d?.tag!==void 0&&(I=We(d.tag,w)),g=m._OrtCreateRunOptions($.logSeverityLevel,$.logVerbosityLevel,!!$.terminate,I),g===0&&ye("Can't create run options."),d?.extra!==void 0&&tr(d.extra,"",new WeakSet,(D,F)=>{let U=We(D,w),q=We(F,w);m._OrtAddRunConfigEntry(g,U,q)!==0&&ye(`Can't set a run config entry: ${D} - ${F}.`)}),[g,w]}catch(I){throw g!==0&&m._OrtReleaseRunOptions(g),w.forEach(D=>m._free(D)),I}}}),im,am,sm,Mr,um,Wa,Ga=L$1(()=>{$t(),Br(),im=d=>{switch(d){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${d}`)}},am=d=>{switch(d){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${d}`)}},sm=d=>{d.extra||(d.extra={}),d.extra.session||(d.extra.session={});let m=d.extra.session;m.use_ort_model_bytes_directly||(m.use_ort_model_bytes_directly="1"),d.executionProviders&&d.executionProviders.some(g=>(typeof g=="string"?g:g.name)==="webgpu")&&(d.enableMemPattern=!1)},Mr=(d,m,g,w)=>{let $=We(m,w),I=We(g,w);_e()._OrtAddSessionConfigEntry(d,$,I)!==0&&ye(`Can't set a session config entry: ${m} - ${g}.`)},um=async(d,m,g)=>{for(let w of m){let $=typeof w=="string"?w:w.name,I=[];switch($){case"webnn":if($="WEBNN",typeof w!="string"){let j=w?.deviceType;j&&Mr(d,"deviceType",j,g)}break;case"webgpu":if($="JS",typeof w!="string"){let j=w;if(j?.preferredLayout){if(j.preferredLayout!=="NCHW"&&j.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${j.preferredLayout}`);Mr(d,"preferredLayout",j.preferredLayout,g)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${$}`)}let D=We($,g),F=I.length,U=0,q=0;if(F>0){U=_e()._malloc(F*_e().PTR_SIZE),g.push(U),q=_e()._malloc(F*_e().PTR_SIZE),g.push(q);for(let j=0;j<F;j++)_e().setValue(U+j*_e().PTR_SIZE,I[j][0],"*"),_e().setValue(q+j*_e().PTR_SIZE,I[j][1],"*")}await _e()._OrtAppendExecutionProvider(d,D,U,q,F)!==0&&ye(`Can't append execution provider: ${$}.`)}},Wa=async d=>{let m=_e(),g=0,w=[],$=d||{};sm($);try{let I=im($.graphOptimizationLevel??"all"),D=am($.executionMode??"sequential"),F=typeof $.logId=="string"?We($.logId,w):0,U=$.logSeverityLevel??2;if(!Number.isInteger(U)||U<0||U>4)throw new Error(`log severity level is not valid: ${U}`);let q=$.logVerbosityLevel??0;if(!Number.isInteger(q)||q<0||q>4)throw new Error(`log verbosity level is not valid: ${q}`);let j=typeof $.optimizedModelFilePath=="string"?We($.optimizedModelFilePath,w):0;if(g=m._OrtCreateSessionOptions(I,!!$.enableCpuMemArena,!!$.enableMemPattern,D,!!$.enableProfiling,0,F,U,q,j),g===0&&ye("Can't create session options."),$.executionProviders&&await um(g,$.executionProviders,w),$.enableGraphCapture!==void 0){if(typeof $.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${$.enableGraphCapture}`);Mr(g,"enableGraphCapture",$.enableGraphCapture.toString(),w)}if($.freeDimensionOverrides)for(let[G,H]of Object.entries($.freeDimensionOverrides)){if(typeof G!="string")throw new Error(`free dimension override name must be a string: ${G}`);if(typeof H!="number"||!Number.isInteger(H)||H<0)throw new Error(`free dimension override value must be a non-negative integer: ${H}`);let V=We(G,w);m._OrtAddFreeDimensionOverride(g,V,H)!==0&&ye(`Can't set a free dimension override: ${G} - ${H}.`)}return $.extra!==void 0&&tr($.extra,"",new WeakSet,(G,H)=>{Mr(g,G,H,w)}),[g,w]}catch(I){throw g!==0&&m._OrtReleaseSessionOptions(g)!==0&&ye("Can't release session options."),w.forEach(D=>m._free(D)),I}}}),xt,Je,St,Gt,rr,Rr,Ur,eo,ee=L$1(()=>{xt=d=>{switch(d){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${d}`)}},Je=d=>{switch(d){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${d}`)}},St=(d,m)=>{let g=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][d],w=typeof m=="number"?m:m.reduce(($,I)=>$*I,1);return g>0?Math.ceil(w*g):void 0},Gt=d=>{switch(d){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${d}`)}},rr=d=>{switch(d){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${d}`)}},Rr=d=>d==="float32"||d==="float16"||d==="int32"||d==="int64"||d==="uint32"||d==="uint8"||d==="bool"||d==="uint4"||d==="int4",Ur=d=>d==="float32"||d==="float16"||d==="int32"||d==="int64"||d==="uint32"||d==="uint64"||d==="int8"||d==="uint8"||d==="bool"||d==="uint4"||d==="int4",eo=d=>{switch(d){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${d}`)}}}),nr,to$1=L$1(()=>{Sr(),nr=async d=>{if(typeof d=="string"){let m=await fetch(d);if(!m.ok)throw new Error(`failed to load external data file: ${d}`);let g=m.headers.get("Content-Length"),w=g?parseInt(g,10):0;if(w<1073741824)return new Uint8Array(await m.arrayBuffer());{if(!m.body)throw new Error(`failed to load external data file: ${d}, no response body.`);let $=m.body.getReader(),I;try{I=new ArrayBuffer(w)}catch(F){if(F instanceof RangeError){let U=Math.ceil(w/65536);I=new WebAssembly.Memory({initial:U,maximum:U}).buffer}else throw F}let D=0;for(;;){let{done:F,value:U}=await $.read();if(F)break;let q=U.byteLength;new Uint8Array(I,D,q).set(U),D+=q}return new Uint8Array(I,0,w)}}else return d instanceof Blob?new Uint8Array(await d.arrayBuffer()):d instanceof Uint8Array?d:new Uint8Array(d)}}),lm,dm,Ha,Fa,Nr,cm,le,et=L$1(()=>{ee(),lm=["V","I","W","E","F"],dm=(d,m)=>{console.log(`[${lm[d]},${new Date().toISOString()}]${m}`)},Nr=(d,m)=>{Ha=d,Fa=m},cm=(d,m)=>{let g=rr(d),w=rr(Ha);g>=w&&dm(g,typeof m=="function"?m():m)},le=(...d)=>{Fa&&cm(...d)}}),ro,tt,E$1,Dt,Vr,qa,ja,ae=L$1(()=>{ro=class{static calcMatMulShape(d,m){return d[1]!==m[0]?void 0:[d[0],m[1]]}},tt=class{static calcShape(d,m,g=!1){let w=d.length,$=m.length;if(w===0)return m;if($===0)return d;let I=Math.max(d.length,m.length),D=new Array(I);if(g){if(w<2||$<2)return;let F=ro.calcMatMulShape([d[w-2],d[w-1]],[m[$-2],m[$-1]]);if(F===void 0)return;[D[I-2],D[I-1]]=F}for(let F=g?3:1;F<=I;F++){let U=w-F<0?1:d[w-F],q=$-F<0?1:m[$-F];if(U!==q&&U>1&&q>1)return;let j=Math.max(U,q);if(U&&q)D[I-F]=Math.max(U,q);else{if(j>1)return;D[I-F]=0}}return D}static isValidBroadcast(d,m){let g=d.length,w=m.length;if(g>w)return!1;for(let $=1;$<=g;$++)if(d[g-$]!==1&&d[g-$]!==m[w-$])return!1;return!0}},E$1=class ns{static size(m){return ns.getSizeFromDimensionRange(m,0,m.length)}static convertShape(m,g=4){let w=m.length;if(w===0)return[];let $=new Array(w),I=w-1;for(;I>=0;){if(m[I]%g===0){$[I]=m[I]/g;break}if(g%m[I]!==0)throw new Error("cannot convert shape");$[I]=1,g/=m[I],I--}for(I--;I>=0;I--)$[I]=m[I];return $}static sizeFromDimension(m,g){if(g<0||g>m.length)throw new Error(`invalid dimension of ${g} for sizeFromDimension as Tensor has ${m.length} dimensions.`);return ns.getSizeFromDimensionRange(m,g,m.length)}static sizeToDimension(m,g){if(g<0||g>m.length)throw new Error(`invalid dimension of ${g} for sizeToDimension as Tensor has ${m.length} dimensions.`);return ns.getSizeFromDimensionRange(m,0,g)}static getSizeFromDimensionRange(m,g,w){let $=1;for(let I=g;I<w;I++){if(m[I]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");$*=Number(m[I])}return $}static computeStrides(m){let g=m.length;if(g===0)return[];if(g===1)return[1];let w=new Array(g);w[g-1]=1,w[g-2]=m[g-1];for(let $=g-3;$>=0;--$)w[$]=w[$+1]*m[$+1];return w}static normalizeAxis(m,g){if(m<-g&&m>=g)throw new Error("unsupported axis for this operation.");return m<0?m+g:m}static normalizeAxes(m,g){return m.map(w=>this.normalizeAxis(w,g??m.length))}static sortBasedOnPerm(m,g){return g?g.map(w=>m[w]):m.slice().reverse()}static padShape(m,g){let w=m.length;return m.map(($,I)=>$+g[I]+g[I+w])}static areEqual(m,g){return m.length!==g.length?!1:m.every((w,$)=>w===g[$])}},Dt=class An{static adjustPoolAttributes(m,g,w,$,I,D){if(!m&&w.length!==g.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(m)for(let F=0;F<g.length-2;F++)F>=w.length?w.push(g[F+2]):w[F]=g[F+2];for(let F=0;F<w.length;F++)if(F<$.length){if($[F]<0)throw new Error("strides should be greater than or equal to 1")}else $.push(1);for(let F=0;F<w.length;F++)if(F<I.length){if(I[F]<0)throw new Error("dilations should be greater than or equal to 1")}else I.push(1);for(let F=0;F<w.length*2;F++)if(F<D.length){if(D[F]<0)throw new Error("pad should be greater than or equal to 1")}else D.push(0);for(let F=0;F<w.length;F++){if(w[F]<=0)throw new Error("kernel shapes need to be greater than 0");if(D[F]>=w[F]||D[F+w.length]>=w[F])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(m,g,w,$,I,D,F){if(F){if(I.length!==2*(m.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(g.length!==m.length-2)throw new Error("length of strides should be the length of data dimensions");if($.length!==m.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let U=0;U<m.length-2;U++)An.adjustPadAndReturnShape(m[U+(D?1:2)],g[U],w[U],$[U],I,U,U+m.length-2,F)}}static computePoolOutputShape(m,g,w,$,I,D,F){if(g.length<=0)throw new Error("input shape must be of size greater than 0");let U=[g[0],g[1]];return An.computeShapeHelper(m,g,U,w,$,I,D,F),U}static computeConvOutputShape(m,g,w,$,I,D,F){if(m.length<=0||g.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let U=[m[0],g[0]];return An.computeShapeHelper(!1,m,U,w,$,I,D,F),U}static computeShapeHelper(m,g,w,$,I,D,F,U){if(m)for(let q=0;q<g.length-2;q++)w.push(1);else for(let q=0;q<g.length-2;q++)w.push(An.adjustPadAndReturnShape(g[q+2],$[q],I[q],D[q],F,q,q+g.length-2,U))}static adjustPadAndReturnShape(m,g,w,$,I,D,F,U){let q=w*($-1)+1;if(U&&U!=="NOTSET")switch(U){case"VALID":return I[D]=0,I[F]=0,Math.floor((m-q)/g+1);case"SAME_LOWER":case"SAME_UPPER":if(w!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let j=((m+g-1)/g-1)*g+$-m;return I[D]=Math.floor(U==="SAME_LOWER"?(j+1)/2:j/2),I[F]=j-I[D],Math.floor((m+j-$)/g+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((m+I[D]+I[F]-q)/g+1)}},Vr=class{static getShapeOfGemmResult(d,m,g,w,$){if(d.length!==2||g.length!==2)throw new Error("shape need to be of size 2");let I,D,F;m?(I=d[1],D=d[0]):(I=d[0],D=d[1]);let U=-1;if(w?(F=g[0],U=1):(F=g[1],U=0),g[U]!==D)throw new Error("dimension mismatch");if(I<=0||F<=0||D<=0)throw new Error("invalid shape specified");if($&&!tt.isValidBroadcast($,[I,F]))throw new Error("gemm: invalid bias shape for broadcast");return[I,F,D]}},qa=-34028234663852886e22,ja=34028234663852886e22}),Lr,no=L$1(()=>{ee(),Lr=(d,m)=>new(Gt(m))(d)}),Za,io,Qa,pm,Ka,mm,Ya,Wr,Gr,oo,Xa,Ja=L$1(()=>{ee(),et(),Za=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),io=(d,m)=>{if(m==="int32")return d;let g=Za.get(m);if(!g)throw new Error(`WebNN backend does not support data type: ${m}`);let w=g/8;if(d.byteLength%w!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${w}.`);let $=d.byteLength/w,I=new(Gt(m))(d.buffer,d.byteOffset,$);switch(m){case"int64":case"uint64":{let D=new Int32Array($);for(let F=0;F<$;F++){let U=I[F];if(U>2147483647n||U<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");D[F]=Number(U)}return new Uint8Array(D.buffer)}case"int8":case"uint8":case"uint32":{if(m==="uint32"&&I.some(F=>F>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let D=Int32Array.from(I,Number);return new Uint8Array(D.buffer)}default:throw new Error(`Unsupported data conversion from ${m} to 'int32'`)}},Qa=(d,m)=>{if(m==="int32")return d;if(d.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let g=d.byteLength/4,w=new Int32Array(d.buffer,d.byteOffset,g);switch(m){case"int64":{let $=BigInt64Array.from(w,BigInt);return new Uint8Array($.buffer)}case"uint64":{if(w.some(I=>I<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let $=BigUint64Array.from(w,BigInt);return new Uint8Array($.buffer)}case"int8":{if(w.some(I=>I<-128||I>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let $=Int8Array.from(w,Number);return new Uint8Array($.buffer)}case"uint8":{if(w.some($=>$<0||$>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(w,Number)}case"uint32":{if(w.some(I=>I<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let $=Uint32Array.from(w,Number);return new Uint8Array($.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${m}`)}},pm=1,Ka=()=>pm++,mm=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Ya=(d,m)=>{let g=Za.get(d);if(!g)throw new Error(`WebNN backend does not support data type: ${d}`);return m.length>0?Math.ceil(m.reduce((w,$)=>w*$)*g/8):0},Wr=class{constructor(d){this.isDataConverted=!1;let{sessionId:m,context:g,tensor:w,dataType:$,shape:I,fallbackDataType:D}=d;this.sessionId=m,this.mlContext=g,this.mlTensor=w,this.dataType=$,this.tensorShape=I,this.fallbackDataType=D}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Ya(this.dataType,this.tensorShape)}destroy(){le("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(d){this.mlContext.writeTensor(this.mlTensor,d)}async read(d){if(this.fallbackDataType){let m=await this.mlContext.readTensor(this.mlTensor),g=Qa(new Uint8Array(m),this.dataType);if(d){(d instanceof ArrayBuffer?new Uint8Array(d):new Uint8Array(d.buffer,d.byteOffset,d.byteLength)).set(g);return}else return g.buffer}else return d?this.mlContext.readTensor(this.mlTensor,d):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(d,m,g){return this.mlContext===d&&this.dataType===m&&this.tensorShape.length===g.length&&this.tensorShape.every((w,$)=>w===g[$])}setIsDataConverted(d){this.isDataConverted=d}},Gr=class{constructor(d,m){this.tensorManager=d,this.wrapper=m}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(d,m,g,w){let $=this.tensorManager.getMLContext(d),I;if(!$.opSupportLimits().input.dataTypes.includes(m)){if(I=mm.get(m),!I||!$.opSupportLimits().input.dataTypes.includes(I))throw new Error(`WebNN backend does not support data type: ${m}`);le("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${m} to ${I}`)}if(this.wrapper){if(this.wrapper.canReuseTensor($,m,g))return this.wrapper.tensor;if(w){if(this.wrapper.byteLength!==Ya(m,g))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let D=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(d,m,g,D,!0,!0,I),w&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(d){let m=d;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")m=io(d,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(d.byteLength===this.wrapper.byteLength){this.wrapper.write(m);return}else le("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(m):this.activeUpload=new Uint8Array(m)}async download(d){if(this.activeUpload){let m=this.wrapper?.isDataConverted?Qa(this.activeUpload,this.wrapper?.type):this.activeUpload;if(d){d instanceof ArrayBuffer?new Uint8Array(d).set(m):new Uint8Array(d.buffer,d.byteOffset,d.byteLength).set(m);return}else return m.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return d?this.wrapper.read(d):this.wrapper.read()}},oo=class{constructor(d){this.backend=d,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(d){let m=this.backend.getMLContext(d);if(!m)throw new Error("MLContext not found for session.");return m}reserveTensorId(){let d=Ka();return this.tensorTrackersById.set(d,new Gr(this)),d}releaseTensorId(d){let m=this.tensorTrackersById.get(d);m&&(this.tensorTrackersById.delete(d),m.tensorWrapper&&this.releaseTensor(m.tensorWrapper))}async ensureTensor(d,m,g,w,$){le("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${m}, dataType: ${g}, shape: ${w}, copyOld: ${$}}`);let I=this.tensorTrackersById.get(m);if(!I)throw new Error("Tensor not found.");return I.ensureTensor(d,g,w,$)}upload(d,m){let g=this.tensorTrackersById.get(d);if(!g)throw new Error("Tensor not found.");g.upload(m)}async download(d,m){le("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${d}, dstBuffer: ${m?.byteLength}}`);let g=this.tensorTrackersById.get(d);if(!g)throw new Error("Tensor not found.");return g.download(m)}releaseTensorsForSession(d){for(let m of this.freeTensors)m.sessionId===d&&m.destroy();this.freeTensors=this.freeTensors.filter(m=>m.sessionId!==d)}registerTensor(d,m,g,w){let $=this.getMLContext(d),I=Ka(),D=new Wr({sessionId:d,context:$,tensor:m,dataType:g,shape:w});return this.tensorTrackersById.set(I,new Gr(this,D)),this.externalTensors.add(D),I}async getCachedTensor(d,m,g,w,$,I,D){let F=this.getMLContext(d);for(let[q,j]of this.freeTensors.entries())if(j.canReuseTensor(F,m,g)){le("verbose",()=>`[WebNN] Reusing tensor {dataType: ${m}, ${D?`fallbackDataType: ${D},`:""} shape: ${g}`);let G=this.freeTensors.splice(q,1)[0];return G.sessionId=d,G}le("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${m}, ${D?`fallbackDataType: ${D},`:""} shape: ${g}}`);let U=await F.createTensor({dataType:D??m,shape:g,dimensions:g,usage:w,writable:$,readable:I});return new Wr({sessionId:d,context:F,tensor:U,dataType:m,shape:g,fallbackDataType:D})}releaseTensor(d){this.externalTensors.has(d)&&this.externalTensors.delete(d),this.freeTensors.push(d)}},Xa=(...d)=>new oo(...d)}),Hr,fm,Fr,es=L$1(()=>{ee(),$t(),no(),Ja(),et(),Hr=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),fm=(d,m)=>{if(d===m)return!0;if(d===void 0||m===void 0)return!1;let g=Object.keys(d).sort(),w=Object.keys(m).sort();return g.length===w.length&&g.every(($,I)=>$===w[I]&&d[$]===m[$])},Fr=class{constructor(d){this.tensorManager=Xa(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,Nr(d.logLevel,!!d.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(d){le("verbose",()=>`[WebNN] onRunStart {sessionId: ${d}}`),this.activeSessionId=d}onRunEnd(d){le("verbose",()=>`[WebNN] onRunEnd {sessionId: ${d}}`);let m=this.temporarySessionTensorIds.get(d);if(m){for(let g of m)le("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${g}}`),this.tensorManager.releaseTensorId(g);this.temporarySessionTensorIds.delete(d),this.activeSessionId=void 0}}async createMLContext(d){if(d instanceof GPUDevice){let g=this.mlContextCache.findIndex(w=>w.gpuDevice===d);if(g!==-1)return this.mlContextCache[g].mlContext;{let w=await navigator.ml.createContext(d);return this.mlContextCache.push({gpuDevice:d,mlContext:w}),w}}else if(d===void 0){let g=this.mlContextCache.findIndex(w=>w.options===void 0&&w.gpuDevice===void 0);if(g!==-1)return this.mlContextCache[g].mlContext;{let w=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:w}),w}}let m=this.mlContextCache.findIndex(g=>fm(g.options,d));if(m!==-1)return this.mlContextCache[m].mlContext;{let g=await navigator.ml.createContext(d);return this.mlContextCache.push({options:d,mlContext:g}),g}}registerMLContext(d,m){this.mlContextBySessionId.set(d,m);let g=this.sessionIdsByMLContext.get(m);g||(g=new Set,this.sessionIdsByMLContext.set(m,g)),g.add(d),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(d,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(d,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(d){this.sessionGraphInputs.delete(d),this.sessionGraphOutputs.delete(d);let m=this.mlContextBySessionId.get(d);if(!m)return;this.tensorManager.releaseTensorsForSession(d),this.mlContextBySessionId.delete(d);let g=this.sessionIdsByMLContext.get(m);if(g.delete(d),g.size===0){this.sessionIdsByMLContext.delete(m);let w=this.mlContextCache.findIndex($=>$.mlContext===m);w!==-1&&this.mlContextCache.splice(w,1)}}getMLContext(d){return this.mlContextBySessionId.get(d)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(d){le("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${d}}`),this.tensorManager.releaseTensorId(d)}async ensureTensor(d,m,g,w,$){let I=Hr.get(g);if(!I)throw new Error(`Unsupported ONNX data type: ${g}`);return this.tensorManager.ensureTensor(d??this.currentSessionId,m,I,w,$)}async createTemporaryTensor(d,m,g){le("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${m}, shape: ${g}}`);let w=Hr.get(m);if(!w)throw new Error(`Unsupported ONNX data type: ${m}`);let $=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(d,$,w,g,!1);let I=this.temporarySessionTensorIds.get(d);return I?I.push($):this.temporarySessionTensorIds.set(d,[$]),$}uploadTensor(d,m){if(!_e().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");le("verbose",()=>`[WebNN] uploadTensor {tensorId: ${d}, data: ${m.byteLength}}`),this.tensorManager.upload(d,m)}async downloadTensor(d,m){return this.tensorManager.download(d,m)}createMLTensorDownloader(d,m){return async()=>{let g=await this.tensorManager.download(d);return Lr(g,m)}}registerMLTensor(d,m,g,w){let $=Hr.get(g);if(!$)throw new Error(`Unsupported ONNX data type: ${g}`);let I=this.tensorManager.registerTensor(d,m,$,w);return le("verbose",()=>`[WebNN] registerMLTensor {tensor: ${m}, dataType: ${$}, dimensions: ${w}} -> {tensorId: ${I}}`),I}registerMLConstant(d,m,g,w,$,I,D=!1){if(!I)throw new Error("External mounted files are not available.");let F=d;d.startsWith("./")&&(F=d.substring(2));let U=I.get(F);if(!U)throw new Error(`File with name ${F} not found in preloaded files.`);if(m+g>U.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let q=U.slice(m,m+g).buffer,j;switch($.dataType){case"float32":j=new Float32Array(q);break;case"float16":j=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(q):new Uint16Array(q);break;case"int32":j=new Int32Array(q);break;case"uint32":j=new Uint32Array(q);break;case"int64":if(D){let G=io(new Uint8Array(q),"int64");j=new Int32Array(G.buffer),$.dataType="int32"}else j=new BigInt64Array(q);break;case"uint64":j=new BigUint64Array(q);break;case"int8":j=new Int8Array(q);break;case"int4":case"uint4":case"uint8":j=new Uint8Array(q);break;default:throw new Error(`Unsupported data type: ${$.dataType} in creating WebNN Constant from external data.`)}return le("verbose",()=>`[WebNN] registerMLConstant {dataType: ${$.dataType}, shape: ${$.shape}}} ${D?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),w.constant($,j)}registerGraphInput(d){this.temporaryGraphInputs.push(d)}registerGraphOutput(d){this.temporaryGraphOutputs.push(d)}isGraphInput(d,m){let g=this.sessionGraphInputs.get(d);return g?g.includes(m):!1}isGraphOutput(d,m){let g=this.sessionGraphOutputs.get(d);return g?g.includes(m):!1}isGraphInputOutputTypeSupported(d,m,g=!0){let w=this.mlContextBySessionId.get(d),$=Hr.get(xt(m));return typeof $>"u"?!1:g?!!w?.opSupportLimits().input.dataTypes.includes($):!!w?.opSupportLimits().output.dataTypes.includes($)}flush(){}}}),qr=L$1(()=>{}),ts,ao,so,hm,gm,rs,lo,uo,os,is=L$1(()=>{et(),qr(),ts=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),ao=[],so=d=>Math.ceil(Number(d)/16)*16,hm=d=>{for(let m=0;m<ao.length;m++){let g=ao[m];if(d<=g)return g}return Math.ceil(d/16)*16},gm=1,rs=()=>gm++,lo=async(d,m,g,w)=>{let $=so(g),I=d.device.createBuffer({size:$,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let D=d.getCommandEncoder();d.endComputePass(),D.copyBufferToBuffer(m,0,I,0,$),d.flush(),await I.mapAsync(GPUMapMode.READ);let F=I.getMappedRange();if(w){let U=w();return U.set(new Uint8Array(F,0,g)),U}else return new Uint8Array(F.slice(0,g))}finally{I.destroy()}},uo=class{constructor(d){this.backend=d,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[m]of ts)ao.push(m),this.freeBuffers.set(m,[]),this.freeUniformBuffers.set(m,[]);this.sessionCount=0}upload(d,m){let g=m.buffer,w=m.byteOffset,$=m.byteLength,I=so($),D=this.storageCache.get(d);if(!D)throw new Error("gpu data for uploading does not exist");if(Number(D.originalSize)!==$)throw new Error(`inconsistent data size. gpu data size=${D.originalSize}, data size=${$}`);let F=this.backend.device.createBuffer({mappedAtCreation:!0,size:I,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),U=F.getMappedRange();new Uint8Array(U).set(new Uint8Array(g,w,$)),F.unmap();let q=this.backend.device.createCommandEncoder();q.copyBufferToBuffer(F,0,D.gpuData.buffer,0,I),this.backend.device.queue.submit([q.finish()]),F.destroy(),le("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${d})`)}memcpy(d,m){let g=this.storageCache.get(d);if(!g)throw new Error("source gpu data for memcpy does not exist");let w=this.storageCache.get(m);if(!w)throw new Error("destination gpu data for memcpy does not exist");if(g.originalSize!==w.originalSize)throw new Error("inconsistent source and destination gpu data size");let $=so(g.originalSize),I=this.backend.getCommandEncoder();this.backend.endComputePass(),I.copyBufferToBuffer(g.gpuData.buffer,0,w.gpuData.buffer,0,$)}registerExternalBuffer(d,m,g){let w;if(g){if(w=g[0],d===g[1])return le("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${m}) => id=${w}, buffer is the same, skip.`),w;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else w=rs();return this.storageCache.set(w,{gpuData:{id:w,type:0,buffer:d},originalSize:m}),le("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${m}) => id=${w}, registered.`),w}unregisterExternalBuffer(d){d!==void 0&&(this.storageCache.delete(d),le("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${d}`))}create(d,m=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let g=hm(d),w,$=(m&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,I=(m&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if($||I){let F=($?this.freeBuffers:this.freeUniformBuffers).get(g);F?F.length>0?w=F.pop():w=this.backend.device.createBuffer({size:g,usage:m}):w=this.backend.device.createBuffer({size:g,usage:m})}else w=this.backend.device.createBuffer({size:g,usage:m});let D={id:rs(),type:0,buffer:w};return this.storageCache.set(D.id,{gpuData:D,originalSize:Number(d)}),le("verbose",()=>`[WebGPU] GpuDataManager.create(size=${d}) => id=${D.id}`),D}get(d){return this.storageCache.get(d)?.gpuData}release(d){let m=typeof d=="bigint"?Number(d):d,g=this.storageCache.get(m);if(!g){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return le("verbose",()=>`[WebGPU] GpuDataManager.release(id=${m}), gpuDataId=${g.gpuData.id}`),this.storageCache.delete(m),this.buffersPending.push(g.gpuData.buffer),g.originalSize}async download(d,m){let g=this.storageCache.get(Number(d));if(!g)throw new Error("data does not exist");await lo(this.backend,g.gpuData.buffer,g.originalSize,m)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let d of this.buffersPending){let m=ts.get(d.size);if((d.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let g=this.freeBuffers.get(d.size)||[];m===void 0||g.length>=m?d.destroy():g.push(d)}else if((d.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let g=this.freeUniformBuffers.get(d.size)||[];m===void 0||g.length>=m?d.destroy():g.push(d)}else d.destroy()}this.buffersPending=[]}else{let d=this.capturedPendingBuffers.get(this.backend.currentSessionId);d||(d=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,d));for(let m of this.buffersPending)d.push(m);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(d=>{d.forEach(m=>{m.destroy()})}),this.freeUniformBuffers.forEach(d=>{d.forEach(m=>{m.destroy()})}),this.storageCache.forEach(d=>{d.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(d=>{d.forEach(m=>{m.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(d){let m=this.capturedPendingBuffers.get(d);m&&(m.forEach(g=>{g.destroy()}),this.capturedPendingBuffers.delete(d)),this.sessionCount-=1,this.sessionCount===0&&(le("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(g=>{g.gpuData.buffer.destroy()}),this.storageCache=new Map)}},os=(...d)=>new uo(...d)}),co,te,Se=L$1(()=>{co=class{constructor(d){Object.assign(this,d)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(d=>`${this[d]}`).join(";")),this.key}},te=d=>new co(d)}),Bt,mo,ve,ke,W,he,fo,Mt,je,K,jr,P,N$1,as,Kr,po,ss,ue=L$1(()=>{ee(),ae(),Bt=64,mo=(d,m)=>{if(m===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(d)){case 10:return m>1?`vec${m}<f16>`:"f16";case 1:return m>1?`vec${m}<f32>`:"f32";case 6:return m>1?`vec${m}<i32>`:"i32";case 12:return m>1?`vec${m}<u32>`:"u32";case 7:if(m>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(m>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(m!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${d}`)}},ve=(d,m=1)=>{let g=mo(d,m);return typeof g=="string"?g:g[0]},ke=(d,m=1)=>{let g=mo(d,m);return typeof g=="string"?g:g[1]},W=(...d)=>{let m=[];return d.forEach(g=>{g.length!==0&&m.push({type:12,data:g},{type:12,data:E$1.computeStrides(g)})}),m},he=d=>d%4===0?4:d%2===0?2:1,fo=(d="f32",m,g="0")=>!m||m===1?`${d}(${g})`:`vec${m}<${d}>(${g})`,Mt=(d,m,g)=>d==="f32"?g:m===1?`f32(${g})`:`vec${m}<f32>(${g})`,je=(d,m)=>m===4?`(${d}.x + ${d}.y + ${d}.z + ${d}.w)`:m===2?`(${d}.x + ${d}.y)`:m===3?`(${d}.x + ${d}.y + ${d}.z)`:d,K=(d,m,g,w)=>d.startsWith("uniforms.")&&g>4?typeof m=="string"?w==="f16"?`${d}[(${m}) / 8][(${m}) % 8 / 4][(${m}) % 8 % 4]`:`${d}[(${m}) / 4][(${m}) % 4]`:w==="f16"?`${d}[${Math.floor(m/8)}][${Math.floor(m%8/4)}][${m%8%4}]`:`${d}[${Math.floor(m/4)}][${m%4}]`:g>1?`${d}[${m}]`:d,jr=(d,m,g,w,$)=>{let I=typeof g=="number",D=I?g:g.length,F=[...new Array(D).keys()],U=D<2?"u32":D<=4?`vec${D}<u32>`:`array<u32, ${D}>`,q=mo(m,$),j=typeof q=="string"?q:q[1],G=typeof q=="string"?q:q[0],H={indices:U,value:j,storage:G,tensor:m},V=Ye=>typeof Ye=="string"?Ye:`${Ye}u`,Z={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},Q=I?"uniforms.":"",J=`${Q}${d}_shape`,ie=`${Q}${d}_strides`,re="";for(let Ye=0;Ye<D-1;Ye++)re+=`
    let dim${Ye} = current / ${K(ie,Ye,D)};
    let rest${Ye} = current % ${K(ie,Ye,D)};
    indices[${Ye}] = dim${Ye};
    current = rest${Ye};
    `;re+=`indices[${D-1}] = current;`;let se=D<2?"":`
  fn o2i_${d}(offset: u32) -> ${H.indices} {
    var indices: ${H.indices};
    var current = offset;
    ${re}
    return indices;
  }`,X=Ye=>(Z.offsetToIndices=!0,D<2?Ye:`o2i_${d}(${Ye})`),ne=[];if(D>=2)for(let Ye=D-1;Ye>=0;Ye--)ne.push(`${K(ie,Ye,D)} * (indices[${Ye}])`);let ce=D<2?"":`
  fn i2o_${d}(indices: ${H.indices}) -> u32 {
    return ${ne.join("+")};
  }`,oe=Ye=>(Z.indicesToOffset=!0,D<2?Ye:`i2o_${d}(${Ye})`),de=(...Ye)=>D===0?"0u":`${H.indices}(${Ye.map(V).join(",")})`,me=(Ye,bt)=>D<2?`${Ye}`:`${K(Ye,bt,D)}`,ge=(Ye,bt,Qt)=>D<2?`${Ye}=${Qt};`:`${K(Ye,bt,D)}=${Qt};`,fe={},xe=(Ye,bt)=>{Z.broadcastedIndicesToOffset=!0;let Qt=`${bt.name}broadcastedIndicesTo${d}Offset`;if(Qt in fe)return`${Qt}(${Ye})`;let Vt=[];for(let ut=D-1;ut>=0;ut--){let At=bt.indicesGet("outputIndices",ut+bt.rank-D);Vt.push(`${me(ie,ut)} * (${At} % ${me(J,ut)})`)}return fe[Qt]=`fn ${Qt}(outputIndices: ${bt.type.indices}) -> u32 {
             return ${Vt.length>0?Vt.join("+"):"0u"};
           }`,`${Qt}(${Ye})`},Fe=(Ye,bt)=>(()=>{if(H.storage===H.value)return`${d}[${Ye}]=${bt};`;if(H.storage==="vec2<u32>"&&H.value==="i32")return`${d}[${Ye}]=vec2<u32>(u32(${bt}), select(0u, 0xFFFFFFFFu, ${bt} < 0));`;if(H.storage==="vec2<u32>"&&H.value==="u32")return`${d}[${Ye}]=vec2<u32>(u32(${bt}), 0u);`;if(H.storage==="u32"&&H.value==="vec4<bool>")return`${d}[${Ye}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${bt}));`;throw new Error(`not supported combination of storage type ${H.storage} and value type ${H.value} yet`)})(),Te=Ye=>(()=>{if(H.storage===H.value)return`${d}[${Ye}]`;if(H.storage==="vec2<u32>"&&H.value==="i32")return`i32(${d}[${Ye}].x)`;if(H.storage==="vec2<u32>"&&H.value==="u32")return`u32(${d}[${Ye}].x)`;if(H.storage==="u32"&&H.value==="vec4<bool>")return`vec4<bool>(bool(${d}[${Ye}] & 0xFFu), bool(${d}[${Ye}] & 0xFF00u), bool(${d}[${Ye}] & 0xFF0000u), bool(${d}[${Ye}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${H.storage} and value type ${H.value} yet`)})(),Oe=D<2?"":`
  fn get_${d}ByIndices(indices: ${H.indices}) -> ${j} {
    return ${Te(`i2o_${d}(indices)`)};
  }`,Be=D<2?"":(()=>{let Ye=F.map(Qt=>`d${Qt}: u32`).join(", "),bt=F.map(Qt=>`d${Qt}`).join(", ");return`
  fn get_${d}(${Ye}) -> ${j} {
    return get_${d}ByIndices(${de(bt)});
  }`})(),_t=(...Ye)=>{if(Ye.length!==D)throw new Error(`indices length must be ${D}`);let bt=Ye.map(V).join(",");return D===0?Te("0u"):D===1?Te(bt[0]):(Z.get=!0,Z.getByIndices=!0,Z.indicesToOffset=!0,`get_${d}(${bt})`)},Et=Ye=>D<2?Te(Ye):(Z.getByIndices=!0,Z.indicesToOffset=!0,`get_${d}ByIndices(${Ye})`),dt=D<2?"":`
  fn set_${d}ByIndices(indices: ${H.indices}, value: ${j}) {
    ${Fe(`i2o_${d}(indices)`,"value")}
  }`,Zt=D<2?"":(()=>{let Ye=F.map(Qt=>`d${Qt}: u32`).join(", "),bt=F.map(Qt=>`d${Qt}`).join(", ");return`
  fn set_${d}(${Ye}, value: ${j}) {
    set_${d}ByIndices(${de(bt)}, value);
  }`})();return{impl:()=>{let Ye=[],bt=!1;return Z.offsetToIndices&&(Ye.push(se),bt=!0),Z.indicesToOffset&&(Ye.push(ce),bt=!0),Z.broadcastedIndicesToOffset&&(Object.values(fe).forEach(Qt=>Ye.push(Qt)),bt=!0),Z.set&&(Ye.push(Zt),bt=!0),Z.setByIndices&&(Ye.push(dt),bt=!0),Z.get&&(Ye.push(Be),bt=!0),Z.getByIndices&&(Ye.push(Oe),bt=!0),!I&&bt&&Ye.unshift(`const ${J} = ${H.indices}(${g.join(",")});`,`const ${ie} = ${H.indices}(${E$1.computeStrides(g).join(",")});`),Ye.join(`
`)},type:H,offsetToIndices:X,indicesToOffset:oe,broadcastedIndicesToOffset:xe,indices:de,indicesGet:me,indicesSet:ge,set:(...Ye)=>{if(Ye.length!==D+1)throw new Error(`indices length must be ${D}`);let bt=Ye[D];if(typeof bt!="string")throw new Error("value must be string");let Qt=Ye.slice(0,D).map(V).join(",");return D===0?Fe("0u",bt):D===1?Fe(Qt[0],bt):(Z.set=!0,Z.setByIndices=!0,Z.indicesToOffset=!0,`set_${d}(${Qt}, ${bt})`)},setByOffset:Fe,setByIndices:(Ye,bt)=>D<2?Fe(Ye,bt):(Z.setByIndices=!0,Z.indicesToOffset=!0,`set_${d}ByIndices(${Ye}, ${bt});`),get:_t,getByOffset:Te,getByIndices:Et,usage:w,name:d,strides:ie,shape:J,rank:D}},P=(d,m,g,w=1)=>jr(d,m,g,"input",w),N$1=(d,m,g,w=1)=>jr(d,m,g,"output",w),as=(d,m,g)=>jr(d,m,g,"atomicOutput",1),Kr=(d,m,g,w=1)=>jr(d,m,g,"internal",w),po=class{constructor(d,m){this.normalizedDispatchGroup=d,this.limits=m,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(d){return`if (global_idx >= ${typeof d=="number"?`${d}u`:d}) { return; }`}mainStart(d=Bt){let m=typeof d=="number"?d:d[0],g=typeof d=="number"?1:d[1],w=typeof d=="number"?1:d[2];if(m>this.limits.maxComputeWorkgroupSizeX||g>this.limits.maxComputeWorkgroupSizeY||w>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${m}, ${g}, ${w}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(m*g*w>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${m}, ${g}, ${w}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let $=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,I=$?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,D=$?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${m*g*w}u + local_idx;`;return`@compute @workgroup_size(${m}, ${g}, ${w})
  fn main(${I}) {
    ${D}
  `}appendVariableUniforms(d){d.rank!==0&&(d.shape.startsWith("uniforms.")&&this.uniforms.push({name:d.shape.replace("uniforms.",""),type:"u32",length:d.rank}),d.strides.startsWith("uniforms.")&&this.uniforms.push({name:d.strides.replace("uniforms.",""),type:"u32",length:d.rank}))}declareVariable(d,m){if(d.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(d),this.appendVariableUniforms(d);let g=d.usage==="input"?"read":"read_write",w=d.usage==="atomicOutput"?"atomic<i32>":d.type.storage;return`@group(0) @binding(${m}) var<storage, ${g}> ${d.name}: array<${w}>;`}declareVariables(...d){return d.map(m=>this.declareVariable(m,this.variableIndex++)).join(`
`)}registerInternalVariable(d){if(d.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(d),this.appendVariableUniforms(d)}registerInternalVariables(...d){return d.forEach(m=>this.registerInternalVariable(m)),this}registerUniform(d,m,g=1){return this.uniforms.push({name:d,type:m,length:g}),this}registerUniforms(d){return this.uniforms=this.uniforms.concat(d),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let d=[];for(let{name:m,type:g,length:w}of this.uniforms)if(w&&w>4)g==="f16"?d.push(`@align(16) ${m}:array<mat2x4<${g}>, ${Math.ceil(w/8)}>`):d.push(`${m}:array<vec4<${g}>, ${Math.ceil(w/4)}>`);else{let $=w==null||w===1?g:`vec${w}<${g}>`;d.push(`${m}:${$}`)}return`
      struct Uniforms { ${d.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(d=>d.impl()).join(`
`)+this.internalVariables.map(d=>d.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let d=m=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(m)];return this.uniforms.map(m=>[d(m.type),m.length??1])}},ss=(d,m)=>new po(d,m)}),ym,us,bm,_m,wm,vm,Pe,ls,ds,ct=L$1(()=>{ee(),ae(),Se(),ue(),ym=(d,m)=>{if(!d||d.length!==1)throw new Error("Transpose requires 1 input.");if(m.length!==0&&m.length!==d[0].dims.length)throw new Error(`perm size ${m.length} does not match input rank ${d[0].dims.length}`)},us=(d,m)=>m.length!==0?m:[...new Array(d).keys()].reverse(),bm=(d,m)=>E$1.sortBasedOnPerm(d,us(d.length,m)),_m=(d,m,g,w)=>{let $=`fn perm(i: ${w.type.indices}) -> ${g.type.indices} {
    var a: ${g.type.indices};`;for(let I=0;I<m;++I)$+=`a[${d[I]}]=i[${I}];`;return $+="return a;}"},wm=(d,m)=>{let g=[],w=[];for(let $=0;$<d.length;++$)d[$]!==1&&g.push(d[$]),d[m[$]]!==1&&w.push(m[$]);return{newShape:g,newPerm:w}},vm=(d,m)=>{let g=0;for(let w=0;w<d.length;++w)if(m[d[w]]!==1){if(d[w]<g)return!1;g=d[w]}return!0},Pe=(d,m)=>{let g=d.dataType,w=d.dims.length,$=us(w,m),I=bm(d.dims,$),D=d.dims,F=I,U=w<2||vm($,d.dims),q;if(U)return q=Z=>{let Q=P("input",g,D,4),J=N$1("output",g,F,4);return`
  ${Z.registerUniform("output_size","u32").declareVariables(Q,J)}
  ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let Z=E$1.size(I);return{outputs:[{dims:I,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(Z/64/4)},programUniforms:[{type:12,data:Math.ceil(Z/4)}]}},getShaderSource:q};let{newShape:j,newPerm:G}=wm(d.dims,$),H=E$1.areEqual(G,[2,3,1]),V=E$1.areEqual(G,[3,1,2]);if(j.length===2||H||V){D=H?[j[0],j[1]*j[2]]:V?[j[0]*j[1],j[2]]:j,F=[D[1],D[0]];let Z=16;return q=Q=>{let J=P("a",g,D.length),ie=N$1("output",g,F.length);return`
  ${Q.registerUniform("output_size","u32").declareVariables(J,ie)}
  var<workgroup> tile : array<array<${ie.type.value}, ${Z+1}>, ${Z}>;
  ${Q.mainStart([Z,Z,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${Z} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${Z}u + local_id.x;
    let input_row = workgroup_id_x * ${Z}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${J.getByIndices(`${J.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${Z}u + local_id.x;
    let output_row = workgroup_id_y * ${Z}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${ie.setByIndices(`${ie.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let Q=E$1.size(I);return{outputs:[{dims:I,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(F[1]/Z),y:Math.ceil(F[0]/Z)},programUniforms:[{type:12,data:Q},...W(D,F)]}},getShaderSource:q}}return q=Z=>{let Q=P("a",g,D.length),J=N$1("output",g,F.length);return`
  ${Z.registerUniform("output_size","u32").declareVariables(Q,J)}

  ${_m($,w,Q,J)}

  ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${J.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${J.setByOffset("global_idx",Q.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${m}`,inputDependencies:["rank"]},getRunData:()=>{let Z=E$1.size(I);return{outputs:[{dims:I,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(Z/64)},programUniforms:[{type:12,data:Z},...W(D,F)]}},getShaderSource:q}},ls=(d,m)=>{ym(d.inputs,m.perm),d.compute(Pe(d.inputs[0],m.perm))},ds=d=>te({perm:d.perm})}),$m,xm,Sm,Tm,Cm,Im,Am,Em,km,Pm,rt,cs,ps,ms,fs,hs,gs,ys,bs,_s,ws,vs=L$1(()=>{ee(),ae(),ue(),Zr(),ct(),$m={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},xm={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},Sm={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Tm={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Cm=(d,m)=>{let g=[];for(let w=m-d;w<m;++w)g.push(w);return g},Im=(d,m)=>{let g=[],w=d.length;for(let I=0;I<w;I++)m.indexOf(I)===-1&&g.push(d[I]);let $=m.map(I=>d[I]);return[g,$]},Am=(d,m)=>{let g=d.length+m.length,w=[],$=0;for(let I=0;I<g;I++)m.indexOf(I)===-1?w.push(d[$++]):w.push(1);return w},Em=(d,m)=>{for(let g=0;g<d.length;++g)if(d[d.length-g-1]!==m-1-g)return!1;return!0},km=(d,m)=>{let g=[];if(!Em(d,m)){for(let w=0;w<m;++w)d.indexOf(w)===-1&&g.push(w);d.forEach(w=>g.push(w))}return g},Pm=(d,m,g,w,$,I,D)=>{let F=g[0].dims,U=E$1.size(I),q=E$1.size(D),j=P("_A",g[0].dataType,F),G=N$1("output",$,I),H=64;U===1&&(H=256);let V=`
          var<workgroup> aBestValues : array<f32, ${H}>;
       `,Z=Q=>`
        ${Q.registerUniform("reduceSize","u32").declareVariables(j,G)}
        ${V}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${Q.mainStart(H)}

          let outputIndex = global_idx / ${H};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${Sm[w]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${H}) {
           let candidate = f32(${j.getByOffset("offset + k")});
           bestValue = ${$m[w]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${H}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${xm[w]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${G.setByOffset("outputIndex",`${w==="mean"?`${G.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${G.type.storage}(${Tm[w]})`}`)};
         }
        }`;return{name:d,shaderCache:{hint:`${m};${H}`,inputDependencies:["type"]},getShaderSource:Z,getRunData:()=>({outputs:[{dims:I,dataType:$}],dispatchGroup:{x:U},programUniforms:[{type:12,data:q}]})}},rt=(d,m,g,w)=>{let $=d.inputs.length===1?g:ho(d.inputs,g),I=$.axes;I.length===0&&!$.noopWithEmptyAxes&&(I=d.inputs[0].dims.map((V,Z)=>Z));let D=E$1.normalizeAxes(I,d.inputs[0].dims.length),F=D,U=d.inputs[0],q=km(F,d.inputs[0].dims.length);q.length>0&&(U=d.compute(Pe(d.inputs[0],q),{inputs:[0],outputs:[-1]})[0],F=Cm(F.length,U.dims.length));let[j,G]=Im(U.dims,F),H=j;$.keepDims&&(H=Am(j,D)),d.compute(Pm(m,$.cacheKey,[U],w,d.inputs[0].dataType,H,G),{inputs:[U]})},cs=(d,m)=>{rt(d,"ReduceMeanShared",m,"mean")},ps=(d,m)=>{rt(d,"ReduceL1Shared",m,"l1")},ms=(d,m)=>{rt(d,"ReduceL2Shared",m,"l2")},fs=(d,m)=>{rt(d,"ReduceLogSumExpShared",m,"logSumExp")},hs=(d,m)=>{rt(d,"ReduceMaxShared",m,"max")},gs=(d,m)=>{rt(d,"ReduceMinShared",m,"min")},ys=(d,m)=>{rt(d,"ReduceProdShared",m,"prod")},bs=(d,m)=>{rt(d,"ReduceSumShared",m,"sum")},_s=(d,m)=>{rt(d,"ReduceSumSquareShared",m,"sumSquare")},ws=(d,m)=>{rt(d,"ReduceLogSumShared",m,"logSum")}}),nt,Om,Qr,ho,ot,zm,Dm,Bm,Mm,Rm,Um,Nm,Vm,Lm,Wm,it,$s,xs,Ss,Ts,Cs,Is,As,Es,ks,Ps,Zr=L$1(()=>{ee(),ae(),Se(),ue(),vs(),nt=d=>{if(!d||d.length===0||d.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(d.length===2&&d[1].dims.length!==1)throw new Error("Invalid axes input dims.")},Om=d=>["","",`var value = ${d.getByIndices("input_indices")};`,""],Qr=(d,m,g,w,$,I,D=!1,F=!1)=>{let U=[],q=g[0].dims,j=q.length,G=E$1.normalizeAxes($,j),H=!F&&G.length===0;q.forEach((Q,J)=>{H||G.indexOf(J)>=0?D&&U.push(1):U.push(Q)});let V=U.length,Z=E$1.size(U);return{name:d,shaderCache:m,getShaderSource:Q=>{let J=[],ie=P("_A",g[0].dataType,j),re=N$1("output",I,V),se=w(ie,re,G),X=se[2];for(let ne=0,ce=0;ne<j;ne++)H||G.indexOf(ne)>=0?(D&&ce++,X=`for(var j${ne}: u32 = 0; j${ne} < ${q[ne]}; j${ne}++) {
                  ${se[2].includes("last_index")?`let last_index = j${ne};`:""}
                  ${ie.indicesSet("input_indices",ne,`j${ne}`)}
                  ${X}
                }`):(J.push(`${ie.indicesSet("input_indices",ne,re.indicesGet("output_indices",ce))};`),ce++);return`

        ${Q.registerUniform("output_size","u32").declareVariables(ie,re)}

        ${Q.mainStart()}
          ${Q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${ie.type.indices};
          let output_indices = ${re.offsetToIndices("global_idx")};

          ${J.join(`
`)}
          ${se[0]}       // init ops for reduce max/min
          ${se[1]}
          ${X}
          ${se[3]}
          ${se.length===4?re.setByOffset("global_idx","value"):se.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:U,dataType:I}],dispatchGroup:{x:Math.ceil(Z/64)},programUniforms:[{type:12,data:Z},...W(q,U)]})}},ho=(d,m)=>{let g=[];return d[1].dims[0]>0&&d[1].getBigInt64Array().forEach(w=>g.push(Number(w))),te({axes:g,keepDims:m.keepDims,noopWithEmptyAxes:m.noopWithEmptyAxes})},ot=(d,m,g,w)=>{let $=d.inputs,I=$.length===1?g:ho($,g);d.compute(Qr(m,{hint:I.cacheKey,inputDependencies:["rank"]},[$[0]],I.noopWithEmptyAxes&&I.axes.length===0?Om:w,I.axes,$[0].dataType,I.keepDims,I.noopWithEmptyAxes),{inputs:[0]})},zm=(d,m)=>{nt(d.inputs),ot(d,"ReduceLogSum",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += ${g.getByIndices("input_indices")};`,"value = log(value);"])},Dm=(d,m)=>{nt(d.inputs),ot(d,"ReduceL1",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += abs(${g.getByIndices("input_indices")});`,""])},Bm=(d,m)=>{nt(d.inputs),ot(d,"ReduceL2",m,(g,w)=>[`var t = ${w.type.value}(0); var value = ${w.type.value}(0);`,"",`t = ${g.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},Mm=(d,m)=>{nt(d.inputs),ot(d,"ReduceLogSumExp",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += exp(${g.getByIndices("input_indices")});`,"value = log(value);"])},Rm=(d,m)=>{nt(d.inputs),ot(d,"ReduceMax",m,(g,w,$)=>{let I=[];for(let D=0;D<g.rank;D++)($.indexOf(D)>=0||$.length===0)&&I.push(g.indicesSet("input_indices",D,0));return[`${I.join(`
`)}`,`var value = ${g.getByIndices("input_indices")};`,`value = max(value, ${g.getByIndices("input_indices")});`,""]})},Um=(d,m)=>{nt(d.inputs),ot(d,"ReduceMean",m,(g,w,$)=>{let I=1;for(let D=0;D<g.rank;D++)($.indexOf(D)>=0||$.length===0)&&(I*=d.inputs[0].dims[D]);return["var sum = f32(0);","",`sum += f32(${g.getByIndices("input_indices")});`,`let value = ${w.type.value}(sum / ${I});`]})},Nm=(d,m)=>{nt(d.inputs),ot(d,"ReduceMin",m,(g,w,$)=>{let I=[];for(let D=0;D<g.rank;D++)($.indexOf(D)>=0||$.length===0)&&I.push(`input_indices[${D}] = 0;`);return[`${I.join(`
`)}`,`var value = ${g.getByIndices("input_indices")};`,`value = min(value, ${g.getByIndices("input_indices")});`,""]})},Vm=(d,m)=>{nt(d.inputs),ot(d,"ReduceProd",m,(g,w)=>[`var value = ${w.type.storage}(1);`,"",`value *= ${g.getByIndices("input_indices")};`,""])},Lm=(d,m)=>{nt(d.inputs),ot(d,"ReduceSum",m,(g,w)=>[`var value = ${w.type.storage}(0);`,"",`value += ${g.getByIndices("input_indices")};`,""])},Wm=(d,m)=>{nt(d.inputs),ot(d,"ReduceSumSquare",m,(g,w)=>[`var t = ${w.type.value}(0); var value = ${w.type.value}(0);`,"",`t = ${g.getByIndices("input_indices")}; value += t * t;`,""])},it=(d,m,g)=>{if(m.length===0)return g;let w=1,$=1;for(let I=0;I<m.length;I++)m.indexOf(I)===-1?w*=d[I]:$*=d[I];return $<32&&w>1024},$s=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Um(d,m):cs(d,m)},xs=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Dm(d,m):ps(d,m)},Ss=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Bm(d,m):ms(d,m)},Ts=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Mm(d,m):fs(d,m)},Cs=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Rm(d,m):hs(d,m)},Is=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Nm(d,m):gs(d,m)},As=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Vm(d,m):ys(d,m)},Es=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Lm(d,m):bs(d,m)},ks=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?Wm(d,m):_s(d,m)},Ps=(d,m)=>{it(d.inputs[0].dims,m.axes,m.noopWithEmptyAxes)?zm(d,m):ws(d,m)}}),Os,zs,Ds,go,Bs=L$1(()=>{ee(),Se(),Zr(),Os=d=>{if(!d||d.length===0||d.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(d[0].dataType!==1)throw new Error("Invalid input type.")},zs=(d,m)=>{Os(d.inputs);let g=(w,$,I)=>{let D=[];for(let F=0;F<w.rank;F++)(I.indexOf(F)>=0||I.length===0)&&D.push(`input_indices[${F}] = 0;`);return[`${D.join(`
`)}`,`var value = ${w.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${w.getByIndices("input_indices")} ${m.selectLastIndex>0?"<=":"<"} value) {
         value = ${w.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",$.setByOffset("global_idx","best_index")]};d.compute(Qr("ArgMin",{hint:m.cacheKey,inputDependencies:["rank"]},[d.inputs[0]],g,[m.axis],7,m.keepDims),{inputs:[0]})},Ds=(d,m)=>{Os(d.inputs);let g=(w,$,I)=>{let D=[];for(let F=0;F<w.rank;F++)(I.indexOf(F)>=0||I.length===0)&&D.push(`input_indices[${F}] = 0;`);return[`${D.join(`
`)}`,`var value = ${w.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${w.getByIndices("input_indices")} ${m.selectLastIndex>0?">=":">"} value) {
         value = ${w.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",$.setByOffset("global_idx","best_index")]};d.compute(Qr("argMax",{hint:m.cacheKey,inputDependencies:["rank"]},[d.inputs[0]],g,[m.axis],7,m.keepDims),{inputs:[0]})},go=d=>te(d)}),Gm,yo,Hm,Fm,qm,Ht,jm,Ms,Yr=L$1(()=>{ee(),ae(),qr(),ue(),Gm=(d,m)=>{let g=d[0],w=d[1],$=d[2],I=d[3],D=d[4],F=d[5];if(D&&F)throw new Error("Attention cannot have both past and attention_bias");if(g.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let U=g.dims[0],q=g.dims[1],j=g.dims[2];if($.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(w.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(w.dims[0]!==j)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if($.dims[0]!==w.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let G=$.dims[0]/3,H=G,V=H;if(m.qkvHiddenSizes.length>0){if(m.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let se of m.qkvHiddenSizes)if(se%m.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");G=m.qkvHiddenSizes[0],H=m.qkvHiddenSizes[1],V=m.qkvHiddenSizes[2]}let Z=q;if(G!==H)throw new Error("qkv_hidden_sizes first element should be same as the second");if($.dims[0]!==G+H+V)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let Q=0;if(D){if(H!==V)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(D.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(D.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(D.dims[1]!==U)throw new Error('Input "past" second dimension must be batch_size');if(D.dims[2]!==m.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(D.dims[4]!==H/m.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');m.pastPresentShareBuffer||(Q=D.dims[3])}let J=Z+Q,ie=-1,re=0;if(I)throw new Error("Mask not supported");if(D)throw new Error("past is not supported");if(F){if(F.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(F.dims[0]!==U||F.dims[1]!==m.numHeads||F.dims[2]!==q||F.dims[3]!==J)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:U,sequenceLength:q,pastSequenceLength:Q,kvSequenceLength:Z,totalSequenceLength:J,maxSequenceLength:ie,inputHiddenSize:j,hiddenSize:G,vHiddenSize:V,headSize:Math.floor(G/m.numHeads),vHeadSize:Math.floor(V/m.numHeads),numHeads:m.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:m.maskFilterValue,maskType:re,scale:m.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},yo=(d,m,g)=>m&&d?`
      let total_sequence_length_input = u32(${m.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${d?.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${g?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,Hm=(d,m,g,w,$,I,D,F)=>{let U=he(D?1:I),q=64,j=I/U;j<q&&(q=32);let G=Math.ceil(I/U/q),H=[{type:12,data:m},{type:12,data:g},{type:12,data:w},{type:12,data:$},{type:12,data:j},{type:12,data:G}],V=ve(d.dataType,U),Z=ke(1,U),Q=["type"];D&&Q.push("type"),F&&Q.push("type");let J=ie=>{let re=N$1("x",d.dataType,d.dims,U),se=[re],X=D?P("seq_lens",D.dataType,D.dims):void 0;X&&se.push(X);let ne=F?P("total_sequence_length_input",F.dataType,F.dims):void 0;ne&&se.push(ne);let ce=ke(d.dataType),oe=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${q}>;
  var<workgroup> thread_sum: array<f32, ${q}>;
  ${ie.registerUniforms(oe).declareVariables(...se)}
  ${ie.mainStart([q,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${yo(X,ne,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${q}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${D?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${Z}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${Z}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(U){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${U}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${q}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${Z}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${Z}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(U){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${U}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${q}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${re.type.value}(${ce}(1.0) / ${ce}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${Z}(x[offset + i]);
        x[offset + i] = ${re.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${D?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${re.type.value}(${ce}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${q};${V};${U}`,inputDependencies:Q},getShaderSource:J,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:$,z:m*g},programUniforms:H})}},Fm=(d,m,g,w,$,I,D,F,U)=>{let q=D+I.kvSequenceLength,j=[I.batchSize,I.numHeads,I.sequenceLength,q],G=d>1&&w,H=I.kvNumHeads?I.kvNumHeads:I.numHeads,V=G?[I.batchSize,H,q,I.headSize]:void 0,Z=I.nReps?I.nReps:1,Q=I.scale===0?1/Math.sqrt(I.headSize):I.scale,J=he(I.headSize),ie=I.headSize/J,re=12,se={x:Math.ceil(q/re),y:Math.ceil(I.sequenceLength/re),z:I.batchSize*I.numHeads},X=[{type:12,data:I.sequenceLength},{type:12,data:ie},{type:12,data:q},{type:12,data:I.numHeads},{type:12,data:I.headSize},{type:1,data:Q},{type:12,data:D},{type:12,data:I.kvSequenceLength},{type:12,data:Z}],ne=G&&w&&E$1.size(w.dims)>0,ce=["type","type"];ne&&ce.push("type"),$&&ce.push("type"),F&&ce.push("type"),U&&ce.push("type");let oe=[{dims:j,dataType:m.dataType,gpuDataType:0}];G&&oe.push({dims:V,dataType:m.dataType,gpuDataType:0});let de=me=>{let ge=P("q",m.dataType,m.dims,J),fe=P("key",g.dataType,g.dims,J),xe=[ge,fe];if(ne){let dt=P("past_key",w.dataType,w.dims,J);xe.push(dt)}$&&xe.push(P("attention_bias",$.dataType,$.dims));let Fe=F?P("seq_lens",F.dataType,F.dims):void 0;Fe&&xe.push(Fe);let Te=U?P("total_sequence_length_input",U.dataType,U.dims):void 0;Te&&xe.push(Te);let Oe=N$1("output",m.dataType,j),Be=[Oe];G&&Be.push(N$1("present_key",m.dataType,V,J));let _t=ke(1,J),Et=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${re}u;

  var<workgroup> tileQ: array<${ge.type.storage}, ${re*re}>;
  var<workgroup> tileK: array<${ge.type.storage}, ${re*re}>;
  ${me.registerUniforms(Et).declareVariables(...xe,...Be)}
  ${me.mainStart([re,re,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${Z===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${Z===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${yo(Fe,Te,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${ne&&G?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${G?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${_t}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${ne&&G?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${G?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${_t}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(J){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${J}`)}})()};
        output[outputIdx] = ${Oe.type.value} (sum * uniforms.alpha) + ${$?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${J};${$!==void 0};${w!==void 0};${d}`,inputDependencies:ce},getRunData:()=>({outputs:oe,dispatchGroup:se,programUniforms:X}),getShaderSource:de}},qm=(d,m,g,w,$,I,D=void 0,F=void 0)=>{let U=I+$.kvSequenceLength,q=$.nReps?$.nReps:1,j=$.vHiddenSize*q,G=d>1&&w,H=$.kvNumHeads?$.kvNumHeads:$.numHeads,V=G?[$.batchSize,H,U,$.headSize]:void 0,Z=[$.batchSize,$.sequenceLength,j],Q=12,J={x:Math.ceil($.vHeadSize/Q),y:Math.ceil($.sequenceLength/Q),z:$.batchSize*$.numHeads},ie=[{type:12,data:$.sequenceLength},{type:12,data:U},{type:12,data:$.vHeadSize},{type:12,data:$.numHeads},{type:12,data:$.headSize},{type:12,data:j},{type:12,data:I},{type:12,data:$.kvSequenceLength},{type:12,data:q}],re=G&&w&&E$1.size(w.dims)>0,se=["type","type"];re&&se.push("type"),D&&se.push("type"),F&&se.push("type");let X=[{dims:Z,dataType:m.dataType,gpuDataType:0}];G&&X.push({dims:V,dataType:m.dataType,gpuDataType:0});let ne=ce=>{let oe=P("probs",m.dataType,m.dims),de=P("v",g.dataType,g.dims),me=[oe,de];re&&me.push(P("past_value",w.dataType,w.dims));let ge=D?P("seq_lens",D.dataType,D.dims):void 0;D&&me.push(ge);let fe=F?P("total_sequence_length_input",F.dataType,F.dims):void 0;F&&me.push(fe);let xe=[N$1("output",m.dataType,Z)];G&&xe.push(N$1("present_value",m.dataType,V));let Fe=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${Q}u;
  var<workgroup> tileQ: array<${oe.type.value}, ${Q*Q}>;
  var<workgroup> tileV: array<${oe.type.value}, ${Q*Q}>;
  ${ce.registerUniforms(Fe).declareVariables(...me,...xe)}
  ${ce.mainStart([Q,Q,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${q===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${q===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${yo(ge,fe,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${re&&G?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${G?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${oe.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${re&&G?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${G?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${w!==void 0};${d}`,inputDependencies:se},getRunData:()=>({outputs:X,dispatchGroup:J,programUniforms:ie}),getShaderSource:ne}},Ht=(d,m,g,w,$,I,D,F,U,q,j=void 0,G=void 0)=>{let H=Math.min(d.outputCount,1+(D?1:0)+(F?1:0)),V=H>1?q.pastSequenceLength:0,Z=V+q.kvSequenceLength,Q=U&&E$1.size(U.dims)>0?U:void 0,J=[m,g];H>1&&D&&E$1.size(D.dims)>0&&J.push(D),Q&&J.push(Q),j&&J.push(j),G&&J.push(G);let ie=d.compute(Fm(H,m,g,D,Q,q,V,j,G),{inputs:J,outputs:H>1?[-1,1]:[-1]})[0];d.compute(Hm(ie,q.batchSize,q.numHeads,V,q.sequenceLength,Z,j,G),{inputs:j&&G?[ie,j,G]:[ie],outputs:[]});let re=[ie,w];H>1&&F&&E$1.size(F.dims)>0&&re.push(F),j&&re.push(j),G&&re.push(G),d.compute(qm(H,ie,w,F,q,V,j,G),{inputs:re,outputs:H>1?[0,2]:[0]})},jm=(d,m)=>{let g=[m.batchSize,m.numHeads,m.sequenceLength,m.headSize],w=m.sequenceLength,$=m.inputHiddenSize,I=m.headSize,D=12,F={x:Math.ceil(m.headSize/D),y:Math.ceil(m.sequenceLength/D),z:m.batchSize*m.numHeads},U=[d.inputs[0],d.inputs[1],d.inputs[2]],q=[{type:12,data:w},{type:12,data:$},{type:12,data:I},{type:12,data:m.numHeads},{type:12,data:m.headSize},{type:12,data:m.hiddenSize},{type:12,data:m.hiddenSize+m.hiddenSize+m.vHiddenSize}],j=G=>{let H=N$1("output_q",U[0].dataType,g),V=N$1("output_k",U[0].dataType,g),Z=N$1("output_v",U[0].dataType,g),Q=P("input",U[0].dataType,U[0].dims),J=P("weight",U[1].dataType,U[1].dims),ie=P("bias",U[2].dataType,U[2].dims),re=Q.type.storage,se=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${D}u;
  var<workgroup> tileInput: array<${re}, ${D*D}>;
  var<workgroup> tileWeightQ: array<${re}, ${D*D}>;
  var<workgroup> tileWeightK: array<${re}, ${D*D}>;
  var<workgroup> tileWeightV: array<${re}, ${D*D}>;
  ${G.registerUniforms(se).declareVariables(Q,J,ie,H,V,Z)}
  ${G.mainStart([D,D,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${re}(0);
    var valueK = ${re}(0);
    var valueV = ${re}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return d.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:g,dataType:d.inputs[0].dataType,gpuDataType:0},{dims:g,dataType:d.inputs[0].dataType,gpuDataType:0},{dims:g,dataType:d.inputs[0].dataType,gpuDataType:0}],dispatchGroup:F,programUniforms:q}),getShaderSource:j},{inputs:U,outputs:[-1,-1,-1]})},Ms=(d,m)=>{let g=Gm(d.inputs,m),[w,$,I]=jm(d,g);return Ht(d,w,$,I,d.inputs[4],void 0,void 0,void 0,d.inputs[5],g)}}),Km,Zm,Qm,Rs,Us=L$1(()=>{Ve(),ee(),ae(),Se(),ue(),Km=(d,m)=>{if(!d||d.length!==5)throw new Error("BatchNormalization requires 5 inputs");let g=(w,$,I)=>{let D=$.length;if(D!==w.length)throw new Error(`${I}: num dimensions != ${D}`);$.forEach((F,U)=>{if(F!==w[U])throw new Error(`${I}: dim[${U}] do not match`)})};if(d[0].dims.length>1){let w=m.format==="NHWC"?m.spatial?d[0].dims.slice(-1):d[0].dims.slice(-1).concat(d[0].dims.slice(1,d[0].dims.length-1)):d[0].dims.slice(1,m.spatial?2:void 0);g(d[1].dims,w,"Invalid input scale"),g(d[2].dims,w,"Invalid input B"),g(d[3].dims,w,"Invalid input mean"),g(d[4].dims,w,"Invalid input var")}else g(d[1].dims,[1],"Invalid input scale"),g(d[2].dims,[1],"Invalid input B"),g(d[3].dims,[1],"Invalid input mean"),g(d[4].dims,[1],"Invalid input var")},Zm=(d,m)=>{let{epsilon:g,spatial:w,format:$}=m,I=d[0].dims,D=w?he(I[I.length-1]):1,F=$==="NHWC"&&I.length>1?D:1,U=E$1.size(I)/D,q=w,j=q?I.length:I,G=P("x",d[0].dataType,d[0].dims,D),H=P("scale",d[1].dataType,d[1].dims,F),V=P("bias",d[2].dataType,d[2].dims,F),Z=P("inputMean",d[3].dataType,d[3].dims,F),Q=P("inputVar",d[4].dataType,d[4].dims,F),J=N$1("y",d[0].dataType,j,D),ie=()=>{let se="";if(w)se=`let cOffset = ${I.length===1?"0u":$==="NHWC"?`outputIndices[${I.length-1}] / ${D}`:"outputIndices[1]"};`;else if($==="NCHW")se=`
            ${J.indicesSet("outputIndices","0","0")}
            let cOffset = ${J.indicesToOffset("outputIndices")};`;else{se=`var cIndices = ${H.type.indices}(0);
                       cIndices[0] = outputIndices[${I.length-1}];`;for(let X=1;X<H.rank;X++)se+=`cIndices[${X}] = outputIndices[${X}];`;se+=`let cOffset = ${H.indicesToOffset("cIndices")};`}return se},re=se=>`
  const epsilon = ${g};
  ${se.registerUniform("outputSize","u32").declareVariables(G,H,V,Z,Q,J)}
  ${se.mainStart()}
  ${se.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${J.offsetToIndices(`global_idx * ${D}`)};
    ${ie()}
    let scale = ${H.getByOffset("cOffset")};
    let bias = ${V.getByOffset("cOffset")};
    let inputMean = ${Z.getByOffset("cOffset")};
    let inputVar = ${Q.getByOffset("cOffset")};
    let x = ${G.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${J.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${m.epsilon}_${m.format}_${w}_${D}`,inputDependencies:q?["rank","type","type","type","type"]:void 0},getShaderSource:re,getRunData:()=>({outputs:[{dims:d[0].dims,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(U/64)},programUniforms:q?[{type:12,data:U},...W(I)]:[{type:12,data:U}]})}},Qm=d=>te(d),Rs=(d,m)=>{let{inputs:g,outputCount:w}=d,$=Qm({...m,outputCount:w});if(we.webgpu.validateInputContent&&Km(g,$),m.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");d.compute(Zm(g,$))}}),Ym,Xm,Ns,Vs=L$1(()=>{ae(),ue(),Ym=d=>{if(d[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(d[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(d[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(d[0].dims[2]!==d[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Xm=d=>{let m=d[0].dims,g=d[0].dims[2],w=E$1.size(m)/4,$=d[0].dataType,I=P("input",$,m,4),D=P("bias",$,[g],4),F=P("residual",$,m,4),U=N$1("output",$,m,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:m,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(w/64)}}),getShaderSource:q=>`
  const channels = ${g}u / 4;
  ${q.declareVariables(I,D,F,U)}

  ${q.mainStart()}
    ${q.guardAgainstOutOfBoundsWorkgroupSizes(w)}
    let value = ${I.getByOffset("global_idx")}
      + ${D.getByOffset("global_idx % channels")} + ${F.getByOffset("global_idx")};
    ${U.setByOffset("global_idx","value")}
  }`}},Ns=d=>{Ym(d.inputs),d.compute(Xm(d.inputs))}}),Jm,be,Ls,Ws,Gs,Hs,Fs,qs,js,Ks,Zs,ef,Qs,Ys,Xs,Js,or,eu,Xr,tu,ru,nu,ou,iu,au,su,uu,lu,du,cu,pu,mu,fu,hu,gu,yu,bu,bo,_o,_u,wu,vu,tf,rf,$u,Jr=L$1(()=>{ee(),ae(),Se(),ue(),Jm=(d,m,g,w,$,I,D)=>{let F=Math.ceil(m/4),U="";typeof $=="string"?U=`${$}(a)`:U=$("a");let q=P("inputData",g,[F],4),j=N$1("outputData",w,[F],4),G=[{name:"vec_size",type:"u32"}];return D&&G.push(...D),`
      ${d.registerUniforms(G).declareVariables(q,j)}

  ${I??""}

  ${d.mainStart()}
    ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${q.getByOffset("global_idx")};
    ${j.setByOffset("global_idx",U)}
  }`},be=(d,m,g,w,$,I=d.dataType,D,F)=>{let U=[{type:12,data:Math.ceil(E$1.size(d.dims)/4)}];return D&&U.push(...D),{name:m,shaderCache:{hint:$,inputDependencies:["type"]},getShaderSource:q=>Jm(q,E$1.size(d.dims),d.dataType,I,g,w,F),getRunData:q=>({outputs:[{dims:d.dims,dataType:I}],dispatchGroup:{x:Math.ceil(E$1.size(q[0].dims)/64/4)},programUniforms:U})}},Ls=d=>{d.compute(be(d.inputs[0],"Abs","abs"))},Ws=d=>{d.compute(be(d.inputs[0],"Acos","acos"))},Gs=d=>{d.compute(be(d.inputs[0],"Acosh","acosh"))},Hs=d=>{d.compute(be(d.inputs[0],"Asin","asin"))},Fs=d=>{d.compute(be(d.inputs[0],"Asinh","asinh"))},qs=d=>{d.compute(be(d.inputs[0],"Atan","atan"))},js=d=>{d.compute(be(d.inputs[0],"Atanh","atanh"))},Ks=d=>te(d),Zs=(d,m)=>{let g;switch(m.to){case 10:g="vec4<f16>";break;case 1:g="vec4<f32>";break;case 12:g="vec4<u32>";break;case 6:g="vec4<i32>";break;case 9:g="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${m.to}`)}d.compute(be(d.inputs[0],"Cast",g,void 0,m.cacheKey,m.to))},ef=d=>{let m,g,w=d.length>=2&&d[1].data!==0,$=d.length>=3&&d[2].data!==0;switch(d[0].dataType){case 1:m=w?d[1].getFloat32Array()[0]:-34028234663852886e22,g=$?d[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:m=w?d[1].getUint16Array()[0]:64511,g=$?d[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return te({min:m,max:g})},Qs=(d,m)=>{let g=m||ef(d.inputs),w=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"Clip",$=>`clamp(${$}, vec4<${w}>(uniforms.min), vec4<${w}>(uniforms.max))`,void 0,g.cacheKey,void 0,[{type:d.inputs[0].dataType,data:g.min},{type:d.inputs[0].dataType,data:g.max}],[{name:"min",type:w},{name:"max",type:w}]),{inputs:[0]})},Ys=d=>{d.compute(be(d.inputs[0],"Ceil","ceil"))},Xs=d=>{d.compute(be(d.inputs[0],"Cos","cos"))},Js=d=>{d.compute(be(d.inputs[0],"Cosh","cosh"))},or=d=>te(d),eu=(d,m)=>{let g=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"Elu",w=>`elu_vf32(${w})`,`
  const elu_alpha_ = ${g}(${m.alpha});

  fn elu_f32(a: ${g}) -> ${g} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${g}>) -> vec4<${g}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,m.cacheKey))},Xr=(d="f32")=>`
const r0: ${d} = 0.3275911;
const r1: ${d} = 0.254829592;
const r2: ${d} = -0.284496736;
const r3: ${d} = 1.421413741;
const r4: ${d} = -1.453152027;
const r5: ${d} = 1.061405429;

fn erf_vf32(v: vec4<${d}>) -> vec4<${d}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,tu=d=>{let m=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"Erf",g=>`erf_vf32(${g})`,Xr(m)))},ru=d=>{d.compute(be(d.inputs[0],"Exp","exp"))},nu=d=>{d.compute(be(d.inputs[0],"Floor","floor"))},ou=d=>{let m=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"Gelu",g=>`0.5 * ${g} * (1.0 + erf_vf32(${g} * 0.7071067811865475))`,Xr(m)))},iu=(d,m)=>{let g=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"LeakyRelu",w=>`select(leaky_relu_alpha_ * ${w}, ${w}, ${w} >= vec4<${g}>(0.0))`,`const leaky_relu_alpha_ = ${g}(${m.alpha});`,m.cacheKey))},au=d=>{d.compute(be(d.inputs[0],"Not",m=>`!${m}`))},su=d=>{d.compute(be(d.inputs[0],"Neg",m=>`-${m}`))},uu=d=>{d.compute(be(d.inputs[0],"Reciprocal",m=>`1.0/${m}`))},lu=d=>{let m=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"Relu",g=>`select(vec4<${m}>(0.0), ${g}, ${g} > vec4<${m}>(0.0))`))},du=d=>{d.compute(be(d.inputs[0],"Sigmoid",m=>`(1.0 / (1.0 + exp(-${m})))`))},cu=d=>te(d),pu=(d,m)=>{let g=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"HardSigmoid",w=>`max(vec4<${g}>(0.0), min(vec4<${g}>(1.0), ${m.alpha} * ${w} + vec4<${g}>(${m.beta})))`,void 0,m.cacheKey))},mu=d=>{d.compute(be(d.inputs[0],"Sin","sin"))},fu=d=>{d.compute(be(d.inputs[0],"Sinh","sinh"))},hu=d=>{d.compute(be(d.inputs[0],"Sqrt","sqrt"))},gu=d=>{d.compute(be(d.inputs[0],"Tan","tan"))},yu=d=>`sign(${d}) * (1 - exp(-2 * abs(${d}))) / (1 + exp(-2 * abs(${d})))`,bu=d=>{d.compute(be(d.inputs[0],"Tanh",yu))},bo=(d="f32")=>`
const fast_gelu_a: ${d} = 0.5;
const fast_gelu_b: ${d} = 0.7978845608028654;
const fast_gelu_c: ${d} = 0.035677408136300125;

fn tanh_v(v: vec4<${d}>) -> vec4<${d}> {
  return ${yu("v")};
}
`,_o=d=>`(fast_gelu_a + fast_gelu_a * tanh_v(${d} * (fast_gelu_c * ${d} * ${d} + fast_gelu_b))) * ${d}`,_u=d=>{let m=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"FastGelu",_o,bo(m),void 0,d.inputs[0].dataType))},wu=(d,m)=>{let g=ke(d.inputs[0].dataType);return d.compute(be(d.inputs[0],"ThresholdedRelu",w=>`select(vec4<${g}>(0.0), ${w}, ${w} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${g}>(${m.alpha});`,m.cacheKey)),0},vu=d=>{d.compute(be(d.inputs[0],"Log","log"))},tf=(d,m)=>`
const alpha = vec4<${d}>(${m});
const one = ${d}(1.0);
const zero = ${d}(0.0);

fn quick_gelu_impl(x: vec4<${d}>) -> vec4<${d}> {
  let v = x *alpha;
  var x1 : vec4<${d}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,rf=d=>`quick_gelu_impl(${d})`,$u=(d,m)=>{let g=ke(d.inputs[0].dataType);d.compute(be(d.inputs[0],"QuickGelu",rf,tf(g,m.alpha),m.cacheKey,d.inputs[0].dataType))}}),nf,of,Su,Tu=L$1(()=>{ae(),ue(),Jr(),nf=d=>{if(d[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(d[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(d[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(d[0].dims[2]!==d[1].dims[0])throw new Error("last dimension of input and bias are not the same")},of=d=>{let m=d[0].dims.slice();m[2]=m[2]/2;let g=P("input",d[0].dataType,d[0].dims,4),w=P("bias",d[0].dataType,[d[0].dims[2]],4),$=N$1("output",d[0].dataType,m,4),I=E$1.size(m)/4,D=ve(d[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:m,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(I/64)}}),getShaderSource:F=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${d[0].dims[2]/4/2}u;

  ${F.declareVariables(g,w,$)}

  ${Xr(D)}

  ${F.mainStart()}
    ${F.guardAgainstOutOfBoundsWorkgroupSizes(I)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${$.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},Su=d=>{nf(d.inputs),d.compute(of(d.inputs))}}),af,sf,at,Cu,Iu,Au,Eu,ku,Pu,Ou,zu,Du,Bu,Mu=L$1(()=>{ee(),ae(),ue(),af=(d,m,g,w,$,I,D,F,U,q,j,G)=>{let H,V;typeof F=="string"?H=V=(re,se)=>`${F}((${re}),(${se}))`:typeof F=="function"?H=V=F:(H=F.scalar,V=F.vector);let Z=N$1("outputData",j,w.length,4),Q=P("aData",U,m.length,4),J=P("bData",q,g.length,4),ie;if($)if(I){let re=E$1.size(m)===1,se=E$1.size(g)===1,X=m.length>0&&m[m.length-1]%4===0,ne=g.length>0&&g[g.length-1]%4===0;re||se?ie=Z.setByOffset("global_idx",V(re?`${Q.type.value}(${Q.getByOffset("0")}.x)`:Q.getByOffset("global_idx"),se?`${J.type.value}(${J.getByOffset("0")}.x)`:J.getByOffset("global_idx"))):ie=`
            let outputIndices = ${Z.offsetToIndices("global_idx * 4u")};
            let offsetA = ${Q.broadcastedIndicesToOffset("outputIndices",Z)};
            let offsetB = ${J.broadcastedIndicesToOffset("outputIndices",Z)};
            ${Z.setByOffset("global_idx",V(D||X?Q.getByOffset("offsetA / 4u"):`${Q.type.value}(${Q.getByOffset("offsetA / 4u")}[offsetA % 4u])`,D||ne?J.getByOffset("offsetB / 4u"):`${J.type.value}(${J.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else ie=Z.setByOffset("global_idx",V(Q.getByOffset("global_idx"),J.getByOffset("global_idx")));else{if(!I)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let re=(se,X,ne="")=>{let ce=`aData[indexA${X}][componentA${X}]`,oe=`bData[indexB${X}][componentB${X}]`;return`
            let outputIndices${X} = ${Z.offsetToIndices(`global_idx * 4u + ${X}u`)};
            let offsetA${X} = ${Q.broadcastedIndicesToOffset(`outputIndices${X}`,Z)};
            let offsetB${X} = ${J.broadcastedIndicesToOffset(`outputIndices${X}`,Z)};
            let indexA${X} = offsetA${X} / 4u;
            let indexB${X} = offsetB${X} / 4u;
            let componentA${X} = offsetA${X} % 4u;
            let componentB${X} = offsetB${X} % 4u;
            ${se}[${X}] = ${ne}(${H(ce,oe)});
          `};j===9?ie=`
            var data = vec4<u32>(0);
            ${re("data",0,"u32")}
            ${re("data",1,"u32")}
            ${re("data",2,"u32")}
            ${re("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:ie=`
            ${re("outputData[global_idx]",0)}
            ${re("outputData[global_idx]",1)}
            ${re("outputData[global_idx]",2)}
            ${re("outputData[global_idx]",3)}
          `}return`
        ${d.registerUniform("vec_size","u32").declareVariables(Q,J,Z)}

        ${G??""}

        ${d.mainStart()}
        ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${ie}
      }`},sf=(d,m,g,w,$,I,D=g.dataType)=>{let F=g.dims.map(Q=>Number(Q)??1),U=w.dims.map(Q=>Number(Q)??1),q=!E$1.areEqual(F,U),j=F,G=E$1.size(F),H=!1,V=!1,Z=[q];if(q){let Q=tt.calcShape(F,U,!1);if(!Q)throw new Error("Can't perform binary op on the given tensors");j=Q.slice(),G=E$1.size(j);let J=E$1.size(F)===1,ie=E$1.size(U)===1,re=F.length>0&&F[F.length-1]%4===0,se=U.length>0&&U[U.length-1]%4===0;Z.push(J),Z.push(ie),Z.push(re),Z.push(se);let X=1;for(let ne=1;ne<j.length;ne++){let ce=F[F.length-ne],oe=U[U.length-ne];if(ce===oe)X*=ce;else break}X%4===0?(V=!0,H=!0):(J||ie||re||se)&&(H=!0)}else H=!0;return Z.push(H),{name:d,shaderCache:{hint:m+Z.map(Q=>Q.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:Q=>af(Q,F,U,j,H,q,V,$,g.dataType,w.dataType,D,I),getRunData:()=>({outputs:[{dims:j,dataType:D}],dispatchGroup:{x:Math.ceil(G/64/4)},programUniforms:[{type:12,data:Math.ceil(E$1.size(j)/4)},...W(F,U,j)]})}},at=(d,m,g,w,$,I)=>{d.compute(sf(m,$??"",d.inputs[0],d.inputs[1],g,w,I))},Cu=d=>{at(d,"Add",(m,g)=>`${m}+${g}`)},Iu=d=>{at(d,"Div",(m,g)=>`${m}/${g}`)},Au=d=>{at(d,"Equal",{scalar:(m,g)=>`u32(${m}==${g})`,vector:(m,g)=>`vec4<u32>(${m}==${g})`},void 0,void 0,9)},Eu=d=>{at(d,"Mul",(m,g)=>`${m}*${g}`)},ku=d=>{let m=P("input",d.inputs[0].dataType,d.inputs[0].dims).type.value;at(d,"Pow",{scalar:(g,w)=>`pow_custom(${g},${w})`,vector:(g,w)=>`pow_vector_custom(${g},${w})`},`
    fn pow_custom(a : ${m}, b : ${m}) -> ${m} {
      if (b == ${m}(0.0)) {
        return ${m}(1.0);
      } else if (a < ${m}(0.0) && f32(b) != floor(f32(b))) {
        return ${m}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${m}(1.0), round(f32(abs(b) % ${m}(2.0))) != 1.0) * ${m}(${m==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${m}>, b : vec4<${m}>) -> vec4<${m}> {
      // TODO: implement vectorized pow
      return vec4<${m}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},Pu=d=>{at(d,"Sub",(m,g)=>`${m}-${g}`)},Ou=d=>{at(d,"Greater",{scalar:(m,g)=>`u32(${m}>${g})`,vector:(m,g)=>`vec4<u32>(${m}>${g})`},void 0,void 0,9)},zu=d=>{at(d,"Less",{scalar:(m,g)=>`u32(${m}<${g})`,vector:(m,g)=>`vec4<u32>(${m}<${g})`},void 0,void 0,9)},Du=d=>{at(d,"GreaterOrEqual",{scalar:(m,g)=>`u32(${m}>=${g})`,vector:(m,g)=>`vec4<u32>(${m}>=${g})`},void 0,void 0,9)},Bu=d=>{at(d,"LessOrEqual",{scalar:(m,g)=>`u32(${m}<=${g})`,vector:(m,g)=>`vec4<u32>(${m}<=${g})`},void 0,void 0,9)}}),lf,df,cf,pf,Ru,Uu,Nu=L$1(()=>{ee(),ae(),Se(),ue(),lf=(d,m)=>{if(!d||d.length<1)throw new Error("too few inputs");let g=0,w=d[g],$=w.dataType,I=w.dims.length;d.forEach((D,F)=>{if(F!==g){if(D.dataType!==$)throw new Error("input tensors should be one type");if(D.dims.length!==I)throw new Error("input tensors should have the same shape");D.dims.forEach((U,q)=>{if(q!==m&&U!==w.dims[q])throw new Error("non concat dimensions must match")})}})},df=(d,m)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${d}u>(${m});
    for (var i: u32 = 0u; i < ${d}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${d}u;
  }`,cf=(d,m)=>{let g=d.length,w=[];for(let $=0;$<g;++$){let I=m.setByOffset("global_idx",d[$].getByIndices("indices"));g===1?w.push(I):$===0?w.push(`if (inputIndex == ${$}u) { ${I} }`):$===g-1?w.push(`else { ${I} }`):w.push(`else if (inputIndex == ${$}) { ${I} }`)}return w.join(`
`)},pf=(d,m,g,w)=>{let $=E$1.size(g),I=new Array(d.length),D=new Array(d.length),F=0,U=[],q=[],j=[{type:12,data:$}];for(let Q=0;Q<d.length;++Q)F+=d[Q].dims[m],I[Q]=F,q.push(d[Q].dims.length),D[Q]=P(`input${Q}`,w,q[Q]),U.push("rank"),j.push({type:12,data:I[Q]});for(let Q=0;Q<d.length;++Q)j.push(...W(d[Q].dims));j.push(...W(g));let G=N$1("output",w,g.length),H=G.indicesGet("indices",m),V=Array.from(Array(I.length).keys()).map(Q=>`uniforms.sizeInConcatAxis${Q}`).join(","),Z=Q=>`

  ${(()=>{Q.registerUniform("outputSize","u32");for(let J=0;J<d.length;J++)Q.registerUniform(`sizeInConcatAxis${J}`,"u32");return Q.declareVariables(...D,G)})()}

  ${df(I.length,V)}

  ${Q.mainStart()}
    ${Q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${G.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${H});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${I.length}u>(${V});
      ${H} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${cf(D,G)}
  }`;return{name:"Concat",shaderCache:{hint:`${m}`,inputDependencies:U},getRunData:()=>({outputs:[{dims:g,dataType:w}],dispatchGroup:{x:Math.ceil($/64)},programUniforms:j}),getShaderSource:Z}},Ru=(d,m)=>{let g=d.inputs,w=g[0].dims,$=E$1.normalizeAxis(m.axis,w.length);lf(g,$);let I=w.slice();I[$]=g.reduce((F,U)=>F+(U.dims.length>$?U.dims[$]:0),0);let D=g.filter(F=>E$1.size(F.dims)>0);d.compute(pf(D,$,I,g[0].dataType),{inputs:D})},Uu=d=>te({axis:d.axis})}),Ke,Ze,Qe,en,Tt=L$1(()=>{ee(),ae(),Ke=(d,m,g="f32")=>{switch(d.activation){case"Relu":return`value = max(value, ${m}(0.0));`;case"Sigmoid":return`value = (${m}(1.0) / (${m}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${m}(${g}(uniforms.clip_min)), ${m}(${g}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${m}(0.0), min(${m}(1.0), ${g}(uniforms.alpha) * value + ${g}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${g}(uniforms.alpha) * value, value, value >= ${m}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${d.activation}`)}},Ze=(d,m)=>{d.activation==="Clip"?m.push({type:1,data:d.clipMax},{type:1,data:d.clipMin}):d.activation==="HardSigmoid"?m.push({type:1,data:d.alpha},{type:1,data:d.beta}):d.activation==="LeakyRelu"&&m.push({type:1,data:d.alpha})},Qe=(d,m)=>{d.activation==="Clip"?m.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):d.activation==="HardSigmoid"?m.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):d.activation==="LeakyRelu"&&m.push({name:"alpha",type:"f32"})},en=d=>{let m=d?.activation||"";if(m==="HardSigmoid"){let[g,w]=d?.activation_params||[.2,.5];return{activation:m,alpha:g,beta:w}}else if(m==="Clip"){let[g,w]=d?.activation_params||[qa,ja];return{activation:m,clipMax:w,clipMin:g}}else if(m==="LeakyRelu"){let[g]=d?.activation_params||[.01];return{activation:m,alpha:g}}return{activation:m}}}),Ae,Vu,tn=L$1(()=>{Ae=(d,m)=>{switch(d){case 1:return m;case 2:return`vec2<${m}>`;case 3:return`vec3<${m}>`;case 4:return`vec4<${m}>`;default:throw new Error(`${d}-component is not supported.`)}},Vu=d=>`
      ${d?"value = value + getBiasByOutputCoords(coords);":""}
      `}),Lu,Wu=L$1(()=>{Lu=d=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${d}.x), i32(${d}.y), i32(${d}.z), 1));
}
`}),ir,rn,nn=L$1(()=>{ee(),ae(),ue(),Tt(),ir=(d,m,g,w,$)=>{let I=w-g;return`
      ${Array.from({length:g}).map((D,F)=>`
      if (${K(m.shape,F,m.rank)} != 1) {
        ${m.indicesSet(d,F,K($,F+I,w))}
      } else {
        ${m.indicesSet(d,F,0)}
      }`).join("")}
`},rn=(d,m,g,w,$=!1,I)=>{let D=d[0].dims,F=d[1].dims,U=D[D.length-2],q=F[F.length-1],j=D[D.length-1],G=he(q),H=he(j),V=he(U),Z=E$1.size(g)/G/V,Q=d.length>2,J=w?w.slice(0,-2):g.slice(0,-2),ie=[E$1.size(J),U,q],re=[{type:12,data:Z},{type:12,data:U},{type:12,data:q},{type:12,data:j}];Ze(m,re),re.push(...W(J,D,F)),Q&&re.push(...W(d[2].dims)),re.push(...W(ie));let se=X=>{let ne=Kr("batch_dims",d[0].dataType,J.length),ce=P("a",d[0].dataType,D.length,H),oe=P("b",d[1].dataType,F.length,G),de=N$1("output",d[0].dataType,ie.length,G),me=ve(de.type.tensor),ge=Ke(m,de.type.value,me),fe=[ce,oe],xe="";if(Q){let Oe=$?G:1;fe.push(P("bias",d[2].dataType,d[2].dims.length,Oe)),xe=`${$?`value += bias[col / ${Oe}];`:`value += ${de.type.value}(bias[row + i]);`}`}let Fe=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Qe(m,Fe);let Te=()=>{let Oe=`var a_data: ${ce.type.value};`;for(let Be=0;Be<H;Be++)Oe+=`
              let b_data${Be} = b[(b_offset + (k + ${Be}) * uniforms.N + col) / ${G}];`;for(let Be=0;Be<V;Be++){Oe+=`a_data = a[(a_offset + (row + ${Be}) * uniforms.K + k) / ${H}];`;for(let _t=0;_t<H;_t++)Oe+=`
            values[${Be}] = fma(${oe.type.value}(a_data${H===1?"":`[${_t}]`}), b_data${_t}, values[${Be}]);
`}return Oe};return`
  ${X.registerUniforms(Fe).registerInternalVariables(ne).declareVariables(...fe,de)}
  ${X.mainStart()}
    ${X.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${G})) * ${G};
    var index1 = global_idx / (uniforms.N / ${G});
    let stride1 = uniforms.M / ${V};
    let row = (index1 % stride1) * ${V};
    let batch = index1 / stride1;

    ${g.length===2?"":`let batch_indices = ${ne.offsetToIndices("batch")};`}

    var a_indices: ${ce.type.indices};
    ${ir("a_indices",ce,ce.rank-2,ne.rank,"batch_indices")}
    ${ce.indicesSet("a_indices",ce.rank-2,0)}
    ${ce.indicesSet("a_indices",ce.rank-1,0)}
    let a_offset = ${ce.indicesToOffset("a_indices")};

    var b_indices: ${oe.type.indices};
    ${ir("b_indices",oe,oe.rank-2,ne.rank,"batch_indices")}
    ${oe.indicesSet("b_indices",oe.rank-2,0)}
    ${oe.indicesSet("b_indices",oe.rank-1,0)}
    let b_offset = ${oe.indicesToOffset("b_indices")};
    var values: array<${de.type.value}, ${V}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${H}) {
      ${Te()}
    }
    for (var i = 0u; i < ${V}u; i++) {
      var value = values[i];
      ${xe}
      ${ge}
      let cur_indices = ${de.type.indices}(batch, row + i, col);
      let offset = ${de.indicesToOffset("cur_indices")};
      ${de.setByOffset(`offset / ${G}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${m.activation};${G};${H};${V};${$}`,inputDependencies:Q?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:I?I(g):g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(Z/64)},programUniforms:re}),getShaderSource:se}}}),mf,ff,wo,Gu,hf,vo,gf,ar,on=L$1(()=>{ee(),ae(),ue(),Tt(),nn(),tn(),mf=(d,m)=>d?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${m?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${m?", batchIndices":""});
        `,ff=(d,m)=>d?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${m===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${m===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${m===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,wo=(d,m,g="f32",w,$=!1,I=32,D=!1,F=32)=>{let U=m[1]*d[1],q=m[0]*d[0],j=$?U:I,G=$?I:U,H=j/m[0],V=I/m[1];if(!(($&&H===4&&d[1]===4||!$&&(H===3||H===4))&&j%m[0]===0&&I%m[1]===0&&d[0]===4))throw new Error(`If transposeA ${$} is true, innerElementSize ${H} and workPerThread[1] ${d[1]} must be 4.
      Otherwise, innerElementSize ${H} must be 3 or 4.
  tileAWidth ${j} must be divisible by workgroupSize[0]${m[0]}. tileInner ${I} must be divisible by workgroupSize[1] ${m[1]}. colPerThread ${d[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${H}<${g}>, ${j/H}>, ${G}>;
var<workgroup> mm_Bsub: array<array<vec4<${g}>, ${q/d[0]}>, ${I}>;

const rowPerThread = ${d[1]};
const colPerThread = ${d[0]};
const innerElementSize = ${H};
const tileInner = ${I};

@compute @workgroup_size(${m[0]}, ${m[1]}, ${m[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${D?"0":"i32(globalId.z)"};
  ${w?`let batchIndices = ${w.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${U};

  let num_tiles = ${D?`${Math.ceil(F/I)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${D?`i32(globalId.z) * ${F}`:"0"};

  var acc: array<vec4<${g}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${V};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${mf($,w)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${V}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${w?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${H===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${ff($,H)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},Gu=(d,m)=>d?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${m?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${m?", batchIndices":""});
            `,hf=d=>d?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",vo=(d,m,g="f32",w,$=!1,I=32,D=!1,F=32,U=!1)=>{let q=d[1]*m[1],j=d[0]*m[0],G=$?q:I,H=$?I:q;if(!(H%m[1]===0&&G%m[0]===0&&I%m[1]===0))throw new Error(`tileAHight ${H} must be divisible by workgroupSize[1]${m[1]}, tileAWidth ${G} must be divisible by workgroupSize[0]${m[0]}, tileInner ${I} must be divisible by workgroupSize[1]${m[1]}`);let V=H/m[1],Z=G/m[0],Q=I/m[1],J=U?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${q};
    let globalColStart = i32(workgroupId.x) * ${j};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${H}; inputRow = inputRow + ${m[1]}) {
        for (var inputCol = localCol; inputCol < ${G}; inputCol = inputCol + ${m[0]}) {
          ${Gu($,w)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${I}; inputRow = inputRow + ${m[1]}) {
            for (var inputCol = localCol; inputCol < ${j}; inputCol = inputCol + ${m[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${w?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${g}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${m[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${$?`mm_Asub[k][localRow + innerRow * ${m[1]}];`:`mm_Asub[localRow + innerRow * ${m[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${m[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${m[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${q};

let tileRowA = i32(localId.y) * ${V};
let tileColA = i32(localId.x) * ${Z};
let tileRowB = i32(localId.y) * ${Q};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${V}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${Z}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${Gu($,w)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${Q}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${w?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${g}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${hf($)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${g}, ${G}>, ${H}>;
  var<workgroup> mm_Bsub : array<array<${g}, ${j}>, ${I}>;
  const rowPerThread = ${d[1]};
  const colPerThread = ${d[0]};
  const tileInner = ${I};

@compute @workgroup_size(${m[0]}, ${m[1]}, ${m[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${D?"0":"i32(globalId.z)"};
    ${w?`let batchIndices = ${w.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${D?`${Math.ceil(F/I)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${D?`i32(globalId.z) * ${F}`:"0"};

    var acc : array<array<${g}, colPerThread>, rowPerThread>;
    ${J}
  }
`},gf=(d,m,g,w,$=!1)=>{let[I,D,F,U]=w,q=ve(w[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${I.type.indices}) -> ${Ae(d,q)} {
      var value = ${Ae(d,q)}(0.0);
      let col = colIn * ${d};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${D.type.indices};
        ${ir("aIndices",D,D.rank-2,I.rank,"batchIndices")}
        ${D.indicesSet("aIndices",D.rank-2,"u32(row)")}
        ${D.indicesSet("aIndices",D.rank-1,"u32(colIn)")}
        value = ${D.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${I.type.indices}) -> ${Ae(d,q)} {
      var value = ${Ae(d,q)}(0.0);
      let col = colIn * ${d};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${F.type.indices};
        ${ir("bIndices",F,F.rank-2,I.rank,"batchIndices")}
        ${F.indicesSet("bIndices",F.rank-2,"u32(row)")}
        ${F.indicesSet("bIndices",F.rank-1,"u32(colIn)")}
        value = ${F.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Ae(d,q)}) {
      let col = colIn * ${d};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${m?`value = value + ${$?"bias[colIn]":`${Ae(d,q)}(bias[row])`};`:""}
        ${g}
        ${U.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},ar=(d,m,g,w,$=!1,I)=>{let D=d[0].dims,F=d[1].dims,U=D.slice(0,-2),q=F.slice(0,-2),j=w?w.slice(0,-2):g.slice(0,-2),G=E$1.size(j),H=D[D.length-2],V=D[D.length-1],Z=F[F.length-1],Q=V%4===0&&Z%4===0,J=H<=8?[4,1,1]:[4,4,1],ie=[8,8,1],re=[Math.ceil(Z/ie[0]/J[0]),Math.ceil(H/ie[1]/J[1]),Math.ceil(G/ie[2]/J[2])],se=Q?4:1,X=[...U,H,V/se],ne=X.length,ce=[...q,V,Z/se],oe=ce.length,de=[G,H,Z/se],me=[{type:6,data:H},{type:6,data:Z},{type:6,data:V}];Ze(m,me),me.push(...W(j,X,ce));let ge=["rank","rank"],fe=d.length>2;fe&&(me.push(...W(d[2].dims)),ge.push("rank")),me.push(...W(de));let xe=Fe=>{let Te=j.length,Oe=Kr("batchDims",d[0].dataType,Te,1),Be=ve(d[0].dataType),_t=P("a",d[0].dataType,ne,se),Et=P("b",d[1].dataType,oe,se),dt=N$1("result",d[0].dataType,de.length,se),Zt=[_t,Et];if(fe){let ut=$?se:1;Zt.push(P("bias",d[2].dataType,d[2].dims.length,ut))}let Ye=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Qe(m,Ye);let bt=ve(dt.type.tensor),Qt=Ke(m,dt.type.value,bt),Vt=gf(se,fe,Qt,[Oe,_t,Et,dt],$);return`
  ${Fe.registerUniforms(Ye).registerInternalVariables(Oe).declareVariables(...Zt,dt)}
  ${Vt}
  ${Q?wo(J,ie,Be,Oe):vo(J,ie,Be,Oe)}
                   `};return{name:"MatMul",shaderCache:{hint:`${J};${m.activation};${Q};${$}`,inputDependencies:ge},getRunData:()=>({outputs:[{dims:I?I(g):g,dataType:d[0].dataType}],dispatchGroup:{x:re[0],y:re[1],z:re[2]},programUniforms:me}),getShaderSource:xe}}}),yf,Hu,Fu=L$1(()=>{ee(),et(),ue(),Tt(),tn(),Wu(),on(),yf=(d,m,g,w,$=!1,I,D=4,F=4,U=4,q="f32")=>{let j=me=>{switch(me){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${q}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${me} is not supported.`)}},G=me=>{switch(me){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${me} is not supported.`)}},H=d?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,V=d?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,Z=d?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",Q=d?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",J=d?"row":"col",ie=d?"col":"row",re=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${d?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${J} / outWidth;
    let outCol = ${J} % outWidth;

    let WRow = ${ie} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${ie} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${ie} % inChannels;
    var resData = ${Ae(D,q)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${Z} && xCol >= 0 && xCol < ${Q}) {
      ${H}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${j(D)}
    }
    return resData;`,se=d?m&&w?`
    let col = colIn * ${D};
    ${re}`:`
    let col = colIn * ${D};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${re}
    }
    return ${Ae(D,q)}(0.0);`:w&&g?`
    let col = colIn * ${D};
    ${re}`:`
    let col = colIn * ${D};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${re}
    }
    return ${Ae(D,q)}(0.0);`,X=d?w&&g?G(F):`
    let col = colIn * ${F};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${G(F)}
    }
    return ${Ae(F,q)}(0.0);`:`
    let col = colIn * ${F};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${G(F)}
    }
    return ${Ae(F,q)}(0.0);`,ne=Ae(U,q),ce=Ae(d?D:F,q),oe=Ae(d?F:D,q),de=Ke(I,ne,q);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${ce} {
      ${d?se:X}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${oe} {
      ${d?X:se}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${ne}) {
      let col = colIn * ${U};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${d?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${V}
      ${Vu($)}
      ${de}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},Hu=(d,m,g,w,$,I,D,F,U)=>{let q=m.format==="NHWC",j=q?d[0].dims[3]:d[0].dims[1],G=g[0],H=q?g[2]:g[3],V=q?g[1]:g[2],Z=q?g[3]:g[1],Q=q&&(j%4===0||j%3===0)&&Z%4===0,J=q?Z:H*V,ie=q?H*V:Z,re=[8,8,1],se=w<=8?[4,1,1]:[4,4,1],X=[Math.ceil(J/re[0]/se[0]),Math.ceil(ie/re[1]/se[1]),Math.ceil(G/re[2]/se[2])];le("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${X}`);let ne=Q?q&&j%4!==0?3:4:1,ce=re[1]*se[1],oe=re[0]*se[0],de=Math.max(re[0]*ne,re[1]),me=w%ce===0,ge=$%oe===0,fe=I%de===0,xe=Q?[ne,4,4]:[1,1,1],Fe=[{type:6,data:w},{type:6,data:$},{type:6,data:I},{type:6,data:[m.pads[0],m.pads[1]]},{type:6,data:m.strides},{type:6,data:m.dilations}];Ze(m,Fe),Fe.push(...W(d[0].dims,d[1].dims));let Te=["rank","rank"];D&&(Fe.push(...W(d[2].dims)),Te.push("rank")),Fe.push(...W(g));let Oe=Be=>{let _t=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Qe(m,_t);let Et=Q?4:1,dt=ve(d[0].dataType),Zt=`
      fn setOutputAtIndex(flatIndex : i32, value : ${Q?`vec4<${dt}>`:dt}) {
        result[flatIndex] = ${Q?`vec4<${dt}>`:dt}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${Q?`vec4<${dt}>`:dt}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${Q?"/ 4":""}, value);
      }`,Ye=P("x",d[0].dataType,d[0].dims.length,ne===3?1:ne),bt=P("w",d[1].dataType,d[1].dims.length,Et),Qt=[Ye,bt],Vt=N$1("result",d[0].dataType,g.length,Et);if(D){let ut=P("bias",d[2].dataType,d[2].dims.length,Et);Qt.push(ut),Zt+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${Q?`vec4<${dt}>`:dt} {
          return bias[coords.${q?"w":"y"}${Q?"/ 4":""}];
        }`}return`
        ${Lu("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${Be.registerUniforms(_t).declareVariables(...Qt,Vt)}
        ${Zt}
        ${yf(q,me,ge,fe,D,m,xe[0],xe[1],xe[2],dt)}
        ${Q?wo(se,re,dt,void 0,!q,de):vo(se,re,dt,void 0,!q,de,!1,void 0,F)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${m.cacheKey};${ne};${Q};${me};${ge};${fe};${ce};${oe};${de}`,inputDependencies:Te},getRunData:()=>({outputs:[{dims:U?U(g):g,dataType:d[0].dataType}],dispatchGroup:{x:X[0],y:X[1],z:X[2]},programUniforms:Fe}),getShaderSource:Oe}}}),bf,qu,an,_f,ju,wf,Ku,Zu,Qu=L$1(()=>{ee(),et(),ae(),ue(),Tt(),tn(),bf=d=>{let m=1;for(let g=0;g<d.length;g++)m*=d[g];return m},qu=d=>typeof d=="number"?[d,d,d]:d,an=(d,m)=>m<=1?d:d+(d-1)*(m-1),_f=(d,m,g,w=1)=>{let $=an(m,w);return Math.floor((d[0]*(g-1)-g+$)/2)},ju=(d,m,g,w,$)=>{$==null&&($=_f(d,m[0],w[0]));let I=[0,0,0,g];for(let D=0;D<3;D++)d[D]+2*$>=m[D]&&(I[D]=Math.trunc((d[D]-m[D]+2*$)/w[D]+1));return I},wf=(d,m,g,w,$,I,D,F,U,q)=>{let j,G,H,V;if(d==="VALID"&&(d=0),typeof d=="number"){j={top:d,bottom:d,left:d,right:d,front:d,back:d};let Z=ju([m,g,w,1],[F,U,q],1,[$,I,D],d);G=Z[0],H=Z[1],V=Z[2]}else if(Array.isArray(d)){if(!d.every((Q,J,ie)=>Q===ie[0]))throw Error(`Unsupported padding parameter: ${d}`);j={top:d[0],bottom:d[1],left:d[2],right:d[3],front:d[4],back:d[5]};let Z=ju([m,g,w,1],[F,U,q],1,[$,I,D],d[0]);G=Z[0],H=Z[1],V=Z[2]}else if(d==="SAME_UPPER"){G=Math.ceil(m/$),H=Math.ceil(g/I),V=Math.ceil(w/D);let Z=(G-1)*$+F-m,Q=(H-1)*I+U-g,J=(V-1)*D+q-w,ie=Math.floor(Z/2),re=Z-ie,se=Math.floor(Q/2),X=Q-se,ne=Math.floor(J/2),ce=J-ne;j={top:se,bottom:X,left:ne,right:ce,front:ie,back:re}}else throw Error(`Unknown padding parameter: ${d}`);return{padInfo:j,outDepth:G,outHeight:H,outWidth:V}},Ku=(d,m,g,w,$,I=!1,D="channelsLast")=>{let F,U,q,j,G;if(D==="channelsLast")[F,U,q,j,G]=d;else if(D==="channelsFirst")[F,G,U,q,j]=d;else throw new Error(`Unknown dataFormat ${D}`);let[H,,V,Z,Q]=m,[J,ie,re]=qu(g),[se,X,ne]=qu(w),ce=an(V,se),oe=an(Z,X),de=an(Q,ne),{padInfo:me,outDepth:ge,outHeight:fe,outWidth:xe}=wf($,U,q,j,J,ie,re,ce,oe,de),Fe=I?H*G:H,Te=[0,0,0,0,0];return D==="channelsFirst"?Te=[F,Fe,ge,fe,xe]:D==="channelsLast"&&(Te=[F,ge,fe,xe,Fe]),{batchSize:F,dataFormat:D,inDepth:U,inHeight:q,inWidth:j,inChannels:G,outDepth:ge,outHeight:fe,outWidth:xe,outChannels:Fe,padInfo:me,strideDepth:J,strideHeight:ie,strideWidth:re,filterDepth:V,filterHeight:Z,filterWidth:Q,effectiveFilterDepth:ce,effectiveFilterHeight:oe,effectiveFilterWidth:de,dilationDepth:se,dilationHeight:X,dilationWidth:ne,inShape:d,outShape:Te,filterShape:m}},Zu=(d,m,g,w,$,I)=>{let D=I==="channelsLast";D?d[0].dims[3]:d[0].dims[1];let F=[64,1,1],U={x:g.map((J,ie)=>ie)},q=[Math.ceil(bf(U.x.map(J=>g[J]))/F[0]),1,1];le("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${q}`);let j=1,G=E$1.size(g),H=[{type:12,data:G},{type:12,data:w},{type:12,data:$},{type:12,data:m.strides},{type:12,data:m.dilations}];Ze(m,H),H.push(...W(d[0].dims,d[1].dims));let V=["rank","rank"],Z=d.length===3;Z&&(H.push(...W(d[2].dims)),V.push("rank")),H.push(...W(g));let Q=J=>{let ie=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:w.length},{name:"pads",type:"u32",length:$.length},{name:"strides",type:"u32",length:m.strides.length},{name:"dilations",type:"u32",length:m.dilations.length}];Qe(m,ie);let re=1,se=ve(d[0].dataType),X=P("x",d[0].dataType,d[0].dims.length,j),ne=P("W",d[1].dataType,d[1].dims.length,re),ce=[X,ne],oe=N$1("result",d[0].dataType,g.length,re),de="";if(Z){let fe=P("bias",d[2].dataType,d[2].dims.length,re);ce.push(fe),de+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${se} {
          return bias[${D?K("coords",4,5):K("coords",1,5)}];
        }`}let me=Ae(j,se),ge=Ke(m,me,se);return`
            ${de}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${X.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${ne.getByIndices("aIndices")};
            }
          ${J.registerUniforms(ie).declareVariables(...ce,oe)}
          ${J.mainStart()}
          ${J.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${oe.offsetToIndices("global_idx")};
              let batch = ${K("coords",0,X.rank)};
              let d2 = ${D?K("coords",X.rank-1,X.rank):K("coords",1,X.rank)};
              let xFRCCorner = vec3<u32>(${D?K("coords",1,X.rank):K("coords",2,X.rank)},
              ${D?K("coords",2,X.rank):K("coords",3,X.rank)},
              ${D?K("coords",3,X.rank):K("coords",4,X.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${D?K("uniforms.x_shape",1,X.rank):K("uniforms.x_shape",2,X.rank)};
              let xShapeZ = ${D?K("uniforms.x_shape",2,X.rank):K("uniforms.x_shape",3,X.rank)};
              let xShapeW = ${D?K("uniforms.x_shape",3,X.rank):K("uniforms.x_shape",4,X.rank)};
              let xShapeU = ${D?K("uniforms.x_shape",4,X.rank):K("uniforms.x_shape",1,X.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${D?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${D?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${D?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${D?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${Z?"value = value + getBiasByOutputCoords(coords)":""};
              ${ge}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${m.cacheKey};${D};${j};${Z}`,inputDependencies:V},getRunData:()=>({outputs:[{dims:g,dataType:d[0].dataType}],dispatchGroup:{x:q[0],y:q[1],z:q[2]},programUniforms:H}),getShaderSource:Q}}}),Yu,Xu,Ju=L$1(()=>{ee(),ae(),ue(),Tt(),Yu=(d,m,g,w)=>{let $=d.length>2,I=$?"value += b[output_channel];":"",D=d[0].dims,F=d[1].dims,U=m.format==="NHWC",q=U?g[3]:g[1],j=q/m.group,G=U&&j>=4?he(q):1,H=E$1.size(g)/G,V=[{type:12,data:H},{type:12,data:m.dilations},{type:12,data:[m.strides[0],m.strides[1]]},{type:12,data:[m.pads[0],m.pads[1]]},{type:12,data:j}];Ze(m,V),V.push(...W(D,[F[0],F[1],F[2],F[3]/G]));let Z=$?["rank","rank","rank"]:["rank","rank"];V.push(...W([g[0],g[1],g[2],g[3]/G]));let Q=J=>{let ie=N$1("output",d[0].dataType,g.length,G),re=ve(ie.type.tensor),se=Ke(m,ie.type.value,re),X=P("x",d[0].dataType,D.length),ne=P("w",d[1].dataType,F.length,G),ce=[X,ne];$&&ce.push(P("b",d[2].dataType,d[2].dims,G));let oe=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:m.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Qe(m,oe);let de=U?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${X.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${ne.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${X.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${ne.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${J.registerUniforms(oe).declareVariables(...ce,ie)}

  ${J.mainStart()}
    ${J.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${ie.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${U?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${U?1:2}], outputIndices[${U?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${G} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${U?2:1}];

    var value: ${ie.type.value} = ${ie.type.value}(0);
    ${de}
    ${I}
    ${se}
    ${ie.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${m.cacheKey}_${G}`,inputDependencies:Z},getRunData:()=>({outputs:[{dims:w?w(g):g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(H/64)},programUniforms:V}),getShaderSource:Q}},Xu=(d,m,g,w)=>{let $=d.length>2,I=he(g[3]),D=he(g[2]),F=E$1.size(g)/I/D,U=[d[0].dims[0],d[0].dims[1],d[0].dims[2],d[0].dims[3]/I],q=[d[1].dims[0],d[1].dims[1],d[1].dims[2],d[1].dims[3]/I],j=[g[0],g[1],g[2],g[3]/I],G=[{type:12,data:F},{type:6,data:[m.strides[0],m.strides[1]]},{type:6,data:[m.pads[0],m.pads[1]]}];Ze(m,G),G.push(...W(U,q,j));let H=(D-1)*m.strides[1]+q[1],V=Z=>{let Q=N$1("output",d[0].dataType,j.length,I),J=ve(Q.type.tensor),ie=Ke(m,Q.type.value,J),re=P("x",d[0].dataType,U.length,I),se=P("w",d[1].dataType,q.length,I),X=[re,se];$&&X.push(P("b",d[2].dataType,d[2].dims,I));let ne=$?"value += b[output_channel];":"",ce=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Qe(m,ce),`
  ${Z.registerUniforms(ce).declareVariables(...X,Q)}
  ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${D}u;
    let col = (index1 % width1) * ${D}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${re.type.value}, ${H}>;
    var values: array<${Q.type.value}, ${D}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${q[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${H}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${re.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${re.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${q[1]}; w_width++) {
          let w_val = ${se.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${D}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${D}u; i++) {
      var value = values[i];
      ${ne}
      ${ie}
      ${Q.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${m.cacheKey};${I};${D};${H};${q[0]};${q[1]}`,inputDependencies:$?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:w?w(g):g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(F/64)},programUniforms:G}),getShaderSource:V}}}),vf,$o,$f,xo,So,el,xf,Sf,To,tl=L$1(()=>{ae(),Fu(),Qu(),on(),Ju(),Tt(),nn(),ct(),vf=(d,m,g,w,$,I)=>{let D=d[0],F=d.slice(I?1:2,I?3:4),U=F.length,q=m[0],j=m.slice(2).map((H,V)=>H+(H-1)*(g[V]-1)),G=F.map((H,V)=>H+w[V]+w[V+U]).map((H,V)=>Math.floor((H-j[V]+$[V])/$[V]));return G.splice(0,0,D),G.splice(I?3:1,0,q),G},$o=[2,3,1,0],$f=(d,m)=>{if(!d||d.length!==2&&d.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(d[0].dims.length>5)throw new Error("greater than 5D is not supported");if(d[0].dims.length!==d[1].dims.length)throw new Error("filter does not have same dimension as input");let g=d[0].dims[m.format==="NHWC"?d[0].dims.length-1:1],w=d[1].dims[1]*m.group;if(g!==w)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(d.length===3&&(d[2].dims.length!==1||d[1].dims[0]!==d[2].dims[0]))throw new Error("invalid bias");let $=d[0].dims.length-2;if(m.dilations.length!==$)throw new Error(`dilations should be ${$}D`);if(m.strides.length!==$)throw new Error(`strides should be ${$}D`);if(m.pads.length!==$*2)throw new Error(`pads should be ${$*2}D`);if(m.kernelShape.length!==0&&m.kernelShape.length!==d[1].dims.length-2)throw new Error("invalid kernel shape")},xo=(d,m)=>{let g=d.kernelShape.slice();g.length<m[1].dims.length-2&&g.push(...Array(m[1].dims.length-2-g.length).fill(0));for(let I=2;I<m[1].dims.length;++I)g[I-2]===0&&(g[I-2]=m[1].dims[I]);let w=d.pads.slice();Dt.adjustPadsBasedOnAutoPad(m[0].dims,d.strides,d.dilations,g,w,d.format==="NHWC",d.autoPad);let $=Object.assign({},d);return Object.assign($,{kernelShape:g,pads:w}),$},So=d=>{let m=en(d),g=d.format,w=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][d.auto_pad],$=d.dilations,I=d.group,D=d.kernel_shape,F=d.pads,U=d.strides,q=d.w_is_const();return{autoPad:w,format:g,dilations:$,group:I,kernelShape:D,pads:F,strides:U,wIsConst:q,...m,cacheKey:`${d.format};${m.activation};`}},el=(d,m,g,w)=>{let $=g.format==="NHWC",I=vf(m[0].dims,m[1].dims,g.dilations,g.pads,g.strides,$);if(g.group!==1){let ce=[m[0]];if($){let oe=d.kernelCustomData.wT??d.compute(Pe(m[1],$o),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=oe),ce.push(oe)}else ce.push(m[1]);m.length===3&&ce.push(m[2]),!d.adapterInfo.isArchitecture("ampere")&&$&&m[1].dims[0]===g.group&&m[1].dims[1]===1&&g.dilations[0]===1&&g.dilations[1]===1?d.compute(Xu(ce,g,I,w),{inputs:ce}):d.compute(Yu(ce,g,I,w),{inputs:ce});return}let D=m.length===3,F=m[0].dims[$?1:2],U=m[0].dims[$?2:3],q=m[0].dims[$?3:1],j=m[1].dims[2],G=m[1].dims[3],H=I[$?1:2],V=I[$?2:3],Z=I[$?3:1],Q=$&&j===F&&G===U&&g.pads[0]===0&&g.pads[1]===0;if(Q||j===1&&G===1&&g.dilations[0]===1&&g.dilations[1]===1&&g.strides[0]===1&&g.strides[1]===1&&g.pads[0]===0&&g.pads[1]===0){let ce=I[0],oe,de,me,ge=[];if($){let Fe=d.kernelCustomData.wT??d.compute(Pe(m[1],$o),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];if(g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=Fe),Q){let Te=F*U*q;oe=m[0].reshape([1,ce,Te]),de=Fe.reshape([1,Te,Z]),me=[1,ce,Z]}else oe=m[0].reshape([ce,F*U,q]),de=Fe.reshape([1,q,Z]),me=[ce,H*V,Z];ge.push(oe),ge.push(de)}else oe=m[0].reshape([ce,q,F*U]),de=m[1].reshape([1,Z,q]),me=[ce,Z,H*V],ge.push(de),ge.push(oe);D&&ge.push(m[2]);let fe=me[2],xe=ge[0].dims[ge[0].dims.length-1];fe<8&&xe<8?d.compute(rn(ge,g,I,me,$,w),{inputs:ge}):d.compute(ar(ge,g,I,me,$,w),{inputs:ge});return}let J=!0,ie=d.kernelCustomData.wT??d.compute(Pe(m[1],$o),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=ie);let re=[m[0],ie];D&&re.push(m[2]);let se=$?H*V:Z,X=$?Z:H*V,ne=j*G*q;d.compute(Hu(re,g,I,se,X,ne,D,J,w),{inputs:re})},xf=(d,m)=>{let g=m.format==="NHWC",w=[d.inputs[0].reshape(g?[d.inputs[0].dims[0],1,d.inputs[0].dims[1],d.inputs[0].dims[2]]:[d.inputs[0].dims[0],d.inputs[0].dims[1],1,d.inputs[0].dims[2]]),d.inputs[1].reshape([d.inputs[1].dims[0],d.inputs[1].dims[1],1,d.inputs[1].dims[2]])];d.inputs.length===3&&w.push(d.inputs[2]);let $=[0,m.pads[0],0,m.pads[1]],I=[1].concat(m.strides),D=[1].concat(m.dilations),F=[1].concat(m.kernelShape),U=xo({...m,pads:$,strides:I,dilations:D,kernelShape:F},w);el(d,w,U,q=>g?[q[0],q[2],q[3]]:[q[0],q[1],q[3]])},Sf=(d,m,g)=>{let w=g.format==="NHWC"?"channelsLast":"channelsFirst",$=xo(g,m),I=g.autoPad==="NOTSET"?g.pads:g.autoPad,D=Ku(m[0].dims,m[1].dims,g.strides,g.dilations,I,!1,w);d.compute(Zu(m,$,D.outShape,[D.filterDepth,D.filterHeight,D.filterWidth],[D.padInfo.front,D.padInfo.top,D.padInfo.left],w))},To=(d,m)=>{if($f(d.inputs,m),d.inputs[0].dims.length===3)xf(d,m);else if(d.inputs[0].dims.length===5)Sf(d,d.inputs,m);else{let g=xo(m,d.inputs);el(d,d.inputs,g)}}}),rl,nl=L$1(()=>{ee(),et(),ae(),ue(),rl=(d,m,g)=>{let w=d.length>2,$=m.outputShape,I=m.format==="NHWC",D=m.group,F=d[1].dims,U=F[2]/D,q=F[3],j=I?he(U):1,G=I&&q===1&&U>=4,H=G?Math.floor(U/4)*4:Math.floor(U/j)*j,V=U-H,Z=I?he(q):1,Q=I?q===1?j:Z:1,J=E$1.size($)/Z,ie=[Math.ceil(J/64),1,1];le("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${ie}`);let re=["rank","rank"],se=[m.strides[0],m.strides[1]],X=[m.kernelShape[I?1:2],m.kernelShape[I?2:3]],ne=[m.dilations[0],m.dilations[1]],ce=[X[0]+(m.dilations[0]<=1?0:(m.kernelShape[I?1:2]-1)*(m.dilations[0]-1)),X[1]+(m.dilations[1]<=1?0:(m.kernelShape[I?2:3]-1)*(m.dilations[1]-1))],oe=[ce[0]-1-Math.floor((m.pads[0]+m.pads[2])/2),ce[1]-1-Math.floor((m.pads[1]+m.pads[3])/2)],de=[{type:12,data:J},{type:12,data:se},{type:12,data:X},{type:12,data:ne},{type:12,data:ce},{type:6,data:oe},{type:12,data:H},{type:12,data:U},{type:12,data:q},...W(d[0].dims,d[1].dims)];w&&(de.push(...W(d[2].dims)),re.push("rank")),de.push(...W($));let me=ge=>{let fe=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:se.length},{name:"filter_dims",type:"u32",length:X.length},{name:"dilations",type:"u32",length:X.length},{name:"effective_filter_dims",type:"u32",length:ce.length},{name:"pads",type:"i32",length:oe.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],xe=ve(d[0].dataType),Fe=I?1:2,Te=I?2:3,Oe=I?3:1,Be=P("W",d[1].dataType,d[1].dims.length,Q),_t=P("Dy",d[0].dataType,d[0].dims.length,j),Et=[_t,Be];w&&Et.push(P("bias",d[2].dataType,[$[Oe]].length,Z));let dt=N$1("result",d[0].dataType,$.length,Z),Zt=()=>{let Qt="";if(G)j===4?Qt+=`
        let xValue = ${_t.getByOffset("x_offset")};
        let wValue = ${Be.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:j===2?Qt+=`
          dotProd = dotProd + dot(vec4<${xe}>(${_t.getByOffset("x_offset")}, ${_t.getByOffset("x_offset + 1u")}), vec4<${xe}>(${Be.getByOffset("w_offset")}, ${Be.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:j===1&&(Qt+=`
          dotProd = dotProd + dot(vec4<${xe}>(${_t.getByOffset("x_offset")}, ${_t.getByOffset("x_offset + 1u")}, ${_t.getByOffset("x_offset + 2u")}, ${_t.getByOffset("x_offset + 3u")}), vec4<${xe}>(${Be.getByOffset("w_offset")}, ${Be.getByOffset("w_offset + 1u")}, ${Be.getByOffset("w_offset + 2u")}, ${Be.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(Qt+=`
                  let xValue = ${I?_t.getByOffset(`${_t.indicesToOffset(`${_t.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${j}`):_t.get("batch","inputChannel","idyR","idyC")};
        `,j===1)Qt+=`
          let w_offset = ${Be.indicesToOffset(`${Be.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${Be.getByOffset(`w_offset / ${Q}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let Vt=0;Vt<j;Vt++)Qt+=`
            let wValue${Vt} = ${Be.getByOffset(`${Be.indicesToOffset(`${Be.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${Vt}, wOutChannel)`)} / ${Q}`)};
            dotProd = dotProd + xValue[${Vt}] * wValue${Vt};`;return Qt},Ye=()=>{if(V===0)return"";if(!G)throw new Error(`packInputAs4 ${G} is not true.`);let Qt="";if(j===1){Qt+="dotProd = dotProd";for(let Vt=0;Vt<V;Vt++)Qt+=`
            + ${_t.getByOffset(`x_offset + ${Vt}`)} * ${Be.getByOffset(`w_offset + ${Vt}`)}`;Qt+=";"}else if(j===2){if(V!==2)throw new Error(`Invalid inputChannelsRemainder ${V}.`);Qt+=`
          let xValue = ${_t.getByOffset("x_offset")};
          let wValue = ${Be.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return Qt},bt=`
            let outputIndices = ${dt.offsetToIndices(`global_idx * ${Z}`)};
            let batch = ${dt.indicesGet("outputIndices",0)};
            let d1 = ${dt.indicesGet("outputIndices",Oe)};
            let r = ${dt.indicesGet("outputIndices",Fe)};
            let c = ${dt.indicesGet("outputIndices",Te)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${dt.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${xe}(dyRCorner) + ${xe}(wR)) / ${xe}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${xe}(uniforms.Dy_shape[${Fe}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${xe}(dyCCorner) + ${xe}(wC)) / ${xe}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${xe}(uniforms.Dy_shape[${Te}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${G?`
                var x_offset = ${_t.indicesToOffset(`${_t.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${j};
                var w_offset = ${Be.indicesToOffset(`${Be.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${Q};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${G?4:j}) {
                  ${Zt()}
                  inputChannel = inputChannel + ${G?4:j};
                }
                ${Ye()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${w?` + bias[d1 / ${Z}]`:""};
            ${dt.setByOffset("global_idx","value")};
          `;return`
    ${ge.registerUniforms(fe).declareVariables(...Et,dt)}
      ${ge.mainStart()}
      ${ge.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${bt}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${m.cacheKey};${j}${Q}${Z}${G}${V}`,inputDependencies:re},getRunData:()=>({dispatchGroup:{x:ie[0],y:ie[1],z:ie[2]},outputs:[{dims:g?g($):$,dataType:d[0].dataType}],programUniforms:de}),getShaderSource:me}}}),Tf,Cf,If,ol,il,Af,al,Ef,sl,ul=L$1(()=>{nl(),Tt(),ct(),Tf=(d,m,g,w,$,I)=>(d-1)*m+g+(w-1)*$+1-I,Cf=(d,m,g,w,$)=>{let I=Math.floor(d/2);m==="SAME_UPPER"?(g[w]=I,g[$]=d-I):m==="SAME_LOWER"&&(g[w]=d-I,g[$]=I)},If=(d,m,g,w,$,I,D,F,U,q)=>{let j=d.length-2,G=q.length===0;U.length<j&&U.push(...Array(j-U.length).fill(0));let H=d[0],V=m[F?3:1]*$;for(let Z=0,Q=d.length-j-(F?1:0);Z<j;++Z,++Q){let J=d[Q],ie=G?J*D[Z]:q[Z],re=Tf(J,D[Z],I[Z],m[Q],g[Z],ie);Cf(re,w,I,Z,Z+j),G&&q.push(D[Z]*(J-1)+U[Z]+(m[Q]-1)*g[Z]+1-I[Z]-I[Z+j])}q.splice(0,0,H),q.splice(F?3:1,0,V)},ol=(d,m)=>{let g=d.kernelShape.slice();if(d.kernelShape.length===0||d.kernelShape.reduce((G,H)=>G*H,1)===0){g.length=0;for(let G=2;G<m[1].dims.length;++G)g.push(m[1].dims[G])}let w=d.format==="NHWC";g.splice(0,0,m[1].dims[0]),g.splice(w?3:1,0,m[1].dims[1]);let $=d.pads.slice(),I=d.outputShape.slice(),D=d.outputPadding.slice(),F=m[0].dims,U=d.dilations.slice();if(U.reduce((G,H)=>G+H,0)===0){let G=m[0].dims.length-2;U=new Array(G).fill(1)}let q=d.strides.slice();if(q.reduce((G,H)=>G+H,0)===0){let G=m[0].dims.length-2;q=new Array(G).fill(1)}If(F,g,U,d.autoPad,d.group,$,q,w,D,I);let j=Object.assign({},d);return Object.assign(j,{kernelShape:g,pads:$,outputPadding:D,outputShape:I,dilations:U,strides:q}),j},il=d=>{let m=en(d),g=d.format,w=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof d.autoPad>"u"?0:d.autoPad],$=d.dilations,I=d.group,D=d.kernelShape,F=d.pads,U=d.strides,q=d.wIsConst(),j=d.outputPadding,G=d.outputShape;return{autoPad:w,format:g,dilations:$,group:I,kernelShape:D,outputPadding:j,outputShape:G,pads:F,strides:U,wIsConst:q,...m,cacheKey:`${d.format};${m.activation};`}},Af=(d,m)=>{if(!d||d.length!==2&&d.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(d[0].dims.length!==4&&d[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(d[0].dims.length!==d[1].dims.length)throw new Error("filter does not have same dimension as input");let g=d[0].dims[m.format==="NHWC"?d[0].dims.length-1:1],w=d[1].dims[0];if(g!==w)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let $=d[1].dims[1]*m.group;if(d.length===3&&(d[2].dims.length!==1||d[2].dims[0]!==$))throw new Error("invalid bias");let I=d[0].dims.length-2;if(m.dilations.reduce((D,F)=>D+F,0)>0&&m.dilations.length!==I)throw new Error(`dilations should be ${I}D`);if(m.strides.reduce((D,F)=>D+F,0)>0&&m.strides.length!==I)throw new Error(`strides should be ${I}D`);if(m.pads.reduce((D,F)=>D+F,0)>0&&m.pads.length!==I*2)throw new Error(`pads should be ${I*2}D`);if(m.outputPadding.length!==I&&m.outputPadding.length!==0)throw new Error(`output_padding should be ${I}D`);if(m.kernelShape.reduce((D,F)=>D+F,0)>0&&m.kernelShape.length!==0&&m.kernelShape.length!==d[1].dims.length-2)throw new Error("invalid kernel shape");if(m.outputShape.length!==0&&m.outputShape.length!==d[0].dims.length-2)throw new Error("invalid output shape")},al=(d,m,g,w)=>{let $=d.kernelCustomData.wT??d.compute(Pe(m[1],[2,3,0,1]),{inputs:[1],outputs:[g.wIsConst?-2:-1]})[0];g.wIsConst&&!d.kernelCustomData.wT&&(d.kernelCustomData.wT=$);let I=[m[0],$];m.length===3&&I.push(m[2]),d.compute(rl(I,g,w),{inputs:I})},Ef=(d,m)=>{let g=m.format==="NHWC",w=[d.inputs[0].reshape(g?[d.inputs[0].dims[0],1,d.inputs[0].dims[1],d.inputs[0].dims[2]]:[d.inputs[0].dims[0],d.inputs[0].dims[1],1,d.inputs[0].dims[2]]),d.inputs[1].reshape([d.inputs[1].dims[0],d.inputs[1].dims[1],1,d.inputs[1].dims[2]])];d.inputs.length===3&&w.push(d.inputs[2]);let $=m.kernelShape;($.length===0||$[0]===0)&&($=[d.inputs[1].dims[2]]);let I=m.dilations;(I.length===0||I[0]===0)&&(I=[1]);let D=m.strides;(D.length===0||D[0]===0)&&(D=[1]);let F=m.pads;F.length===0&&(F=[0,0]),F=[0,F[0],0,F[1]],D=[1].concat(D),I=[1].concat(I),$=[1].concat($);let U=m.outputPadding;U=[0].concat(U);let q=ol({...m,pads:F,strides:D,dilations:I,kernelShape:$,outputPadding:U},w);al(d,w,q,j=>g?[j[0],j[2],j[3]]:[j[0],j[1],j[3]])},sl=(d,m)=>{if(Af(d.inputs,m),d.inputs[0].dims.length===3)Ef(d,m);else{let g=ol(m,d.inputs);al(d,d.inputs,g)}}}),kf,ll,dl,cl=L$1(()=>{ee(),ae(),Se(),ue(),kf=(d,m,g,w)=>{let $=E$1.size(m),I=m.length,D=P("input",d,I),F=N$1("output",d,I),U=g.dataType===6?g.getInt32Array()[0]:Number(g.getBigInt64Array()[0]),q=E$1.normalizeAxis(U,I),j=G=>{let H=` i32(${D.indicesGet("inputIndices","uniforms.axis")}) `,V=K("uniforms.input_shape","uniforms.axis",I),Z=w.reverse?H+(w.exclusive?" + 1":""):"0",Q=w.reverse?V:H+(w.exclusive?"":" + 1");return`
                ${G.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(D,F)}
                ${G.mainStart()}
                  ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${F.offsetToIndices("global_idx")};
                  var sum = ${F.type.value}(0);
                  let first : i32 = ${Z};
                  let last : i32 = ${Q};
                  for (var i : i32 = first; i < last; i++) {
                    ${D.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${D.getByIndices("inputIndices")};
                  }
                  ${F.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:w.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:m,dataType:d}],dispatchGroup:{x:Math.ceil($/64)},programUniforms:[{type:12,data:$},{type:12,data:q},...W(m,m)]}),getShaderSource:j}},ll=(d,m)=>{let g=d.inputs[0].dims,w=d.inputs[0].dataType,$=d.inputs[1];d.compute(kf(w,g,$,m),{inputs:[0]})},dl=d=>{let m=d.exclusive===1,g=d.reverse===1;return te({exclusive:m,reverse:g})}}),Pf,Of,zf,pl,ml,fl=L$1(()=>{ee(),ae(),Se(),ue(),Pf=d=>{if(!d||d.length!==1)throw new Error("DepthToSpace requires 1 input.");if(d[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},Of=(d,m,g,w)=>{let $=[];$.push(`fn perm(i: ${w.type.indices}) -> ${g.type.indices} {
    var a: ${g.type.indices};`);for(let I=0;I<m;++I)$.push(g.indicesSet("a",d[I],`i[${I}]`));return $.push("return a;}"),$.join(`
`)},zf=(d,m)=>{let g,w,$,I,D,F,U=m.format==="NHWC",q=m.blocksize,j=m.mode==="DCR";U?([g,w,$,I]=d.dims,D=j?[g,w,$,q,q,I/q**2]:[g,w,$,I/q**2,q,q],F=j?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([g,w,$,I]=[d.dims[0],d.dims[2],d.dims[3],d.dims[1]],D=j?[g,q,q,I/q**2,w,$]:[g,I/q**2,q,q,w,$],F=j?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let G=d.reshape(D),H=G.dims.length,V=d.dataType,Z=P("a",V,H),Q=N$1("output",V,H),J=ie=>`
  ${ie.registerUniform("output_size","u32").declareVariables(Z,Q)}

  ${Of(F,H,Z,Q)}

  ${ie.mainStart()}
    ${ie.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${Q.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${Q.setByOffset("global_idx",Z.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${d.dims};${m.blocksize};${m.mode}`,inputDependencies:["rank"]},getRunData:ie=>{let re=U?[g,w*q,$*q,I/q**2]:[g,I/q**2,w*q,$*q],se=E$1.size(re),X=G.dims,ne=E$1.sortBasedOnPerm(X,F);return{outputs:[{dims:re,dataType:ie[0].dataType}],dispatchGroup:{x:Math.ceil(se/64)},programUniforms:[{type:12,data:se},...W(X,ne)]}},getShaderSource:J}},pl=(d,m)=>{Pf(d.inputs),d.compute(zf(d.inputs[0],m))},ml=d=>te({blocksize:d.blocksize,mode:d.mode,format:d.format})}),Co,sn,hl,Df,Bf,Io,Ao,gl,Mf,yl,bl,_l=L$1(()=>{ee(),ae(),Se(),ue(),Co="[a-zA-Z]|\\.\\.\\.",sn="("+Co+")+",hl="^"+sn+"$",Df="("+sn+",)*"+sn,Bf="^"+Df+"$",Io=class{constructor(d=-1){this.symbolToIndices=new Map,this.inputIndex=d}addSymbol(d,m){let g=this.symbolToIndices.get(d);g===void 0?g=[m]:g.push(m),this.symbolToIndices.set(d,g)}},Ao=class{constructor(d,m){this.equation=m,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[g,w]=m.includes("->")?m.split("->",2):[m,""];if(!g.match(RegExp(Bf)))throw new Error("Invalid LHS term");if(g.split(",").forEach(($,I)=>{let D=d[I].dims.slice();if(!$.match(RegExp(hl)))throw new Error("Invalid LHS term");let F=this.processTerm($,!0,D,I);this.lhs.push(F)}),w==="")w+=[...this.symbolToInfo.entries()].filter(([$,I])=>I.count===1||$==="...").map(([$])=>$).join("");else if(!w.match(RegExp(sn)))throw new Error("Invalid RHS");w.match(RegExp(Co,"g"))?.forEach($=>{if($==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let I=this.symbolToInfo.get($);if(I===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(I.dimValue)}}),this.rhs=this.processTerm(w,!1,this.outputDims)}addSymbol(d,m,g){let w=this.symbolToInfo.get(d);if(w!==void 0){if(w.dimValue!==m&&w.count!==1)throw new Error("Dimension mismatch");w.count++,w.inputIndices.push(g)}else w={count:1,dimValue:m,inputIndices:[g]};this.symbolToInfo.set(d,w)}processTerm(d,m,g,w=-1){let $=g.length,I=!1,D=[],F=0;if(!d.match(RegExp(hl))&&!m&&d!=="")throw new Error("Invalid LHS term");let U=d.match(RegExp(Co,"g")),q=new Io(w);return U?.forEach((j,G)=>{if(j==="..."){if(I)throw new Error("Only one ellipsis is allowed per input term");I=!0;let H=$-U.length+1;if(H<0)throw new Error("Ellipsis out of bounds");if(D=g.slice(F,F+H),this.hasEllipsis){if(this.ellipsisDims.length!==D.length||this.ellipsisDims.toString()!==D.toString())throw new Error("Ellipsis dimensions mismatch")}else if(m)this.hasEllipsis=!0,this.ellipsisDims=D;else throw new Error("Ellipsis must be specified in the LHS");for(let V=0;V<D.length;V++){let Z=String.fromCharCode(48+V);q.addSymbol(Z,G+V),this.addSymbol(Z,g[F++],w)}}else q.addSymbol(j,G+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(j,g[F++],w)}),q}},gl=d=>d+"_max",Mf=(d,m,g,w)=>{let $=d.map(q=>q.length).map((q,j)=>P(`input${j}`,m,q)),I=E$1.size(w),D=N$1("output",m,w.length),F=[...g.symbolToInfo.keys()].filter(q=>!g.rhs.symbolToIndices.has(q)),U=q=>{let j=[],G="var prod = 1.0;",H="var sum = 0.0;",V="sum += prod;",Z=[],Q=[],J=[],ie=[],re=g.symbolToInfo.size===g.rhs.symbolToIndices.size;g.symbolToInfo.forEach((X,ne)=>{if(g.rhs.symbolToIndices.has(ne)){let ce=g.rhs.symbolToIndices.get(ne)?.[0];ce!==void 0&&g.lhs.forEach((oe,de)=>{if(X.inputIndices.includes(de)){let me=oe.symbolToIndices.get(ne);if(me===void 0)throw new Error("Invalid symbol error");me.forEach(ge=>{j.push(`${$[de].indicesSet(`input${de}Indices`,ge,D.indicesGet("outputIndices",ce))}`)})}})}else g.lhs.forEach((ce,oe)=>{if(X.inputIndices.includes(oe)){let de=ce.symbolToIndices.get(ne);if(de===void 0)throw new Error("Invalid symbol error");de.forEach(me=>{Z.push(`${$[oe].indicesSet(`input${oe}Indices`,me,`${ne}`)}`)}),ie.push(`prod *= ${$[oe].getByIndices(`input${oe}Indices`)};`)}}),Q.push(`for(var ${ne}: u32 = 0; ${ne} < uniforms.${gl(ne)}; ${ne}++) {`),J.push("}")});let se=re?[...j,`let sum = ${$.map((X,ne)=>X.getByIndices(`input${ne}Indices`)).join(" * ")};`]:[...j,H,...Q,...Z,G,...ie,V,...J];return`
            ${q.registerUniforms(F.map(X=>({name:`${gl(X)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...$,D)}

            ${q.mainStart()}
            ${q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${D.offsetToIndices("global_idx")};
            ${$.map((X,ne)=>`var input${ne}Indices: ${$[ne].type.indices};`).join(`
`)}
            ${se.join(`
`)};
            ${D.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:g.equation,inputDependencies:d.map(()=>"rank")},getRunData:()=>{let q=F.filter(G=>g.symbolToInfo.has(G)).map(G=>({type:12,data:g.symbolToInfo.get(G)?.dimValue||0}));q.push({type:12,data:I});let j=d.map((G,H)=>[...W(G)]).reduce((G,H)=>G.concat(H),q);return j.push(...W(w)),{outputs:[{dims:w,dataType:m}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:j}},getShaderSource:U}},yl=(d,m)=>{let g=new Ao(d.inputs,m.equation),w=g.outputDims,$=d.inputs.map((I,D)=>I.dims);d.compute(Mf($,d.inputs[0].dataType,g,w))},bl=d=>{let m=d.equation.replace(/\s+/g,"");return te({equation:m})}}),Rf,wl,Uf,Nf,vl,$l=L$1(()=>{ee(),ae(),ue(),Rf=d=>{if(!d||d.length!==2)throw new Error("Expand requires 2 input.");let m=d[0].dims,g=Array.from(d[1].getBigInt64Array(),Number),w=g.length<m.length?0:g.length-m.length,$=m.length<g.length?0:m.length-g.length;for(;w<g.length&&$<m.length;++w,++$)if(g[w]!==m[$]&&g[w]!==1&&m[$]!==1)throw new Error("Expand requires shape to be broadcastable to input")},wl=(d,m)=>{let g=d.length-m.length,w=[];for(let $=0;$<g;++$)w.push(d[$]);for(let $=0;$<m.length;++$)w.push(m[$]===1?d[$+g]:m[$]);return w},Uf=(d,m)=>d.length>m.length?wl(d,m):wl(m,d),Nf=d=>{let m=d[0].dims,g=Array.from(d[1].getBigInt64Array(),Number),w=Uf(m,g),$=d[0].dataType,I=$===9||E$1.size(m)===1,D=$===9||m.length>0&&m[m.length-1]%4===0?4:1,F=I||w.length>0&&w[w.length-1]%4===0?4:1,U=Math.ceil(E$1.size(w)/F),q=G=>{let H=P("input",$,m.length,D),V=N$1("output",$,w.length,F),Z;if($===9){let Q=(J,ie,re="")=>`
          let outputIndices${ie} = ${V.offsetToIndices(`outputOffset + ${ie}u`)};
          let offset${ie} = ${H.broadcastedIndicesToOffset(`outputIndices${ie}`,V)};
          let index${ie} = offset${ie} / 4u;
          let component${ie} = offset${ie} % 4u;
          ${J}[${ie}] = ${re}(${H.getByOffset(`index${ie}`)}[component${ie}]);
        `;Z=`
        let outputOffset = global_idx * ${F};
        var data = vec4<u32>(0);
        ${Q("data",0,"u32")}
        ${Q("data",1,"u32")}
        ${Q("data",2,"u32")}
        ${Q("data",3,"u32")}
        ${V.setByOffset("global_idx","data")}
      }`}else Z=`
        let outputIndices = ${V.offsetToIndices(`global_idx * ${F}`)};
        let inputOffset = ${H.broadcastedIndicesToOffset("outputIndices",V)};
        let data = ${V.type.value}(${H.getByOffset(`inputOffset / ${D}`)});
        ${V.setByOffset("global_idx","data")}
      }`;return`
    ${G.registerUniform("vec_size","u32").declareVariables(H,V)}
    ${G.mainStart()}
    ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${Z}`},j=[{type:12,data:U},...W(m,w)];return{name:"Expand",shaderCache:{hint:`${w.length};${D}${F}`,inputDependencies:["rank"]},getShaderSource:q,getRunData:()=>({outputs:[{dims:w,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(U/64)},programUniforms:j})}},vl=d=>{Rf(d.inputs),d.compute(Nf(d.inputs),{inputs:[0]})}}),Vf,xl,Sl=L$1(()=>{ee(),ae(),ue(),Jr(),Vf=d=>{let m=d[0].dataType,g=E$1.size(d[0].dims),w=E$1.size(d[1].dims),$=w%4===0,I=D=>{let F=P("x",m,[1],4),U=P("bias",m,[1],4),q=N$1("y",m,[1],4),j=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],G=V=>`
      let bias${V}_offset: u32 = (global_idx * 4 + ${V}) % uniforms.bias_size;
      let bias${V} = ${U.getByOffset(`bias${V}_offset / 4`)}[bias${V}_offset % 4];`,H=$?`
      let bias = ${U.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${G(0)}${G(1)}${G(2)}${G(3)}
      let bias = ${F.type.value}(bias0, bias1, bias2, bias3);`;return`${D.registerUniforms(j).declareVariables(F,U,q)}

    ${bo(ke(m))}

    ${D.mainStart(Bt)}
      ${D.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${F.getByOffset("global_idx")};
      ${H}
      let x_in = x + bias;
      ${q.setByOffset("global_idx",_o("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${$}`,inputDependencies:["type","type"]},getShaderSource:I,getRunData:D=>({outputs:[{dims:D[0].dims,dataType:D[0].dataType}],programUniforms:[{type:12,data:Math.ceil(g/4)},{type:12,data:w}],dispatchGroup:{x:Math.ceil(g/Bt/4)}})}},xl=d=>{d.inputs.length<2||E$1.size(d.inputs[1].dims)===0?_u(d):d.compute(Vf(d.inputs))}}),Lf,Wf,Tl,Cl,Il=L$1(()=>{ee(),ae(),Se(),ue(),Lf=d=>{if(!d||d.length!==2)throw new Error("Gather requires 2 inputs.")},Wf=(d,m)=>{let g=d[0].dims,w=d[1].dims,$=g.length,I=E$1.normalizeAxis(m.axis,$),D=g.slice(0);D.splice(I,1,...w);let F=g[I],U=d[0].dataType===9?4:1,q=Math.ceil(E$1.size(D)/U),j=[{type:12,data:q},{type:6,data:F},{type:12,data:I},...W(d[0].dims,d[1].dims,D)],G=H=>{let V=P("data",d[0].dataType,d[0].dims.length,U),Z=P("inputIndices",d[1].dataType,d[1].dims.length),Q=N$1("output",d[0].dataType,D.length,U),J=re=>{let se=w.length,X=`var indicesIndices${re}  = ${Z.type.indices}(0);`;for(let ne=0;ne<se;ne++)X+=`${se>1?`indicesIndices${re}[${ne}]`:`indicesIndices${re}`} = ${D.length>1?`outputIndices${re}[uniforms.axis + ${ne}]`:`outputIndices${re}`};`;X+=`
          var idx${re} = ${Z.getByIndices(`indicesIndices${re}`)};
          if (idx${re} < 0) {
            idx${re} = idx${re} + uniforms.axisDimLimit;
          }
          var dataIndices${re} : ${V.type.indices};
        `;for(let ne=0,ce=0;ne<$;ne++)ne===I?(X+=`${$>1?`dataIndices${re}[${ne}]`:`dataIndices${re}`} = u32(idx${re});`,ce+=se):(X+=`${$>1?`dataIndices${re}[${ne}]`:`dataIndices${re}`} = ${D.length>1?`outputIndices${re}[${ce}]`:`outputIndices${re}`};`,ce++);return X},ie;if(d[0].dataType===9){let re=(se,X,ne="")=>`
          let outputIndices${X} = ${Q.offsetToIndices(`outputOffset + ${X}u`)};
          ${J(X)};
          let offset${X} = ${V.indicesToOffset(`dataIndices${X}`)};
          let index${X} = offset${X} / 4u;
          let component${X} = offset${X} % 4u;
          ${se}[${X}] = ${ne}(${V.getByOffset(`index${X}`)}[component${X}]);
        `;ie=`
        let outputOffset = global_idx * ${U};
        var value = vec4<u32>(0);
        ${re("value",0,"u32")}
        ${re("value",1,"u32")}
        ${re("value",2,"u32")}
        ${re("value",3,"u32")}
        ${Q.setByOffset("global_idx","value")}
      `}else ie=`
      let outputIndices = ${Q.offsetToIndices("global_idx")};
      ${J("")};
      let value = ${V.getByIndices("dataIndices")};
      ${Q.setByOffset("global_idx","value")};
      `;return`
      ${H.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(V,Z,Q)}
      ${H.mainStart()}
        ${H.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${ie}
      }`};return{name:"Gather",shaderCache:{hint:m.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:D,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(q/64)},programUniforms:j}),getShaderSource:G}},Tl=d=>te({axis:d.axis}),Cl=(d,m)=>{let g=d.inputs;Lf(g),d.compute(Wf(d.inputs,m))}}),Gf,Al,El,kl=L$1(()=>{ee(),ae(),ue(),Gf=(d,m,g,w,$,I,D,F,U)=>{let q=[{type:12,data:I},{type:12,data:w},{type:12,data:$},{type:12,data:g},{type:12,data:D},{type:12,data:F},{type:12,data:U}],j=[I];q.push(...W(m.dims,j));let G=H=>{let V=P("indices_data",m.dataType,m.dims.length),Z=N$1("input_slice_offsets_data",12,1,1),Q=[V,Z],J=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:$.length},{name:"sizes_from_slice_dims_data",type:"u32",length:g.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${H.registerUniforms(J).declareVariables(...Q)}
  ${H.mainStart()}
    ${H.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${$.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${g.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return d.compute({name:"computeSliceOffsets",shaderCache:{hint:`${$.length}_${g.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:j,dataType:d.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:q}),getShaderSource:G},{inputs:[m],outputs:[-1]})[0]},Al=(d,m)=>{let g=d.inputs,w=g[0].dims,$=g[0].dataType,I=g[1].dims,D=I[I.length-1],F=E$1.sizeToDimension(I,I.length-1),U=E$1.sizeFromDimension(w,m.batchDims+D),q=E$1.sizeToDimension(w,m.batchDims),j=E$1.sizeFromDimension(w,m.batchDims),G=F/q,H=new Array(D),V=U;for(let X=0;X<D;++X)H[D-1-X]=V,V*=w[m.batchDims+D-1-X];let Z=Gf(d,g[1],H,m.batchDims,w,F,G,j,D),Q=m.batchDims+D;if(Q>w.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let J=I.slice(0,-1).concat(w.slice(Q)),ie=E$1.size(J),re=[{type:12,data:ie},{type:12,data:U},...W(g[0].dims,Z.dims,J)],se=X=>{let ne=P("data",g[0].dataType,g[0].dims.length),ce=P("slice_offsets",12,Z.dims.length),oe=N$1("output",g[0].dataType,J.length);return`
          ${X.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(ne,ce,oe)}
            ${X.mainStart()}
            ${X.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};d.compute({name:"GatherND",shaderCache:{hint:m.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:J,dataType:$}],dispatchGroup:{x:Math.ceil(ie/64)},programUniforms:re}),getShaderSource:se},{inputs:[g[0],Z]})},El=d=>({batchDims:d.batch_dims,cacheKey:""})}),Hf,Ff,Pl,Ol,zl=L$1(()=>{ee(),ae(),Se(),ue(),Hf=(d,m)=>{if(d.length<3||d.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let g=E$1.normalizeAxis(m.quantizeAxis,d[0].dims.length),w=m.blockSize,$=d[0],I=d[2],D=d.length===4?d[3]:void 0;if(I.dims.length!==$.dims.length||!$.dims.map((F,U)=>U===g?Math.ceil(F/w)===I.dims[U]:F===I.dims[U]).reduce((F,U)=>F&&U,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(D){if(D.dataType!==$.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(D.dims.length!==I.dims.length||!D.dims.map((F,U)=>F===I.dims[U]).reduce((F,U)=>F&&U,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},Ff=(d,m)=>{let g=d[0].dims,w=d[1].dims,$=g.length,I=E$1.normalizeAxis(m.gatherAxis,$),D=E$1.normalizeAxis(m.quantizeAxis,$),F=g.slice(0);F.splice(I,1,...w);let U=E$1.size(F),q=d[2].dataType,j=d[0].dataType===22,G=[{type:12,data:U},{type:12,data:D},{type:12,data:I},{type:12,data:m.blockSize},...W(...d.map((V,Z)=>V.dims),F)],H=V=>{let Z=P("data",d[0].dataType,d[0].dims.length),Q=P("inputIndices",d[1].dataType,d[1].dims.length),J=P("scales",d[2].dataType,d[2].dims.length),ie=d.length>3?P("zeroPoint",d[3].dataType,d[3].dims.length):void 0,re=N$1("output",q,F.length),se=[Z,Q,J];ie&&se.push(ie);let X=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${V.registerUniforms(X).declareVariables(...se,re)}
        ${V.mainStart()}
        let output_indices = ${re.offsetToIndices("global_idx")};
        var indices_indices = ${Q.type.indices}(0);
        ${w.length>1?`
          for (var i: u32 = 0; i < ${w.length}; i++) {
            let index = ${re.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${Q.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${re.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${Z.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${re.indicesGet("output_indices","i")};
          ${Z.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${Q.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${g[I]};
        }
        ${Z.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${F.length}; i++) {
          let index = ${re.indicesGet("output_indices",`i + ${w.length} - 1`)};
          ${Z.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${Z.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${Z.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${j?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${J.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${J.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${J.getByIndices("scale_indices")};
        ${ie?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${ie.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${ie.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${j?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${ke(q)}(quantized_data - zero_point) * scale;
        ${re.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${m.cacheKey};${d.filter((V,Z)=>Z!==1).map(V=>V.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:d.length},(V,Z)=>"rank")},getRunData:()=>({outputs:[{dims:F,dataType:q}],dispatchGroup:{x:Math.ceil(U/64)},programUniforms:G}),getShaderSource:H}},Pl=(d,m)=>{let g=d.inputs;Hf(g,m),d.compute(Ff(d.inputs,m))},Ol=d=>te({blockSize:d.blockSize,gatherAxis:d.gatherAxis,quantizeAxis:d.quantizeAxis})}),qf,jf,Dl,Bl,Ml=L$1(()=>{ee(),ae(),Se(),ue(),qf=d=>{if(!d||d.length!==2)throw new Error("GatherElements requires 2 inputs.");if(d[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(d[0].dims.length!==d[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},jf=(d,m)=>{let g=d[0].dims,w=d[0].dataType,$=g.length,I=d[1].dims,D=d[1].dataType,F=E$1.normalizeAxis(m.axis,$),U=g[F],q=I.slice(0),j=E$1.size(q),G=P("input",w,$),H=P("indicesInput",D,I.length),V=N$1("output",w,q.length),Z=[{type:12,data:j},{type:6,data:U},{type:12,data:F}];return Z.push(...W(g,I,q)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:q,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:Z}),getShaderSource:Q=>`
      ${Q.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(G,H,V)}
      ${Q.mainStart()}
      ${Q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${V.offsetToIndices("global_idx")};

      var idx = ${H.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${G.type.indices}(outputIndices);
      ${G.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${G.getByIndices("inputIndices")};

      ${V.setByOffset("global_idx","value")};
  }`}},Dl=d=>te({axis:d.axis}),Bl=(d,m)=>{let g=d.inputs;qf(g),d.compute(jf(d.inputs,m))}}),Kf,Zf,Rl,Ul,Nl=L$1(()=>{ee(),ae(),ue(),Kf=d=>{if(!d)throw new Error("Input is missing");if(d.length<2||d.length>3)throw new Error("Invaid input number.");if(d.length===3&&d[2].dims.length>2)throw new Error("Invalid input shape of C");if(d[0].dataType!==d[1].dataType||d.length===3&&d[0].dataType!==d[2].dataType)throw new Error("Input types are mismatched")},Zf=(d,m)=>{let g=d[0].dims.slice(),w=d[1].dims.slice(),[$,I,D]=Vr.getShapeOfGemmResult(g,m.transA,w,m.transB,d.length===3?d[2].dims:void 0),F=[$,I];if(!F)throw new Error("Can't use gemm on the given tensors");let U=16,q=Math.ceil(I/U),j=Math.ceil($/U),G=!0,H=E$1.size(F),V=[{type:12,data:G?q:H},{type:12,data:$},{type:12,data:I},{type:12,data:D},{type:1,data:m.alpha},{type:1,data:m.beta}],Z=["type","type"];d.length===3&&(V.push(...W(d[2].dims)),Z.push("rank")),V.push(...W(F));let Q=ie=>{let re="";m.transA&&m.transB?re="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":m.transA&&!m.transB?re="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!m.transA&&m.transB?re="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!m.transA&&!m.transB&&(re="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let se=m.alpha===1?"":"value *= uniforms.alpha;",X=P("a",d[0].dataType,d[0].dims),ne=P("b",d[1].dataType,d[1].dims),ce=X.type.value,oe=null,de=[X,ne];d.length===3&&(oe=P("c",d[2].dataType,d[2].dims.length),de.push(oe));let me=N$1("output",d[0].dataType,F.length);de.push(me);let ge=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${ie.registerUniforms(ge).declareVariables(...de)}

  ${ie.mainStart()}
    ${ie.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${ce}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${re}
    }

    ${se}
    ${oe!=null?`let cOffset = ${oe.broadcastedIndicesToOffset("vec2(m, n)",me)}; value += ${ce}(uniforms.beta) * ${oe.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},J=ie=>{let re=P("a",d[0].dataType,d[0].dims),se=P("b",d[1].dataType,d[1].dims),X=null,ne=[re,se];d.length===3&&(X=P("c",d[2].dataType,d[2].dims.length),ne.push(X));let ce=N$1("output",d[0].dataType,F.length);ne.push(ce);let oe=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],de="",me="";m.transA&&m.transB?(me=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${re.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${se.type.value}(0);
      }
      `,de="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):m.transA&&!m.transB?(me=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${re.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${se.type.value}(0);
      }
      `,de="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!m.transA&&m.transB?(me=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${re.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${se.type.value}(0);
      }
      `,de="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!m.transA&&!m.transB&&(me=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${re.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${se.type.value}(0);
      }
      `,de="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let ge=m.alpha===1?"":"value *= uniforms.alpha;";return`
  ${ie.registerUniforms(oe).declareVariables(...ne)}
  var<workgroup> tile_a: array<array<${re.type.storage}, ${U}>, ${U}>;
  var<workgroup> tile_b: array<array<${se.type.storage}, ${U}>, ${U}>;
  ${ie.mainStart([U,U,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${U};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${U};
    let num_tiles = (uniforms.K - 1) / ${U} + 1;
    var k_start = 0u;
    var value = ${ce.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${me}
      k_start = k_start + ${U};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${U}; k++) {
        ${de}
      }
      workgroupBarrier();
    }

    ${ge}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${X!=null?`let cOffset = ${X.broadcastedIndicesToOffset("vec2(m, n)",ce)}; value += ${ce.type.value}(uniforms.beta) * ${X.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return G?{name:"GemmShared",shaderCache:{hint:`${m.cacheKey}`,inputDependencies:Z},getRunData:()=>({outputs:[{dims:F,dataType:d[0].dataType}],dispatchGroup:{x:q*j},programUniforms:V}),getShaderSource:J}:{name:"Gemm",shaderCache:{hint:`${m.cacheKey}`,inputDependencies:Z},getRunData:()=>({outputs:[{dims:F,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(H/64)},programUniforms:V}),getShaderSource:Q}},Rl=d=>{let m=d.transA,g=d.transB,w=d.alpha,$=d.beta;return{transA:m,transB:g,alpha:w,beta:$,cacheKey:`${d.transA};${d.transB};${d.alpha===1}`}},Ul=(d,m)=>{Kf(d.inputs),d.compute(Zf(d.inputs,m))}}),pt,Ct,Ft,qt,Qf,Yf,Xf,Jf,eh,th,rh,nh,Vl,Ll,Wl=L$1(()=>{ee(),ae(),Se(),ue(),[pt,Ct,Ft,qt]=[0,1,2,3],Qf=d=>{if(d[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(d[0].dims.length!==d[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(d[0].dims.length-2!==d[1].dims[d[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${d[0].dims.length-2}`);if(d[0].dims[0]!==d[1].dims[0])throw new Error("grid batch size must match input batch size")},Yf=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,Xf=d=>`
  fn gs_bicubic_interpolate(p: mat4x4<${d}>, x: f32, y: f32) -> ${d} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${d}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,Jf=d=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${d.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,eh=d=>`
  ${d.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,th=(d,m,g)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${m} {
     var pixel = ${m}(0);
     var indices = vec4<u32>(0);
     indices[${pt}] = batch;
     indices[${Ct}] = channel;`+(()=>{switch(g.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${Ft}] = u32(r);
            indices[${qt}] = u32(c);
          } else {
            return ${m}(0);
          }
        `;case"border":return`
          indices[${Ft}] = u32(clamp(r, 0, H - 1));
          indices[${qt}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${Ft}] = gs_reflect(r, border[1], border[3]);
          indices[${qt}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${g.paddingMode} is not supported`)}})()+`
    return ${d.getByIndices("indices")};
  }
`,rh=(d,m,g)=>(()=>{switch(g.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${pt}], indices[${Ct}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${pt}], indices[${Ct}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${pt}], indices[${Ct}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${pt}], indices[${Ct}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${pt}], indices[${Ct}], border);

          let dx2 = ${m}(f32(x2) - x);
          let dx1 = ${m}(x - f32(x1));
          let dy2 = ${m}(f32(y2) - y);
          let dy1 = ${m}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${m}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${pt}], indices[${Ct}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${g.mode} is not supported`)}})()+`${d.setByOffset("global_idx","result")}`,nh=(d,m)=>{let g=P("x",d[0].dataType,d[0].dims.length),w=[d[1].dims[0],d[1].dims[1],d[1].dims[2]],$=P("grid",d[1].dataType,w.length,2),I=[d[0].dims[0],d[0].dims[1],d[1].dims[1],d[1].dims[2]];m.format==="NHWC"&&(I=[d[0].dims[0],d[1].dims[1],d[1].dims[2],d[0].dims[3]],[pt,Ct,Ft,qt]=[0,3,1,2]);let D=N$1("output",d[0].dataType,I.length),F=g.type.value,U=E$1.size(I),q=[{type:12,data:U},...W(d[0].dims,w,I)],j=G=>`
  ${G.registerUniform("output_size","u32").declareVariables(g,$,D)}
  ${Yf}
  ${Xf(F)}
  ${Jf(m)}
  ${eh(m)}
  ${th(g,F,m)}

  ${G.mainStart()}
    ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${Ft}]);
      let W_in = i32(uniforms.x_shape[${qt}]);

      ${m.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${D.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${pt}], indices[${Ft}], indices[${qt}]);
      let nxy = ${$.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${rh(D,F,m)}
  }`;return{name:"GridSample",shaderCache:{hint:`${m.cacheKey}`,inputDependencies:["type","type"]},getRunData:G=>{let H=E$1.size(I);return{outputs:[{dims:I,dataType:G[0].dataType}],dispatchGroup:{x:Math.ceil(H/64)},programUniforms:q}},getShaderSource:j}},Vl=(d,m)=>{Qf(d.inputs),d.compute(nh(d.inputs,m))},Ll=d=>te({alignCorners:d.align_corners,mode:d.mode,paddingMode:d.padding_mode,format:d.format})}),Re,ah,Hl,Gl,sh,sr,Fl,Eo=L$1(()=>{ee(),ae(),Se(),qr(),Yr(),ue(),ct(),Re=(d,m)=>d.length>m&&d[m].dims.length>0?d[m]:void 0,ah=(d,m)=>{let g=d[0],w=Re(d,1),$=Re(d,2),I=Re(d,3),D=Re(d,4),F=Re(d,5),U=Re(d,6),q=Re(d,7);if(g.dims.length!==3&&g.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let j=g.dims[0],G=g.dims[1],H=g.dims.length===3?g.dims[2]:m.numHeads*g.dims[4],V=G,Z=0,Q=0,J=Math.floor(H/m.numHeads);if(U&&q&&E$1.size(U.dims)&&E$1.size(q.dims)){if(U.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(U.dims[0]!==j||U.dims[1]!==m.numHeads||U.dims[3]!==J)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(q.dims[0]!==j||q.dims[1]!==m.numHeads||q.dims[3]!==J)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(U.dims[2]!==q.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(q.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');Z=U.dims[2],Q=U.dims[2]}else if(U&&E$1.size(U.dims)||q&&E$1.size(q.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let ie;if(w&&E$1.size(w.dims)>0){if(g.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(w.dims.length<3||w.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(g.dims[0]!==w.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(w.dims.length===3){if(w.dims[2]!==g.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');ie=2,V=w.dims[1]}else if(w.dims.length===5){if(w.dims[2]!==m.numHeads||w.dims[3]!==2||w.dims[4]!==J)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if($)throw new Error('Expect "value" be none when "key" has packed kv format.');ie=5,V=w.dims[1]}else{if(w.dims[1]!==m.numHeads||w.dims[3]!==J)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');ie=0,V=w.dims[2]}}else{if(g.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(g.dims[2]!==m.numHeads||g.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');ie=3}if(I&&E$1.size(I.dims)>0){if(I.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(w&&w.dims.length===5&&w.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let re=Z+V,se=0;if(D&&E$1.size(D.dims)>0){se=8;let oe=D.dims;throw oe.length===1?oe[0]===j?se=1:oe[0]===3*j+2&&(se=3):oe.length===2&&oe[0]===j&&oe[1]===re&&(se=5),se===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let X=!1,ne=H;if($&&E$1.size($.dims)>0){if($.dims.length!==3&&$.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(g.dims[0]!==$.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if($.dims.length===3){if(V!==$.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');ne=$.dims[2]}else{if(V!==$.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');ne=$.dims[1]*$.dims[3],X=!0}}let ce=!1;if(D&&E$1.size(D.dims)>0)throw new Error("Key padding mask is not supported");if(F&&E$1.size(F.dims)>0){if(F.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(F.dims[0]!==j||F.dims[1]!==m.numHeads||F.dims[2]!==G||F.dims[3]!==re)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:j,sequenceLength:G,pastSequenceLength:Z,kvSequenceLength:V,totalSequenceLength:re,maxSequenceLength:Q,inputHiddenSize:0,hiddenSize:H,vHiddenSize:ne,headSize:J,vHeadSize:Math.floor(ne/m.numHeads),numHeads:m.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:m.maskFilterValue,maskType:se,scale:m.scale,broadcastResPosBias:ce,passPastInKv:X,qkvFormat:ie}},Hl=d=>te({...d}),Gl=te({perm:[0,2,1,3]}),sh=(d,m,g,w,$,I,D)=>{let F=[w,$,I],U=E$1.size(F),q=[{type:12,data:U},{type:12,data:D},{type:12,data:I}],j=G=>{let H=N$1("qkv_with_bias",m.dataType,F),V=P("qkv",m.dataType,F),Z=P("bias",g.dataType,F),Q=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${G.registerUniforms(Q).declareVariables(V,Z,H)}
  ${G.mainStart()}
    ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return d.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:F,dataType:m.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(U/64)},programUniforms:q}),getShaderSource:j},{inputs:[m,g],outputs:[-1]})[0]},sr=(d,m,g,w,$,I,D,F)=>{let U=I;if(D&&E$1.size(D.dims)>0){if(w===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return U=sh(d,I,D,m,w,g*$,F),U=U.reshape([m,w,g,$]),g===1||w===1?U:d.compute(Pe(U,Gl.perm),{inputs:[U],outputs:[-1]})[0]}else return I.dims.length===3&&(U=I.reshape([m,w,g,$])),g===1||w===1?U:d.compute(Pe(U,Gl.perm),{inputs:[U],outputs:[-1]})[0]},Fl=(d,m)=>{let g=ah(d.inputs,m),w=d.inputs[0],$=Re(d.inputs,1),I=Re(d.inputs,2),D=Re(d.inputs,3),F=Re(d.inputs,4),U=Re(d.inputs,5),q=Re(d.inputs,6),j=Re(d.inputs,7);if(w.dims.length===5)throw new Error("Packed QKV is not implemented");if($?.dims.length===5)throw new Error("Packed KV is not implemented");let G=$&&I&&$.dims.length===4&&I.dims.length===4,H=sr(d,g.batchSize,g.numHeads,g.sequenceLength,g.headSize,w,D,0);if(G)return Ht(d,H,$,I,F,void 0,q,j,U,g);if(!$||!I)throw new Error("key and value must be provided");let V=sr(d,g.batchSize,g.numHeads,g.kvSequenceLength,g.headSize,$,D,g.hiddenSize),Z=sr(d,g.batchSize,g.numHeads,g.kvSequenceLength,g.vHeadSize,I,D,2*g.hiddenSize);Ht(d,H,V,Z,F,void 0,q,j,U,g)}}),uh,lh,dh,ch,ko,ql,jl,Po=L$1(()=>{ee(),ae(),Se(),ue(),uh=d=>{if(!d||d.length<1)throw new Error("too few inputs")},lh=(d,m)=>{let g=[],w=m.numOutputs;return d[1].dims[0]>0&&(d[1].getBigInt64Array().forEach($=>g.push(Number($))),w=g.length),te({numOutputs:w,axis:m.axis,splitSizes:g})},dh=d=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${d}u; i += 1u ) {
    if (index < ${K("uniforms.size_in_split_axis","i",d)}) {
        return i;
    }
    }
    return ${d}u;
}`,ch=d=>{let m=d.length,g=[];for(let w=0;w<m;++w){let $=d[w].setByIndices("indices","input[global_idx]");m===1?g.push($):w===0?g.push(`if (output_number == ${w}u) { ${$} }`):w===m-1?g.push(`else { ${$} }`):g.push(`else if (output_number == ${w}) { ${$} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${d[0].type.indices}, global_idx: u32) {
        ${g.join(`
`)}
      }`},ko=(d,m)=>{let g=d[0].dims,w=E$1.size(g),$=d[0].dataType,I=E$1.normalizeAxis(m.axis,g.length),D=new Array(m.numOutputs),F=P("input",$,g.length),U=new Array(m.numOutputs),q=[],j=[],G=0,H=[{type:12,data:w}];for(let Z=0;Z<m.numOutputs;Z++){G+=m.splitSizes[Z],U[Z]=G;let Q=g.slice();Q[I]=m.splitSizes[Z],j.push(Q),D[Z]=N$1(`output${Z}`,$,Q.length),q.push({dims:j[Z],dataType:d[0].dataType})}H.push({type:12,data:U},...W(g,...j));let V=Z=>`
  ${Z.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",U.length).declareVariables(F,...D)}
  ${dh(U.length)}
  ${ch(D)}

  ${Z.mainStart()}
    ${Z.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${F.offsetToIndices("global_idx")};
    var index = ${F.indicesGet("indices",I)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${K("uniforms.size_in_split_axis","output_number - 1u",U.length)};
      ${F.indicesSet("indices",I,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:m.cacheKey,inputDependencies:["rank"]},getShaderSource:V,getRunData:()=>({outputs:q,dispatchGroup:{x:Math.ceil(w/64)},programUniforms:H})}},ql=(d,m)=>{uh(d.inputs);let g=d.inputs.length===1?m:lh(d.inputs,m);d.compute(ko(d.inputs,g),{inputs:[0]})},jl=d=>{let m=d.axis,g=d.splitSizes,w=d.numOutputs<0?g.length:d.numOutputs;if(w!==g.length)throw new Error("numOutputs and splitSizes length must be equal");return te({axis:m,numOutputs:w,splitSizes:g})}}),ph,un,Kl,Oo=L$1(()=>{ee(),ae(),Se(),ue(),ph=(d,m)=>{let[g,w,$,I]=d,{numHeads:D,rotaryEmbeddingDim:F}=m;if(g.dims.length!==3&&g.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${g.dims.length}`);if(!E$1.areEqual(w.dims,[])&&!E$1.areEqual(w.dims,[1])&&w.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${w.dims.length}`);if($.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${$.dims.length}`);if(I.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${I.dims.length}`);if(!E$1.areEqual($.dims,I.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(F>0&&D===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let U=g.dims[0],q=g.dims[g.dims.length-2],j=$.dims[0],G=E$1.sizeFromDimension(g.dims,1)/q,H=F===0?$.dims[1]*2:G/D;if(F>H)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(w.dims.length===2){if(U!==w.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${w.dims[0]}`);if(q!==w.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${w.dims[1]}`)}if(H/2!==$.dims[1]&&F/2!==$.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${$.dims[1]}`);if(q>j)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},un=(d,m)=>{let{interleaved:g,numHeads:w,rotaryEmbeddingDim:$,scale:I}=m,D=d[0].dims[0],F=E$1.sizeFromDimension(d[0].dims,1),U=d[0].dims[d[0].dims.length-2],q=F/U,j=d[2].dims[1],G=$===0?j*2:q/w,H=new Array(D,U,q/G,G-j),V=E$1.computeStrides(H),Z=[{type:1,data:I},{type:12,data:H},{type:12,data:V},...d[0].dims.length===3?new Array({type:12,data:[F,q,G,1]}):[],...d[0].dims.length===4?new Array({type:12,data:[F,G,U*G,1]}):[],...W(d[0].dims,d[1].dims,d[2].dims,d[3].dims,d[0].dims)],Q=J=>{let ie=P("input",d[0].dataType,d[0].dims.length),re=P("position_ids",d[1].dataType,d[1].dims.length),se=P("cos_cache",d[2].dataType,d[2].dims.length),X=P("sin_cache",d[3].dataType,d[3].dims.length),ne=N$1("output",d[0].dataType,d[0].dims.length);return J.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:H.length},{name:"global_strides",type:"u32",length:V.length},{name:"input_output_strides",type:"u32",length:V.length}]),`
        ${J.declareVariables(ie,re,se,X,ne)}

        ${J.mainStart(Bt)}
          let half_rotary_emb_dim = uniforms.${se.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${J.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${re.broadcastedIndicesToOffset("bsnh.xy",N$1("",re.type.tensor,2))};
            let position_id =
                u32(${re.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${g});
            let j = i + select(half_rotary_emb_dim, 1, ${g});
            let re = ${ie.getByOffset("i")} * ${se.get("position_id","bsnh[3]")} -
                ${ie.getByOffset("j")} * ${X.get("position_id","bsnh[3]")};
            ${ne.setByOffset("i","re")}
            let im = ${ie.getByOffset("i")} * ${X.get("position_id","bsnh[3]")} +
                ${ie.getByOffset("j")} * ${se.get("position_id","bsnh[3]")};
            ${ne.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${ne.setByOffset("k",ie.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:te({interleaved:g}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:Q,getRunData:()=>({outputs:[{dims:d[0].dims,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(E$1.size(H)/Bt)},programUniforms:Z})}},Kl=(d,m)=>{ph(d.inputs,m),d.compute(un(d.inputs,m))}}),mh,fh,Zl,hh,Ql,Yl=L$1(()=>{Se(),ee(),Yr(),Eo(),Po(),ct(),Oo(),ue(),mh=(d,m)=>{if(m.doRotary&&d.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let g=d[0],w=d[1],$=d[2],I=d[3],D=d[4];if(m.doRotary!==0&&d.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(m.localWindowSize!==-1)throw new Error("Local attention is not supported");if(m.softcap!==0)throw new Error("Softcap is not supported");if(m.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(m.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(g.dims.length!==3&&g.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let F=!1,U=g.dims[0],q=g.dims[1],j=g.dims.length===3?F?g.dims[2]/3:g.dims[2]:m.numHeads*g.dims[4],G=q,H=0,V=!w||w.dims.length===0,Z=Math.floor(V?j/(m.numHeads+2*m.kvNumHeads):j/m.numHeads);V&&(j=Z*m.numHeads);let Q=I&&I.dims.length!==0,J=D&&D.dims.length!==0;if(Q&&I.dims.length===4&&I.dims[0]===U&&I.dims[1]!==m.kvNumHeads&&I.dims[2]===m.kvNumHeads&&I.dims[3]===Z)throw new Error("BSNH pastKey/pastValue is not supported");if(Q&&J){if(I.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(D.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');H=I.dims[2]}else if(Q||J)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let ie=1;if(w&&w.dims.length>0){if(g.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(w.dims.length<3||w.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(g.dims[0]!==w.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(w.dims.length===3){if(g.dims[2]%w.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');G=w.dims[1]}else if(w.dims.length===5){if(w.dims[2]!==m.numHeads||w.dims[3]!==2||w.dims[4]!==Z)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if($)throw new Error('Expect "value" be none when "key" has packed kv format.');G=w.dims[1]}else{if(w.dims[1]!==m.numHeads||w.dims[3]!==Z)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');G=w.dims[2]}}else{if(g.dims.length!==3&&g.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(g.dims.length===5&&(g.dims[2]!==m.numHeads||g.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');ie=3}let re=0,se=!1,X=m.kvNumHeads?Z*m.kvNumHeads:j;if($&&$.dims.length>0){if($.dims.length!==3&&$.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(g.dims[0]!==$.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if($.dims.length===3){if(G!==$.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');X=$.dims[2]}else{if(G!==$.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');X=$.dims[1]*$.dims[3],se=!0}}let ne=d.length>4?d[5]:void 0;if(ne&&ne.dims.length!==1&&ne.dims[0]!==U)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:U,sequenceLength:q,pastSequenceLength:H,kvSequenceLength:G,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:j,vHiddenSize:X,headSize:Z,vHeadSize:Math.floor(X/m.kvNumHeads),numHeads:m.numHeads,kvNumHeads:m.kvNumHeads,nReps:m.numHeads/m.kvNumHeads,pastPresentShareBuffer:!1,maskType:re,scale:m.scale,broadcastResPosBias:!1,passPastInKv:se,qkvFormat:ie}},fh=te({perm:[0,2,1,3]}),Zl=(d,m,g)=>{let w=m,$=g.kvNumHeads;return m.dims.length===3&&g.kvSequenceLength!==0&&(w=m.reshape([g.batchSize,g.kvSequenceLength,$,g.headSize]),w=d.compute(Pe(w,fh.perm),{inputs:[w],outputs:[-1]})[0]),w},hh=(d,m,g,w)=>{let $=7,I=["type","type"],D=[d*m],F=d*m,U=[{type:12,data:F},{type:12,data:m},{type:12,data:d}],q=j=>{let G=P("seq_lens",g.dataType,g.dims),H=P("total_seq_lens",w.dataType,w.dims),V=N$1("pos_ids",$,D),Z=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${j.registerUniforms(Z).declareVariables(G,H,V)}
  ${j.mainStart()}
    ${j.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${H.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${G.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${V.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${V.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${V.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${d};${m}`,inputDependencies:I},getRunData:()=>({outputs:[{dims:D,dataType:$}],dispatchGroup:{x:Math.ceil(F/64)},programUniforms:U}),getShaderSource:q}},Ql=(d,m)=>{let g=mh(d.inputs,m);if(d.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(d.inputs[1]?.dims.length===5)throw new Error("Packed KV is not implemented");let w=d.inputs[0],$=d.inputs[1]&&d.inputs[1].dims.length>0?d.inputs[1]:void 0,I=d.inputs[2]&&d.inputs[2].dims.length>0?d.inputs[2]:void 0,D=d.inputs[3]&&d.inputs[3].dims.length!==0?d.inputs[3]:void 0,F=d.inputs[4]&&d.inputs[4].dims.length!==0?d.inputs[4]:void 0,U=d.inputs.length>4?d.inputs[5]:void 0,q=d.inputs.length>5?d.inputs[6]:void 0,j=g.kvNumHeads?g.kvNumHeads:g.numHeads,G=te({axis:2,numOutputs:3,splitSizes:[g.numHeads*g.headSize,j*g.headSize,j*g.headSize]}),[H,V,Z]=!$&&!I?d.compute(ko([w],G),{inputs:[w],outputs:[-1,-1,-1]}):[w,$,I],Q,J;if(m.doRotary){let X=d.compute(hh(g.batchSize,g.sequenceLength,U,q),{inputs:[U,q],outputs:[-1]})[0],ne=d.inputs[7],ce=d.inputs[8],oe=te({interleaved:m.rotaryInterleaved!==0,numHeads:g.numHeads,rotaryEmbeddingDim:0,scale:m.scale}),de=[H,X,ne,ce],me=[-1];Q=d.compute(un(de,oe),{inputs:de,outputs:me})[0],de.splice(0,1,V);let ge=te({interleaved:m.rotaryInterleaved!==0,numHeads:g.kvNumHeads,rotaryEmbeddingDim:0,scale:m.scale});J=d.compute(un(de,ge),{inputs:de,outputs:me})[0]}let ie=sr(d,g.batchSize,g.numHeads,g.sequenceLength,g.headSize,m.doRotary?Q:H,void 0,0),re=Zl(d,m.doRotary?J:V,g),se=Zl(d,Z,g);Ht(d,ie,re,se,void 0,void 0,D,F,void 0,g,U,q)}}),Xl,gh,yh,Jl,ed=L$1(()=>{ee(),ae(),ct(),ue(),Xl=(d,m,g,w,$,I,D,F)=>{let U=he(I),q=U===1?"f32":`vec${U}f`,j=U===1?"vec2f":`mat2x${U}f`,G=$*D,H=64;G===1&&(H=256);let V=[$,D,I/U],Z=[$,D,2],Q=["rank","type","type"],J=[];J.push(...W(V,Z));let ie=re=>{let se=P("x",m.dataType,3,U),X=P("scale",g.dataType,g.dims),ne=P("bias",w.dataType,w.dims),ce=N$1("output",1,3,2),oe=[se,X,ne,ce];return`
  var<workgroup> workgroup_shared : array<${j}, ${H}>;
  const workgroup_size = ${H}u;
  ${re.declareVariables(...oe)}
  ${re.mainStart(H)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${q}(0);
    var squared_sum = ${q}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${q}(${se.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${j}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${je("workgroup_shared[0][0]",U)} / f32(hight * ${U});
      let squared_sum_final = ${je("workgroup_shared[0][1]",U)} / f32(hight * ${U});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${F}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return d.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${U};${F};${H}`,inputDependencies:Q},getRunData:()=>({outputs:[{dims:Z,dataType:1}],dispatchGroup:{x:G},programUniforms:J}),getShaderSource:ie},{inputs:[m,g,w],outputs:[-1]})[0]},gh=(d,m,g)=>{let w=m[0].dims,$=w,I=2,D=w[0],F=w[1],U=E$1.sizeFromDimension(w,I),q=he(U),j=E$1.size($)/q,G=Xl(d,m[0],m[1],m[2],D,U,F,g.epsilon),H=[D,F,U/q],V=[D,F],Z=["type","none"],Q=J=>{let ie=P("x",m[0].dataType,H.length,q),re=P("scale_shift",1,V.length,2),se=N$1("output",m[0].dataType,H.length,q),X=[ie,re,se];return`
  ${J.registerUniform("output_size","u32").declareVariables(...X)}
  ${J.mainStart()}
  ${J.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${se.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${re.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${ie.getByOffset("global_idx")} * ${se.type.value}(scale_shift.x) + ${se.type.value}(scale_shift.y);
      ${se.setByOffset("global_idx","value")};
  }`};d.compute({name:"InstanceNormalization",shaderCache:{hint:`${q}`,inputDependencies:Z},getRunData:()=>({outputs:[{dims:$,dataType:m[0].dataType}],dispatchGroup:{x:Math.ceil(j/64)},programUniforms:[{type:12,data:j},...W(H,V,H)]}),getShaderSource:Q},{inputs:[m[0],G]})},yh=(d,m,g)=>{let w=m[0].dims,$=w,I=w[0],D=w[w.length-1],F=E$1.sizeFromDimension(w,1)/D,U=he(D),q=E$1.size($)/U,j=[{type:12,data:F},{type:12,data:Math.floor(D/U)}],G=["type","type"],H=!1,V=[0,w.length-1];for(let ie=0;ie<w.length-2;ie++)H=H||w[ie+1]!==1,V.push(ie+1);H=H&&w[w.length-1]!==1;let Z=H?d.compute(Pe(d.inputs[0],V),{inputs:[d.inputs[0]],outputs:[-1]})[0]:d.inputs[0].reshape(Array.from({length:w.length},(ie,re)=>w[V[re]])),Q=Xl(d,Z,m[1],m[2],I,F,D,g.epsilon),J=ie=>{let re=ve(m[0].dataType),se=U===1?"vec2f":`mat${U}x2f`,X=oe=>{let de=oe===0?"x":"y",me=U===1?"f32":`vec${U}f`;switch(U){case 1:return`${re}(${me}(scale.${de}))`;case 2:return`vec2<${re}>(${me}(scale[0].${de}, scale[1].${de}))`;case 4:return`vec4<${re}>(${me}(scale[0].${de}, scale[1].${de}, scale[2].${de}, scale[3].${de}))`;default:throw new Error(`Not supported compoents ${U}`)}},ne=P("input",m[0].dataType,m[0].dims,U),ce=N$1("output",m[0].dataType,$,U);return`
  @group(0) @binding(0) var<storage, read> input : array<${ne.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${se}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${ce.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${ie.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${X(0)}, ${X(1)});
  }`};d.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${U}`,inputDependencies:G},getRunData:()=>({outputs:[{dims:$,dataType:m[0].dataType}],dispatchGroup:{x:Math.ceil(q/64)},programUniforms:j}),getShaderSource:J},{inputs:[m[0],Q]})},Jl=(d,m)=>{m.format==="NHWC"?yh(d,d.inputs,m):gh(d,d.inputs,m)}}),bh,_h,td,rd=L$1(()=>{ee(),ae(),ue(),bh=d=>{if(!d||d.length<2)throw new Error("layerNorm requires at least 2 inputs.")},_h=(d,m,g)=>{let w=m.simplified,$=d[0].dims,I=d[1],D=!w&&d[2],F=$,U=E$1.normalizeAxis(m.axis,$.length),q=E$1.sizeToDimension($,U),j=E$1.sizeFromDimension($,U),G=E$1.size(I.dims),H=D?E$1.size(D.dims):0;if(G!==j||D&&H!==j)throw new Error(`Size of X.shape()[axis:] == ${j}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${G} and bias size of ${H}`);let V=[];for(let ne=0;ne<$.length;++ne)ne<U?V.push($[ne]):V.push(1);let Z=he(j),Q=["type","type"],J=[{type:12,data:q},{type:1,data:j},{type:12,data:Math.floor(j/Z)},{type:1,data:m.epsilon}];D&&Q.push("type");let ie=g>1,re=g>2,se=ne=>{let ce=ve(d[0].dataType),oe=[P("x",d[0].dataType,d[0].dims,Z),P("scale",I.dataType,I.dims,Z)];D&&oe.push(P("bias",D.dataType,D.dims,Z)),oe.push(N$1("output",d[0].dataType,F,Z)),ie&&oe.push(N$1("mean_data_output",1,V)),re&&oe.push(N$1("inv_std_output",1,V));let de=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${ne.registerUniforms(de).declareVariables(...oe)}
  ${ne.mainStart()}
    ${ne.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${fo("f32",Z)};
    var mean_square_vector = ${fo("f32",Z)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${Mt(ce,Z,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${je("mean_vector",Z)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${je("mean_square_vector",Z)} / uniforms.norm_size ${w?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${Mt(ce,Z,"x[j + offset]")};
      let f32scale = ${Mt(ce,Z,"scale[j]")};
      output[j + offset] = ${oe[0].type.value}((f32input ${w?"":"- mean"}) * inv_std_dev * f32scale
        ${D?`+ ${Mt(ce,Z,"bias[j]")}`:""}
      );
    }

    ${ie?"mean_data_output[global_idx] = mean":""};
    ${re?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},X=[{dims:F,dataType:d[0].dataType}];return ie&&X.push({dims:V,dataType:1}),re&&X.push({dims:V,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${Z};${g};${w}`,inputDependencies:Q},getRunData:()=>({outputs:X,dispatchGroup:{x:Math.ceil(q/64)},programUniforms:J}),getShaderSource:se}},td=(d,m)=>{bh(d.inputs),d.compute(_h(d.inputs,m,d.outputCount))}}),wh,nd,od=L$1(()=>{ae(),nn(),on(),wh=d=>{if(!d||d.length!==2)throw new Error("MatMul requires 2 inputs.");if(d[0].dims[d[0].dims.length-1]!==d[1].dims[d[1].dims.length-2])throw new Error("shared dimension does not match.")},nd=d=>{wh(d.inputs);let m=tt.calcShape(d.inputs[0].dims,d.inputs[1].dims,!0);if(!m)throw new Error("Can't use matmul on the given tensors");let g=m[m.length-1],w=d.inputs[0].dims[d.inputs[0].dims.length-1];if(g<8&&w<8)d.compute(rn(d.inputs,{activation:""},m));else{let $=m[m.length-2],I=E$1.size(d.inputs[0].dims.slice(0,-2)),D=E$1.size(d.inputs[1].dims.slice(0,-2));if(I!==1&&$===1&&D===1){let F=d.inputs[0].reshape([1,I,w]),U=d.inputs[1].reshape([1,w,g]),q=[1,I,g],j=[F,U];d.compute(ar(j,{activation:""},m,q),{inputs:j})}else d.compute(ar(d.inputs,{activation:""},m))}}}),vh,$h,xh,id,ad,sd=L$1(()=>{ee(),ae(),Se(),ue(),vh=(d,m)=>{if(d.length<3||d.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let g=d[0],w=g.dims.length;if(g.dims[w-1]!==m.k)throw new Error("The last dim of input shape does not match the k value");let $=Math.floor((m.k+m.blockSize-1)/m.blockSize),I=m.blockSize/8*m.bits,D=d[1];if(!E$1.areEqual(D.dims,[m.n,$,I]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let F=d[2].dims;if(E$1.size(F)!==m.n*$)throw new Error("scales input size error.");if(d.length===4){let U=d[3].dims,q=m.n*(m.bits===8?$:Math.floor(($*m.bits+7)/8));if(E$1.size(U)!==q)throw new Error("zeroPoints input size error.")}},$h=(d,m)=>{let g=d[0].dims,w=g.length,$=g[w-2],I=m.k,D=m.n,F=g.slice(0,w-2),U=E$1.size(F),q=d[1].dims[2]/4,j=d[0].dataType,G=he(m.k),H=he(q),V=he(D),Z=F.concat([$,D]),Q=$>1&&D/V%2===0?2:1,J=E$1.size(Z)/V/Q,ie=64,re=[],se=[U,$,I/G],X=E$1.convertShape(d[1].dims).slice();X.splice(-1,1,q/H),re.push(...W(se)),re.push(...W(X)),re.push(...W(d[2].dims)),d.length===4&&re.push(...W(E$1.convertShape(d[3].dims)));let ne=[U,$,D/V];re.push(...W(ne));let ce=oe=>{let de=se.length,me=P("a",d[0].dataType,de,G),ge=P("b",12,X.length,H),fe=P("scales",d[2].dataType,d[2].dims.length),xe=[me,ge,fe],Fe=d.length===4?P("zero_points",12,d[3].dims.length):void 0;Fe&&xe.push(Fe);let Te=ne.length,Oe=N$1("output",d[0].dataType,Te,V),Be=ve(d[0].dataType),_t=(()=>{switch(G){case 1:return`array<${Be}, 8>`;case 2:return`mat4x2<${Be}>`;case 4:return`mat2x4<${Be}>`;default:throw new Error(`${G}-component is not supported.`)}})(),Et=()=>{let Ye=`
          // reuse a data
            var input_offset = ${me.indicesToOffset(`${me.type.indices}(batch, row, word_offset)`)};
            var a_data: ${_t};
            for (var j: u32 = 0; j < ${8/G}; j++) {
              a_data[j] = ${me.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let bt=0;bt<V*Q;bt++)Ye+=`
            b_value = ${H===1?`b${bt}_data`:`b${bt}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${_t}(${Array.from({length:4},(Qt,Vt)=>`${Be}(b_value_lower[${Vt}]), ${Be}(b_value_upper[${Vt}])`).join(", ")});
            b_dequantized_values = ${G===1?`${_t}(${Array.from({length:8},(Qt,Vt)=>`(b_quantized_values[${Vt}] - ${Fe?`zero_point${bt}`:"zero_point"}) * scale${bt}`).join(", ")});`:`(b_quantized_values - ${_t}(${Array(8).fill(`${Fe?`zero_point${bt}`:"zero_point"}`).join(",")})) * scale${bt};`};
            workgroup_shared[local_id.x * ${Q} + ${Math.floor(bt/V)}]${V>1?`[${bt%V}]`:""} += ${Array.from({length:8/G},(Qt,Vt)=>`${G===1?`a_data[${Vt}] * b_dequantized_values[${Vt}]`:`dot(a_data[${Vt}], b_dequantized_values[${Vt}])`}`).join(" + ")};
          `;return Ye},dt=()=>{let Ye=`
            var col_index = col * ${V};
            ${Fe?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${Be}(8);`}
            `;for(let bt=0;bt<V*Q;bt++)Ye+=`
            let scale${bt} = ${fe.getByOffset("col_index * nBlocksPerCol + block")};
            ${Fe?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${Fe.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${bt} = ${Be}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return Ye},Zt=()=>{let Ye=`col_index = col * ${V};`;for(let bt=0;bt<V*Q;bt++)Ye+=`
            let b${bt}_data = ${ge.getByIndices(`${ge.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return Ye+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${_t};
            var b_dequantized_values: ${_t};`,Ye};return`
        var<workgroup> workgroup_shared: array<${Oe.type.value}, ${Q*ie}>;
        ${oe.declareVariables(...xe,Oe)}
        ${oe.mainStart([ie,1,1])}
          let output_indices = ${Oe.offsetToIndices(`(global_idx / ${ie}) * ${Q}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${ie}) {
            //process one block
            var word_offset: u32 = block * ${m.blockSize/G};
            ${dt()}
            for (var word: u32 = 0; word < ${q}; word += ${H}) {
              ${Zt()}
              for (var i: u32 = 0; i < ${H}; i++) {
                ${Et()}
                word_offset += ${8/G};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${Q}) {
            var output_value: ${Oe.type.value} = ${Oe.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${ie}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${Q};
            }
            ${Oe.setByIndices(`${Oe.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${m.blockSize};${m.bits};${G};${H};${V};${Q};${ie}`,inputDependencies:Array(d.length).fill("rank")},getRunData:()=>({outputs:[{dims:Z,dataType:j}],dispatchGroup:{x:J},programUniforms:re}),getShaderSource:ce}},xh=(d,m)=>{let g=d[0].dims,w=g.length,$=g[w-2],I=m.k,D=m.n,F=g.slice(0,w-2),U=E$1.size(F),q=d[1].dims[2]/4,j=d[0].dataType,G=he(m.k),H=he(q),V=F.concat([$,D]),Z=128,Q=D%8===0?8:D%4===0?4:1,J=Z/Q,ie=J*H*8,re=ie/G,se=ie/m.blockSize,X=E$1.size(V)/Q,ne=[],ce=[U,$,I/G],oe=E$1.convertShape(d[1].dims).slice();oe.splice(-1,1,q/H),ne.push(...W(ce)),ne.push(...W(oe)),ne.push(...W(d[2].dims)),d.length===4&&ne.push(...W(E$1.convertShape(d[3].dims)));let de=[U,$,D];ne.push(...W(de));let me=ge=>{let fe=ce.length,xe=P("a",d[0].dataType,fe,G),Fe=P("b",12,oe.length,H),Te=P("scales",d[2].dataType,d[2].dims.length),Oe=[xe,Fe,Te],Be=d.length===4?P("zero_points",12,d[3].dims.length):void 0;Be&&Oe.push(Be);let _t=de.length,Et=N$1("output",d[0].dataType,_t),dt=ve(d[0].dataType),Zt=()=>{switch(G){case 1:return`
          let a_data0 = vec4<${dt}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${dt}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${dt}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${dt}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${G}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${xe.type.value}, ${re}>;
        var<workgroup> inter_results: array<array<${Et.type.value}, ${J}>, ${Q}>;
        ${ge.declareVariables(...Oe,Et)}
        ${ge.mainStart([J,Q,1])}
          let output_indices = ${Et.offsetToIndices(`workgroup_index * ${Q}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${se} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${re};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${re}; a_offset += ${Z})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${xe.getByIndices(`${xe.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${xe.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${se} + local_id.x;
            ${Be?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${Be.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${dt}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${dt}(8);`}
            let scale = ${Te.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${Fe.getByIndices(`${Fe.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${m.blockSize/G};
            for (var i: u32 = 0; i < ${H}; i++) {
              ${Zt()}
              let b_value = ${H===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${dt}>(${Array.from({length:4},(Ye,bt)=>`${dt}(b_value_lower[${bt}]), ${dt}(b_value_upper[${bt}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${dt}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(Ye,bt)=>`${`dot(a_data${bt}, b_dequantized_values[${bt}])`}`).join(" + ")};
              word_offset += ${8/G};
            }
            workgroupBarrier();
          }

          if (local_idx < ${Q}) {
            var output_value: ${Et.type.value} = ${Et.type.value}(0);
            for (var b = 0u; b < ${J}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${Et.setByIndices(`${Et.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${m.blockSize};${G};${H};${J};${Q}`,inputDependencies:Array(d.length).fill("rank")},getRunData:()=>({outputs:[{dims:V,dataType:j}],dispatchGroup:{x:X},programUniforms:ne}),getShaderSource:me}},id=(d,m)=>{vh(d.inputs,m),m.blockSize===32&&d.adapterInfo.isVendor("intel")&&d.adapterInfo.isArchitecture("gen-12lp")?d.compute(xh(d.inputs,m)):d.compute($h(d.inputs,m))},ad=d=>te(d)}),Sh,Th,Ch,Ih,Ah,Eh,kh,Ph,ud,ld=L$1(()=>{ee(),ae(),ue(),Sh=d=>{if(!d||d.length<1)throw new Error("Too few inputs");if(d[0].dataType!==1&&d[0].dataType!==10)throw new Error("Input type must be float or float16.");if(d.length>=2){let m=d[0].dims.length*2===d[1].dims[0];if(d.length===4&&(m=d[3].dims[0]*2===d[1].dims[0]),!m)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},Th=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
            k = i32(${d.indicesGet("indices",$)}) - ${K("uniforms.pads",$,g)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${K("uniforms.x_shape",$,m)})) {
              break;
            }
            offset += k * i32(${K("uniforms.x_strides",$,m)});
        `;return`
          value = ${d.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${w}
            value = x[offset];
          }
      `},Ch=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
                k = i32(${d.indicesGet("indices",$)}) - ${K("uniforms.pads",$,g)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${K("uniforms.x_shape",$,m)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${K("uniforms.x_shape",$,m)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${K("uniforms.x_strides",$,m)});
            `;return`
              var offset = 0;
              var k = 0;
              ${w}
              value = x[offset];
          `},Ih=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
                k = i32(${d.indicesGet("indices",$)}) - ${K("uniforms.pads",$,g)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${K("uniforms.x_shape",$,m)})) {
                  k = i32(${K("uniforms.x_shape",$,m)}) - 1;
                }
                offset += k * i32(${K("uniforms.x_strides",$,m)});
            `;return`
              var offset = 0;
              var k = 0;
              ${w}
              value = x[offset];
          `},Ah=(d,m,g)=>{let w="";for(let $=m-1;$>=0;--$)w+=`
                k = i32(${d.indicesGet("indices",$)}) - ${K("uniforms.pads",$,g)};
                if (k < 0)  {
                  k += i32(${K("uniforms.x_shape",$,m)}]);
                }
                if (k >= i32(${K("uniforms.x_shape",$,m)})) {
                  k -= i32(${K("uniforms.x_shape",$,m)});
                }
                offset += k * i32(${K("uniforms.x_strides",$,m)});
            `;return`
              var offset = 0;
              var k = 0;
              ${w}
              value = x[offset];
          `},Eh=(d,m,g)=>{switch(g.mode){case 0:return Th(d,m,g.pads.length);case 1:return Ch(d,m,g.pads.length);case 2:return Ih(d,m,g.pads.length);case 3:return Ah(d,m,g.pads.length);default:throw new Error("Invalid mode")}},kh=(d,m)=>{let g=E$1.padShape(d[0].dims.slice(),m.pads),w=d[0].dims,$=E$1.size(g),I=[{type:12,data:$},{type:6,data:m.pads}],D=d.length>=3&&d[2].data;m.mode===0&&I.push({type:D?d[2].dataType:1,data:m.value}),I.push(...W(d[0].dims,g));let F=["rank"],U=q=>{let j=N$1("output",d[0].dataType,g.length),G=P("x",d[0].dataType,w.length),H=G.type.value,V=Eh(j,w.length,m),Z=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:m.pads.length}];return m.mode===0&&Z.push({name:"constant_value",type:D?H:"f32"}),`
            ${q.registerUniforms(Z).declareVariables(G,j)}
            ${q.mainStart()}
            ${q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${j.offsetToIndices("global_idx")};

            var value = ${H}(0);
            ${V}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${m.mode}${D}`,inputDependencies:F},getRunData:()=>({outputs:[{dims:g,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(E$1.size(g)/64)},programUniforms:I}),getShaderSource:U}},Ph=(d,m)=>{if(d.length>1){let g=d[1].getBigInt64Array(),w=d.length>=3&&d[2].data?d[2].dataType===10?d[2].getUint16Array()[0]:d[2].getFloat32Array()[0]:0,$=d[0].dims.length,I=new Int32Array(2*$).fill(0);if(d.length>=4){let F=d[3].getBigInt64Array();for(let U=0;U<F.length;U++)I[Number(F[U])]=Number(g[U]),I[Number(F[U])+$]=Number(g[U+F.length])}else g.forEach((F,U)=>I[Number(U)]=Number(F));let D=[];return I.forEach(F=>D.push(F)),{mode:m.mode,value:w,pads:D}}else return m},ud=(d,m)=>{Sh(d.inputs);let g=Ph(d.inputs,m);d.compute(kh(d.inputs,g),{inputs:[0]})}}),ln,dd,cd,pd,md,Oh,zh,fd,hd,gd,yd,bd,_d,wd,vd,$d,xd,Sd,Td,Cd=L$1(()=>{Ve(),ee(),ae(),ue(),ln=d=>{if(we.webgpu.validateInputContent&&(!d||d.length!==1))throw new Error("Pool ops requires 1 input.")},dd=(d,m,g)=>{let w=m.format==="NHWC",$=d.dims.slice();w&&$.splice(1,0,$.pop());let I=Object.hasOwnProperty.call(m,"dilations"),D=m.kernelShape.slice(),F=m.strides.slice(),U=I?m.dilations.slice():[],q=m.pads.slice();Dt.adjustPoolAttributes(g,$,D,F,U,q);let j=Dt.computePoolOutputShape(g,$,F,U,D,q,m.autoPad),G=Object.assign({},m);I?Object.assign(G,{kernelShape:D,strides:F,pads:q,dilations:U,cacheKey:m.cacheKey}):Object.assign(G,{kernelShape:D,strides:F,pads:q,cacheKey:m.cacheKey});let H=j.slice();return H.push(H.splice(1,1)[0]),[G,w?H:j]},cd=(d,m)=>{let g=m.format==="NHWC",w=E$1.size(d),$=E$1.size(m.kernelShape),I=[{type:12,data:w},{type:12,data:$}],D=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(m.kernelShape.length<=2){let F=m.kernelShape[m.kernelShape.length-1],U=m.strides[m.strides.length-1],q=m.pads[m.pads.length/2-1],j=m.pads[m.pads.length-1],G=!!(q+j);I.push({type:12,data:F},{type:12,data:U},{type:12,data:q},{type:12,data:j}),D.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let H=!1;if(m.kernelShape.length===2){let V=m.kernelShape[m.kernelShape.length-2],Z=m.strides[m.strides.length-2],Q=m.pads[m.pads.length/2-2],J=m.pads[m.pads.length-2];H=!!(Q+J),I.push({type:12,data:V},{type:12,data:Z},{type:12,data:Q},{type:12,data:J}),D.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[I,D,!0,G,H]}else{if(g)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let F=E$1.computeStrides(m.kernelShape);I.push({type:12,data:F},{type:12,data:m.pads},{type:12,data:m.strides}),D.push({name:"kernelStrides",type:"u32",length:F.length},{name:"pads",type:"u32",length:m.pads.length},{name:"strides",type:"u32",length:m.strides.length});let U=m.pads.reduce((q,j)=>q+j);return[I,D,!!U,!1,!1]}},pd=(d,m,g,w,$,I,D,F,U,q,j,G)=>{let H=$.format==="NHWC",V=m.type.value,Z=N$1("output",m.type.tensor,w);if($.kernelShape.length<=2){let Q="",J="",ie="",re=g-(H?2:1);if(j?Q=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${re}] = indices[${re}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${re}] < 0 || xIndices[${re}]
                      >= uniforms.x_shape[${re}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${m.indicesToOffset("xIndices")}];
                  ${I}
                }`:Q=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${re}] = indices[${re}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${m.indicesToOffset("xIndices")}];
                  ${I}
                }`,$.kernelShape.length===2){let se=g-(H?3:2);G?J=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${se}] = indices[${se}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${se}] < 0 || xIndices[${se}] >= uniforms.x_shape[${se}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:J=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${se}] = indices[${se}] * uniforms.sh - uniforms.phStart + j;
                `,ie=`
              }
            `}return`
            ${d.registerUniforms(U).declareVariables(m,Z)}

            ${d.mainStart()}
              ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${Z.offsetToIndices("global_idx")};
              var xIndices = ${Z.offsetToIndices("global_idx")};

              var value = ${V}(${F});
              var pad = 0;
              ${J}
              ${Q}
              ${ie}
              ${D}

              output[global_idx] = value;
            }`}else{if(H)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let Q=$.kernelShape.length,J=$.pads.length,ie="";return q?ie=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${m.indicesToOffset("xIndices")}];
                ${I}
              }`:ie=`
              }
              let x_val = x[${m.indicesToOffset("xIndices")}];
              ${I}
            `,`
            ${d.registerUniforms(U).declareVariables(m,Z)}

            ${d.mainStart()}
              ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${Z.offsetToIndices("global_idx")};
              var xIndices = ${Z.offsetToIndices("global_idx")};

              var offsets: array<u32, ${Q}>;

              var value = ${V}(${F});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${Q-1}u; j++) {
                  offsets[j] = offset / ${K("uniforms.kernelStrides","j",Q)};
                  offset -= offsets[j] * ${K("uniforms.kernelStrides","j",Q)};
                }
                offsets[${Q-1}] = offset;

                isPad = false;
                for (var j = ${g-Q}u; j < ${g}u; j++) {
                  xIndices[j] = indices[j] * ${K("uniforms.strides",`j - ${g-Q}u`,Q)}
                    + offsets[j - ${g-Q}u] - ${K("uniforms.pads","j - 2u",J)};
                  ${ie}
              }
              ${D}

              output[global_idx] = value;
            }`}},md=d=>`${d.format};${d.ceilMode};${d.autoPad};${d.kernelShape.length}`,Oh=d=>`${md(d)};${d.countIncludePad}`,zh=d=>`${md(d)};${d.storageOrder};${d.dilations}`,fd=d=>({format:d.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][d.auto_pad],ceilMode:d.ceil_mode,kernelShape:d.kernel_shape,strides:d.strides,pads:d.pads}),hd=(d,m,g,w)=>{let[$,I]=dd(m,w,g),D=P("x",m.dataType,m.dims.length),F=D.type.value,U="value += x_val;",q="";$.countIncludePad?q+=`value /= ${F}(uniforms.kernelSize);`:q+=`value /= ${F}(i32(uniforms.kernelSize) - pad);`;let[j,G,H,V,Z]=cd(I,$);j.push(...W(m.dims,I));let Q=["rank"];return{name:d,shaderCache:{hint:`${w.cacheKey};${H};${V};${Z}`,inputDependencies:Q},getRunData:()=>({outputs:[{dims:I,dataType:m.dataType}],dispatchGroup:{x:Math.ceil(E$1.size(I)/64)},programUniforms:j}),getShaderSource:J=>pd(J,D,m.dims.length,I.length,$,U,q,0,G,H,V,Z)}},gd=d=>{let m=d.count_include_pad!==0,g=fd(d);if(g.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let w={countIncludePad:m,...g,cacheKey:""};return{...w,cacheKey:Oh(w)}},yd=(d,m)=>{ln(d.inputs),d.compute(hd("AveragePool",d.inputs[0],!1,m))},bd={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},_d=d=>{let m=d.format;return{format:m,...bd,cacheKey:m}},wd=(d,m)=>{ln(d.inputs),d.compute(hd("GlobalAveragePool",d.inputs[0],!0,m))},vd=(d,m,g,w)=>{let[$,I]=dd(m,w,g),D=`
      value = max(x_val, value);
    `,F="",U=P("x",m.dataType,m.dims.length),q=["rank"],[j,G,H,V,Z]=cd(I,$);return j.push(...W(m.dims,I)),{name:d,shaderCache:{hint:`${w.cacheKey};${H};${V};${Z}`,inputDependencies:q},getRunData:()=>({outputs:[{dims:I,dataType:m.dataType}],dispatchGroup:{x:Math.ceil(E$1.size(I)/64)},programUniforms:j}),getShaderSource:Q=>pd(Q,U,m.dims.length,I.length,$,D,F,m.dataType===10?-65504:-1e5,G,H,V,Z)}},$d=(d,m)=>{ln(d.inputs),d.compute(vd("MaxPool",d.inputs[0],!1,m))},xd=d=>{let m=d.storage_order,g=d.dilations,w=fd(d);if(m!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(w.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let $={storageOrder:m,dilations:g,...w,cacheKey:""};return{...$,cacheKey:zh($)}},Sd=d=>{let m=d.format;return{format:m,...bd,cacheKey:m}},Td=(d,m)=>{ln(d.inputs),d.compute(vd("GlobalMaxPool",d.inputs[0],!0,m))}}),Bh,Mh,Id,Ad,Ed=L$1(()=>{ee(),ae(),Se(),ue(),Bh=(d,m)=>{if(d.length<2||d.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(d.length===3&&d[1].dims===d[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(d.length===3&&d[0].dataType!==d[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(d[0].dataType===6&&d.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(d[1].dims.length!==0&&d[1].dims.length!==1&&d[1].dims.length!==d[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(d.length>2){if(d[0].dataType!==d[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(d[1].dims.length!==d[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!d[1].dims.map((g,w)=>g===d[2].dims[w]).reduce((g,w)=>g&&w,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(m.blockSize>0){if(d[1].dims.length===0||d[1].dims.length===1&&d[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!d[1].dims.map(($,I)=>I===m.axis||$===d[0].dims[I]).reduce(($,I)=>$&&I,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(d[1].dims.length!==d[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let g=d[0].dims[m.axis],w=d[1].dims[m.axis];if(m.blockSize<Math.ceil(g/w)||m.blockSize>Math.ceil(g/(w-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},Mh=(d,m)=>{let g=E$1.normalizeAxis(m.axis,d[0].dims.length),w=d[0].dataType,$=w===3,I=d[0].dims,D=d[1].dataType,F=E$1.size(I),U=w===3||w===2,q=U?[Math.ceil(E$1.size(d[0].dims)/4)]:d[0].dims,j=d[1].dims,G=d.length>2?d[2]:void 0,H=G?U?[Math.ceil(E$1.size(G.dims)/4)]:G.dims:void 0,V=j.length===0||j.length===1&&j[0]===1,Z=V===!1&&j.length===1,Q=he(F),J=V&&(!U||Q===4),ie=J?Q:1,re=J&&!U?Q:1,se=P("input",U?12:w,q.length,re),X=P("scale",D,j.length),ne=G?P("zero_point",U?12:w,H.length):void 0,ce=N$1("output",D,I.length,ie),oe=[se,X];ne&&oe.push(ne);let de=[q,j];G&&de.push(H);let me=[{type:12,data:F/ie},{type:12,data:g},{type:12,data:m.blockSize},...W(...de,I)],ge=fe=>{let xe=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${fe.registerUniforms(xe).declareVariables(...oe,ce)}
      ${fe.mainStart()}
          ${fe.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${ce.offsetToIndices("global_idx")};

          // Set input x
          ${U?`
            let input = ${se.getByOffset("global_idx / 4")};
            let x_vec = ${$?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${ie===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${se.getByOffset("global_idx")};`};

          // Set scale input
          ${V?`let scale_value= ${X.getByOffset("0")}`:Z?`
            let scale_index = ${ce.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${X.getByOffset("scale_index")};`:`
            var scale_indices: ${X.type.indices} = output_indices;
            let index = ${X.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${X.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${X.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${ne?V?U?`
                let zero_point_input = ${ne.getByOffset("0")};
                let zero_point_vec =  ${$?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${ne.getByOffset("0")}`:Z?U?`
                let zero_point_index = ${ce.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${ne.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${$?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${ce.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${ne.getByOffset("zero_point_index")};`:U?`
                let zero_point_offset = ${X.indicesToOffset("scale_indices")};
                let zero_point_input = ${ne.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${$?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${ne.getByIndices("scale_indices")};`:`let zero_point_value = ${U?$?"i32":"u32":se.type.value}(0);`};
      // Compute and write output
      ${ce.setByOffset("global_idx",`${ce.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:m.cacheKey,inputDependencies:ne?["rank","rank","rank"]:["rank","rank"]},getShaderSource:ge,getRunData:()=>({outputs:[{dims:I,dataType:D}],dispatchGroup:{x:Math.ceil(F/ie/64),y:1,z:1},programUniforms:me})}},Id=(d,m)=>{Bh(d.inputs,m),d.compute(Mh(d.inputs,m))},Ad=d=>te({axis:d.axis,blockSize:d.blockSize})}),Rh,Uh,kd,Pd=L$1(()=>{Ve(),ee(),ue(),Rh=(d,m,g)=>{let w=d===m,$=d<m&&g<0,I=d>m&&g>0;if(w||$||I)throw new Error("Range these inputs' contents are invalid.")},Uh=(d,m,g,w)=>{let $=Math.abs(Math.ceil((m-d)/g)),I=[$],D=$,F=[{type:12,data:D},{type:w,data:d},{type:w,data:g},...W(I)],U=q=>{let j=N$1("output",w,I.length),G=j.type.value,H=[{name:"outputSize",type:"u32"},{name:"start",type:G},{name:"delta",type:G}];return`
        ${q.registerUniforms(H).declareVariables(j)}
        ${q.mainStart()}
        ${q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${G}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${w}`},getShaderSource:U,getRunData:()=>({outputs:[{dims:I,dataType:w}],dispatchGroup:{x:Math.ceil(D/64)},programUniforms:F})}},kd=d=>{let m=0,g=0,w=0;d.inputs[0].dataType===6?(m=d.inputs[0].getInt32Array()[0],g=d.inputs[1].getInt32Array()[0],w=d.inputs[2].getInt32Array()[0]):d.inputs[0].dataType===1&&(m=d.inputs[0].getFloat32Array()[0],g=d.inputs[1].getFloat32Array()[0],w=d.inputs[2].getFloat32Array()[0]),we.webgpu.validateInputContent&&Rh(m,g,w),d.compute(Uh(m,g,w,d.inputs[0].dataType),{inputs:[]})}}),Nh,Vh,Od,zd,Dd=L$1(()=>{ee(),ae(),Se(),ue(),Nh=(d,m,g,w)=>{if(d!=="none"&&w!=="i32"&&w!=="u32"&&w!=="f32")throw new Error(`Input ${w} is not supported with reduction ${d}.`);let $=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,I=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${m}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(d){case"none":return`${m}=${g};`;case"add":return w==="i32"||w==="u32"?`atomicAdd(&${m}, bitcast<${w}>(${g}));`:`
              ${$}bitcast<${w}>(oldValue) + (${g})${I}`;case"max":return w==="i32"||w==="u32"?`atomicMax(&${m}, bitcast<${w}>(${g}));`:`
                ${$}max(bitcast<f32>(oldValue), (${g}))${I}`;case"min":return w==="i32"||w==="u32"?`atomicMin(&${m}, bitcast<${w}>(${g}));`:`${$}min(bitcast<${w}>(oldValue), (${g}))${I}`;case"mul":return`${$}(bitcast<${w}>(oldValue) * (${g}))${I}`;default:throw new Error(`Reduction ${d} is not supported.`)}},Vh=(d,m)=>{let g=d[0].dims,w=d[1].dims,$=g,I=1,D=Math.ceil(E$1.sizeToDimension(w,w.length-1)/I),F=w[w.length-1],U=E$1.sizeFromDimension(g,F),q=[{type:12,data:D},{type:12,data:F},{type:12,data:U},...W(d[1].dims,d[2].dims,$)],j=G=>{let H=P("indices",d[1].dataType,d[1].dims.length),V=P("updates",d[2].dataType,d[2].dims.length,I),Z=m.reduction!=="none"&&m.reduction!==""?as("output",d[0].dataType,$.length):N$1("output",d[0].dataType,$.length,I);return`
      ${G.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(H,V,Z)}
      ${G.mainStart()}
        ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var data_offset = 0u;
  let indices_start = uniforms.last_index_dimension * global_idx;
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${d[0].dims.length===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${Nh(m.reduction,"output[data_offset + i]","value",Z.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${m.cacheKey}_${m.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:$,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(D/64)},programUniforms:q}),getShaderSource:j}},Od=d=>te({reduction:d.reduction}),zd=(d,m)=>{d.compute(Vh(d.inputs,m),{inputs:[d.inputs[1],d.inputs[2]],outputs:[]})}}),Lh,Wh,Gh,Bd,Hh,Fh,qh,jh,Kh,Zh,Qh,Yh,Md,Xh,Jh,eg,tg,rg,Rd,Ud,Nd=L$1(()=>{ee(),ae(),Se(),ue(),Lh=(d,m)=>{if(d.every(g=>g>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),d.length>0){if(m.mode==="linear"){if(!(d.length===2||d.length===3||d.length===4&&d[0]===1&&d[1]===1||d.length===4&&d[0]===1&&d[3]===1||d.length===5&&d[0]===1&&d[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(m.mode==="cubic"&&!(d.length===2||d.length===4&&d[0]===1&&d[1]===1||d.length===4&&d[0]===1&&d[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},Wh=(d,m,g)=>{m.every($=>$>=0&&$<g||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let w=new Array(g).fill(1);return m.forEach(($,I)=>w[$]=d[I]),w},Gh=(d,m,g,w,$,I)=>{let[D,F,U]=g>10?[1,2,3]:[-1,d.length>1?1:-1,-1],q=d[0].dims.length;if(D>0&&d.length>D&&d[D].dims.length>0)d[D].getFloat32Array().forEach(j=>I.push(j));else if(m.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(F>0&&d.length>F&&d[F].dims.length===1&&d[F].dims[0]>0){if(d[F].getFloat32Array().forEach(j=>w.push(j)),w.length!==0&&w.length!==q&&g>=18&&w.length!==m.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");Lh(w,m),m.axes.length>0&&Wh(w,m.axes,q).forEach((j,G)=>w[G]=j)}if(U>0&&d.length>U&&d[U].dims.length===1&&d[U].dims[0]>0&&(d[U].getBigInt64Array().forEach(j=>$.push(Number(j))),$.length!==0&&$.length!==q&&g>=18&&$.length!==m.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(m.axes.length>0){if(w.length!==0&&w.length!==m.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if($.length!==0&&$.length!==m.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof w<"u"&&typeof $<"u"&&w.length>0&&$.length>q)throw new Error("Resize requires only of scales or sizes to be specified")},Bd=(d,m,g,w)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${d}) * (${m});
  let whole = ${w}(big / (${g}));
  let fract = ${w}(big % (${g})) / ${w}(${g});
  return whole + fract;
`,Hh=(d,m)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${m} { `+(()=>{switch(d){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${m}(xResized) / ${m}(xScale);
          } else {
            ${Bd("xResized","lengthOriginal","lengthResized",m)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${m}(xResized) + 0.5) / ${m}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${m}(xResized) + 0.5) / ${m}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${Bd("xResized","lengthOriginal - 1","lengthResized - 1",m)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${m}(roiStart) * ${m}(lengthOriginal - 1) +
                        (${m}(xResized) * ${m}(roiEnd - roiStart) * ${m}(lengthOriginal - 1)) /
                        ${m}(lengthResized - 1);
                  } else {
                    return 0.5 * ${m}(roiStart + roiEnd) * ${m}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${m}xScale * ${m}(lengthResized);
                  const adjustment = ${m}(lengthResized) / outputWidth;
                  const center = ${m}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${m}(xResized) + 0.5) / ${m}(xScale)) - 0.5;`;case"half_pixel":return`return ((${m}(xResized) + 0.5) / ${m}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${d} is not supported`)}})()+"}",Fh=(d,m,g)=>`fn getNearestPixelFromOriginal(xOriginal: ${g}, isDownSample: bool) -> ${g} {`+(()=>{switch(d){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";case"simple":default:if(m<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${d} is not supported`)}})()+"}",qh=(d,m,g)=>{let w=new Array(g).fill(0).concat(new Array(g).fill(1)),$=d.length===0?w:d.slice();return m.length>0?(m.forEach((I,D)=>{w[I]=$[D],w[D+g]=$[m.length+D]}),w):$},jh=(d,m,g,w)=>{let $=[];if(g.length>0)if(w.length>0){if(d.forEach(I=>$.push(I)),Math.max(...w)>d.length)throw new Error("axes is out of bound");w.forEach((I,D)=>$[I]=g[D])}else g.forEach(I=>$.push(I));else{if(m.length===0)throw new Error("Resize requires either scales or sizes.");$=d.map((I,D)=>Math.round(I*m[D]))}return $},Kh=(d,m,g)=>{let w=(()=>{switch(g.keepAspectRatioPolicy){case"not_larger":return g.axes.length>0?Math.min(...g.axes.map(I=>m[I]),Number.MAX_VALUE):Math.min(...m,Number.MAX_VALUE);case"not_smaller":return g.axes.length>0?Math.max(...g.axes.map(I=>m[I]),Number.MIN_VALUE):Math.max(...m,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${g.keepAspectRatioPolicy} is not supported`)}})();m.fill(1,0,m.length);let $=d.slice();return g.axes.length>0?(g.axes.forEach(I=>m[I]=w),g.axes.forEach(I=>$[I]=Math.round(d[I]*m[I]))):(m.fill(w,0,m.length),$.forEach((I,D)=>$[D]=Math.round(I*m[D]))),$},Zh=(d,m,g,w,$)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${d.type.indices}) -> array<${d.type.value}, ${g.length}> {
      var original_indices: array<${d.type.value}, ${g.length}>;
      for (var i:u32 = 0; i < ${g.length}; i++) {
        var output_index = ${d.indicesGet("output_indices","i")};
        var scale = ${K("uniforms.scales","i",w)};
        var roi_low = ${K("uniforms.roi","i",$)};
        var roi_hi = ${K("uniforms.roi",`i + ${m.length}`,$)};
        if (scale == 1.0) {
          original_indices[i] = ${d.type.value}(output_index);
        } else {
          var input_shape_i = ${K("uniforms.input_shape","i",m.length)};
          var output_shape_i = ${K("uniforms.output_shape","i",g.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,Qh=(d,m,g,w,$,I,D)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${m.type.indices}) -> ${d.type.indices} {
      var input_indices: ${d.type.indices};
      for (var i:u32 = 0; i < ${w.length}; i++) {
        var output_index = ${m.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${K("uniforms.scales","i",$)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${K("uniforms.roi","i",I)};
          var roi_hi = ${K("uniforms.roi",`i + ${g.length}`,I)};
          var input_shape_i = ${K("uniforms.input_shape","i",g.length)};
          var output_shape_i = ${K("uniforms.output_shape","i",w.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${D} || (original_idx >= 0 && original_idx < ${m.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${m.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${d.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,Yh=(d,m)=>`
    fn checkInputIndices(input_indices: ${d.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${m.length}; i++) {
        var input_index = ${d.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${K("uniforms.input_shape","i",m.length)}) {
          return false;
        }
      }
      return true;
    }`,Md=(d,m,g,w)=>d.rank>w?`
    ${d.indicesSet("input_indices",m,"channel")};
    ${d.indicesSet("input_indices",g,"batch")};
`:"",Xh=(d,m,g,w,$)=>{let[I,D,F,U]=g.length===2?[-1,0,1,-1]:[0,2,3,1],q=d.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${q} {
      var input_indices: ${d.type.indices};
      ${d.indicesSet("input_indices",D,`max(0, min(row, ${g[D]} - 1))`)};
      ${d.indicesSet("input_indices",F,`max(0, min(col, ${g[F]} - 1))`)};
      ${Md(d,U,I,2)}
      return ${d.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${m.type.indices}) -> ${q} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${q} = originalIndices[${D}];
      var col:${q} = originalIndices[${F}];
      ${w?`if (row < 0 || row > (${g[D]} - 1) || col < 0 || col > (${g[F]} - 1)) {
        return ${$};
      }`:""};
      row = max(0, min(row, ${g[D]} - 1));
      col = max(0, min(col, ${g[F]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${g.length>2?`u32(originalIndices[${U}])`:"0"};
      var batch: u32 =  ${g.length>2?`u32(originalIndices[${I}])`:"0"};
      var x11: ${q} = getInputValue(batch, channel, row1, col1);
      var x12: ${q} = getInputValue(batch, channel, row1, col2);
      var x21: ${q} = getInputValue(batch, channel, row2, col1);
      var x22: ${q} = getInputValue(batch, channel, row2, col2);
      var dx1: ${q} = abs(row - ${q}(row1));
      var dx2: ${q} = abs(${q}(row2) - row);
      var dy1: ${q} = abs(col - ${q}(col1));
      var dy2: ${q} = abs(${q}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},Jh=(d,m,g,w,$,I,D,F,U,q)=>{let j=g.length===2,[G,H]=j?[0,1]:[2,3],V=d.type.value,Z=Q=>{let J=Q===G?"row":"col";return`
      fn ${J}CubicInterpolation(input_indices: ${d.type.indices}, output_indices: ${m.type.indices}) -> ${V} {
        var output_index = ${m.indicesGet("output_indices",Q)};
        var originalIdx: ${V} = getOriginalCoordinateFromResizedCoordinate(output_index, ${$[Q]},
        ${w[Q]}, ${g[Q]}, ${I[Q]}, ${I[Q]} + ${g.length});
        var fractOriginalIdx: ${V} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${F} && (originalIdx < 0 || originalIdx > (${g[Q]} - 1))) {
          return ${U};
        }
        var data: array<${V}, 4> = array<${V}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${J}: ${V} = originalIdx + ${V}(i);
          if (${J} < 0 || ${J} >= ${g[Q]}) {
            ${q?`coefs[i + 1] = 0.0;
                        continue;`:F?`return ${U};`:`${J} = max(0, min(${J}, ${g[Q]} - 1));`};
          }
        var input_indices_copy: ${d.type.indices} = input_indices;
          ${d.indicesSet("input_indices_copy",Q,`u32(${J})`)};
          data[i + 1] = ${Q===G?d.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${Z(G)};
    ${Z(H)};
  fn getCubicInterpolationCoefs(s: ${V}) -> array<${V}, 4> {
    var absS = abs(s);
    var coeffs: array<${V}, 4> = array<${V}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${V} = 1.0 - absS;
    var twoMinusAbsS: ${V} = 2.0 - absS;
    var onePlusAbsS: ${V} = 1.0 + absS;
    coeffs[0] = ((${D} * onePlusAbsS - 5 * ${D}) * onePlusAbsS + 8 * ${D}) * onePlusAbsS - 4 * ${D};
    coeffs[1] = ((${D} + 2) * absS - (${D} + 3)) * absS * absS + 1;
    coeffs[2] = ((${D} + 2) * oneMinusAbsS - (${D} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${D} * twoMinusAbsS - 5 * ${D}) * twoMinusAbsS + 8 * ${D}) * twoMinusAbsS - 4 * ${D};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${V}, 4>, coefs: array<${V}, 4>) -> ${V} {
    var coefsSum: ${V} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${m.type.indices}) -> ${V} {
    var input_indices: ${d.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},eg=(d,m,g,w,$)=>{let[I,D,F,U,q]=g.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],j=d.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${j} {
      var input_indices: ${d.type.indices};
      ${d.indicesSet("input_indices",D,`max(0, min(depth, ${g[D]} - 1))`)};
      ${d.indicesSet("input_indices",F,`max(0, min(height, ${g[F]} - 1))`)};
      ${d.indicesSet("input_indices",U,`max(0, min(width, ${g[U]} - 1))`)};
      ${Md(d,q,I,3)}
      return ${d.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${m.type.indices}) -> ${j} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${j} = originalIndices[${D}];
      var height:${j} = originalIndices[${F}];
      var width:${j} = originalIndices[${U}];
      ${w?`if (depth < 0 || depth > (${g[D]} - 1) || height < 0 || height > (${g[F]} - 1) || width < 0 || (width > ${g[U]} - 1)) {
      return ${$};
        }`:""};

    depth = max(0, min(depth, ${g[D]} - 1));
      height = max(0, min(height, ${g[F]} - 1));
      width = max(0, min(width, ${g[U]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${g.length>3?`u32(originalIndices[${q}])`:"0"};
      var batch: u32 =  ${g.length>3?`u32(originalIndices[${I}])`:"0"};

      var x111: ${j} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${j} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${j} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${j} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${j} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${j} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${j} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${j} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${j} = abs(depth - ${j}(depth1));
      var dx2: ${j} = abs(${j}(depth2) - depth);
      var dy1: ${j} = abs(height - ${j}(height1));
      var dy2: ${j} = abs(${j}(height2) - height);
      var dz1: ${j} = abs(width - ${j}(width1));
      var dz2: ${j} = abs(${j}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},tg=(d,m,g,w,$,I)=>{let D=d.dims,F=qh(I,m.axes,D.length),U=jh(D,w,$,m.axes),q=w.slice();w.length===0&&(q=D.map((re,se)=>re===0?1:U[se]/re),m.keepAspectRatioPolicy!=="stretch"&&(U=Kh(D,q,m)));let j=N$1("output",d.dataType,U.length),G=P("input",d.dataType,D.length),H=E$1.size(U),V=D.length===U.length&&D.every((re,se)=>re===U[se]),Z=m.coordinateTransformMode==="tf_crop_and_resize",Q=m.extrapolationValue,J=G.type.value,ie=re=>`
      ${V?"":`
      ${Hh(m.coordinateTransformMode,J)};
      ${(()=>{switch(m.mode){case"nearest":return`
              ${Yh(G,D)};
              ${Fh(m.nearestMode,g,J)};
              ${Qh(G,j,D,U,q.length,F.length,Z)};
              `;case"linear":return`
              ${Zh(j,D,U,q.length,F.length)};
              ${(()=>{if(D.length===2||D.length===4)return`${Xh(G,j,D,Z,Q)}`;if(D.length===3||D.length===5)return`${eg(G,j,D,Z,Q)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(D.length===2||D.length===4)return`${Jh(G,j,D,U,q,F,m.cubicCoeffA,Z,m.extrapolationValue,m.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${re.registerUniform("output_size","u32").registerUniform("scales","f32",q.length).registerUniform("roi","f32",F.length).declareVariables(G,j)}
      ${re.mainStart()}
        ${re.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${V?"output[global_idx] = input[global_idx];":`
        let output_indices = ${j.offsetToIndices("global_idx")};
        var input_indices: ${G.type.indices};
        ${(()=>{switch(m.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${G.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${m.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${D.length===2||D.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${m.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${m.cacheKey}|${g}|${q.length>0?m.mode==="cubic"?q:q.length:""}|${$.length>0?$:""}|${F.length>0?F:""}|${V}|${m.mode==="nearest"?D.length:D}`,inputDependencies:["rank"]},getShaderSource:ie,getRunData:()=>({outputs:[{dims:U,dataType:d.dataType}],dispatchGroup:{x:Math.ceil(H/64)},programUniforms:[{type:12,data:H},{type:1,data:q},{type:1,data:F},...W(D,U)]})}},rg=d=>{let m=d.customDataBuffer;return new Uint32Array(m,m.byteOffset,1)[0]},Rd=(d,m)=>{let g=[],w=[],$=[],I=rg(d);if(m.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");Gh(d.inputs,m,I,g,w,$),d.compute(tg(d.inputs[0],m,I,g,w,$),{inputs:[0]})},Ud=d=>{let m=d.antialias,g=d.axes,w=d.coordinateTransformMode,$=d.cubicCoeffA,I=d.excludeOutside!==0,D=d.extrapolationValue,F=d.keepAspectRatioPolicy,U=d.mode,q=d.nearestMode===""?"simple":d.nearestMode;return te({antialias:m,axes:g,coordinateTransformMode:w,cubicCoeffA:$,excludeOutside:I,extrapolationValue:D,keepAspectRatioPolicy:F,mode:U,nearestMode:q})}}),ng,og,Vd,Ld=L$1(()=>{ee(),ae(),ue(),ng=d=>{if(!d||d.length<3)throw new Error("layerNorm requires at least 3 inputs.");let m=d[0],g=d[1],w=d[2];if(m.dataType!==g.dataType||m.dataType!==w.dataType)throw new Error("All inputs must have the same data type");if(m.dims.length!==3&&m.dims.length!==2)throw new Error("Input must be 2D or 3D");if(g.dims.length!==3&&g.dims.length!==2)throw new Error("Skip must be 2D or 3D");let $=m.dims[m.dims.length-1],I=m.dims[m.dims.length-2];if(g.dims[g.dims.length-1]!==$)throw new Error("Skip must have the same hidden size as input");if(g.dims[g.dims.length-2]!==I)throw new Error("Skip must have the same sequence length as input");if(w.dims.length!==1)throw new Error("Gamma must be 1D");if(w.dims[w.dims.length-1]!==$)throw new Error("Gamma must have the same hidden size as input");if(d.length>3){let D=d[3];if(D.dims.length!==1)throw new Error("Beta must be 1D");if(D.dims[D.dims.length-1]!==$)throw new Error("Beta must have the same hidden size as input")}if(d.length>4){let D=d[4];if(D.dims.length!==1)throw new Error("Bias must be 1D");if(D.dims[D.dims.length-1]!==$)throw new Error("Bias must have the same hidden size as input")}},og=(d,m,g,w)=>{let $=m.simplified,I=d[0].dims,D=E$1.size(I),F=I,U=D,q=I.slice(-1)[0],j=w?I.slice(0,-1).concat(1):[],G=!$&&d.length>3,H=d.length>4,V=w&&g>1,Z=w&&g>2,Q=g>3,J=64,ie=he(q),re=[{type:12,data:U},{type:12,data:ie},{type:12,data:q},{type:1,data:m.epsilon}],se=ne=>{let ce=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],oe=[P("x",d[0].dataType,d[0].dims,ie),P("skip",d[1].dataType,d[1].dims,ie),P("gamma",d[2].dataType,d[2].dims,ie)];G&&oe.push(P("beta",d[3].dataType,d[3].dims,ie)),H&&oe.push(P("bias",d[4].dataType,d[4].dims,ie)),oe.push(N$1("output",d[0].dataType,F,ie)),V&&oe.push(N$1("mean_output",1,j)),Z&&oe.push(N$1("inv_std_output",1,j)),Q&&oe.push(N$1("input_skip_bias_sum",d[0].dataType,F,ie));let de=ve(d[0].dataType),me=ve(1,ie);return`

      ${ne.registerUniforms(ce).declareVariables(...oe)}
      var<workgroup> sum_shared : array<${me}, ${J}>;
      var<workgroup> sum_squared_shared : array<${me}, ${J}>;

      ${ne.mainStart([J,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${J};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${J};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${J-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${H?"bias[offset1d + i]":de+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${Q?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${Mt(de,ie,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${J};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${je("sum",ie)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${je("square_sum",ie)} / f32(uniforms.hidden_size) ${$?"":"- mean * mean"} + uniforms.epsilon);
        ${V?"mean_output[global_idx] = mean;":""}
        ${Z?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${$?"":`- ${de}(mean)`}) *
            ${de}(inv_std_dev) * gamma[offset1d + i]
            ${G?"+ beta[offset1d + i]":""};
        }
      }`},X=[{dims:F,dataType:d[0].dataType}];return g>1&&X.push({dims:j,dataType:1}),g>2&&X.push({dims:j,dataType:1}),g>3&&X.push({dims:I,dataType:d[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${ie};${V};${Z};${Q}`,inputDependencies:d.map((ne,ce)=>"type")},getShaderSource:se,getRunData:()=>({outputs:X,dispatchGroup:{x:Math.ceil(U/q)},programUniforms:re})}},Vd=(d,m)=>{ng(d.inputs);let g=[0];d.outputCount>1&&g.push(-3),d.outputCount>2&&g.push(-3),d.outputCount>3&&g.push(3),d.compute(og(d.inputs,m,d.outputCount,!1),{outputs:g})}}),ig,dn,ag,Wd,sg,ug,Gd,Hd,Fd=L$1(()=>{ee(),ae(),Se(),ue(),ig=(d,m)=>{if(!d||d.length<1)throw new Error("too few inputs");if(m.axes.length!==0){if(m.axes.length!==m.starts.length||m.axes.length!==m.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(m.starts.length!==m.ends.length)throw new Error("starts and ends must have the same length");d.slice(1).forEach((g,w)=>{if(d[w+1].dataType!==6&&d[w+1].dataType!==7)throw new Error(`Input ${w} must be an array of int32 or int64`)})},dn=(d,m)=>{let g=[];if(d.length>m)if(d[m].dataType===7)d[m].getBigInt64Array().forEach(w=>g.push(Number(w)));else if(d[m].dataType===6)d[m].getInt32Array().forEach(w=>g.push(Number(w)));else throw new Error(`Input ${m} must be an array of int32 or int64`);return g},ag=(d,m)=>{if(d.length>1){let g=dn(d,1),w=dn(d,2),$=dn(d,3);return $.length===0&&($=[...Array(d[0].dims.length).keys()]),te({starts:g,ends:w,axes:$})}else return m},Wd=(d,m,g,w,$)=>{let I=d;return d<0&&(I+=g[w[m]]),$[m]<0?Math.max(0,Math.min(I,g[w[m]]-1)):Math.max(0,Math.min(I,g[w[m]]))},sg=(d,m,g)=>`fn calculateInputIndices(output_indices: ${m.type.indices}) -> ${d.type.indices} {
          var input_indices: ${d.type.indices};
          var carry = 0u;
          for (var i = ${g.length-1}; i >= 0; i--) {
            let input_shape_i = ${K("uniforms.input_shape","i",g.length)};
            let steps_i = ${K("uniforms.steps","i",g.length)};
            let signs_i = ${K("uniforms.signs","i",g.length)};
            let starts_i = ${K("uniforms.starts","i",g.length)};
            var output_index = ${m.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${d.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,ug=(d,m)=>{let g=d[0].dims,w=E$1.size(g),$=m.axes.length>0?E$1.normalizeAxes(m.axes,g.length):[...Array(g.length).keys()],I=dn(d,4);I.forEach(ie=>ie!==0||(()=>{throw new Error("step cannot be 0")})),I.length===0&&(I=Array($.length).fill(1));let D=m.starts.map((ie,re)=>Wd(ie,re,g,$,I)),F=m.ends.map((ie,re)=>Wd(ie,re,g,$,I));if($.length!==D.length||$.length!==F.length)throw new Error("start, ends and axes should have the same number of elements");if($.length!==g.length)for(let ie=0;ie<g.length;++ie)$.includes(ie)||(D.splice(ie,0,0),F.splice(ie,0,g[ie]),I.splice(ie,0,1));let U=I.map(ie=>Math.sign(ie));I.forEach((ie,re,se)=>{if(ie<0){let X=(F[re]-D[re])/ie,ne=D[re],ce=ne+X*I[re];D[re]=ce,F[re]=ne,se[re]=-ie}});let q=g.slice(0);$.forEach((ie,re)=>{q[ie]=Math.ceil((F[ie]-D[ie])/I[ie])});let j={dims:q,dataType:d[0].dataType},G=N$1("output",d[0].dataType,q.length),H=P("input",d[0].dataType,d[0].dims.length),V=E$1.size(q),Z=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:D.length},{name:"signs",type:"i32",length:U.length},{name:"steps",type:"u32",length:I.length}],Q=[{type:12,data:V},{type:12,data:D},{type:6,data:U},{type:12,data:I},...W(d[0].dims,q)],J=ie=>`
      ${ie.registerUniforms(Z).declareVariables(H,G)}
        ${sg(H,G,g)}
        ${ie.mainStart()}
          ${ie.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${G.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${G.setByOffset("global_idx",H.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${U.length}_${D.length}_${I.length}`,inputDependencies:["rank"]},getShaderSource:J,getRunData:()=>({outputs:[j],dispatchGroup:{x:Math.ceil(w/64)},programUniforms:Q})}},Gd=(d,m)=>{ig(d.inputs,m);let g=ag(d.inputs,m);d.compute(ug(d.inputs,g),{inputs:[0]})},Hd=d=>{let m=d.starts,g=d.ends,w=d.axes;return te({starts:m,ends:g,axes:w})}}),lg,dg,qd,jd,Kd=L$1(()=>{ee(),ae(),Se(),ct(),ue(),lg=d=>{if(!d||d.length!==1)throw new Error("Softmax op requires 1 input.")},dg=(d,m)=>{let g=d.inputs[0],w=g.dims,$=E$1.size(w),I=w.length,D=E$1.normalizeAxis(m.axis,I),F=D<w.length-1,U,q=[];F?(q=Array.from({length:I},(oe,de)=>de),q[D]=I-1,q[I-1]=D,U=d.compute(Pe(g,q),{inputs:[g],outputs:[-1]})[0]):U=g;let j=U.dims,G=j[I-1],H=$/G,V=he(G),Z=G/V,Q=64;H===1&&(Q=256);let J=(oe,de)=>de===4?`max(max(${oe}.x, ${oe}.y), max(${oe}.z, ${oe}.w))`:de===2?`max(${oe}.x, ${oe}.y)`:de===3?`max(max(${oe}.x, ${oe}.y), ${oe}.z)`:oe,ie=P("x",U.dataType,U.dims,V),re=N$1("result",U.dataType,U.dims,V),se=ie.type.value,X=ve(U.dataType)==="f32"?`var threadMax = ${se}(-3.402823e+38f);`:`var threadMax = ${se}(-65504.0h);`,ne=oe=>`
      var<workgroup> rowMaxShared : ${se};
      var<workgroup> rowSumShared : ${se};
      var<workgroup> threadShared : array<${se}, ${Q}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${se} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${se}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${oe.registerUniform("packedCols","i32").declareVariables(ie,re)}
      ${oe.mainStart(Q)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${Q};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${X}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${se}(${J("threadShared[0]",V)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${se}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${se}(${je("threadShared[0]",V)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          // max operation protects against NaN since all values should be >=0
          value = max(value, ${se}(0.0));
          setValue(row, col, row_stride, value);
        }
      }`,ce=d.compute({name:"Softmax",shaderCache:{hint:`${V};${Q}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:j,dataType:U.dataType}],dispatchGroup:{x:H},programUniforms:[{type:6,data:Z}]}),getShaderSource:ne},{inputs:[U],outputs:[F?-1:0]})[0];F&&d.compute(Pe(ce,q),{inputs:[ce]})},qd=(d,m)=>{lg(d.inputs),dg(d,m)},jd=d=>te({axis:d.axis})}),Zd,cg,pg,mg,Qd,Yd=L$1(()=>{ee(),ae(),ue(),Zd=d=>Array.from(d.getBigInt64Array(),Number),cg=d=>{if(!d||d.length!==2)throw new Error("Tile requires 2 inputs.");if(d[0].dataType!==1&&d[0].dataType!==10&&d[0].dataType!==6&&d[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(d[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(d[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(Zd(d[1]).length!==d[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},pg=(d,m)=>{let g=[];for(let w=0;w<d.length;++w)g.push(d[w]*m[w]);return g},mg=(d,m)=>{let g=d[0].dims,w=m??Zd(d[1]),$=pg(g,w),I=E$1.size($),D=d[0].dataType,F=P("input",D,g.length),U=N$1("output",D,$.length),q=j=>`
      const inputShape = ${F.indices(...g)};
      ${j.registerUniform("output_size","u32").declareVariables(F,U)}
      ${j.mainStart()}
      ${j.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${U.offsetToIndices("global_idx")};
      var input_indices: ${F.type.indices};
      for (var i = 0; i < ${g.length}; i++) {
        let input_dim_i = ${F.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${U.indicesGet("output_indices","i")}  % input_dim_i;

        ${F.indicesSet("input_indices","i","input_dim_value")}
      }
      ${U.setByOffset("global_idx",F.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${w}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:$,dataType:d[0].dataType}],dispatchGroup:{x:Math.ceil(I/64)},programUniforms:[{type:12,data:I},...W(d[0].dims,$)]}),getShaderSource:q}},Qd=d=>{cg(d.inputs),d.compute(mg(d.inputs),{inputs:[0]})}}),fg,hg,Xd,Jd=L$1(()=>{ee(),ae(),ue(),fg=(d,m,g,w,$)=>{let I=N$1("output_data",$,g.length,4),D=P("a_data",m[1].dataType,m[1].dims.length,4),F=P("b_data",m[2].dataType,m[2].dims.length,4),U=P("c_data",m[0].dataType,m[0].dims.length,4),q,j=(G,H,V)=>`select(${H}, ${G}, ${V})`;if(!w)q=I.setByOffset("global_idx",j(D.getByOffset("global_idx"),F.getByOffset("global_idx"),U.getByOffset("global_idx")));else{let G=(H,V,Z="")=>{let Q=`a_data[index_a${V}][component_a${V}]`,J=`b_data[index_b${V}][component_b${V}]`,ie=`bool(c_data[index_c${V}] & (0xffu << (component_c${V} * 8)))`;return`
            let output_indices${V} = ${I.offsetToIndices(`global_idx * 4u + ${V}u`)};
            let offset_a${V} = ${D.broadcastedIndicesToOffset(`output_indices${V}`,I)};
            let offset_b${V} = ${F.broadcastedIndicesToOffset(`output_indices${V}`,I)};
            let offset_c${V} = ${U.broadcastedIndicesToOffset(`output_indices${V}`,I)};
            let index_a${V} = offset_a${V} / 4u;
            let index_b${V} = offset_b${V} / 4u;
            let index_c${V} = offset_c${V} / 4u;
            let component_a${V} = offset_a${V} % 4u;
            let component_b${V} = offset_b${V} % 4u;
            let component_c${V} = offset_c${V} % 4u;
            ${H}[${V}] = ${Z}(${j(Q,J,ie)});
          `};$===9?q=`
            var data = vec4<u32>(0);
            ${G("data",0,"u32")}
            ${G("data",1,"u32")}
            ${G("data",2,"u32")}
            ${G("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:q=`
            ${G("output_data[global_idx]",0)}
            ${G("output_data[global_idx]",1)}
            ${G("output_data[global_idx]",2)}
            ${G("output_data[global_idx]",3)}
          `}return`
        ${d.registerUniform("vec_size","u32").declareVariables(U,D,F,I)}
        ${d.mainStart()}
        ${d.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${q}
      }`},hg=d=>{let m=d[1].dims,g=d[2].dims,w=d[0].dims,$=d[1].dataType,I=!(E$1.areEqual(m,g)&&E$1.areEqual(g,w)),D=m,F=E$1.size(m);if(I){let q=tt.calcShape(tt.calcShape(m,g,!1),w,!1);if(!q)throw new Error("Can't perform where op on the given tensors");D=q,F=E$1.size(D)}let U=Math.ceil(F/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:q=>fg(q,d,D,I,$),getRunData:()=>({outputs:[{dims:D,dataType:$}],dispatchGroup:{x:Math.ceil(F/64/4)},programUniforms:[{type:12,data:U},...W(w,m,g,D)]})}},Xd=d=>{d.compute(hg(d.inputs))}}),ec,tc=L$1(()=>{Bs(),Yr(),Us(),Vs(),Tu(),Mu(),Nu(),tl(),ul(),cl(),fl(),_l(),$l(),Sl(),Il(),kl(),zl(),Ml(),Nl(),Wl(),Yl(),ed(),rd(),od(),sd(),Eo(),ld(),Cd(),Ed(),Pd(),Dd(),Zr(),Nd(),Oo(),Ld(),Fd(),Kd(),Po(),Yd(),ct(),Jr(),Jd(),ec=new Map([["Abs",[Ls]],["Acos",[Ws]],["Acosh",[Gs]],["Add",[Cu]],["ArgMax",[Ds,go]],["ArgMin",[zs,go]],["Asin",[Hs]],["Asinh",[Fs]],["Atan",[qs]],["Atanh",[js]],["Attention",[Ms]],["AveragePool",[yd,gd]],["BatchNormalization",[Rs]],["BiasAdd",[Ns]],["BiasSplitGelu",[Su]],["Cast",[Zs,Ks]],["Ceil",[Ys]],["Clip",[Qs]],["Concat",[Ru,Uu]],["Conv",[To,So]],["ConvTranspose",[sl,il]],["Cos",[Xs]],["Cosh",[Js]],["CumSum",[ll,dl]],["DepthToSpace",[pl,ml]],["DequantizeLinear",[Id,Ad]],["Div",[Iu]],["Einsum",[yl,bl]],["Elu",[eu,or]],["Equal",[Au]],["Erf",[tu]],["Exp",[ru]],["Expand",[vl]],["FastGelu",[xl]],["Floor",[nu]],["FusedConv",[To,So]],["Gather",[Cl,Tl]],["GatherElements",[Bl,Dl]],["GatherBlockQuantized",[Pl,Ol]],["GatherND",[Al,El]],["Gelu",[ou]],["Gemm",[Ul,Rl]],["GlobalAveragePool",[wd,_d]],["GlobalMaxPool",[Td,Sd]],["Greater",[Ou]],["GreaterOrEqual",[Du]],["GridSample",[Vl,Ll]],["GroupQueryAttention",[Ql]],["HardSigmoid",[pu,cu]],["InstanceNormalization",[Jl]],["LayerNormalization",[td]],["LeakyRelu",[iu,or]],["Less",[zu]],["LessOrEqual",[Bu]],["Log",[vu]],["MatMul",[nd]],["MatMulNBits",[id,ad]],["MaxPool",[$d,xd]],["Mul",[Eu]],["MultiHeadAttention",[Fl,Hl]],["Neg",[su]],["Not",[au]],["Pad",[ud]],["Pow",[ku]],["QuickGelu",[$u,or]],["Range",[kd]],["Reciprocal",[uu]],["ReduceMin",[Is]],["ReduceMean",[$s]],["ReduceMax",[Cs]],["ReduceSum",[Es]],["ReduceProd",[As]],["ReduceL1",[xs]],["ReduceL2",[Ss]],["ReduceLogSum",[Ps]],["ReduceLogSumExp",[Ts]],["ReduceSumSquare",[ks]],["Relu",[lu]],["Resize",[Rd,Ud]],["RotaryEmbedding",[Kl]],["ScatterND",[zd,Od]],["Sigmoid",[du]],["Sin",[mu]],["Sinh",[fu]],["Slice",[Gd,Hd]],["SkipLayerNormalization",[Vd]],["Split",[ql,jl]],["Sqrt",[hu]],["Softmax",[qd,jd]],["Sub",[Pu]],["Tan",[gu]],["Tanh",[bu]],["ThresholdedRelu",[wu,or]],["Tile",[Qd]],["Transpose",[ls,ds]],["Where",[Xd]]])}),cn,rc=L$1(()=>{Ve(),et(),ue(),cn=class{constructor(d){this.backend=d,this.repo=new Map,this.attributesBound=!1}getArtifact(d){return this.repo.get(d)}setArtifact(d,m){this.repo.set(d,m)}run(d,m,g,w,$){Ne(d.programInfo.name);let I=this.backend.device,D=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let F=[];for(let q of m)F.push({binding:F.length,resource:{buffer:q.buffer}});for(let q of g)F.push({binding:F.length,resource:{buffer:q.buffer}});$&&F.push({binding:F.length,resource:$});let U=I.createBindGroup({layout:d.computePipeline.getBindGroupLayout(0),entries:F,label:d.programInfo.name});if(this.backend.sessionStatus==="capturing"){let q={kernelId:this.backend.currentKernelId,computePipeline:d.computePipeline,bindGroup:U,dispatchGroup:w};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(q)}D.setPipeline(d.computePipeline),D.setBindGroup(0,U),D.dispatchWorkgroups(...w),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Me(d.programInfo.name)}dispose(){}build(d,m){Ne(d.name);let g=this.backend.device,w=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(q=>{g.features.has(q.feature)&&w.push(`enable ${q.extension};`)});let $=ss(m,this.backend.device.limits),I=d.getShaderSource($),D=`${w.join(`
`)}
${$.additionalImplementations}
${I}`,F=g.createShaderModule({code:D,label:d.name});le("verbose",()=>`[WebGPU] ${d.name} shader code: ${D}`);let U=g.createComputePipeline({compute:{module:F,entryPoint:"main"},layout:"auto",label:d.name});return Me(d.name),{programInfo:d,computePipeline:U,uniformVariablesInfo:$.variablesInfo}}normalizeDispatchGroupSize(d){let m=typeof d=="number"?d:d.x,g=typeof d=="number"?1:d.y||1,w=typeof d=="number"?1:d.z||1,$=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(m<=$&&g<=$&&w<=$)return[m,g,w];let I=m*g*w,D=Math.ceil(Math.sqrt(I));if(D>$){if(D=Math.ceil(Math.cbrt(I)),D>$)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[D,D,D]}else return[D,D,1]}}}),nc={};Wt(nc,{WebGpuBackend:()=>Do});var gg,yg,zo,Do,oc=L$1(()=>{Ve(),ee(),et(),no(),is(),tc(),rc(),gg=(d,m)=>{if(m.length!==d.length)throw new Error(`inputDependencies length ${m.length} is not equal to inputTensors length ${d.length}.`);let g=[];for(let w=0;w<d.length;++w){let $=d[w].dataType;switch(m[w]){case"none":{g.push("");break}case"type":{g.push(`${$}`);break}case"rank":{let I=d[w].dims.length;g.push(`${$};${I}`);break}case"dims":{let I=d[w].dims.join(",");g.push(`${$};${I}`);break}default:throw new Error(`unsupported input dependency: ${m[w]}`)}}return g.join("|")},yg=(d,m,g)=>{let w=d.name;return d.shaderCache?.hint&&(w+="["+d.shaderCache.hint+"]"),w+=":"+g+`:${gg(m,d.shaderCache?.inputDependencies??new Array(m.length).fill("dims"))}`,w},zo=class{constructor(d){d&&(this.architecture=d.architecture,this.vendor=d.vendor)}isArchitecture(d){return this.architecture===d}isVendor(d){return this.vendor===d}},Do=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let d=this.kernelCustomData.get(this.currentKernelId);return d||(d={},this.kernelCustomData.set(this.currentKernelId,d)),d}async initialize(d,m){this.env=d;let g=[],w={requiredLimits:{maxComputeWorkgroupStorageSize:m.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:m.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:m.limits.maxStorageBufferBindingSize,maxBufferSize:m.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:m.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:m.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:m.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:m.limits.maxComputeWorkgroupSizeZ},requiredFeatures:g},$=I=>m.features.has(I)&&g.push(I)&&!0;$("chromium-experimental-timestamp-query-inside-passes")||$("timestamp-query"),$("shader-f16"),$("subgroups"),this.device=await m.requestDevice(w),this.adapterInfo=new zo(m.info||await m.requestAdapterInfo()),this.gpuDataManager=os(this),this.programManager=new cn(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,Nr(d.logLevel,!!d.debug),this.device.onuncapturederror=I=>{I.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${I.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:m,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let d=this.getCommandEncoder(),m={};this.queryType==="at-passes"&&(m.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=d.beginComputePass(m)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;Ne(),this.endComputePass();let d;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),d=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(d,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,d,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&d.mapAsync(GPUMapMode.READ).then(()=>{let m=new BigUint64Array(d.getMappedRange()),g=this.pendingQueries.get(d);for(let w=0;w<m.length/2;w++){let $=g[w],I=$.kernelId,D=this.kernels.get(I),F=D.kernelType,U=D.kernelName,q=$.programName,j=$.inputTensorViews,G=$.outputTensorViews,H=m[w*2],V=m[w*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=H);let Z=Number(H-this.queryTimeBase),Q=Number(V-this.queryTimeBase);if(!Number.isSafeInteger(Z)||!Number.isSafeInteger(Q))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:j.map(J=>({dims:J.dims,dataType:Je(J.dataType)})),outputsMetadata:G.map(J=>({dims:J.dims,dataType:Je(J.dataType)})),kernelId:I,kernelType:F,kernelName:U,programName:q,startTime:Z,endTime:Q});else{let J="";j.forEach((re,se)=>{J+=`input[${se}]: [${re.dims}] | ${Je(re.dataType)}, `});let ie="";G.forEach((re,se)=>{ie+=`output[${se}]: [${re.dims}] | ${Je(re.dataType)}, `}),console.log(`[profiling] kernel "${I}|${F}|${U}|${q}" ${J}${ie}start time: ${Z} ns, execution time: ${Q-Z} ns`)}$r("GPU",`${q}::${H}::${V}`)}d.unmap(),this.pendingQueries.delete(d)}),Me()}run(d,m,g,w,$,I){Ne(d.name);let D=[];for(let re=0;re<m.length;++re){let se=m[re].data;if(se===0)continue;let X=this.gpuDataManager.get(se);if(!X)throw new Error(`no GPU data for input: ${se}`);D.push(X)}let{outputs:F,dispatchGroup:U,programUniforms:q}=d.getRunData(m),j=g.length===0?F.map((re,se)=>se):g;if(j.length!==F.length)throw new Error(`Output size ${j.length} must be equal to ${F.length}.`);let G=[],H=[];for(let re=0;re<F.length;++re){if(!Number.isInteger(j[re])||j[re]<-3||j[re]>=I)throw new Error(`Invalid output index: ${j[re]}`);if(j[re]===-3)continue;let se=j[re]===-1,X=j[re]===-2,ne=se||X?$(F[re].dataType,F[re].dims):w(j[re],F[re].dataType,F[re].dims);if(G.push(ne),ne.data===0)continue;let ce=this.gpuDataManager.get(ne.data);if(!ce)throw new Error(`no GPU data for output: ${ne.data}`);if(se&&this.temporaryData.push(ce),X){let oe=this.kernelPersistentData.get(this.currentKernelId);oe||(oe=[],this.kernelPersistentData.set(this.currentKernelId,oe)),oe.push(ce)}H.push(ce)}if(D.length!==m.length||H.length!==G.length){if(H.length===0)return Me(d.name),G;throw new Error(`Program ${d.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let V;if(q){let re=0,se=[];q.forEach(oe=>{let de=typeof oe.data=="number"?[oe.data]:oe.data;if(de.length===0)return;let me=oe.type===10?2:4,ge,fe;oe.type===10?(fe=de.length>4?16:de.length>2?8:de.length*me,ge=de.length>4?16:me*de.length):(fe=de.length<=2?de.length*me:16,ge=16),re=Math.ceil(re/fe)*fe,se.push(re);let xe=oe.type===10?8:4;re+=de.length>4?Math.ceil(de.length/xe)*ge:de.length*me});let X=16;re=Math.ceil(re/X)*X;let ne=new ArrayBuffer(re);q.forEach((oe,de)=>{let me=se[de],ge=typeof oe.data=="number"?[oe.data]:oe.data;if(oe.type===6)new Int32Array(ne,me,ge.length).set(ge);else if(oe.type===12)new Uint32Array(ne,me,ge.length).set(ge);else if(oe.type===10)new Uint16Array(ne,me,ge.length).set(ge);else if(oe.type===1)new Float32Array(ne,me,ge.length).set(ge);else throw new Error(`Unsupported uniform type: ${Je(oe.type)}`)});let ce=this.gpuDataManager.create(re,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(ce.buffer,0,ne,0,re),this.gpuDataManager.release(ce.id),V={offset:0,size:re,buffer:ce.buffer}}let Z=this.programManager.normalizeDispatchGroupSize(U),Q=Z[1]===1&&Z[2]===1,J=yg(d,m,Q),ie=this.programManager.getArtifact(J);if(ie||(ie=this.programManager.build(d,Z),this.programManager.setArtifact(J,ie),le("info",()=>`[artifact] key: ${J}, programName: ${d.name}`)),q&&ie.uniformVariablesInfo){if(q.length!==ie.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${ie.uniformVariablesInfo.length}, got ${q.length} in program "${ie.programInfo.name}".`);for(let re=0;re<q.length;re++){let se=q[re],X=se.type,ne=typeof se.data=="number"?1:se.data.length,[ce,oe]=ie.uniformVariablesInfo[re];if(X!==ce||ne!==oe)throw new Error(`Uniform variable ${re} mismatch: expect type ${ce} with size ${oe}, got type ${X} with size ${ne} in program "${ie.programInfo.name}".`)}}if(le("info",()=>`[ProgramManager] run "${d.name}" (key=${J}) with ${Z[0]}x${Z[1]}x${Z[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let re={kernelId:this.currentKernelId,programName:ie.programInfo.name,inputTensorViews:m,outputTensorViews:G};this.pendingKernels.push(re),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(re)}return this.programManager.run(ie,D,H,Z,V),Me(d.name),G}upload(d,m){this.gpuDataManager.upload(d,m)}memcpy(d,m){this.gpuDataManager.memcpy(d,m)}async download(d,m){await this.gpuDataManager.download(d,m)}alloc(d){return this.gpuDataManager.create(d).id}free(d){return this.gpuDataManager.release(d)}createKernel(d,m,g,w){let $=ec.get(d);if(!$)throw new Error(`kernel not implemented: ${d}`);let I={kernelType:d,kernelName:w,kernelEntry:$[0],attributes:[$[1],g]};this.kernels.set(m,I)}releaseKernel(d){let m=this.kernelPersistentData.get(d);if(m){for(let g of m)this.gpuDataManager.release(g.id);this.kernelPersistentData.delete(d)}this.kernelCustomData.delete(d),this.kernels.delete(d)}computeKernel(d,m,g){let w=this.kernels.get(d);if(!w)throw new Error(`kernel not created: ${d}`);let $=w.kernelType,I=w.kernelName,D=w.kernelEntry,F=w.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${$}] ${I}" is not allowed to be called recursively`);this.currentKernelId=d,F[0]&&(F[1]=F[0](F[1]),F[0]=void 0),le("info",()=>`[WebGPU] Start to run kernel "[${$}] ${I}"...`);let U=this.env.debug;this.temporaryData=[];try{return U&&this.device.pushErrorScope("validation"),D(m,F[1]),0}catch(q){return g.push(Promise.resolve(`[WebGPU] Kernel "[${$}] ${I}" failed. ${q}`)),1}finally{U&&g.push(this.device.popErrorScope().then(q=>q?`GPU validation error for kernel "[${$}] ${I}": ${q.message}`:null));for(let q of this.temporaryData)this.gpuDataManager.release(q.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(d,m,g,w){let $=this.sessionExternalDataMapping.get(d);$||($=new Map,this.sessionExternalDataMapping.set(d,$));let I=$.get(m),D=this.gpuDataManager.registerExternalBuffer(g,w,I);return $.set(m,[D,g]),D}unregisterBuffers(d){let m=this.sessionExternalDataMapping.get(d);m&&(m.forEach(g=>this.gpuDataManager.unregisterExternalBuffer(g[0])),this.sessionExternalDataMapping.delete(d))}getBuffer(d){let m=this.gpuDataManager.get(d);if(!m)throw new Error(`no GPU data for buffer: ${d}`);return m.buffer}createDownloader(d,m,g){return async()=>{let w=await lo(this,d,m);return Lr(w.buffer,g)}}writeTimestamp(d){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,d)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){le("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){le("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){le("info","replay"),this.sessionStatus="replaying";let d=this.capturedCommandList.get(this.currentSessionId),m=this.capturedPendingKernels.get(this.currentSessionId),g=d.length;this.pendingKernels=[];for(let w=0;w<g;w++){let $=this.getComputePassEncoder(),I=d[w];this.writeTimestamp(this.pendingDispatchNumber*2),$.setPipeline(I.computePipeline),$.setBindGroup(0,I.bindGroup),$.dispatchWorkgroups(...I.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(m[w]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(d){this.unregisterBuffers(d),this.capturedCommandList.has(d)&&this.capturedCommandList.delete(d),this.capturedPendingKernels.has(d)&&this.capturedPendingKernels.delete(d),this.gpuDataManager.onReleaseSession(d)}onRunStart(d){this.currentSessionId=d,this.setQueryType()}}}),ic={};Wt(ic,{init:()=>bg});var ur,Bo,bg,ac=L$1(()=>{ee(),et(),ae(),es(),ur=class rp{constructor(m,g,w,$){this.module=m,this.dataType=g,this.data=w,this.dims=$}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,m)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,m)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,m)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let m=E$1.size(this.dims);return m===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,m)}reshape(m){if(E$1.size(m)!==E$1.size(this.dims))throw new Error("Invalid new shape");return new rp(this.module,this.dataType,this.data,m)}},Bo=class{constructor(d,m,g){this.module=d,this.backend=m,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=m.adapterInfo;let w=d.PTR_SIZE,$=g/d.PTR_SIZE,I=w===4?"i32":"i64";this.opKernelContext=Number(d.getValue(w*$++,I));let D=Number(d.getValue(w*$++,I));this.outputCount=Number(d.getValue(w*$++,I)),this.customDataOffset=Number(d.getValue(w*$++,"*")),this.customDataSize=Number(d.getValue(w*$++,I));let F=[];for(let U=0;U<D;U++){let q=Number(d.getValue(w*$++,I)),j=Number(d.getValue(w*$++,"*")),G=Number(d.getValue(w*$++,I)),H=[];for(let V=0;V<G;V++)H.push(Number(d.getValue(w*$++,I)));F.push(new ur(d,q,j,H))}this.inputs=F}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(d,m){let g=m?.inputs?.map(D=>typeof D=="number"?this.inputs[D]:D)??this.inputs,w=m?.outputs??[],$=(D,F,U)=>new ur(this.module,F,this.output(D,U),U),I=(D,F)=>{let U=St(D,F);if(!U)throw new Error(`Unsupported data type: ${D}`);let q=U>0?this.backend.gpuDataManager.create(U).id:0;return new ur(this.module,D,q,F)};return this.backend.run(d,g,w,$,I,this.outputCount)}output(d,m){let g=this.module.stackSave();try{let w=this.module.PTR_SIZE,$=w===4?"i32":"i64",I=this.module.stackAlloc((1+m.length)*w);this.module.setValue(I,m.length,$);for(let D=0;D<m.length;D++)this.module.setValue(I+w*(D+1),m[D],$);return this.module._JsepOutput(this.opKernelContext,d,I)}catch(w){throw new Error(`Failed to generate kernel's output[${d}] with dims [${m}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${w}`)}finally{this.module.stackRestore(g)}}},bg=async(d,m,g,w)=>{let $=m.jsepInit;if(!$)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(d==="webgpu"){let I=(oc(),Xt(nc)).WebGpuBackend,D=new I;await D.initialize(g,w),$("webgpu",[D,F=>D.alloc(Number(F)),F=>D.free(F),(F,U,q,j=!1)=>{if(j)le("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(F)}, dst=${Number(U)}, size=${Number(q)}`),D.memcpy(Number(F),Number(U));else{le("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(F)}, gpuDataId=${Number(U)}, size=${Number(q)}`);let G=m.HEAPU8.subarray(Number(F>>>0),Number(F>>>0)+Number(q));D.upload(Number(U),G)}},async(F,U,q)=>{le("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${F}, dataOffset=${U}, size=${q}`),await D.download(Number(F),()=>m.HEAPU8.subarray(Number(U)>>>0,Number(U+q)>>>0))},(F,U,q)=>D.createKernel(F,Number(U),q,m.UTF8ToString(m._JsepGetNodeName(Number(U)))),F=>D.releaseKernel(F),(F,U,q,j)=>{le("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${q}, kernel=${F}, contextDataOffset=${U}`);let G=new Bo(m,D,Number(U));return D.computeKernel(Number(F),G,j)},()=>D.captureBegin(),()=>D.captureEnd(),()=>D.replay()])}else{let I=new Fr(g);$("webnn",[I,()=>I.reserveTensorId(),D=>I.releaseTensorId(D),async(D,F,U,q,j)=>I.ensureTensor(D,F,U,q,j),(D,F)=>{I.uploadTensor(D,F)},async(D,F)=>I.downloadTensor(D,F),(D,F)=>I.registerMLContext(D,F),!!g.trace])}}}),_g,Ir,Ar,Rt,wg,sc,er,Er,kr,uc,Pr,Or,zr,Zn=L$1(()=>{Ve(),La(),Ga(),ee(),$t(),Br(),to$1(),_g=(d,m)=>{_e()._OrtInit(d,m)!==0&&ye("Can't initialize onnxruntime.")},Ir=async d=>{_g(d.wasm.numThreads,rr(d.logLevel))},Ar=async(d,m)=>{_e().asyncInit?.();let g=d.webgpu.adapter;if(m==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(g){if(typeof g.limits!="object"||typeof g.features!="object"||typeof g.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let w=d.webgpu.powerPreference;if(w!==void 0&&w!=="low-power"&&w!=="high-performance")throw new Error(`Invalid powerPreference setting: "${w}"`);let $=d.webgpu.forceFallbackAdapter;if($!==void 0&&typeof $!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${$}"`);if(g=await navigator.gpu.requestAdapter({powerPreference:w,forceFallbackAdapter:$}),!g)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(m==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");{let w=(ac(),Xt(ic)).init;m==="webgpu"&&await w("webgpu",_e(),d,g),m==="webnn"&&await w("webnn",_e(),d)}},Rt=new Map,wg=d=>{let m=_e(),g=m.stackSave();try{let w=m.PTR_SIZE,$=m.stackAlloc(2*w);m._OrtGetInputOutputCount(d,$,$+w)!==0&&ye("Can't get session input/output count.");let I=w===4?"i32":"i64";return[Number(m.getValue($,I)),Number(m.getValue($+w,I))]}finally{m.stackRestore(g)}},sc=(d,m)=>{let g=_e(),w=g.stackSave(),$=0;try{let I=g.PTR_SIZE,D=g.stackAlloc(2*I);g._OrtGetInputOutputMetadata(d,m,D,D+I)!==0&&ye("Can't get session input/output metadata.");let F=Number(g.getValue(D,"*"));$=Number(g.getValue(D+I,"*"));let U=g.HEAP32[$/4];if(U===0)return[F,0];let q=g.HEAPU32[$/4+1],j=[];for(let G=0;G<q;G++){let H=Number(g.getValue($+8+G*I,"*"));j.push(H!==0?g.UTF8ToString(H):Number(g.getValue($+8+(G+q)*I,"*")))}return[F,U,j]}finally{g.stackRestore(w),$!==0&&g._OrtFree($)}},er=d=>{let m=_e(),g=m._malloc(d.byteLength);if(g===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${d.byteLength}.`);return m.HEAPU8.set(d,g),[g,d.byteLength]},Er=async(d,m)=>{let g,w,$=_e();Array.isArray(d)?[g,w]=d:d.buffer===$.HEAPU8.buffer?[g,w]=[d.byteOffset,d.byteLength]:[g,w]=er(d);let I=0,D=0,F=0,U=[],q=[],j=[];try{if([D,U]=await Wa(m),m?.externalData&&$.mountExternalData){let X=[];for(let ne of m.externalData){let ce=typeof ne=="string"?ne:ne.path;X.push(nr(typeof ne=="string"?ne:ne.data).then(oe=>{$.mountExternalData(ce,oe)}))}await Promise.all(X)}for(let X of m?.executionProviders??[])if((typeof X=="string"?X:X.name)==="webnn"){if($.shouldTransferToMLTensor=!1,typeof X!="string"){let ne=X,ce=ne?.context,oe=ne?.gpuDevice,de=ne?.deviceType,me=ne?.powerPreference;ce?$.currentContext=ce:oe?$.currentContext=await $.webnnCreateMLContext(oe):$.currentContext=await $.webnnCreateMLContext({deviceType:de,powerPreference:me})}else $.currentContext=await $.webnnCreateMLContext();break}I=await $._OrtCreateSession(g,w,D),$.webgpuOnCreateSession?.(I),I===0&&ye("Can't create a session."),$.jsepOnCreateSession?.(),$.currentContext&&($.webnnRegisterMLContext(I,$.currentContext),$.currentContext=void 0,$.shouldTransferToMLTensor=!0);let[G,H]=wg(I),V=!!m?.enableGraphCapture,Z=[],Q=[],J=[],ie=[],re=[];for(let X=0;X<G;X++){let[ne,ce,oe]=sc(I,X);ne===0&&ye("Can't get an input name."),q.push(ne);let de=$.UTF8ToString(ne);Z.push(de),J.push(ce===0?{name:de,isTensor:!1}:{name:de,isTensor:!0,type:Je(ce),shape:oe})}for(let X=0;X<H;X++){let[ne,ce,oe]=sc(I,X+G);ne===0&&ye("Can't get an output name."),j.push(ne);let de=$.UTF8ToString(ne);Q.push(de),ie.push(ce===0?{name:de,isTensor:!1}:{name:de,isTensor:!0,type:Je(ce),shape:oe});{if(V&&m?.preferredOutputLocation===void 0){re.push("gpu-buffer");continue}let me=typeof m?.preferredOutputLocation=="string"?m.preferredOutputLocation:m?.preferredOutputLocation?.[de]??"cpu",ge=$.webnnIsGraphOutput;if(me==="cpu"&&ge&&ge(I,de)){re.push("ml-tensor-cpu-output");continue}if(me!=="cpu"&&me!=="cpu-pinned"&&me!=="gpu-buffer"&&me!=="ml-tensor")throw new Error(`Not supported preferred output location: ${me}.`);if(V&&me!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${me}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);re.push(me)}}let se=null;return re.some(X=>X==="gpu-buffer"||X==="ml-tensor"||X==="ml-tensor-cpu-output")&&(F=$._OrtCreateBinding(I),F===0&&ye("Can't create IO binding."),se={handle:F,outputPreferredLocations:re,outputPreferredLocationsEncoded:re.map(X=>X==="ml-tensor-cpu-output"?"ml-tensor":X).map(X=>eo(X))}),Rt.set(I,[I,q,j,se,V,!1]),[I,Z,Q,J,ie]}catch(G){throw q.forEach(H=>$._OrtFree(H)),j.forEach(H=>$._OrtFree(H)),F!==0&&$._OrtReleaseBinding(F)!==0&&ye("Can't release IO binding."),I!==0&&$._OrtReleaseSession(I)!==0&&ye("Can't release session."),G}finally{$._free(g),D!==0&&$._OrtReleaseSessionOptions(D)!==0&&ye("Can't release session options."),U.forEach(G=>$._free(G)),$.unmountExternalData?.()}},kr=d=>{let m=_e(),g=Rt.get(d);if(!g)throw new Error(`cannot release session. invalid session id: ${d}`);let[w,$,I,D,F]=g;D&&(F&&m._OrtClearBoundOutputs(D.handle)!==0&&ye("Can't clear bound outputs."),m._OrtReleaseBinding(D.handle)!==0&&ye("Can't release IO binding.")),m.jsepOnReleaseSession?.(d),m.webnnOnReleaseSession?.(d),m.webgpuOnReleaseSession?.(d),$.forEach(U=>m._OrtFree(U)),I.forEach(U=>m._OrtFree(U)),m._OrtReleaseSession(w)!==0&&ye("Can't release session."),Rt.delete(d)},uc=async(d,m,g,w,$,I,D=!1)=>{if(!d){m.push(0);return}let F=_e(),U=F.PTR_SIZE,q=d[0],j=d[1],G=d[3],H=G,V,Z;if(q==="string"&&(G==="gpu-buffer"||G==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(D&&G!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${I} when enableGraphCapture is true.`);if(G==="gpu-buffer"){let ie=d[2].gpuBuffer;Z=St(xt(q),j);{let re=F.jsepRegisterBuffer;if(!re)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');V=re(w,I,ie,Z)}}else if(G==="ml-tensor"){let ie=d[2].mlTensor;Z=St(xt(q),j);let re=F.webnnRegisterMLTensor;if(!re)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');V=re(w,ie,xt(q),j)}else{let ie=d[2];if(Array.isArray(ie)){Z=U*ie.length,V=F._malloc(Z),g.push(V);for(let re=0;re<ie.length;re++){if(typeof ie[re]!="string")throw new TypeError(`tensor data at index ${re} is not a string`);F.setValue(V+re*U,We(ie[re],g),"*")}}else{let re=F.webnnIsGraphInput,se=F.webnnIsGraphOutput;if(q!=="string"&&re&&se){let X=F.UTF8ToString($);if(re(w,X)||se(w,X)){let ne=xt(q);Z=St(ne,j),H="ml-tensor";let ce=F.webnnCreateTemporaryTensor,oe=F.webnnUploadTensor;if(!ce||!oe)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let de=await ce(w,ne,j);oe(de,new Uint8Array(ie.buffer,ie.byteOffset,ie.byteLength)),V=de}else Z=ie.byteLength,V=F._malloc(Z),g.push(V),F.HEAPU8.set(new Uint8Array(ie.buffer,ie.byteOffset,Z),V)}else Z=ie.byteLength,V=F._malloc(Z),g.push(V),F.HEAPU8.set(new Uint8Array(ie.buffer,ie.byteOffset,Z),V)}}let Q=F.stackSave(),J=F.stackAlloc(4*j.length);try{j.forEach((re,se)=>F.setValue(J+se*U,re,U===4?"i32":"i64"));let ie=F._OrtCreateTensor(xt(q),V,Z,J,j.length,eo(H));ie===0&&ye(`Can't create tensor for input/output. session=${w}, index=${I}.`),m.push(ie)}finally{F.stackRestore(Q)}},Pr=async(d,m,g,w,$,I)=>{let D=_e(),F=D.PTR_SIZE,U=Rt.get(d);if(!U)throw new Error(`cannot run inference. invalid session id: ${d}`);let q=U[0],j=U[1],G=U[2],H=U[3],V=U[4],Z=U[5],Q=m.length,J=w.length,ie=0,re=[],se=[],X=[],ne=[],ce=D.stackSave(),oe=D.stackAlloc(Q*F),de=D.stackAlloc(Q*F),me=D.stackAlloc(J*F),ge=D.stackAlloc(J*F);try{[ie,re]=Va(I),wt("wasm prepareInputOutputTensor");for(let Te=0;Te<Q;Te++)await uc(g[Te],se,ne,d,j[m[Te]],m[Te],V);for(let Te=0;Te<J;Te++)await uc($[Te],X,ne,d,G[w[Te]],Q+w[Te],V);vt("wasm prepareInputOutputTensor");for(let Te=0;Te<Q;Te++)D.setValue(oe+Te*F,se[Te],"*"),D.setValue(de+Te*F,j[m[Te]],"*");for(let Te=0;Te<J;Te++)D.setValue(me+Te*F,X[Te],"*"),D.setValue(ge+Te*F,G[w[Te]],"*");if(H&&!Z){let{handle:Te,outputPreferredLocations:Oe,outputPreferredLocationsEncoded:Be}=H;if(j.length!==Q)throw new Error(`input count from feeds (${Q}) is expected to be always equal to model's input count (${j.length}).`);wt("wasm bindInputsOutputs");for(let _t=0;_t<Q;_t++){let Et=m[_t];await D._OrtBindInput(Te,j[Et],se[_t])!==0&&ye(`Can't bind input[${_t}] for session=${d}.`)}for(let _t=0;_t<J;_t++){let Et=w[_t];$[_t]?.[3]?D._OrtBindOutput(Te,G[Et],X[_t],0)!==0&&ye(`Can't bind pre-allocated output[${_t}] for session=${d}.`):D._OrtBindOutput(Te,G[Et],0,Be[Et])!==0&&ye(`Can't bind output[${_t}] to ${Oe[_t]} for session=${d}.`)}vt("wasm bindInputsOutputs"),Rt.set(d,[q,j,G,H,V,!0])}D.jsepOnRunStart?.(q),D.webnnOnRunStart?.(q);let fe;H?fe=await D._OrtRunWithBinding(q,H.handle,J,me,ie):fe=await D._OrtRun(q,de,oe,Q,ge,J,me,ie),fe!==0&&ye("failed to call OrtRun().");let xe=[],Fe=[];wt("wasm ProcessOutputTensor");for(let Te=0;Te<J;Te++){let Oe=Number(D.getValue(me+Te*F,"*"));if(Oe===X[Te]){xe.push($[Te]);continue}let Be=D.stackSave(),_t=D.stackAlloc(4*F),Et=!1,dt,Zt=0;try{D._OrtGetTensorData(Oe,_t,_t+F,_t+2*F,_t+3*F)!==0&&ye(`Can't access output tensor data on index ${Te}.`);let Ye=F===4?"i32":"i64",bt=Number(D.getValue(_t,Ye));Zt=D.getValue(_t+F,"*");let Qt=D.getValue(_t+F*2,"*"),Vt=Number(D.getValue(_t+F*3,Ye)),ut=[];for(let fr=0;fr<Vt;fr++)ut.push(Number(D.getValue(Qt+fr*F,Ye)));D._OrtFree(Qt)!==0&&ye("Can't free memory for tensor dims.");let At=ut.reduce((fr,pr)=>fr*pr,1);dt=Je(bt);let dr=H?.outputPreferredLocations[w[Te]];if(dt==="string"){if(dr==="gpu-buffer"||dr==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let fr=[];for(let pr=0;pr<At;pr++){let zt=D.getValue(Zt+pr*F,"*"),Ce=D.getValue(Zt+(pr+1)*F,"*"),Nt=pr===At-1?void 0:Ce-zt;fr.push(D.UTF8ToString(zt,Nt))}xe.push([dt,ut,fr,"cpu"])}else if(dr==="gpu-buffer"&&At>0){let fr=D.jsepGetBuffer;if(!fr)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let pr=fr(Zt),zt=St(bt,At);if(zt===void 0||!Rr(dt))throw new Error(`Unsupported data type: ${dt}`);Et=!0,xe.push([dt,ut,{gpuBuffer:pr,download:D.jsepCreateDownloader(pr,zt,dt),dispose:()=>{D._OrtReleaseTensor(Oe)!==0&&ye("Can't release tensor.")}},"gpu-buffer"])}else if(dr==="ml-tensor"&&At>0){let fr=D.webnnEnsureTensor,pr=D.webnnIsGraphInputOutputTypeSupported;if(!fr||!pr)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(St(bt,At)===void 0||!Ur(dt))throw new Error(`Unsupported data type: ${dt}`);if(!pr(d,dt,!1))throw new Error(`preferredLocation "ml-tensor" for ${dt} output is not supported by current WebNN Context.`);let zt=await fr(d,Zt,bt,ut,!1);Et=!0,xe.push([dt,ut,{mlTensor:zt,download:D.webnnCreateMLTensorDownloader(Zt,dt),dispose:()=>{D.webnnReleaseTensorId(Zt),D._OrtReleaseTensor(Oe)}},"ml-tensor"])}else if(dr==="ml-tensor-cpu-output"&&At>0){let fr=D.webnnCreateMLTensorDownloader(Zt,dt)(),pr=xe.length;Et=!0,Fe.push((async()=>{let zt=[pr,await fr];return D.webnnReleaseTensorId(Zt),D._OrtReleaseTensor(Oe),zt})()),xe.push([dt,ut,[],"cpu"])}else{let fr=Gt(dt),pr=new fr(At);new Uint8Array(pr.buffer,pr.byteOffset,pr.byteLength).set(D.HEAPU8.subarray(Zt,Zt+pr.byteLength)),xe.push([dt,ut,pr,"cpu"])}}finally{D.stackRestore(Be),dt==="string"&&Zt&&D._free(Zt),Et||D._OrtReleaseTensor(Oe)}}H&&!V&&(D._OrtClearBoundOutputs(H.handle)!==0&&ye("Can't clear bound outputs."),Rt.set(d,[q,j,G,H,V,!1]));for(let[Te,Oe]of await Promise.all(Fe))xe[Te][2]=Oe;return vt("wasm ProcessOutputTensor"),xe}finally{D.webnnOnRunEnd?.(q),D.stackRestore(ce),se.forEach(fe=>D._OrtReleaseTensor(fe)),X.forEach(fe=>D._OrtReleaseTensor(fe)),ne.forEach(fe=>D._free(fe)),ie!==0&&D._OrtReleaseRunOptions(ie),re.forEach(fe=>D._free(fe))}},Or=d=>{let m=_e(),g=Rt.get(d);if(!g)throw new Error("invalid session id");let w=g[0],$=m._OrtEndProfiling(w);$===0&&ye("Can't get an profile file name."),m._OrtFree($)},zr=d=>{let m=[];for(let g of d){let w=g[2];!Array.isArray(w)&&"buffer"in w&&m.push(w.buffer)}return m}}),Ut,He,lr,mn,fn,pn,Mo,Ro,jt,Kt,$g,lc,dc,cc,pc,mc,fc,hc,Uo=L$1(()=>{Ve(),Zn(),$t(),Tr(),Ut=()=>!!we.wasm.proxy&&typeof document<"u",lr=!1,mn=!1,fn=!1,Ro=new Map,jt=(d,m)=>{let g=Ro.get(d);g?g.push(m):Ro.set(d,[m])},Kt=()=>{if(lr||!mn||fn||!He)throw new Error("worker not ready")},$g=d=>{switch(d.data.type){case"init-wasm":lr=!1,d.data.err?(fn=!0,Mo[1](d.data.err)):(mn=!0,Mo[0]()),pn&&(URL.revokeObjectURL(pn),pn=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let m=Ro.get(d.data.type);d.data.err?m.shift()[1](d.data.err):m.shift()[0](d.data.out);break}}},lc=async()=>{if(!mn){if(lr)throw new Error("multiple calls to 'initWasm()' detected.");if(fn)throw new Error("previous call to 'initWasm()' failed.");if(lr=!0,Ut())return new Promise((d,m)=>{He?.terminate(),Ra().then(([g,w])=>{try{He=w,He.onerror=I=>m(I),He.onmessage=$g,Mo=[d,m];let $={type:"init-wasm",in:we};!$.in.wasm.wasmPaths&&(g||Yn)&&($.in.wasm.wasmPaths={wasm:new URL(""+new URL("assets/ort-wasm-simd-threaded.jsep-CLmJQkb_.wasm",import.meta.url).href,import.meta.url).href}),He.postMessage($),pn=g}catch($){m($)}},m)});try{await Cr(we.wasm),await Ir(we),mn=!0}catch(d){throw fn=!0,d}finally{lr=!1}}},dc=async d=>{if(Ut())return Kt(),new Promise((m,g)=>{jt("init-ep",[m,g]);let w={type:"init-ep",in:{epName:d,env:we}};He.postMessage(w)});await Ar(we,d)},cc=async d=>Ut()?(Kt(),new Promise((m,g)=>{jt("copy-from",[m,g]);let w={type:"copy-from",in:{buffer:d}};He.postMessage(w,[d.buffer])})):er(d),pc=async(d,m)=>{if(Ut()){if(m?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return Kt(),new Promise((g,w)=>{jt("create",[g,w]);let $={type:"create",in:{model:d,options:{...m}}},I=[];d instanceof Uint8Array&&I.push(d.buffer),He.postMessage($,I)})}else return Er(d,m)},mc=async d=>{if(Ut())return Kt(),new Promise((m,g)=>{jt("release",[m,g]);let w={type:"release",in:d};He.postMessage(w)});kr(d)},fc=async(d,m,g,w,$,I)=>{if(Ut()){if(g.some(D=>D[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if($.some(D=>D))throw new Error("pre-allocated output tensor is not supported for proxy.");return Kt(),new Promise((D,F)=>{jt("run",[D,F]);let U=g,q={type:"run",in:{sessionId:d,inputIndices:m,inputs:U,outputIndices:w,options:I}};He.postMessage(q,zr(U))})}else return Pr(d,m,g,w,$,I)},hc=async d=>{if(Ut())return Kt(),new Promise((m,g)=>{jt("end-profiling",[m,g]);let w={type:"end-profiling",in:d};He.postMessage(w)});Or(d)}}),gc,xg,hn,yc=L$1(()=>{Ve(),Uo(),ee(),Sr(),to$1(),gc=(d,m)=>{switch(d.location){case"cpu":return[d.type,d.dims,d.data,"cpu"];case"gpu-buffer":return[d.type,d.dims,{gpuBuffer:d.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[d.type,d.dims,{mlTensor:d.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${d.location} for ${m()}`)}},xg=d=>{switch(d[3]){case"cpu":return new qe(d[0],d[2],d[1]);case"gpu-buffer":{let m=d[0];if(!Rr(m))throw new Error(`not supported data type: ${m} for deserializing GPU tensor`);let{gpuBuffer:g,download:w,dispose:$}=d[2];return qe.fromGpuBuffer(g,{dataType:m,dims:d[1],download:w,dispose:$})}case"ml-tensor":{let m=d[0];if(!Ur(m))throw new Error(`not supported data type: ${m} for deserializing MLTensor tensor`);let{mlTensor:g,download:w,dispose:$}=d[2];return qe.fromMLTensor(g,{dataType:m,dims:d[1],download:w,dispose:$})}default:throw new Error(`invalid data location: ${d[3]}`)}},hn=class{async fetchModelAndCopyToWasmMemory(d){return cc(await nr(d))}async loadModel(d,m){Ne();let g;typeof d=="string"?g=await this.fetchModelAndCopyToWasmMemory(d):g=d,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await pc(g,m),Me()}async dispose(){return mc(this.sessionId)}async run(d,m,g){Ne();let w=[],$=[];Object.entries(d).forEach(G=>{let H=G[0],V=G[1],Z=this.inputNames.indexOf(H);if(Z===-1)throw new Error(`invalid input '${H}'`);w.push(V),$.push(Z)});let I=[],D=[];Object.entries(m).forEach(G=>{let H=G[0],V=G[1],Z=this.outputNames.indexOf(H);if(Z===-1)throw new Error(`invalid output '${H}'`);I.push(V),D.push(Z)});let F=w.map((G,H)=>gc(G,()=>`input "${this.inputNames[$[H]]}"`)),U=I.map((G,H)=>G?gc(G,()=>`output "${this.outputNames[D[H]]}"`):null),q=await fc(this.sessionId,$,F,D,U,g),j={};for(let G=0;G<q.length;G++)j[this.outputNames[D[G]]]=I[G]??xg(q[G]);return Me(),j}startProfiling(){}endProfiling(){hc(this.sessionId)}}}),_c={};Wt(_c,{OnnxruntimeWebAssemblyBackend:()=>gn,initializeFlags:()=>bc,wasmBackend:()=>Sg});var bc,gn,Sg,wc=L$1(()=>{Ve(),Uo(),yc(),bc=()=>{(typeof we.wasm.initTimeout!="number"||we.wasm.initTimeout<0)&&(we.wasm.initTimeout=0);let d=we.wasm.simd;if(typeof d!="boolean"&&d!==void 0&&d!=="fixed"&&d!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${d}". Reset it to \`false\` and ignore SIMD feature checking.`),we.wasm.simd=!1),typeof we.wasm.proxy!="boolean"&&(we.wasm.proxy=!1),typeof we.wasm.trace!="boolean"&&(we.wasm.trace=!1),typeof we.wasm.numThreads!="number"||!Number.isInteger(we.wasm.numThreads)||we.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)we.wasm.numThreads=1;else{let m=typeof navigator>"u"?Wn("node:os").cpus().length:navigator.hardwareConcurrency;we.wasm.numThreads=Math.min(4,Math.ceil((m||1)/2))}},gn=class{async init(d){bc(),await lc(),await dc(d)}async createInferenceSessionHandler(d,m){let g=new hn;return await g.loadModel(d,m),g}},Sg=new gn});Ve();Ve();Ve();var Sa="1.23.0";{let d=(wc(),Xt(_c)).wasmBackend;Pt("webgpu",d,5),Pt("webnn",d,5),Pt("cpu",d,10),Pt("wasm",d,10)}Object.defineProperty(we.versions,"web",{value:Sa,enumerable:!0});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*//**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 *//**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}function getAugmentedNamespace(d){if(d.__esModule)return d;var m=d.default;if(typeof m=="function"){var g=function w(){return this instanceof w?Reflect.construct(m,arguments,this.constructor):m.apply(this,arguments)};g.prototype=m.prototype}else g={};return Object.defineProperty(g,"__esModule",{value:!0}),Object.keys(d).forEach((function(w){var $=Object.getOwnPropertyDescriptor(d,w);Object.defineProperty(g,w,$.get?$:{enumerable:!0,get:function(){return d[w]}})})),g}typeof self>"u"&&typeof commonjsGlobal=="object"&&(commonjsGlobal.self=commonjsGlobal);var global$1=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",m=0;m<64;++m)lookup[m]=d[m],revLookup[d.charCodeAt(m)]=m;revLookup[45]=62,revLookup[95]=63}function toByteArray(d){var m,g,w,$,I,D;inited||init();var F=d.length;if(F%4>0)throw new Error("Invalid string. Length must be a multiple of 4");I=d[F-2]==="="?2:d[F-1]==="="?1:0,D=new Arr(3*F/4-I),w=I>0?F-4:F;var U=0;for(m=0,g=0;m<w;m+=4,g+=3)$=revLookup[d.charCodeAt(m)]<<18|revLookup[d.charCodeAt(m+1)]<<12|revLookup[d.charCodeAt(m+2)]<<6|revLookup[d.charCodeAt(m+3)],D[U++]=$>>16&255,D[U++]=$>>8&255,D[U++]=255&$;return I===2?($=revLookup[d.charCodeAt(m)]<<2|revLookup[d.charCodeAt(m+1)]>>4,D[U++]=255&$):I===1&&($=revLookup[d.charCodeAt(m)]<<10|revLookup[d.charCodeAt(m+1)]<<4|revLookup[d.charCodeAt(m+2)]>>2,D[U++]=$>>8&255,D[U++]=255&$),D}function tripletToBase64(d){return lookup[d>>18&63]+lookup[d>>12&63]+lookup[d>>6&63]+lookup[63&d]}function encodeChunk(d,m,g){for(var w,$=[],I=m;I<g;I+=3)w=(d[I]<<16)+(d[I+1]<<8)+d[I+2],$.push(tripletToBase64(w));return $.join("")}function fromByteArray(d){var m;inited||init();for(var g=d.length,w=g%3,$="",I=[],D=16383,F=0,U=g-w;F<U;F+=D)I.push(encodeChunk(d,F,F+D>U?U:F+D));return w===1?(m=d[g-1],$+=lookup[m>>2],$+=lookup[m<<4&63],$+="=="):w===2&&(m=(d[g-2]<<8)+d[g-1],$+=lookup[m>>10],$+=lookup[m>>4&63],$+=lookup[m<<2&63],$+="="),I.push($),I.join("")}function read(d,m,g,w,$){var I,D,F=8*$-w-1,U=(1<<F)-1,q=U>>1,j=-7,G=g?$-1:0,H=g?-1:1,V=d[m+G];for(G+=H,I=V&(1<<-j)-1,V>>=-j,j+=F;j>0;I=256*I+d[m+G],G+=H,j-=8);for(D=I&(1<<-j)-1,I>>=-j,j+=w;j>0;D=256*D+d[m+G],G+=H,j-=8);if(I===0)I=1-q;else{if(I===U)return D?NaN:1/0*(V?-1:1);D+=Math.pow(2,w),I-=q}return(V?-1:1)*D*Math.pow(2,I-w)}function write(d,m,g,w,$,I){var D,F,U,q=8*I-$-1,j=(1<<q)-1,G=j>>1,H=$===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=w?0:I-1,Z=w?1:-1,Q=m<0||m===0&&1/m<0?1:0;for(m=Math.abs(m),isNaN(m)||m===1/0?(F=isNaN(m)?1:0,D=j):(D=Math.floor(Math.log(m)/Math.LN2),m*(U=Math.pow(2,-D))<1&&(D--,U*=2),(m+=D+G>=1?H/U:H*Math.pow(2,1-G))*U>=2&&(D++,U/=2),D+G>=j?(F=0,D=j):D+G>=1?(F=(m*U-1)*Math.pow(2,$),D+=G):(F=m*Math.pow(2,G-1)*Math.pow(2,$),D=0));$>=8;d[g+V]=255&F,V+=Z,F/=256,$-=8);for(D=D<<$|F,q+=$;q>0;d[g+V]=255&D,V+=Z,D/=256,q-=8);d[g+V-Z]|=128*Q}var toString={}.toString,isArray=Array.isArray||function(d){return toString.call(d)=="[object Array]"},INSPECT_MAX_BYTES=50;function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(d,m){if(kMaxLength()<m)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(d=new Uint8Array(m)).__proto__=Buffer.prototype:(d===null&&(d=new Buffer(m)),d.length=m),d}function Buffer(d,m,g){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(d,m,g);if(typeof d=="number"){if(typeof m=="string")throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,d)}return from(this,d,m,g)}function from(d,m,g,w){if(typeof m=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&m instanceof ArrayBuffer?fromArrayBuffer(d,m,g,w):typeof m=="string"?fromString(d,m,g):fromObject(d,m)}function assertSize(d){if(typeof d!="number")throw new TypeError('"size" argument must be a number');if(d<0)throw new RangeError('"size" argument must not be negative')}function alloc(d,m,g,w){return assertSize(m),m<=0?createBuffer(d,m):g!==void 0?typeof w=="string"?createBuffer(d,m).fill(g,w):createBuffer(d,m).fill(g):createBuffer(d,m)}function allocUnsafe(d,m){if(assertSize(m),d=createBuffer(d,m<0?0:0|checked(m)),!Buffer.TYPED_ARRAY_SUPPORT)for(var g=0;g<m;++g)d[g]=0;return d}function fromString(d,m,g){if(typeof g=="string"&&g!==""||(g="utf8"),!Buffer.isEncoding(g))throw new TypeError('"encoding" must be a valid string encoding');var w=0|byteLength(m,g),$=(d=createBuffer(d,w)).write(m,g);return $!==w&&(d=d.slice(0,$)),d}function fromArrayLike(d,m){var g=m.length<0?0:0|checked(m.length);d=createBuffer(d,g);for(var w=0;w<g;w+=1)d[w]=255&m[w];return d}function fromArrayBuffer(d,m,g,w){if(m.byteLength,g<0||m.byteLength<g)throw new RangeError("'offset' is out of bounds");if(m.byteLength<g+(w||0))throw new RangeError("'length' is out of bounds");return m=g===void 0&&w===void 0?new Uint8Array(m):w===void 0?new Uint8Array(m,g):new Uint8Array(m,g,w),Buffer.TYPED_ARRAY_SUPPORT?(d=m).__proto__=Buffer.prototype:d=fromArrayLike(d,m),d}function fromObject(d,m){if(internalIsBuffer(m)){var g=0|checked(m.length);return(d=createBuffer(d,g)).length===0||m.copy(d,0,0,g),d}if(m){if(typeof ArrayBuffer<"u"&&m.buffer instanceof ArrayBuffer||"length"in m)return typeof m.length!="number"||isnan(m.length)?createBuffer(d,0):fromArrayLike(d,m);if(m.type==="Buffer"&&isArray(m.data))return fromArrayLike(d,m.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(d){if(d>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|d}function internalIsBuffer(d){return!(d==null||!d._isBuffer)}function byteLength(d,m){if(internalIsBuffer(d))return d.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(d)||d instanceof ArrayBuffer))return d.byteLength;typeof d!="string"&&(d=""+d);var g=d.length;if(g===0)return 0;for(var w=!1;;)switch(m){case"ascii":case"latin1":case"binary":return g;case"utf8":case"utf-8":case void 0:return utf8ToBytes(d).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*g;case"hex":return g>>>1;case"base64":return base64ToBytes(d).length;default:if(w)return utf8ToBytes(d).length;m=(""+m).toLowerCase(),w=!0}}function slowToString(d,m,g){var w=!1;if((m===void 0||m<0)&&(m=0),m>this.length||((g===void 0||g>this.length)&&(g=this.length),g<=0)||(g>>>=0)<=(m>>>=0))return"";for(d||(d="utf8");;)switch(d){case"hex":return hexSlice(this,m,g);case"utf8":case"utf-8":return utf8Slice(this,m,g);case"ascii":return asciiSlice(this,m,g);case"latin1":case"binary":return latin1Slice(this,m,g);case"base64":return base64Slice(this,m,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,m,g);default:if(w)throw new TypeError("Unknown encoding: "+d);d=(d+"").toLowerCase(),w=!0}}function swap(d,m,g){var w=d[m];d[m]=d[g],d[g]=w}function bidirectionalIndexOf(d,m,g,w,$){if(d.length===0)return-1;if(typeof g=="string"?(w=g,g=0):g>2147483647?g=2147483647:g<-2147483648&&(g=-2147483648),g=+g,isNaN(g)&&(g=$?0:d.length-1),g<0&&(g=d.length+g),g>=d.length){if($)return-1;g=d.length-1}else if(g<0){if(!$)return-1;g=0}if(typeof m=="string"&&(m=Buffer.from(m,w)),internalIsBuffer(m))return m.length===0?-1:arrayIndexOf(d,m,g,w,$);if(typeof m=="number")return m&=255,Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?$?Uint8Array.prototype.indexOf.call(d,m,g):Uint8Array.prototype.lastIndexOf.call(d,m,g):arrayIndexOf(d,[m],g,w,$);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(d,m,g,w,$){var I,D=1,F=d.length,U=m.length;if(w!==void 0&&((w=String(w).toLowerCase())==="ucs2"||w==="ucs-2"||w==="utf16le"||w==="utf-16le")){if(d.length<2||m.length<2)return-1;D=2,F/=2,U/=2,g/=2}function q(V,Z){return D===1?V[Z]:V.readUInt16BE(Z*D)}if($){var j=-1;for(I=g;I<F;I++)if(q(d,I)===q(m,j===-1?0:I-j)){if(j===-1&&(j=I),I-j+1===U)return j*D}else j!==-1&&(I-=I-j),j=-1}else for(g+U>F&&(g=F-U),I=g;I>=0;I--){for(var G=!0,H=0;H<U;H++)if(q(d,I+H)!==q(m,H)){G=!1;break}if(G)return I}return-1}function hexWrite(d,m,g,w){g=Number(g)||0;var $=d.length-g;w?(w=Number(w))>$&&(w=$):w=$;var I=m.length;if(I%2!=0)throw new TypeError("Invalid hex string");w>I/2&&(w=I/2);for(var D=0;D<w;++D){var F=parseInt(m.substr(2*D,2),16);if(isNaN(F))return D;d[g+D]=F}return D}function utf8Write(d,m,g,w){return blitBuffer(utf8ToBytes(m,d.length-g),d,g,w)}function asciiWrite(d,m,g,w){return blitBuffer(asciiToBytes(m),d,g,w)}function latin1Write(d,m,g,w){return asciiWrite(d,m,g,w)}function base64Write(d,m,g,w){return blitBuffer(base64ToBytes(m),d,g,w)}function ucs2Write(d,m,g,w){return blitBuffer(utf16leToBytes(m,d.length-g),d,g,w)}function base64Slice(d,m,g){return m===0&&g===d.length?fromByteArray(d):fromByteArray(d.slice(m,g))}function utf8Slice(d,m,g){g=Math.min(d.length,g);for(var w=[],$=m;$<g;){var I,D,F,U,q=d[$],j=null,G=q>239?4:q>223?3:q>191?2:1;if($+G<=g)switch(G){case 1:q<128&&(j=q);break;case 2:(192&(I=d[$+1]))==128&&(U=(31&q)<<6|63&I)>127&&(j=U);break;case 3:I=d[$+1],D=d[$+2],(192&I)==128&&(192&D)==128&&(U=(15&q)<<12|(63&I)<<6|63&D)>2047&&(U<55296||U>57343)&&(j=U);break;case 4:I=d[$+1],D=d[$+2],F=d[$+3],(192&I)==128&&(192&D)==128&&(192&F)==128&&(U=(15&q)<<18|(63&I)<<12|(63&D)<<6|63&F)>65535&&U<1114112&&(j=U)}j===null?(j=65533,G=1):j>65535&&(j-=65536,w.push(j>>>10&1023|55296),j=56320|1023&j),w.push(j),$+=G}return decodeCodePointsArray(w)}Buffer.TYPED_ARRAY_SUPPORT=global$1.TYPED_ARRAY_SUPPORT===void 0||global$1.TYPED_ARRAY_SUPPORT,kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(d){return d.__proto__=Buffer.prototype,d},Buffer.from=function(d,m,g){return from(null,d,m,g)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&Buffer[Symbol.species]),Buffer.alloc=function(d,m,g){return alloc(null,d,m,g)},Buffer.allocUnsafe=function(d){return allocUnsafe(null,d)},Buffer.allocUnsafeSlow=function(d){return allocUnsafe(null,d)},Buffer.isBuffer=isBuffer,Buffer.compare=function(d,m){if(!internalIsBuffer(d)||!internalIsBuffer(m))throw new TypeError("Arguments must be Buffers");if(d===m)return 0;for(var g=d.length,w=m.length,$=0,I=Math.min(g,w);$<I;++$)if(d[$]!==m[$]){g=d[$],w=m[$];break}return g<w?-1:w<g?1:0},Buffer.isEncoding=function(d){switch(String(d).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(d,m){if(!isArray(d))throw new TypeError('"list" argument must be an Array of Buffers');if(d.length===0)return Buffer.alloc(0);var g;if(m===void 0)for(m=0,g=0;g<d.length;++g)m+=d[g].length;var w=Buffer.allocUnsafe(m),$=0;for(g=0;g<d.length;++g){var I=d[g];if(!internalIsBuffer(I))throw new TypeError('"list" argument must be an Array of Buffers');I.copy(w,$),$+=I.length}return w},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var d=this.length;if(d%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var m=0;m<d;m+=2)swap(this,m,m+1);return this},Buffer.prototype.swap32=function(){var d=this.length;if(d%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var m=0;m<d;m+=4)swap(this,m,m+3),swap(this,m+1,m+2);return this},Buffer.prototype.swap64=function(){var d=this.length;if(d%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var m=0;m<d;m+=8)swap(this,m,m+7),swap(this,m+1,m+6),swap(this,m+2,m+5),swap(this,m+3,m+4);return this},Buffer.prototype.toString=function(){var d=0|this.length;return d===0?"":arguments.length===0?utf8Slice(this,0,d):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(d){if(!internalIsBuffer(d))throw new TypeError("Argument must be a Buffer");return this===d||Buffer.compare(this,d)===0},Buffer.prototype.inspect=function(){var d="",m=INSPECT_MAX_BYTES;return this.length>0&&(d=this.toString("hex",0,m).match(/.{2}/g).join(" "),this.length>m&&(d+=" ... ")),"<Buffer "+d+">"},Buffer.prototype.compare=function(d,m,g,w,$){if(!internalIsBuffer(d))throw new TypeError("Argument must be a Buffer");if(m===void 0&&(m=0),g===void 0&&(g=d?d.length:0),w===void 0&&(w=0),$===void 0&&($=this.length),m<0||g>d.length||w<0||$>this.length)throw new RangeError("out of range index");if(w>=$&&m>=g)return 0;if(w>=$)return-1;if(m>=g)return 1;if(this===d)return 0;for(var I=($>>>=0)-(w>>>=0),D=(g>>>=0)-(m>>>=0),F=Math.min(I,D),U=this.slice(w,$),q=d.slice(m,g),j=0;j<F;++j)if(U[j]!==q[j]){I=U[j],D=q[j];break}return I<D?-1:D<I?1:0},Buffer.prototype.includes=function(d,m,g){return this.indexOf(d,m,g)!==-1},Buffer.prototype.indexOf=function(d,m,g){return bidirectionalIndexOf(this,d,m,g,!0)},Buffer.prototype.lastIndexOf=function(d,m,g){return bidirectionalIndexOf(this,d,m,g,!1)},Buffer.prototype.write=function(d,m,g,w){if(m===void 0)w="utf8",g=this.length,m=0;else if(g===void 0&&typeof m=="string")w=m,g=this.length,m=0;else{if(!isFinite(m))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");m|=0,isFinite(g)?(g|=0,w===void 0&&(w="utf8")):(w=g,g=void 0)}var $=this.length-m;if((g===void 0||g>$)&&(g=$),d.length>0&&(g<0||m<0)||m>this.length)throw new RangeError("Attempt to write outside buffer bounds");w||(w="utf8");for(var I=!1;;)switch(w){case"hex":return hexWrite(this,d,m,g);case"utf8":case"utf-8":return utf8Write(this,d,m,g);case"ascii":return asciiWrite(this,d,m,g);case"latin1":case"binary":return latin1Write(this,d,m,g);case"base64":return base64Write(this,d,m,g);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,d,m,g);default:if(I)throw new TypeError("Unknown encoding: "+w);w=(""+w).toLowerCase(),I=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(d){var m=d.length;if(m<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,d);for(var g="",w=0;w<m;)g+=String.fromCharCode.apply(String,d.slice(w,w+=MAX_ARGUMENTS_LENGTH));return g}function asciiSlice(d,m,g){var w="";g=Math.min(d.length,g);for(var $=m;$<g;++$)w+=String.fromCharCode(127&d[$]);return w}function latin1Slice(d,m,g){var w="";g=Math.min(d.length,g);for(var $=m;$<g;++$)w+=String.fromCharCode(d[$]);return w}function hexSlice(d,m,g){var w=d.length;(!m||m<0)&&(m=0),(!g||g<0||g>w)&&(g=w);for(var $="",I=m;I<g;++I)$+=toHex(d[I]);return $}function utf16leSlice(d,m,g){for(var w=d.slice(m,g),$="",I=0;I<w.length;I+=2)$+=String.fromCharCode(w[I]+256*w[I+1]);return $}function checkOffset(d,m,g){if(d%1!=0||d<0)throw new RangeError("offset is not uint");if(d+m>g)throw new RangeError("Trying to access beyond buffer length")}function checkInt(d,m,g,w,$,I){if(!internalIsBuffer(d))throw new TypeError('"buffer" argument must be a Buffer instance');if(m>$||m<I)throw new RangeError('"value" argument is out of bounds');if(g+w>d.length)throw new RangeError("Index out of range")}function objectWriteUInt16(d,m,g,w){m<0&&(m=65535+m+1);for(var $=0,I=Math.min(d.length-g,2);$<I;++$)d[g+$]=(m&255<<8*(w?$:1-$))>>>8*(w?$:1-$)}function objectWriteUInt32(d,m,g,w){m<0&&(m=4294967295+m+1);for(var $=0,I=Math.min(d.length-g,4);$<I;++$)d[g+$]=m>>>8*(w?$:3-$)&255}function checkIEEE754(d,m,g,w,$,I){if(g+w>d.length)throw new RangeError("Index out of range");if(g<0)throw new RangeError("Index out of range")}function writeFloat(d,m,g,w,$){return $||checkIEEE754(d,m,g,4),write(d,m,g,w,23,4),g+4}function writeDouble(d,m,g,w,$){return $||checkIEEE754(d,m,g,8),write(d,m,g,w,52,8),g+8}Buffer.prototype.slice=function(d,m){var g,w=this.length;if((d=~~d)<0?(d+=w)<0&&(d=0):d>w&&(d=w),(m=m===void 0?w:~~m)<0?(m+=w)<0&&(m=0):m>w&&(m=w),m<d&&(m=d),Buffer.TYPED_ARRAY_SUPPORT)(g=this.subarray(d,m)).__proto__=Buffer.prototype;else{var $=m-d;g=new Buffer($,void 0);for(var I=0;I<$;++I)g[I]=this[I+d]}return g},Buffer.prototype.readUIntLE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=this[d],$=1,I=0;++I<m&&($*=256);)w+=this[d+I]*$;return w},Buffer.prototype.readUIntBE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=this[d+--m],$=1;m>0&&($*=256);)w+=this[d+--m]*$;return w},Buffer.prototype.readUInt8=function(d,m){return m||checkOffset(d,1,this.length),this[d]},Buffer.prototype.readUInt16LE=function(d,m){return m||checkOffset(d,2,this.length),this[d]|this[d+1]<<8},Buffer.prototype.readUInt16BE=function(d,m){return m||checkOffset(d,2,this.length),this[d]<<8|this[d+1]},Buffer.prototype.readUInt32LE=function(d,m){return m||checkOffset(d,4,this.length),(this[d]|this[d+1]<<8|this[d+2]<<16)+16777216*this[d+3]},Buffer.prototype.readUInt32BE=function(d,m){return m||checkOffset(d,4,this.length),16777216*this[d]+(this[d+1]<<16|this[d+2]<<8|this[d+3])},Buffer.prototype.readIntLE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=this[d],$=1,I=0;++I<m&&($*=256);)w+=this[d+I]*$;return w>=($*=128)&&(w-=Math.pow(2,8*m)),w},Buffer.prototype.readIntBE=function(d,m,g){d|=0,m|=0,g||checkOffset(d,m,this.length);for(var w=m,$=1,I=this[d+--w];w>0&&($*=256);)I+=this[d+--w]*$;return I>=($*=128)&&(I-=Math.pow(2,8*m)),I},Buffer.prototype.readInt8=function(d,m){return m||checkOffset(d,1,this.length),128&this[d]?-1*(255-this[d]+1):this[d]},Buffer.prototype.readInt16LE=function(d,m){m||checkOffset(d,2,this.length);var g=this[d]|this[d+1]<<8;return 32768&g?4294901760|g:g},Buffer.prototype.readInt16BE=function(d,m){m||checkOffset(d,2,this.length);var g=this[d+1]|this[d]<<8;return 32768&g?4294901760|g:g},Buffer.prototype.readInt32LE=function(d,m){return m||checkOffset(d,4,this.length),this[d]|this[d+1]<<8|this[d+2]<<16|this[d+3]<<24},Buffer.prototype.readInt32BE=function(d,m){return m||checkOffset(d,4,this.length),this[d]<<24|this[d+1]<<16|this[d+2]<<8|this[d+3]},Buffer.prototype.readFloatLE=function(d,m){return m||checkOffset(d,4,this.length),read(this,d,!0,23,4)},Buffer.prototype.readFloatBE=function(d,m){return m||checkOffset(d,4,this.length),read(this,d,!1,23,4)},Buffer.prototype.readDoubleLE=function(d,m){return m||checkOffset(d,8,this.length),read(this,d,!0,52,8)},Buffer.prototype.readDoubleBE=function(d,m){return m||checkOffset(d,8,this.length),read(this,d,!1,52,8)},Buffer.prototype.writeUIntLE=function(d,m,g,w){d=+d,m|=0,g|=0,w||checkInt(this,d,m,g,Math.pow(2,8*g)-1,0);var $=1,I=0;for(this[m]=255&d;++I<g&&($*=256);)this[m+I]=d/$&255;return m+g},Buffer.prototype.writeUIntBE=function(d,m,g,w){d=+d,m|=0,g|=0,w||checkInt(this,d,m,g,Math.pow(2,8*g)-1,0);var $=g-1,I=1;for(this[m+$]=255&d;--$>=0&&(I*=256);)this[m+$]=d/I&255;return m+g},Buffer.prototype.writeUInt8=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(d=Math.floor(d)),this[m]=255&d,m+1},Buffer.prototype.writeUInt16LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=255&d,this[m+1]=d>>>8):objectWriteUInt16(this,d,m,!0),m+2},Buffer.prototype.writeUInt16BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>8,this[m+1]=255&d):objectWriteUInt16(this,d,m,!1),m+2},Buffer.prototype.writeUInt32LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m+3]=d>>>24,this[m+2]=d>>>16,this[m+1]=d>>>8,this[m]=255&d):objectWriteUInt32(this,d,m,!0),m+4},Buffer.prototype.writeUInt32BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>24,this[m+1]=d>>>16,this[m+2]=d>>>8,this[m+3]=255&d):objectWriteUInt32(this,d,m,!1),m+4},Buffer.prototype.writeIntLE=function(d,m,g,w){if(d=+d,m|=0,!w){var $=Math.pow(2,8*g-1);checkInt(this,d,m,g,$-1,-$)}var I=0,D=1,F=0;for(this[m]=255&d;++I<g&&(D*=256);)d<0&&F===0&&this[m+I-1]!==0&&(F=1),this[m+I]=(d/D|0)-F&255;return m+g},Buffer.prototype.writeIntBE=function(d,m,g,w){if(d=+d,m|=0,!w){var $=Math.pow(2,8*g-1);checkInt(this,d,m,g,$-1,-$)}var I=g-1,D=1,F=0;for(this[m+I]=255&d;--I>=0&&(D*=256);)d<0&&F===0&&this[m+I+1]!==0&&(F=1),this[m+I]=(d/D|0)-F&255;return m+g},Buffer.prototype.writeInt8=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(d=Math.floor(d)),d<0&&(d=255+d+1),this[m]=255&d,m+1},Buffer.prototype.writeInt16LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=255&d,this[m+1]=d>>>8):objectWriteUInt16(this,d,m,!0),m+2},Buffer.prototype.writeInt16BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>8,this[m+1]=255&d):objectWriteUInt16(this,d,m,!1),m+2},Buffer.prototype.writeInt32LE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=255&d,this[m+1]=d>>>8,this[m+2]=d>>>16,this[m+3]=d>>>24):objectWriteUInt32(this,d,m,!0),m+4},Buffer.prototype.writeInt32BE=function(d,m,g){return d=+d,m|=0,g||checkInt(this,d,m,4,2147483647,-2147483648),d<0&&(d=4294967295+d+1),Buffer.TYPED_ARRAY_SUPPORT?(this[m]=d>>>24,this[m+1]=d>>>16,this[m+2]=d>>>8,this[m+3]=255&d):objectWriteUInt32(this,d,m,!1),m+4},Buffer.prototype.writeFloatLE=function(d,m,g){return writeFloat(this,d,m,!0,g)},Buffer.prototype.writeFloatBE=function(d,m,g){return writeFloat(this,d,m,!1,g)},Buffer.prototype.writeDoubleLE=function(d,m,g){return writeDouble(this,d,m,!0,g)},Buffer.prototype.writeDoubleBE=function(d,m,g){return writeDouble(this,d,m,!1,g)},Buffer.prototype.copy=function(d,m,g,w){if(g||(g=0),w||w===0||(w=this.length),m>=d.length&&(m=d.length),m||(m=0),w>0&&w<g&&(w=g),w===g||d.length===0||this.length===0)return 0;if(m<0)throw new RangeError("targetStart out of bounds");if(g<0||g>=this.length)throw new RangeError("sourceStart out of bounds");if(w<0)throw new RangeError("sourceEnd out of bounds");w>this.length&&(w=this.length),d.length-m<w-g&&(w=d.length-m+g);var $,I=w-g;if(this===d&&g<m&&m<w)for($=I-1;$>=0;--$)d[$+m]=this[$+g];else if(I<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for($=0;$<I;++$)d[$+m]=this[$+g];else Uint8Array.prototype.set.call(d,this.subarray(g,g+I),m);return I},Buffer.prototype.fill=function(d,m,g,w){if(typeof d=="string"){if(typeof m=="string"?(w=m,m=0,g=this.length):typeof g=="string"&&(w=g,g=this.length),d.length===1){var $=d.charCodeAt(0);$<256&&(d=$)}if(w!==void 0&&typeof w!="string")throw new TypeError("encoding must be a string");if(typeof w=="string"&&!Buffer.isEncoding(w))throw new TypeError("Unknown encoding: "+w)}else typeof d=="number"&&(d&=255);if(m<0||this.length<m||this.length<g)throw new RangeError("Out of range index");if(g<=m)return this;var I;if(m>>>=0,g=g===void 0?this.length:g>>>0,d||(d=0),typeof d=="number")for(I=m;I<g;++I)this[I]=d;else{var D=internalIsBuffer(d)?d:utf8ToBytes(new Buffer(d,w).toString()),F=D.length;for(I=0;I<g-m;++I)this[I+m]=D[I%F]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g,HeaderTypes;function base64clean(d){if((d=stringtrim(d).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;d.length%4!=0;)d+="=";return d}function stringtrim(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")}function toHex(d){return d<16?"0"+d.toString(16):d.toString(16)}function utf8ToBytes(d,m){var g;m=m||1/0;for(var w=d.length,$=null,I=[],D=0;D<w;++D){if((g=d.charCodeAt(D))>55295&&g<57344){if(!$){if(g>56319){(m-=3)>-1&&I.push(239,191,189);continue}if(D+1===w){(m-=3)>-1&&I.push(239,191,189);continue}$=g;continue}if(g<56320){(m-=3)>-1&&I.push(239,191,189),$=g;continue}g=65536+($-55296<<10|g-56320)}else $&&(m-=3)>-1&&I.push(239,191,189);if($=null,g<128){if((m-=1)<0)break;I.push(g)}else if(g<2048){if((m-=2)<0)break;I.push(g>>6|192,63&g|128)}else if(g<65536){if((m-=3)<0)break;I.push(g>>12|224,g>>6&63|128,63&g|128)}else{if(!(g<1114112))throw new Error("Invalid code point");if((m-=4)<0)break;I.push(g>>18|240,g>>12&63|128,g>>6&63|128,63&g|128)}}return I}function asciiToBytes(d){for(var m=[],g=0;g<d.length;++g)m.push(255&d.charCodeAt(g));return m}function utf16leToBytes(d,m){for(var g,w,$,I=[],D=0;D<d.length&&!((m-=2)<0);++D)w=(g=d.charCodeAt(D))>>8,$=g%256,I.push($),I.push(w);return I}function base64ToBytes(d){return toByteArray(base64clean(d))}function blitBuffer(d,m,g,w){for(var $=0;$<w&&!($+g>=m.length||$>=d.length);++$)m[$+g]=d[$];return $}function isnan(d){return d!=d}function isBuffer(d){return d!=null&&(!!d._isBuffer||isFastBuffer(d)||isSlowBuffer(d))}function isFastBuffer(d){return!!d.constructor&&typeof d.constructor.isBuffer=="function"&&d.constructor.isBuffer(d)}function isSlowBuffer(d){return typeof d.readFloatLE=="function"&&typeof d.slice=="function"&&isFastBuffer(d.slice(0,0))}(function(d){d[d.BITMAP_INFO_HEADER=40]="BITMAP_INFO_HEADER",d[d.BITMAP_V2_INFO_HEADER=52]="BITMAP_V2_INFO_HEADER",d[d.BITMAP_V3_INFO_HEADER=56]="BITMAP_V3_INFO_HEADER",d[d.BITMAP_V4_HEADER=108]="BITMAP_V4_HEADER",d[d.BITMAP_V5_HEADER=124]="BITMAP_V5_HEADER"})(HeaderTypes||(HeaderTypes={}));var HeaderTypes$1=HeaderTypes,BmpCompression;function maskColor(d,m,g,w){const $=1+~d&d,I=1+~m&m,D=1+~g&g,F=1+~w&w,U=d/$+1,q=m/I+1,j=g/D+1,G=w/F+1;return{shiftRed:H=>(H&d)/$*256/U,shiftGreen:H=>(H&m)/I*256/q,shiftBlue:H=>(H&g)/D*256/j,shiftAlpha:w!==0?H=>(H&w)/F*256/G:()=>255}}(function(d){d[d.NONE=0]="NONE",d[d.BI_RLE8=1]="BI_RLE8",d[d.BI_RLE4=2]="BI_RLE4",d[d.BI_BIT_FIELDS=3]="BI_BIT_FIELDS",d[d.BI_ALPHA_BIT_FIELDS=6]="BI_ALPHA_BIT_FIELDS"})(BmpCompression||(BmpCompression={}));class BmpDecoder{flag;fileSize;reserved1;reserved2;offset;headerSize;width;height;planes;bitPP;compression;rawSize;hr;vr;colors;importantColors;palette;data;maskRed;maskGreen;maskBlue;maskAlpha;toRGBA;pos;bottomUp;buffer;locRed;locGreen;locBlue;locAlpha;shiftRed;shiftGreen;shiftBlue;shiftAlpha;constructor(m,{toRGBA:g}={toRGBA:!1}){if(this.buffer=m,this.toRGBA=!!g,this.pos=0,this.bottomUp=!0,this.flag=this.buffer.toString("utf-8",0,this.pos+=2),this.flag!=="BM")throw new Error("Invalid BMP File");this.locRed=this.toRGBA?0:3,this.locGreen=this.toRGBA?1:2,this.locBlue=this.toRGBA?2:1,this.locAlpha=this.toRGBA?3:0,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.readUInt32LE(),this.reserved1=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.reserved2=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.offset=this.readUInt32LE(),this.headerSize=this.readUInt32LE(),!(this.headerSize in HeaderTypes$1))throw new Error(`Unsupported BMP header size ${this.headerSize}`);if(this.width=this.readUInt32LE(),this.height=this.readUInt32LE(),this.height=this.height>2147483647?this.height-4294967296:this.height,this.planes=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.bitPP=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.compression=this.readUInt32LE(),this.rawSize=this.readUInt32LE(),this.hr=this.readUInt32LE(),this.vr=this.readUInt32LE(),this.colors=this.readUInt32LE(),this.importantColors=this.readUInt32LE(),this.bitPP===32?(this.maskAlpha=0,this.maskRed=16711680,this.maskGreen=65280,this.maskBlue=255):this.bitPP===16&&(this.maskAlpha=0,this.maskRed=31744,this.maskGreen=992,this.maskBlue=31),(this.headerSize>HeaderTypes$1.BITMAP_INFO_HEADER||this.compression===BmpCompression.BI_BIT_FIELDS||this.compression===BmpCompression.BI_ALPHA_BIT_FIELDS)&&(this.maskRed=this.readUInt32LE(),this.maskGreen=this.readUInt32LE(),this.maskBlue=this.readUInt32LE()),(this.headerSize>HeaderTypes$1.BITMAP_V2_INFO_HEADER||this.compression===BmpCompression.BI_ALPHA_BIT_FIELDS)&&(this.maskAlpha=this.readUInt32LE()),this.headerSize>HeaderTypes$1.BITMAP_V3_INFO_HEADER&&(this.pos+=HeaderTypes$1.BITMAP_V4_HEADER-HeaderTypes$1.BITMAP_V3_INFO_HEADER),this.headerSize>HeaderTypes$1.BITMAP_V4_HEADER&&(this.pos+=HeaderTypes$1.BITMAP_V5_HEADER-HeaderTypes$1.BITMAP_V4_HEADER),this.bitPP<=8||this.colors>0){const g=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(g);for(let w=0;w<g;w++){const $=this.buffer.readUInt8(this.pos++),I=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++),F=this.buffer.readUInt8(this.pos++);this.palette[w]={red:D,green:I,blue:$,quad:F}}}this.height<0&&(this.height*=-1,this.bottomUp=!1);const m=maskColor(this.maskRed,this.maskGreen,this.maskBlue,this.maskAlpha);this.shiftRed=m.shiftRed,this.shiftGreen=m.shiftGreen,this.shiftBlue=m.shiftBlue,this.shiftAlpha=m.shiftAlpha}parseRGBA(){switch(this.data=Buffer.alloc(this.width*this.height*4),this.bitPP){case 1:this.bit1();break;case 4:this.bit4();break;case 8:this.bit8();break;case 16:this.bit16();break;case 24:this.bit24();break;default:this.bit32()}}bit1(){const m=Math.ceil(this.width/8),g=m%4,w=g!==0?4-g:0;this.scanImage(w,m,(($,I)=>{const D=this.buffer.readUInt8(this.pos++),F=I*this.width*4+8*$*4;for(let U=0;U<8&&8*$+U<this.width;U++){const q=this.palette[D>>7-U&1];this.data[F+U*this.locAlpha]=0,this.data[F+4*U+this.locBlue]=q.blue,this.data[F+4*U+this.locGreen]=q.green,this.data[F+4*U+this.locRed]=q.red}}))}bit4(){if(this.compression===BmpCompression.BI_RLE4){this.data.fill(0);let m=!1,g=this.bottomUp?this.height-1:0,w=0;for(;w<this.data.length;){const $=this.buffer.readUInt8(this.pos++),I=this.buffer.readUInt8(this.pos++);if($===0){if(I===0){g+=this.bottomUp?-1:1,w=g*this.width*4,m=!1;continue}if(I===1)break;if(I===2){const D=this.buffer.readUInt8(this.pos++),F=this.buffer.readUInt8(this.pos++);g+=this.bottomUp?-F:F,w+=F*this.width*4+4*D}else{let D=this.buffer.readUInt8(this.pos++);for(let F=0;F<I;F++)w=this.setPixelData(w,m?15&D:(240&D)>>4),1&F&&F+1<I&&(D=this.buffer.readUInt8(this.pos++)),m=!m;(I+1>>1&1)==1&&this.pos++}}else for(let D=0;D<$;D++)w=this.setPixelData(w,m?15&I:(240&I)>>4),m=!m}}else{const m=Math.ceil(this.width/2),g=m%4,w=g!==0?4-g:0;this.scanImage(w,m,(($,I)=>{const D=this.buffer.readUInt8(this.pos++),F=I*this.width*4+2*$*4,U=D>>4;let q=this.palette[U];if(this.data[F]=0,this.data[F+1]=q.blue,this.data[F+2]=q.green,this.data[F+3]=q.red,2*$+1>=this.width)return!1;const j=15&D;q=this.palette[j],this.data[F+4]=0,this.data[F+4+1]=q.blue,this.data[F+4+2]=q.green,this.data[F+4+3]=q.red}))}}bit8(){if(this.compression===BmpCompression.BI_RLE8){this.data.fill(0);let m=this.bottomUp?this.height-1:0,g=0;for(;g<this.data.length;){const w=this.buffer.readUInt8(this.pos++),$=this.buffer.readUInt8(this.pos++);if(w===0){if($===0){m+=this.bottomUp?-1:1,g=m*this.width*4;continue}if($===1)break;if($===2){const I=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++);m+=this.bottomUp?-D:D,g+=D*this.width*4+4*I}else{for(let I=0;I<$;I++){const D=this.buffer.readUInt8(this.pos++);g=this.setPixelData(g,D)}!0&$&&this.pos++}}else for(let I=0;I<w;I++)g=this.setPixelData(g,$)}}else{const m=this.width%4,g=m!==0?4-m:0;this.scanImage(g,this.width,((w,$)=>{const I=this.buffer.readUInt8(this.pos++),D=$*this.width*4+4*w;if(I<this.palette.length){const F=this.palette[I];this.data[D]=0,this.data[D+1]=F.blue,this.data[D+2]=F.green,this.data[D+3]=F.red}else this.data[D]=0,this.data[D+1]=255,this.data[D+2]=255,this.data[D+3]=255}))}}bit16(){const m=this.width%2*2;this.scanImage(m,this.width,((g,w)=>{const $=w*this.width*4+4*g,I=this.buffer.readUInt16LE(this.pos);this.pos+=2,this.data[$+this.locRed]=this.shiftRed(I),this.data[$+this.locGreen]=this.shiftGreen(I),this.data[$+this.locBlue]=this.shiftBlue(I),this.data[$+this.locAlpha]=this.shiftAlpha(I)}))}bit24(){const m=this.width%4;this.scanImage(m,this.width,((g,w)=>{const $=w*this.width*4+4*g,I=this.buffer.readUInt8(this.pos++),D=this.buffer.readUInt8(this.pos++),F=this.buffer.readUInt8(this.pos++);this.data[$+this.locRed]=F,this.data[$+this.locGreen]=D,this.data[$+this.locBlue]=I,this.data[$+this.locAlpha]=0}))}bit32(){this.scanImage(0,this.width,((m,g)=>{const w=g*this.width*4+4*m,$=this.readUInt32LE();this.data[w+this.locRed]=this.shiftRed($),this.data[w+this.locGreen]=this.shiftGreen($),this.data[w+this.locBlue]=this.shiftBlue($),this.data[w+this.locAlpha]=this.shiftAlpha($)}))}scanImage(m=0,g=this.width,w){for(let $=this.height-1;$>=0;$--){const I=this.bottomUp?$:this.height-1-$;for(let D=0;D<g;D++)if(w.call(this,D,I)===!1)return;this.pos+=m}}readUInt32LE(){const m=this.buffer.readUInt32LE(this.pos);return this.pos+=4,m}setPixelData(m,g){const{blue:w,green:$,red:I}=this.palette[g];return this.data[m+this.locAlpha]=0,this.data[m+1+this.locBlue]=w,this.data[m+2+this.locGreen]=$,this.data[m+3+this.locRed]=I,m+4}}function createInteger(d){return d.reduce(((m,g)=>m<<1|g),0)}function createColor(d){return d.quad<<24|d.red<<16|d.green<<8|d.blue}class BmpEncoder{fileSize;reserved1;reserved2;offset;width;flag;height;planes;bitPP;compress;hr;vr;colors;importantColors;rawSize;headerSize;data;palette;extraBytes;buffer;bytesInColor;pos;constructor(m){switch(this.buffer=m.data,this.width=m.width,this.height=m.height,this.headerSize=HeaderTypes$1.BITMAP_INFO_HEADER,this.flag="BM",this.bitPP=m.bitPP||24,this.offset=54,this.reserved1=m.reserved1||0,this.reserved2=m.reserved2||0,this.planes=1,this.compress=0,this.hr=m.hr||0,this.vr=m.vr||0,this.importantColors=m.importantColors||0,this.colors=Math.min(2**(this.bitPP-1||1),m.colors||1/0),this.palette=m.palette||[],this.colors&&this.bitPP<16?this.offset+=4*this.colors:this.colors=0,this.bitPP){case 32:this.bytesInColor=4;break;case 16:this.bytesInColor=2;break;case 8:this.bytesInColor=1;break;case 4:this.bytesInColor=.5;break;case 1:this.bytesInColor=1/8;break;default:this.bytesInColor=3,this.bitPP=24}const g=this.width*this.bitPP/32,w=Math.ceil(g);this.extraBytes=4*(w-g),this.rawSize=this.height*w*4+2,this.fileSize=this.rawSize+this.offset,this.data=Buffer.alloc(this.fileSize,1),this.pos=0,this.encode()}encode(){switch(this.pos=0,this.writeHeader(),this.bitPP){case 32:this.bit32();break;case 16:this.bit16();break;case 8:this.bit8();break;case 4:this.bit4();break;case 1:this.bit1();break;default:this.bit24()}}writeHeader(){this.data.write(this.flag,this.pos,2),this.pos+=2,this.writeUInt32LE(this.fileSize),this.writeUInt32LE(this.reserved1<<16|this.reserved2),this.writeUInt32LE(this.offset),this.writeUInt32LE(this.headerSize),this.writeUInt32LE(this.width),this.writeUInt32LE(this.height),this.data.writeUInt16LE(this.planes,this.pos),this.pos+=2,this.data.writeUInt16LE(this.bitPP,this.pos),this.pos+=2,this.writeUInt32LE(this.compress),this.writeUInt32LE(this.rawSize),this.writeUInt32LE(this.hr),this.writeUInt32LE(this.vr),this.writeUInt32LE(this.colors),this.writeUInt32LE(this.importantColors)}bit1(){this.palette.length&&this.colors===2?this.initColors(1):(this.writeUInt32LE(16777215),this.writeUInt32LE(0)),this.pos+=1;let m=[];this.writeImage(((g,w,$)=>{let I=w;I++;const D=this.buffer[I++],F=this.buffer[I++],U=.2126*this.buffer[I++]+.7152*F+.0722*D;return m.push(U>127?0:1),($+1)%8==0?(this.data[g-1]=createInteger(m),m=[]):$===this.width-1&&m.length>0&&(this.data[g-1]=createInteger(m)<<4,m=[]),I}))}bit4(){const m=this.initColors(4);let g=[];this.writeImage(((w,$,I)=>{let D=$;const F=createColor({quad:this.buffer[D++],blue:this.buffer[D++],green:this.buffer[D++],red:this.buffer[D++]}),U=m.findIndex((q=>q===F));return U!==-1?g.push(U):g.push(0),(I+1)%2==0&&(this.data[w]=g[0]<<4|g[1],g=[]),D}))}bit8(){const m=this.initColors(8);this.writeImage(((g,w)=>{let $=w;const I=createColor({quad:this.buffer[$++],blue:this.buffer[$++],green:this.buffer[$++],red:this.buffer[$++]}),D=m.findIndex((F=>F===I));return this.data[g]=D!==-1?D:0,$}))}bit16(){this.writeImage(((m,g)=>{let w=g+1;const $=this.buffer[w++]/8,I=this.buffer[w++]/8,D=this.buffer[w++]/8<<10|I<<5|$;return this.data[m]=255&D,this.data[m+1]=(65280&D)>>8,w}))}bit24(){this.writeImage(((m,g)=>{let w=g+1;return this.data[m]=this.buffer[w++],this.data[m+1]=this.buffer[w++],this.data[m+2]=this.buffer[w++],w}))}bit32(){this.writeImage(((m,g)=>{let w=g;return this.data[m+3]=this.buffer[w++],this.data[m]=this.buffer[w++],this.data[m+1]=this.buffer[w++],this.data[m+2]=this.buffer[w++],w}))}writeImage(m){const g=this.extraBytes+this.width*this.bytesInColor;let w=0;for(let $=0;$<this.height;$++)for(let I=0;I<this.width;I++){const D=Math.floor(this.pos+(this.height-1-$)*g+I*this.bytesInColor);w=m.call(this,D,w,I,$)}}initColors(m){const g=[];if(!this.palette.length)throw new Error(`To encode ${m}-bit BMPs a pallette is needed. Please choose up to ${this.colors} colors. Colors must be 32-bit integers.`);for(let w=0;w<this.colors;w++){const $=createColor(this.palette[w]);this.writeUInt32LE($),g.push($)}return g}writeUInt32LE(m){this.data.writeUInt32LE(m,this.pos),this.pos+=4}}function decode$2(d,m){return new BmpDecoder(d,m)}function encode$2(d){return new BmpEncoder(d)}function _typeof(d){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},_typeof(d)}var trimLeft=/^\s+/,trimRight=/\s+$/;function tinycolor(d,m){if(m=m||{},(d=d||"")instanceof tinycolor)return d;if(!(this instanceof tinycolor))return new tinycolor(d,m);var g=inputToRGB(d);this._originalInput=d,this._r=g.r,this._g=g.g,this._b=g.b,this._a=g.a,this._roundA=Math.round(100*this._a)/100,this._format=m.format||g.format,this._gradientType=m.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=g.ok}function inputToRGB(d){var m={r:0,g:0,b:0},g=1,w=null,$=null,I=null,D=!1,F=!1;return typeof d=="string"&&(d=stringInputToObject(d)),_typeof(d)=="object"&&(isValidCSSUnit(d.r)&&isValidCSSUnit(d.g)&&isValidCSSUnit(d.b)?(m=rgbToRgb(d.r,d.g,d.b),D=!0,F=String(d.r).substr(-1)==="%"?"prgb":"rgb"):isValidCSSUnit(d.h)&&isValidCSSUnit(d.s)&&isValidCSSUnit(d.v)?(w=convertToPercentage(d.s),$=convertToPercentage(d.v),m=hsvToRgb(d.h,w,$),D=!0,F="hsv"):isValidCSSUnit(d.h)&&isValidCSSUnit(d.s)&&isValidCSSUnit(d.l)&&(w=convertToPercentage(d.s),I=convertToPercentage(d.l),m=hslToRgb(d.h,w,I),D=!0,F="hsl"),d.hasOwnProperty("a")&&(g=d.a)),g=boundAlpha(g),{ok:D,format:d.format||F,r:Math.min(255,Math.max(m.r,0)),g:Math.min(255,Math.max(m.g,0)),b:Math.min(255,Math.max(m.b,0)),a:g}}function rgbToRgb(d,m,g){return{r:255*bound01(d,255),g:255*bound01(m,255),b:255*bound01(g,255)}}function rgbToHsl(d,m,g){d=bound01(d,255),m=bound01(m,255),g=bound01(g,255);var w,$,I=Math.max(d,m,g),D=Math.min(d,m,g),F=(I+D)/2;if(I==D)w=$=0;else{var U=I-D;switch($=F>.5?U/(2-I-D):U/(I+D),I){case d:w=(m-g)/U+(m<g?6:0);break;case m:w=(g-d)/U+2;break;case g:w=(d-m)/U+4}w/=6}return{h:w,s:$,l:F}}function hslToRgb(d,m,g){var w,$,I;function D(q,j,G){return G<0&&(G+=1),G>1&&(G-=1),G<1/6?q+6*(j-q)*G:G<.5?j:G<2/3?q+(j-q)*(2/3-G)*6:q}if(d=bound01(d,360),m=bound01(m,100),g=bound01(g,100),m===0)w=$=I=g;else{var F=g<.5?g*(1+m):g+m-g*m,U=2*g-F;w=D(U,F,d+1/3),$=D(U,F,d),I=D(U,F,d-1/3)}return{r:255*w,g:255*$,b:255*I}}function rgbToHsv(d,m,g){d=bound01(d,255),m=bound01(m,255),g=bound01(g,255);var w,$,I=Math.max(d,m,g),D=Math.min(d,m,g),F=I,U=I-D;if($=I===0?0:U/I,I==D)w=0;else{switch(I){case d:w=(m-g)/U+(m<g?6:0);break;case m:w=(g-d)/U+2;break;case g:w=(d-m)/U+4}w/=6}return{h:w,s:$,v:F}}function hsvToRgb(d,m,g){d=6*bound01(d,360),m=bound01(m,100),g=bound01(g,100);var w=Math.floor(d),$=d-w,I=g*(1-m),D=g*(1-$*m),F=g*(1-(1-$)*m),U=w%6;return{r:255*[g,D,I,I,F,g][U],g:255*[F,g,g,D,I,I][U],b:255*[I,I,F,g,g,D][U]}}function rgbToHex(d,m,g,w){var $=[pad2(Math.round(d).toString(16)),pad2(Math.round(m).toString(16)),pad2(Math.round(g).toString(16))];return w&&$[0].charAt(0)==$[0].charAt(1)&&$[1].charAt(0)==$[1].charAt(1)&&$[2].charAt(0)==$[2].charAt(1)?$[0].charAt(0)+$[1].charAt(0)+$[2].charAt(0):$.join("")}function rgbaToHex(d,m,g,w,$){var I=[pad2(Math.round(d).toString(16)),pad2(Math.round(m).toString(16)),pad2(Math.round(g).toString(16)),pad2(convertDecimalToHex(w))];return $&&I[0].charAt(0)==I[0].charAt(1)&&I[1].charAt(0)==I[1].charAt(1)&&I[2].charAt(0)==I[2].charAt(1)&&I[3].charAt(0)==I[3].charAt(1)?I[0].charAt(0)+I[1].charAt(0)+I[2].charAt(0)+I[3].charAt(0):I.join("")}function rgbaToArgbHex(d,m,g,w){return[pad2(convertDecimalToHex(w)),pad2(Math.round(d).toString(16)),pad2(Math.round(m).toString(16)),pad2(Math.round(g).toString(16))].join("")}function _desaturate(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.s-=m/100,g.s=clamp01(g.s),tinycolor(g)}function _saturate(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.s+=m/100,g.s=clamp01(g.s),tinycolor(g)}function _greyscale(d){return tinycolor(d).desaturate(100)}function _lighten(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.l+=m/100,g.l=clamp01(g.l),tinycolor(g)}function _brighten(d,m){m=m===0?0:m||10;var g=tinycolor(d).toRgb();return g.r=Math.max(0,Math.min(255,g.r-Math.round(-m/100*255))),g.g=Math.max(0,Math.min(255,g.g-Math.round(-m/100*255))),g.b=Math.max(0,Math.min(255,g.b-Math.round(-m/100*255))),tinycolor(g)}function _darken(d,m){m=m===0?0:m||10;var g=tinycolor(d).toHsl();return g.l-=m/100,g.l=clamp01(g.l),tinycolor(g)}function _spin(d,m){var g=tinycolor(d).toHsl(),w=(g.h+m)%360;return g.h=w<0?360+w:w,tinycolor(g)}function _complement(d){var m=tinycolor(d).toHsl();return m.h=(m.h+180)%360,tinycolor(m)}function polyad(d,m){if(isNaN(m)||m<=0)throw new Error("Argument to polyad must be a positive number");for(var g=tinycolor(d).toHsl(),w=[tinycolor(d)],$=360/m,I=1;I<m;I++)w.push(tinycolor({h:(g.h+I*$)%360,s:g.s,l:g.l}));return w}function _splitcomplement(d){var m=tinycolor(d).toHsl(),g=m.h;return[tinycolor(d),tinycolor({h:(g+72)%360,s:m.s,l:m.l}),tinycolor({h:(g+216)%360,s:m.s,l:m.l})]}function _analogous(d,m,g){m=m||6,g=g||30;var w=tinycolor(d).toHsl(),$=360/g,I=[tinycolor(d)];for(w.h=(w.h-($*m>>1)+720)%360;--m;)w.h=(w.h+$)%360,I.push(tinycolor(w));return I}function _monochromatic(d,m){m=m||6;for(var g=tinycolor(d).toHsv(),w=g.h,$=g.s,I=g.v,D=[],F=1/m;m--;)D.push(tinycolor({h:w,s:$,v:I})),I=(I+F)%1;return D}tinycolor.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var d=this.toRgb();return(299*d.r+587*d.g+114*d.b)/1e3},getLuminance:function(){var d,m,g,w=this.toRgb();return d=w.r/255,m=w.g/255,g=w.b/255,.2126*(d<=.03928?d/12.92:Math.pow((d+.055)/1.055,2.4))+.7152*(m<=.03928?m/12.92:Math.pow((m+.055)/1.055,2.4))+.0722*(g<=.03928?g/12.92:Math.pow((g+.055)/1.055,2.4))},setAlpha:function(d){return this._a=boundAlpha(d),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var d=rgbToHsv(this._r,this._g,this._b);return{h:360*d.h,s:d.s,v:d.v,a:this._a}},toHsvString:function(){var d=rgbToHsv(this._r,this._g,this._b),m=Math.round(360*d.h),g=Math.round(100*d.s),w=Math.round(100*d.v);return this._a==1?"hsv("+m+", "+g+"%, "+w+"%)":"hsva("+m+", "+g+"%, "+w+"%, "+this._roundA+")"},toHsl:function(){var d=rgbToHsl(this._r,this._g,this._b);return{h:360*d.h,s:d.s,l:d.l,a:this._a}},toHslString:function(){var d=rgbToHsl(this._r,this._g,this._b),m=Math.round(360*d.h),g=Math.round(100*d.s),w=Math.round(100*d.l);return this._a==1?"hsl("+m+", "+g+"%, "+w+"%)":"hsla("+m+", "+g+"%, "+w+"%, "+this._roundA+")"},toHex:function(d){return rgbToHex(this._r,this._g,this._b,d)},toHexString:function(d){return"#"+this.toHex(d)},toHex8:function(d){return rgbaToHex(this._r,this._g,this._b,this._a,d)},toHex8String:function(d){return"#"+this.toHex8(d)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*bound01(this._r,255))+"%",g:Math.round(100*bound01(this._g,255))+"%",b:Math.round(100*bound01(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(100*bound01(this._r,255))+"%, "+Math.round(100*bound01(this._g,255))+"%, "+Math.round(100*bound01(this._b,255))+"%)":"rgba("+Math.round(100*bound01(this._r,255))+"%, "+Math.round(100*bound01(this._g,255))+"%, "+Math.round(100*bound01(this._b,255))+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":!(this._a<1)&&(hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1)},toFilter:function(d){var m="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),g=m,w=this._gradientType?"GradientType = 1, ":"";if(d){var $=tinycolor(d);g="#"+rgbaToArgbHex($._r,$._g,$._b,$._a)}return"progid:DXImageTransform.Microsoft.gradient("+w+"startColorstr="+m+",endColorstr="+g+")"},toString:function(d){var m=!!d;d=d||this._format;var g=!1,w=this._a<1&&this._a>=0;return m||!w||d!=="hex"&&d!=="hex6"&&d!=="hex3"&&d!=="hex4"&&d!=="hex8"&&d!=="name"?(d==="rgb"&&(g=this.toRgbString()),d==="prgb"&&(g=this.toPercentageRgbString()),d!=="hex"&&d!=="hex6"||(g=this.toHexString()),d==="hex3"&&(g=this.toHexString(!0)),d==="hex4"&&(g=this.toHex8String(!0)),d==="hex8"&&(g=this.toHex8String()),d==="name"&&(g=this.toName()),d==="hsl"&&(g=this.toHslString()),d==="hsv"&&(g=this.toHsvString()),g||this.toHexString()):d==="name"&&this._a===0?this.toName():this.toRgbString()},clone:function(){return tinycolor(this.toString())},_applyModification:function(d,m){var g=d.apply(null,[this].concat([].slice.call(m)));return this._r=g._r,this._g=g._g,this._b=g._b,this.setAlpha(g._a),this},lighten:function(){return this._applyModification(_lighten,arguments)},brighten:function(){return this._applyModification(_brighten,arguments)},darken:function(){return this._applyModification(_darken,arguments)},desaturate:function(){return this._applyModification(_desaturate,arguments)},saturate:function(){return this._applyModification(_saturate,arguments)},greyscale:function(){return this._applyModification(_greyscale,arguments)},spin:function(){return this._applyModification(_spin,arguments)},_applyCombination:function(d,m){return d.apply(null,[this].concat([].slice.call(m)))},analogous:function(){return this._applyCombination(_analogous,arguments)},complement:function(){return this._applyCombination(_complement,arguments)},monochromatic:function(){return this._applyCombination(_monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(_splitcomplement,arguments)},triad:function(){return this._applyCombination(polyad,[3])},tetrad:function(){return this._applyCombination(polyad,[4])}},tinycolor.fromRatio=function(d,m){if(_typeof(d)=="object"){var g={};for(var w in d)d.hasOwnProperty(w)&&(g[w]=w==="a"?d[w]:convertToPercentage(d[w]));d=g}return tinycolor(d,m)},tinycolor.equals=function(d,m){return!(!d||!m)&&tinycolor(d).toRgbString()==tinycolor(m).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},tinycolor.mix=function(d,m,g){g=g===0?0:g||50;var w=tinycolor(d).toRgb(),$=tinycolor(m).toRgb(),I=g/100;return tinycolor({r:($.r-w.r)*I+w.r,g:($.g-w.g)*I+w.g,b:($.b-w.b)*I+w.b,a:($.a-w.a)*I+w.a})},tinycolor.readability=function(d,m){var g=tinycolor(d),w=tinycolor(m);return(Math.max(g.getLuminance(),w.getLuminance())+.05)/(Math.min(g.getLuminance(),w.getLuminance())+.05)},tinycolor.isReadable=function(d,m,g){var w,$,I=tinycolor.readability(d,m);switch($=!1,(w=validateWCAG2Parms(g)).level+w.size){case"AAsmall":case"AAAlarge":$=I>=4.5;break;case"AAlarge":$=I>=3;break;case"AAAsmall":$=I>=7}return $},tinycolor.mostReadable=function(d,m,g){var w,$,I,D,F=null,U=0;$=(g=g||{}).includeFallbackColors,I=g.level,D=g.size;for(var q=0;q<m.length;q++)(w=tinycolor.readability(d,m[q]))>U&&(U=w,F=tinycolor(m[q]));return tinycolor.isReadable(d,F,{level:I,size:D})||!$?F:(g.includeFallbackColors=!1,tinycolor.mostReadable(d,["#fff","#000"],g))};var names$1=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip(names$1);function flip(d){var m={};for(var g in d)d.hasOwnProperty(g)&&(m[d[g]]=g);return m}function boundAlpha(d){return d=parseFloat(d),(isNaN(d)||d<0||d>1)&&(d=1),d}function bound01(d,m){isOnePointZero(d)&&(d="100%");var g=isPercentage(d);return d=Math.min(m,Math.max(0,parseFloat(d))),g&&(d=parseInt(d*m,10)/100),Math.abs(d-m)<1e-6?1:d%m/parseFloat(m)}function clamp01(d){return Math.min(1,Math.max(0,d))}function parseIntFromHex(d){return parseInt(d,16)}function isOnePointZero(d){return typeof d=="string"&&d.indexOf(".")!=-1&&parseFloat(d)===1}function isPercentage(d){return typeof d=="string"&&d.indexOf("%")!=-1}function pad2(d){return d.length==1?"0"+d:""+d}function convertToPercentage(d){return d<=1&&(d=100*d+"%"),d}function convertDecimalToHex(d){return Math.round(255*parseFloat(d)).toString(16)}function convertHexToDecimal(d){return parseIntFromHex(d)/255}var matchers=(CSS_UNIT="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",{CSS_UNIT:new RegExp(CSS_UNIT),rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}),CSS_UNIT,PERMISSIVE_MATCH3,PERMISSIVE_MATCH4;function isValidCSSUnit(d){return!!matchers.CSS_UNIT.exec(d)}function stringInputToObject(d){d=d.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var m,g=!1;if(names$1[d])d=names$1[d],g=!0;else if(d=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};return(m=matchers.rgb.exec(d))?{r:m[1],g:m[2],b:m[3]}:(m=matchers.rgba.exec(d))?{r:m[1],g:m[2],b:m[3],a:m[4]}:(m=matchers.hsl.exec(d))?{h:m[1],s:m[2],l:m[3]}:(m=matchers.hsla.exec(d))?{h:m[1],s:m[2],l:m[3],a:m[4]}:(m=matchers.hsv.exec(d))?{h:m[1],s:m[2],v:m[3]}:(m=matchers.hsva.exec(d))?{h:m[1],s:m[2],v:m[3],a:m[4]}:(m=matchers.hex8.exec(d))?{r:parseIntFromHex(m[1]),g:parseIntFromHex(m[2]),b:parseIntFromHex(m[3]),a:convertHexToDecimal(m[4]),format:g?"name":"hex8"}:(m=matchers.hex6.exec(d))?{r:parseIntFromHex(m[1]),g:parseIntFromHex(m[2]),b:parseIntFromHex(m[3]),format:g?"name":"hex"}:(m=matchers.hex4.exec(d))?{r:parseIntFromHex(m[1]+""+m[1]),g:parseIntFromHex(m[2]+""+m[2]),b:parseIntFromHex(m[3]+""+m[3]),a:convertHexToDecimal(m[4]+""+m[4]),format:g?"name":"hex8"}:!!(m=matchers.hex3.exec(d))&&{r:parseIntFromHex(m[1]+""+m[1]),g:parseIntFromHex(m[2]+""+m[2]),b:parseIntFromHex(m[3]+""+m[3]),format:g?"name":"hex"}}function validateWCAG2Parms(d){var m,g;return(m=((d=d||{level:"AA",size:"small"}).level||"AA").toUpperCase())!=="AA"&&m!=="AAA"&&(m="AA"),(g=(d.size||"small").toLowerCase())!=="small"&&g!=="large"&&(g="small"),{level:m,size:g}}function clone(d){const m={width:d.bitmap.width,height:d.bitmap.height,data:Buffer.from(d.bitmap.data)};return new d.constructor(m)}function scan(d,m,g,w,$,I){let D,F,U,q,j;if(typeof m=="function")j=m,D=0,F=0,U=d.bitmap.width,q=d.bitmap.height;else{if(D=m,typeof g!="number")throw new Error("y must be a number");if(F=g,typeof w!="number")throw new Error("w must be a number");if(U=w,typeof $!="number")throw new Error("h must be a number");if(q=$,typeof I!="function")throw new Error("cb must be a function");j=I}D=Math.round(D),F=Math.round(F),U=Math.round(U),q=Math.round(q);const G=j.bind(d);for(let H=F;H<F+q;H++)for(let V=D;V<D+U;V++)G(V,H,d.bitmap.width*H+V<<2);return d}function*scanIterator(d,m,g,w,$){m=Math.round(m),g=Math.round(g),w=Math.round(w),$=Math.round($);for(let I=g;I<g+$;I++)for(let D=m;D<m+w;D++){const F=d.bitmap.width*I+D<<2;yield{x:D,y:I,idx:F,image:d}}}function intToRGBA$1(d){if(typeof d!="number")throw new Error("i must be a number");const m={r:0,g:0,b:0,a:0};return m.r=Math.floor(d/Math.pow(256,3)),m.g=Math.floor((d-m.r*Math.pow(256,3))/Math.pow(256,2)),m.b=Math.floor((d-m.r*Math.pow(256,3)-m.g*Math.pow(256,2))/Math.pow(256,1)),m.a=Math.floor((d-m.r*Math.pow(256,3)-m.g*Math.pow(256,2)-m.b*Math.pow(256,1))/Math.pow(256,0)),m}function colorDiff(d,m){const g=D=>Math.pow(D,2),{max:w}=Math,$="a"in d?d.a:255,I="a"in m?m.a:255;return(w(g(d.r-m.r),g(d.r-m.r-$+I))+w(g(d.g-m.g),g(d.g-m.g-$+I))+w(g(d.b-m.b),g(d.b-m.b-$+I)))/195075}function limit255(d){return d=Math.max(d,0),d=Math.min(d,255)}function cssColorToHex(d){return typeof d=="number"?d:parseInt(tinycolor(d).toHex8(),16)}function encode$1(d,m={}){return scan({bitmap:d},0,0,d.width,d.height,(function(g,w,$){const I=d.data[$+0],D=d.data[$+1],F=d.data[$+2],U=d.data[$+3];d.data[$+0]=U,d.data[$+1]=F,d.data[$+2]=D,d.data[$+3]=I})),encode$2({...d,...m}).data}function decode$1(d,m){const g=decode$2(d,m);return scan({bitmap:g},0,0,g.width,g.height,(function(w,$,I){const D=g.data[I+1],F=g.data[I+2],U=g.data[I+3];g.data[I+0]=U,g.data[I+1]=F,g.data[I+2]=D,g.data[I+3]=255})),g}function msBmp(){return{mime:"image/x-ms-bmp",encode:encode$1,decode:decode$1}}function bmp(){return{mime:"image/bmp",encode:encode$1,decode:decode$1}}var omggif={},GifReader_1,GifWriter_1;function GifWriter(d,m,g,w){var $=0,I=(w=w===void 0?{}:w).loop===void 0?null:w.loop,D=w.palette===void 0?null:w.palette;if(m<=0||g<=0||m>65535||g>65535)throw new Error("Width/Height invalid.");function F(Q){var J=Q.length;if(J<2||J>256||J&J-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return J}d[$++]=71,d[$++]=73,d[$++]=70,d[$++]=56,d[$++]=57,d[$++]=97;var U=0,q=0;if(D!==null){for(var j=F(D);j>>=1;)++U;if(j=1<<U,--U,w.background!==void 0){if((q=w.background)>=j)throw new Error("Background index out of range.");if(q===0)throw new Error("Background index explicitly passed as 0.")}}if(d[$++]=255&m,d[$++]=m>>8&255,d[$++]=255&g,d[$++]=g>>8&255,d[$++]=(D!==null?128:0)|U,d[$++]=q,d[$++]=0,D!==null)for(var G=0,H=D.length;G<H;++G){var V=D[G];d[$++]=V>>16&255,d[$++]=V>>8&255,d[$++]=255&V}if(I!==null){if(I<0||I>65535)throw new Error("Loop count invalid.");d[$++]=33,d[$++]=255,d[$++]=11,d[$++]=78,d[$++]=69,d[$++]=84,d[$++]=83,d[$++]=67,d[$++]=65,d[$++]=80,d[$++]=69,d[$++]=50,d[$++]=46,d[$++]=48,d[$++]=3,d[$++]=1,d[$++]=255&I,d[$++]=I>>8&255,d[$++]=0}var Z=!1;this.addFrame=function(Q,J,ie,re,se,X){if(Z===!0&&(--$,Z=!1),X=X===void 0?{}:X,Q<0||J<0||Q>65535||J>65535)throw new Error("x/y invalid.");if(ie<=0||re<=0||ie>65535||re>65535)throw new Error("Width/Height invalid.");if(se.length<ie*re)throw new Error("Not enough pixels for the frame size.");var ne=!0,ce=X.palette;if(ce==null&&(ne=!1,ce=D),ce==null)throw new Error("Must supply either a local or global palette.");for(var oe=F(ce),de=0;oe>>=1;)++de;oe=1<<de;var me=X.delay===void 0?0:X.delay,ge=X.disposal===void 0?0:X.disposal;if(ge<0||ge>3)throw new Error("Disposal out of range.");var fe=!1,xe=0;if(X.transparent!==void 0&&X.transparent!==null&&(fe=!0,(xe=X.transparent)<0||xe>=oe))throw new Error("Transparent color index.");if((ge!==0||fe||me!==0)&&(d[$++]=33,d[$++]=249,d[$++]=4,d[$++]=ge<<2|(fe===!0?1:0),d[$++]=255&me,d[$++]=me>>8&255,d[$++]=xe,d[$++]=0),d[$++]=44,d[$++]=255&Q,d[$++]=Q>>8&255,d[$++]=255&J,d[$++]=J>>8&255,d[$++]=255&ie,d[$++]=ie>>8&255,d[$++]=255&re,d[$++]=re>>8&255,d[$++]=ne===!0?128|de-1:0,ne===!0)for(var Fe=0,Te=ce.length;Fe<Te;++Fe){var Oe=ce[Fe];d[$++]=Oe>>16&255,d[$++]=Oe>>8&255,d[$++]=255&Oe}return $=GifWriterOutputLZWCodeStream(d,$,de<2?2:de,se)},this.end=function(){return Z===!1&&(d[$++]=59,Z=!0),$},this.getOutputBuffer=function(){return d},this.setOutputBuffer=function(Q){d=Q},this.getOutputBufferPosition=function(){return $},this.setOutputBufferPosition=function(Q){$=Q}}function GifWriterOutputLZWCodeStream(d,m,g,w){d[m++]=g;var $=m++,I=1<<g,D=I-1,F=I+1,U=F+1,q=g+1,j=0,G=0;function H(ne){for(;j>=ne;)d[m++]=255&G,G>>=8,j-=8,m===$+256&&(d[$]=255,$=m++)}function V(ne){G|=ne<<j,j+=q,H(8)}var Z=w[0]&D,Q={};V(I);for(var J=1,ie=w.length;J<ie;++J){var re=w[J]&D,se=Z<<8|re,X=Q[se];if(X===void 0){for(G|=Z<<j,j+=q;j>=8;)d[m++]=255&G,G>>=8,j-=8,m===$+256&&(d[$]=255,$=m++);U===4096?(V(I),U=F+1,q=g+1,Q={}):(U>=1<<q&&++q,Q[se]=U++),Z=re}else Z=X}return V(Z),V(F),H(1),$+1===m?d[$]=0:(d[$]=m-$-1,d[m++]=0),m}function GifReader(d){var m=0;if(d[m++]!==71||d[m++]!==73||d[m++]!==70||d[m++]!==56||(d[m++]+1&253)!=56||d[m++]!==97)throw new Error("Invalid GIF 87a/89a header.");var g=d[m++]|d[m++]<<8,w=d[m++]|d[m++]<<8,$=d[m++],I=$>>7,D=1<<(7&$)+1;d[m++],d[m++];var F=null,U=null;I&&(F=m,U=D,m+=3*D);var q=!0,j=[],G=0,H=null,V=0,Z=null;for(this.width=g,this.height=w;q&&m<d.length;)switch(d[m++]){case 33:switch(d[m++]){case 255:if(d[m]!==11||d[m+1]==78&&d[m+2]==69&&d[m+3]==84&&d[m+4]==83&&d[m+5]==67&&d[m+6]==65&&d[m+7]==80&&d[m+8]==69&&d[m+9]==50&&d[m+10]==46&&d[m+11]==48&&d[m+12]==3&&d[m+13]==1&&d[m+16]==0)m+=14,Z=d[m++]|d[m++]<<8,m++;else for(m+=12;;){if(!((fe=d[m++])>=0))throw Error("Invalid block size");if(fe===0)break;m+=fe}break;case 249:if(d[m++]!==4||d[m+4]!==0)throw new Error("Invalid graphics extension block.");var Q=d[m++];G=d[m++]|d[m++]<<8,H=d[m++],1&Q||(H=null),V=Q>>2&7,m++;break;case 254:for(;;){if(!((fe=d[m++])>=0))throw Error("Invalid block size");if(fe===0)break;m+=fe}break;default:throw new Error("Unknown graphic control label: 0x"+d[m-1].toString(16))}break;case 44:var J=d[m++]|d[m++]<<8,ie=d[m++]|d[m++]<<8,re=d[m++]|d[m++]<<8,se=d[m++]|d[m++]<<8,X=d[m++],ne=X>>6&1,ce=1<<(7&X)+1,oe=F,de=U,me=!1;X>>7&&(me=!0,oe=m,de=ce,m+=3*ce);var ge=m;for(m++;;){var fe;if(!((fe=d[m++])>=0))throw Error("Invalid block size");if(fe===0)break;m+=fe}j.push({x:J,y:ie,width:re,height:se,has_local_palette:me,palette_offset:oe,palette_size:de,data_offset:ge,data_length:m-ge,transparent_index:H,interlaced:!!ne,delay:G,disposal:V});break;case 59:q=!1;break;default:throw new Error("Unknown gif block: 0x"+d[m-1].toString(16))}this.numFrames=function(){return j.length},this.loopCount=function(){return Z},this.frameInfo=function(xe){if(xe<0||xe>=j.length)throw new Error("Frame index out of range.");return j[xe]},this.decodeAndBlitFrameBGRA=function(xe,Fe){var Te=this.frameInfo(xe),Oe=Te.width*Te.height,Be=new Uint8Array(Oe);GifReaderLZWOutputIndexStream(d,Te.data_offset,Be,Oe);var _t=Te.palette_offset,Et=Te.transparent_index;Et===null&&(Et=256);var dt=Te.width,Zt=g-dt,Ye=dt,bt=4*(Te.y*g+Te.x),Qt=4*((Te.y+Te.height)*g+Te.x),Vt=bt,ut=4*Zt;Te.interlaced===!0&&(ut+=4*g*7);for(var At=8,dr=0,fr=Be.length;dr<fr;++dr){var pr=Be[dr];if(Ye===0&&(Ye=dt,(Vt+=ut)>=Qt&&(ut=4*Zt+4*g*(At-1),Vt=bt+(dt+Zt)*(At<<1),At>>=1)),pr===Et)Vt+=4;else{var zt=d[_t+3*pr],Ce=d[_t+3*pr+1],Nt=d[_t+3*pr+2];Fe[Vt++]=Nt,Fe[Vt++]=Ce,Fe[Vt++]=zt,Fe[Vt++]=255}--Ye}},this.decodeAndBlitFrameRGBA=function(xe,Fe){var Te=this.frameInfo(xe),Oe=Te.width*Te.height,Be=new Uint8Array(Oe);GifReaderLZWOutputIndexStream(d,Te.data_offset,Be,Oe);var _t=Te.palette_offset,Et=Te.transparent_index;Et===null&&(Et=256);var dt=Te.width,Zt=g-dt,Ye=dt,bt=4*(Te.y*g+Te.x),Qt=4*((Te.y+Te.height)*g+Te.x),Vt=bt,ut=4*Zt;Te.interlaced===!0&&(ut+=4*g*7);for(var At=8,dr=0,fr=Be.length;dr<fr;++dr){var pr=Be[dr];if(Ye===0&&(Ye=dt,(Vt+=ut)>=Qt&&(ut=4*Zt+4*g*(At-1),Vt=bt+(dt+Zt)*(At<<1),At>>=1)),pr===Et)Vt+=4;else{var zt=d[_t+3*pr],Ce=d[_t+3*pr+1],Nt=d[_t+3*pr+2];Fe[Vt++]=zt,Fe[Vt++]=Ce,Fe[Vt++]=Nt,Fe[Vt++]=255}--Ye}}}function GifReaderLZWOutputIndexStream(d,m,g,w){for(var $=d[m++],I=1<<$,D=I+1,F=D+1,U=$+1,q=(1<<U)-1,j=0,G=0,H=0,V=d[m++],Z=new Int32Array(4096),Q=null;;){for(;j<16&&V!==0;)G|=d[m++]<<j,j+=8,V===1?V=d[m++]:--V;if(j<U)break;var J=G&q;if(G>>=U,j-=U,J!==I){if(J===D)break;for(var ie=J<F?J:Q,re=0,se=ie;se>I;)se=Z[se]>>8,++re;var X=se;if(H+re+(ie!==J?1:0)>w)return void console.log("Warning, gif stream longer than expected.");g[H++]=X;var ne=H+=re;for(ie!==J&&(g[H++]=X),se=ie;re--;)se=Z[se],g[--ne]=255&se,se>>=8;Q!==null&&F<4096&&(Z[F++]=Q<<8|X,F>=q+1&&U<12&&(++U,q=q<<1|1)),Q=J}else F=D+1,q=(1<<(U=$+1))-1,Q=null}return H!==w&&console.log("Warning, gif stream shorter than expected."),g}try{GifWriter_1=omggif.GifWriter=GifWriter,GifReader_1=omggif.GifReader=GifReader}catch{}let BitmapImage$2=class No{constructor(...m){if(m.length===0)throw new Error("constructor requires parameters");const g=m[0];if(g!==null&&typeof g=="object")if(g instanceof No){const w=g.bitmap;this.bitmap={width:w.width,height:w.height,data:new Buffer(w.width*w.height*4)},w.data.copy(this.bitmap.data)}else{if(!(g.width&&g.height&&g.data))throw new Error("unrecognized constructor parameters");this.bitmap=g}else{if(typeof g!="number"||typeof m[1]!="number")throw new Error("unrecognized constructor parameters");{const w=g,$=m[1],I=m[2];this.bitmap={width:w,height:$},Buffer.isBuffer(I)?this.bitmap.data=I:(this.bitmap.data=new Buffer(w*$*4),typeof I=="number"&&this.fillRGBA(I))}}}blit(m,g,w,$,I,D,F){if($+D>this.bitmap.width)throw new Error("copy exceeds width of source bitmap");if(g+D>m.bitmap.width)throw new Error("copy exceeds width of target bitmap");if(I+F>this.bitmap.height)throw new Error("copy exceeds height of source bitmap");if(w+F>m.bitmap.height)throw new Erro("copy exceeds height of target bitmap");const U=this.bitmap.data,q=m.bitmap.data,j=4*this.bitmap.width,G=4*m.bitmap.width,H=4*D;let V=I*j+4*$,Z=w*G+4*g;for(;--F>=0;)U.copy(q,Z,V,V+H),V+=j,Z+=G;return this}fillRGBA(m){const g=this.bitmap.data,w=4*this.bitmap.height;let $=0;for(;$<w;)g.writeUInt32BE(m,$),$+=4;for(;$<g.length;)g.copy(g,$,0,w),$+=w;return this}getRGBA(m,g){const w=4*(g*this.bitmap.width+m);return this.bitmap.data.readUInt32BE(w)}getRGBASet(){const m=new Set,g=this.bitmap.data;for(let w=0;w<g.length;w+=4)m.add(g.readUInt32BE(w,!0));return m}greyscale(){const m=this.bitmap.data;return this.scan(0,0,this.bitmap.width,this.bitmap.height,((g,w,$)=>{const I=Math.round(.299*m[$]+.587*m[$+1]+.114*m[$+2]);m[$]=I,m[$+1]=I,m[$+2]=I})),this}reframe(m,g,w,$,I){const D=m<0?0:m,F=g<0?0:g,U=w+D>this.bitmap.width?this.bitmap.width-D:w,q=$+F>this.bitmap.height?this.bitmap.height-F:$,j=m<0?-m:0,G=g<0?-g:0;let H;if(I===void 0){if(D!==m||F!=g||U!==w||q!==$)throw new GifError("fillRGBA required for this reframing");H=new No(w,$)}else H=new No(w,$,I);return this.blit(H,j,G,D,F,U,q),this.bitmap=H.bitmap,this}scale(m){if(m===1)return;if(!Number.isInteger(m)||m<1)throw new Error("the scale must be an integer >= 1");const g=this.bitmap.width,w=this.bitmap.height,$=g*m*4,I=this.bitmap.data,D=new Buffer(w*$*m);let F,U=0,q=0;for(let j=0;j<w;++j){F=q;for(let G=0;G<g;++G){const H=I.readUInt32BE(U,!0);for(let V=0;V<m;++V)D.writeUInt32BE(H,q),q+=4;U+=4}for(let G=1;G<m;++G)D.copy(D,q,F,q),q+=$,F+=$}return this.bitmap={width:g*m,height:w*m,data:D},this}scanAllCoords(m){const g=this.bitmap.width,w=this.bitmap.data.length;let $=0,I=0;for(let D=0;D<w;D+=4)m($,I,D),++$===g&&($=0,++I)}scanAllIndexes(m){const g=this.bitmap.data.length;for(let w=0;w<g;w+=4)m(w)}};var bitmapimage=BitmapImage$2,gif$1={};let Gif$1=class{constructor(d,m,g){this.width=g.width,this.height=g.height,this.loops=g.loops,this.usesTransparency=g.usesTransparency,this.colorScope=g.colorScope,this.frames=m,this.buffer=d}};Gif$1.GlobalColorsPreferred=0,Gif$1.GlobalColorsOnly=1,Gif$1.LocalColorsOnly=2;let GifError$2=class extends Error{constructor(d){super(d),d instanceof Error&&(this.stack="Gif"+d.stack)}};gif$1.Gif=Gif$1,gif$1.GifError=GifError$2;var gifcodec={},gifutil={},_polyfillNode_fs={},_polyfillNode_fs$1=Object.freeze({__proto__:null,default:_polyfillNode_fs}),require$$0=getAugmentedNamespace(_polyfillNode_fs$1),__defProp$3=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__defNormalProp$3=(d,m,g)=>m in d?__defProp$3(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__markAsModule=d=>__defProp$3(d,"__esModule",{value:!0}),__export$1=(d,m)=>{for(var g in m)__defProp$3(d,g,{get:m[g],enumerable:!0})},__reExport=(d,m,g,w)=>{if(m&&typeof m=="object"||typeof m=="function")for(let $ of __getOwnPropNames(m))!__hasOwnProp.call(d,$)&&g&&__defProp$3(d,$,{get:()=>m[$],enumerable:!(w=__getOwnPropDesc(m,$))||w.enumerable});return d},__toCommonJS=(d=>(m,g)=>d&&d.get(m)||(g=__reExport(__markAsModule({}),m,1),d&&d.set(m,g),g))(typeof WeakMap<"u"?new WeakMap:0),__publicField$3=(d,m,g)=>(__defNormalProp$3(d,typeof m!="symbol"?m+"":m,g),g),src_exports={};__export$1(src_exports,{applyPalette:()=>applyPalette,applyPaletteSync:()=>applyPaletteSync$1,buildPalette:()=>buildPalette,buildPaletteSync:()=>buildPaletteSync$1,constants:()=>constants_exports$1,conversion:()=>conversion_exports$1,distance:()=>distance_exports$1,image:()=>image_exports$1,palette:()=>palette_exports$1,quality:()=>quality_exports$1,utils:()=>utils_exports$1});var constants_exports$1={};__export$1(constants_exports$1,{bt709:()=>bt709_exports$1});var bt709_exports$1={};__export$1(bt709_exports$1,{Y:()=>Y$1,x:()=>x$2,y:()=>y$2});var Y$1=(d=>(d[d.RED=.2126]="RED",d[d.GREEN=.7152]="GREEN",d[d.BLUE=.0722]="BLUE",d[d.WHITE=1]="WHITE",d))(Y$1||{}),x$2=(d=>(d[d.RED=.64]="RED",d[d.GREEN=.3]="GREEN",d[d.BLUE=.15]="BLUE",d[d.WHITE=.3127]="WHITE",d))(x$2||{}),y$2=(d=>(d[d.RED=.33]="RED",d[d.GREEN=.6]="GREEN",d[d.BLUE=.06]="BLUE",d[d.WHITE=.329]="WHITE",d))(y$2||{}),conversion_exports$1={};function correctGamma$1(d){return d>.04045?((d+.055)/1.055)**2.4:d/12.92}function rgb2xyz$1(d,m,g){return{x:.4124*(d=correctGamma$1(d/255))+.3576*(m=correctGamma$1(m/255))+.1805*(g=correctGamma$1(g/255)),y:.2126*d+.7152*m+.0722*g,z:.0193*d+.1192*m+.9505*g}}__export$1(conversion_exports$1,{lab2rgb:()=>lab2rgb$1,lab2xyz:()=>lab2xyz$1,rgb2hsl:()=>rgb2hsl$1,rgb2lab:()=>rgb2lab$1,rgb2xyz:()=>rgb2xyz$1,xyz2lab:()=>xyz2lab$1,xyz2rgb:()=>xyz2rgb$1});var arithmetic_exports$1={};function degrees2radians$1(d){return d*(Math.PI/180)}function max3$1(d,m,g){let w=d;return w<m&&(w=m),w<g&&(w=g),w}function min3$1(d,m,g){let w=d;return w>m&&(w=m),w>g&&(w=g),w}function intInRange$1(d,m,g){return d>g&&(d=g),d<m&&(d=m),0|d}function inRange0to255Rounded$1(d){return(d=Math.round(d))>255?d=255:d<0&&(d=0),d}function inRange0to255$1(d){return d>255?d=255:d<0&&(d=0),d}function stableSort$1(d,m){const g=typeof d[0];let w;if(g==="number"||g==="string"){const $=Object.create(null);for(let I=0,D=d.length;I<D;I++){const F=d[I];$[F]||$[F]===0||($[F]=I)}w=d.sort(((I,D)=>m(I,D)||$[I]-$[D]))}else{const $=d.slice(0);w=d.sort(((I,D)=>m(I,D)||$.indexOf(I)-$.indexOf(D)))}return w}function rgb2hsl$1(d,m,g){const w=min3$1(d,m,g),$=max3$1(d,m,g),I=$-w,D=(w+$)/510;let F=0;D>0&&D<1&&(F=I/(D<.5?$+w:510-$-w));let U=0;return I>0&&(U=$===d?(m-g)/I:$===m?2+(g-d)/I:4+(d-m)/I,U*=60,U<0&&(U+=360)),{h:U,s:F,l:D}}__export$1(arithmetic_exports$1,{degrees2radians:()=>degrees2radians$1,inRange0to255:()=>inRange0to255$1,inRange0to255Rounded:()=>inRange0to255Rounded$1,intInRange:()=>intInRange$1,max3:()=>max3$1,min3:()=>min3$1,stableSort:()=>stableSort$1});var refX$1=.95047,refY$1=1,refZ$1=1.08883;function pivot$1(d){return d>.008856?d**(1/3):7.787*d+16/116}function xyz2lab$1(d,m,g){if(d=pivot$1(d/refX$1),m=pivot$1(m/refY$1),g=pivot$1(g/refZ$1),116*m-16<0)throw new Error("xxx");return{L:Math.max(0,116*m-16),a:500*(d-m),b:200*(m-g)}}function rgb2lab$1(d,m,g){const w=rgb2xyz$1(d,m,g);return xyz2lab$1(w.x,w.y,w.z)}var refX2$1=.95047,refY2$1=1,refZ2$1=1.08883;function pivot2$1(d){return d>.206893034?d**3:(d-16/116)/7.787}function lab2xyz$1(d,m,g){const w=(d+16)/116,$=w-g/200;return{x:refX2$1*pivot2$1(m/500+w),y:refY2$1*pivot2$1(w),z:refZ2$1*pivot2$1($)}}function correctGamma2$1(d){return d>.0031308?1.055*d**(1/2.4)-.055:12.92*d}function xyz2rgb$1(d,m,g){const w=correctGamma2$1(3.2406*d+-1.5372*m+-.4986*g),$=correctGamma2$1(-.9689*d+1.8758*m+.0415*g),I=correctGamma2$1(.0557*d+-.204*m+1.057*g);return{r:inRange0to255Rounded$1(255*w),g:inRange0to255Rounded$1(255*$),b:inRange0to255Rounded$1(255*I)}}function lab2rgb$1(d,m,g){const w=lab2xyz$1(d,m,g);return xyz2rgb$1(w.x,w.y,w.z)}var distance_exports$1={};__export$1(distance_exports$1,{AbstractDistanceCalculator:()=>AbstractDistanceCalculator$1,AbstractEuclidean:()=>AbstractEuclidean$1,AbstractManhattan:()=>AbstractManhattan$1,CIE94GraphicArts:()=>CIE94GraphicArts$1,CIE94Textiles:()=>CIE94Textiles$1,CIEDE2000:()=>CIEDE2000$1,CMetric:()=>CMetric$1,Euclidean:()=>Euclidean$1,EuclideanBT709:()=>EuclideanBT709$1,EuclideanBT709NoAlpha:()=>EuclideanBT709NoAlpha$1,Manhattan:()=>Manhattan$1,ManhattanBT709:()=>ManhattanBT709$1,ManhattanNommyde:()=>ManhattanNommyde$1,PNGQuant:()=>PNGQuant$1});var AbstractDistanceCalculator$1=class{constructor(){__publicField$3(this,"_maxDistance"),__publicField$3(this,"_whitePoint"),this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(d,m,g,w){this._whitePoint={r:d>0?255/d:0,g:m>0?255/m:0,b:g>0?255/g:0,a:w>0?255/w:0},this._maxDistance=this.calculateRaw(d,m,g,w,0,0,0,0)}calculateNormalized(d,m){return this.calculateRaw(d.r,d.g,d.b,d.a,m.r,m.g,m.b,m.a)/this._maxDistance}},AbstractCIE94$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,F){const U=rgb2lab$1(inRange0to255$1(d*this._whitePoint.r),inRange0to255$1(m*this._whitePoint.g),inRange0to255$1(g*this._whitePoint.b)),q=rgb2lab$1(inRange0to255$1($*this._whitePoint.r),inRange0to255$1(I*this._whitePoint.g),inRange0to255$1(D*this._whitePoint.b)),j=U.L-q.L,G=U.a-q.a,H=U.b-q.b,V=Math.sqrt(U.a*U.a+U.b*U.b),Z=V-Math.sqrt(q.a*q.a+q.b*q.b);let Q=G*G+H*H-Z*Z;Q=Q<0?0:Math.sqrt(Q);const J=(F-w)*this._whitePoint.a*this._kA;return Math.sqrt((j/this._Kl)**2+(Z/(1+this._K1*V))**2+(Q/(1+this._K2*V))**2+J**2)}},CIE94Textiles$1=class extends AbstractCIE94$1{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=12.5/255}},CIE94GraphicArts$1=class extends AbstractCIE94$1{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=25/255}},_CIEDE2000$1=class extends AbstractDistanceCalculator$1{_setDefaults(){}static _calculatehp(d,m){const g=Math.atan2(d,m);return g>=0?g:g+_CIEDE2000$1._deg360InRad}static _calculateRT(d,m){const g=m**7,w=2*Math.sqrt(g/(g+_CIEDE2000$1._pow25to7)),$=_CIEDE2000$1._deg30InRad*Math.exp(-(((d-_CIEDE2000$1._deg275InRad)/_CIEDE2000$1._deg25InRad)**2));return-Math.sin(2*$)*w}static _calculateT(d){return 1-.17*Math.cos(d-_CIEDE2000$1._deg30InRad)+.24*Math.cos(2*d)+.32*Math.cos(3*d+_CIEDE2000$1._deg6InRad)-.2*Math.cos(4*d-_CIEDE2000$1._deg63InRad)}static _calculate_ahp(d,m,g,w){const $=g+w;return d===0?$:m<=_CIEDE2000$1._deg180InRad?$/2:$<_CIEDE2000$1._deg360InRad?($+_CIEDE2000$1._deg360InRad)/2:($-_CIEDE2000$1._deg360InRad)/2}static _calculate_dHp(d,m,g,w){let $;return $=d===0?0:m<=_CIEDE2000$1._deg180InRad?g-w:g<=w?g-w+_CIEDE2000$1._deg360InRad:g-w-_CIEDE2000$1._deg360InRad,2*Math.sqrt(d)*Math.sin($/2)}calculateRaw(d,m,g,w,$,I,D,F){const U=rgb2lab$1(inRange0to255$1(d*this._whitePoint.r),inRange0to255$1(m*this._whitePoint.g),inRange0to255$1(g*this._whitePoint.b)),q=rgb2lab$1(inRange0to255$1($*this._whitePoint.r),inRange0to255$1(I*this._whitePoint.g),inRange0to255$1(D*this._whitePoint.b)),j=(F-w)*this._whitePoint.a*_CIEDE2000$1._kA,G=this.calculateRawInLab(U,q);return Math.sqrt(G+j*j)}calculateRawInLab(d,m){const g=d.L,w=d.a,$=d.b,I=m.L,D=m.a,F=m.b,U=((Math.sqrt(w*w+$*$)+Math.sqrt(D*D+F*F))/2)**7,q=.5*(1-Math.sqrt(U/(U+_CIEDE2000$1._pow25to7))),j=(1+q)*w,G=(1+q)*D,H=Math.sqrt(j*j+$*$),V=Math.sqrt(G*G+F*F),Z=H*V,Q=_CIEDE2000$1._calculatehp($,j),J=_CIEDE2000$1._calculatehp(F,G),ie=Math.abs(Q-J),re=I-g,se=V-H,X=_CIEDE2000$1._calculate_dHp(Z,ie,J,Q),ne=_CIEDE2000$1._calculate_ahp(Z,ie,Q,J),ce=(H+V)/2,oe=((g+I)/2-50)**2,de=se/(1+.045*ce),me=X/(1+.015*_CIEDE2000$1._calculateT(ne)*ce);return(re/(1+.015*oe/Math.sqrt(20+oe)))**2+de**2+me**2+_CIEDE2000$1._calculateRT(ne,ce)*de*me}},CIEDE2000$1=_CIEDE2000$1;__publicField$3(CIEDE2000$1,"_kA",25/255),__publicField$3(CIEDE2000$1,"_pow25to7",25**7),__publicField$3(CIEDE2000$1,"_deg360InRad",degrees2radians$1(360)),__publicField$3(CIEDE2000$1,"_deg180InRad",degrees2radians$1(180)),__publicField$3(CIEDE2000$1,"_deg30InRad",degrees2radians$1(30)),__publicField$3(CIEDE2000$1,"_deg6InRad",degrees2radians$1(6)),__publicField$3(CIEDE2000$1,"_deg63InRad",degrees2radians$1(63)),__publicField$3(CIEDE2000$1,"_deg275InRad",degrees2radians$1(275)),__publicField$3(CIEDE2000$1,"_deg25InRad",degrees2radians$1(25));var CMetric$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,F){const U=(d+$)/2*this._whitePoint.r,q=(d-$)*this._whitePoint.r,j=(m-I)*this._whitePoint.g,G=(g-D)*this._whitePoint.b,H=((512+U)*q*q>>8)+4*j*j+((767-U)*G*G>>8),V=(F-w)*this._whitePoint.a;return Math.sqrt(H+V*V)}_setDefaults(){}},AbstractEuclidean$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,F){const U=$-d,q=I-m,j=D-g,G=F-w;return Math.sqrt(this._kR*U*U+this._kG*q*q+this._kB*j*j+this._kA*G*G)}},Euclidean$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},EuclideanBT709$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},EuclideanBT709NoAlpha$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=0}},AbstractManhattan$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,F){let U=$-d,q=I-m,j=D-g,G=F-w;return U<0&&(U=0-U),q<0&&(q=0-q),j<0&&(j=0-j),G<0&&(G=0-G),this._kR*U+this._kG*q+this._kB*j+this._kA*G}},Manhattan$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},ManhattanNommyde$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}},ManhattanBT709$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},PNGQuant$1=class extends AbstractDistanceCalculator$1{calculateRaw(d,m,g,w,$,I,D,F){const U=(F-w)*this._whitePoint.a;return this._colordifferenceCh(d*this._whitePoint.r,$*this._whitePoint.r,U)+this._colordifferenceCh(m*this._whitePoint.g,I*this._whitePoint.g,U)+this._colordifferenceCh(g*this._whitePoint.b,D*this._whitePoint.b,U)}_colordifferenceCh(d,m,g){const w=d-m,$=w+g;return w*w+$*$}_setDefaults(){}},palette_exports$1={};__export$1(palette_exports$1,{AbstractPaletteQuantizer:()=>AbstractPaletteQuantizer$1,ColorHistogram:()=>ColorHistogram$1,NeuQuant:()=>NeuQuant$1,NeuQuantFloat:()=>NeuQuantFloat$1,RGBQuant:()=>RGBQuant$1,WuColorCube:()=>WuColorCube$1,WuQuant:()=>WuQuant$1});var AbstractPaletteQuantizer$1=class{quantizeSync(){for(const d of this.quantize())if(d.palette)return d.palette;throw new Error("unreachable")}},Point$1=class{constructor(){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),__publicField$3(this,"uint32"),__publicField$3(this,"rgba"),this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}static createByQuadruplet(d){const m=new Point$1;return m.r=0|d[0],m.g=0|d[1],m.b=0|d[2],m.a=0|d[3],m._loadUINT32(),m._loadQuadruplet(),m}static createByRGBA(d,m,g,w){const $=new Point$1;return $.r=0|d,$.g=0|m,$.b=0|g,$.a=0|w,$._loadUINT32(),$._loadQuadruplet(),$}static createByUint32(d){const m=new Point$1;return m.uint32=d>>>0,m._loadRGBA(),m._loadQuadruplet(),m}from(d){this.r=d.r,this.g=d.g,this.b=d.b,this.a=d.a,this.uint32=d.uint32,this.rgba[0]=d.r,this.rgba[1]=d.g,this.rgba[2]=d.b,this.rgba[3]=d.a}getLuminosity(d){let m=this.r,g=this.g,w=this.b;return d&&(m=Math.min(255,255-this.a+this.a*m/255),g=Math.min(255,255-this.a+this.a*g/255),w=Math.min(255,255-this.a+this.a*w/255)),.2126*m+.7152*g+.0722*w}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=255&this.uint32,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}},PointContainer$1=class{constructor(){__publicField$3(this,"_pointArray"),__publicField$3(this,"_width"),__publicField$3(this,"_height"),this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(d){this._width=d}setHeight(d){this._height=d}getPointArray(){return this._pointArray}clone(){const d=new PointContainer$1;d._width=this._width,d._height=this._height;for(let m=0,g=this._pointArray.length;m<g;m++)d._pointArray[m]=Point$1.createByUint32(0|this._pointArray[m].uint32);return d}toUint32Array(){const d=this._pointArray.length,m=new Uint32Array(d);for(let g=0;g<d;g++)m[g]=this._pointArray[g].uint32;return m}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(d){const m=d.naturalWidth,g=d.naturalHeight,w=document.createElement("canvas");return w.width=m,w.height=g,w.getContext("2d").drawImage(d,0,0,m,g,0,0,m,g),PointContainer$1.fromHTMLCanvasElement(w)}static fromHTMLCanvasElement(d){const m=d.width,g=d.height,w=d.getContext("2d").getImageData(0,0,m,g);return PointContainer$1.fromImageData(w)}static fromImageData(d){const m=d.width,g=d.height;return PointContainer$1.fromUint8Array(d.data,m,g)}static fromUint8Array(d,m,g){switch(Object.prototype.toString.call(d)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:d=new Uint8Array(d)}const w=new Uint32Array(d.buffer);return PointContainer$1.fromUint32Array(w,m,g)}static fromUint32Array(d,m,g){const w=new PointContainer$1;w._width=m,w._height=g;for(let $=0,I=d.length;$<I;$++)w._pointArray[$]=Point$1.createByUint32(0|d[$]);return w}static fromBuffer(d,m,g){const w=new Uint32Array(d.buffer,d.byteOffset,d.byteLength/Uint32Array.BYTES_PER_ELEMENT);return PointContainer$1.fromUint32Array(w,m,g)}},hueGroups$1=10;function hueGroup$1(d,m){const g=360/m;for(let w=1,$=g-g/2;w<m;w++,$+=g)if(d>=$&&d<$+g)return w;return 0}var Palette$1=class{constructor(){__publicField$3(this,"_pointContainer"),__publicField$3(this,"_pointArray",[]),__publicField$3(this,"_i32idx",{}),this._pointContainer=new PointContainer$1,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(d){this._pointArray.push(d),this._pointContainer.setWidth(this._pointArray.length)}has(d){for(let m=this._pointArray.length-1;m>=0;m--)if(d.uint32===this._pointArray[m].uint32)return!0;return!1}getNearestColor(d,m){return this._pointArray[0|this._getNearestIndex(d,m)]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(d){return typeof this._i32idx[d]=="number"?this._i32idx[d]:-1}_getNearestIndex(d,m){let g=this._nearestPointFromCache(""+m.uint32);if(g>=0)return g;let w=Number.MAX_VALUE;g=0;for(let $=0,I=this._pointArray.length;$<I;$++){const D=this._pointArray[$],F=d.calculateRaw(m.r,m.g,m.b,m.a,D.r,D.g,D.b,D.a);F<w&&(w=F,g=$)}return this._i32idx[m.uint32]=g,g}sort(){this._i32idx={},this._pointArray.sort(((d,m)=>{const g=rgb2hsl$1(d.r,d.g,d.b),w=rgb2hsl$1(m.r,m.g,m.b),$=d.r===d.g&&d.g===d.b?0:1+hueGroup$1(g.h,hueGroups$1),I=(m.r===m.g&&m.g===m.b?0:1+hueGroup$1(w.h,hueGroups$1))-$;if(I)return-I;const D=d.getLuminosity(!0),F=m.getLuminosity(!0);if(F-D!=0)return F-D;const U=(100*w.s|0)-(100*g.s|0);return U?-U:0}))}},utils_exports$1={};__export$1(utils_exports$1,{HueStatistics:()=>HueStatistics$1,Palette:()=>Palette$1,Point:()=>Point$1,PointContainer:()=>PointContainer$1,ProgressTracker:()=>ProgressTracker$1,arithmetic:()=>arithmetic_exports$1});var HueGroup$1=class{constructor(){__publicField$3(this,"num",0),__publicField$3(this,"cols",[])}},HueStatistics$1=class{constructor(d,m){__publicField$3(this,"_numGroups"),__publicField$3(this,"_minCols"),__publicField$3(this,"_stats"),__publicField$3(this,"_groupsFull"),this._numGroups=d,this._minCols=m,this._stats=[];for(let g=0;g<=d;g++)this._stats[g]=new HueGroup$1;this._groupsFull=0}check(d){this._groupsFull===this._numGroups+1&&(this.check=()=>{});const m=255&d,g=d>>>8&255,w=d>>>16&255,$=m===g&&g===w?0:1+hueGroup$1(rgb2hsl$1(m,g,w).h,this._numGroups),I=this._stats[$],D=this._minCols;I.num++,I.num>D||(I.num===D&&this._groupsFull++,I.num<=D&&this._stats[$].cols.push(d))}injectIntoDictionary(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d[g]?d[g]++:d[g]=1}))}injectIntoArray(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d.indexOf(g)===-1&&d.push(g)}))}},_ProgressTracker$1=class{constructor(d,m){__publicField$3(this,"progress"),__publicField$3(this,"_step"),__publicField$3(this,"_range"),__publicField$3(this,"_last"),__publicField$3(this,"_progressRange"),this._range=d,this._progressRange=m,this._step=Math.max(1,this._range/(_ProgressTracker$1.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(d){return d-this._last>=this._step&&(this._last=d,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0)}},ProgressTracker$1=_ProgressTracker$1;__publicField$3(ProgressTracker$1,"steps",100);var networkBiasShift$1=3,Neuron$1=class{constructor(d){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point$1.createByRGBA(this.r>>networkBiasShift$1,this.g>>networkBiasShift$1,this.b>>networkBiasShift$1,this.a>>networkBiasShift$1)}subtract(d,m,g,w){this.r-=0|d,this.g-=0|m,this.b-=0|g,this.a-=0|w}},_NeuQuant$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256){super(),__publicField$3(this,"_pointArray"),__publicField$3(this,"_networkSize"),__publicField$3(this,"_network"),__publicField$3(this,"_sampleFactor"),__publicField$3(this,"_radPower"),__publicField$3(this,"_freq"),__publicField$3(this,"_bias"),__publicField$3(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift$1,255<<networkBiasShift$1,255<<networkBiasShift$1,255<<networkBiasShift$1)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new Neuron$1((d<<networkBiasShift$1+8)/this._networkSize|0),this._freq[d]=_NeuQuant$1._initialBias/this._networkSize|0,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuant$1._minpicturebytes&&(d=1);const g=30+(d-1)/3|0,w=m/d|0;let $,I=w/_NeuQuant$1._nCycles|0,D=_NeuQuant$1._initAlpha,F=(this._networkSize>>3)*_NeuQuant$1._radiusBias,U=F>>_NeuQuant$1._radiusBiasShift;U<=1&&(U=0);for(let j=0;j<U;j++)this._radPower[j]=D*((U*U-j*j)*_NeuQuant$1._radBias/(U*U))>>>0;$=m<_NeuQuant$1._minpicturebytes?1:m%_NeuQuant$1._prime1!=0?_NeuQuant$1._prime1:m%_NeuQuant$1._prime2!=0?_NeuQuant$1._prime2:m%_NeuQuant$1._prime3!=0?_NeuQuant$1._prime3:_NeuQuant$1._prime4;const q=new ProgressTracker$1(w,99);for(let j=0,G=0;j<w;){q.shouldNotify(j)&&(yield{progress:q.progress});const H=this._pointArray[G],V=H.b<<networkBiasShift$1,Z=H.g<<networkBiasShift$1,Q=H.r<<networkBiasShift$1,J=H.a<<networkBiasShift$1,ie=this._contest(V,Z,Q,J);if(this._alterSingle(D,ie,V,Z,Q,J),U!==0&&this._alterNeighbour(U,ie,V,Z,Q,J),G+=$,G>=m&&(G-=m),j++,I===0&&(I=1),j%I==0){D-=D/g|0,F-=F/_NeuQuant$1._radiusDecrease|0,U=F>>_NeuQuant$1._radiusBiasShift,U<=1&&(U=0);for(let re=0;re<U;re++)this._radPower[re]=D*((U*U-re*re)*_NeuQuant$1._radBias/(U*U))>>>0}}}_buildPalette(){const d=new Palette$1;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let F=m+d;F>this._networkSize&&(F=this._networkSize);let U=m+1,q=m-1,j=1;for(;U<F||q>D;){const G=this._radPower[j++]/_NeuQuant$1._alphaRadBias;if(U<F){const H=this._network[U++];H.subtract(G*(H.r-$),G*(H.g-w),G*(H.b-g),G*(H.a-I))}if(q>D){const H=this._network[q--];H.subtract(G*(H.r-$),G*(H.g-w),G*(H.b-g),G*(H.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuant$1._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift$1;let I=2147483647,D=I,F=-1,U=F;for(let q=0;q<this._networkSize;q++){const j=this._network[q],G=this._distance.calculateNormalized(j,{r:g,g:m,b:d,a:w})*$|0;G<I&&(I=G,F=q);const H=G-(this._bias[q]>>_NeuQuant$1._initialBiasShift-networkBiasShift$1);H<D&&(D=H,U=q);const V=this._freq[q]>>_NeuQuant$1._betaShift;this._freq[q]-=V,this._bias[q]+=V<<_NeuQuant$1._gammaShift}return this._freq[F]+=_NeuQuant$1._beta,this._bias[F]-=_NeuQuant$1._betaGamma,U}},NeuQuant$1=_NeuQuant$1;__publicField$3(NeuQuant$1,"_prime1",499),__publicField$3(NeuQuant$1,"_prime2",491),__publicField$3(NeuQuant$1,"_prime3",487),__publicField$3(NeuQuant$1,"_prime4",503),__publicField$3(NeuQuant$1,"_minpicturebytes",_NeuQuant$1._prime4),__publicField$3(NeuQuant$1,"_nCycles",100),__publicField$3(NeuQuant$1,"_initialBiasShift",16),__publicField$3(NeuQuant$1,"_initialBias",1<<_NeuQuant$1._initialBiasShift),__publicField$3(NeuQuant$1,"_gammaShift",10),__publicField$3(NeuQuant$1,"_betaShift",10),__publicField$3(NeuQuant$1,"_beta",_NeuQuant$1._initialBias>>_NeuQuant$1._betaShift),__publicField$3(NeuQuant$1,"_betaGamma",_NeuQuant$1._initialBias<<_NeuQuant$1._gammaShift-_NeuQuant$1._betaShift),__publicField$3(NeuQuant$1,"_radiusBiasShift",6),__publicField$3(NeuQuant$1,"_radiusBias",1<<_NeuQuant$1._radiusBiasShift),__publicField$3(NeuQuant$1,"_radiusDecrease",30),__publicField$3(NeuQuant$1,"_alphaBiasShift",10),__publicField$3(NeuQuant$1,"_initAlpha",1<<_NeuQuant$1._alphaBiasShift),__publicField$3(NeuQuant$1,"_radBiasShift",8),__publicField$3(NeuQuant$1,"_radBias",1<<_NeuQuant$1._radBiasShift),__publicField$3(NeuQuant$1,"_alphaRadBiasShift",_NeuQuant$1._alphaBiasShift+_NeuQuant$1._radBiasShift),__publicField$3(NeuQuant$1,"_alphaRadBias",1<<_NeuQuant$1._alphaRadBiasShift);var networkBiasShift2$1=3,NeuronFloat$1=class{constructor(d){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point$1.createByRGBA(this.r>>networkBiasShift2$1,this.g>>networkBiasShift2$1,this.b>>networkBiasShift2$1,this.a>>networkBiasShift2$1)}subtract(d,m,g,w){this.r-=d,this.g-=m,this.b-=g,this.a-=w}},_NeuQuantFloat$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256){super(),__publicField$3(this,"_pointArray"),__publicField$3(this,"_networkSize"),__publicField$3(this,"_network"),__publicField$3(this,"_sampleFactor"),__publicField$3(this,"_radPower"),__publicField$3(this,"_freq"),__publicField$3(this,"_bias"),__publicField$3(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift2$1,255<<networkBiasShift2$1,255<<networkBiasShift2$1,255<<networkBiasShift2$1)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new NeuronFloat$1((d<<networkBiasShift2$1+8)/this._networkSize),this._freq[d]=_NeuQuantFloat$1._initialBias/this._networkSize,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuantFloat$1._minpicturebytes&&(d=1);const g=30+(d-1)/3,w=m/d;let $,I=w/_NeuQuantFloat$1._nCycles|0,D=_NeuQuantFloat$1._initAlpha,F=(this._networkSize>>3)*_NeuQuantFloat$1._radiusBias,U=F>>_NeuQuantFloat$1._radiusBiasShift;U<=1&&(U=0);for(let j=0;j<U;j++)this._radPower[j]=D*((U*U-j*j)*_NeuQuantFloat$1._radBias/(U*U));$=m<_NeuQuantFloat$1._minpicturebytes?1:m%_NeuQuantFloat$1._prime1!=0?_NeuQuantFloat$1._prime1:m%_NeuQuantFloat$1._prime2!=0?_NeuQuantFloat$1._prime2:m%_NeuQuantFloat$1._prime3!=0?_NeuQuantFloat$1._prime3:_NeuQuantFloat$1._prime4;const q=new ProgressTracker$1(w,99);for(let j=0,G=0;j<w;){q.shouldNotify(j)&&(yield{progress:q.progress});const H=this._pointArray[G],V=H.b<<networkBiasShift2$1,Z=H.g<<networkBiasShift2$1,Q=H.r<<networkBiasShift2$1,J=H.a<<networkBiasShift2$1,ie=this._contest(V,Z,Q,J);if(this._alterSingle(D,ie,V,Z,Q,J),U!==0&&this._alterNeighbour(U,ie,V,Z,Q,J),G+=$,G>=m&&(G-=m),j++,I===0&&(I=1),j%I==0){D-=D/g,F-=F/_NeuQuantFloat$1._radiusDecrease,U=F>>_NeuQuantFloat$1._radiusBiasShift,U<=1&&(U=0);for(let re=0;re<U;re++)this._radPower[re]=D*((U*U-re*re)*_NeuQuantFloat$1._radBias/(U*U))}}}_buildPalette(){const d=new Palette$1;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let F=m+d;F>this._networkSize&&(F=this._networkSize);let U=m+1,q=m-1,j=1;for(;U<F||q>D;){const G=this._radPower[j++]/_NeuQuantFloat$1._alphaRadBias;if(U<F){const H=this._network[U++];H.subtract(G*(H.r-$),G*(H.g-w),G*(H.b-g),G*(H.a-I))}if(q>D){const H=this._network[q--];H.subtract(G*(H.r-$),G*(H.g-w),G*(H.b-g),G*(H.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuantFloat$1._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift2$1;let I=2147483647,D=I,F=-1,U=F;for(let q=0;q<this._networkSize;q++){const j=this._network[q],G=this._distance.calculateNormalized(j,{r:g,g:m,b:d,a:w})*$;G<I&&(I=G,F=q);const H=G-(this._bias[q]>>_NeuQuantFloat$1._initialBiasShift-networkBiasShift2$1);H<D&&(D=H,U=q);const V=this._freq[q]>>_NeuQuantFloat$1._betaShift;this._freq[q]-=V,this._bias[q]+=V<<_NeuQuantFloat$1._gammaShift}return this._freq[F]+=_NeuQuantFloat$1._beta,this._bias[F]-=_NeuQuantFloat$1._betaGamma,U}},NeuQuantFloat$1=_NeuQuantFloat$1;__publicField$3(NeuQuantFloat$1,"_prime1",499),__publicField$3(NeuQuantFloat$1,"_prime2",491),__publicField$3(NeuQuantFloat$1,"_prime3",487),__publicField$3(NeuQuantFloat$1,"_prime4",503),__publicField$3(NeuQuantFloat$1,"_minpicturebytes",_NeuQuantFloat$1._prime4),__publicField$3(NeuQuantFloat$1,"_nCycles",100),__publicField$3(NeuQuantFloat$1,"_initialBiasShift",16),__publicField$3(NeuQuantFloat$1,"_initialBias",1<<_NeuQuantFloat$1._initialBiasShift),__publicField$3(NeuQuantFloat$1,"_gammaShift",10),__publicField$3(NeuQuantFloat$1,"_betaShift",10),__publicField$3(NeuQuantFloat$1,"_beta",_NeuQuantFloat$1._initialBias>>_NeuQuantFloat$1._betaShift),__publicField$3(NeuQuantFloat$1,"_betaGamma",_NeuQuantFloat$1._initialBias<<_NeuQuantFloat$1._gammaShift-_NeuQuantFloat$1._betaShift),__publicField$3(NeuQuantFloat$1,"_radiusBiasShift",6),__publicField$3(NeuQuantFloat$1,"_radiusBias",1<<_NeuQuantFloat$1._radiusBiasShift),__publicField$3(NeuQuantFloat$1,"_radiusDecrease",30),__publicField$3(NeuQuantFloat$1,"_alphaBiasShift",10),__publicField$3(NeuQuantFloat$1,"_initAlpha",1<<_NeuQuantFloat$1._alphaBiasShift),__publicField$3(NeuQuantFloat$1,"_radBiasShift",8),__publicField$3(NeuQuantFloat$1,"_radBias",1<<_NeuQuantFloat$1._radBiasShift),__publicField$3(NeuQuantFloat$1,"_alphaRadBiasShift",_NeuQuantFloat$1._alphaBiasShift+_NeuQuantFloat$1._radBiasShift),__publicField$3(NeuQuantFloat$1,"_alphaRadBias",1<<_NeuQuantFloat$1._alphaRadBiasShift);var _ColorHistogram$1=class{constructor(d,m){__publicField$3(this,"_method"),__publicField$3(this,"_hueStats"),__publicField$3(this,"_histogram"),__publicField$3(this,"_initColors"),__publicField$3(this,"_minHueCols"),this._method=d,this._minHueCols=m<<2,this._initColors=m<<2,this._hueStats=new HueStatistics$1(_ColorHistogram$1._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(d){switch(this._method){case 1:this._colorStats1D(d);break;case 2:this._colorStats2D(d)}}getImportanceSortedColorsIDXI32(){const d=stableSort$1(Object.keys(this._histogram),((g,w)=>this._histogram[w]-this._histogram[g]));if(d.length===0)return[];let m;switch(this._method){case 1:const g=Math.min(d.length,this._initColors),w=d[g-1],$=this._histogram[w];m=d.slice(0,g);let I=g;const D=d.length;for(;I<D&&this._histogram[d[I]]===$;)m.push(d[I++]);this._hueStats.injectIntoArray(m);break;case 2:m=d;break;default:throw new Error("Incorrect method")}return m.map((g=>+g))}_colorStats1D(d){const m=this._histogram,g=d.getPointArray(),w=g.length;for(let $=0;$<w;$++){const I=g[$].uint32;this._hueStats.check(I),I in m?m[I]++:m[I]=1}}_colorStats2D(d){const m=d.getWidth(),g=d.getHeight(),w=d.getPointArray(),$=_ColorHistogram$1._boxSize[0],I=_ColorHistogram$1._boxSize[1],D=$*I,F=this._makeBoxes(m,g,$,I),U=this._histogram;F.forEach((q=>{let j=Math.round(q.w*q.h/D)*_ColorHistogram$1._boxPixels;j<2&&(j=2);const G={};this._iterateBox(q,m,(H=>{const V=w[H].uint32;this._hueStats.check(V),V in U?U[V]++:V in G?++G[V]>=j&&(U[V]=G[V]):G[V]=1}))})),this._hueStats.injectIntoDictionary(U)}_iterateBox(d,m,g){const w=d,$=w.y*m+w.x,I=(w.y+w.h-1)*m+(w.x+w.w-1),D=m-w.w+1;let F=0,U=$;do g.call(this,U),U+=++F%w.w==0?D:1;while(U<=I)}_makeBoxes(d,m,g,w){const $=d%g,I=m%w,D=d-$,F=m-I,U=[];for(let q=0;q<m;q+=w)for(let j=0;j<d;j+=g)U.push({x:j,y:q,w:j===D?$:g,h:q===F?I:w});return U}},ColorHistogram$1=_ColorHistogram$1;__publicField$3(ColorHistogram$1,"_boxSize",[64,64]),__publicField$3(ColorHistogram$1,"_boxPixels",2),__publicField$3(ColorHistogram$1,"_hueGroups",10);var RemovedColor$1=class{constructor(d,m,g){__publicField$3(this,"index"),__publicField$3(this,"color"),__publicField$3(this,"distance"),this.index=d,this.color=m,this.distance=g}},RGBQuant$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256,g=2){super(),__publicField$3(this,"_colors"),__publicField$3(this,"_initialDistance"),__publicField$3(this,"_distanceIncrement"),__publicField$3(this,"_histogram"),__publicField$3(this,"_distance"),this._distance=d,this._colors=m,this._histogram=new ColorHistogram$1(g,m),this._initialDistance=.01,this._distanceIncrement=.005}sample(d){this._histogram.sample(d)}*quantize(){const d=this._histogram.getImportanceSortedColorsIDXI32();if(d.length===0)throw new Error("No colors in image");yield*this._buildPalette(d)}*_buildPalette(d){const m=new Palette$1,g=m.getPointContainer().getPointArray(),w=new Array(d.length);for(let j=0;j<d.length;j++)g.push(Point$1.createByUint32(d[j])),w[j]=1;const $=g.length,I=[];let D=$,F=this._initialDistance;const U=new ProgressTracker$1(D-this._colors,99);for(;D>this._colors;){I.length=0;for(let j=0;j<$;j++){if(U.shouldNotify($-D)&&(yield{progress:U.progress}),w[j]===0)continue;const G=g[j];for(let H=j+1;H<$;H++){if(w[H]===0)continue;const V=g[H],Z=this._distance.calculateNormalized(G,V);Z<F&&(I.push(new RemovedColor$1(H,V,Z)),w[H]=0,D--)}}F+=D>3*this._colors?this._initialDistance:this._distanceIncrement}if(D<this._colors){stableSort$1(I,((G,H)=>H.distance-G.distance));let j=0;for(;D<this._colors&&j<I.length;)w[I[j].index]=1,D++,j++}let q=g.length;for(let j=q-1;j>=0;j--)w[j]===0&&(j!==q-1&&(g[j]=g[q-1]),--q);g.length=q,m.sort(),yield{palette:m,progress:100}}};function createArray1D$1(d){const m=[];for(let g=0;g<d;g++)m[g]=0;return m}function createArray4D$1(d,m,g,w){const $=new Array(d);for(let I=0;I<d;I++){$[I]=new Array(m);for(let D=0;D<m;D++){$[I][D]=new Array(g);for(let F=0;F<g;F++){$[I][D][F]=new Array(w);for(let U=0;U<w;U++)$[I][D][F][U]=0}}}return $}function createArray3D$1(d,m,g){const w=new Array(d);for(let $=0;$<d;$++){w[$]=new Array(m);for(let I=0;I<m;I++){w[$][I]=new Array(g);for(let D=0;D<g;D++)w[$][I][D]=0}}return w}function fillArray3D$1(d,m,g,w,$){for(let I=0;I<m;I++){d[I]=[];for(let D=0;D<g;D++){d[I][D]=[];for(let F=0;F<w;F++)d[I][D][F]=$}}}function fillArray1D$1(d,m,g){for(let w=0;w<m;w++)d[w]=g}var WuColorCube$1=class{constructor(){__publicField$3(this,"redMinimum"),__publicField$3(this,"redMaximum"),__publicField$3(this,"greenMinimum"),__publicField$3(this,"greenMaximum"),__publicField$3(this,"blueMinimum"),__publicField$3(this,"blueMaximum"),__publicField$3(this,"volume"),__publicField$3(this,"alphaMinimum"),__publicField$3(this,"alphaMaximum")}},_WuQuant$1=class extends AbstractPaletteQuantizer$1{constructor(d,m=256,g=5){super(),__publicField$3(this,"_reds"),__publicField$3(this,"_greens"),__publicField$3(this,"_blues"),__publicField$3(this,"_alphas"),__publicField$3(this,"_sums"),__publicField$3(this,"_weights"),__publicField$3(this,"_momentsRed"),__publicField$3(this,"_momentsGreen"),__publicField$3(this,"_momentsBlue"),__publicField$3(this,"_momentsAlpha"),__publicField$3(this,"_moments"),__publicField$3(this,"_table"),__publicField$3(this,"_pixels"),__publicField$3(this,"_cubes"),__publicField$3(this,"_colors"),__publicField$3(this,"_significantBitsPerChannel"),__publicField$3(this,"_maxSideIndex"),__publicField$3(this,"_alphaMaxSideIndex"),__publicField$3(this,"_sideSize"),__publicField$3(this,"_alphaSideSize"),__publicField$3(this,"_distance"),this._distance=d,this._setQuality(g),this._initialize(m)}sample(d){const m=d.getPointArray();for(let g=0,w=m.length;g<w;g++)this._addColor(m[g]);this._pixels=this._pixels.concat(m)}*quantize(){yield*this._preparePalette();const d=new Palette$1;for(let m=0;m<this._colors;m++)if(this._sums[m]>0){const g=this._sums[m],w=this._reds[m]/g,$=this._greens[m]/g,I=this._blues[m]/g,D=this._alphas[m]/g,F=Point$1.createByRGBA(0|w,0|$,0|I,0|D);d.add(F)}d.sort(),yield{palette:d,progress:100}}*_preparePalette(){yield*this._calculateMoments();let d=0;const m=createArray1D$1(this._colors);for(let D=1;D<this._colors;++D){this._cut(this._cubes[d],this._cubes[D])?(m[d]=this._cubes[d].volume>1?this._calculateVariance(this._cubes[d]):0,m[D]=this._cubes[D].volume>1?this._calculateVariance(this._cubes[D]):0):(m[d]=0,D--),d=0;let F=m[0];for(let U=1;U<=D;++U)m[U]>F&&(F=m[U],d=U);if(F<=0){this._colors=D+1;break}}const g=[],w=[],$=[],I=[];for(let D=0;D<this._colors;++D){const F=_WuQuant$1._volume(this._cubes[D],this._weights);F>0?(g[D]=_WuQuant$1._volume(this._cubes[D],this._momentsRed)/F|0,w[D]=_WuQuant$1._volume(this._cubes[D],this._momentsGreen)/F|0,$[D]=_WuQuant$1._volume(this._cubes[D],this._momentsBlue)/F|0,I[D]=_WuQuant$1._volume(this._cubes[D],this._momentsAlpha)/F|0):(g[D]=0,w[D]=0,$[D]=0,I[D]=0)}this._reds=createArray1D$1(this._colors+1),this._greens=createArray1D$1(this._colors+1),this._blues=createArray1D$1(this._colors+1),this._alphas=createArray1D$1(this._colors+1),this._sums=createArray1D$1(this._colors+1);for(let D=0,F=this._pixels.length;D<F;D++){const U=this._pixels[D];let q=-1,j=Number.MAX_VALUE;for(let G=0;G<this._colors;G++){const H=g[G],V=w[G],Z=$[G],Q=I[G],J=this._distance.calculateRaw(H,V,Z,Q,U.r,U.g,U.b,U.a);J<j&&(j=J,q=G)}this._reds[q]+=U.r,this._greens[q]+=U.g,this._blues[q]+=U.b,this._alphas[q]+=U.a,this._sums[q]++}}_addColor(d){const m=8-this._significantBitsPerChannel,g=1+(d.r>>m),w=1+(d.g>>m),$=1+(d.b>>m),I=1+(d.a>>m);this._weights[I][g][w][$]++,this._momentsRed[I][g][w][$]+=d.r,this._momentsGreen[I][g][w][$]+=d.g,this._momentsBlue[I][g][w][$]+=d.b,this._momentsAlpha[I][g][w][$]+=d.a,this._moments[I][g][w][$]+=this._table[d.r]+this._table[d.g]+this._table[d.b]+this._table[d.a]}*_calculateMoments(){const d=[],m=[],g=[],w=[],$=[],I=[],D=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),F=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),U=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),q=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),j=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),G=createArray3D$1(this._sideSize,this._sideSize,this._sideSize);let H=0;const V=new ProgressTracker$1(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let Z=1;Z<=this._alphaMaxSideIndex;++Z){fillArray3D$1(D,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(F,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(U,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(q,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(j,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(G,this._sideSize,this._sideSize,this._sideSize,0);for(let Q=1;Q<=this._maxSideIndex;++Q,++H){V.shouldNotify(H)&&(yield{progress:V.progress}),fillArray1D$1(d,this._sideSize,0),fillArray1D$1(m,this._sideSize,0),fillArray1D$1(g,this._sideSize,0),fillArray1D$1(w,this._sideSize,0),fillArray1D$1($,this._sideSize,0),fillArray1D$1(I,this._sideSize,0);for(let J=1;J<=this._maxSideIndex;++J){let ie=0,re=0,se=0,X=0,ne=0,ce=0;for(let oe=1;oe<=this._maxSideIndex;++oe)ie+=this._weights[Z][Q][J][oe],re+=this._momentsRed[Z][Q][J][oe],se+=this._momentsGreen[Z][Q][J][oe],X+=this._momentsBlue[Z][Q][J][oe],ne+=this._momentsAlpha[Z][Q][J][oe],ce+=this._moments[Z][Q][J][oe],d[oe]+=ie,m[oe]+=re,g[oe]+=se,w[oe]+=X,$[oe]+=ne,I[oe]+=ce,D[Q][J][oe]=D[Q-1][J][oe]+d[oe],F[Q][J][oe]=F[Q-1][J][oe]+m[oe],U[Q][J][oe]=U[Q-1][J][oe]+g[oe],q[Q][J][oe]=q[Q-1][J][oe]+w[oe],j[Q][J][oe]=j[Q-1][J][oe]+$[oe],G[Q][J][oe]=G[Q-1][J][oe]+I[oe],this._weights[Z][Q][J][oe]=this._weights[Z-1][Q][J][oe]+D[Q][J][oe],this._momentsRed[Z][Q][J][oe]=this._momentsRed[Z-1][Q][J][oe]+F[Q][J][oe],this._momentsGreen[Z][Q][J][oe]=this._momentsGreen[Z-1][Q][J][oe]+U[Q][J][oe],this._momentsBlue[Z][Q][J][oe]=this._momentsBlue[Z-1][Q][J][oe]+q[Q][J][oe],this._momentsAlpha[Z][Q][J][oe]=this._momentsAlpha[Z-1][Q][J][oe]+j[Q][J][oe],this._moments[Z][Q][J][oe]=this._moments[Z-1][Q][J][oe]+G[Q][J][oe]}}}}static _volumeFloat(d,m){return m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMaximum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum])}static _volume(d,m){return 0|_WuQuant$1._volumeFloat(d,m)}static _top(d,m,g,w){let $;switch(m){case _WuQuant$1._alpha:$=w[g][d.redMaximum][d.greenMaximum][d.blueMaximum]-w[g][d.redMaximum][d.greenMinimum][d.blueMaximum]-w[g][d.redMinimum][d.greenMaximum][d.blueMaximum]+w[g][d.redMinimum][d.greenMinimum][d.blueMaximum]-(w[g][d.redMaximum][d.greenMaximum][d.blueMinimum]-w[g][d.redMaximum][d.greenMinimum][d.blueMinimum]-w[g][d.redMinimum][d.greenMaximum][d.blueMinimum]+w[g][d.redMinimum][d.greenMinimum][d.blueMinimum]);break;case _WuQuant$1._red:$=w[d.alphaMaximum][g][d.greenMaximum][d.blueMaximum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMaximum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMaximum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMaximum]-(w[d.alphaMaximum][g][d.greenMaximum][d.blueMinimum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMinimum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMinimum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMinimum]);break;case _WuQuant$1._green:$=w[d.alphaMaximum][d.redMaximum][g][d.blueMaximum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMaximum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMaximum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMaximum]-(w[d.alphaMaximum][d.redMaximum][g][d.blueMinimum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMinimum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMinimum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMinimum]);break;case _WuQuant$1._blue:$=w[d.alphaMaximum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMaximum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMaximum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMaximum][d.redMinimum][d.greenMinimum][g]-(w[d.alphaMinimum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMinimum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMinimum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMinimum][d.redMinimum][d.greenMinimum][g]);break;default:throw new Error("impossible")}return 0|$}static _bottom(d,m,g){switch(m){case _WuQuant$1._alpha:return-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant$1._red:return-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant$1._green:return-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant$1._blue:return-g[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);default:return 0}}_calculateVariance(d){const m=_WuQuant$1._volume(d,this._momentsRed),g=_WuQuant$1._volume(d,this._momentsGreen),w=_WuQuant$1._volume(d,this._momentsBlue),$=_WuQuant$1._volume(d,this._momentsAlpha);return _WuQuant$1._volumeFloat(d,this._moments)-(m*m+g*g+w*w+$*$)/_WuQuant$1._volume(d,this._weights)}_maximize(d,m,g,w,$,I,D,F,U){const q=0|_WuQuant$1._bottom(d,m,this._momentsRed),j=0|_WuQuant$1._bottom(d,m,this._momentsGreen),G=0|_WuQuant$1._bottom(d,m,this._momentsBlue),H=0|_WuQuant$1._bottom(d,m,this._momentsAlpha),V=0|_WuQuant$1._bottom(d,m,this._weights);let Z=0,Q=-1;for(let J=g;J<w;++J){let ie=q+_WuQuant$1._top(d,m,J,this._momentsRed),re=j+_WuQuant$1._top(d,m,J,this._momentsGreen),se=G+_WuQuant$1._top(d,m,J,this._momentsBlue),X=H+_WuQuant$1._top(d,m,J,this._momentsAlpha),ne=V+_WuQuant$1._top(d,m,J,this._weights);if(ne!==0){let ce=ie*ie+re*re+se*se+X*X,oe=ce/ne;ie=$-ie,re=I-re,se=D-se,X=F-X,ne=U-ne,ne!==0&&(ce=ie*ie+re*re+se*se+X*X,oe+=ce/ne,oe>Z&&(Z=oe,Q=J))}}return{max:Z,position:Q}}_cut(d,m){let g;const w=_WuQuant$1._volume(d,this._momentsRed),$=_WuQuant$1._volume(d,this._momentsGreen),I=_WuQuant$1._volume(d,this._momentsBlue),D=_WuQuant$1._volume(d,this._momentsAlpha),F=_WuQuant$1._volume(d,this._weights),U=this._maximize(d,_WuQuant$1._red,d.redMinimum+1,d.redMaximum,w,$,I,D,F),q=this._maximize(d,_WuQuant$1._green,d.greenMinimum+1,d.greenMaximum,w,$,I,D,F),j=this._maximize(d,_WuQuant$1._blue,d.blueMinimum+1,d.blueMaximum,w,$,I,D,F),G=this._maximize(d,_WuQuant$1._alpha,d.alphaMinimum+1,d.alphaMaximum,w,$,I,D,F);if(G.max>=U.max&&G.max>=q.max&&G.max>=j.max){if(g=_WuQuant$1._alpha,G.position<0)return!1}else g=U.max>=G.max&&U.max>=q.max&&U.max>=j.max?_WuQuant$1._red:q.max>=G.max&&q.max>=U.max&&q.max>=j.max?_WuQuant$1._green:_WuQuant$1._blue;switch(m.redMaximum=d.redMaximum,m.greenMaximum=d.greenMaximum,m.blueMaximum=d.blueMaximum,m.alphaMaximum=d.alphaMaximum,g){case _WuQuant$1._red:m.redMinimum=d.redMaximum=U.position,m.greenMinimum=d.greenMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant$1._green:m.greenMinimum=d.greenMaximum=q.position,m.redMinimum=d.redMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant$1._blue:m.blueMinimum=d.blueMaximum=j.position,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant$1._alpha:m.alphaMinimum=d.alphaMaximum=G.position,m.blueMinimum=d.blueMinimum,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum}return d.volume=(d.redMaximum-d.redMinimum)*(d.greenMaximum-d.greenMinimum)*(d.blueMaximum-d.blueMinimum)*(d.alphaMaximum-d.alphaMinimum),m.volume=(m.redMaximum-m.redMinimum)*(m.greenMaximum-m.greenMinimum)*(m.blueMaximum-m.blueMinimum)*(m.alphaMaximum-m.alphaMinimum),!0}_initialize(d){this._colors=d,this._cubes=[];for(let m=0;m<d;m++)this._cubes[m]=new WuColorCube$1;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let m=0;m<256;++m)this._table[m]=m*m;this._pixels=[]}_setQuality(d=5){this._significantBitsPerChannel=d,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}},WuQuant$1=_WuQuant$1;__publicField$3(WuQuant$1,"_alpha",3),__publicField$3(WuQuant$1,"_red",2),__publicField$3(WuQuant$1,"_green",1),__publicField$3(WuQuant$1,"_blue",0);var image_exports$1={};__export$1(image_exports$1,{AbstractImageQuantizer:()=>AbstractImageQuantizer$1,ErrorDiffusionArray:()=>ErrorDiffusionArray$1,ErrorDiffusionArrayKernel:()=>ErrorDiffusionArrayKernel$1,ErrorDiffusionRiemersma:()=>ErrorDiffusionRiemersma$1,NearestColor:()=>NearestColor$1});var AbstractImageQuantizer$1=class{quantizeSync(d,m){for(const g of this.quantize(d,m))if(g.pointContainer)return g.pointContainer;throw new Error("unreachable")}},NearestColor$1=class extends AbstractImageQuantizer$1{constructor(d){super(),__publicField$3(this,"_distance"),this._distance=d}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=new ProgressTracker$1($,99);for(let D=0;D<$;D++){I.shouldNotify(D)&&(yield{progress:I.progress});for(let F=0,U=D*w;F<w;F++,U++){const q=g[U];q.from(m.getNearestColor(this._distance,q))}}yield{pointContainer:d,progress:100}}},ErrorDiffusionArrayKernel$1=(d=>(d[d.FloydSteinberg=0]="FloydSteinberg",d[d.FalseFloydSteinberg=1]="FalseFloydSteinberg",d[d.Stucki=2]="Stucki",d[d.Atkinson=3]="Atkinson",d[d.Jarvis=4]="Jarvis",d[d.Burkes=5]="Burkes",d[d.Sierra=6]="Sierra",d[d.TwoSierra=7]="TwoSierra",d[d.SierraLite=8]="SierraLite",d))(ErrorDiffusionArrayKernel$1||{}),ErrorDiffusionArray$1=class extends AbstractImageQuantizer$1{constructor(d,m,g=!0,w=0,$=!1){super(),__publicField$3(this,"_minColorDistance"),__publicField$3(this,"_serpentine"),__publicField$3(this,"_kernel"),__publicField$3(this,"_calculateErrorLikeGIMP"),__publicField$3(this,"_distance"),this._setKernel(m),this._distance=d,this._minColorDistance=w,this._serpentine=g,this._calculateErrorLikeGIMP=$}*quantize(d,m){const g=d.getPointArray(),w=new Point$1,$=d.getWidth(),I=d.getHeight(),D=[];let F=1,U=1;for(const j of this._kernel){const G=j[2]+1;U<G&&(U=G)}for(let j=0;j<U;j++)this._fillErrorLine(D[j]=[],$);const q=new ProgressTracker$1(I,99);for(let j=0;j<I;j++){q.shouldNotify(j)&&(yield{progress:q.progress}),this._serpentine&&(F*=-1);const G=j*$,H=F===1?0:$-1,V=F===1?$:-1;this._fillErrorLine(D[0],$),D.push(D.shift());const Z=D[0];for(let Q=H,J=G+H;Q!==V;Q+=F,J+=F){const ie=g[J],re=Z[Q];w.from(ie);const se=Point$1.createByRGBA(inRange0to255Rounded$1(ie.r+re[0]),inRange0to255Rounded$1(ie.g+re[1]),inRange0to255Rounded$1(ie.b+re[2]),inRange0to255Rounded$1(ie.a+re[3])),X=m.getNearestColor(this._distance,se);if(ie.from(X),this._minColorDistance&&this._distance.calculateNormalized(w,X)<this._minColorDistance)continue;let ne,ce,oe,de;this._calculateErrorLikeGIMP?(ne=se.r-X.r,ce=se.g-X.g,oe=se.b-X.b,de=se.a-X.a):(ne=w.r-X.r,ce=w.g-X.g,oe=w.b-X.b,de=w.a-X.a);const me=F===1?0:this._kernel.length-1,ge=F===1?this._kernel.length:-1;for(let fe=me;fe!==ge;fe+=F){const xe=this._kernel[fe][1]*F,Fe=this._kernel[fe][2];if(xe+Q>=0&&xe+Q<$&&Fe+j>=0&&Fe+j<I){const Te=this._kernel[fe][0],Oe=D[Fe][xe+Q];Oe[0]+=ne*Te,Oe[1]+=ce*Te,Oe[2]+=oe*Te,Oe[3]+=de*Te}}}}yield{pointContainer:d,progress:100}}_fillErrorLine(d,m){d.length>m&&(d.length=m);const g=d.length;for(let w=0;w<g;w++){const $=d[w];$[0]=$[1]=$[2]=$[3]=0}for(let w=g;w<m;w++)d[w]=[0,0,0,0]}_setKernel(d){switch(d){case 0:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case 1:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case 2:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case 3:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case 4:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case 5:this._kernel=[[.25,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[.25,0,1],[4/32,1,1],[2/32,2,1]];break;case 6:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case 7:this._kernel=[[.25,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case 8:this._kernel=[[.5,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw new Error(`ErrorDiffusionArray: unknown kernel = ${d}`)}}};function*hilbertCurve$1(d,m,g){const w=Math.max(d,m),$={width:d,height:m,level:Math.floor(Math.log(w)/Math.log(2)+1),callback:g,tracker:new ProgressTracker$1(d*m,99),index:0,x:0,y:0};yield*walkHilbert$1($,1),visit$1($,0)}function*walkHilbert$1(d,m){if(!(d.level<1)){switch(d.tracker.shouldNotify(d.index)&&(yield{progress:d.tracker.progress}),d.level--,m){case 2:yield*walkHilbert$1(d,1),visit$1(d,3),yield*walkHilbert$1(d,2),visit$1(d,4),yield*walkHilbert$1(d,2),visit$1(d,2),yield*walkHilbert$1(d,4);break;case 3:yield*walkHilbert$1(d,4),visit$1(d,2),yield*walkHilbert$1(d,3),visit$1(d,1),yield*walkHilbert$1(d,3),visit$1(d,3),yield*walkHilbert$1(d,1);break;case 1:yield*walkHilbert$1(d,2),visit$1(d,4),yield*walkHilbert$1(d,1),visit$1(d,3),yield*walkHilbert$1(d,1),visit$1(d,1),yield*walkHilbert$1(d,3);break;case 4:yield*walkHilbert$1(d,3),visit$1(d,1),yield*walkHilbert$1(d,4),visit$1(d,2),yield*walkHilbert$1(d,4),visit$1(d,4),yield*walkHilbert$1(d,2)}d.level++}}function visit$1(d,m){switch(d.x>=0&&d.x<d.width&&d.y>=0&&d.y<d.height&&(d.callback(d.x,d.y),d.index++),m){case 2:d.x--;break;case 3:d.x++;break;case 1:d.y--;break;case 4:d.y++}}var ErrorDiffusionRiemersma$1=class extends AbstractImageQuantizer$1{constructor(d,m=16,g=1){super(),__publicField$3(this,"_distance"),__publicField$3(this,"_weights"),__publicField$3(this,"_errorQueueSize"),this._distance=d,this._errorQueueSize=m,this._weights=ErrorDiffusionRiemersma$1._createWeights(g,m)}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=[];let D=0;for(let F=0;F<this._errorQueueSize;F++)I[F]={r:0,g:0,b:0,a:0};yield*hilbertCurve$1(w,$,((F,U)=>{const q=g[F+U*w];let{r:j,g:G,b:H,a:V}=q;for(let ie=0;ie<this._errorQueueSize;ie++){const re=this._weights[ie],se=I[(ie+D)%this._errorQueueSize];j+=se.r*re,G+=se.g*re,H+=se.b*re,V+=se.a*re}const Z=Point$1.createByRGBA(inRange0to255Rounded$1(j),inRange0to255Rounded$1(G),inRange0to255Rounded$1(H),inRange0to255Rounded$1(V)),Q=m.getNearestColor(this._distance,Z);D=(D+1)%this._errorQueueSize;const J=(D+this._errorQueueSize-1)%this._errorQueueSize;I[J].r=q.r-Q.r,I[J].g=q.g-Q.g,I[J].b=q.b-Q.b,I[J].a=q.a-Q.a,q.from(Q)})),yield{pointContainer:d,progress:100}}static _createWeights(d,m){const g=[],w=Math.exp(Math.log(m)/(m-1));for(let $=0,I=1;$<m;$++)g[$]=(I+.5|0)/m*d,I*=w;return g}},quality_exports$1={};__export$1(quality_exports$1,{ssim:()=>ssim$1});var K1$1=.01,K2$1=.03;function ssim$1(d,m){if(d.getHeight()!==m.getHeight()||d.getWidth()!==m.getWidth())throw new Error("Images have different sizes!");const g=(255*K1$1)**2,w=(255*K2$1)**2;let $=0,I=0;return iterate$1(d,m,((D,F,U,q)=>{let j=0,G=0,H=0;for(let Z=0;Z<D.length;Z++)G+=(D[Z]-U)**2,H+=(F[Z]-q)**2,j+=(D[Z]-U)*(F[Z]-q);const V=D.length-1;G/=V,H/=V,j/=V,I+=(2*U*q+g)*(2*j+w)/((U**2+q**2+g)*(G+H+w)),$++})),I/$}function iterate$1(d,m,g){const w=d.getWidth(),$=d.getHeight();for(let I=0;I<$;I+=8)for(let D=0;D<w;D+=8){const F=Math.min(8,w-D),U=Math.min(8,$-I),q=calculateLumaValuesForWindow$1(d,D,I,F,U),j=calculateLumaValuesForWindow$1(m,D,I,F,U);g(q,j,calculateAverageLuma$1(q),calculateAverageLuma$1(j))}}function calculateLumaValuesForWindow$1(d,m,g,w,$){const I=d.getPointArray(),D=[];let F=0;for(let U=g;U<g+$;U++){const q=U*d.getWidth();for(let j=m;j<m+w;j++){const G=I[q+j];D[F]=.2126*G.r+.7152*G.g+.0722*G.b,F++}}return D}function calculateAverageLuma$1(d){let m=0;for(const g of d)m+=g;return m/d.length}var setImmediateImpl=typeof setImmediate=="function"?setImmediate:typeof process<"u"&&typeof(process==null?void 0:process.nextTick)=="function"?d=>process.nextTick(d):d=>setTimeout(d,0);function buildPaletteSync$1(d,{colorDistanceFormula:m,paletteQuantization:g,colors:w}={}){const $=paletteQuantizationToPaletteQuantizer$1(colorDistanceFormulaToColorDistance$1(m),g,w);return d.forEach((I=>$.sample(I))),$.quantizeSync()}async function buildPalette(d,{colorDistanceFormula:m,paletteQuantization:g,colors:w,onProgress:$}={}){return new Promise(((I,D)=>{const F=paletteQuantizationToPaletteQuantizer$1(colorDistanceFormulaToColorDistance$1(m),g,w);let U;d.forEach((G=>F.sample(G)));const q=F.quantize(),j=()=>{try{const G=q.next();G.done?I(U):(G.value.palette&&(U=G.value.palette),$&&$(G.value.progress),setImmediateImpl(j))}catch(G){D(G)}};setImmediateImpl(j)}))}function applyPaletteSync$1(d,m,{colorDistanceFormula:g,imageQuantization:w}={}){return imageQuantizationToImageQuantizer$1(colorDistanceFormulaToColorDistance$1(g),w).quantizeSync(d,m)}async function applyPalette(d,m,{colorDistanceFormula:g,imageQuantization:w,onProgress:$}={}){return new Promise(((I,D)=>{let F;const U=imageQuantizationToImageQuantizer$1(colorDistanceFormulaToColorDistance$1(g),w).quantize(d,m),q=()=>{try{const j=U.next();j.done?I(F):(j.value.pointContainer&&(F=j.value.pointContainer),$&&$(j.value.progress),setImmediateImpl(q))}catch(j){D(j)}};setImmediateImpl(q)}))}function colorDistanceFormulaToColorDistance$1(d="euclidean-bt709"){switch(d){case"cie94-graphic-arts":return new CIE94GraphicArts$1;case"cie94-textiles":return new CIE94Textiles$1;case"ciede2000":return new CIEDE2000$1;case"color-metric":return new CMetric$1;case"euclidean":return new Euclidean$1;case"euclidean-bt709":return new EuclideanBT709$1;case"euclidean-bt709-noalpha":return new EuclideanBT709NoAlpha$1;case"manhattan":return new Manhattan$1;case"manhattan-bt709":return new ManhattanBT709$1;case"manhattan-nommyde":return new ManhattanNommyde$1;case"pngquant":return new PNGQuant$1;default:throw new Error(`Unknown colorDistanceFormula ${d}`)}}function imageQuantizationToImageQuantizer$1(d,m="floyd-steinberg"){switch(m){case"nearest":return new NearestColor$1(d);case"riemersma":return new ErrorDiffusionRiemersma$1(d);case"floyd-steinberg":return new ErrorDiffusionArray$1(d,0);case"false-floyd-steinberg":return new ErrorDiffusionArray$1(d,1);case"stucki":return new ErrorDiffusionArray$1(d,2);case"atkinson":return new ErrorDiffusionArray$1(d,3);case"jarvis":return new ErrorDiffusionArray$1(d,4);case"burkes":return new ErrorDiffusionArray$1(d,5);case"sierra":return new ErrorDiffusionArray$1(d,6);case"two-sierra":return new ErrorDiffusionArray$1(d,7);case"sierra-lite":return new ErrorDiffusionArray$1(d,8);default:throw new Error(`Unknown imageQuantization ${m}`)}}function paletteQuantizationToPaletteQuantizer$1(d,m="wuquant",g=256){switch(m){case"neuquant":return new NeuQuant$1(d,g);case"rgbquant":return new RGBQuant$1(d,g);case"wuquant":return new WuQuant$1(d,g);case"neuquant-float":return new NeuQuantFloat$1(d,g);default:throw new Error(`Unknown paletteQuantization ${m}`)}}var imageQ=__toCommonJS(src_exports),gifframe={};const BitmapImage$1=bitmapimage;let GifFrame$1=class xc extends BitmapImage$1{constructor(...m){if(super(...m),m[0]instanceof xc){const g=m[0];this.xOffset=g.xOffset,this.yOffset=g.yOffset,this.disposalMethod=g.disposalMethod,this.delayCentisecs=g.delayCentisecs,this.interlaced=g.interlaced}else{const g=m[m.length-1];let w={};typeof g!="object"||g instanceof BitmapImage$1||(w=g),this.xOffset=w.xOffset||0,this.yOffset=w.yOffset||0,this.disposalMethod=w.disposalMethod!==void 0?w.disposalMethod:xc.DisposeToBackgroundColor,this.delayCentisecs=w.delayCentisecs||8,this.interlaced=w.interlaced||!1}}getPalette(){const m=new Set,g=this.bitmap.data;let w=0,$=!1;for(;w<g.length;){if(g[w+3]===0)$=!0;else{const U=g.readUInt32BE(w,!0)>>8&16777215;m.add(U)}w+=4}const I=new Array(m.size),D=m.values();for(w=0;w<I.length;++w)I[w]=D.next().value;I.sort(((U,q)=>U-q));let F=I.length;return $&&++F,{colors:I,usesTransparency:$,indexCount:F}}};var hasRequiredGifutil,hasRequiredGifcodec;function requireGifutil(){return hasRequiredGifutil||(hasRequiredGifutil=1,(function(d){const m=require$$0,g=imageQ,w=bitmapimage,{GifFrame:$}=gifframe,{GifError:I}=gif$1,{GifCodec:D}=requireGifcodec(),F=[".jpg",".jpeg",".png",".bmp"],U=new D;function q(j,G,H,V,Z){const Q=Array.isArray(j)?j:[j];if(Z){if(["FloydSteinberg","FalseFloydSteinberg","Stucki","Atkinson","Jarvis","Burkes","Sierra","TwoSierra","SierraLite"].indexOf(Z.ditherAlgorithm)<0)throw new Error(`Invalid ditherAlgorithm '${Z.ditherAlgorithm}'`);Z.serpentine===void 0&&(Z.serpentine=!0),Z.minimumColorDistanceToDither===void 0&&(Z.minimumColorDistanceToDither=0),Z.calculateErrorLikeGIMP===void 0&&(Z.calculateErrorLikeGIMP=!1)}const J=new g.distance.Euclidean,ie=new g.palette[G](J,H,V);let re;re=Z?new g.image.ErrorDiffusionArray(J,g.image.ErrorDiffusionArrayKernel[Z.ditherAlgorithm],Z.serpentine,Z.minimumColorDistanceToDither,Z.calculateErrorLikeGIMP):new g.image.NearestColor(J);const se=[];Q.forEach((ne=>{const ce=ne.bitmap.data,oe=new ArrayBuffer(ce.length),de=new Uint32Array(oe);for(let ge=0,fe=0;ge<ce.length;ge+=4,++fe)de[fe]=ce.readUInt32LE(ge,!0);const me=g.utils.PointContainer.fromUint32Array(de,ne.bitmap.width,ne.bitmap.height);ie.sample(me),se.push(me)}));const X=ie.quantizeSync();for(let ne=0;ne<Q.length;++ne){const ce=Q[ne].bitmap.data,oe=re.quantizeSync(se[ne],X).toUint32Array();for(let de=0,me=0;de<ce.length;de+=4,++me)ce.writeUInt32LE(oe[me],de)}}d.cloneFrames=function(j){let G=[];return j.forEach((H=>{G.push(new $(H))})),G},d.getColorInfo=function(j,G){let H=!1;const V=[];for(let re=0;re<j.length;++re){let se=j[re].getPalette();if(se.usesTransparency&&(H=!0),se.indexCount>256)throw new I(`Frame ${re} uses more than 256 color indexes`);V.push(se)}if(G===0)return{usesTransparency:H,palettes:V};const Z=new Set;V.forEach((re=>{re.colors.forEach((se=>{Z.add(se)}))}));let Q=Z.size;if(H&&++Q,G&&Q>G)return{usesTransparency:H,palettes:V};const J=new Array(Z.size),ie=Z.values();for(let re=0;re<J.length;++re)J[re]=ie.next().value;return J.sort(((re,se)=>re-se)),{colors:J,indexCount:Q,usesTransparency:H,palettes:V}},d.copyAsJimp=function(j,G){return d.shareAsJimp(j,new w(G))},d.getMaxDimensions=function(j){let G=0,H=0;return j.forEach((V=>{const Z=V.xOffset+V.bitmap.width;Z>G&&(G=Z);const Q=V.yOffset+V.bitmap.height;Q>H&&(H=Q)})),{maxWidth:G,maxHeight:H}},d.quantizeDekker=function(j,G,H){q(j,"NeuQuantFloat",G=G||256,0,H)},d.quantizeSorokin=function(j,G,H,V){let Z;switch(G=G||256,H=H||"min-pop"){case"min-pop":Z=2;break;case"top-pop":Z=1;break;default:throw new Error(`Invalid quantizeSorokin histogram '${H}'`)}q(j,"RGBQuant",G,Z,V)},d.quantizeWu=function(j,G,H,V){if(G=G||256,(H=H||5)<1||H>8)throw new Error("Invalid quantization quality");q(j,"WuQuant",G,H,V)},d.read=function(j,G){return G=G||U,Buffer.isBuffer(j)?G.decodeGif(j):(function(H){return new Promise(((V,Z)=>{m.readFile(H,((Q,J)=>Q?Z(Q):V(J)))}))})(j).then((H=>G.decodeGif(H)))},d.shareAsJimp=function(j,G){const H=new j(G.bitmap.width,G.bitmap.height,0);return H.bitmap.data=G.bitmap.data,H},d.write=function(j,G,H,V){V=V||U;const Z=j.match(/\.[a-zA-Z]+$/);if(Z!==null&&F.includes(Z[0].toLowerCase()))throw new Error(`GIF '${j}' has an unexpected suffix`);return V.encodeGif(G,H).then((Q=>(function(J,ie){return new Promise(((re,se)=>{m.writeFile(J,ie,(X=>X?se(X):re()))}))})(j,Q.buffer).then((()=>Q))))}})(gifutil)),gifutil}function requireGifcodec(){if(hasRequiredGifcodec)return gifcodec;hasRequiredGifcodec=1;const d=omggif,{Gif:m,GifError:g}=gif$1;function w(){const G=requireGifutil();return w=function(){return G},G}const{GifFrame:$}=gifframe;function I(G,H){const V=G.indexOf(H);return V===-1?null:V}function D(G,H){for(var V,Z=0,Q=G.length-1;Z<=Q;)if(G[V=Math.floor((Z+Q)/2)]>H)Q=V-1;else{if(!(G[V]<H))return V;Z=V+1}return null}function F(G){const H=G.colors;G.usesTransparency&&H.push(0);const V=H.length;let Z=2;for(;V>Z;)Z<<=1;H.length=Z,H.fill(0,V)}function U(G,H){let V=G.bitmap.width*G.bitmap.height;return V=Math.ceil(V*H/8),V+=Math.ceil(V/255),100+V+768}function q(G){let H=G.indexCount,V=0;for(--H;H;)++V,H>>=1;return V>0?V:1}function j(G,H,V,Z,Q){if(V.interlaced)throw new g("writing interlaced GIFs is not supported");const J=(function(re,se,X){const ne=X.colors,ce=ne.length<=8?I:D,oe=se.bitmap.data,de=new Buffer(oe.length/4);let me=ne.length,ge=0,fe=0;for(;ge<oe.length;){if(oe[ge+3]!==0){const xe=oe.readUInt32BE(ge,!0)>>8&16777215;de[fe]=ce(ne,xe)}else de[fe]=me;ge+=4,++fe}if(X.usesTransparency){if(me===256)throw new g(`Frame ${re} already has 256 colorsand so can't use transparency`)}else me=null;return{buffer:de,transparentIndex:me}})(H,V,Z),ie={delay:V.delayCentisecs,disposal:V.disposalMethod,transparent:J.transparentIndex};Q&&(F(Z),ie.palette=Z.colors);try{let re,se=G.getOutputBuffer(),X=G.getOutputBufferPosition(),ne=!0;for(;ne;)if(re=G.addFrame(V.xOffset,V.yOffset,V.bitmap.width,V.bitmap.height,J.buffer,ie),ne=!1,re>=se.length-1){const ce=new Buffer(1.5*se.length);se.copy(ce),G.setOutputBuffer(ce),G.setOutputBufferPosition(X),se=ce,ne=!0}return se}catch(re){throw new g(re)}}return gifcodec.GifCodec=class{constructor(G={}){this._transparentRGB=null,typeof G.transparentRGB=="number"&&G.transparentRGB!==0&&(this._transparentRGBA=256*G.transparentRGB),this._testInitialBufferSize=0}decodeGif(G){try{let H;try{H=new d.GifReader(G)}catch(J){throw new g(J)}const V=H.numFrames(),Z=[],Q={width:H.width,height:H.height,loops:H.loopCount(),usesTransparency:!1};for(let J=0;J<V;++J){const ie=this._decodeFrame(H,J,Q.usesTransparency);Z.push(ie.frame),ie.usesTransparency&&(Q.usesTransparency=!0)}return Promise.resolve(new m(G,Z,Q))}catch(H){return Promise.reject(H)}}encodeGif(G,H={}){try{if(G===null||G.length===0)throw new g("there are no frames");const V=w().getMaxDimensions(G);return(H=Object.assign({},H)).width=V.maxWidth,H.height=V.maxHeight,H.loops===void 0&&(H.loops=0),H.colorScope=H.colorScope||m.GlobalColorsPreferred,Promise.resolve(this._encodeGif(G,H))}catch(V){return Promise.reject(V)}}_decodeFrame(G,H,V){let Z,Q;try{if(Z=G.frameInfo(H),Q=new Buffer(G.width*G.height*4),G.decodeAndBlitFrameRGBA(H,Q),Z.width!==G.width||Z.height!==G.height){if(Z.y&&(Q=Q.slice(Z.y*G.width*4)),G.width>Z.width)for(let ie=0;ie<Z.height;++ie)Q.copy(Q,ie*Z.width*4,4*(Z.x+ie*G.width),4*(Z.x+ie*G.width)+4*Z.width);Q=Q.slice(0,Z.width*Z.height*4)}}catch(ie){throw new g(ie)}let J=!1;if(this._transparentRGBA===null){if(!V)for(let ie=3;ie<Q.length;ie+=4)Q[ie]===0&&(J=!0,ie=Q.length)}else for(let ie=3;ie<Q.length;ie+=4)Q[ie]===0&&(Q.writeUInt32BE(this._transparentRGBA,ie-3),J=!0);return{frame:new $(Z.width,Z.height,Q,{xOffset:Z.x,yOffset:Z.y,disposalMethod:Z.disposal,interlaced:Z.interlaced,delayCentisecs:Z.delay}),usesTransparency:J}}_encodeGif(G,H){let V;if(H.colorScope===m.LocalColorsOnly)V=w().getColorInfo(G,0);else if(V=w().getColorInfo(G,256),!V.colors){if(H.colorScope===m.GlobalColorsOnly)throw new g("Too many color indexes for global color table");H.colorScope=m.LocalColorsOnly}H.usesTransparency=V.usesTransparency;const Z=V.palettes;return H.colorScope===m.LocalColorsOnly?(function(Q,J,ie,re){const se={loop:J.loops};let X,ne=new Buffer(ie);try{X=new d.GifWriter(ne,J.width,J.height,se)}catch(ce){throw new g(ce)}for(let ce=0;ce<Q.length;++ce)ne=j(X,ce,Q[ce],re[ce],!0);return new m(ne.slice(0,X.end()),Q,J)})(G,H,2e3,Z):(function(Q,J,ie,re){const se={colors:re.colors.slice(),usesTransparency:re.usesTransparency};F(se);const X={palette:se.colors,loop:J.loops};let ne,ce=new Buffer(ie);try{ne=new d.GifWriter(ce,J.width,J.height,X)}catch(oe){throw new g(oe)}for(let oe=0;oe<Q.length;++oe)ce=j(ne,oe,Q[oe],re,!1);return new m(ce.slice(0,ne.end()),Q,J)})(G,H,2e3,V)}_getSizeEstimateGlobal(G,H){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let V=968;const Z=q(G);return H.forEach((Q=>{V+=U(Q,Z)})),V}_getSizeEstimateLocal(G,H){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let V=200;for(let Z=0;Z<H.length;++Z){const Q=q(G[Z]);V+=U(H[Z],Q)}return V}},gifcodec}GifFrame$1.DisposeToAnything=0,GifFrame$1.DisposeNothing=1,GifFrame$1.DisposeToBackgroundColor=2,GifFrame$1.DisposeToPrevious=3,gifframe.GifFrame=GifFrame$1;const BitmapImage=bitmapimage,{GifCodec}=requireGifcodec(),{GifFrame}=gifframe,GifUtil=requireGifutil();var src={BitmapImage,GifCodec,GifFrame,GifUtil};function gif(){return{mime:"image/gif",encode:async d=>{const m=new src.BitmapImage(d);src.GifUtil.quantizeDekker(m,256);const g=new src.GifFrame(d);return(await new src.GifCodec().encodeGif([g],{})).buffer},decode:d=>{const m=new omggif.GifReader(d),g=Buffer.alloc(m.width*m.height*4);return m.decodeAndBlitFrameRGBA(0,g),{data:g,width:m.width,height:m.height}}}}var encoder={exports:{}};(function(d){function m(g){var w,$,I,D,F,U=Math.floor,q=new Array(64),j=new Array(64),G=new Array(64),H=new Array(64),V=new Array(65535),Z=new Array(65535),Q=new Array(64),J=new Array(64),ie=[],re=0,se=7,X=new Array(64),ne=new Array(64),ce=new Array(64),oe=new Array(256),de=new Array(2048),me=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],ge=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],fe=[0,1,2,3,4,5,6,7,8,9,10,11],xe=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Fe=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Te=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Oe=[0,1,2,3,4,5,6,7,8,9,10,11],Be=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],_t=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Et(Vt,ut){for(var At=0,dr=0,fr=new Array,pr=1;pr<=16;pr++){for(var zt=1;zt<=Vt[pr];zt++)fr[ut[dr]]=[],fr[ut[dr]][0]=At,fr[ut[dr]][1]=pr,dr++,At++;At*=2}return fr}function dt(Vt){for(var ut=Vt[0],At=Vt[1]-1;At>=0;)ut&1<<At&&(re|=1<<se),At--,--se<0&&(re==255?(Zt(255),Zt(0)):Zt(re),se=7,re=0)}function Zt(Vt){ie.push(Vt)}function Ye(Vt){Zt(Vt>>8&255),Zt(255&Vt)}function bt(Vt,ut,At,dr,fr){for(var pr,zt=fr[0],Ce=fr[240],Nt=(function(ht,gr){var yr,li,fi,ai,hi,ui,vi,bi,_i,ki,yi=0;for(_i=0;_i<8;++_i){yr=ht[yi],li=ht[yi+1],fi=ht[yi+2],ai=ht[yi+3],hi=ht[yi+4],ui=ht[yi+5],vi=ht[yi+6];var cr=yr+(bi=ht[yi+7]),di=yr-bi,br=li+vi,ii=li-vi,It=fi+ui,si=fi-ui,Ei=ai+hi,Ue=ai-hi,ni=cr+Ei,_r=cr-Ei,hr=br+It,ei=br-It;ht[yi]=ni+hr,ht[yi+4]=ni-hr;var ri=.707106781*(ei+_r);ht[yi+2]=_r+ri,ht[yi+6]=_r-ri;var xi=.382683433*((ni=Ue+si)-(ei=ii+di)),gi=.5411961*ni+xi,wi=1.306562965*ei+xi,Ii=.707106781*(hr=si+ii),Ui=di+Ii,Ti=di-Ii;ht[yi+5]=Ti+gi,ht[yi+3]=Ti-gi,ht[yi+1]=Ui+wi,ht[yi+7]=Ui-wi,yi+=8}for(yi=0,_i=0;_i<8;++_i){yr=ht[yi],li=ht[yi+8],fi=ht[yi+16],ai=ht[yi+24],hi=ht[yi+32],ui=ht[yi+40],vi=ht[yi+48];var Mi=yr+(bi=ht[yi+56]),Di=yr-bi,Bi=li+vi,Vi=li-vi,Ki=fi+ui,Ni=fi-ui,Oi=ai+hi,qi=ai-hi,zi=Mi+Oi,Ri=Mi-Oi,Pi=Bi+Ki,yn=Bi-Ki;ht[yi]=zi+Pi,ht[yi+32]=zi-Pi;var Cn=.707106781*(yn+Ri);ht[yi+16]=Ri+Cn,ht[yi+48]=Ri-Cn;var Wi=.382683433*((zi=qi+Ni)-(yn=Vi+Di)),Tn=.5411961*zi+Wi,Sn=1.306562965*yn+Wi,Gi=.707106781*(Pi=Ni+Vi),En=Di+Gi,Fi=Di-Gi;ht[yi+40]=Fi+Tn,ht[yi+24]=Fi-Tn,ht[yi+8]=En+Sn,ht[yi+56]=En-Sn,yi++}for(_i=0;_i<64;++_i)ki=ht[_i]*gr[_i],Q[_i]=ki>0?ki+.5|0:ki-.5|0;return Q})(Vt,ut),Xe=0;Xe<64;++Xe)J[me[Xe]]=Nt[Xe];var lt=J[0]-At;At=J[0],lt==0?dt(dr[0]):(dt(dr[Z[pr=32767+lt]]),dt(V[pr]));for(var st=63;st>0&&J[st]==0;st--);if(st==0)return dt(zt),At;for(var yt,Yt=1;Yt<=st;){for(var $e=Yt;J[Yt]==0&&Yt<=st;++Yt);var ze=Yt-$e;if(ze>=16){yt=ze>>4;for(var ft=1;ft<=yt;++ft)dt(Ce);ze&=15}pr=32767+J[Yt],dt(fr[(ze<<4)+Z[pr]]),dt(V[pr]),Yt++}return st!=63&&dt(zt),At}function Qt(Vt){Vt<=0&&(Vt=1),Vt>100&&(Vt=100),F!=Vt&&((function(ut){for(var At=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],dr=0;dr<64;dr++){var fr=U((At[dr]*ut+50)/100);fr<1?fr=1:fr>255&&(fr=255),q[me[dr]]=fr}for(var pr=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],zt=0;zt<64;zt++){var Ce=U((pr[zt]*ut+50)/100);Ce<1?Ce=1:Ce>255&&(Ce=255),j[me[zt]]=Ce}for(var Nt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Xe=0,lt=0;lt<8;lt++)for(var st=0;st<8;st++)G[Xe]=1/(q[me[Xe]]*Nt[lt]*Nt[st]*8),H[Xe]=1/(j[me[Xe]]*Nt[lt]*Nt[st]*8),Xe++})(Vt<50?Math.floor(5e3/Vt):Math.floor(200-2*Vt)),F=Vt)}this.encode=function(Vt,ut){var At;new Date().getTime(),ut&&Qt(ut),ie=new Array,re=0,se=7,Ye(65496),Ye(65504),Ye(16),Zt(74),Zt(70),Zt(73),Zt(70),Zt(0),Zt(1),Zt(1),Zt(0),Ye(1),Ye(1),Zt(0),Zt(0),(At=Vt.comments)!==void 0&&At.constructor===Array&&At.forEach((fi=>{if(typeof fi=="string"){Ye(65534);var ai,hi=fi.length;for(Ye(hi+2),ai=0;ai<hi;ai++)Zt(fi.charCodeAt(ai))}})),(function(fi){if(fi){Ye(65505),fi[0]===69&&fi[1]===120&&fi[2]===105&&fi[3]===102?Ye(fi.length+2):(Ye(fi.length+5+2),Zt(69),Zt(120),Zt(105),Zt(102),Zt(0));for(var ai=0;ai<fi.length;ai++)Zt(fi[ai])}})(Vt.exifBuffer),(function(){Ye(65499),Ye(132),Zt(0);for(var fi=0;fi<64;fi++)Zt(q[fi]);Zt(1);for(var ai=0;ai<64;ai++)Zt(j[ai])})(),(function(fi,ai){Ye(65472),Ye(17),Zt(8),Ye(ai),Ye(fi),Zt(3),Zt(1),Zt(17),Zt(0),Zt(2),Zt(17),Zt(1),Zt(3),Zt(17),Zt(1)})(Vt.width,Vt.height),(function(){Ye(65476),Ye(418),Zt(0);for(var fi=0;fi<16;fi++)Zt(ge[fi+1]);for(var ai=0;ai<=11;ai++)Zt(fe[ai]);Zt(16);for(var hi=0;hi<16;hi++)Zt(xe[hi+1]);for(var ui=0;ui<=161;ui++)Zt(Fe[ui]);Zt(1);for(var vi=0;vi<16;vi++)Zt(Te[vi+1]);for(var bi=0;bi<=11;bi++)Zt(Oe[bi]);Zt(17);for(var _i=0;_i<16;_i++)Zt(Be[_i+1]);for(var ki=0;ki<=161;ki++)Zt(_t[ki])})(),Ye(65498),Ye(12),Zt(3),Zt(1),Zt(0),Zt(2),Zt(17),Zt(3),Zt(17),Zt(0),Zt(63),Zt(0);var dr=0,fr=0,pr=0;re=0,se=7,this.encode.displayName="_encode_";for(var zt,Ce,Nt,Xe,lt,st,yt,Yt,$e,ze=Vt.data,ft=Vt.width,ht=Vt.height,gr=4*ft,yr=0;yr<ht;){for(zt=0;zt<gr;){for(st=lt=gr*yr+zt,yt=-1,Yt=0,$e=0;$e<64;$e++)st=lt+(Yt=$e>>3)*gr+(yt=4*(7&$e)),yr+Yt>=ht&&(st-=gr*(yr+1+Yt-ht)),zt+yt>=gr&&(st-=zt+yt-gr+4),Ce=ze[st++],Nt=ze[st++],Xe=ze[st++],X[$e]=(de[Ce]+de[Nt+256|0]+de[Xe+512|0]>>16)-128,ne[$e]=(de[Ce+768|0]+de[Nt+1024|0]+de[Xe+1280|0]>>16)-128,ce[$e]=(de[Ce+1280|0]+de[Nt+1536|0]+de[Xe+1792|0]>>16)-128;dr=bt(X,G,dr,w,I),fr=bt(ne,H,fr,$,D),pr=bt(ce,H,pr,$,D),zt+=32}yr+=8}if(se>=0){var li=[];li[1]=se+1,li[0]=(1<<se+1)-1,dt(li)}return Ye(65497),Buffer.from(ie)},new Date().getTime(),g||(g=50),(function(){for(var Vt=String.fromCharCode,ut=0;ut<256;ut++)oe[ut]=Vt(ut)})(),w=Et(ge,fe),$=Et(Te,Oe),I=Et(xe,Fe),D=Et(Be,_t),(function(){for(var Vt=1,ut=2,At=1;At<=15;At++){for(var dr=Vt;dr<ut;dr++)Z[32767+dr]=At,V[32767+dr]=[],V[32767+dr][1]=At,V[32767+dr][0]=dr;for(var fr=-(ut-1);fr<=-Vt;fr++)Z[32767+fr]=At,V[32767+fr]=[],V[32767+fr][1]=At,V[32767+fr][0]=ut-1+fr;Vt<<=1,ut<<=1}})(),(function(){for(var Vt=0;Vt<256;Vt++)de[Vt]=19595*Vt,de[Vt+256|0]=38470*Vt,de[Vt+512|0]=7471*Vt+32768,de[Vt+768|0]=-11059*Vt,de[Vt+1024|0]=-21709*Vt,de[Vt+1280|0]=32768*Vt+8421375,de[Vt+1536|0]=-27439*Vt,de[Vt+1792|0]=-5329*Vt})(),Qt(g),new Date().getTime()}encoder.exports=function(g,w){w===void 0&&(w=50);var $=new m(w),I=$.encode(g,w);return{data:I,width:g.width,height:g.height}}})();var encoderExports=encoder.exports,decoder={exports:{}},module,JpegImage;module=decoder,JpegImage=(function(){var d=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),m=4017,g=799,w=3406,$=2276,I=1567,D=3784,F=5793,U=2896;function q(){}function j(ie,re){for(var se,X,ne=0,ce=[],oe=16;oe>0&&!ie[oe-1];)oe--;ce.push({children:[],index:0});var de,me=ce[0];for(se=0;se<oe;se++){for(X=0;X<ie[se];X++){for((me=ce.pop()).children[me.index]=re[ne];me.index>0;){if(ce.length===0)throw new Error("Could not recreate Huffman Table");me=ce.pop()}for(me.index++,ce.push(me);ce.length<=se;)ce.push(de={children:[],index:0}),me.children[me.index]=de.children,me=de;ne++}se+1<oe&&(ce.push(de={children:[],index:0}),me.children[me.index]=de.children,me=de)}return ce[0].children}function G(ie,re,se,X,ne,ce,oe,de,me,ge){se.precision,se.samplesPerLine,se.scanLines;var fe=se.mcusPerLine,xe=se.progressive;se.maxH,se.maxV;var Fe=re,Te=0,Oe=0;function Be(){if(Oe>0)return Oe--,Te>>Oe&1;if((Te=ie[re++])==255){var Yt=ie[re++];if(Yt)throw new Error("unexpected marker: "+(Te<<8|Yt).toString(16))}return Oe=7,Te>>>7}function _t(Yt){for(var $e,ze=Yt;($e=Be())!==null;){if(typeof(ze=ze[$e])=="number")return ze;if(typeof ze!="object")throw new Error("invalid huffman sequence")}return null}function Et(Yt){for(var $e=0;Yt>0;){var ze=Be();if(ze===null)return;$e=$e<<1|ze,Yt--}return $e}function dt(Yt){var $e=Et(Yt);return $e>=1<<Yt-1?$e:$e+(-1<<Yt)+1}var Zt,Ye=0,bt=0;function Qt(Yt,$e,ze,ft,ht){var gr=ze%fe,yr=(ze/fe|0)*Yt.v+ft,li=gr*Yt.h+ht;Yt.blocks[yr]===void 0&&ge.tolerantDecoding||$e(Yt,Yt.blocks[yr][li])}function Vt(Yt,$e,ze){var ft=ze/Yt.blocksPerLine|0,ht=ze%Yt.blocksPerLine;Yt.blocks[ft]===void 0&&ge.tolerantDecoding||$e(Yt,Yt.blocks[ft][ht])}var ut,At,dr,fr,pr,zt,Ce=X.length;zt=xe?ce===0?de===0?function(Yt,$e){var ze=_t(Yt.huffmanTableDC),ft=ze===0?0:dt(ze)<<me;$e[0]=Yt.pred+=ft}:function(Yt,$e){$e[0]|=Be()<<me}:de===0?function(Yt,$e){if(Ye>0)Ye--;else for(var ze=ce,ft=oe;ze<=ft;){var ht=_t(Yt.huffmanTableAC),gr=15&ht,yr=ht>>4;if(gr!==0)$e[d[ze+=yr]]=dt(gr)*(1<<me),ze++;else{if(yr<15){Ye=Et(yr)+(1<<yr)-1;break}ze+=16}}}:function(Yt,$e){for(var ze=ce,ft=oe,ht=0;ze<=ft;){var gr=d[ze],yr=$e[gr]<0?-1:1;switch(bt){case 0:var li=_t(Yt.huffmanTableAC),fi=15&li;if(ht=li>>4,fi===0)ht<15?(Ye=Et(ht)+(1<<ht),bt=4):(ht=16,bt=1);else{if(fi!==1)throw new Error("invalid ACn encoding");Zt=dt(fi),bt=ht?2:3}continue;case 1:case 2:$e[gr]?$e[gr]+=(Be()<<me)*yr:--ht==0&&(bt=bt==2?3:0);break;case 3:$e[gr]?$e[gr]+=(Be()<<me)*yr:($e[gr]=Zt<<me,bt=0);break;case 4:$e[gr]&&($e[gr]+=(Be()<<me)*yr)}ze++}bt===4&&--Ye==0&&(bt=0)}:function(Yt,$e){var ze=_t(Yt.huffmanTableDC),ft=ze===0?0:dt(ze);$e[0]=Yt.pred+=ft;for(var ht=1;ht<64;){var gr=_t(Yt.huffmanTableAC),yr=15&gr,li=gr>>4;if(yr!==0)$e[d[ht+=li]]=dt(yr),ht++;else{if(li<15)break;ht+=16}}};var Nt,Xe,lt,st,yt=0;for(Xe=Ce==1?X[0].blocksPerLine*X[0].blocksPerColumn:fe*se.mcusPerColumn,ne||(ne=Xe);yt<Xe;){for(At=0;At<Ce;At++)X[At].pred=0;if(Ye=0,Ce==1)for(ut=X[0],pr=0;pr<ne;pr++)Vt(ut,zt,yt),yt++;else for(pr=0;pr<ne;pr++){for(At=0;At<Ce;At++)for(lt=(ut=X[At]).h,st=ut.v,dr=0;dr<st;dr++)for(fr=0;fr<lt;fr++)Qt(ut,zt,yt,dr,fr);if(++yt===Xe)break}if(yt===Xe)do{if(ie[re]===255&&ie[re+1]!==0)break;re+=1}while(re<ie.length-2);if(Oe=0,(Nt=ie[re]<<8|ie[re+1])<65280)throw new Error("marker was not found");if(!(Nt>=65488&&Nt<=65495))break;re+=2}return re-Fe}function H(ie,re){var se,X,ne=[],ce=re.blocksPerLine,oe=re.blocksPerColumn,de=ce<<3,me=new Int32Array(64),ge=new Uint8Array(64);function fe(Et,dt,Zt){var Ye,bt,Qt,Vt,ut,At,dr,fr,pr,zt,Ce=re.quantizationTable,Nt=Zt;for(zt=0;zt<64;zt++)Nt[zt]=Et[zt]*Ce[zt];for(zt=0;zt<8;++zt){var Xe=8*zt;Nt[1+Xe]!=0||Nt[2+Xe]!=0||Nt[3+Xe]!=0||Nt[4+Xe]!=0||Nt[5+Xe]!=0||Nt[6+Xe]!=0||Nt[7+Xe]!=0?(Ye=F*Nt[0+Xe]+128>>8,bt=F*Nt[4+Xe]+128>>8,Qt=Nt[2+Xe],Vt=Nt[6+Xe],ut=U*(Nt[1+Xe]-Nt[7+Xe])+128>>8,fr=U*(Nt[1+Xe]+Nt[7+Xe])+128>>8,At=Nt[3+Xe]<<4,dr=Nt[5+Xe]<<4,pr=Ye-bt+1>>1,Ye=Ye+bt+1>>1,bt=pr,pr=Qt*D+Vt*I+128>>8,Qt=Qt*I-Vt*D+128>>8,Vt=pr,pr=ut-dr+1>>1,ut=ut+dr+1>>1,dr=pr,pr=fr+At+1>>1,At=fr-At+1>>1,fr=pr,pr=Ye-Vt+1>>1,Ye=Ye+Vt+1>>1,Vt=pr,pr=bt-Qt+1>>1,bt=bt+Qt+1>>1,Qt=pr,pr=ut*$+fr*w+2048>>12,ut=ut*w-fr*$+2048>>12,fr=pr,pr=At*g+dr*m+2048>>12,At=At*m-dr*g+2048>>12,dr=pr,Nt[0+Xe]=Ye+fr,Nt[7+Xe]=Ye-fr,Nt[1+Xe]=bt+dr,Nt[6+Xe]=bt-dr,Nt[2+Xe]=Qt+At,Nt[5+Xe]=Qt-At,Nt[3+Xe]=Vt+ut,Nt[4+Xe]=Vt-ut):(pr=F*Nt[0+Xe]+512>>10,Nt[0+Xe]=pr,Nt[1+Xe]=pr,Nt[2+Xe]=pr,Nt[3+Xe]=pr,Nt[4+Xe]=pr,Nt[5+Xe]=pr,Nt[6+Xe]=pr,Nt[7+Xe]=pr)}for(zt=0;zt<8;++zt){var lt=zt;Nt[8+lt]!=0||Nt[16+lt]!=0||Nt[24+lt]!=0||Nt[32+lt]!=0||Nt[40+lt]!=0||Nt[48+lt]!=0||Nt[56+lt]!=0?(Ye=F*Nt[0+lt]+2048>>12,bt=F*Nt[32+lt]+2048>>12,Qt=Nt[16+lt],Vt=Nt[48+lt],ut=U*(Nt[8+lt]-Nt[56+lt])+2048>>12,fr=U*(Nt[8+lt]+Nt[56+lt])+2048>>12,At=Nt[24+lt],dr=Nt[40+lt],pr=Ye-bt+1>>1,Ye=Ye+bt+1>>1,bt=pr,pr=Qt*D+Vt*I+2048>>12,Qt=Qt*I-Vt*D+2048>>12,Vt=pr,pr=ut-dr+1>>1,ut=ut+dr+1>>1,dr=pr,pr=fr+At+1>>1,At=fr-At+1>>1,fr=pr,pr=Ye-Vt+1>>1,Ye=Ye+Vt+1>>1,Vt=pr,pr=bt-Qt+1>>1,bt=bt+Qt+1>>1,Qt=pr,pr=ut*$+fr*w+2048>>12,ut=ut*w-fr*$+2048>>12,fr=pr,pr=At*g+dr*m+2048>>12,At=At*m-dr*g+2048>>12,dr=pr,Nt[0+lt]=Ye+fr,Nt[56+lt]=Ye-fr,Nt[8+lt]=bt+dr,Nt[48+lt]=bt-dr,Nt[16+lt]=Qt+At,Nt[40+lt]=Qt-At,Nt[24+lt]=Vt+ut,Nt[32+lt]=Vt-ut):(pr=F*Zt[zt+0]+8192>>14,Nt[0+lt]=pr,Nt[8+lt]=pr,Nt[16+lt]=pr,Nt[24+lt]=pr,Nt[32+lt]=pr,Nt[40+lt]=pr,Nt[48+lt]=pr,Nt[56+lt]=pr)}for(zt=0;zt<64;++zt){var st=128+(Nt[zt]+8>>4);dt[zt]=st<0?0:st>255?255:st}}J(de*oe*8);for(var xe=0;xe<oe;xe++){var Fe=xe<<3;for(se=0;se<8;se++)ne.push(new Uint8Array(de));for(var Te=0;Te<ce;Te++){fe(re.blocks[xe][Te],ge,me);var Oe=0,Be=Te<<3;for(X=0;X<8;X++){var _t=ne[Fe+X];for(se=0;se<8;se++)_t[Be+se]=ge[Oe++]}}}return ne}function V(ie){return ie<0?0:ie>255?255:ie}q.prototype={load:function(ie){var re=new XMLHttpRequest;re.open("GET",ie,!0),re.responseType="arraybuffer",re.onload=(function(){var se=new Uint8Array(re.response||re.mozResponseArrayBuffer);this.parse(se),this.onload&&this.onload()}).bind(this),re.send(null)},parse:function(ie){var re=1e3*this.opts.maxResolutionInMP*1e3,se=0;function X(){var ai=ie[se]<<8|ie[se+1];return se+=2,ai}function ne(ai){var hi,ui,vi=1,bi=1;for(ui in ai.components)ai.components.hasOwnProperty(ui)&&(vi<(hi=ai.components[ui]).h&&(vi=hi.h),bi<hi.v&&(bi=hi.v));var _i=Math.ceil(ai.samplesPerLine/8/vi),ki=Math.ceil(ai.scanLines/8/bi);for(ui in ai.components)if(ai.components.hasOwnProperty(ui)){hi=ai.components[ui];var yi=Math.ceil(Math.ceil(ai.samplesPerLine/8)*hi.h/vi),cr=Math.ceil(Math.ceil(ai.scanLines/8)*hi.v/bi),di=_i*hi.h,br=ki*hi.v,ii=[];J(br*di*256);for(var It=0;It<br;It++){for(var si=[],Ei=0;Ei<di;Ei++)si.push(new Int32Array(64));ii.push(si)}hi.blocksPerLine=yi,hi.blocksPerColumn=cr,hi.blocks=ii}ai.maxH=vi,ai.maxV=bi,ai.mcusPerLine=_i,ai.mcusPerColumn=ki}ie.length;var ce,oe,de,me,ge=null,fe=null,xe=[],Fe=[],Te=[],Oe=[],Be=X(),_t=-1;if(this.comments=[],Be!=65496)throw new Error("SOI not found");for(Be=X();Be!=65497;){switch(Be){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Et=(de=void 0,me=void 0,de=X(),me=ie.subarray(se,se+de-2),se+=me.length,me);if(Be===65534){var dt=String.fromCharCode.apply(null,Et);this.comments.push(dt)}Be===65504&&Et[0]===74&&Et[1]===70&&Et[2]===73&&Et[3]===70&&Et[4]===0&&(ge={version:{major:Et[5],minor:Et[6]},densityUnits:Et[7],xDensity:Et[8]<<8|Et[9],yDensity:Et[10]<<8|Et[11],thumbWidth:Et[12],thumbHeight:Et[13],thumbData:Et.subarray(14,14+3*Et[12]*Et[13])}),Be===65505&&Et[0]===69&&Et[1]===120&&Et[2]===105&&Et[3]===102&&Et[4]===0&&(this.exifBuffer=Et.subarray(5,Et.length)),Be===65518&&Et[0]===65&&Et[1]===100&&Et[2]===111&&Et[3]===98&&Et[4]===101&&Et[5]===0&&(fe={version:Et[6],flags0:Et[7]<<8|Et[8],flags1:Et[9]<<8|Et[10],transformCode:Et[11]});break;case 65499:for(var Zt=X()+se-2;se<Zt;){var Ye=ie[se++];J(256);var bt=new Int32Array(64);if(Ye>>4){if(Ye>>4!=1)throw new Error("DQT: invalid table spec");for(li=0;li<64;li++)bt[d[li]]=X()}else for(li=0;li<64;li++)bt[d[li]]=ie[se++];xe[15&Ye]=bt}break;case 65472:case 65473:case 65474:X(),(ce={}).extended=Be===65473,ce.progressive=Be===65474,ce.precision=ie[se++],ce.scanLines=X(),ce.samplesPerLine=X(),ce.components={},ce.componentsOrder=[];var Qt=ce.scanLines*ce.samplesPerLine;if(Qt>re){var Vt=Math.ceil((Qt-re)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${Vt}MP`)}var ut,At=ie[se++];for(gr=0;gr<At;gr++){ut=ie[se];var dr=ie[se+1]>>4,fr=15&ie[se+1],pr=ie[se+2];if(dr<=0||fr<=0)throw new Error("Invalid sampling factor, expected values above 0");ce.componentsOrder.push(ut),ce.components[ut]={h:dr,v:fr,quantizationIdx:pr},se+=3}ne(ce),Fe.push(ce);break;case 65476:var zt=X();for(gr=2;gr<zt;){var Ce=ie[se++],Nt=new Uint8Array(16),Xe=0;for(li=0;li<16;li++,se++)Xe+=Nt[li]=ie[se];J(16+Xe);var lt=new Uint8Array(Xe);for(li=0;li<Xe;li++,se++)lt[li]=ie[se];gr+=17+Xe,(Ce>>4?Te:Oe)[15&Ce]=j(Nt,lt)}break;case 65501:X(),oe=X();break;case 65500:X(),X();break;case 65498:X();var st=ie[se++],yt=[];for(gr=0;gr<st;gr++){fi=ce.components[ie[se++]];var Yt=ie[se++];fi.huffmanTableDC=Oe[Yt>>4],fi.huffmanTableAC=Te[15&Yt],yt.push(fi)}var $e=ie[se++],ze=ie[se++],ft=ie[se++],ht=G(ie,se,ce,yt,oe,$e,ze,ft>>4,15&ft,this.opts);se+=ht;break;case 65535:ie[se]!==255&&se--;break;default:if(ie[se-3]==255&&ie[se-2]>=192&&ie[se-2]<=254){se-=3;break}if(Be===224||Be==225){if(_t!==-1)throw new Error(`first unknown JPEG marker at offset ${_t.toString(16)}, second unknown JPEG marker ${Be.toString(16)} at offset ${(se-1).toString(16)}`);_t=se-1;const ai=X();if(ie[se+ai-2]===255){se+=ai-2;break}}throw new Error("unknown JPEG marker "+Be.toString(16))}Be=X()}if(Fe.length!=1)throw new Error("only single frame JPEGs supported");for(var gr=0;gr<Fe.length;gr++){var yr=Fe[gr].components;for(var li in yr)yr[li].quantizationTable=xe[yr[li].quantizationIdx],delete yr[li].quantizationIdx}for(this.width=ce.samplesPerLine,this.height=ce.scanLines,this.jfif=ge,this.adobe=fe,this.components=[],gr=0;gr<ce.componentsOrder.length;gr++){var fi=ce.components[ce.componentsOrder[gr]];this.components.push({lines:H(0,fi),scaleX:fi.h/ce.maxH,scaleY:fi.v/ce.maxV})}},getData:function(ie,re){var se,X,ne,ce,oe,de,me,ge,fe,xe,Fe,Te,Oe,Be,_t,Et,dt,Zt,Ye,bt,Qt,Vt=this.width/ie,ut=this.height/re,At=0,dr=ie*re*this.components.length;J(dr);var fr=new Uint8Array(dr);switch(this.components.length){case 1:for(se=this.components[0],xe=0;xe<re;xe++)for(oe=se.lines[0|xe*se.scaleY*ut],fe=0;fe<ie;fe++)Fe=oe[0|fe*se.scaleX*Vt],fr[At++]=Fe;break;case 2:for(se=this.components[0],X=this.components[1],xe=0;xe<re;xe++)for(oe=se.lines[0|xe*se.scaleY*ut],de=X.lines[0|xe*X.scaleY*ut],fe=0;fe<ie;fe++)Fe=oe[0|fe*se.scaleX*Vt],fr[At++]=Fe,Fe=de[0|fe*X.scaleX*Vt],fr[At++]=Fe;break;case 3:for(Qt=!0,this.adobe&&this.adobe.transformCode?Qt=!0:this.opts.colorTransform!==void 0&&(Qt=!!this.opts.colorTransform),se=this.components[0],X=this.components[1],ne=this.components[2],xe=0;xe<re;xe++)for(oe=se.lines[0|xe*se.scaleY*ut],de=X.lines[0|xe*X.scaleY*ut],me=ne.lines[0|xe*ne.scaleY*ut],fe=0;fe<ie;fe++)Qt?(Fe=oe[0|fe*se.scaleX*Vt],Te=de[0|fe*X.scaleX*Vt],Zt=V(Fe+1.402*((Oe=me[0|fe*ne.scaleX*Vt])-128)),Ye=V(Fe-.3441363*(Te-128)-.71413636*(Oe-128)),bt=V(Fe+1.772*(Te-128))):(Zt=oe[0|fe*se.scaleX*Vt],Ye=de[0|fe*X.scaleX*Vt],bt=me[0|fe*ne.scaleX*Vt]),fr[At++]=Zt,fr[At++]=Ye,fr[At++]=bt;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(Qt=!1,this.adobe&&this.adobe.transformCode?Qt=!0:this.opts.colorTransform!==void 0&&(Qt=!!this.opts.colorTransform),se=this.components[0],X=this.components[1],ne=this.components[2],ce=this.components[3],xe=0;xe<re;xe++)for(oe=se.lines[0|xe*se.scaleY*ut],de=X.lines[0|xe*X.scaleY*ut],me=ne.lines[0|xe*ne.scaleY*ut],ge=ce.lines[0|xe*ce.scaleY*ut],fe=0;fe<ie;fe++)Qt?(Fe=oe[0|fe*se.scaleX*Vt],Te=de[0|fe*X.scaleX*Vt],Oe=me[0|fe*ne.scaleX*Vt],Be=ge[0|fe*ce.scaleX*Vt],_t=255-V(Fe+1.402*(Oe-128)),Et=255-V(Fe-.3441363*(Te-128)-.71413636*(Oe-128)),dt=255-V(Fe+1.772*(Te-128))):(_t=oe[0|fe*se.scaleX*Vt],Et=de[0|fe*X.scaleX*Vt],dt=me[0|fe*ne.scaleX*Vt],Be=ge[0|fe*ce.scaleX*Vt]),fr[At++]=255-_t,fr[At++]=255-Et,fr[At++]=255-dt,fr[At++]=255-Be;break;default:throw new Error("Unsupported color mode")}return fr},copyToImageData:function(ie,re){var se,X,ne,ce,oe,de,me,ge,fe,xe=ie.width,Fe=ie.height,Te=ie.data,Oe=this.getData(xe,Fe),Be=0,_t=0;switch(this.components.length){case 1:for(X=0;X<Fe;X++)for(se=0;se<xe;se++)ne=Oe[Be++],Te[_t++]=ne,Te[_t++]=ne,Te[_t++]=ne,re&&(Te[_t++]=255);break;case 3:for(X=0;X<Fe;X++)for(se=0;se<xe;se++)me=Oe[Be++],ge=Oe[Be++],fe=Oe[Be++],Te[_t++]=me,Te[_t++]=ge,Te[_t++]=fe,re&&(Te[_t++]=255);break;case 4:for(X=0;X<Fe;X++)for(se=0;se<xe;se++)oe=Oe[Be++],de=Oe[Be++],ne=Oe[Be++],me=255-V(oe*(1-(ce=Oe[Be++])/255)+ce),ge=255-V(de*(1-ce/255)+ce),fe=255-V(ne*(1-ce/255)+ce),Te[_t++]=me,Te[_t++]=ge,Te[_t++]=fe,re&&(Te[_t++]=255);break;default:throw new Error("Unsupported color mode")}}};var Z=0,Q=0;function J(ie=0){var re=Z+ie;if(re>Q){var se=Math.ceil((re-Q)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${se}MB`)}Z=re}return q.resetMaxMemoryUsage=function(ie){Z=0,Q=ie},q.getBytesAllocated=function(){return Z},q.requestMemoryAllocation=J,q})(),module.exports=function(d,m={}){var g={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...m},w=new Uint8Array(d),$=new JpegImage;$.opts=g,JpegImage.resetMaxMemoryUsage(1024*g.maxMemoryUsageInMB*1024),$.parse(w);var I=g.formatAsRGBA?4:3,D=$.width*$.height*I;try{JpegImage.requestMemoryAllocation(D);var F={width:$.width,height:$.height,exifBuffer:$.exifBuffer,data:g.useTArray?new Uint8Array(D):Buffer.alloc(D)};$.comments.length>0&&(F.comments=$.comments)}catch(U){throw U instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+D):U instanceof ReferenceError&&U.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):U}return $.copyToImageData(F,g.formatAsRGBA),F};var decoderExports=decoder.exports,encode=encoderExports,decode=decoderExports,jpegJs={encode,decode},JPEG=getDefaultExportFromCjs(jpegJs);function jpeg$2(){return{mime:"image/jpeg",encode:(d,{quality:m=100}={})=>JPEG.encode(d,m).data,decode:(d,m)=>JPEG.decode(d,m)}}function commonjsRequire(d){throw new Error('Could not dynamically require "'+d+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var browser$1={exports:{}};browser$1.exports=(function(){function d(m,g,w){function $(F,U){if(!g[F]){if(!m[F]){var q=typeof commonjsRequire=="function"&&commonjsRequire;if(!U&&q)return q(F,!0);if(I)return I(F,!0);var j=new Error("Cannot find module '"+F+"'");throw j.code="MODULE_NOT_FOUND",j}var G=g[F]={exports:{}};m[F][0].call(G.exports,(function(H){return $(m[F][1][H]||H)}),G,G.exports,d,m,g,w)}return g[F].exports}for(var I=typeof commonjsRequire=="function"&&commonjsRequire,D=0;D<w.length;D++)$(w[D]);return $}return d})()({1:[function(d,m,g){(function(w){(function(){let $=d("./interlace"),I=[function(){},function(j,G,H,V){if(V===G.length)throw new Error("Ran out of data");let Z=G[V];j[H]=Z,j[H+1]=Z,j[H+2]=Z,j[H+3]=255},function(j,G,H,V){if(V+1>=G.length)throw new Error("Ran out of data");let Z=G[V];j[H]=Z,j[H+1]=Z,j[H+2]=Z,j[H+3]=G[V+1]},function(j,G,H,V){if(V+2>=G.length)throw new Error("Ran out of data");j[H]=G[V],j[H+1]=G[V+1],j[H+2]=G[V+2],j[H+3]=255},function(j,G,H,V){if(V+3>=G.length)throw new Error("Ran out of data");j[H]=G[V],j[H+1]=G[V+1],j[H+2]=G[V+2],j[H+3]=G[V+3]}],D=[function(){},function(j,G,H,V){let Z=G[0];j[H]=Z,j[H+1]=Z,j[H+2]=Z,j[H+3]=V},function(j,G,H){let V=G[0];j[H]=V,j[H+1]=V,j[H+2]=V,j[H+3]=G[1]},function(j,G,H,V){j[H]=G[0],j[H+1]=G[1],j[H+2]=G[2],j[H+3]=V},function(j,G,H){j[H]=G[0],j[H+1]=G[1],j[H+2]=G[2],j[H+3]=G[3]}];function F(j,G){let H=[],V=0;function Z(){if(V===j.length)throw new Error("Ran out of data");let Q,J,ie,re,se,X,ne,ce,oe=j[V];switch(V++,G){default:throw new Error("unrecognised depth");case 16:ne=j[V],V++,H.push((oe<<8)+ne);break;case 4:ne=15&oe,ce=oe>>4,H.push(ce,ne);break;case 2:se=3&oe,X=oe>>2&3,ne=oe>>4&3,ce=oe>>6&3,H.push(ce,ne,X,se);break;case 1:Q=1&oe,J=oe>>1&1,ie=oe>>2&1,re=oe>>3&1,se=oe>>4&1,X=oe>>5&1,ne=oe>>6&1,ce=oe>>7&1,H.push(ce,ne,X,se,re,ie,J,Q)}}return{get:function(Q){for(;H.length<Q;)Z();let J=H.slice(0,Q);return H=H.slice(Q),J},resetAfterLine:function(){H.length=0},end:function(){if(V!==j.length)throw new Error("extra data found")}}}function U(j,G,H,V,Z,Q){let J=j.width,ie=j.height,re=j.index;for(let se=0;se<ie;se++)for(let X=0;X<J;X++){let ne=H(X,se,re);I[V](G,Z,ne,Q),Q+=V}return Q}function q(j,G,H,V,Z,Q){let J=j.width,ie=j.height,re=j.index;for(let se=0;se<ie;se++){for(let X=0;X<J;X++){let ne=Z.get(V),ce=H(X,se,re);D[V](G,ne,ce,Q)}Z.resetAfterLine()}}g.dataToBitMap=function(j,G){let H,V,Z=G.width,Q=G.height,J=G.depth,ie=G.bpp,re=G.interlace;J!==8&&(H=F(j,J)),V=J<=8?w.alloc(Z*Q*4):new Uint16Array(Z*Q*4);let se,X,ne=Math.pow(2,J)-1,ce=0;if(re)se=$.getImagePasses(Z,Q),X=$.getInterlaceIterator(Z,Q);else{let oe=0;X=function(){let de=oe;return oe+=4,de},se=[{width:Z,height:Q}]}for(let oe=0;oe<se.length;oe++)J===8?ce=U(se[oe],V,X,ie,j,ce):q(se[oe],V,X,ie,H,ne);if(J===8){if(ce!==j.length)throw new Error("extra data found")}else H.end();return V}}).call(this)}).call(this,d("buffer").Buffer)},{"./interlace":11,buffer:32}],2:[function(d,m,g){(function(w){(function(){let $=d("./constants");m.exports=function(I,D,F,U){let q=[$.COLORTYPE_COLOR_ALPHA,$.COLORTYPE_ALPHA].indexOf(U.colorType)!==-1;if(U.colorType===U.inputColorType){let se=(function(){let X=new ArrayBuffer(2);return new DataView(X).setInt16(0,256,!0),new Int16Array(X)[0]!==256})();if(U.bitDepth===8||U.bitDepth===16&&se)return I}let j=U.bitDepth!==16?I:new Uint16Array(I.buffer),G=255,H=$.COLORTYPE_TO_BPP_MAP[U.inputColorType];H!==4||U.inputHasAlpha||(H=3);let V=$.COLORTYPE_TO_BPP_MAP[U.colorType];U.bitDepth===16&&(G=65535,V*=2);let Z=w.alloc(D*F*V),Q=0,J=0,ie=U.bgColor||{};function re(){let se,X,ne,ce=G;switch(U.inputColorType){case $.COLORTYPE_COLOR_ALPHA:ce=j[Q+3],se=j[Q],X=j[Q+1],ne=j[Q+2];break;case $.COLORTYPE_COLOR:se=j[Q],X=j[Q+1],ne=j[Q+2];break;case $.COLORTYPE_ALPHA:ce=j[Q+1],se=j[Q],X=se,ne=se;break;case $.COLORTYPE_GRAYSCALE:se=j[Q],X=se,ne=se;break;default:throw new Error("input color type:"+U.inputColorType+" is not supported at present")}return U.inputHasAlpha&&(q||(ce/=G,se=Math.min(Math.max(Math.round((1-ce)*ie.red+ce*se),0),G),X=Math.min(Math.max(Math.round((1-ce)*ie.green+ce*X),0),G),ne=Math.min(Math.max(Math.round((1-ce)*ie.blue+ce*ne),0),G))),{red:se,green:X,blue:ne,alpha:ce}}ie.red===void 0&&(ie.red=G),ie.green===void 0&&(ie.green=G),ie.blue===void 0&&(ie.blue=G);for(let se=0;se<F;se++)for(let X=0;X<D;X++){let ne=re();switch(U.colorType){case $.COLORTYPE_COLOR_ALPHA:case $.COLORTYPE_COLOR:U.bitDepth===8?(Z[J]=ne.red,Z[J+1]=ne.green,Z[J+2]=ne.blue,q&&(Z[J+3]=ne.alpha)):(Z.writeUInt16BE(ne.red,J),Z.writeUInt16BE(ne.green,J+2),Z.writeUInt16BE(ne.blue,J+4),q&&Z.writeUInt16BE(ne.alpha,J+6));break;case $.COLORTYPE_ALPHA:case $.COLORTYPE_GRAYSCALE:{let ce=(ne.red+ne.green+ne.blue)/3;U.bitDepth===8?(Z[J]=ce,q&&(Z[J+1]=ne.alpha)):(Z.writeUInt16BE(ce,J),q&&Z.writeUInt16BE(ne.alpha,J+2));break}default:throw new Error("unrecognised color Type "+U.colorType)}Q+=H,J+=V}return Z}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,buffer:32}],3:[function(d,m,g){(function(w,$){(function(){let I=d("util"),D=d("stream"),F=m.exports=function(){D.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};I.inherits(F,D),F.prototype.read=function(U,q){this._reads.push({length:Math.abs(U),allowLess:U<0,func:q}),w.nextTick((function(){this._process(),this._paused&&this._reads&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}).bind(this))},F.prototype.write=function(U,q){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;let j;return j=$.isBuffer(U)?U:$.from(U,q||this._encoding),this._buffers.push(j),this._buffered+=j.length,this._process(),this._reads&&this._reads.length===0&&(this._paused=!0),this.writable&&!this._paused},F.prototype.end=function(U,q){U&&this.write(U,q),this.writable=!1,this._buffers&&(this._buffers.length===0?this._end():(this._buffers.push(null),this._process()))},F.prototype.destroySoon=F.prototype.end,F.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("Unexpected end of input")),this.destroy()},F.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},F.prototype._processReadAllowingLess=function(U){this._reads.shift();let q=this._buffers[0];q.length>U.length?(this._buffered-=U.length,this._buffers[0]=q.slice(U.length),U.func.call(this,q.slice(0,U.length))):(this._buffered-=q.length,this._buffers.shift(),U.func.call(this,q))},F.prototype._processRead=function(U){this._reads.shift();let q=0,j=0,G=$.alloc(U.length);for(;q<U.length;){let H=this._buffers[j++],V=Math.min(H.length,U.length-q);H.copy(G,q,0,V),q+=V,V!==H.length&&(this._buffers[--j]=H.slice(V))}j>0&&this._buffers.splice(0,j),this._buffered-=U.length,U.func.call(this,G)},F.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){let U=this._reads[0];if(U.allowLess)this._processReadAllowingLess(U);else{if(!(this._buffered>=U.length))break;this._processRead(U)}}this._buffers&&!this.writable&&this._end()}catch(U){this.emit("error",U)}}}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{_process:63,buffer:32,stream:65,util:84}],4:[function(d,m,g){m.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],5:[function(d,m,g){let w=[];(function(){for(let I=0;I<256;I++){let D=I;for(let F=0;F<8;F++)1&D?D=3988292384^D>>>1:D>>>=1;w[I]=D}})();let $=m.exports=function(){this._crc=-1};$.prototype.write=function(I){for(let D=0;D<I.length;D++)this._crc=w[255&(this._crc^I[D])]^this._crc>>>8;return!0},$.prototype.crc32=function(){return~this._crc},$.crc32=function(I){let D=-1;for(let F=0;F<I.length;F++)D=w[255&(D^I[F])]^D>>>8;return~D}},{}],6:[function(d,m,g){(function(w){(function(){let $=d("./paeth-predictor");function I(ie,re,se,X,ne){for(let ce=0;ce<se;ce++)X[ne+ce]=ie[re+ce]}function D(ie,re,se){let X=0,ne=re+se;for(let ce=re;ce<ne;ce++)X+=Math.abs(ie[ce]);return X}function F(ie,re,se,X,ne,ce){for(let oe=0;oe<se;oe++){let de=oe>=ce?ie[re+oe-ce]:0,me=ie[re+oe]-de;X[ne+oe]=me}}function U(ie,re,se,X){let ne=0;for(let ce=0;ce<se;ce++){let oe=ce>=X?ie[re+ce-X]:0,de=ie[re+ce]-oe;ne+=Math.abs(de)}return ne}function q(ie,re,se,X,ne){for(let ce=0;ce<se;ce++){let oe=re>0?ie[re+ce-se]:0,de=ie[re+ce]-oe;X[ne+ce]=de}}function j(ie,re,se){let X=0,ne=re+se;for(let ce=re;ce<ne;ce++){let oe=re>0?ie[ce-se]:0,de=ie[ce]-oe;X+=Math.abs(de)}return X}function G(ie,re,se,X,ne,ce){for(let oe=0;oe<se;oe++){let de=oe>=ce?ie[re+oe-ce]:0,me=re>0?ie[re+oe-se]:0,ge=ie[re+oe]-(de+me>>1);X[ne+oe]=ge}}function H(ie,re,se,X){let ne=0;for(let ce=0;ce<se;ce++){let oe=ce>=X?ie[re+ce-X]:0,de=re>0?ie[re+ce-se]:0,me=ie[re+ce]-(oe+de>>1);ne+=Math.abs(me)}return ne}function V(ie,re,se,X,ne,ce){for(let oe=0;oe<se;oe++){let de=oe>=ce?ie[re+oe-ce]:0,me=re>0?ie[re+oe-se]:0,ge=re>0&&oe>=ce?ie[re+oe-(se+ce)]:0,fe=ie[re+oe]-$(de,me,ge);X[ne+oe]=fe}}function Z(ie,re,se,X){let ne=0;for(let ce=0;ce<se;ce++){let oe=ce>=X?ie[re+ce-X]:0,de=re>0?ie[re+ce-se]:0,me=re>0&&ce>=X?ie[re+ce-(se+X)]:0,ge=ie[re+ce]-$(oe,de,me);ne+=Math.abs(ge)}return ne}let Q={0:I,1:F,2:q,3:G,4:V},J={0:D,1:U,2:j,3:H,4:Z};m.exports=function(ie,re,se,X,ne){let ce;if("filterType"in X&&X.filterType!==-1){if(typeof X.filterType!="number")throw new Error("unrecognised filter types");ce=[X.filterType]}else ce=[0,1,2,3,4];X.bitDepth===16&&(ne*=2);let oe=re*ne,de=0,me=0,ge=w.alloc((oe+1)*se),fe=ce[0];for(let xe=0;xe<se;xe++){if(ce.length>1){let Fe=1/0;for(let Te=0;Te<ce.length;Te++){let Oe=J[ce[Te]](ie,me,oe,ne);Oe<Fe&&(fe=ce[Te],Fe=Oe)}}ge[de]=fe,de++,Q[fe](ie,me,oe,ge,de,ne),de+=oe,me+=oe}return ge}}).call(this)}).call(this,d("buffer").Buffer)},{"./paeth-predictor":15,buffer:32}],7:[function(d,m,g){(function(w){(function(){let $=d("util"),I=d("./chunkstream"),D=d("./filter-parse"),F=m.exports=function(U){I.call(this);let q=[],j=this;this._filter=new D(U,{read:this.read.bind(this),write:function(G){q.push(G)},complete:function(){j.emit("complete",w.concat(q))}}),this._filter.start()};$.inherits(F,I)}).call(this)}).call(this,d("buffer").Buffer)},{"./chunkstream":3,"./filter-parse":9,buffer:32,util:84}],8:[function(d,m,g){(function(w){(function(){let $=d("./sync-reader"),I=d("./filter-parse");g.process=function(D,F){let U=[],q=new $(D);return new I(F,{read:q.read.bind(q),write:function(j){U.push(j)},complete:function(){}}).start(),q.process(),w.concat(U)}}).call(this)}).call(this,d("buffer").Buffer)},{"./filter-parse":9,"./sync-reader":22,buffer:32}],9:[function(d,m,g){(function(w){(function(){let $=d("./interlace"),I=d("./paeth-predictor");function D(U,q,j){let G=U*q;return j!==8&&(G=Math.ceil(G/(8/j))),G}let F=m.exports=function(U,q){let j=U.width,G=U.height,H=U.interlace,V=U.bpp,Z=U.depth;if(this.read=q.read,this.write=q.write,this.complete=q.complete,this._imageIndex=0,this._images=[],H){let Q=$.getImagePasses(j,G);for(let J=0;J<Q.length;J++)this._images.push({byteWidth:D(Q[J].width,V,Z),height:Q[J].height,lineIndex:0})}else this._images.push({byteWidth:D(j,V,Z),height:G,lineIndex:0});this._xComparison=Z===8?V:Z===16?2*V:1};F.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},F.prototype._unFilterType1=function(U,q,j){let G=this._xComparison,H=G-1;for(let V=0;V<j;V++){let Z=U[1+V],Q=V>H?q[V-G]:0;q[V]=Z+Q}},F.prototype._unFilterType2=function(U,q,j){let G=this._lastLine;for(let H=0;H<j;H++){let V=U[1+H],Z=G?G[H]:0;q[H]=V+Z}},F.prototype._unFilterType3=function(U,q,j){let G=this._xComparison,H=G-1,V=this._lastLine;for(let Z=0;Z<j;Z++){let Q=U[1+Z],J=V?V[Z]:0,ie=Z>H?q[Z-G]:0,re=Math.floor((ie+J)/2);q[Z]=Q+re}},F.prototype._unFilterType4=function(U,q,j){let G=this._xComparison,H=G-1,V=this._lastLine;for(let Z=0;Z<j;Z++){let Q=U[1+Z],J=V?V[Z]:0,ie=Z>H?q[Z-G]:0,re=Z>H&&V?V[Z-G]:0,se=I(ie,J,re);q[Z]=Q+se}},F.prototype._reverseFilterLine=function(U){let q,j=U[0],G=this._images[this._imageIndex],H=G.byteWidth;if(j===0)q=U.slice(1,H+1);else switch(q=w.alloc(H),j){case 1:this._unFilterType1(U,q,H);break;case 2:this._unFilterType2(U,q,H);break;case 3:this._unFilterType3(U,q,H);break;case 4:this._unFilterType4(U,q,H);break;default:throw new Error("Unrecognised filter type - "+j)}this.write(q),G.lineIndex++,G.lineIndex>=G.height?(this._lastLine=null,this._imageIndex++,G=this._images[this._imageIndex]):this._lastLine=q,G?this.read(G.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}}).call(this)}).call(this,d("buffer").Buffer)},{"./interlace":11,"./paeth-predictor":15,buffer:32}],10:[function(d,m,g){(function(w){(function(){function $(F,U,q,j,G){let H=0;for(let V=0;V<j;V++)for(let Z=0;Z<q;Z++){let Q=G[F[H]];if(!Q)throw new Error("index "+F[H]+" not in palette");for(let J=0;J<4;J++)U[H+J]=Q[J];H+=4}}function I(F,U,q,j,G){let H=0;for(let V=0;V<j;V++)for(let Z=0;Z<q;Z++){let Q=!1;if(G.length===1?G[0]===F[H]&&(Q=!0):G[0]===F[H]&&G[1]===F[H+1]&&G[2]===F[H+2]&&(Q=!0),Q)for(let J=0;J<4;J++)U[H+J]=0;H+=4}}function D(F,U,q,j,G){let H=255,V=Math.pow(2,G)-1,Z=0;for(let Q=0;Q<j;Q++)for(let J=0;J<q;J++){for(let ie=0;ie<4;ie++)U[Z+ie]=Math.floor(F[Z+ie]*H/V+.5);Z+=4}}m.exports=function(F,U,q=!1){let j=U.depth,G=U.width,H=U.height,V=U.colorType,Z=U.transColor,Q=U.palette,J=F;return V===3?$(F,J,G,H,Q):(Z&&I(F,J,G,H,Z),j===8||q||(j===16&&(J=w.alloc(G*H*4)),D(F,J,G,H,j))),J}}).call(this)}).call(this,d("buffer").Buffer)},{buffer:32}],11:[function(d,m,g){let w=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];g.getImagePasses=function($,I){let D=[],F=$%8,U=I%8,q=($-F)/8,j=(I-U)/8;for(let G=0;G<w.length;G++){let H=w[G],V=q*H.x.length,Z=j*H.y.length;for(let Q=0;Q<H.x.length&&H.x[Q]<F;Q++)V++;for(let Q=0;Q<H.y.length&&H.y[Q]<U;Q++)Z++;V>0&&Z>0&&D.push({width:V,height:Z,index:G})}return D},g.getInterlaceIterator=function($){return function(I,D,F){let U=I%w[F].x.length,q=(I-U)/w[F].x.length*8+w[F].x[U],j=D%w[F].y.length;return 4*q+((D-j)/w[F].y.length*8+w[F].y[j])*$*4}}},{}],12:[function(d,m,g){(function(w){(function(){let $=d("util"),I=d("stream"),D=d("./constants"),F=d("./packer"),U=m.exports=function(q){I.call(this);let j=q||{};this._packer=new F(j),this._deflate=this._packer.createDeflate(),this.readable=!0};$.inherits(U,I),U.prototype.pack=function(q,j,G,H){this.emit("data",w.from(D.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(j,G)),H&&this.emit("data",this._packer.packGAMA(H));let V=this._packer.filterData(q,j,G);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",(function(Z){this.emit("data",this._packer.packIDAT(Z))}).bind(this)),this._deflate.on("end",(function(){this.emit("data",this._packer.packIEND()),this.emit("end")}).bind(this)),this._deflate.end(V)}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:32,stream:65,util:84}],13:[function(d,m,g){(function(w){(function(){let $=!0,I=d("zlib");I.deflateSync||($=!1);let D=d("./constants"),F=d("./packer");m.exports=function(U,q){if(!$)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let j=new F(q||{}),G=[];G.push(w.from(D.PNG_SIGNATURE)),G.push(j.packIHDR(U.width,U.height)),U.gamma&&G.push(j.packGAMA(U.gamma));let H=j.filterData(U.data,U.width,U.height),V=I.deflateSync(H,j.getDeflateOptions());if(H=null,!V||!V.length)throw new Error("bad png - invalid compressed data response");return G.push(j.packIDAT(V)),G.push(j.packIEND()),w.concat(G)}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:32,zlib:31}],14:[function(d,m,g){(function(w){(function(){let $=d("./constants"),I=d("./crc"),D=d("./bitpacker"),F=d("./filter-pack"),U=d("zlib"),q=m.exports=function(j){if(this._options=j,j.deflateChunkSize=j.deflateChunkSize||32768,j.deflateLevel=j.deflateLevel!=null?j.deflateLevel:9,j.deflateStrategy=j.deflateStrategy!=null?j.deflateStrategy:3,j.inputHasAlpha=j.inputHasAlpha==null||j.inputHasAlpha,j.deflateFactory=j.deflateFactory||U.createDeflate,j.bitDepth=j.bitDepth||8,j.colorType=typeof j.colorType=="number"?j.colorType:$.COLORTYPE_COLOR_ALPHA,j.inputColorType=typeof j.inputColorType=="number"?j.inputColorType:$.COLORTYPE_COLOR_ALPHA,[$.COLORTYPE_GRAYSCALE,$.COLORTYPE_COLOR,$.COLORTYPE_COLOR_ALPHA,$.COLORTYPE_ALPHA].indexOf(j.colorType)===-1)throw new Error("option color type:"+j.colorType+" is not supported at present");if([$.COLORTYPE_GRAYSCALE,$.COLORTYPE_COLOR,$.COLORTYPE_COLOR_ALPHA,$.COLORTYPE_ALPHA].indexOf(j.inputColorType)===-1)throw new Error("option input color type:"+j.inputColorType+" is not supported at present");if(j.bitDepth!==8&&j.bitDepth!==16)throw new Error("option bit depth:"+j.bitDepth+" is not supported at present")};q.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},q.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},q.prototype.filterData=function(j,G,H){let V=D(j,G,H,this._options),Z=$.COLORTYPE_TO_BPP_MAP[this._options.colorType];return F(V,G,H,this._options,Z)},q.prototype._packChunk=function(j,G){let H=G?G.length:0,V=w.alloc(H+12);return V.writeUInt32BE(H,0),V.writeUInt32BE(j,4),G&&G.copy(V,8),V.writeInt32BE(I.crc32(V.slice(4,V.length-4)),V.length-4),V},q.prototype.packGAMA=function(j){let G=w.alloc(4);return G.writeUInt32BE(Math.floor(j*$.GAMMA_DIVISION),0),this._packChunk($.TYPE_gAMA,G)},q.prototype.packIHDR=function(j,G){let H=w.alloc(13);return H.writeUInt32BE(j,0),H.writeUInt32BE(G,4),H[8]=this._options.bitDepth,H[9]=this._options.colorType,H[10]=0,H[11]=0,H[12]=0,this._packChunk($.TYPE_IHDR,H)},q.prototype.packIDAT=function(j){return this._packChunk($.TYPE_IDAT,j)},q.prototype.packIEND=function(){return this._packChunk($.TYPE_IEND,null)}}).call(this)}).call(this,d("buffer").Buffer)},{"./bitpacker":2,"./constants":4,"./crc":5,"./filter-pack":6,buffer:32,zlib:31}],15:[function(d,m,g){m.exports=function(w,$,I){let D=w+$-I,F=Math.abs(D-w),U=Math.abs(D-$),q=Math.abs(D-I);return F<=U&&F<=q?w:U<=q?$:I}},{}],16:[function(d,m,g){let w=d("util"),$=d("zlib"),I=d("./chunkstream"),D=d("./filter-parse-async"),F=d("./parser"),U=d("./bitmapper"),q=d("./format-normaliser"),j=m.exports=function(G){I.call(this),this._parser=new F(G,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=G,this.writable=!0,this._parser.start()};w.inherits(j,I),j.prototype._handleError=function(G){this.emit("error",G),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",(function(){}))),this.errord=!0},j.prototype._inflateData=function(G){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=$.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{let H=(1+(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3))*this._bitmapInfo.height,V=Math.max(H,$.Z_MIN_CHUNK);this._inflate=$.createInflate({chunkSize:V});let Z=H,Q=this.emit.bind(this,"error");this._inflate.on("error",(function(ie){Z&&Q(ie)})),this._filter.on("complete",this._complete.bind(this));let J=this._filter.write.bind(this._filter);this._inflate.on("data",(function(ie){Z&&(ie.length>Z&&(ie=ie.slice(0,Z)),Z-=ie.length,J(ie))})),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(G)},j.prototype._handleMetaData=function(G){this._metaData=G,this._bitmapInfo=Object.create(G),this._filter=new D(this._bitmapInfo)},j.prototype._handleTransColor=function(G){this._bitmapInfo.transColor=G},j.prototype._handlePalette=function(G){this._bitmapInfo.palette=G},j.prototype._simpleTransparency=function(){this._metaData.alpha=!0},j.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},j.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"))},j.prototype._complete=function(G){if(this.errord)return;let H;try{let V=U.dataToBitMap(G,this._bitmapInfo);H=q(V,this._bitmapInfo,this._options.skipRescale),V=null}catch(V){return void this._handleError(V)}this.emit("parsed",H)}},{"./bitmapper":1,"./chunkstream":3,"./filter-parse-async":7,"./format-normaliser":10,"./parser":18,util:84,zlib:31}],17:[function(d,m,g){(function(w){(function(){let $=!0,I=d("zlib"),D=d("./sync-inflate");I.deflateSync||($=!1);let F=d("./sync-reader"),U=d("./filter-parse-sync"),q=d("./parser"),j=d("./bitmapper"),G=d("./format-normaliser");m.exports=function(H,V){if(!$)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let Z,Q,J;function ie(Oe){Z=Oe}function re(Oe){Q=Oe}function se(Oe){Q.transColor=Oe}function X(Oe){Q.palette=Oe}function ne(){Q.alpha=!0}function ce(Oe){J=Oe}let oe=[];function de(Oe){oe.push(Oe)}let me=new F(H);if(new q(V,{read:me.read.bind(me),error:ie,metadata:re,gamma:ce,palette:X,transColor:se,inflateData:de,simpleTransparency:ne}).start(),me.process(),Z)throw Z;let ge,fe=w.concat(oe);if(oe.length=0,Q.interlace)ge=I.inflateSync(fe);else{let Oe=(1+(Q.width*Q.bpp*Q.depth+7>>3))*Q.height;ge=D(fe,{chunkSize:Oe,maxLength:Oe})}if(fe=null,!ge||!ge.length)throw new Error("bad png - invalid inflate data response");let xe=U.process(ge,Q);fe=null;let Fe=j.dataToBitMap(xe,Q);xe=null;let Te=G(Fe,Q,V.skipRescale);return Q.data=Te,Q.gamma=J||0,Q}}).call(this)}).call(this,d("buffer").Buffer)},{"./bitmapper":1,"./filter-parse-sync":8,"./format-normaliser":10,"./parser":18,"./sync-inflate":21,"./sync-reader":22,buffer:32,zlib:31}],18:[function(d,m,g){(function(w){(function(){let $=d("./constants"),I=d("./crc"),D=m.exports=function(F,U){this._options=F,F.checkCRC=F.checkCRC!==!1,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[$.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[$.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[$.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[$.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[$.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[$.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=U.read,this.error=U.error,this.metadata=U.metadata,this.gamma=U.gamma,this.transColor=U.transColor,this.palette=U.palette,this.parsed=U.parsed,this.inflateData=U.inflateData,this.finished=U.finished,this.simpleTransparency=U.simpleTransparency,this.headersFinished=U.headersFinished||function(){}};D.prototype.start=function(){this.read($.PNG_SIGNATURE.length,this._parseSignature.bind(this))},D.prototype._parseSignature=function(F){let U=$.PNG_SIGNATURE;for(let q=0;q<U.length;q++)if(F[q]!==U[q])return void this.error(new Error("Invalid file signature"));this.read(8,this._parseChunkBegin.bind(this))},D.prototype._parseChunkBegin=function(F){let U=F.readUInt32BE(0),q=F.readUInt32BE(4),j="";for(let H=4;H<8;H++)j+=String.fromCharCode(F[H]);let G=!!(32&F[4]);if(this._hasIHDR||q===$.TYPE_IHDR){if(this._crc=new I,this._crc.write(w.from(j)),this._chunks[q])return this._chunks[q](U);G?this.read(U+4,this._skipChunk.bind(this)):this.error(new Error("Unsupported critical chunk type "+j))}else this.error(new Error("Expected IHDR on beggining"))},D.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},D.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},D.prototype._parseChunkEnd=function(F){let U=F.readInt32BE(0),q=this._crc.crc32();this._options.checkCRC&&q!==U?this.error(new Error("Crc error - "+U+" - "+q)):this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},D.prototype._handleIHDR=function(F){this.read(F,this._parseIHDR.bind(this))},D.prototype._parseIHDR=function(F){this._crc.write(F);let U=F.readUInt32BE(0),q=F.readUInt32BE(4),j=F[8],G=F[9],H=F[10],V=F[11],Z=F[12];if(j!==8&&j!==4&&j!==2&&j!==1&&j!==16)return void this.error(new Error("Unsupported bit depth "+j));if(!(G in $.COLORTYPE_TO_BPP_MAP))return void this.error(new Error("Unsupported color type"));if(H!==0)return void this.error(new Error("Unsupported compression method"));if(V!==0)return void this.error(new Error("Unsupported filter method"));if(Z!==0&&Z!==1)return void this.error(new Error("Unsupported interlace method"));this._colorType=G;let Q=$.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:U,height:q,depth:j,interlace:!!Z,palette:!!(G&$.COLORTYPE_PALETTE),color:!!(G&$.COLORTYPE_COLOR),alpha:!!(G&$.COLORTYPE_ALPHA),bpp:Q,colorType:G}),this._handleChunkEnd()},D.prototype._handlePLTE=function(F){this.read(F,this._parsePLTE.bind(this))},D.prototype._parsePLTE=function(F){this._crc.write(F);let U=Math.floor(F.length/3);for(let q=0;q<U;q++)this._palette.push([F[3*q],F[3*q+1],F[3*q+2],255]);this.palette(this._palette),this._handleChunkEnd()},D.prototype._handleTRNS=function(F){this.simpleTransparency(),this.read(F,this._parseTRNS.bind(this))},D.prototype._parseTRNS=function(F){if(this._crc.write(F),this._colorType===$.COLORTYPE_PALETTE_COLOR){if(this._palette.length===0)return void this.error(new Error("Transparency chunk must be after palette"));if(F.length>this._palette.length)return void this.error(new Error("More transparent colors than palette size"));for(let U=0;U<F.length;U++)this._palette[U][3]=F[U];this.palette(this._palette)}this._colorType===$.COLORTYPE_GRAYSCALE&&this.transColor([F.readUInt16BE(0)]),this._colorType===$.COLORTYPE_COLOR&&this.transColor([F.readUInt16BE(0),F.readUInt16BE(2),F.readUInt16BE(4)]),this._handleChunkEnd()},D.prototype._handleGAMA=function(F){this.read(F,this._parseGAMA.bind(this))},D.prototype._parseGAMA=function(F){this._crc.write(F),this.gamma(F.readUInt32BE(0)/$.GAMMA_DIVISION),this._handleChunkEnd()},D.prototype._handleIDAT=function(F){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-F,this._parseIDAT.bind(this,F))},D.prototype._parseIDAT=function(F,U){if(this._crc.write(U),this._colorType===$.COLORTYPE_PALETTE_COLOR&&this._palette.length===0)throw new Error("Expected palette not found");this.inflateData(U);let q=F-U.length;q>0?this._handleIDAT(q):this._handleChunkEnd()},D.prototype._handleIEND=function(F){this.read(F,this._parseIEND.bind(this))},D.prototype._parseIEND=function(F){this._crc.write(F),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}}).call(this)}).call(this,d("buffer").Buffer)},{"./constants":4,"./crc":5,buffer:32}],19:[function(d,m,g){let w=d("./parser-sync"),$=d("./packer-sync");g.read=function(I,D){return w(I,D||{})},g.write=function(I,D){return $(I,D)}},{"./packer-sync":13,"./parser-sync":17}],20:[function(d,m,g){(function(w,$){(function(){let I=d("util"),D=d("stream"),F=d("./parser-async"),U=d("./packer-async"),q=d("./png-sync"),j=g.PNG=function(G){D.call(this),G=G||{},this.width=0|G.width,this.height=0|G.height,this.data=this.width>0&&this.height>0?$.alloc(4*this.width*this.height):null,G.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new F(G),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",(function(H){this.data=H,this.emit("parsed",H)}).bind(this)),this._packer=new U(G),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};I.inherits(j,D),j.sync=q,j.prototype.pack=function(){return this.data&&this.data.length?(w.nextTick((function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}).bind(this)),this):(this.emit("error","No data provided"),this)},j.prototype.parse=function(G,H){if(H){let V,Z;V=(function(Q){this.removeListener("error",Z),this.data=Q,H(null,this)}).bind(this),Z=(function(Q){this.removeListener("parsed",V),H(Q,null)}).bind(this),this.once("parsed",V),this.once("error",Z)}return this.end(G),this},j.prototype.write=function(G){return this._parser.write(G),!0},j.prototype.end=function(G){this._parser.end(G)},j.prototype._metadata=function(G){this.width=G.width,this.height=G.height,this.emit("metadata",G)},j.prototype._gamma=function(G){this.gamma=G},j.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},j.bitblt=function(G,H,V,Z,Q,J,ie,re){if(Z|=0,Q|=0,J|=0,ie|=0,re|=0,(V|=0)>G.width||Z>G.height||V+Q>G.width||Z+J>G.height)throw new Error("bitblt reading outside image");if(ie>H.width||re>H.height||ie+Q>H.width||re+J>H.height)throw new Error("bitblt writing outside image");for(let se=0;se<J;se++)G.data.copy(H.data,(re+se)*H.width+ie<<2,(Z+se)*G.width+V<<2,(Z+se)*G.width+V+Q<<2)},j.prototype.bitblt=function(G,H,V,Z,Q,J,ie){return j.bitblt(this,G,H,V,Z,Q,J,ie),this},j.adjustGamma=function(G){if(G.gamma){for(let H=0;H<G.height;H++)for(let V=0;V<G.width;V++){let Z=G.width*H+V<<2;for(let Q=0;Q<3;Q++){let J=G.data[Z+Q]/255;J=Math.pow(J,1/2.2/G.gamma),G.data[Z+Q]=Math.round(255*J)}}G.gamma=0}},j.prototype.adjustGamma=function(){j.adjustGamma(this)}}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{"./packer-async":12,"./parser-async":16,"./png-sync":19,_process:63,buffer:32,stream:65,util:84}],21:[function(d,m,g){(function(w,$){(function(){let I=d("assert").ok,D=d("zlib"),F=d("util"),U=d("buffer").kMaxLength;function q(Z){if(!(this instanceof q))return new q(Z);Z&&Z.chunkSize<D.Z_MIN_CHUNK&&(Z.chunkSize=D.Z_MIN_CHUNK),D.Inflate.call(this,Z),this._offset=this._offset===void 0?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,Z&&Z.maxLength!=null&&(this._maxLength=Z.maxLength)}function j(Z){return new q(Z)}function G(Z,Q){Z._handle&&(Z._handle.close(),Z._handle=null)}function H(Z,Q){if(typeof Q=="string"&&(Q=$.from(Q)),!(Q instanceof $))throw new TypeError("Not a string or buffer");let J=Z._finishFlushFlag;return J==null&&(J=D.Z_FINISH),Z._processChunk(Q,J)}function V(Z,Q){return H(new q(Q),Z)}q.prototype._processChunk=function(Z,Q,J){if(typeof J=="function")return D.Inflate._processChunk.call(this,Z,Q,J);let ie,re,se=this,X=Z&&Z.length,ne=this._chunkSize-this._offset,ce=this._maxLength,oe=0,de=[],me=0;function ge(xe,Fe){if(se._hadError)return;let Te=ne-Fe;if(I(Te>=0,"have should not go down"),Te>0){let Oe=se._buffer.slice(se._offset,se._offset+Te);if(se._offset+=Te,Oe.length>ce&&(Oe=Oe.slice(0,ce)),de.push(Oe),me+=Oe.length,ce-=Oe.length,ce===0)return!1}return(Fe===0||se._offset>=se._chunkSize)&&(ne=se._chunkSize,se._offset=0,se._buffer=$.allocUnsafe(se._chunkSize)),Fe===0&&(oe+=X-xe,X=xe,!0)}this.on("error",(function(xe){ie=xe})),I(this._handle,"zlib binding closed");do re=this._handle.writeSync(Q,Z,oe,X,this._buffer,this._offset,ne),re=re||this._writeState;while(!this._hadError&&ge(re[0],re[1]));if(this._hadError)throw ie;if(me>=U)throw G(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+U.toString(16)+" bytes");let fe=$.concat(de,me);return G(this),fe},F.inherits(q,D.Inflate),m.exports=g=V,g.Inflate=q,g.createInflate=j,g.inflateSync=V}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{_process:63,assert:23,buffer:32,util:84,zlib:31}],22:[function(d,m,g){let w=m.exports=function($){this._buffer=$,this._reads=[]};w.prototype.read=function($,I){this._reads.push({length:Math.abs($),allowLess:$<0,func:I})},w.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){let $=this._reads[0];if(!this._buffer.length||!(this._buffer.length>=$.length||$.allowLess))break;{this._reads.shift();let I=this._buffer;this._buffer=I.slice($.length),$.func.call(this,I.slice(0,$.length))}}if(this._reads.length>0)throw new Error("There are some read requests waitng on finished stream");if(this._buffer.length>0)throw new Error("unrecognised content at end of stream")}},{}],23:[function(d,m,g){(function(w){(function(){var $=d("object-assign");/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */function I(Te,Oe){if(Te===Oe)return 0;for(var Be=Te.length,_t=Oe.length,Et=0,dt=Math.min(Be,_t);Et<dt;++Et)if(Te[Et]!==Oe[Et]){Be=Te[Et],_t=Oe[Et];break}return Be<_t?-1:_t<Be?1:0}function D(Te){return w.Buffer&&typeof w.Buffer.isBuffer=="function"?w.Buffer.isBuffer(Te):!(Te==null||!Te._isBuffer)}var F=d("util/"),U=Object.prototype.hasOwnProperty,q=Array.prototype.slice,j=(function(){}).name==="foo";function G(Te){return Object.prototype.toString.call(Te)}function H(Te){return!D(Te)&&typeof w.ArrayBuffer=="function"&&(typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(Te):!!Te&&(Te instanceof DataView||!!(Te.buffer&&Te.buffer instanceof ArrayBuffer)))}var V=m.exports=X,Z=/\s*function\s+([^\(\s]*)\s*/;function Q(Te){if(F.isFunction(Te)){if(j)return Te.name;var Oe=Te.toString().match(Z);return Oe&&Oe[1]}}function J(Te,Oe){return typeof Te=="string"?Te.length<Oe?Te:Te.slice(0,Oe):Te}function ie(Te){if(j||!F.isFunction(Te))return F.inspect(Te);var Oe=Q(Te);return"[Function"+(Oe?": "+Oe:"")+"]"}function re(Te){return J(ie(Te.actual),128)+" "+Te.operator+" "+J(ie(Te.expected),128)}function se(Te,Oe,Be,_t,Et){throw new V.AssertionError({message:Be,actual:Te,expected:Oe,operator:_t,stackStartFunction:Et})}function X(Te,Oe){Te||se(Te,!0,Oe,"==",V.ok)}function ne(Te,Oe,Be,_t){if(Te===Oe)return!0;if(D(Te)&&D(Oe))return I(Te,Oe)===0;if(F.isDate(Te)&&F.isDate(Oe))return Te.getTime()===Oe.getTime();if(F.isRegExp(Te)&&F.isRegExp(Oe))return Te.source===Oe.source&&Te.global===Oe.global&&Te.multiline===Oe.multiline&&Te.lastIndex===Oe.lastIndex&&Te.ignoreCase===Oe.ignoreCase;if(Te!==null&&typeof Te=="object"||Oe!==null&&typeof Oe=="object"){if(H(Te)&&H(Oe)&&G(Te)===G(Oe)&&!(Te instanceof Float32Array||Te instanceof Float64Array))return I(new Uint8Array(Te.buffer),new Uint8Array(Oe.buffer))===0;if(D(Te)!==D(Oe))return!1;var Et=(_t=_t||{actual:[],expected:[]}).actual.indexOf(Te);return Et!==-1&&Et===_t.expected.indexOf(Oe)||(_t.actual.push(Te),_t.expected.push(Oe),oe(Te,Oe,Be,_t))}return Be?Te===Oe:Te==Oe}function ce(Te){return Object.prototype.toString.call(Te)=="[object Arguments]"}function oe(Te,Oe,Be,_t){if(Te==null||Oe==null)return!1;if(F.isPrimitive(Te)||F.isPrimitive(Oe))return Te===Oe;if(Be&&Object.getPrototypeOf(Te)!==Object.getPrototypeOf(Oe))return!1;var Et=ce(Te),dt=ce(Oe);if(Et&&!dt||!Et&&dt)return!1;if(Et)return ne(Te=q.call(Te),Oe=q.call(Oe),Be);var Zt,Ye,bt=Fe(Te),Qt=Fe(Oe);if(bt.length!==Qt.length)return!1;for(bt.sort(),Qt.sort(),Ye=bt.length-1;Ye>=0;Ye--)if(bt[Ye]!==Qt[Ye])return!1;for(Ye=bt.length-1;Ye>=0;Ye--)if(!ne(Te[Zt=bt[Ye]],Oe[Zt],Be,_t))return!1;return!0}function de(Te,Oe,Be){ne(Te,Oe,!0)&&se(Te,Oe,Be,"notDeepStrictEqual",de)}function me(Te,Oe){if(!Te||!Oe)return!1;if(Object.prototype.toString.call(Oe)=="[object RegExp]")return Oe.test(Te);try{if(Te instanceof Oe)return!0}catch{}return!Error.isPrototypeOf(Oe)&&Oe.call({},Te)===!0}function ge(Te){var Oe;try{Te()}catch(Be){Oe=Be}return Oe}function fe(Te,Oe,Be,_t){var Et;if(typeof Oe!="function")throw new TypeError('"block" argument must be a function');typeof Be=="string"&&(_t=Be,Be=null),Et=ge(Oe),_t=(Be&&Be.name?" ("+Be.name+").":".")+(_t?" "+_t:"."),Te&&!Et&&se(Et,Be,"Missing expected exception"+_t);var dt=typeof _t=="string",Zt=!Te&&Et&&!Be;if((!Te&&F.isError(Et)&&dt&&me(Et,Be)||Zt)&&se(Et,Be,"Got unwanted exception"+_t),Te&&Et&&Be&&!me(Et,Be)||!Te&&Et)throw Et}function xe(Te,Oe){Te||se(Te,!0,Oe,"==",xe)}V.AssertionError=function(Te){this.name="AssertionError",this.actual=Te.actual,this.expected=Te.expected,this.operator=Te.operator,Te.message?(this.message=Te.message,this.generatedMessage=!1):(this.message=re(this),this.generatedMessage=!0);var Oe=Te.stackStartFunction||se;if(Error.captureStackTrace)Error.captureStackTrace(this,Oe);else{var Be=new Error;if(Be.stack){var _t=Be.stack,Et=Q(Oe),dt=_t.indexOf(`
`+Et);if(dt>=0){var Zt=_t.indexOf(`
`,dt+1);_t=_t.substring(Zt+1)}this.stack=_t}}},F.inherits(V.AssertionError,Error),V.fail=se,V.ok=X,V.equal=function(Te,Oe,Be){Te!=Oe&&se(Te,Oe,Be,"==",V.equal)},V.notEqual=function(Te,Oe,Be){Te==Oe&&se(Te,Oe,Be,"!=",V.notEqual)},V.deepEqual=function(Te,Oe,Be){ne(Te,Oe,!1)||se(Te,Oe,Be,"deepEqual",V.deepEqual)},V.deepStrictEqual=function(Te,Oe,Be){ne(Te,Oe,!0)||se(Te,Oe,Be,"deepStrictEqual",V.deepStrictEqual)},V.notDeepEqual=function(Te,Oe,Be){ne(Te,Oe,!1)&&se(Te,Oe,Be,"notDeepEqual",V.notDeepEqual)},V.notDeepStrictEqual=de,V.strictEqual=function(Te,Oe,Be){Te!==Oe&&se(Te,Oe,Be,"===",V.strictEqual)},V.notStrictEqual=function(Te,Oe,Be){Te===Oe&&se(Te,Oe,Be,"!==",V.notStrictEqual)},V.throws=function(Te,Oe,Be){fe(!0,Te,Oe,Be)},V.doesNotThrow=function(Te,Oe,Be){fe(!1,Te,Oe,Be)},V.ifError=function(Te){if(Te)throw Te},V.strict=$(xe,V,{equal:V.strictEqual,deepEqual:V.deepStrictEqual,notEqual:V.notStrictEqual,notDeepEqual:V.notDeepStrictEqual}),V.strict.strict=V.strict;var Fe=Object.keys||function(Te){var Oe=[];for(var Be in Te)U.call(Te,Be)&&Oe.push(Be);return Oe}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"object-assign":51,"util/":26}],24:[function(d,m,g){typeof Object.create=="function"?m.exports=function(w,$){w.super_=$,w.prototype=Object.create($.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}})}:m.exports=function(w,$){w.super_=$;var I=function(){};I.prototype=$.prototype,w.prototype=new I,w.prototype.constructor=w}},{}],25:[function(d,m,g){m.exports=function(w){return w&&typeof w=="object"&&typeof w.copy=="function"&&typeof w.fill=="function"&&typeof w.readUInt8=="function"}},{}],26:[function(d,m,g){(function(w,$){(function(){var I=/%[sdj%]/g;g.format=function(Ye){if(!oe(Ye)){for(var bt=[],Qt=0;Qt<arguments.length;Qt++)bt.push(U(arguments[Qt]));return bt.join(" ")}Qt=1;for(var Vt=arguments,ut=Vt.length,At=String(Ye).replace(I,(function(fr){if(fr==="%%")return"%";if(Qt>=ut)return fr;switch(fr){case"%s":return String(Vt[Qt++]);case"%d":return Number(Vt[Qt++]);case"%j":try{return JSON.stringify(Vt[Qt++])}catch{return"[Circular]"}default:return fr}})),dr=Vt[Qt];Qt<ut;dr=Vt[++Qt])X(dr)||!fe(dr)?At+=" "+dr:At+=" "+U(dr);return At},g.deprecate=function(Ye,bt){if(me($.process))return function(){return g.deprecate(Ye,bt).apply(this,arguments)};if(w.noDeprecation===!0)return Ye;var Qt=!1;function Vt(){if(!Qt){if(w.throwDeprecation)throw new Error(bt);w.traceDeprecation?console.trace(bt):console.error(bt),Qt=!0}return Ye.apply(this,arguments)}return Vt};var D,F={};function U(Ye,bt){var Qt={seen:[],stylize:j};return arguments.length>=3&&(Qt.depth=arguments[2]),arguments.length>=4&&(Qt.colors=arguments[3]),se(bt)?Qt.showHidden=bt:bt&&g._extend(Qt,bt),me(Qt.showHidden)&&(Qt.showHidden=!1),me(Qt.depth)&&(Qt.depth=2),me(Qt.colors)&&(Qt.colors=!1),me(Qt.customInspect)&&(Qt.customInspect=!0),Qt.colors&&(Qt.stylize=q),H(Qt,Ye,Qt.depth)}function q(Ye,bt){var Qt=U.styles[bt];return Qt?"\x1B["+U.colors[Qt][0]+"m"+Ye+"\x1B["+U.colors[Qt][1]+"m":Ye}function j(Ye,bt){return Ye}function G(Ye){var bt={};return Ye.forEach((function(Qt,Vt){bt[Qt]=!0})),bt}function H(Ye,bt,Qt){if(Ye.customInspect&&bt&&Te(bt.inspect)&&bt.inspect!==g.inspect&&(!bt.constructor||bt.constructor.prototype!==bt)){var Vt=bt.inspect(Qt,Ye);return oe(Vt)||(Vt=H(Ye,Vt,Qt)),Vt}var ut=V(Ye,bt);if(ut)return ut;var At=Object.keys(bt),dr=G(At);if(Ye.showHidden&&(At=Object.getOwnPropertyNames(bt)),Fe(bt)&&(At.indexOf("message")>=0||At.indexOf("description")>=0))return Z(bt);if(At.length===0){if(Te(bt)){var fr=bt.name?": "+bt.name:"";return Ye.stylize("[Function"+fr+"]","special")}if(ge(bt))return Ye.stylize(RegExp.prototype.toString.call(bt),"regexp");if(xe(bt))return Ye.stylize(Date.prototype.toString.call(bt),"date");if(Fe(bt))return Z(bt)}var pr,zt="",Ce=!1,Nt=["{","}"];return re(bt)&&(Ce=!0,Nt=["[","]"]),Te(bt)&&(zt=" [Function"+(bt.name?": "+bt.name:"")+"]"),ge(bt)&&(zt=" "+RegExp.prototype.toString.call(bt)),xe(bt)&&(zt=" "+Date.prototype.toUTCString.call(bt)),Fe(bt)&&(zt=" "+Z(bt)),At.length!==0||Ce&&bt.length!=0?Qt<0?ge(bt)?Ye.stylize(RegExp.prototype.toString.call(bt),"regexp"):Ye.stylize("[Object]","special"):(Ye.seen.push(bt),pr=Ce?Q(Ye,bt,Qt,dr,At):At.map((function(Xe){return J(Ye,bt,Qt,dr,Xe,Ce)})),Ye.seen.pop(),ie(pr,zt,Nt)):Nt[0]+zt+Nt[1]}function V(Ye,bt){if(me(bt))return Ye.stylize("undefined","undefined");if(oe(bt)){var Qt="'"+JSON.stringify(bt).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Ye.stylize(Qt,"string")}return ce(bt)?Ye.stylize(""+bt,"number"):se(bt)?Ye.stylize(""+bt,"boolean"):X(bt)?Ye.stylize("null","null"):void 0}function Z(Ye){return"["+Error.prototype.toString.call(Ye)+"]"}function Q(Ye,bt,Qt,Vt,ut){for(var At=[],dr=0,fr=bt.length;dr<fr;++dr)Zt(bt,String(dr))?At.push(J(Ye,bt,Qt,Vt,String(dr),!0)):At.push("");return ut.forEach((function(pr){pr.match(/^\d+$/)||At.push(J(Ye,bt,Qt,Vt,pr,!0))})),At}function J(Ye,bt,Qt,Vt,ut,At){var dr,fr,pr;if((pr=Object.getOwnPropertyDescriptor(bt,ut)||{value:bt[ut]}).get?fr=pr.set?Ye.stylize("[Getter/Setter]","special"):Ye.stylize("[Getter]","special"):pr.set&&(fr=Ye.stylize("[Setter]","special")),Zt(Vt,ut)||(dr="["+ut+"]"),fr||(Ye.seen.indexOf(pr.value)<0?(fr=X(Qt)?H(Ye,pr.value,null):H(Ye,pr.value,Qt-1)).indexOf(`
`)>-1&&(fr=At?fr.split(`
`).map((function(zt){return"  "+zt})).join(`
`).substr(2):`
`+fr.split(`
`).map((function(zt){return"   "+zt})).join(`
`)):fr=Ye.stylize("[Circular]","special")),me(dr)){if(At&&ut.match(/^\d+$/))return fr;(dr=JSON.stringify(""+ut)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(dr=dr.substr(1,dr.length-2),dr=Ye.stylize(dr,"name")):(dr=dr.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),dr=Ye.stylize(dr,"string"))}return dr+": "+fr}function ie(Ye,bt,Qt){return Ye.reduce((function(Vt,ut){return ut.indexOf(`
`),Vt+ut.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?Qt[0]+(bt===""?"":bt+`
 `)+" "+Ye.join(`,
  `)+" "+Qt[1]:Qt[0]+bt+" "+Ye.join(", ")+" "+Qt[1]}function re(Ye){return Array.isArray(Ye)}function se(Ye){return typeof Ye=="boolean"}function X(Ye){return Ye===null}function ne(Ye){return Ye==null}function ce(Ye){return typeof Ye=="number"}function oe(Ye){return typeof Ye=="string"}function de(Ye){return typeof Ye=="symbol"}function me(Ye){return Ye===void 0}function ge(Ye){return fe(Ye)&&Be(Ye)==="[object RegExp]"}function fe(Ye){return typeof Ye=="object"&&Ye!==null}function xe(Ye){return fe(Ye)&&Be(Ye)==="[object Date]"}function Fe(Ye){return fe(Ye)&&(Be(Ye)==="[object Error]"||Ye instanceof Error)}function Te(Ye){return typeof Ye=="function"}function Oe(Ye){return Ye===null||typeof Ye=="boolean"||typeof Ye=="number"||typeof Ye=="string"||typeof Ye=="symbol"||Ye===void 0}function Be(Ye){return Object.prototype.toString.call(Ye)}function _t(Ye){return Ye<10?"0"+Ye.toString(10):Ye.toString(10)}g.debuglog=function(Ye){if(me(D)&&(D=w.env.NODE_DEBUG||""),Ye=Ye.toUpperCase(),!F[Ye])if(new RegExp("\\b"+Ye+"\\b","i").test(D)){var bt=w.pid;F[Ye]=function(){var Qt=g.format.apply(g,arguments);console.error("%s %d: %s",Ye,bt,Qt)}}else F[Ye]=function(){};return F[Ye]},g.inspect=U,U.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},U.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},g.isArray=re,g.isBoolean=se,g.isNull=X,g.isNullOrUndefined=ne,g.isNumber=ce,g.isString=oe,g.isSymbol=de,g.isUndefined=me,g.isRegExp=ge,g.isObject=fe,g.isDate=xe,g.isError=Fe,g.isFunction=Te,g.isPrimitive=Oe,g.isBuffer=d("./support/isBuffer");var Et=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function dt(){var Ye=new Date,bt=[_t(Ye.getHours()),_t(Ye.getMinutes()),_t(Ye.getSeconds())].join(":");return[Ye.getDate(),Et[Ye.getMonth()],bt].join(" ")}function Zt(Ye,bt){return Object.prototype.hasOwnProperty.call(Ye,bt)}g.log=function(){console.log("%s - %s",dt(),g.format.apply(g,arguments))},g.inherits=d("inherits"),g._extend=function(Ye,bt){if(!bt||!fe(bt))return Ye;for(var Qt=Object.keys(bt),Vt=Qt.length;Vt--;)Ye[Qt[Vt]]=bt[Qt[Vt]];return Ye}}).call(this)}).call(this,d("_process"),commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"./support/isBuffer":25,_process:63,inherits:24}],27:[function(d,m,g){(function(w){(function(){var $=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],I=typeof globalThis>"u"?w:globalThis;m.exports=function(){for(var D=[],F=0;F<$.length;F++)typeof I[$[F]]=="function"&&(D[D.length]=$[F]);return D}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],28:[function(d,m,g){g.byteLength=j,g.toByteArray=H,g.fromByteArray=Q;for(var w=[],$=[],I=typeof Uint8Array<"u"?Uint8Array:Array,D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F=0,U=D.length;F<U;++F)w[F]=D[F],$[D.charCodeAt(F)]=F;function q(J){var ie=J.length;if(ie%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var re=J.indexOf("=");return re===-1&&(re=ie),[re,re===ie?0:4-re%4]}function j(J){var ie=q(J),re=ie[0],se=ie[1];return 3*(re+se)/4-se}function G(J,ie,re){return 3*(ie+re)/4-re}function H(J){var ie,re,se=q(J),X=se[0],ne=se[1],ce=new I(G(J,X,ne)),oe=0,de=ne>0?X-4:X;for(re=0;re<de;re+=4)ie=$[J.charCodeAt(re)]<<18|$[J.charCodeAt(re+1)]<<12|$[J.charCodeAt(re+2)]<<6|$[J.charCodeAt(re+3)],ce[oe++]=ie>>16&255,ce[oe++]=ie>>8&255,ce[oe++]=255&ie;return ne===2&&(ie=$[J.charCodeAt(re)]<<2|$[J.charCodeAt(re+1)]>>4,ce[oe++]=255&ie),ne===1&&(ie=$[J.charCodeAt(re)]<<10|$[J.charCodeAt(re+1)]<<4|$[J.charCodeAt(re+2)]>>2,ce[oe++]=ie>>8&255,ce[oe++]=255&ie),ce}function V(J){return w[J>>18&63]+w[J>>12&63]+w[J>>6&63]+w[63&J]}function Z(J,ie,re){for(var se,X=[],ne=ie;ne<re;ne+=3)se=(J[ne]<<16&16711680)+(J[ne+1]<<8&65280)+(255&J[ne+2]),X.push(V(se));return X.join("")}function Q(J){for(var ie,re=J.length,se=re%3,X=[],ne=16383,ce=0,oe=re-se;ce<oe;ce+=ne)X.push(Z(J,ce,ce+ne>oe?oe:ce+ne));return se===1?(ie=J[re-1],X.push(w[ie>>2]+w[ie<<4&63]+"==")):se===2&&(ie=(J[re-2]<<8)+J[re-1],X.push(w[ie>>10]+w[ie>>4&63]+w[ie<<2&63]+"=")),X.join("")}$[45]=62,$[95]=63},{}],29:[function(d,m,g){},{}],30:[function(d,m,g){(function(w,$){(function(){var I=d("assert"),D=d("pako/lib/zlib/zstream"),F=d("pako/lib/zlib/deflate.js"),U=d("pako/lib/zlib/inflate.js"),q=d("pako/lib/zlib/constants");for(var j in q)g[j]=q[j];g.NONE=0,g.DEFLATE=1,g.INFLATE=2,g.GZIP=3,g.GUNZIP=4,g.DEFLATERAW=5,g.INFLATERAW=6,g.UNZIP=7;var G=31,H=139;function V(Z){if(typeof Z!="number"||Z<g.DEFLATE||Z>g.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=Z,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}V.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,I(this.init_done,"close before init"),I(this.mode<=g.UNZIP),this.mode===g.DEFLATE||this.mode===g.GZIP||this.mode===g.DEFLATERAW?F.deflateEnd(this.strm):this.mode!==g.INFLATE&&this.mode!==g.GUNZIP&&this.mode!==g.INFLATERAW&&this.mode!==g.UNZIP||U.inflateEnd(this.strm),this.mode=g.NONE,this.dictionary=null)},V.prototype.write=function(Z,Q,J,ie,re,se,X){return this._write(!0,Z,Q,J,ie,re,se,X)},V.prototype.writeSync=function(Z,Q,J,ie,re,se,X){return this._write(!1,Z,Q,J,ie,re,se,X)},V.prototype._write=function(Z,Q,J,ie,re,se,X,ne){if(I.equal(arguments.length,8),I(this.init_done,"write before init"),I(this.mode!==g.NONE,"already finalized"),I.equal(!1,this.write_in_progress,"write already in progress"),I.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,I.equal(!1,Q===void 0,"must provide flush value"),this.write_in_progress=!0,Q!==g.Z_NO_FLUSH&&Q!==g.Z_PARTIAL_FLUSH&&Q!==g.Z_SYNC_FLUSH&&Q!==g.Z_FULL_FLUSH&&Q!==g.Z_FINISH&&Q!==g.Z_BLOCK)throw new Error("Invalid flush value");if(J==null&&(J=$.alloc(0),re=0,ie=0),this.strm.avail_in=re,this.strm.input=J,this.strm.next_in=ie,this.strm.avail_out=ne,this.strm.output=se,this.strm.next_out=X,this.flush=Q,!Z)return this._process(),this._checkError()?this._afterSync():void 0;var ce=this;return w.nextTick((function(){ce._process(),ce._after()})),this},V.prototype._afterSync=function(){var Z=this.strm.avail_out,Q=this.strm.avail_in;return this.write_in_progress=!1,[Q,Z]},V.prototype._process=function(){var Z=null;switch(this.mode){case g.DEFLATE:case g.GZIP:case g.DEFLATERAW:this.err=F.deflate(this.strm,this.flush);break;case g.UNZIP:switch(this.strm.avail_in>0&&(Z=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(Z===null)break;if(this.strm.input[Z]!==G){this.mode=g.INFLATE;break}if(this.gzip_id_bytes_read=1,Z++,this.strm.avail_in===1)break;case 1:if(Z===null)break;this.strm.input[Z]===H?(this.gzip_id_bytes_read=2,this.mode=g.GUNZIP):this.mode=g.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case g.INFLATE:case g.GUNZIP:case g.INFLATERAW:for(this.err=U.inflate(this.strm,this.flush),this.err===g.Z_NEED_DICT&&this.dictionary&&(this.err=U.inflateSetDictionary(this.strm,this.dictionary),this.err===g.Z_OK?this.err=U.inflate(this.strm,this.flush):this.err===g.Z_DATA_ERROR&&(this.err=g.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===g.GUNZIP&&this.err===g.Z_STREAM_END&&this.strm.next_in[0]!==0;)this.reset(),this.err=U.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},V.prototype._checkError=function(){switch(this.err){case g.Z_OK:case g.Z_BUF_ERROR:if(this.strm.avail_out!==0&&this.flush===g.Z_FINISH)return this._error("unexpected end of file"),!1;break;case g.Z_STREAM_END:break;case g.Z_NEED_DICT:return this.dictionary==null?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},V.prototype._after=function(){if(this._checkError()){var Z=this.strm.avail_out,Q=this.strm.avail_in;this.write_in_progress=!1,this.callback(Q,Z),this.pending_close&&this.close()}},V.prototype._error=function(Z){this.strm.msg&&(Z=this.strm.msg),this.onerror(Z,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},V.prototype.init=function(Z,Q,J,ie,re){I(arguments.length===4||arguments.length===5,"init(windowBits, level, memLevel, strategy, [dictionary])"),I(Z>=8&&Z<=15,"invalid windowBits"),I(Q>=-1&&Q<=9,"invalid compression level"),I(J>=1&&J<=9,"invalid memlevel"),I(ie===g.Z_FILTERED||ie===g.Z_HUFFMAN_ONLY||ie===g.Z_RLE||ie===g.Z_FIXED||ie===g.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(Q,Z,J,ie,re),this._setDictionary()},V.prototype.params=function(){throw new Error("deflateParams Not supported")},V.prototype.reset=function(){this._reset(),this._setDictionary()},V.prototype._init=function(Z,Q,J,ie,re){switch(this.level=Z,this.windowBits=Q,this.memLevel=J,this.strategy=ie,this.flush=g.Z_NO_FLUSH,this.err=g.Z_OK,this.mode!==g.GZIP&&this.mode!==g.GUNZIP||(this.windowBits+=16),this.mode===g.UNZIP&&(this.windowBits+=32),this.mode!==g.DEFLATERAW&&this.mode!==g.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new D,this.mode){case g.DEFLATE:case g.GZIP:case g.DEFLATERAW:this.err=F.deflateInit2(this.strm,this.level,g.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case g.INFLATE:case g.GUNZIP:case g.INFLATERAW:case g.UNZIP:this.err=U.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==g.Z_OK&&this._error("Init error"),this.dictionary=re,this.write_in_progress=!1,this.init_done=!0},V.prototype._setDictionary=function(){if(this.dictionary!=null){switch(this.err=g.Z_OK,this.mode){case g.DEFLATE:case g.DEFLATERAW:this.err=F.deflateSetDictionary(this.strm,this.dictionary)}this.err!==g.Z_OK&&this._error("Failed to set dictionary")}},V.prototype._reset=function(){switch(this.err=g.Z_OK,this.mode){case g.DEFLATE:case g.DEFLATERAW:case g.GZIP:this.err=F.deflateReset(this.strm);break;case g.INFLATE:case g.INFLATERAW:case g.GUNZIP:this.err=U.inflateReset(this.strm)}this.err!==g.Z_OK&&this._error("Failed to reset stream")},g.Zlib=V}).call(this)}).call(this,d("_process"),d("buffer").Buffer)},{_process:63,assert:23,buffer:32,"pako/lib/zlib/constants":54,"pako/lib/zlib/deflate.js":56,"pako/lib/zlib/inflate.js":58,"pako/lib/zlib/zstream":62}],31:[function(d,m,g){(function(w){(function(){var $=d("buffer").Buffer,I=d("stream").Transform,D=d("./binding"),F=d("util"),U=d("assert").ok,q=d("buffer").kMaxLength,j="Cannot create final Buffer. It would be larger than 0x"+q.toString(16)+" bytes";D.Z_MIN_WINDOWBITS=8,D.Z_MAX_WINDOWBITS=15,D.Z_DEFAULT_WINDOWBITS=15,D.Z_MIN_CHUNK=64,D.Z_MAX_CHUNK=1/0,D.Z_DEFAULT_CHUNK=16384,D.Z_MIN_MEMLEVEL=1,D.Z_MAX_MEMLEVEL=9,D.Z_DEFAULT_MEMLEVEL=8,D.Z_MIN_LEVEL=-1,D.Z_MAX_LEVEL=9,D.Z_DEFAULT_LEVEL=D.Z_DEFAULT_COMPRESSION;for(var G=Object.keys(D),H=0;H<G.length;H++){var V=G[H];V.match(/^Z/)&&Object.defineProperty(g,V,{enumerable:!0,value:D[V],writable:!1})}for(var Z={Z_OK:D.Z_OK,Z_STREAM_END:D.Z_STREAM_END,Z_NEED_DICT:D.Z_NEED_DICT,Z_ERRNO:D.Z_ERRNO,Z_STREAM_ERROR:D.Z_STREAM_ERROR,Z_DATA_ERROR:D.Z_DATA_ERROR,Z_MEM_ERROR:D.Z_MEM_ERROR,Z_BUF_ERROR:D.Z_BUF_ERROR,Z_VERSION_ERROR:D.Z_VERSION_ERROR},Q=Object.keys(Z),J=0;J<Q.length;J++){var ie=Q[J];Z[Z[ie]]=ie}function re(Oe,Be,_t){var Et=[],dt=0;function Zt(){for(var Qt;(Qt=Oe.read())!==null;)Et.push(Qt),dt+=Qt.length;Oe.once("readable",Zt)}function Ye(Qt){Oe.removeListener("end",bt),Oe.removeListener("readable",Zt),_t(Qt)}function bt(){var Qt,Vt=null;dt>=q?Vt=new RangeError(j):Qt=$.concat(Et,dt),Et=[],Oe.close(),_t(Vt,Qt)}Oe.on("error",Ye),Oe.on("end",bt),Oe.end(Be),Zt()}function se(Oe,Be){if(typeof Be=="string"&&(Be=$.from(Be)),!$.isBuffer(Be))throw new TypeError("Not a string or buffer");var _t=Oe._finishFlushFlag;return Oe._processChunk(Be,_t)}function X(Oe){if(!(this instanceof X))return new X(Oe);xe.call(this,Oe,D.DEFLATE)}function ne(Oe){if(!(this instanceof ne))return new ne(Oe);xe.call(this,Oe,D.INFLATE)}function ce(Oe){if(!(this instanceof ce))return new ce(Oe);xe.call(this,Oe,D.GZIP)}function oe(Oe){if(!(this instanceof oe))return new oe(Oe);xe.call(this,Oe,D.GUNZIP)}function de(Oe){if(!(this instanceof de))return new de(Oe);xe.call(this,Oe,D.DEFLATERAW)}function me(Oe){if(!(this instanceof me))return new me(Oe);xe.call(this,Oe,D.INFLATERAW)}function ge(Oe){if(!(this instanceof ge))return new ge(Oe);xe.call(this,Oe,D.UNZIP)}function fe(Oe){return Oe===D.Z_NO_FLUSH||Oe===D.Z_PARTIAL_FLUSH||Oe===D.Z_SYNC_FLUSH||Oe===D.Z_FULL_FLUSH||Oe===D.Z_FINISH||Oe===D.Z_BLOCK}function xe(Oe,Be){var _t=this;if(this._opts=Oe=Oe||{},this._chunkSize=Oe.chunkSize||g.Z_DEFAULT_CHUNK,I.call(this,Oe),Oe.flush&&!fe(Oe.flush))throw new Error("Invalid flush flag: "+Oe.flush);if(Oe.finishFlush&&!fe(Oe.finishFlush))throw new Error("Invalid flush flag: "+Oe.finishFlush);if(this._flushFlag=Oe.flush||D.Z_NO_FLUSH,this._finishFlushFlag=Oe.finishFlush!==void 0?Oe.finishFlush:D.Z_FINISH,Oe.chunkSize&&(Oe.chunkSize<g.Z_MIN_CHUNK||Oe.chunkSize>g.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+Oe.chunkSize);if(Oe.windowBits&&(Oe.windowBits<g.Z_MIN_WINDOWBITS||Oe.windowBits>g.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+Oe.windowBits);if(Oe.level&&(Oe.level<g.Z_MIN_LEVEL||Oe.level>g.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+Oe.level);if(Oe.memLevel&&(Oe.memLevel<g.Z_MIN_MEMLEVEL||Oe.memLevel>g.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+Oe.memLevel);if(Oe.strategy&&Oe.strategy!=g.Z_FILTERED&&Oe.strategy!=g.Z_HUFFMAN_ONLY&&Oe.strategy!=g.Z_RLE&&Oe.strategy!=g.Z_FIXED&&Oe.strategy!=g.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+Oe.strategy);if(Oe.dictionary&&!$.isBuffer(Oe.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new D.Zlib(Be);var Et=this;this._hadError=!1,this._handle.onerror=function(Ye,bt){Fe(Et),Et._hadError=!0;var Qt=new Error(Ye);Qt.errno=bt,Qt.code=g.codes[bt],Et.emit("error",Qt)};var dt=g.Z_DEFAULT_COMPRESSION;typeof Oe.level=="number"&&(dt=Oe.level);var Zt=g.Z_DEFAULT_STRATEGY;typeof Oe.strategy=="number"&&(Zt=Oe.strategy),this._handle.init(Oe.windowBits||g.Z_DEFAULT_WINDOWBITS,dt,Oe.memLevel||g.Z_DEFAULT_MEMLEVEL,Zt,Oe.dictionary),this._buffer=$.allocUnsafe(this._chunkSize),this._offset=0,this._level=dt,this._strategy=Zt,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!_t._handle},configurable:!0,enumerable:!0})}function Fe(Oe,Be){Be&&w.nextTick(Be),Oe._handle&&(Oe._handle.close(),Oe._handle=null)}function Te(Oe){Oe.emit("close")}Object.defineProperty(g,"codes",{enumerable:!0,value:Object.freeze(Z),writable:!1}),g.Deflate=X,g.Inflate=ne,g.Gzip=ce,g.Gunzip=oe,g.DeflateRaw=de,g.InflateRaw=me,g.Unzip=ge,g.createDeflate=function(Oe){return new X(Oe)},g.createInflate=function(Oe){return new ne(Oe)},g.createDeflateRaw=function(Oe){return new de(Oe)},g.createInflateRaw=function(Oe){return new me(Oe)},g.createGzip=function(Oe){return new ce(Oe)},g.createGunzip=function(Oe){return new oe(Oe)},g.createUnzip=function(Oe){return new ge(Oe)},g.deflate=function(Oe,Be,_t){return typeof Be=="function"&&(_t=Be,Be={}),re(new X(Be),Oe,_t)},g.deflateSync=function(Oe,Be){return se(new X(Be),Oe)},g.gzip=function(Oe,Be,_t){return typeof Be=="function"&&(_t=Be,Be={}),re(new ce(Be),Oe,_t)},g.gzipSync=function(Oe,Be){return se(new ce(Be),Oe)},g.deflateRaw=function(Oe,Be,_t){return typeof Be=="function"&&(_t=Be,Be={}),re(new de(Be),Oe,_t)},g.deflateRawSync=function(Oe,Be){return se(new de(Be),Oe)},g.unzip=function(Oe,Be,_t){return typeof Be=="function"&&(_t=Be,Be={}),re(new ge(Be),Oe,_t)},g.unzipSync=function(Oe,Be){return se(new ge(Be),Oe)},g.inflate=function(Oe,Be,_t){return typeof Be=="function"&&(_t=Be,Be={}),re(new ne(Be),Oe,_t)},g.inflateSync=function(Oe,Be){return se(new ne(Be),Oe)},g.gunzip=function(Oe,Be,_t){return typeof Be=="function"&&(_t=Be,Be={}),re(new oe(Be),Oe,_t)},g.gunzipSync=function(Oe,Be){return se(new oe(Be),Oe)},g.inflateRaw=function(Oe,Be,_t){return typeof Be=="function"&&(_t=Be,Be={}),re(new me(Be),Oe,_t)},g.inflateRawSync=function(Oe,Be){return se(new me(Be),Oe)},F.inherits(xe,I),xe.prototype.params=function(Oe,Be,_t){if(Oe<g.Z_MIN_LEVEL||Oe>g.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+Oe);if(Be!=g.Z_FILTERED&&Be!=g.Z_HUFFMAN_ONLY&&Be!=g.Z_RLE&&Be!=g.Z_FIXED&&Be!=g.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+Be);if(this._level!==Oe||this._strategy!==Be){var Et=this;this.flush(D.Z_SYNC_FLUSH,(function(){U(Et._handle,"zlib binding closed"),Et._handle.params(Oe,Be),Et._hadError||(Et._level=Oe,Et._strategy=Be,_t&&_t())}))}else w.nextTick(_t)},xe.prototype.reset=function(){return U(this._handle,"zlib binding closed"),this._handle.reset()},xe.prototype._flush=function(Oe){this._transform($.alloc(0),"",Oe)},xe.prototype.flush=function(Oe,Be){var _t=this,Et=this._writableState;(typeof Oe=="function"||Oe===void 0&&!Be)&&(Be=Oe,Oe=D.Z_FULL_FLUSH),Et.ended?Be&&w.nextTick(Be):Et.ending?Be&&this.once("end",Be):Et.needDrain?Be&&this.once("drain",(function(){return _t.flush(Oe,Be)})):(this._flushFlag=Oe,this.write($.alloc(0),"",Be))},xe.prototype.close=function(Oe){Fe(this,Oe),w.nextTick(Te,this)},xe.prototype._transform=function(Oe,Be,_t){var Et,dt=this._writableState,Zt=(dt.ending||dt.ended)&&(!Oe||dt.length===Oe.length);return Oe===null||$.isBuffer(Oe)?this._handle?(Zt?Et=this._finishFlushFlag:(Et=this._flushFlag,Oe.length>=dt.length&&(this._flushFlag=this._opts.flush||D.Z_NO_FLUSH)),void this._processChunk(Oe,Et,_t)):_t(new Error("zlib binding closed")):_t(new Error("invalid input"))},xe.prototype._processChunk=function(Oe,Be,_t){var Et=Oe&&Oe.length,dt=this._chunkSize-this._offset,Zt=0,Ye=this,bt=typeof _t=="function";if(!bt){var Qt,Vt=[],ut=0;this.on("error",(function(zt){Qt=zt})),U(this._handle,"zlib binding closed");do var At=this._handle.writeSync(Be,Oe,Zt,Et,this._buffer,this._offset,dt);while(!this._hadError&&pr(At[0],At[1]));if(this._hadError)throw Qt;if(ut>=q)throw Fe(this),new RangeError(j);var dr=$.concat(Vt,ut);return Fe(this),dr}U(this._handle,"zlib binding closed");var fr=this._handle.write(Be,Oe,Zt,Et,this._buffer,this._offset,dt);function pr(zt,Ce){if(this&&(this.buffer=null,this.callback=null),!Ye._hadError){var Nt=dt-Ce;if(U(Nt>=0,"have should not go down"),Nt>0){var Xe=Ye._buffer.slice(Ye._offset,Ye._offset+Nt);Ye._offset+=Nt,bt?Ye.push(Xe):(Vt.push(Xe),ut+=Xe.length)}if((Ce===0||Ye._offset>=Ye._chunkSize)&&(dt=Ye._chunkSize,Ye._offset=0,Ye._buffer=$.allocUnsafe(Ye._chunkSize)),Ce===0){if(Zt+=Et-zt,Et=zt,!bt)return!0;var lt=Ye._handle.write(Be,Oe,Zt,Et,Ye._buffer,Ye._offset,Ye._chunkSize);return lt.callback=pr,void(lt.buffer=Oe)}if(!bt)return!1;_t()}}fr.buffer=Oe,fr.callback=pr},F.inherits(X,xe),F.inherits(ne,xe),F.inherits(ce,xe),F.inherits(oe,xe),F.inherits(de,xe),F.inherits(me,xe),F.inherits(ge,xe)}).call(this)}).call(this,d("_process"))},{"./binding":30,_process:63,assert:23,buffer:32,stream:65,util:84}],32:[function(d,m,g){(function(w){(function(){var $=d("base64-js"),I=d("ieee754");g.Buffer=q,g.SlowBuffer=se,g.INSPECT_MAX_BYTES=50;var D=2147483647;function F(){try{var $e=new Uint8Array(1);return $e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},$e.foo()===42}catch{return!1}}function U($e){if($e>D)throw new RangeError('The value "'+$e+'" is invalid for option "size"');var ze=new Uint8Array($e);return ze.__proto__=q.prototype,ze}function q($e,ze,ft){if(typeof $e=="number"){if(typeof ze=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return V($e)}return j($e,ze,ft)}function j($e,ze,ft){if(typeof $e=="string")return Z($e,ze);if(ArrayBuffer.isView($e))return Q($e);if($e==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof $e);if(yt($e,ArrayBuffer)||$e&&yt($e.buffer,ArrayBuffer))return J($e,ze,ft);if(typeof $e=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var ht=$e.valueOf&&$e.valueOf();if(ht!=null&&ht!==$e)return q.from(ht,ze,ft);var gr=ie($e);if(gr)return gr;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof $e[Symbol.toPrimitive]=="function")return q.from($e[Symbol.toPrimitive]("string"),ze,ft);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof $e)}function G($e){if(typeof $e!="number")throw new TypeError('"size" argument must be of type number');if($e<0)throw new RangeError('The value "'+$e+'" is invalid for option "size"')}function H($e,ze,ft){return G($e),$e<=0?U($e):ze!==void 0?typeof ft=="string"?U($e).fill(ze,ft):U($e).fill(ze):U($e)}function V($e){return G($e),U($e<0?0:0|re($e))}function Z($e,ze){if(typeof ze=="string"&&ze!==""||(ze="utf8"),!q.isEncoding(ze))throw new TypeError("Unknown encoding: "+ze);var ft=0|X($e,ze),ht=U(ft),gr=ht.write($e,ze);return gr!==ft&&(ht=ht.slice(0,gr)),ht}function Q($e){for(var ze=$e.length<0?0:0|re($e.length),ft=U(ze),ht=0;ht<ze;ht+=1)ft[ht]=255&$e[ht];return ft}function J($e,ze,ft){if(ze<0||$e.byteLength<ze)throw new RangeError('"offset" is outside of buffer bounds');if($e.byteLength<ze+(ft||0))throw new RangeError('"length" is outside of buffer bounds');var ht;return(ht=ze===void 0&&ft===void 0?new Uint8Array($e):ft===void 0?new Uint8Array($e,ze):new Uint8Array($e,ze,ft)).__proto__=q.prototype,ht}function ie($e){if(q.isBuffer($e)){var ze=0|re($e.length),ft=U(ze);return ft.length===0||$e.copy(ft,0,0,ze),ft}return $e.length!==void 0?typeof $e.length!="number"||Yt($e.length)?U(0):Q($e):$e.type==="Buffer"&&Array.isArray($e.data)?Q($e.data):void 0}function re($e){if($e>=D)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+D.toString(16)+" bytes");return 0|$e}function se($e){return+$e!=$e&&($e=0),q.alloc(+$e)}function X($e,ze){if(q.isBuffer($e))return $e.length;if(ArrayBuffer.isView($e)||yt($e,ArrayBuffer))return $e.byteLength;if(typeof $e!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof $e);var ft=$e.length,ht=arguments.length>2&&arguments[2]===!0;if(!ht&&ft===0)return 0;for(var gr=!1;;)switch(ze){case"ascii":case"latin1":case"binary":return ft;case"utf8":case"utf-8":return Ce($e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*ft;case"hex":return ft>>>1;case"base64":return lt($e).length;default:if(gr)return ht?-1:Ce($e).length;ze=(""+ze).toLowerCase(),gr=!0}}function ne($e,ze,ft){var ht=!1;if((ze===void 0||ze<0)&&(ze=0),ze>this.length||((ft===void 0||ft>this.length)&&(ft=this.length),ft<=0)||(ft>>>=0)<=(ze>>>=0))return"";for($e||($e="utf8");;)switch($e){case"hex":return Ye(this,ze,ft);case"utf8":case"utf-8":return Be(this,ze,ft);case"ascii":return dt(this,ze,ft);case"latin1":case"binary":return Zt(this,ze,ft);case"base64":return Oe(this,ze,ft);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,ze,ft);default:if(ht)throw new TypeError("Unknown encoding: "+$e);$e=($e+"").toLowerCase(),ht=!0}}function ce($e,ze,ft){var ht=$e[ze];$e[ze]=$e[ft],$e[ft]=ht}function oe($e,ze,ft,ht,gr){if($e.length===0)return-1;if(typeof ft=="string"?(ht=ft,ft=0):ft>2147483647?ft=2147483647:ft<-2147483648&&(ft=-2147483648),Yt(ft=+ft)&&(ft=gr?0:$e.length-1),ft<0&&(ft=$e.length+ft),ft>=$e.length){if(gr)return-1;ft=$e.length-1}else if(ft<0){if(!gr)return-1;ft=0}if(typeof ze=="string"&&(ze=q.from(ze,ht)),q.isBuffer(ze))return ze.length===0?-1:de($e,ze,ft,ht,gr);if(typeof ze=="number")return ze&=255,typeof Uint8Array.prototype.indexOf=="function"?gr?Uint8Array.prototype.indexOf.call($e,ze,ft):Uint8Array.prototype.lastIndexOf.call($e,ze,ft):de($e,[ze],ft,ht,gr);throw new TypeError("val must be string, number or Buffer")}function de($e,ze,ft,ht,gr){var yr,li=1,fi=$e.length,ai=ze.length;if(ht!==void 0&&((ht=String(ht).toLowerCase())==="ucs2"||ht==="ucs-2"||ht==="utf16le"||ht==="utf-16le")){if($e.length<2||ze.length<2)return-1;li=2,fi/=2,ai/=2,ft/=2}function hi(_i,ki){return li===1?_i[ki]:_i.readUInt16BE(ki*li)}if(gr){var ui=-1;for(yr=ft;yr<fi;yr++)if(hi($e,yr)===hi(ze,ui===-1?0:yr-ui)){if(ui===-1&&(ui=yr),yr-ui+1===ai)return ui*li}else ui!==-1&&(yr-=yr-ui),ui=-1}else for(ft+ai>fi&&(ft=fi-ai),yr=ft;yr>=0;yr--){for(var vi=!0,bi=0;bi<ai;bi++)if(hi($e,yr+bi)!==hi(ze,bi)){vi=!1;break}if(vi)return yr}return-1}function me($e,ze,ft,ht){ft=Number(ft)||0;var gr=$e.length-ft;ht?(ht=Number(ht))>gr&&(ht=gr):ht=gr;var yr=ze.length;ht>yr/2&&(ht=yr/2);for(var li=0;li<ht;++li){var fi=parseInt(ze.substr(2*li,2),16);if(Yt(fi))return li;$e[ft+li]=fi}return li}function ge($e,ze,ft,ht){return st(Ce(ze,$e.length-ft),$e,ft,ht)}function fe($e,ze,ft,ht){return st(Nt(ze),$e,ft,ht)}function xe($e,ze,ft,ht){return fe($e,ze,ft,ht)}function Fe($e,ze,ft,ht){return st(lt(ze),$e,ft,ht)}function Te($e,ze,ft,ht){return st(Xe(ze,$e.length-ft),$e,ft,ht)}function Oe($e,ze,ft){return ze===0&&ft===$e.length?$.fromByteArray($e):$.fromByteArray($e.slice(ze,ft))}function Be($e,ze,ft){ft=Math.min($e.length,ft);for(var ht=[],gr=ze;gr<ft;){var yr,li,fi,ai,hi=$e[gr],ui=null,vi=hi>239?4:hi>223?3:hi>191?2:1;if(gr+vi<=ft)switch(vi){case 1:hi<128&&(ui=hi);break;case 2:(192&(yr=$e[gr+1]))==128&&(ai=(31&hi)<<6|63&yr)>127&&(ui=ai);break;case 3:yr=$e[gr+1],li=$e[gr+2],(192&yr)==128&&(192&li)==128&&(ai=(15&hi)<<12|(63&yr)<<6|63&li)>2047&&(ai<55296||ai>57343)&&(ui=ai);break;case 4:yr=$e[gr+1],li=$e[gr+2],fi=$e[gr+3],(192&yr)==128&&(192&li)==128&&(192&fi)==128&&(ai=(15&hi)<<18|(63&yr)<<12|(63&li)<<6|63&fi)>65535&&ai<1114112&&(ui=ai)}ui===null?(ui=65533,vi=1):ui>65535&&(ui-=65536,ht.push(ui>>>10&1023|55296),ui=56320|1023&ui),ht.push(ui),gr+=vi}return Et(ht)}g.kMaxLength=D,q.TYPED_ARRAY_SUPPORT=F(),q.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(q.prototype,"parent",{enumerable:!0,get:function(){if(q.isBuffer(this))return this.buffer}}),Object.defineProperty(q.prototype,"offset",{enumerable:!0,get:function(){if(q.isBuffer(this))return this.byteOffset}}),typeof Symbol<"u"&&Symbol.species!=null&&q[Symbol.species]===q&&Object.defineProperty(q,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),q.poolSize=8192,q.from=function($e,ze,ft){return j($e,ze,ft)},q.prototype.__proto__=Uint8Array.prototype,q.__proto__=Uint8Array,q.alloc=function($e,ze,ft){return H($e,ze,ft)},q.allocUnsafe=function($e){return V($e)},q.allocUnsafeSlow=function($e){return V($e)},q.isBuffer=function($e){return $e!=null&&$e._isBuffer===!0&&$e!==q.prototype},q.compare=function($e,ze){if(yt($e,Uint8Array)&&($e=q.from($e,$e.offset,$e.byteLength)),yt(ze,Uint8Array)&&(ze=q.from(ze,ze.offset,ze.byteLength)),!q.isBuffer($e)||!q.isBuffer(ze))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if($e===ze)return 0;for(var ft=$e.length,ht=ze.length,gr=0,yr=Math.min(ft,ht);gr<yr;++gr)if($e[gr]!==ze[gr]){ft=$e[gr],ht=ze[gr];break}return ft<ht?-1:ht<ft?1:0},q.isEncoding=function($e){switch(String($e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},q.concat=function($e,ze){if(!Array.isArray($e))throw new TypeError('"list" argument must be an Array of Buffers');if($e.length===0)return q.alloc(0);var ft;if(ze===void 0)for(ze=0,ft=0;ft<$e.length;++ft)ze+=$e[ft].length;var ht=q.allocUnsafe(ze),gr=0;for(ft=0;ft<$e.length;++ft){var yr=$e[ft];if(yt(yr,Uint8Array)&&(yr=q.from(yr)),!q.isBuffer(yr))throw new TypeError('"list" argument must be an Array of Buffers');yr.copy(ht,gr),gr+=yr.length}return ht},q.byteLength=X,q.prototype._isBuffer=!0,q.prototype.swap16=function(){var $e=this.length;if($e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var ze=0;ze<$e;ze+=2)ce(this,ze,ze+1);return this},q.prototype.swap32=function(){var $e=this.length;if($e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var ze=0;ze<$e;ze+=4)ce(this,ze,ze+3),ce(this,ze+1,ze+2);return this},q.prototype.swap64=function(){var $e=this.length;if($e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var ze=0;ze<$e;ze+=8)ce(this,ze,ze+7),ce(this,ze+1,ze+6),ce(this,ze+2,ze+5),ce(this,ze+3,ze+4);return this},q.prototype.toString=function(){var $e=this.length;return $e===0?"":arguments.length===0?Be(this,0,$e):ne.apply(this,arguments)},q.prototype.toLocaleString=q.prototype.toString,q.prototype.equals=function($e){if(!q.isBuffer($e))throw new TypeError("Argument must be a Buffer");return this===$e||q.compare(this,$e)===0},q.prototype.inspect=function(){var $e="",ze=g.INSPECT_MAX_BYTES;return $e=this.toString("hex",0,ze).replace(/(.{2})/g,"$1 ").trim(),this.length>ze&&($e+=" ... "),"<Buffer "+$e+">"},q.prototype.compare=function($e,ze,ft,ht,gr){if(yt($e,Uint8Array)&&($e=q.from($e,$e.offset,$e.byteLength)),!q.isBuffer($e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof $e);if(ze===void 0&&(ze=0),ft===void 0&&(ft=$e?$e.length:0),ht===void 0&&(ht=0),gr===void 0&&(gr=this.length),ze<0||ft>$e.length||ht<0||gr>this.length)throw new RangeError("out of range index");if(ht>=gr&&ze>=ft)return 0;if(ht>=gr)return-1;if(ze>=ft)return 1;if(this===$e)return 0;for(var yr=(gr>>>=0)-(ht>>>=0),li=(ft>>>=0)-(ze>>>=0),fi=Math.min(yr,li),ai=this.slice(ht,gr),hi=$e.slice(ze,ft),ui=0;ui<fi;++ui)if(ai[ui]!==hi[ui]){yr=ai[ui],li=hi[ui];break}return yr<li?-1:li<yr?1:0},q.prototype.includes=function($e,ze,ft){return this.indexOf($e,ze,ft)!==-1},q.prototype.indexOf=function($e,ze,ft){return oe(this,$e,ze,ft,!0)},q.prototype.lastIndexOf=function($e,ze,ft){return oe(this,$e,ze,ft,!1)},q.prototype.write=function($e,ze,ft,ht){if(ze===void 0)ht="utf8",ft=this.length,ze=0;else if(ft===void 0&&typeof ze=="string")ht=ze,ft=this.length,ze=0;else{if(!isFinite(ze))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");ze>>>=0,isFinite(ft)?(ft>>>=0,ht===void 0&&(ht="utf8")):(ht=ft,ft=void 0)}var gr=this.length-ze;if((ft===void 0||ft>gr)&&(ft=gr),$e.length>0&&(ft<0||ze<0)||ze>this.length)throw new RangeError("Attempt to write outside buffer bounds");ht||(ht="utf8");for(var yr=!1;;)switch(ht){case"hex":return me(this,$e,ze,ft);case"utf8":case"utf-8":return ge(this,$e,ze,ft);case"ascii":return fe(this,$e,ze,ft);case"latin1":case"binary":return xe(this,$e,ze,ft);case"base64":return Fe(this,$e,ze,ft);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Te(this,$e,ze,ft);default:if(yr)throw new TypeError("Unknown encoding: "+ht);ht=(""+ht).toLowerCase(),yr=!0}},q.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _t=4096;function Et($e){var ze=$e.length;if(ze<=_t)return String.fromCharCode.apply(String,$e);for(var ft="",ht=0;ht<ze;)ft+=String.fromCharCode.apply(String,$e.slice(ht,ht+=_t));return ft}function dt($e,ze,ft){var ht="";ft=Math.min($e.length,ft);for(var gr=ze;gr<ft;++gr)ht+=String.fromCharCode(127&$e[gr]);return ht}function Zt($e,ze,ft){var ht="";ft=Math.min($e.length,ft);for(var gr=ze;gr<ft;++gr)ht+=String.fromCharCode($e[gr]);return ht}function Ye($e,ze,ft){var ht=$e.length;(!ze||ze<0)&&(ze=0),(!ft||ft<0||ft>ht)&&(ft=ht);for(var gr="",yr=ze;yr<ft;++yr)gr+=zt($e[yr]);return gr}function bt($e,ze,ft){for(var ht=$e.slice(ze,ft),gr="",yr=0;yr<ht.length;yr+=2)gr+=String.fromCharCode(ht[yr]+256*ht[yr+1]);return gr}function Qt($e,ze,ft){if($e%1!=0||$e<0)throw new RangeError("offset is not uint");if($e+ze>ft)throw new RangeError("Trying to access beyond buffer length")}function Vt($e,ze,ft,ht,gr,yr){if(!q.isBuffer($e))throw new TypeError('"buffer" argument must be a Buffer instance');if(ze>gr||ze<yr)throw new RangeError('"value" argument is out of bounds');if(ft+ht>$e.length)throw new RangeError("Index out of range")}function ut($e,ze,ft,ht,gr,yr){if(ft+ht>$e.length)throw new RangeError("Index out of range");if(ft<0)throw new RangeError("Index out of range")}function At($e,ze,ft,ht,gr){return ze=+ze,ft>>>=0,gr||ut($e,ze,ft,4),I.write($e,ze,ft,ht,23,4),ft+4}function dr($e,ze,ft,ht,gr){return ze=+ze,ft>>>=0,gr||ut($e,ze,ft,8),I.write($e,ze,ft,ht,52,8),ft+8}q.prototype.slice=function($e,ze){var ft=this.length;($e=~~$e)<0?($e+=ft)<0&&($e=0):$e>ft&&($e=ft),(ze=ze===void 0?ft:~~ze)<0?(ze+=ft)<0&&(ze=0):ze>ft&&(ze=ft),ze<$e&&(ze=$e);var ht=this.subarray($e,ze);return ht.__proto__=q.prototype,ht},q.prototype.readUIntLE=function($e,ze,ft){$e>>>=0,ze>>>=0,ft||Qt($e,ze,this.length);for(var ht=this[$e],gr=1,yr=0;++yr<ze&&(gr*=256);)ht+=this[$e+yr]*gr;return ht},q.prototype.readUIntBE=function($e,ze,ft){$e>>>=0,ze>>>=0,ft||Qt($e,ze,this.length);for(var ht=this[$e+--ze],gr=1;ze>0&&(gr*=256);)ht+=this[$e+--ze]*gr;return ht},q.prototype.readUInt8=function($e,ze){return $e>>>=0,ze||Qt($e,1,this.length),this[$e]},q.prototype.readUInt16LE=function($e,ze){return $e>>>=0,ze||Qt($e,2,this.length),this[$e]|this[$e+1]<<8},q.prototype.readUInt16BE=function($e,ze){return $e>>>=0,ze||Qt($e,2,this.length),this[$e]<<8|this[$e+1]},q.prototype.readUInt32LE=function($e,ze){return $e>>>=0,ze||Qt($e,4,this.length),(this[$e]|this[$e+1]<<8|this[$e+2]<<16)+16777216*this[$e+3]},q.prototype.readUInt32BE=function($e,ze){return $e>>>=0,ze||Qt($e,4,this.length),16777216*this[$e]+(this[$e+1]<<16|this[$e+2]<<8|this[$e+3])},q.prototype.readIntLE=function($e,ze,ft){$e>>>=0,ze>>>=0,ft||Qt($e,ze,this.length);for(var ht=this[$e],gr=1,yr=0;++yr<ze&&(gr*=256);)ht+=this[$e+yr]*gr;return ht>=(gr*=128)&&(ht-=Math.pow(2,8*ze)),ht},q.prototype.readIntBE=function($e,ze,ft){$e>>>=0,ze>>>=0,ft||Qt($e,ze,this.length);for(var ht=ze,gr=1,yr=this[$e+--ht];ht>0&&(gr*=256);)yr+=this[$e+--ht]*gr;return yr>=(gr*=128)&&(yr-=Math.pow(2,8*ze)),yr},q.prototype.readInt8=function($e,ze){return $e>>>=0,ze||Qt($e,1,this.length),128&this[$e]?-1*(255-this[$e]+1):this[$e]},q.prototype.readInt16LE=function($e,ze){$e>>>=0,ze||Qt($e,2,this.length);var ft=this[$e]|this[$e+1]<<8;return 32768&ft?4294901760|ft:ft},q.prototype.readInt16BE=function($e,ze){$e>>>=0,ze||Qt($e,2,this.length);var ft=this[$e+1]|this[$e]<<8;return 32768&ft?4294901760|ft:ft},q.prototype.readInt32LE=function($e,ze){return $e>>>=0,ze||Qt($e,4,this.length),this[$e]|this[$e+1]<<8|this[$e+2]<<16|this[$e+3]<<24},q.prototype.readInt32BE=function($e,ze){return $e>>>=0,ze||Qt($e,4,this.length),this[$e]<<24|this[$e+1]<<16|this[$e+2]<<8|this[$e+3]},q.prototype.readFloatLE=function($e,ze){return $e>>>=0,ze||Qt($e,4,this.length),I.read(this,$e,!0,23,4)},q.prototype.readFloatBE=function($e,ze){return $e>>>=0,ze||Qt($e,4,this.length),I.read(this,$e,!1,23,4)},q.prototype.readDoubleLE=function($e,ze){return $e>>>=0,ze||Qt($e,8,this.length),I.read(this,$e,!0,52,8)},q.prototype.readDoubleBE=function($e,ze){return $e>>>=0,ze||Qt($e,8,this.length),I.read(this,$e,!1,52,8)},q.prototype.writeUIntLE=function($e,ze,ft,ht){$e=+$e,ze>>>=0,ft>>>=0,ht||Vt(this,$e,ze,ft,Math.pow(2,8*ft)-1,0);var gr=1,yr=0;for(this[ze]=255&$e;++yr<ft&&(gr*=256);)this[ze+yr]=$e/gr&255;return ze+ft},q.prototype.writeUIntBE=function($e,ze,ft,ht){$e=+$e,ze>>>=0,ft>>>=0,ht||Vt(this,$e,ze,ft,Math.pow(2,8*ft)-1,0);var gr=ft-1,yr=1;for(this[ze+gr]=255&$e;--gr>=0&&(yr*=256);)this[ze+gr]=$e/yr&255;return ze+ft},q.prototype.writeUInt8=function($e,ze,ft){return $e=+$e,ze>>>=0,ft||Vt(this,$e,ze,1,255,0),this[ze]=255&$e,ze+1},q.prototype.writeUInt16LE=function($e,ze,ft){return $e=+$e,ze>>>=0,ft||Vt(this,$e,ze,2,65535,0),this[ze]=255&$e,this[ze+1]=$e>>>8,ze+2},q.prototype.writeUInt16BE=function($e,ze,ft){return $e=+$e,ze>>>=0,ft||Vt(this,$e,ze,2,65535,0),this[ze]=$e>>>8,this[ze+1]=255&$e,ze+2},q.prototype.writeUInt32LE=function($e,ze,ft){return $e=+$e,ze>>>=0,ft||Vt(this,$e,ze,4,4294967295,0),this[ze+3]=$e>>>24,this[ze+2]=$e>>>16,this[ze+1]=$e>>>8,this[ze]=255&$e,ze+4},q.prototype.writeUInt32BE=function($e,ze,ft){return $e=+$e,ze>>>=0,ft||Vt(this,$e,ze,4,4294967295,0),this[ze]=$e>>>24,this[ze+1]=$e>>>16,this[ze+2]=$e>>>8,this[ze+3]=255&$e,ze+4},q.prototype.writeIntLE=function($e,ze,ft,ht){if($e=+$e,ze>>>=0,!ht){var gr=Math.pow(2,8*ft-1);Vt(this,$e,ze,ft,gr-1,-gr)}var yr=0,li=1,fi=0;for(this[ze]=255&$e;++yr<ft&&(li*=256);)$e<0&&fi===0&&this[ze+yr-1]!==0&&(fi=1),this[ze+yr]=($e/li|0)-fi&255;return ze+ft},q.prototype.writeIntBE=function($e,ze,ft,ht){if($e=+$e,ze>>>=0,!ht){var gr=Math.pow(2,8*ft-1);Vt(this,$e,ze,ft,gr-1,-gr)}var yr=ft-1,li=1,fi=0;for(this[ze+yr]=255&$e;--yr>=0&&(li*=256);)$e<0&&fi===0&&this[ze+yr+1]!==0&&(fi=1),this[ze+yr]=($e/li|0)-fi&255;return ze+ft},q.prototype.writeInt8=function($e,ze,ft){return $e=+$e,ze>>>=0,ft||Vt(this,$e,ze,1,127,-128),$e<0&&($e=255+$e+1),this[ze]=255&$e,ze+1},q.prototype.writeInt16LE=function($e,ze,ft){return $e=+$e,ze>>>=0,ft||Vt(this,$e,ze,2,32767,-32768),this[ze]=255&$e,this[ze+1]=$e>>>8,ze+2},q.prototype.writeInt16BE=function($e,ze,ft){return $e=+$e,ze>>>=0,ft||Vt(this,$e,ze,2,32767,-32768),this[ze]=$e>>>8,this[ze+1]=255&$e,ze+2},q.prototype.writeInt32LE=function($e,ze,ft){return $e=+$e,ze>>>=0,ft||Vt(this,$e,ze,4,2147483647,-2147483648),this[ze]=255&$e,this[ze+1]=$e>>>8,this[ze+2]=$e>>>16,this[ze+3]=$e>>>24,ze+4},q.prototype.writeInt32BE=function($e,ze,ft){return $e=+$e,ze>>>=0,ft||Vt(this,$e,ze,4,2147483647,-2147483648),$e<0&&($e=4294967295+$e+1),this[ze]=$e>>>24,this[ze+1]=$e>>>16,this[ze+2]=$e>>>8,this[ze+3]=255&$e,ze+4},q.prototype.writeFloatLE=function($e,ze,ft){return At(this,$e,ze,!0,ft)},q.prototype.writeFloatBE=function($e,ze,ft){return At(this,$e,ze,!1,ft)},q.prototype.writeDoubleLE=function($e,ze,ft){return dr(this,$e,ze,!0,ft)},q.prototype.writeDoubleBE=function($e,ze,ft){return dr(this,$e,ze,!1,ft)},q.prototype.copy=function($e,ze,ft,ht){if(!q.isBuffer($e))throw new TypeError("argument should be a Buffer");if(ft||(ft=0),ht||ht===0||(ht=this.length),ze>=$e.length&&(ze=$e.length),ze||(ze=0),ht>0&&ht<ft&&(ht=ft),ht===ft||$e.length===0||this.length===0)return 0;if(ze<0)throw new RangeError("targetStart out of bounds");if(ft<0||ft>=this.length)throw new RangeError("Index out of range");if(ht<0)throw new RangeError("sourceEnd out of bounds");ht>this.length&&(ht=this.length),$e.length-ze<ht-ft&&(ht=$e.length-ze+ft);var gr=ht-ft;if(this===$e&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(ze,ft,ht);else if(this===$e&&ft<ze&&ze<ht)for(var yr=gr-1;yr>=0;--yr)$e[yr+ze]=this[yr+ft];else Uint8Array.prototype.set.call($e,this.subarray(ft,ht),ze);return gr},q.prototype.fill=function($e,ze,ft,ht){if(typeof $e=="string"){if(typeof ze=="string"?(ht=ze,ze=0,ft=this.length):typeof ft=="string"&&(ht=ft,ft=this.length),ht!==void 0&&typeof ht!="string")throw new TypeError("encoding must be a string");if(typeof ht=="string"&&!q.isEncoding(ht))throw new TypeError("Unknown encoding: "+ht);if($e.length===1){var gr=$e.charCodeAt(0);(ht==="utf8"&&gr<128||ht==="latin1")&&($e=gr)}}else typeof $e=="number"&&($e&=255);if(ze<0||this.length<ze||this.length<ft)throw new RangeError("Out of range index");if(ft<=ze)return this;var yr;if(ze>>>=0,ft=ft===void 0?this.length:ft>>>0,$e||($e=0),typeof $e=="number")for(yr=ze;yr<ft;++yr)this[yr]=$e;else{var li=q.isBuffer($e)?$e:q.from($e,ht),fi=li.length;if(fi===0)throw new TypeError('The value "'+$e+'" is invalid for argument "value"');for(yr=0;yr<ft-ze;++yr)this[yr+ze]=li[yr%fi]}return this};var fr=/[^+/0-9A-Za-z-_]/g;function pr($e){if(($e=($e=$e.split("=")[0]).trim().replace(fr,"")).length<2)return"";for(;$e.length%4!=0;)$e+="=";return $e}function zt($e){return $e<16?"0"+$e.toString(16):$e.toString(16)}function Ce($e,ze){var ft;ze=ze||1/0;for(var ht=$e.length,gr=null,yr=[],li=0;li<ht;++li){if((ft=$e.charCodeAt(li))>55295&&ft<57344){if(!gr){if(ft>56319){(ze-=3)>-1&&yr.push(239,191,189);continue}if(li+1===ht){(ze-=3)>-1&&yr.push(239,191,189);continue}gr=ft;continue}if(ft<56320){(ze-=3)>-1&&yr.push(239,191,189),gr=ft;continue}ft=65536+(gr-55296<<10|ft-56320)}else gr&&(ze-=3)>-1&&yr.push(239,191,189);if(gr=null,ft<128){if((ze-=1)<0)break;yr.push(ft)}else if(ft<2048){if((ze-=2)<0)break;yr.push(ft>>6|192,63&ft|128)}else if(ft<65536){if((ze-=3)<0)break;yr.push(ft>>12|224,ft>>6&63|128,63&ft|128)}else{if(!(ft<1114112))throw new Error("Invalid code point");if((ze-=4)<0)break;yr.push(ft>>18|240,ft>>12&63|128,ft>>6&63|128,63&ft|128)}}return yr}function Nt($e){for(var ze=[],ft=0;ft<$e.length;++ft)ze.push(255&$e.charCodeAt(ft));return ze}function Xe($e,ze){for(var ft,ht,gr,yr=[],li=0;li<$e.length&&!((ze-=2)<0);++li)ht=(ft=$e.charCodeAt(li))>>8,gr=ft%256,yr.push(gr),yr.push(ht);return yr}function lt($e){return $.toByteArray(pr($e))}function st($e,ze,ft,ht){for(var gr=0;gr<ht&&!(gr+ft>=ze.length||gr>=$e.length);++gr)ze[gr+ft]=$e[gr];return gr}function yt($e,ze){return $e instanceof ze||$e!=null&&$e.constructor!=null&&$e.constructor.name!=null&&$e.constructor.name===ze.name}function Yt($e){return $e!=$e}}).call(this)}).call(this,d("buffer").Buffer)},{"base64-js":28,buffer:32,ieee754:45}],33:[function(d,m,g){var w=d("get-intrinsic"),$=d("./"),I=$(w("String.prototype.indexOf"));m.exports=function(D,F){var U=w(D,!!F);return typeof U=="function"&&I(D,".prototype.")>-1?$(U):U}},{"./":34,"get-intrinsic":39}],34:[function(d,m,g){var w=d("function-bind"),$=d("get-intrinsic"),I=$("%Function.prototype.apply%"),D=$("%Function.prototype.call%"),F=$("%Reflect.apply%",!0)||w.call(D,I),U=$("%Object.getOwnPropertyDescriptor%",!0),q=$("%Object.defineProperty%",!0),j=$("%Math.max%");if(q)try{q({},"a",{value:1})}catch{q=null}m.exports=function(H){var V=F(w,D,arguments);return U&&q&&U(V,"length").configurable&&q(V,"length",{value:1+j(0,H.length-(arguments.length-1))}),V};var G=function(){return F(w,I,arguments)};q?q(m.exports,"apply",{value:G}):m.exports.apply=G},{"function-bind":38,"get-intrinsic":39}],35:[function(d,m,g){var w,$=typeof Reflect=="object"?Reflect:null,I=$&&typeof $.apply=="function"?$.apply:function(oe,de,me){return Function.prototype.apply.call(oe,de,me)};function D(oe){console&&console.warn&&console.warn(oe)}w=$&&typeof $.ownKeys=="function"?$.ownKeys:Object.getOwnPropertySymbols?function(oe){return Object.getOwnPropertyNames(oe).concat(Object.getOwnPropertySymbols(oe))}:function(oe){return Object.getOwnPropertyNames(oe)};var F=Number.isNaN||function(oe){return oe!=oe};function U(){U.init.call(this)}m.exports=U,m.exports.once=X,U.EventEmitter=U,U.prototype._events=void 0,U.prototype._eventsCount=0,U.prototype._maxListeners=void 0;var q=10;function j(oe){if(typeof oe!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof oe)}function G(oe){return oe._maxListeners===void 0?U.defaultMaxListeners:oe._maxListeners}function H(oe,de,me,ge){var fe,xe,Fe;if(j(me),(xe=oe._events)===void 0?(xe=oe._events=Object.create(null),oe._eventsCount=0):(xe.newListener!==void 0&&(oe.emit("newListener",de,me.listener?me.listener:me),xe=oe._events),Fe=xe[de]),Fe===void 0)Fe=xe[de]=me,++oe._eventsCount;else if(typeof Fe=="function"?Fe=xe[de]=ge?[me,Fe]:[Fe,me]:ge?Fe.unshift(me):Fe.push(me),(fe=G(oe))>0&&Fe.length>fe&&!Fe.warned){Fe.warned=!0;var Te=new Error("Possible EventEmitter memory leak detected. "+Fe.length+" "+String(de)+" listeners added. Use emitter.setMaxListeners() to increase limit");Te.name="MaxListenersExceededWarning",Te.emitter=oe,Te.type=de,Te.count=Fe.length,D(Te)}return oe}function V(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Z(oe,de,me){var ge={fired:!1,wrapFn:void 0,target:oe,type:de,listener:me},fe=V.bind(ge);return fe.listener=me,ge.wrapFn=fe,fe}function Q(oe,de,me){var ge=oe._events;if(ge===void 0)return[];var fe=ge[de];return fe===void 0?[]:typeof fe=="function"?me?[fe.listener||fe]:[fe]:me?se(fe):ie(fe,fe.length)}function J(oe){var de=this._events;if(de!==void 0){var me=de[oe];if(typeof me=="function")return 1;if(me!==void 0)return me.length}return 0}function ie(oe,de){for(var me=new Array(de),ge=0;ge<de;++ge)me[ge]=oe[ge];return me}function re(oe,de){for(;de+1<oe.length;de++)oe[de]=oe[de+1];oe.pop()}function se(oe){for(var de=new Array(oe.length),me=0;me<de.length;++me)de[me]=oe[me].listener||oe[me];return de}function X(oe,de){return new Promise((function(me,ge){function fe(Fe){oe.removeListener(de,xe),ge(Fe)}function xe(){typeof oe.removeListener=="function"&&oe.removeListener("error",fe),me([].slice.call(arguments))}ce(oe,de,xe,{once:!0}),de!=="error"&&ne(oe,fe,{once:!0})}))}function ne(oe,de,me){typeof oe.on=="function"&&ce(oe,"error",de,me)}function ce(oe,de,me,ge){if(typeof oe.on=="function")ge.once?oe.once(de,me):oe.on(de,me);else{if(typeof oe.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof oe);oe.addEventListener(de,(function fe(xe){ge.once&&oe.removeEventListener(de,fe),me(xe)}))}}Object.defineProperty(U,"defaultMaxListeners",{enumerable:!0,get:function(){return q},set:function(oe){if(typeof oe!="number"||oe<0||F(oe))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+oe+".");q=oe}}),U.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},U.prototype.setMaxListeners=function(oe){if(typeof oe!="number"||oe<0||F(oe))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+oe+".");return this._maxListeners=oe,this},U.prototype.getMaxListeners=function(){return G(this)},U.prototype.emit=function(oe){for(var de=[],me=1;me<arguments.length;me++)de.push(arguments[me]);var ge=oe==="error",fe=this._events;if(fe!==void 0)ge=ge&&fe.error===void 0;else if(!ge)return!1;if(ge){var xe;if(de.length>0&&(xe=de[0]),xe instanceof Error)throw xe;var Fe=new Error("Unhandled error."+(xe?" ("+xe.message+")":""));throw Fe.context=xe,Fe}var Te=fe[oe];if(Te===void 0)return!1;if(typeof Te=="function")I(Te,this,de);else{var Oe=Te.length,Be=ie(Te,Oe);for(me=0;me<Oe;++me)I(Be[me],this,de)}return!0},U.prototype.addListener=function(oe,de){return H(this,oe,de,!1)},U.prototype.on=U.prototype.addListener,U.prototype.prependListener=function(oe,de){return H(this,oe,de,!0)},U.prototype.once=function(oe,de){return j(de),this.on(oe,Z(this,oe,de)),this},U.prototype.prependOnceListener=function(oe,de){return j(de),this.prependListener(oe,Z(this,oe,de)),this},U.prototype.removeListener=function(oe,de){var me,ge,fe,xe,Fe;if(j(de),(ge=this._events)===void 0)return this;if((me=ge[oe])===void 0)return this;if(me===de||me.listener===de)--this._eventsCount==0?this._events=Object.create(null):(delete ge[oe],ge.removeListener&&this.emit("removeListener",oe,me.listener||de));else if(typeof me!="function"){for(fe=-1,xe=me.length-1;xe>=0;xe--)if(me[xe]===de||me[xe].listener===de){Fe=me[xe].listener,fe=xe;break}if(fe<0)return this;fe===0?me.shift():re(me,fe),me.length===1&&(ge[oe]=me[0]),ge.removeListener!==void 0&&this.emit("removeListener",oe,Fe||de)}return this},U.prototype.off=U.prototype.removeListener,U.prototype.removeAllListeners=function(oe){var de,me,ge;if((me=this._events)===void 0)return this;if(me.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):me[oe]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete me[oe]),this;if(arguments.length===0){var fe,xe=Object.keys(me);for(ge=0;ge<xe.length;++ge)(fe=xe[ge])!=="removeListener"&&this.removeAllListeners(fe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(de=me[oe])=="function")this.removeListener(oe,de);else if(de!==void 0)for(ge=de.length-1;ge>=0;ge--)this.removeListener(oe,de[ge]);return this},U.prototype.listeners=function(oe){return Q(this,oe,!0)},U.prototype.rawListeners=function(oe){return Q(this,oe,!1)},U.listenerCount=function(oe,de){return typeof oe.listenerCount=="function"?oe.listenerCount(de):J.call(oe,de)},U.prototype.listenerCount=J,U.prototype.eventNames=function(){return this._eventsCount>0?w(this._events):[]}},{}],36:[function(d,m,g){var w=d("is-callable"),$=Object.prototype.toString,I=Object.prototype.hasOwnProperty,D=function(j,G,H){for(var V=0,Z=j.length;V<Z;V++)I.call(j,V)&&(H==null?G(j[V],V,j):G.call(H,j[V],V,j))},F=function(j,G,H){for(var V=0,Z=j.length;V<Z;V++)H==null?G(j.charAt(V),V,j):G.call(H,j.charAt(V),V,j)},U=function(j,G,H){for(var V in j)I.call(j,V)&&(H==null?G(j[V],V,j):G.call(H,j[V],V,j))},q=function(j,G,H){if(!w(G))throw new TypeError("iterator must be a function");var V;arguments.length>=3&&(V=H),$.call(j)==="[object Array]"?D(j,G,V):typeof j=="string"?F(j,G,V):U(j,G,V)};m.exports=q},{"is-callable":48}],37:[function(d,m,g){var w="Function.prototype.bind called on incompatible ",$=Array.prototype.slice,I=Object.prototype.toString,D="[object Function]";m.exports=function(F){var U=this;if(typeof U!="function"||I.call(U)!==D)throw new TypeError(w+U);for(var q,j=$.call(arguments,1),G=function(){if(this instanceof q){var J=U.apply(this,j.concat($.call(arguments)));return Object(J)===J?J:this}return U.apply(F,j.concat($.call(arguments)))},H=Math.max(0,U.length-j.length),V=[],Z=0;Z<H;Z++)V.push("$"+Z);if(q=Function("binder","return function ("+V.join(",")+"){ return binder.apply(this,arguments); }")(G),U.prototype){var Q=function(){};Q.prototype=U.prototype,q.prototype=new Q,Q.prototype=null}return q}},{}],38:[function(d,m,g){var w=d("./implementation");m.exports=Function.prototype.bind||w},{"./implementation":37}],39:[function(d,m,g){var w,$=SyntaxError,I=Function,D=TypeError,F=function(Te){try{return I('"use strict"; return ('+Te+").constructor;")()}catch{}},U=Object.getOwnPropertyDescriptor;if(U)try{U({},"")}catch{U=null}var q=function(){throw new D},j=U?(function(){try{return q}catch{try{return U(arguments,"callee").get}catch{return q}}})():q,G=d("has-symbols")(),H=Object.getPrototypeOf||function(Te){return Te.__proto__},V={},Z=typeof Uint8Array>"u"?w:H(Uint8Array),Q={"%AggregateError%":typeof AggregateError>"u"?w:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?w:ArrayBuffer,"%ArrayIteratorPrototype%":G?H([][Symbol.iterator]()):w,"%AsyncFromSyncIteratorPrototype%":w,"%AsyncFunction%":V,"%AsyncGenerator%":V,"%AsyncGeneratorFunction%":V,"%AsyncIteratorPrototype%":V,"%Atomics%":typeof Atomics>"u"?w:Atomics,"%BigInt%":typeof BigInt>"u"?w:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?w:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?w:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?w:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?w:Float32Array,"%Float64Array%":typeof Float64Array>"u"?w:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?w:FinalizationRegistry,"%Function%":I,"%GeneratorFunction%":V,"%Int8Array%":typeof Int8Array>"u"?w:Int8Array,"%Int16Array%":typeof Int16Array>"u"?w:Int16Array,"%Int32Array%":typeof Int32Array>"u"?w:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":G?H(H([][Symbol.iterator]())):w,"%JSON%":typeof JSON=="object"?JSON:w,"%Map%":typeof Map>"u"?w:Map,"%MapIteratorPrototype%":typeof Map<"u"&&G?H(new Map()[Symbol.iterator]()):w,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?w:Promise,"%Proxy%":typeof Proxy>"u"?w:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?w:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?w:Set,"%SetIteratorPrototype%":typeof Set<"u"&&G?H(new Set()[Symbol.iterator]()):w,"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?w:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":G?H(""[Symbol.iterator]()):w,"%Symbol%":G?Symbol:w,"%SyntaxError%":$,"%ThrowTypeError%":j,"%TypedArray%":Z,"%TypeError%":D,"%Uint8Array%":typeof Uint8Array>"u"?w:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?w:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?w:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?w:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?w:WeakMap,"%WeakRef%":typeof WeakRef>"u"?w:WeakRef,"%WeakSet%":typeof WeakSet>"u"?w:WeakSet};try{null.error}catch(Te){var J=H(H(Te));Q["%Error.prototype%"]=J}var ie=function Te(Oe){var Be;if(Oe==="%AsyncFunction%")Be=F("async function () {}");else if(Oe==="%GeneratorFunction%")Be=F("function* () {}");else if(Oe==="%AsyncGeneratorFunction%")Be=F("async function* () {}");else if(Oe==="%AsyncGenerator%"){var _t=Te("%AsyncGeneratorFunction%");_t&&(Be=_t.prototype)}else if(Oe==="%AsyncIteratorPrototype%"){var Et=Te("%AsyncGenerator%");Et&&(Be=H(Et.prototype))}return Q[Oe]=Be,Be},re={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},se=d("function-bind"),X=d("has"),ne=se.call(Function.call,Array.prototype.concat),ce=se.call(Function.apply,Array.prototype.splice),oe=se.call(Function.call,String.prototype.replace),de=se.call(Function.call,String.prototype.slice),me=se.call(Function.call,RegExp.prototype.exec),ge=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,fe=/\\(\\)?/g,xe=function(Te){var Oe=de(Te,0,1),Be=de(Te,-1);if(Oe==="%"&&Be!=="%")throw new $("invalid intrinsic syntax, expected closing `%`");if(Be==="%"&&Oe!=="%")throw new $("invalid intrinsic syntax, expected opening `%`");var _t=[];return oe(Te,ge,(function(Et,dt,Zt,Ye){_t[_t.length]=Zt?oe(Ye,fe,"$1"):dt||Et})),_t},Fe=function(Te,Oe){var Be,_t=Te;if(X(re,_t)&&(_t="%"+(Be=re[_t])[0]+"%"),X(Q,_t)){var Et=Q[_t];if(Et===V&&(Et=ie(_t)),Et===void 0&&!Oe)throw new D("intrinsic "+Te+" exists, but is not available. Please file an issue!");return{alias:Be,name:_t,value:Et}}throw new $("intrinsic "+Te+" does not exist!")};m.exports=function(Te,Oe){if(typeof Te!="string"||Te.length===0)throw new D("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Oe!="boolean")throw new D('"allowMissing" argument must be a boolean');if(me(/^%?[^%]*%?$/,Te)===null)throw new $("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Be=xe(Te),_t=Be.length>0?Be[0]:"",Et=Fe("%"+_t+"%",Oe),dt=Et.name,Zt=Et.value,Ye=!1,bt=Et.alias;bt&&(_t=bt[0],ce(Be,ne([0,1],bt)));for(var Qt=1,Vt=!0;Qt<Be.length;Qt+=1){var ut=Be[Qt],At=de(ut,0,1),dr=de(ut,-1);if((At==='"'||At==="'"||At==="`"||dr==='"'||dr==="'"||dr==="`")&&At!==dr)throw new $("property names with quotes must have matching quotes");if(ut!=="constructor"&&Vt||(Ye=!0),X(Q,dt="%"+(_t+="."+ut)+"%"))Zt=Q[dt];else if(Zt!=null){if(!(ut in Zt)){if(!Oe)throw new D("base intrinsic for "+Te+" exists, but the property is not available.");return}if(U&&Qt+1>=Be.length){var fr=U(Zt,ut);Zt=(Vt=!!fr)&&"get"in fr&&!("originalValue"in fr.get)?fr.get:Zt[ut]}else Vt=X(Zt,ut),Zt=Zt[ut];Vt&&!Ye&&(Q[dt]=Zt)}}return Zt}},{"function-bind":38,has:44,"has-symbols":41}],40:[function(d,m,g){var w=d("get-intrinsic")("%Object.getOwnPropertyDescriptor%",!0);if(w)try{w([],"length")}catch{w=null}m.exports=w},{"get-intrinsic":39}],41:[function(d,m,g){var w=typeof Symbol<"u"&&Symbol,$=d("./shams");m.exports=function(){return typeof w=="function"&&typeof Symbol=="function"&&typeof w("foo")=="symbol"&&typeof Symbol("bar")=="symbol"&&$()}},{"./shams":42}],42:[function(d,m,g){m.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var w={},$=Symbol("test"),I=Object($);if(typeof $=="string"||Object.prototype.toString.call($)!=="[object Symbol]"||Object.prototype.toString.call(I)!=="[object Symbol]")return!1;var D=42;for($ in w[$]=D,w)return!1;if(typeof Object.keys=="function"&&Object.keys(w).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(w).length!==0)return!1;var F=Object.getOwnPropertySymbols(w);if(F.length!==1||F[0]!==$||!Object.prototype.propertyIsEnumerable.call(w,$))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var U=Object.getOwnPropertyDescriptor(w,$);if(U.value!==D||U.enumerable!==!0)return!1}return!0}},{}],43:[function(d,m,g){var w=d("has-symbols/shams");m.exports=function(){return w()&&!!Symbol.toStringTag}},{"has-symbols/shams":42}],44:[function(d,m,g){var w=d("function-bind");m.exports=w.call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":38}],45:[function(d,m,g){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */g.read=function(w,$,I,D,F){var U,q,j=8*F-D-1,G=(1<<j)-1,H=G>>1,V=-7,Z=I?F-1:0,Q=I?-1:1,J=w[$+Z];for(Z+=Q,U=J&(1<<-V)-1,J>>=-V,V+=j;V>0;U=256*U+w[$+Z],Z+=Q,V-=8);for(q=U&(1<<-V)-1,U>>=-V,V+=D;V>0;q=256*q+w[$+Z],Z+=Q,V-=8);if(U===0)U=1-H;else{if(U===G)return q?NaN:1/0*(J?-1:1);q+=Math.pow(2,D),U-=H}return(J?-1:1)*q*Math.pow(2,U-D)},g.write=function(w,$,I,D,F,U){var q,j,G,H=8*U-F-1,V=(1<<H)-1,Z=V>>1,Q=F===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=D?0:U-1,ie=D?1:-1,re=$<0||$===0&&1/$<0?1:0;for($=Math.abs($),isNaN($)||$===1/0?(j=isNaN($)?1:0,q=V):(q=Math.floor(Math.log($)/Math.LN2),$*(G=Math.pow(2,-q))<1&&(q--,G*=2),($+=q+Z>=1?Q/G:Q*Math.pow(2,1-Z))*G>=2&&(q++,G/=2),q+Z>=V?(j=0,q=V):q+Z>=1?(j=($*G-1)*Math.pow(2,F),q+=Z):(j=$*Math.pow(2,Z-1)*Math.pow(2,F),q=0));F>=8;w[I+J]=255&j,J+=ie,j/=256,F-=8);for(q=q<<F|j,H+=F;H>0;w[I+J]=255&q,J+=ie,q/=256,H-=8);w[I+J-ie]|=128*re}},{}],46:[function(d,m,g){typeof Object.create=="function"?m.exports=function(w,$){$&&(w.super_=$,w.prototype=Object.create($.prototype,{constructor:{value:w,enumerable:!1,writable:!0,configurable:!0}}))}:m.exports=function(w,$){if($){w.super_=$;var I=function(){};I.prototype=$.prototype,w.prototype=new I,w.prototype.constructor=w}}},{}],47:[function(d,m,g){var w=d("has-tostringtag/shams")(),$=d("call-bind/callBound")("Object.prototype.toString"),I=function(U){return!(w&&U&&typeof U=="object"&&Symbol.toStringTag in U)&&$(U)==="[object Arguments]"},D=function(U){return!!I(U)||U!==null&&typeof U=="object"&&typeof U.length=="number"&&U.length>=0&&$(U)!=="[object Array]"&&$(U.callee)==="[object Function]"},F=(function(){return I(arguments)})();I.isLegacyArguments=D,m.exports=F?I:D},{"call-bind/callBound":33,"has-tostringtag/shams":43}],48:[function(d,m,g){var w,$,I=Function.prototype.toString,D=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply;if(typeof D=="function"&&typeof Object.defineProperty=="function")try{w=Object.defineProperty({},"length",{get:function(){throw $}}),$={},D((function(){throw 42}),null,w)}catch(ne){ne!==$&&(D=null)}else D=null;var F=/^\s*class\b/,U=function(ne){try{var ce=I.call(ne);return F.test(ce)}catch{return!1}},q=function(ne){try{return!U(ne)&&(I.call(ne),!0)}catch{return!1}},j=Object.prototype.toString,G="[object Object]",H="[object Function]",V="[object GeneratorFunction]",Z="[object HTMLAllCollection]",Q="[object HTML document.all class]",J="[object HTMLCollection]",ie=typeof Symbol=="function"&&!!Symbol.toStringTag,re=!(0 in[,]),se=function(){return!1};if(typeof document=="object"){var X=document.all;j.call(X)===j.call(document.all)&&(se=function(ne){if((re||!ne)&&(ne===void 0||typeof ne=="object"))try{var ce=j.call(ne);return(ce===Z||ce===Q||ce===J||ce===G)&&ne("")==null}catch{}return!1})}m.exports=D?function(ne){if(se(ne))return!0;if(!ne||typeof ne!="function"&&typeof ne!="object")return!1;try{D(ne,null,w)}catch(ce){if(ce!==$)return!1}return!U(ne)&&q(ne)}:function(ne){if(se(ne))return!0;if(!ne||typeof ne!="function"&&typeof ne!="object")return!1;if(ie)return q(ne);if(U(ne))return!1;var ce=j.call(ne);return!(ce!==H&&ce!==V&&!/^\[object HTML/.test(ce))&&q(ne)}},{}],49:[function(d,m,g){var w,$=Object.prototype.toString,I=Function.prototype.toString,D=/^\s*(?:function)?\*/,F=d("has-tostringtag/shams")(),U=Object.getPrototypeOf,q=function(){if(!F)return!1;try{return Function("return function*() {}")()}catch{}};m.exports=function(j){if(typeof j!="function")return!1;if(D.test(I.call(j)))return!0;if(!F)return $.call(j)==="[object GeneratorFunction]";if(!U)return!1;if(w===void 0){var G=q();w=!!G&&U(G)}return U(j)===w}},{"has-tostringtag/shams":43}],50:[function(d,m,g){(function(w){(function(){var $=d("for-each"),I=d("available-typed-arrays"),D=d("call-bind/callBound"),F=D("Object.prototype.toString"),U=d("has-tostringtag/shams")(),q=d("gopd"),j=typeof globalThis>"u"?w:globalThis,G=I(),H=D("Array.prototype.indexOf",!0)||function(ie,re){for(var se=0;se<ie.length;se+=1)if(ie[se]===re)return se;return-1},V=D("String.prototype.slice"),Z={},Q=Object.getPrototypeOf;U&&q&&Q&&$(G,(function(ie){var re=new j[ie];if(Symbol.toStringTag in re){var se=Q(re),X=q(se,Symbol.toStringTag);if(!X){var ne=Q(se);X=q(ne,Symbol.toStringTag)}Z[ie]=X.get}}));var J=function(ie){var re=!1;return $(Z,(function(se,X){if(!re)try{re=se.call(ie)===X}catch{}})),re};m.exports=function(ie){if(!ie||typeof ie!="object")return!1;if(!U||!(Symbol.toStringTag in ie)){var re=V(F(ie),8,-1);return H(G,re)>-1}return!!q&&J(ie)}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":27,"call-bind/callBound":33,"for-each":36,gopd:40,"has-tostringtag/shams":43}],51:[function(d,m,g){var w=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;function D(U){if(U==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(U)}function F(){try{if(!Object.assign)return!1;var U=new String("abc");if(U[5]="de",Object.getOwnPropertyNames(U)[0]==="5")return!1;for(var q={},j=0;j<10;j++)q["_"+String.fromCharCode(j)]=j;var G=Object.getOwnPropertyNames(q).map((function(V){return q[V]}));if(G.join("")!=="0123456789")return!1;var H={};return"abcdefghijklmnopqrst".split("").forEach((function(V){H[V]=V})),Object.keys(Object.assign({},H)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}m.exports=F()?Object.assign:function(U,q){for(var j,G,H=D(U),V=1;V<arguments.length;V++){for(var Z in j=Object(arguments[V]))$.call(j,Z)&&(H[Z]=j[Z]);if(w){G=w(j);for(var Q=0;Q<G.length;Q++)I.call(j,G[Q])&&(H[G[Q]]=j[G[Q]])}}return H}},{}],52:[function(d,m,g){var w=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function $(F,U){return Object.prototype.hasOwnProperty.call(F,U)}g.assign=function(F){for(var U=Array.prototype.slice.call(arguments,1);U.length;){var q=U.shift();if(q){if(typeof q!="object")throw new TypeError(q+"must be non-object");for(var j in q)$(q,j)&&(F[j]=q[j])}}return F},g.shrinkBuf=function(F,U){return F.length===U?F:F.subarray?F.subarray(0,U):(F.length=U,F)};var I={arraySet:function(F,U,q,j,G){if(U.subarray&&F.subarray)F.set(U.subarray(q,q+j),G);else for(var H=0;H<j;H++)F[G+H]=U[q+H]},flattenChunks:function(F){var U,q,j,G,H,V;for(j=0,U=0,q=F.length;U<q;U++)j+=F[U].length;for(V=new Uint8Array(j),G=0,U=0,q=F.length;U<q;U++)H=F[U],V.set(H,G),G+=H.length;return V}},D={arraySet:function(F,U,q,j,G){for(var H=0;H<j;H++)F[G+H]=U[q+H]},flattenChunks:function(F){return[].concat.apply([],F)}};g.setTyped=function(F){F?(g.Buf8=Uint8Array,g.Buf16=Uint16Array,g.Buf32=Int32Array,g.assign(g,I)):(g.Buf8=Array,g.Buf16=Array,g.Buf32=Array,g.assign(g,D))},g.setTyped(w)},{}],53:[function(d,m,g){function w($,I,D,F){for(var U=65535&$,q=$>>>16&65535,j=0;D!==0;){D-=j=D>2e3?2e3:D;do q=q+(U=U+I[F++]|0)|0;while(--j);U%=65521,q%=65521}return U|q<<16}m.exports=w},{}],54:[function(d,m,g){m.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],55:[function(d,m,g){function w(){for(var D,F=[],U=0;U<256;U++){D=U;for(var q=0;q<8;q++)D=1&D?3988292384^D>>>1:D>>>1;F[U]=D}return F}var $=w();function I(D,F,U,q){var j=$,G=q+U;D^=-1;for(var H=q;H<G;H++)D=D>>>8^j[255&(D^F[H])];return~D}m.exports=I},{}],56:[function(d,m,g){var w,$=d("../utils/common"),I=d("./trees"),D=d("./adler32"),F=d("./crc32"),U=d("./messages"),q=0,j=1,G=3,H=4,V=5,Z=0,Q=1,J=-2,ie=-3,re=-5,se=-1,X=1,ne=2,ce=3,oe=4,de=0,me=2,ge=8,fe=9,xe=15,Fe=8,Te=286,Oe=30,Be=19,_t=2*Te+1,Et=15,dt=3,Zt=258,Ye=Zt+dt+1,bt=32,Qt=42,Vt=69,ut=73,At=91,dr=103,fr=113,pr=666,zt=1,Ce=2,Nt=3,Xe=4,lt=3;function st(Ue,ni){return Ue.msg=U[ni],ni}function yt(Ue){return(Ue<<1)-(Ue>4?9:0)}function Yt(Ue){for(var ni=Ue.length;--ni>=0;)Ue[ni]=0}function $e(Ue){var ni=Ue.state,_r=ni.pending;_r>Ue.avail_out&&(_r=Ue.avail_out),_r!==0&&($.arraySet(Ue.output,ni.pending_buf,ni.pending_out,_r,Ue.next_out),Ue.next_out+=_r,ni.pending_out+=_r,Ue.total_out+=_r,Ue.avail_out-=_r,ni.pending-=_r,ni.pending===0&&(ni.pending_out=0))}function ze(Ue,ni){I._tr_flush_block(Ue,Ue.block_start>=0?Ue.block_start:-1,Ue.strstart-Ue.block_start,ni),Ue.block_start=Ue.strstart,$e(Ue.strm)}function ft(Ue,ni){Ue.pending_buf[Ue.pending++]=ni}function ht(Ue,ni){Ue.pending_buf[Ue.pending++]=ni>>>8&255,Ue.pending_buf[Ue.pending++]=255&ni}function gr(Ue,ni,_r,hr){var ei=Ue.avail_in;return ei>hr&&(ei=hr),ei===0?0:(Ue.avail_in-=ei,$.arraySet(ni,Ue.input,Ue.next_in,ei,_r),Ue.state.wrap===1?Ue.adler=D(Ue.adler,ni,ei,_r):Ue.state.wrap===2&&(Ue.adler=F(Ue.adler,ni,ei,_r)),Ue.next_in+=ei,Ue.total_in+=ei,ei)}function yr(Ue,ni){var _r,hr,ei=Ue.max_chain_length,ri=Ue.strstart,xi=Ue.prev_length,gi=Ue.nice_match,wi=Ue.strstart>Ue.w_size-Ye?Ue.strstart-(Ue.w_size-Ye):0,Ii=Ue.window,Ui=Ue.w_mask,Ti=Ue.prev,Mi=Ue.strstart+Zt,Di=Ii[ri+xi-1],Bi=Ii[ri+xi];Ue.prev_length>=Ue.good_match&&(ei>>=2),gi>Ue.lookahead&&(gi=Ue.lookahead);do if(Ii[(_r=ni)+xi]===Bi&&Ii[_r+xi-1]===Di&&Ii[_r]===Ii[ri]&&Ii[++_r]===Ii[ri+1]){ri+=2,_r++;do;while(Ii[++ri]===Ii[++_r]&&Ii[++ri]===Ii[++_r]&&Ii[++ri]===Ii[++_r]&&Ii[++ri]===Ii[++_r]&&Ii[++ri]===Ii[++_r]&&Ii[++ri]===Ii[++_r]&&Ii[++ri]===Ii[++_r]&&Ii[++ri]===Ii[++_r]&&ri<Mi);if(hr=Zt-(Mi-ri),ri=Mi-Zt,hr>xi){if(Ue.match_start=ni,xi=hr,hr>=gi)break;Di=Ii[ri+xi-1],Bi=Ii[ri+xi]}}while((ni=Ti[ni&Ui])>wi&&--ei!=0);return xi<=Ue.lookahead?xi:Ue.lookahead}function li(Ue){var ni,_r,hr,ei,ri,xi=Ue.w_size;do{if(ei=Ue.window_size-Ue.lookahead-Ue.strstart,Ue.strstart>=xi+(xi-Ye)){$.arraySet(Ue.window,Ue.window,xi,xi,0),Ue.match_start-=xi,Ue.strstart-=xi,Ue.block_start-=xi,ni=_r=Ue.hash_size;do hr=Ue.head[--ni],Ue.head[ni]=hr>=xi?hr-xi:0;while(--_r);ni=_r=xi;do hr=Ue.prev[--ni],Ue.prev[ni]=hr>=xi?hr-xi:0;while(--_r);ei+=xi}if(Ue.strm.avail_in===0)break;if(_r=gr(Ue.strm,Ue.window,Ue.strstart+Ue.lookahead,ei),Ue.lookahead+=_r,Ue.lookahead+Ue.insert>=dt)for(ri=Ue.strstart-Ue.insert,Ue.ins_h=Ue.window[ri],Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[ri+1])&Ue.hash_mask;Ue.insert&&(Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[ri+dt-1])&Ue.hash_mask,Ue.prev[ri&Ue.w_mask]=Ue.head[Ue.ins_h],Ue.head[Ue.ins_h]=ri,ri++,Ue.insert--,!(Ue.lookahead+Ue.insert<dt)););}while(Ue.lookahead<Ye&&Ue.strm.avail_in!==0)}function fi(Ue,ni){var _r=65535;for(_r>Ue.pending_buf_size-5&&(_r=Ue.pending_buf_size-5);;){if(Ue.lookahead<=1){if(li(Ue),Ue.lookahead===0&&ni===q)return zt;if(Ue.lookahead===0)break}Ue.strstart+=Ue.lookahead,Ue.lookahead=0;var hr=Ue.block_start+_r;if((Ue.strstart===0||Ue.strstart>=hr)&&(Ue.lookahead=Ue.strstart-hr,Ue.strstart=hr,ze(Ue,!1),Ue.strm.avail_out===0)||Ue.strstart-Ue.block_start>=Ue.w_size-Ye&&(ze(Ue,!1),Ue.strm.avail_out===0))return zt}return Ue.insert=0,ni===H?(ze(Ue,!0),Ue.strm.avail_out===0?Nt:Xe):(Ue.strstart>Ue.block_start&&(ze(Ue,!1),Ue.strm.avail_out),zt)}function ai(Ue,ni){for(var _r,hr;;){if(Ue.lookahead<Ye){if(li(Ue),Ue.lookahead<Ye&&ni===q)return zt;if(Ue.lookahead===0)break}if(_r=0,Ue.lookahead>=dt&&(Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Ue.strstart+dt-1])&Ue.hash_mask,_r=Ue.prev[Ue.strstart&Ue.w_mask]=Ue.head[Ue.ins_h],Ue.head[Ue.ins_h]=Ue.strstart),_r!==0&&Ue.strstart-_r<=Ue.w_size-Ye&&(Ue.match_length=yr(Ue,_r)),Ue.match_length>=dt)if(hr=I._tr_tally(Ue,Ue.strstart-Ue.match_start,Ue.match_length-dt),Ue.lookahead-=Ue.match_length,Ue.match_length<=Ue.max_lazy_match&&Ue.lookahead>=dt){Ue.match_length--;do Ue.strstart++,Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Ue.strstart+dt-1])&Ue.hash_mask,_r=Ue.prev[Ue.strstart&Ue.w_mask]=Ue.head[Ue.ins_h],Ue.head[Ue.ins_h]=Ue.strstart;while(--Ue.match_length!=0);Ue.strstart++}else Ue.strstart+=Ue.match_length,Ue.match_length=0,Ue.ins_h=Ue.window[Ue.strstart],Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Ue.strstart+1])&Ue.hash_mask;else hr=I._tr_tally(Ue,0,Ue.window[Ue.strstart]),Ue.lookahead--,Ue.strstart++;if(hr&&(ze(Ue,!1),Ue.strm.avail_out===0))return zt}return Ue.insert=Ue.strstart<dt-1?Ue.strstart:dt-1,ni===H?(ze(Ue,!0),Ue.strm.avail_out===0?Nt:Xe):Ue.last_lit&&(ze(Ue,!1),Ue.strm.avail_out===0)?zt:Ce}function hi(Ue,ni){for(var _r,hr,ei;;){if(Ue.lookahead<Ye){if(li(Ue),Ue.lookahead<Ye&&ni===q)return zt;if(Ue.lookahead===0)break}if(_r=0,Ue.lookahead>=dt&&(Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Ue.strstart+dt-1])&Ue.hash_mask,_r=Ue.prev[Ue.strstart&Ue.w_mask]=Ue.head[Ue.ins_h],Ue.head[Ue.ins_h]=Ue.strstart),Ue.prev_length=Ue.match_length,Ue.prev_match=Ue.match_start,Ue.match_length=dt-1,_r!==0&&Ue.prev_length<Ue.max_lazy_match&&Ue.strstart-_r<=Ue.w_size-Ye&&(Ue.match_length=yr(Ue,_r),Ue.match_length<=5&&(Ue.strategy===X||Ue.match_length===dt&&Ue.strstart-Ue.match_start>4096)&&(Ue.match_length=dt-1)),Ue.prev_length>=dt&&Ue.match_length<=Ue.prev_length){ei=Ue.strstart+Ue.lookahead-dt,hr=I._tr_tally(Ue,Ue.strstart-1-Ue.prev_match,Ue.prev_length-dt),Ue.lookahead-=Ue.prev_length-1,Ue.prev_length-=2;do++Ue.strstart<=ei&&(Ue.ins_h=(Ue.ins_h<<Ue.hash_shift^Ue.window[Ue.strstart+dt-1])&Ue.hash_mask,_r=Ue.prev[Ue.strstart&Ue.w_mask]=Ue.head[Ue.ins_h],Ue.head[Ue.ins_h]=Ue.strstart);while(--Ue.prev_length!=0);if(Ue.match_available=0,Ue.match_length=dt-1,Ue.strstart++,hr&&(ze(Ue,!1),Ue.strm.avail_out===0))return zt}else if(Ue.match_available){if((hr=I._tr_tally(Ue,0,Ue.window[Ue.strstart-1]))&&ze(Ue,!1),Ue.strstart++,Ue.lookahead--,Ue.strm.avail_out===0)return zt}else Ue.match_available=1,Ue.strstart++,Ue.lookahead--}return Ue.match_available&&(hr=I._tr_tally(Ue,0,Ue.window[Ue.strstart-1]),Ue.match_available=0),Ue.insert=Ue.strstart<dt-1?Ue.strstart:dt-1,ni===H?(ze(Ue,!0),Ue.strm.avail_out===0?Nt:Xe):Ue.last_lit&&(ze(Ue,!1),Ue.strm.avail_out===0)?zt:Ce}function ui(Ue,ni){for(var _r,hr,ei,ri,xi=Ue.window;;){if(Ue.lookahead<=Zt){if(li(Ue),Ue.lookahead<=Zt&&ni===q)return zt;if(Ue.lookahead===0)break}if(Ue.match_length=0,Ue.lookahead>=dt&&Ue.strstart>0&&(hr=xi[ei=Ue.strstart-1])===xi[++ei]&&hr===xi[++ei]&&hr===xi[++ei]){ri=Ue.strstart+Zt;do;while(hr===xi[++ei]&&hr===xi[++ei]&&hr===xi[++ei]&&hr===xi[++ei]&&hr===xi[++ei]&&hr===xi[++ei]&&hr===xi[++ei]&&hr===xi[++ei]&&ei<ri);Ue.match_length=Zt-(ri-ei),Ue.match_length>Ue.lookahead&&(Ue.match_length=Ue.lookahead)}if(Ue.match_length>=dt?(_r=I._tr_tally(Ue,1,Ue.match_length-dt),Ue.lookahead-=Ue.match_length,Ue.strstart+=Ue.match_length,Ue.match_length=0):(_r=I._tr_tally(Ue,0,Ue.window[Ue.strstart]),Ue.lookahead--,Ue.strstart++),_r&&(ze(Ue,!1),Ue.strm.avail_out===0))return zt}return Ue.insert=0,ni===H?(ze(Ue,!0),Ue.strm.avail_out===0?Nt:Xe):Ue.last_lit&&(ze(Ue,!1),Ue.strm.avail_out===0)?zt:Ce}function vi(Ue,ni){for(var _r;;){if(Ue.lookahead===0&&(li(Ue),Ue.lookahead===0)){if(ni===q)return zt;break}if(Ue.match_length=0,_r=I._tr_tally(Ue,0,Ue.window[Ue.strstart]),Ue.lookahead--,Ue.strstart++,_r&&(ze(Ue,!1),Ue.strm.avail_out===0))return zt}return Ue.insert=0,ni===H?(ze(Ue,!0),Ue.strm.avail_out===0?Nt:Xe):Ue.last_lit&&(ze(Ue,!1),Ue.strm.avail_out===0)?zt:Ce}function bi(Ue,ni,_r,hr,ei){this.good_length=Ue,this.max_lazy=ni,this.nice_length=_r,this.max_chain=hr,this.func=ei}function _i(Ue){Ue.window_size=2*Ue.w_size,Yt(Ue.head),Ue.max_lazy_match=w[Ue.level].max_lazy,Ue.good_match=w[Ue.level].good_length,Ue.nice_match=w[Ue.level].nice_length,Ue.max_chain_length=w[Ue.level].max_chain,Ue.strstart=0,Ue.block_start=0,Ue.lookahead=0,Ue.insert=0,Ue.match_length=Ue.prev_length=dt-1,Ue.match_available=0,Ue.ins_h=0}function ki(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ge,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new $.Buf16(2*_t),this.dyn_dtree=new $.Buf16(2*(2*Oe+1)),this.bl_tree=new $.Buf16(2*(2*Be+1)),Yt(this.dyn_ltree),Yt(this.dyn_dtree),Yt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new $.Buf16(Et+1),this.heap=new $.Buf16(2*Te+1),Yt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new $.Buf16(2*Te+1),Yt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function yi(Ue){var ni;return Ue&&Ue.state?(Ue.total_in=Ue.total_out=0,Ue.data_type=me,(ni=Ue.state).pending=0,ni.pending_out=0,ni.wrap<0&&(ni.wrap=-ni.wrap),ni.status=ni.wrap?Qt:fr,Ue.adler=ni.wrap===2?0:1,ni.last_flush=q,I._tr_init(ni),Z):st(Ue,J)}function cr(Ue){var ni=yi(Ue);return ni===Z&&_i(Ue.state),ni}function di(Ue,ni){return Ue&&Ue.state?Ue.state.wrap!==2?J:(Ue.state.gzhead=ni,Z):J}function br(Ue,ni,_r,hr,ei,ri){if(!Ue)return J;var xi=1;if(ni===se&&(ni=6),hr<0?(xi=0,hr=-hr):hr>15&&(xi=2,hr-=16),ei<1||ei>fe||_r!==ge||hr<8||hr>15||ni<0||ni>9||ri<0||ri>oe)return st(Ue,J);hr===8&&(hr=9);var gi=new ki;return Ue.state=gi,gi.strm=Ue,gi.wrap=xi,gi.gzhead=null,gi.w_bits=hr,gi.w_size=1<<gi.w_bits,gi.w_mask=gi.w_size-1,gi.hash_bits=ei+7,gi.hash_size=1<<gi.hash_bits,gi.hash_mask=gi.hash_size-1,gi.hash_shift=~~((gi.hash_bits+dt-1)/dt),gi.window=new $.Buf8(2*gi.w_size),gi.head=new $.Buf16(gi.hash_size),gi.prev=new $.Buf16(gi.w_size),gi.lit_bufsize=1<<ei+6,gi.pending_buf_size=4*gi.lit_bufsize,gi.pending_buf=new $.Buf8(gi.pending_buf_size),gi.d_buf=1*gi.lit_bufsize,gi.l_buf=3*gi.lit_bufsize,gi.level=ni,gi.strategy=ri,gi.method=_r,cr(Ue)}function ii(Ue,ni){return br(Ue,ni,ge,xe,Fe,de)}function It(Ue,ni){var _r,hr,ei,ri;if(!Ue||!Ue.state||ni>V||ni<0)return Ue?st(Ue,J):J;if(hr=Ue.state,!Ue.output||!Ue.input&&Ue.avail_in!==0||hr.status===pr&&ni!==H)return st(Ue,Ue.avail_out===0?re:J);if(hr.strm=Ue,_r=hr.last_flush,hr.last_flush=ni,hr.status===Qt)if(hr.wrap===2)Ue.adler=0,ft(hr,31),ft(hr,139),ft(hr,8),hr.gzhead?(ft(hr,(hr.gzhead.text?1:0)+(hr.gzhead.hcrc?2:0)+(hr.gzhead.extra?4:0)+(hr.gzhead.name?8:0)+(hr.gzhead.comment?16:0)),ft(hr,255&hr.gzhead.time),ft(hr,hr.gzhead.time>>8&255),ft(hr,hr.gzhead.time>>16&255),ft(hr,hr.gzhead.time>>24&255),ft(hr,hr.level===9?2:hr.strategy>=ne||hr.level<2?4:0),ft(hr,255&hr.gzhead.os),hr.gzhead.extra&&hr.gzhead.extra.length&&(ft(hr,255&hr.gzhead.extra.length),ft(hr,hr.gzhead.extra.length>>8&255)),hr.gzhead.hcrc&&(Ue.adler=F(Ue.adler,hr.pending_buf,hr.pending,0)),hr.gzindex=0,hr.status=Vt):(ft(hr,0),ft(hr,0),ft(hr,0),ft(hr,0),ft(hr,0),ft(hr,hr.level===9?2:hr.strategy>=ne||hr.level<2?4:0),ft(hr,lt),hr.status=fr);else{var xi=ge+(hr.w_bits-8<<4)<<8;xi|=(hr.strategy>=ne||hr.level<2?0:hr.level<6?1:hr.level===6?2:3)<<6,hr.strstart!==0&&(xi|=bt),xi+=31-xi%31,hr.status=fr,ht(hr,xi),hr.strstart!==0&&(ht(hr,Ue.adler>>>16),ht(hr,65535&Ue.adler)),Ue.adler=1}if(hr.status===Vt)if(hr.gzhead.extra){for(ei=hr.pending;hr.gzindex<(65535&hr.gzhead.extra.length)&&(hr.pending!==hr.pending_buf_size||(hr.gzhead.hcrc&&hr.pending>ei&&(Ue.adler=F(Ue.adler,hr.pending_buf,hr.pending-ei,ei)),$e(Ue),ei=hr.pending,hr.pending!==hr.pending_buf_size));)ft(hr,255&hr.gzhead.extra[hr.gzindex]),hr.gzindex++;hr.gzhead.hcrc&&hr.pending>ei&&(Ue.adler=F(Ue.adler,hr.pending_buf,hr.pending-ei,ei)),hr.gzindex===hr.gzhead.extra.length&&(hr.gzindex=0,hr.status=ut)}else hr.status=ut;if(hr.status===ut)if(hr.gzhead.name){ei=hr.pending;do{if(hr.pending===hr.pending_buf_size&&(hr.gzhead.hcrc&&hr.pending>ei&&(Ue.adler=F(Ue.adler,hr.pending_buf,hr.pending-ei,ei)),$e(Ue),ei=hr.pending,hr.pending===hr.pending_buf_size)){ri=1;break}ri=hr.gzindex<hr.gzhead.name.length?255&hr.gzhead.name.charCodeAt(hr.gzindex++):0,ft(hr,ri)}while(ri!==0);hr.gzhead.hcrc&&hr.pending>ei&&(Ue.adler=F(Ue.adler,hr.pending_buf,hr.pending-ei,ei)),ri===0&&(hr.gzindex=0,hr.status=At)}else hr.status=At;if(hr.status===At)if(hr.gzhead.comment){ei=hr.pending;do{if(hr.pending===hr.pending_buf_size&&(hr.gzhead.hcrc&&hr.pending>ei&&(Ue.adler=F(Ue.adler,hr.pending_buf,hr.pending-ei,ei)),$e(Ue),ei=hr.pending,hr.pending===hr.pending_buf_size)){ri=1;break}ri=hr.gzindex<hr.gzhead.comment.length?255&hr.gzhead.comment.charCodeAt(hr.gzindex++):0,ft(hr,ri)}while(ri!==0);hr.gzhead.hcrc&&hr.pending>ei&&(Ue.adler=F(Ue.adler,hr.pending_buf,hr.pending-ei,ei)),ri===0&&(hr.status=dr)}else hr.status=dr;if(hr.status===dr&&(hr.gzhead.hcrc?(hr.pending+2>hr.pending_buf_size&&$e(Ue),hr.pending+2<=hr.pending_buf_size&&(ft(hr,255&Ue.adler),ft(hr,Ue.adler>>8&255),Ue.adler=0,hr.status=fr)):hr.status=fr),hr.pending!==0){if($e(Ue),Ue.avail_out===0)return hr.last_flush=-1,Z}else if(Ue.avail_in===0&&yt(ni)<=yt(_r)&&ni!==H)return st(Ue,re);if(hr.status===pr&&Ue.avail_in!==0)return st(Ue,re);if(Ue.avail_in!==0||hr.lookahead!==0||ni!==q&&hr.status!==pr){var gi=hr.strategy===ne?vi(hr,ni):hr.strategy===ce?ui(hr,ni):w[hr.level].func(hr,ni);if(gi!==Nt&&gi!==Xe||(hr.status=pr),gi===zt||gi===Nt)return Ue.avail_out===0&&(hr.last_flush=-1),Z;if(gi===Ce&&(ni===j?I._tr_align(hr):ni!==V&&(I._tr_stored_block(hr,0,0,!1),ni===G&&(Yt(hr.head),hr.lookahead===0&&(hr.strstart=0,hr.block_start=0,hr.insert=0))),$e(Ue),Ue.avail_out===0))return hr.last_flush=-1,Z}return ni!==H?Z:hr.wrap<=0?Q:(hr.wrap===2?(ft(hr,255&Ue.adler),ft(hr,Ue.adler>>8&255),ft(hr,Ue.adler>>16&255),ft(hr,Ue.adler>>24&255),ft(hr,255&Ue.total_in),ft(hr,Ue.total_in>>8&255),ft(hr,Ue.total_in>>16&255),ft(hr,Ue.total_in>>24&255)):(ht(hr,Ue.adler>>>16),ht(hr,65535&Ue.adler)),$e(Ue),hr.wrap>0&&(hr.wrap=-hr.wrap),hr.pending!==0?Z:Q)}function si(Ue){var ni;return Ue&&Ue.state?(ni=Ue.state.status)!==Qt&&ni!==Vt&&ni!==ut&&ni!==At&&ni!==dr&&ni!==fr&&ni!==pr?st(Ue,J):(Ue.state=null,ni===fr?st(Ue,ie):Z):J}function Ei(Ue,ni){var _r,hr,ei,ri,xi,gi,wi,Ii,Ui=ni.length;if(!Ue||!Ue.state||(ri=(_r=Ue.state).wrap)===2||ri===1&&_r.status!==Qt||_r.lookahead)return J;for(ri===1&&(Ue.adler=D(Ue.adler,ni,Ui,0)),_r.wrap=0,Ui>=_r.w_size&&(ri===0&&(Yt(_r.head),_r.strstart=0,_r.block_start=0,_r.insert=0),Ii=new $.Buf8(_r.w_size),$.arraySet(Ii,ni,Ui-_r.w_size,_r.w_size,0),ni=Ii,Ui=_r.w_size),xi=Ue.avail_in,gi=Ue.next_in,wi=Ue.input,Ue.avail_in=Ui,Ue.next_in=0,Ue.input=ni,li(_r);_r.lookahead>=dt;){hr=_r.strstart,ei=_r.lookahead-(dt-1);do _r.ins_h=(_r.ins_h<<_r.hash_shift^_r.window[hr+dt-1])&_r.hash_mask,_r.prev[hr&_r.w_mask]=_r.head[_r.ins_h],_r.head[_r.ins_h]=hr,hr++;while(--ei);_r.strstart=hr,_r.lookahead=dt-1,li(_r)}return _r.strstart+=_r.lookahead,_r.block_start=_r.strstart,_r.insert=_r.lookahead,_r.lookahead=0,_r.match_length=_r.prev_length=dt-1,_r.match_available=0,Ue.next_in=gi,Ue.input=wi,Ue.avail_in=xi,_r.wrap=ri,Z}w=[new bi(0,0,0,0,fi),new bi(4,4,8,4,ai),new bi(4,5,16,8,ai),new bi(4,6,32,32,ai),new bi(4,4,16,16,hi),new bi(8,16,32,32,hi),new bi(8,16,128,128,hi),new bi(8,32,128,256,hi),new bi(32,128,258,1024,hi),new bi(32,258,258,4096,hi)],g.deflateInit=ii,g.deflateInit2=br,g.deflateReset=cr,g.deflateResetKeep=yi,g.deflateSetHeader=di,g.deflate=It,g.deflateEnd=si,g.deflateSetDictionary=Ei,g.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":52,"./adler32":53,"./crc32":55,"./messages":60,"./trees":61}],57:[function(d,m,g){var w=30,$=12;m.exports=function(I,D){var F,U,q,j,G,H,V,Z,Q,J,ie,re,se,X,ne,ce,oe,de,me,ge,fe,xe,Fe,Te,Oe;F=I.state,U=I.next_in,Te=I.input,q=U+(I.avail_in-5),j=I.next_out,Oe=I.output,G=j-(D-I.avail_out),H=j+(I.avail_out-257),V=F.dmax,Z=F.wsize,Q=F.whave,J=F.wnext,ie=F.window,re=F.hold,se=F.bits,X=F.lencode,ne=F.distcode,ce=(1<<F.lenbits)-1,oe=(1<<F.distbits)-1;e:do{se<15&&(re+=Te[U++]<<se,se+=8,re+=Te[U++]<<se,se+=8),de=X[re&ce];t:for(;;){if(re>>>=me=de>>>24,se-=me,(me=de>>>16&255)==0)Oe[j++]=65535&de;else{if(!(16&me)){if(64&me){if(32&me){F.mode=$;break e}I.msg="invalid literal/length code",F.mode=w;break e}de=X[(65535&de)+(re&(1<<me)-1)];continue t}for(ge=65535&de,(me&=15)&&(se<me&&(re+=Te[U++]<<se,se+=8),ge+=re&(1<<me)-1,re>>>=me,se-=me),se<15&&(re+=Te[U++]<<se,se+=8,re+=Te[U++]<<se,se+=8),de=ne[re&oe];;){if(re>>>=me=de>>>24,se-=me,16&(me=de>>>16&255)){if(fe=65535&de,se<(me&=15)&&(re+=Te[U++]<<se,(se+=8)<me&&(re+=Te[U++]<<se,se+=8)),(fe+=re&(1<<me)-1)>V){I.msg="invalid distance too far back",F.mode=w;break e}if(re>>>=me,se-=me,fe>(me=j-G)){if((me=fe-me)>Q&&F.sane){I.msg="invalid distance too far back",F.mode=w;break e}if(xe=0,Fe=ie,J===0){if(xe+=Z-me,me<ge){ge-=me;do Oe[j++]=ie[xe++];while(--me);xe=j-fe,Fe=Oe}}else if(J<me){if(xe+=Z+J-me,(me-=J)<ge){ge-=me;do Oe[j++]=ie[xe++];while(--me);if(xe=0,J<ge){ge-=me=J;do Oe[j++]=ie[xe++];while(--me);xe=j-fe,Fe=Oe}}}else if(xe+=J-me,me<ge){ge-=me;do Oe[j++]=ie[xe++];while(--me);xe=j-fe,Fe=Oe}for(;ge>2;)Oe[j++]=Fe[xe++],Oe[j++]=Fe[xe++],Oe[j++]=Fe[xe++],ge-=3;ge&&(Oe[j++]=Fe[xe++],ge>1&&(Oe[j++]=Fe[xe++]))}else{xe=j-fe;do Oe[j++]=Oe[xe++],Oe[j++]=Oe[xe++],Oe[j++]=Oe[xe++],ge-=3;while(ge>2);ge&&(Oe[j++]=Oe[xe++],ge>1&&(Oe[j++]=Oe[xe++]))}break}if(64&me){I.msg="invalid distance code",F.mode=w;break e}de=ne[(65535&de)+(re&(1<<me)-1)]}}break}}while(U<q&&j<H);U-=ge=se>>3,re&=(1<<(se-=ge<<3))-1,I.next_in=U,I.next_out=j,I.avail_in=U<q?q-U+5:5-(U-q),I.avail_out=j<H?H-j+257:257-(j-H),F.hold=re,F.bits=se}},{}],58:[function(d,m,g){var w=d("../utils/common"),$=d("./adler32"),I=d("./crc32"),D=d("./inffast"),F=d("./inftrees"),U=0,q=1,j=2,G=4,H=5,V=6,Z=0,Q=1,J=2,ie=-2,re=-3,se=-4,X=-5,ne=8,ce=1,oe=2,de=3,me=4,ge=5,fe=6,xe=7,Fe=8,Te=9,Oe=10,Be=11,_t=12,Et=13,dt=14,Zt=15,Ye=16,bt=17,Qt=18,Vt=19,ut=20,At=21,dr=22,fr=23,pr=24,zt=25,Ce=26,Nt=27,Xe=28,lt=29,st=30,yt=31,Yt=852,$e=592,ze=15;function ft(br){return(br>>>24&255)+(br>>>8&65280)+((65280&br)<<8)+((255&br)<<24)}function ht(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new w.Buf16(320),this.work=new w.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function gr(br){var ii;return br&&br.state?(ii=br.state,br.total_in=br.total_out=ii.total=0,br.msg="",ii.wrap&&(br.adler=1&ii.wrap),ii.mode=ce,ii.last=0,ii.havedict=0,ii.dmax=32768,ii.head=null,ii.hold=0,ii.bits=0,ii.lencode=ii.lendyn=new w.Buf32(Yt),ii.distcode=ii.distdyn=new w.Buf32($e),ii.sane=1,ii.back=-1,Z):ie}function yr(br){var ii;return br&&br.state?((ii=br.state).wsize=0,ii.whave=0,ii.wnext=0,gr(br)):ie}function li(br,ii){var It,si;return br&&br.state?(si=br.state,ii<0?(It=0,ii=-ii):(It=1+(ii>>4),ii<48&&(ii&=15)),ii&&(ii<8||ii>15)?ie:(si.window!==null&&si.wbits!==ii&&(si.window=null),si.wrap=It,si.wbits=ii,yr(br))):ie}function fi(br,ii){var It,si;return br?(si=new ht,br.state=si,si.window=null,(It=li(br,ii))!==Z&&(br.state=null),It):ie}function ai(br){return fi(br,ze)}var hi,ui,vi=!0;function bi(br){if(vi){var ii;for(hi=new w.Buf32(512),ui=new w.Buf32(32),ii=0;ii<144;)br.lens[ii++]=8;for(;ii<256;)br.lens[ii++]=9;for(;ii<280;)br.lens[ii++]=7;for(;ii<288;)br.lens[ii++]=8;for(F(q,br.lens,0,288,hi,0,br.work,{bits:9}),ii=0;ii<32;)br.lens[ii++]=5;F(j,br.lens,0,32,ui,0,br.work,{bits:5}),vi=!1}br.lencode=hi,br.lenbits=9,br.distcode=ui,br.distbits=5}function _i(br,ii,It,si){var Ei,Ue=br.state;return Ue.window===null&&(Ue.wsize=1<<Ue.wbits,Ue.wnext=0,Ue.whave=0,Ue.window=new w.Buf8(Ue.wsize)),si>=Ue.wsize?(w.arraySet(Ue.window,ii,It-Ue.wsize,Ue.wsize,0),Ue.wnext=0,Ue.whave=Ue.wsize):((Ei=Ue.wsize-Ue.wnext)>si&&(Ei=si),w.arraySet(Ue.window,ii,It-si,Ei,Ue.wnext),(si-=Ei)?(w.arraySet(Ue.window,ii,It-si,si,0),Ue.wnext=si,Ue.whave=Ue.wsize):(Ue.wnext+=Ei,Ue.wnext===Ue.wsize&&(Ue.wnext=0),Ue.whave<Ue.wsize&&(Ue.whave+=Ei))),0}function ki(br,ii){var It,si,Ei,Ue,ni,_r,hr,ei,ri,xi,gi,wi,Ii,Ui,Ti,Mi,Di,Bi,Vi,Ki,Ni,Oi,qi,zi,Ri=0,Pi=new w.Buf8(4),yn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!br||!br.state||!br.output||!br.input&&br.avail_in!==0)return ie;(It=br.state).mode===_t&&(It.mode=Et),ni=br.next_out,Ei=br.output,hr=br.avail_out,Ue=br.next_in,si=br.input,_r=br.avail_in,ei=It.hold,ri=It.bits,xi=_r,gi=hr,Oi=Z;e:for(;;)switch(It.mode){case ce:if(It.wrap===0){It.mode=Et;break}for(;ri<16;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}if(2&It.wrap&&ei===35615){It.check=0,Pi[0]=255&ei,Pi[1]=ei>>>8&255,It.check=I(It.check,Pi,2,0),ei=0,ri=0,It.mode=oe;break}if(It.flags=0,It.head&&(It.head.done=!1),!(1&It.wrap)||(((255&ei)<<8)+(ei>>8))%31){br.msg="incorrect header check",It.mode=st;break}if((15&ei)!==ne){br.msg="unknown compression method",It.mode=st;break}if(ri-=4,Ni=8+(15&(ei>>>=4)),It.wbits===0)It.wbits=Ni;else if(Ni>It.wbits){br.msg="invalid window size",It.mode=st;break}It.dmax=1<<Ni,br.adler=It.check=1,It.mode=512&ei?Oe:_t,ei=0,ri=0;break;case oe:for(;ri<16;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}if(It.flags=ei,(255&It.flags)!==ne){br.msg="unknown compression method",It.mode=st;break}if(57344&It.flags){br.msg="unknown header flags set",It.mode=st;break}It.head&&(It.head.text=ei>>8&1),512&It.flags&&(Pi[0]=255&ei,Pi[1]=ei>>>8&255,It.check=I(It.check,Pi,2,0)),ei=0,ri=0,It.mode=de;case de:for(;ri<32;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}It.head&&(It.head.time=ei),512&It.flags&&(Pi[0]=255&ei,Pi[1]=ei>>>8&255,Pi[2]=ei>>>16&255,Pi[3]=ei>>>24&255,It.check=I(It.check,Pi,4,0)),ei=0,ri=0,It.mode=me;case me:for(;ri<16;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}It.head&&(It.head.xflags=255&ei,It.head.os=ei>>8),512&It.flags&&(Pi[0]=255&ei,Pi[1]=ei>>>8&255,It.check=I(It.check,Pi,2,0)),ei=0,ri=0,It.mode=ge;case ge:if(1024&It.flags){for(;ri<16;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}It.length=ei,It.head&&(It.head.extra_len=ei),512&It.flags&&(Pi[0]=255&ei,Pi[1]=ei>>>8&255,It.check=I(It.check,Pi,2,0)),ei=0,ri=0}else It.head&&(It.head.extra=null);It.mode=fe;case fe:if(1024&It.flags&&((wi=It.length)>_r&&(wi=_r),wi&&(It.head&&(Ni=It.head.extra_len-It.length,It.head.extra||(It.head.extra=new Array(It.head.extra_len)),w.arraySet(It.head.extra,si,Ue,wi,Ni)),512&It.flags&&(It.check=I(It.check,si,wi,Ue)),_r-=wi,Ue+=wi,It.length-=wi),It.length))break e;It.length=0,It.mode=xe;case xe:if(2048&It.flags){if(_r===0)break e;wi=0;do Ni=si[Ue+wi++],It.head&&Ni&&It.length<65536&&(It.head.name+=String.fromCharCode(Ni));while(Ni&&wi<_r);if(512&It.flags&&(It.check=I(It.check,si,wi,Ue)),_r-=wi,Ue+=wi,Ni)break e}else It.head&&(It.head.name=null);It.length=0,It.mode=Fe;case Fe:if(4096&It.flags){if(_r===0)break e;wi=0;do Ni=si[Ue+wi++],It.head&&Ni&&It.length<65536&&(It.head.comment+=String.fromCharCode(Ni));while(Ni&&wi<_r);if(512&It.flags&&(It.check=I(It.check,si,wi,Ue)),_r-=wi,Ue+=wi,Ni)break e}else It.head&&(It.head.comment=null);It.mode=Te;case Te:if(512&It.flags){for(;ri<16;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}if(ei!==(65535&It.check)){br.msg="header crc mismatch",It.mode=st;break}ei=0,ri=0}It.head&&(It.head.hcrc=It.flags>>9&1,It.head.done=!0),br.adler=It.check=0,It.mode=_t;break;case Oe:for(;ri<32;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}br.adler=It.check=ft(ei),ei=0,ri=0,It.mode=Be;case Be:if(It.havedict===0)return br.next_out=ni,br.avail_out=hr,br.next_in=Ue,br.avail_in=_r,It.hold=ei,It.bits=ri,J;br.adler=It.check=1,It.mode=_t;case _t:if(ii===H||ii===V)break e;case Et:if(It.last){ei>>>=7&ri,ri-=7&ri,It.mode=Nt;break}for(;ri<3;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}switch(It.last=1&ei,ri-=1,3&(ei>>>=1)){case 0:It.mode=dt;break;case 1:if(bi(It),It.mode=ut,ii===V){ei>>>=2,ri-=2;break e}break;case 2:It.mode=bt;break;case 3:br.msg="invalid block type",It.mode=st}ei>>>=2,ri-=2;break;case dt:for(ei>>>=7&ri,ri-=7&ri;ri<32;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}if((65535&ei)!=(ei>>>16^65535)){br.msg="invalid stored block lengths",It.mode=st;break}if(It.length=65535&ei,ei=0,ri=0,It.mode=Zt,ii===V)break e;case Zt:It.mode=Ye;case Ye:if(wi=It.length){if(wi>_r&&(wi=_r),wi>hr&&(wi=hr),wi===0)break e;w.arraySet(Ei,si,Ue,wi,ni),_r-=wi,Ue+=wi,hr-=wi,ni+=wi,It.length-=wi;break}It.mode=_t;break;case bt:for(;ri<14;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}if(It.nlen=257+(31&ei),ei>>>=5,ri-=5,It.ndist=1+(31&ei),ei>>>=5,ri-=5,It.ncode=4+(15&ei),ei>>>=4,ri-=4,It.nlen>286||It.ndist>30){br.msg="too many length or distance symbols",It.mode=st;break}It.have=0,It.mode=Qt;case Qt:for(;It.have<It.ncode;){for(;ri<3;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}It.lens[yn[It.have++]]=7&ei,ei>>>=3,ri-=3}for(;It.have<19;)It.lens[yn[It.have++]]=0;if(It.lencode=It.lendyn,It.lenbits=7,qi={bits:It.lenbits},Oi=F(U,It.lens,0,19,It.lencode,0,It.work,qi),It.lenbits=qi.bits,Oi){br.msg="invalid code lengths set",It.mode=st;break}It.have=0,It.mode=Vt;case Vt:for(;It.have<It.nlen+It.ndist;){for(;Mi=(Ri=It.lencode[ei&(1<<It.lenbits)-1])>>>16&255,Di=65535&Ri,!((Ti=Ri>>>24)<=ri);){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}if(Di<16)ei>>>=Ti,ri-=Ti,It.lens[It.have++]=Di;else{if(Di===16){for(zi=Ti+2;ri<zi;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}if(ei>>>=Ti,ri-=Ti,It.have===0){br.msg="invalid bit length repeat",It.mode=st;break}Ni=It.lens[It.have-1],wi=3+(3&ei),ei>>>=2,ri-=2}else if(Di===17){for(zi=Ti+3;ri<zi;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}ri-=Ti,Ni=0,wi=3+(7&(ei>>>=Ti)),ei>>>=3,ri-=3}else{for(zi=Ti+7;ri<zi;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}ri-=Ti,Ni=0,wi=11+(127&(ei>>>=Ti)),ei>>>=7,ri-=7}if(It.have+wi>It.nlen+It.ndist){br.msg="invalid bit length repeat",It.mode=st;break}for(;wi--;)It.lens[It.have++]=Ni}}if(It.mode===st)break;if(It.lens[256]===0){br.msg="invalid code -- missing end-of-block",It.mode=st;break}if(It.lenbits=9,qi={bits:It.lenbits},Oi=F(q,It.lens,0,It.nlen,It.lencode,0,It.work,qi),It.lenbits=qi.bits,Oi){br.msg="invalid literal/lengths set",It.mode=st;break}if(It.distbits=6,It.distcode=It.distdyn,qi={bits:It.distbits},Oi=F(j,It.lens,It.nlen,It.ndist,It.distcode,0,It.work,qi),It.distbits=qi.bits,Oi){br.msg="invalid distances set",It.mode=st;break}if(It.mode=ut,ii===V)break e;case ut:It.mode=At;case At:if(_r>=6&&hr>=258){br.next_out=ni,br.avail_out=hr,br.next_in=Ue,br.avail_in=_r,It.hold=ei,It.bits=ri,D(br,gi),ni=br.next_out,Ei=br.output,hr=br.avail_out,Ue=br.next_in,si=br.input,_r=br.avail_in,ei=It.hold,ri=It.bits,It.mode===_t&&(It.back=-1);break}for(It.back=0;Mi=(Ri=It.lencode[ei&(1<<It.lenbits)-1])>>>16&255,Di=65535&Ri,!((Ti=Ri>>>24)<=ri);){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}if(Mi&&!(240&Mi)){for(Bi=Ti,Vi=Mi,Ki=Di;Mi=(Ri=It.lencode[Ki+((ei&(1<<Bi+Vi)-1)>>Bi)])>>>16&255,Di=65535&Ri,!(Bi+(Ti=Ri>>>24)<=ri);){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}ei>>>=Bi,ri-=Bi,It.back+=Bi}if(ei>>>=Ti,ri-=Ti,It.back+=Ti,It.length=Di,Mi===0){It.mode=Ce;break}if(32&Mi){It.back=-1,It.mode=_t;break}if(64&Mi){br.msg="invalid literal/length code",It.mode=st;break}It.extra=15&Mi,It.mode=dr;case dr:if(It.extra){for(zi=It.extra;ri<zi;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}It.length+=ei&(1<<It.extra)-1,ei>>>=It.extra,ri-=It.extra,It.back+=It.extra}It.was=It.length,It.mode=fr;case fr:for(;Mi=(Ri=It.distcode[ei&(1<<It.distbits)-1])>>>16&255,Di=65535&Ri,!((Ti=Ri>>>24)<=ri);){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}if(!(240&Mi)){for(Bi=Ti,Vi=Mi,Ki=Di;Mi=(Ri=It.distcode[Ki+((ei&(1<<Bi+Vi)-1)>>Bi)])>>>16&255,Di=65535&Ri,!(Bi+(Ti=Ri>>>24)<=ri);){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}ei>>>=Bi,ri-=Bi,It.back+=Bi}if(ei>>>=Ti,ri-=Ti,It.back+=Ti,64&Mi){br.msg="invalid distance code",It.mode=st;break}It.offset=Di,It.extra=15&Mi,It.mode=pr;case pr:if(It.extra){for(zi=It.extra;ri<zi;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}It.offset+=ei&(1<<It.extra)-1,ei>>>=It.extra,ri-=It.extra,It.back+=It.extra}if(It.offset>It.dmax){br.msg="invalid distance too far back",It.mode=st;break}It.mode=zt;case zt:if(hr===0)break e;if(wi=gi-hr,It.offset>wi){if((wi=It.offset-wi)>It.whave&&It.sane){br.msg="invalid distance too far back",It.mode=st;break}wi>It.wnext?(wi-=It.wnext,Ii=It.wsize-wi):Ii=It.wnext-wi,wi>It.length&&(wi=It.length),Ui=It.window}else Ui=Ei,Ii=ni-It.offset,wi=It.length;wi>hr&&(wi=hr),hr-=wi,It.length-=wi;do Ei[ni++]=Ui[Ii++];while(--wi);It.length===0&&(It.mode=At);break;case Ce:if(hr===0)break e;Ei[ni++]=It.length,hr--,It.mode=At;break;case Nt:if(It.wrap){for(;ri<32;){if(_r===0)break e;_r--,ei|=si[Ue++]<<ri,ri+=8}if(gi-=hr,br.total_out+=gi,It.total+=gi,gi&&(br.adler=It.check=It.flags?I(It.check,Ei,gi,ni-gi):$(It.check,Ei,gi,ni-gi)),gi=hr,(It.flags?ei:ft(ei))!==It.check){br.msg="incorrect data check",It.mode=st;break}ei=0,ri=0}It.mode=Xe;case Xe:if(It.wrap&&It.flags){for(;ri<32;){if(_r===0)break e;_r--,ei+=si[Ue++]<<ri,ri+=8}if(ei!==(4294967295&It.total)){br.msg="incorrect length check",It.mode=st;break}ei=0,ri=0}It.mode=lt;case lt:Oi=Q;break e;case st:Oi=re;break e;case yt:return se;default:return ie}return br.next_out=ni,br.avail_out=hr,br.next_in=Ue,br.avail_in=_r,It.hold=ei,It.bits=ri,(It.wsize||gi!==br.avail_out&&It.mode<st&&(It.mode<Nt||ii!==G))&&_i(br,br.output,br.next_out,gi-br.avail_out),xi-=br.avail_in,gi-=br.avail_out,br.total_in+=xi,br.total_out+=gi,It.total+=gi,It.wrap&&gi&&(br.adler=It.check=It.flags?I(It.check,Ei,gi,br.next_out-gi):$(It.check,Ei,gi,br.next_out-gi)),br.data_type=It.bits+(It.last?64:0)+(It.mode===_t?128:0)+(It.mode===ut||It.mode===Zt?256:0),(xi===0&&gi===0||ii===G)&&Oi===Z&&(Oi=X),Oi}function yi(br){if(!br||!br.state)return ie;var ii=br.state;return ii.window&&(ii.window=null),br.state=null,Z}function cr(br,ii){var It;return br&&br.state&&2&(It=br.state).wrap?(It.head=ii,ii.done=!1,Z):ie}function di(br,ii){var It,si=ii.length;return br&&br.state?(It=br.state).wrap!==0&&It.mode!==Be?ie:It.mode===Be&&$(1,ii,si,0)!==It.check?re:_i(br,ii,si,si)?(It.mode=yt,se):(It.havedict=1,Z):ie}g.inflateReset=yr,g.inflateReset2=li,g.inflateResetKeep=gr,g.inflateInit=ai,g.inflateInit2=fi,g.inflate=ki,g.inflateEnd=yi,g.inflateGetHeader=cr,g.inflateSetDictionary=di,g.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":52,"./adler32":53,"./crc32":55,"./inffast":57,"./inftrees":59}],59:[function(d,m,g){var w=d("../utils/common"),$=15,I=852,D=592,F=0,U=1,q=2,j=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],G=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],H=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],V=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];m.exports=function(Z,Q,J,ie,re,se,X,ne){var ce,oe,de,me,ge,fe,xe,Fe,Te,Oe=ne.bits,Be=0,_t=0,Et=0,dt=0,Zt=0,Ye=0,bt=0,Qt=0,Vt=0,ut=0,At=null,dr=0,fr=new w.Buf16($+1),pr=new w.Buf16($+1),zt=null,Ce=0;for(Be=0;Be<=$;Be++)fr[Be]=0;for(_t=0;_t<ie;_t++)fr[Q[J+_t]]++;for(Zt=Oe,dt=$;dt>=1&&fr[dt]===0;dt--);if(Zt>dt&&(Zt=dt),dt===0)return re[se++]=20971520,re[se++]=20971520,ne.bits=1,0;for(Et=1;Et<dt&&fr[Et]===0;Et++);for(Zt<Et&&(Zt=Et),Qt=1,Be=1;Be<=$;Be++)if(Qt<<=1,(Qt-=fr[Be])<0)return-1;if(Qt>0&&(Z===F||dt!==1))return-1;for(pr[1]=0,Be=1;Be<$;Be++)pr[Be+1]=pr[Be]+fr[Be];for(_t=0;_t<ie;_t++)Q[J+_t]!==0&&(X[pr[Q[J+_t]]++]=_t);if(Z===F?(At=zt=X,fe=19):Z===U?(At=j,dr-=257,zt=G,Ce-=257,fe=256):(At=H,zt=V,fe=-1),ut=0,_t=0,Be=Et,ge=se,Ye=Zt,bt=0,de=-1,me=(Vt=1<<Zt)-1,Z===U&&Vt>I||Z===q&&Vt>D)return 1;for(;;){xe=Be-bt,X[_t]<fe?(Fe=0,Te=X[_t]):X[_t]>fe?(Fe=zt[Ce+X[_t]],Te=At[dr+X[_t]]):(Fe=96,Te=0),ce=1<<Be-bt,Et=oe=1<<Ye;do re[ge+(ut>>bt)+(oe-=ce)]=xe<<24|Fe<<16|Te;while(oe!==0);for(ce=1<<Be-1;ut&ce;)ce>>=1;if(ce!==0?(ut&=ce-1,ut+=ce):ut=0,_t++,--fr[Be]==0){if(Be===dt)break;Be=Q[J+X[_t]]}if(Be>Zt&&(ut&me)!==de){for(bt===0&&(bt=Zt),ge+=Et,Qt=1<<(Ye=Be-bt);Ye+bt<dt&&!((Qt-=fr[Ye+bt])<=0);)Ye++,Qt<<=1;if(Vt+=1<<Ye,Z===U&&Vt>I||Z===q&&Vt>D)return 1;re[de=ut&me]=Zt<<24|Ye<<16|ge-se}}return ut!==0&&(re[ge+ut]=Be-bt<<24|64<<16),ne.bits=Zt,0}},{"../utils/common":52}],60:[function(d,m,g){m.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],61:[function(d,m,g){var w=d("../utils/common"),$=4,I=0,D=1,F=2;function U(cr){for(var di=cr.length;--di>=0;)cr[di]=0}var q=0,j=1,G=2,H=3,V=258,Z=29,Q=256,J=Q+1+Z,ie=30,re=19,se=2*J+1,X=15,ne=16,ce=7,oe=256,de=16,me=17,ge=18,fe=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],xe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Fe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Oe=512,Be=new Array(2*(J+2));U(Be);var _t=new Array(2*ie);U(_t);var Et=new Array(Oe);U(Et);var dt=new Array(V-H+1);U(dt);var Zt=new Array(Z);U(Zt);var Ye,bt,Qt,Vt=new Array(ie);function ut(cr,di,br,ii,It){this.static_tree=cr,this.extra_bits=di,this.extra_base=br,this.elems=ii,this.max_length=It,this.has_stree=cr&&cr.length}function At(cr,di){this.dyn_tree=cr,this.max_code=0,this.stat_desc=di}function dr(cr){return cr<256?Et[cr]:Et[256+(cr>>>7)]}function fr(cr,di){cr.pending_buf[cr.pending++]=255&di,cr.pending_buf[cr.pending++]=di>>>8&255}function pr(cr,di,br){cr.bi_valid>ne-br?(cr.bi_buf|=di<<cr.bi_valid&65535,fr(cr,cr.bi_buf),cr.bi_buf=di>>ne-cr.bi_valid,cr.bi_valid+=br-ne):(cr.bi_buf|=di<<cr.bi_valid&65535,cr.bi_valid+=br)}function zt(cr,di,br){pr(cr,br[2*di],br[2*di+1])}function Ce(cr,di){var br=0;do br|=1&cr,cr>>>=1,br<<=1;while(--di>0);return br>>>1}function Nt(cr){cr.bi_valid===16?(fr(cr,cr.bi_buf),cr.bi_buf=0,cr.bi_valid=0):cr.bi_valid>=8&&(cr.pending_buf[cr.pending++]=255&cr.bi_buf,cr.bi_buf>>=8,cr.bi_valid-=8)}function Xe(cr,di){var br,ii,It,si,Ei,Ue,ni=di.dyn_tree,_r=di.max_code,hr=di.stat_desc.static_tree,ei=di.stat_desc.has_stree,ri=di.stat_desc.extra_bits,xi=di.stat_desc.extra_base,gi=di.stat_desc.max_length,wi=0;for(si=0;si<=X;si++)cr.bl_count[si]=0;for(ni[2*cr.heap[cr.heap_max]+1]=0,br=cr.heap_max+1;br<se;br++)(si=ni[2*ni[2*(ii=cr.heap[br])+1]+1]+1)>gi&&(si=gi,wi++),ni[2*ii+1]=si,ii>_r||(cr.bl_count[si]++,Ei=0,ii>=xi&&(Ei=ri[ii-xi]),Ue=ni[2*ii],cr.opt_len+=Ue*(si+Ei),ei&&(cr.static_len+=Ue*(hr[2*ii+1]+Ei)));if(wi!==0){do{for(si=gi-1;cr.bl_count[si]===0;)si--;cr.bl_count[si]--,cr.bl_count[si+1]+=2,cr.bl_count[gi]--,wi-=2}while(wi>0);for(si=gi;si!==0;si--)for(ii=cr.bl_count[si];ii!==0;)(It=cr.heap[--br])>_r||(ni[2*It+1]!==si&&(cr.opt_len+=(si-ni[2*It+1])*ni[2*It],ni[2*It+1]=si),ii--)}}function lt(cr,di,br){var ii,It,si=new Array(X+1),Ei=0;for(ii=1;ii<=X;ii++)si[ii]=Ei=Ei+br[ii-1]<<1;for(It=0;It<=di;It++){var Ue=cr[2*It+1];Ue!==0&&(cr[2*It]=Ce(si[Ue]++,Ue))}}function st(){var cr,di,br,ii,It,si=new Array(X+1);for(br=0,ii=0;ii<Z-1;ii++)for(Zt[ii]=br,cr=0;cr<1<<fe[ii];cr++)dt[br++]=ii;for(dt[br-1]=ii,It=0,ii=0;ii<16;ii++)for(Vt[ii]=It,cr=0;cr<1<<xe[ii];cr++)Et[It++]=ii;for(It>>=7;ii<ie;ii++)for(Vt[ii]=It<<7,cr=0;cr<1<<xe[ii]-7;cr++)Et[256+It++]=ii;for(di=0;di<=X;di++)si[di]=0;for(cr=0;cr<=143;)Be[2*cr+1]=8,cr++,si[8]++;for(;cr<=255;)Be[2*cr+1]=9,cr++,si[9]++;for(;cr<=279;)Be[2*cr+1]=7,cr++,si[7]++;for(;cr<=287;)Be[2*cr+1]=8,cr++,si[8]++;for(lt(Be,J+1,si),cr=0;cr<ie;cr++)_t[2*cr+1]=5,_t[2*cr]=Ce(cr,5);Ye=new ut(Be,fe,Q+1,J,X),bt=new ut(_t,xe,0,ie,X),Qt=new ut(new Array(0),Fe,0,re,ce)}function yt(cr){var di;for(di=0;di<J;di++)cr.dyn_ltree[2*di]=0;for(di=0;di<ie;di++)cr.dyn_dtree[2*di]=0;for(di=0;di<re;di++)cr.bl_tree[2*di]=0;cr.dyn_ltree[2*oe]=1,cr.opt_len=cr.static_len=0,cr.last_lit=cr.matches=0}function Yt(cr){cr.bi_valid>8?fr(cr,cr.bi_buf):cr.bi_valid>0&&(cr.pending_buf[cr.pending++]=cr.bi_buf),cr.bi_buf=0,cr.bi_valid=0}function $e(cr,di,br,ii){Yt(cr),fr(cr,br),fr(cr,~br),w.arraySet(cr.pending_buf,cr.window,di,br,cr.pending),cr.pending+=br}function ze(cr,di,br,ii){var It=2*di,si=2*br;return cr[It]<cr[si]||cr[It]===cr[si]&&ii[di]<=ii[br]}function ft(cr,di,br){for(var ii=cr.heap[br],It=br<<1;It<=cr.heap_len&&(It<cr.heap_len&&ze(di,cr.heap[It+1],cr.heap[It],cr.depth)&&It++,!ze(di,ii,cr.heap[It],cr.depth));)cr.heap[br]=cr.heap[It],br=It,It<<=1;cr.heap[br]=ii}function ht(cr,di,br){var ii,It,si,Ei,Ue=0;if(cr.last_lit!==0)do ii=cr.pending_buf[cr.d_buf+2*Ue]<<8|cr.pending_buf[cr.d_buf+2*Ue+1],It=cr.pending_buf[cr.l_buf+Ue],Ue++,ii===0?zt(cr,It,di):(zt(cr,(si=dt[It])+Q+1,di),(Ei=fe[si])!==0&&pr(cr,It-=Zt[si],Ei),zt(cr,si=dr(--ii),br),(Ei=xe[si])!==0&&pr(cr,ii-=Vt[si],Ei));while(Ue<cr.last_lit);zt(cr,oe,di)}function gr(cr,di){var br,ii,It,si=di.dyn_tree,Ei=di.stat_desc.static_tree,Ue=di.stat_desc.has_stree,ni=di.stat_desc.elems,_r=-1;for(cr.heap_len=0,cr.heap_max=se,br=0;br<ni;br++)si[2*br]!==0?(cr.heap[++cr.heap_len]=_r=br,cr.depth[br]=0):si[2*br+1]=0;for(;cr.heap_len<2;)si[2*(It=cr.heap[++cr.heap_len]=_r<2?++_r:0)]=1,cr.depth[It]=0,cr.opt_len--,Ue&&(cr.static_len-=Ei[2*It+1]);for(di.max_code=_r,br=cr.heap_len>>1;br>=1;br--)ft(cr,si,br);It=ni;do br=cr.heap[1],cr.heap[1]=cr.heap[cr.heap_len--],ft(cr,si,1),ii=cr.heap[1],cr.heap[--cr.heap_max]=br,cr.heap[--cr.heap_max]=ii,si[2*It]=si[2*br]+si[2*ii],cr.depth[It]=(cr.depth[br]>=cr.depth[ii]?cr.depth[br]:cr.depth[ii])+1,si[2*br+1]=si[2*ii+1]=It,cr.heap[1]=It++,ft(cr,si,1);while(cr.heap_len>=2);cr.heap[--cr.heap_max]=cr.heap[1],Xe(cr,di),lt(si,_r,cr.bl_count)}function yr(cr,di,br){var ii,It,si=-1,Ei=di[1],Ue=0,ni=7,_r=4;for(Ei===0&&(ni=138,_r=3),di[2*(br+1)+1]=65535,ii=0;ii<=br;ii++)It=Ei,Ei=di[2*(ii+1)+1],++Ue<ni&&It===Ei||(Ue<_r?cr.bl_tree[2*It]+=Ue:It!==0?(It!==si&&cr.bl_tree[2*It]++,cr.bl_tree[2*de]++):Ue<=10?cr.bl_tree[2*me]++:cr.bl_tree[2*ge]++,Ue=0,si=It,Ei===0?(ni=138,_r=3):It===Ei?(ni=6,_r=3):(ni=7,_r=4))}function li(cr,di,br){var ii,It,si=-1,Ei=di[1],Ue=0,ni=7,_r=4;for(Ei===0&&(ni=138,_r=3),ii=0;ii<=br;ii++)if(It=Ei,Ei=di[2*(ii+1)+1],!(++Ue<ni&&It===Ei)){if(Ue<_r)do zt(cr,It,cr.bl_tree);while(--Ue!=0);else It!==0?(It!==si&&(zt(cr,It,cr.bl_tree),Ue--),zt(cr,de,cr.bl_tree),pr(cr,Ue-3,2)):Ue<=10?(zt(cr,me,cr.bl_tree),pr(cr,Ue-3,3)):(zt(cr,ge,cr.bl_tree),pr(cr,Ue-11,7));Ue=0,si=It,Ei===0?(ni=138,_r=3):It===Ei?(ni=6,_r=3):(ni=7,_r=4)}}function fi(cr){var di;for(yr(cr,cr.dyn_ltree,cr.l_desc.max_code),yr(cr,cr.dyn_dtree,cr.d_desc.max_code),gr(cr,cr.bl_desc),di=re-1;di>=3&&cr.bl_tree[2*Te[di]+1]===0;di--);return cr.opt_len+=3*(di+1)+5+5+4,di}function ai(cr,di,br,ii){var It;for(pr(cr,di-257,5),pr(cr,br-1,5),pr(cr,ii-4,4),It=0;It<ii;It++)pr(cr,cr.bl_tree[2*Te[It]+1],3);li(cr,cr.dyn_ltree,di-1),li(cr,cr.dyn_dtree,br-1)}function hi(cr){var di,br=4093624447;for(di=0;di<=31;di++,br>>>=1)if(1&br&&cr.dyn_ltree[2*di]!==0)return I;if(cr.dyn_ltree[18]!==0||cr.dyn_ltree[20]!==0||cr.dyn_ltree[26]!==0)return D;for(di=32;di<Q;di++)if(cr.dyn_ltree[2*di]!==0)return D;return I}U(Vt);var ui=!1;function vi(cr){ui||(st(),ui=!0),cr.l_desc=new At(cr.dyn_ltree,Ye),cr.d_desc=new At(cr.dyn_dtree,bt),cr.bl_desc=new At(cr.bl_tree,Qt),cr.bi_buf=0,cr.bi_valid=0,yt(cr)}function bi(cr,di,br,ii){pr(cr,(q<<1)+(ii?1:0),3),$e(cr,di,br)}function _i(cr){pr(cr,j<<1,3),zt(cr,oe,Be),Nt(cr)}function ki(cr,di,br,ii){var It,si,Ei=0;cr.level>0?(cr.strm.data_type===F&&(cr.strm.data_type=hi(cr)),gr(cr,cr.l_desc),gr(cr,cr.d_desc),Ei=fi(cr),It=cr.opt_len+3+7>>>3,(si=cr.static_len+3+7>>>3)<=It&&(It=si)):It=si=br+5,br+4<=It&&di!==-1?bi(cr,di,br,ii):cr.strategy===$||si===It?(pr(cr,(j<<1)+(ii?1:0),3),ht(cr,Be,_t)):(pr(cr,(G<<1)+(ii?1:0),3),ai(cr,cr.l_desc.max_code+1,cr.d_desc.max_code+1,Ei+1),ht(cr,cr.dyn_ltree,cr.dyn_dtree)),yt(cr),ii&&Yt(cr)}function yi(cr,di,br){return cr.pending_buf[cr.d_buf+2*cr.last_lit]=di>>>8&255,cr.pending_buf[cr.d_buf+2*cr.last_lit+1]=255&di,cr.pending_buf[cr.l_buf+cr.last_lit]=255&br,cr.last_lit++,di===0?cr.dyn_ltree[2*br]++:(cr.matches++,di--,cr.dyn_ltree[2*(dt[br]+Q+1)]++,cr.dyn_dtree[2*dr(di)]++),cr.last_lit===cr.lit_bufsize-1}g._tr_init=vi,g._tr_stored_block=bi,g._tr_flush_block=ki,g._tr_tally=yi,g._tr_align=_i},{"../utils/common":52}],62:[function(d,m,g){function w(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}m.exports=w},{}],63:[function(d,m,g){var w,$,I=m.exports={};function D(){throw new Error("setTimeout has not been defined")}function F(){throw new Error("clearTimeout has not been defined")}function U(re){if(w===setTimeout)return setTimeout(re,0);if((w===D||!w)&&setTimeout)return w=setTimeout,setTimeout(re,0);try{return w(re,0)}catch{try{return w.call(null,re,0)}catch{return w.call(this,re,0)}}}function q(re){if($===clearTimeout)return clearTimeout(re);if(($===F||!$)&&clearTimeout)return $=clearTimeout,clearTimeout(re);try{return $(re)}catch{try{return $.call(null,re)}catch{return $.call(this,re)}}}(function(){try{w=typeof setTimeout=="function"?setTimeout:D}catch{w=D}try{$=typeof clearTimeout=="function"?clearTimeout:F}catch{$=F}})();var j,G=[],H=!1,V=-1;function Z(){H&&j&&(H=!1,j.length?G=j.concat(G):V=-1,G.length&&Q())}function Q(){if(!H){var re=U(Z);H=!0;for(var se=G.length;se;){for(j=G,G=[];++V<se;)j&&j[V].run();V=-1,se=G.length}j=null,H=!1,q(re)}}function J(re,se){this.fun=re,this.array=se}function ie(){}I.nextTick=function(re){var se=new Array(arguments.length-1);if(arguments.length>1)for(var X=1;X<arguments.length;X++)se[X-1]=arguments[X];G.push(new J(re,se)),G.length!==1||H||U(Q)},J.prototype.run=function(){this.fun.apply(null,this.array)},I.title="browser",I.browser=!0,I.env={},I.argv=[],I.version="",I.versions={},I.on=ie,I.addListener=ie,I.once=ie,I.off=ie,I.removeListener=ie,I.removeAllListeners=ie,I.emit=ie,I.prependListener=ie,I.prependOnceListener=ie,I.listeners=function(re){return[]},I.binding=function(re){throw new Error("process.binding is not supported")},I.cwd=function(){return"/"},I.chdir=function(re){throw new Error("process.chdir is not supported")},I.umask=function(){return 0}},{}],64:[function(d,m,g){/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var w=d("buffer"),$=w.Buffer;function I(F,U){for(var q in F)U[q]=F[q]}function D(F,U,q){return $(F,U,q)}$.from&&$.alloc&&$.allocUnsafe&&$.allocUnsafeSlow?m.exports=w:(I(w,g),g.Buffer=D),D.prototype=Object.create($.prototype),I($,D),D.from=function(F,U,q){if(typeof F=="number")throw new TypeError("Argument must not be a number");return $(F,U,q)},D.alloc=function(F,U,q){if(typeof F!="number")throw new TypeError("Argument must be a number");var j=$(F);return U!==void 0?typeof q=="string"?j.fill(U,q):j.fill(U):j.fill(0),j},D.allocUnsafe=function(F){if(typeof F!="number")throw new TypeError("Argument must be a number");return $(F)},D.allocUnsafeSlow=function(F){if(typeof F!="number")throw new TypeError("Argument must be a number");return w.SlowBuffer(F)}},{buffer:32}],65:[function(d,m,g){m.exports=$;var w=d("events").EventEmitter;function $(){w.call(this)}d("inherits")($,w),$.Readable=d("readable-stream/lib/_stream_readable.js"),$.Writable=d("readable-stream/lib/_stream_writable.js"),$.Duplex=d("readable-stream/lib/_stream_duplex.js"),$.Transform=d("readable-stream/lib/_stream_transform.js"),$.PassThrough=d("readable-stream/lib/_stream_passthrough.js"),$.finished=d("readable-stream/lib/internal/streams/end-of-stream.js"),$.pipeline=d("readable-stream/lib/internal/streams/pipeline.js"),$.Stream=$,$.prototype.pipe=function(I,D){var F=this;function U(Q){I.writable&&I.write(Q)===!1&&F.pause&&F.pause()}function q(){F.readable&&F.resume&&F.resume()}F.on("data",U),I.on("drain",q),I._isStdio||D&&D.end===!1||(F.on("end",G),F.on("close",H));var j=!1;function G(){j||(j=!0,I.end())}function H(){j||(j=!0,typeof I.destroy=="function"&&I.destroy())}function V(Q){if(Z(),w.listenerCount(this,"error")===0)throw Q}function Z(){F.removeListener("data",U),I.removeListener("drain",q),F.removeListener("end",G),F.removeListener("close",H),F.removeListener("error",V),I.removeListener("error",V),F.removeListener("end",Z),F.removeListener("close",Z),I.removeListener("close",Z)}return F.on("error",V),I.on("error",V),F.on("end",Z),F.on("close",Z),I.on("close",Z),I.emit("pipe",F),I}},{events:35,inherits:46,"readable-stream/lib/_stream_duplex.js":67,"readable-stream/lib/_stream_passthrough.js":68,"readable-stream/lib/_stream_readable.js":69,"readable-stream/lib/_stream_transform.js":70,"readable-stream/lib/_stream_writable.js":71,"readable-stream/lib/internal/streams/end-of-stream.js":75,"readable-stream/lib/internal/streams/pipeline.js":77}],66:[function(d,m,g){function w(j,G){j.prototype=Object.create(G.prototype),j.prototype.constructor=j,j.__proto__=G}var $={};function I(j,G,H){function V(Q,J,ie){return typeof G=="string"?G:G(Q,J,ie)}H||(H=Error);var Z=(function(Q){function J(ie,re,se){return Q.call(this,V(ie,re,se))||this}return w(J,Q),J})(H);Z.prototype.name=H.name,Z.prototype.code=j,$[j]=Z}function D(j,G){if(Array.isArray(j)){var H=j.length;return j=j.map((function(V){return String(V)})),H>2?"one of ".concat(G," ").concat(j.slice(0,H-1).join(", "),", or ")+j[H-1]:H===2?"one of ".concat(G," ").concat(j[0]," or ").concat(j[1]):"of ".concat(G," ").concat(j[0])}return"of ".concat(G," ").concat(String(j))}function F(j,G,H){return j.substr(0,G.length)===G}function U(j,G,H){return(H===void 0||H>j.length)&&(H=j.length),j.substring(H-G.length,H)===G}function q(j,G,H){return typeof H!="number"&&(H=0),!(H+G.length>j.length)&&j.indexOf(G,H)!==-1}I("ERR_INVALID_OPT_VALUE",(function(j,G){return'The value "'+G+'" is invalid for option "'+j+'"'}),TypeError),I("ERR_INVALID_ARG_TYPE",(function(j,G,H){var V,Z;if(typeof G=="string"&&F(G,"not ")?(V="must not be",G=G.replace(/^not /,"")):V="must be",U(j," argument"))Z="The ".concat(j," ").concat(V," ").concat(D(G,"type"));else{var Q=q(j,".")?"property":"argument";Z='The "'.concat(j,'" ').concat(Q," ").concat(V," ").concat(D(G,"type"))}return Z+=". Received type ".concat(typeof H)}),TypeError),I("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),I("ERR_METHOD_NOT_IMPLEMENTED",(function(j){return"The "+j+" method is not implemented"})),I("ERR_STREAM_PREMATURE_CLOSE","Premature close"),I("ERR_STREAM_DESTROYED",(function(j){return"Cannot call "+j+" after a stream was destroyed"})),I("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),I("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),I("ERR_STREAM_WRITE_AFTER_END","write after end"),I("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),I("ERR_UNKNOWN_ENCODING",(function(j){return"Unknown encoding: "+j}),TypeError),I("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),m.exports.codes=$},{}],67:[function(d,m,g){(function(w){(function(){var $=Object.keys||function(V){var Z=[];for(var Q in V)Z.push(Q);return Z};m.exports=j;var I=d("./_stream_readable"),D=d("./_stream_writable");d("inherits")(j,I);for(var F=$(D.prototype),U=0;U<F.length;U++){var q=F[U];j.prototype[q]||(j.prototype[q]=D.prototype[q])}function j(V){if(!(this instanceof j))return new j(V);I.call(this,V),D.call(this,V),this.allowHalfOpen=!0,V&&(V.readable===!1&&(this.readable=!1),V.writable===!1&&(this.writable=!1),V.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",G)))}function G(){this._writableState.ended||w.nextTick(H,this)}function H(V){V.end()}Object.defineProperty(j.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(j.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(j.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(j.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(V){this._readableState!==void 0&&this._writableState!==void 0&&(this._readableState.destroyed=V,this._writableState.destroyed=V)}})}).call(this)}).call(this,d("_process"))},{"./_stream_readable":69,"./_stream_writable":71,_process:63,inherits:46}],68:[function(d,m,g){m.exports=$;var w=d("./_stream_transform");function $(I){if(!(this instanceof $))return new $(I);w.call(this,I)}d("inherits")($,w),$.prototype._transform=function(I,D,F){F(null,I)}},{"./_stream_transform":70,inherits:46}],69:[function(d,m,g){(function(w,$){(function(){var I;m.exports=Fe,Fe.ReadableState=xe,d("events").EventEmitter;var D=function(st,yt){return st.listeners(yt).length},F=d("./internal/streams/stream"),U=d("buffer").Buffer,q=$.Uint8Array||function(){};function j(st){return U.from(st)}function G(st){return U.isBuffer(st)||st instanceof q}var H,V=d("util");H=V&&V.debuglog?V.debuglog("stream"):function(){};var Z,Q,J,ie=d("./internal/streams/buffer_list"),re=d("./internal/streams/destroy"),se=d("./internal/streams/state").getHighWaterMark,X=d("../errors").codes,ne=X.ERR_INVALID_ARG_TYPE,ce=X.ERR_STREAM_PUSH_AFTER_EOF,oe=X.ERR_METHOD_NOT_IMPLEMENTED,de=X.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;d("inherits")(Fe,F);var me=re.errorOrDestroy,ge=["error","close","destroy","pause","resume"];function fe(st,yt,Yt){if(typeof st.prependListener=="function")return st.prependListener(yt,Yt);st._events&&st._events[yt]?Array.isArray(st._events[yt])?st._events[yt].unshift(Yt):st._events[yt]=[Yt,st._events[yt]]:st.on(yt,Yt)}function xe(st,yt,Yt){I=I||d("./_stream_duplex"),st=st||{},typeof Yt!="boolean"&&(Yt=yt instanceof I),this.objectMode=!!st.objectMode,Yt&&(this.objectMode=this.objectMode||!!st.readableObjectMode),this.highWaterMark=se(this,st,"readableHighWaterMark",Yt),this.buffer=new ie,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=st.emitClose!==!1,this.autoDestroy=!!st.autoDestroy,this.destroyed=!1,this.defaultEncoding=st.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,st.encoding&&(Z||(Z=d("string_decoder/").StringDecoder),this.decoder=new Z(st.encoding),this.encoding=st.encoding)}function Fe(st){if(I=I||d("./_stream_duplex"),!(this instanceof Fe))return new Fe(st);var yt=this instanceof I;this._readableState=new xe(st,this,yt),this.readable=!0,st&&(typeof st.read=="function"&&(this._read=st.read),typeof st.destroy=="function"&&(this._destroy=st.destroy)),F.call(this)}function Te(st,yt,Yt,$e,ze){H("readableAddChunk",yt);var ft,ht=st._readableState;if(yt===null)ht.reading=!1,Zt(st,ht);else if(ze||(ft=Be(ht,yt)),ft)me(st,ft);else if(ht.objectMode||yt&&yt.length>0)if(typeof yt=="string"||ht.objectMode||Object.getPrototypeOf(yt)===U.prototype||(yt=j(yt)),$e)ht.endEmitted?me(st,new de):Oe(st,ht,yt,!0);else if(ht.ended)me(st,new ce);else{if(ht.destroyed)return!1;ht.reading=!1,ht.decoder&&!Yt?(yt=ht.decoder.write(yt),ht.objectMode||yt.length!==0?Oe(st,ht,yt,!1):Qt(st,ht)):Oe(st,ht,yt,!1)}else $e||(ht.reading=!1,Qt(st,ht));return!ht.ended&&(ht.length<ht.highWaterMark||ht.length===0)}function Oe(st,yt,Yt,$e){yt.flowing&&yt.length===0&&!yt.sync?(yt.awaitDrain=0,st.emit("data",Yt)):(yt.length+=yt.objectMode?1:Yt.length,$e?yt.buffer.unshift(Yt):yt.buffer.push(Yt),yt.needReadable&&Ye(st)),Qt(st,yt)}function Be(st,yt){var Yt;return G(yt)||typeof yt=="string"||yt===void 0||st.objectMode||(Yt=new ne("chunk",["string","Buffer","Uint8Array"],yt)),Yt}Object.defineProperty(Fe.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(st){this._readableState&&(this._readableState.destroyed=st)}}),Fe.prototype.destroy=re.destroy,Fe.prototype._undestroy=re.undestroy,Fe.prototype._destroy=function(st,yt){yt(st)},Fe.prototype.push=function(st,yt){var Yt,$e=this._readableState;return $e.objectMode?Yt=!0:typeof st=="string"&&((yt=yt||$e.defaultEncoding)!==$e.encoding&&(st=U.from(st,yt),yt=""),Yt=!0),Te(this,st,yt,!1,Yt)},Fe.prototype.unshift=function(st){return Te(this,st,null,!0,!1)},Fe.prototype.isPaused=function(){return this._readableState.flowing===!1},Fe.prototype.setEncoding=function(st){Z||(Z=d("string_decoder/").StringDecoder);var yt=new Z(st);this._readableState.decoder=yt,this._readableState.encoding=this._readableState.decoder.encoding;for(var Yt=this._readableState.buffer.head,$e="";Yt!==null;)$e+=yt.write(Yt.data),Yt=Yt.next;return this._readableState.buffer.clear(),$e!==""&&this._readableState.buffer.push($e),this._readableState.length=$e.length,this};var _t=1073741824;function Et(st){return st>=_t?st=_t:(st--,st|=st>>>1,st|=st>>>2,st|=st>>>4,st|=st>>>8,st|=st>>>16,st++),st}function dt(st,yt){return st<=0||yt.length===0&&yt.ended?0:yt.objectMode?1:st!=st?yt.flowing&&yt.length?yt.buffer.head.data.length:yt.length:(st>yt.highWaterMark&&(yt.highWaterMark=Et(st)),st<=yt.length?st:yt.ended?yt.length:(yt.needReadable=!0,0))}function Zt(st,yt){if(H("onEofChunk"),!yt.ended){if(yt.decoder){var Yt=yt.decoder.end();Yt&&Yt.length&&(yt.buffer.push(Yt),yt.length+=yt.objectMode?1:Yt.length)}yt.ended=!0,yt.sync?Ye(st):(yt.needReadable=!1,yt.emittedReadable||(yt.emittedReadable=!0,bt(st)))}}function Ye(st){var yt=st._readableState;H("emitReadable",yt.needReadable,yt.emittedReadable),yt.needReadable=!1,yt.emittedReadable||(H("emitReadable",yt.flowing),yt.emittedReadable=!0,w.nextTick(bt,st))}function bt(st){var yt=st._readableState;H("emitReadable_",yt.destroyed,yt.length,yt.ended),yt.destroyed||!yt.length&&!yt.ended||(st.emit("readable"),yt.emittedReadable=!1),yt.needReadable=!yt.flowing&&!yt.ended&&yt.length<=yt.highWaterMark,zt(st)}function Qt(st,yt){yt.readingMore||(yt.readingMore=!0,w.nextTick(Vt,st,yt))}function Vt(st,yt){for(;!yt.reading&&!yt.ended&&(yt.length<yt.highWaterMark||yt.flowing&&yt.length===0);){var Yt=yt.length;if(H("maybeReadMore read 0"),st.read(0),Yt===yt.length)break}yt.readingMore=!1}function ut(st){return function(){var yt=st._readableState;H("pipeOnDrain",yt.awaitDrain),yt.awaitDrain&&yt.awaitDrain--,yt.awaitDrain===0&&D(st,"data")&&(yt.flowing=!0,zt(st))}}function At(st){var yt=st._readableState;yt.readableListening=st.listenerCount("readable")>0,yt.resumeScheduled&&!yt.paused?yt.flowing=!0:st.listenerCount("data")>0&&st.resume()}function dr(st){H("readable nexttick read 0"),st.read(0)}function fr(st,yt){yt.resumeScheduled||(yt.resumeScheduled=!0,w.nextTick(pr,st,yt))}function pr(st,yt){H("resume",yt.reading),yt.reading||st.read(0),yt.resumeScheduled=!1,st.emit("resume"),zt(st),yt.flowing&&!yt.reading&&st.read(0)}function zt(st){var yt=st._readableState;for(H("flow",yt.flowing);yt.flowing&&st.read()!==null;);}function Ce(st,yt){return yt.length===0?null:(yt.objectMode?Yt=yt.buffer.shift():!st||st>=yt.length?(Yt=yt.decoder?yt.buffer.join(""):yt.buffer.length===1?yt.buffer.first():yt.buffer.concat(yt.length),yt.buffer.clear()):Yt=yt.buffer.consume(st,yt.decoder),Yt);var Yt}function Nt(st){var yt=st._readableState;H("endReadable",yt.endEmitted),yt.endEmitted||(yt.ended=!0,w.nextTick(Xe,yt,st))}function Xe(st,yt){if(H("endReadableNT",st.endEmitted,st.length),!st.endEmitted&&st.length===0&&(st.endEmitted=!0,yt.readable=!1,yt.emit("end"),st.autoDestroy)){var Yt=yt._writableState;(!Yt||Yt.autoDestroy&&Yt.finished)&&yt.destroy()}}function lt(st,yt){for(var Yt=0,$e=st.length;Yt<$e;Yt++)if(st[Yt]===yt)return Yt;return-1}Fe.prototype.read=function(st){H("read",st),st=parseInt(st,10);var yt=this._readableState,Yt=st;if(st!==0&&(yt.emittedReadable=!1),st===0&&yt.needReadable&&((yt.highWaterMark!==0?yt.length>=yt.highWaterMark:yt.length>0)||yt.ended))return H("read: emitReadable",yt.length,yt.ended),yt.length===0&&yt.ended?Nt(this):Ye(this),null;if((st=dt(st,yt))===0&&yt.ended)return yt.length===0&&Nt(this),null;var $e,ze=yt.needReadable;return H("need readable",ze),(yt.length===0||yt.length-st<yt.highWaterMark)&&H("length less than watermark",ze=!0),yt.ended||yt.reading?H("reading or ended",ze=!1):ze&&(H("do read"),yt.reading=!0,yt.sync=!0,yt.length===0&&(yt.needReadable=!0),this._read(yt.highWaterMark),yt.sync=!1,yt.reading||(st=dt(Yt,yt))),($e=st>0?Ce(st,yt):null)===null?(yt.needReadable=yt.length<=yt.highWaterMark,st=0):(yt.length-=st,yt.awaitDrain=0),yt.length===0&&(yt.ended||(yt.needReadable=!0),Yt!==st&&yt.ended&&Nt(this)),$e!==null&&this.emit("data",$e),$e},Fe.prototype._read=function(st){me(this,new oe("_read()"))},Fe.prototype.pipe=function(st,yt){var Yt=this,$e=this._readableState;switch($e.pipesCount){case 0:$e.pipes=st;break;case 1:$e.pipes=[$e.pipes,st];break;default:$e.pipes.push(st)}$e.pipesCount+=1,H("pipe count=%d opts=%j",$e.pipesCount,yt);var ze=yt&&yt.end===!1||st===w.stdout||st===w.stderr?vi:ht;function ft(bi,_i){H("onunpipe"),bi===Yt&&_i&&_i.hasUnpiped===!1&&(_i.hasUnpiped=!0,li())}function ht(){H("onend"),st.end()}$e.endEmitted?w.nextTick(ze):Yt.once("end",ze),st.on("unpipe",ft);var gr=ut(Yt);st.on("drain",gr);var yr=!1;function li(){H("cleanup"),st.removeListener("close",hi),st.removeListener("finish",ui),st.removeListener("drain",gr),st.removeListener("error",ai),st.removeListener("unpipe",ft),Yt.removeListener("end",ht),Yt.removeListener("end",vi),Yt.removeListener("data",fi),yr=!0,!$e.awaitDrain||st._writableState&&!st._writableState.needDrain||gr()}function fi(bi){H("ondata");var _i=st.write(bi);H("dest.write",_i),_i===!1&&(($e.pipesCount===1&&$e.pipes===st||$e.pipesCount>1&&lt($e.pipes,st)!==-1)&&!yr&&(H("false write response, pause",$e.awaitDrain),$e.awaitDrain++),Yt.pause())}function ai(bi){H("onerror",bi),vi(),st.removeListener("error",ai),D(st,"error")===0&&me(st,bi)}function hi(){st.removeListener("finish",ui),vi()}function ui(){H("onfinish"),st.removeListener("close",hi),vi()}function vi(){H("unpipe"),Yt.unpipe(st)}return Yt.on("data",fi),fe(st,"error",ai),st.once("close",hi),st.once("finish",ui),st.emit("pipe",Yt),$e.flowing||(H("pipe resume"),Yt.resume()),st},Fe.prototype.unpipe=function(st){var yt=this._readableState,Yt={hasUnpiped:!1};if(yt.pipesCount===0)return this;if(yt.pipesCount===1)return st&&st!==yt.pipes||(st||(st=yt.pipes),yt.pipes=null,yt.pipesCount=0,yt.flowing=!1,st&&st.emit("unpipe",this,Yt)),this;if(!st){var $e=yt.pipes,ze=yt.pipesCount;yt.pipes=null,yt.pipesCount=0,yt.flowing=!1;for(var ft=0;ft<ze;ft++)$e[ft].emit("unpipe",this,{hasUnpiped:!1});return this}var ht=lt(yt.pipes,st);return ht===-1||(yt.pipes.splice(ht,1),yt.pipesCount-=1,yt.pipesCount===1&&(yt.pipes=yt.pipes[0]),st.emit("unpipe",this,Yt)),this},Fe.prototype.on=function(st,yt){var Yt=F.prototype.on.call(this,st,yt),$e=this._readableState;return st==="data"?($e.readableListening=this.listenerCount("readable")>0,$e.flowing!==!1&&this.resume()):st==="readable"&&($e.endEmitted||$e.readableListening||($e.readableListening=$e.needReadable=!0,$e.flowing=!1,$e.emittedReadable=!1,H("on readable",$e.length,$e.reading),$e.length?Ye(this):$e.reading||w.nextTick(dr,this))),Yt},Fe.prototype.addListener=Fe.prototype.on,Fe.prototype.removeListener=function(st,yt){var Yt=F.prototype.removeListener.call(this,st,yt);return st==="readable"&&w.nextTick(At,this),Yt},Fe.prototype.removeAllListeners=function(st){var yt=F.prototype.removeAllListeners.apply(this,arguments);return st!=="readable"&&st!==void 0||w.nextTick(At,this),yt},Fe.prototype.resume=function(){var st=this._readableState;return st.flowing||(H("resume"),st.flowing=!st.readableListening,fr(this,st)),st.paused=!1,this},Fe.prototype.pause=function(){return H("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(H("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},Fe.prototype.wrap=function(st){var yt=this,Yt=this._readableState,$e=!1;for(var ze in st.on("end",(function(){if(H("wrapped end"),Yt.decoder&&!Yt.ended){var ht=Yt.decoder.end();ht&&ht.length&&yt.push(ht)}yt.push(null)})),st.on("data",(function(ht){H("wrapped data"),Yt.decoder&&(ht=Yt.decoder.write(ht)),Yt.objectMode&&ht==null||(Yt.objectMode||ht&&ht.length)&&(yt.push(ht)||($e=!0,st.pause()))})),st)this[ze]===void 0&&typeof st[ze]=="function"&&(this[ze]=(function(ht){return function(){return st[ht].apply(st,arguments)}})(ze));for(var ft=0;ft<ge.length;ft++)st.on(ge[ft],this.emit.bind(this,ge[ft]));return this._read=function(ht){H("wrapped _read",ht),$e&&($e=!1,st.resume())},this},typeof Symbol=="function"&&(Fe.prototype[Symbol.asyncIterator]=function(){return Q===void 0&&(Q=d("./internal/streams/async_iterator")),Q(this)}),Object.defineProperty(Fe.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Fe.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Fe.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(st){this._readableState&&(this._readableState.flowing=st)}}),Fe._fromList=Ce,Object.defineProperty(Fe.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(Fe.from=function(st,yt){return J===void 0&&(J=d("./internal/streams/from")),J(Fe,st,yt)})}).call(this)}).call(this,d("_process"),commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":66,"./_stream_duplex":67,"./internal/streams/async_iterator":72,"./internal/streams/buffer_list":73,"./internal/streams/destroy":74,"./internal/streams/from":76,"./internal/streams/state":78,"./internal/streams/stream":79,_process:63,buffer:32,events:35,inherits:46,"string_decoder/":80,util:29}],70:[function(d,m,g){m.exports=j;var w=d("../errors").codes,$=w.ERR_METHOD_NOT_IMPLEMENTED,I=w.ERR_MULTIPLE_CALLBACK,D=w.ERR_TRANSFORM_ALREADY_TRANSFORMING,F=w.ERR_TRANSFORM_WITH_LENGTH_0,U=d("./_stream_duplex");function q(V,Z){var Q=this._transformState;Q.transforming=!1;var J=Q.writecb;if(J===null)return this.emit("error",new I);Q.writechunk=null,Q.writecb=null,Z!=null&&this.push(Z),J(V);var ie=this._readableState;ie.reading=!1,(ie.needReadable||ie.length<ie.highWaterMark)&&this._read(ie.highWaterMark)}function j(V){if(!(this instanceof j))return new j(V);U.call(this,V),this._transformState={afterTransform:q.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,V&&(typeof V.transform=="function"&&(this._transform=V.transform),typeof V.flush=="function"&&(this._flush=V.flush)),this.on("prefinish",G)}function G(){var V=this;typeof this._flush!="function"||this._readableState.destroyed?H(this,null,null):this._flush((function(Z,Q){H(V,Z,Q)}))}function H(V,Z,Q){if(Z)return V.emit("error",Z);if(Q!=null&&V.push(Q),V._writableState.length)throw new F;if(V._transformState.transforming)throw new D;return V.push(null)}d("inherits")(j,U),j.prototype.push=function(V,Z){return this._transformState.needTransform=!1,U.prototype.push.call(this,V,Z)},j.prototype._transform=function(V,Z,Q){Q(new $("_transform()"))},j.prototype._write=function(V,Z,Q){var J=this._transformState;if(J.writecb=Q,J.writechunk=V,J.writeencoding=Z,!J.transforming){var ie=this._readableState;(J.needTransform||ie.needReadable||ie.length<ie.highWaterMark)&&this._read(ie.highWaterMark)}},j.prototype._read=function(V){var Z=this._transformState;Z.writechunk===null||Z.transforming?Z.needTransform=!0:(Z.transforming=!0,this._transform(Z.writechunk,Z.writeencoding,Z.afterTransform))},j.prototype._destroy=function(V,Z){U.prototype._destroy.call(this,V,(function(Q){Z(Q)}))}},{"../errors":66,"./_stream_duplex":67,inherits:46}],71:[function(d,m,g){(function(w,$){(function(){function I(zt){var Ce=this;this.next=null,this.entry=null,this.finish=function(){pr(Ce,zt)}}var D;m.exports=xe,xe.WritableState=fe;var F={deprecate:d("util-deprecate")},U=d("./internal/streams/stream"),q=d("buffer").Buffer,j=$.Uint8Array||function(){};function G(zt){return q.from(zt)}function H(zt){return q.isBuffer(zt)||zt instanceof j}var V,Z=d("./internal/streams/destroy"),Q=d("./internal/streams/state").getHighWaterMark,J=d("../errors").codes,ie=J.ERR_INVALID_ARG_TYPE,re=J.ERR_METHOD_NOT_IMPLEMENTED,se=J.ERR_MULTIPLE_CALLBACK,X=J.ERR_STREAM_CANNOT_PIPE,ne=J.ERR_STREAM_DESTROYED,ce=J.ERR_STREAM_NULL_VALUES,oe=J.ERR_STREAM_WRITE_AFTER_END,de=J.ERR_UNKNOWN_ENCODING,me=Z.errorOrDestroy;function ge(){}function fe(zt,Ce,Nt){D=D||d("./_stream_duplex"),zt=zt||{},typeof Nt!="boolean"&&(Nt=Ce instanceof D),this.objectMode=!!zt.objectMode,Nt&&(this.objectMode=this.objectMode||!!zt.writableObjectMode),this.highWaterMark=Q(this,zt,"writableHighWaterMark",Nt),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Xe=zt.decodeStrings===!1;this.decodeStrings=!Xe,this.defaultEncoding=zt.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(lt){Zt(Ce,lt)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=zt.emitClose!==!1,this.autoDestroy=!!zt.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new I(this)}function xe(zt){var Ce=this instanceof(D=D||d("./_stream_duplex"));if(!Ce&&!V.call(xe,this))return new xe(zt);this._writableState=new fe(zt,this,Ce),this.writable=!0,zt&&(typeof zt.write=="function"&&(this._write=zt.write),typeof zt.writev=="function"&&(this._writev=zt.writev),typeof zt.destroy=="function"&&(this._destroy=zt.destroy),typeof zt.final=="function"&&(this._final=zt.final)),U.call(this)}function Fe(zt,Ce){var Nt=new oe;me(zt,Nt),w.nextTick(Ce,Nt)}function Te(zt,Ce,Nt,Xe){var lt;return Nt===null?lt=new ce:typeof Nt=="string"||Ce.objectMode||(lt=new ie("chunk",["string","Buffer"],Nt)),!lt||(me(zt,lt),w.nextTick(Xe,lt),!1)}function Oe(zt,Ce,Nt){return zt.objectMode||zt.decodeStrings===!1||typeof Ce!="string"||(Ce=q.from(Ce,Nt)),Ce}function Be(zt,Ce,Nt,Xe,lt,st){if(!Nt){var yt=Oe(Ce,Xe,lt);Xe!==yt&&(Nt=!0,lt="buffer",Xe=yt)}var Yt=Ce.objectMode?1:Xe.length;Ce.length+=Yt;var $e=Ce.length<Ce.highWaterMark;if($e||(Ce.needDrain=!0),Ce.writing||Ce.corked){var ze=Ce.lastBufferedRequest;Ce.lastBufferedRequest={chunk:Xe,encoding:lt,isBuf:Nt,callback:st,next:null},ze?ze.next=Ce.lastBufferedRequest:Ce.bufferedRequest=Ce.lastBufferedRequest,Ce.bufferedRequestCount+=1}else _t(zt,Ce,!1,Yt,Xe,lt,st);return $e}function _t(zt,Ce,Nt,Xe,lt,st,yt){Ce.writelen=Xe,Ce.writecb=yt,Ce.writing=!0,Ce.sync=!0,Ce.destroyed?Ce.onwrite(new ne("write")):Nt?zt._writev(lt,Ce.onwrite):zt._write(lt,st,Ce.onwrite),Ce.sync=!1}function Et(zt,Ce,Nt,Xe,lt){--Ce.pendingcb,Nt?(w.nextTick(lt,Xe),w.nextTick(dr,zt,Ce),zt._writableState.errorEmitted=!0,me(zt,Xe)):(lt(Xe),zt._writableState.errorEmitted=!0,me(zt,Xe),dr(zt,Ce))}function dt(zt){zt.writing=!1,zt.writecb=null,zt.length-=zt.writelen,zt.writelen=0}function Zt(zt,Ce){var Nt=zt._writableState,Xe=Nt.sync,lt=Nt.writecb;if(typeof lt!="function")throw new se;if(dt(Nt),Ce)Et(zt,Nt,Xe,Ce,lt);else{var st=Vt(Nt)||zt.destroyed;st||Nt.corked||Nt.bufferProcessing||!Nt.bufferedRequest||Qt(zt,Nt),Xe?w.nextTick(Ye,zt,Nt,st,lt):Ye(zt,Nt,st,lt)}}function Ye(zt,Ce,Nt,Xe){Nt||bt(zt,Ce),Ce.pendingcb--,Xe(),dr(zt,Ce)}function bt(zt,Ce){Ce.length===0&&Ce.needDrain&&(Ce.needDrain=!1,zt.emit("drain"))}function Qt(zt,Ce){Ce.bufferProcessing=!0;var Nt=Ce.bufferedRequest;if(zt._writev&&Nt&&Nt.next){var Xe=Ce.bufferedRequestCount,lt=new Array(Xe),st=Ce.corkedRequestsFree;st.entry=Nt;for(var yt=0,Yt=!0;Nt;)lt[yt]=Nt,Nt.isBuf||(Yt=!1),Nt=Nt.next,yt+=1;lt.allBuffers=Yt,_t(zt,Ce,!0,Ce.length,lt,"",st.finish),Ce.pendingcb++,Ce.lastBufferedRequest=null,st.next?(Ce.corkedRequestsFree=st.next,st.next=null):Ce.corkedRequestsFree=new I(Ce),Ce.bufferedRequestCount=0}else{for(;Nt;){var $e=Nt.chunk,ze=Nt.encoding,ft=Nt.callback;if(_t(zt,Ce,!1,Ce.objectMode?1:$e.length,$e,ze,ft),Nt=Nt.next,Ce.bufferedRequestCount--,Ce.writing)break}Nt===null&&(Ce.lastBufferedRequest=null)}Ce.bufferedRequest=Nt,Ce.bufferProcessing=!1}function Vt(zt){return zt.ending&&zt.length===0&&zt.bufferedRequest===null&&!zt.finished&&!zt.writing}function ut(zt,Ce){zt._final((function(Nt){Ce.pendingcb--,Nt&&me(zt,Nt),Ce.prefinished=!0,zt.emit("prefinish"),dr(zt,Ce)}))}function At(zt,Ce){Ce.prefinished||Ce.finalCalled||(typeof zt._final!="function"||Ce.destroyed?(Ce.prefinished=!0,zt.emit("prefinish")):(Ce.pendingcb++,Ce.finalCalled=!0,w.nextTick(ut,zt,Ce)))}function dr(zt,Ce){var Nt=Vt(Ce);if(Nt&&(At(zt,Ce),Ce.pendingcb===0&&(Ce.finished=!0,zt.emit("finish"),Ce.autoDestroy))){var Xe=zt._readableState;(!Xe||Xe.autoDestroy&&Xe.endEmitted)&&zt.destroy()}return Nt}function fr(zt,Ce,Nt){Ce.ending=!0,dr(zt,Ce),Nt&&(Ce.finished?w.nextTick(Nt):zt.once("finish",Nt)),Ce.ended=!0,zt.writable=!1}function pr(zt,Ce,Nt){var Xe=zt.entry;for(zt.entry=null;Xe;){var lt=Xe.callback;Ce.pendingcb--,lt(Nt),Xe=Xe.next}Ce.corkedRequestsFree.next=zt}d("inherits")(xe,U),fe.prototype.getBuffer=function(){for(var zt=this.bufferedRequest,Ce=[];zt;)Ce.push(zt),zt=zt.next;return Ce},(function(){try{Object.defineProperty(fe.prototype,"buffer",{get:F.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})(),typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(V=Function.prototype[Symbol.hasInstance],Object.defineProperty(xe,Symbol.hasInstance,{value:function(zt){return!!V.call(this,zt)||this===xe&&zt&&zt._writableState instanceof fe}})):V=function(zt){return zt instanceof this},xe.prototype.pipe=function(){me(this,new X)},xe.prototype.write=function(zt,Ce,Nt){var Xe=this._writableState,lt=!1,st=!Xe.objectMode&&H(zt);return st&&!q.isBuffer(zt)&&(zt=G(zt)),typeof Ce=="function"&&(Nt=Ce,Ce=null),st?Ce="buffer":Ce||(Ce=Xe.defaultEncoding),typeof Nt!="function"&&(Nt=ge),Xe.ending?Fe(this,Nt):(st||Te(this,Xe,zt,Nt))&&(Xe.pendingcb++,lt=Be(this,Xe,st,zt,Ce,Nt)),lt},xe.prototype.cork=function(){this._writableState.corked++},xe.prototype.uncork=function(){var zt=this._writableState;zt.corked&&(zt.corked--,zt.writing||zt.corked||zt.bufferProcessing||!zt.bufferedRequest||Qt(this,zt))},xe.prototype.setDefaultEncoding=function(zt){if(typeof zt=="string"&&(zt=zt.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((zt+"").toLowerCase())>-1))throw new de(zt);return this._writableState.defaultEncoding=zt,this},Object.defineProperty(xe.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(xe.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),xe.prototype._write=function(zt,Ce,Nt){Nt(new re("_write()"))},xe.prototype._writev=null,xe.prototype.end=function(zt,Ce,Nt){var Xe=this._writableState;return typeof zt=="function"?(Nt=zt,zt=null,Ce=null):typeof Ce=="function"&&(Nt=Ce,Ce=null),zt!=null&&this.write(zt,Ce),Xe.corked&&(Xe.corked=1,this.uncork()),Xe.ending||fr(this,Xe,Nt),this},Object.defineProperty(xe.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(xe.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(zt){this._writableState&&(this._writableState.destroyed=zt)}}),xe.prototype.destroy=Z.destroy,xe.prototype._undestroy=Z.undestroy,xe.prototype._destroy=function(zt,Ce){Ce(zt)}}).call(this)}).call(this,d("_process"),commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"../errors":66,"./_stream_duplex":67,"./internal/streams/destroy":74,"./internal/streams/state":78,"./internal/streams/stream":79,_process:63,buffer:32,inherits:46,"util-deprecate":81}],72:[function(d,m,g){(function(w){(function(){var $;function I(ne,ce,oe){return ce in ne?Object.defineProperty(ne,ce,{value:oe,enumerable:!0,configurable:!0,writable:!0}):ne[ce]=oe,ne}var D=d("./end-of-stream"),F=Symbol("lastResolve"),U=Symbol("lastReject"),q=Symbol("error"),j=Symbol("ended"),G=Symbol("lastPromise"),H=Symbol("handlePromise"),V=Symbol("stream");function Z(ne,ce){return{value:ne,done:ce}}function Q(ne){var ce=ne[F];if(ce!==null){var oe=ne[V].read();oe!==null&&(ne[G]=null,ne[F]=null,ne[U]=null,ce(Z(oe,!1)))}}function J(ne){w.nextTick(Q,ne)}function ie(ne,ce){return function(oe,de){ne.then((function(){ce[j]?oe(Z(void 0,!0)):ce[H](oe,de)}),de)}}var re=Object.getPrototypeOf((function(){})),se=Object.setPrototypeOf(($={get stream(){return this[V]},next:function(){var ne=this,ce=this[q];if(ce!==null)return Promise.reject(ce);if(this[j])return Promise.resolve(Z(void 0,!0));if(this[V].destroyed)return new Promise((function(ge,fe){w.nextTick((function(){ne[q]?fe(ne[q]):ge(Z(void 0,!0))}))}));var oe,de=this[G];if(de)oe=new Promise(ie(de,this));else{var me=this[V].read();if(me!==null)return Promise.resolve(Z(me,!1));oe=new Promise(this[H])}return this[G]=oe,oe}},I($,Symbol.asyncIterator,(function(){return this})),I($,"return",(function(){var ne=this;return new Promise((function(ce,oe){ne[V].destroy(null,(function(de){de?oe(de):ce(Z(void 0,!0))}))}))})),$),re),X=function(ne){var ce,oe=Object.create(se,(I(ce={},V,{value:ne,writable:!0}),I(ce,F,{value:null,writable:!0}),I(ce,U,{value:null,writable:!0}),I(ce,q,{value:null,writable:!0}),I(ce,j,{value:ne._readableState.endEmitted,writable:!0}),I(ce,H,{value:function(de,me){var ge=oe[V].read();ge?(oe[G]=null,oe[F]=null,oe[U]=null,de(Z(ge,!1))):(oe[F]=de,oe[U]=me)},writable:!0}),ce));return oe[G]=null,D(ne,(function(de){if(de&&de.code!=="ERR_STREAM_PREMATURE_CLOSE"){var me=oe[U];return me!==null&&(oe[G]=null,oe[F]=null,oe[U]=null,me(de)),void(oe[q]=de)}var ge=oe[F];ge!==null&&(oe[G]=null,oe[F]=null,oe[U]=null,ge(Z(void 0,!0))),oe[j]=!0})),ne.on("readable",J.bind(null,oe)),oe};m.exports=X}).call(this)}).call(this,d("_process"))},{"./end-of-stream":75,_process:63}],73:[function(d,m,g){function w(V,Z){var Q=Object.keys(V);if(Object.getOwnPropertySymbols){var J=Object.getOwnPropertySymbols(V);Z&&(J=J.filter((function(ie){return Object.getOwnPropertyDescriptor(V,ie).enumerable}))),Q.push.apply(Q,J)}return Q}function $(V){for(var Z=1;Z<arguments.length;Z++){var Q=arguments[Z]!=null?arguments[Z]:{};Z%2?w(Object(Q),!0).forEach((function(J){I(V,J,Q[J])})):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(Q)):w(Object(Q)).forEach((function(J){Object.defineProperty(V,J,Object.getOwnPropertyDescriptor(Q,J))}))}return V}function I(V,Z,Q){return Z in V?Object.defineProperty(V,Z,{value:Q,enumerable:!0,configurable:!0,writable:!0}):V[Z]=Q,V}function D(V,Z){if(!(V instanceof Z))throw new TypeError("Cannot call a class as a function")}function F(V,Z){for(var Q=0;Q<Z.length;Q++){var J=Z[Q];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(V,J.key,J)}}function U(V,Z,Q){return Z&&F(V.prototype,Z),V}var q=d("buffer").Buffer,j=d("util").inspect,G=j&&j.custom||"inspect";function H(V,Z,Q){q.prototype.copy.call(V,Z,Q)}m.exports=(function(){function V(){D(this,V),this.head=null,this.tail=null,this.length=0}return U(V,[{key:"push",value:function(Z){var Q={data:Z,next:null};this.length>0?this.tail.next=Q:this.head=Q,this.tail=Q,++this.length}},{key:"unshift",value:function(Z){var Q={data:Z,next:this.head};this.length===0&&(this.tail=Q),this.head=Q,++this.length}},{key:"shift",value:function(){if(this.length!==0){var Z=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,Z}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(Z){if(this.length===0)return"";for(var Q=this.head,J=""+Q.data;Q=Q.next;)J+=Z+Q.data;return J}},{key:"concat",value:function(Z){if(this.length===0)return q.alloc(0);for(var Q=q.allocUnsafe(Z>>>0),J=this.head,ie=0;J;)H(J.data,Q,ie),ie+=J.data.length,J=J.next;return Q}},{key:"consume",value:function(Z,Q){var J;return Z<this.head.data.length?(J=this.head.data.slice(0,Z),this.head.data=this.head.data.slice(Z)):J=Z===this.head.data.length?this.shift():Q?this._getString(Z):this._getBuffer(Z),J}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(Z){var Q=this.head,J=1,ie=Q.data;for(Z-=ie.length;Q=Q.next;){var re=Q.data,se=Z>re.length?re.length:Z;if(se===re.length?ie+=re:ie+=re.slice(0,Z),(Z-=se)==0){se===re.length?(++J,Q.next?this.head=Q.next:this.head=this.tail=null):(this.head=Q,Q.data=re.slice(se));break}++J}return this.length-=J,ie}},{key:"_getBuffer",value:function(Z){var Q=q.allocUnsafe(Z),J=this.head,ie=1;for(J.data.copy(Q),Z-=J.data.length;J=J.next;){var re=J.data,se=Z>re.length?re.length:Z;if(re.copy(Q,Q.length-Z,0,se),(Z-=se)==0){se===re.length?(++ie,J.next?this.head=J.next:this.head=this.tail=null):(this.head=J,J.data=re.slice(se));break}++ie}return this.length-=ie,Q}},{key:G,value:function(Z,Q){return j(this,$({},Q,{depth:0,customInspect:!1}))}}]),V})()},{buffer:32,util:29}],74:[function(d,m,g){(function(w){(function(){function $(j,G){var H=this,V=this._readableState&&this._readableState.destroyed,Z=this._writableState&&this._writableState.destroyed;return V||Z?(G?G(j):j&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,w.nextTick(U,this,j)):w.nextTick(U,this,j)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(j||null,(function(Q){!G&&Q?H._writableState?H._writableState.errorEmitted?w.nextTick(D,H):(H._writableState.errorEmitted=!0,w.nextTick(I,H,Q)):w.nextTick(I,H,Q):G?(w.nextTick(D,H),G(Q)):w.nextTick(D,H)})),this)}function I(j,G){U(j,G),D(j)}function D(j){j._writableState&&!j._writableState.emitClose||j._readableState&&!j._readableState.emitClose||j.emit("close")}function F(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function U(j,G){j.emit("error",G)}function q(j,G){var H=j._readableState,V=j._writableState;H&&H.autoDestroy||V&&V.autoDestroy?j.destroy(G):j.emit("error",G)}m.exports={destroy:$,undestroy:F,errorOrDestroy:q}}).call(this)}).call(this,d("_process"))},{_process:63}],75:[function(d,m,g){var w=d("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function $(U){var q=!1;return function(){if(!q){q=!0;for(var j=arguments.length,G=new Array(j),H=0;H<j;H++)G[H]=arguments[H];U.apply(this,G)}}}function I(){}function D(U){return U.setHeader&&typeof U.abort=="function"}function F(U,q,j){if(typeof q=="function")return F(U,null,q);q||(q={}),j=$(j||I);var G=q.readable||q.readable!==!1&&U.readable,H=q.writable||q.writable!==!1&&U.writable,V=function(){U.writable||Q()},Z=U._writableState&&U._writableState.finished,Q=function(){H=!1,Z=!0,G||j.call(U)},J=U._readableState&&U._readableState.endEmitted,ie=function(){G=!1,J=!0,H||j.call(U)},re=function(ne){j.call(U,ne)},se=function(){var ne;return G&&!J?(U._readableState&&U._readableState.ended||(ne=new w),j.call(U,ne)):H&&!Z?(U._writableState&&U._writableState.ended||(ne=new w),j.call(U,ne)):void 0},X=function(){U.req.on("finish",Q)};return D(U)?(U.on("complete",Q),U.on("abort",se),U.req?X():U.on("request",X)):H&&!U._writableState&&(U.on("end",V),U.on("close",V)),U.on("end",ie),U.on("finish",Q),q.error!==!1&&U.on("error",re),U.on("close",se),function(){U.removeListener("complete",Q),U.removeListener("abort",se),U.removeListener("request",X),U.req&&U.req.removeListener("finish",Q),U.removeListener("end",V),U.removeListener("close",V),U.removeListener("finish",Q),U.removeListener("end",ie),U.removeListener("error",re),U.removeListener("close",se)}}m.exports=F},{"../../../errors":66}],76:[function(d,m,g){m.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],77:[function(d,m,g){var w;function $(Q){var J=!1;return function(){J||(J=!0,Q.apply(void 0,arguments))}}var I=d("../../../errors").codes,D=I.ERR_MISSING_ARGS,F=I.ERR_STREAM_DESTROYED;function U(Q){if(Q)throw Q}function q(Q){return Q.setHeader&&typeof Q.abort=="function"}function j(Q,J,ie,re){re=$(re);var se=!1;Q.on("close",(function(){se=!0})),w===void 0&&(w=d("./end-of-stream")),w(Q,{readable:J,writable:ie},(function(ne){if(ne)return re(ne);se=!0,re()}));var X=!1;return function(ne){if(!se&&!X)return X=!0,q(Q)?Q.abort():typeof Q.destroy=="function"?Q.destroy():void re(ne||new F("pipe"))}}function G(Q){Q()}function H(Q,J){return Q.pipe(J)}function V(Q){return Q.length?typeof Q[Q.length-1]!="function"?U:Q.pop():U}function Z(){for(var Q=arguments.length,J=new Array(Q),ie=0;ie<Q;ie++)J[ie]=arguments[ie];var re,se=V(J);if(Array.isArray(J[0])&&(J=J[0]),J.length<2)throw new D("streams");var X=J.map((function(ne,ce){var oe=ce<J.length-1;return j(ne,oe,ce>0,(function(de){re||(re=de),de&&X.forEach(G),oe||(X.forEach(G),se(re))}))}));return J.reduce(H)}m.exports=Z},{"../../../errors":66,"./end-of-stream":75}],78:[function(d,m,g){var w=d("../../../errors").codes.ERR_INVALID_OPT_VALUE;function $(D,F,U){return D.highWaterMark!=null?D.highWaterMark:F?D[U]:null}function I(D,F,U,q){var j=$(F,q,U);if(j!=null){if(!isFinite(j)||Math.floor(j)!==j||j<0)throw new w(q?U:"highWaterMark",j);return Math.floor(j)}return D.objectMode?16:16384}m.exports={getHighWaterMark:I}},{"../../../errors":66}],79:[function(d,m,g){m.exports=d("events").EventEmitter},{events:35}],80:[function(d,m,g){var w=d("safe-buffer").Buffer,$=w.isEncoding||function(X){switch((X=""+X)&&X.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function I(X){if(!X)return"utf8";for(var ne;;)switch(X){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return X;default:if(ne)return;X=(""+X).toLowerCase(),ne=!0}}function D(X){var ne=I(X);if(typeof ne!="string"&&(w.isEncoding===$||!$(X)))throw new Error("Unknown encoding: "+X);return ne||X}function F(X){var ne;switch(this.encoding=D(X),this.encoding){case"utf16le":this.text=Z,this.end=Q,ne=4;break;case"utf8":this.fillLast=G,ne=4;break;case"base64":this.text=J,this.end=ie,ne=3;break;default:return this.write=re,void(this.end=se)}this.lastNeed=0,this.lastTotal=0,this.lastChar=w.allocUnsafe(ne)}function U(X){return X<=127?0:X>>5==6?2:X>>4==14?3:X>>3==30?4:X>>6==2?-1:-2}function q(X,ne,ce){var oe=ne.length-1;if(oe<ce)return 0;var de=U(ne[oe]);return de>=0?(de>0&&(X.lastNeed=de-1),de):--oe<ce||de===-2?0:(de=U(ne[oe]))>=0?(de>0&&(X.lastNeed=de-2),de):--oe<ce||de===-2?0:(de=U(ne[oe]))>=0?(de>0&&(de===2?de=0:X.lastNeed=de-3),de):0}function j(X,ne,ce){if((192&ne[0])!=128)return X.lastNeed=0,"ï¿½";if(X.lastNeed>1&&ne.length>1){if((192&ne[1])!=128)return X.lastNeed=1,"ï¿½";if(X.lastNeed>2&&ne.length>2&&(192&ne[2])!=128)return X.lastNeed=2,"ï¿½"}}function G(X){var ne=this.lastTotal-this.lastNeed,ce=j(this,X);return ce!==void 0?ce:this.lastNeed<=X.length?(X.copy(this.lastChar,ne,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(X.copy(this.lastChar,ne,0,X.length),void(this.lastNeed-=X.length))}function H(X,ne){var ce=q(this,X,ne);if(!this.lastNeed)return X.toString("utf8",ne);this.lastTotal=ce;var oe=X.length-(ce-this.lastNeed);return X.copy(this.lastChar,0,oe),X.toString("utf8",ne,oe)}function V(X){var ne=X&&X.length?this.write(X):"";return this.lastNeed?ne+"ï¿½":ne}function Z(X,ne){if((X.length-ne)%2==0){var ce=X.toString("utf16le",ne);if(ce){var oe=ce.charCodeAt(ce.length-1);if(oe>=55296&&oe<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=X[X.length-2],this.lastChar[1]=X[X.length-1],ce.slice(0,-1)}return ce}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=X[X.length-1],X.toString("utf16le",ne,X.length-1)}function Q(X){var ne=X&&X.length?this.write(X):"";if(this.lastNeed){var ce=this.lastTotal-this.lastNeed;return ne+this.lastChar.toString("utf16le",0,ce)}return ne}function J(X,ne){var ce=(X.length-ne)%3;return ce===0?X.toString("base64",ne):(this.lastNeed=3-ce,this.lastTotal=3,ce===1?this.lastChar[0]=X[X.length-1]:(this.lastChar[0]=X[X.length-2],this.lastChar[1]=X[X.length-1]),X.toString("base64",ne,X.length-ce))}function ie(X){var ne=X&&X.length?this.write(X):"";return this.lastNeed?ne+this.lastChar.toString("base64",0,3-this.lastNeed):ne}function re(X){return X.toString(this.encoding)}function se(X){return X&&X.length?this.write(X):""}g.StringDecoder=F,F.prototype.write=function(X){if(X.length===0)return"";var ne,ce;if(this.lastNeed){if((ne=this.fillLast(X))===void 0)return"";ce=this.lastNeed,this.lastNeed=0}else ce=0;return ce<X.length?ne?ne+this.text(X,ce):this.text(X,ce):ne||""},F.prototype.end=V,F.prototype.text=H,F.prototype.fillLast=function(X){if(this.lastNeed<=X.length)return X.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);X.copy(this.lastChar,this.lastTotal-this.lastNeed,0,X.length),this.lastNeed-=X.length}},{"safe-buffer":64}],81:[function(d,m,g){(function(w){(function(){function $(D,F){if(I("noDeprecation"))return D;var U=!1;function q(){if(!U){if(I("throwDeprecation"))throw new Error(F);I("traceDeprecation")?console.trace(F):console.warn(F),U=!0}return D.apply(this,arguments)}return q}function I(D){try{if(!w.localStorage)return!1}catch{return!1}var F=w.localStorage[D];return F!=null&&String(F).toLowerCase()==="true"}m.exports=$}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],82:[function(d,m,g){arguments[4][25][0].apply(g,arguments)},{dup:25}],83:[function(d,m,g){var w=d("is-arguments"),$=d("is-generator-function"),I=d("which-typed-array"),D=d("is-typed-array");function F(ht){return ht.call.bind(ht)}var U=typeof BigInt<"u",q=typeof Symbol<"u",j=F(Object.prototype.toString),G=F(Number.prototype.valueOf),H=F(String.prototype.valueOf),V=F(Boolean.prototype.valueOf);if(U)var Z=F(BigInt.prototype.valueOf);if(q)var Q=F(Symbol.prototype.valueOf);function J(ht,gr){if(typeof ht!="object")return!1;try{return gr(ht),!0}catch{return!1}}function ie(ht){return typeof Promise<"u"&&ht instanceof Promise||ht!==null&&typeof ht=="object"&&typeof ht.then=="function"&&typeof ht.catch=="function"}function re(ht){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(ht):D(ht)||ut(ht)}function se(ht){return I(ht)==="Uint8Array"}function X(ht){return I(ht)==="Uint8ClampedArray"}function ne(ht){return I(ht)==="Uint16Array"}function ce(ht){return I(ht)==="Uint32Array"}function oe(ht){return I(ht)==="Int8Array"}function de(ht){return I(ht)==="Int16Array"}function me(ht){return I(ht)==="Int32Array"}function ge(ht){return I(ht)==="Float32Array"}function fe(ht){return I(ht)==="Float64Array"}function xe(ht){return I(ht)==="BigInt64Array"}function Fe(ht){return I(ht)==="BigUint64Array"}function Te(ht){return j(ht)==="[object Map]"}function Oe(ht){return typeof Map<"u"&&(Te.working?Te(ht):ht instanceof Map)}function Be(ht){return j(ht)==="[object Set]"}function _t(ht){return typeof Set<"u"&&(Be.working?Be(ht):ht instanceof Set)}function Et(ht){return j(ht)==="[object WeakMap]"}function dt(ht){return typeof WeakMap<"u"&&(Et.working?Et(ht):ht instanceof WeakMap)}function Zt(ht){return j(ht)==="[object WeakSet]"}function Ye(ht){return Zt(ht)}function bt(ht){return j(ht)==="[object ArrayBuffer]"}function Qt(ht){return typeof ArrayBuffer<"u"&&(bt.working?bt(ht):ht instanceof ArrayBuffer)}function Vt(ht){return j(ht)==="[object DataView]"}function ut(ht){return typeof DataView<"u"&&(Vt.working?Vt(ht):ht instanceof DataView)}g.isArgumentsObject=w,g.isGeneratorFunction=$,g.isTypedArray=D,g.isPromise=ie,g.isArrayBufferView=re,g.isUint8Array=se,g.isUint8ClampedArray=X,g.isUint16Array=ne,g.isUint32Array=ce,g.isInt8Array=oe,g.isInt16Array=de,g.isInt32Array=me,g.isFloat32Array=ge,g.isFloat64Array=fe,g.isBigInt64Array=xe,g.isBigUint64Array=Fe,Te.working=typeof Map<"u"&&Te(new Map),g.isMap=Oe,Be.working=typeof Set<"u"&&Be(new Set),g.isSet=_t,Et.working=typeof WeakMap<"u"&&Et(new WeakMap),g.isWeakMap=dt,Zt.working=typeof WeakSet<"u"&&Zt(new WeakSet),g.isWeakSet=Ye,bt.working=typeof ArrayBuffer<"u"&&bt(new ArrayBuffer),g.isArrayBuffer=Qt,Vt.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Vt(new DataView(new ArrayBuffer(1),0,1)),g.isDataView=ut;var At=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function dr(ht){return j(ht)==="[object SharedArrayBuffer]"}function fr(ht){return At!==void 0&&(dr.working===void 0&&(dr.working=dr(new At)),dr.working?dr(ht):ht instanceof At)}function pr(ht){return j(ht)==="[object AsyncFunction]"}function zt(ht){return j(ht)==="[object Map Iterator]"}function Ce(ht){return j(ht)==="[object Set Iterator]"}function Nt(ht){return j(ht)==="[object Generator]"}function Xe(ht){return j(ht)==="[object WebAssembly.Module]"}function lt(ht){return J(ht,G)}function st(ht){return J(ht,H)}function yt(ht){return J(ht,V)}function Yt(ht){return U&&J(ht,Z)}function $e(ht){return q&&J(ht,Q)}function ze(ht){return lt(ht)||st(ht)||yt(ht)||Yt(ht)||$e(ht)}function ft(ht){return typeof Uint8Array<"u"&&(Qt(ht)||fr(ht))}g.isSharedArrayBuffer=fr,g.isAsyncFunction=pr,g.isMapIterator=zt,g.isSetIterator=Ce,g.isGeneratorObject=Nt,g.isWebAssemblyCompiledModule=Xe,g.isNumberObject=lt,g.isStringObject=st,g.isBooleanObject=yt,g.isBigIntObject=Yt,g.isSymbolObject=$e,g.isBoxedPrimitive=ze,g.isAnyArrayBuffer=ft,["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(ht){Object.defineProperty(g,ht,{enumerable:!1,value:function(){throw new Error(ht+" is not supported in userland")}})}))},{"is-arguments":47,"is-generator-function":49,"is-typed-array":50,"which-typed-array":85}],84:[function(d,m,g){(function(w){(function(){var $=Object.getOwnPropertyDescriptors||function(ut){for(var At=Object.keys(ut),dr={},fr=0;fr<At.length;fr++)dr[At[fr]]=Object.getOwnPropertyDescriptor(ut,At[fr]);return dr},I=/%[sdj%]/g;g.format=function(ut){if(!de(ut)){for(var At=[],dr=0;dr<arguments.length;dr++)At.push(q(arguments[dr]));return At.join(" ")}dr=1;for(var fr=arguments,pr=fr.length,zt=String(ut).replace(I,(function(Nt){if(Nt==="%%")return"%";if(dr>=pr)return Nt;switch(Nt){case"%s":return String(fr[dr++]);case"%d":return Number(fr[dr++]);case"%j":try{return JSON.stringify(fr[dr++])}catch{return"[Circular]"}default:return Nt}})),Ce=fr[dr];dr<pr;Ce=fr[++dr])ne(Ce)||!xe(Ce)?zt+=" "+Ce:zt+=" "+q(Ce);return zt},g.deprecate=function(ut,At){if(w!==void 0&&w.noDeprecation===!0)return ut;if(w===void 0)return function(){return g.deprecate(ut,At).apply(this,arguments)};var dr=!1;function fr(){if(!dr){if(w.throwDeprecation)throw new Error(At);w.traceDeprecation?console.trace(At):console.error(At),dr=!0}return ut.apply(this,arguments)}return fr};var D={},F=/^$/;if(w.env.NODE_DEBUG){var U=w.env.NODE_DEBUG;U=U.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),F=new RegExp("^"+U+"$","i")}function q(ut,At){var dr={seen:[],stylize:G};return arguments.length>=3&&(dr.depth=arguments[2]),arguments.length>=4&&(dr.colors=arguments[3]),X(At)?dr.showHidden=At:At&&g._extend(dr,At),ge(dr.showHidden)&&(dr.showHidden=!1),ge(dr.depth)&&(dr.depth=2),ge(dr.colors)&&(dr.colors=!1),ge(dr.customInspect)&&(dr.customInspect=!0),dr.colors&&(dr.stylize=j),V(dr,ut,dr.depth)}function j(ut,At){var dr=q.styles[At];return dr?"\x1B["+q.colors[dr][0]+"m"+ut+"\x1B["+q.colors[dr][1]+"m":ut}function G(ut,At){return ut}function H(ut){var At={};return ut.forEach((function(dr,fr){At[dr]=!0})),At}function V(ut,At,dr){if(ut.customInspect&&At&&Oe(At.inspect)&&At.inspect!==g.inspect&&(!At.constructor||At.constructor.prototype!==At)){var fr=At.inspect(dr,ut);return de(fr)||(fr=V(ut,fr,dr)),fr}var pr=Z(ut,At);if(pr)return pr;var zt=Object.keys(At),Ce=H(zt);if(ut.showHidden&&(zt=Object.getOwnPropertyNames(At)),Te(At)&&(zt.indexOf("message")>=0||zt.indexOf("description")>=0))return Q(At);if(zt.length===0){if(Oe(At)){var Nt=At.name?": "+At.name:"";return ut.stylize("[Function"+Nt+"]","special")}if(fe(At))return ut.stylize(RegExp.prototype.toString.call(At),"regexp");if(Fe(At))return ut.stylize(Date.prototype.toString.call(At),"date");if(Te(At))return Q(At)}var Xe,lt="",st=!1,yt=["{","}"];return se(At)&&(st=!0,yt=["[","]"]),Oe(At)&&(lt=" [Function"+(At.name?": "+At.name:"")+"]"),fe(At)&&(lt=" "+RegExp.prototype.toString.call(At)),Fe(At)&&(lt=" "+Date.prototype.toUTCString.call(At)),Te(At)&&(lt=" "+Q(At)),zt.length!==0||st&&At.length!=0?dr<0?fe(At)?ut.stylize(RegExp.prototype.toString.call(At),"regexp"):ut.stylize("[Object]","special"):(ut.seen.push(At),Xe=st?J(ut,At,dr,Ce,zt):zt.map((function(Yt){return ie(ut,At,dr,Ce,Yt,st)})),ut.seen.pop(),re(Xe,lt,yt)):yt[0]+lt+yt[1]}function Z(ut,At){if(ge(At))return ut.stylize("undefined","undefined");if(de(At)){var dr="'"+JSON.stringify(At).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ut.stylize(dr,"string")}return oe(At)?ut.stylize(""+At,"number"):X(At)?ut.stylize(""+At,"boolean"):ne(At)?ut.stylize("null","null"):void 0}function Q(ut){return"["+Error.prototype.toString.call(ut)+"]"}function J(ut,At,dr,fr,pr){for(var zt=[],Ce=0,Nt=At.length;Ce<Nt;++Ce)Ye(At,String(Ce))?zt.push(ie(ut,At,dr,fr,String(Ce),!0)):zt.push("");return pr.forEach((function(Xe){Xe.match(/^\d+$/)||zt.push(ie(ut,At,dr,fr,Xe,!0))})),zt}function ie(ut,At,dr,fr,pr,zt){var Ce,Nt,Xe;if((Xe=Object.getOwnPropertyDescriptor(At,pr)||{value:At[pr]}).get?Nt=Xe.set?ut.stylize("[Getter/Setter]","special"):ut.stylize("[Getter]","special"):Xe.set&&(Nt=ut.stylize("[Setter]","special")),Ye(fr,pr)||(Ce="["+pr+"]"),Nt||(ut.seen.indexOf(Xe.value)<0?(Nt=ne(dr)?V(ut,Xe.value,null):V(ut,Xe.value,dr-1)).indexOf(`
`)>-1&&(Nt=zt?Nt.split(`
`).map((function(lt){return"  "+lt})).join(`
`).slice(2):`
`+Nt.split(`
`).map((function(lt){return"   "+lt})).join(`
`)):Nt=ut.stylize("[Circular]","special")),ge(Ce)){if(zt&&pr.match(/^\d+$/))return Nt;(Ce=JSON.stringify(""+pr)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Ce=Ce.slice(1,-1),Ce=ut.stylize(Ce,"name")):(Ce=Ce.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Ce=ut.stylize(Ce,"string"))}return Ce+": "+Nt}function re(ut,At,dr){return ut.reduce((function(fr,pr){return pr.indexOf(`
`),fr+pr.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?dr[0]+(At===""?"":At+`
 `)+" "+ut.join(`,
  `)+" "+dr[1]:dr[0]+At+" "+ut.join(", ")+" "+dr[1]}function se(ut){return Array.isArray(ut)}function X(ut){return typeof ut=="boolean"}function ne(ut){return ut===null}function ce(ut){return ut==null}function oe(ut){return typeof ut=="number"}function de(ut){return typeof ut=="string"}function me(ut){return typeof ut=="symbol"}function ge(ut){return ut===void 0}function fe(ut){return xe(ut)&&_t(ut)==="[object RegExp]"}function xe(ut){return typeof ut=="object"&&ut!==null}function Fe(ut){return xe(ut)&&_t(ut)==="[object Date]"}function Te(ut){return xe(ut)&&(_t(ut)==="[object Error]"||ut instanceof Error)}function Oe(ut){return typeof ut=="function"}function Be(ut){return ut===null||typeof ut=="boolean"||typeof ut=="number"||typeof ut=="string"||typeof ut=="symbol"||ut===void 0}function _t(ut){return Object.prototype.toString.call(ut)}function Et(ut){return ut<10?"0"+ut.toString(10):ut.toString(10)}g.debuglog=function(ut){if(ut=ut.toUpperCase(),!D[ut])if(F.test(ut)){var At=w.pid;D[ut]=function(){var dr=g.format.apply(g,arguments);console.error("%s %d: %s",ut,At,dr)}}else D[ut]=function(){};return D[ut]},g.inspect=q,q.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},q.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},g.types=d("./support/types"),g.isArray=se,g.isBoolean=X,g.isNull=ne,g.isNullOrUndefined=ce,g.isNumber=oe,g.isString=de,g.isSymbol=me,g.isUndefined=ge,g.isRegExp=fe,g.types.isRegExp=fe,g.isObject=xe,g.isDate=Fe,g.types.isDate=Fe,g.isError=Te,g.types.isNativeError=Te,g.isFunction=Oe,g.isPrimitive=Be,g.isBuffer=d("./support/isBuffer");var dt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Zt(){var ut=new Date,At=[Et(ut.getHours()),Et(ut.getMinutes()),Et(ut.getSeconds())].join(":");return[ut.getDate(),dt[ut.getMonth()],At].join(" ")}function Ye(ut,At){return Object.prototype.hasOwnProperty.call(ut,At)}g.log=function(){console.log("%s - %s",Zt(),g.format.apply(g,arguments))},g.inherits=d("inherits"),g._extend=function(ut,At){if(!At||!xe(At))return ut;for(var dr=Object.keys(At),fr=dr.length;fr--;)ut[dr[fr]]=At[dr[fr]];return ut};var bt=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;function Qt(ut,At){if(!ut){var dr=new Error("Promise was rejected with a falsy value");dr.reason=ut,ut=dr}return At(ut)}function Vt(ut){if(typeof ut!="function")throw new TypeError('The "original" argument must be of type Function');function At(){for(var dr=[],fr=0;fr<arguments.length;fr++)dr.push(arguments[fr]);var pr=dr.pop();if(typeof pr!="function")throw new TypeError("The last argument must be of type Function");var zt=this,Ce=function(){return pr.apply(zt,arguments)};ut.apply(this,dr).then((function(Nt){w.nextTick(Ce.bind(null,null,Nt))}),(function(Nt){w.nextTick(Qt.bind(null,Nt,Ce))}))}return Object.setPrototypeOf(At,Object.getPrototypeOf(ut)),Object.defineProperties(At,$(ut)),At}g.promisify=function(ut){if(typeof ut!="function")throw new TypeError('The "original" argument must be of type Function');if(bt&&ut[bt]){var At;if(typeof(At=ut[bt])!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(At,bt,{value:At,enumerable:!1,writable:!1,configurable:!0}),At}function At(){for(var dr,fr,pr=new Promise((function(Nt,Xe){dr=Nt,fr=Xe})),zt=[],Ce=0;Ce<arguments.length;Ce++)zt.push(arguments[Ce]);zt.push((function(Nt,Xe){Nt?fr(Nt):dr(Xe)}));try{ut.apply(this,zt)}catch(Nt){fr(Nt)}return pr}return Object.setPrototypeOf(At,Object.getPrototypeOf(ut)),bt&&Object.defineProperty(At,bt,{value:At,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(At,$(ut))},g.promisify.custom=bt,g.callbackify=Vt}).call(this)}).call(this,d("_process"))},{"./support/isBuffer":82,"./support/types":83,_process:63,inherits:46}],85:[function(d,m,g){(function(w){(function(){var $=d("for-each"),I=d("available-typed-arrays"),D=d("call-bind/callBound"),F=d("gopd"),U=D("Object.prototype.toString"),q=d("has-tostringtag/shams")(),j=typeof globalThis>"u"?w:globalThis,G=I(),H=D("String.prototype.slice"),V={},Z=Object.getPrototypeOf;q&&F&&Z&&$(G,(function(ie){if(typeof j[ie]=="function"){var re=new j[ie];if(Symbol.toStringTag in re){var se=Z(re),X=F(se,Symbol.toStringTag);if(!X){var ne=Z(se);X=F(ne,Symbol.toStringTag)}V[ie]=X.get}}}));var Q=function(ie){var re=!1;return $(V,(function(se,X){if(!re)try{var ne=se.call(ie);ne===X&&(re=ne)}catch{}})),re},J=d("is-typed-array");m.exports=function(ie){return!!J(ie)&&(q&&Symbol.toStringTag in ie?Q(ie):H(U(ie),8,-1))}}).call(this)}).call(this,commonjsGlobal!==void 0?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{"available-typed-arrays":27,"call-bind/callBound":33,"for-each":36,gopd:40,"has-tostringtag/shams":43,"is-typed-array":50}]},{},[20])(20);var browserExports=browser$1.exports,PNGFilterType,PNGFilterType2,PNGColorType,PNGColorType2;function png(){return{mime:"image/png",hasAlpha:!0,encode:(d,{deflateLevel:m=9,deflateStrategy:g=3,filterType:w=PNGFilterType.AUTO,colorType:$,inputHasAlpha:I=!0,...D}={})=>{const F=new browserExports.PNG({width:d.width,height:d.height});return F.data=d.data,browserExports.PNG.sync.write(F,{...D,deflateLevel:m,deflateStrategy:g,filterType:w,colorType:$!==void 0?$:I?PNGColorType.COLOR_ALPHA:PNGColorType.COLOR,inputHasAlpha:I})},decode:(d,m)=>{const g=browserExports.PNG.sync.read(d,m);return{data:g.data,width:g.width,height:g.height}}}}PNGFilterType2=PNGFilterType||(PNGFilterType={}),PNGFilterType2[PNGFilterType2.AUTO=-1]="AUTO",PNGFilterType2[PNGFilterType2.NONE=0]="NONE",PNGFilterType2[PNGFilterType2.SUB=1]="SUB",PNGFilterType2[PNGFilterType2.UP=2]="UP",PNGFilterType2[PNGFilterType2.AVERAGE=3]="AVERAGE",PNGFilterType2[PNGFilterType2.PATH=4]="PATH",PNGColorType2=PNGColorType||(PNGColorType={}),PNGColorType2[PNGColorType2.GRAYSCALE=0]="GRAYSCALE",PNGColorType2[PNGColorType2.COLOR=2]="COLOR",PNGColorType2[PNGColorType2.GRAYSCALE_ALPHA=4]="GRAYSCALE_ALPHA",PNGColorType2[PNGColorType2.COLOR_ALPHA=6]="COLOR_ALPHA";var UTIF={exports:{}},common={},hasRequiredCommon;function requireCommon(){return hasRequiredCommon||(hasRequiredCommon=1,(function(d){var m=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function g(I,D){return Object.prototype.hasOwnProperty.call(I,D)}d.assign=function(I){for(var D=Array.prototype.slice.call(arguments,1);D.length;){var F=D.shift();if(F){if(typeof F!="object")throw new TypeError(F+"must be non-object");for(var U in F)g(F,U)&&(I[U]=F[U])}}return I},d.shrinkBuf=function(I,D){return I.length===D?I:I.subarray?I.subarray(0,D):(I.length=D,I)};var w={arraySet:function(I,D,F,U,q){if(D.subarray&&I.subarray)I.set(D.subarray(F,F+U),q);else for(var j=0;j<U;j++)I[q+j]=D[F+j]},flattenChunks:function(I){var D,F,U,q,j,G;for(U=0,D=0,F=I.length;D<F;D++)U+=I[D].length;for(G=new Uint8Array(U),q=0,D=0,F=I.length;D<F;D++)j=I[D],G.set(j,q),q+=j.length;return G}},$={arraySet:function(I,D,F,U,q){for(var j=0;j<U;j++)I[q+j]=D[F+j]},flattenChunks:function(I){return[].concat.apply([],I)}};d.setTyped=function(I){I?(d.Buf8=Uint8Array,d.Buf16=Uint16Array,d.Buf32=Int32Array,d.assign(d,w)):(d.Buf8=Array,d.Buf16=Array,d.Buf32=Array,d.assign(d,$))},d.setTyped(m)})(common)),common}var deflate$1={},deflate={},trees={},hasRequiredTrees,adler32_1,hasRequiredAdler32,crc32_1,hasRequiredCrc32,messages,hasRequiredMessages,hasRequiredDeflate$1;function requireTrees(){if(hasRequiredTrees)return trees;hasRequiredTrees=1;var d=requireCommon(),m=0,g=1;function w(Xe){for(var lt=Xe.length;--lt>=0;)Xe[lt]=0}var $=0,I=29,D=256,F=D+1+I,U=30,q=19,j=2*F+1,G=15,H=16,V=7,Z=256,Q=16,J=17,ie=18,re=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],se=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],X=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ne=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ce=new Array(2*(F+2));w(ce);var oe=new Array(2*U);w(oe);var de=new Array(512);w(de);var me=new Array(256);w(me);var ge=new Array(I);w(ge);var fe,xe,Fe,Te=new Array(U);function Oe(Xe,lt,st,yt,Yt){this.static_tree=Xe,this.extra_bits=lt,this.extra_base=st,this.elems=yt,this.max_length=Yt,this.has_stree=Xe&&Xe.length}function Be(Xe,lt){this.dyn_tree=Xe,this.max_code=0,this.stat_desc=lt}function _t(Xe){return Xe<256?de[Xe]:de[256+(Xe>>>7)]}function Et(Xe,lt){Xe.pending_buf[Xe.pending++]=255&lt,Xe.pending_buf[Xe.pending++]=lt>>>8&255}function dt(Xe,lt,st){Xe.bi_valid>H-st?(Xe.bi_buf|=lt<<Xe.bi_valid&65535,Et(Xe,Xe.bi_buf),Xe.bi_buf=lt>>H-Xe.bi_valid,Xe.bi_valid+=st-H):(Xe.bi_buf|=lt<<Xe.bi_valid&65535,Xe.bi_valid+=st)}function Zt(Xe,lt,st){dt(Xe,st[2*lt],st[2*lt+1])}function Ye(Xe,lt){var st=0;do st|=1&Xe,Xe>>>=1,st<<=1;while(--lt>0);return st>>>1}function bt(Xe,lt,st){var yt,Yt,$e=new Array(G+1),ze=0;for(yt=1;yt<=G;yt++)$e[yt]=ze=ze+st[yt-1]<<1;for(Yt=0;Yt<=lt;Yt++){var ft=Xe[2*Yt+1];ft!==0&&(Xe[2*Yt]=Ye($e[ft]++,ft))}}function Qt(Xe){var lt;for(lt=0;lt<F;lt++)Xe.dyn_ltree[2*lt]=0;for(lt=0;lt<U;lt++)Xe.dyn_dtree[2*lt]=0;for(lt=0;lt<q;lt++)Xe.bl_tree[2*lt]=0;Xe.dyn_ltree[2*Z]=1,Xe.opt_len=Xe.static_len=0,Xe.last_lit=Xe.matches=0}function Vt(Xe){Xe.bi_valid>8?Et(Xe,Xe.bi_buf):Xe.bi_valid>0&&(Xe.pending_buf[Xe.pending++]=Xe.bi_buf),Xe.bi_buf=0,Xe.bi_valid=0}function ut(Xe,lt,st,yt){var Yt=2*lt,$e=2*st;return Xe[Yt]<Xe[$e]||Xe[Yt]===Xe[$e]&&yt[lt]<=yt[st]}function At(Xe,lt,st){for(var yt=Xe.heap[st],Yt=st<<1;Yt<=Xe.heap_len&&(Yt<Xe.heap_len&&ut(lt,Xe.heap[Yt+1],Xe.heap[Yt],Xe.depth)&&Yt++,!ut(lt,yt,Xe.heap[Yt],Xe.depth));)Xe.heap[st]=Xe.heap[Yt],st=Yt,Yt<<=1;Xe.heap[st]=yt}function dr(Xe,lt,st){var yt,Yt,$e,ze,ft=0;if(Xe.last_lit!==0)do yt=Xe.pending_buf[Xe.d_buf+2*ft]<<8|Xe.pending_buf[Xe.d_buf+2*ft+1],Yt=Xe.pending_buf[Xe.l_buf+ft],ft++,yt===0?Zt(Xe,Yt,lt):(Zt(Xe,($e=me[Yt])+D+1,lt),(ze=re[$e])!==0&&dt(Xe,Yt-=ge[$e],ze),Zt(Xe,$e=_t(--yt),st),(ze=se[$e])!==0&&dt(Xe,yt-=Te[$e],ze));while(ft<Xe.last_lit);Zt(Xe,Z,lt)}function fr(Xe,lt){var st,yt,Yt,$e=lt.dyn_tree,ze=lt.stat_desc.static_tree,ft=lt.stat_desc.has_stree,ht=lt.stat_desc.elems,gr=-1;for(Xe.heap_len=0,Xe.heap_max=j,st=0;st<ht;st++)$e[2*st]!==0?(Xe.heap[++Xe.heap_len]=gr=st,Xe.depth[st]=0):$e[2*st+1]=0;for(;Xe.heap_len<2;)$e[2*(Yt=Xe.heap[++Xe.heap_len]=gr<2?++gr:0)]=1,Xe.depth[Yt]=0,Xe.opt_len--,ft&&(Xe.static_len-=ze[2*Yt+1]);for(lt.max_code=gr,st=Xe.heap_len>>1;st>=1;st--)At(Xe,$e,st);Yt=ht;do st=Xe.heap[1],Xe.heap[1]=Xe.heap[Xe.heap_len--],At(Xe,$e,1),yt=Xe.heap[1],Xe.heap[--Xe.heap_max]=st,Xe.heap[--Xe.heap_max]=yt,$e[2*Yt]=$e[2*st]+$e[2*yt],Xe.depth[Yt]=(Xe.depth[st]>=Xe.depth[yt]?Xe.depth[st]:Xe.depth[yt])+1,$e[2*st+1]=$e[2*yt+1]=Yt,Xe.heap[1]=Yt++,At(Xe,$e,1);while(Xe.heap_len>=2);Xe.heap[--Xe.heap_max]=Xe.heap[1],(function(yr,li){var fi,ai,hi,ui,vi,bi,_i=li.dyn_tree,ki=li.max_code,yi=li.stat_desc.static_tree,cr=li.stat_desc.has_stree,di=li.stat_desc.extra_bits,br=li.stat_desc.extra_base,ii=li.stat_desc.max_length,It=0;for(ui=0;ui<=G;ui++)yr.bl_count[ui]=0;for(_i[2*yr.heap[yr.heap_max]+1]=0,fi=yr.heap_max+1;fi<j;fi++)(ui=_i[2*_i[2*(ai=yr.heap[fi])+1]+1]+1)>ii&&(ui=ii,It++),_i[2*ai+1]=ui,ai>ki||(yr.bl_count[ui]++,vi=0,ai>=br&&(vi=di[ai-br]),bi=_i[2*ai],yr.opt_len+=bi*(ui+vi),cr&&(yr.static_len+=bi*(yi[2*ai+1]+vi)));if(It!==0){do{for(ui=ii-1;yr.bl_count[ui]===0;)ui--;yr.bl_count[ui]--,yr.bl_count[ui+1]+=2,yr.bl_count[ii]--,It-=2}while(It>0);for(ui=ii;ui!==0;ui--)for(ai=yr.bl_count[ui];ai!==0;)(hi=yr.heap[--fi])>ki||(_i[2*hi+1]!==ui&&(yr.opt_len+=(ui-_i[2*hi+1])*_i[2*hi],_i[2*hi+1]=ui),ai--)}})(Xe,lt),bt($e,gr,Xe.bl_count)}function pr(Xe,lt,st){var yt,Yt,$e=-1,ze=lt[1],ft=0,ht=7,gr=4;for(ze===0&&(ht=138,gr=3),lt[2*(st+1)+1]=65535,yt=0;yt<=st;yt++)Yt=ze,ze=lt[2*(yt+1)+1],++ft<ht&&Yt===ze||(ft<gr?Xe.bl_tree[2*Yt]+=ft:Yt!==0?(Yt!==$e&&Xe.bl_tree[2*Yt]++,Xe.bl_tree[2*Q]++):ft<=10?Xe.bl_tree[2*J]++:Xe.bl_tree[2*ie]++,ft=0,$e=Yt,ze===0?(ht=138,gr=3):Yt===ze?(ht=6,gr=3):(ht=7,gr=4))}function zt(Xe,lt,st){var yt,Yt,$e=-1,ze=lt[1],ft=0,ht=7,gr=4;for(ze===0&&(ht=138,gr=3),yt=0;yt<=st;yt++)if(Yt=ze,ze=lt[2*(yt+1)+1],!(++ft<ht&&Yt===ze)){if(ft<gr)do Zt(Xe,Yt,Xe.bl_tree);while(--ft!=0);else Yt!==0?(Yt!==$e&&(Zt(Xe,Yt,Xe.bl_tree),ft--),Zt(Xe,Q,Xe.bl_tree),dt(Xe,ft-3,2)):ft<=10?(Zt(Xe,J,Xe.bl_tree),dt(Xe,ft-3,3)):(Zt(Xe,ie,Xe.bl_tree),dt(Xe,ft-11,7));ft=0,$e=Yt,ze===0?(ht=138,gr=3):Yt===ze?(ht=6,gr=3):(ht=7,gr=4)}}w(Te);var Ce=!1;function Nt(Xe,lt,st,yt){dt(Xe,($<<1)+(yt?1:0),3),(function(Yt,$e,ze,ft){Vt(Yt),Et(Yt,ze),Et(Yt,~ze),d.arraySet(Yt.pending_buf,Yt.window,$e,ze,Yt.pending),Yt.pending+=ze})(Xe,lt,st)}return trees._tr_init=function(Xe){Ce||((function(){var lt,st,yt,Yt,$e,ze=new Array(G+1);for(yt=0,Yt=0;Yt<I-1;Yt++)for(ge[Yt]=yt,lt=0;lt<1<<re[Yt];lt++)me[yt++]=Yt;for(me[yt-1]=Yt,$e=0,Yt=0;Yt<16;Yt++)for(Te[Yt]=$e,lt=0;lt<1<<se[Yt];lt++)de[$e++]=Yt;for($e>>=7;Yt<U;Yt++)for(Te[Yt]=$e<<7,lt=0;lt<1<<se[Yt]-7;lt++)de[256+$e++]=Yt;for(st=0;st<=G;st++)ze[st]=0;for(lt=0;lt<=143;)ce[2*lt+1]=8,lt++,ze[8]++;for(;lt<=255;)ce[2*lt+1]=9,lt++,ze[9]++;for(;lt<=279;)ce[2*lt+1]=7,lt++,ze[7]++;for(;lt<=287;)ce[2*lt+1]=8,lt++,ze[8]++;for(bt(ce,F+1,ze),lt=0;lt<U;lt++)oe[2*lt+1]=5,oe[2*lt]=Ye(lt,5);fe=new Oe(ce,re,D+1,F,G),xe=new Oe(oe,se,0,U,G),Fe=new Oe(new Array(0),X,0,q,V)})(),Ce=!0),Xe.l_desc=new Be(Xe.dyn_ltree,fe),Xe.d_desc=new Be(Xe.dyn_dtree,xe),Xe.bl_desc=new Be(Xe.bl_tree,Fe),Xe.bi_buf=0,Xe.bi_valid=0,Qt(Xe)},trees._tr_stored_block=Nt,trees._tr_flush_block=function(Xe,lt,st,yt){var Yt,$e,ze=0;Xe.level>0?(Xe.strm.data_type===2&&(Xe.strm.data_type=(function(ft){var ht,gr=4093624447;for(ht=0;ht<=31;ht++,gr>>>=1)if(1&gr&&ft.dyn_ltree[2*ht]!==0)return m;if(ft.dyn_ltree[18]!==0||ft.dyn_ltree[20]!==0||ft.dyn_ltree[26]!==0)return g;for(ht=32;ht<D;ht++)if(ft.dyn_ltree[2*ht]!==0)return g;return m})(Xe)),fr(Xe,Xe.l_desc),fr(Xe,Xe.d_desc),ze=(function(ft){var ht;for(pr(ft,ft.dyn_ltree,ft.l_desc.max_code),pr(ft,ft.dyn_dtree,ft.d_desc.max_code),fr(ft,ft.bl_desc),ht=q-1;ht>=3&&ft.bl_tree[2*ne[ht]+1]===0;ht--);return ft.opt_len+=3*(ht+1)+5+5+4,ht})(Xe),Yt=Xe.opt_len+3+7>>>3,($e=Xe.static_len+3+7>>>3)<=Yt&&(Yt=$e)):Yt=$e=st+5,st+4<=Yt&&lt!==-1?Nt(Xe,lt,st,yt):Xe.strategy===4||$e===Yt?(dt(Xe,2+(yt?1:0),3),dr(Xe,ce,oe)):(dt(Xe,4+(yt?1:0),3),(function(ft,ht,gr,yr){var li;for(dt(ft,ht-257,5),dt(ft,gr-1,5),dt(ft,yr-4,4),li=0;li<yr;li++)dt(ft,ft.bl_tree[2*ne[li]+1],3);zt(ft,ft.dyn_ltree,ht-1),zt(ft,ft.dyn_dtree,gr-1)})(Xe,Xe.l_desc.max_code+1,Xe.d_desc.max_code+1,ze+1),dr(Xe,Xe.dyn_ltree,Xe.dyn_dtree)),Qt(Xe),yt&&Vt(Xe)},trees._tr_tally=function(Xe,lt,st){return Xe.pending_buf[Xe.d_buf+2*Xe.last_lit]=lt>>>8&255,Xe.pending_buf[Xe.d_buf+2*Xe.last_lit+1]=255&lt,Xe.pending_buf[Xe.l_buf+Xe.last_lit]=255&st,Xe.last_lit++,lt===0?Xe.dyn_ltree[2*st]++:(Xe.matches++,lt--,Xe.dyn_ltree[2*(me[st]+D+1)]++,Xe.dyn_dtree[2*_t(lt)]++),Xe.last_lit===Xe.lit_bufsize-1},trees._tr_align=function(Xe){dt(Xe,2,3),Zt(Xe,Z,ce),(function(lt){lt.bi_valid===16?(Et(lt,lt.bi_buf),lt.bi_buf=0,lt.bi_valid=0):lt.bi_valid>=8&&(lt.pending_buf[lt.pending++]=255&lt.bi_buf,lt.bi_buf>>=8,lt.bi_valid-=8)})(Xe)},trees}function requireAdler32(){return hasRequiredAdler32||(hasRequiredAdler32=1,adler32_1=function(d,m,g,w){for(var $=65535&d,I=d>>>16&65535,D=0;g!==0;){g-=D=g>2e3?2e3:g;do I=I+($=$+m[w++]|0)|0;while(--D);$%=65521,I%=65521}return $|I<<16}),adler32_1}function requireCrc32(){if(hasRequiredCrc32)return crc32_1;hasRequiredCrc32=1;var d=(function(){for(var m,g=[],w=0;w<256;w++){m=w;for(var $=0;$<8;$++)m=1&m?3988292384^m>>>1:m>>>1;g[w]=m}return g})();return crc32_1=function(m,g,w,$){var I=d,D=$+w;m^=-1;for(var F=$;F<D;F++)m=m>>>8^I[255&(m^g[F])];return~m},crc32_1}function requireMessages(){return hasRequiredMessages?messages:(hasRequiredMessages=1,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"})}function requireDeflate$1(){if(hasRequiredDeflate$1)return deflate;hasRequiredDeflate$1=1;var d,m=requireCommon(),g=requireTrees(),w=requireAdler32(),$=requireCrc32(),I=requireMessages(),D=0,F=4,U=0,q=-2,j=-1,G=4,H=2,V=8,Z=9,Q=286,J=30,ie=19,re=2*Q+1,se=15,X=3,ne=258,ce=ne+X+1,oe=42,de=103,me=113,ge=666,fe=1,xe=2,Fe=3,Te=4;function Oe(Ce,Nt){return Ce.msg=I[Nt],Nt}function Be(Ce){return(Ce<<1)-(Ce>4?9:0)}function _t(Ce){for(var Nt=Ce.length;--Nt>=0;)Ce[Nt]=0}function Et(Ce){var Nt=Ce.state,Xe=Nt.pending;Xe>Ce.avail_out&&(Xe=Ce.avail_out),Xe!==0&&(m.arraySet(Ce.output,Nt.pending_buf,Nt.pending_out,Xe,Ce.next_out),Ce.next_out+=Xe,Nt.pending_out+=Xe,Ce.total_out+=Xe,Ce.avail_out-=Xe,Nt.pending-=Xe,Nt.pending===0&&(Nt.pending_out=0))}function dt(Ce,Nt){g._tr_flush_block(Ce,Ce.block_start>=0?Ce.block_start:-1,Ce.strstart-Ce.block_start,Nt),Ce.block_start=Ce.strstart,Et(Ce.strm)}function Zt(Ce,Nt){Ce.pending_buf[Ce.pending++]=Nt}function Ye(Ce,Nt){Ce.pending_buf[Ce.pending++]=Nt>>>8&255,Ce.pending_buf[Ce.pending++]=255&Nt}function bt(Ce,Nt){var Xe,lt,st=Ce.max_chain_length,yt=Ce.strstart,Yt=Ce.prev_length,$e=Ce.nice_match,ze=Ce.strstart>Ce.w_size-ce?Ce.strstart-(Ce.w_size-ce):0,ft=Ce.window,ht=Ce.w_mask,gr=Ce.prev,yr=Ce.strstart+ne,li=ft[yt+Yt-1],fi=ft[yt+Yt];Ce.prev_length>=Ce.good_match&&(st>>=2),$e>Ce.lookahead&&($e=Ce.lookahead);do if(ft[(Xe=Nt)+Yt]===fi&&ft[Xe+Yt-1]===li&&ft[Xe]===ft[yt]&&ft[++Xe]===ft[yt+1]){yt+=2,Xe++;do;while(ft[++yt]===ft[++Xe]&&ft[++yt]===ft[++Xe]&&ft[++yt]===ft[++Xe]&&ft[++yt]===ft[++Xe]&&ft[++yt]===ft[++Xe]&&ft[++yt]===ft[++Xe]&&ft[++yt]===ft[++Xe]&&ft[++yt]===ft[++Xe]&&yt<yr);if(lt=ne-(yr-yt),yt=yr-ne,lt>Yt){if(Ce.match_start=Nt,Yt=lt,lt>=$e)break;li=ft[yt+Yt-1],fi=ft[yt+Yt]}}while((Nt=gr[Nt&ht])>ze&&--st!=0);return Yt<=Ce.lookahead?Yt:Ce.lookahead}function Qt(Ce){var Nt,Xe,lt,st,yt,Yt,$e,ze,ft,ht,gr=Ce.w_size;do{if(st=Ce.window_size-Ce.lookahead-Ce.strstart,Ce.strstart>=gr+(gr-ce)){m.arraySet(Ce.window,Ce.window,gr,gr,0),Ce.match_start-=gr,Ce.strstart-=gr,Ce.block_start-=gr,Nt=Xe=Ce.hash_size;do lt=Ce.head[--Nt],Ce.head[Nt]=lt>=gr?lt-gr:0;while(--Xe);Nt=Xe=gr;do lt=Ce.prev[--Nt],Ce.prev[Nt]=lt>=gr?lt-gr:0;while(--Xe);st+=gr}if(Ce.strm.avail_in===0)break;if(Yt=Ce.strm,$e=Ce.window,ze=Ce.strstart+Ce.lookahead,ft=st,ht=void 0,(ht=Yt.avail_in)>ft&&(ht=ft),Xe=ht===0?0:(Yt.avail_in-=ht,m.arraySet($e,Yt.input,Yt.next_in,ht,ze),Yt.state.wrap===1?Yt.adler=w(Yt.adler,$e,ht,ze):Yt.state.wrap===2&&(Yt.adler=$(Yt.adler,$e,ht,ze)),Yt.next_in+=ht,Yt.total_in+=ht,ht),Ce.lookahead+=Xe,Ce.lookahead+Ce.insert>=X)for(yt=Ce.strstart-Ce.insert,Ce.ins_h=Ce.window[yt],Ce.ins_h=(Ce.ins_h<<Ce.hash_shift^Ce.window[yt+1])&Ce.hash_mask;Ce.insert&&(Ce.ins_h=(Ce.ins_h<<Ce.hash_shift^Ce.window[yt+X-1])&Ce.hash_mask,Ce.prev[yt&Ce.w_mask]=Ce.head[Ce.ins_h],Ce.head[Ce.ins_h]=yt,yt++,Ce.insert--,!(Ce.lookahead+Ce.insert<X)););}while(Ce.lookahead<ce&&Ce.strm.avail_in!==0)}function Vt(Ce,Nt){for(var Xe,lt;;){if(Ce.lookahead<ce){if(Qt(Ce),Ce.lookahead<ce&&Nt===D)return fe;if(Ce.lookahead===0)break}if(Xe=0,Ce.lookahead>=X&&(Ce.ins_h=(Ce.ins_h<<Ce.hash_shift^Ce.window[Ce.strstart+X-1])&Ce.hash_mask,Xe=Ce.prev[Ce.strstart&Ce.w_mask]=Ce.head[Ce.ins_h],Ce.head[Ce.ins_h]=Ce.strstart),Xe!==0&&Ce.strstart-Xe<=Ce.w_size-ce&&(Ce.match_length=bt(Ce,Xe)),Ce.match_length>=X)if(lt=g._tr_tally(Ce,Ce.strstart-Ce.match_start,Ce.match_length-X),Ce.lookahead-=Ce.match_length,Ce.match_length<=Ce.max_lazy_match&&Ce.lookahead>=X){Ce.match_length--;do Ce.strstart++,Ce.ins_h=(Ce.ins_h<<Ce.hash_shift^Ce.window[Ce.strstart+X-1])&Ce.hash_mask,Xe=Ce.prev[Ce.strstart&Ce.w_mask]=Ce.head[Ce.ins_h],Ce.head[Ce.ins_h]=Ce.strstart;while(--Ce.match_length!=0);Ce.strstart++}else Ce.strstart+=Ce.match_length,Ce.match_length=0,Ce.ins_h=Ce.window[Ce.strstart],Ce.ins_h=(Ce.ins_h<<Ce.hash_shift^Ce.window[Ce.strstart+1])&Ce.hash_mask;else lt=g._tr_tally(Ce,0,Ce.window[Ce.strstart]),Ce.lookahead--,Ce.strstart++;if(lt&&(dt(Ce,!1),Ce.strm.avail_out===0))return fe}return Ce.insert=Ce.strstart<X-1?Ce.strstart:X-1,Nt===F?(dt(Ce,!0),Ce.strm.avail_out===0?Fe:Te):Ce.last_lit&&(dt(Ce,!1),Ce.strm.avail_out===0)?fe:xe}function ut(Ce,Nt){for(var Xe,lt,st;;){if(Ce.lookahead<ce){if(Qt(Ce),Ce.lookahead<ce&&Nt===D)return fe;if(Ce.lookahead===0)break}if(Xe=0,Ce.lookahead>=X&&(Ce.ins_h=(Ce.ins_h<<Ce.hash_shift^Ce.window[Ce.strstart+X-1])&Ce.hash_mask,Xe=Ce.prev[Ce.strstart&Ce.w_mask]=Ce.head[Ce.ins_h],Ce.head[Ce.ins_h]=Ce.strstart),Ce.prev_length=Ce.match_length,Ce.prev_match=Ce.match_start,Ce.match_length=X-1,Xe!==0&&Ce.prev_length<Ce.max_lazy_match&&Ce.strstart-Xe<=Ce.w_size-ce&&(Ce.match_length=bt(Ce,Xe),Ce.match_length<=5&&(Ce.strategy===1||Ce.match_length===X&&Ce.strstart-Ce.match_start>4096)&&(Ce.match_length=X-1)),Ce.prev_length>=X&&Ce.match_length<=Ce.prev_length){st=Ce.strstart+Ce.lookahead-X,lt=g._tr_tally(Ce,Ce.strstart-1-Ce.prev_match,Ce.prev_length-X),Ce.lookahead-=Ce.prev_length-1,Ce.prev_length-=2;do++Ce.strstart<=st&&(Ce.ins_h=(Ce.ins_h<<Ce.hash_shift^Ce.window[Ce.strstart+X-1])&Ce.hash_mask,Xe=Ce.prev[Ce.strstart&Ce.w_mask]=Ce.head[Ce.ins_h],Ce.head[Ce.ins_h]=Ce.strstart);while(--Ce.prev_length!=0);if(Ce.match_available=0,Ce.match_length=X-1,Ce.strstart++,lt&&(dt(Ce,!1),Ce.strm.avail_out===0))return fe}else if(Ce.match_available){if((lt=g._tr_tally(Ce,0,Ce.window[Ce.strstart-1]))&&dt(Ce,!1),Ce.strstart++,Ce.lookahead--,Ce.strm.avail_out===0)return fe}else Ce.match_available=1,Ce.strstart++,Ce.lookahead--}return Ce.match_available&&(lt=g._tr_tally(Ce,0,Ce.window[Ce.strstart-1]),Ce.match_available=0),Ce.insert=Ce.strstart<X-1?Ce.strstart:X-1,Nt===F?(dt(Ce,!0),Ce.strm.avail_out===0?Fe:Te):Ce.last_lit&&(dt(Ce,!1),Ce.strm.avail_out===0)?fe:xe}function At(Ce,Nt,Xe,lt,st){this.good_length=Ce,this.max_lazy=Nt,this.nice_length=Xe,this.max_chain=lt,this.func=st}function dr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=V,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new m.Buf16(2*re),this.dyn_dtree=new m.Buf16(2*(2*J+1)),this.bl_tree=new m.Buf16(2*(2*ie+1)),_t(this.dyn_ltree),_t(this.dyn_dtree),_t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new m.Buf16(se+1),this.heap=new m.Buf16(2*Q+1),_t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new m.Buf16(2*Q+1),_t(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function fr(Ce){var Nt;return Ce&&Ce.state?(Ce.total_in=Ce.total_out=0,Ce.data_type=H,(Nt=Ce.state).pending=0,Nt.pending_out=0,Nt.wrap<0&&(Nt.wrap=-Nt.wrap),Nt.status=Nt.wrap?oe:me,Ce.adler=Nt.wrap===2?0:1,Nt.last_flush=D,g._tr_init(Nt),U):Oe(Ce,q)}function pr(Ce){var Nt=fr(Ce);return Nt===U&&(function(Xe){Xe.window_size=2*Xe.w_size,_t(Xe.head),Xe.max_lazy_match=d[Xe.level].max_lazy,Xe.good_match=d[Xe.level].good_length,Xe.nice_match=d[Xe.level].nice_length,Xe.max_chain_length=d[Xe.level].max_chain,Xe.strstart=0,Xe.block_start=0,Xe.lookahead=0,Xe.insert=0,Xe.match_length=Xe.prev_length=X-1,Xe.match_available=0,Xe.ins_h=0})(Ce.state),Nt}function zt(Ce,Nt,Xe,lt,st,yt){if(!Ce)return q;var Yt=1;if(Nt===j&&(Nt=6),lt<0?(Yt=0,lt=-lt):lt>15&&(Yt=2,lt-=16),st<1||st>Z||Xe!==V||lt<8||lt>15||Nt<0||Nt>9||yt<0||yt>G)return Oe(Ce,q);lt===8&&(lt=9);var $e=new dr;return Ce.state=$e,$e.strm=Ce,$e.wrap=Yt,$e.gzhead=null,$e.w_bits=lt,$e.w_size=1<<$e.w_bits,$e.w_mask=$e.w_size-1,$e.hash_bits=st+7,$e.hash_size=1<<$e.hash_bits,$e.hash_mask=$e.hash_size-1,$e.hash_shift=~~(($e.hash_bits+X-1)/X),$e.window=new m.Buf8(2*$e.w_size),$e.head=new m.Buf16($e.hash_size),$e.prev=new m.Buf16($e.w_size),$e.lit_bufsize=1<<st+6,$e.pending_buf_size=4*$e.lit_bufsize,$e.pending_buf=new m.Buf8($e.pending_buf_size),$e.d_buf=1*$e.lit_bufsize,$e.l_buf=3*$e.lit_bufsize,$e.level=Nt,$e.strategy=yt,$e.method=Xe,pr(Ce)}return d=[new At(0,0,0,0,(function(Ce,Nt){var Xe=65535;for(Xe>Ce.pending_buf_size-5&&(Xe=Ce.pending_buf_size-5);;){if(Ce.lookahead<=1){if(Qt(Ce),Ce.lookahead===0&&Nt===D)return fe;if(Ce.lookahead===0)break}Ce.strstart+=Ce.lookahead,Ce.lookahead=0;var lt=Ce.block_start+Xe;if((Ce.strstart===0||Ce.strstart>=lt)&&(Ce.lookahead=Ce.strstart-lt,Ce.strstart=lt,dt(Ce,!1),Ce.strm.avail_out===0)||Ce.strstart-Ce.block_start>=Ce.w_size-ce&&(dt(Ce,!1),Ce.strm.avail_out===0))return fe}return Ce.insert=0,Nt===F?(dt(Ce,!0),Ce.strm.avail_out===0?Fe:Te):(Ce.strstart>Ce.block_start&&(dt(Ce,!1),Ce.strm.avail_out),fe)})),new At(4,4,8,4,Vt),new At(4,5,16,8,Vt),new At(4,6,32,32,Vt),new At(4,4,16,16,ut),new At(8,16,32,32,ut),new At(8,16,128,128,ut),new At(8,32,128,256,ut),new At(32,128,258,1024,ut),new At(32,258,258,4096,ut)],deflate.deflateInit=function(Ce,Nt){return zt(Ce,Nt,V,15,8,0)},deflate.deflateInit2=zt,deflate.deflateReset=pr,deflate.deflateResetKeep=fr,deflate.deflateSetHeader=function(Ce,Nt){return Ce&&Ce.state?Ce.state.wrap!==2?q:(Ce.state.gzhead=Nt,U):q},deflate.deflate=function(Ce,Nt){var Xe,lt,st,yt;if(!Ce||!Ce.state||Nt>5||Nt<0)return Ce?Oe(Ce,q):q;if(lt=Ce.state,!Ce.output||!Ce.input&&Ce.avail_in!==0||lt.status===ge&&Nt!==F)return Oe(Ce,Ce.avail_out===0?-5:q);if(lt.strm=Ce,Xe=lt.last_flush,lt.last_flush=Nt,lt.status===oe)if(lt.wrap===2)Ce.adler=0,Zt(lt,31),Zt(lt,139),Zt(lt,8),lt.gzhead?(Zt(lt,(lt.gzhead.text?1:0)+(lt.gzhead.hcrc?2:0)+(lt.gzhead.extra?4:0)+(lt.gzhead.name?8:0)+(lt.gzhead.comment?16:0)),Zt(lt,255&lt.gzhead.time),Zt(lt,lt.gzhead.time>>8&255),Zt(lt,lt.gzhead.time>>16&255),Zt(lt,lt.gzhead.time>>24&255),Zt(lt,lt.level===9?2:lt.strategy>=2||lt.level<2?4:0),Zt(lt,255&lt.gzhead.os),lt.gzhead.extra&&lt.gzhead.extra.length&&(Zt(lt,255&lt.gzhead.extra.length),Zt(lt,lt.gzhead.extra.length>>8&255)),lt.gzhead.hcrc&&(Ce.adler=$(Ce.adler,lt.pending_buf,lt.pending,0)),lt.gzindex=0,lt.status=69):(Zt(lt,0),Zt(lt,0),Zt(lt,0),Zt(lt,0),Zt(lt,0),Zt(lt,lt.level===9?2:lt.strategy>=2||lt.level<2?4:0),Zt(lt,3),lt.status=me);else{var Yt=V+(lt.w_bits-8<<4)<<8;Yt|=(lt.strategy>=2||lt.level<2?0:lt.level<6?1:lt.level===6?2:3)<<6,lt.strstart!==0&&(Yt|=32),Yt+=31-Yt%31,lt.status=me,Ye(lt,Yt),lt.strstart!==0&&(Ye(lt,Ce.adler>>>16),Ye(lt,65535&Ce.adler)),Ce.adler=1}if(lt.status===69)if(lt.gzhead.extra){for(st=lt.pending;lt.gzindex<(65535&lt.gzhead.extra.length)&&(lt.pending!==lt.pending_buf_size||(lt.gzhead.hcrc&&lt.pending>st&&(Ce.adler=$(Ce.adler,lt.pending_buf,lt.pending-st,st)),Et(Ce),st=lt.pending,lt.pending!==lt.pending_buf_size));)Zt(lt,255&lt.gzhead.extra[lt.gzindex]),lt.gzindex++;lt.gzhead.hcrc&&lt.pending>st&&(Ce.adler=$(Ce.adler,lt.pending_buf,lt.pending-st,st)),lt.gzindex===lt.gzhead.extra.length&&(lt.gzindex=0,lt.status=73)}else lt.status=73;if(lt.status===73)if(lt.gzhead.name){st=lt.pending;do{if(lt.pending===lt.pending_buf_size&&(lt.gzhead.hcrc&&lt.pending>st&&(Ce.adler=$(Ce.adler,lt.pending_buf,lt.pending-st,st)),Et(Ce),st=lt.pending,lt.pending===lt.pending_buf_size)){yt=1;break}yt=lt.gzindex<lt.gzhead.name.length?255&lt.gzhead.name.charCodeAt(lt.gzindex++):0,Zt(lt,yt)}while(yt!==0);lt.gzhead.hcrc&&lt.pending>st&&(Ce.adler=$(Ce.adler,lt.pending_buf,lt.pending-st,st)),yt===0&&(lt.gzindex=0,lt.status=91)}else lt.status=91;if(lt.status===91)if(lt.gzhead.comment){st=lt.pending;do{if(lt.pending===lt.pending_buf_size&&(lt.gzhead.hcrc&&lt.pending>st&&(Ce.adler=$(Ce.adler,lt.pending_buf,lt.pending-st,st)),Et(Ce),st=lt.pending,lt.pending===lt.pending_buf_size)){yt=1;break}yt=lt.gzindex<lt.gzhead.comment.length?255&lt.gzhead.comment.charCodeAt(lt.gzindex++):0,Zt(lt,yt)}while(yt!==0);lt.gzhead.hcrc&&lt.pending>st&&(Ce.adler=$(Ce.adler,lt.pending_buf,lt.pending-st,st)),yt===0&&(lt.status=de)}else lt.status=de;if(lt.status===de&&(lt.gzhead.hcrc?(lt.pending+2>lt.pending_buf_size&&Et(Ce),lt.pending+2<=lt.pending_buf_size&&(Zt(lt,255&Ce.adler),Zt(lt,Ce.adler>>8&255),Ce.adler=0,lt.status=me)):lt.status=me),lt.pending!==0){if(Et(Ce),Ce.avail_out===0)return lt.last_flush=-1,U}else if(Ce.avail_in===0&&Be(Nt)<=Be(Xe)&&Nt!==F)return Oe(Ce,-5);if(lt.status===ge&&Ce.avail_in!==0)return Oe(Ce,-5);if(Ce.avail_in!==0||lt.lookahead!==0||Nt!==D&&lt.status!==ge){var $e=lt.strategy===2?(function(ze,ft){for(var ht;;){if(ze.lookahead===0&&(Qt(ze),ze.lookahead===0)){if(ft===D)return fe;break}if(ze.match_length=0,ht=g._tr_tally(ze,0,ze.window[ze.strstart]),ze.lookahead--,ze.strstart++,ht&&(dt(ze,!1),ze.strm.avail_out===0))return fe}return ze.insert=0,ft===F?(dt(ze,!0),ze.strm.avail_out===0?Fe:Te):ze.last_lit&&(dt(ze,!1),ze.strm.avail_out===0)?fe:xe})(lt,Nt):lt.strategy===3?(function(ze,ft){for(var ht,gr,yr,li,fi=ze.window;;){if(ze.lookahead<=ne){if(Qt(ze),ze.lookahead<=ne&&ft===D)return fe;if(ze.lookahead===0)break}if(ze.match_length=0,ze.lookahead>=X&&ze.strstart>0&&(gr=fi[yr=ze.strstart-1])===fi[++yr]&&gr===fi[++yr]&&gr===fi[++yr]){li=ze.strstart+ne;do;while(gr===fi[++yr]&&gr===fi[++yr]&&gr===fi[++yr]&&gr===fi[++yr]&&gr===fi[++yr]&&gr===fi[++yr]&&gr===fi[++yr]&&gr===fi[++yr]&&yr<li);ze.match_length=ne-(li-yr),ze.match_length>ze.lookahead&&(ze.match_length=ze.lookahead)}if(ze.match_length>=X?(ht=g._tr_tally(ze,1,ze.match_length-X),ze.lookahead-=ze.match_length,ze.strstart+=ze.match_length,ze.match_length=0):(ht=g._tr_tally(ze,0,ze.window[ze.strstart]),ze.lookahead--,ze.strstart++),ht&&(dt(ze,!1),ze.strm.avail_out===0))return fe}return ze.insert=0,ft===F?(dt(ze,!0),ze.strm.avail_out===0?Fe:Te):ze.last_lit&&(dt(ze,!1),ze.strm.avail_out===0)?fe:xe})(lt,Nt):d[lt.level].func(lt,Nt);if($e!==Fe&&$e!==Te||(lt.status=ge),$e===fe||$e===Fe)return Ce.avail_out===0&&(lt.last_flush=-1),U;if($e===xe&&(Nt===1?g._tr_align(lt):Nt!==5&&(g._tr_stored_block(lt,0,0,!1),Nt===3&&(_t(lt.head),lt.lookahead===0&&(lt.strstart=0,lt.block_start=0,lt.insert=0))),Et(Ce),Ce.avail_out===0))return lt.last_flush=-1,U}return Nt!==F?U:lt.wrap<=0?1:(lt.wrap===2?(Zt(lt,255&Ce.adler),Zt(lt,Ce.adler>>8&255),Zt(lt,Ce.adler>>16&255),Zt(lt,Ce.adler>>24&255),Zt(lt,255&Ce.total_in),Zt(lt,Ce.total_in>>8&255),Zt(lt,Ce.total_in>>16&255),Zt(lt,Ce.total_in>>24&255)):(Ye(lt,Ce.adler>>>16),Ye(lt,65535&Ce.adler)),Et(Ce),lt.wrap>0&&(lt.wrap=-lt.wrap),lt.pending!==0?U:1)},deflate.deflateEnd=function(Ce){var Nt;return Ce&&Ce.state?(Nt=Ce.state.status)!==oe&&Nt!==69&&Nt!==73&&Nt!==91&&Nt!==de&&Nt!==me&&Nt!==ge?Oe(Ce,q):(Ce.state=null,Nt===me?Oe(Ce,-3):U):q},deflate.deflateSetDictionary=function(Ce,Nt){var Xe,lt,st,yt,Yt,$e,ze,ft,ht=Nt.length;if(!Ce||!Ce.state||(yt=(Xe=Ce.state).wrap)===2||yt===1&&Xe.status!==oe||Xe.lookahead)return q;for(yt===1&&(Ce.adler=w(Ce.adler,Nt,ht,0)),Xe.wrap=0,ht>=Xe.w_size&&(yt===0&&(_t(Xe.head),Xe.strstart=0,Xe.block_start=0,Xe.insert=0),ft=new m.Buf8(Xe.w_size),m.arraySet(ft,Nt,ht-Xe.w_size,Xe.w_size,0),Nt=ft,ht=Xe.w_size),Yt=Ce.avail_in,$e=Ce.next_in,ze=Ce.input,Ce.avail_in=ht,Ce.next_in=0,Ce.input=Nt,Qt(Xe);Xe.lookahead>=X;){lt=Xe.strstart,st=Xe.lookahead-(X-1);do Xe.ins_h=(Xe.ins_h<<Xe.hash_shift^Xe.window[lt+X-1])&Xe.hash_mask,Xe.prev[lt&Xe.w_mask]=Xe.head[Xe.ins_h],Xe.head[Xe.ins_h]=lt,lt++;while(--st);Xe.strstart=lt,Xe.lookahead=X-1,Qt(Xe)}return Xe.strstart+=Xe.lookahead,Xe.block_start=Xe.strstart,Xe.insert=Xe.lookahead,Xe.lookahead=0,Xe.match_length=Xe.prev_length=X-1,Xe.match_available=0,Ce.next_in=$e,Ce.input=ze,Ce.avail_in=Yt,Xe.wrap=yt,U},deflate.deflateInfo="pako deflate (from Nodeca project)",deflate}var strings={},hasRequiredStrings,zstream,hasRequiredZstream,hasRequiredDeflate;function requireStrings(){if(hasRequiredStrings)return strings;hasRequiredStrings=1;var d=requireCommon(),m=!0,g=!0;try{String.fromCharCode.apply(null,[0])}catch{m=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{g=!1}for(var w=new d.Buf8(256),$=0;$<256;$++)w[$]=$>=252?6:$>=248?5:$>=240?4:$>=224?3:$>=192?2:1;function I(D,F){if(F<65534&&(D.subarray&&g||!D.subarray&&m))return String.fromCharCode.apply(null,d.shrinkBuf(D,F));for(var U="",q=0;q<F;q++)U+=String.fromCharCode(D[q]);return U}return w[254]=w[254]=1,strings.string2buf=function(D){var F,U,q,j,G,H=D.length,V=0;for(j=0;j<H;j++)(64512&(U=D.charCodeAt(j)))==55296&&j+1<H&&(64512&(q=D.charCodeAt(j+1)))==56320&&(U=65536+(U-55296<<10)+(q-56320),j++),V+=U<128?1:U<2048?2:U<65536?3:4;for(F=new d.Buf8(V),G=0,j=0;G<V;j++)(64512&(U=D.charCodeAt(j)))==55296&&j+1<H&&(64512&(q=D.charCodeAt(j+1)))==56320&&(U=65536+(U-55296<<10)+(q-56320),j++),U<128?F[G++]=U:U<2048?(F[G++]=192|U>>>6,F[G++]=128|63&U):U<65536?(F[G++]=224|U>>>12,F[G++]=128|U>>>6&63,F[G++]=128|63&U):(F[G++]=240|U>>>18,F[G++]=128|U>>>12&63,F[G++]=128|U>>>6&63,F[G++]=128|63&U);return F},strings.buf2binstring=function(D){return I(D,D.length)},strings.binstring2buf=function(D){for(var F=new d.Buf8(D.length),U=0,q=F.length;U<q;U++)F[U]=D.charCodeAt(U);return F},strings.buf2string=function(D,F){var U,q,j,G,H=F||D.length,V=new Array(2*H);for(q=0,U=0;U<H;)if((j=D[U++])<128)V[q++]=j;else if((G=w[j])>4)V[q++]=65533,U+=G-1;else{for(j&=G===2?31:G===3?15:7;G>1&&U<H;)j=j<<6|63&D[U++],G--;G>1?V[q++]=65533:j<65536?V[q++]=j:(j-=65536,V[q++]=55296|j>>10&1023,V[q++]=56320|1023&j)}return I(V,q)},strings.utf8border=function(D,F){var U;for((F=F||D.length)>D.length&&(F=D.length),U=F-1;U>=0&&(192&D[U])==128;)U--;return U<0||U===0?F:U+w[D[U]]>F?U:F},strings}function requireZstream(){return hasRequiredZstream?zstream:(hasRequiredZstream=1,zstream=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0})}function requireDeflate(){if(hasRequiredDeflate)return deflate$1;hasRequiredDeflate=1;var d=requireDeflate$1(),m=requireCommon(),g=requireStrings(),w=requireMessages(),$=requireZstream(),I=Object.prototype.toString,D=0,F=-1,U=0,q=8;function j(H){if(!(this instanceof j))return new j(H);this.options=m.assign({level:F,method:q,chunkSize:16384,windowBits:15,memLevel:8,strategy:U,to:""},H||{});var V=this.options;V.raw&&V.windowBits>0?V.windowBits=-V.windowBits:V.gzip&&V.windowBits>0&&V.windowBits<16&&(V.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $,this.strm.avail_out=0;var Z=d.deflateInit2(this.strm,V.level,V.method,V.windowBits,V.memLevel,V.strategy);if(Z!==D)throw new Error(w[Z]);if(V.header&&d.deflateSetHeader(this.strm,V.header),V.dictionary){var Q;if(Q=typeof V.dictionary=="string"?g.string2buf(V.dictionary):I.call(V.dictionary)==="[object ArrayBuffer]"?new Uint8Array(V.dictionary):V.dictionary,(Z=d.deflateSetDictionary(this.strm,Q))!==D)throw new Error(w[Z]);this._dict_set=!0}}function G(H,V){var Z=new j(V);if(Z.push(H,!0),Z.err)throw Z.msg||w[Z.err];return Z.result}return j.prototype.push=function(H,V){var Z,Q,J=this.strm,ie=this.options.chunkSize;if(this.ended)return!1;Q=V===~~V?V:V===!0?4:0,typeof H=="string"?J.input=g.string2buf(H):I.call(H)==="[object ArrayBuffer]"?J.input=new Uint8Array(H):J.input=H,J.next_in=0,J.avail_in=J.input.length;do{if(J.avail_out===0&&(J.output=new m.Buf8(ie),J.next_out=0,J.avail_out=ie),(Z=d.deflate(J,Q))!==1&&Z!==D)return this.onEnd(Z),this.ended=!0,!1;J.avail_out!==0&&(J.avail_in!==0||Q!==4&&Q!==2)||(this.options.to==="string"?this.onData(g.buf2binstring(m.shrinkBuf(J.output,J.next_out))):this.onData(m.shrinkBuf(J.output,J.next_out)))}while((J.avail_in>0||J.avail_out===0)&&Z!==1);return Q===4?(Z=d.deflateEnd(this.strm),this.onEnd(Z),this.ended=!0,Z===D):Q!==2||(this.onEnd(D),J.avail_out=0,!0)},j.prototype.onData=function(H){this.chunks.push(H)},j.prototype.onEnd=function(H){H===D&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=m.flattenChunks(this.chunks)),this.chunks=[],this.err=H,this.msg=this.strm.msg},deflate$1.Deflate=j,deflate$1.deflate=G,deflate$1.deflateRaw=function(H,V){return(V=V||{}).raw=!0,G(H,V)},deflate$1.gzip=function(H,V){return(V=V||{}).gzip=!0,G(H,V)},deflate$1}var inflate$1={},inflate={},inffast,hasRequiredInffast,inftrees,hasRequiredInftrees,hasRequiredInflate$1,constants,hasRequiredConstants,gzheader,hasRequiredGzheader,hasRequiredInflate,pako_1,hasRequiredPako;function requireInffast(){return hasRequiredInffast?inffast:(hasRequiredInffast=1,inffast=function(d,m){var g,w,$,I,D,F,U,q,j,G,H,V,Z,Q,J,ie,re,se,X,ne,ce,oe,de,me,ge;g=d.state,w=d.next_in,me=d.input,$=w+(d.avail_in-5),I=d.next_out,ge=d.output,D=I-(m-d.avail_out),F=I+(d.avail_out-257),U=g.dmax,q=g.wsize,j=g.whave,G=g.wnext,H=g.window,V=g.hold,Z=g.bits,Q=g.lencode,J=g.distcode,ie=(1<<g.lenbits)-1,re=(1<<g.distbits)-1;e:do{Z<15&&(V+=me[w++]<<Z,Z+=8,V+=me[w++]<<Z,Z+=8),se=Q[V&ie];t:for(;;){if(V>>>=X=se>>>24,Z-=X,(X=se>>>16&255)===0)ge[I++]=65535&se;else{if(!(16&X)){if(64&X){if(32&X){g.mode=12;break e}d.msg="invalid literal/length code",g.mode=30;break e}se=Q[(65535&se)+(V&(1<<X)-1)];continue t}for(ne=65535&se,(X&=15)&&(Z<X&&(V+=me[w++]<<Z,Z+=8),ne+=V&(1<<X)-1,V>>>=X,Z-=X),Z<15&&(V+=me[w++]<<Z,Z+=8,V+=me[w++]<<Z,Z+=8),se=J[V&re];;){if(V>>>=X=se>>>24,Z-=X,16&(X=se>>>16&255)){if(ce=65535&se,Z<(X&=15)&&(V+=me[w++]<<Z,(Z+=8)<X&&(V+=me[w++]<<Z,Z+=8)),(ce+=V&(1<<X)-1)>U){d.msg="invalid distance too far back",g.mode=30;break e}if(V>>>=X,Z-=X,ce>(X=I-D)){if((X=ce-X)>j&&g.sane){d.msg="invalid distance too far back",g.mode=30;break e}if(oe=0,de=H,G===0){if(oe+=q-X,X<ne){ne-=X;do ge[I++]=H[oe++];while(--X);oe=I-ce,de=ge}}else if(G<X){if(oe+=q+G-X,(X-=G)<ne){ne-=X;do ge[I++]=H[oe++];while(--X);if(oe=0,G<ne){ne-=X=G;do ge[I++]=H[oe++];while(--X);oe=I-ce,de=ge}}}else if(oe+=G-X,X<ne){ne-=X;do ge[I++]=H[oe++];while(--X);oe=I-ce,de=ge}for(;ne>2;)ge[I++]=de[oe++],ge[I++]=de[oe++],ge[I++]=de[oe++],ne-=3;ne&&(ge[I++]=de[oe++],ne>1&&(ge[I++]=de[oe++]))}else{oe=I-ce;do ge[I++]=ge[oe++],ge[I++]=ge[oe++],ge[I++]=ge[oe++],ne-=3;while(ne>2);ne&&(ge[I++]=ge[oe++],ne>1&&(ge[I++]=ge[oe++]))}break}if(64&X){d.msg="invalid distance code",g.mode=30;break e}se=J[(65535&se)+(V&(1<<X)-1)]}}break}}while(w<$&&I<F);w-=ne=Z>>3,V&=(1<<(Z-=ne<<3))-1,d.next_in=w,d.next_out=I,d.avail_in=w<$?$-w+5:5-(w-$),d.avail_out=I<F?F-I+257:257-(I-F),g.hold=V,g.bits=Z},inffast)}function requireInftrees(){if(hasRequiredInftrees)return inftrees;hasRequiredInftrees=1;var d=requireCommon(),m=15,g=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],w=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],$=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],I=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return inftrees=function(D,F,U,q,j,G,H,V){var Z,Q,J,ie,re,se,X,ne,ce,oe=V.bits,de=0,me=0,ge=0,fe=0,xe=0,Fe=0,Te=0,Oe=0,Be=0,_t=0,Et=null,dt=0,Zt=new d.Buf16(16),Ye=new d.Buf16(16),bt=null,Qt=0;for(de=0;de<=m;de++)Zt[de]=0;for(me=0;me<q;me++)Zt[F[U+me]]++;for(xe=oe,fe=m;fe>=1&&Zt[fe]===0;fe--);if(xe>fe&&(xe=fe),fe===0)return j[G++]=20971520,j[G++]=20971520,V.bits=1,0;for(ge=1;ge<fe&&Zt[ge]===0;ge++);for(xe<ge&&(xe=ge),Oe=1,de=1;de<=m;de++)if(Oe<<=1,(Oe-=Zt[de])<0)return-1;if(Oe>0&&(D===0||fe!==1))return-1;for(Ye[1]=0,de=1;de<m;de++)Ye[de+1]=Ye[de]+Zt[de];for(me=0;me<q;me++)F[U+me]!==0&&(H[Ye[F[U+me]]++]=me);if(D===0?(Et=bt=H,se=19):D===1?(Et=g,dt-=257,bt=w,Qt-=257,se=256):(Et=$,bt=I,se=-1),_t=0,me=0,de=ge,re=G,Fe=xe,Te=0,J=-1,ie=(Be=1<<xe)-1,D===1&&Be>852||D===2&&Be>592)return 1;for(;;){X=de-Te,H[me]<se?(ne=0,ce=H[me]):H[me]>se?(ne=bt[Qt+H[me]],ce=Et[dt+H[me]]):(ne=96,ce=0),Z=1<<de-Te,ge=Q=1<<Fe;do j[re+(_t>>Te)+(Q-=Z)]=X<<24|ne<<16|ce;while(Q!==0);for(Z=1<<de-1;_t&Z;)Z>>=1;if(Z!==0?(_t&=Z-1,_t+=Z):_t=0,me++,--Zt[de]==0){if(de===fe)break;de=F[U+H[me]]}if(de>xe&&(_t&ie)!==J){for(Te===0&&(Te=xe),re+=ge,Oe=1<<(Fe=de-Te);Fe+Te<fe&&!((Oe-=Zt[Fe+Te])<=0);)Fe++,Oe<<=1;if(Be+=1<<Fe,D===1&&Be>852||D===2&&Be>592)return 1;j[J=_t&ie]=xe<<24|Fe<<16|re-G}}return _t!==0&&(j[re+_t]=de-Te<<24|64<<16),V.bits=xe,0}}function requireInflate$1(){if(hasRequiredInflate$1)return inflate;hasRequiredInflate$1=1;var d=requireCommon(),m=requireAdler32(),g=requireCrc32(),w=requireInffast(),$=requireInftrees(),I=1,D=2,F=0,U=-2,q=1,j=12,G=30,H=852,V=592;function Z(me){return(me>>>24&255)+(me>>>8&65280)+((65280&me)<<8)+((255&me)<<24)}function Q(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function J(me){var ge;return me&&me.state?(ge=me.state,me.total_in=me.total_out=ge.total=0,me.msg="",ge.wrap&&(me.adler=1&ge.wrap),ge.mode=q,ge.last=0,ge.havedict=0,ge.dmax=32768,ge.head=null,ge.hold=0,ge.bits=0,ge.lencode=ge.lendyn=new d.Buf32(H),ge.distcode=ge.distdyn=new d.Buf32(V),ge.sane=1,ge.back=-1,F):U}function ie(me){var ge;return me&&me.state?((ge=me.state).wsize=0,ge.whave=0,ge.wnext=0,J(me)):U}function re(me,ge){var fe,xe;return me&&me.state?(xe=me.state,ge<0?(fe=0,ge=-ge):(fe=1+(ge>>4),ge<48&&(ge&=15)),ge&&(ge<8||ge>15)?U:(xe.window!==null&&xe.wbits!==ge&&(xe.window=null),xe.wrap=fe,xe.wbits=ge,ie(me))):U}function se(me,ge){var fe,xe;return me?(xe=new Q,me.state=xe,xe.window=null,(fe=re(me,ge))!==F&&(me.state=null),fe):U}var X,ne,ce=!0;function oe(me){if(ce){var ge;for(X=new d.Buf32(512),ne=new d.Buf32(32),ge=0;ge<144;)me.lens[ge++]=8;for(;ge<256;)me.lens[ge++]=9;for(;ge<280;)me.lens[ge++]=7;for(;ge<288;)me.lens[ge++]=8;for($(I,me.lens,0,288,X,0,me.work,{bits:9}),ge=0;ge<32;)me.lens[ge++]=5;$(D,me.lens,0,32,ne,0,me.work,{bits:5}),ce=!1}me.lencode=X,me.lenbits=9,me.distcode=ne,me.distbits=5}function de(me,ge,fe,xe){var Fe,Te=me.state;return Te.window===null&&(Te.wsize=1<<Te.wbits,Te.wnext=0,Te.whave=0,Te.window=new d.Buf8(Te.wsize)),xe>=Te.wsize?(d.arraySet(Te.window,ge,fe-Te.wsize,Te.wsize,0),Te.wnext=0,Te.whave=Te.wsize):((Fe=Te.wsize-Te.wnext)>xe&&(Fe=xe),d.arraySet(Te.window,ge,fe-xe,Fe,Te.wnext),(xe-=Fe)?(d.arraySet(Te.window,ge,fe-xe,xe,0),Te.wnext=xe,Te.whave=Te.wsize):(Te.wnext+=Fe,Te.wnext===Te.wsize&&(Te.wnext=0),Te.whave<Te.wsize&&(Te.whave+=Fe))),0}return inflate.inflateReset=ie,inflate.inflateReset2=re,inflate.inflateResetKeep=J,inflate.inflateInit=function(me){return se(me,15)},inflate.inflateInit2=se,inflate.inflate=function(me,ge){var fe,xe,Fe,Te,Oe,Be,_t,Et,dt,Zt,Ye,bt,Qt,Vt,ut,At,dr,fr,pr,zt,Ce,Nt,Xe,lt,st=0,yt=new d.Buf8(4),Yt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!me||!me.state||!me.output||!me.input&&me.avail_in!==0)return U;(fe=me.state).mode===j&&(fe.mode=13),Oe=me.next_out,Fe=me.output,_t=me.avail_out,Te=me.next_in,xe=me.input,Be=me.avail_in,Et=fe.hold,dt=fe.bits,Zt=Be,Ye=_t,Nt=F;e:for(;;)switch(fe.mode){case q:if(fe.wrap===0){fe.mode=13;break}for(;dt<16;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}if(2&fe.wrap&&Et===35615){fe.check=0,yt[0]=255&Et,yt[1]=Et>>>8&255,fe.check=g(fe.check,yt,2,0),Et=0,dt=0,fe.mode=2;break}if(fe.flags=0,fe.head&&(fe.head.done=!1),!(1&fe.wrap)||(((255&Et)<<8)+(Et>>8))%31){me.msg="incorrect header check",fe.mode=G;break}if((15&Et)!=8){me.msg="unknown compression method",fe.mode=G;break}if(dt-=4,Ce=8+(15&(Et>>>=4)),fe.wbits===0)fe.wbits=Ce;else if(Ce>fe.wbits){me.msg="invalid window size",fe.mode=G;break}fe.dmax=1<<Ce,me.adler=fe.check=1,fe.mode=512&Et?10:j,Et=0,dt=0;break;case 2:for(;dt<16;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}if(fe.flags=Et,(255&fe.flags)!=8){me.msg="unknown compression method",fe.mode=G;break}if(57344&fe.flags){me.msg="unknown header flags set",fe.mode=G;break}fe.head&&(fe.head.text=Et>>8&1),512&fe.flags&&(yt[0]=255&Et,yt[1]=Et>>>8&255,fe.check=g(fe.check,yt,2,0)),Et=0,dt=0,fe.mode=3;case 3:for(;dt<32;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}fe.head&&(fe.head.time=Et),512&fe.flags&&(yt[0]=255&Et,yt[1]=Et>>>8&255,yt[2]=Et>>>16&255,yt[3]=Et>>>24&255,fe.check=g(fe.check,yt,4,0)),Et=0,dt=0,fe.mode=4;case 4:for(;dt<16;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}fe.head&&(fe.head.xflags=255&Et,fe.head.os=Et>>8),512&fe.flags&&(yt[0]=255&Et,yt[1]=Et>>>8&255,fe.check=g(fe.check,yt,2,0)),Et=0,dt=0,fe.mode=5;case 5:if(1024&fe.flags){for(;dt<16;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}fe.length=Et,fe.head&&(fe.head.extra_len=Et),512&fe.flags&&(yt[0]=255&Et,yt[1]=Et>>>8&255,fe.check=g(fe.check,yt,2,0)),Et=0,dt=0}else fe.head&&(fe.head.extra=null);fe.mode=6;case 6:if(1024&fe.flags&&((bt=fe.length)>Be&&(bt=Be),bt&&(fe.head&&(Ce=fe.head.extra_len-fe.length,fe.head.extra||(fe.head.extra=new Array(fe.head.extra_len)),d.arraySet(fe.head.extra,xe,Te,bt,Ce)),512&fe.flags&&(fe.check=g(fe.check,xe,bt,Te)),Be-=bt,Te+=bt,fe.length-=bt),fe.length))break e;fe.length=0,fe.mode=7;case 7:if(2048&fe.flags){if(Be===0)break e;bt=0;do Ce=xe[Te+bt++],fe.head&&Ce&&fe.length<65536&&(fe.head.name+=String.fromCharCode(Ce));while(Ce&&bt<Be);if(512&fe.flags&&(fe.check=g(fe.check,xe,bt,Te)),Be-=bt,Te+=bt,Ce)break e}else fe.head&&(fe.head.name=null);fe.length=0,fe.mode=8;case 8:if(4096&fe.flags){if(Be===0)break e;bt=0;do Ce=xe[Te+bt++],fe.head&&Ce&&fe.length<65536&&(fe.head.comment+=String.fromCharCode(Ce));while(Ce&&bt<Be);if(512&fe.flags&&(fe.check=g(fe.check,xe,bt,Te)),Be-=bt,Te+=bt,Ce)break e}else fe.head&&(fe.head.comment=null);fe.mode=9;case 9:if(512&fe.flags){for(;dt<16;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}if(Et!==(65535&fe.check)){me.msg="header crc mismatch",fe.mode=G;break}Et=0,dt=0}fe.head&&(fe.head.hcrc=fe.flags>>9&1,fe.head.done=!0),me.adler=fe.check=0,fe.mode=j;break;case 10:for(;dt<32;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}me.adler=fe.check=Z(Et),Et=0,dt=0,fe.mode=11;case 11:if(fe.havedict===0)return me.next_out=Oe,me.avail_out=_t,me.next_in=Te,me.avail_in=Be,fe.hold=Et,fe.bits=dt,2;me.adler=fe.check=1,fe.mode=j;case j:if(ge===5||ge===6)break e;case 13:if(fe.last){Et>>>=7&dt,dt-=7&dt,fe.mode=27;break}for(;dt<3;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}switch(fe.last=1&Et,dt-=1,3&(Et>>>=1)){case 0:fe.mode=14;break;case 1:if(oe(fe),fe.mode=20,ge===6){Et>>>=2,dt-=2;break e}break;case 2:fe.mode=17;break;case 3:me.msg="invalid block type",fe.mode=G}Et>>>=2,dt-=2;break;case 14:for(Et>>>=7&dt,dt-=7&dt;dt<32;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}if((65535&Et)!=(Et>>>16^65535)){me.msg="invalid stored block lengths",fe.mode=G;break}if(fe.length=65535&Et,Et=0,dt=0,fe.mode=15,ge===6)break e;case 15:fe.mode=16;case 16:if(bt=fe.length){if(bt>Be&&(bt=Be),bt>_t&&(bt=_t),bt===0)break e;d.arraySet(Fe,xe,Te,bt,Oe),Be-=bt,Te+=bt,_t-=bt,Oe+=bt,fe.length-=bt;break}fe.mode=j;break;case 17:for(;dt<14;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}if(fe.nlen=257+(31&Et),Et>>>=5,dt-=5,fe.ndist=1+(31&Et),Et>>>=5,dt-=5,fe.ncode=4+(15&Et),Et>>>=4,dt-=4,fe.nlen>286||fe.ndist>30){me.msg="too many length or distance symbols",fe.mode=G;break}fe.have=0,fe.mode=18;case 18:for(;fe.have<fe.ncode;){for(;dt<3;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}fe.lens[Yt[fe.have++]]=7&Et,Et>>>=3,dt-=3}for(;fe.have<19;)fe.lens[Yt[fe.have++]]=0;if(fe.lencode=fe.lendyn,fe.lenbits=7,Xe={bits:fe.lenbits},Nt=$(0,fe.lens,0,19,fe.lencode,0,fe.work,Xe),fe.lenbits=Xe.bits,Nt){me.msg="invalid code lengths set",fe.mode=G;break}fe.have=0,fe.mode=19;case 19:for(;fe.have<fe.nlen+fe.ndist;){for(;At=(st=fe.lencode[Et&(1<<fe.lenbits)-1])>>>16&255,dr=65535&st,!((ut=st>>>24)<=dt);){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}if(dr<16)Et>>>=ut,dt-=ut,fe.lens[fe.have++]=dr;else{if(dr===16){for(lt=ut+2;dt<lt;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}if(Et>>>=ut,dt-=ut,fe.have===0){me.msg="invalid bit length repeat",fe.mode=G;break}Ce=fe.lens[fe.have-1],bt=3+(3&Et),Et>>>=2,dt-=2}else if(dr===17){for(lt=ut+3;dt<lt;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}dt-=ut,Ce=0,bt=3+(7&(Et>>>=ut)),Et>>>=3,dt-=3}else{for(lt=ut+7;dt<lt;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}dt-=ut,Ce=0,bt=11+(127&(Et>>>=ut)),Et>>>=7,dt-=7}if(fe.have+bt>fe.nlen+fe.ndist){me.msg="invalid bit length repeat",fe.mode=G;break}for(;bt--;)fe.lens[fe.have++]=Ce}}if(fe.mode===G)break;if(fe.lens[256]===0){me.msg="invalid code -- missing end-of-block",fe.mode=G;break}if(fe.lenbits=9,Xe={bits:fe.lenbits},Nt=$(I,fe.lens,0,fe.nlen,fe.lencode,0,fe.work,Xe),fe.lenbits=Xe.bits,Nt){me.msg="invalid literal/lengths set",fe.mode=G;break}if(fe.distbits=6,fe.distcode=fe.distdyn,Xe={bits:fe.distbits},Nt=$(D,fe.lens,fe.nlen,fe.ndist,fe.distcode,0,fe.work,Xe),fe.distbits=Xe.bits,Nt){me.msg="invalid distances set",fe.mode=G;break}if(fe.mode=20,ge===6)break e;case 20:fe.mode=21;case 21:if(Be>=6&&_t>=258){me.next_out=Oe,me.avail_out=_t,me.next_in=Te,me.avail_in=Be,fe.hold=Et,fe.bits=dt,w(me,Ye),Oe=me.next_out,Fe=me.output,_t=me.avail_out,Te=me.next_in,xe=me.input,Be=me.avail_in,Et=fe.hold,dt=fe.bits,fe.mode===j&&(fe.back=-1);break}for(fe.back=0;At=(st=fe.lencode[Et&(1<<fe.lenbits)-1])>>>16&255,dr=65535&st,!((ut=st>>>24)<=dt);){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}if(At&&!(240&At)){for(fr=ut,pr=At,zt=dr;At=(st=fe.lencode[zt+((Et&(1<<fr+pr)-1)>>fr)])>>>16&255,dr=65535&st,!(fr+(ut=st>>>24)<=dt);){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}Et>>>=fr,dt-=fr,fe.back+=fr}if(Et>>>=ut,dt-=ut,fe.back+=ut,fe.length=dr,At===0){fe.mode=26;break}if(32&At){fe.back=-1,fe.mode=j;break}if(64&At){me.msg="invalid literal/length code",fe.mode=G;break}fe.extra=15&At,fe.mode=22;case 22:if(fe.extra){for(lt=fe.extra;dt<lt;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}fe.length+=Et&(1<<fe.extra)-1,Et>>>=fe.extra,dt-=fe.extra,fe.back+=fe.extra}fe.was=fe.length,fe.mode=23;case 23:for(;At=(st=fe.distcode[Et&(1<<fe.distbits)-1])>>>16&255,dr=65535&st,!((ut=st>>>24)<=dt);){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}if(!(240&At)){for(fr=ut,pr=At,zt=dr;At=(st=fe.distcode[zt+((Et&(1<<fr+pr)-1)>>fr)])>>>16&255,dr=65535&st,!(fr+(ut=st>>>24)<=dt);){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}Et>>>=fr,dt-=fr,fe.back+=fr}if(Et>>>=ut,dt-=ut,fe.back+=ut,64&At){me.msg="invalid distance code",fe.mode=G;break}fe.offset=dr,fe.extra=15&At,fe.mode=24;case 24:if(fe.extra){for(lt=fe.extra;dt<lt;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}fe.offset+=Et&(1<<fe.extra)-1,Et>>>=fe.extra,dt-=fe.extra,fe.back+=fe.extra}if(fe.offset>fe.dmax){me.msg="invalid distance too far back",fe.mode=G;break}fe.mode=25;case 25:if(_t===0)break e;if(bt=Ye-_t,fe.offset>bt){if((bt=fe.offset-bt)>fe.whave&&fe.sane){me.msg="invalid distance too far back",fe.mode=G;break}bt>fe.wnext?(bt-=fe.wnext,Qt=fe.wsize-bt):Qt=fe.wnext-bt,bt>fe.length&&(bt=fe.length),Vt=fe.window}else Vt=Fe,Qt=Oe-fe.offset,bt=fe.length;bt>_t&&(bt=_t),_t-=bt,fe.length-=bt;do Fe[Oe++]=Vt[Qt++];while(--bt);fe.length===0&&(fe.mode=21);break;case 26:if(_t===0)break e;Fe[Oe++]=fe.length,_t--,fe.mode=21;break;case 27:if(fe.wrap){for(;dt<32;){if(Be===0)break e;Be--,Et|=xe[Te++]<<dt,dt+=8}if(Ye-=_t,me.total_out+=Ye,fe.total+=Ye,Ye&&(me.adler=fe.check=fe.flags?g(fe.check,Fe,Ye,Oe-Ye):m(fe.check,Fe,Ye,Oe-Ye)),Ye=_t,(fe.flags?Et:Z(Et))!==fe.check){me.msg="incorrect data check",fe.mode=G;break}Et=0,dt=0}fe.mode=28;case 28:if(fe.wrap&&fe.flags){for(;dt<32;){if(Be===0)break e;Be--,Et+=xe[Te++]<<dt,dt+=8}if(Et!==(4294967295&fe.total)){me.msg="incorrect length check",fe.mode=G;break}Et=0,dt=0}fe.mode=29;case 29:Nt=1;break e;case G:Nt=-3;break e;case 31:return-4;default:return U}return me.next_out=Oe,me.avail_out=_t,me.next_in=Te,me.avail_in=Be,fe.hold=Et,fe.bits=dt,(fe.wsize||Ye!==me.avail_out&&fe.mode<G&&(fe.mode<27||ge!==4))&&de(me,me.output,me.next_out,Ye-me.avail_out),Zt-=me.avail_in,Ye-=me.avail_out,me.total_in+=Zt,me.total_out+=Ye,fe.total+=Ye,fe.wrap&&Ye&&(me.adler=fe.check=fe.flags?g(fe.check,Fe,Ye,me.next_out-Ye):m(fe.check,Fe,Ye,me.next_out-Ye)),me.data_type=fe.bits+(fe.last?64:0)+(fe.mode===j?128:0)+(fe.mode===20||fe.mode===15?256:0),(Zt===0&&Ye===0||ge===4)&&Nt===F&&(Nt=-5),Nt},inflate.inflateEnd=function(me){if(!me||!me.state)return U;var ge=me.state;return ge.window&&(ge.window=null),me.state=null,F},inflate.inflateGetHeader=function(me,ge){var fe;return me&&me.state&&2&(fe=me.state).wrap?(fe.head=ge,ge.done=!1,F):U},inflate.inflateSetDictionary=function(me,ge){var fe,xe=ge.length;return me&&me.state?(fe=me.state).wrap!==0&&fe.mode!==11?U:fe.mode===11&&m(1,ge,xe,0)!==fe.check?-3:de(me,ge,xe,xe)?(fe.mode=31,-4):(fe.havedict=1,F):U},inflate.inflateInfo="pako inflate (from Nodeca project)",inflate}function requireConstants(){return hasRequiredConstants?constants:(hasRequiredConstants=1,constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8})}function requireGzheader(){return hasRequiredGzheader?gzheader:(hasRequiredGzheader=1,gzheader=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1})}function requireInflate(){if(hasRequiredInflate)return inflate$1;hasRequiredInflate=1;var d=requireInflate$1(),m=requireCommon(),g=requireStrings(),w=requireConstants(),$=requireMessages(),I=requireZstream(),D=requireGzheader(),F=Object.prototype.toString;function U(j){if(!(this instanceof U))return new U(j);this.options=m.assign({chunkSize:16384,windowBits:0,to:""},j||{});var G=this.options;G.raw&&G.windowBits>=0&&G.windowBits<16&&(G.windowBits=-G.windowBits,G.windowBits===0&&(G.windowBits=-15)),!(G.windowBits>=0&&G.windowBits<16)||j&&j.windowBits||(G.windowBits+=32),G.windowBits>15&&G.windowBits<48&&(15&G.windowBits||(G.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new I,this.strm.avail_out=0;var H=d.inflateInit2(this.strm,G.windowBits);if(H!==w.Z_OK)throw new Error($[H]);if(this.header=new D,d.inflateGetHeader(this.strm,this.header),G.dictionary&&(typeof G.dictionary=="string"?G.dictionary=g.string2buf(G.dictionary):F.call(G.dictionary)==="[object ArrayBuffer]"&&(G.dictionary=new Uint8Array(G.dictionary)),G.raw&&(H=d.inflateSetDictionary(this.strm,G.dictionary))!==w.Z_OK))throw new Error($[H])}function q(j,G){var H=new U(G);if(H.push(j,!0),H.err)throw H.msg||$[H.err];return H.result}return U.prototype.push=function(j,G){var H,V,Z,Q,J,ie=this.strm,re=this.options.chunkSize,se=this.options.dictionary,X=!1;if(this.ended)return!1;V=G===~~G?G:G===!0?w.Z_FINISH:w.Z_NO_FLUSH,typeof j=="string"?ie.input=g.binstring2buf(j):F.call(j)==="[object ArrayBuffer]"?ie.input=new Uint8Array(j):ie.input=j,ie.next_in=0,ie.avail_in=ie.input.length;do{if(ie.avail_out===0&&(ie.output=new m.Buf8(re),ie.next_out=0,ie.avail_out=re),(H=d.inflate(ie,w.Z_NO_FLUSH))===w.Z_NEED_DICT&&se&&(H=d.inflateSetDictionary(this.strm,se)),H===w.Z_BUF_ERROR&&X===!0&&(H=w.Z_OK,X=!1),H!==w.Z_STREAM_END&&H!==w.Z_OK)return this.onEnd(H),this.ended=!0,!1;ie.next_out&&(ie.avail_out!==0&&H!==w.Z_STREAM_END&&(ie.avail_in!==0||V!==w.Z_FINISH&&V!==w.Z_SYNC_FLUSH)||(this.options.to==="string"?(Z=g.utf8border(ie.output,ie.next_out),Q=ie.next_out-Z,J=g.buf2string(ie.output,Z),ie.next_out=Q,ie.avail_out=re-Q,Q&&m.arraySet(ie.output,ie.output,Z,Q,0),this.onData(J)):this.onData(m.shrinkBuf(ie.output,ie.next_out)))),ie.avail_in===0&&ie.avail_out===0&&(X=!0)}while((ie.avail_in>0||ie.avail_out===0)&&H!==w.Z_STREAM_END);return H===w.Z_STREAM_END&&(V=w.Z_FINISH),V===w.Z_FINISH?(H=d.inflateEnd(this.strm),this.onEnd(H),this.ended=!0,H===w.Z_OK):V!==w.Z_SYNC_FLUSH||(this.onEnd(w.Z_OK),ie.avail_out=0,!0)},U.prototype.onData=function(j){this.chunks.push(j)},U.prototype.onEnd=function(j){j===w.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=m.flattenChunks(this.chunks)),this.chunks=[],this.err=j,this.msg=this.strm.msg},inflate$1.Inflate=U,inflate$1.inflate=q,inflate$1.inflateRaw=function(j,G){return(G=G||{}).raw=!0,q(j,G)},inflate$1.ungzip=q,inflate$1}function requirePako(){if(hasRequiredPako)return pako_1;hasRequiredPako=1;var d={};return(0,requireCommon().assign)(d,requireDeflate(),requireInflate(),requireConstants()),pako_1=d}(function(d){(function(){var m={};function g(){typeof process<"u"||console.log.apply(console,arguments)}d.exports=m,(function(w,$){(function(){var I=(function(){function U(q){this.message="JPEG error: "+q}return U.prototype=new Error,U.prototype.name="JpegError",U.constructor=U,U})(),D=(function(){var U=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),q=4017,j=799,G=3406,H=2276,V=1567,Z=3784,Q=5793,J=2896;function ie(de){de==null&&(de={}),de.w==null&&(de.w=-1),this.V=de.n,this.N=de.w}function re(de,me){for(var ge,fe,xe,Fe=0,Te=[],Oe=16;Oe>0&&!de[Oe-1];)Oe--;Te.push({children:[],index:0});var Be=Te[0];for(ge=0;ge<Oe;ge++){for(fe=0;fe<de[ge];fe++){for((Be=Te.pop()).children[Be.index]=me[Fe];Be.index>0;)Be=Te.pop();for(Be.index++,Te.push(Be);Te.length<=ge;)Te.push(xe={children:[],index:0}),Be.children[Be.index]=xe.children,Be=xe;Fe++}ge+1<Oe&&(Te.push(xe={children:[],index:0}),Be.children[Be.index]=xe.children,Be=xe)}return Te[0].children}function se(de,me,ge){return 64*((de.P+1)*me+ge)}function X(de,me,ge,fe,xe,Fe,Te,Oe,Be,_t){_t==null&&(_t=!1);var Et,dt,Zt,Ye,bt,Qt,Vt,ut,At,dr,fr,pr=ge.m,zt=ge.Z,Ce=me,Nt=0,Xe=0,lt=0,st=0,yt=0,Yt=0;function $e(){if(Xe>0)return Xe--,Nt>>Xe&1;if((Nt=de[me++])===255){var ai=de[me++];if(ai){if(ai===220&&_t){var hi=F(de,me+=2);if(me+=2,hi>0&&hi!==ge.s)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",hi)}else if(ai===217){if(_t){var ui=8*yt;if(ui>0&&ui<ge.s/10)throw new DNLMarkerError("Found EOI marker (0xFFD9) while parsing scan data, possibly caused by incorrect `scanLines` parameter",ui)}throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data")}throw new I("unexpected marker")}}return Xe=7,Nt>>>7}function ze(ai){for(var hi=ai;;){switch(typeof(hi=hi[$e()])){case"number":return hi;case"object":continue}throw new I("invalid huffman sequence")}}function ft(ai){for(var hi=0;ai>0;)hi=hi<<1|$e(),ai--;return hi}function ht(ai){if(ai===1)return $e()===1?1:-1;var hi=ft(ai);return hi>=1<<ai-1?hi:hi+(-1<<ai)+1}function gr(ai,hi,ui,vi,bi){var _i=ui%pr;yt=(ui/pr|0)*ai.A+vi;var ki=_i*ai.h+bi;hi(ai,se(ai,yt,ki))}function yr(ai,hi,ui){yt=ui/ai.P|0;var vi=ui%ai.P;hi(ai,se(ai,yt,vi))}var li=fe.length;for(Vt=zt?Fe===0?Oe===0?function(ai,hi){var ui=ze(ai.J),vi=ui===0?0:ht(ui)<<Be;ai.D[hi]=ai.Q+=vi}:function(ai,hi){ai.D[hi]|=$e()<<Be}:Oe===0?function(ai,hi){if(lt>0)lt--;else for(var ui=Fe,vi=Te;ui<=vi;){var bi=ze(ai.i),_i=15&bi,ki=bi>>4;if(_i!==0){var yi=U[ui+=ki];ai.D[hi+yi]=ht(_i)*(1<<Be),ui++}else{if(ki<15){lt=ft(ki)+(1<<ki)-1;break}ui+=16}}}:function(ai,hi){for(var ui,vi,bi=Fe,_i=Te,ki=0;bi<=_i;){var yi=hi+U[bi],cr=ai.D[yi]<0?-1:1;switch(st){case 0:if(ki=(vi=ze(ai.i))>>4,(ui=15&vi)==0)ki<15?(lt=ft(ki)+(1<<ki),st=4):(ki=16,st=1);else{if(ui!==1)throw new I("invalid ACn encoding");Et=ht(ui),st=ki?2:3}continue;case 1:case 2:ai.D[yi]?ai.D[yi]+=cr*($e()<<Be):--ki==0&&(st=st===2?3:0);break;case 3:ai.D[yi]?ai.D[yi]+=cr*($e()<<Be):(ai.D[yi]=Et<<Be,st=0);break;case 4:ai.D[yi]&&(ai.D[yi]+=cr*($e()<<Be))}bi++}st===4&&--lt==0&&(st=0)}:function(ai,hi){var ui=ze(ai.J),vi=ui===0?0:ht(ui),bi=1;for(ai.D[hi]=ai.Q+=vi;bi<64;){var _i=ze(ai.i),ki=15&_i,yi=_i>>4;if(ki!==0){var cr=U[bi+=yi];ai.D[hi+cr]=ht(ki),bi++}else{if(yi<15)break;bi+=16}}},At=li===1?fe[0].P*fe[0].c:pr*ge.R;Yt<=At;){var fi=xe?Math.min(At-Yt,xe):At;if(fi>0){for(Zt=0;Zt<li;Zt++)fe[Zt].Q=0;if(lt=0,li===1)for(dt=fe[0],Qt=0;Qt<fi;Qt++)yr(dt,Vt,Yt),Yt++;else for(Qt=0;Qt<fi;Qt++){for(Zt=0;Zt<li;Zt++)for(dr=(dt=fe[Zt]).h,fr=dt.A,Ye=0;Ye<fr;Ye++)for(bt=0;bt<dr;bt++)gr(dt,Vt,Yt,Ye,bt);Yt++}}if(Xe=0,!(ut=oe(de,me))||(ut.u&&(me=ut.offset),!(ut.M>=65488&&ut.M<=65495)))break;me+=2}return me-Ce}function ne(de,me,ge){var fe,xe,Fe,Te,Oe,Be,_t,Et,dt,Zt,Ye,bt,Qt,Vt,ut,At,dr,fr=de.$,pr=de.D;if(!fr)throw new I("missing required Quantization Table.");for(var zt=0;zt<64;zt+=8)dt=pr[me+zt],Zt=pr[me+zt+1],Ye=pr[me+zt+2],bt=pr[me+zt+3],Qt=pr[me+zt+4],Vt=pr[me+zt+5],ut=pr[me+zt+6],At=pr[me+zt+7],dt*=fr[zt],Zt|Ye|bt|Qt|Vt|ut|At?(Zt*=fr[zt+1],Ye*=fr[zt+2],bt*=fr[zt+3],Qt*=fr[zt+4],Vt*=fr[zt+5],ut*=fr[zt+6],At*=fr[zt+7],xe=(fe=(fe=Q*dt+128>>8)+(xe=Q*Qt+128>>8)+1>>1)-xe,dr=(Fe=Ye)*Z+(Te=ut)*V+128>>8,Fe=Fe*V-Te*Z+128>>8,_t=(Oe=(Oe=J*(Zt-At)+128>>8)+(_t=Vt<<4)+1>>1)-_t,Be=(Et=(Et=J*(Zt+At)+128>>8)+(Be=bt<<4)+1>>1)-Be,Te=(fe=fe+(Te=dr)+1>>1)-Te,Fe=(xe=xe+Fe+1>>1)-Fe,dr=Oe*H+Et*G+2048>>12,Oe=Oe*G-Et*H+2048>>12,Et=dr,dr=Be*j+_t*q+2048>>12,Be=Be*q-_t*j+2048>>12,_t=dr,ge[zt]=fe+Et,ge[zt+7]=fe-Et,ge[zt+1]=xe+_t,ge[zt+6]=xe-_t,ge[zt+2]=Fe+Be,ge[zt+5]=Fe-Be,ge[zt+3]=Te+Oe,ge[zt+4]=Te-Oe):(dr=Q*dt+512>>10,ge[zt]=dr,ge[zt+1]=dr,ge[zt+2]=dr,ge[zt+3]=dr,ge[zt+4]=dr,ge[zt+5]=dr,ge[zt+6]=dr,ge[zt+7]=dr);for(var Ce=0;Ce<8;++Ce)dt=ge[Ce],(Zt=ge[Ce+8])|(Ye=ge[Ce+16])|(bt=ge[Ce+24])|(Qt=ge[Ce+32])|(Vt=ge[Ce+40])|(ut=ge[Ce+48])|(At=ge[Ce+56])?(xe=(fe=4112+((fe=Q*dt+2048>>12)+(xe=Q*Qt+2048>>12)+1>>1))-xe,dr=(Fe=Ye)*Z+(Te=ut)*V+2048>>12,Fe=Fe*V-Te*Z+2048>>12,Te=dr,_t=(Oe=(Oe=J*(Zt-At)+2048>>12)+(_t=Vt)+1>>1)-_t,Be=(Et=(Et=J*(Zt+At)+2048>>12)+(Be=bt)+1>>1)-Be,dr=Oe*H+Et*G+2048>>12,Oe=Oe*G-Et*H+2048>>12,Et=dr,dr=Be*j+_t*q+2048>>12,Be=Be*q-_t*j+2048>>12,(dt=(fe=fe+Te+1>>1)+Et)<16?dt=0:dt>=4080?dt=255:dt>>=4,(Zt=(xe=xe+Fe+1>>1)+(_t=dr))<16?Zt=0:Zt>=4080?Zt=255:Zt>>=4,(Ye=(Fe=xe-Fe)+Be)<16?Ye=0:Ye>=4080?Ye=255:Ye>>=4,(bt=(Te=fe-Te)+Oe)<16?bt=0:bt>=4080?bt=255:bt>>=4,(Qt=Te-Oe)<16?Qt=0:Qt>=4080?Qt=255:Qt>>=4,(Vt=Fe-Be)<16?Vt=0:Vt>=4080?Vt=255:Vt>>=4,(ut=xe-_t)<16?ut=0:ut>=4080?ut=255:ut>>=4,(At=fe-Et)<16?At=0:At>=4080?At=255:At>>=4,pr[me+Ce]=dt,pr[me+Ce+8]=Zt,pr[me+Ce+16]=Ye,pr[me+Ce+24]=bt,pr[me+Ce+32]=Qt,pr[me+Ce+40]=Vt,pr[me+Ce+48]=ut,pr[me+Ce+56]=At):(dr=(dr=Q*dt+8192>>14)<-2040?0:dr>=2024?255:dr+2056>>4,pr[me+Ce]=dr,pr[me+Ce+8]=dr,pr[me+Ce+16]=dr,pr[me+Ce+24]=dr,pr[me+Ce+32]=dr,pr[me+Ce+40]=dr,pr[me+Ce+48]=dr,pr[me+Ce+56]=dr)}function ce(de,me){for(var ge=me.P,fe=me.c,xe=new Int16Array(64),Fe=0;Fe<fe;Fe++)for(var Te=0;Te<ge;Te++)ne(me,se(me,Fe,Te),xe);return me.D}function oe(de,me,ge){ge==null&&(ge=me);var fe=de.length-1,xe=ge<me?ge:me;if(me>=fe)return null;var Fe=F(de,me);if(Fe>=65472&&Fe<=65534)return{u:null,M:Fe,offset:me};for(var Te=F(de,xe);!(Te>=65472&&Te<=65534);){if(++xe>=fe)return null;Te=F(de,xe)}return{u:Fe.toString(16),M:Te,offset:xe}}return ie.prototype={parse(de,me){me==null&&(me={});var ge,fe,xe=me.F,Fe=0,Te=null,Oe=null,Be=0;function _t(){var br=F(de,Fe),ii=(Fe+=2)+br-2,It=oe(de,ii,Fe);It&&It.u&&(ii=It.offset);var si=de.subarray(Fe,ii);return Fe+=si.length,si}function Et(br){for(var ii=Math.ceil(br.o/8/br.X),It=Math.ceil(br.s/8/br.B),si=0;si<br.W.length;si++){yr=br.W[si];var Ei=Math.ceil(Math.ceil(br.o/8)*yr.h/br.X),Ue=Math.ceil(Math.ceil(br.s/8)*yr.A/br.B),ni=ii*yr.h,_r=64*(It*yr.A)*(ni+1);yr.D=new Int16Array(_r),yr.P=Ei,yr.c=Ue}br.m=ii,br.R=It}var dt=[],Zt=[],Ye=[],bt=F(de,Fe);if(Fe+=2,bt!==65496)throw new I("SOI not found");bt=F(de,Fe),Fe+=2;e:for(;bt!==65497;){var Qt,Vt,ut;switch(bt){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var At=_t();bt===65504&&At[0]===74&&At[1]===70&&At[2]===73&&At[3]===70&&At[4]===0&&(Te={version:{d:At[5],T:At[6]},K:At[7],j:At[8]<<8|At[9],H:At[10]<<8|At[11],S:At[12],I:At[13],C:At.subarray(14,14+3*At[12]*At[13])}),bt===65518&&At[0]===65&&At[1]===100&&At[2]===111&&At[3]===98&&At[4]===101&&(Oe={version:At[5]<<8|At[6],k:At[7]<<8|At[8],q:At[9]<<8|At[10],a:At[11]});break;case 65499:for(var dr=F(de,Fe)+(Fe+=2)-2;Fe<dr;){var fr=de[Fe++],pr=new Uint16Array(64);if(fr>>4){if(fr>>4!=1)throw new I("DQT - invalid table spec");for(Vt=0;Vt<64;Vt++)pr[U[Vt]]=F(de,Fe),Fe+=2}else for(Vt=0;Vt<64;Vt++)pr[U[Vt]]=de[Fe++];dt[15&fr]=pr}break;case 65472:case 65473:case 65474:if(ge)throw new I("Only single frame JPEGs supported");Fe+=2,(ge={}).G=bt===65473,ge.Z=bt===65474,ge.precision=de[Fe++];var zt,Ce=F(de,Fe),Nt=0,Xe=0;Fe+=2,ge.s=xe||Ce,ge.o=F(de,Fe),Fe+=2,ge.W=[],ge._={};var lt=de[Fe++];for(Qt=0;Qt<lt;Qt++){zt=de[Fe];var st=de[Fe+1]>>4,yt=15&de[Fe+1];Nt<st&&(Nt=st),Xe<yt&&(Xe=yt);var Yt=de[Fe+2];ut=ge.W.push({h:st,A:yt,L:Yt,$:null}),ge._[zt]=ut-1,Fe+=3}ge.X=Nt,ge.B=Xe,Et(ge);break;case 65476:var $e=F(de,Fe);for(Fe+=2,Qt=2;Qt<$e;){var ze=de[Fe++],ft=new Uint8Array(16),ht=0;for(Vt=0;Vt<16;Vt++,Fe++)ht+=ft[Vt]=de[Fe];var gr=new Uint8Array(ht);for(Vt=0;Vt<ht;Vt++,Fe++)gr[Vt]=de[Fe];Qt+=17+ht,(ze>>4?Zt:Ye)[15&ze]=re(ft,gr)}break;case 65501:fe=F(de,Fe+=2),Fe+=2;break;case 65498:var yr,li=++Be==1&&!xe;Fe+=2;var fi=de[Fe++],ai=[];for(Qt=0;Qt<fi;Qt++){var hi=de[Fe++],ui=ge._[hi];(yr=ge.W[ui]).index=hi;var vi=de[Fe++];yr.J=Ye[vi>>4],yr.i=Zt[15&vi],ai.push(yr)}var bi=de[Fe++],_i=de[Fe++],ki=de[Fe++];try{var yi=X(de,Fe,ge,ai,fe,bi,_i,ki>>4,15&ki,li);Fe+=yi}catch(br){if(br instanceof DNLMarkerError)return this.parse(de,{F:br.s});if(br instanceof EOIMarkerError)break e;throw br}break;case 65500:Fe+=4;break;case 65535:de[Fe]!==255&&Fe--;break;default:var cr=oe(de,Fe-2,Fe-3);if(cr&&cr.u){Fe=cr.offset;break}if(Fe>=de.length-1)break e;throw new I("JpegImage.parse - unknown marker: "+bt.toString(16))}bt=F(de,Fe),Fe+=2}for(this.width=ge.o,this.height=ge.s,this.g=Te,this.b=Oe,this.W=[],Qt=0;Qt<ge.W.length;Qt++){var di=dt[(yr=ge.W[Qt]).L];di&&(yr.$=di),this.W.push({index:yr.index,e:ce(0,yr),l:yr.h/ge.X,t:yr.A/ge.B,P:yr.P,c:yr.c})}this.p=this.W.length},Y(de,me,ge){ge==null&&(ge=!1);var fe,xe,Fe,Te,Oe,Be,_t,Et,dt,Zt,Ye,bt,Qt=this.width/de,Vt=this.height/me,ut=0,At=this.W.length,dr=de*me*At,fr=new Uint8ClampedArray(dr),pr=new Uint32Array(de),zt=4294967288;for(_t=0;_t<At;_t++){if(xe=(fe=this.W[_t]).l*Qt,Fe=fe.t*Vt,ut=_t,Ye=fe.e,Te=fe.P+1<<3,xe!==bt){for(Oe=0;Oe<de;Oe++)Et=0|Oe*xe,pr[Oe]=(Et&zt)<<3|7&Et;bt=xe}for(Be=0;Be<me;Be++)for(Zt=Te*((Et=0|Be*Fe)&zt)|(7&Et)<<3,Oe=0;Oe<de;Oe++)fr[ut]=Ye[Zt+pr[Oe]],ut+=At}var Ce=this.V;if(ge||At!==4||Ce||(Ce=new Int32Array([-256,255,-256,255,-256,255,-256,255])),Ce)for(_t=0;_t<dr;)for(Et=0,dt=0;Et<At;Et++,_t++,dt+=2)fr[_t]=(fr[_t]*Ce[dt]>>8)+Ce[dt+1];return fr},get f(){return this.b?!!this.b.a:this.p===3?this.N!==0&&(this.W[0].index!==82||this.W[1].index!==71||this.W[2].index!==66):this.N===1},z:function(de){for(var me,ge,fe,xe=0,Fe=de.length;xe<Fe;xe+=3)me=de[xe],ge=de[xe+1],fe=de[xe+2],de[xe]=me-179.456+1.402*fe,de[xe+1]=me+135.459-.344*ge-.714*fe,de[xe+2]=me-226.816+1.772*ge;return de},O:function(de){for(var me,ge,fe,xe,Fe=0,Te=0,Oe=de.length;Te<Oe;Te+=4)me=de[Te],ge=de[Te+1],fe=de[Te+2],xe=de[Te+3],de[Fe++]=ge*(-660635669420364e-19*ge+.000437130475926232*fe-54080610064599e-18*me+.00048449797120281*xe-.154362151871126)-122.67195406894+fe*(-.000957964378445773*fe+.000817076911346625*me-.00477271405408747*xe+1.53380253221734)+me*(.000961250184130688*me-.00266257332283933*xe+.48357088451265)+xe*(-.000336197177618394*xe+.484791561490776),de[Fe++]=107.268039397724+ge*(219927104525741e-19*ge-.000640992018297945*fe+.000659397001245577*me+.000426105652938837*xe-.176491792462875)+fe*(-.000778269941513683*fe+.00130872261408275*me+.000770482631801132*xe-.151051492775562)+me*(.00126935368114843*me-.00265090189010898*xe+.25802910206845)+xe*(-.000318913117588328*xe-.213742400323665),de[Fe++]=ge*(-.000570115196973677*ge-263409051004589e-19*fe+.0020741088115012*me-.00288260236853442*xe+.814272968359295)-20.810012546947+fe*(-153496057440975e-19*fe-.000132689043961446*me+.000560833691242812*xe-.195152027534049)+me*(.00174418132927582*me-.00255243321439347*xe+.116935020465145)+xe*(-.000343531996510555*xe+.24165260232407);return de.subarray(0,Fe)},r:function(de){for(var me,ge,fe,xe=0,Fe=de.length;xe<Fe;xe+=4)me=de[xe],ge=de[xe+1],fe=de[xe+2],de[xe]=434.456-me-1.402*fe,de[xe+1]=119.541-me+.344*ge+.714*fe,de[xe+2]=481.816-me-1.772*ge;return de},U:function(de){for(var me,ge,fe,xe,Fe=0,Te=0,Oe=de.length;Te<Oe;Te+=4)me=de[Te],ge=de[Te+1],fe=de[Te+2],xe=de[Te+3],de[Fe++]=255+me*(-6747147073602441e-20*me+.0008379262121013727*ge+.0002894718188643294*fe+.003264231057537806*xe-1.1185611867203937)+ge*(26374107616089405e-21*ge-8626949158638572e-20*fe-.0002748769067499491*xe-.02155688794978967)+fe*(-3878099212869363e-20*fe-.0003267808279485286*xe+.0686742238595345)-xe*(.0003361971776183937*xe+.7430659151342254),de[Fe++]=255+me*(.00013596372813588848*me+.000924537132573585*ge+.00010567359618683593*fe+.0004791864687436512*xe-.3109689587515875)+ge*(-.00023545346108370344*ge+.0002702845253534714*fe+.0020200308977307156*xe-.7488052167015494)+fe*(6834815998235662e-20*fe+.00015168452363460973*xe-.09751927774728933)-xe*(.0003189131175883281*xe+.7364883807733168),de[Fe++]=255+me*(13598650411385307e-21*me+.00012423956175490851*ge+.0004751985097583589*fe-36729317476630422e-22*xe-.05562186980264034)+ge*(.00016141380598724676*ge+.0009692239130725186*fe+.0007782692450036253*xe-.44015232367526463)+fe*(5068882914068769e-22*fe+.0017778369011375071*xe-.7591454649749609)-xe*(.0003435319965105553*xe+.7063770186160144);return de.subarray(0,Fe)},getData:function(de){var me=de.width,ge=de.height,fe=de.forceRGB,xe=de.isSourcePDF;if(this.p>4)throw new I("Unsupported color mode");var Fe=this.Y(me,ge,xe);if(this.p===1&&fe){for(var Te=Fe.length,Oe=new Uint8ClampedArray(3*Te),Be=0,_t=0;_t<Te;_t++){var Et=Fe[_t];Oe[Be++]=Et,Oe[Be++]=Et,Oe[Be++]=Et}return Oe}if(this.p===3&&this.f)return this.z(Fe);if(this.p===4){if(this.f)return fe?this.O(Fe):this.r(Fe);if(fe)return this.U(Fe)}return Fe}},ie})();function F(U,q){return U[q]<<8|U[q+1]}w.JpegDecoder=D})(),w.encodeImage=function(I,D,F,U){var q={t256:[D],t257:[F],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[F],t279:[D*F*4],t282:[[72,1]],t283:[[72,1]],t284:[1],t286:[[0,1]],t287:[[0,1]],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(U)for(var j in U)q[j]=U[j];var G=new Uint8Array(w.encode([q])),H=new Uint8Array(I),V=new Uint8Array(1e3+D*F*4);for(j=0;j<G.length;j++)V[j]=G[j];for(j=0;j<H.length;j++)V[1e3+j]=H[j];return V.buffer},w.encode=function(I){var D=new Uint8Array(2e4),F=4,U=w._binBE;D[0]=D[1]=77,U.writeUshort(D,2,42);var q=8;U.writeUint(D,F,q),F+=4;for(var j=0;j<I.length;j++){var G=w._writeIFD(U,w._types.basic,D,q,I[j]);q=G[1],j<I.length-1&&(3&q&&(q+=4-(3&q)),U.writeUint(D,G[0],q))}return D.slice(0,q).buffer},w.decode=function(I,D){D==null&&(D={parseMN:!0,debug:!1});var F=new Uint8Array(I),U=0,q=w._binBE.readASCII(F,U,2);U+=2;var j=q=="II"?w._binLE:w._binBE;j.readUshort(F,U),U+=2;var G=j.readUint(F,U);U+=4;for(var H=[];;){var V=j.readUshort(F,G),Z=j.readUshort(F,G+4);if(V!=0&&(Z<1||13<Z)){g("error in TIFF");break}if(w._readIFD(j,F,G,H,0,D),(G=j.readUint(F,G+2+12*V))==0)break}return H},w.decodeImage=function(I,D,F){if(!D.data){var U=new Uint8Array(I),q=w._binBE.readASCII(U,0,2);if(D.t256!=null){D.isLE=q=="II",D.width=D.t256[0],D.height=D.t257[0];var j=D.t259?D.t259[0]:1,G=D.t266?D.t266[0]:1;D.t284&&D.t284[0]==2&&g("PlanarConfiguration 2 should not be used!"),j==7&&D.t258&&D.t258.length>3&&(D.t258=D.t258.slice(0,3));var H=D.t277?D.t277[0]:1,V=(D.t258?D.t258[0]:1)*H;j==1&&D.t279!=null&&D.t278&&D.t262[0]==32803&&(V=Math.round(8*D.t279[0]/(D.width*D.t278[0]))),D.t50885&&D.t50885[0]==4&&(V=3*D.t258[0]);var Z=8*Math.ceil(D.width*V/8),Q=D.t273;(Q==null||D.t322)&&(Q=D.t324);var J=D.t279;j==1&&Q.length==1&&(J=[D.height*(Z>>>3)]),(J==null||D.t322)&&(J=D.t325);var ie=new Uint8Array(D.height*(Z>>>3)),re=0;if(D.t322!=null){var se=D.t322[0],X=D.t323[0],ne=Math.floor((D.width+se-1)/se),ce=Math.floor((D.height+X-1)/X),oe=new Uint8Array(0|Math.ceil(se*X*V/8));console.log("====",ne,ce);for(var de=0;de<ce;de++)for(var me=0;me<ne;me++){var ge=de*ne+me;oe.fill(0),w.decode._decompress(D,F,U,Q[ge],J[ge],j,oe,0,G,se,X),j==6?ie=oe:w._copyTile(oe,0|Math.ceil(se*V/8),X,ie,0|Math.ceil(D.width*V/8),D.height,0|Math.ceil(me*se*V/8),de*X)}re=8*ie.length}else{if(Q==null)return;var fe=D.t278?D.t278[0]:D.height;for(fe=Math.min(fe,D.height),ge=0;ge<Q.length;ge++)w.decode._decompress(D,F,U,Q[ge],J[ge],j,ie,0|Math.ceil(re/8),G,D.width,fe),re+=Z*fe;re=Math.min(re,8*ie.length)}D.data=new Uint8Array(ie.buffer,0,0|Math.ceil(re/8))}}},w.decode._decompress=function(I,D,F,U,q,j,G,H,V,Z,Q){if(I.t271&&I.t271[0]=="Panasonic"&&I.t45&&I.t45[0]==6&&(j=34316),j==1)for(var J=0;J<q;J++)G[H+J]=F[U+J];else if(j==2)w.decode._decodeG2(F,U,q,G,H,Z,V);else if(j==3)w.decode._decodeG3(F,U,q,G,H,Z,V,!!I.t292&&!(1&~I.t292[0]));else if(j==4)w.decode._decodeG4(F,U,q,G,H,Z,V);else if(j==5)w.decode._decodeLZW(F,U,q,G,H,8);else if(j==6)w.decode._decodeOldJPEG(I,F,U,q,G,H);else if(j==7||j==34892)w.decode._decodeNewJPEG(I,F,U,q,G,H);else if(j==8||j==32946){var ie=new Uint8Array(F.buffer,U+2,q-6),re=$.inflateRaw(ie);H+re.length<=G.length&&G.set(re,H)}else j==9?w.decode._decodeVC5(F,U,q,G,H,I.t33422):j==32767?w.decode._decodeARW(I,F,U,q,G,H):j==32773?w.decode._decodePackBits(F,U,q,G,H):j==32809?w.decode._decodeThunder(F,U,q,G,H):j==34316?w.decode._decodePanasonic(I,F,U,q,G,H):j==34713?w.decode._decodeNikon(I,D,F,U,q,G,H):j==34676?w.decode._decodeLogLuv32(I,F,U,q,G,H):g("Unknown compression",j);var se=I.t258?Math.min(32,I.t258[0]):1,X=I.t277?I.t277[0]:1,ne=se*X>>>3,ce=Math.ceil(se*X*Z/8);if(se==16&&!I.isLE&&I.t33422==null)for(var oe=0;oe<Q;oe++)for(var de=H+oe*ce,me=1;me<ce;me+=2){var ge=G[de+me];G[de+me]=G[de+me-1],G[de+me-1]=ge}if(I.t317&&I.t317[0]==2)for(oe=0;oe<Q;oe++){var fe=H+oe*ce;if(se==16)for(J=ne;J<ce;J+=2){var xe=(G[fe+J+1]<<8|G[fe+J])+(G[fe+J-ne+1]<<8|G[fe+J-ne]);G[fe+J]=255&xe,G[fe+J+1]=xe>>>8&255}else if(X==3)for(J=3;J<ce;J+=3)G[fe+J]=G[fe+J]+G[fe+J-3]&255,G[fe+J+1]=G[fe+J+1]+G[fe+J-2]&255,G[fe+J+2]=G[fe+J+2]+G[fe+J-1]&255;else for(J=ne;J<ce;J++)G[fe+J]=G[fe+J]+G[fe+J-ne]&255}},w.decode._decodePanasonic=function(I,D,F,U,q,j){var G,H,V,Z,Q,J,ie,re,se=D.buffer,X=I.t2[0],ne=I.t3[0],ce=I.t10[0],oe=I.t45[0],de=0,me=0,ge=0,fe=0,xe=oe==6?new Uint32Array(18):new Uint8Array(16),Fe=[0,0],Te=[0,0],Oe=0,Be=new Uint8Array(16384),_t=new Uint16Array(q.buffer);function Et(Yt){if(ge==0){var $e=new Uint8Array(se,F+me+8184,8200),ze=new Uint8Array(se,F+me,8184);Be.set($e),Be.set(ze,$e.length),me+=16384}if(oe!=5)return(Be[fe=(ge=ge-Yt&131071)>>3^16368]|Be[fe+1]<<8)>>(7&ge)&~(-1<<Yt);for(G=0;G<16;G++)xe[G]=Be[ge++],ge&=16383}function dt(Yt){return Be[ge+15-Yt]}function Zt(){Fe[0]=0,Fe[1]=0,Te[0]=0,Te[1]=0}if(oe==7)throw oe;if(oe==6){var Ye=ce==12,bt=Ye?function(){xe[0]=dt(0)<<4|dt(1)>>4,xe[1]=4095&((15&dt(1))<<8|dt(2)),xe[2]=dt(3)>>6&3,xe[3]=(63&dt(3))<<2|dt(4)>>6,xe[4]=(63&dt(4))<<2|dt(5)>>6,xe[5]=(63&dt(5))<<2|dt(6)>>6,xe[6]=dt(6)>>4&3,xe[7]=(15&dt(6))<<4|dt(7)>>4,xe[8]=(15&dt(7))<<4|dt(8)>>4,xe[9]=(15&dt(8))<<4|dt(9)>>4,xe[10]=dt(9)>>2&3,xe[11]=(3&dt(9))<<6|dt(10)>>2,xe[12]=(3&dt(10))<<6|dt(11)>>2,xe[13]=(3&dt(11))<<6|dt(12)>>2,xe[14]=3&dt(12),xe[15]=dt(13),xe[16]=dt(14),xe[17]=dt(15),ge+=16,fe=0}:function(){xe[0]=dt(0)<<6|dt(1)>>2,xe[1]=16383&((3&dt(1))<<12|dt(2)<<4|dt(3)>>4),xe[2]=dt(3)>>2&3,xe[3]=(3&dt(3))<<8|dt(4),xe[4]=dt(5)<<2|dt(6)>>6,xe[5]=(63&dt(6))<<4|dt(7)>>4,xe[6]=dt(7)>>2&3,xe[7]=(3&dt(7))<<8|dt(8),xe[8]=dt(9)<<2&1020|dt(10)>>6,xe[9]=1023&(dt(10)<<4|dt(11)>>4),xe[10]=dt(11)>>2&3,xe[11]=(3&dt(11))<<8|dt(12),xe[12]=1023&(dt(13)<<2&1020|dt(14)>>6),xe[13]=1023&(dt(14)<<4|dt(15)>>4),ge+=16,fe=0},Qt=Ye?14:11,Vt=Ye?128:512,ut=Ye?2048:8192,At=Ye?16383:65535,dr=Ye?4095:16383,fr=X/Qt,pr=16*fr,zt=Ye?18:14;for(J=0;J<ne-15;J+=16){var Ce=Math.min(16,ne-J),Nt=pr*Ce;for(Be=new Uint8Array(se,F+de,Nt),ge=0,de+=Nt,re=0,ie=0;re<Ce;re++,ie=0){Oe=(J+re)*X;for(var Xe=0;Xe<fr;Xe++)for(bt(),Zt(),V=0,Q=0,G=0;G<Qt;G++){if(Z=1&G,G%3==2){var lt=fe<zt?xe[fe++]:0;lt==3&&(lt=4),Q=Vt<<lt,V=1<<lt}var st=fe<zt?xe[fe++]:0;Fe[Z]?(st*=V,Q<ut&&Te[Z]>Q&&(st+=Te[Z]-Q),Te[Z]=st):(Fe[Z]=st,st?Te[Z]=st:st=Te[Z]),_t[Oe+ie++]=st-15<=At?st-15&At:st+2147483633>>31&dr}}}}else if(oe==5){var yt=ce==12?10:9;for(J=0;J<ne;J++)for(ie=0;ie<X;ie+=yt)Et(0),ce==12?(_t[Oe++]=((15&xe[1])<<8)+xe[0],_t[Oe++]=16*xe[2]+(xe[1]>>4),_t[Oe++]=((15&xe[4])<<8)+xe[3],_t[Oe++]=16*xe[5]+(xe[4]>>4),_t[Oe++]=((15&xe[7])<<8)+xe[6],_t[Oe++]=16*xe[8]+(xe[7]>>4),_t[Oe++]=((15&xe[10])<<8)+xe[9],_t[Oe++]=16*xe[11]+(xe[10]>>4),_t[Oe++]=((15&xe[13])<<8)+xe[12],_t[Oe++]=16*xe[14]+(xe[13]>>4)):ce==14&&(_t[Oe++]=xe[0]+((63&xe[1])<<8),_t[Oe++]=(xe[1]>>6)+4*xe[2]+((15&xe[3])<<10),_t[Oe++]=(xe[3]>>4)+16*xe[4]+((3&xe[5])<<12),_t[Oe++]=((252&xe[5])>>2)+(xe[6]<<6),_t[Oe++]=xe[7]+((63&xe[8])<<8),_t[Oe++]=(xe[8]>>6)+4*xe[9]+((15&xe[10])<<10),_t[Oe++]=(xe[10]>>4)+16*xe[11]+((3&xe[12])<<12),_t[Oe++]=((252&xe[12])>>2)+(xe[13]<<6),_t[Oe++]=xe[14]+((63&xe[15])<<8))}else{if(oe!=4)throw oe;for(J=0;J<ne;J++)for(ie=0;ie<X;ie++)Z=1&(G=ie%14),G==0&&Zt(),G%3==2&&(V=4>>3-Et(2)),Te[Z]?(H=Et(8))!=0&&(Fe[Z]-=128<<V,(Fe[Z]<0||V==4)&&(Fe[Z]&=~(-1<<V)),Fe[Z]+=H<<V):(Te[Z]=Et(8),(Te[Z]||G>11)&&(Fe[Z]=Te[Z]<<4|Et(4))),_t[Oe++]=Fe[1&ie]}},w.decode._decodeVC5=(function(){var I,D,F,U=[1,0,1,0,2,2,1,1,3,7,1,2,5,25,1,3,6,48,1,4,6,54,1,5,7,111,1,8,7,99,1,6,7,105,12,0,7,107,1,7,8,209,20,0,8,212,1,9,8,220,1,10,9,393,1,11,9,394,32,0,9,416,1,12,9,427,1,13,10,887,1,18,10,784,1,14,10,790,1,15,10,835,60,0,10,852,1,16,10,885,1,17,11,1571,1,19,11,1668,1,20,11,1669,100,0,11,1707,1,21,11,1772,1,22,12,3547,1,29,12,3164,1,24,12,3166,1,25,12,3140,1,23,12,3413,1,26,12,3537,1,27,12,3539,1,28,13,7093,1,35,13,6283,1,30,13,6331,1,31,13,6335,180,0,13,6824,1,32,13,7072,1,33,13,7077,320,0,13,7076,1,34,14,12565,1,36,14,12661,1,37,14,12669,1,38,14,13651,1,39,14,14184,1,40,15,28295,1,46,15,28371,1,47,15,25320,1,42,15,25336,1,43,15,25128,1,41,15,27300,1,44,15,28293,1,45,16,50259,1,48,16,50643,1,49,16,50675,1,50,16,56740,1,53,16,56584,1,51,16,56588,1,52,17,113483,1,61,17,113482,1,60,17,101285,1,55,17,101349,1,56,17,109205,1,57,17,109207,1,58,17,100516,1,54,17,113171,1,59,18,202568,1,62,18,202696,1,63,18,218408,1,64,18,218412,1,65,18,226340,1,66,18,226356,1,67,18,226358,1,68,19,402068,1,69,19,405138,1,70,19,405394,1,71,19,436818,1,72,19,436826,1,73,19,452714,1,75,19,452718,1,76,19,452682,1,74,20,804138,1,77,20,810279,1,78,20,810790,1,79,20,873638,1,80,20,873654,1,81,20,905366,1,82,20,905430,1,83,20,905438,1,84,21,1608278,1,85,21,1620557,1,86,21,1621582,1,87,21,1621583,1,88,21,1747310,1,89,21,1810734,1,90,21,1810735,1,91,21,1810863,1,92,21,1810879,1,93,22,3621725,1,99,22,3621757,1,100,22,3241112,1,94,22,3494556,1,95,22,3494557,1,96,22,3494622,1,97,22,3494623,1,98,23,6482227,1,102,23,6433117,1,101,23,6989117,1,103,23,6989119,1,105,23,6989118,1,104,23,7243449,1,106,23,7243512,1,107,24,13978233,1,111,24,12964453,1,109,24,12866232,1,108,24,14486897,1,113,24,13978232,1,110,24,14486896,1,112,24,14487026,1,114,24,14487027,1,115,25,25732598,1,225,25,25732597,1,189,25,25732596,1,188,25,25732595,1,203,25,25732594,1,202,25,25732593,1,197,25,25732592,1,207,25,25732591,1,169,25,25732590,1,223,25,25732589,1,159,25,25732522,1,235,25,25732579,1,152,25,25732575,1,192,25,25732489,1,179,25,25732573,1,201,25,25732472,1,172,25,25732576,1,149,25,25732488,1,178,25,25732566,1,120,25,25732571,1,219,25,25732577,1,150,25,25732487,1,127,25,25732506,1,211,25,25732548,1,125,25,25732588,1,158,25,25732486,1,247,25,25732467,1,238,25,25732508,1,163,25,25732552,1,228,25,25732603,1,183,25,25732513,1,217,25,25732587,1,168,25,25732520,1,122,25,25732484,1,128,25,25732562,1,249,25,25732505,1,187,25,25732504,1,186,25,25732483,1,136,25,25928905,1,181,25,25732560,1,255,25,25732500,1,230,25,25732482,1,135,25,25732555,1,233,25,25732568,1,222,25,25732583,1,145,25,25732481,1,134,25,25732586,1,167,25,25732521,1,248,25,25732518,1,209,25,25732480,1,243,25,25732512,1,216,25,25732509,1,164,25,25732547,1,140,25,25732479,1,157,25,25732544,1,239,25,25732574,1,191,25,25732564,1,251,25,25732478,1,156,25,25732546,1,139,25,25732498,1,242,25,25732557,1,133,25,25732477,1,162,25,25732515,1,213,25,25732584,1,165,25,25732514,1,212,25,25732476,1,227,25,25732494,1,198,25,25732531,1,236,25,25732530,1,234,25,25732529,1,117,25,25732528,1,215,25,25732527,1,124,25,25732526,1,123,25,25732525,1,254,25,25732524,1,253,25,25732523,1,148,25,25732570,1,218,25,25732580,1,146,25,25732581,1,147,25,25732569,1,224,25,25732533,1,143,25,25732540,1,184,25,25732541,1,185,25,25732585,1,166,25,25732556,1,132,25,25732485,1,129,25,25732563,1,250,25,25732578,1,151,25,25732501,1,119,25,25732502,1,193,25,25732536,1,176,25,25732496,1,245,25,25732553,1,229,25,25732516,1,206,25,25732582,1,144,25,25732517,1,208,25,25732558,1,137,25,25732543,1,241,25,25732466,1,237,25,25732507,1,190,25,25732542,1,240,25,25732551,1,131,25,25732554,1,232,25,25732565,1,252,25,25732475,1,171,25,25732493,1,205,25,25732492,1,204,25,25732491,1,118,25,25732490,1,214,25,25928904,1,180,25,25732549,1,126,25,25732602,1,182,25,25732539,1,175,25,25732545,1,141,25,25732559,1,138,25,25732537,1,177,25,25732534,1,153,25,25732503,1,194,25,25732606,1,160,25,25732567,1,121,25,25732538,1,174,25,25732497,1,246,25,25732550,1,130,25,25732572,1,200,25,25732474,1,170,25,25732511,1,221,25,25732601,1,196,25,25732532,1,142,25,25732519,1,210,25,25732495,1,199,25,25732605,1,155,25,25732535,1,154,25,25732499,1,244,25,25732510,1,220,25,25732600,1,195,25,25732607,1,161,25,25732604,1,231,25,25732473,1,173,25,25732599,1,226,26,51465122,1,116,26,51465123,0,1],q=[3,3,3,3,2,2,2,1,1,1];function j(re){var se=re[1],X=re[0][se>>>3]>>>7-(7&se)&1;return re[1]++,X}function G(re,se){if(I==null){I={};for(var X=0;X<U.length;X+=4)I[U[X+1]]=U.slice(X,X+4)}for(var ne=j(re),ce=I[ne];ce==null;)ne=ne<<1|j(re),ce=I[ne];var oe=ce[3];oe!=0&&(oe=j(re)==0?oe:-oe),se[0]=ce[2],se[1]=oe}function H(re,se){for(var X=0;X<se;X++)1&~re||re++,re>>>=1;return re}function V(re,se){return re>>se}function Z(re,se,X,ne,ce,oe){se[X]=V(V(11*re[ce]-4*re[ce+oe]+re[ce+oe+oe]+4,3)+re[ne],1),se[X+oe]=V(V(5*re[ce]+4*re[ce+oe]-re[ce+oe+oe]+4,3)-re[ne],1)}function Q(re,se,X,ne,ce,oe){var de=re[ce-oe]-re[ce+oe],me=re[ce],ge=re[ne];se[X]=V(V(de+4,3)+me+ge,1),se[X+oe]=V(V(4-de,3)+me-ge,1)}function J(re,se,X,ne,ce,oe){se[X]=V(V(5*re[ce]+4*re[ce-oe]-re[ce-oe-oe]+4,3)+re[ne],1),se[X+oe]=V(V(11*re[ce]-4*re[ce-oe]+re[ce-oe-oe]+4,3)-re[ne],1)}function ie(re){return re=F[re=re<0?0:re>4095?4095:re]>>>2}return function(re,se,X,ne,ce,oe){ne=new Uint16Array(ne.buffer);var de,me,ge,fe,xe,Fe,Te,Oe,Be=Date.now(),_t=w._binBE,Et=se+X;se+=4;for(var dt=oe[0]==1;se<Et;){var Zt=_t.readShort(re,se),Ye=_t.readUshort(re,se+2);if(se+=4,Zt==12)fr=Ye;else if(Zt==20)de=Ye;else if(Zt==21)me=Ye;else if(Zt==48)ge=Ye;else if(Zt==53)fe=Ye;else if(Zt!=35){if(Zt==62)xe=Ye;else if(Zt!=101){if(Zt==109)Fe=Ye;else if(Zt!=84){if(Zt!=106){if(Zt!=107){if(Zt!=108){if(Zt!=102){if(Zt==104)ui=Ye;else if(Zt!=105){var bt=Zt<0?-Zt:Zt,Qt=65280&bt,Vt=0;if(24576&bt&&(8192&bt?(Vt=65535&Ye,Vt+=(255&bt)<<16):Vt=65535&Ye),24576&~bt){if(bt==16388)se+=4*Vt;else if(Qt!=8192&&Qt!=8448&&Qt!=9216)throw bt.toString(16)}else{if(Te==null){Te=[];for(var ut=0;ut<4;ut++)Te[ut]=new Int16Array((de>>>1)*(me>>>1));for(Oe=new Int16Array((de>>>1)*(me>>>1)),D=new Int16Array(1024),ut=0;ut<1024;ut++){var At=ut-512,dr=Math.abs(At),fr=Math.floor(768*dr*dr*dr/16581375)+dr;D[ut]=Math.sign(At)*fr}for(F=new Uint16Array(4096),ut=0;ut<4096;ut++){var pr=ut,zt=65535*(Math.pow(113,pr/4095)-1)/112;F[ut]=Math.min(zt,65535)}}var Ce=Te[xe],Nt=H(de,1+q[ge]),Xe=H(me,1+q[ge]);if(ge==0)for(var lt=0;lt<Xe;lt++)for(var st=0;st<Nt;st++){var yt=se+2*(lt*Nt+st);Ce[lt*(de>>>1)+st]=re[yt]<<8|re[yt+1]}else{var Yt=[re,8*se],$e=[],ze=0,ft=Nt*Xe,ht=[0,0],gr=0;for(Ye=0;ze<ft;)for(G(Yt,ht),gr=ht[0],Ye=ht[1];gr>0;)$e[ze++]=Ye,gr--;var yr=(ge-1)%3,li=yr!=1?Nt:0,fi=yr!=0?Xe:0;for(lt=0;lt<Xe;lt++){var ai=(lt+fi)*(de>>>1)+li,hi=lt*Nt;for(st=0;st<Nt;st++)Ce[ai+st]=D[$e[hi+st]+512]*fe}if(yr==2){var ui=de>>>1,vi=2*Nt,bi=2*Xe;for(lt=0;lt<Xe;lt++)for(st=0;st<vi;st++){ut=2*lt*ui+st;var _i=Xe*ui+(yi=lt*ui+st);lt==0?Z(Ce,Oe,ut,_i,yi,ui):lt==Xe-1?J(Ce,Oe,ut,_i,yi,ui):Q(Ce,Oe,ut,_i,yi,ui)}var ki=Ce;for(Ce=Oe,Oe=ki,lt=0;lt<bi;lt++)for(st=0;st<Nt;st++){var yi;ut=lt*ui+2*st,_i=Nt+(yi=lt*ui+st),st==0?Z(Ce,Oe,ut,_i,yi,1):st==Nt-1?J(Ce,Oe,ut,_i,yi,1):Q(Ce,Oe,ut,_i,yi,1)}ki=Ce,Ce=Oe,Oe=ki;for(var cr=[],di=2-~~((ge-1)/3),br=0;br<3;br++)cr[br]=Fe>>14-2*br&3;var ii=cr[di];if(ii!=0)for(lt=0;lt<bi;lt++)for(st=0;st<vi;st++)Ce[ut=lt*ui+st]=Ce[ut]<<ii}}if(ge==9&&xe==3){var It=Te[0],si=Te[1],Ei=Te[2],Ue=Te[3];for(lt=0;lt<me;lt+=2)for(st=0;st<de;st+=2){var ni=lt*de+st,_r=It[yt=(lt>>>1)*(de>>>1)+(st>>>1)],hr=si[yt]-2048,ei=Ei[yt]-2048,ri=Ue[yt]-2048,xi=(hr<<1)+_r,gi=(ei<<1)+_r,wi=_r+ri,Ii=_r-ri;dt?(ne[ni]=ie(wi),ne[ni+1]=ie(gi),ne[ni+de]=ie(xi),ne[ni+de+1]=ie(Ii)):(ne[ni]=ie(xi),ne[ni+1]=ie(wi),ne[ni+de]=ie(Ii),ne[ni+de+1]=ie(gi))}}se+=4*Vt}}}}}}}}}}console.log(Date.now()-Be)}})(),w.decode._decodeLogLuv32=function(I,D,F,U,q,j){for(var G=I.width,H=4*G,V=0,Z=new Uint8Array(H);V<U;){for(var Q=0;Q<H;){var J=D[F+V];if(V++,J<128){for(var ie=0;ie<J;ie++)Z[Q+ie]=D[F+V+ie];Q+=J,V+=J}else{for(J-=126,ie=0;ie<J;ie++)Z[Q+ie]=D[F+V];Q+=J,V++}}for(var re=0;re<G;re++)q[j+0]=Z[re],q[j+1]=Z[re+G],q[j+2]=Z[re+2*G],q[j+4]=Z[re+3*G],j+=6}},w.decode._ljpeg_diff=function(I,D,F){var U,q,j=w.decode._getbithuff;return U=j(I,D,F[0],F),(q=j(I,D,U,0))&1<<U-1||(q-=(1<<U)-1),q},w.decode._decodeARW=function(I,D,F,U,q,j){var G=I.t256[0],H=I.t257[0],V=I.t258[0],Z=I.isLE?w._binLE:w._binBE;if(G*H==U||G*H*1.5==U)if(G*H*1.5!=U){var Q,J,ie,re,se,X,ne,ce,oe=new Uint16Array(16),de=new Uint8Array(G+1);for(Be=0;Be<H;Be++){for(var me=0;me<G;me++)de[me]=D[F++];for(ce=0,Oe=0;Oe<G-30;ce+=16){for(J=2047&(Q=Z.readUint(de,ce)),ie=2047&Q>>>11,re=15&Q>>>22,se=15&Q>>>26,X=0;X<4&&128<<X<=J-ie;X++);for(ne=30,ge=0;ge<16;ge++)ge==re?oe[ge]=J:ge==se?oe[ge]=ie:(oe[ge]=((Z.readUshort(de,ce+(ne>>3))>>>(7&ne)&127)<<X)+ie,oe[ge]>2047&&(oe[ge]=2047),ne+=7);for(ge=0;ge<16;ge++,Oe+=2)Vt=oe[ge]<<1,w.decode._putsF(q,(Be*G+Oe)*V,Vt<<16-V);Oe-=1&Oe?1:31}}}else for(var ge=0;ge<U;ge+=3){var fe=D[F+ge+0],xe=D[F+ge+1],Fe=D[F+ge+2];q[j+ge]=xe<<4|fe>>>4,q[j+ge+1]=fe<<4|Fe>>>4,q[j+ge+2]=Fe<<4|xe>>>4}else{H+=8;var Te,Oe,Be,_t=[F,0,0,0],Et=new Uint16Array(32770),dt=[3857,3856,3599,3342,3085,2828,2571,2314,2057,1800,1543,1286,1029,772,771,768,514,513],Zt=0,Ye=w.decode._ljpeg_diff;for(Et[0]=15,Te=ge=0;ge<18;ge++)for(var bt=32768>>>(dt[ge]>>>8),Qt=0;Qt<bt;Qt++)Et[++Te]=dt[ge];for(Oe=G;Oe--;)for(Be=0;Be<H+1;Be+=2)if(Be==H&&(Be=1),Zt+=Ye(D,_t,Et),Be<H){var Vt=4095&Zt;w.decode._putsF(q,(Be*G+Oe)*V,Vt<<16-V)}}},w.decode._decodeNikon=function(I,D,F,U,q,j,G){var H=[[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,5,4,3,6,2,7,1,0,8,9,11,10,12],[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,57,90,56,39,22,5,4,3,2,1,0,11,12,12],[0,0,1,4,2,3,1,2,0,0,0,0,0,0,0,0,0,5,4,6,3,7,2,8,1,9,0,10,11,12],[0,0,1,4,3,1,1,1,1,1,2,0,0,0,0,0,0,5,6,4,7,8,3,9,2,1,0,10,11,12,13,14],[0,0,1,5,1,1,1,1,1,1,1,2,0,0,0,0,0,8,92,75,58,41,7,6,5,4,3,2,1,0,13,14],[0,0,1,4,2,2,3,1,2,0,0,0,0,0,0,0,0,7,6,8,5,9,4,10,3,11,12,2,0,1,13,14]],V=I.t256[0],Z=I.t257[0],Q=I.t258[0],J=0,ie=0,re=w.decode._make_decoder,se=w.decode._getbithuff,X=D[0].exifIFD.makerNote,ne=X.t150?X.t150:X.t140,ce=0,oe=ne[ce++],de=ne[ce++];oe!=73&&de!=88||(ce+=2110),oe==70&&(J=2),Q==14&&(J+=3);for(var me=[[0,0],[0,0]],ge=I.isLE?w._binLE:w._binBE,fe=0;fe<2;fe++)for(var xe=0;xe<2;xe++)me[fe][xe]=ge.readShort(ne,ce),ce+=2;var Fe,Te,Oe,Be,_t,Et=1<<Q&32767,dt=0,Zt=ge.readShort(ne,ce);ce+=2,Zt>1&&(dt=Math.floor(Et/(Zt-1))),oe==68&&de==32&&dt>0&&(ie=ge.readShort(ne,562));var Ye=[0,0],bt=re(H[J]),Qt=[U,0,0,0];for(Fe=0;Fe<Z;Fe++)for(ie&&Fe==ie&&(bt=re(H[J+1])),Te=0;Te<V;Te++){fe=se(F,Qt,bt[0],bt),(_t=1+(se(F,Qt,(Oe=15&fe)-(Be=fe>>>4),0)<<1)<<Be>>>1)&1<<Oe-1||(_t-=(1<<Oe)-(Be==0?1:0)),Te<2?Ye[Te]=me[1&Fe][Te]+=_t:Ye[1&Te]+=_t;var Vt=Math.min(Math.max(Ye[1&Te],0),(1<<Q)-1),ut=(Fe*V+Te)*Q;w.decode._putsF(j,ut,Vt<<16-Q)}},w.decode._putsF=function(I,D,F){F<<=8-(7&D);var U=D>>>3;I[U]|=F>>>16,I[U+1]|=F>>>8,I[U+2]|=F},w.decode._getbithuff=function(I,D,F,U){var q;w.decode._get_byte;var j=D[0],G=D[1],H=D[2],V=D[3];if(F==0||H<0)return 0;for(;!V&&H<F&&(q=I[j++])!=-1&&!(V=0);)G=(G<<8)+q,H+=8;if(q=G<<32-H>>>32-F,U?(H-=U[q+1]>>>8,q=255&U[q+1]):H-=F,H<0)throw"e";return D[0]=j,D[1]=G,D[2]=H,D[3]=V,q},w.decode._make_decoder=function(I){var D,F,U,q,j,G=[];for(D=16;D!=0&&!I[D];D--);var H=17;for(G[0]=D,U=F=1;F<=D;F++)for(q=0;q<I[F];q++,++H)for(j=0;j<1<<D-F;j++)U<=1<<D&&(G[U++]=F<<8|I[H]);return G},w.decode._decodeNewJPEG=function(I,D,F,U,q,j){U=Math.min(U,D.length-F);var G=I.t347,H=G?G.length:0,V=new Uint8Array(H+U);if(G){for(var Z=0,Q=0;Q<H-1&&(G[Q]!=255||G[Q+1]!=217);Q++)V[Z++]=G[Q];var J=D[F],ie=D[F+1];for(J==255&&ie==216||(V[Z++]=J,V[Z++]=ie),Q=2;Q<U;Q++)V[Z++]=D[F+Q]}else for(Q=0;Q<U;Q++)V[Q]=D[F+Q];if(I.t262[0]==32803||I.t259[0]==7&&I.t262[0]==34892){var re=I.t258[0],se=w.LosslessJpegDecode(V),X=se.length;if(re==16)if(I.isLE)for(Q=0;Q<X;Q++)q[j+(Q<<1)]=255&se[Q],q[j+(Q<<1)+1]=se[Q]>>>8;else for(Q=0;Q<X;Q++)q[j+(Q<<1)]=se[Q]>>>8,q[j+(Q<<1)+1]=255&se[Q];else if(re==14||re==12||re==10){var ne=16-re;for(Q=0;Q<X;Q++)w.decode._putsF(q,Q*re,se[Q]<<ne)}else{if(re!=8)throw new Error("unsupported bit depth "+re);for(Q=0;Q<X;Q++)q[j+Q]=se[Q]}}else{var ce=new w.JpegDecoder;ce.parse(V);var oe=ce.getData({width:ce.width,height:ce.height,forceRGB:!0,isSourcePDF:!1});for(Q=0;Q<oe.length;Q++)q[j+Q]=oe[Q]}I.t262[0]==6&&(I.t262[0]=2)},w.decode._decodeOldJPEGInit=function(I,D,F,U){var q,j,G,H,V,Z=216,Q=0,J=0,ie=!1,re=I.t513,se=re?re[0]:0,X=I.t514,ne=X?X[0]:0,ce=I.t324||I.t273||re,oe=I.t530,de=0,me=0,ge=I.t277?I.t277[0]:1,fe=I.t515;if(ce&&(J=ce[0],ie=ce.length>1),!ie){if(D[F]==255&&D[F+1]==Z)return{jpegOffset:F};if(re!=null&&(D[F+se]==255&&D[F+se+1]==Z?Q=F+se:g("JPEGInterchangeFormat does not point to SOI"),X==null?g("JPEGInterchangeFormatLength field is missing"):(se>=J||se+ne<=J)&&g("JPEGInterchangeFormatLength field value is invalid"),Q!=null))return{jpegOffset:Q}}if(oe!=null&&(de=oe[0],me=oe[1]),re!=null&&X!=null)if(ne>=2&&se+ne<=J){for(q=D[F+se+ne-2]==255&&D[F+se+ne-1]==Z?new Uint8Array(ne-2):new Uint8Array(ne),G=0;G<q.length;G++)q[G]=D[F+se+G];g("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else g("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(q==null){var xe=0,Fe=[];Fe[xe++]=255,Fe[xe++]=Z;var Te=I.t519;if(Te==null)throw new Error("JPEGQTables tag is missing");for(G=0;G<Te.length;G++)for(Fe[xe++]=255,Fe[xe++]=219,Fe[xe++]=0,Fe[xe++]=67,Fe[xe++]=G,H=0;H<64;H++)Fe[xe++]=D[F+Te[G]+H];for(V=0;V<2;V++){var Oe=I[V==0?"t520":"t521"];if(Oe==null)throw new Error((V==0?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(G=0;G<Oe.length;G++){Fe[xe++]=255,Fe[xe++]=196;var Be=19;for(H=0;H<16;H++)Be+=D[F+Oe[G]+H];for(Fe[xe++]=Be>>>8,Fe[xe++]=255&Be,Fe[xe++]=G|V<<4,H=0;H<16;H++)Fe[xe++]=D[F+Oe[G]+H];for(H=0;H<Be;H++)Fe[xe++]=D[F+Oe[G]+16+H]}}if(Fe[xe++]=255,Fe[xe++]=192,Fe[xe++]=0,Fe[xe++]=8+3*ge,Fe[xe++]=8,Fe[xe++]=I.height>>>8&255,Fe[xe++]=255&I.height,Fe[xe++]=I.width>>>8&255,Fe[xe++]=255&I.width,Fe[xe++]=ge,ge==1)Fe[xe++]=1,Fe[xe++]=17,Fe[xe++]=0;else for(G=0;G<3;G++)Fe[xe++]=G+1,Fe[xe++]=G!=0?17:(15&de)<<4|15&me,Fe[xe++]=G;fe!=null&&fe[0]!=0&&(Fe[xe++]=255,Fe[xe++]=221,Fe[xe++]=0,Fe[xe++]=4,Fe[xe++]=fe[0]>>>8&255,Fe[xe++]=255&fe[0]),q=new Uint8Array(Fe)}var _t=-1;for(G=0;G<q.length-1;){if(q[G]==255&&q[G+1]==192){_t=G;break}G++}if(_t==-1){var Et=new Uint8Array(q.length+10+3*ge);Et.set(q);var dt=q.length;if(_t=q.length,(q=Et)[dt++]=255,q[dt++]=192,q[dt++]=0,q[dt++]=8+3*ge,q[dt++]=8,q[dt++]=I.height>>>8&255,q[dt++]=255&I.height,q[dt++]=I.width>>>8&255,q[dt++]=255&I.width,q[dt++]=ge,ge==1)q[dt++]=1,q[dt++]=17,q[dt++]=0;else for(G=0;G<3;G++)q[dt++]=G+1,q[dt++]=G!=0?17:(15&de)<<4|15&me,q[dt++]=G}if(D[J]==255&&D[J+1]==218){var Zt=D[J+2]<<8|D[J+3];for((j=new Uint8Array(Zt+2))[0]=D[J],j[1]=D[J+1],j[2]=D[J+2],j[3]=D[J+3],G=0;G<Zt-2;G++)j[G+4]=D[J+G+4]}else{var Ye=0;if((j=new Uint8Array(8+2*ge))[Ye++]=255,j[Ye++]=218,j[Ye++]=0,j[Ye++]=6+2*ge,j[Ye++]=ge,ge==1)j[Ye++]=1,j[Ye++]=0;else for(G=0;G<3;G++)j[Ye++]=G+1,j[Ye++]=G<<4|G;j[Ye++]=0,j[Ye++]=63,j[Ye++]=0}return{jpegOffset:F,tables:q,sosMarker:j,sofPosition:_t}},w.decode._decodeOldJPEG=function(I,D,F,U,q,j){var G,H,V,Z,Q=w.decode._decodeOldJPEGInit(I,D,F,U);if(Q.jpegOffset!=null)for(G=F+U-Q.jpegOffset,V=new Uint8Array(G),re=0;re<G;re++)V[re]=D[Q.jpegOffset+re];else{for(H=Q.tables.length,(V=new Uint8Array(H+Q.sosMarker.length+U+2)).set(Q.tables),Z=H,V[Q.sofPosition+5]=I.height>>>8&255,V[Q.sofPosition+6]=255&I.height,V[Q.sofPosition+7]=I.width>>>8&255,V[Q.sofPosition+8]=255&I.width,D[F]==255&&D[F+1]==SOS||(V.set(Q.sosMarker,Z),Z+=sosMarker.length),re=0;re<U;re++)V[Z++]=D[F+re];V[Z++]=255,V[Z++]=EOI}var J=new w.JpegDecoder;J.parse(V);for(var ie=J.getData({width:J.width,height:J.height,forceRGB:!0,isSourcePDF:!1}),re=0;re<ie.length;re++)q[j+re]=ie[re];I.t262&&I.t262[0]==6&&(I.t262[0]=2)},w.decode._decodePackBits=function(I,D,F,U,q){for(var j=new Int8Array(I.buffer),G=new Int8Array(U.buffer),H=D+F;D<H;){var V=j[D];if(D++,V>=0&&V<128)for(var Z=0;Z<V+1;Z++)G[q]=j[D],q++,D++;if(V>=-127&&V<0){for(Z=0;Z<1-V;Z++)G[q]=j[D],q++;D++}}return q},w.decode._decodeThunder=function(I,D,F,U,q){for(var j=[0,1,0,-1],G=[0,1,2,3,0,-3,-2,-1],H=D+F,V=2*q,Z=0;D<H;){var Q=I[D],J=Q>>>6,ie=63&Q;if(D++,J==3&&(Z=15&ie,U[V>>>1]|=Z<<4*(1-V&1),V++),J==0)for(var re=0;re<ie;re++)U[V>>>1]|=Z<<4*(1-V&1),V++;if(J==2)for(re=0;re<2;re++)(se=ie>>>3*(1-re)&7)!=4&&(Z+=G[se],U[V>>>1]|=Z<<4*(1-V&1),V++);if(J==1)for(re=0;re<3;re++){var se;(se=ie>>>2*(2-re)&3)!=2&&(Z+=j[se],U[V>>>1]|=Z<<4*(1-V&1),V++)}}},w.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3},w.decode._lens=(function(){var I=function(V,Z,Q,J){for(var ie=0;ie<Z.length;ie++)V[Z[ie]]=Q+ie*J},D="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",F="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",U="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",q="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",j="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";D=D.split(","),F=F.split(","),U=U.split(","),q=q.split(","),j=j.split(",");var G={},H={};return I(G,D,0,1),I(G,U,64,64),I(G,j,1792,64),I(H,F,0,1),I(H,q,64,64),I(H,j,1792,64),[G,H]})(),w.decode._decodeG4=function(I,D,F,U,q,j,G){for(var H=w.decode,V=D<<3,Z=0,Q="",J=[],ie=[],re=0;re<j;re++)ie.push(0);ie=H._makeDiff(ie);for(var se=0,X=0,ne=0,ce=0,oe=0,de=0,me="",ge=0,fe=8*Math.ceil(j/8);V>>>3<D+F;){ne=H._findDiff(ie,se+(se==0?0:1),1-oe),ce=H._findDiff(ie,ne,oe);var xe=0;if(G==1&&(xe=I[V>>>3]>>>7-(7&V)&1),G==2&&(xe=I[V>>>3]>>>(7&V)&1),V++,Q+=xe,me=="H"){if(H._lens[oe][Q]!=null){var Fe=H._lens[oe][Q];Q="",Z+=Fe,Fe<64&&(H._addNtimes(J,Z,oe),se+=Z,oe=1-oe,Z=0,--ge==0&&(me=""))}}else Q=="0001"&&(Q="",H._addNtimes(J,ce-se,oe),se=ce),Q=="001"&&(Q="",me="H",ge=2),H._dmap[Q]!=null&&(X=ne+H._dmap[Q],H._addNtimes(J,X-se,oe),se=X,Q="",oe=1-oe);J.length==j&&me==""&&(H._writeBits(J,U,8*q+de*fe),oe=0,de++,se=0,ie=H._makeDiff(J),J=[])}},w.decode._findDiff=function(I,D,F){for(var U=0;U<I.length;U+=2)if(I[U]>=D&&I[U+1]==F)return I[U]},w.decode._makeDiff=function(I){var D=[];I[0]==1&&D.push(0,1);for(var F=1;F<I.length;F++)I[F-1]!=I[F]&&D.push(F,I[F]);return D.push(I.length,0,I.length,1),D},w.decode._decodeG2=function(I,D,F,U,q,j,G){for(var H=w.decode,V=D<<3,Z=0,Q="",J=[],ie=0,re=0,se=8*Math.ceil(j/8);V>>>3<D+F;){var X=0;G==1&&(X=I[V>>>3]>>>7-(7&V)&1),G==2&&(X=I[V>>>3]>>>(7&V)&1),V++,Q+=X,(Z=H._lens[ie][Q])!=null&&(H._addNtimes(J,Z,ie),Q="",Z<64&&(ie=1-ie),J.length==j&&(H._writeBits(J,U,8*q+re*se),J=[],re++,ie=0,7&V&&(V+=8-(7&V)),Z>=64&&(V+=8)))}},w.decode._decodeG3=function(I,D,F,U,q,j,G,H){for(var V=w.decode,Z=D<<3,Q=0,J="",ie=[],re=[],se=0;se<j;se++)ie.push(0);for(var X=0,ne=0,ce=0,oe=0,de=0,me=-1,ge="",fe=0,xe=!0,Fe=8*Math.ceil(j/8);Z>>>3<D+F;){ce=V._findDiff(re,X+(X==0?0:1),1-de),oe=V._findDiff(re,ce,de);var Te=0;if(G==1&&(Te=I[Z>>>3]>>>7-(7&Z)&1),G==2&&(Te=I[Z>>>3]>>>(7&Z)&1),Z++,J+=Te,xe){if(V._lens[de][J]!=null){var Oe=V._lens[de][J];J="",Q+=Oe,Oe<64&&(V._addNtimes(ie,Q,de),de=1-de,Q=0)}}else ge=="H"?V._lens[de][J]!=null&&(Oe=V._lens[de][J],J="",Q+=Oe,Oe<64&&(V._addNtimes(ie,Q,de),X+=Q,de=1-de,Q=0,--fe==0&&(ge=""))):(J=="0001"&&(J="",V._addNtimes(ie,oe-X,de),X=oe),J=="001"&&(J="",ge="H",fe=2),V._dmap[J]!=null&&(ne=ce+V._dmap[J],V._addNtimes(ie,ne-X,de),X=ne,J="",de=1-de));J.endsWith("000000000001")&&(me>=0&&V._writeBits(ie,U,8*q+me*Fe),H&&(G==1&&(xe=(I[Z>>>3]>>>7-(7&Z)&1)==1),G==2&&(xe=(I[Z>>>3]>>>(7&Z)&1)==1),Z++),J="",de=0,me++,X=0,re=V._makeDiff(ie),ie=[])}ie.length==j&&V._writeBits(ie,U,8*q+me*Fe)},w.decode._addNtimes=function(I,D,F){for(var U=0;U<D;U++)I.push(F)},w.decode._writeBits=function(I,D,F){for(var U=0;U<I.length;U++)D[F+U>>>3]|=I[U]<<7-(F+U&7)},w.decode._decodeLZW=w.decode._decodeLZW=(function(){var I,D,F,U,q=0,j=0,G=0,H=0,V=function(){var se=I>>>3,X=(D[se]<<16|D[se+1]<<8|D[se+2])>>>24-(7&I)-j&(1<<j)-1;return I+=j,X},Z=new Uint32Array(16384),Q=0,J=function(se){j=se+1,q=H+1},ie=function(se){for(var X=se<<2,ne=Z[X+2],ce=U+ne-1;X!=65535;)F[ce--]=Z[X],X=Z[X+1];U+=ne},re=function(se,X){var ne=q<<2,ce=se<<2;Z[ne]=Z[3+(X<<2)],Z[ne+1]=ce,Z[ne+2]=Z[ce+2]+1,Z[ne+3]=Z[ce+3],++q+1==1<<j&&j!=12&&j++};return function(se,X,ne,ce,oe,de){I=X<<3,D=se,F=ce,U=oe;var me=X+ne<<3,ge=0,fe=0;for((function(xe){if(xe!=Q){Q=xe,H=1+(G=1<<xe);for(var Fe=0;Fe<H+1;Fe++)Z[4*Fe]=Z[4*Fe+3]=Fe,Z[4*Fe+1]=65535,Z[4*Fe+2]=1}})(de),J(de);I<me&&(ge=V())!=H;){if(ge==G){if(J(de),(ge=V())==H)break;ie(ge)}else ge<q?(ie(ge),re(fe,ge)):(re(fe,fe),ie(q-1));fe=ge}return U}})(),w.tags={},w._types=(function(){var I=new Array(250);return I.fill(0),{basic:{main:I=I.concat([0,0,0,0,4,3,3,3,3,3,0,0,3,0,0,0,3,0,0,2,2,2,2,4,3,0,0,3,4,4,3,3,5,5,3,2,5,5,0,0,0,0,4,4,0,0,3,3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,2,2,3,5,5,3,0,3,3,4,4,4,3,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),rest:{33432:2,33434:5,33437:5,34665:4,34850:3,34853:4,34855:3,34864:3,34866:4,36864:7,36867:2,36868:2,37121:7,37377:10,37378:5,37380:10,37381:5,37383:3,37384:3,37385:3,37386:5,37510:7,37520:2,37521:2,37522:2,40960:7,40961:3,40962:4,40963:4,40965:4,41486:5,41487:5,41488:3,41985:3,41986:3,41987:3,41988:5,41989:3,41990:3,41993:3,41994:3,41995:7,41996:3,42032:2,42033:2,42034:5,42036:2,42037:2,59932:7}},gps:{main:[1,2,5,2,5,1,5,5,0,9],rest:{18:2,29:2}}}})(),w._readIFD=function(I,D,F,U,q,j){var G=I.readUshort(D,F);F+=2;var H={};j.debug&&g("   ".repeat(q),U.length-1,">>>----------------");for(var V=0;V<G;V++){var Z=I.readUshort(D,F);F+=2;var Q=I.readUshort(D,F);F+=2;var J=I.readUint(D,F);F+=4;var ie=I.readUint(D,F);F+=4;var re=[];if(Q==1||Q==7){var se=J<5?F-4:ie;se+J>D.buffer.byteLength&&(J=D.buffer.byteLength-se),re=new Uint8Array(D.buffer,se,J)}if(Q==2){var X=J<5?F-4:ie,ne=D[X],ce=Math.max(0,Math.min(J-1,D.length-X));ne<128||ce==0?re.push(I.readASCII(D,X,ce)):re=new Uint8Array(D.buffer,X,ce)}if(Q==3)for(var oe=0;oe<J;oe++)re.push(I.readUshort(D,(J<3?F-4:ie)+2*oe));if(Q==4||Q==13)for(oe=0;oe<J;oe++)re.push(I.readUint(D,(J<2?F-4:ie)+4*oe));if(Q==5||Q==10){var de=Q==5?I.readUint:I.readInt;for(oe=0;oe<J;oe++)re.push([de(D,ie+8*oe),de(D,ie+8*oe+4)])}if(Q==8)for(oe=0;oe<J;oe++)re.push(I.readShort(D,(J<3?F-4:ie)+2*oe));if(Q==9)for(oe=0;oe<J;oe++)re.push(I.readInt(D,(J<2?F-4:ie)+4*oe));if(Q==11)for(oe=0;oe<J;oe++)re.push(I.readFloat(D,ie+4*oe));if(Q==12)for(oe=0;oe<J;oe++)re.push(I.readDouble(D,ie+8*oe));if(J==0||re.length!=0){if(j.debug&&g("   ".repeat(q),Z,Q,w.tags[Z],re),H["t"+Z]=re,!(Z==330&&H.t272&&H.t272[0]=="DSLR-A100")){if(Z==330||Z==34665||Z==34853||Z==50740&&I.readUshort(D,I.readUint(re,0))<300||Z==61440){var me=Z==50740?[I.readUint(re,0)]:re,ge=[];for(oe=0;oe<me.length;oe++)w._readIFD(I,D,me[oe],ge,q+1,j);Z==330&&(H.subIFD=ge),Z==34665&&(H.exifIFD=ge[0]),Z==34853&&(H.gpsiIFD=ge[0]),Z==50740&&(H.dngPrvt=ge[0]),Z==61440&&(H.fujiIFD=ge[0])}}if(Z==37500&&j.parseMN){var fe=re;if(I.readASCII(fe,0,5)=="Nikon")H.makerNote=w.decode(fe.slice(10).buffer)[0];else if(I.readASCII(fe,0,5)=="OLYMP"||I.readASCII(fe,0,9)=="OM SYSTEM"){var xe=[8208,8224,8240,8256,8272],Fe=[];w._readIFD(I,fe,fe[1]==77?16:fe[5]==85?12:8,Fe,q+1,j);var Te=H.makerNote=Fe.pop();for(oe=0;oe<xe.length;oe++){var Oe="t"+xe[oe];Te[Oe]!=null&&(w._readIFD(I,fe,Te[Oe][0],Fe,q+1,j),Te[Oe]=Fe.pop())}Te.t12288&&(w._readIFD(I,Te.t12288,0,Fe,q+1,j),Te.t12288=Fe.pop())}else I.readUshort(D,ie)<300&&I.readUshort(D,ie+4)<=12&&(Fe=[],w._readIFD(I,D,ie,Fe,q+1,j),H.makerNote=Fe[0])}}else if(g(Z,"unknown TIFF tag type: ",Q,"num:",J),V==0)return}return U.push(H),j.debug&&g("   ".repeat(q),"<<<---------------"),F},w._writeIFD=function(I,D,F,U,q){var j=Object.keys(q),G=j.length;q.exifIFD&&G--,q.gpsiIFD&&G--,I.writeUshort(F,U,G);for(var H=(U+=2)+12*G+4,V=0;V<j.length;V++){var Z=j[V];if(Z!="t34665"&&Z!="t34853"){Z=="exifIFD"&&(Z="t34665"),Z=="gpsiIFD"&&(Z="t34853");var Q=parseInt(Z.slice(1)),J=D.main[Q];if(J==null&&(J=D.rest[Q]),J==null||J==0)throw new Error("unknown type of tag: "+Q);var ie=q[Z];Q==34665&&(ie=[H],H=w._writeIFD(I,D,F,H,q.exifIFD)[1]),Q==34853&&(ie=[H],H=w._writeIFD(I,w._types.gps,F,H,q.gpsiIFD)[1]),J==2&&(ie=ie[0]+"\0");var re=ie.length;I.writeUshort(F,U,Q),U+=2,I.writeUshort(F,U,J),U+=2,I.writeUint(F,U,re);var se=[-1,1,1,2,4,8,0,1,0,4,8,0,8][J]*re,X=U+=4;if(se>4&&(I.writeUint(F,U,H),X=H),J==1||J==7)for(var ne=0;ne<re;ne++)F[X+ne]=ie[ne];else if(J==2)I.writeASCII(F,X,ie);else if(J==3)for(ne=0;ne<re;ne++)I.writeUshort(F,X+2*ne,ie[ne]);else if(J==4)for(ne=0;ne<re;ne++)I.writeUint(F,X+4*ne,ie[ne]);else if(J==5||J==10){var ce=J==5?I.writeUint:I.writeInt;for(ne=0;ne<re;ne++){var oe=ie[ne],de=oe[0],me=oe[1];if(de==null)throw"e";ce(F,X+8*ne,de),ce(F,X+8*ne+4,me)}}else if(J==9)for(ne=0;ne<re;ne++)I.writeInt(F,X+4*ne,ie[ne]);else{if(J!=12)throw J;for(ne=0;ne<re;ne++)I.writeDouble(F,X+8*ne,ie[ne])}se>4&&(H+=se+=1&se),U+=4}}return[U,H]},w.toRGBA8=function(I,D){function F(li){return li<.0031308?12.92*li:1.055*Math.pow(li,1/2.4)-.055}var U=I.width,q=I.height,j=U*q,G=I.data,H=new Uint8Array(4*j),V=I.t262?I.t262[0]:2,Z=I.t258?Math.min(32,I.t258[0]):1;I.t262==null&&Z==1&&(V=0);var Q=I.t277?I.t277[0]:I.t258?I.t258.length:[1,1,3,1,1,4,3][V],J=I.t339?I.t339[0]:null;if(V==1&&Z==32&&J!=3)throw"e";var ie=Math.ceil(Q*Z*U/8);if(V==0){D=1/256;for(var re=0;re<q;re++){var se=re*ie,X=re*U;if(Z==1)for(var ne=0;ne<U;ne++){var ce=X+ne<<2,oe=G[se+(ne>>3)]>>7-(7&ne)&1;H[ce]=H[ce+1]=H[ce+2]=255*(1-oe),H[ce+3]=255}if(Z==4)for(ne=0;ne<U;ne++)ce=X+ne<<2,oe=G[se+(ne>>1)]>>4-4*(1&ne)&15,H[ce]=H[ce+1]=H[ce+2]=17*(15-oe),H[ce+3]=255;if(Z==8)for(ne=0;ne<U;ne++)ce=X+ne<<2,oe=G[se+ne],H[ce]=H[ce+1]=H[ce+2]=255-oe,H[ce+3]=255;if(Z==16)for(ne=0;ne<U;ne++)ce=X+ne<<2,oe=G[(me=se+2*ne)+1]<<8|G[me],H[ce]=H[ce+1]=H[ce+2]=Math.min(255,255-~~(oe*D)),H[ce+3]=255}}else if(V==1){D==null&&(D=1/256);var de=3&G.length?null:new Float32Array(G.buffer);for(re=0;re<q;re++){if(se=re*ie,X=re*U,Z==1)for(ne=0;ne<U;ne++)ce=X+ne<<2,oe=G[se+(ne>>3)]>>7-(7&ne)&1,H[ce]=H[ce+1]=H[ce+2]=255*oe,H[ce+3]=255;if(Z==2)for(ne=0;ne<U;ne++)ce=X+ne<<2,oe=G[se+(ne>>2)]>>6-2*(3&ne)&3,H[ce]=H[ce+1]=H[ce+2]=85*oe,H[ce+3]=255;if(Z==8)for(ne=0;ne<U;ne++)ce=X+ne<<2,oe=G[se+ne*Q],H[ce]=H[ce+1]=H[ce+2]=oe,H[ce+3]=255;if(Z==16)for(ne=0;ne<U;ne++)ce=X+ne<<2,oe=G[(me=se+2*ne)+1]<<8|G[me],H[ce]=H[ce+1]=H[ce+2]=Math.min(255,~~(oe*D)),H[ce+3]=255;if(Z==32)for(ne=0;ne<U;ne++){var me;ce=X+ne<<2,oe=de[me=(se>>>2)+ne],H[ce]=H[ce+1]=H[ce+2]=~~(.5+255*oe),H[ce+3]=255}}}else if(V==2)if(Z==8){if(Q==1)for(ne=0;ne<j;ne++)H[4*ne]=H[4*ne+1]=H[4*ne+2]=G[ne],H[4*ne+3]=255;if(Q==3)for(ne=0;ne<j;ne++){var ge=3*ne;H[ce=ne<<2]=G[ge],H[ce+1]=G[ge+1],H[ce+2]=G[ge+2],H[ce+3]=255}if(Q>=4)for(ne=0;ne<j;ne++)ge=ne*Q,H[ce=ne<<2]=G[ge],H[ce+1]=G[ge+1],H[ce+2]=G[ge+2],H[ce+3]=G[ge+3]}else if(Z==16){if(Q==4)for(ne=0;ne<j;ne++)ge=8*ne+1,H[ce=ne<<2]=G[ge],H[ce+1]=G[ge+2],H[ce+2]=G[ge+4],H[ce+3]=G[ge+6];if(Q==3)for(ne=0;ne<j;ne++)ge=6*ne+1,H[ce=ne<<2]=G[ge],H[ce+1]=G[ge+2],H[ce+2]=G[ge+4],H[ce+3]=255}else{if(Z!=32)throw Z;var fe=new Float32Array(G.buffer),xe=0;for(ne=0;ne<fe.length;ne++)xe=Math.min(xe,fe[ne]);if(xe<0)for(ne=0;ne<G.length;ne+=4){var Fe=G[ne];G[ne]=G[ne+3],G[ne+3]=Fe,Fe=G[ne+1],G[ne+1]=G[ne+2],G[ne+2]=Fe}var Te=[];for(ne=0;ne<65536;ne++)Te.push(F(ne/65535));for(ne=0;ne<fe.length;ne++){var Oe=Math.max(0,Math.min(1,fe[ne]));fe[ne]=Te[~~(.5+65535*Oe)]}if(Q==3)for(ne=0;ne<j;ne++)ge=3*ne,H[ce=ne<<2]=~~(.5+255*fe[ge]),H[ce+1]=~~(.5+255*fe[ge+1]),H[ce+2]=~~(.5+255*fe[ge+2]),H[ce+3]=255;else{if(Q!=4)throw Q;for(ne=0;ne<j;ne++)ge=4*ne,H[ce=ne<<2]=~~(.5+255*fe[ge]),H[ce+1]=~~(.5+255*fe[ge+1]),H[ce+2]=~~(.5+255*fe[ge+2]),H[ce+3]=~~(.5+255*fe[ge+3])}}else if(V==3){var Be=I.t320,_t=1<<Z,Et=Z==8&&Q>1&&I.t338&&I.t338[0]!=0;for(re=0;re<q;re++)for(var dt=0;dt<U;dt++){ce=(ne=re*U+dt)<<2;var Zt=0,Ye=re*ie;if(Z==1)Zt=G[Ye+(dt>>>3)]>>>7-(7&dt)&1;else if(Z==2)Zt=G[Ye+(dt>>>2)]>>>6-2*(3&dt)&3;else if(Z==4)Zt=G[Ye+(dt>>>1)]>>>4-4*(1&dt)&15;else{if(Z!=8)throw Z;Zt=G[Ye+dt*Q]}H[ce]=Be[Zt]>>8,H[ce+1]=Be[_t+Zt]>>8,H[ce+2]=Be[_t+_t+Zt]>>8,H[ce+3]=Et?G[Ye+dt*Q+1]:255}}else if(V==5){var bt=Q>4?1:0;for(ne=0;ne<j;ne++){ce=ne<<2;var Qt=ne*Q;if(window.UDOC){var Vt=G[Qt],ut=G[Qt+1],At=G[Qt+2],dr=G[Qt+3],fr=UDOC.C.cmykToRgb([Vt*(1/255),ut*(1/255),At*(1/255),dr*(1/255)]);H[ce]=~~(.5+255*fr[0]),H[ce+1]=~~(.5+255*fr[1]),H[ce+2]=~~(.5+255*fr[2])}else Vt=255-G[Qt],ut=255-G[Qt+1],At=255-G[Qt+2],dr=(255-G[Qt+3])*(1/255),H[ce]=~~(Vt*dr+.5),H[ce+1]=~~(ut*dr+.5),H[ce+2]=~~(At*dr+.5);H[ce+3]=255*(1-bt)+G[Qt+4]*bt}}else if(V==6&&I.t278){var pr=I.t278[0];for(re=0;re<q;re+=pr){ne=re*U;for(var zt=pr*U,Ce=0;Ce<zt;Ce++){ce=4*(ne+Ce),At=G[(Qt=3*ne+4*(Ce>>>1))+(1&Ce)];var Nt=G[Qt+2]-128,Xe=G[Qt+3]-128,lt=At+((Xe>>2)+(Xe>>3)+(Xe>>5)),st=At-((Nt>>2)+(Nt>>4)+(Nt>>5))-((Xe>>1)+(Xe>>3)+(Xe>>4)+(Xe>>5)),yt=At+(Nt+(Nt>>1)+(Nt>>2)+(Nt>>6));H[ce]=Math.max(0,Math.min(255,lt)),H[ce+1]=Math.max(0,Math.min(255,st)),H[ce+2]=Math.max(0,Math.min(255,yt)),H[ce+3]=255}}}else if(V==32845)for(re=0;re<q;re++)for(dt=0;dt<U;dt++){ce=4*(re*U+dt);var Yt=G[(Qt=6*(re*U+dt))+1]<<8|G[Qt],$e=(Yt=Math.pow(2,(Yt+.5)/256-64),(G[Qt+3]+.5)/410),ze=(G[Qt+5]+.5)/410,ft=9*$e/(6*$e-16*ze+12),ht=4*ze/(6*$e-16*ze+12),gr=ft*Yt/ht,yr=(1-ft-ht)*Yt/ht;lt=2.69*gr-1.276*(At=Yt)-.414*yr,st=-1.022*gr+1.978*At+.044*yr,yt=.061*gr-.224*At+1.163*yr,H[ce]=255*F(Math.min(lt,1)),H[ce+1]=255*F(Math.min(st,1)),H[ce+2]=255*F(Math.min(yt,1)),H[ce+3]=255}else g("Unknown Photometric interpretation: "+V);return H},w.replaceIMG=function(I){I==null&&(I=document.getElementsByTagName("img"));for(var D=["tif","tiff","dng","cr2","nef"],F=0;F<I.length;F++){var U=I[F],q=U.getAttribute("src");if(q!=null){var j=q.split(".").pop().toLowerCase();if(D.indexOf(j)!=-1){var G=new XMLHttpRequest;w._xhrs.push(G),w._imgs.push(U),G.open("GET",q),G.responseType="arraybuffer",G.onload=w._imgLoaded,G.send()}}}},w._xhrs=[],w._imgs=[],w._imgLoaded=function(I){var D=w._xhrs.indexOf(I.target),F=w._imgs[D];w._xhrs.splice(D,1),w._imgs.splice(D,1),F.setAttribute("src",w.bufferToURI(I.target.response))},w.bufferToURI=function(I){var D=w.decode(I),F=D,U=0,q=F[0];D[0].subIFD&&(F=F.concat(D[0].subIFD));for(var j=0;j<F.length;j++){var G=F[j];if(!(G.t258==null||G.t258.length<3)){var H=G.t256*G.t257;H>U&&(U=H,q=G)}}w.decodeImage(I,q,D);var V=w.toRGBA8(q),Z=q.width,Q=q.height,J=document.createElement("canvas");J.width=Z,J.height=Q;var ie=J.getContext("2d"),re=new ImageData(new Uint8ClampedArray(V.buffer),Z,Q);return ie.putImageData(re,0,0),J.toDataURL()},w._binBE={nextZero:function(I,D){for(;I[D]!=0;)D++;return D},readUshort:function(I,D){return I[D]<<8|I[D+1]},readShort:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+1],F[1]=I[D+0],w._binBE.i16[0]},readInt:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+3],F[1]=I[D+2],F[2]=I[D+1],F[3]=I[D+0],w._binBE.i32[0]},readUint:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+3],F[1]=I[D+2],F[2]=I[D+1],F[3]=I[D+0],w._binBE.ui32[0]},readASCII:function(I,D,F){for(var U="",q=0;q<F;q++)U+=String.fromCharCode(I[D+q]);return U},readFloat:function(I,D){for(var F=w._binBE.ui8,U=0;U<4;U++)F[U]=I[D+3-U];return w._binBE.fl32[0]},readDouble:function(I,D){for(var F=w._binBE.ui8,U=0;U<8;U++)F[U]=I[D+7-U];return w._binBE.fl64[0]},writeUshort:function(I,D,F){I[D]=F>>8&255,I[D+1]=255&F},writeInt:function(I,D,F){var U=w._binBE.ui8;w._binBE.i32[0]=F,I[D+3]=U[0],I[D+2]=U[1],I[D+1]=U[2],I[D+0]=U[3]},writeUint:function(I,D,F){I[D]=F>>24&255,I[D+1]=F>>16&255,I[D+2]=F>>8&255,I[D+3]=255&F},writeASCII:function(I,D,F){for(var U=0;U<F.length;U++)I[D+U]=F.charCodeAt(U)},writeDouble:function(I,D,F){w._binBE.fl64[0]=F;for(var U=0;U<8;U++)I[D+U]=w._binBE.ui8[7-U]}},w._binBE.ui8=new Uint8Array(8),w._binBE.i16=new Int16Array(w._binBE.ui8.buffer),w._binBE.i32=new Int32Array(w._binBE.ui8.buffer),w._binBE.ui32=new Uint32Array(w._binBE.ui8.buffer),w._binBE.fl32=new Float32Array(w._binBE.ui8.buffer),w._binBE.fl64=new Float64Array(w._binBE.ui8.buffer),w._binLE={nextZero:w._binBE.nextZero,readUshort:function(I,D){return I[D+1]<<8|I[D]},readShort:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+0],F[1]=I[D+1],w._binBE.i16[0]},readInt:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+0],F[1]=I[D+1],F[2]=I[D+2],F[3]=I[D+3],w._binBE.i32[0]},readUint:function(I,D){var F=w._binBE.ui8;return F[0]=I[D+0],F[1]=I[D+1],F[2]=I[D+2],F[3]=I[D+3],w._binBE.ui32[0]},readASCII:w._binBE.readASCII,readFloat:function(I,D){for(var F=w._binBE.ui8,U=0;U<4;U++)F[U]=I[D+U];return w._binBE.fl32[0]},readDouble:function(I,D){for(var F=w._binBE.ui8,U=0;U<8;U++)F[U]=I[D+U];return w._binBE.fl64[0]},writeUshort:function(I,D,F){I[D]=255&F,I[D+1]=F>>8&255},writeInt:function(I,D,F){var U=w._binBE.ui8;w._binBE.i32[0]=F,I[D+0]=U[0],I[D+1]=U[1],I[D+2]=U[2],I[D+3]=U[3]},writeUint:function(I,D,F){I[D]=F>>>0&255,I[D+1]=F>>>8&255,I[D+2]=F>>>16&255,I[D+3]=F>>>24&255},writeASCII:w._binBE.writeASCII},w._copyTile=function(I,D,F,U,q,j,G,H){for(var V=Math.min(D,q-G),Z=Math.min(F,j-H),Q=0;Q<Z;Q++)for(var J=(H+Q)*q+G,ie=Q*D,re=0;re<V;re++)U[J+re]=I[ie+re]},w.LosslessJpegDecode=(function(){var I,D;function F(){return I[D++]}function U(){return I[D++]<<8|I[D++]}function q(se){for(var X=F(),ne=[0,0,0,255],ce=[],oe=0;oe<16;oe++)ce[oe]=F();for(oe=0;oe<16;oe++)for(var de=0;de<ce[oe];de++)ne[j(ne,0,oe+1,1)+3]=F();var me=new Uint8Array(256);for(se[X]=[new Uint8Array(ne),me],oe=0;oe<256;oe++){for(var ge=8,fe=oe,xe=0;ne[xe+3]==255&&ge!=0;)xe=ne[xe+(fe>>--ge&1)];me[oe]=xe}}function j(se,X,ne,ce){if(se[X+3]!=255)return 0;if(ne==0)return X;for(var oe=0;oe<2;oe++){se[X+oe]==0&&(se[X+oe]=se.length,se.push(0,0,ce,255));var de=j(se,se[X+oe],ne-1,ce+1);if(de!=0)return de}return 0}function G(se){for(var X=se.b,ne=se.f;X<25&&se.a<se.d;){var ce=se.data[se.a++];ce!=255||se.c||se.a++,ne=ne<<8|ce,X+=8}if(X<0)throw"e";se.b=X,se.f=ne}function H(se,X){return X.b<se&&G(X),X.f>>(X.b-=se)&65535>>16-se}function V(se,X){var ne=se[0],ce=0,oe=255;X.b<16&&G(X);var de=X.f>>X.b-8&255;for(oe=ne[(ce=se[1][de])+3],X.b-=ne[ce+2];oe==255;)oe=ne[(ce=ne[ce+(X.f>>--X.b&1)])+3];return oe}function Z(se,X){return se<32768>>16-X&&(se+=1-(1<<X)),se}function Q(se,X){var ne=V(se,X);return ne==0?0:ne==16?-32768:Z(H(ne,X),ne)}function J(se,X,ne,ce,oe,de){for(var me=0,ge=0;ge<de;ge++){for(var fe=ge*X,xe=0;xe<X;xe+=oe){me++;for(var Fe=0;Fe<oe;Fe++)se[fe+xe+Fe]=Q(ce[Fe],ne)}if(ne.e!=0&&me%ne.e==0&&ge!=0){for(var Te=ne.a,Oe=ne.data;Oe[Te]!=255||!(208<=Oe[Te+1]&&Oe[Te+1]<=215);)Te--;ne.a=Te+2,ne.f=0,ne.b=0}}}function ie(se,X){return Z(H(se,X),se)}function re(se,X,ne,ce,oe,de,me,ge){for(var fe=ne*me,xe=oe;xe<de;xe++)se[xe]+=1<<ge-1;for(var Fe=me;Fe<fe;Fe+=me)for(xe=oe;xe<de;xe++)se[Fe+xe]+=se[Fe+xe-me];for(var Te=1;Te<ce;Te++){var Oe=Te*fe;for(xe=oe;xe<de;xe++)se[Oe+xe]+=se[Oe+xe-fe];for(Fe=me;Fe<fe;Fe+=me)for(xe=oe;xe<de;xe++){var Be=Oe+Fe+xe,_t=Be-fe,Et=se[Be-me],dt=0;if(X==0)dt=0;else if(X==1)dt=Et;else if(X==2)dt=se[_t];else if(X==3)dt=se[_t-me];else if(X==4)dt=Et+(se[_t]-se[_t-me]);else if(X==5)dt=Et+(se[_t]-se[_t-me]>>>1);else if(X==6)dt=se[_t]+(Et-se[_t-me]>>>1);else{if(X!=7)throw X;dt=Et+se[_t]>>>1}se[Be]+=dt}}}return function(se){if(I=se,D=0,U()!=65496)throw"e";for(var X=[],ne=0,ce=0,oe=0,de=[],me=[],ge=[],fe=0,xe=0,Fe=0;;){var Te=U();if(Te!=65535){var Oe=U();if(Te==65475){ce=F(),xe=U(),Fe=U(),fe=F();for(var Be=0;Be<fe;Be++){var _t=F(),Et=F();if(F()!=0)throw"e";X[_t]=[Be,Et>>4,15&Et]}}else if(Te==65476)for(var dt=D+Oe-2;D<dt;)q(me);else{if(Te==65498){for(D++,Be=0;Be<fe;Be++){var Zt=X[F()];ge[Zt[0]]=me[F()>>>4],de[Zt[0]]=Zt.slice(1)}ne=F(),D+=2;break}Te==65501?oe=U():D+=Oe-2}}else D--}var Ye=new(ce>8?Uint16Array:Uint8Array)(xe*Fe*fe),bt={b:0,f:0,c:ne==8,a:D,data:I,d:I.length,e:oe};if(bt.c)(function(gr,yr,li,fi,ai){for(var hi=I.length-D,ui=0;ui<hi;ui+=4){var vi=I[D+ui];I[D+ui]=I[D+ui+3],I[D+ui+3]=vi,vi=I[D+ui+1],I[D+ui+1]=I[D+ui+2],I[D+ui+2]=vi}for(var bi=0;bi<ai;bi++)for(var _i=32768,ki=32768,yi=0;yi<yr;yi+=2){var cr=V(fi,li),di=V(fi,li);cr!=0&&(_i+=ie(cr,li)),di!=0&&(ki+=ie(di,li)),gr[bi*yr+yi]=65535&_i,gr[bi*yr+yi+1]=65535&ki}})(Ye,Fe*fe,bt,ge[0],xe);else{var Qt=[],Vt=0,ut=0;for(Be=0;Be<fe;Be++){var At=de[Be];(yt=At[0])>Vt&&(Vt=yt),(st=At[1])>ut&&(ut=st),Qt.push(yt*st)}if(Vt!=1||ut!=1){if(fe!=3||Qt[1]!=1||Qt[2]!=1||Vt!=2||ut!=1&&ut!=2)throw"e";var dr=[],fr=0;for(Be=0;Be<fe;Be++){for(var pr=0;pr<Qt[Be];pr++)dr.push(ge[Be]);fr+=Qt[Be]}var zt=Fe/Vt,Ce=xe/ut,Nt=zt*Ce;J(Ye,zt*fr,bt,dr,fr,Ce),re(Ye,ne,zt,Ce,fr-2,fr,fr,ce);var Xe=new Uint16Array(Nt*Qt[0]);if(Vt==2&&ut==2){for(Be=0;Be<Nt;Be++)Xe[4*Be]=Ye[6*Be],Xe[4*Be+1]=Ye[6*Be+1],Xe[4*Be+2]=Ye[6*Be+2],Xe[4*Be+3]=Ye[6*Be+3];for(re(Xe,ne,4*zt,Ce,0,1,1,ce),Be=0;Be<Nt;Be++)Ye[6*Be]=Xe[4*Be],Ye[6*Be+1]=Xe[4*Be+1],Ye[6*Be+2]=Xe[4*Be+2],Ye[6*Be+3]=Xe[4*Be+3]}if(Vt==2&&ut==1){for(Be=0;Be<Nt;Be++)Xe[2*Be]=Ye[4*Be],Xe[2*Be+1]=Ye[4*Be+1];for(re(Xe,ne,2*zt,Ce,0,1,1,ce),Be=0;Be<Nt;Be++)Ye[4*Be]=Xe[2*Be],Ye[4*Be+1]=Xe[2*Be+1]}for(var lt=Ye.slice(0),st=0;st<xe;st++)if(ut==2)for(var yt=0;yt<Fe;yt++){var Yt=((st>>>1)*zt+(yt>>>1))*fr,$e=2*(1&st)+(1&yt);Ye[ze=(st*Fe+yt)*fe]=lt[Yt+$e],Ye[ze+1]=lt[Yt+4],Ye[ze+2]=lt[Yt+5]}else for(yt=0;yt<Fe;yt++){var ze;Yt=(st*zt+(yt>>>1))*fr,$e=1&yt,Ye[ze=(st*Fe+yt)*fe]=lt[Yt+$e],Ye[ze+1]=lt[Yt+2],Ye[ze+2]=lt[Yt+3]}}else if(J(Ye,Fe*fe,bt,ge,fe,xe),oe==0)re(Ye,ne,Fe,xe,0,fe,fe,ce);else{var ft=Math.floor(oe/Fe);for(st=0;st<xe;st+=ft){var ht=Ye.slice(st*Fe*fe,(st+ft)*Fe*fe);re(ht,ne,Fe,ft,0,fe,fe,ce),Ye.set(ht,st*Fe*fe)}}}return Ye}})(),(function(){var I=2,D=4,F=5,U=6,q=7,j=12,G=13,H=14,V=15,Z=17;function Q(de){var me={c:new Int8Array(2<<de.u)};return(function(ge,fe,xe){var Fe=[fe,3*fe+18,5*fe+67,7*fe+276,xe];ge.o=fe,ge.w=(Fe[4]+2*fe)/(2*fe+1)+1|0,ge.v=Math.ceil(Math.log2(ge.w)),ge.t=9,(function(Te,Oe){for(var Be=-Oe[4],_t=0;Be<=Oe[4];_t++,Be++)Te[_t]=Be<=-276?-4:Be<=-67?-3:Be<=-18?-2:Be<-0?-1:Be<=Oe[0]?0:Be<Oe[1]?1:Be<Oe[2]?2:Be<Oe[3]?3:4})(ge.c,Fe)})(me,0,de.g),me}function J(de){for(var me=[[],[],[]],ge=Math.max(2,de.w+32>>>6),fe=0;fe<3;fe++)for(var xe=0;xe<41;xe++)me[fe][xe]=[ge,1];return me}function ie(de,me){var ge=0,fe=8-de.a;if(de.j,de.a,me){if(me>=fe)do ge<<=fe,me-=fe,ge|=de[de.j]&(1<<fe)-1,de.j++,fe=8;while(me>=8);me&&(ge<<=me,fe-=me,ge|=de[de.j]>>>fe&(1<<me)-1),de.a=8-fe}return ge}function re(de,me,ge,fe,xe,Fe,Te,Oe){Oe==null&&(Oe=0);var Be,_t,Et,dt,Zt,Ye,bt=Fe+1,Qt=bt%2,Vt=0,ut=fe[xe],At=fe[xe-1],dr=fe[xe-2][bt],fr=At[bt-1],pr=At[bt],zt=At[bt+1],Ce=ut[bt-1],Nt=ut[bt+1],Xe=Math.abs;if(Qt&&(Et=Xe(zt-pr),dt=Xe(dr-pr),Zt=Xe(fr-pr)),Qt){if(Ye=(Ye=Et>Zt&&dt<Et?dr+fr:Et<Zt&&dt<Zt?dr+zt:zt+fr)+2*pr>>>2,Oe)return void(ut[bt]=Ye);Be=me.t*me.c[de.g+pr-dr]+me.c[de.g+fr-pr]}else Ye=pr>fr&&pr>zt||pr<fr&&pr<zt?Nt+Ce+2*pr>>>2:Ce+Nt>>>1,Be=me.t*me.c[de.g+pr-fr]+me.c[de.g+fr-Ce];_t=Xe(Be);var lt=(function(yt){for(var Yt=-1,$e=0;!$e;Yt++)$e=yt[yt.j]>>>7-yt.a&1,yt.a++,yt.a&=7,yt.a||yt.j++;return Yt})(ge);if(lt<de.n-me.v-1){var st=(function(yt,Yt){var $e=0;if(Yt<yt)for(;$e<=14&&Yt<<++$e<yt;);return $e})(Te[_t][0],Te[_t][1]);Vt=ie(ge,st)+(lt<<st)}else Vt=ie(ge,me.v)+1;Vt=1&Vt?-1-(Vt>>>1):Vt>>>1,Te[_t][0]+=Xe(Vt),Te[_t][1]==de.f&&(Te[_t][0]>>>=1,Te[_t][1]>>>=1),Te[_t][1]++,Ye=Be<0?Ye-Vt:Ye+Vt,de.i&&(Ye<0?Ye+=me.w:Ye>de.g&&(Ye-=me.w)),ut[bt]=Ye>=0?Math.min(Ye,de.g):0}function se(de,me,ge){for(var fe=de[0].length,xe=me;xe<=ge;xe++)de[xe][0]=de[xe-1][1],de[xe][fe-1]=de[xe-1][fe-2]}function X(de){se(de,q,j),se(de,I,D),se(de,V,Z)}function ne(de,me,ge,fe,xe,Fe,Te,Oe,Be,_t,Et,dt,Zt){for(var Ye=0,bt=1,Qt=xe<G&&xe>D;bt<de.m;)Ye<de.m&&(re(de,me,ge,fe,xe,Ye,Te[Be],de.h&&(Qt&&_t||!Qt&&(Et||(Ye&dt)==Zt))),re(de,me,ge,fe,Fe,Ye,Te[Be],de.h&&(!Qt&&_t||Qt&&(Et||(Ye&dt)==Zt))),Ye+=2),Ye>8&&(re(de,me,ge,fe,xe,bt,Oe[Be]),re(de,me,ge,fe,Fe,bt,Oe[Be]),bt+=2);X(fe)}function ce(de,me,ge,fe,xe,Fe){ne(de,me,ge,fe,I,q,xe,Fe,0,0,1,0,8),ne(de,me,ge,fe,8,V,xe,Fe,1,0,1,0,8),ne(de,me,ge,fe,3,9,xe,Fe,2,1,0,3,0),ne(de,me,ge,fe,10,16,xe,Fe,0,0,0,3,2),ne(de,me,ge,fe,D,11,xe,Fe,1,0,0,3,2),ne(de,me,ge,fe,j,Z,xe,Fe,2,1,0,3,0)}function oe(de,me,ge,fe,xe,Fe){var Te=Fe.length,Oe=de.l;xe+1==de.s&&(Oe=de.e-xe*de.l);for(var Be=6*de.e*fe+xe*de.l,_t=0;_t<6;_t++){for(var Et=0;Et<Oe;Et++){var dt,Zt=Fe[_t%Te][Et%Te];dt=Zt==0?I+(_t>>>1):Zt==2?V+(_t>>>1):q+_t;var Ye=de.h?(2*Et/3&2147483646|Et%3&1)+(Et%3>>>1):Et>>>1;me[Be+Et]=ge[dt][Ye+1]}Be+=de.e}}w._decompressRAF=function(de,me){var ge=(function(bt){var Qt=w._binBE.readUshort,Vt={b:Qt(bt,0),i:bt[2],C:bt[3],u:bt[4],q:Qt(bt,5),k:Qt(bt,7),e:Qt(bt,9),l:Qt(bt,11),s:bt[13],d:Qt(bt,14)};if(Vt.b!=18771||Vt.i>1||Vt.q<6||Vt.q%6||Vt.e<768||Vt.e%24||Vt.l!=768||Vt.k<Vt.l||Vt.k%Vt.l||Vt.k-Vt.e>=Vt.l||Vt.s>16||Vt.s!=Vt.k/Vt.l||Vt.s!=Math.ceil(Vt.e/Vt.l)||Vt.d!=Vt.q/6||Vt.u!=12&&Vt.u!=14&&Vt.u!=16||Vt.C!=16&&Vt.C!=0)throw"Invalid data";if(Vt.i==0)throw"Not implemented. We need this file!";return Vt.h=Vt.C==16,Vt.m=0|(Vt.h?2*Vt.l/3:Vt.l>>>1),Vt.A=Vt.m+2,Vt.f=64,Vt.g=(1<<Vt.u)-1,Vt.n=4*Vt.u,Vt})(de),fe=(function(bt,Qt){var Vt=new Array(Qt.s),ut=4*Qt.s,At=16+ut;12&ut&&(At+=16-(12&ut));for(var dr=0,fr=16;dr<Qt.s;fr+=4){var pr=w._binBE.readUint(bt,fr);Vt[dr]=bt.slice(At,At+pr),Vt[dr].j=0,Vt[dr].a=0,At+=pr,dr++}if(At!=bt.length)throw"Invalid data";return Vt})(de,ge),xe=Q(ge),Fe=new Int16Array(ge.e*ge.q);me==null&&(me=ge.h?[[1,1,0,1,1,2],[1,1,2,1,1,0],[2,0,1,0,2,1],[1,1,2,1,1,0],[1,1,0,1,1,2],[0,2,1,2,0,1]]:[[0,1],[3,2]]);for(var Te=[[0,3],[1,D],[F,11],[U,j],[G,16],[H,Z]],Oe=[],Be=0;Be<18;Be++)Oe[Be]=new Uint16Array(ge.A);for(var _t=0;_t<ge.s;_t++){var Et=J(xe),dt=J(xe);for(Be=0;Be<18;Be++)for(var Zt=0;Zt<ge.A;Zt++)Oe[Be][Zt]=0;for(var Ye=0;Ye<ge.d;Ye++){for(ce(ge,xe,fe[_t],Oe,Et,dt),Be=0;Be<6;Be++)for(Zt=0;Zt<ge.A;Zt++)Oe[Te[Be][0]][Zt]=Oe[Te[Be][1]][Zt];for(oe(ge,Fe,Oe,Ye,_t,me),Be=I;Be<18;Be++)if([F,U,G,H].indexOf(Be)==-1)for(Zt=0;Zt<ge.A;Zt++)Oe[Be][Zt]=0;X(Oe)}}return Fe}})()})(m,typeof commonjsRequire=="function"?requirePako():self.pako)})()})(UTIF);var UTIFExports=UTIF.exports,utif=getDefaultExportFromCjs(UTIFExports),util$1,objectUtil;function getDimensionValue(d){return typeof d=="number"?d:d instanceof Uint8Array?d[0]:typeof d[0]=="string"?parseInt(d[0]):d[0]}function tiff(){return{mime:"image/tiff",encode:d=>{const m=utif.encodeImage(d.data,d.width,d.height);return Buffer.from(m)},decode:d=>{const m=utif.decode(d),g=m[0];if(!g)throw new Error("No page found in TIFF");if(!g.t256)throw new Error("No image width found in TIFF");if(!g.t257)throw new Error("No image height found in TIFF");m.forEach(($=>{utif.decodeImage(d,$)}));const w=utif.toRGBA8(g);return{data:Buffer.from(w),width:getDimensionValue(g.t256),height:getDimensionValue(g.t257)}}}}(function(d){d.assertEqual=m=>m,d.assertIs=function(m){},d.assertNever=function(m){throw new Error},d.arrayToEnum=m=>{const g={};for(const w of m)g[w]=w;return g},d.getValidEnumValues=m=>{const g=d.objectKeys(m).filter(($=>typeof m[m[$]]!="number")),w={};for(const $ of g)w[$]=m[$];return d.objectValues(w)},d.objectValues=m=>d.objectKeys(m).map((function(g){return m[g]})),d.objectKeys=typeof Object.keys=="function"?m=>Object.keys(m):m=>{const g=[];for(const w in m)Object.prototype.hasOwnProperty.call(m,w)&&g.push(w);return g},d.find=(m,g)=>{for(const w of m)if(g(w))return w},d.isInteger=typeof Number.isInteger=="function"?m=>Number.isInteger(m):m=>typeof m=="number"&&isFinite(m)&&Math.floor(m)===m,d.joinValues=function(m,g=" | "){return m.map((w=>typeof w=="string"?`'${w}'`:w)).join(g)},d.jsonStringifyReplacer=(m,g)=>typeof g=="bigint"?g.toString():g})(util$1||(util$1={})),(function(d){d.mergeShapes=(m,g)=>({...m,...g})})(objectUtil||(objectUtil={}));const ZodParsedType=util$1.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=d=>{switch(typeof d){case"undefined":return ZodParsedType.undefined;case"string":return ZodParsedType.string;case"number":return isNaN(d)?ZodParsedType.nan:ZodParsedType.number;case"boolean":return ZodParsedType.boolean;case"function":return ZodParsedType.function;case"bigint":return ZodParsedType.bigint;case"symbol":return ZodParsedType.symbol;case"object":return Array.isArray(d)?ZodParsedType.array:d===null?ZodParsedType.null:d.then&&typeof d.then=="function"&&d.catch&&typeof d.catch=="function"?ZodParsedType.promise:typeof Map<"u"&&d instanceof Map?ZodParsedType.map:typeof Set<"u"&&d instanceof Set?ZodParsedType.set:typeof Date<"u"&&d instanceof Date?ZodParsedType.date:ZodParsedType.object;default:return ZodParsedType.unknown}},ZodIssueCode=util$1.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),quotelessJson=d=>JSON.stringify(d,null,2).replace(/"([^"]+)":/g,"$1:");class ZodError extends Error{constructor(m){super(),this.issues=[],this.addIssue=w=>{this.issues=[...this.issues,w]},this.addIssues=(w=[])=>{this.issues=[...this.issues,...w]};const g=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,g):this.__proto__=g,this.name="ZodError",this.issues=m}get errors(){return this.issues}format(m){const g=m||function(I){return I.message},w={_errors:[]},$=I=>{for(const D of I.issues)if(D.code==="invalid_union")D.unionErrors.map($);else if(D.code==="invalid_return_type")$(D.returnTypeError);else if(D.code==="invalid_arguments")$(D.argumentsError);else if(D.path.length===0)w._errors.push(g(D));else{let F=w,U=0;for(;U<D.path.length;){const q=D.path[U];U===D.path.length-1?(F[q]=F[q]||{_errors:[]},F[q]._errors.push(g(D))):F[q]=F[q]||{_errors:[]},F=F[q],U++}}};return $(this),w}static assert(m){if(!(m instanceof ZodError))throw new Error(`Not a ZodError: ${m}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,util$1.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(m=(g=>g.message)){const g={},w=[];for(const $ of this.issues)$.path.length>0?(g[$.path[0]]=g[$.path[0]]||[],g[$.path[0]].push(m($))):w.push(m($));return{formErrors:w,fieldErrors:g}}get formErrors(){return this.flatten()}}ZodError.create=d=>new ZodError(d);const errorMap=(d,m)=>{let g;switch(d.code){case ZodIssueCode.invalid_type:g=d.received===ZodParsedType.undefined?"Required":`Expected ${d.expected}, received ${d.received}`;break;case ZodIssueCode.invalid_literal:g=`Invalid literal value, expected ${JSON.stringify(d.expected,util$1.jsonStringifyReplacer)}`;break;case ZodIssueCode.unrecognized_keys:g=`Unrecognized key(s) in object: ${util$1.joinValues(d.keys,", ")}`;break;case ZodIssueCode.invalid_union:g="Invalid input";break;case ZodIssueCode.invalid_union_discriminator:g=`Invalid discriminator value. Expected ${util$1.joinValues(d.options)}`;break;case ZodIssueCode.invalid_enum_value:g=`Invalid enum value. Expected ${util$1.joinValues(d.options)}, received '${d.received}'`;break;case ZodIssueCode.invalid_arguments:g="Invalid function arguments";break;case ZodIssueCode.invalid_return_type:g="Invalid function return type";break;case ZodIssueCode.invalid_date:g="Invalid date";break;case ZodIssueCode.invalid_string:typeof d.validation=="object"?"includes"in d.validation?(g=`Invalid input: must include "${d.validation.includes}"`,typeof d.validation.position=="number"&&(g=`${g} at one or more positions greater than or equal to ${d.validation.position}`)):"startsWith"in d.validation?g=`Invalid input: must start with "${d.validation.startsWith}"`:"endsWith"in d.validation?g=`Invalid input: must end with "${d.validation.endsWith}"`:util$1.assertNever(d.validation):g=d.validation!=="regex"?`Invalid ${d.validation}`:"Invalid";break;case ZodIssueCode.too_small:g=d.type==="array"?`Array must contain ${d.exact?"exactly":d.inclusive?"at least":"more than"} ${d.minimum} element(s)`:d.type==="string"?`String must contain ${d.exact?"exactly":d.inclusive?"at least":"over"} ${d.minimum} character(s)`:d.type==="number"?`Number must be ${d.exact?"exactly equal to ":d.inclusive?"greater than or equal to ":"greater than "}${d.minimum}`:d.type==="date"?`Date must be ${d.exact?"exactly equal to ":d.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(d.minimum))}`:"Invalid input";break;case ZodIssueCode.too_big:g=d.type==="array"?`Array must contain ${d.exact?"exactly":d.inclusive?"at most":"less than"} ${d.maximum} element(s)`:d.type==="string"?`String must contain ${d.exact?"exactly":d.inclusive?"at most":"under"} ${d.maximum} character(s)`:d.type==="number"?`Number must be ${d.exact?"exactly":d.inclusive?"less than or equal to":"less than"} ${d.maximum}`:d.type==="bigint"?`BigInt must be ${d.exact?"exactly":d.inclusive?"less than or equal to":"less than"} ${d.maximum}`:d.type==="date"?`Date must be ${d.exact?"exactly":d.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(d.maximum))}`:"Invalid input";break;case ZodIssueCode.custom:g="Invalid input";break;case ZodIssueCode.invalid_intersection_types:g="Intersection results could not be merged";break;case ZodIssueCode.not_multiple_of:g=`Number must be a multiple of ${d.multipleOf}`;break;case ZodIssueCode.not_finite:g="Number must be finite";break;default:g=m.defaultError,util$1.assertNever(d)}return{message:g}};let overrideErrorMap=errorMap;function setErrorMap(d){overrideErrorMap=d}function getErrorMap(){return overrideErrorMap}const makeIssue=d=>{const{data:m,path:g,errorMaps:w,issueData:$}=d,I=[...g,...$.path||[]],D={...$,path:I};if($.message!==void 0)return{...$,path:I,message:$.message};let F="";const U=w.filter((q=>!!q)).slice().reverse();for(const q of U)F=q(D,{data:m,defaultError:F}).message;return{...$,path:I,message:F}},EMPTY_PATH=[];function addIssueToContext(d,m){const g=getErrorMap(),w=makeIssue({issueData:m,data:d.data,path:d.path,errorMaps:[d.common.contextualErrorMap,d.schemaErrorMap,g,g===errorMap?void 0:errorMap].filter(($=>!!$))});d.common.issues.push(w)}class ParseStatus{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(m,g){const w=[];for(const $ of g){if($.status==="aborted")return INVALID;$.status==="dirty"&&m.dirty(),w.push($.value)}return{status:m.value,value:w}}static async mergeObjectAsync(m,g){const w=[];for(const $ of g){const I=await $.key,D=await $.value;w.push({key:I,value:D})}return ParseStatus.mergeObjectSync(m,w)}static mergeObjectSync(m,g){const w={};for(const $ of g){const{key:I,value:D}=$;if(I.status==="aborted"||D.status==="aborted")return INVALID;I.status==="dirty"&&m.dirty(),D.status==="dirty"&&m.dirty(),I.value==="__proto__"||D.value===void 0&&!$.alwaysSet||(w[I.value]=D.value)}return{status:m.value,value:w}}}const INVALID=Object.freeze({status:"aborted"}),DIRTY=d=>({status:"dirty",value:d}),OK=d=>({status:"valid",value:d}),isAborted=d=>d.status==="aborted",isDirty=d=>d.status==="dirty",isValid=d=>d.status==="valid",isAsync=d=>typeof Promise<"u"&&d instanceof Promise;function __classPrivateFieldGet(d,m,g,w){if(typeof m=="function"?d!==m||!0:!m.has(d))throw new TypeError("Cannot read private member from an object whose class did not declare it");return m.get(d)}function __classPrivateFieldSet(d,m,g,w,$){if(typeof m=="function"?d!==m||!0:!m.has(d))throw new TypeError("Cannot write private member to an object whose class did not declare it");return m.set(d,g),g}var errorUtil,_ZodEnum_cache,_ZodNativeEnum_cache;typeof SuppressedError=="function"&&SuppressedError,(function(d){d.errToObj=m=>typeof m=="string"?{message:m}:m||{},d.toString=m=>typeof m=="string"?m:m?.message})(errorUtil||(errorUtil={}));class ParseInputLazyPath{constructor(m,g,w,$){this._cachedPath=[],this.parent=m,this.data=g,this._path=w,this._key=$}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const handleResult=(d,m)=>{if(isValid(m))return{success:!0,data:m.value};if(!d.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const g=new ZodError(d.common.issues);return this._error=g,this._error}}};function processCreateParams(d){if(!d)return{};const{errorMap:m,invalid_type_error:g,required_error:w,description:$}=d;if(m&&(g||w))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return m?{errorMap:m,description:$}:{errorMap:(I,D)=>{var F,U;const{message:q}=d;return I.code==="invalid_enum_value"?{message:q??D.defaultError}:D.data===void 0?{message:(F=q??w)!==null&&F!==void 0?F:D.defaultError}:I.code!=="invalid_type"?{message:D.defaultError}:{message:(U=q??g)!==null&&U!==void 0?U:D.defaultError}},description:$}}class ZodType{constructor(m){this.spa=this.safeParseAsync,this._def=m,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(m){return getParsedType(m.data)}_getOrReturnCtx(m,g){return g||{common:m.parent.common,data:m.data,parsedType:getParsedType(m.data),schemaErrorMap:this._def.errorMap,path:m.path,parent:m.parent}}_processInputParams(m){return{status:new ParseStatus,ctx:{common:m.parent.common,data:m.data,parsedType:getParsedType(m.data),schemaErrorMap:this._def.errorMap,path:m.path,parent:m.parent}}}_parseSync(m){const g=this._parse(m);if(isAsync(g))throw new Error("Synchronous parse encountered promise.");return g}_parseAsync(m){const g=this._parse(m);return Promise.resolve(g)}parse(m,g){const w=this.safeParse(m,g);if(w.success)return w.data;throw w.error}safeParse(m,g){var w;const $={common:{issues:[],async:(w=g?.async)!==null&&w!==void 0&&w,contextualErrorMap:g?.errorMap},path:g?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:m,parsedType:getParsedType(m)},I=this._parseSync({data:m,path:$.path,parent:$});return handleResult($,I)}async parseAsync(m,g){const w=await this.safeParseAsync(m,g);if(w.success)return w.data;throw w.error}async safeParseAsync(m,g){const w={common:{issues:[],contextualErrorMap:g?.errorMap,async:!0},path:g?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:m,parsedType:getParsedType(m)},$=this._parse({data:m,path:w.path,parent:w}),I=await(isAsync($)?$:Promise.resolve($));return handleResult(w,I)}refine(m,g){const w=$=>typeof g=="string"||g===void 0?{message:g}:typeof g=="function"?g($):g;return this._refinement((($,I)=>{const D=m($),F=()=>I.addIssue({code:ZodIssueCode.custom,...w($)});return typeof Promise<"u"&&D instanceof Promise?D.then((U=>!!U||(F(),!1))):!!D||(F(),!1)}))}refinement(m,g){return this._refinement(((w,$)=>!!m(w)||($.addIssue(typeof g=="function"?g(w,$):g),!1)))}_refinement(m){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"refinement",refinement:m}})}superRefine(m){return this._refinement(m)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(m){return ZodUnion.create([this,m],this._def)}and(m){return ZodIntersection.create(this,m,this._def)}transform(m){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"transform",transform:m}})}default(m){const g=typeof m=="function"?m:()=>m;return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:g,typeName:ZodFirstPartyTypeKind.ZodDefault})}brand(){return new ZodBranded({typeName:ZodFirstPartyTypeKind.ZodBranded,type:this,...processCreateParams(this._def)})}catch(m){const g=typeof m=="function"?m:()=>m;return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:g,typeName:ZodFirstPartyTypeKind.ZodCatch})}describe(m){return new this.constructor({...this._def,description:m})}pipe(m){return ZodPipeline.create(this,m)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const cuidRegex=/^c[^\s-]{8,}$/i,cuid2Regex=/^[0-9a-z]+$/,ulidRegex=/^[0-9A-HJKMNP-TV-Z]{26}$/,uuidRegex=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,nanoidRegex=/^[a-z0-9_-]{21}$/i,durationRegex=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,emailRegex=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_emojiRegex="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let emojiRegex;const ipv4Regex=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6Regex=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64Regex=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,dateRegexSource="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",dateRegex=new RegExp(`^${dateRegexSource}$`);function timeRegexSource(d){let m="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return d.precision?m=`${m}\\.\\d{${d.precision}}`:d.precision==null&&(m=`${m}(\\.\\d+)?`),m}function timeRegex(d){return new RegExp(`^${timeRegexSource(d)}$`)}function datetimeRegex(d){let m=`${dateRegexSource}T${timeRegexSource(d)}`;const g=[];return g.push(d.local?"Z?":"Z"),d.offset&&g.push("([+-]\\d{2}:?\\d{2})"),m=`${m}(${g.join("|")})`,new RegExp(`^${m}$`)}function isValidIP(d,m){return!(m!=="v4"&&m||!ipv4Regex.test(d))||!(m!=="v6"&&m||!ipv6Regex.test(d))}class ZodString extends ZodType{_parse(m){if(this._def.coerce&&(m.data=String(m.data)),this._getType(m)!==ZodParsedType.string){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.string,received:$.parsedType}),INVALID}const g=new ParseStatus;let w;for(const $ of this._def.checks)if($.kind==="min")m.data.length<$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:$.value,type:"string",inclusive:!0,exact:!1,message:$.message}),g.dirty());else if($.kind==="max")m.data.length>$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:$.value,type:"string",inclusive:!0,exact:!1,message:$.message}),g.dirty());else if($.kind==="length"){const I=m.data.length>$.value,D=m.data.length<$.value;(I||D)&&(w=this._getOrReturnCtx(m,w),I?addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:$.value,type:"string",inclusive:!0,exact:!0,message:$.message}):D&&addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:$.value,type:"string",inclusive:!0,exact:!0,message:$.message}),g.dirty())}else if($.kind==="email")emailRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"email",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="emoji")emojiRegex||(emojiRegex=new RegExp(_emojiRegex,"u")),emojiRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"emoji",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="uuid")uuidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"uuid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="nanoid")nanoidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"nanoid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="cuid")cuidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"cuid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="cuid2")cuid2Regex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"cuid2",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="ulid")ulidRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"ulid",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty());else if($.kind==="url")try{new URL(m.data)}catch{w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"url",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()}else $.kind==="regex"?($.regex.lastIndex=0,$.regex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"regex",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty())):$.kind==="trim"?m.data=m.data.trim():$.kind==="includes"?m.data.includes($.value,$.position)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:{includes:$.value,position:$.position},message:$.message}),g.dirty()):$.kind==="toLowerCase"?m.data=m.data.toLowerCase():$.kind==="toUpperCase"?m.data=m.data.toUpperCase():$.kind==="startsWith"?m.data.startsWith($.value)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:{startsWith:$.value},message:$.message}),g.dirty()):$.kind==="endsWith"?m.data.endsWith($.value)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:{endsWith:$.value},message:$.message}),g.dirty()):$.kind==="datetime"?datetimeRegex($).test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:"datetime",message:$.message}),g.dirty()):$.kind==="date"?dateRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:"date",message:$.message}),g.dirty()):$.kind==="time"?timeRegex($).test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.invalid_string,validation:"time",message:$.message}),g.dirty()):$.kind==="duration"?durationRegex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"duration",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()):$.kind==="ip"?isValidIP(m.data,$.version)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"ip",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()):$.kind==="base64"?base64Regex.test(m.data)||(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{validation:"base64",code:ZodIssueCode.invalid_string,message:$.message}),g.dirty()):util$1.assertNever($);return{status:g.value,value:m.data}}_regex(m,g,w){return this.refinement(($=>m.test($)),{validation:g,code:ZodIssueCode.invalid_string,...errorUtil.errToObj(w)})}_addCheck(m){return new ZodString({...this._def,checks:[...this._def.checks,m]})}email(m){return this._addCheck({kind:"email",...errorUtil.errToObj(m)})}url(m){return this._addCheck({kind:"url",...errorUtil.errToObj(m)})}emoji(m){return this._addCheck({kind:"emoji",...errorUtil.errToObj(m)})}uuid(m){return this._addCheck({kind:"uuid",...errorUtil.errToObj(m)})}nanoid(m){return this._addCheck({kind:"nanoid",...errorUtil.errToObj(m)})}cuid(m){return this._addCheck({kind:"cuid",...errorUtil.errToObj(m)})}cuid2(m){return this._addCheck({kind:"cuid2",...errorUtil.errToObj(m)})}ulid(m){return this._addCheck({kind:"ulid",...errorUtil.errToObj(m)})}base64(m){return this._addCheck({kind:"base64",...errorUtil.errToObj(m)})}ip(m){return this._addCheck({kind:"ip",...errorUtil.errToObj(m)})}datetime(m){var g,w;return typeof m=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:m}):this._addCheck({kind:"datetime",precision:m?.precision===void 0?null:m?.precision,offset:(g=m?.offset)!==null&&g!==void 0&&g,local:(w=m?.local)!==null&&w!==void 0&&w,...errorUtil.errToObj(m?.message)})}date(m){return this._addCheck({kind:"date",message:m})}time(m){return typeof m=="string"?this._addCheck({kind:"time",precision:null,message:m}):this._addCheck({kind:"time",precision:m?.precision===void 0?null:m?.precision,...errorUtil.errToObj(m?.message)})}duration(m){return this._addCheck({kind:"duration",...errorUtil.errToObj(m)})}regex(m,g){return this._addCheck({kind:"regex",regex:m,...errorUtil.errToObj(g)})}includes(m,g){return this._addCheck({kind:"includes",value:m,position:g?.position,...errorUtil.errToObj(g?.message)})}startsWith(m,g){return this._addCheck({kind:"startsWith",value:m,...errorUtil.errToObj(g)})}endsWith(m,g){return this._addCheck({kind:"endsWith",value:m,...errorUtil.errToObj(g)})}min(m,g){return this._addCheck({kind:"min",value:m,...errorUtil.errToObj(g)})}max(m,g){return this._addCheck({kind:"max",value:m,...errorUtil.errToObj(g)})}length(m,g){return this._addCheck({kind:"length",value:m,...errorUtil.errToObj(g)})}nonempty(m){return this.min(1,errorUtil.errToObj(m))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((m=>m.kind==="datetime"))}get isDate(){return!!this._def.checks.find((m=>m.kind==="date"))}get isTime(){return!!this._def.checks.find((m=>m.kind==="time"))}get isDuration(){return!!this._def.checks.find((m=>m.kind==="duration"))}get isEmail(){return!!this._def.checks.find((m=>m.kind==="email"))}get isURL(){return!!this._def.checks.find((m=>m.kind==="url"))}get isEmoji(){return!!this._def.checks.find((m=>m.kind==="emoji"))}get isUUID(){return!!this._def.checks.find((m=>m.kind==="uuid"))}get isNANOID(){return!!this._def.checks.find((m=>m.kind==="nanoid"))}get isCUID(){return!!this._def.checks.find((m=>m.kind==="cuid"))}get isCUID2(){return!!this._def.checks.find((m=>m.kind==="cuid2"))}get isULID(){return!!this._def.checks.find((m=>m.kind==="ulid"))}get isIP(){return!!this._def.checks.find((m=>m.kind==="ip"))}get isBase64(){return!!this._def.checks.find((m=>m.kind==="base64"))}get minLength(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m}get maxLength(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m}}function floatSafeRemainder(d,m){const g=(d.toString().split(".")[1]||"").length,w=(m.toString().split(".")[1]||"").length,$=g>w?g:w;return parseInt(d.toFixed($).replace(".",""))%parseInt(m.toFixed($).replace(".",""))/Math.pow(10,$)}ZodString.create=d=>{var m;return new ZodString({checks:[],typeName:ZodFirstPartyTypeKind.ZodString,coerce:(m=d?.coerce)!==null&&m!==void 0&&m,...processCreateParams(d)})};class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(m){if(this._def.coerce&&(m.data=Number(m.data)),this._getType(m)!==ZodParsedType.number){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.number,received:$.parsedType}),INVALID}let g;const w=new ParseStatus;for(const $ of this._def.checks)$.kind==="int"?util$1.isInteger(m.data)||(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:"integer",received:"float",message:$.message}),w.dirty()):$.kind==="min"?($.inclusive?m.data<$.value:m.data<=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_small,minimum:$.value,type:"number",inclusive:$.inclusive,exact:!1,message:$.message}),w.dirty()):$.kind==="max"?($.inclusive?m.data>$.value:m.data>=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_big,maximum:$.value,type:"number",inclusive:$.inclusive,exact:!1,message:$.message}),w.dirty()):$.kind==="multipleOf"?floatSafeRemainder(m.data,$.value)!==0&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.not_multiple_of,multipleOf:$.value,message:$.message}),w.dirty()):$.kind==="finite"?Number.isFinite(m.data)||(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.not_finite,message:$.message}),w.dirty()):util$1.assertNever($);return{status:w.value,value:m.data}}gte(m,g){return this.setLimit("min",m,!0,errorUtil.toString(g))}gt(m,g){return this.setLimit("min",m,!1,errorUtil.toString(g))}lte(m,g){return this.setLimit("max",m,!0,errorUtil.toString(g))}lt(m,g){return this.setLimit("max",m,!1,errorUtil.toString(g))}setLimit(m,g,w,$){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:m,value:g,inclusive:w,message:errorUtil.toString($)}]})}_addCheck(m){return new ZodNumber({...this._def,checks:[...this._def.checks,m]})}int(m){return this._addCheck({kind:"int",message:errorUtil.toString(m)})}positive(m){return this._addCheck({kind:"min",value:0,inclusive:!1,message:errorUtil.toString(m)})}negative(m){return this._addCheck({kind:"max",value:0,inclusive:!1,message:errorUtil.toString(m)})}nonpositive(m){return this._addCheck({kind:"max",value:0,inclusive:!0,message:errorUtil.toString(m)})}nonnegative(m){return this._addCheck({kind:"min",value:0,inclusive:!0,message:errorUtil.toString(m)})}multipleOf(m,g){return this._addCheck({kind:"multipleOf",value:m,message:errorUtil.toString(g)})}finite(m){return this._addCheck({kind:"finite",message:errorUtil.toString(m)})}safe(m){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:errorUtil.toString(m)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:errorUtil.toString(m)})}get minValue(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m}get maxValue(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m}get isInt(){return!!this._def.checks.find((m=>m.kind==="int"||m.kind==="multipleOf"&&util$1.isInteger(m.value)))}get isFinite(){let m=null,g=null;for(const w of this._def.checks){if(w.kind==="finite"||w.kind==="int"||w.kind==="multipleOf")return!0;w.kind==="min"?(g===null||w.value>g)&&(g=w.value):w.kind==="max"&&(m===null||w.value<m)&&(m=w.value)}return Number.isFinite(g)&&Number.isFinite(m)}}ZodNumber.create=d=>new ZodNumber({checks:[],typeName:ZodFirstPartyTypeKind.ZodNumber,coerce:d?.coerce||!1,...processCreateParams(d)});class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(m){if(this._def.coerce&&(m.data=BigInt(m.data)),this._getType(m)!==ZodParsedType.bigint){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.bigint,received:$.parsedType}),INVALID}let g;const w=new ParseStatus;for(const $ of this._def.checks)$.kind==="min"?($.inclusive?m.data<$.value:m.data<=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_small,type:"bigint",minimum:$.value,inclusive:$.inclusive,message:$.message}),w.dirty()):$.kind==="max"?($.inclusive?m.data>$.value:m.data>=$.value)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.too_big,type:"bigint",maximum:$.value,inclusive:$.inclusive,message:$.message}),w.dirty()):$.kind==="multipleOf"?m.data%$.value!==BigInt(0)&&(g=this._getOrReturnCtx(m,g),addIssueToContext(g,{code:ZodIssueCode.not_multiple_of,multipleOf:$.value,message:$.message}),w.dirty()):util$1.assertNever($);return{status:w.value,value:m.data}}gte(m,g){return this.setLimit("min",m,!0,errorUtil.toString(g))}gt(m,g){return this.setLimit("min",m,!1,errorUtil.toString(g))}lte(m,g){return this.setLimit("max",m,!0,errorUtil.toString(g))}lt(m,g){return this.setLimit("max",m,!1,errorUtil.toString(g))}setLimit(m,g,w,$){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:m,value:g,inclusive:w,message:errorUtil.toString($)}]})}_addCheck(m){return new ZodBigInt({...this._def,checks:[...this._def.checks,m]})}positive(m){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:errorUtil.toString(m)})}negative(m){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:errorUtil.toString(m)})}nonpositive(m){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:errorUtil.toString(m)})}nonnegative(m){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:errorUtil.toString(m)})}multipleOf(m,g){return this._addCheck({kind:"multipleOf",value:m,message:errorUtil.toString(g)})}get minValue(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m}get maxValue(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m}}ZodBigInt.create=d=>{var m;return new ZodBigInt({checks:[],typeName:ZodFirstPartyTypeKind.ZodBigInt,coerce:(m=d?.coerce)!==null&&m!==void 0&&m,...processCreateParams(d)})};class ZodBoolean extends ZodType{_parse(m){if(this._def.coerce&&(m.data=!!m.data),this._getType(m)!==ZodParsedType.boolean){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.boolean,received:g.parsedType}),INVALID}return OK(m.data)}}ZodBoolean.create=d=>new ZodBoolean({typeName:ZodFirstPartyTypeKind.ZodBoolean,coerce:d?.coerce||!1,...processCreateParams(d)});class ZodDate extends ZodType{_parse(m){if(this._def.coerce&&(m.data=new Date(m.data)),this._getType(m)!==ZodParsedType.date){const $=this._getOrReturnCtx(m);return addIssueToContext($,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.date,received:$.parsedType}),INVALID}if(isNaN(m.data.getTime()))return addIssueToContext(this._getOrReturnCtx(m),{code:ZodIssueCode.invalid_date}),INVALID;const g=new ParseStatus;let w;for(const $ of this._def.checks)$.kind==="min"?m.data.getTime()<$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_small,message:$.message,inclusive:!0,exact:!1,minimum:$.value,type:"date"}),g.dirty()):$.kind==="max"?m.data.getTime()>$.value&&(w=this._getOrReturnCtx(m,w),addIssueToContext(w,{code:ZodIssueCode.too_big,message:$.message,inclusive:!0,exact:!1,maximum:$.value,type:"date"}),g.dirty()):util$1.assertNever($);return{status:g.value,value:new Date(m.data.getTime())}}_addCheck(m){return new ZodDate({...this._def,checks:[...this._def.checks,m]})}min(m,g){return this._addCheck({kind:"min",value:m.getTime(),message:errorUtil.toString(g)})}max(m,g){return this._addCheck({kind:"max",value:m.getTime(),message:errorUtil.toString(g)})}get minDate(){let m=null;for(const g of this._def.checks)g.kind==="min"&&(m===null||g.value>m)&&(m=g.value);return m!=null?new Date(m):null}get maxDate(){let m=null;for(const g of this._def.checks)g.kind==="max"&&(m===null||g.value<m)&&(m=g.value);return m!=null?new Date(m):null}}ZodDate.create=d=>new ZodDate({checks:[],coerce:d?.coerce||!1,typeName:ZodFirstPartyTypeKind.ZodDate,...processCreateParams(d)});class ZodSymbol extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.symbol){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.symbol,received:g.parsedType}),INVALID}return OK(m.data)}}ZodSymbol.create=d=>new ZodSymbol({typeName:ZodFirstPartyTypeKind.ZodSymbol,...processCreateParams(d)});class ZodUndefined extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.undefined){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.undefined,received:g.parsedType}),INVALID}return OK(m.data)}}ZodUndefined.create=d=>new ZodUndefined({typeName:ZodFirstPartyTypeKind.ZodUndefined,...processCreateParams(d)});class ZodNull extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.null){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.null,received:g.parsedType}),INVALID}return OK(m.data)}}ZodNull.create=d=>new ZodNull({typeName:ZodFirstPartyTypeKind.ZodNull,...processCreateParams(d)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(m){return OK(m.data)}}ZodAny.create=d=>new ZodAny({typeName:ZodFirstPartyTypeKind.ZodAny,...processCreateParams(d)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(m){return OK(m.data)}}ZodUnknown.create=d=>new ZodUnknown({typeName:ZodFirstPartyTypeKind.ZodUnknown,...processCreateParams(d)});class ZodNever extends ZodType{_parse(m){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.never,received:g.parsedType}),INVALID}}ZodNever.create=d=>new ZodNever({typeName:ZodFirstPartyTypeKind.ZodNever,...processCreateParams(d)});class ZodVoid extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.undefined){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.void,received:g.parsedType}),INVALID}return OK(m.data)}}ZodVoid.create=d=>new ZodVoid({typeName:ZodFirstPartyTypeKind.ZodVoid,...processCreateParams(d)});class ZodArray extends ZodType{_parse(m){const{ctx:g,status:w}=this._processInputParams(m),$=this._def;if(g.parsedType!==ZodParsedType.array)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:g.parsedType}),INVALID;if($.exactLength!==null){const D=g.data.length>$.exactLength.value,F=g.data.length<$.exactLength.value;(D||F)&&(addIssueToContext(g,{code:D?ZodIssueCode.too_big:ZodIssueCode.too_small,minimum:F?$.exactLength.value:void 0,maximum:D?$.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:$.exactLength.message}),w.dirty())}if($.minLength!==null&&g.data.length<$.minLength.value&&(addIssueToContext(g,{code:ZodIssueCode.too_small,minimum:$.minLength.value,type:"array",inclusive:!0,exact:!1,message:$.minLength.message}),w.dirty()),$.maxLength!==null&&g.data.length>$.maxLength.value&&(addIssueToContext(g,{code:ZodIssueCode.too_big,maximum:$.maxLength.value,type:"array",inclusive:!0,exact:!1,message:$.maxLength.message}),w.dirty()),g.common.async)return Promise.all([...g.data].map(((D,F)=>$.type._parseAsync(new ParseInputLazyPath(g,D,g.path,F))))).then((D=>ParseStatus.mergeArray(w,D)));const I=[...g.data].map(((D,F)=>$.type._parseSync(new ParseInputLazyPath(g,D,g.path,F))));return ParseStatus.mergeArray(w,I)}get element(){return this._def.type}min(m,g){return new ZodArray({...this._def,minLength:{value:m,message:errorUtil.toString(g)}})}max(m,g){return new ZodArray({...this._def,maxLength:{value:m,message:errorUtil.toString(g)}})}length(m,g){return new ZodArray({...this._def,exactLength:{value:m,message:errorUtil.toString(g)}})}nonempty(m){return this.min(1,m)}}function deepPartialify(d){if(d instanceof ZodObject){const m={};for(const g in d.shape){const w=d.shape[g];m[g]=ZodOptional.create(deepPartialify(w))}return new ZodObject({...d._def,shape:()=>m})}return d instanceof ZodArray?new ZodArray({...d._def,type:deepPartialify(d.element)}):d instanceof ZodOptional?ZodOptional.create(deepPartialify(d.unwrap())):d instanceof ZodNullable?ZodNullable.create(deepPartialify(d.unwrap())):d instanceof ZodTuple?ZodTuple.create(d.items.map((m=>deepPartialify(m)))):d}ZodArray.create=(d,m)=>new ZodArray({type:d,minLength:null,maxLength:null,exactLength:null,typeName:ZodFirstPartyTypeKind.ZodArray,...processCreateParams(m)});class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const m=this._def.shape(),g=util$1.objectKeys(m);return this._cached={shape:m,keys:g}}_parse(m){if(this._getType(m)!==ZodParsedType.object){const U=this._getOrReturnCtx(m);return addIssueToContext(U,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:U.parsedType}),INVALID}const{status:g,ctx:w}=this._processInputParams(m),{shape:$,keys:I}=this._getCached(),D=[];if(!(this._def.catchall instanceof ZodNever&&this._def.unknownKeys==="strip"))for(const U in w.data)I.includes(U)||D.push(U);const F=[];for(const U of I){const q=$[U],j=w.data[U];F.push({key:{status:"valid",value:U},value:q._parse(new ParseInputLazyPath(w,j,w.path,U)),alwaysSet:U in w.data})}if(this._def.catchall instanceof ZodNever){const U=this._def.unknownKeys;if(U==="passthrough")for(const q of D)F.push({key:{status:"valid",value:q},value:{status:"valid",value:w.data[q]}});else if(U==="strict")D.length>0&&(addIssueToContext(w,{code:ZodIssueCode.unrecognized_keys,keys:D}),g.dirty());else if(U!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const U=this._def.catchall;for(const q of D){const j=w.data[q];F.push({key:{status:"valid",value:q},value:U._parse(new ParseInputLazyPath(w,j,w.path,q)),alwaysSet:q in w.data})}}return w.common.async?Promise.resolve().then((async()=>{const U=[];for(const q of F){const j=await q.key,G=await q.value;U.push({key:j,value:G,alwaysSet:q.alwaysSet})}return U})).then((U=>ParseStatus.mergeObjectSync(g,U))):ParseStatus.mergeObjectSync(g,F)}get shape(){return this._def.shape()}strict(m){return errorUtil.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...m!==void 0?{errorMap:(g,w)=>{var $,I,D,F;const U=(D=(I=($=this._def).errorMap)===null||I===void 0?void 0:I.call($,g,w).message)!==null&&D!==void 0?D:w.defaultError;return g.code==="unrecognized_keys"?{message:(F=errorUtil.errToObj(m).message)!==null&&F!==void 0?F:U}:{message:U}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(m){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...m})})}merge(m){return new ZodObject({unknownKeys:m._def.unknownKeys,catchall:m._def.catchall,shape:()=>({...this._def.shape(),...m._def.shape()}),typeName:ZodFirstPartyTypeKind.ZodObject})}setKey(m,g){return this.augment({[m]:g})}catchall(m){return new ZodObject({...this._def,catchall:m})}pick(m){const g={};return util$1.objectKeys(m).forEach((w=>{m[w]&&this.shape[w]&&(g[w]=this.shape[w])})),new ZodObject({...this._def,shape:()=>g})}omit(m){const g={};return util$1.objectKeys(this.shape).forEach((w=>{m[w]||(g[w]=this.shape[w])})),new ZodObject({...this._def,shape:()=>g})}deepPartial(){return deepPartialify(this)}partial(m){const g={};return util$1.objectKeys(this.shape).forEach((w=>{const $=this.shape[w];m&&!m[w]?g[w]=$:g[w]=$.optional()})),new ZodObject({...this._def,shape:()=>g})}required(m){const g={};return util$1.objectKeys(this.shape).forEach((w=>{if(m&&!m[w])g[w]=this.shape[w];else{let $=this.shape[w];for(;$ instanceof ZodOptional;)$=$._def.innerType;g[w]=$}})),new ZodObject({...this._def,shape:()=>g})}keyof(){return createZodEnum(util$1.objectKeys(this.shape))}}ZodObject.create=(d,m)=>new ZodObject({shape:()=>d,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(m)}),ZodObject.strictCreate=(d,m)=>new ZodObject({shape:()=>d,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(m)}),ZodObject.lazycreate=(d,m)=>new ZodObject({shape:d,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(m)});class ZodUnion extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m),w=this._def.options;if(g.common.async)return Promise.all(w.map((async $=>{const I={...g,common:{...g.common,issues:[]},parent:null};return{result:await $._parseAsync({data:g.data,path:g.path,parent:I}),ctx:I}}))).then((function($){for(const D of $)if(D.result.status==="valid")return D.result;for(const D of $)if(D.result.status==="dirty")return g.common.issues.push(...D.ctx.common.issues),D.result;const I=$.map((D=>new ZodError(D.ctx.common.issues)));return addIssueToContext(g,{code:ZodIssueCode.invalid_union,unionErrors:I}),INVALID}));{let $;const I=[];for(const F of w){const U={...g,common:{...g.common,issues:[]},parent:null},q=F._parseSync({data:g.data,path:g.path,parent:U});if(q.status==="valid")return q;q.status!=="dirty"||$||($={result:q,ctx:U}),U.common.issues.length&&I.push(U.common.issues)}if($)return g.common.issues.push(...$.ctx.common.issues),$.result;const D=I.map((F=>new ZodError(F)));return addIssueToContext(g,{code:ZodIssueCode.invalid_union,unionErrors:D}),INVALID}}get options(){return this._def.options}}ZodUnion.create=(d,m)=>new ZodUnion({options:d,typeName:ZodFirstPartyTypeKind.ZodUnion,...processCreateParams(m)});const getDiscriminator=d=>d instanceof ZodLazy?getDiscriminator(d.schema):d instanceof ZodEffects?getDiscriminator(d.innerType()):d instanceof ZodLiteral?[d.value]:d instanceof ZodEnum?d.options:d instanceof ZodNativeEnum?util$1.objectValues(d.enum):d instanceof ZodDefault?getDiscriminator(d._def.innerType):d instanceof ZodUndefined?[void 0]:d instanceof ZodNull?[null]:d instanceof ZodOptional?[void 0,...getDiscriminator(d.unwrap())]:d instanceof ZodNullable?[null,...getDiscriminator(d.unwrap())]:d instanceof ZodBranded||d instanceof ZodReadonly?getDiscriminator(d.unwrap()):d instanceof ZodCatch?getDiscriminator(d._def.innerType):[];class ZodDiscriminatedUnion extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m);if(g.parsedType!==ZodParsedType.object)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:g.parsedType}),INVALID;const w=this.discriminator,$=g.data[w],I=this.optionsMap.get($);return I?g.common.async?I._parseAsync({data:g.data,path:g.path,parent:g}):I._parseSync({data:g.data,path:g.path,parent:g}):(addIssueToContext(g,{code:ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[w]}),INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(m,g,w){const $=new Map;for(const I of g){const D=getDiscriminator(I.shape[m]);if(!D.length)throw new Error(`A discriminator value for key \`${m}\` could not be extracted from all schema options`);for(const F of D){if($.has(F))throw new Error(`Discriminator property ${String(m)} has duplicate value ${String(F)}`);$.set(F,I)}}return new ZodDiscriminatedUnion({typeName:ZodFirstPartyTypeKind.ZodDiscriminatedUnion,discriminator:m,options:g,optionsMap:$,...processCreateParams(w)})}}function mergeValues(d,m){const g=getParsedType(d),w=getParsedType(m);if(d===m)return{valid:!0,data:d};if(g===ZodParsedType.object&&w===ZodParsedType.object){const $=util$1.objectKeys(m),I=util$1.objectKeys(d).filter((F=>$.indexOf(F)!==-1)),D={...d,...m};for(const F of I){const U=mergeValues(d[F],m[F]);if(!U.valid)return{valid:!1};D[F]=U.data}return{valid:!0,data:D}}if(g===ZodParsedType.array&&w===ZodParsedType.array){if(d.length!==m.length)return{valid:!1};const $=[];for(let I=0;I<d.length;I++){const D=mergeValues(d[I],m[I]);if(!D.valid)return{valid:!1};$.push(D.data)}return{valid:!0,data:$}}return g===ZodParsedType.date&&w===ZodParsedType.date&&+d==+m?{valid:!0,data:d}:{valid:!1}}class ZodIntersection extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m),$=(I,D)=>{if(isAborted(I)||isAborted(D))return INVALID;const F=mergeValues(I.value,D.value);return F.valid?((isDirty(I)||isDirty(D))&&g.dirty(),{status:g.value,value:F.data}):(addIssueToContext(w,{code:ZodIssueCode.invalid_intersection_types}),INVALID)};return w.common.async?Promise.all([this._def.left._parseAsync({data:w.data,path:w.path,parent:w}),this._def.right._parseAsync({data:w.data,path:w.path,parent:w})]).then((([I,D])=>$(I,D))):$(this._def.left._parseSync({data:w.data,path:w.path,parent:w}),this._def.right._parseSync({data:w.data,path:w.path,parent:w}))}}ZodIntersection.create=(d,m,g)=>new ZodIntersection({left:d,right:m,typeName:ZodFirstPartyTypeKind.ZodIntersection,...processCreateParams(g)});class ZodTuple extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.array)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:w.parsedType}),INVALID;if(w.data.length<this._def.items.length)return addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),INVALID;!this._def.rest&&w.data.length>this._def.items.length&&(addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),g.dirty());const $=[...w.data].map(((I,D)=>{const F=this._def.items[D]||this._def.rest;return F?F._parse(new ParseInputLazyPath(w,I,w.path,D)):null})).filter((I=>!!I));return w.common.async?Promise.all($).then((I=>ParseStatus.mergeArray(g,I))):ParseStatus.mergeArray(g,$)}get items(){return this._def.items}rest(m){return new ZodTuple({...this._def,rest:m})}}ZodTuple.create=(d,m)=>{if(!Array.isArray(d))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:d,typeName:ZodFirstPartyTypeKind.ZodTuple,rest:null,...processCreateParams(m)})};class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.object)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:w.parsedType}),INVALID;const $=[],I=this._def.keyType,D=this._def.valueType;for(const F in w.data)$.push({key:I._parse(new ParseInputLazyPath(w,F,w.path,F)),value:D._parse(new ParseInputLazyPath(w,w.data[F],w.path,F)),alwaysSet:F in w.data});return w.common.async?ParseStatus.mergeObjectAsync(g,$):ParseStatus.mergeObjectSync(g,$)}get element(){return this._def.valueType}static create(m,g,w){return new ZodRecord(g instanceof ZodType?{keyType:m,valueType:g,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(w)}:{keyType:ZodString.create(),valueType:m,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(g)})}}class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.map)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.map,received:w.parsedType}),INVALID;const $=this._def.keyType,I=this._def.valueType,D=[...w.data.entries()].map((([F,U],q)=>({key:$._parse(new ParseInputLazyPath(w,F,w.path,[q,"key"])),value:I._parse(new ParseInputLazyPath(w,U,w.path,[q,"value"]))})));if(w.common.async){const F=new Map;return Promise.resolve().then((async()=>{for(const U of D){const q=await U.key,j=await U.value;if(q.status==="aborted"||j.status==="aborted")return INVALID;q.status!=="dirty"&&j.status!=="dirty"||g.dirty(),F.set(q.value,j.value)}return{status:g.value,value:F}}))}{const F=new Map;for(const U of D){const q=U.key,j=U.value;if(q.status==="aborted"||j.status==="aborted")return INVALID;q.status!=="dirty"&&j.status!=="dirty"||g.dirty(),F.set(q.value,j.value)}return{status:g.value,value:F}}}}ZodMap.create=(d,m,g)=>new ZodMap({valueType:m,keyType:d,typeName:ZodFirstPartyTypeKind.ZodMap,...processCreateParams(g)});class ZodSet extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.parsedType!==ZodParsedType.set)return addIssueToContext(w,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.set,received:w.parsedType}),INVALID;const $=this._def;$.minSize!==null&&w.data.size<$.minSize.value&&(addIssueToContext(w,{code:ZodIssueCode.too_small,minimum:$.minSize.value,type:"set",inclusive:!0,exact:!1,message:$.minSize.message}),g.dirty()),$.maxSize!==null&&w.data.size>$.maxSize.value&&(addIssueToContext(w,{code:ZodIssueCode.too_big,maximum:$.maxSize.value,type:"set",inclusive:!0,exact:!1,message:$.maxSize.message}),g.dirty());const I=this._def.valueType;function D(U){const q=new Set;for(const j of U){if(j.status==="aborted")return INVALID;j.status==="dirty"&&g.dirty(),q.add(j.value)}return{status:g.value,value:q}}const F=[...w.data.values()].map(((U,q)=>I._parse(new ParseInputLazyPath(w,U,w.path,q))));return w.common.async?Promise.all(F).then((U=>D(U))):D(F)}min(m,g){return new ZodSet({...this._def,minSize:{value:m,message:errorUtil.toString(g)}})}max(m,g){return new ZodSet({...this._def,maxSize:{value:m,message:errorUtil.toString(g)}})}size(m,g){return this.min(m,g).max(m,g)}nonempty(m){return this.min(1,m)}}ZodSet.create=(d,m)=>new ZodSet({valueType:d,minSize:null,maxSize:null,typeName:ZodFirstPartyTypeKind.ZodSet,...processCreateParams(m)});class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(m){const{ctx:g}=this._processInputParams(m);if(g.parsedType!==ZodParsedType.function)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.function,received:g.parsedType}),INVALID;function w(F,U){return makeIssue({data:F,path:g.path,errorMaps:[g.common.contextualErrorMap,g.schemaErrorMap,getErrorMap(),errorMap].filter((q=>!!q)),issueData:{code:ZodIssueCode.invalid_arguments,argumentsError:U}})}function $(F,U){return makeIssue({data:F,path:g.path,errorMaps:[g.common.contextualErrorMap,g.schemaErrorMap,getErrorMap(),errorMap].filter((q=>!!q)),issueData:{code:ZodIssueCode.invalid_return_type,returnTypeError:U}})}const I={errorMap:g.common.contextualErrorMap},D=g.data;if(this._def.returns instanceof ZodPromise){const F=this;return OK((async function(...U){const q=new ZodError([]),j=await F._def.args.parseAsync(U,I).catch((V=>{throw q.addIssue(w(U,V)),q})),G=await Reflect.apply(D,this,j);return await F._def.returns._def.type.parseAsync(G,I).catch((V=>{throw q.addIssue($(G,V)),q}))}))}{const F=this;return OK((function(...U){const q=F._def.args.safeParse(U,I);if(!q.success)throw new ZodError([w(U,q.error)]);const j=Reflect.apply(D,this,q.data),G=F._def.returns.safeParse(j,I);if(!G.success)throw new ZodError([$(j,G.error)]);return G.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...m){return new ZodFunction({...this._def,args:ZodTuple.create(m).rest(ZodUnknown.create())})}returns(m){return new ZodFunction({...this._def,returns:m})}implement(m){return this.parse(m)}strictImplement(m){return this.parse(m)}static create(m,g,w){return new ZodFunction({args:m||ZodTuple.create([]).rest(ZodUnknown.create()),returns:g||ZodUnknown.create(),typeName:ZodFirstPartyTypeKind.ZodFunction,...processCreateParams(w)})}}class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(m){const{ctx:g}=this._processInputParams(m);return this._def.getter()._parse({data:g.data,path:g.path,parent:g})}}ZodLazy.create=(d,m)=>new ZodLazy({getter:d,typeName:ZodFirstPartyTypeKind.ZodLazy,...processCreateParams(m)});class ZodLiteral extends ZodType{_parse(m){if(m.data!==this._def.value){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{received:g.data,code:ZodIssueCode.invalid_literal,expected:this._def.value}),INVALID}return{status:"valid",value:m.data}}get value(){return this._def.value}}function createZodEnum(d,m){return new ZodEnum({values:d,typeName:ZodFirstPartyTypeKind.ZodEnum,...processCreateParams(m)})}ZodLiteral.create=(d,m)=>new ZodLiteral({value:d,typeName:ZodFirstPartyTypeKind.ZodLiteral,...processCreateParams(m)});class ZodEnum extends ZodType{constructor(){super(...arguments),_ZodEnum_cache.set(this,void 0)}_parse(m){if(typeof m.data!="string"){const g=this._getOrReturnCtx(m),w=this._def.values;return addIssueToContext(g,{expected:util$1.joinValues(w),received:g.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodEnum_cache)||__classPrivateFieldSet(this,_ZodEnum_cache,new Set(this._def.values)),!__classPrivateFieldGet(this,_ZodEnum_cache).has(m.data)){const g=this._getOrReturnCtx(m),w=this._def.values;return addIssueToContext(g,{received:g.data,code:ZodIssueCode.invalid_enum_value,options:w}),INVALID}return OK(m.data)}get options(){return this._def.values}get enum(){const m={};for(const g of this._def.values)m[g]=g;return m}get Values(){const m={};for(const g of this._def.values)m[g]=g;return m}get Enum(){const m={};for(const g of this._def.values)m[g]=g;return m}extract(m,g=this._def){return ZodEnum.create(m,{...this._def,...g})}exclude(m,g=this._def){return ZodEnum.create(this.options.filter((w=>!m.includes(w))),{...this._def,...g})}}_ZodEnum_cache=new WeakMap,ZodEnum.create=createZodEnum;class ZodNativeEnum extends ZodType{constructor(){super(...arguments),_ZodNativeEnum_cache.set(this,void 0)}_parse(m){const g=util$1.getValidEnumValues(this._def.values),w=this._getOrReturnCtx(m);if(w.parsedType!==ZodParsedType.string&&w.parsedType!==ZodParsedType.number){const $=util$1.objectValues(g);return addIssueToContext(w,{expected:util$1.joinValues($),received:w.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodNativeEnum_cache)||__classPrivateFieldSet(this,_ZodNativeEnum_cache,new Set(util$1.getValidEnumValues(this._def.values))),!__classPrivateFieldGet(this,_ZodNativeEnum_cache).has(m.data)){const $=util$1.objectValues(g);return addIssueToContext(w,{received:w.data,code:ZodIssueCode.invalid_enum_value,options:$}),INVALID}return OK(m.data)}get enum(){return this._def.values}}_ZodNativeEnum_cache=new WeakMap,ZodNativeEnum.create=(d,m)=>new ZodNativeEnum({values:d,typeName:ZodFirstPartyTypeKind.ZodNativeEnum,...processCreateParams(m)});class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(m){const{ctx:g}=this._processInputParams(m);if(g.parsedType!==ZodParsedType.promise&&g.common.async===!1)return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.promise,received:g.parsedType}),INVALID;const w=g.parsedType===ZodParsedType.promise?g.data:Promise.resolve(g.data);return OK(w.then(($=>this._def.type.parseAsync($,{path:g.path,errorMap:g.common.contextualErrorMap}))))}}ZodPromise.create=(d,m)=>new ZodPromise({type:d,typeName:ZodFirstPartyTypeKind.ZodPromise,...processCreateParams(m)});class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ZodFirstPartyTypeKind.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(m){const{status:g,ctx:w}=this._processInputParams(m),$=this._def.effect||null,I={addIssue:D=>{addIssueToContext(w,D),D.fatal?g.abort():g.dirty()},get path(){return w.path}};if(I.addIssue=I.addIssue.bind(I),$.type==="preprocess"){const D=$.transform(w.data,I);if(w.common.async)return Promise.resolve(D).then((async F=>{if(g.value==="aborted")return INVALID;const U=await this._def.schema._parseAsync({data:F,path:w.path,parent:w});return U.status==="aborted"?INVALID:U.status==="dirty"||g.value==="dirty"?DIRTY(U.value):U}));{if(g.value==="aborted")return INVALID;const F=this._def.schema._parseSync({data:D,path:w.path,parent:w});return F.status==="aborted"?INVALID:F.status==="dirty"||g.value==="dirty"?DIRTY(F.value):F}}if($.type==="refinement"){const D=F=>{const U=$.refinement(F,I);if(w.common.async)return Promise.resolve(U);if(U instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return F};if(w.common.async===!1){const F=this._def.schema._parseSync({data:w.data,path:w.path,parent:w});return F.status==="aborted"?INVALID:(F.status==="dirty"&&g.dirty(),D(F.value),{status:g.value,value:F.value})}return this._def.schema._parseAsync({data:w.data,path:w.path,parent:w}).then((F=>F.status==="aborted"?INVALID:(F.status==="dirty"&&g.dirty(),D(F.value).then((()=>({status:g.value,value:F.value}))))))}if($.type==="transform"){if(w.common.async===!1){const D=this._def.schema._parseSync({data:w.data,path:w.path,parent:w});if(!isValid(D))return D;const F=$.transform(D.value,I);if(F instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:g.value,value:F}}return this._def.schema._parseAsync({data:w.data,path:w.path,parent:w}).then((D=>isValid(D)?Promise.resolve($.transform(D.value,I)).then((F=>({status:g.value,value:F}))):D))}util$1.assertNever($)}}ZodEffects.create=(d,m,g)=>new ZodEffects({schema:d,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:m,...processCreateParams(g)}),ZodEffects.createWithPreprocess=(d,m,g)=>new ZodEffects({schema:m,effect:{type:"preprocess",transform:d},typeName:ZodFirstPartyTypeKind.ZodEffects,...processCreateParams(g)});class ZodOptional extends ZodType{_parse(m){return this._getType(m)===ZodParsedType.undefined?OK(void 0):this._def.innerType._parse(m)}unwrap(){return this._def.innerType}}ZodOptional.create=(d,m)=>new ZodOptional({innerType:d,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(m)});class ZodNullable extends ZodType{_parse(m){return this._getType(m)===ZodParsedType.null?OK(null):this._def.innerType._parse(m)}unwrap(){return this._def.innerType}}ZodNullable.create=(d,m)=>new ZodNullable({innerType:d,typeName:ZodFirstPartyTypeKind.ZodNullable,...processCreateParams(m)});class ZodDefault extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m);let w=g.data;return g.parsedType===ZodParsedType.undefined&&(w=this._def.defaultValue()),this._def.innerType._parse({data:w,path:g.path,parent:g})}removeDefault(){return this._def.innerType}}ZodDefault.create=(d,m)=>new ZodDefault({innerType:d,typeName:ZodFirstPartyTypeKind.ZodDefault,defaultValue:typeof m.default=="function"?m.default:()=>m.default,...processCreateParams(m)});class ZodCatch extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m),w={...g,common:{...g.common,issues:[]}},$=this._def.innerType._parse({data:w.data,path:w.path,parent:{...w}});return isAsync($)?$.then((I=>({status:"valid",value:I.status==="valid"?I.value:this._def.catchValue({get error(){return new ZodError(w.common.issues)},input:w.data})}))):{status:"valid",value:$.status==="valid"?$.value:this._def.catchValue({get error(){return new ZodError(w.common.issues)},input:w.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(d,m)=>new ZodCatch({innerType:d,typeName:ZodFirstPartyTypeKind.ZodCatch,catchValue:typeof m.catch=="function"?m.catch:()=>m.catch,...processCreateParams(m)});class ZodNaN extends ZodType{_parse(m){if(this._getType(m)!==ZodParsedType.nan){const g=this._getOrReturnCtx(m);return addIssueToContext(g,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.nan,received:g.parsedType}),INVALID}return{status:"valid",value:m.data}}}ZodNaN.create=d=>new ZodNaN({typeName:ZodFirstPartyTypeKind.ZodNaN,...processCreateParams(d)});const BRAND=Symbol("zod_brand");class ZodBranded extends ZodType{_parse(m){const{ctx:g}=this._processInputParams(m),w=g.data;return this._def.type._parse({data:w,path:g.path,parent:g})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(m){const{status:g,ctx:w}=this._processInputParams(m);if(w.common.async)return(async()=>{const $=await this._def.in._parseAsync({data:w.data,path:w.path,parent:w});return $.status==="aborted"?INVALID:$.status==="dirty"?(g.dirty(),DIRTY($.value)):this._def.out._parseAsync({data:$.value,path:w.path,parent:w})})();{const $=this._def.in._parseSync({data:w.data,path:w.path,parent:w});return $.status==="aborted"?INVALID:$.status==="dirty"?(g.dirty(),{status:"dirty",value:$.value}):this._def.out._parseSync({data:$.value,path:w.path,parent:w})}}static create(m,g){return new ZodPipeline({in:m,out:g,typeName:ZodFirstPartyTypeKind.ZodPipeline})}}class ZodReadonly extends ZodType{_parse(m){const g=this._def.innerType._parse(m),w=$=>(isValid($)&&($.value=Object.freeze($.value)),$);return isAsync(g)?g.then(($=>w($))):w(g)}unwrap(){return this._def.innerType}}function custom(d,m={},g){return d?ZodAny.create().superRefine(((w,$)=>{var I,D;if(!d(w)){const F=typeof m=="function"?m(w):typeof m=="string"?{message:m}:m,U=(D=(I=F.fatal)!==null&&I!==void 0?I:g)===null||D===void 0||D,q=typeof F=="string"?{message:F}:F;$.addIssue({code:"custom",...q,fatal:U})}})):ZodAny.create()}ZodReadonly.create=(d,m)=>new ZodReadonly({innerType:d,typeName:ZodFirstPartyTypeKind.ZodReadonly,...processCreateParams(m)});const late={object:ZodObject.lazycreate};var ZodFirstPartyTypeKind;(function(d){d.ZodString="ZodString",d.ZodNumber="ZodNumber",d.ZodNaN="ZodNaN",d.ZodBigInt="ZodBigInt",d.ZodBoolean="ZodBoolean",d.ZodDate="ZodDate",d.ZodSymbol="ZodSymbol",d.ZodUndefined="ZodUndefined",d.ZodNull="ZodNull",d.ZodAny="ZodAny",d.ZodUnknown="ZodUnknown",d.ZodNever="ZodNever",d.ZodVoid="ZodVoid",d.ZodArray="ZodArray",d.ZodObject="ZodObject",d.ZodUnion="ZodUnion",d.ZodDiscriminatedUnion="ZodDiscriminatedUnion",d.ZodIntersection="ZodIntersection",d.ZodTuple="ZodTuple",d.ZodRecord="ZodRecord",d.ZodMap="ZodMap",d.ZodSet="ZodSet",d.ZodFunction="ZodFunction",d.ZodLazy="ZodLazy",d.ZodLiteral="ZodLiteral",d.ZodEnum="ZodEnum",d.ZodEffects="ZodEffects",d.ZodNativeEnum="ZodNativeEnum",d.ZodOptional="ZodOptional",d.ZodNullable="ZodNullable",d.ZodDefault="ZodDefault",d.ZodCatch="ZodCatch",d.ZodPromise="ZodPromise",d.ZodBranded="ZodBranded",d.ZodPipeline="ZodPipeline",d.ZodReadonly="ZodReadonly"})(ZodFirstPartyTypeKind||(ZodFirstPartyTypeKind={}));const instanceOfType=(d,m={message:`Input not instance of ${d.name}`})=>custom((g=>g instanceof d),m),stringType=ZodString.create,numberType=ZodNumber.create,nanType=ZodNaN.create,bigIntType=ZodBigInt.create,booleanType=ZodBoolean.create,dateType=ZodDate.create,symbolType=ZodSymbol.create,undefinedType=ZodUndefined.create,nullType=ZodNull.create,anyType=ZodAny.create,unknownType=ZodUnknown.create,neverType=ZodNever.create,voidType=ZodVoid.create,arrayType=ZodArray.create,objectType=ZodObject.create,strictObjectType=ZodObject.strictCreate,unionType=ZodUnion.create,discriminatedUnionType=ZodDiscriminatedUnion.create,intersectionType=ZodIntersection.create,tupleType=ZodTuple.create,recordType=ZodRecord.create,mapType=ZodMap.create,setType=ZodSet.create,functionType=ZodFunction.create,lazyType=ZodLazy.create,literalType=ZodLiteral.create,enumType=ZodEnum.create,nativeEnumType=ZodNativeEnum.create,promiseType=ZodPromise.create,effectsType=ZodEffects.create,optionalType=ZodOptional.create,nullableType=ZodNullable.create,preprocessType=ZodEffects.createWithPreprocess,pipelineType=ZodPipeline.create,ostring=()=>stringType().optional(),onumber=()=>numberType().optional(),oboolean=()=>booleanType().optional(),coerce={string:d=>ZodString.create({...d,coerce:!0}),number:d=>ZodNumber.create({...d,coerce:!0}),boolean:d=>ZodBoolean.create({...d,coerce:!0}),bigint:d=>ZodBigInt.create({...d,coerce:!0}),date:d=>ZodDate.create({...d,coerce:!0})},NEVER=INVALID;var z=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap,getErrorMap,makeIssue,EMPTY_PATH,addIssueToContext,ParseStatus,INVALID,DIRTY,OK,isAborted,isDirty,isValid,isAsync,get util(){return util$1},get objectUtil(){return objectUtil},ZodParsedType,getParsedType,ZodType,datetimeRegex,ZodString,ZodNumber,ZodBigInt,ZodBoolean,ZodDate,ZodSymbol,ZodUndefined,ZodNull,ZodAny,ZodUnknown,ZodNever,ZodVoid,ZodArray,ZodObject,ZodUnion,ZodDiscriminatedUnion,ZodIntersection,ZodTuple,ZodRecord,ZodMap,ZodSet,ZodFunction,ZodLazy,ZodLiteral,ZodEnum,ZodNativeEnum,ZodPromise,ZodEffects,ZodTransformer:ZodEffects,ZodOptional,ZodNullable,ZodDefault,ZodCatch,ZodNaN,BRAND,ZodBranded,ZodPipeline,ZodReadonly,custom,Schema:ZodType,ZodSchema:ZodType,late,get ZodFirstPartyTypeKind(){return ZodFirstPartyTypeKind},coerce,any:anyType,array:arrayType,bigint:bigIntType,boolean:booleanType,date:dateType,discriminatedUnion:discriminatedUnionType,effect:effectsType,enum:enumType,function:functionType,instanceof:instanceOfType,intersection:intersectionType,lazy:lazyType,literal:literalType,map:mapType,nan:nanType,nativeEnum:nativeEnumType,never:neverType,null:nullType,nullable:nullableType,number:numberType,object:objectType,oboolean,onumber,optional:optionalType,ostring,pipeline:pipelineType,preprocess:preprocessType,promise:promiseType,record:recordType,set:setType,strictObject:strictObjectType,string:stringType,symbol:symbolType,transformer:effectsType,tuple:tupleType,undefined:undefinedType,union:unionType,unknown:unknownType,void:voidType,NEVER,ZodIssueCode,quotelessJson,ZodError}),Edge,Edge2;Edge2=Edge||(Edge={}),Edge2[Edge2.EXTEND=1]="EXTEND",Edge2[Edge2.WRAP=2]="WRAP",Edge2[Edge2.CROP=3]="CROP";const JimpClassSchema=z.object({bitmap:z.object({data:z.union([z.instanceof(Buffer),z.instanceof(Uint8Array)]),width:z.number(),height:z.number()})}),BlitOptionsSchemaComplex=z.object({src:JimpClassSchema,x:z.number().optional(),y:z.number().optional(),srcX:z.number().optional(),srcY:z.number().optional(),srcW:z.number().optional(),srcH:z.number().optional()}),BlitOptionsSchema=z.union([JimpClassSchema,BlitOptionsSchemaComplex]),methods$h={blit(d,m){const g=BlitOptionsSchema.parse(m);let{src:w,x:$=0,y:I=0,srcX:D=0,srcY:F=0,srcW:U=w.bitmap.width,srcH:q=w.bitmap.height}="bitmap"in g?{src:g}:g;if(!("bitmap"in w))throw new Error("The source must be a Jimp image");if(typeof $!="number"||typeof I!="number")throw new Error("x and y must be numbers");$=Math.round($),I=Math.round(I),D=Math.round(D),F=Math.round(F),U=Math.round(U),q=Math.round(q);const j=d.bitmap.width,G=d.bitmap.height;return scan(w,D,F,U,q,(function(H,V,Z){const Q=$+H-D,J=I+V-F;if(Q>=0&&J>=0&&j-Q>0&&G-J>0){const ie=d.getPixelIndex(Q,J),re={r:w.bitmap.data[Z]||0,g:w.bitmap.data[Z+1]||0,b:w.bitmap.data[Z+2]||0,a:w.bitmap.data[Z+3]||0},se={r:d.bitmap.data[ie]||0,g:d.bitmap.data[ie+1]||0,b:d.bitmap.data[ie+2]||0,a:d.bitmap.data[ie+3]||0};d.bitmap.data[ie]=(re.a*(re.r-se.r)-se.r+255>>8)+se.r,d.bitmap.data[ie+1]=(re.a*(re.g-se.g)-se.g+255>>8)+se.g,d.bitmap.data[ie+2]=(re.a*(re.b-se.b)-se.b+255>>8)+se.b,d.bitmap.data[ie+3]=limit255(se.a+re.a)}})),d}},mulTable=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1],shgTable=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18],methods$g={blur(d,m){if(typeof m!="number")throw new Error("r must be a number");if(m<1)throw new Error("r must be greater than 0");let g,w,$,I,D,F,U,q,j,G,H,V,Z;const Q=d.bitmap.width-1,J=d.bitmap.height-1,ie=m+1,re=mulTable[m],se=shgTable[m],X=[],ne=[],ce=[],oe=[],de=[],me=[];let ge=2;for(;ge-- >0;){for(V=0,Z=0,F=0;F<d.bitmap.height;F++){for(g=d.bitmap.data[Z]*ie,w=d.bitmap.data[Z+1]*ie,$=d.bitmap.data[Z+2]*ie,I=d.bitmap.data[Z+3]*ie,U=1;U<=m;U++)q=Z+((U>Q?Q:U)<<2),g+=d.bitmap.data[q++],w+=d.bitmap.data[q++],$+=d.bitmap.data[q++],I+=d.bitmap.data[q];for(D=0;D<d.bitmap.width;D++)X[V]=g,ne[V]=w,ce[V]=$,oe[V]=I,F===0&&(de[D]=((q=D+ie)<Q?q:Q)<<2,me[D]=(q=D-m)>0?q<<2:0),j=Z+de[D],G=Z+me[D],g+=d.bitmap.data[j++]-d.bitmap.data[G++],w+=d.bitmap.data[j++]-d.bitmap.data[G++],$+=d.bitmap.data[j++]-d.bitmap.data[G++],I+=d.bitmap.data[j]-d.bitmap.data[G++],V++;Z+=d.bitmap.width<<2}for(D=0;D<d.bitmap.width;D++){for(H=D,g=X[H]*ie,w=ne[H]*ie,$=ce[H]*ie,I=oe[H]*ie,U=1;U<=m;U++)H+=U>J?0:d.bitmap.width,g+=X[H],w+=ne[H],$+=ce[H],I+=oe[H];for(V=D<<2,F=0;F<d.bitmap.height;F++)d.bitmap.data[V]=limit255(g*re>>>se),d.bitmap.data[V+1]=limit255(w*re>>>se),d.bitmap.data[V+2]=limit255($*re>>>se),d.bitmap.data[V+3]=limit255(I*re>>>se),D===0&&(de[F]=((q=F+ie)<J?q:J)*d.bitmap.width,me[F]=(q=F-m)>0?q*d.bitmap.width:0),j=D+de[F],G=D+me[F],g+=X[j]-X[G],w+=ne[j]-ne[G],$+=ce[j]-ce[G],I+=oe[j]-oe[G],V+=d.bitmap.width<<2}}return d},gaussian(d,m){if(typeof m!="number")throw new Error("r must be a number");if(m<1)throw new Error("r must be greater than 0");const g=Math.ceil(2.57*m),w=2*g+1,$=m*m*2,I=$*Math.PI,D=[];for(let F=0;F<w;F++){const U=[];for(let q=0;q<w;q++){const j=(q-g)**2+(F-g)**2;U[q]=Math.exp(-j/$)/I}D.push(U)}for(let F=0;F<d.bitmap.height;F++)for(let U=0;U<d.bitmap.width;U++){let q=0,j=0,G=0,H=0,V=0;for(let Z=0;Z<w;Z++){for(let J=0;J<w;J++){const ie=Math.min(d.bitmap.width-1,Math.max(0,J+U-g)),re=Math.min(d.bitmap.height-1,Math.max(0,Z+F-g)),se=D[Z][J],X=re*d.bitmap.width+ie<<2;q+=d.bitmap.data[X]*se,j+=d.bitmap.data[X+1]*se,G+=d.bitmap.data[X+2]*se,H+=d.bitmap.data[X+3]*se,V+=se}const Q=F*d.bitmap.width+U<<2;d.bitmap.data[Q]=Math.round(q/V),d.bitmap.data[Q+1]=Math.round(j/V),d.bitmap.data[Q+2]=Math.round(G/V),d.bitmap.data[Q+3]=Math.round(H/V)}}return d}},CircleOptionsSchema=z.object({x:z.number().optional(),y:z.number().optional(),radius:z.number().min(0).optional()}),methods$f={circle(d,m={}){const g=CircleOptionsSchema.parse(m),w=g.radius||(d.bitmap.width>d.bitmap.height?d.bitmap.height:d.bitmap.width)/2,$=typeof g.x=="number"?g.x:d.bitmap.width/2,I=typeof g.y=="number"?g.y:d.bitmap.height/2;return d.scan(((D,F,U)=>{const q=Math.sqrt(Math.pow(D-$,2)+Math.pow(F-I,2));w-q<=0?d.bitmap.data[U+3]=0:w-q<1&&(d.bitmap.data[U+3]=255*(w-q))})),d}},ConvolutionMatrixSchema=z.array(z.number()).min(1).array(),ConvolutionComplexOptionsSchema=z.object({kernel:ConvolutionMatrixSchema,edgeHandling:z.nativeEnum(Edge).optional()}),ConvolutionOptionsSchema=z.union([ConvolutionMatrixSchema,ConvolutionComplexOptionsSchema]),ConvoluteComplexOptionsSchema=z.object({kernel:ConvolutionMatrixSchema,x:z.number().optional(),y:z.number().optional(),w:z.number().optional(),h:z.number().optional()}),ConvoluteOptionsSchema=z.union([ConvolutionMatrixSchema,ConvoluteComplexOptionsSchema]),PixelateSize=z.number().min(1).max(1/0),PixelateComplexOptionsSchema=z.object({size:PixelateSize,x:z.number().optional(),y:z.number().optional(),w:z.number().optional(),h:z.number().optional()}),PixelateOptionsSchema=z.union([PixelateSize,PixelateComplexOptionsSchema]);function applyKernel(d,m,g,w){const $=[0,0,0,0],I=(m.length-1)/2;for(let D=0;D<m.length;D+=1)for(let F=0;F<m[D].length;F+=1){const U=d.getPixelIndex(g+D-I,w+F-I);$[0]+=d.bitmap.data[U]*m[D][F],$[1]+=d.bitmap.data[U+1]*m[D][F],$[2]+=d.bitmap.data[U+2]*m[D][F],$[3]+=d.bitmap.data[U+3]*m[D][F]}return $}function mix(d,m,g=50){return{r:(m.r-d.r)*(g/100)+d.r,g:(m.g-d.g)*(g/100)+d.g,b:(m.b-d.b)*(g/100)+d.b}}const HueActionSchema=z.object({apply:z.literal("hue"),params:z.tuple([z.number().min(-360).max(360)])}),SpinActionSchema=z.object({apply:z.literal("spin"),params:z.tuple([z.number().min(-360).max(360)])}),LightenActionSchema=z.object({apply:z.literal("lighten"),params:z.tuple([z.number().min(0).max(100)]).optional()}),RGBColorSchema=z.object({r:z.number().min(0).max(255),g:z.number().min(0).max(255),b:z.number().min(0).max(255)}),MixActionSchema=z.object({apply:z.literal("mix"),params:z.union([z.tuple([RGBColorSchema]),z.tuple([RGBColorSchema,z.number().min(0).max(100)])])}),TintActionSchema=z.object({apply:z.literal("tint"),params:z.tuple([z.number().min(0).max(100)]).optional()}),ShadeActionSchema=z.object({apply:z.literal("shade"),params:z.tuple([z.number().min(0).max(100)]).optional()}),XorActionSchema=z.object({apply:z.literal("xor"),params:z.tuple([RGBColorSchema])}),RedActionSchema=z.object({apply:z.literal("red"),params:z.tuple([z.number().min(-255).max(255)])}),GreenActionSchema=z.object({apply:z.literal("green"),params:z.tuple([z.number().min(-255).max(255)])}),BlueActionSchema=z.object({apply:z.literal("blue"),params:z.tuple([z.number().min(-255).max(255)])}),BrightenActionSchema=z.object({apply:z.literal("brighten"),params:z.tuple([z.number().min(0).max(100)]).optional()}),DarkenActionSchema=z.object({apply:z.literal("darken"),params:z.tuple([z.number().min(0).max(100)]).optional()}),DesaturateActionSchema=z.object({apply:z.literal("desaturate"),params:z.tuple([z.number().min(0).max(100)]).optional()}),SaturateActionSchema=z.object({apply:z.literal("saturate"),params:z.tuple([z.number().min(0).max(100)]).optional()}),GrayscaleActionSchema=z.object({apply:z.literal("greyscale"),params:z.tuple([]).optional()}),ColorActionNameSchema=z.union([HueActionSchema,SpinActionSchema,LightenActionSchema,MixActionSchema,TintActionSchema,ShadeActionSchema,XorActionSchema,RedActionSchema,GreenActionSchema,BlueActionSchema,BrightenActionSchema,DarkenActionSchema,DesaturateActionSchema,SaturateActionSchema,GrayscaleActionSchema]);function histogram(d){const m={r:new Array(256).fill(0),g:new Array(256).fill(0),b:new Array(256).fill(0)};return d.scan(((g,w,$)=>{m.r[d.bitmap.data[$+0]]++,m.g[d.bitmap.data[$+1]]++,m.b[d.bitmap.data[$+2]]++})),m}const normalizeValue=function(d,m,g){return 255*(d-m)/(g-m)},getBounds=function(d){return[d.findIndex((m=>m>0)),255-d.slice().reverse().findIndex((m=>m>0))]},methods$e={normalize(d){const m=histogram(d),g={r:getBounds(m.r),g:getBounds(m.g),b:getBounds(m.b)};return d.scan(((w,$,I)=>{const D=d.bitmap.data[I+0],F=d.bitmap.data[I+1],U=d.bitmap.data[I+2];d.bitmap.data[I+0]=normalizeValue(D,g.r[0],g.r[1]),d.bitmap.data[I+1]=normalizeValue(F,g.g[0],g.g[1]),d.bitmap.data[I+2]=normalizeValue(U,g.b[0],g.b[1])})),d},invert:d=>(d.scan(((m,g,w)=>{d.bitmap.data[w]=255-d.bitmap.data[w],d.bitmap.data[w+1]=255-d.bitmap.data[w+1],d.bitmap.data[w+2]=255-d.bitmap.data[w+2]})),d),brightness(d,m){if(typeof m!="number")throw new Error("val must be numbers");return d.scan(((g,w,$)=>{d.bitmap.data[$]=limit255(d.bitmap.data[$]*m),d.bitmap.data[$+1]=limit255(d.bitmap.data[$+1]*m),d.bitmap.data[$+2]=limit255(d.bitmap.data[$+2]*m)})),d},contrast(d,m){if(typeof m!="number")throw new Error("val must be numbers");if(m<-1||m>1)throw new Error("val must be a number between -1 and +1");const g=(m+1)/(1-m);function w($){return($=Math.floor(g*($-127)+127))<0?0:$>255?255:$}return d.scan((($,I,D)=>{d.bitmap.data[D]=w(d.bitmap.data[D]),d.bitmap.data[D+1]=w(d.bitmap.data[D+1]),d.bitmap.data[D+2]=w(d.bitmap.data[D+2])})),d},posterize(d,m){if(typeof m!="number")throw new Error("n must be numbers");return m<2&&(m=2),d.scan(((g,w,$)=>{const I=d.bitmap.data[$],D=d.bitmap.data[$+1],F=d.bitmap.data[$+2];d.bitmap.data[$]=Math.floor(I/255*(m-1))/(m-1)*255,d.bitmap.data[$+1]=Math.floor(D/255*(m-1))/(m-1)*255,d.bitmap.data[$+2]=Math.floor(F/255*(m-1))/(m-1)*255})),d},greyscale:d=>(d.scan(((m,g,w)=>{const $=.2126*d.bitmap.data[w]+.7152*d.bitmap.data[w+1]+.0722*d.bitmap.data[w+2];d.bitmap.data[w]=$,d.bitmap.data[w+1]=$,d.bitmap.data[w+2]=$})),d),opacity(d,m){if(typeof m!="number")throw new Error("f must be a number");if(m<0||m>1)throw new Error("f must be a number from 0 to 1");return d.scan(((g,w,$)=>{const I=d.bitmap.data[$+3]*m;d.bitmap.data[$+3]=I})),d},sepia:d=>(d.scan(((m,g,w)=>{let $=d.bitmap.data[w],I=d.bitmap.data[w+1],D=d.bitmap.data[w+2];$=.393*$+.769*I+.189*D,I=.349*$+.686*I+.168*D,D=.272*$+.534*I+.131*D,d.bitmap.data[w]=$<255?$:255,d.bitmap.data[w+1]=I<255?I:255,d.bitmap.data[w+2]=D<255?D:255})),d),fade(d,m){if(typeof m!="number")throw new Error("f must be a number");if(m<0||m>1)throw new Error("f must be a number from 0 to 1");return this.opacity(d,1-m)},convolution(d,m){const g=ConvolutionOptionsSchema.parse(m),{kernel:w,edgeHandling:$=Edge.EXTEND}="kernel"in g?g:{kernel:g,edgeHandling:void 0};if(!w[0])throw new Error("kernel must be a matrix");const I=Buffer.from(d.bitmap.data),D=w.length,F=w[0].length,U=Math.floor(D/2),q=Math.floor(F/2),j=-U,G=-q;let H,V,Z,Q,J,ie,re,se,X,ne;return d.scan(((ce,oe,de)=>{Q=0,Z=0,V=0;for(let me=j;me<=U;me++)for(let ge=G;ge<=q;ge++)se=ce+ge,X=oe+me,H=w[me+U][ge+q],ne=d.getPixelIndex(se,X,$),ne===-1?(re=0,ie=0,J=0):(J=d.bitmap.data[ne+0],ie=d.bitmap.data[ne+1],re=d.bitmap.data[ne+2]),V+=H*J,Z+=H*ie,Q+=H*re;V<0&&(V=0),Z<0&&(Z=0),Q<0&&(Q=0),V>255&&(V=255),Z>255&&(Z=255),Q>255&&(Q=255),I[de+0]=V,I[de+1]=Z,I[de+2]=Q})),d.bitmap.data=I,d},opaque:d=>(d.scan(((m,g,w)=>{d.bitmap.data[w+3]=255})),d),pixelate(d,m){const g=PixelateOptionsSchema.parse(m),{size:w,x:$=0,y:I=0,w:D=d.bitmap.width-$,h:F=d.bitmap.height-I}=typeof g=="number"?{size:g}:g,U=[[1/16,2/16,1/16],[2/16,.25,2/16],[1/16,2/16,1/16]],q=clone(d);return scan(q,$,I,D,F,((j,G,H)=>{j=w*Math.floor(j/w),G=w*Math.floor(G/w);const V=applyKernel(q,U,j,G);d.bitmap.data[H]=V[0],d.bitmap.data[H+1]=V[1],d.bitmap.data[H+2]=V[2],d.bitmap.data[H+3]=V[3]})),d},convolute(d,m){const g=ConvoluteOptionsSchema.parse(m),{kernel:w,x:$=0,y:I=0,w:D=d.bitmap.width-$,h:F=d.bitmap.height-I}="kernel"in g?g:{kernel:g},U=clone(d);return scan(U,$,I,D,F,((q,j,G)=>{const H=applyKernel(U,w,q,j);d.bitmap.data[G]=limit255(H[0]),d.bitmap.data[G+1]=limit255(H[1]),d.bitmap.data[G+2]=limit255(H[2]),d.bitmap.data[G+3]=limit255(H[3])})),d},color(d,m){if(!m||!Array.isArray(m))throw new Error("actions must be an array");return m.forEach((g=>ColorActionNameSchema.parse(g))),m=m.map((g=>(g.apply!=="xor"&&g.apply!=="mix"||(g.params[0]=tinycolor(g.params[0]).toRgb()),g))),d.scan(((g,w,$)=>{let I={r:d.bitmap.data[$],g:d.bitmap.data[$+1],b:d.bitmap.data[$+2]};const D=(F,U)=>limit255(I[F]+U);m.forEach((F=>{if(F.apply==="mix")I=mix(I,F.params[0],F.params[1]);else if(F.apply==="tint")I=mix(I,{r:255,g:255,b:255},F.params?.[0]);else if(F.apply==="shade")I=mix(I,{r:0,g:0,b:0},F.params?.[0]);else if(F.apply==="xor")I={r:I.r^F.params[0].r,g:I.g^F.params[0].g,b:I.b^F.params[0].b};else if(F.apply==="red")I.r=D("r",F.params[0]);else if(F.apply==="green")I.g=D("g",F.params[0]);else if(F.apply==="blue")I.b=D("b",F.params[0]);else{F.apply==="hue"&&(F.apply="spin");const U=tinycolor(I),q=U[F.apply].bind(U);if(!q)throw new Error("action "+F.apply+" not supported");I=q(...F.params||[]).toRgb()}})),d.bitmap.data[$]=I.r,d.bitmap.data[$+1]=I.g,d.bitmap.data[$+2]=I.b})),d}};var lib$1={},ieee754={read:function(d,m,g,w,$){var I,D,F=8*$-w-1,U=(1<<F)-1,q=U>>1,j=-7,G=g?$-1:0,H=g?-1:1,V=d[m+G];for(G+=H,I=V&(1<<-j)-1,V>>=-j,j+=F;j>0;I=256*I+d[m+G],G+=H,j-=8);for(D=I&(1<<-j)-1,I>>=-j,j+=w;j>0;D=256*D+d[m+G],G+=H,j-=8);if(I===0)I=1-q;else{if(I===U)return D?NaN:1/0*(V?-1:1);D+=Math.pow(2,w),I-=q}return(V?-1:1)*D*Math.pow(2,I-w)},write:function(d,m,g,w,$,I){var D,F,U,q=8*I-$-1,j=(1<<q)-1,G=j>>1,H=$===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=w?0:I-1,Z=w?1:-1,Q=m<0||m===0&&1/m<0?1:0;for(m=Math.abs(m),isNaN(m)||m===1/0?(F=isNaN(m)?1:0,D=j):(D=Math.floor(Math.log(m)/Math.LN2),m*(U=Math.pow(2,-D))<1&&(D--,U*=2),(m+=D+G>=1?H/U:H*Math.pow(2,1-G))*U>=2&&(D++,U/=2),D+G>=j?(F=0,D=j):D+G>=1?(F=(m*U-1)*Math.pow(2,$),D+=G):(F=m*Math.pow(2,G-1)*Math.pow(2,$),D=0));$>=8;d[g+V]=255&F,V+=Z,F/=256,$-=8);for(D=D<<$|F,q+=$;q>0;d[g+V]=255&D,V+=Z,D/=256,q-=8);d[g+V-Z]|=128*Q}};(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.AnsiStringType=d.StringType=d.BufferType=d.Uint8ArrayType=d.IgnoreType=d.Float80_LE=d.Float80_BE=d.Float64_LE=d.Float64_BE=d.Float32_LE=d.Float32_BE=d.Float16_LE=d.Float16_BE=d.INT64_BE=d.UINT64_BE=d.INT64_LE=d.UINT64_LE=d.INT32_LE=d.INT32_BE=d.INT24_BE=d.INT24_LE=d.INT16_LE=d.INT16_BE=d.INT8=d.UINT32_BE=d.UINT32_LE=d.UINT24_BE=d.UINT24_LE=d.UINT16_BE=d.UINT16_LE=d.UINT8=void 0;const m=ieee754;function g($){return new DataView($.buffer,$.byteOffset)}d.UINT8={len:1,get:($,I)=>g($).getUint8(I),put:($,I,D)=>(g($).setUint8(I,D),I+1)},d.UINT16_LE={len:2,get:($,I)=>g($).getUint16(I,!0),put:($,I,D)=>(g($).setUint16(I,D,!0),I+2)},d.UINT16_BE={len:2,get:($,I)=>g($).getUint16(I),put:($,I,D)=>(g($).setUint16(I,D),I+2)},d.UINT24_LE={len:3,get($,I){const D=g($);return D.getUint8(I)+(D.getUint16(I+1,!0)<<8)},put($,I,D){const F=g($);return F.setUint8(I,255&D),F.setUint16(I+1,D>>8,!0),I+3}},d.UINT24_BE={len:3,get($,I){const D=g($);return(D.getUint16(I)<<8)+D.getUint8(I+2)},put($,I,D){const F=g($);return F.setUint16(I,D>>8),F.setUint8(I+2,255&D),I+3}},d.UINT32_LE={len:4,get:($,I)=>g($).getUint32(I,!0),put:($,I,D)=>(g($).setUint32(I,D,!0),I+4)},d.UINT32_BE={len:4,get:($,I)=>g($).getUint32(I),put:($,I,D)=>(g($).setUint32(I,D),I+4)},d.INT8={len:1,get:($,I)=>g($).getInt8(I),put:($,I,D)=>(g($).setInt8(I,D),I+1)},d.INT16_BE={len:2,get:($,I)=>g($).getInt16(I),put:($,I,D)=>(g($).setInt16(I,D),I+2)},d.INT16_LE={len:2,get:($,I)=>g($).getInt16(I,!0),put:($,I,D)=>(g($).setInt16(I,D,!0),I+2)},d.INT24_LE={len:3,get($,I){const D=d.UINT24_LE.get($,I);return D>8388607?D-16777216:D},put($,I,D){const F=g($);return F.setUint8(I,255&D),F.setUint16(I+1,D>>8,!0),I+3}},d.INT24_BE={len:3,get($,I){const D=d.UINT24_BE.get($,I);return D>8388607?D-16777216:D},put($,I,D){const F=g($);return F.setUint16(I,D>>8),F.setUint8(I+2,255&D),I+3}},d.INT32_BE={len:4,get:($,I)=>g($).getInt32(I),put:($,I,D)=>(g($).setInt32(I,D),I+4)},d.INT32_LE={len:4,get:($,I)=>g($).getInt32(I,!0),put:($,I,D)=>(g($).setInt32(I,D,!0),I+4)},d.UINT64_LE={len:8,get:($,I)=>g($).getBigUint64(I,!0),put:($,I,D)=>(g($).setBigUint64(I,D,!0),I+8)},d.INT64_LE={len:8,get:($,I)=>g($).getBigInt64(I,!0),put:($,I,D)=>(g($).setBigInt64(I,D,!0),I+8)},d.UINT64_BE={len:8,get:($,I)=>g($).getBigUint64(I),put:($,I,D)=>(g($).setBigUint64(I,D),I+8)},d.INT64_BE={len:8,get:($,I)=>g($).getBigInt64(I),put:($,I,D)=>(g($).setBigInt64(I,D),I+8)},d.Float16_BE={len:2,get($,I){return m.read($,I,!1,10,this.len)},put($,I,D){return m.write($,D,I,!1,10,this.len),I+this.len}},d.Float16_LE={len:2,get($,I){return m.read($,I,!0,10,this.len)},put($,I,D){return m.write($,D,I,!0,10,this.len),I+this.len}},d.Float32_BE={len:4,get:($,I)=>g($).getFloat32(I),put:($,I,D)=>(g($).setFloat32(I,D),I+4)},d.Float32_LE={len:4,get:($,I)=>g($).getFloat32(I,!0),put:($,I,D)=>(g($).setFloat32(I,D,!0),I+4)},d.Float64_BE={len:8,get:($,I)=>g($).getFloat64(I),put:($,I,D)=>(g($).setFloat64(I,D),I+8)},d.Float64_LE={len:8,get:($,I)=>g($).getFloat64(I,!0),put:($,I,D)=>(g($).setFloat64(I,D,!0),I+8)},d.Float80_BE={len:10,get($,I){return m.read($,I,!1,63,this.len)},put($,I,D){return m.write($,D,I,!1,63,this.len),I+this.len}},d.Float80_LE={len:10,get($,I){return m.read($,I,!0,63,this.len)},put($,I,D){return m.write($,D,I,!0,63,this.len),I+this.len}},d.IgnoreType=class{constructor($){this.len=$}get($,I){}},d.Uint8ArrayType=class{constructor($){this.len=$}get($,I){return $.subarray(I,I+this.len)}},d.BufferType=class{constructor($){this.len=$}get($,I){return Buffer.from($.subarray(I,I+this.len))}},d.StringType=class{constructor($,I){this.len=$,this.encoding=I}get($,I){return Buffer.from($).toString(this.encoding,I,I+this.len)}};class w{constructor(I){this.len=I}static decode(I,D,F){let U="";for(let q=D;q<F;++q)U+=w.codePointToString(w.singleByteDecoder(I[q]));return U}static inRange(I,D,F){return D<=I&&I<=F}static codePointToString(I){return I<=65535?String.fromCharCode(I):(I-=65536,String.fromCharCode(55296+(I>>10),56320+(1023&I)))}static singleByteDecoder(I){if(w.inRange(I,0,127))return I;const D=w.windows1252[I-128];if(D===null)throw Error("invaliding encoding");return D}get(I,D=0){return w.decode(I,D,D+this.len)}}d.AnsiStringType=w,w.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]})(lib$1);var core$1={},ReadStreamTokenizer$1={},AbstractTokenizer$1={},lib={},EndOfFileStream={};(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.EndOfStreamError=d.defaultMessages=void 0,d.defaultMessages="End-Of-Stream";class m extends Error{constructor(){super(d.defaultMessages)}}d.EndOfStreamError=m})(EndOfFileStream);var StreamReader={},Deferred$1={};Object.defineProperty(Deferred$1,"__esModule",{value:!0}),Deferred$1.Deferred=void 0;class Deferred{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise(((m,g)=>{this.reject=g,this.resolve=m}))}}Deferred$1.Deferred=Deferred,(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.StreamReader=d.EndOfStreamError=void 0;const m=EndOfFileStream,g=Deferred$1;var w=EndOfFileStream;Object.defineProperty(d,"EndOfStreamError",{enumerable:!0,get:function(){return w.EndOfStreamError}}),d.StreamReader=class{constructor($){if(this.s=$,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!$.read||!$.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",(()=>this.reject(new m.EndOfStreamError))),this.s.once("error",(I=>this.reject(I))),this.s.once("close",(()=>this.reject(new Error("Stream closed"))))}async peek($,I,D){const F=await this.read($,I,D);return this.peekQueue.push($.subarray(I,I+F)),F}async read($,I,D){if(D===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new m.EndOfStreamError;let F=D,U=0;for(;this.peekQueue.length>0&&F>0;){const q=this.peekQueue.pop();if(!q)throw new Error("peekData should be defined");const j=Math.min(q.length,F);$.set(q.subarray(0,j),I+U),U+=j,F-=j,j<q.length&&this.peekQueue.push(q.subarray(j))}for(;F>0&&!this.endOfStream;){const q=Math.min(F,1048576),j=await this.readFromStream($,I+U,q);if(U+=j,j<q)break;F-=j}return U}async readFromStream($,I,D){const F=this.s.read(D);if(F)return $.set(F,I),F.length;{const U={buffer:$,offset:I,length:D,deferred:new g.Deferred};return this.deferred=U.deferred,this.s.once("readable",(()=>{this.readDeferred(U)})),U.deferred.promise}}readDeferred($){const I=this.s.read($.length);I?($.buffer.set(I,$.offset),$.deferred.resolve(I.length),this.deferred=null):this.s.once("readable",(()=>{this.readDeferred($)}))}reject($){this.endOfStream=!0,this.deferred&&(this.deferred.reject($),this.deferred=null)}}})(StreamReader),(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.StreamReader=d.EndOfStreamError=void 0;var m=EndOfFileStream;Object.defineProperty(d,"EndOfStreamError",{enumerable:!0,get:function(){return m.EndOfStreamError}});var g=StreamReader;Object.defineProperty(d,"StreamReader",{enumerable:!0,get:function(){return g.StreamReader}})})(lib),Object.defineProperty(AbstractTokenizer$1,"__esModule",{value:!0}),AbstractTokenizer$1.AbstractTokenizer=void 0;const peek_readable_1$2=lib;class AbstractTokenizer{constructor(m){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=m||{}}async readToken(m,g=this.position){const w=Buffer.alloc(m.len);if(await this.readBuffer(w,{position:g})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(w,0)}async peekToken(m,g=this.position){const w=Buffer.alloc(m.len);if(await this.peekBuffer(w,{position:g})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(w,0)}async readNumber(m){if(await this.readBuffer(this.numBuffer,{length:m.len})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(this.numBuffer,0)}async peekNumber(m){if(await this.peekBuffer(this.numBuffer,{length:m.len})<m.len)throw new peek_readable_1$2.EndOfStreamError;return m.get(this.numBuffer,0)}async ignore(m){if(this.fileInfo.size!==void 0){const g=this.fileInfo.size-this.position;if(m>g)return this.position+=g,g}return this.position+=m,m}async close(){}normalizeOptions(m,g){if(g&&g.position!==void 0&&g.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return g?{mayBeLess:g.mayBeLess===!0,offset:g.offset?g.offset:0,length:g.length?g.length:m.length-(g.offset?g.offset:0),position:g.position?g.position:this.position}:{mayBeLess:!1,offset:0,length:m.length,position:this.position}}}AbstractTokenizer$1.AbstractTokenizer=AbstractTokenizer,Object.defineProperty(ReadStreamTokenizer$1,"__esModule",{value:!0}),ReadStreamTokenizer$1.ReadStreamTokenizer=void 0;const AbstractTokenizer_1$1=AbstractTokenizer$1,peek_readable_1$1=lib,maxBufferSize=256e3;class ReadStreamTokenizer extends AbstractTokenizer_1$1.AbstractTokenizer{constructor(m,g){super(g),this.streamReader=new peek_readable_1$1.StreamReader(m)}async getFileInfo(){return this.fileInfo}async readBuffer(m,g){const w=this.normalizeOptions(m,g),$=w.position-this.position;if($>0)return await this.ignore($),this.readBuffer(m,g);if($<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(w.length===0)return 0;const I=await this.streamReader.read(m,w.offset,w.length);if(this.position+=I,(!g||!g.mayBeLess)&&I<w.length)throw new peek_readable_1$1.EndOfStreamError;return I}async peekBuffer(m,g){const w=this.normalizeOptions(m,g);let $=0;if(w.position){const I=w.position-this.position;if(I>0){const D=new Uint8Array(w.length+I);return $=await this.peekBuffer(D,{mayBeLess:w.mayBeLess}),m.set(D.subarray(I),w.offset),$-I}if(I<0)throw new Error("Cannot peek from a negative offset in a stream")}if(w.length>0){try{$=await this.streamReader.peek(m,w.offset,w.length)}catch(I){if(g&&g.mayBeLess&&I instanceof peek_readable_1$1.EndOfStreamError)return 0;throw I}if(!w.mayBeLess&&$<w.length)throw new peek_readable_1$1.EndOfStreamError}return $}async ignore(m){const g=Math.min(maxBufferSize,m),w=new Uint8Array(g);let $=0;for(;$<m;){const I=m-$,D=await this.readBuffer(w,{length:Math.min(g,I)});if(D<0)return D;$+=D}return $}}ReadStreamTokenizer$1.ReadStreamTokenizer=ReadStreamTokenizer;var BufferTokenizer$1={};Object.defineProperty(BufferTokenizer$1,"__esModule",{value:!0}),BufferTokenizer$1.BufferTokenizer=void 0;const peek_readable_1=lib,AbstractTokenizer_1=AbstractTokenizer$1;class BufferTokenizer extends AbstractTokenizer_1.AbstractTokenizer{constructor(m,g){super(g),this.uint8Array=m,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:m.length}async readBuffer(m,g){if(g&&g.position){if(g.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=g.position}const w=await this.peekBuffer(m,g);return this.position+=w,w}async peekBuffer(m,g){const w=this.normalizeOptions(m,g),$=Math.min(this.uint8Array.length-w.position,w.length);if(!w.mayBeLess&&$<w.length)throw new peek_readable_1.EndOfStreamError;return m.set(this.uint8Array.subarray(w.position,w.position+$),w.offset),$}async close(){}}BufferTokenizer$1.BufferTokenizer=BufferTokenizer,(function(d){Object.defineProperty(d,"__esModule",{value:!0}),d.fromBuffer=d.fromStream=d.EndOfStreamError=void 0;const m=ReadStreamTokenizer$1,g=BufferTokenizer$1;var w=lib;Object.defineProperty(d,"EndOfStreamError",{enumerable:!0,get:function(){return w.EndOfStreamError}}),d.fromStream=function($,I){return I=I||{},new m.ReadStreamTokenizer($,I)},d.fromBuffer=function($,I){return new g.BufferTokenizer($,I)}})(core$1);var util={stringToBytes:d=>[...d].map((m=>m.charCodeAt(0))),tarHeaderChecksumMatches:(d,m=0)=>{const g=parseInt(d.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(g))return!1;let w=256;for(let $=m;$<m+148;$++)w+=d[$];for(let $=m+156;$<m+512;$++)w+=d[$];return g===w},uint32SyncSafeToken:{get:(d,m)=>127&d[m+3]|d[m+2]<<7|d[m+1]<<14|d[m]<<21,len:4}},supported$1={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]};const Token=lib$1,strtok3=core$1,{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=util,supported=supported$1,minimumBytes=4100;async function fromStream(d){const m=await strtok3.fromStream(d);try{return await fromTokenizer(m)}finally{await m.close()}}async function fromBuffer(d){if(!(d instanceof Uint8Array||d instanceof ArrayBuffer||Buffer.isBuffer(d)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof d}\``);const m=d instanceof Buffer?d:Buffer.from(d);if(m&&m.length>1)return fromTokenizer(strtok3.fromBuffer(m))}function _check(d,m,g){g={offset:0,...g};for(const[w,$]of m.entries())if(g.mask){if($!==(g.mask[w]&d[w+g.offset]))return!1}else if($!==d[w+g.offset])return!1;return!0}async function fromTokenizer(d){try{return _fromTokenizer(d)}catch(m){if(!(m instanceof strtok3.EndOfStreamError))throw m}}async function _fromTokenizer(d){let m=Buffer.alloc(minimumBytes);const g=($,I)=>_check(m,$,I),w=($,I)=>g(stringToBytes($),I);if(d.fileInfo.size||(d.fileInfo.size=Number.MAX_SAFE_INTEGER),await d.peekBuffer(m,{length:12,mayBeLess:!0}),g([66,77]))return{ext:"bmp",mime:"image/bmp"};if(g([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(g([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(g([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(g([37,33]))return await d.peekBuffer(m,{length:24,mayBeLess:!0}),w("PS-Adobe-",{offset:2})&&w(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(g([31,160])||g([31,157]))return{ext:"Z",mime:"application/x-compress"};if(g([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(g([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(g([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(g([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(w("ID3")){await d.ignore(6);const $=await d.readToken(uint32SyncSafeToken);return d.position+$>d.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await d.ignore($),fromTokenizer(d))}if(w("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((m[0]===67||m[0]===70)&&g([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(g([71,73,70]))return{ext:"gif",mime:"image/gif"};if(w("FLIF"))return{ext:"flif",mime:"image/flif"};if(w("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(w("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(w("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(w("FORM"))return{ext:"aif",mime:"audio/aiff"};if(w("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(g([80,75,3,4])){try{for(;d.position+30<d.fileInfo.size;){await d.readBuffer(m,{length:30});const $={compressedSize:m.readUInt32LE(18),uncompressedSize:m.readUInt32LE(22),filenameLength:m.readUInt16LE(26),extraFieldLength:m.readUInt16LE(28)};if($.filename=await d.readToken(new Token.StringType($.filenameLength,"utf-8")),await d.ignore($.extraFieldLength),$.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if($.filename.endsWith(".rels")||$.filename.endsWith(".xml"))switch($.filename.split("/")[0]){case"_rels":default:break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}if($.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if($.filename.startsWith("3D/")&&$.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if($.filename==="mimetype"&&$.compressedSize===$.uncompressedSize)switch(await d.readToken(new Token.StringType($.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"}}if($.compressedSize===0){let I=-1;for(;I<0&&d.position<d.fileInfo.size;)await d.peekBuffer(m,{mayBeLess:!0}),I=m.indexOf("504B0304",0,"hex"),await d.ignore(I>=0?I:m.length)}else await d.ignore($.compressedSize)}}catch($){if(!($ instanceof strtok3.EndOfStreamError))throw $}return{ext:"zip",mime:"application/zip"}}if(w("OggS")){await d.ignore(28);const $=Buffer.alloc(8);return await d.readBuffer($),_check($,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check($,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check($,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check($,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check($,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check($,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(g([80,75])&&(m[2]===3||m[2]===5||m[2]===7)&&(m[3]===4||m[3]===6||m[3]===8))return{ext:"zip",mime:"application/zip"};if(w("ftyp",{offset:4})&&96&m[8]){const $=m.toString("binary",8,12).replace("\0"," ").trim();switch($){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return $.startsWith("3g")?$.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(w("MThd"))return{ext:"mid",mime:"audio/midi"};if(w("wOFF")&&(g([0,1,0,0],{offset:4})||w("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(w("wOF2")&&(g([0,1,0,0],{offset:4})||w("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(g([212,195,178,161])||g([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(w("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(w("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(w("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(g([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(w("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(w("%PDF")){await d.ignore(1350);const $=10485760,I=Buffer.alloc(Math.min($,d.fileInfo.size));return await d.readBuffer(I,{mayBeLess:!0}),I.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(g([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(g([73,73,42,0]))return w("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:g([28,0,254,0],{offset:8})||g([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:g([8,0,0,0],{offset:4})&&(g([45,0,254,0],{offset:8})||g([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(m=Buffer.alloc(24),await d.peekBuffer(m),(g([16,251,134,1],{offset:4})||g([8,0,0,0],{offset:4}))&&g([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(g([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(w("MAC "))return{ext:"ape",mime:"audio/ape"};if(g([26,69,223,163])){async function $(){const U=await d.peekNumber(Token.UINT8);let q=128,j=0;for(;!(U&q)&&q!==0;)++j,q>>=1;const G=Buffer.alloc(j+1);return await d.readBuffer(G),G}async function I(){const U=await $(),q=await $();q[0]^=128>>q.length-1;const j=Math.min(6,q.length);return{id:U.readUIntBE(0,U.length),len:q.readUIntBE(q.length-j,j)}}async function D(U,q){for(;q>0;){const j=await I();if(j.id===17026)return d.readToken(new Token.StringType(j.len,"utf-8"));await d.ignore(j.len),--q}}const F=await I();switch(await D(0,F.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(g([82,73,70,70])){if(g([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(g([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(g([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(w("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(g([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(w("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(w("MSCF")||w("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(g([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(g([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(g([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(g([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(w("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(w("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(g([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(w("IMPM"))return{ext:"it",mime:"audio/x-it"};if(w("-lh0-",{offset:2})||w("-lh1-",{offset:2})||w("-lh2-",{offset:2})||w("-lh3-",{offset:2})||w("-lh4-",{offset:2})||w("-lh5-",{offset:2})||w("-lh6-",{offset:2})||w("-lh7-",{offset:2})||w("-lzs-",{offset:2})||w("-lz4-",{offset:2})||w("-lz5-",{offset:2})||w("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(g([0,0,1,186])){if(g([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(g([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(w("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(g([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(w("<?xml "))return{ext:"xml",mime:"application/xml"};if(g([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(g([82,97,114,33,26,7])&&(m[6]===0||m[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(w("solid "))return{ext:"stl",mime:"model/stl"};if(w("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(w("!<arch>"))return await d.ignore(8),await d.readToken(new Token.StringType(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(g([137,80,78,71,13,10,26,10])){async function $(){return{length:await d.readToken(Token.INT32_BE),type:await d.readToken(new Token.StringType(4,"binary"))}}await d.ignore(8);do{const I=await $();if(I.length<0)return;switch(I.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await d.ignore(I.length+4)}}while(d.position+8<d.fileInfo.size);return{ext:"png",mime:"image/png"}}if(g([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(g([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(g([102,114,101,101],{offset:4})||g([109,100,97,116],{offset:4})||g([109,111,111,118],{offset:4})||g([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(g([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(w("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(g([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(g([48,38,178,117,142,102,207,17,166,217])){async function $(){const I=Buffer.alloc(16);return await d.readBuffer(I),{id:I,size:Number(await d.readToken(Token.UINT64_LE))}}for(await d.ignore(30);d.position+24<d.fileInfo.size;){const I=await $();let D=I.size-24;if(_check(I.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const F=Buffer.alloc(16);if(D-=await d.readBuffer(F),_check(F,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(F,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await d.ignore(D)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(g([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((g([126,16,4])||g([126,24,4]))&&g([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(g([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(g([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await d.ignore(20),await d.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(g([255,10])||g([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(g([0,0,1,186])||g([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(g([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(g([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(g([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(g([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await d.peekBuffer(m,{length:Math.min(256,d.fileInfo.size),mayBeLess:!0}),w("BEGIN:")){if(w("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(w("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(w("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(w("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(w("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(g([4,0,0,0])&&m.length>=16){const $=m.readUInt32LE(12);if($>12&&m.length>=$+16)try{const I=m.slice(16,$+16).toString();if(JSON.parse(I).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(g([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(w("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(g([71],{offset:4})&&(g([71],{offset:192})||g([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(g([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(g([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(g([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(g([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(g([76,80],{offset:34})&&(g([0,0,1],{offset:8})||g([1,0,2],{offset:8})||g([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(g([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await d.peekBuffer(m,{length:Math.min(512,d.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(m))return{ext:"tar",mime:"application/x-tar"};if(g([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(w("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(m.length>=2&&g([255,224],{offset:0,mask:[255,224]})){if(g([16],{offset:1,mask:[22]}))return g([8],{offset:1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(g([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(g([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(g([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream=readableStream=>new Promise(((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",(async()=>{const d=new stream.PassThrough;let m;m=stream.pipeline?stream.pipeline(readableStream,d,(()=>{})):readableStream.pipe(d);const g=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const w=await fromBuffer(g);d.fileType=w}catch(w){reject(w)}resolve(m)}))})),fileType={fromStream,fromTokenizer,fromBuffer,stream};Object.defineProperty(fileType,"extensions",{get:()=>new Set(supported.extensions)}),Object.defineProperty(fileType,"mimeTypes",{get:()=>new Set(supported.mimeTypes)});var core=fileType,fileType$1=getDefaultExportFromCjs(core);function to(d,m){return d.then((function(g){return[null,g]})).catch((function(g){return[g,void 0]}))}const writeFile=async()=>{throw new Error("Not supported")};function Mime$1(){this._types=Object.create(null),this._extensions=Object.create(null);for(let d=0;d<arguments.length;d++)this.define(arguments[d]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}Mime$1.prototype.define=function(d,m){for(let g in d){let w=d[g].map((function($){return $.toLowerCase()}));g=g.toLowerCase();for(let $=0;$<w.length;$++){const I=w[$];if(I[0]!=="*"){if(!m&&I in this._types)throw new Error('Attempt to change mapping for "'+I+'" extension from "'+this._types[I]+'" to "'+g+'". Pass `force=true` to allow this, otherwise remove "'+I+'" from the list of extensions for "'+g+'".');this._types[I]=g}}if(m||!this._extensions[g]){const $=w[0];this._extensions[g]=$[0]!=="*"?$:$.substr(1)}}},Mime$1.prototype.getType=function(d){let m=(d=String(d)).replace(/^.*[/\\]/,"").toLowerCase(),g=m.replace(/^.*\./,"").toLowerCase(),w=m.length<d.length;return(g.length<m.length-1||!w)&&this._types[g]||null},Mime$1.prototype.getExtension=function(d){return(d=/^\s*([^;\s]*)/.test(d)&&RegExp.$1)&&this._extensions[d.toLowerCase()]||null};var Mime_1=Mime$1,standard={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};let Mime=Mime_1;var lite=new Mime(standard),mime=getDefaultExportFromCjs(lite),HorizontalAlign,HorizontalAlign2,VerticalAlign,VerticalAlign2,BlendMode,BlendMode2;function srcOver(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a;return{r:(d.r*d.a+m.r*m.a*(1-d.a))/w,g:(d.g*d.a+m.g*m.a*(1-d.a))/w,b:(d.b*d.a+m.b*m.a*(1-d.a))/w,a:w}}function dstOver(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a;return{r:(m.r*m.a+d.r*d.a*(1-m.a))/w,g:(m.g*m.a+d.g*d.a*(1-m.a))/w,b:(m.b*m.a+d.b*d.a*(1-m.a))/w,a:w}}function multiply(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,q=m.b*m.a;return{r:($*F+$*(1-m.a)+F*(1-d.a))/w,g:(I*U+I*(1-m.a)+U*(1-d.a))/w,b:(D*q+D*(1-m.a)+q*(1-d.a))/w,a:w}}function add(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a;return{r:($+m.r*m.a)/w,g:(I+m.g*m.a)/w,b:(D+m.b*m.a)/w,a:w}}function screen(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,q=m.b*m.a;return{r:($*m.a+F*d.a-$*F+$*(1-m.a)+F*(1-d.a))/w,g:(I*m.a+U*d.a-I*U+I*(1-m.a)+U*(1-d.a))/w,b:(D*m.a+q*d.a-D*q+D*(1-m.a)+q*(1-d.a))/w,a:w}}function overlay(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,q=m.b*m.a;return{r:(2*F<=m.a?2*$*F+$*(1-m.a)+F*(1-d.a):$*(1+m.a)+F*(1+d.a)-2*F*$-m.a*d.a)/w,g:(2*U<=m.a?2*I*U+I*(1-m.a)+U*(1-d.a):I*(1+m.a)+U*(1+d.a)-2*U*I-m.a*d.a)/w,b:(2*q<=m.a?2*D*q+D*(1-m.a)+q*(1-d.a):D*(1+m.a)+q*(1+d.a)-2*q*D-m.a*d.a)/w,a:w}}function darken(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,q=m.b*m.a;return{r:(Math.min($*m.a,F*d.a)+$*(1-m.a)+F*(1-d.a))/w,g:(Math.min(I*m.a,U*d.a)+I*(1-m.a)+U*(1-d.a))/w,b:(Math.min(D*m.a,q*d.a)+D*(1-m.a)+q*(1-d.a))/w,a:w}}function lighten(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,q=m.b*m.a;return{r:(Math.max($*m.a,F*d.a)+$*(1-m.a)+F*(1-d.a))/w,g:(Math.max(I*m.a,U*d.a)+I*(1-m.a)+U*(1-d.a))/w,b:(Math.max(D*m.a,q*d.a)+D*(1-m.a)+q*(1-d.a))/w,a:w}}function hardLight(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,q=m.b*m.a;return{r:(2*$<=d.a?2*$*F+$*(1-m.a)+F*(1-d.a):$*(1+m.a)+F*(1+d.a)-2*F*$-m.a*d.a)/w,g:(2*I<=d.a?2*I*U+I*(1-m.a)+U*(1-d.a):I*(1+m.a)+U*(1+d.a)-2*U*I-m.a*d.a)/w,b:(2*D<=d.a?2*D*q+D*(1-m.a)+q*(1-d.a):D*(1+m.a)+q*(1+d.a)-2*q*D-m.a*d.a)/w,a:w}}function difference(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,q=m.b*m.a;return{r:($+F-2*Math.min($*m.a,F*d.a))/w,g:(I+U-2*Math.min(I*m.a,U*d.a))/w,b:(D+q-2*Math.min(D*m.a,q*d.a))/w,a:w}}function exclusion(d,m,g=1){d.a*=g;const w=m.a+d.a-m.a*d.a,$=d.r*d.a,I=d.g*d.a,D=d.b*d.a,F=m.r*m.a,U=m.g*m.a,q=m.b*m.a;return{r:($*m.a+F*d.a-2*$*F+$*(1-m.a)+F*(1-d.a))/w,g:(I*m.a+U*d.a-2*I*U+I*(1-m.a)+U*(1-d.a))/w,b:(D*m.a+q*d.a-2*D*q+D*(1-m.a)+q*(1-d.a))/w,a:w}}HorizontalAlign2=HorizontalAlign||(HorizontalAlign={}),HorizontalAlign2[HorizontalAlign2.LEFT=1]="LEFT",HorizontalAlign2[HorizontalAlign2.CENTER=2]="CENTER",HorizontalAlign2[HorizontalAlign2.RIGHT=4]="RIGHT",VerticalAlign2=VerticalAlign||(VerticalAlign={}),VerticalAlign2[VerticalAlign2.TOP=8]="TOP",VerticalAlign2[VerticalAlign2.MIDDLE=16]="MIDDLE",VerticalAlign2[VerticalAlign2.BOTTOM=32]="BOTTOM",BlendMode2=BlendMode||(BlendMode={}),BlendMode2.SRC_OVER="srcOver",BlendMode2.DST_OVER="dstOver",BlendMode2.MULTIPLY="multiply",BlendMode2.ADD="add",BlendMode2.SCREEN="screen",BlendMode2.OVERLAY="overlay",BlendMode2.DARKEN="darken",BlendMode2.LIGHTEN="lighten",BlendMode2.HARD_LIGHT="hardLight",BlendMode2.DIFFERENCE="difference",BlendMode2.EXCLUSION="exclusion";const names=[srcOver,dstOver,multiply,add,screen,overlay,darken,lighten,hardLight,difference,exclusion];var compositeModes=Object.freeze({__proto__:null,add,darken,difference,dstOver,exclusion,hardLight,lighten,multiply,names,overlay,screen,srcOver});function composite(d,m,g=0,w=0,$={}){if(!(m instanceof d.constructor))throw new Error("The source must be a Jimp image");if(typeof g!="number"||typeof w!="number")throw new Error("x and y must be numbers");const{mode:I=BlendMode.SRC_OVER}=$;let{opacitySource:D=1,opacityDest:F=1}=$;(typeof D!="number"||D<0||D>1)&&(D=1),(typeof F!="number"||F<0||F>1)&&(F=1);const U=compositeModes[I];return g=Math.round(g),w=Math.round(w),F!==1&&d.scan(((q,j,G)=>{const H=d.bitmap.data[G+3]*F;d.bitmap.data[G+3]=H})),m.scan(((q,j,G)=>{const H=d.getPixelIndex(g+q,w+j,Edge.CROP);if(H===-1)return;const V=U({r:m.bitmap.data[G+0]/255,g:m.bitmap.data[G+1]/255,b:m.bitmap.data[G+2]/255,a:m.bitmap.data[G+3]/255},{r:d.bitmap.data[H+0]/255,g:d.bitmap.data[H+1]/255,b:d.bitmap.data[H+2]/255,a:d.bitmap.data[H+3]/255},D);d.bitmap.data[H+0]=limit255(255*V.r),d.bitmap.data[H+1]=limit255(255*V.g),d.bitmap.data[H+2]=limit255(255*V.b),d.bitmap.data[H+3]=limit255(255*V.a)})),d}var jpeg$1={parseSections:function(d,m){var g,w;for(d.setBigEndian(!0);d.remainingLength()>0&&w!==218;){if(d.nextUInt8()!==255)throw new Error("Invalid JPEG section offset");g=(w=d.nextUInt8())>=208&&w<=217||w===218?0:d.nextUInt16()-2,m(w,d.branch(0,g)),d.skip(g)}},getSizeFromSOFSection:function(d){return d.skip(1),{height:d.nextUInt16(),width:d.nextUInt16()}},getSectionName:function(d){var m,g;switch(d){case 216:m="SOI";break;case 196:m="DHT";break;case 219:m="DQT";break;case 221:m="DRI";break;case 218:m="SOS";break;case 254:m="COM";break;case 217:m="EOI";break;default:d>=224&&d<=239?(m="APP",g=d-224):d>=192&&d<=207&&d!==196&&d!==200&&d!==204?(m="SOF",g=d-192):d>=208&&d<=215&&(m="RST",g=d-208)}var w={name:m};return typeof g=="number"&&(w.index=g),w}};function readExifValue(d,m){switch(d){case 1:return m.nextUInt8();case 3:case 8:return m.nextUInt16();case 4:case 9:return m.nextUInt32();case 5:return[m.nextUInt32(),m.nextUInt32()];case 6:return m.nextInt8();case 10:return[m.nextInt32(),m.nextInt32()];case 11:return m.nextFloat();case 12:return m.nextDouble();default:throw new Error("Invalid format while decoding: "+d)}}function getBytesPerComponent(d){switch(d){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function readExifTag(d,m){var g,w,$=m.nextUInt16(),I=m.nextUInt16(),D=getBytesPerComponent(I),F=m.nextUInt32(),U=D*F;if(U>4&&(m=d.openWithOffset(m.nextUInt32())),I===2){var q=(g=m.nextString(F)).indexOf("\0");q!==-1&&(g=g.substr(0,q))}else if(I===7)g=m.nextBuffer(F);else if(I!==0)for(g=[],w=0;w<F;++w)g.push(readExifValue(I,m));return U<4&&m.skip(4-U),[$,g,I]}function readIFDSection(d,m,g){var w,$,I=m.nextUInt16();for($=0;$<I;++$)g((w=readExifTag(d,m))[0],w[1],w[2])}function readHeader(d){if(d.nextString(6)!=="Exif\0\0")throw new Error("Invalid EXIF header");var m=d.mark(),g=d.nextUInt16();if(g===18761)d.setBigEndian(!1);else{if(g!==19789)throw new Error("Invalid TIFF header");d.setBigEndian(!0)}if(d.nextUInt16()!==42)throw new Error("Invalid TIFF data");return m}var exif$2={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(d,m){var g,w,$,I;try{g=readHeader(d)}catch{return!1}var D=g.openWithOffset(d.nextUInt32()),F=this.IFD0;readIFDSection(g,D,(function(Z,Q,J){switch(Z){case 34853:$=Q[0];break;case 34665:w=Q[0];break;default:m(F,Z,Q,J)}}));var U=D.nextUInt32();if(U!==0){var q=g.openWithOffset(U);readIFDSection(g,q,m.bind(null,this.IFD1))}if($){var j=g.openWithOffset($);readIFDSection(g,j,m.bind(null,this.GPSIFD))}if(w){var G=g.openWithOffset(w),H=this.InteropIFD;readIFDSection(g,G,(function(Z,Q,J){Z===40965?I=Q[0]:m(H,Z,Q,J)}))}if(I){var V=g.openWithOffset(I);readIFDSection(g,V,m.bind(null,this.InteropIFD))}return!0}};function parseNumber(d){return parseInt(d,10)}var hours=3600,minutes=60;function parseDateTimeParts(d,m){d=d.map(parseNumber),m=m.map(parseNumber);var g=d[0],w=d[1]-1,$=d[2],I=m[0],D=m[1],F=m[2];return Date.UTC(g,w,$,I,D,F,0)/1e3}function parseDateWithTimezoneFormat(d){var m=d.substr(0,10).split("-"),g=d.substr(11,8).split(":"),w=d.substr(19,6).split(":").map(parseNumber),$=w[0]*hours+w[1]*minutes,I=parseDateTimeParts(m,g);if(typeof(I-=$)=="number"&&!isNaN(I))return I}function parseDateWithSpecFormat(d){var m=d.split(" "),g=parseDateTimeParts(m[0].split(":"),m[1].split(":"));if(typeof g=="number"&&!isNaN(g))return g}function parseExifDate(d){var m=d.length===19&&d.charAt(4)===":";return d.length===25&&d.charAt(10)==="T"?parseDateWithTimezoneFormat(d):m?parseDateWithSpecFormat(d):void 0}var date$1={parseDateWithSpecFormat,parseDateWithTimezoneFormat,parseExifDate},exif$1=exif$2,date=date$1,degreeTags=[{section:exif$1.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:exif$1.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],dateTags=[{section:exif$1.SubIFD,type:306,name:"ModifyDate"},{section:exif$1.SubIFD,type:36867,name:"DateTimeOriginal"},{section:exif$1.SubIFD,type:36868,name:"CreateDate"},{section:exif$1.SubIFD,type:306,name:"ModifyDate"}],simplify$1={castDegreeValues:function(d,m){degreeTags.forEach((function(g){var w=d(g);if(w){var $=d({section:g.section,type:g.refType,name:g.refName})===g.posVal?1:-1,I=(w[0]+w[1]/60+w[2]/3600)*$;m(g,I)}}))},castDateValues:function(d,m){dateTags.forEach((function(g){var w=d(g);if(w){var $=date.parseExifDate(w);$!==void 0&&m(g,$)}}))},simplifyValue:function(d,m){return Array.isArray(d)&&(d=d.map((function(g){return m===10||m===5?g[0]/g[1]:g}))).length===1&&(d=d[0]),d}},exifTags,hasRequiredExifTags;function requireExifTags(){return hasRequiredExifTags?exifTags:(hasRequiredExifTags=1,exifTags={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}})}var jpeg=jpeg$1,exif=exif$2,simplify=simplify$1;function ExifResult(d,m,g,w,$,I,D){this.startMarker=d,this.tags=m,this.imageSize=g,this.thumbnailOffset=w,this.thumbnailLength=$,this.thumbnailType=I,this.app1Offset=D}function Parser$1(d){this.stream=d,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}ExifResult.prototype={hasThumbnail:function(d){return!(!this.thumbnailOffset||!this.thumbnailLength)&&(typeof d!="string"||(d.toLowerCase().trim()==="image/jpeg"?this.thumbnailType===6:d.toLowerCase().trim()==="image/tiff"&&this.thumbnailType===1))},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var d,m=this._getThumbnailStream();return jpeg.parseSections(m,(function(g,w){jpeg.getSectionName(g).name==="SOF"&&(d=jpeg.getSizeFromSOFSection(w))})),d}},Parser$1.prototype={enableBinaryFields:function(d){return this.flags.readBinaryTags=!!d,this},enablePointers:function(d){return this.flags.hidePointers=!d,this},enableTagNames:function(d){return this.flags.resolveTagNames=!!d,this},enableImageSize:function(d){return this.flags.imageSize=!!d,this},enableReturnTags:function(d){return this.flags.returnTags=!!d,this},enableSimpleValues:function(d){return this.flags.simplifyValues=!!d,this},parse:function(){var d,m,g,w,$,I,D,F,U,q=this.stream.mark(),j=q.openWithOffset(0),G=this.flags;return G.resolveTagNames&&(D=requireExifTags()),G.resolveTagNames?(d={},F=function(H){return d[H.name]},U=function(H,V){d[H.name]=V}):(d=[],F=function(H){var V;for(V=0;V<d.length;++V)if(d[V].type===H.type&&d[V].section===H.section)return d.value},U=function(H,V){var Z;for(Z=0;Z<d.length;++Z)if(d[Z].type===H.type&&d[Z].section===H.section)return void(d.value=V)}),jpeg.parseSections(j,(function(H,V){var Z=V.offsetFrom(q);H===225?exif.parseTags(V,(function(Q,J,ie,re){if(G.readBinaryTags||re!==7){if(J===513){if(g=ie[0],G.hidePointers)return}else if(J===514){if(w=ie[0],G.hidePointers)return}else if(J===259&&($=ie[0],G.hidePointers))return;if(G.returnTags)if(G.simplifyValues&&(ie=simplify.simplifyValue(ie,re)),G.resolveTagNames){var se=(Q===exif.GPSIFD?D.gps:D.exif)[J];se||(se=D.exif[J]),d.hasOwnProperty(se)||(d[se]=ie)}else d.push({section:Q,type:J,value:ie})}}))&&(I=Z):G.imageSize&&jpeg.getSectionName(H).name==="SOF"&&(m=jpeg.getSizeFromSOFSection(V))})),G.simplifyValues&&(simplify.castDegreeValues(F,U),simplify.castDateValues(F,U)),new ExifResult(q,d,m,g,w,$,I)}};var parser=Parser$1,domBufferstream,hasRequiredDomBufferstream,bufferstream,hasRequiredBufferstream;function requireDomBufferstream(){if(hasRequiredDomBufferstream)return domBufferstream;function d(m,g,w,$,I,D){this.global=I,g=g||0,w=w||m.byteLength-g,this.arrayBuffer=m.slice(g,g+w),this.view=new I.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian($),this.offset=0,this.parentOffset=(D||0)+g}return hasRequiredDomBufferstream=1,d.prototype={setBigEndian:function(m){this.littleEndian=!m},nextUInt8:function(){var m=this.view.getUint8(this.offset);return this.offset+=1,m},nextInt8:function(){var m=this.view.getInt8(this.offset);return this.offset+=1,m},nextUInt16:function(){var m=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,m},nextUInt32:function(){var m=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,m},nextInt16:function(){var m=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,m},nextInt32:function(){var m=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,m},nextFloat:function(){var m=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,m},nextDouble:function(){var m=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,m},nextBuffer:function(m){var g=this.arrayBuffer.slice(this.offset,this.offset+m);return this.offset+=m,g},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(m){var g=this.arrayBuffer.slice(this.offset,this.offset+m);return g=String.fromCharCode.apply(null,new this.global.Uint8Array(g)),this.offset+=m,g},mark:function(){var m=this;return{openWithOffset:function(g){return g=(g||0)+this.offset,new d(m.arrayBuffer,g,m.arrayBuffer.byteLength-g,!m.littleEndian,m.global,m.parentOffset)},offset:this.offset,getParentOffset:function(){return m.parentOffset}}},offsetFrom:function(m){return this.parentOffset+this.offset-(m.offset+m.getParentOffset())},skip:function(m){this.offset+=m},branch:function(m,g){return g=typeof g=="number"?g:this.arrayBuffer.byteLength-(this.offset+m),new d(this.arrayBuffer,this.offset+m,g,!this.littleEndian,this.global,this.parentOffset)}},domBufferstream=d}function requireBufferstream(){if(hasRequiredBufferstream)return bufferstream;function d(m,g,w,$){this.buffer=m,this.offset=g||0,w=typeof w=="number"?w:m.length,this.endPosition=this.offset+w,this.setBigEndian($)}return hasRequiredBufferstream=1,d.prototype={setBigEndian:function(m){this.bigEndian=!!m},nextUInt8:function(){var m=this.buffer.readUInt8(this.offset);return this.offset+=1,m},nextInt8:function(){var m=this.buffer.readInt8(this.offset);return this.offset+=1,m},nextUInt16:function(){var m=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,m},nextUInt32:function(){var m=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,m},nextInt16:function(){var m=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,m},nextInt32:function(){var m=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,m},nextFloat:function(){var m=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,m},nextDouble:function(){var m=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,m},nextBuffer:function(m){var g=this.buffer.slice(this.offset,this.offset+m);return this.offset+=m,g},remainingLength:function(){return this.endPosition-this.offset},nextString:function(m){var g=this.buffer.toString("utf8",this.offset,this.offset+m);return this.offset+=m,g},mark:function(){var m=this;return{openWithOffset:function(g){return g=(g||0)+this.offset,new d(m.buffer,g,m.endPosition-g,m.bigEndian)},offset:this.offset}},offsetFrom:function(m){return this.offset-m.offset},skip:function(m){this.offset+=m},branch:function(m,g){return g=typeof g=="number"?g:this.endPosition-(this.offset+m),new d(this.buffer,this.offset+m,g,this.bigEndian)}},bufferstream=d}var Parser=parser;function getGlobal(){return(0,eval)("this")}var exifParser={create:function(d,m){if(d instanceof(m=m||getGlobal()).ArrayBuffer){var g=requireDomBufferstream();return new Parser(new g(d,0,d.byteLength,!0,m))}var w=requireBufferstream();return new Parser(new w(d,0,d.length,!0))}},EXIFParser=getDefaultExportFromCjs(exifParser);function getExifOrientation(d){const m=d._exif;return m&&m.tags&&m.tags.Orientation||1}function getExifOrientationTransformation(d){const m=d.bitmap.width,g=d.bitmap.height;switch(getExifOrientation(d)){case 1:default:return null;case 2:return function(w,$){return[m-w-1,$]};case 3:return function(w,$){return[m-w-1,g-$-1]};case 4:return function(w,$){return[w,g-$-1]};case 5:return function(w,$){return[$,w]};case 6:return function(w,$){return[$,g-w-1]};case 7:return function(w,$){return[m-$-1,g-w-1]};case 8:return function(w,$){return[m-$-1,w]}}}function transformBitmap(d,m,g,w){const $=d.bitmap.data,I=d.bitmap.width,D=Buffer.alloc($.length);for(let F=0;F<m;F++)for(let U=0;U<g;U++){const[q,j]=w(F,U),G=m*U+F<<2,H=I*j+q<<2,V=$.readUInt32BE(H);D.writeUInt32BE(V,G)}d.bitmap.data=D,d.bitmap.width=m,d.bitmap.height=g,d._exif.tags.Orientation=1}function exifRotate(d){if(getExifOrientation(d)<2)return;const m=getExifOrientationTransformation(d),g=getExifOrientation(d)>4,w=g?d.bitmap.height:d.bitmap.width,$=g?d.bitmap.width:d.bitmap.height;m&&transformBitmap(d,w,$,m)}async function attemptExifRotate(d,m){try{d._exif=EXIFParser.create(m).parse(),exifRotate(d)}catch{}}var __defProp$2=Object.defineProperty,__defNormalProp$2=(d,m,g)=>m in d?__defProp$2(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__publicField$2=(d,m,g)=>__defNormalProp$2(d,typeof m!="symbol"?m+"":m,g);const emptyBitmap={data:Buffer.alloc(0),width:0,height:0};function bufferFromArrayBuffer(d){const m=Buffer.alloc(d.byteLength),g=new Uint8Array(d);for(let w=0;w<m.length;++w)m[w]=g[w];return m}function createJimp({plugins:d,formats:m}={}){const g=d||[],w=(m||[]).map((I=>I())),$=class{constructor(I=emptyBitmap){if(__publicField$2(this,"bitmap",emptyBitmap),__publicField$2(this,"background",0),__publicField$2(this,"formats",[]),__publicField$2(this,"mime"),this.formats=w,"data"in I)this.bitmap=I;else if(this.bitmap={data:Buffer.alloc(I.width*I.height*4),width:I.width,height:I.height},I.color){this.background=typeof I.color=="string"?cssColorToHex(I.color):I.color;for(let D=0;D<this.bitmap.data.length;D+=4)this.bitmap.data.writeUInt32BE(this.background,D)}for(const D of g)for(const F in D)this[F]=(...U)=>{const q=D[F]?.(this,...U);return typeof q=="object"&&"bitmap"in q?(this.bitmap=q.bitmap,this):q}}static async read(I,D){if(Buffer.isBuffer(I)||I instanceof ArrayBuffer)return this.fromBuffer(I);const[F,U]=await to(fetch(I));if(F)throw new Error(`Could not load Buffer from URL: ${I}`);if(!U.ok)throw new Error(`HTTP Status ${U.status} for url ${I}`);const[q,j]=await to(U.arrayBuffer());if(q)throw new Error(`Could not load Buffer from ${I}`);const G=bufferFromArrayBuffer(j);return this.fromBuffer(G,D)}static fromBitmap(I){let D;if(I.data instanceof Buffer&&(D=Buffer.from(I.data)),(I.data instanceof Uint8Array||I.data instanceof Uint8ClampedArray)&&(D=Buffer.from(I.data.buffer)),Array.isArray(I.data)&&(D=Buffer.concat(I.data.map((F=>Buffer.from(F.toString(16).padStart(8,"0"),"hex"))))),!D)throw new Error("data must be a Buffer");if(typeof I.height!="number"||typeof I.width!="number")throw new Error("bitmap must have width and height");return new $({height:I.height,width:I.width,data:D})}static async fromBuffer(I,D){const F=I instanceof ArrayBuffer?bufferFromArrayBuffer(I):I,U=await fileType$1.fromBuffer(F);if(!U||!U.mime)throw new Error("Could not find MIME for Buffer");const q=w.find((G=>G.mime===U.mime));if(!q||!q.decode)throw new Error(`Mime type ${U.mime} does not support decoding`);const j=new $(await q.decode(F,D?.[q.mime]));return j.mime=U.mime,attemptExifRotate(j,F),j}inspect(){return"<Jimp "+(this.bitmap===emptyBitmap?"pending...":this.bitmap.width+"x"+this.bitmap.height)+">"}toString(){return"[object Jimp]"}get width(){return this.bitmap.width}get height(){return this.bitmap.height}async getBuffer(I,D){const F=this.formats.find((q=>q.mime===I));if(!F||!F.encode)throw new Error(`Unsupported MIME type: ${I}`);let U;return F.hasAlpha?U=this:(U=new $({width:this.bitmap.width,height:this.bitmap.height,color:this.background}),composite(U,this)),F.encode(U.bitmap,D)}async getBase64(I,D){return"data:"+I+";base64,"+(await this.getBuffer(I,D)).toString("base64")}async write(I,D){const F=mime.getType(I);await writeFile(I,await this.getBuffer(F,D))}clone(){return new $({...this.bitmap,data:Buffer.from(this.bitmap.data)})}getPixelIndex(I,D,F){let U,q;if(F||(F=Edge.EXTEND),typeof I!="number"||typeof D!="number")throw new Error("x and y must be numbers");U=I=Math.round(I),q=D=Math.round(D),F===Edge.EXTEND&&(I<0&&(U=0),I>=this.bitmap.width&&(U=this.bitmap.width-1),D<0&&(q=0),D>=this.bitmap.height&&(q=this.bitmap.height-1)),F===Edge.WRAP&&(I<0&&(U=this.bitmap.width+I),I>=this.bitmap.width&&(U=I%this.bitmap.width),D<0&&(q=this.bitmap.height+D),D>=this.bitmap.height&&(q=D%this.bitmap.height));let j=this.bitmap.width*q+U<<2;return(U<0||U>=this.bitmap.width)&&(j=-1),(q<0||q>=this.bitmap.height)&&(j=-1),j}getPixelColor(I,D){if(typeof I!="number"||typeof D!="number")throw new Error("x and y must be numbers");const F=this.getPixelIndex(I,D);return this.bitmap.data.readUInt32BE(F)}setPixelColor(I,D,F){if(typeof I!="number"||typeof D!="number"||typeof F!="number")throw new Error("hex, x and y must be numbers");const U=this.getPixelIndex(D,F);return this.bitmap.data.writeUInt32BE(I,U),this}hasAlpha(){const{width:I,height:D,data:F}=this.bitmap,U=I*D<<2;for(let q=3;q<U;q+=4)if(F[q]!==255)return!0;return!1}composite(I,D=0,F=0,U={}){return composite(this,I,D,F,U)}scan(I,D,F,U,q){return scan(this,I,D,F,U,q)}scanIterator(I=0,D=0,F=this.bitmap.width,U=this.bitmap.height){if(typeof I!="number"||typeof D!="number")throw new Error("x and y must be numbers");if(typeof F!="number"||typeof U!="number")throw new Error("w and h must be numbers");return scanIterator(this,I,D,F,U)}};return $}var ResizeStrategy,ResizeStrategy2;function Resize(d,m,g,w,$,I,D){this.widthOriginal=Math.abs(Math.floor(d)||0),this.heightOriginal=Math.abs(Math.floor(m)||0),this.targetWidth=Math.abs(Math.floor(g)||0),this.targetHeight=Math.abs(Math.floor(w)||0),this.colorChannels=$?4:3,this.interpolationPass=!!I,this.resizeCallback=typeof D=="function"?D:function(){},this.targetWidthMultipliedByChannels=this.targetWidth*this.colorChannels,this.originalWidthMultipliedByChannels=this.widthOriginal*this.colorChannels,this.originalHeightMultipliedByChannels=this.heightOriginal*this.colorChannels,this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal,this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight,this.initialize()}ResizeStrategy2=ResizeStrategy||(ResizeStrategy={}),ResizeStrategy2.NEAREST_NEIGHBOR="nearestNeighbor",ResizeStrategy2.BILINEAR="bilinearInterpolation",ResizeStrategy2.BICUBIC="bicubicInterpolation",ResizeStrategy2.HERMITE="hermiteInterpolation",ResizeStrategy2.BEZIER="bezierInterpolation",Resize.prototype.initialize=function(){if(!(this.widthOriginal>0&&this.heightOriginal>0&&this.targetWidth>0&&this.targetHeight>0))throw console.log(this),new Error("Invalid settings specified for the resizer.");this.configurePasses()},Resize.prototype.configurePasses=function(){this.widthOriginal===this.targetWidth?this.resizeWidth=this.bypassResizer:(this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth,this.ratioWeightWidthPass<1&&this.interpolationPass?(this.initializeFirstPassBuffers(!0),this.resizeWidth=this.colorChannels===4?this.resizeWidthInterpolatedRGBA:this.resizeWidthInterpolatedRGB):(this.initializeFirstPassBuffers(!1),this.resizeWidth=this.colorChannels===4?this.resizeWidthRGBA:this.resizeWidthRGB)),this.heightOriginal===this.targetHeight?this.resizeHeight=this.bypassResizer:(this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight,this.ratioWeightHeightPass<1&&this.interpolationPass?(this.initializeSecondPassBuffers(!0),this.resizeHeight=this.resizeHeightInterpolated):(this.initializeSecondPassBuffers(!1),this.resizeHeight=this.colorChannels===4?this.resizeHeightRGBA:this.resizeHeightRGB))},Resize.prototype._resizeWidthInterpolatedRGBChannels=function(d,m){const g=m?4:3,w=this.ratioWeightWidthPass,$=this.widthBuffer;let I,D,F=0,U=0,q=0,j=0,G=0;for(I=0;F<1/3;I+=g,F+=w)for(U=I,q=0;U<this.widthPassResultSize;q+=this.originalWidthMultipliedByChannels,U+=this.targetWidthMultipliedByChannels)$[U]=d[q],$[U+1]=d[q+1],$[U+2]=d[q+2],m&&($[U+3]=d[q+3]);for(F-=1/3,D=this.widthOriginal-1;F<D;I+=g,F+=w)for(G=F%1,j=1-G,U=I,q=Math.floor(F)*g;U<this.widthPassResultSize;q+=this.originalWidthMultipliedByChannels,U+=this.targetWidthMultipliedByChannels)$[U+0]=d[q+0]*j+d[q+g+0]*G,$[U+1]=d[q+1]*j+d[q+g+1]*G,$[U+2]=d[q+2]*j+d[q+g+2]*G,m&&($[U+3]=d[q+3]*j+d[q+g+3]*G);for(D=this.originalWidthMultipliedByChannels-g;I<this.targetWidthMultipliedByChannels;I+=g)for(U=I,q=D;U<this.widthPassResultSize;q+=this.originalWidthMultipliedByChannels,U+=this.targetWidthMultipliedByChannels)$[U]=d[q],$[U+1]=d[q+1],$[U+2]=d[q+2],m&&($[U+3]=d[q+3]);return $},Resize.prototype._resizeWidthRGBChannels=function(d,m){const g=m?4:3,w=this.ratioWeightWidthPass,$=1/w,I=this.originalWidthMultipliedByChannels-g+1,D=this.targetWidthMultipliedByChannels-g+1,F=this.outputWidthWorkBench,U=this.widthBuffer,q=this.outputWidthWorkBenchOpaquePixelsCount;let j=0,G=0,H=0,V=0,Z=0,Q=0,J=0,ie=1,re=0,se=0,X=0,ne=0;do{for(Z=0;Z<this.originalHeightMultipliedByChannels;)F[Z++]=0,F[Z++]=0,F[Z++]=0,m&&(F[Z++]=0,q[Z/g-1]=0);j=w;do{for(G=1+H-V,ie=Math.min(j,G),Z=0,Q=H;Z<this.originalHeightMultipliedByChannels;Q+=I)re=d[Q],se=d[++Q],X=d[++Q],ne=m?d[++Q]:255,F[Z++]+=(ne?re:0)*ie,F[Z++]+=(ne?se:0)*ie,F[Z++]+=(ne?X:0)*ie,m&&(F[Z++]+=ne*ie,q[Z/g-1]+=ne?ie:0);if(!(j>=G)){V+=j;break}H+=g,V=H,j-=G}while(j>0&&H<this.originalWidthMultipliedByChannels);for(Z=0,Q=J;Z<this.originalHeightMultipliedByChannels;Q+=D)j=m?q[Z/g]:1,ie=m?j?1/j:0:$,U[Q]=F[Z++]*ie,U[++Q]=F[Z++]*ie,U[++Q]=F[Z++]*ie,m&&(U[++Q]=F[Z++]*$);J+=g}while(J<this.targetWidthMultipliedByChannels);return U},Resize.prototype._resizeHeightRGBChannels=function(d,m){const g=this.ratioWeightHeightPass,w=1/g,$=this.outputHeightWorkBench,I=this.heightBuffer,D=this.outputHeightWorkBenchOpaquePixelsCount;let F=0,U=0,q=0,j=0,G=0,H=0,V=0,Z=1,Q=0,J=0,ie=0,re=0;do{for(G=0;G<this.targetWidthMultipliedByChannels;)$[G++]=0,$[G++]=0,$[G++]=0,m&&($[G++]=0,D[G/4-1]=0);F=g;do{for(U=1+q-j,Z=Math.min(F,U),V=q,G=0;G<this.targetWidthMultipliedByChannels;)Q=d[V++],J=d[V++],ie=d[V++],re=m?d[V++]:255,$[G++]+=(re?Q:0)*Z,$[G++]+=(re?J:0)*Z,$[G++]+=(re?ie:0)*Z,m&&($[G++]+=re*Z,D[G/4-1]+=re?Z:0);if(!(F>=U)){j+=F;break}q=V,j=q,F-=U}while(F>0&&q<this.widthPassResultSize);for(G=0;G<this.targetWidthMultipliedByChannels;)F=m?D[G/4]:1,Z=m?F?1/F:0:w,I[H++]=Math.round($[G++]*Z),I[H++]=Math.round($[G++]*Z),I[H++]=Math.round($[G++]*Z),m&&(I[H++]=Math.round($[G++]*w))}while(H<this.finalResultSize);return I},Resize.prototype.resizeWidthInterpolatedRGB=function(d){return this._resizeWidthInterpolatedRGBChannels(d,!1)},Resize.prototype.resizeWidthInterpolatedRGBA=function(d){return this._resizeWidthInterpolatedRGBChannels(d,!0)},Resize.prototype.resizeWidthRGB=function(d){return this._resizeWidthRGBChannels(d,!1)},Resize.prototype.resizeWidthRGBA=function(d){return this._resizeWidthRGBChannels(d,!0)},Resize.prototype.resizeHeightInterpolated=function(d){const m=this.ratioWeightHeightPass,g=this.heightBuffer;let w,$=0,I=0,D=0,F=0,U=0,q=0,j=0;for(;$<1/3;$+=m)for(D=0;D<this.targetWidthMultipliedByChannels;)g[I++]=Math.round(d[D++]);for($-=1/3,w=this.heightOriginal-1;$<w;$+=m)for(j=$%1,q=1-j,F=Math.floor($)*this.targetWidthMultipliedByChannels,U=F+this.targetWidthMultipliedByChannels,D=0;D<this.targetWidthMultipliedByChannels;++D)g[I++]=Math.round(d[F++]*q+d[U++]*j);for(;I<this.finalResultSize;)for(D=0,F=w*this.targetWidthMultipliedByChannels;D<this.targetWidthMultipliedByChannels;++D)g[I++]=Math.round(d[F++]);return g},Resize.prototype.resizeHeightRGB=function(d){return this._resizeHeightRGBChannels(d,!1)},Resize.prototype.resizeHeightRGBA=function(d){return this._resizeHeightRGBChannels(d,!0)},Resize.prototype.resize=function(d){this.resizeCallback(this.resizeHeight(this.resizeWidth(d)))},Resize.prototype.bypassResizer=function(d){return d},Resize.prototype.initializeFirstPassBuffers=function(d){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize),d||(this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels),this.colorChannels>3&&(this.outputWidthWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.heightOriginal)))},Resize.prototype.initializeSecondPassBuffers=function(d){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize),d||(this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels),this.colorChannels>3&&(this.outputHeightWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.targetWidth)))},Resize.prototype.generateFloatBuffer=function(d){try{return new Float32Array(d)}catch(m){return console.error(m),[]}},Resize.prototype.generateFloat64Buffer=function(d){try{return new Float64Array(d)}catch(m){return console.error(m),[]}},Resize.prototype.generateUint8Buffer=function(d){try{return new Uint8Array(d)}catch(m){return console.error(m),[]}};const operations={nearestNeighbor(d,m){const g=d.width,w=d.height,$=m.width,I=m.height,D=d.data,F=m.data;for(let U=0;U<I;U++)for(let q=0;q<$;q++){let j=4*(U*$+q),G=4*(Math.floor(U*w/I)*g+Math.floor(q*g/$));F[j++]=D[G++],F[j++]=D[G++],F[j++]=D[G++],F[j++]=D[G++]}},bilinearInterpolation(d,m){const g=d.width,w=d.height,$=m.width,I=m.height,D=d.data,F=m.data,U=function(j,G,H,V,Z){return G===V?H:Math.round((j-G)*Z+(V-j)*H)},q=function(j,G,H,V,Z,Q,J,ie){let re=4*(J*g+V)+G,se=4*(J*g+Z)+G;const X=U(H,V,D[re],Z,D[se]);if(ie===J)F[j+G]=X;else{re=4*(ie*g+V)+G,se=4*(ie*g+Z)+G;const ne=U(H,V,D[re],Z,D[se]);F[j+G]=U(Q,J,X,ie,ne)}};for(let j=0;j<I;j++)for(let G=0;G<$;G++){const H=4*(j*$+G),V=G*g/$,Z=Math.floor(V),Q=Math.min(Math.ceil(V),g-1),J=j*w/I,ie=Math.floor(J),re=Math.min(Math.ceil(J),w-1);q(H,0,V,Z,Q,J,ie,re),q(H,1,V,Z,Q,J,ie,re),q(H,2,V,Z,Q,J,ie,re),q(H,3,V,Z,Q,J,ie,re)}},_interpolate2D(d,m,g,w){const $=d.data,I=m.data,D=d.width,F=d.height,U=m.width,q=m.height,j=Math.max(1,Math.floor(D/U)),G=U*j,H=Math.max(1,Math.floor(F/q)),V=q*H,Z=Buffer.alloc(G*F*4);for(let ie=0;ie<F;ie++)for(let re=0;re<G;re++){const se=re*(D-1)/G,X=Math.floor(se),ne=se-X,ce=4*(ie*D+X),oe=4*(ie*G+re);for(let de=0;de<4;de++){const me=ce+de,ge=X>0?$[me-4]:2*$[me]-$[me+4],fe=$[me],xe=$[me+4],Fe=X<D-2?$[me+8]:2*$[me+4]-$[me];Z[oe+de]=w(ge,fe,xe,Fe,ne)}}const Q=Buffer.alloc(G*V*4);for(let ie=0;ie<V;ie++)for(let re=0;re<G;re++){const se=ie*(F-1)/V,X=Math.floor(se),ne=se-X,ce=4*(X*G+re),oe=4*(ie*G+re);for(let de=0;de<4;de++){const me=ce+de,ge=X>0?Z[me-4*G]:2*Z[me]-Z[me+4*G],fe=Z[me],xe=Z[me+4*G],Fe=X<F-2?Z[me+8*G]:2*Z[me+4*G]-Z[me];Q[oe+de]=w(ge,fe,xe,Fe,ne)}}const J=j*H;if(J>1)for(let ie=0;ie<q;ie++)for(let re=0;re<U;re++){let se=0,X=0,ne=0,ce=0,oe=0;for(let me=0;me<H;me++){const ge=ie*H+me;for(let fe=0;fe<j;fe++){const xe=4*(ge*G+(re*j+fe)),Fe=Q[xe+3];Fe&&(se+=Q[xe],X+=Q[xe+1],ne+=Q[xe+2],oe++),ce+=Fe}}const de=4*(ie*U+re);I[de]=oe?Math.round(se/oe):0,I[de+1]=oe?Math.round(X/oe):0,I[de+2]=oe?Math.round(ne/oe):0,I[de+3]=Math.round(ce/J)}else m.data=Q},bicubicInterpolation(d,m,g){return this._interpolate2D(d,m,g,(function(w,$,I,D,F){const U=D-I-w+$,q=w-$-U,j=I-w,G=$;return Math.max(0,Math.min(255,U*(F*F*F)+q*(F*F)+j*F+G))}))},hermiteInterpolation(d,m,g){return this._interpolate2D(d,m,g,(function(w,$,I,D,F){const U=$,q=.5*(I-w),j=w-2.5*$+2*I-.5*D,G=.5*(D-w)+1.5*($-I);return Math.max(0,Math.min(255,Math.round(((G*F+j)*F+q)*F+U)))}))},bezierInterpolation(d,m,g){return this._interpolate2D(d,m,g,(function(w,$,I,D,F){const U=1-F,q=$*U*U*U,j=3*($+(I-w)/4)*U*U*F,G=3*(I-(D-$)/4)*U*F*F,H=I*F*F*F;return Math.max(0,Math.min(255,Math.round(q+j+G+H)))}))}},ResizeOptionsSchema=z.union([z.object({w:z.number().min(0),h:z.number().min(0).optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),z.object({w:z.number().min(0).optional(),h:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()})]),ScaleToFitOptionsSchema=z.object({w:z.number().min(0),h:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()}),ScaleComplexOptionsSchema=z.object({f:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$d={resize(d,m){const{mode:g}=ResizeOptionsSchema.parse(m);let w,$;if(typeof m.w=="number")w=m.w,$=m.h??d.bitmap.height*(w/d.bitmap.width);else{if(typeof m.h!="number")throw new Error("w must be a number");$=m.h,w=m.w??d.bitmap.width*($/d.bitmap.height)}if(w=Math.round(w)||1,$=Math.round($)||1,g&&typeof operations[g]=="function"){const I={data:Buffer.alloc(w*$*4),width:w,height:$};operations[g](d.bitmap,I),d.bitmap=I}else new Resize(d.bitmap.width,d.bitmap.height,w,$,!0,!0,(I=>{d.bitmap.data=Buffer.from(I),d.bitmap.width=w,d.bitmap.height=$})).resize(d.bitmap.data);return d},scale(d,m){const{f:g,mode:w}=typeof m=="number"?{f:m}:ScaleComplexOptionsSchema.parse(m),$=d.bitmap.width*g,I=d.bitmap.height*g;return this.resize(d,{w:$,h:I,mode:w})},scaleToFit(d,m){const{h:g,w,mode:$}=ScaleToFitOptionsSchema.parse(m),I=w/g>d.bitmap.width/d.bitmap.height?g/d.bitmap.height:w/d.bitmap.width;return this.scale(d,{f:I,mode:$})}},ContainOptionsSchema=z.object({w:z.number(),h:z.number(),align:z.number().optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$c={contain(d,m){const{w:g,h:w,align:$=HorizontalAlign.CENTER|VerticalAlign.MIDDLE,mode:I}=ContainOptionsSchema.parse(m),D=7&$,F=$>>3;if((D===0||D&D-1)&&(F===0||F&F-1))throw new Error("only use one flag per alignment direction");const U=D>>1,q=F>>1,j=g/w>d.bitmap.width/d.bitmap.height?w/d.bitmap.height:g/d.bitmap.width,G=methods$d.scale(clone(d),{f:j,mode:I});return(d=methods$d.resize(d,{w:g,h:w,mode:I})).scan(((H,V,Z)=>{d.bitmap.data.writeUInt32BE(d.background,Z)})),d=methods$h.blit(d,{src:G,x:(d.bitmap.width-G.bitmap.width)/2*U,y:(d.bitmap.height-G.bitmap.height)/2*q})}},CropOptionsSchema=z.object({x:z.number(),y:z.number(),w:z.number(),h:z.number()}),AutocropComplexOptionsSchema=z.object({tolerance:z.number().min(0).max(1).optional(),cropOnlyFrames:z.boolean().optional(),cropSymmetric:z.boolean().optional(),leaveBorder:z.number().optional(),ignoreSides:z.object({north:z.boolean().optional(),south:z.boolean().optional(),east:z.boolean().optional(),west:z.boolean().optional()}).optional()}),methods$b={crop(d,m){let{x:g,y:w,w:$,h:I}=CropOptionsSchema.parse(m);if(g=Math.round(g),w=Math.round(w),$=Math.round($),I=Math.round(I),g===0&&$===d.bitmap.width){const D=$*w+g<<2,F=D+(I*$<<2);d.bitmap.data=d.bitmap.data.slice(D,F)}else{const D=Buffer.allocUnsafe($*I*4);let F=0;scan(d,g,w,$,I,(function(U,q,j){const G=d.bitmap.data.readUInt32BE(j);D.writeUInt32BE(G,F),F+=4})),d.bitmap.data=D}return d.bitmap.width=$,d.bitmap.height=I,d},autocrop(d,m={}){const{tolerance:g=2e-4,cropOnlyFrames:w=!0,cropSymmetric:$=!1,leaveBorder:I=0,ignoreSides:D}=typeof m=="number"?{tolerance:m}:AutocropComplexOptionsSchema.parse(m),F=d.bitmap.width,U=d.bitmap.height,q={north:!1,south:!1,east:!1,west:!1,...D};let j=d.getPixelColor(0,0);const G=intToRGBA$1(j);let H=0,V=0,Z=0,Q=0;if(j=d.getPixelColor(0,0),!q.north)e:for(let se=0;se<U-1;se++){for(let X=0;X<F;X++)if(colorDiff(G,intToRGBA$1(d.getPixelColor(X,se)))>g)break e;H++}if(j=d.getPixelColor(F,0),!q.west)e:for(let se=0;se<F-1;se++){for(let X=0+H;X<U;X++)if(colorDiff(G,intToRGBA$1(d.getPixelColor(se,X)))>g)break e;Q++}if(j=d.getPixelColor(0,U),!q.south)e:for(let se=U-1;se>=H+1;se--){for(let X=F-V-1;X>=0;X--)if(colorDiff(G,intToRGBA$1(d.getPixelColor(X,se)))>g)break e;Z++}if(j=d.getPixelColor(F,U),!q.east)e:for(let se=F-1;se>=0+Q+1;se--){for(let X=U-1;X>=0+H;X--)if(colorDiff(G,intToRGBA$1(d.getPixelColor(se,X)))>g)break e;V++}let J=!1;if(Q-=I,V-=I,H-=I,Z-=I,$){const se=Math.min(V,Q),X=Math.min(H,Z);Q=se,V=se,H=X,Z=X}Q=Q>=0?Q:0,V=V>=0?V:0,H=H>=0?H:0,Z=Z>=0?Z:0;const ie=F-(Q+V),re=U-(Z+H);return J=w?V!==0&&H!==0&&Q!==0&&Z!==0:V!==0||H!==0||Q!==0||Z!==0,J&&this.crop(d,{x:Q,y:H,w:ie,h:re}),d}},CoverOptionsSchema=z.object({w:z.number(),h:z.number(),align:z.number().optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$a={cover(d,m){const{w:g,h:w,align:$=HorizontalAlign.CENTER|VerticalAlign.MIDDLE,mode:I}=CoverOptionsSchema.parse(m),D=7&$,F=$>>3;if((D===0||D&D-1)&&(F===0||F&F-1))throw new Error("only use one flag per alignment direction");const U=D>>1,q=F>>1,j=g/w>d.bitmap.width/d.bitmap.height?g/d.bitmap.width:w/d.bitmap.height;return d=methods$d.scale(d,{f:j,mode:I}),d=methods$b.crop(d,{x:(d.bitmap.width-g)/2*U,y:(d.bitmap.height-w)/2*q,w:g,h:w})}},DisplaceOptionsSchema=z.object({map:JimpClassSchema,offset:z.number()}),methods$9={displace(d,m){const{map:g,offset:w}=DisplaceOptionsSchema.parse(m),$=clone(d);return d.scan(((I,D,F)=>{let U=g.bitmap.data[F]/256*w;U=Math.round(U);const q=d.getPixelIndex(I+U,D);d.bitmap.data[q]=$.bitmap.data[F],d.bitmap.data[q+1]=$.bitmap.data[F+1],d.bitmap.data[q+2]=$.bitmap.data[F+2]})),d}},methods$8={dither(d){const m=[1,9,3,11,13,5,15,7,4,12,2,10,16,8,14,6];return d.scan(((g,w,$)=>{const I=m[((3&w)<<2)+g%4];d.bitmap.data[$]=Math.min(d.bitmap.data[$]+I,255),d.bitmap.data[$+1]=Math.min(d.bitmap.data[$+1]+I,255),d.bitmap.data[$+2]=Math.min(d.bitmap.data[$+2]+I,255)})),d}},FisheyeOptionsSchema=z.object({radius:z.number().min(0).optional()}),methods$7={fisheye(d,m={}){const{radius:g=2.5}=FisheyeOptionsSchema.parse(m),w=clone(d),{width:$,height:I}=w.bitmap;return w.scan(((D,F)=>{const U=D/$,q=F/I,j=Math.sqrt(Math.pow(U-.5,2)+Math.pow(q-.5,2)),G=2*Math.pow(j,g),H=(U-.5)/j,V=(q-.5)/j,Z=Math.round((G*H+.5)*$),Q=Math.round((G*V+.5)*I),J=w.getPixelColor(Z,Q);d.setPixelColor(J,D,F)})),d.setPixelColor(w.getPixelColor($/2,I/2),$/2,I/2),d}},FlipOptionsSchema=z.object({horizontal:z.boolean().optional(),vertical:z.boolean().optional()}),methods$6={flip(d,m){const{horizontal:g,vertical:w}=FlipOptionsSchema.parse(m),$=Buffer.alloc(d.bitmap.data.length);return d.scan(((I,D,F)=>{const U=g?d.bitmap.width-1-I:I,q=w?d.bitmap.height-1-D:D,j=d.bitmap.width*q+U<<2,G=d.bitmap.data.readUInt32BE(F);$.writeUInt32BE(G,j)})),d.bitmap.data=Buffer.from($),d}};function Converter$1(d,m){if(!(d&&m&&d.length&&m.length))throw new Error("Bad alphabet");this.srcAlphabet=d,this.dstAlphabet=m}Converter$1.prototype.convert=function(d){var m,g,w,$={},I=this.srcAlphabet.length,D=this.dstAlphabet.length,F=d.length,U=typeof d=="string"?"":[];if(!this.isValid(d))throw new Error('Number "'+d+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return d;for(m=0;m<F;m++)$[m]=this.srcAlphabet.indexOf(d[m]);do{for(g=0,w=0,m=0;m<F;m++)(g=g*I+$[m])>=D?($[w++]=parseInt(g/D,10),g%=D):w>0&&($[w++]=0);F=w,U=this.dstAlphabet.slice(g,g+1).concat(U)}while(w!==0);return U},Converter$1.prototype.isValid=function(d){for(var m=0;m<d.length;++m)if(this.srcAlphabet.indexOf(d[m])===-1)return!1;return!0};var converter=Converter$1,Converter=converter;function anyBase(d,m){var g=new Converter(d,m);return function(w){return g.convert(w)}}anyBase.BIN="01",anyBase.OCT="01234567",anyBase.DEC="0123456789",anyBase.HEX="0123456789abcdef";var anyBase_1=anyBase,anyBase$1=getDefaultExportFromCjs(anyBase_1),__defProp$1=Object.defineProperty,__defNormalProp$1=(d,m,g)=>m in d?__defProp$1(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__publicField$1=(d,m,g)=>__defNormalProp$1(d,typeof m!="symbol"?m+"":m,g);class ImagePHash{constructor(m,g){__publicField$1(this,"size"),__publicField$1(this,"smallerSize"),this.size=m||32,this.smallerSize=g||8,initCoefficients(this.size)}distance(m,g){let w=0;for(let $=0;$<m.length;$++)m[$]!==g[$]&&w++;return w/m.length}getHash(m){m=methods$d.resize(clone(m),{w:this.size,h:this.size}),m=methods$e.greyscale(m);const g=[];for(let F=0;F<m.bitmap.width;F++){const U=[];for(let q=0;q<m.bitmap.height;q++)U[q]=intToRGBA(m.getPixelColor(F,q)).b;g[F]=U}const w=applyDCT(g,this.size);let $=0;for(let F=0;F<this.smallerSize;F++)for(let U=0;U<this.smallerSize;U++)$+=w[F][U];const I=$/(this.smallerSize*this.smallerSize);let D="";for(let F=0;F<this.smallerSize;F++)for(let U=0;U<this.smallerSize;U++)D+=w[F][U]>I?"1":"0";return D}}function intToRGBA(d){const m=255&d,g=255&(d>>>=8),w=255&(d>>>=8);return{r:255&(d>>>=8),g:w,b:g,a:m}}const c$1=[];function initCoefficients(d){for(let m=1;m<d;m++)c$1[m]=1;c$1[0]=1/Math.sqrt(2)}function applyDCT(d,m){const g=m,w=[];for(let $=0;$<g;$++){const I=[];for(let D=0;D<g;D++){let F=0;for(let U=0;U<g;U++)for(let q=0;q<g;q++)F+=Math.cos((2*U+1)/(2*g)*$*Math.PI)*Math.cos((2*q+1)/(2*g)*D*Math.PI)*d[U][q];F*=c$1[$]*c$1[D]/4,I[D]=F,w[$]=I}}return w}const alphabet="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_",maxHashLength=[NaN,NaN];for(let d=2;d<65;d++){const m=anyBase$1(anyBase$1.BIN,alphabet.slice(0,d))(new Array(65).join("1"));maxHashLength.push(m.length)}const methods$5={pHash:d=>new ImagePHash().getHash(d),hash(d,m=64){if(m<2||m>64)throw new Error("base must be a number between 2 and 64");const g=alphabet.slice(0,m),w=this.pHash(d),$=maxHashLength[m];return anyBase$1(anyBase$1.BIN,g)(w).padStart($,"0")},distanceFromHash(d,m){const g=new ImagePHash,w=g.getHash(d);return g.distance(w,m)}},MaskOptionsObjectSchema=z.object({src:JimpClassSchema,x:z.number().optional(),y:z.number().optional()}),MaskOptionsSchema=z.union([JimpClassSchema,MaskOptionsObjectSchema]),methods$4={mask(d,m){let g,w,$;MaskOptionsSchema.parse(m),"bitmap"in m?(g=m,w=0,$=0):(g=m.src,w=m.x??0,$=m.y??0),w=Math.round(w),$=Math.round($);const I=d.bitmap.width,D=d.bitmap.height;return g.scan((function(F,U,q){const j=w+F,G=$+U;if(j>=0&&G>=0&&j<I&&G<D){const H=d.getPixelIndex(j,G),{data:V}=g.bitmap,Z=(V[q+0]+V[q+1]+V[q+2])/3;d.bitmap.data[H+3]*=Z/255}})),d}};function measureText(d,m){let g=0;for(let w=0;w<m.length;w++){const $=m[w],I=d.chars[$];if(I){const D=d.kernings[$],F=m[w+1],U=D&&F&&D[F]&&D[F]||0;g+=(I.xadvance||0)+U}}return g}function splitLines(d,m,g){const w=m.replace(/[\r\n]+/g,` 
`).split(" "),$=[];let I=[],D=0;return w.forEach((F=>{if(measureText(d,F+(w.length>1?" ":""))>g){const j=F[Symbol.iterator]();let G="";for(const H of j){const V=[...I,G+H].join(" "),Z=measureText(d,V);Z<g?G+=H:Z>g?($.push([...I,G]),I=[],G=H):($.push([...I,G+H]),I=[],G="")}return}const U=[...I,F].join(" "),q=measureText(d,U);q<=g&&!F.includes(`
`)?(q>D&&(D=q),I.push(F)):($.push(I),I=[F.replace(`
`,"")])})),$.push(I),{lines:$,longestLine:D}}function measureTextHeight(d,m,g){const{lines:w}=splitLines(d,m,g);return w.length*d.common.lineHeight}const PrintOptionsSchema=z.object({x:z.number(),y:z.number(),text:z.union([z.union([z.string(),z.number()]),z.object({text:z.union([z.string(),z.number()]),alignmentX:z.nativeEnum(HorizontalAlign).optional(),alignmentY:z.nativeEnum(VerticalAlign).optional()})]),maxWidth:z.number().optional(),maxHeight:z.number().optional(),cb:z.function(z.tuple([z.object({x:z.number(),y:z.number()})])).optional()});function xOffsetBasedOnAlignment(d,m,g,w){return w===HorizontalAlign.LEFT?0:w===HorizontalAlign.CENTER?(g-measureText(d,m))/2:g-measureText(d,m)}function drawCharacter(d,m,g,w,$){if($.width>0&&$.height>0){const I=m.pages[$.page];I&&(d=methods$h.blit(d,{src:I,x:g+$.xoffset,y:w+$.yoffset,srcX:$.x,srcY:$.y,srcW:$.width,srcH:$.height}))}return d}function printText(d,m,g,w,$,I){for(let D=0;D<$.length;D++){const F=$[D];let U;U=m.chars[F]?F:/\s/.test(F)?"":"?";const q=m.chars[U]||{xadvance:void 0},j=m.kernings[U];q&&drawCharacter(d,m,g,w,q);const G=$[D+1];g+=(j&&G&&j[G]&&j[G]||0)+(q.xadvance||I)}}const methods$3={print(d,{font:m,...g}){let w,$,{x:I,y:D,text:F,maxWidth:U=1/0,maxHeight:q=1/0,cb:j=(()=>{})}=PrintOptionsSchema.parse(g);typeof F=="object"&&F.text!==null&&F.text!==void 0?(w=F.alignmentX||HorizontalAlign.LEFT,$=F.alignmentY||VerticalAlign.TOP,{text:F}=F):(w=HorizontalAlign.LEFT,$=VerticalAlign.TOP,F=F.toString()),typeof F=="number"&&(F=F.toString()),q!==1/0&&$===VerticalAlign.BOTTOM?D+=q-measureTextHeight(m,F,U):q!==1/0&&$===VerticalAlign.MIDDLE&&(D+=q/2-measureTextHeight(m,F,U)/2);const G=Object.entries(m.chars).find((Z=>Z[1].xadvance))?.[1].xadvance;if(typeof G!="number")throw new Error("Could not find default character width");const{lines:H,longestLine:V}=splitLines(m,F,U);return H.forEach((Z=>{const Q=Z.join(" "),J=xOffsetBasedOnAlignment(m,Q,U,w);printText(d,m,I+J,D,Q,G),D+=m.common.lineHeight})),j.bind(d)({x:I+V,y:D}),d}},RotateOptionsSchema=z.union([z.number(),z.object({deg:z.number(),mode:z.union([z.boolean(),z.nativeEnum(ResizeStrategy)]).optional()})]);function createIdxTranslationFunction(d){return function(m,g){return g*d+m<<2}}function matrixRotate(d,m){if(Math.abs(m)%90!=0)throw new Error("Unsupported matrix rotation degree");const g=d.bitmap.width,w=d.bitmap.height;let $;switch(m){case 90:case-270:$=90;break;case 180:case-180:$=180;break;case 270:case-90:$=-90;break;default:throw new Error("Unsupported matrix rotation degree")}const I=$===180?g:w,D=$===180?w:g,F=Buffer.alloc(d.bitmap.data.length),U=createIdxTranslationFunction(g),q=createIdxTranslationFunction(I);for(let j=0;j<g;j++)for(let G=0;G<w;G++){const H=U(j,G),V=d.bitmap.data.readUInt32BE(H);let Z;switch($){case 90:Z=q(G,g-j-1);break;case-90:Z=q(w-G-1,j);break;case 180:Z=q(g-j-1,w-G-1);break;default:throw new Error("Unsupported matrix rotation angle")}F.writeUInt32BE(V,Z)}d.bitmap.data=F,d.bitmap.width=I,d.bitmap.height=D}function createTranslationFunction(d,m){return function(g,w){return{x:g+d,y:w+m}}}function advancedRotate(d,m,g){const w=m*Math.PI/180,$=Math.cos(w),I=Math.sin(w);let D=d.bitmap.width,F=d.bitmap.height;if(g===!0||typeof g=="string"){D=Math.ceil(Math.abs(d.bitmap.width*$)+Math.abs(d.bitmap.height*I))+1,F=Math.ceil(Math.abs(d.bitmap.width*I)+Math.abs(d.bitmap.height*$))+1,D%2!=0&&D++,F%2!=0&&F++;const V=clone(d);d.scan(((Q,J,ie)=>{d.bitmap.data.writeUInt32BE(d.background,ie)}));const Z=Math.max(D,F,d.bitmap.width,d.bitmap.height);d=composite(d=methods$d.resize(d,{h:Z,w:Z,mode:g===!0?void 0:g}),V,d.bitmap.width/2-V.bitmap.width/2,d.bitmap.height/2-V.bitmap.height/2)}const U=d.bitmap.width,q=d.bitmap.height,j=Buffer.alloc(d.bitmap.data.length),G=createTranslationFunction(-U/2,-q/2),H=createTranslationFunction(U/2+.5,q/2+.5);for(let V=1;V<=q;V++)for(let Z=1;Z<=U;Z++){const Q=G(Z,V),J=H($*Q.x-I*Q.y,$*Q.y+I*Q.x),ie=U*(V-1)+Z-1<<2;if(J.x>=0&&J.x<U&&J.y>=0&&J.y<q){const re=U*(0|J.y)+J.x<<2,se=d.bitmap.data.readUInt32BE(re);j.writeUInt32BE(se,ie)}else j.writeUInt32BE(d.background,ie)}if(d.bitmap.data=j,g===!0||typeof g=="string"){const V=Math.max(U/2-D/2,0),Z=Math.max(q/2-F/2,0);d=methods$b.crop(d,{x:V,y:Z,w:D,h:F})}}const methods$2={rotate(d,m){const g=RotateOptionsSchema.parse(m),w=typeof g=="number"?{deg:g}:g,{mode:$=!0}=w;let{deg:I}=w;return I%=360,I%360==0||(I%90==0&&($||d.bitmap.width===d.bitmap.height||I%180==0)?matrixRotate(d,I):advancedRotate(d,I,$)),d}},ThresholdOptionsSchema=z.object({max:z.number().min(0).max(255),replace:z.number().min(0).max(255).optional(),autoGreyscale:z.boolean().optional()}),methods$1={threshold(d,m){let{max:g,replace:w=255,autoGreyscale:$=!0}=ThresholdOptionsSchema.parse(m);return g=limit255(g),w=limit255(w),$&&methods$e.greyscale(d),d.scan(((I,D,F)=>{const U=d.bitmap.data[F]<g?d.bitmap.data[F]:w;d.bitmap.data[F]=U,d.bitmap.data[F+1]=U,d.bitmap.data[F+2]=U})),d}};var __defProp=Object.defineProperty,__defNormalProp=(d,m,g)=>m in d?__defProp(d,m,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[m]=g,__export=(d,m)=>{for(var g in m)__defProp(d,g,{get:m[g],enumerable:!0})},__publicField=(d,m,g)=>(__defNormalProp(d,typeof m!="symbol"?m+"":m,g),g),constants_exports={};__export(constants_exports,{bt709:()=>bt709_exports});var bt709_exports={};__export(bt709_exports,{Y:()=>Y,x:()=>x$1,y:()=>y$1});var Y=(d=>(d[d.RED=.2126]="RED",d[d.GREEN=.7152]="GREEN",d[d.BLUE=.0722]="BLUE",d[d.WHITE=1]="WHITE",d))(Y||{}),x$1=(d=>(d[d.RED=.64]="RED",d[d.GREEN=.3]="GREEN",d[d.BLUE=.15]="BLUE",d[d.WHITE=.3127]="WHITE",d))(x$1||{}),y$1=(d=>(d[d.RED=.33]="RED",d[d.GREEN=.6]="GREEN",d[d.BLUE=.06]="BLUE",d[d.WHITE=.329]="WHITE",d))(y$1||{}),conversion_exports={};function correctGamma(d){return d>.04045?((d+.055)/1.055)**2.4:d/12.92}function rgb2xyz(d,m,g){return{x:.4124*(d=correctGamma(d/255))+.3576*(m=correctGamma(m/255))+.1805*(g=correctGamma(g/255)),y:.2126*d+.7152*m+.0722*g,z:.0193*d+.1192*m+.9505*g}}__export(conversion_exports,{lab2rgb:()=>lab2rgb,lab2xyz:()=>lab2xyz,rgb2hsl:()=>rgb2hsl,rgb2lab:()=>rgb2lab,rgb2xyz:()=>rgb2xyz,xyz2lab:()=>xyz2lab,xyz2rgb:()=>xyz2rgb});var arithmetic_exports={};function degrees2radians(d){return d*(Math.PI/180)}function max3(d,m,g){let w=d;return w<m&&(w=m),w<g&&(w=g),w}function min3(d,m,g){let w=d;return w>m&&(w=m),w>g&&(w=g),w}function intInRange(d,m,g){return d>g&&(d=g),d<m&&(d=m),0|d}function inRange0to255Rounded(d){return(d=Math.round(d))>255?d=255:d<0&&(d=0),d}function inRange0to255(d){return d>255?d=255:d<0&&(d=0),d}function stableSort(d,m){const g=typeof d[0];let w;if(g==="number"||g==="string"){const $=Object.create(null);for(let I=0,D=d.length;I<D;I++){const F=d[I];$[F]||$[F]===0||($[F]=I)}w=d.sort(((I,D)=>m(I,D)||$[I]-$[D]))}else{const $=d.slice(0);w=d.sort(((I,D)=>m(I,D)||$.indexOf(I)-$.indexOf(D)))}return w}function rgb2hsl(d,m,g){const w=min3(d,m,g),$=max3(d,m,g),I=$-w,D=(w+$)/510;let F=0;D>0&&D<1&&(F=I/(D<.5?$+w:510-$-w));let U=0;return I>0&&(U=$===d?(m-g)/I:$===m?2+(g-d)/I:4+(d-m)/I,U*=60,U<0&&(U+=360)),{h:U,s:F,l:D}}__export(arithmetic_exports,{degrees2radians:()=>degrees2radians,inRange0to255:()=>inRange0to255,inRange0to255Rounded:()=>inRange0to255Rounded,intInRange:()=>intInRange,max3:()=>max3,min3:()=>min3,stableSort:()=>stableSort});var refX=.95047,refY=1,refZ=1.08883;function pivot(d){return d>.008856?d**(1/3):7.787*d+16/116}function xyz2lab(d,m,g){if(d=pivot(d/refX),m=pivot(m/refY),g=pivot(g/refZ),116*m-16<0)throw new Error("xxx");return{L:Math.max(0,116*m-16),a:500*(d-m),b:200*(m-g)}}function rgb2lab(d,m,g){const w=rgb2xyz(d,m,g);return xyz2lab(w.x,w.y,w.z)}var refX2=.95047,refY2=1,refZ2=1.08883;function pivot2(d){return d>.206893034?d**3:(d-16/116)/7.787}function lab2xyz(d,m,g){const w=(d+16)/116,$=w-g/200;return{x:refX2*pivot2(m/500+w),y:refY2*pivot2(w),z:refZ2*pivot2($)}}function correctGamma2(d){return d>.0031308?1.055*d**(1/2.4)-.055:12.92*d}function xyz2rgb(d,m,g){const w=correctGamma2(3.2406*d+-1.5372*m+-.4986*g),$=correctGamma2(-.9689*d+1.8758*m+.0415*g),I=correctGamma2(.0557*d+-.204*m+1.057*g);return{r:inRange0to255Rounded(255*w),g:inRange0to255Rounded(255*$),b:inRange0to255Rounded(255*I)}}function lab2rgb(d,m,g){const w=lab2xyz(d,m,g);return xyz2rgb(w.x,w.y,w.z)}var distance_exports={};__export(distance_exports,{AbstractDistanceCalculator:()=>AbstractDistanceCalculator,AbstractEuclidean:()=>AbstractEuclidean,AbstractManhattan:()=>AbstractManhattan,CIE94GraphicArts:()=>CIE94GraphicArts,CIE94Textiles:()=>CIE94Textiles,CIEDE2000:()=>CIEDE2000,CMetric:()=>CMetric,Euclidean:()=>Euclidean,EuclideanBT709:()=>EuclideanBT709,EuclideanBT709NoAlpha:()=>EuclideanBT709NoAlpha,Manhattan:()=>Manhattan,ManhattanBT709:()=>ManhattanBT709,ManhattanNommyde:()=>ManhattanNommyde,PNGQuant:()=>PNGQuant});var AbstractDistanceCalculator=class{constructor(){__publicField(this,"_maxDistance"),__publicField(this,"_whitePoint"),this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(d,m,g,w){this._whitePoint={r:d>0?255/d:0,g:m>0?255/m:0,b:g>0?255/g:0,a:w>0?255/w:0},this._maxDistance=this.calculateRaw(d,m,g,w,0,0,0,0)}calculateNormalized(d,m){return this.calculateRaw(d.r,d.g,d.b,d.a,m.r,m.g,m.b,m.a)/this._maxDistance}},AbstractCIE94=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,F){const U=rgb2lab(inRange0to255(d*this._whitePoint.r),inRange0to255(m*this._whitePoint.g),inRange0to255(g*this._whitePoint.b)),q=rgb2lab(inRange0to255($*this._whitePoint.r),inRange0to255(I*this._whitePoint.g),inRange0to255(D*this._whitePoint.b)),j=U.L-q.L,G=U.a-q.a,H=U.b-q.b,V=Math.sqrt(U.a*U.a+U.b*U.b),Z=V-Math.sqrt(q.a*q.a+q.b*q.b);let Q=G*G+H*H-Z*Z;Q=Q<0?0:Math.sqrt(Q);const J=(F-w)*this._whitePoint.a*this._kA;return Math.sqrt((j/this._Kl)**2+(Z/(1+this._K1*V))**2+(Q/(1+this._K2*V))**2+J**2)}},CIE94Textiles=class extends AbstractCIE94{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=12.5/255}},CIE94GraphicArts=class extends AbstractCIE94{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=25/255}},_CIEDE2000=class extends AbstractDistanceCalculator{_setDefaults(){}static _calculatehp(d,m){const g=Math.atan2(d,m);return g>=0?g:g+_CIEDE2000._deg360InRad}static _calculateRT(d,m){const g=m**7,w=2*Math.sqrt(g/(g+_CIEDE2000._pow25to7)),$=_CIEDE2000._deg30InRad*Math.exp(-(((d-_CIEDE2000._deg275InRad)/_CIEDE2000._deg25InRad)**2));return-Math.sin(2*$)*w}static _calculateT(d){return 1-.17*Math.cos(d-_CIEDE2000._deg30InRad)+.24*Math.cos(2*d)+.32*Math.cos(3*d+_CIEDE2000._deg6InRad)-.2*Math.cos(4*d-_CIEDE2000._deg63InRad)}static _calculate_ahp(d,m,g,w){const $=g+w;return d===0?$:m<=_CIEDE2000._deg180InRad?$/2:$<_CIEDE2000._deg360InRad?($+_CIEDE2000._deg360InRad)/2:($-_CIEDE2000._deg360InRad)/2}static _calculate_dHp(d,m,g,w){let $;return $=d===0?0:m<=_CIEDE2000._deg180InRad?g-w:g<=w?g-w+_CIEDE2000._deg360InRad:g-w-_CIEDE2000._deg360InRad,2*Math.sqrt(d)*Math.sin($/2)}calculateRaw(d,m,g,w,$,I,D,F){const U=rgb2lab(inRange0to255(d*this._whitePoint.r),inRange0to255(m*this._whitePoint.g),inRange0to255(g*this._whitePoint.b)),q=rgb2lab(inRange0to255($*this._whitePoint.r),inRange0to255(I*this._whitePoint.g),inRange0to255(D*this._whitePoint.b)),j=(F-w)*this._whitePoint.a*_CIEDE2000._kA,G=this.calculateRawInLab(U,q);return Math.sqrt(G+j*j)}calculateRawInLab(d,m){const g=d.L,w=d.a,$=d.b,I=m.L,D=m.a,F=m.b,U=((Math.sqrt(w*w+$*$)+Math.sqrt(D*D+F*F))/2)**7,q=.5*(1-Math.sqrt(U/(U+_CIEDE2000._pow25to7))),j=(1+q)*w,G=(1+q)*D,H=Math.sqrt(j*j+$*$),V=Math.sqrt(G*G+F*F),Z=H*V,Q=_CIEDE2000._calculatehp($,j),J=_CIEDE2000._calculatehp(F,G),ie=Math.abs(Q-J),re=I-g,se=V-H,X=_CIEDE2000._calculate_dHp(Z,ie,J,Q),ne=_CIEDE2000._calculate_ahp(Z,ie,Q,J),ce=(H+V)/2,oe=((g+I)/2-50)**2,de=se/(1+.045*ce),me=X/(1+.015*_CIEDE2000._calculateT(ne)*ce);return(re/(1+.015*oe/Math.sqrt(20+oe)))**2+de**2+me**2+_CIEDE2000._calculateRT(ne,ce)*de*me}},CIEDE2000=_CIEDE2000;__publicField(CIEDE2000,"_kA",25/255),__publicField(CIEDE2000,"_pow25to7",25**7),__publicField(CIEDE2000,"_deg360InRad",degrees2radians(360)),__publicField(CIEDE2000,"_deg180InRad",degrees2radians(180)),__publicField(CIEDE2000,"_deg30InRad",degrees2radians(30)),__publicField(CIEDE2000,"_deg6InRad",degrees2radians(6)),__publicField(CIEDE2000,"_deg63InRad",degrees2radians(63)),__publicField(CIEDE2000,"_deg275InRad",degrees2radians(275)),__publicField(CIEDE2000,"_deg25InRad",degrees2radians(25));var CMetric=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,F){const U=(d+$)/2*this._whitePoint.r,q=(d-$)*this._whitePoint.r,j=(m-I)*this._whitePoint.g,G=(g-D)*this._whitePoint.b,H=((512+U)*q*q>>8)+4*j*j+((767-U)*G*G>>8),V=(F-w)*this._whitePoint.a;return Math.sqrt(H+V*V)}_setDefaults(){}},AbstractEuclidean=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,F){const U=$-d,q=I-m,j=D-g,G=F-w;return Math.sqrt(this._kR*U*U+this._kG*q*q+this._kB*j*j+this._kA*G*G)}},Euclidean=class extends AbstractEuclidean{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},EuclideanBT709=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},EuclideanBT709NoAlpha=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=0}},AbstractManhattan=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,F){let U=$-d,q=I-m,j=D-g,G=F-w;return U<0&&(U=0-U),q<0&&(q=0-q),j<0&&(j=0-j),G<0&&(G=0-G),this._kR*U+this._kG*q+this._kB*j+this._kA*G}},Manhattan=class extends AbstractManhattan{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},ManhattanNommyde=class extends AbstractManhattan{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}},ManhattanBT709=class extends AbstractManhattan{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},PNGQuant=class extends AbstractDistanceCalculator{calculateRaw(d,m,g,w,$,I,D,F){const U=(F-w)*this._whitePoint.a;return this._colordifferenceCh(d*this._whitePoint.r,$*this._whitePoint.r,U)+this._colordifferenceCh(m*this._whitePoint.g,I*this._whitePoint.g,U)+this._colordifferenceCh(g*this._whitePoint.b,D*this._whitePoint.b,U)}_colordifferenceCh(d,m,g){const w=d-m,$=w+g;return w*w+$*$}_setDefaults(){}},palette_exports={};__export(palette_exports,{AbstractPaletteQuantizer:()=>AbstractPaletteQuantizer,ColorHistogram:()=>ColorHistogram,NeuQuant:()=>NeuQuant,NeuQuantFloat:()=>NeuQuantFloat,RGBQuant:()=>RGBQuant,WuColorCube:()=>WuColorCube,WuQuant:()=>WuQuant});var AbstractPaletteQuantizer=class{quantizeSync(){for(const d of this.quantize())if(d.palette)return d.palette;throw new Error("unreachable")}},Point=class{constructor(){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),__publicField(this,"uint32"),__publicField(this,"rgba"),this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}static createByQuadruplet(d){const m=new Point;return m.r=0|d[0],m.g=0|d[1],m.b=0|d[2],m.a=0|d[3],m._loadUINT32(),m._loadQuadruplet(),m}static createByRGBA(d,m,g,w){const $=new Point;return $.r=0|d,$.g=0|m,$.b=0|g,$.a=0|w,$._loadUINT32(),$._loadQuadruplet(),$}static createByUint32(d){const m=new Point;return m.uint32=d>>>0,m._loadRGBA(),m._loadQuadruplet(),m}from(d){this.r=d.r,this.g=d.g,this.b=d.b,this.a=d.a,this.uint32=d.uint32,this.rgba[0]=d.r,this.rgba[1]=d.g,this.rgba[2]=d.b,this.rgba[3]=d.a}getLuminosity(d){let m=this.r,g=this.g,w=this.b;return d&&(m=Math.min(255,255-this.a+this.a*m/255),g=Math.min(255,255-this.a+this.a*g/255),w=Math.min(255,255-this.a+this.a*w/255)),.2126*m+.7152*g+.0722*w}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=255&this.uint32,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}},PointContainer=class{constructor(){__publicField(this,"_pointArray"),__publicField(this,"_width"),__publicField(this,"_height"),this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(d){this._width=d}setHeight(d){this._height=d}getPointArray(){return this._pointArray}clone(){const d=new PointContainer;d._width=this._width,d._height=this._height;for(let m=0,g=this._pointArray.length;m<g;m++)d._pointArray[m]=Point.createByUint32(0|this._pointArray[m].uint32);return d}toUint32Array(){const d=this._pointArray.length,m=new Uint32Array(d);for(let g=0;g<d;g++)m[g]=this._pointArray[g].uint32;return m}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(d){const m=d.naturalWidth,g=d.naturalHeight,w=document.createElement("canvas");return w.width=m,w.height=g,w.getContext("2d").drawImage(d,0,0,m,g,0,0,m,g),PointContainer.fromHTMLCanvasElement(w)}static fromHTMLCanvasElement(d){const m=d.width,g=d.height,w=d.getContext("2d").getImageData(0,0,m,g);return PointContainer.fromImageData(w)}static fromImageData(d){const m=d.width,g=d.height;return PointContainer.fromUint8Array(d.data,m,g)}static fromUint8Array(d,m,g){switch(Object.prototype.toString.call(d)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:d=new Uint8Array(d)}const w=new Uint32Array(d.buffer);return PointContainer.fromUint32Array(w,m,g)}static fromUint32Array(d,m,g){const w=new PointContainer;w._width=m,w._height=g;for(let $=0,I=d.length;$<I;$++)w._pointArray[$]=Point.createByUint32(0|d[$]);return w}static fromBuffer(d,m,g){const w=new Uint32Array(d.buffer,d.byteOffset,d.byteLength/Uint32Array.BYTES_PER_ELEMENT);return PointContainer.fromUint32Array(w,m,g)}},hueGroups=10;function hueGroup(d,m){const g=360/m;for(let w=1,$=g-g/2;w<m;w++,$+=g)if(d>=$&&d<$+g)return w;return 0}var Palette=class{constructor(){__publicField(this,"_pointContainer"),__publicField(this,"_pointArray",[]),__publicField(this,"_i32idx",{}),this._pointContainer=new PointContainer,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(d){this._pointArray.push(d),this._pointContainer.setWidth(this._pointArray.length)}has(d){for(let m=this._pointArray.length-1;m>=0;m--)if(d.uint32===this._pointArray[m].uint32)return!0;return!1}getNearestColor(d,m){return this._pointArray[0|this._getNearestIndex(d,m)]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(d){return typeof this._i32idx[d]=="number"?this._i32idx[d]:-1}_getNearestIndex(d,m){let g=this._nearestPointFromCache(""+m.uint32);if(g>=0)return g;let w=Number.MAX_VALUE;g=0;for(let $=0,I=this._pointArray.length;$<I;$++){const D=this._pointArray[$],F=d.calculateRaw(m.r,m.g,m.b,m.a,D.r,D.g,D.b,D.a);F<w&&(w=F,g=$)}return this._i32idx[m.uint32]=g,g}sort(){this._i32idx={},this._pointArray.sort(((d,m)=>{const g=rgb2hsl(d.r,d.g,d.b),w=rgb2hsl(m.r,m.g,m.b),$=d.r===d.g&&d.g===d.b?0:1+hueGroup(g.h,hueGroups),I=(m.r===m.g&&m.g===m.b?0:1+hueGroup(w.h,hueGroups))-$;if(I)return-I;const D=d.getLuminosity(!0),F=m.getLuminosity(!0);if(F-D!=0)return F-D;const U=(100*w.s|0)-(100*g.s|0);return U?-U:0}))}},utils_exports={};__export(utils_exports,{HueStatistics:()=>HueStatistics,Palette:()=>Palette,Point:()=>Point,PointContainer:()=>PointContainer,ProgressTracker:()=>ProgressTracker,arithmetic:()=>arithmetic_exports});var HueGroup=class{constructor(){__publicField(this,"num",0),__publicField(this,"cols",[])}},HueStatistics=class{constructor(d,m){__publicField(this,"_numGroups"),__publicField(this,"_minCols"),__publicField(this,"_stats"),__publicField(this,"_groupsFull"),this._numGroups=d,this._minCols=m,this._stats=[];for(let g=0;g<=d;g++)this._stats[g]=new HueGroup;this._groupsFull=0}check(d){this._groupsFull===this._numGroups+1&&(this.check=()=>{});const m=255&d,g=d>>>8&255,w=d>>>16&255,$=m===g&&g===w?0:1+hueGroup(rgb2hsl(m,g,w).h,this._numGroups),I=this._stats[$],D=this._minCols;I.num++,I.num>D||(I.num===D&&this._groupsFull++,I.num<=D&&this._stats[$].cols.push(d))}injectIntoDictionary(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d[g]?d[g]++:d[g]=1}))}injectIntoArray(d){for(let m=0;m<=this._numGroups;m++)this._stats[m].num<=this._minCols&&this._stats[m].cols.forEach((g=>{d.indexOf(g)===-1&&d.push(g)}))}},_ProgressTracker=class{constructor(d,m){__publicField(this,"progress"),__publicField(this,"_step"),__publicField(this,"_range"),__publicField(this,"_last"),__publicField(this,"_progressRange"),this._range=d,this._progressRange=m,this._step=Math.max(1,this._range/(_ProgressTracker.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(d){return d-this._last>=this._step&&(this._last=d,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0)}},ProgressTracker=_ProgressTracker;__publicField(ProgressTracker,"steps",100);var networkBiasShift=3,Neuron=class{constructor(d){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift,this.g>>networkBiasShift,this.b>>networkBiasShift,this.a>>networkBiasShift)}subtract(d,m,g,w){this.r-=0|d,this.g-=0|m,this.b-=0|g,this.a-=0|w}},_NeuQuant=class extends AbstractPaletteQuantizer{constructor(d,m=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new Neuron((d<<networkBiasShift+8)/this._networkSize|0),this._freq[d]=_NeuQuant._initialBias/this._networkSize|0,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuant._minpicturebytes&&(d=1);const g=30+(d-1)/3|0,w=m/d|0;let $,I=w/_NeuQuant._nCycles|0,D=_NeuQuant._initAlpha,F=(this._networkSize>>3)*_NeuQuant._radiusBias,U=F>>_NeuQuant._radiusBiasShift;U<=1&&(U=0);for(let j=0;j<U;j++)this._radPower[j]=D*((U*U-j*j)*_NeuQuant._radBias/(U*U))>>>0;$=m<_NeuQuant._minpicturebytes?1:m%_NeuQuant._prime1!=0?_NeuQuant._prime1:m%_NeuQuant._prime2!=0?_NeuQuant._prime2:m%_NeuQuant._prime3!=0?_NeuQuant._prime3:_NeuQuant._prime4;const q=new ProgressTracker(w,99);for(let j=0,G=0;j<w;){q.shouldNotify(j)&&(yield{progress:q.progress});const H=this._pointArray[G],V=H.b<<networkBiasShift,Z=H.g<<networkBiasShift,Q=H.r<<networkBiasShift,J=H.a<<networkBiasShift,ie=this._contest(V,Z,Q,J);if(this._alterSingle(D,ie,V,Z,Q,J),U!==0&&this._alterNeighbour(U,ie,V,Z,Q,J),G+=$,G>=m&&(G-=m),j++,I===0&&(I=1),j%I==0){D-=D/g|0,F-=F/_NeuQuant._radiusDecrease|0,U=F>>_NeuQuant._radiusBiasShift,U<=1&&(U=0);for(let re=0;re<U;re++)this._radPower[re]=D*((U*U-re*re)*_NeuQuant._radBias/(U*U))>>>0}}}_buildPalette(){const d=new Palette;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let F=m+d;F>this._networkSize&&(F=this._networkSize);let U=m+1,q=m-1,j=1;for(;U<F||q>D;){const G=this._radPower[j++]/_NeuQuant._alphaRadBias;if(U<F){const H=this._network[U++];H.subtract(G*(H.r-$),G*(H.g-w),G*(H.b-g),G*(H.a-I))}if(q>D){const H=this._network[q--];H.subtract(G*(H.r-$),G*(H.g-w),G*(H.b-g),G*(H.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuant._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift;let I=2147483647,D=I,F=-1,U=F;for(let q=0;q<this._networkSize;q++){const j=this._network[q],G=this._distance.calculateNormalized(j,{r:g,g:m,b:d,a:w})*$|0;G<I&&(I=G,F=q);const H=G-(this._bias[q]>>_NeuQuant._initialBiasShift-networkBiasShift);H<D&&(D=H,U=q);const V=this._freq[q]>>_NeuQuant._betaShift;this._freq[q]-=V,this._bias[q]+=V<<_NeuQuant._gammaShift}return this._freq[F]+=_NeuQuant._beta,this._bias[F]-=_NeuQuant._betaGamma,U}},NeuQuant=_NeuQuant;__publicField(NeuQuant,"_prime1",499),__publicField(NeuQuant,"_prime2",491),__publicField(NeuQuant,"_prime3",487),__publicField(NeuQuant,"_prime4",503),__publicField(NeuQuant,"_minpicturebytes",_NeuQuant._prime4),__publicField(NeuQuant,"_nCycles",100),__publicField(NeuQuant,"_initialBiasShift",16),__publicField(NeuQuant,"_initialBias",1<<_NeuQuant._initialBiasShift),__publicField(NeuQuant,"_gammaShift",10),__publicField(NeuQuant,"_betaShift",10),__publicField(NeuQuant,"_beta",_NeuQuant._initialBias>>_NeuQuant._betaShift),__publicField(NeuQuant,"_betaGamma",_NeuQuant._initialBias<<_NeuQuant._gammaShift-_NeuQuant._betaShift),__publicField(NeuQuant,"_radiusBiasShift",6),__publicField(NeuQuant,"_radiusBias",1<<_NeuQuant._radiusBiasShift),__publicField(NeuQuant,"_radiusDecrease",30),__publicField(NeuQuant,"_alphaBiasShift",10),__publicField(NeuQuant,"_initAlpha",1<<_NeuQuant._alphaBiasShift),__publicField(NeuQuant,"_radBiasShift",8),__publicField(NeuQuant,"_radBias",1<<_NeuQuant._radBiasShift),__publicField(NeuQuant,"_alphaRadBiasShift",_NeuQuant._alphaBiasShift+_NeuQuant._radBiasShift),__publicField(NeuQuant,"_alphaRadBias",1<<_NeuQuant._alphaRadBiasShift);var networkBiasShift2=3,NeuronFloat=class{constructor(d){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=d}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift2,this.g>>networkBiasShift2,this.b>>networkBiasShift2,this.a>>networkBiasShift2)}subtract(d,m,g,w){this.r-=d,this.g-=m,this.b-=g,this.a-=w}},_NeuQuantFloat=class extends AbstractPaletteQuantizer{constructor(d,m=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=d,this._pointArray=[],this._sampleFactor=1,this._networkSize=m,this._distance.setWhitePoint(255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2)}sample(d){this._pointArray=this._pointArray.concat(d.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let d=0;d<this._networkSize;d++)this._network[d]=new NeuronFloat((d<<networkBiasShift2+8)/this._networkSize),this._freq[d]=_NeuQuantFloat._initialBias/this._networkSize,this._bias[d]=0}*_learn(){let d=this._sampleFactor;const m=this._pointArray.length;m<_NeuQuantFloat._minpicturebytes&&(d=1);const g=30+(d-1)/3,w=m/d;let $,I=w/_NeuQuantFloat._nCycles|0,D=_NeuQuantFloat._initAlpha,F=(this._networkSize>>3)*_NeuQuantFloat._radiusBias,U=F>>_NeuQuantFloat._radiusBiasShift;U<=1&&(U=0);for(let j=0;j<U;j++)this._radPower[j]=D*((U*U-j*j)*_NeuQuantFloat._radBias/(U*U));$=m<_NeuQuantFloat._minpicturebytes?1:m%_NeuQuantFloat._prime1!=0?_NeuQuantFloat._prime1:m%_NeuQuantFloat._prime2!=0?_NeuQuantFloat._prime2:m%_NeuQuantFloat._prime3!=0?_NeuQuantFloat._prime3:_NeuQuantFloat._prime4;const q=new ProgressTracker(w,99);for(let j=0,G=0;j<w;){q.shouldNotify(j)&&(yield{progress:q.progress});const H=this._pointArray[G],V=H.b<<networkBiasShift2,Z=H.g<<networkBiasShift2,Q=H.r<<networkBiasShift2,J=H.a<<networkBiasShift2,ie=this._contest(V,Z,Q,J);if(this._alterSingle(D,ie,V,Z,Q,J),U!==0&&this._alterNeighbour(U,ie,V,Z,Q,J),G+=$,G>=m&&(G-=m),j++,I===0&&(I=1),j%I==0){D-=D/g,F-=F/_NeuQuantFloat._radiusDecrease,U=F>>_NeuQuantFloat._radiusBiasShift,U<=1&&(U=0);for(let re=0;re<U;re++)this._radPower[re]=D*((U*U-re*re)*_NeuQuantFloat._radBias/(U*U))}}}_buildPalette(){const d=new Palette;return this._network.forEach((m=>{d.add(m.toPoint())})),d.sort(),d}_alterNeighbour(d,m,g,w,$,I){let D=m-d;D<-1&&(D=-1);let F=m+d;F>this._networkSize&&(F=this._networkSize);let U=m+1,q=m-1,j=1;for(;U<F||q>D;){const G=this._radPower[j++]/_NeuQuantFloat._alphaRadBias;if(U<F){const H=this._network[U++];H.subtract(G*(H.r-$),G*(H.g-w),G*(H.b-g),G*(H.a-I))}if(q>D){const H=this._network[q--];H.subtract(G*(H.r-$),G*(H.g-w),G*(H.b-g),G*(H.a-I))}}}_alterSingle(d,m,g,w,$,I){d/=_NeuQuantFloat._initAlpha;const D=this._network[m];D.subtract(d*(D.r-$),d*(D.g-w),d*(D.b-g),d*(D.a-I))}_contest(d,m,g,w){const $=1020<<networkBiasShift2;let I=2147483647,D=I,F=-1,U=F;for(let q=0;q<this._networkSize;q++){const j=this._network[q],G=this._distance.calculateNormalized(j,{r:g,g:m,b:d,a:w})*$;G<I&&(I=G,F=q);const H=G-(this._bias[q]>>_NeuQuantFloat._initialBiasShift-networkBiasShift2);H<D&&(D=H,U=q);const V=this._freq[q]>>_NeuQuantFloat._betaShift;this._freq[q]-=V,this._bias[q]+=V<<_NeuQuantFloat._gammaShift}return this._freq[F]+=_NeuQuantFloat._beta,this._bias[F]-=_NeuQuantFloat._betaGamma,U}},NeuQuantFloat=_NeuQuantFloat;__publicField(NeuQuantFloat,"_prime1",499),__publicField(NeuQuantFloat,"_prime2",491),__publicField(NeuQuantFloat,"_prime3",487),__publicField(NeuQuantFloat,"_prime4",503),__publicField(NeuQuantFloat,"_minpicturebytes",_NeuQuantFloat._prime4),__publicField(NeuQuantFloat,"_nCycles",100),__publicField(NeuQuantFloat,"_initialBiasShift",16),__publicField(NeuQuantFloat,"_initialBias",1<<_NeuQuantFloat._initialBiasShift),__publicField(NeuQuantFloat,"_gammaShift",10),__publicField(NeuQuantFloat,"_betaShift",10),__publicField(NeuQuantFloat,"_beta",_NeuQuantFloat._initialBias>>_NeuQuantFloat._betaShift),__publicField(NeuQuantFloat,"_betaGamma",_NeuQuantFloat._initialBias<<_NeuQuantFloat._gammaShift-_NeuQuantFloat._betaShift),__publicField(NeuQuantFloat,"_radiusBiasShift",6),__publicField(NeuQuantFloat,"_radiusBias",1<<_NeuQuantFloat._radiusBiasShift),__publicField(NeuQuantFloat,"_radiusDecrease",30),__publicField(NeuQuantFloat,"_alphaBiasShift",10),__publicField(NeuQuantFloat,"_initAlpha",1<<_NeuQuantFloat._alphaBiasShift),__publicField(NeuQuantFloat,"_radBiasShift",8),__publicField(NeuQuantFloat,"_radBias",1<<_NeuQuantFloat._radBiasShift),__publicField(NeuQuantFloat,"_alphaRadBiasShift",_NeuQuantFloat._alphaBiasShift+_NeuQuantFloat._radBiasShift),__publicField(NeuQuantFloat,"_alphaRadBias",1<<_NeuQuantFloat._alphaRadBiasShift);var _ColorHistogram=class{constructor(d,m){__publicField(this,"_method"),__publicField(this,"_hueStats"),__publicField(this,"_histogram"),__publicField(this,"_initColors"),__publicField(this,"_minHueCols"),this._method=d,this._minHueCols=m<<2,this._initColors=m<<2,this._hueStats=new HueStatistics(_ColorHistogram._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(d){switch(this._method){case 1:this._colorStats1D(d);break;case 2:this._colorStats2D(d)}}getImportanceSortedColorsIDXI32(){const d=stableSort(Object.keys(this._histogram),((g,w)=>this._histogram[w]-this._histogram[g]));if(d.length===0)return[];let m;switch(this._method){case 1:const g=Math.min(d.length,this._initColors),w=d[g-1],$=this._histogram[w];m=d.slice(0,g);let I=g;const D=d.length;for(;I<D&&this._histogram[d[I]]===$;)m.push(d[I++]);this._hueStats.injectIntoArray(m);break;case 2:m=d;break;default:throw new Error("Incorrect method")}return m.map((g=>+g))}_colorStats1D(d){const m=this._histogram,g=d.getPointArray(),w=g.length;for(let $=0;$<w;$++){const I=g[$].uint32;this._hueStats.check(I),I in m?m[I]++:m[I]=1}}_colorStats2D(d){const m=d.getWidth(),g=d.getHeight(),w=d.getPointArray(),$=_ColorHistogram._boxSize[0],I=_ColorHistogram._boxSize[1],D=$*I,F=this._makeBoxes(m,g,$,I),U=this._histogram;F.forEach((q=>{let j=Math.round(q.w*q.h/D)*_ColorHistogram._boxPixels;j<2&&(j=2);const G={};this._iterateBox(q,m,(H=>{const V=w[H].uint32;this._hueStats.check(V),V in U?U[V]++:V in G?++G[V]>=j&&(U[V]=G[V]):G[V]=1}))})),this._hueStats.injectIntoDictionary(U)}_iterateBox(d,m,g){const w=d,$=w.y*m+w.x,I=(w.y+w.h-1)*m+(w.x+w.w-1),D=m-w.w+1;let F=0,U=$;do g.call(this,U),U+=++F%w.w==0?D:1;while(U<=I)}_makeBoxes(d,m,g,w){const $=d%g,I=m%w,D=d-$,F=m-I,U=[];for(let q=0;q<m;q+=w)for(let j=0;j<d;j+=g)U.push({x:j,y:q,w:j===D?$:g,h:q===F?I:w});return U}},ColorHistogram=_ColorHistogram;__publicField(ColorHistogram,"_boxSize",[64,64]),__publicField(ColorHistogram,"_boxPixels",2),__publicField(ColorHistogram,"_hueGroups",10);var RemovedColor=class{constructor(d,m,g){__publicField(this,"index"),__publicField(this,"color"),__publicField(this,"distance"),this.index=d,this.color=m,this.distance=g}},RGBQuant=class extends AbstractPaletteQuantizer{constructor(d,m=256,g=2){super(),__publicField(this,"_colors"),__publicField(this,"_initialDistance"),__publicField(this,"_distanceIncrement"),__publicField(this,"_histogram"),__publicField(this,"_distance"),this._distance=d,this._colors=m,this._histogram=new ColorHistogram(g,m),this._initialDistance=.01,this._distanceIncrement=.005}sample(d){this._histogram.sample(d)}*quantize(){const d=this._histogram.getImportanceSortedColorsIDXI32();if(d.length===0)throw new Error("No colors in image");yield*this._buildPalette(d)}*_buildPalette(d){const m=new Palette,g=m.getPointContainer().getPointArray(),w=new Array(d.length);for(let j=0;j<d.length;j++)g.push(Point.createByUint32(d[j])),w[j]=1;const $=g.length,I=[];let D=$,F=this._initialDistance;const U=new ProgressTracker(D-this._colors,99);for(;D>this._colors;){I.length=0;for(let j=0;j<$;j++){if(U.shouldNotify($-D)&&(yield{progress:U.progress}),w[j]===0)continue;const G=g[j];for(let H=j+1;H<$;H++){if(w[H]===0)continue;const V=g[H],Z=this._distance.calculateNormalized(G,V);Z<F&&(I.push(new RemovedColor(H,V,Z)),w[H]=0,D--)}}F+=D>3*this._colors?this._initialDistance:this._distanceIncrement}if(D<this._colors){stableSort(I,((G,H)=>H.distance-G.distance));let j=0;for(;D<this._colors&&j<I.length;)w[I[j].index]=1,D++,j++}let q=g.length;for(let j=q-1;j>=0;j--)w[j]===0&&(j!==q-1&&(g[j]=g[q-1]),--q);g.length=q,m.sort(),yield{palette:m,progress:100}}};function createArray1D(d){const m=[];for(let g=0;g<d;g++)m[g]=0;return m}function createArray4D(d,m,g,w){const $=new Array(d);for(let I=0;I<d;I++){$[I]=new Array(m);for(let D=0;D<m;D++){$[I][D]=new Array(g);for(let F=0;F<g;F++){$[I][D][F]=new Array(w);for(let U=0;U<w;U++)$[I][D][F][U]=0}}}return $}function createArray3D(d,m,g){const w=new Array(d);for(let $=0;$<d;$++){w[$]=new Array(m);for(let I=0;I<m;I++){w[$][I]=new Array(g);for(let D=0;D<g;D++)w[$][I][D]=0}}return w}function fillArray3D(d,m,g,w,$){for(let I=0;I<m;I++){d[I]=[];for(let D=0;D<g;D++){d[I][D]=[];for(let F=0;F<w;F++)d[I][D][F]=$}}}function fillArray1D(d,m,g){for(let w=0;w<m;w++)d[w]=g}var WuColorCube=class{constructor(){__publicField(this,"redMinimum"),__publicField(this,"redMaximum"),__publicField(this,"greenMinimum"),__publicField(this,"greenMaximum"),__publicField(this,"blueMinimum"),__publicField(this,"blueMaximum"),__publicField(this,"volume"),__publicField(this,"alphaMinimum"),__publicField(this,"alphaMaximum")}},_WuQuant=class extends AbstractPaletteQuantizer{constructor(d,m=256,g=5){super(),__publicField(this,"_reds"),__publicField(this,"_greens"),__publicField(this,"_blues"),__publicField(this,"_alphas"),__publicField(this,"_sums"),__publicField(this,"_weights"),__publicField(this,"_momentsRed"),__publicField(this,"_momentsGreen"),__publicField(this,"_momentsBlue"),__publicField(this,"_momentsAlpha"),__publicField(this,"_moments"),__publicField(this,"_table"),__publicField(this,"_pixels"),__publicField(this,"_cubes"),__publicField(this,"_colors"),__publicField(this,"_significantBitsPerChannel"),__publicField(this,"_maxSideIndex"),__publicField(this,"_alphaMaxSideIndex"),__publicField(this,"_sideSize"),__publicField(this,"_alphaSideSize"),__publicField(this,"_distance"),this._distance=d,this._setQuality(g),this._initialize(m)}sample(d){const m=d.getPointArray();for(let g=0,w=m.length;g<w;g++)this._addColor(m[g]);this._pixels=this._pixels.concat(m)}*quantize(){yield*this._preparePalette();const d=new Palette;for(let m=0;m<this._colors;m++)if(this._sums[m]>0){const g=this._sums[m],w=this._reds[m]/g,$=this._greens[m]/g,I=this._blues[m]/g,D=this._alphas[m]/g,F=Point.createByRGBA(0|w,0|$,0|I,0|D);d.add(F)}d.sort(),yield{palette:d,progress:100}}*_preparePalette(){yield*this._calculateMoments();let d=0;const m=createArray1D(this._colors);for(let D=1;D<this._colors;++D){this._cut(this._cubes[d],this._cubes[D])?(m[d]=this._cubes[d].volume>1?this._calculateVariance(this._cubes[d]):0,m[D]=this._cubes[D].volume>1?this._calculateVariance(this._cubes[D]):0):(m[d]=0,D--),d=0;let F=m[0];for(let U=1;U<=D;++U)m[U]>F&&(F=m[U],d=U);if(F<=0){this._colors=D+1;break}}const g=[],w=[],$=[],I=[];for(let D=0;D<this._colors;++D){const F=_WuQuant._volume(this._cubes[D],this._weights);F>0?(g[D]=_WuQuant._volume(this._cubes[D],this._momentsRed)/F|0,w[D]=_WuQuant._volume(this._cubes[D],this._momentsGreen)/F|0,$[D]=_WuQuant._volume(this._cubes[D],this._momentsBlue)/F|0,I[D]=_WuQuant._volume(this._cubes[D],this._momentsAlpha)/F|0):(g[D]=0,w[D]=0,$[D]=0,I[D]=0)}this._reds=createArray1D(this._colors+1),this._greens=createArray1D(this._colors+1),this._blues=createArray1D(this._colors+1),this._alphas=createArray1D(this._colors+1),this._sums=createArray1D(this._colors+1);for(let D=0,F=this._pixels.length;D<F;D++){const U=this._pixels[D];let q=-1,j=Number.MAX_VALUE;for(let G=0;G<this._colors;G++){const H=g[G],V=w[G],Z=$[G],Q=I[G],J=this._distance.calculateRaw(H,V,Z,Q,U.r,U.g,U.b,U.a);J<j&&(j=J,q=G)}this._reds[q]+=U.r,this._greens[q]+=U.g,this._blues[q]+=U.b,this._alphas[q]+=U.a,this._sums[q]++}}_addColor(d){const m=8-this._significantBitsPerChannel,g=1+(d.r>>m),w=1+(d.g>>m),$=1+(d.b>>m),I=1+(d.a>>m);this._weights[I][g][w][$]++,this._momentsRed[I][g][w][$]+=d.r,this._momentsGreen[I][g][w][$]+=d.g,this._momentsBlue[I][g][w][$]+=d.b,this._momentsAlpha[I][g][w][$]+=d.a,this._moments[I][g][w][$]+=this._table[d.r]+this._table[d.g]+this._table[d.b]+this._table[d.a]}*_calculateMoments(){const d=[],m=[],g=[],w=[],$=[],I=[],D=createArray3D(this._sideSize,this._sideSize,this._sideSize),F=createArray3D(this._sideSize,this._sideSize,this._sideSize),U=createArray3D(this._sideSize,this._sideSize,this._sideSize),q=createArray3D(this._sideSize,this._sideSize,this._sideSize),j=createArray3D(this._sideSize,this._sideSize,this._sideSize),G=createArray3D(this._sideSize,this._sideSize,this._sideSize);let H=0;const V=new ProgressTracker(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let Z=1;Z<=this._alphaMaxSideIndex;++Z){fillArray3D(D,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(F,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(U,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(q,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(j,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(G,this._sideSize,this._sideSize,this._sideSize,0);for(let Q=1;Q<=this._maxSideIndex;++Q,++H){V.shouldNotify(H)&&(yield{progress:V.progress}),fillArray1D(d,this._sideSize,0),fillArray1D(m,this._sideSize,0),fillArray1D(g,this._sideSize,0),fillArray1D(w,this._sideSize,0),fillArray1D($,this._sideSize,0),fillArray1D(I,this._sideSize,0);for(let J=1;J<=this._maxSideIndex;++J){let ie=0,re=0,se=0,X=0,ne=0,ce=0;for(let oe=1;oe<=this._maxSideIndex;++oe)ie+=this._weights[Z][Q][J][oe],re+=this._momentsRed[Z][Q][J][oe],se+=this._momentsGreen[Z][Q][J][oe],X+=this._momentsBlue[Z][Q][J][oe],ne+=this._momentsAlpha[Z][Q][J][oe],ce+=this._moments[Z][Q][J][oe],d[oe]+=ie,m[oe]+=re,g[oe]+=se,w[oe]+=X,$[oe]+=ne,I[oe]+=ce,D[Q][J][oe]=D[Q-1][J][oe]+d[oe],F[Q][J][oe]=F[Q-1][J][oe]+m[oe],U[Q][J][oe]=U[Q-1][J][oe]+g[oe],q[Q][J][oe]=q[Q-1][J][oe]+w[oe],j[Q][J][oe]=j[Q-1][J][oe]+$[oe],G[Q][J][oe]=G[Q-1][J][oe]+I[oe],this._weights[Z][Q][J][oe]=this._weights[Z-1][Q][J][oe]+D[Q][J][oe],this._momentsRed[Z][Q][J][oe]=this._momentsRed[Z-1][Q][J][oe]+F[Q][J][oe],this._momentsGreen[Z][Q][J][oe]=this._momentsGreen[Z-1][Q][J][oe]+U[Q][J][oe],this._momentsBlue[Z][Q][J][oe]=this._momentsBlue[Z-1][Q][J][oe]+q[Q][J][oe],this._momentsAlpha[Z][Q][J][oe]=this._momentsAlpha[Z-1][Q][J][oe]+j[Q][J][oe],this._moments[Z][Q][J][oe]=this._moments[Z-1][Q][J][oe]+G[Q][J][oe]}}}}static _volumeFloat(d,m){return m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMaximum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(m[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]-m[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+m[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-m[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]+m[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-m[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum])}static _volume(d,m){return 0|_WuQuant._volumeFloat(d,m)}static _top(d,m,g,w){let $;switch(m){case _WuQuant._alpha:$=w[g][d.redMaximum][d.greenMaximum][d.blueMaximum]-w[g][d.redMaximum][d.greenMinimum][d.blueMaximum]-w[g][d.redMinimum][d.greenMaximum][d.blueMaximum]+w[g][d.redMinimum][d.greenMinimum][d.blueMaximum]-(w[g][d.redMaximum][d.greenMaximum][d.blueMinimum]-w[g][d.redMaximum][d.greenMinimum][d.blueMinimum]-w[g][d.redMinimum][d.greenMaximum][d.blueMinimum]+w[g][d.redMinimum][d.greenMinimum][d.blueMinimum]);break;case _WuQuant._red:$=w[d.alphaMaximum][g][d.greenMaximum][d.blueMaximum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMaximum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMaximum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMaximum]-(w[d.alphaMaximum][g][d.greenMaximum][d.blueMinimum]-w[d.alphaMaximum][g][d.greenMinimum][d.blueMinimum]-w[d.alphaMinimum][g][d.greenMaximum][d.blueMinimum]+w[d.alphaMinimum][g][d.greenMinimum][d.blueMinimum]);break;case _WuQuant._green:$=w[d.alphaMaximum][d.redMaximum][g][d.blueMaximum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMaximum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMaximum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMaximum]-(w[d.alphaMaximum][d.redMaximum][g][d.blueMinimum]-w[d.alphaMaximum][d.redMinimum][g][d.blueMinimum]-w[d.alphaMinimum][d.redMaximum][g][d.blueMinimum]+w[d.alphaMinimum][d.redMinimum][g][d.blueMinimum]);break;case _WuQuant._blue:$=w[d.alphaMaximum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMaximum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMaximum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMaximum][d.redMinimum][d.greenMinimum][g]-(w[d.alphaMinimum][d.redMaximum][d.greenMaximum][g]-w[d.alphaMinimum][d.redMaximum][d.greenMinimum][g]-w[d.alphaMinimum][d.redMinimum][d.greenMaximum][g]+w[d.alphaMinimum][d.redMinimum][d.greenMinimum][g]);break;default:throw new Error("impossible")}return 0|$}static _bottom(d,m,g){switch(m){case _WuQuant._alpha:return-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant._red:return-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant._green:return-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMaximum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMaximum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMaximum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMaximum]-(-g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);case _WuQuant._blue:return-g[d.alphaMaximum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMaximum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMaximum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMaximum][d.redMinimum][d.greenMinimum][d.blueMinimum]-(-g[d.alphaMinimum][d.redMaximum][d.greenMaximum][d.blueMinimum]+g[d.alphaMinimum][d.redMaximum][d.greenMinimum][d.blueMinimum]+g[d.alphaMinimum][d.redMinimum][d.greenMaximum][d.blueMinimum]-g[d.alphaMinimum][d.redMinimum][d.greenMinimum][d.blueMinimum]);default:return 0}}_calculateVariance(d){const m=_WuQuant._volume(d,this._momentsRed),g=_WuQuant._volume(d,this._momentsGreen),w=_WuQuant._volume(d,this._momentsBlue),$=_WuQuant._volume(d,this._momentsAlpha);return _WuQuant._volumeFloat(d,this._moments)-(m*m+g*g+w*w+$*$)/_WuQuant._volume(d,this._weights)}_maximize(d,m,g,w,$,I,D,F,U){const q=0|_WuQuant._bottom(d,m,this._momentsRed),j=0|_WuQuant._bottom(d,m,this._momentsGreen),G=0|_WuQuant._bottom(d,m,this._momentsBlue),H=0|_WuQuant._bottom(d,m,this._momentsAlpha),V=0|_WuQuant._bottom(d,m,this._weights);let Z=0,Q=-1;for(let J=g;J<w;++J){let ie=q+_WuQuant._top(d,m,J,this._momentsRed),re=j+_WuQuant._top(d,m,J,this._momentsGreen),se=G+_WuQuant._top(d,m,J,this._momentsBlue),X=H+_WuQuant._top(d,m,J,this._momentsAlpha),ne=V+_WuQuant._top(d,m,J,this._weights);if(ne!==0){let ce=ie*ie+re*re+se*se+X*X,oe=ce/ne;ie=$-ie,re=I-re,se=D-se,X=F-X,ne=U-ne,ne!==0&&(ce=ie*ie+re*re+se*se+X*X,oe+=ce/ne,oe>Z&&(Z=oe,Q=J))}}return{max:Z,position:Q}}_cut(d,m){let g;const w=_WuQuant._volume(d,this._momentsRed),$=_WuQuant._volume(d,this._momentsGreen),I=_WuQuant._volume(d,this._momentsBlue),D=_WuQuant._volume(d,this._momentsAlpha),F=_WuQuant._volume(d,this._weights),U=this._maximize(d,_WuQuant._red,d.redMinimum+1,d.redMaximum,w,$,I,D,F),q=this._maximize(d,_WuQuant._green,d.greenMinimum+1,d.greenMaximum,w,$,I,D,F),j=this._maximize(d,_WuQuant._blue,d.blueMinimum+1,d.blueMaximum,w,$,I,D,F),G=this._maximize(d,_WuQuant._alpha,d.alphaMinimum+1,d.alphaMaximum,w,$,I,D,F);if(G.max>=U.max&&G.max>=q.max&&G.max>=j.max){if(g=_WuQuant._alpha,G.position<0)return!1}else g=U.max>=G.max&&U.max>=q.max&&U.max>=j.max?_WuQuant._red:q.max>=G.max&&q.max>=U.max&&q.max>=j.max?_WuQuant._green:_WuQuant._blue;switch(m.redMaximum=d.redMaximum,m.greenMaximum=d.greenMaximum,m.blueMaximum=d.blueMaximum,m.alphaMaximum=d.alphaMaximum,g){case _WuQuant._red:m.redMinimum=d.redMaximum=U.position,m.greenMinimum=d.greenMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant._green:m.greenMinimum=d.greenMaximum=q.position,m.redMinimum=d.redMinimum,m.blueMinimum=d.blueMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant._blue:m.blueMinimum=d.blueMaximum=j.position,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum,m.alphaMinimum=d.alphaMinimum;break;case _WuQuant._alpha:m.alphaMinimum=d.alphaMaximum=G.position,m.blueMinimum=d.blueMinimum,m.redMinimum=d.redMinimum,m.greenMinimum=d.greenMinimum}return d.volume=(d.redMaximum-d.redMinimum)*(d.greenMaximum-d.greenMinimum)*(d.blueMaximum-d.blueMinimum)*(d.alphaMaximum-d.alphaMinimum),m.volume=(m.redMaximum-m.redMinimum)*(m.greenMaximum-m.greenMinimum)*(m.blueMaximum-m.blueMinimum)*(m.alphaMaximum-m.alphaMinimum),!0}_initialize(d){this._colors=d,this._cubes=[];for(let m=0;m<d;m++)this._cubes[m]=new WuColorCube;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let m=0;m<256;++m)this._table[m]=m*m;this._pixels=[]}_setQuality(d=5){this._significantBitsPerChannel=d,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}},WuQuant=_WuQuant;__publicField(WuQuant,"_alpha",3),__publicField(WuQuant,"_red",2),__publicField(WuQuant,"_green",1),__publicField(WuQuant,"_blue",0);var image_exports={};__export(image_exports,{AbstractImageQuantizer:()=>AbstractImageQuantizer,ErrorDiffusionArray:()=>ErrorDiffusionArray,ErrorDiffusionArrayKernel:()=>ErrorDiffusionArrayKernel,ErrorDiffusionRiemersma:()=>ErrorDiffusionRiemersma,NearestColor:()=>NearestColor});var AbstractImageQuantizer=class{quantizeSync(d,m){for(const g of this.quantize(d,m))if(g.pointContainer)return g.pointContainer;throw new Error("unreachable")}},NearestColor=class extends AbstractImageQuantizer{constructor(d){super(),__publicField(this,"_distance"),this._distance=d}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=new ProgressTracker($,99);for(let D=0;D<$;D++){I.shouldNotify(D)&&(yield{progress:I.progress});for(let F=0,U=D*w;F<w;F++,U++){const q=g[U];q.from(m.getNearestColor(this._distance,q))}}yield{pointContainer:d,progress:100}}},ErrorDiffusionArrayKernel=(d=>(d[d.FloydSteinberg=0]="FloydSteinberg",d[d.FalseFloydSteinberg=1]="FalseFloydSteinberg",d[d.Stucki=2]="Stucki",d[d.Atkinson=3]="Atkinson",d[d.Jarvis=4]="Jarvis",d[d.Burkes=5]="Burkes",d[d.Sierra=6]="Sierra",d[d.TwoSierra=7]="TwoSierra",d[d.SierraLite=8]="SierraLite",d))(ErrorDiffusionArrayKernel||{}),ErrorDiffusionArray=class extends AbstractImageQuantizer{constructor(d,m,g=!0,w=0,$=!1){super(),__publicField(this,"_minColorDistance"),__publicField(this,"_serpentine"),__publicField(this,"_kernel"),__publicField(this,"_calculateErrorLikeGIMP"),__publicField(this,"_distance"),this._setKernel(m),this._distance=d,this._minColorDistance=w,this._serpentine=g,this._calculateErrorLikeGIMP=$}*quantize(d,m){const g=d.getPointArray(),w=new Point,$=d.getWidth(),I=d.getHeight(),D=[];let F=1,U=1;for(const j of this._kernel){const G=j[2]+1;U<G&&(U=G)}for(let j=0;j<U;j++)this._fillErrorLine(D[j]=[],$);const q=new ProgressTracker(I,99);for(let j=0;j<I;j++){q.shouldNotify(j)&&(yield{progress:q.progress}),this._serpentine&&(F*=-1);const G=j*$,H=F===1?0:$-1,V=F===1?$:-1;this._fillErrorLine(D[0],$),D.push(D.shift());const Z=D[0];for(let Q=H,J=G+H;Q!==V;Q+=F,J+=F){const ie=g[J],re=Z[Q];w.from(ie);const se=Point.createByRGBA(inRange0to255Rounded(ie.r+re[0]),inRange0to255Rounded(ie.g+re[1]),inRange0to255Rounded(ie.b+re[2]),inRange0to255Rounded(ie.a+re[3])),X=m.getNearestColor(this._distance,se);if(ie.from(X),this._minColorDistance&&this._distance.calculateNormalized(w,X)<this._minColorDistance)continue;let ne,ce,oe,de;this._calculateErrorLikeGIMP?(ne=se.r-X.r,ce=se.g-X.g,oe=se.b-X.b,de=se.a-X.a):(ne=w.r-X.r,ce=w.g-X.g,oe=w.b-X.b,de=w.a-X.a);const me=F===1?0:this._kernel.length-1,ge=F===1?this._kernel.length:-1;for(let fe=me;fe!==ge;fe+=F){const xe=this._kernel[fe][1]*F,Fe=this._kernel[fe][2];if(xe+Q>=0&&xe+Q<$&&Fe+j>=0&&Fe+j<I){const Te=this._kernel[fe][0],Oe=D[Fe][xe+Q];Oe[0]+=ne*Te,Oe[1]+=ce*Te,Oe[2]+=oe*Te,Oe[3]+=de*Te}}}}yield{pointContainer:d,progress:100}}_fillErrorLine(d,m){d.length>m&&(d.length=m);const g=d.length;for(let w=0;w<g;w++){const $=d[w];$[0]=$[1]=$[2]=$[3]=0}for(let w=g;w<m;w++)d[w]=[0,0,0,0]}_setKernel(d){switch(d){case 0:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case 1:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case 2:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case 3:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case 4:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case 5:this._kernel=[[.25,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[.25,0,1],[4/32,1,1],[2/32,2,1]];break;case 6:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case 7:this._kernel=[[.25,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case 8:this._kernel=[[.5,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw new Error(`ErrorDiffusionArray: unknown kernel = ${d}`)}}};function*hilbertCurve(d,m,g){const w=Math.max(d,m),$={width:d,height:m,level:Math.floor(Math.log(w)/Math.log(2)+1),callback:g,tracker:new ProgressTracker(d*m,99),index:0,x:0,y:0};yield*walkHilbert($,1),visit($,0)}function*walkHilbert(d,m){if(!(d.level<1)){switch(d.tracker.shouldNotify(d.index)&&(yield{progress:d.tracker.progress}),d.level--,m){case 2:yield*walkHilbert(d,1),visit(d,3),yield*walkHilbert(d,2),visit(d,4),yield*walkHilbert(d,2),visit(d,2),yield*walkHilbert(d,4);break;case 3:yield*walkHilbert(d,4),visit(d,2),yield*walkHilbert(d,3),visit(d,1),yield*walkHilbert(d,3),visit(d,3),yield*walkHilbert(d,1);break;case 1:yield*walkHilbert(d,2),visit(d,4),yield*walkHilbert(d,1),visit(d,3),yield*walkHilbert(d,1),visit(d,1),yield*walkHilbert(d,3);break;case 4:yield*walkHilbert(d,3),visit(d,1),yield*walkHilbert(d,4),visit(d,2),yield*walkHilbert(d,4),visit(d,4),yield*walkHilbert(d,2)}d.level++}}function visit(d,m){switch(d.x>=0&&d.x<d.width&&d.y>=0&&d.y<d.height&&(d.callback(d.x,d.y),d.index++),m){case 2:d.x--;break;case 3:d.x++;break;case 1:d.y--;break;case 4:d.y++}}var ErrorDiffusionRiemersma=class extends AbstractImageQuantizer{constructor(d,m=16,g=1){super(),__publicField(this,"_distance"),__publicField(this,"_weights"),__publicField(this,"_errorQueueSize"),this._distance=d,this._errorQueueSize=m,this._weights=ErrorDiffusionRiemersma._createWeights(g,m)}*quantize(d,m){const g=d.getPointArray(),w=d.getWidth(),$=d.getHeight(),I=[];let D=0;for(let F=0;F<this._errorQueueSize;F++)I[F]={r:0,g:0,b:0,a:0};yield*hilbertCurve(w,$,((F,U)=>{const q=g[F+U*w];let{r:j,g:G,b:H,a:V}=q;for(let ie=0;ie<this._errorQueueSize;ie++){const re=this._weights[ie],se=I[(ie+D)%this._errorQueueSize];j+=se.r*re,G+=se.g*re,H+=se.b*re,V+=se.a*re}const Z=Point.createByRGBA(inRange0to255Rounded(j),inRange0to255Rounded(G),inRange0to255Rounded(H),inRange0to255Rounded(V)),Q=m.getNearestColor(this._distance,Z);D=(D+1)%this._errorQueueSize;const J=(D+this._errorQueueSize-1)%this._errorQueueSize;I[J].r=q.r-Q.r,I[J].g=q.g-Q.g,I[J].b=q.b-Q.b,I[J].a=q.a-Q.a,q.from(Q)})),yield{pointContainer:d,progress:100}}static _createWeights(d,m){const g=[],w=Math.exp(Math.log(m)/(m-1));for(let $=0,I=1;$<m;$++)g[$]=(I+.5|0)/m*d,I*=w;return g}},quality_exports={};__export(quality_exports,{ssim:()=>ssim});var K1=.01,K2=.03;function ssim(d,m){if(d.getHeight()!==m.getHeight()||d.getWidth()!==m.getWidth())throw new Error("Images have different sizes!");const g=(255*K1)**2,w=(255*K2)**2;let $=0,I=0;return iterate(d,m,((D,F,U,q)=>{let j=0,G=0,H=0;for(let Z=0;Z<D.length;Z++)G+=(D[Z]-U)**2,H+=(F[Z]-q)**2,j+=(D[Z]-U)*(F[Z]-q);const V=D.length-1;G/=V,H/=V,j/=V,I+=(2*U*q+g)*(2*j+w)/((U**2+q**2+g)*(G+H+w)),$++})),I/$}function iterate(d,m,g){const w=d.getWidth(),$=d.getHeight();for(let I=0;I<$;I+=8)for(let D=0;D<w;D+=8){const F=Math.min(8,w-D),U=Math.min(8,$-I),q=calculateLumaValuesForWindow(d,D,I,F,U),j=calculateLumaValuesForWindow(m,D,I,F,U);g(q,j,calculateAverageLuma(q),calculateAverageLuma(j))}}function calculateLumaValuesForWindow(d,m,g,w,$){const I=d.getPointArray(),D=[];let F=0;for(let U=g;U<g+$;U++){const q=U*d.getWidth();for(let j=m;j<m+w;j++){const G=I[q+j];D[F]=.2126*G.r+.7152*G.g+.0722*G.b,F++}}return D}function calculateAverageLuma(d){let m=0;for(const g of d)m+=g;return m/d.length}function buildPaletteSync(d,{colorDistanceFormula:m,paletteQuantization:g,colors:w}={}){const $=paletteQuantizationToPaletteQuantizer(colorDistanceFormulaToColorDistance(m),g,w);return d.forEach((I=>$.sample(I))),$.quantizeSync()}function applyPaletteSync(d,m,{colorDistanceFormula:g,imageQuantization:w}={}){return imageQuantizationToImageQuantizer(colorDistanceFormulaToColorDistance(g),w).quantizeSync(d,m)}function colorDistanceFormulaToColorDistance(d="euclidean-bt709"){switch(d){case"cie94-graphic-arts":return new CIE94GraphicArts;case"cie94-textiles":return new CIE94Textiles;case"ciede2000":return new CIEDE2000;case"color-metric":return new CMetric;case"euclidean":return new Euclidean;case"euclidean-bt709":return new EuclideanBT709;case"euclidean-bt709-noalpha":return new EuclideanBT709NoAlpha;case"manhattan":return new Manhattan;case"manhattan-bt709":return new ManhattanBT709;case"manhattan-nommyde":return new ManhattanNommyde;case"pngquant":return new PNGQuant;default:throw new Error(`Unknown colorDistanceFormula ${d}`)}}function imageQuantizationToImageQuantizer(d,m="floyd-steinberg"){switch(m){case"nearest":return new NearestColor(d);case"riemersma":return new ErrorDiffusionRiemersma(d);case"floyd-steinberg":return new ErrorDiffusionArray(d,0);case"false-floyd-steinberg":return new ErrorDiffusionArray(d,1);case"stucki":return new ErrorDiffusionArray(d,2);case"atkinson":return new ErrorDiffusionArray(d,3);case"jarvis":return new ErrorDiffusionArray(d,4);case"burkes":return new ErrorDiffusionArray(d,5);case"sierra":return new ErrorDiffusionArray(d,6);case"two-sierra":return new ErrorDiffusionArray(d,7);case"sierra-lite":return new ErrorDiffusionArray(d,8);default:throw new Error(`Unknown imageQuantization ${m}`)}}function paletteQuantizationToPaletteQuantizer(d,m="wuquant",g=256){switch(m){case"neuquant":return new NeuQuant(d,g);case"rgbquant":return new RGBQuant(d,g);case"wuquant":return new WuQuant(d,g);case"neuquant-float":return new NeuQuantFloat(d,g);default:throw new Error(`Unknown paletteQuantization ${m}`)}}/**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cie94.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ciede2000.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * cmetric.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * common.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * constants.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ditherErrorDiffusionArray.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * euclidean.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * helper.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * hueStatistics.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * iq.ts - Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2rgb.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * lab2xyz.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * manhattanNeuQuant.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * nearestColor.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * palette.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pngQuant.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * point.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * pointContainer.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2hsl.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2lab.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgb2xyz.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * ssim.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * wuQuant.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2lab.ts - part of Image Quantization Library
 *//**
 * @preserve
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * xyz2rgb.ts - part of Image Quantization Library
 *//**
 * @preserve
 * MIT License
 *
 * Copyright 2015-2018 Igor Bezkrovnyi
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * riemersma.ts - part of Image Quantization Library
 *//**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * colorHistogram.ts - part of Image Quantization Library
 *//**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * neuquant.ts - part of Image Quantization Library
 *//**
 * @preserve TypeScript port:
 * Copyright 2015-2018 Igor Bezkrovnyi
 * All rights reserved. (MIT Licensed)
 *
 * rgbquant.ts - part of Image Quantization Library
 */typeof setImmediate=="function"?setImmediate:typeof process<"u"&&process?.nextTick;const QuantizeOptionsSchema=z.object({colors:z.number().optional(),colorDistanceFormula:z.union([z.literal("cie94-textiles"),z.literal("cie94-graphic-arts"),z.literal("ciede2000"),z.literal("color-metric"),z.literal("euclidean"),z.literal("euclidean-bt709-noalpha"),z.literal("euclidean-bt709"),z.literal("manhattan"),z.literal("manhattan-bt709"),z.literal("manhattan-nommyde"),z.literal("pngquant")]).optional(),paletteQuantization:z.union([z.literal("neuquant"),z.literal("neuquant-float"),z.literal("rgbquant"),z.literal("wuquant")]).optional(),imageQuantization:z.union([z.literal("nearest"),z.literal("riemersma"),z.literal("floyd-steinberg"),z.literal("false-floyd-steinberg"),z.literal("stucki"),z.literal("atkinson"),z.literal("jarvis"),z.literal("burkes"),z.literal("sierra"),z.literal("two-sierra"),z.literal("sierra-lite")]).optional()}),methods={quantize(d,m){const{colors:g,colorDistanceFormula:w,paletteQuantization:$,imageQuantization:I}=QuantizeOptionsSchema.parse(m),D=utils_exports.PointContainer.fromUint8Array(d.bitmap.data,d.bitmap.width,d.bitmap.height),F=applyPaletteSync(D,buildPaletteSync([D],{colors:g,colorDistanceFormula:w,paletteQuantization:$}),{colorDistanceFormula:w,imageQuantization:I});return d.bitmap.data=Buffer.from(F.toUint8Array()),d}};var parseBmfontAscii=function(d){if(!d)throw new Error("no data provided");var m={pages:[],chars:[],kernings:[]},g=(d=d.toString().trim()).split(/\r\n?|\n/g);if(g.length===0)throw new Error("no data in BMFont file");for(var w=0;w<g.length;w++){var $=splitLine(g[w],w);if($)if($.key==="page"){if(typeof $.data.id!="number")throw new Error("malformed file at line "+w+" -- needs page id=N");if(typeof $.data.file!="string")throw new Error("malformed file at line "+w+' -- needs page file="path"');m.pages[$.data.id]=$.data.file}else $.key==="chars"||$.key==="kernings"||($.key==="char"?m.chars.push($.data):$.key==="kerning"?m.kernings.push($.data):m[$.key]=$.data)}return m};function splitLine(d,m){if(!(d=d.replace(/\t+/g," ").trim()))return null;var g=d.indexOf(" ");if(g===-1)throw new Error("no named row at line "+m);var w=d.substring(0,g);d=(d=(d=(d=d.substring(g+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map((function(U){return U.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)}));for(var $=[],I=0;I<d.length;I++){var D=d[I];I===0?$.push({key:D[0],data:""}):I===d.length-1?$[$.length-1].data=parseData(D[0]):($[$.length-1].data=parseData(D[0]),$.push({key:D[1],data:""}))}var F={key:w,data:{}};return $.forEach((function(U){F.data[U.key]=U.data})),F}function parseData(d){return d&&d.length!==0?d.indexOf('"')===0||d.indexOf("'")===0?d.substring(1,d.length-1):d.indexOf(",")!==-1?parseIntList$1(d):parseInt(d,10):""}function parseIntList$1(d){return d.split(",").map((function(m){return parseInt(m,10)}))}getDefaultExportFromCjs(parseBmfontAscii);var GLYPH_DESIGNER_ERROR="chasrset",parseAttribs=function(d){for(var m in d=Object.assign({},d),GLYPH_DESIGNER_ERROR in d&&(d.charset=d[GLYPH_DESIGNER_ERROR],delete d[GLYPH_DESIGNER_ERROR]),d)m!=="face"&&m!=="charset"&&(d[m]=m==="padding"||m==="spacing"?parseIntList(d[m]):parseInt(d[m],10));return d};function parseIntList(d){return d.split(",").map((function(m){return parseInt(m,10)}))}var xmlParseFromString=self.DOMParser!==void 0?function(d){return new self.DOMParser().parseFromString(d,"application/xml")}:self.ActiveXObject!==void 0&&new self.ActiveXObject("Microsoft.XMLDOM")?function(d){var m=new self.ActiveXObject("Microsoft.XMLDOM");return m.async="false",m.loadXML(d),m}:function(d){var m=document.createElement("div");return m.innerHTML=d,m},parseAttributes=parseAttribs,parseFromString=xmlParseFromString,NAME_MAP={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"},browser=function(d){d=d.toString();var m=parseFromString(d),g={pages:[],chars:[],kernings:[]};["info","common"].forEach((function(q){var j=m.getElementsByTagName(q)[0];j&&(g[q]=parseAttributes(getAttribs(j)))}));var w=m.getElementsByTagName("pages")[0];if(!w)throw new Error("malformed file -- no <pages> element");for(var $=w.getElementsByTagName("page"),I=0;I<$.length;I++){var D=$[I],F=parseInt(D.getAttribute("id"),10),U=D.getAttribute("file");if(isNaN(F))throw new Error('malformed file -- page "id" attribute is NaN');if(!U)throw new Error('malformed file -- needs page "file" attribute');g.pages[parseInt(F,10)]=U}return["chars","kernings"].forEach((function(q){var j=m.getElementsByTagName(q)[0];if(j)for(var G=q.substring(0,q.length-1),H=j.getElementsByTagName(G),V=0;V<H.length;V++){var Z=H[V];g[q].push(parseAttributes(getAttribs(Z)))}})),g};function getAttribs(d){return getAttribList(d).reduce((function(m,g){return m[mapName(g.nodeName)]=g.nodeValue,m}),{})}function getAttribList(d){for(var m=[],g=0;g<d.attributes.length;g++)m.push(d.attributes[g]);return m}function mapName(d){return NAME_MAP[d.toLowerCase()]||d}getDefaultExportFromCjs(browser);var HEADER$1=[66,77,70],parseBmfontBinary=function(d){if(d.length<6)throw new Error("invalid buffer length for BMFont");var m=HEADER$1.every((function(I,D){return d.readUInt8(D)===I}));if(!m)throw new Error("BMFont missing BMF byte header");var g=3;if(d.readUInt8(g++)>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var w={kernings:[],chars:[]},$=0;$<5;$++)g+=readBlock(w,d,g);return w};function readBlock(d,m,g){if(g>m.length-1)return 0;var w=m.readUInt8(g++),$=m.readInt32LE(g);switch(g+=4,w){case 1:d.info=readInfo(m,g);break;case 2:d.common=readCommon(m,g);break;case 3:d.pages=readPages(m,g,$);break;case 4:d.chars=readChars(m,g,$);break;case 5:d.kernings=readKernings(m,g,$)}return 5+$}function readInfo(d,m){var g={};g.size=d.readInt16LE(m);var w=d.readUInt8(m+2);return g.smooth=w>>7&1,g.unicode=w>>6&1,g.italic=w>>5&1,g.bold=w>>4&1,w>>3&1&&(g.fixedHeight=1),g.charset=d.readUInt8(m+3)||"",g.stretchH=d.readUInt16LE(m+4),g.aa=d.readUInt8(m+6),g.padding=[d.readInt8(m+7),d.readInt8(m+8),d.readInt8(m+9),d.readInt8(m+10)],g.spacing=[d.readInt8(m+11),d.readInt8(m+12)],g.outline=d.readUInt8(m+13),g.face=readStringNT(d,m+14),g}function readCommon(d,m){var g={};return g.lineHeight=d.readUInt16LE(m),g.base=d.readUInt16LE(m+2),g.scaleW=d.readUInt16LE(m+4),g.scaleH=d.readUInt16LE(m+6),g.pages=d.readUInt16LE(m+8),d.readUInt8(m+10),g.packed=0,g.alphaChnl=d.readUInt8(m+11),g.redChnl=d.readUInt8(m+12),g.greenChnl=d.readUInt8(m+13),g.blueChnl=d.readUInt8(m+14),g}function readPages(d,m,g){for(var w=[],$=readNameNT(d,m),I=$.length+1,D=g/I,F=0;F<D;F++)w[F]=d.slice(m,m+$.length).toString("utf8"),m+=I;return w}function readChars(d,m,g){for(var w=[],$=g/20,I=0;I<$;I++){var D={},F=20*I;D.id=d.readUInt32LE(m+0+F),D.x=d.readUInt16LE(m+4+F),D.y=d.readUInt16LE(m+6+F),D.width=d.readUInt16LE(m+8+F),D.height=d.readUInt16LE(m+10+F),D.xoffset=d.readInt16LE(m+12+F),D.yoffset=d.readInt16LE(m+14+F),D.xadvance=d.readInt16LE(m+16+F),D.page=d.readUInt8(m+18+F),D.chnl=d.readUInt8(m+19+F),w[I]=D}return w}function readKernings(d,m,g){for(var w=[],$=g/10,I=0;I<$;I++){var D={},F=10*I;D.first=d.readUInt32LE(m+0+F),D.second=d.readUInt32LE(m+4+F),D.amount=d.readInt16LE(m+8+F),w[I]=D}return w}function readNameNT(d,m){for(var g=m;g<d.length&&d[g]!==0;g++);return d.slice(m,g)}function readStringNT(d,m){return readNameNT(d,m).toString("utf8")}getDefaultExportFromCjs(parseBmfontBinary);function e(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}const t=d=>{if(!d)return null;const m={};switch(d.type){case"ELEMENT":{let g={};const w=E(d.value.attributes),$=t(d.value.children);if(w&&(g=Object.assign(g,w)),$){const I=r(d.value.children);g=Object.assign(g,I)}m[d.value.type]=g;break}case"ATTRIBUTE":{const g=d.value;m[g.name]=g.value;break}case"CONTENT":return{content:d.value}}return m},r=d=>d&&Array.isArray(d)&&d.length!==0?n(d)?{content:d[0].value}:{children:d.map(t)}:null,n=d=>d&&Array.isArray(d)&&d.length===1&&d[0].type==="CONTENT",E=d=>d&&Array.isArray(d)?d.map(t).reduce(((m,g)=>Object.assign(m,g)),{}):null;var s={convert:d=>t(d.value.children[0])},a={Token:(d,m)=>({type:d,value:m}),TOKEN_TYPE:{OPEN_BRACKET:"OPEN_BRACKET",ELEMENT_TYPE:"ELEMENT_TYPE",CLOSE_ELEMENT:"CLOSE_ELEMENT",ATTRIB_NAME:"ATTRIB_NAME",ATTRIB_VALUE:"ATTRIB_VALUE",ASSIGN:"ASSIGN",CLOSE_BRACKET:"CLOSE_BRACKET",CONTENT:"CONTENT",EOF:"EOF"}};const{Token:T,TOKEN_TYPE:u}=a,c=T("EOF"),l=d=>d===" "||d===`
`||d==="\r"||d==="	",o=d=>d.replace(/'/g,'"');var N={createLexer:function(d){let m=null,g=(G=>{let H=0;for(;H<G.length&&l(G[H]);)H++;return((V,Z)=>{if(V.startsWith("<?xml",Z)){const Q=V.length;for(;Z<Q;)if(V[Z]!=="?")Z++;else{if(V[Z+1]===">")return Z+2;Z++}}return Z})(G,H)})(d),w=[];const $=()=>d[g],I=()=>m!==c&&g<d.length,D=G=>G==='"'||G==="'",F=()=>{for(;I()&&l(d[g]);)g++},U=G=>{if(I()){if(d[g]==="<"){let H="<";return g++,I()&&d[g]==="/"?(g++,H="</"):I()&&d[g]==="!"&&d[g+1]==="-"&&d[g+2]==="-"&&(g++,g++,g++,H="<!--"),H}if($()==="/"){let H="/";return g++,I()&&$()===">"&&(g++,H="/>"),H}if(d[g]==="="||d[g]===">"){const H=d[g];return g++,H}}return q(!!G)},q=G=>{const H=G?/[^>=<]/u:/[a-zA-Z0-9_:-]/;let V=g;for(;I()&&d[g].match(H);)g++;return o(d.substring(V,g))},j=()=>{const G=g;F();const H=g-G;if(I())if(m&&m.type===u.OPEN_BRACKET){F();const V=U(!1);m=T(u.ELEMENT_TYPE,V),w.push(V)}else if(m&&m.type===u.ASSIGN){I()&&D($())&&g++;let V=g;for(;I()&&!D($());)g++;const Z=o(d.substring(V,g));g++,m=T(u.ATTRIB_VALUE,Z)}else{F();let V=U(!0);switch(V){case"=":m=m.type===u.ATTRIB_NAME?T(u.ASSIGN):T(u.CONTENT,V);break;case"</":{const Z=g;for(;d[g]!==">";)g++;m=T(u.CLOSE_ELEMENT,d.substring(Z,g)),g++,w.pop();break}case"/>":{const Z=w.pop();m=T(u.CLOSE_ELEMENT,Z);break}case"<!--":{const Z=["!","-","-"];for(;I()&&(Z[2]!==">"||Z[1]!=="-"||Z[0]!=="-");)Z.shift(),Z.push(d[g]),g++;return j()}case">":m=T(u.CLOSE_BRACKET);break;case"<":m=T(u.OPEN_BRACKET);break;default:if(V&&V.length>0){if(m.type===u.CLOSE_BRACKET){let Z="";$()!=="<"&&(Z=q(!0)),m=T(u.CONTENT,V+Z)}else if(m.type!==u.ATTRIB_NAME&&m.type!==u.CONTENT)m.type===u.CLOSE_ELEMENT?(V=" ".repeat(H)+V,m=T(u.CONTENT,V)):m=T(u.ATTRIB_NAME,V);else{const Z=" ".repeat(H)+V;m=T(u.CONTENT,Z)}break}{const Z='Unknown Syntax : "'+d[g]+'"';throw new Error(Z)}}}else m=c;return m};return{peek:$,next:j,hasNext:I}}};const{createLexer:i}=N,{Token:p,TOKEN_TYPE:O}=a,[A,f,C,h]=["ROOT","ELEMENT","ATTRIBUTE","CONTENT"],_=(d,m)=>({type:d,value:m}),L=d=>_(h,d),y=(d,m,g)=>_(f,{type:d,attributes:m,children:g}),v=(d,m)=>_(C,{name:d,value:m}),S=(d,m)=>{const g=[];for(;d.hasNext();){const w=d.next();switch(w.type){case O.OPEN_BRACKET:{const $=d.next(),[I,D]=R(d);let F=[];D.type!==O.CLOSE_ELEMENT&&(F=S(d,$)),F&&F.length>0&&F[0].type===O.CONTENT&&(F=b(F)),g.push(y($.value,I,F));break}case O.CLOSE_ELEMENT:if(w.value===m.value)return g;break;case O.CONTENT:g.push(L(w.value));break;case O.EOF:return g;default:throw new Error(`Unknown Lexem type: ${w.type} "${w.value}, scoping element: ${m.value}"`)}}return g},R=d=>{const m=[];let g=d.peek();if(!d.hasNext()||g&&g.type===O.CLOSE_BRACKET||g&&g.type===O.CLOSE_ELEMENT)return[m,g];for(g=d.next();d.hasNext()&&g&&g.type!==O.CLOSE_BRACKET&&g.type!==O.CLOSE_ELEMENT;){const w=g;d.next();const $=d.next(),I=v(w.value,$.value);m.push(I),g=d.next()}return[m,g]};function b(d){let m=[],g="";return d.forEach((w=>{w.type===O.CONTENT?g+=w.value:(g.length&&(m.push(L(g)),g=""),m.push(w))})),g.length&&m.push(L(g)),m}var B={transpile:function(d,m){const g=(w=>_(A,{children:S(w,p(A,"ROOT"))}))(i(d));return m?m.convert(g):g}};const M=s,{transpile:x}=B;var k=e({convertXML:function(d,m){return x(d,m||M)},createAST:function(d){return x(d)}}),simpleXmlToJson_min=k,xmlPackage=getDefaultExportFromCjs(simpleXmlToJson_min);const{convertXML}=xmlPackage;createJimp({formats:[png]});Buffer.from([66,77,70,3]);var pixelmatch_1=pixelmatch;const defaultOptions={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffColorAlt:null,diffMask:!1};function pixelmatch(d,m,g,w,$,I){if(!isPixelData(d)||!isPixelData(m)||g&&!isPixelData(g))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(d.length!==m.length||g&&g.length!==d.length)throw new Error("Image sizes do not match.");if(d.length!==w*$*4)throw new Error("Image data size does not match width/height.");I=Object.assign({},defaultOptions,I);const D=w*$,F=new Uint32Array(d.buffer,d.byteOffset,D),U=new Uint32Array(m.buffer,m.byteOffset,D);let q=!0;for(let H=0;H<D;H++)if(F[H]!==U[H]){q=!1;break}if(q){if(g&&!I.diffMask)for(let H=0;H<D;H++)drawGrayPixel(d,4*H,I.alpha,g);return 0}const j=35215*I.threshold*I.threshold;let G=0;for(let H=0;H<$;H++)for(let V=0;V<w;V++){const Z=4*(H*w+V),Q=colorDelta(d,m,Z,Z);Math.abs(Q)>j?I.includeAA||!antialiased(d,V,H,w,$,m)&&!antialiased(m,V,H,w,$,d)?(g&&drawPixel(g,Z,...Q<0&&I.diffColorAlt||I.diffColor),G++):g&&!I.diffMask&&drawPixel(g,Z,...I.aaColor):g&&(I.diffMask||drawGrayPixel(d,Z,I.alpha,g))}return G}function isPixelData(d){return ArrayBuffer.isView(d)&&d.constructor.BYTES_PER_ELEMENT===1}function antialiased(d,m,g,w,$,I){const D=Math.max(m-1,0),F=Math.max(g-1,0),U=Math.min(m+1,w-1),q=Math.min(g+1,$-1),j=4*(g*w+m);let G,H,V,Z,Q=m===D||m===U||g===F||g===q?1:0,J=0,ie=0;for(let re=D;re<=U;re++)for(let se=F;se<=q;se++){if(re===m&&se===g)continue;const X=colorDelta(d,d,j,4*(se*w+re),!0);if(X===0){if(Q++,Q>2)return!1}else X<J?(J=X,G=re,H=se):X>ie&&(ie=X,V=re,Z=se)}return J!==0&&ie!==0&&(hasManySiblings(d,G,H,w,$)&&hasManySiblings(I,G,H,w,$)||hasManySiblings(d,V,Z,w,$)&&hasManySiblings(I,V,Z,w,$))}function hasManySiblings(d,m,g,w,$){const I=Math.max(m-1,0),D=Math.max(g-1,0),F=Math.min(m+1,w-1),U=Math.min(g+1,$-1),q=4*(g*w+m);let j=m===I||m===F||g===D||g===U?1:0;for(let G=I;G<=F;G++)for(let H=D;H<=U;H++){if(G===m&&H===g)continue;const V=4*(H*w+G);if(d[q]===d[V]&&d[q+1]===d[V+1]&&d[q+2]===d[V+2]&&d[q+3]===d[V+3]&&j++,j>2)return!0}return!1}function colorDelta(d,m,g,w,$){let I=d[g+0],D=d[g+1],F=d[g+2],U=d[g+3],q=m[w+0],j=m[w+1],G=m[w+2],H=m[w+3];if(U===H&&I===q&&D===j&&F===G)return 0;U<255&&(U/=255,I=blend(I,U),D=blend(D,U),F=blend(F,U)),H<255&&(H/=255,q=blend(q,H),j=blend(j,H),G=blend(G,H));const V=rgb2y(I,D,F),Z=rgb2y(q,j,G),Q=V-Z;if($)return Q;const J=rgb2i(I,D,F)-rgb2i(q,j,G),ie=rgb2q(I,D,F)-rgb2q(q,j,G),re=.5053*Q*Q+.299*J*J+.1957*ie*ie;return V>Z?-re:re}function rgb2y(d,m,g){return .29889531*d+.58662247*m+.11448223*g}function rgb2i(d,m,g){return .59597799*d-.2741761*m-.32180189*g}function rgb2q(d,m,g){return .21147017*d-.52261711*m+.31114694*g}function blend(d,m){return 255+(d-255)*m}function drawPixel(d,m,g,w,$){d[m+0]=g,d[m+1]=w,d[m+2]=$,d[m+3]=255}function drawGrayPixel(d,m,g,w){const $=blend(rgb2y(d[m+0],d[m+1],d[m+2]),g*d[m+3]/255);drawPixel(w,m,$,$,$)}getDefaultExportFromCjs(pixelmatch_1);const defaultPlugins=[methods$h,methods$g,methods$f,methods$e,methods$c,methods$a,methods$b,methods$9,methods$8,methods$7,methods$6,methods$5,methods$4,methods$3,methods$d,methods$2,methods$1,methods],defaultFormats=[bmp,msBmp,gif,jpeg$2,png,tiff];bmp().mime,gif().mime,jpeg$2().mime,png().mime,tiff().mime;const Jimp=createJimp({formats:defaultFormats,plugins:defaultPlugins}),imageLimits={maxMemoryUsageInMB:1024,maxResolutionInMP:100};async function preprocessTensor(d,m,g,w,$){const{width:I,height:D,normalized:F}=d.input;let U=m;return U=await normalizeTensor(U,g,w,!F,$),U=await resizeTensor(U,I,D,$),U}async function loadToTensor(d,{width:m,height:g,crop:w,normalized:$,abortSignal:I}){var D=new Float32Array(g*m*3*d.length);for(let q=0;q<d.length;q++){I?.throwIfAborted();let j=d[q];const G=await Jimp.fromBuffer(j,{"image/jpeg":imageLimits});if(w){const re=coordsScaler({x:G.width,y:G.height}),{x:se,y:X,height:ne,width:ce}=toTopLeftCoords(re(w));I?.throwIfAborted(),G.crop({x:se,y:X,w:ce,h:ne})}I?.throwIfAborted(),G.resize({w:m,h:g});var F=G.bitmap.data;const[H,V,Z]=new Array(new Array,new Array,new Array);for(let re=0;re<F.length;re+=4)I?.throwIfAborted(),H.push(F[re]),V.push(F[re+1]),Z.push(F[re+2]);const Q=H.concat(V).concat(Z);let J,ie=Q.length;if($)for(J=0;J<ie;J++)I?.throwIfAborted(),D[q*ie+J]=Q[J]/255}I?.throwIfAborted();var U=new qe("float32",D,[d.length,3,g,m]);return D=new Float32Array(0),U}async function normalizeTensor(d,m,g,w=!1,$){$?.throwIfAborted();const I=await d.getData(),D=d.dims;for(let U=0;U<D[2];U++)for(let q=0;q<D[3];q++)for(let j=0;j<D[1];j++){$?.throwIfAborted();let G=j*D[2]*D[3]+U*D[3]+q;I[G]=(I[G]-m[j])/g[j],w&&(I[G]=Math.min(I[G]*255,255))}$?.throwIfAborted();const F=new qe(d.type,I,D);return d.dispose(),F}function output2BB(d,m,g,w,$){let I=[],D=[];const F=d.length;let U=m.length/F;for(let q=0;q<g;q++){let j=[],G=[],H=m.slice(q*U*F,(q+1)*U*F);for(let V=0;V<H.length;V+=F){$?.throwIfAborted();const Z=X=>d.includes(X)?H[V+d.indexOf(X)]:void 0,Q={sx:Z("sx"),sy:Z("sy"),ex:Z("ex"),ey:Z("ey"),cx:Z("cx"),cy:Z("cy"),w:Z("w"),h:Z("h"),score:Z("score")},[J,ie]=match$1.case({cx:"number",ex:"number"},({cx:X,ex:ne})=>[X,2*(ne-X)]).case({cx:"number",sx:"number"},({sx:X,cx:ne})=>[ne,2*(ne-X)]).case({cx:"number",w:"number"},({cx:X,w:ne})=>[X,ne]).case({ex:"number",sx:"number"},({sx:X,ex:ne})=>[(X+ne)/2,ne-X]).case({ex:"number",w:"number"},({ex:X,w:ne})=>[X-ne/2,ne]).case({sx:"number",w:"number"},({sx:X,w:ne})=>[X+ne/2,ne]).default(()=>{throw new Error(`Could not get center point x coord and width. Check your protocol's inference.detection.output.shape. Available atoms: ${JSON.stringify(Q)}`)})(Q),[re,se]=match$1.case({cy:"number",ey:"number"},({cy:X,ey:ne})=>[X,2*(ne-X)]).case({cy:"number",sy:"number"},({sy:X,cy:ne})=>[ne,2*(ne-X)]).case({cy:"number",h:"number"},({cy:X,h:ne})=>[X,ne]).case({ey:"number",sy:"number"},({sy:X,ey:ne})=>[(X+ne)/2,ne-X]).case({ey:"number",h:"number"},({ey:X,h:ne})=>[X-ne/2,ne]).case({sy:"number",h:"number"},({sy:X,h:ne})=>[X+ne/2,ne]).default(()=>{throw new Error(`Could not get center point y coord and height. Check your protocol's inference.detection.output.shape. Available atoms: ${JSON.stringify(Q)}`)})(Q);if(J==0&&re==0&&ie==0&&se==0)break;if(Q.score===void 0)throw new Error("Could not get score. Check your protocol's inference.detection.output.shape.");Q.score>w&&(j.push([J,re,ie,se]),G.push(Q.score))}I.push(j),D.push(G)}return[I,D]}async function resizeTensor(d,m,g,w){w?.throwIfAborted();const $=await d.getData(),I=d.dims,D=new Float32Array(g*m*3),F=[1,3,g,m],U=I[3]/m,q=I[2]/g;for(let G=0;G<m;G++)for(let H=0;H<g;H++)for(let V=0;V<3;V++){w?.throwIfAborted();const Z=V*g*m+H*m+G,Q=V*I[2]*I[3]+Math.floor(H*q)*I[3]+Math.floor(G*U);D[Z]=$[Q]}return w?.throwIfAborted(),new qe(d.type,D,F)}we.wasm.numThreads=1;we.wasm.wasmPaths={"ort-wasm-simd-threaded.wasm":"/ort-wasm-simd-threaded.wasm"};const TARGETWIDTH=640,TARGETHEIGHT=640,NUMCONF=.437,STD=[.229,.224,.225],MEAN=[.485,.456,.406];async function loadModel(d,m=!1,g){g??=()=>{};const w=await fetchHttpRequest(d,{cacheAs:"model",onProgress:g}).then(I=>I.arrayBuffer()).then(I=>new Uint8Array(I)),$=Kp.create(w,{executionProviders:m?["webgpu"]:[]});if(!$)throw new Error("Impossible de charger le modÃ¨le ONNX");return $}async function infer({abortSignal:d,...m},g,w,$,I=!1,D=!0){if(D&&console.warn("webgpu not implemented yet, using wasm"),!w)throw new Error("Model not loaded");let F=-1;I||(F=Date.now()),m={...m,input:{width:TARGETWIDTH,height:TARGETHEIGHT,name:w.inputNames[0],normalized:!0,...m?.input},output:{name:"output0",...m?.output}};let U;U=await loadToTensor(g,{...m.input,abortSignal:d});const q=await w.run({[m.input.name]:U}),j=output2BB(m.output.shape,q[m.output.name].data,g.length,NUMCONF,d),[G,H]=j;return[G,H,F,U]}async function classify(d,m,g,w){const $=d.input.name??g.inputNames[0],I=await preprocessTensor(d,m,MEAN,STD,w),D=await g.run({[$]:I});w?.throwIfAborted();const F=await D[Object.keys(D)[0]].getData(!0).then(U=>[...U.values()]);return m.dispose(),F}const centeredBoundingBox=type({x:"number",y:"number",w:"number",h:"number"}),topLeftBoundingBox=type({x:"number",y:"number",width:"number",height:"number"});type({x:"number > 0",y:"number > 0",width:"number > 0",height:"number > 0"});type.or(centeredBoundingBox,topLeftBoundingBox);function coordsScaler({x:d,y:m}){return({x:g,y:w,...$})=>{const[I,D]=[g*d,w*m];return"width"in $&&"height"in $?{x:I,y:D,width:$.width*d,height:$.height*m}:"w"in $&&"h"in $?{x:I,y:D,w:$.w*d,h:$.h*m}:{x:I,y:D,...$}}}function toTopLeftCoords({x:d,y:m,w:g,h:w}){return{x:d-g/2,y:m-w/2,width:g,height:w}}async function cropImage(d,m,g,w="0px"){const $=await createImageBitmap(new Blob([d],{type:m})),I=coordsScaler({x:$.width,y:$.height})(toTopLeftCoords(g)),{inPixels:D}=parseCropPadding(w),F={x:D($.width),y:D($.height)};try{const U=await createImageBitmap($,clamp(I.x-F.x,0,$.width),clamp(I.y-F.y,0,$.height),clamp(I.width+2*F.x,1,$.width),clamp(I.height+2*F.y,1,$.height)),q=new OffscreenCanvas(U.width,U.height);return q.getContext("2d")?.drawImage(U,0,0),{cropped:await q.convertToBlob({type:["image/png","image/jpeg"].includes(m)?m:"image/png"}).then(G=>G.arrayBuffer()),original:d}}catch(U){throw new Error(`Couldn't crop with ${JSON.stringify({boundingBox:I,padding:w})}: ${U}`,{cause:U})}finally{$.close()}}function parseCropPadding(d){const m=d.match(/(\d+)(px|%)/);if(!m)throw new Error(`Invalid crop padding: ${d}`);const[g,w]=[Number.parseInt(m[1],10),m[2]];return{withUnit:d,unitless:g,unit:w,inPixels:$=>w==="px"?g:Math.round($*g/100)}}const MetadataRecord=type({"[string]":{value:[type.or("null",MetadataRuntimeValue.boolean,MetadataRuntimeValue.integer,MetadataRuntimeValue.float,MetadataRuntimeValue.string,"string.date.iso",MetadataRuntimeValue.location,MetadataRuntimeValue.boundingbox),"@","Valeur de la mÃ©tadonnÃ©e"],"valueLabel?":["string","@","Label de la valeur de la mÃ©tadonnÃ©e. Existe pour les mÃ©tadonnÃ©es de type enum, contient dans ce cas le label associÃ© Ã  la clÃ© de l'option de l'enum choisie"],confidence:["number","@","Confiance dans la valeur de la mÃ©tadonnÃ©e, entre 0 et 1"],manuallyModified:["boolean","@","La valeur de la mÃ©tadonnÃ©e a Ã©tÃ© modifiÃ©e manuellement"],alternatives:type({"[string]":["number","@","Confiance dans cette valeur alternative de la mÃ©tadonnÃ©e, entre 0 et 1."]}).describe("Autres valeurs possibles. Les clÃ©s de l'objet sont les autres valeurs possibles pour cette mÃ©tadonnÃ©e (converties en texte via JSON), les valeurs de l'objet sont les confiances associÃ©es Ã  ces alternatives.")}}),Analysis=type({observations:type({"[string]":{label:["string","@","Label de l'observation"],images:type({id:["string","@","ID de l'image"],filename:["string","@","Nom du fichier utilisÃ© pour cette image"],contentType:["string","@","Type de contenu de l'image, au format MIME (exemple: image/jpeg)"],sequence:["number","@","NumÃ©ro de sÃ©quence de l'image dans l'archive .zip. Unique Ã  l'entiÃ¨retÃ© de l'export"],metadata:MetadataRecord,exportedAs:type({original:["string","@","Chemin vers l'image originale"],cropped:["string","@","Chemin vers l'image recadrÃ©e"]}).describe("Chemins dans l'archive .zip vers l'image exportÃ©e")}).array(),metadata:MetadataRecord,protocolMetadata:MetadataRecord.describe("MÃ©tadonnÃ©es dÃ©finies par le protocole. Les clÃ©s de l'objet sont les identifiants des mÃ©tadonnÃ©es, sans le prÃ©fixe qui identifie leur protocole de provenance")}}).describe("Associe l'ID d'une observation Ã  son label et les valeurs de ses mÃ©tadonnÃ©es"),protocol:Protocol$1.describe("Le protocole utilisÃ© pour cette session d'analyse")});function toMetadataRecord(d){return mapValues(d,({value:m,...g})=>({value:m instanceof Date?m.toISOString():m,...g}))}function toCSV(d,m,g=";"){const w=$=>`"${$?.replace(/"/g,'""')??""}"`;return[d.map(w).join(g),...m.map($=>d.map(I=>w($[I])).join(g))].join(`
`)}swarp.generateResultsZip(async({protocolId:d,include:m,cropPadding:g,jsonSchemaURL:w},$)=>{const I=await openDatabase$1(),D=await I.get("Protocol",d).then(Schemas.Protocol.assert);if(!D)throw new Error(`Protocol with ID ${d} not found`);const F=D.exports??{images:{cropped:FilepathTemplate.assert("cropped/{{sequence}}.{{extension image.filename}}"),original:FilepathTemplate.assert("original/{{sequence}}.{{extension image.filename}}")},metadata:{json:"analysis.json",csv:"metadata.csv"}},U=await I.getAll("Observation"),q=await I.getAll("Image"),j=await I.getAll("Metadata").then(se=>Object.fromEntries(se.map(X=>[X.id,X]))),G=await I.getAll("MetadataOption").then(se=>{const X={};for(const ne of se)X[ne.metadataId]||(X[ne.metadataId]=[]),X[ne.metadataId].push(ne);return X});let H={},V=1;U.sort(compareBy(se=>se.label+se.id));for(const{id:se,label:X,images:ne,metadataOverrides:ce}of U){const oe=await observationMetadata(I,{images:ne,metadataOverrides:MetadataValues.assert(ce)}).then(de=>addValueLabels(de,G));H[se]={label:X,metadata:toMetadataRecord(oe),protocolMetadata:toMetadataRecord(protocolMetadataValues(D,oe)),images:[]};for(const de of ne.sort()){if(!q.some(Fe=>Fe.id===de))continue;const me=Schemas.Image.assert(q.find(Fe=>Fe.id===de)),ge=await addValueLabels(me.metadata,G),fe={...me,metadata:toMetadataRecord(ge),protocolMetadata:toMetadataRecord(protocolMetadataValues(D,ge))},xe={observation:H[se],image:fe,sequence:V};H[se].images.push({...fe,sequence:V,exportedAs:{original:F.images.original.render(xe),cropped:F.images.cropped.render(xe)}}),V++}}const Z=[...new Set(U.flatMap(se=>Object.keys(H[se.id].metadata)))];let Q=[],J=1,ie=0;if(m!=="metadataonly"){J+=U.flatMap(se=>se.images).length;for(const[se,X]of U.flatMap(ne=>ne.images.map(ce=>[ne,ce]))){const ne=q.find(Oe=>Oe.id===X);if(!ne)continue;const ce=MetadataValues.assert({...ne.metadata,...se.metadataOverrides}),{contentType:oe,filename:de}=Schemas.Image.assert(ne),me=ce[D.crop?.metadata??"crop"]?.value;if(!ne.fileId)continue;const ge=await I.get("ImageFile",ne.fileId);if(!ge)continue;const{cropped:fe,original:xe}=me?await cropImage(ge.bytes,oe,me,g):{cropped:ge.bytes,original:ge.bytes};let Fe,Te;try{oe==="image/jpeg"?Te=addExifMetadata(fe,Object.values(j),ce):Te=new Uint8Array(fe),m==="full"&&(oe==="image/jpeg"?Fe=addExifMetadata(xe,Object.values(j),ce):Fe=new Uint8Array(xe))}catch(Oe){console.error(Oe),$({warning:["exif-write-error",{filename:ge.filename}]}),Fe=new Uint8Array(xe),Te=new Uint8Array(fe)}Q.push({imageId:X,croppedBytes:Te,originalBytes:Fe,contentType:oe,filename:de}),ie++,$({progress:ie/J})}}const re=await new Promise((se,X)=>zip({[F.metadata.json]:strToU8(stringifyWithToplevelOrdering("json",w.toString(),Analysis.assert({observations:H,protocol:{...D,exports:{...D.exports,images:{original:F.images.original.toJSON(),cropped:F.images.cropped.toJSON()}}}}),["protocol","observations"])),[F.metadata.csv]:strToU8(toCSV(["Identifiant","Observation",...Z.filter(ne=>!!j[ne]?.label).flatMap(ne=>[metadataPrettyKey(j[ne]),`${metadataPrettyKey(j[ne])}: Confiance`])],U.map(ne=>({Identifiant:ne.id,Observation:ne.label,...Object.fromEntries(Object.entries(H[ne.id].metadata).flatMap(([ce,{value:oe,confidence:de,valueLabel:me}])=>[[metadataPrettyKey(j[ce]),metadataPrettyValue("en",j[ce],oe,me)],[`${metadataPrettyKey(j[ce])}: Confiance`,de.toString()]]))})))),...m==="metadataonly"?{}:Object.fromEntries(Object.values(H).flatMap(({images:ne})=>ne).flatMap(({exportedAs:ne,id:ce})=>{const oe=Q.find(de=>de.imageId===ce);return oe?[[ne.cropped,[oe.croppedBytes,{level:0}]],[ne.original,[oe.originalBytes,{level:0}]]].filter(([,[de]])=>de!==void 0):[]}))},{comment:`Generated by C.i.g.a.l.e on ${new Date().toISOString()}`},(ne,ce)=>{ne&&X(ne),se(ce)}));return $({progress:1}),re.buffer});let inferenceSessions=new Map;swarp.loadModel(async({task:d,request:m,classmapping:g,protocolId:w,webgpu:$},I)=>{const D=progressSplitter("model",.9,"classmapping");function F(G,H){return typeof H=="string"?H:[G,H.method,H.url,Object.entries(H.headers).sort(([V],[Z])=>V.localeCompare(Z)).map(([V,Z])=>`${V}:${Z}`)].join("|")}const U=F(w,m),q=inferenceSessions.get(d);if(q&&q.id===U)return console.debug(`Model ${d} already loaded with ID ${U}`),!0;console.debug(`Loading model for task ${d} with ID ${U}`);const j={id:U,onnx:await loadModel(m,$,({transferred:G,total:H})=>{I(D("model",G/H))})};return g&&(j.classmapping=await fetchHttpRequest(g,{cacheAs:"model",onProgress({transferred:G,total:H}){I(D("classmapping",G/H))}}).then(G=>G.text()).then(G=>G.split(/\r?\n/).filter(Boolean))),console.debug(`Model ${d} loaded successfully with ID ${U}`),inferenceSessions.set(d,j),!0});swarp.isModelLoaded(async d=>inferenceSessions.has(d));swarp.inferBoundingBoxes(async({fileId:d,taskSettings:m},g,w)=>{const $=inferenceSessions.get("detection")?.onnx;if(!$)throw new Error("ModÃ¨le de dÃ©tection non chargÃ©");const I=await openDatabase$1();w.abortSignal?.throwIfAborted();const D=await I.get("ImageFile",d);if(!D)throw new Error(`Fichier avec l'ID ${d} non trouvÃ©`);const[[F],[U]]=await infer({...m,abortSignal:w.abortSignal},[D.bytes],$);return{boxes:F,scores:U}});swarp.classify(async({imageId:d,metadataIds:m,taskSettings:g},w,$)=>{$.abortSignal?.throwIfAborted();const I=await openDatabase$1(),D=Schemas.Image.assert(await I.get("Image",d));$.abortSignal?.throwIfAborted();const F=inferenceSessions.get("classification");if(!F)return{scores:[]};const{classmapping:U,onnx:q}=F;if(!U)throw new Error("Le modÃ¨le de classification n'a pas de classmapping associÃ©");if($.abortSignal?.throwIfAborted(),!D.fileId)throw new Error(`Image ${d} has no ImageFile`);const j=await I.get("ImageFile",D.fileId);if(!j)throw new Error(`Fichier avec l'ID ${D.fileId} non trouvÃ©`);const G=D.metadata[m.cropbox]?.value??{x:.5,y:.5,w:1,h:1};console.debug("Classifying image",D.id,"with cropbox",G);const H=await loadToTensor([j.bytes],{...g.input,normalized:!0,crop:G,abortSignal:$.abortSignal}),V=await classify(g,H,q,$.abortSignal);$.abortSignal?.throwIfAborted();const Z=V.map((Q,J)=>({confidence:Q,value:U[J]})).sort((Q,J)=>J.confidence-Q.confidence).slice(0,100);if($.abortSignal?.throwIfAborted(),Z.length){const[Q,...J]=Z,ie={subjectId:d,...Q,alternatives:J};await storeMetadataValue({db:I,...ie,metadataId:m.target,abortSignal:$.abortSignal})}else throw new Error("No species detected");return{scores:V}});const richTypes={Date:!0,RegExp:!0,String:!0,Number:!0};function diff(d,m,g={cyclesFix:!0},w=[]){let $=[];const I=Array.isArray(d);for(const F in d){const U=d[F],q=I?+F:F;if(!(F in m)){$.push({type:"REMOVE",path:[q],oldValue:d[F]});continue}const j=m[F],G=typeof U=="object"&&typeof j=="object"&&Array.isArray(U)===Array.isArray(j);U&&j&&G&&!richTypes[Object.getPrototypeOf(U)?.constructor?.name]&&(!g.cyclesFix||!w.includes(U))?$.push.apply($,diff(U,j,g,g.cyclesFix?w.concat([U]):[]).map(H=>(H.path.unshift(q),H))):U!==j&&!(Number.isNaN(U)&&Number.isNaN(j))&&!(G&&(isNaN(U)?U+""==j+"":+U==+j))&&$.push({path:[q],type:"CHANGE",value:j,oldValue:U})}const D=Array.isArray(m);for(const F in m)F in d||$.push({type:"CREATE",path:[D?+F:F],value:m[F]});return $}async function toExportedProtocol(d,m){const g=await d.getAll("MetadataOption",metadataOptionsKeyRange(m.id,null));return ExportedProtocol.assert({...omit(m,"dirty"),exports:{...m.exports,...m.exports?{images:{cropped:m.exports.images.cropped.toJSON(),original:m.exports.images.original.toJSON()}}:{}},metadata:Object.fromEntries(await d.getAll("Metadata").then(w=>w.filter($=>m.metadata.includes($.id)).map($=>[$.id,{...omit($,"id"),options:g.filter(({id:I})=>metadataOptionsKeyRange(m.id,$.id).includes(I)).map(I=>omit(I,"id","metadataId"))}])))})}async function compareProtocolWithUpstream(d,m,{onProgress:g}={}){const w=await d.get("Protocol",m).then(Protocol$1.assert);if(await g?.(0),!w?.source)return[];const[$,I]=await Promise.all([fetchHttpRequest(w.source).then(Q=>Q.json()).then(Q=>ExportedProtocol(Q)),toExportedProtocol(d,w)]);if($ instanceof ArkErrors)return console.warn("Remote protocol is invalid",$),[];const D=new Set([...keys($.metadata),...keys(I.metadata)]),F=sum([...D].map(Q=>{const J=I.metadata[Q],ie=$.metadata[Q];if(!J||!ie)return 0;const re=J.options?.map(X=>X.key)??[],se=ie.options?.map(X=>X.key)??[];return new Set([...re,...se]).size}));let U=0;const q={fetchAndConvert:250,microdiff:25,options:F,postProcess:2},j=async(Q=1)=>{U+=Q,g?.(U/sum(Object.values(q)))};await j(q.fetchAndConvert);const G={description:"",key:"",label:"",__deleted:!0};for(const Q of D){if(!$.metadata[Q]||!I.metadata[Q])continue;const J=$.metadata[Q].options??[],ie=[],re=I.metadata[Q].options??[],se=[],X=[...new Set([...J.map(ne=>ne.key),...re.map(ne=>ne.key)])].sort();for(const ne of X){const ce=J.find(de=>de.key===ne),oe=re.find(de=>de.key===ne);se.push(oe??G),ie.push(ce??G),await j()}$.metadata[Q].options=ie,I.metadata[Q].options=se}const H=diff($,I,{cyclesFix:!0});await j(q.microdiff);let V=structuredClone(H);const Z=(Q,J)=>Q.length>=J.length&&range(0,J.length).every(ie=>Q[ie]===J[ie]);for(const{path:Q,type:J}of H){const ie=Q.at(-1),re=Q.slice(0,-1);if(ie==="__deleted"){if(J==="CREATE"){const se=re;V=V.filter(X=>!Z(X.path,se)),V.push({type:"REMOVE",path:[...re],oldValue:fromEntries(H.filter(X=>Z(X.path,se)).filter(X=>X.path.at(-1)!=="__deleted").map(X=>[X.path.at(-1)?.toString()??"",X.oldValue]))})}else if(J==="REMOVE"){const se=re;V=V.filter(X=>!Z(X.path,se)),V.push({type:"CREATE",path:[...re],value:fromEntries(H.filter(X=>Z(X.path,se)).filter(X=>X.path.at(-1)!=="__deleted").map(X=>[X.path.at(-1)?.toString()??"",X.value]))})}}}return await j(q.postProcess),V}swarp.importProtocol(async({contents:d,isJSON:m},g)=>{const w=(q,j)=>{g(j?{phase:q,detail:j}:{phase:q})};w("parsing"),console.time("Parsing protocol");let $=m?JSON.parse(d):YAML.parse(d);console.timeEnd("Parsing protocol"),console.info(`Importing protocol ${$.id}`),console.info($),w("input-validation"),console.time("Validating protocol");const I=ExportedProtocol.assert($);console.timeEnd("Validating protocol");const F=(await openDatabase$1()).transaction(["Protocol","Metadata","MetadataOption"],"readwrite");w("write-protocol"),console.time("Storing Protocol"),F.objectStore("Protocol").put({...I,metadata:Object.keys(I.metadata)}),console.timeEnd("Storing Protocol");for(const[q,j]of Object.entries(I.metadata)){if(typeof j=="string")continue;w("write-metadata",j.label||q),console.time(`Storing Metadata ${q}`),F.objectStore("Metadata").put({id:q,...omit(j,"options")}),console.timeEnd(`Storing Metadata ${q}`),console.time(`Storing Metadata Options for ${q}`);const G=j.options?.length??0;let H=0;for(const V of j.options??[])H++,H%1e3===0&&w("write-metadata-options",`${j.label||q} > ${V.label||V.key} (${H}/${G})`),F.objectStore("MetadataOption").put({id:metadataOptionId(namespacedMetadataId(I.id,q),V.key),metadataId:namespacedMetadataId(I.id,q),...V});console.timeEnd(`Storing Metadata Options for ${q}`)}w("output-validation"),console.time("Validating protocol after storing");const U=ExportedProtocol.assert(I);return console.timeEnd("Validating protocol after storing"),pick(U,"id","name","version")});swarp.diffProtocolWithRemote(async({protocolId:d},m)=>{const g=await openDatabase$1(),w=await g.get("Protocol",d);if(!w)throw new Error(`Protocol with ID ${d} not found`);const $=await compareProtocolWithUpstream(g,d,{onProgress:m});return w.dirty=$.length>0,await g.put("Protocol",w),{dirty:w.dirty,changes:$}});swarp.syncStoredCorrections(async(d,m)=>{const g=await openDatabase$1();if(!g.objectStoreNames.contains("BeamupCorrection"))throw new Error("Database does not support Beamup corrections");let w=[],$=0;const I=await g.count("BeamupCorrection");return I===0?{total:I,failed:w,succeeded:$}:(await syncCorrections(g,(D,F)=>{F?w.push({why:F,ids:D}):$++,m((w.length+$)/I)}),{total:I,failed:w,succeeded:$})});swarp.start();
