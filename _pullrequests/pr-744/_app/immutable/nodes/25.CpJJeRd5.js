import{_ as S,a as qt,g as Q,d as jt,s as Dt}from"../chunks/B0sfP6zc.js";import{j as Et,z as lt,B as it,n as W,t as ft,l as Ht,C as Tt,A as St,s as Nt,e as Ut,d as Kt,r as gt}from"../chunks/BfjK8oC1.js";import{e as $t}from"../chunks/D6WmM5W6.js";import{m as Gt}from"../chunks/qhgpwkM7.js";import{e as Jt}from"../chunks/BmYW83mJ.js";import"../chunks/DsnmJJEf.js";import{f as kt,a as m,p as Qt,c as $,d as st,g as t,u as e,ab as A,b as Wt,az as v,aA as u,ba as Xt,r as d,aF as Yt,e as Zt,aa as te,n as ht}from"../chunks/CKFr55HY.js";import{a as F,e as ee}from"../chunks/BSJa-gCr.js";import{r as Pt,i as nt}from"../chunks/BnINZmlg.js";import{e as ae}from"../chunks/BfRwOU-Q.js";import{t as re,f as oe}from"../chunks/CQ7DZjSk.js";import{R as L}from"../chunks/PUfmrO2I.js";import{V as se}from"../chunks/B1WHLvY0.js";import{A as ne}from"../chunks/CnQKqK84.js";import{D as le}from"../chunks/C9aioxm5.js";import{F as bt,E as wt}from"../chunks/DbQ7YyVi.js";import{I as ie}from"../chunks/DocSOye_.js";import{p as w}from"../chunks/CFsItWt6.js";import{B as xt}from"../chunks/EISLmZ-s.js";import{B as de}from"../chunks/B0qXVrpE.js";import{F as H}from"../chunks/DsdZIrN8.js";import{I as yt}from"../chunks/D4mJ-AV5.js";import{g as It}from"../chunks/bCylyxMO.js";import{o as ve}from"../chunks/DoNGPkrc.js";import{i as ce}from"../chunks/CJ0dtI1a.js";import{t as Mt}from"../chunks/C4Cali0V.js";async function pe({parent:x,params:l}){const s=S(Et("js"));if(!l.id)throw $t(400,"Protocol ID is required");const{protocol:p,metadata:R}=await x(),V=await lt("MetadataOption",it(W(l.id,l.metadata),l.option));V||$t(404,s.t(371));const P=await Promise.all(Jt(V.cascade??{}).map(async([y,I])=>{const O=W(l.id,y),f=await ft.Metadata.get(O);if(!f)return{metadataId:O};let j;return f.type==="enum"&&(j=await lt("MetadataOption",it(O,I))),{metadataId:O,metadata:f,option:j,value:I}})),N=await Promise.all(p.metadata.flatMap(async y=>{const I=await ft.Metadata.get(W(l.id,y));return I?I.type!=="enum"?[]:(await Ht("MetadataOption",Gt(l.id,y))).filter(f=>f.cascade?.[l.metadata]===V.key).map(f=>({value:f.key,metadataId:I.id,metadata:I,option:f})):[]})).then(y=>y.flat());return{protocol:p,metadata:R,option:V,cascades:P,reverseCascades:N}}const ta=Object.freeze(Object.defineProperty({__proto__:null,load:pe},Symbol.toStringTag,{value:"Module"}));var me=kt('<svg><path fill="currentColor" d="M5 14V5h2v7h7.586V6.586L21 13l-6.414 6.414V14z"></path></svg>');function ue(x,l){const s=Pt(l,["$$slots","$$events","$$legacy"]);var p=me();qt(p,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),m(x,p)}var _e=kt('<svg><path fill="currentColor" d="M14 5H5v2h7v7.586H6.586L13 21l6.414-6.414H14z"></path></svg>');function fe(x,l){const s=Pt(l,["$$slots","$$events","$$legacy"]);var p=_e();qt(p,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),m(x,p)}function T(x){return S(Q("main")),async l=>{if(S(Q("main")),!w.params.metadata||!w.params.option||!w.params.id)return;const s=await lt("MetadataOption",it(Tt(w.params.metadata,w.params.id),w.params.option));if(s){try{await x(s,l)}catch(p){p instanceof St&&Mt.error(`Valeur invalide : ${p.summary}`)}await Nt("MetadataOption",s).catch(p=>{const R=S(Q("main"));Mt.error(R.t(251,[Ut(p)]))}),await ce(Kt("Metadata",W(w.params.id,w.params.metadata),"options"))}}}var ge=$('<textarea rows="10"></textarea>'),$e=$('<img class="svelte-128nasq"/>'),he=$('<p class="label-help svelte-128nasq"><!></p>'),be=$('<div class="row svelte-128nasq"><dt class="svelte-128nasq"> </dt> <!> <dd class="svelte-128nasq"> </dd> <!></div>'),we=$('<p class="empty svelte-128nasq"> </p>'),xe=$('<dl class="cascades svelte-128nasq"></dl>'),ye=$('<p class="label-help svelte-128nasq"><!></p>'),Ie=$(" <!>",1),Me=$('<li class="svelte-128nasq"><!></li>'),qe=$('<ul class="reverse-cascades svelte-128nasq"><!></ul>'),ke=$('<div class="split svelte-128nasq"><div class="left svelte-128nasq"><!> <!> <!> <!></div> <div class="right svelte-128nasq"><!> <!></div></div> <h3 class="svelte-128nasq"> </h3> <p class="svelte-128nasq"> </p> <div class="split svelte-128nasq"><div class="left svelte-128nasq"><!></div> <div class="right svelte-128nasq"><!></div></div> <div class="danger"><!></div>',1);function ea(x,l){Qt(l,!0);const s=e(()=>S(Q("main"))),p=e(()=>l.data.cascades),R=e(()=>l.data.reverseCascades),V=e(()=>l.data.metadata),P=e(()=>l.data.option),N=e(()=>t(P).key),y=e(()=>t(P).label),I=e(()=>t(P).description),O=e(()=>t(P).learnMore),f=e(()=>t(P).image);var j=ke(),U=st(j),X=v(U),dt=v(X);{let i=e(()=>t(s).t(352));H(dt,{get label(){return t(i)},children:(n,_)=>{{let a=e(()=>t(s).t(353)),r=e(()=>T((o,c)=>{o.key=c}));yt(n,{get value(){return t(N)},get label(){return t(a)},discreet:!0,get onblur(){return t(r)}})}}})}var vt=u(dt,2);{let i=e(()=>t(s).t(354));H(vt,{get label(){return t(i)},children:(n,_)=>{{let a=e(()=>t(s).t(355)),r=e(()=>T((o,c)=>{o.label=c}));yt(n,{get value(){return t(y)},get label(){return t(a)},discreet:!0,get onblur(){return t(r)}})}}})}var ct=u(vt,2);{let i=e(()=>t(s).t(302));H(ct,{get label(){return t(i)},children:(n,_)=>{var a=ge();Xt(a);var r=e(()=>T((o,{target:c})=>{c instanceof HTMLTextAreaElement&&(o.description=c.value)}));A(()=>jt(a,t(I))),ee("blur",a,function(...o){t(r)?.apply(this,o)}),m(n,a)}})}var Ot=u(ct,2);{let i=e(()=>t(s).t(86)),n=e(()=>t(O)??""),_=e(()=>T((a,r)=>{r?a.learnMore=r:delete a.learnMore}));bt(Ot,{get label(){return t(i)},get value(){return t(n)},get onblur(){return t(_)}})}d(X);var pt=u(X,2),mt=v(pt);{let i=e(()=>t(s).t(356)),n=e(()=>t(f)??""),_=e(()=>T((a,r)=>{r?a.image=r:delete a.image}));bt(mt,{get Icon(){return ie},check:!0,get label(){return t(i)},get value(){return t(n)},get onblur(){return t(_)}})}var Ct=u(mt,2);{var Bt=i=>{var n=$e();A(()=>Dt(n,"src",t(f))),m(i,n)};nt(Ct,i=>{t(f)&&i(Bt)})}d(pt),d(U);var Y=u(U,2),At=v(Y,!0);d(Y);var Z=u(Y,2),Ft=v(Z,!0);d(Z);var tt=u(Z,2),et=v(tt),Vt=v(et);H(Vt,{get Icon(){return fe},composite:!0,label:n=>{const _=(a,r=ht)=>{var o=he(),c=v(o);{let M=e(()=>[l.data.metadata.label,l.data.option.label]);L(c,{get x(){return r()},n:!0,get a(){return t(M)}})}d(o),m(a,o)};{let a=e(()=>[_]),r=e(()=>t(s).cx(359));L(n,{get t(){return t(a)},get x(){return t(r)}})}},children:(n,_)=>{var a=xe();ae(a,21,()=>t(p),({metadataId:r,metadata:o,option:c,value:M})=>r,(r,o,c,M)=>{let g=()=>t(o).metadataId,K=()=>t(o).metadata,h=()=>t(o).option,at=()=>t(o).value;const z=e(()=>gt(g()));var q=be(),b=v(q),C=v(b,!0);d(b);var G=u(b,2);ne(G,{});var D=u(G,2),k=v(D,!0);d(D);var B=u(D,2);{var J=E=>{{let rt=e(()=>t(s).t(360,[h().label||h().key]));xt(E,{get help(){return t(rt)},onclick:()=>It("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:w.params.id??"",metadata:t(z),option:h().key}),children:(ot,Rt)=>{wt(ot,{})},$$slots:{default:!0}})}};nt(B,E=>{h()&&E(J)})}d(q),A(()=>{F(C,K()?.label||t(z)),F(k,h()?.label||h()?.key||at())}),m(r,q)},r=>{var o=we(),c=v(o,!0);d(o),A(M=>F(c,M),[()=>t(s).t(361)]),m(r,o)}),d(a),m(n,a)}}),d(et);var ut=u(et,2),zt=v(ut);H(zt,{get Icon(){return ue},composite:!0,label:n=>{const _=(a,r=ht)=>{var o=ye(),c=v(o);{let M=e(()=>[t(V).label,l.data.option.label]);L(c,{get x(){return r()},n:!0,get a(){return t(M)}})}d(o),m(a,o)};{let a=e(()=>[_]),r=e(()=>t(s).cx(362));L(n,{get t(){return t(a)},get x(){return t(r)}})}},children:(n,_)=>{var a=qe(),r=v(a);se(r,{get items(){return t(R)},children:Yt,$$slots:{default:(o,c)=>{const M=e(()=>c.item),g=e(()=>{const{metadataId:z,metadata:q,option:b,value:C}=t(M);return{metadataId:z,metadata:q,option:b,value:C}}),K=e(()=>gt(t(g).metadataId));var h=Me();{const z=q=>{var b=Zt(),C=st(b);{var G=k=>{var B=Ie(),J=st(B),E=u(J);{let rt=e(()=>t(s).t(360,[t(g).option.label||t(g).option.key]));xt(E,{get help(){return t(rt)},onclick:()=>It("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:w.params.id??"",metadata:t(K),option:t(g).option.key}),children:(ot,Rt)=>{wt(ot,{})},$$slots:{default:!0}})}A(()=>F(J,`${(t(g).option.label||t(g).option.key)??""} `)),m(k,B)},D=k=>{var B=te();A(()=>F(B,t(g).value)),m(k,B)};nt(C,k=>{t(g).option?k(G):k(D,!1)})}m(q,b)};var at=v(h);{let q=e(()=>[z]),b=e(()=>t(s).cx(363)),C=e(()=>[t(g).metadata?.label||t(K)]);L(at,{get t(){return t(q)},get x(){return t(b)},get a(){return t(C)}})}d(h)}m(o,h)}}}),d(a),m(n,a)}}),d(ut),d(tt);var _t=u(tt,2),Lt=v(_t);{const i=n=>{le(n,{})};de(Lt,{danger:!0,onclick:async()=>{await ve(t(N),t(y))},_w_snippet_3:i,children:(n,_)=>{{let a=e(()=>[i]),r=e(()=>t(s).cx(364));L(n,{get t(){return t(a)},get x(){return t(r)}})}},$$slots:{_w_snippet_3:!0,default:!0}})}d(_t),A((i,n)=>{F(At,i),F(Ft,n)},[()=>t(s).t(357),()=>t(s).t(358)]),re(1,U,()=>oe,()=>({duration:100})),m(x,j),Wt()}export{ea as component,ta as universal};
