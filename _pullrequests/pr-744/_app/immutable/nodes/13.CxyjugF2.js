import"../chunks/DsnmJJEf.js";import{f as me,a as u,s as U,g as e,i as b,h as ve,u as n,p as qt,k as Fe,c as z,bx as Aa,az as g,aA as h,n as Ne,r as v,ab as W,b as Bt,a9 as qa,aB as Me,d as X,e as $e,aZ as Wt,aa as We,a5 as Ba}from"../chunks/CKFr55HY.js";import{d as oa,e as $t,a as he,r as Oa}from"../chunks/BSJa-gCr.js";import{s as Re}from"../chunks/BYsmyf-T.js";import{r as pe,p as zt,i as F,s as Sa}from"../chunks/BnINZmlg.js";import{c as Va}from"../chunks/Eu4gtx6U.js";import{e as Be,i as Zt}from"../chunks/BfRwOU-Q.js";import{F as Pa,C as Da,h as Ha}from"../chunks/DAOst7r_.js";import{c as Gt}from"../chunks/_Ua9-HGN.js";import{a as Je,t as Ke,K as ja}from"../chunks/fs5VanAl.js";import{a as _e,b as De,s as tt,c as Pe,_ as Ea,g as La}from"../chunks/B0sfP6zc.js";import{b as na}from"../chunks/B5L0AQ92.js";import{R as xe}from"../chunks/PUfmrO2I.js";import{w as sa}from"../chunks/CfgHx0iS.js";import{C as Ra}from"../chunks/D6998Fwd.js";import{D as Yt}from"../chunks/C9aioxm5.js";import{S as Ta}from"../chunks/w-oxgOS-.js";import{p as Na}from"../chunks/CFsItWt6.js";import{w as Fa,c as Ct,t as wt,b as Ua,d as yt,e as Wa}from"../chunks/BTVA-Cj2.js";import{B as Te}from"../chunks/EISLmZ-s.js";import{B as Jt}from"../chunks/B1ufcx3J.js";import{B as kt}from"../chunks/B0qXVrpE.js";import{C as Za}from"../chunks/DqV6OcAN.js";import{g as Ga,k as qe,t as Xe,_ as Ya,q as Kt}from"../chunks/BfjK8oC1.js";import{c as Oe,l as Ue,m as At,q as Xt,r as Ja,j as Ka}from"../chunks/BmYW83mJ.js";import{c as Xa,f as Qa,d as er,g as It,h as tr,p as ar,j as rr,k as ir}from"../chunks/BkWgRosR.js";import{i as Qt,a as ea,s as or,t as nr}from"../chunks/CaMFGYwT.js";import{L as sr}from"../chunks/ChskKCUc.js";import{d as Mt,s as Qe,c as lr,h as cr}from"../chunks/qhgpwkM7.js";import{g as ye}from"../chunks/bCylyxMO.js";import{P as ta}from"../chunks/De1XvMMn.js";import{s as dr}from"../chunks/BnT1n4qy.js";import{s as hr}from"../chunks/CUqDLSou.js";import{u as w}from"../chunks/CzznUtHs.js";import{S as ur}from"../chunks/DhFJ2lNy.js";import{t as aa}from"../chunks/C4Cali0V.js";import{T as vr}from"../chunks/7mf7GzFZ.js";var gr=me('<svg><path fill="currentColor" d="M2.5 7a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m0 10a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m10 0a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m-3-10a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0m0 10a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0m10 0a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0M16 11V8h-3V6h3V3h2v3h3v2h-3v3z"></path></svg>');function fr(y,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=gr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(y,s)}var mr=me('<svg><path fill="currentColor" d="m5.828 7l2.536 2.535L6.95 10.95L2 6l4.95-4.95l1.414 1.415L5.828 5H13a8 8 0 1 1 0 16H4v-2h9a6 6 0 0 0 0-12z"></path></svg>');function pr(y,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=mr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(y,s)}var _r=me('<svg><path fill="currentColor" d="m10.828 12l4.95 4.95l-1.414 1.415L8 12l6.364-6.364l1.414 1.414z"></path></svg>');function br(y,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=_r();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(y,s)}var xr=me('<svg><path fill="currentColor" d="m13.172 12l-4.95-4.95l1.414-1.413L16 12l-6.364 6.364l-1.414-1.415z"></path></svg>');function wr(y,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=xr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(y,s)}var yr=me('<svg><path fill="currentColor" d="m11.602 13.76l1.412 1.412l8.466-8.466l1.414 1.415l-9.88 9.88l-6.364-6.365l1.414-1.414l2.125 2.125zm.002-2.828l4.952-4.953l1.41 1.41l-4.952 4.953zm-2.827 5.655L7.364 18L1 11.636l1.414-1.414l1.413 1.413l-.001.001z"></path></svg>');function et(y,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=yr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(y,s)}var kr=me('<svg><path fill="currentColor" d="M11 5.07A7.005 7.005 0 0 0 5.07 11H7v2H5.07A7 7 0 0 0 11 18.93V17h2v1.93A7 7 0 0 0 18.93 13H17v-2h1.93A7 7 0 0 0 13 5.07V7h-2zM3.055 11A9.004 9.004 0 0 1 11 3.055V1h2v2.055A9.004 9.004 0 0 1 20.945 11H23v2h-2.055A9.004 9.004 0 0 1 13 20.945V23h-2v-2.055A9.004 9.004 0 0 1 3.055 13H1v-2zM14 12a2 2 0 1 1-4 0a2 2 0 0 1 4 0"></path></svg>');function Ir(y,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=kr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(y,s)}var Mr=me('<svg><path fill="currentColor" d="M13 19.938A8.004 8.004 0 0 0 19.938 13H17v-2h2.938A8.004 8.004 0 0 0 13 4.062V7h-2V4.062A8.004 8.004 0 0 0 4.062 11H7v2H4.062A8.004 8.004 0 0 0 11 19.938V17h2zM12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m0-8a2 2 0 1 1 0-4a2 2 0 0 1 0 4"></path></svg>');function $r(y,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=Mr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(y,s)}var zr=me('<svg><path fill="currentColor" d="M18 11V8l4 4l-4 4v-3h-5v5h3l-4 4l-4-4h3v-5H6v3l-4-4l4-4v3h5V6H8l4-4l4 4h-3v5z"></path></svg>');function Cr(y,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=zr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(y,s)}var Ar=me('<svg><path fill="currentColor" d="M12.5 2a.5.5 0 0 0-.5.5V12h-2V4.5a.5.5 0 0 0-1 0V14H7c-.38-1.62-1.358-2.56-2.405-2.678A89 89 0 0 0 6.166 15.1c.86 1.962 1.725 3.422 2.838 4.399C10.078 20.442 11.459 21 13.5 21a5.5 5.5 0 0 0 5.5-5.5V7a.5.5 0 0 0-1 0v5h-2V4a.5.5 0 0 0-1 0v8h-2V2.5a.5.5 0 0 0-.5-.5M21 15.5a7.5 7.5 0 0 1-7.5 7.5c-2.458 0-4.328-.692-5.816-1.998c-1.45-1.274-2.459-3.064-3.35-5.1c-.93-2.127-1.444-3.422-1.724-4.178c-.357-.964.136-2.312 1.476-2.406a4.02 4.02 0 0 1 2.914.94V4.5a2.5 2.5 0 0 1 3.04-2.442a2.5 2.5 0 0 1 4.79-.467A2.502 2.502 0 0 1 18 4v.55q.243-.05.5-.05A2.5 2.5 0 0 1 21 7z"></path></svg>');function qr(y,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=Ar();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(y,s)}var Br=me('<svg><path fill="currentColor" d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2v2a8 8 0 1 0 5.135 1.865L15 8V2h6l-2.447 2.447A9.98 9.98 0 0 1 22 12"></path></svg>');function ra(y,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=Br();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(y,s)}var Or=me('<svg><path fill="currentColor" d="M20 16h2v6h-6v-2H8v2H2v-6h2V8H2V2h6v2h8V2h6v6h-2zm-2 0V8h-2V6H8v2H6v8h2v2h8v-2zM4 4v2h2V4zm0 14v2h2v-2zM18 4v2h2V4zm0 14v2h2v-2z"></path></svg>');function Sr(y,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=Or();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(y,s)}const ia={origin:{x:0,y:0},scale:1,panning:!1,panStart:{x:0,y:0,zoomOrigin:{x:0,y:0}}};function Vr({naturalWidth:y,naturalHeight:r,clientWidth:i,clientHeight:s,clientTop:M,clientLeft:C},S){const Z=y/r,ne=i/s;let se=0,N=0;return Z<ne?(se=s*Z,N=s):(N=i/Z,se=i),S&&(se*=S.scale,N*=S.scale),{width:se,height:N,x:(S?.origin.x??0)+C+(i-se)/2,y:(S?.origin.y??0)+M+(s-N)/2}}class Pr{limits={x:0,y:0,width:0,height:0};#e=U("clickanddrag");get createMode(){return e(this.#e)}set createMode(r){b(this.#e,r,!0)}setCreateMode(r){this.createMode=r}#t=U(ve({x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}}));get clickanddrag(){return e(this.#t)}set clickanddrag(r){b(this.#t,r,!0)}#a=U(ve([]));get points(){return e(this.#a)}set points(r){b(this.#a,r,!0)}#r=n(()=>this.createMode==="clickanddrag"?Ga({x:"number > 0",y:"number > 0",width:"number > 0",height:"number > 0"}).allows(this.clickanddrag):this.createMode=="2point"?this.points.length>=2:this.createMode==="4point"?this.points.length>=4:!1);get ready(){return e(this.#r)}set ready(r){b(this.#r,r)}clamp(r){return{x:Oe(r.x,this.limits.x,this.limits.width),y:Oe(r.y,this.limits.y,this.limits.height),width:Oe(r.width,0,this.limits.width-r.x),height:Oe(r.height,0,this.limits.height-r.y)}}#i=n(()=>this.createMode==="clickanddrag"?this.clickanddrag.x:this.createMode==="off"?0:Math.min(...this.points.map(r=>r.x)));get x(){return e(this.#i)}set x(r){b(this.#i,r)}#o=n(()=>this.createMode==="clickanddrag"?this.clickanddrag.y:this.createMode==="off"?0:Math.min(...this.points.map(r=>r.y)));get y(){return e(this.#o)}set y(r){b(this.#o,r)}#n=n(()=>this.createMode==="clickanddrag"?this.clickanddrag.width:this.createMode==="off"?0:Math.max(...this.points.map(r=>r.x))-this.x);get width(){return e(this.#n)}set width(r){b(this.#n,r)}#s=n(()=>this.createMode==="clickanddrag"?this.clickanddrag.height:this.createMode==="off"?0:Math.max(...this.points.map(r=>r.y))-this.y);get height(){return e(this.#s)}set height(r){b(this.#s,r)}registerPoint(r,i){if(this.createMode!=="off"){if(this.createMode==="clickanddrag"){this.clickanddrag={...this.clickanddrag,x:r,y:i};return}this.points.push({x:r,y:i})}}registerMovement(r,i){if(this.createMode!=="clickanddrag")return;const{width:s,height:M}=this.clickanddrag;(s<=0||M<=0)&&(this.clickanddrag.dragDirection={x:Ue(r),y:Ue(i)});const{x:C,y:S}=this.clickanddrag.dragDirection;C>0&&S>0&&(this.clickanddrag.width+=r,this.clickanddrag.height+=i),C<0&&S<0&&(this.clickanddrag.x+=r,this.clickanddrag.y+=i,this.clickanddrag.width-=r,this.clickanddrag.height-=i),C<0&&S>0&&(this.clickanddrag.x+=r,this.clickanddrag.height+=i,this.clickanddrag.width-=r),C>0&&S<0&&(this.clickanddrag.y+=i,this.clickanddrag.width+=r,this.clickanddrag.height-=i)}rect(){return this.clamp({x:this.x,y:this.y,width:this.width,height:this.height})}reset(){this.clickanddrag={x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}},this.points=[]}constructor({limits:r}){this.limits=r,this.clickanddrag={x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}},this.points=[]}}var Dr=z("(<!>) × [<!>]",1),Hr=z(" <!><br/>",1),jr=z("<!> <br/> &nbsp;&nbsp;&nbsp;dir <!>",1),Er=z(" <!> <br/>",1),Lr=z("<br/> <!>",1),Rr=z('<code class="debug">bbs <br/> <!> <!></code>'),Tr=z('<div class="boundingbox-point new svelte-rvd0k3"></div>'),Nr=z('<div class="boundingbox new svelte-rvd0k3"></div>'),Fr=z("<div></div>"),Ur=z("<div></div>"),Wr=z("<div><!> <!> <!> <!> <!> <!> <!> <!></div>"),Zr=z("<div><!> <!> <!></div>");function Gr(y,r){qt(r,!0);let i=zt(r,"disabled",3,!1),s=U(ve(r.boundingBoxes));sa(()=>r.boundingBoxes,l=>{b(s,l,!0)});let M=U(ve(r.imageElement.clientWidth)),C=U(ve(r.imageElement.clientHeight)),S=U(ve(r.imageElement.clientLeft)),Z=U(ve(r.imageElement.clientTop)),ne=U(ve(r.imageElement.naturalWidth)),se=U(ve(r.imageElement.naturalHeight)),N=U(void 0);const ie=async()=>{r.imageElement&&((l=>{b(M,l.clientWidth,!0),b(C,l.clientHeight,!0),b(S,l.clientLeft,!0),b(Z,l.clientTop,!0),b(ne,l.naturalWidth,!0),b(se,l.naturalHeight,!0)})(r.imageElement),await qa())};Fe(()=>{r.imageElement.addEventListener("load",ie);const l=new ResizeObserver(async(P,x)=>{if(!r.imageElement){x.disconnect();return}await ie()}),I=new MutationObserver(async(P,x)=>{if(!r.imageElement){x.disconnect();return}await ie()});return l.observe(r.imageElement),I.observe(r.imageElement,{attributes:!0,attributeFilter:["src"]}),()=>{l.disconnect(),I.disconnect()}});const A=n(()=>Vr({clientHeight:e(C),clientWidth:e(M),naturalHeight:e(se),naturalWidth:e(ne),clientTop:e(Z),clientLeft:e(S)},r.zoom)),He=n(()=>Ct({x:e(A).width,y:e(A).height})),q=n(()=>Ct({x:1/e(A).width,y:1/e(A).height})),Q=n(()=>At(e(s),e(He)));let G=U(!1),B=n(()=>new Pr({limits:{x:0,y:0,width:e(A).width,height:e(A).height}}));Fe(()=>e(B).setCreateMode(r.createMode));let ee=U(""),V=ve({topleft:!1,topright:!1,bottomleft:!1,bottomright:!1,get left(){return this.topleft&&this.bottomleft},set left(l){this.topleft=l,this.bottomleft=l},get right(){return this.topright&&this.bottomright},set right(l){this.topright=l,this.bottomright=l},get top(){return this.topleft&&this.topright},set top(l){this.topleft=l,this.topright=l},get bottom(){return this.bottomleft&&this.bottomright},set bottom(l){this.bottomleft=l,this.bottomright=l},setAll(l){this.topleft=l,this.topright=l,this.bottomleft=l,this.bottomright=l},isAll(l){return this.topleft===l&&this.topright===l&&this.bottomleft===l&&this.bottomright===l}});var Y=Zr();$t("mousemove",Aa,({target:l})=>{l instanceof Element&&e(G)&&r.createMode==="clickanddrag"&&l.closest(".change-area")!==e(N)&&(console.warn("Dragging has gone outside change area, bailing out. Target is",l),V.setAll(!1),b(G,!1),e(B).reset())});let je;Y.__mouseup=async({button:l})=>{if(!i()&&l===0){if(V.setAll(!1),e(G)&&e(B).ready){const I=e(q)(e(B).rect()),P=await r.oncreate?.(I);P&&(e(s)[P]=I),e(B).reset(),b(G,!1)}else r.onchange?.(e(ee),e(s)[e(ee)]);b(ee,"")}},Y.__mousedown=({clientX:l,clientY:I,currentTarget:P,button:x})=>{if(i()||x!==0||r.createMode==="off")return;const{left:k,top:f}=P.getBoundingClientRect(),[te,_]=[l-k,I-f];(r.movable||r.transformable)&&Object.values(e(Q)).some(J=>Fa(J,{x:te,y:_}))||(b(G,!0),e(B).registerPoint(te,_))},Y.__mousemove=({movementX:l,movementY:I,button:P})=>{if(i()||P!==0)return;const{x,y:k}=e(q)({x:l,y:I,w:0,h:0});if(e(G)&&r.createMode==="clickanddrag"){e(B).registerMovement(l,I);return}const f=e(s)[e(ee)];if(V.isAll(!0)){f.x+=x,f.y+=k;return}if(V.left){f.x+=x,f.width-=x;return}if(V.right){f.width+=x;return}if(V.top){f.y+=k,f.height-=k;return}if(V.bottom){f.height+=k;return}V.topleft&&(f.x+=x,f.y+=k,f.width-=x,f.height-=k),V.topright&&(f.y+=k,f.width+=x,f.height-=k),V.bottomleft&&(f.x+=x,f.width-=x,f.height+=k),V.bottomright&&(f.width+=x,f.height+=k)};let le;var Ee=g(Y);{var Ze=l=>{var I=Rr();Pe(I,"",{},{color:"red"});{const _=(D,d=Ne,L=Ne)=>{Me();var H=We();W((ce,j)=>he(H,`${ce??""} ${j??""}`),[()=>Math.round(d()),()=>Math.round(L())]),u(D,H)},J=(D,d)=>{let L=()=>d?.().x,H=()=>d?.().y,ce=()=>d?.().width,j=()=>d?.().height;Me();var ae=Dr(),oe=h(X(ae));_(oe,L,H);var ge=h(oe,2);_(ge,ce,j),Me(),u(D,ae)};var P=h(g(I),3);Be(P,17,()=>Object.entries(e(Q)),([D,d])=>D,(D,d)=>{var L=n(()=>Wt(e(d),2));let H=()=>e(L)[0],ce=()=>e(L)[1];Me();var j=Hr(),ae=X(j),oe=h(ae);J(oe,ce),Me(),W(()=>he(ae,`@${H()??""} `)),u(D,j)});var x=h(P),k=h(x);{var f=D=>{var d=jr(),L=X(d);J(L,()=>e(B).clickanddrag);var H=h(L,4);_(H,()=>e(B).clickanddrag.dragDirection.x,()=>e(B).clickanddrag.dragDirection.y),u(D,d)},te=D=>{var d=$e(),L=X(d);{var H=j=>{var ae=We("off");u(j,ae)},ce=j=>{var ae=Lr(),oe=h(X(ae),2);Be(oe,17,()=>e(B).points,Zt,(ge,ke,ue)=>{let K=()=>e(ke).x,fe=()=>e(ke).y;Me();var be=Er(),Ge=X(be);Ge.nodeValue=`#${ue} `;var rt=h(Ge);_(rt,K,fe),Me(2),u(ge,be)}),u(j,ae)};F(L,j=>{r.createMode==="off"?j(H):j(ce,!1)},!0)}u(D,d)};F(k,D=>{r.createMode==="clickanddrag"?D(f):D(te,!1)})}v(I),W(()=>he(x,` create ${e(B).ready?"ready ":""} `))}u(l,I)};F(Ee,l=>{Qt()&&l(Ze)})}var ze=h(Ee,2);{var Le=l=>{var I=$e(),P=X(I);Be(P,17,()=>e(B).points,Zt,(x,k)=>{let f=()=>e(k).x,te=()=>e(k).y;var _=$e(),J=X(_);{var D=d=>{var L=Tr();let H;W(()=>H=Pe(L,"",H,{left:`${f()??""}px`,top:`${te()??""}px`})),u(d,L)};F(J,d=>{f()!==0&&te()!==0&&d(D)})}u(x,_)}),u(l,I)},Se=l=>{var I=$e(),P=X(I);{var x=k=>{var f=Nr();let te;W(()=>te=Pe(f,"",te,{left:`${e(B).x??""}px`,top:`${e(B).y??""}px`,width:`${e(B).width??""}px`,height:`${e(B).height??""}px`})),u(k,f)};F(P,k=>{e(G)&&r.createMode==="clickanddrag"&&k(x)},!0)}u(l,I)};F(ze,l=>{r.createMode==="2point"||r.createMode==="4point"?l(Le):l(Se,!1)})}var at=h(ze,2);Be(at,17,()=>Object.entries(e(Q)).filter(([l])=>Xa(l)===r.imageFileID),([l,I])=>l,(l,I)=>{var P=n(()=>Wt(e(I),2));let x=()=>e(P)[0],k=()=>e(P)[1];var f=Wr();let te;f.__mousedown=({button:oe})=>{oe===0&&(i()||(b(ee,x(),!0),r.movable&&V.setAll(!0)))};let _;{const oe=(ke,ue=Ne)=>{var K=Fr();let fe;K.__mousedown=be=>{be.button===0&&(i()||r.transformable&&(b(ee,x(),!0),V[ue()]=!0,be.stopPropagation()))},W(()=>fe=De(K,1,`side ${ue()??""}`,"svelte-rvd0k3",fe,{draggable:r.transformable,dragging:V[ue()]&&e(ee)===x()})),u(ke,K)},ge=(ke,ue=Ne)=>{var K=Ur();let fe;K.__mousedown=be=>{be.button===0&&(i()||r.transformable&&(b(ee,x(),!0),V[ue()]=!0,be.stopPropagation()))},W(()=>fe=De(K,1,`corner ${ue()??""}`,"svelte-rvd0k3",fe,{draggable:r.transformable,dragging:V[ue()]&&e(ee)===x()})),u(ke,K)};var J=g(f);oe(J,()=>"top");var D=h(J,2);oe(D,()=>"bottom");var d=h(D,2);oe(d,()=>"left");var L=h(d,2);oe(L,()=>"right");var H=h(L,2);ge(H,()=>"topleft");var ce=h(H,2);ge(ce,()=>"topright");var j=h(ce,2);ge(j,()=>"bottomleft");var ae=h(j,2);ge(ae,()=>"bottomright"),v(f)}W(()=>{te=De(f,1,"boundingbox svelte-rvd0k3",null,te,{movable:r.movable,precise:!r.movable&&!r.transformable}),tt(f,"data-image",x()),_=Pe(f,"",_,{left:`${k().x??""}px`,top:`${k().y??""}px`,width:`${k().width??""}px`,height:`${k().height??""}px`})}),u(l,f)}),v(Y),na(Y,l=>b(N,l),()=>e(N)),W(l=>{je=De(Y,1,"change-area svelte-rvd0k3",null,je,l),le=Pe(Y,"",le,{left:`${e(A).x??""}px`,top:`${e(A).y??""}px`,width:`${e(A).width??""}px`,height:`${e(A).height??""}px`,cursor:r.cursor})},[()=>({debug:Qt(),precise:!r.movable&&!r.transformable})]),u(y,Y),Bt()}oa(["mouseup","mousedown","mousemove"]);var Yr=z("<!><!>",1);function Jr(y,r){qt(r,!0);const i=zt(r,"final",3,"et"),s=zt(r,"key",3,(S,Z)=>Z);var M=$e(),C=X(M);Be(C,19,()=>r.items,(S,Z)=>s()(S,Z),(S,Z,ne)=>{var se=Yr(),N=X(se);dr(N,()=>r.children,()=>e(Z),()=>e(ne));var ie=h(N);{var A=q=>{var Q=We(", ");u(q,Q)},He=q=>{var Q=$e(),G=X(Q);{var B=ee=>{var V=We();W(()=>he(V,` ${i()??""} `)),u(ee,V)};F(G,ee=>{e(ne)===r.items.length-2&&ee(B)},!0)}u(q,Q)};F(ie,q=>{e(ne)<r.items.length-2?q(A):q(He,!1)})}u(S,se)}),u(y,M),Bt()}var Kr=z('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <p class="loading svelte-k3qi6z"> </p>',1),Xr=z("<br/>"),Qr=z('<p class="coucou svelte-k3qi6z" aria-hidden="true"><!></p>'),ei=z("<button><!></button>"),ti=z('<div class="status svelte-k3qi6z"><!></div>'),ai=z('<h1 class="svelte-k3qi6z"> <!></h1>'),ri=z('<h1 class="svelte-k3qi6z"><code>Image introuvable</code></h1>'),ii=z('<div class="confidence-icon svelte-k3qi6z"><!></div>'),oi=z('<span class="sep svelte-k3qi6z">&middot;</span> <!>',1),ni=z('<li><!> <div class="text svelte-k3qi6z"><p class="index"><!></p> <p class="dimensions svelte-k3qi6z"><code> </code> <!></p></div> <div class="actions svelte-k3qi6z"><!> <!> <!></div></li>'),si=z('<li class="boxes-list-hint svelte-k3qi6z"><p class="svelte-k3qi6z"><!> <!></p> <p class="svelte-k3qi6z"> </p></li>'),li=z('<code class="svelte-k3qi6z"> </code>'),ci=z('<div class="bar svelte-k3qi6z"><p class="svelte-k3qi6z"><!></p> <!></div>'),di=z('<div class="confirmed-overlay svelte-k3qi6z"><div class="icon svelte-k3qi6z"><!></div> <p> </p></div> <div class="layout svelte-k3qi6z"><main class="crop-surface svelte-k3qi6z"><div class="behind-image svelte-k3qi6z"><!></div> <img data-testid="crop-subject-image" alt="" class="svelte-k3qi6z"/> <!></main> <aside class="toolbar svelte-k3qi6z"></aside> <aside class="info svelte-k3qi6z"><section class="top svelte-k3qi6z"><section class="preactions svelte-k3qi6z"><!> <!></section> <section class="filename"><!></section> <section class="actions svelte-k3qi6z"><!> <!></section></section> <section class="boxes svelte-k3qi6z"><ul class="svelte-k3qi6z"><!> <!></ul></section> <section class="progress svelte-k3qi6z"><div class="bar svelte-k3qi6z"><p class="svelte-k3qi6z"><!></p> <!></div> <!></section> <nav class="svelte-k3qi6z"><div class="navigation svelte-k3qi6z"><!> <code class="numbers svelte-k3qi6z"> <div class="separator svelte-k3qi6z">⁄</div> </code> <!></div> <div class="continue svelte-k3qi6z"><span class="auto svelte-k3qi6z"><!></span> <!></div></nav></aside></div>',1);function Yi(y,r){qt(r,!0);const i=n(()=>Ea(La("main"))),s=n(()=>Na.params.image||""),M=n(()=>It(e(s),Xe.Image.state)),C=n(()=>e(M).at(0));Fe(()=>hr({title:e(i).t(157,[e(C)?.filename??"..."])})),Ba("setNavbarAppearance")("floating");let S=U(!1),Z=U("Glisser-recadrer");const ne=[{name:"Glisser-recadrer",help:"Cliquer et glisser pour créer une boîte de recadrage",icon:Sr,shortcut:"r",transformable:!0,createMode:"clickanddrag",movable:!0,cursor:"crosshair"},{name:"2 points",help:"Cliquer sur les 2 coins pour créer une boîte de recadrage",icon:Ir,shortcut:"z",transformable:!1,createMode:"2point",movable:!1,cursor:"crosshair"},{name:"4 points",help:"Cliquer sur les 4 extrémités pour créer une boîte de recadrage",icon:fr,shortcut:"Shift+z",transformable:!1,createMode:"4point",movable:!1,cursor:"crosshair"},{name:"Déplacer",help:"Cliquer et glisser pour déplacer la boîte de recadrage",icon:Cr,shortcut:"v",transformable:!1,createMode:"off",movable:!0,cursor:"pointer"},{name:"Main",help:"Cliquer et glisser pour se déplacer dans l'image",icon:qr,shortcut:"h",transformable:!1,createMode:"off",movable:!1,cursor:"grab"}],se=n(()=>ne.filter(({createMode:t})=>t!=="off"));let N=n(()=>ne.find(({name:t})=>t===e(Z))||ne[0]),ie=U("");const A=n(()=>Object.fromEntries(e(M).map(({metadata:t,id:a})=>[a,lr("boundingbox",t[w.cropMetadataId]?.value)]).filter(([,t])=>!!t))),He=n(()=>w.previewURLs.get(e(s))),q=n(()=>ir(Xe.Image.state).toSorted(Ya)),Q=n(()=>{const t=e(q).indexOf(e(s))-1;if(!(t<0))return e(q).at(t)}),G=n(()=>{const t=e(q).indexOf(e(s))+1;if(!(t>=e(q).length))return e(q).at(t)}),B=n(()=>{const t=e(q).slice(e(q).indexOf(e(s))+1).filter(a=>!le(a)).at(0);return t||e(q).find(a=>!le(a))}),ee=n(()=>e(q).filter(je).length),V=n(()=>e(q).filter(le).length),Y=n(()=>Object.fromEntries(e(M).map(t=>{if(!t.metadata[w.cropMetadataId])return[t.id,void 0];const{alternatives:a,value:o,confidence:c,manuallyModified:m}=t.metadata[w.cropMetadataId];if(a&&Object.entries(a).length>0){const[[p,$]]=Object.entries(a);return[t.id,{value:JSON.parse(p),confidence:$}]}return m?[t.id,void 0]:[t.id,{value:o,confidence:c}]})));function je(t){return It(t).every(a=>w.cropMetadataId in a.metadata)}function le(t){return t?It(t).every(Ee):!1}function Ee(t){const a=w.currentProtocol?.crop?.confirmationMetadata;return a?a in t.metadata&&t.metadata[a].value:!1}async function Ze(t,a){const o=w.cropConfirmationMetadataId;if(!o)return;const c=w.currentProtocol;if(!c)throw new Error("No protocol selected");await Qe({db:qe(),metadataId:o,subjectId:t,type:"boolean",manuallyModified:!0,value:a,protocol:c})}async function ze(t){if(!w.cropConfirmationMetadataId){aa.error(e(i).t(51));return}for(const a of e(M))await Ze(a.id,t)}async function Le(t){const a=e(Y)[t];if(!a){aa.error(e(i).t(120,[t]));return}const o=w.currentProtocol;if(!o)throw new Error("No protocol selected");await Qe({db:qe(),subjectId:t,metadataId:w.cropMetadataId,type:"boundingbox",manuallyModified:!1,protocol:o,...a}),w.classificationMetadataId&&await Mt({db:qe(),metadataId:w.classificationMetadataId,subjectId:t})}const Se=n(()=>Object.fromEntries(e(M).map(t=>{const a=e(Y)[t.id]?.value,o=t.metadata[w.cropMetadataId]?.value;return[t.id,a&&cr("boundingbox",o)&&!Wa(a,o)]}))),at=n(()=>Object.values(e(Y)).every(t=>!t)||Object.values(e(Se)).some(Boolean));async function l(){if(Object.values(e(Y)).every(t=>!t))for(const{id:t}of e(M))await I(t);else for(const{id:t}of e(M))await Le(t)}async function I(t){e(M).length===1?await Mt({db:qe(),metadataId:w.cropMetadataId,subjectId:t}):await Xe.Image.remove(t)}async function P(t,a,o=!0){if(!a)return t&&await Ze(t,!0),t;const c=o&&!!w.cropConfirmationMetadataId&&e(M).filter(Ee).length===e(M).length-1,m=ea().cropAutoNext&&Ua(a)&&(e(N).createMode!=="clickanddrag"||!je(e(s))),p=t?e(M).find(O=>O.id===t):void 0,$=p?.metadata[w.classificationMetadataId];$&&!$.manuallyModified&&await Mt({db:qe(),metadataId:w.classificationMetadataId,subjectId:p.id});let R="";const T=w.currentProtocol;if(!T)throw new Error("No protocol selected");return t?await Qe({db:qe(),protocol:T,metadataId:w.cropMetadataId,subjectId:t,type:"boundingbox",value:yt(a),confidence:1,alternatives:e(Y)[t]?[e(Y)[t]]:void 0,manuallyModified:!0}):e(M).length===1&&e(C)&&!e(C).metadata[w.cropMetadataId]?(R=e(C).id,await Qe({protocol:T,db:qe(),metadataId:w.cropMetadataId,subjectId:R,type:"boundingbox",value:yt(a),confidence:1,manuallyModified:!0,alternatives:[]})):(R=tr(e(s),Math.max(...e(M).map(({id:O})=>ar(O).subindex))+1),await Xe.Image.set({id:R,filename:e(C)?.filename??"",addedAt:rr(e(C)?.addedAt??new Date),contentType:e(C)?.contentType??"",dimensions:Re(e(C)?.dimensions)??{width:0,height:0},fileId:e(s),metadata:{[w.cropMetadataId]:{value:JSON.stringify(yt(a)),confidence:1,manuallyModified:!0,alternatives:{}},[w.cropConfirmationMetadataId]:{value:"true",confidence:1,manuallyModified:!0,alternatives:{}}}})),b(L,!1),await ze(!0),_.manual||(_.imageId=R||t),c&&(b(S,!0),await new Promise(O=>setTimeout(O,500)),b(S,!1)),m&&await ye(e(B)?`#/crop/${e(B)}`:"#/classify",{invalidateAll:!0}),R}async function x(){const t=e(M).map(a=>[a,e(A)[a.id]]);for(const[a,o]of t)await P(a.id,o?wt(o):void 0);await ye(e(B)?`#/crop/${e(B)}`:"#/classify")}async function k(){const t=Re(e(G));await er(e(s)),await ye(e(G)?`#/crop/${t}`:"#/import")}function f(t){if(!e(C))return[0,0];const a=Ct({x:e(C).dimensions.width,y:e(C).dimensions.height}),{w:o,h:c}=At(a(t),Math.round);return[o,c]}function te(){w.imagePreviouslyOpenedInCropper=e(s),ye("/crop")}Fe(()=>{w.imageOpenedInCropper=e(s)});let _=ve({imageId:null,manual:!1});Qa("cropping",{ArrowLeft:{help:e(i).t(106),when:()=>!!e(Q),do:()=>ye(`#/crop/${e(Q)}`)},"Shift+Space":{help:e(i).t(106),when:()=>!!e(Q),do:()=>ye(`#/crop/${e(Q)}`)},ArrowRight:{help:e(i).t(107),when:()=>!!e(G),do:()=>ye(`#/crop/${e(G)}`)},Space:{help:e(i).t(71),do:x},"$mod+Delete":{help:e(i).t(173),do:k},Escape:{help:e(i).t(152),do:te},a:{help:e(i).t(27),do:async()=>nr("cropAutoNext")},Delete:{help:e(i).t(171),when:()=>!!_.imageId,async do(){_.imageId&&(await I(_.imageId),_.manual?_.imageId=null:_.imageId=e(M).toReversed().find(t=>t.id in e(A))?.id??null)}},f:{help:e(i).t(47),when:()=>!!_,do(){_&&(_.imageId===e(ie)?b(ie,""):_.imageId&&b(ie,_.imageId,!0))}},u:{help:e(i).t(161),when:()=>!!e(Se)[e(s)],do:()=>{e(Se)[e(s)]&&Le(e(s))}},"$mod+u":{help:e(i).t(162),when:()=>Object.keys(e(A)).length>0,do:l},ArrowUp:{help:e(i).t(128),when:()=>!le(e(s)),do:()=>ze(!0)},ArrowDown:{help:e(i).t(130),when:()=>le(e(s)),do:()=>ze(!1)},"+":{help:e(i).t(194),do:()=>{e(d).scale=Oe(1,e(d).scale+4*e(H),10)}},"-":{help:e(i).t(83),do:()=>{e(d).scale=Oe(1,e(d).scale-4*e(H),10)}},Digit0:{help:e(i).t(164),do:()=>{e(d).origin={x:0,y:0},e(d).scale=1}},...Xt(ne.map(t=>[t.shortcut,{help:`Choisir l'outil ${t.name}`,do:()=>{b(Z,t.name,!0)}}])),",":{help:e(i).t(177),do:()=>{const t=Object.keys(e(A)),o=(t.indexOf(_.imageId??"")-1+t.length)%t.length;_.imageId=t[o]}},";":{help:e(i).t(178),do:()=>{const t=Object.keys(e(A)),o=(t.indexOf(_.imageId??"")+1)%t.length;_.imageId=t[o]}},...Xt(Ja(1,10).map(t=>[`Digit${t}`,{help:`Sélectionner la boîte #${t}`,when:()=>Object.keys(e(A)).length>=t,do:()=>{const a=Object.keys(e(A))[t-1];_.imageId===a?(_.imageId=null,_.manual=!1):(_.imageId=a,_.manual=!0)}}]))}),Fe(()=>{_.imageId&&document.querySelector(".boxes li.selected")?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})});let J=U(void 0),D=U(!0);sa(()=>e(s),(t,a)=>{a&&w.cropperZoomStates.set(a,Re(e(d))),b(d,Re(w.cropperZoomStates.get(t))??ia,!0)});let d=U(ve({...ia})),L=n(()=>e(M).every(({metadata:t})=>!t[w.cropMetadataId]?.manuallyModified));const H=n(()=>e(d).scale*.1);var ce=di(),j=X(ce),ae=g(j),oe=g(ae);et(oe,{}),v(ae);var ge=h(ae,2),ke=g(ge,!0);v(ge),v(j);var ue=h(j,2),K=g(ue);K.__mousedown=async t=>{e(N).name!=="Main"&&t.button!==1||(t.preventDefault(),e(d).panning=!0,e(d).panStart={x:t.clientX,y:t.clientY,zoomOrigin:Re(e(d).origin)})},K.__mouseup=async({button:t})=>{e(N).name!=="Main"&&t!==1||(e(d).panning=!1)},K.__mousemove=async({clientX:t,clientY:a})=>{e(d).panning&&(e(d).origin.x=e(d).panStart.zoomOrigin.x+(t-e(d).panStart.x),e(d).origin.y=e(d).panStart.zoomOrigin.y+(a-e(d).panStart.y))};var fe=g(K),be=g(fe);{var Ge=t=>{var a=Kr(),o=X(a);Va(o,()=>({"--size":"2em"})),sr(o.lastChild,{}),v(o);var c=h(o,2),m=g(c,!0);v(c),W(p=>he(m,p),[()=>e(i).t(53)]),u(t,a)},rt=t=>{var a=Qr();{const c=m=>{var p=Xr();u(m,p)};var o=g(a);{let m=n(()=>[c]),p=n(()=>e(i).cx(195));xe(o,{get t(){return e(m)},get x(){return e(p)}})}v(a)}u(t,a)};F(be,t=>{e(D)?t(Ge):t(rt,!1)})}v(fe);var Ve=h(fe,2);let Ot;na(Ve,t=>b(J,t),()=>e(J));var la=h(Ve,2);{var ca=t=>{{let a=n(()=>At(e(ie)?Ka(e(A),e(ie)):e(A),wt)),o=n(()=>e(d).panning?e(N).name==="Main"?"grabbing":"move":e(N).cursor);Gr(t,Sa(()=>e(N),{get imageElement(){return e(J)},get zoom(){return e(d)},get imageFileID(){return e(s)},get boundingBoxes(){return e(a)},get disabled(){return e(d).panning},get cursor(){return e(o)},onchange:(c,m)=>P(c,m),oncreate:c=>P(null,c)}))}};F(la,t=>{e(J)&&t(ca)})}v(K);var it=h(K,2);Be(it,21,()=>ne,t=>t.name,(t,a)=>{var o=ei();o.__click=()=>{b(Z,e(a).name,!0)};let c;var m=g(o);Gt(m,()=>e(a).icon,(p,$)=>{$(p,{})}),v(o),Je(o,(p,$)=>Ke?.(p,$),()=>({text:`${e(a).name}: ${e(a).help}`,keyboard:e(a).shortcut,placement:"right"})),W(p=>{tt(o,"aria-label",p),c=De(o,1,"svelte-k3qi6z",null,c,{active:e(a).name===e(Z)})},[()=>e(i).t(60,[e(a).name])]),u(t,o)}),v(it);var St=h(it,2),ot=g(St),nt=g(ot),Vt=g(nt);{const t=o=>{Pa(o,{})},a=o=>{ja(o,{shortcut:"Escape"})};Jt(Vt,{inline:!0,onclick:te,_w_snippet_1:t,_w_snippet_2:a,children:(o,c)=>{{let m=n(()=>[t,a]),p=n(()=>e(i).cx(1));xe(o,{get t(){return e(m)},get x(){return e(p)}})}},$$slots:{_w_snippet_1:!0,_w_snippet_2:!0,default:!0}})}var da=h(Vt,2);{const t=a=>{Yt(a,{})};Jt(da,{dangerous:!0,onclick:k,help:{text:"Supprimer cette image et passer à la suivante",keyboard:"$mod+Delete"},_w_snippet_3:t,children:(a,o)=>{{let c=n(()=>[t]),m=n(()=>e(i).cx(15));xe(a,{get t(){return e(c)},get x(){return e(m)}})}},$$slots:{_w_snippet_3:!0,default:!0}})}v(nt);var st=h(nt,2),ha=g(st);{var ua=t=>{var a=ai(),o=g(a),c=h(o);{var m=p=>{var $=ti(),R=g($);et(R,{}),v($),Je($,(T,O)=>Ke?.(T,O),()=>"Recadrage confirmé"),u(p,$)};F(c,p=>{le(e(s))&&p(m)})}v(a),W(()=>he(o,`${e(C).filename??""} `)),u(t,a)},va=t=>{var a=ri();u(t,a)};F(ha,t=>{e(C)?t(ua):t(va,!1)})}v(st);var Pt=h(st,2),Dt=g(Pt);{const t=c=>{ra(c,{})};let a=n(()=>e(i).t(162)),o=n(()=>!e(at));kt(Dt,{keyboard:"$mod+U",get help(){return e(a)},onclick:l,get disabled(){return e(o)},_w_snippet_4:t,children:(c,m)=>{{let p=n(()=>[t]),$=n(()=>e(i).cx(11));xe(c,{get t(){return e(p)},get x(){return e($)}})}},$$slots:{_w_snippet_4:!0,default:!0}})}var ga=h(Dt,2);{var fa=t=>{{let a=n(()=>le(e(s))?"ArrowDown":"ArrowUp"),o=n(()=>le(e(s))?"Marquer le recadrage comme non confirmé":"Marquer le recadrage comme confirmé");kt(t,{get keyboard(){return e(a)},onclick:()=>ze(!le(e(s))),get help(){return e(o)},children:(c,m)=>{var p=$e(),$=X(p);{var R=O=>{const Ce=de=>{pr(de,{})};{let de=n(()=>[Ce]),we=n(()=>e(i).cx(7));xe(O,{get t(){return e(de)},get x(){return e(we)}})}},T=O=>{const Ce=de=>{et(de,{})};{let de=n(()=>[Ce]),we=n(()=>e(i).cx(18));xe(O,{get t(){return e(de)},get x(){return e(we)}})}};F($,O=>{le(e(s))?O(R):O(T,!1)})}u(c,p)},$$slots:{default:!0}})}};F(ga,t=>{w.cropConfirmationMetadataId&&t(fa)})}v(Pt),v(ot);var lt=h(ot,2),Ht=g(lt),jt=g(Ht);Be(jt,19,()=>e(M).filter(({id:t})=>t in e(A)),t=>t.id,(t,a,o)=>{const c=n(()=>e(A)[e(a).id]),m=n(()=>e(Y)[e(a).id]),p=n(()=>{const[E,re]=f(e(c));return{w:E,h:re}}),$=n(()=>e(ie)===e(a).id);var R=ni();let T;var O=g(R);{var Ce=E=>{{let re=n(()=>wt(e(c))),Ie=n(()=>w.previewURLs.get(e(a).fileId));Za(E,{get box(){return e(re)},get src(){return e(Ie)},class:"thumb"})}};F(O,E=>{e(a).fileId&&E(Ce)})}var de=h(O,2),we=g(de),gt=g(we);{let E=n(()=>e(i).cx(44)),re=n(()=>[e(o)+1]);xe(gt,{get x(){return e(E)},get a(){return e(re)}})}v(we);var ft=h(we,2),Ae=g(ft),mt=g(Ae);v(Ae),Je(Ae,(E,re)=>Ke?.(E,re),()=>"Dimensions de l'image recadrée (en pixels)");var pt=h(Ae,2);{var _t=E=>{var re=oi(),Ie=h(X(re),2);Da(Ie,{get value(){return e(m).confidence},children:(bt,hi)=>{var xt=ii(),Ca=g(xt);Ta(Ca,{}),v(xt),u(bt,xt)},$$slots:{default:!0}}),u(E,re)};F(pt,E=>{e(m)&&!e(a).metadata[w.cropMetadataId].manuallyModified&&E(_t)})}v(ft),v(de);var Nt=h(de,2),Ft=g(Nt);{var $a=E=>{{let re=n(()=>e($)?"Réafficher les autres boîtes":"Masquer les autres boîtes");Te(E,{get help(){return e(re)},keyboard:"F",onclick:()=>b(ie,e($)?"":e(a).id,!0),get crossout(){return e($)},children:(Ie,bt)=>{$r(Ie,{})},$$slots:{default:!0}})}};F(Ft,E=>{Object.values(e(A)).length>1&&E($a)})}var Ut=h(Ft,2);{let E=n(()=>e(m)?`Revenir au recadrage d'origine 
									(${f(e(m).value).join(" × ")}, ${Kt(e(m).confidence)} de confiance)`:"Recadrage d'origine indisponible"),re=n(()=>!e(Se)[e(a).id]);Te(Ut,{get help(){return e(E)},keyboard:"u",get disabled(){return e(re)},onclick:()=>Le(e(a).id),children:(Ie,bt)=>{ra(Ie,{})},$$slots:{default:!0}})}var za=h(Ut,2);{let E=n(()=>e(i).t(171));Te(za,{get help(){return e(E)},keyboard:"Delete",onclick:async()=>I(e(a).id),children:(re,Ie)=>{Yt(re,{})},$$slots:{default:!0}})}v(Nt),v(R),W(()=>{T=De(R,1,"svelte-k3qi6z",null,T,{unfocused:e(ie)&&e(ie)!==e(a).id,selected:_.imageId===e(a).id}),he(mt,`${e(p).w??""}×${e(p).h??""}`)}),u(t,R)});var ma=h(jt,2);{var pa=t=>{var a=si(),o=g(a),c=g(o);Ha(c,()=>"Pour créer une nouvelle boîte,<wbr /> utilisez les outils");var m=h(c,2);Jr(m,{get items(){return e(se)},key:T=>T.name,final:"ou",children:(T,O)=>{let Ce=()=>O?.().icon,de=()=>O?.().help,we=()=>O?.().shortcut;vr(T,{get text(){return de()},get keyboard(){return we()},children:(gt,ft)=>{var Ae=$e(),mt=X(Ae);Gt(mt,Ce,(pt,_t)=>{_t(pt,{})}),u(gt,Ae)},$$slots:{default:!0}})},$$slots:{default:!0}}),v(o);var p=h(o,2),$=g(p,!0);v(p),v(a),W(R=>he($,R),[()=>e(i).t(225)]),u(t,a)};F(ma,t=>{e(L)&&t(pa)})}v(Ht),v(lt);var ct=h(lt,2);{const t=(a,o=Ne)=>{var c=li(),m=g(c,!0);v(c),W(p=>he(m,p),[()=>Kt(o()/e(q).length)]),u(a,c)};var dt=g(ct),ht=g(dt);{const a=c=>{Ra(c,{})},o=c=>{t(c,()=>e(ee))};var _a=g(ht);{let c=n(()=>[a,o]),m=n(()=>e(i).cx(4));xe(_a,{get t(){return e(c)},get x(){return e(m)}})}v(ht)}var ba=h(ht,2);{let a=n(()=>e(ee)/e(q).length);ta(ba,{alwaysActive:!0,get progress(){return e(a)}})}v(dt);var xa=h(dt,2);{var wa=a=>{var o=ci(),c=g(o);{const $=T=>{et(T,{})},R=T=>{t(T,()=>e(V))};var m=g(c);{let T=n(()=>[$,R]),O=n(()=>e(i).cx(9));xe(m,{get t(){return e(T)},get x(){return e(O)}})}v(c)}var p=h(c,2);{let $=n(()=>e(V)/e(q).length);ta(p,{alwaysActive:!0,get progress(){return e($)}})}v(o),u(a,o)};F(xa,a=>{w.cropConfirmationMetadataId&&a(wa)})}v(ct)}var Et=h(ct,2),ut=g(Et),Lt=g(ut);{let t=n(()=>!e(Q)),a=n(()=>e(i).t(106));Te(Lt,{get disabled(){return e(t)},get help(){return e(a)},keyboard:"ArrowLeft",onclick:()=>{e(Q)&&ye("/(app)/(sidepanel)/crop/[image]",{image:e(Q)})},children:(o,c)=>{br(o,{})},$$slots:{default:!0}})}var vt=h(Lt,2),Rt=g(vt),ya=h(Rt,2);v(vt);var ka=h(vt,2);{let t=n(()=>!e(G)),a=n(()=>e(i).t(107));Te(ka,{get disabled(){return e(t)},get help(){return e(a)},keyboard:"ArrowRight",onclick:()=>{e(G)&&ye("/(app)/(sidepanel)/crop/[image]",{image:e(G)})},children:(o,c)=>{wr(o,{})},$$slots:{default:!0}})}v(ut);var Tt=h(ut,2),Ye=g(Tt);{const t=a=>{var o=()=>ea().cropAutoNext,c=m=>or("cropAutoNext",m);{let m=n(()=>e(i).t(40));ur(a,{get value(){return o()},set value(p){c(p)},get label(){return e(m)}})}};var Ia=g(Ye);{let a=n(()=>[t]),o=n(()=>e(i).cx(0));xe(Ia,{get t(){return e(a)},get x(){return e(o)}})}v(Ye),Je(Ye,(a,o)=>Ke?.(a,o),()=>({text:"Passer automatiquement à l'image suivante quand celle-ci est recadrée",keyboard:"A"}))}var Ma=h(Ye,2);{let t=n(()=>e(i).t(129));kt(Ma,{onclick:x,keyboard:"Space",get help(){return e(t)},children:(a,o)=>{Me();var c=We();W(m=>he(c,m),[()=>e(i).t(71)]),u(a,c)},$$slots:{default:!0}})}v(Tt),v(Et),v(St),v(ue),W((t,a)=>{tt(j,"aria-hidden",!e(S)),he(ke,t),tt(Ve,"src",e(He)),Ot=Pe(Ve,"",Ot,{scale:e(d).scale,translate:`${e(d).origin.x??""}px ${e(d).origin.y??""}px`}),he(Rt,`${a??""} `),he(ya,` ${e(q).length??""}`)},[()=>e(i).t(70),()=>e(q).indexOf(e(s))+1]),$t("wheel",K,async t=>{t.preventDefault();let a=e(J).getBoundingClientRect(),o=(t.clientX-a.x)/e(d).scale,c=(t.clientY-a.y)/e(d).scale;e(d).scale=Oe(1,e(d).scale-Ue(t.deltaY)*2*e(H),10),e(d).scale>1?(e(d).origin.x+=Ue(t.deltaY)*e(H)*(o*2-e(J).offsetWidth),e(d).origin.y+=Ue(t.deltaY)*e(H)*(c*2-e(J).offsetHeight)):e(d).origin={x:0,y:0}}),$t("load",Ve,()=>{b(D,!1)}),Oa(Ve),u(y,ce),Bt()}oa(["mousedown","mouseup","mousemove","click"]);export{Yi as component};
