import"./DsnmJJEf.js";import{f as me,a as s,e as q,d as B,g as t,u,n as De,p as Re,c as x,b as He,aw as h,ay as c,r as n,ax as ne,av as ve,l as Oe,a7 as j,a6 as de}from"./CEjrMSr3.js";import{d as je,a as N}from"./CzPTknfj.js";import{r as be,p as C,i as f}from"./BQwRB0hY.js";import{c as Fe}from"./Dz5Bnrn_.js";import{e as Ge,i as Je}from"./B5t4nw1a.js";import{a as ee,t as te}from"./DLjgCAwv.js";import{a as ae,C as he,b as Ke,s as ce,c as Ne,_ as Qe,g as Ue}from"./CFKIlU8F.js";import{b as Ve}from"./DCzt9psv.js";import{b as Xe}from"./C7fIX-p5.js";import{R as fe}from"./KtucAqHY.js";import{D as Ye}from"./BtwpRPni.js";import{I as Ze}from"./DdYGOKw-.js";import"./69_IOA4Y.js";import{B as _e}from"./AyPaKyzk.js";import{s as $e}from"./Bt4b35Jj.js";import{e as et}from"./BKifaK91.js";import{C as tt}from"./C4o8AgFE.js";import{L as ue}from"./42xSxnnI.js";import{L as at}from"./B-ei7I0U.js";var st=me('<svg><path fill="currentColor" d="M8 7v4L2 6l6-5v4h5a8 8 0 1 1 0 16H4v-2h9a6 6 0 0 0 0-12z"></path></svg>');function rt(z,e){const b=be(e,["$$slots","$$events","$$legacy"]);var L=st();ae(L,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...b})),s(z,L)}var ot=me('<svg width="1.2em" height="1.2em" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 8L5.5 11.5L13 4" stroke="currentColor" stroke-linecap="round"></path></svg>');function it(z){var e=ot();s(z,e)}function ge(z,e){const b=C(e,"children",3,void 0),L=C(e,"tag",3,"article"),I=u(()=>!!e.onclick);var i=q(),M=B(i);et(M,L,!1,(W,A)=>{ae(W,()=>({class:"card",onclick:e.onclick,tabindex:t(I)?0:void 0,[he]:{clickable:t(I)}}),void 0,void 0,"svelte-2gevwt");var F=q(),G=B(F);$e(G,()=>b()??De),s(A,F)}),s(z,i)}var lt=x('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),nt=x('<section class="errored-actions svelte-pa7bo1"><!> <!></section>'),vt=x('<div class="loading-overlay svelte-pa7bo1"><!> <span class="text smol svelte-pa7bo1"><!></span> <!></div>'),dt=x('<img class="svelte-pa7bo1"/>'),ct=x('<div class="img-placeholder svelte-pa7bo1"><!></div>'),ft=x('<div data-testid="card-observation-bounding-box" class="bb svelte-pa7bo1"></div>'),_t=x('<div class="inner svelte-pa7bo1"><!> <div><!> <!></div> <footer class="svelte-pa7bo1"><div class="check-icon svelte-pa7bo1"><!></div> <h2 class="svelte-pa7bo1"> </h2> <button class="stack-count svelte-pa7bo1"> </button></footer></div>'),ut=x('<div class="stack-background-card svelte-pa7bo1"><!></div>'),gt=x('<article><div class="main-card svelte-pa7bo1"><!></div> <!></article>');function Pt(z,e){Re(e,!0);const b=u(()=>Qe(Ue("main")));let L=C(e,"selected",3,!1),I=C(e,"selectable",3,!0),i=C(e,"status",7),M=C(e,"loadingStatusText",7),W=C(e,"stacksize",3,1),A=C(e,"boundingBoxes",19,()=>[]),F=be(e,["$$slots","$$events","$$legacy","onclick","onstacksizeclick","ondelete","onretry","title","image","selected","selectable","highlighted","status","statusText","loadingStatusText","stacksize","boundingBoxes","boxes","tooltip","id"]);const G=u(()=>W()>1),J=u(()=>i()==="loading"||i()==="queued"),xe=u(()=>i()==="errored"),ke=u(()=>i()==="loading"?t(b).t(59):i()==="queued"?t(b).t(85):i()==="errored"?t(b).t(87):"");let Q=ne(void 0),se=ne(0),pe=u(()=>t(se)<t(Q)?.scrollWidth);var E=gt();ae(E,()=>({class:"observation","data-selectable":I()?"":void 0,"data-id":e.id,...F,[he]:{selected:L(),selectable:I(),highlighted:e.highlighted,loading:t(J),stacked:t(G)}}),void 0,void 0,"svelte-pa7bo1");var U=c(E),we=c(U);ge(we,{tag:"div",onclick:g=>{t(J)||t(xe)||g instanceof MouseEvent&&e.onclick?.(g,_=>{_.status&&i(_.status),_.loadingStatusText&&M(_.loadingStatusText)})},children:(g,_)=>{var P=_t(),re=c(P);{var ze=a=>{var r=vt(),k=c(r);{var R=o=>{var l=lt(),w=B(l);Fe(w,()=>({"--size":"1.5em"})),at(w.lastChild,{variant:"error"}),n(w),s(o,l)},p=o=>{var l=q(),w=B(l);{var X=y=>{ue(y,{})},Y=y=>{var m=q(),S=B(m);{var d=O=>{ue(O,{waiting:!0})};f(S,O=>{i()==="queued"&&O(d)},!0)}s(y,m)};f(w,y=>{i()==="loading"?y(X):y(Y,!1)},!0)}s(o,l)};f(k,o=>{i()==="errored"?o(R):o(p,!1)})}var v=h(k,2),H=c(v);{var We=o=>{var l=de();j(()=>N(l,M())),s(o,l)},Ae=o=>{var l=de();j(()=>N(l,e.statusText||t(ke))),s(o,l)};f(H,o=>{i()==="loading"&&M()?o(We):o(Ae,!1)})}n(v);var Ee=h(v,2);{var Pe=o=>{var l=nt(),w=c(l);{var X=m=>{{const S=d=>{Ye(d,{})};_e(m,{dangerous:!0,onclick:d=>{d.stopPropagation(),e.ondelete()},_w_snippet_0:S,children:(d,O)=>{{let Z=u(()=>[S]),$=u(()=>t(b).cx(15));fe(d,{get t(){return t(Z)},get x(){return t($)}})}},$$slots:{_w_snippet_0:!0,default:!0}})}};f(w,m=>{e.ondelete&&m(X)})}var Y=h(w,2);{var y=m=>{{const S=d=>{rt(d,{})};_e(m,{onclick:d=>{d.stopPropagation(),e.onretry()},_w_snippet_1:S,children:(d,O)=>{{let Z=u(()=>[S]),$=u(()=>t(b).cx(14));fe(d,{get t(){return t(Z)},get x(){return t($)}})}},$$slots:{_w_snippet_1:!0,default:!0}})}};f(Y,m=>{!t(J)&&e.onretry&&m(y)})}n(l),s(o,l)};f(Ee,o=>{(e.ondelete||e.onretry)&&o(Pe)})}n(r),s(a,r)};f(re,a=>{i()!=="ok"&&a(ze)})}var K=h(re,2);let oe;var ie=c(K);{var Se=a=>{var r=q(),k=B(r);{var R=v=>{tt(v,{blurfill:!0,get src(){return e.image},get alt(){return e.title},get box(){return A()[0]}})},p=v=>{var H=dt();j(()=>{ce(H,"src",e.image),ce(H,"alt",e.title)}),s(v,H)};f(k,v=>{e.boxes==="apply-first"&&A().length>0?v(R):v(p,!1)})}s(a,r)},Be=a=>{var r=ct(),k=c(r);Ze(k,{}),n(r),s(a,r)};f(ie,a=>{e.image?a(Se):a(Be,!1)})}var Le=h(ie,2);{var Te=a=>{var r=q(),k=B(r);Ge(k,17,A,Je,(R,p)=>{var v=ft();j(()=>Ne(v,`left: ${t(p).x*100}%; top: ${t(p).y*80}%; width: ${t(p).width*100}%; height: ${80*t(p).height}%;`)),s(R,v)}),s(a,r)};f(Le,a=>{e.boxes==="show-all"&&a(Te)})}n(K);var le=h(K,2),V=c(le),qe=c(V);it(qe),n(V);var T=h(V,2),Ie=c(T,!0);n(T),Xe(T,a=>ve(Q,a),()=>t(Q)),Oe(()=>Ve(T,"offsetWidth",a=>ve(se,a))),ee(T,(a,r)=>te?.(a,r),()=>t(pe)?e.title:void 0);var D=h(T,2);D.__click=a=>{a.stopPropagation(),e.onstacksizeclick?.()};var Me=c(D,!0);n(D),ee(D,(a,r)=>te?.(a,r),()=>`Cette observation regroupe ${W()} images. Cliquez pour les voir toutes.`),n(le),n(P),j(()=>{oe=Ke(K,1,"boundingboxes-wrapper svelte-pa7bo1",null,oe,{"has-boxes":e.boxes==="show-all"}),N(Ie,e.title),D.disabled=t(J),N(Me,W())}),s(g,P)},$$slots:{default:!0}}),n(U);var ye=h(U,2);{var Ce=g=>{var _=ut(),P=c(_);ge(P,{tag:"div"}),n(_),s(g,_)};f(ye,g=>{t(G)&&g(Ce)})}n(E),ee(E,(g,_)=>te?.(g,_),()=>e.tooltip),s(z,E),He()}je(["click"]);export{Pt as C};
