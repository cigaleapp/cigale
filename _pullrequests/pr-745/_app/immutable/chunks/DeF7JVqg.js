import{ax as i,az as l,g as e,av as r,u as o}from"./CEjrMSr3.js";import{t as n,m as f,M as I}from"./Ckf_cnrE.js";import{S as d,a as h}from"./D06_6yfI.js";import{g}from"./CRLHZjzi.js";import{g as M,s as m,a as p}from"./C4k7jWy3.js";class P{#t=i(l({files:[],total:0,done:0,time:0,task:"",get progress(){return this.total?this.done/this.total:0},removeFile(t){const s=this.files.findIndex(a=>a.id===t);s!==-1&&this.files.splice(s,1)},reset(){this.total=0,this.done=0,this.time=0,this.task=""}}));get processing(){return e(this.#t)}set processing(t){r(this.#t,t,!0)}#e=i(l([]));get selection(){return e(this.#e)}set selection(t){r(this.#e,t,!0)}#r=i("");get imageOpenedInCropper(){return e(this.#r)}set imageOpenedInCropper(t){r(this.#r,t,!0)}#s=i("");get imagePreviouslyOpenedInCropper(){return e(this.#s)}set imagePreviouslyOpenedInCropper(t){r(this.#s,t,!0)}previewURLs=new d;erroredImages=new d;loadingImages=new h;queuedImages=new h;#o=i(l({}));get keybinds(){return e(this.#o)}set keybinds(t){r(this.#o,t,!0)}cropperZoomStates=new d;#i=i(void 0);get setSelection(){return e(this.#i)}set setSelection(t){r(this.#i,t,!0)}#a=i("");get _currentProtocolId(){return e(this.#a)}set _currentProtocolId(t){r(this.#a,t,!0)}cropMetadataValueOf(t){return g(t,"boundingbox",this.cropMetadataId)}#n=o(()=>n.Protocol.state.find(t=>t.id===this.currentProtocolId));get currentProtocol(){return e(this.#n)}set currentProtocol(t){r(this.#n,t)}#c=o(()=>this._currentProtocolId||localStorage.getItem("currentProtocolId")||"");get currentProtocolId(){return e(this.#c)}set currentProtocolId(t){r(this.#c,t)}setCurrentProtocolId(t){localStorage.setItem("currentProtocolId",t),this._currentProtocolId=t}#l=o(()=>n.Metadata.state.find(t=>this.currentProtocol?.metadata.includes(t.id)&&this.currentProtocol?.crop?.metadata===t.id)?.id??"crop");get cropMetadataId(){return e(this.#l)}set cropMetadataId(t){r(this.#l,t)}#d=o(()=>n.Metadata.state.find(t=>this.currentProtocol?.metadata.includes(t.id)&&this.currentProtocol?.crop?.confirmationMetadata===t.id)?.id??"");get cropConfirmationMetadataId(){return e(this.#d)}set cropConfirmationMetadataId(t){r(this.#d,t)}hasPreviewURL(t){return t?this.previewURLs.has(t):!1}setPreviewURL(t,s){console.debug("setPreviewURL",{imageFileId:t,url:s}),t&&this.previewURLs.set(t,s)}#u=o(()=>n.Metadata.state.find(t=>t.id===this.classificationMetadataId)?.infer?.neural??[]);get classificationModels(){return e(this.#u)}set classificationModels(t){r(this.#u,t)}#h=o(()=>this.currentProtocol?.crop?.infer??[]);get cropModels(){return e(this.#h)}set cropModels(t){r(this.#h,t)}#p=o(()=>{const t=this.cropMetadataId;return t?p().protocolModelSelections[this.currentProtocolId]?.[t]??0:-1});get selectedCropModel(){return e(this.#p)}set selectedCropModel(t){r(this.#p,t)}#f=o(()=>{const t=this.classificationMetadataId;return t?p().protocolModelSelections[this.currentProtocolId]?.[t]??0:-1});get selectedClassificationModel(){return e(this.#f)}set selectedClassificationModel(t){r(this.#f,t)}#I=o(()=>this.cropModels.length>0&&this.selectedCropModel!==-1);get cropInferenceAvailable(){return e(this.#I)}set cropInferenceAvailable(t){r(this.#I,t)}#g=o(()=>this.classificationModels.length>0&&this.selectedClassificationModel!==-1);get classificationInferenceAvailable(){return e(this.#g)}set classificationInferenceAvailable(t){r(this.#g,t)}async setModelSelections({classification:t=null,crop:s=null}){if(t===null&&s===null)return;const a={classification:this.classificationMetadataId,crop:this.cropMetadataId};if(!a.classification||!a.crop)return;const u=await M("protocolModelSelections"),c={};t!==null&&t!==this.selectedClassificationModel&&(c[a.classification]=t),s!==null&&s!==this.selectedCropModel&&(c[a.crop]=s),Object.keys(c).length!==0&&await m("protocolModelSelections",{...u,[this.currentProtocolId]:{...u[this.currentProtocolId],...c}})}#M=o(()=>{const t=f.case({id:"string",type:'"enum"',infer:I},({id:s})=>this.currentProtocol?.metadata.includes(s)).default(()=>!1);return n.Metadata.state.find(s=>t(s))?.id});get classificationMetadataId(){return e(this.#M)}set classificationMetadataId(t){r(this.#M,t)}}const O=new P;export{O as u};
