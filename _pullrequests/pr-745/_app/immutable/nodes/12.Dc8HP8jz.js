import"../chunks/DsnmJJEf.js";import{o as L}from"../chunks/DNb_7-rZ.js";import{p as k,g as s,u as n,b as P,i as j,c as T,a as y,ay as w,aw as b,n as F,r as v,aA as q,a6 as D,a7 as S}from"../chunks/CEjrMSr3.js";import{a as C}from"../chunks/CzPTknfj.js";import{p as V,s as R,r as U,i as E}from"../chunks/BQwRB0hY.js";import{c as G}from"../chunks/Dz5Bnrn_.js";import{t as H,f as J}from"../chunks/IkhSBAvL.js";import{_ as K,g as N}from"../chunks/CFKIlU8F.js";import{w as Q}from"../chunks/sX0DUBw3.js";import{A as W}from"../chunks/CHmPELyJ.js";import{B as X}from"../chunks/CSXPGx0M.js";import{t as Y}from"../chunks/DSBtPKP_.js";import{C as Z}from"../chunks/BlmdH1cg.js";import{i as $,a as ee}from"../chunks/C4k7jWy3.js";import{u as t}from"../chunks/DeF7JVqg.js";import{n as x,g as te,a as ae}from"../chunks/DvdFYW7d.js";import{t as O}from"../chunks/Ckf_cnrE.js";import{g as re,e as se}from"../chunks/DrMJCvyF.js";import{L as ie}from"../chunks/B-ei7I0U.js";import{f as A,b as oe,d as ne}from"../chunks/D6DjHfA_.js";import{g as M}from"../chunks/B2FtpkaY.js";import{s as le}from"../chunks/eEn-YRt2.js";function me(h,e){k(e,!0);const d=V(e,"highlighted",3,!1),p=U(e,["$$slots","$$events","$$legacy","fileId","images","highlighted"]),l=n(()=>t.queuedImages.has(e.fileId)?"queued":t.loadingImages.has(e.fileId)?"loading":e.images.some(m=>t.erroredImages.has(m.id))?"errored":"ok"),f=n(()=>{if(s(l)==="errored")return e.images.map(({id:m})=>t.erroredImages.get(m)).filter(x).join("; ");if($())return`${e.fileId} @ ${e.images[0]?.addedAt.toISOString()}`});{let m=n(()=>t.previewURLs.get(e.fileId)),I=n(()=>t.selection.includes(e.fileId)),r=n(()=>e.images.map(a=>t.cropMetadataValueOf(a)?.value).filter(x).map(a=>Y(a)));Z(h,R({get id(){return e.fileId},get title(){return e.images[0].filename},get image(){return s(m)},get selected(){return s(I)},boxes:"show-all",get tooltip(){return s(f)},get status(){return s(l)},get highlighted(){return d()}},()=>p,{get boundingBoxes(){return s(r)}}))}P()}var de=T('<div class="empty svelte-zhpjun"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <p> </p> <!></div>'),ge=T('<section class="observations svelte-zhpjun"><!> <!></section>');function Le(h,e){k(e,!0);const d=n(()=>K(N("main")));le({title:s(d).t(154)});const p=n(()=>[...te(O.Image.state,r=>r.fileId??"").entries()].map(([r,a])=>({id:r,addedAt:new Date(ae(a.map(o=>o.addedAt.getTime()))),name:a[0].filename,virtual:!1,data:a})));j(()=>{t.imageOpenedInCropper=""}),L(()=>{A(O.Image.state.map(({fileId:r})=>r).filter(x).filter(r=>!re(t.currentProtocol,r)))}),Q(()=>t.imagePreviouslyOpenedInCropper,()=>{t.setSelection?.([t.imagePreviouslyOpenedInCropper])});var l=ge(),f=w(l);W(f,{get items(){return s(p)},get sort(){return ee().gallerySort},groups:["Avec détections","Sans détection"],grouping:({data:a})=>a.some(o=>t.cropMetadataValueOf(o))?"Avec détections":"Sans détection",item:(a,o=F,g)=>{let i=()=>g?.().id;{let _=n(()=>i()===t.imagePreviouslyOpenedInCropper),u=n(()=>s(d).t(30));me(a,{get fileId(){return i()},get images(){return o()},boxes:"show-all",get highlighted(){return s(_)},get loadingStatusText(){return s(u)},onretry:()=>{t.erroredImages.delete(i()),A([i()])},ondelete:async()=>{oe(i(),"Cancelled by user"),t.processing.removeFile(i()),await ne(i()),await se(i())},onclick:async(z,c)=>{c({status:"loading",loadingStatusText:"Ouverture…"}),await M("/(app)/(sidepanel)/crop/[image]",{image:i()})}})}},$$slots:{item:!0}});var m=b(f,2);{var I=r=>{var a=de(),o=w(a);G(o,()=>({"--size":"6em"})),ie(o.lastChild,{variant:"empty"}),v(o);var g=b(o,2),i=w(g,!0);v(g);var _=b(g,2);X(_,{onclick:()=>M("/import"),children:(u,z)=>{q();var c=D();S(B=>C(c,B),[()=>s(d).t(108)]),y(u,c)},$$slots:{default:!0}}),v(a),S(u=>C(i,u),[()=>s(d).t(38)]),y(r,a)};E(m,r=>{s(p).length||r(I)})}v(l),H(1,l,()=>J,()=>({duration:100})),y(h,l),P()}export{Le as component};
