import"../chunks/DsnmJJEf.js";import{p as x,g as r,u,b as L,c as C,a7 as T,a as I,aw as q,ay as _,n as B,r as h,e as Z,d as $}from"../chunks/CEjrMSr3.js";import{d as ee,e as O,a as U}from"../chunks/CzPTknfj.js";import{p as V,s as te,r as re,i as D}from"../chunks/BQwRB0hY.js";import{b as W,_ as Y,g as G,s as ae}from"../chunks/CFKIlU8F.js";import{t as ie,f as se}from"../chunks/IkhSBAvL.js";import{A as ne}from"../chunks/CHmPELyJ.js";import{C as H}from"../chunks/BlmdH1cg.js";import{i as le,a as oe}from"../chunks/C4k7jWy3.js";import{u as m}from"../chunks/DeF7JVqg.js";import{s as ue}from"../chunks/Bt4b35Jj.js";import{p as me}from"../chunks/hFci9Gn4.js";import{t as P}from"../chunks/Ckf_cnrE.js";import{e as j}from"../chunks/DrMJCvyF.js";import{i as E,A as z,b as R,d as de}from"../chunks/D6DjHfA_.js";import{L as fe}from"../chunks/B-ei7I0U.js";import{t as ge}from"../chunks/CdFpUUK-.js";import{u as ce}from"../chunks/DvdFYW7d.js";function ve(y,e){x(e,!0);const v=V(e,"highlighted",3,!1),f=re(e,["$$slots","$$events","$$legacy","image","highlighted"]),c=u(()=>m.queuedImages.has(e.image.id)?"queued":m.loadingImages.has(e.image.id)?"loading":m.erroredImages.has(e.image.id)?"errored":"ok"),a=u(()=>{if(r(c)==="errored")return m.erroredImages.get(e.image.id);if(le())return`${e.image.id} @ ${e.image.addedAt.toISOString()}`});{let l=u(()=>m.previewURLs.get(e.image.fileId)),g=u(()=>m.selection.includes(e.image.fileId));H(y,te({get id(){return e.image.fileId},get title(){return e.image.filename},get image(){return r(l)},get selected(){return r(g)},boxes:"show-all",get tooltip(){return r(a)},get status(){return r(c)},get highlighted(){return v()}},()=>f))}L()}var pe=C('<input type="file" multiple class="svelte-1n47qnw"/>'),_e=C('<section role="form"><!> <div class="dragging-overlay svelte-1n47qnw"><p> </p></div> <!></section>');function he(y,e){x(e,!0);const v=u(()=>Y(G("main")));let f=V(e,"dragging",15,!1);function c(t){if(f(!1),!t.dataTransfer)return;t.preventDefault();let i=[];t.dataTransfer.items?i=[...t.dataTransfer.items].map(o=>{if(o.kind==="file")return o.getAsFile()}).filter(o=>!!o):i=[...t.dataTransfer.files];const s=o=>!!(!e.filetypes||!e.filetypes.length||e.filetypes.includes(o.type)||e.filetypes.some(n=>o.name.toLowerCase().endsWith(n)));if(!i.every(s)){e.onunacceptable?.(i);return}e.onfiles?.({event:t,files:i})}var a=_e();let l;var g=_(a);ue(g,()=>e.children??B);var d=q(g,2),b=_(d),w=_(b,!0);h(b),h(d);var F=q(d,2);{var S=t=>{var i=pe();i.__input=s=>{s.currentTarget.files&&e.onfiles?.({event:s,files:[...s.currentTarget.files]})},T(s=>ae(i,"accept",s),[()=>e.filetypes?.join(",")]),I(t,i)};D(F,t=>{e.clickable&&t(S)})}h(a),T(t=>{l=W(a,1,"dropzone svelte-1n47qnw",null,l,{dragging:f(),clickable:e.clickable}),U(w,t)},[()=>r(v).t(80)]),O("dragover",a,t=>{t.dataTransfer&&(t.preventDefault(),f(!0))}),O("drop",a,c),I(y,a),L()}ee(["input"]);var ye=C('<div class="empty-state svelte-1urkjm2"><!> <p> </p></div>'),be=C("<section><!> <!></section>");function Re(y,e){x(e,!0);const v=u(()=>Y(G("main"))),f=u(()=>[...ce(P.Image.state.map(({filename:a,id:l,addedAt:g,fileId:d})=>({id:d??l,addedAt:g,name:a,virtual:!1,data:P.Image.getFromState(l)})),a=>a.id),...m.processing.files.map(({name:a,id:l,addedAt:g})=>({id:l,addedAt:g,name:a,virtual:!0,data:null}))]),c=u(()=>r(f).length===0);{let a=u(()=>r(f).length===0);he(y,{get filetypes(){return z},get clickable(){return r(a)},onfiles:({files:l})=>E(l),onunacceptable:()=>ge.error(r(v).t(385)),children:(l,g)=>{var d=be();let b;var w=_(d);ne(w,{get items(){return r(f)},get sort(){return oe().gallerySort},onemptyclick:async()=>{m.selection.length>0||E(await me({accept:z,multiple:!0}))},item:(i,s=B,o)=>{let n=()=>o?.().id,A=()=>o?.().name;var M=Z(),J=$(M);{var K=p=>{{let k=u(()=>({...s(),fileId:s().fileId}));ve(p,{get image(){return r(k)},ondelete:async()=>{R(n(),"Cancelled by user"),m.processing.removeFile(n()),await j(n())}})}},N=p=>{const k=u(()=>m.erroredImages.get(n())),Q=u(()=>m.queuedImages.has(n()));{let X=u(()=>r(k)?"errored":r(Q)?"queued":"loading");H(p,{get id(){return n()},get title(){return A()},get status(){return r(X)},get tooltip(){return r(k)},image:void 0,ondelete:async()=>{R(n(),"Cancelled by user"),m.processing.removeFile(n()),await de(n()),await j(n())}})}};D(J,p=>{s()&&s().fileId?p(K):p(N,!1)})}I(i,M)},$$slots:{item:!0}});var F=q(w,2);{var S=t=>{var i=ye(),s=_(i);fe(s,{variant:"empty"});var o=q(s,2),n=_(o,!0);h(o),h(i),T(A=>U(n,A),[()=>r(v).t(67)]),I(t,i)};D(F,t=>{r(c)&&t(S)})}h(d),T(()=>b=W(d,1,"observations svelte-1urkjm2",null,b,{empty:r(c)})),ie(1,d,()=>se,()=>({duration:100})),I(l,d)},$$slots:{default:!0}})}L()}export{Re as component};
