import{_ as S,a as kt,g as Q,d as zt,s as Dt}from"../chunks/CFKIlU8F.js";import{k as Ht,z as lt,B as it,n as W,t as ft,l as Tt,C as jt,A as St,s as Nt,e as Ut,d as Kt,r as gt}from"../chunks/Ckf_cnrE.js";import{e as $t}from"../chunks/CdUwIIsC.js";import{m as Gt}from"../chunks/CRLHZjzi.js";import{e as Jt}from"../chunks/DvdFYW7d.js";import"../chunks/DsnmJJEf.js";import{f as qt,a as m,p as Qt,c as $,d as st,g as t,u as e,a7 as V,b as Wt,ay as v,aw as u,b9 as Xt,r as d,aE as Yt,e as Zt,a6 as te,n as ht}from"../chunks/CEjrMSr3.js";import{a as A,e as ee}from"../chunks/CzPTknfj.js";import{r as Pt,i as nt}from"../chunks/BQwRB0hY.js";import{e as ae}from"../chunks/B5t4nw1a.js";import{t as re,f as oe}from"../chunks/IkhSBAvL.js";import{R as L}from"../chunks/KtucAqHY.js";import{V as se}from"../chunks/BL4DxE0O.js";import{A as ne}from"../chunks/CSZcEuzQ.js";import{D as le}from"../chunks/BtwpRPni.js";import{F as bt,E as wt}from"../chunks/CM2jXWJl.js";import{I as ie}from"../chunks/DdYGOKw-.js";import{p as w}from"../chunks/55T8DwzO.js";import{B as yt}from"../chunks/B6FvvaJA.js";import{B as de}from"../chunks/CSXPGx0M.js";import{F as T}from"../chunks/R3Vzjoc7.js";import{I as xt}from"../chunks/9VRlXIzu.js";import{g as It}from"../chunks/B2FtpkaY.js";import{o as ve}from"../chunks/Cqx5n4CW.js";import{i as ce}from"../chunks/B8cK6Xik.js";import{t as Mt}from"../chunks/CdFpUUK-.js";async function pe({parent:y,params:l}){const s=S(Ht("js"));if(!l.id)throw $t(400,"Protocol ID is required");const{protocol:p,metadata:R}=await y(),E=await lt("MetadataOption",it(W(l.id,l.metadata),l.option));E||$t(404,s.t(371));const P=await Promise.all(Jt(E.cascade??{}).map(async([x,I])=>{const O=W(l.id,x),f=await ft.Metadata.get(O);if(!f)return{metadataId:O};let z;return f.type==="enum"&&(z=await lt("MetadataOption",it(O,I))),{metadataId:O,metadata:f,option:z,value:I}})),N=await Promise.all(p.metadata.flatMap(async x=>{const I=await ft.Metadata.get(W(l.id,x));return I?I.type!=="enum"?[]:(await Tt("MetadataOption",Gt(l.id,x))).filter(f=>f.cascade?.[l.metadata]===E.key).map(f=>({value:f.key,metadataId:I.id,metadata:I,option:f})):[]})).then(x=>x.flat());return{protocol:p,metadata:R,option:E,cascades:P,reverseCascades:N}}const ta=Object.freeze(Object.defineProperty({__proto__:null,load:pe},Symbol.toStringTag,{value:"Module"}));var me=qt('<svg><path fill="currentColor" d="M5 14V5h2v7h7.586V6.586L21 13l-6.414 6.414V14z"></path></svg>');function ue(y,l){const s=Pt(l,["$$slots","$$events","$$legacy"]);var p=me();kt(p,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),m(y,p)}var _e=qt('<svg><path fill="currentColor" d="M14 5H5v2h7v7.586H6.586L13 21l6.414-6.414H14z"></path></svg>');function fe(y,l){const s=Pt(l,["$$slots","$$events","$$legacy"]);var p=_e();kt(p,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),m(y,p)}function j(y){return S(Q("main")),async l=>{if(S(Q("main")),!w.params.metadata||!w.params.option||!w.params.id)return;const s=await lt("MetadataOption",it(jt(w.params.metadata,w.params.id),w.params.option));if(s){try{await y(s,l)}catch(p){p instanceof St&&Mt.error(`Valeur invalide : ${p.summary}`)}await Nt("MetadataOption",s).catch(p=>{const R=S(Q("main"));Mt.error(R.t(251,[Ut(p)]))}),await ce(Kt("Metadata",W(w.params.id,w.params.metadata),"options"))}}}var ge=$('<textarea rows="10"></textarea>'),$e=$('<img class="svelte-128nasq"/>'),he=$('<p class="label-help svelte-128nasq"><!></p>'),be=$('<div class="row svelte-128nasq"><dt class="svelte-128nasq"> </dt> <!> <dd class="svelte-128nasq"> </dd> <!></div>'),we=$('<p class="empty svelte-128nasq"> </p>'),ye=$('<dl class="cascades svelte-128nasq"></dl>'),xe=$('<p class="label-help svelte-128nasq"><!></p>'),Ie=$(" <!>",1),Me=$('<li class="svelte-128nasq"><!></li>'),ke=$('<ul class="reverse-cascades svelte-128nasq"><!></ul>'),qe=$('<div class="split svelte-128nasq"><div class="left svelte-128nasq"><!> <!> <!> <!></div> <div class="right svelte-128nasq"><!> <!></div></div> <h3 class="svelte-128nasq"> </h3> <p class="svelte-128nasq"> </p> <div class="split svelte-128nasq"><div class="left svelte-128nasq"><!></div> <div class="right svelte-128nasq"><!></div></div> <div class="danger"><!></div>',1);function ea(y,l){Qt(l,!0);const s=e(()=>S(Q("main"))),p=e(()=>l.data.cascades),R=e(()=>l.data.reverseCascades),E=e(()=>l.data.metadata),P=e(()=>l.data.option),N=e(()=>t(P).key),x=e(()=>t(P).label),I=e(()=>t(P).description),O=e(()=>t(P).learnMore),f=e(()=>t(P).image);var z=qe(),U=st(z),X=v(U),dt=v(X);{let i=e(()=>t(s).t(352));T(dt,{get label(){return t(i)},children:(n,_)=>{{let a=e(()=>t(s).t(353)),r=e(()=>j((o,c)=>{o.key=c}));xt(n,{get value(){return t(N)},get label(){return t(a)},discreet:!0,get onblur(){return t(r)}})}}})}var vt=u(dt,2);{let i=e(()=>t(s).t(354));T(vt,{get label(){return t(i)},children:(n,_)=>{{let a=e(()=>t(s).t(355)),r=e(()=>j((o,c)=>{o.label=c}));xt(n,{get value(){return t(x)},get label(){return t(a)},discreet:!0,get onblur(){return t(r)}})}}})}var ct=u(vt,2);{let i=e(()=>t(s).t(302));T(ct,{get label(){return t(i)},children:(n,_)=>{var a=ge();Xt(a);var r=e(()=>j((o,{target:c})=>{c instanceof HTMLTextAreaElement&&(o.description=c.value)}));V(()=>zt(a,t(I))),ee("blur",a,function(...o){t(r)?.apply(this,o)}),m(n,a)}})}var Ot=u(ct,2);{let i=e(()=>t(s).t(86)),n=e(()=>t(O)??""),_=e(()=>j((a,r)=>{r?a.learnMore=r:delete a.learnMore}));bt(Ot,{get label(){return t(i)},get value(){return t(n)},get onblur(){return t(_)}})}d(X);var pt=u(X,2),mt=v(pt);{let i=e(()=>t(s).t(356)),n=e(()=>t(f)??""),_=e(()=>j((a,r)=>{r?a.image=r:delete a.image}));bt(mt,{get Icon(){return ie},check:!0,get label(){return t(i)},get value(){return t(n)},get onblur(){return t(_)}})}var Ct=u(mt,2);{var Bt=i=>{var n=$e();V(()=>Dt(n,"src",t(f))),m(i,n)};nt(Ct,i=>{t(f)&&i(Bt)})}d(pt),d(U);var Y=u(U,2),Vt=v(Y,!0);d(Y);var Z=u(Y,2),At=v(Z,!0);d(Z);var tt=u(Z,2),et=v(tt),Et=v(et);T(Et,{get Icon(){return fe},composite:!0,label:n=>{const _=(a,r=ht)=>{var o=he(),c=v(o);{let M=e(()=>[l.data.metadata.label,l.data.option.label]);L(c,{get x(){return r()},n:!0,get a(){return t(M)}})}d(o),m(a,o)};{let a=e(()=>[_]),r=e(()=>t(s).cx(359));L(n,{get t(){return t(a)},get x(){return t(r)}})}},children:(n,_)=>{var a=ye();ae(a,21,()=>t(p),({metadataId:r,metadata:o,option:c,value:M})=>r,(r,o,c,M)=>{let g=()=>t(o).metadataId,K=()=>t(o).metadata,h=()=>t(o).option,at=()=>t(o).value;const F=e(()=>gt(g()));var k=be(),b=v(k),C=v(b,!0);d(b);var G=u(b,2);ne(G,{});var D=u(G,2),q=v(D,!0);d(D);var B=u(D,2);{var J=H=>{{let rt=e(()=>t(s).t(360,[h().label||h().key]));yt(H,{get help(){return t(rt)},onclick:()=>It("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:w.params.id??"",metadata:t(F),option:h().key}),children:(ot,Rt)=>{wt(ot,{})},$$slots:{default:!0}})}};nt(B,H=>{h()&&H(J)})}d(k),V(()=>{A(C,K()?.label||t(F)),A(q,h()?.label||h()?.key||at())}),m(r,k)},r=>{var o=we(),c=v(o,!0);d(o),V(M=>A(c,M),[()=>t(s).t(361)]),m(r,o)}),d(a),m(n,a)}}),d(et);var ut=u(et,2),Ft=v(ut);T(Ft,{get Icon(){return ue},composite:!0,label:n=>{const _=(a,r=ht)=>{var o=xe(),c=v(o);{let M=e(()=>[t(E).label,l.data.option.label]);L(c,{get x(){return r()},n:!0,get a(){return t(M)}})}d(o),m(a,o)};{let a=e(()=>[_]),r=e(()=>t(s).cx(362));L(n,{get t(){return t(a)},get x(){return t(r)}})}},children:(n,_)=>{var a=ke(),r=v(a);se(r,{get items(){return t(R)},children:Yt,$$slots:{default:(o,c)=>{const M=e(()=>c.item),g=e(()=>{const{metadataId:F,metadata:k,option:b,value:C}=t(M);return{metadataId:F,metadata:k,option:b,value:C}}),K=e(()=>gt(t(g).metadataId));var h=Me();{const F=k=>{var b=Zt(),C=st(b);{var G=q=>{var B=Ie(),J=st(B),H=u(J);{let rt=e(()=>t(s).t(360,[t(g).option.label||t(g).option.key]));yt(H,{get help(){return t(rt)},onclick:()=>It("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:w.params.id??"",metadata:t(K),option:t(g).option.key}),children:(ot,Rt)=>{wt(ot,{})},$$slots:{default:!0}})}V(()=>A(J,`${(t(g).option.label||t(g).option.key)??""} `)),m(q,B)},D=q=>{var B=te();V(()=>A(B,t(g).value)),m(q,B)};nt(C,q=>{t(g).option?q(G):q(D,!1)})}m(k,b)};var at=v(h);{let k=e(()=>[F]),b=e(()=>t(s).cx(363)),C=e(()=>[t(g).metadata?.label||t(K)]);L(at,{get t(){return t(k)},get x(){return t(b)},get a(){return t(C)}})}d(h)}m(o,h)}}}),d(a),m(n,a)}}),d(ut),d(tt);var _t=u(tt,2),Lt=v(_t);{const i=n=>{le(n,{})};de(Lt,{danger:!0,onclick:async()=>{await ve(t(N),t(x))},_w_snippet_3:i,children:(n,_)=>{{let a=e(()=>[i]),r=e(()=>t(s).cx(364));L(n,{get t(){return t(a)},get x(){return t(r)}})}},$$slots:{_w_snippet_3:!0,default:!0}})}d(_t),V((i,n)=>{A(Vt,i),A(At,n)},[()=>t(s).t(357),()=>t(s).t(358)]),re(1,U,()=>oe,()=>({duration:100})),m(y,z),Wt()}export{ea as component,ta as universal};
