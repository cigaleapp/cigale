import"../chunks/DsnmJJEf.js";import{o as B}from"../chunks/D6ilWQdm.js";import{A as C,g as o,D as l,B as S,a as M,F as O,i as c,aA as y,aB as b,I as k,K as v,aE as F,aF as P}from"../chunks/DLg_PPZ_.js";import{p as z,s as L,r as T,i as j}from"../chunks/D67Hg_eN.js";import{c as D}from"../chunks/Cmdet9fQ.js";import{t as q,f as R}from"../chunks/CKZ3iiSi.js";import{A as V}from"../chunks/BVsv4-Sq.js";import{B as E}from"../chunks/BPUwB5iN.js";import{t as K}from"../chunks/C8qYVKmu.js";import{C as U}from"../chunks/CxK3DY_r.js";import{u as t,i as G,g as H}from"../chunks/yjQBtq-m.js";import{n as h,a as J,b as N}from"../chunks/Csf0LG85.js";import{t as A}from"../chunks/BCT7fajR.js";import{e as Q,d as W}from"../chunks/BbY4Fv7Y.js";import{L as X}from"../chunks/Bx3yqWKm.js";import{f as _,b as Y,d as Z}from"../chunks/hwqyxWC0.js";import{g as w}from"../chunks/pFYPpK6n.js";import{s as $}from"../chunks/DgdFC4m6.js";import{w as ee}from"../chunks/B6p9bkuE.js";function te(u,e){C(e,!0);const g=z(e,"highlighted",3,!1),d=T(e,["$$slots","$$events","$$legacy","fileId","images","highlighted"]),m=l(()=>t.queuedImages.has(e.fileId)?"queued":t.loadingImages.has(e.fileId)?"loading":e.images.some(n=>t.erroredImages.has(n.id))?"errored":"ok"),p=l(()=>{if(o(m)==="errored")return e.images.map(({id:n})=>t.erroredImages.get(n)).filter(h).join("; ");if(G())return`${e.fileId} @ ${e.images[0]?.addedAt.toISOString()}`});{let n=l(()=>t.previewURLs.get(e.fileId)),a=l(()=>t.selection.includes(e.fileId)),s=l(()=>e.images.map(r=>t.cropMetadataValueOf(r)?.value).filter(h).map(r=>K(r)));U(u,L({get id(){return e.fileId},get title(){return e.images[0].filename},get image(){return o(n)},get selected(){return o(a)},boxes:"show-all",get tooltip(){return o(p)},get status(){return o(m)},get highlighted(){return g()}},()=>d,{get boundingBoxes(){return o(s)}}))}S()}var ae=O('<div class="empty svelte-zhpjun"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <p>Aucune image</p> <!></div>'),re=O('<section class="observations svelte-zhpjun"><!> <!></section>');function we(u,e){C(e,!0),$({title:"Recadrer"});const g=l(()=>[...J(A.Image.state,a=>a.fileId??"").entries()].map(([a,s])=>({id:a,addedAt:new Date(N(s.map(r=>r.addedAt.getTime()))),name:s[0].filename,virtual:!1,data:s})));M(()=>{t.imageOpenedInCropper=""}),B(()=>{_(A.Image.state.map(({fileId:a})=>a).filter(h).filter(a=>!Q(t.currentProtocol,a)))}),ee(()=>t.imagePreviouslyOpenedInCropper,()=>{t.setSelection?.([t.imagePreviouslyOpenedInCropper])});var d=re(),m=y(d);V(m,{get items(){return o(g)},get sort(){return H().gallerySort},groups:["Avec détections","Sans détection"],grouping:({data:s})=>s.some(r=>t.cropMetadataValueOf(r))?"Avec détections":"Sans détection",item:(s,r=k,f)=>{let i=()=>f?.().id;{let I=l(()=>i()===t.imagePreviouslyOpenedInCropper);te(s,{get fileId(){return i()},get images(){return r()},boxes:"show-all",get highlighted(){return o(I)},loadingStatusText:"Analyse…",onretry:()=>{t.erroredImages.delete(i()),_([i()])},ondelete:async()=>{Y(i(),"Cancelled by user"),t.processing.removeFile(i()),await Z(i()),await W(i())},onclick:async()=>w("/(app)/(sidepanel)/crop/[image]",{image:i()})})}},$$slots:{item:!0}});var p=b(m,2);{var n=a=>{var s=ae(),r=y(s);D(r,()=>({"--size":"6em"})),X(r.lastChild,{variant:"empty"}),v(r);var f=b(r,4);E(f,{onclick:()=>w("/import"),children:(i,I)=>{F();var x=P("Importer");c(i,x)},$$slots:{default:!0}}),v(s),c(a,s)};j(p,a=>{o(g).length||a(n)})}v(d),q(1,d,()=>R,()=>({duration:100})),c(u,d),S()}export{we as component};
