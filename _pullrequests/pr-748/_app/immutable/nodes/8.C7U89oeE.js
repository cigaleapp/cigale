import"../chunks/DsnmJJEf.js";import{aC as U,g as e,aD as _,aM as ge,D as v,A as It,a as Te,F as y,bs as Ca,aA as g,aB as d,I as Ee,K as m,t as te,i as l,B as $t,a1 as Aa,aE as X,G as j,J as $e,aV as Et,aF as at,h as he}from"../chunks/DLg_PPZ_.js";import{d as Xt,e as yt,s as Me,r as qa}from"../chunks/9TbOa8jV.js";import{s as Le}from"../chunks/CJd3y8SF.js";import{p as wt,i as Z,r as ue,s as Sa}from"../chunks/D67Hg_eN.js";import{B as Lt,a as Ke,K as za,t as Ye,c as Ba}from"../chunks/Cmdet9fQ.js";import{e as qe,i as Tt}from"../chunks/C4hQLFL9.js";import{h as Oa}from"../chunks/C9plLwmr.js";import{c as Ft}from"../chunks/Dm35MxJ2.js";import{b as je,s as tt,c as Ve,a as me}from"../chunks/BNnFn6yw.js";import{b as ea}from"../chunks/BEYaBP-8.js";import{g as ke}from"../chunks/pFYPpK6n.js";import{p as Da}from"../chunks/BGdIILBs.js";import{c as kt,w as Va,t as gt,b as ja,d as pt,e as Ha}from"../chunks/C8qYVKmu.js";import{B as Re,C as Pa}from"../chunks/DceiQKom.js";import{B as bt}from"../chunks/BPUwB5iN.js";import{C as Ra}from"../chunks/4spNFoJP.js";import{C as Ea}from"../chunks/CK85Hv2l.js";import{w as ta}from"../chunks/B6p9bkuE.js";import{b as La,H as Ae,t as Qe,p as Nt,F as Ta}from"../chunks/BCT7fajR.js";import{c as Se,i as Fe,m as Mt,j as Zt,r as Fa,p as Na}from"../chunks/Csf0LG85.js";import{c as Za,f as Ua,d as Ga,g as _t,h as Wa,p as Ja,j as Ka,k as Ya}from"../chunks/BbY4Fv7Y.js";import{i as Ut,u as k,d as xt,s as Qa,g as Gt,b as Xe,c as Xa,t as er,h as tr}from"../chunks/yjQBtq-m.js";import{L as ar}from"../chunks/jGhSvLm_.js";import{P as Wt}from"../chunks/BidjZCUT.js";import{s as rr}from"../chunks/USdlu_3B.js";import{S as ir,C as or}from"../chunks/BVbUXEB0.js";import{T as sr}from"../chunks/D-5pjMzg.js";import{s as nr}from"../chunks/DgdFC4m6.js";import{t as Jt}from"../chunks/BVoxKip6.js";import{T as Kt}from"../chunks/Di2wCwy7.js";const Yt={origin:{x:0,y:0},scale:1,panning:!1,panStart:{x:0,y:0,zoomOrigin:{x:0,y:0}}};function lr({naturalWidth:c,naturalHeight:a,clientWidth:i,clientHeight:o,clientTop:p,clientLeft:M},x){const O=c/a,J=i/o;let D=0,I=0;return O<J?(D=o*O,I=o):(I=i/O,D=i),x&&(D*=x.scale,I*=x.scale),{width:D,height:I,x:(x?.origin.x??0)+M+(i-D)/2,y:(x?.origin.y??0)+p+(o-I)/2}}class cr{limits={x:0,y:0,width:0,height:0};#e=U("clickanddrag");get createMode(){return e(this.#e)}set createMode(a){_(this.#e,a,!0)}setCreateMode(a){this.createMode=a}#t=U(ge({x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}}));get clickanddrag(){return e(this.#t)}set clickanddrag(a){_(this.#t,a,!0)}#a=U(ge([]));get points(){return e(this.#a)}set points(a){_(this.#a,a,!0)}#r=v(()=>this.createMode==="clickanddrag"?La({x:"number > 0",y:"number > 0",width:"number > 0",height:"number > 0"}).allows(this.clickanddrag):this.createMode=="2point"?this.points.length>=2:this.createMode==="4point"?this.points.length>=4:!1);get ready(){return e(this.#r)}set ready(a){_(this.#r,a)}clamp(a){return{x:Se(a.x,this.limits.x,this.limits.width),y:Se(a.y,this.limits.y,this.limits.height),width:Se(a.width,0,this.limits.width-a.x),height:Se(a.height,0,this.limits.height-a.y)}}#i=v(()=>this.createMode==="clickanddrag"?this.clickanddrag.x:this.createMode==="off"?0:Math.min(...this.points.map(a=>a.x)));get x(){return e(this.#i)}set x(a){_(this.#i,a)}#o=v(()=>this.createMode==="clickanddrag"?this.clickanddrag.y:this.createMode==="off"?0:Math.min(...this.points.map(a=>a.y)));get y(){return e(this.#o)}set y(a){_(this.#o,a)}#s=v(()=>this.createMode==="clickanddrag"?this.clickanddrag.width:this.createMode==="off"?0:Math.max(...this.points.map(a=>a.x))-this.x);get width(){return e(this.#s)}set width(a){_(this.#s,a)}#n=v(()=>this.createMode==="clickanddrag"?this.clickanddrag.height:this.createMode==="off"?0:Math.max(...this.points.map(a=>a.y))-this.y);get height(){return e(this.#n)}set height(a){_(this.#n,a)}registerPoint(a,i){if(this.createMode!=="off"){if(this.createMode==="clickanddrag"){this.clickanddrag={...this.clickanddrag,x:a,y:i};return}this.points.push({x:a,y:i})}}registerMovement(a,i){if(this.createMode!=="clickanddrag")return;const{width:o,height:p}=this.clickanddrag;(o<=0||p<=0)&&(this.clickanddrag.dragDirection={x:Fe(a),y:Fe(i)});const{x:M,y:x}=this.clickanddrag.dragDirection;M>0&&x>0&&(this.clickanddrag.width+=a,this.clickanddrag.height+=i),M<0&&x<0&&(this.clickanddrag.x+=a,this.clickanddrag.y+=i,this.clickanddrag.width-=a,this.clickanddrag.height-=i),M<0&&x>0&&(this.clickanddrag.x+=a,this.clickanddrag.height+=i,this.clickanddrag.width-=a),M>0&&x<0&&(this.clickanddrag.y+=i,this.clickanddrag.width+=a,this.clickanddrag.height-=i)}rect(){return this.clamp({x:this.x,y:this.y,width:this.width,height:this.height})}reset(){this.clickanddrag={x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}},this.points=[]}constructor({limits:a}){this.limits=a,this.clickanddrag={x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}},this.points=[]}}var dr=async({button:c},a,i,o,p,M,x,O,J)=>{if(!a()&&c===0){if(i.setAll(!1),e(o)&&e(p).ready){const D=e(M)(e(p).rect()),I=await x.oncreate?.(D);I&&(e(O)[I]=D),e(p).reset(),_(o,!1)}else x.onchange?.(e(J),e(O)[e(J)]);_(J,"")}},vr=({clientX:c,clientY:a,currentTarget:i,button:o},p,M,x,O,J)=>{if(p()||o!==0||M.createMode==="off")return;const{left:D,top:I}=i.getBoundingClientRect(),[H,G]=[c-D,a-I];(M.movable||M.transformable)&&Object.values(e(x)).some(P=>Va(P,{x:H,y:G}))||(_(O,!0),e(J).registerPoint(H,G))},hr=y("(<!>) × [<!>]",1),ur=y(" <!><br/>",1),mr=y("<!> <br/> &nbsp;&nbsp;&nbsp;dir <!>",1),fr=y(" <!> <br/>",1),gr=y("<br/> <!>",1),pr=y('<code class="debug">bbs <br/> <!> <!></code>'),br=y('<div class="boundingbox-point new svelte-rvd0k3"></div>'),_r=y('<div class="boundingbox new svelte-rvd0k3"></div>'),xr=({button:c},a,i,o,p,M)=>{c===0&&(a()||(_(i,o(),!0),p.movable&&M.setAll(!0)))},yr=(c,a,i,o,p,M,x)=>{c.button===0&&(a()||i.transformable&&(_(o,p(),!0),M[x()]=!0,c.stopPropagation()))},wr=y("<div></div>"),kr=(c,a,i,o,p,M,x)=>{c.button===0&&(a()||i.transformable&&(_(o,p(),!0),M[x()]=!0,c.stopPropagation()))},Mr=y("<div></div>"),Ir=y("<div><!> <!> <!> <!> <!> <!> <!> <!></div>"),$r=y("<div><!> <!> <!></div>");function Cr(c,a){It(a,!0);let i=wt(a,"disabled",3,!1),o=U(ge(a.boundingBoxes));ta(()=>a.boundingBoxes,s=>{_(o,s,!0)});let p=U(ge(a.imageElement.clientWidth)),M=U(ge(a.imageElement.clientHeight)),x=U(ge(a.imageElement.clientLeft)),O=U(ge(a.imageElement.clientTop)),J=U(ge(a.imageElement.naturalWidth)),D=U(ge(a.imageElement.naturalHeight)),I=U(void 0);const H=async()=>{a.imageElement&&((s=>{_(p,s.clientWidth,!0),_(M,s.clientHeight,!0),_(x,s.clientLeft,!0),_(O,s.clientTop,!0),_(J,s.naturalWidth,!0),_(D,s.naturalHeight,!0)})(a.imageElement),await Aa())};Te(()=>{a.imageElement.addEventListener("load",H);const s=new ResizeObserver(async(Y,w)=>{if(!a.imageElement){w.disconnect();return}await H()}),q=new MutationObserver(async(Y,w)=>{if(!a.imageElement){w.disconnect();return}await H()});return s.observe(a.imageElement),q.observe(a.imageElement,{attributes:!0,attributeFilter:["src"]}),()=>{s.disconnect(),q.disconnect()}});const G=v(()=>lr({clientHeight:e(M),clientWidth:e(p),naturalHeight:e(D),naturalWidth:e(J),clientTop:e(O),clientLeft:e(x)},a.zoom)),P=v(()=>kt({x:e(G).width,y:e(G).height})),K=v(()=>kt({x:1/e(G).width,y:1/e(G).height})),ee=v(()=>Mt(e(o),e(P)));let ne=U(!1),L=v(()=>new cr({limits:{x:0,y:0,width:e(G).width,height:e(G).height}}));Te(()=>e(L).setCreateMode(a.createMode));let ae=U(""),$=ge({topleft:!1,topright:!1,bottomleft:!1,bottomright:!1,get left(){return this.topleft&&this.bottomleft},set left(s){this.topleft=s,this.bottomleft=s},get right(){return this.topright&&this.bottomright},set right(s){this.topright=s,this.bottomright=s},get top(){return this.topleft&&this.topright},set top(s){this.topleft=s,this.topright=s},get bottom(){return this.bottomleft&&this.bottomright},set bottom(s){this.bottomleft=s,this.bottomright=s},setAll(s){this.topleft=s,this.topright=s,this.bottomleft=s,this.bottomright=s},isAll(s){return this.topleft===s&&this.topright===s&&this.bottomleft===s&&this.bottomright===s}});var fe=$r();yt("mousemove",Ca,({target:s})=>{s instanceof Element&&e(ne)&&a.createMode==="clickanddrag"&&s.closest(".change-area")!==e(I)&&(console.warn("Dragging has gone outside change area, bailing out. Target is",s),$.setAll(!1),_(ne,!1),e(L).reset())});let le;fe.__mouseup=[dr,i,$,ne,L,K,a,o,ae],fe.__mousedown=[vr,i,a,ee,ne,L],fe.__mousemove=({movementX:s,movementY:q,button:Y})=>{if(i()||Y!==0)return;const{x:w,y:C}=e(K)({x:s,y:q,w:0,h:0});if(e(ne)&&a.createMode==="clickanddrag"){e(L).registerMovement(s,q);return}const f=e(o)[e(ae)];if($.isAll(!0)){f.x+=w,f.y+=C;return}if($.left){f.x+=w,f.width-=w;return}if($.right){f.width+=w;return}if($.top){f.y+=C,f.height-=C;return}if($.bottom){f.height+=C;return}$.topleft&&(f.x+=w,f.y+=C,f.width-=w,f.height-=C),$.topright&&(f.y+=C,f.width+=w,f.height-=C),$.bottomleft&&(f.x+=w,f.width-=w,f.height+=C),$.bottomright&&(f.width+=w,f.height+=C)};let He;var Pe=g(fe);{var ze=s=>{var q=pr();Ve(q,"",{},{color:"red"});{const T=(h,S=Ee,V=Ee)=>{X();var F=at();te((W,N)=>Me(F,`${W??""} ${N??""}`),[()=>Math.round(S()),()=>Math.round(V())]),l(h,F)},be=(h,S)=>{let V=()=>S?.().x,F=()=>S?.().y,W=()=>S?.().width,N=()=>S?.().height;X();var re=hr(),Q=d(j(re));T(Q,V,F);var ie=d(Q,2);T(ie,W,N),X(),l(h,re)};var Y=d(g(q),3);qe(Y,17,()=>Object.entries(e(ee)),([h,S])=>h,(h,S)=>{var V=v(()=>Et(e(S),2));let F=()=>e(V)[0],W=()=>e(V)[1];X();var N=ur(),re=j(N),Q=d(re);be(Q,W),X(),te(()=>Me(re,`@${F()??""} `)),l(h,N)});var w=d(Y),C=d(w);{var f=h=>{var S=mr(),V=j(S);be(V,()=>e(L).clickanddrag);var F=d(V,4);T(F,()=>e(L).clickanddrag.dragDirection.x,()=>e(L).clickanddrag.dragDirection.y),l(h,S)},b=h=>{var S=$e(),V=j(S);{var F=N=>{var re=at("off");l(N,re)},W=N=>{var re=gr(),Q=d(j(re),2);qe(Q,17,()=>e(L).points,Tt,(ie,oe,ce)=>{let pe=()=>e(oe).x,_e=()=>e(oe).y;X();var Ie=fr(),xe=j(Ie);xe.nodeValue=`#${ce} `;var Ze=d(xe);T(Ze,pe,_e),X(2),l(ie,Ie)}),l(N,re)};Z(V,N=>{a.createMode==="off"?N(F):N(W,!1)},!0)}l(h,S)};Z(C,h=>{a.createMode==="clickanddrag"?h(f):h(b,!1)})}m(q),te(()=>Me(w,` create ${e(L).ready?"ready ":""} `))}l(s,q)};Z(Pe,s=>{Ut()&&s(ze)})}var Be=d(Pe,2);{var Oe=s=>{var q=$e(),Y=j(q);qe(Y,17,()=>e(L).points,Tt,(w,C)=>{let f=()=>e(C).x,b=()=>e(C).y;var T=$e(),be=j(T);{var h=S=>{var V=br();let F;te(W=>F=Ve(V,"",F,W),[()=>({left:`${f()??""}px`,top:`${b()??""}px`})]),l(S,V)};Z(be,S=>{f()!==0&&b()!==0&&S(h)})}l(w,T)}),l(s,q)},rt=s=>{var q=$e(),Y=j(q);{var w=C=>{var f=_r();let b;te(T=>b=Ve(f,"",b,T),[()=>({left:`${e(L).x??""}px`,top:`${e(L).y??""}px`,width:`${e(L).width??""}px`,height:`${e(L).height??""}px`})]),l(C,f)};Z(Y,C=>{e(ne)&&a.createMode==="clickanddrag"&&C(w)},!0)}l(s,q)};Z(Be,s=>{a.createMode==="2point"||a.createMode==="4point"?s(Oe):s(rt,!1)})}var Ne=d(Be,2);qe(Ne,17,()=>Object.entries(e(ee)).filter(([s])=>Za(s)===a.imageFileID),([s,q])=>s,(s,q)=>{var Y=v(()=>Et(e(q),2));let w=()=>e(Y)[0],C=()=>e(Y)[1];var f=Ir();let b;f.__mousedown=[xr,i,ae,w,a,$];let T;{const Q=(oe,ce=Ee)=>{var pe=wr();let _e;pe.__mousedown=[yr,i,a,ae,w,$,ce],te(Ie=>_e=je(pe,1,`side ${ce()??""}`,"svelte-rvd0k3",_e,Ie),[()=>({draggable:a.transformable,dragging:$[ce()]&&e(ae)===w()})]),l(oe,pe)},ie=(oe,ce=Ee)=>{var pe=Mr();let _e;pe.__mousedown=[kr,i,a,ae,w,$,ce],te(Ie=>_e=je(pe,1,`corner ${ce()??""}`,"svelte-rvd0k3",_e,Ie),[()=>({draggable:a.transformable,dragging:$[ce()]&&e(ae)===w()})]),l(oe,pe)};var be=g(f);Q(be,()=>"top");var h=d(be,2);Q(h,()=>"bottom");var S=d(h,2);Q(S,()=>"left");var V=d(S,2);Q(V,()=>"right");var F=d(V,2);ie(F,()=>"topleft");var W=d(F,2);ie(W,()=>"topright");var N=d(W,2);ie(N,()=>"bottomleft");var re=d(N,2);ie(re,()=>"bottomright"),m(f)}te((Q,ie)=>{b=je(f,1,"boundingbox svelte-rvd0k3",null,b,Q),tt(f,"data-image",w()),T=Ve(f,"",T,ie)},[()=>({movable:a.movable,precise:!a.movable&&!a.transformable}),()=>({left:`${C().x??""}px`,top:`${C().y??""}px`,width:`${C().width??""}px`,height:`${C().height??""}px`})]),l(s,f)}),m(fe),ea(fe,s=>_(I,s),()=>e(I)),te((s,q)=>{le=je(fe,1,"change-area svelte-rvd0k3",null,le,s),He=Ve(fe,"",He,q)},[()=>({debug:Ut(),precise:!a.movable&&!a.transformable}),()=>({left:`${e(G).x??""}px`,top:`${e(G).y??""}px`,width:`${e(G).width??""}px`,height:`${e(G).height??""}px`,cursor:a.cursor})]),l(c,fe),$t()}Xt(["mouseup","mousedown","mousemove"]);var Ar=y("<!><!>",1);function qr(c,a){It(a,!0);const i=wt(a,"final",3,"et"),o=wt(a,"key",3,(x,O)=>O);var p=$e(),M=j(p);qe(M,19,()=>a.items,(x,O)=>o()(x,O),(x,O,J)=>{var D=Ar(),I=j(D);rr(I,()=>a.children,()=>e(O),()=>e(J));var H=d(I);{var G=K=>{var ee=at(", ");l(K,ee)},P=K=>{var ee=$e(),ne=j(ee);{var L=ae=>{var $=at();te(()=>Me($,` ${i()??""} `)),l(ae,$)};Z(ne,ae=>{e(J)===a.items.length-2&&ae(L)},!0)}l(K,ee)};Z(H,K=>{e(J)<a.items.length-2?K(G):K(P,!1)})}l(x,D)}),l(c,p),$t()}var Sr=he('<svg><path fill="currentColor" d="M232 184a8 8 0 0 1-16 0a88 88 0 0 0-150.22-62.22L43.4 144H88a8 8 0 0 1 0 16H24a8 8 0 0 1-8-8V88a8 8 0 0 1 16 0v44.77l22.48-22.33A104 104 0 0 1 232 184"></path></svg>');function Qt(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Sr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var zr=he('<svg><path fill="currentColor" d="M90.34 61.66a8 8 0 0 1 0-11.32l32-32a8 8 0 0 1 11.32 0l32 32a8 8 0 0 1-11.32 11.32L136 43.31V96a8 8 0 0 1-16 0V43.31l-18.34 18.35a8 8 0 0 1-11.32 0m64 132.68L136 212.69V160a8 8 0 0 0-16 0v52.69l-18.34-18.35a8 8 0 0 0-11.32 11.32l32 32a8 8 0 0 0 11.32 0l32-32a8 8 0 0 0-11.32-11.32m83.32-72l-32-32a8 8 0 0 0-11.32 11.32L212.69 120H160a8 8 0 0 0 0 16h52.69l-18.35 18.34a8 8 0 0 0 11.32 11.32l32-32a8 8 0 0 0 0-11.32M43.31 136H96a8 8 0 0 0 0-16H43.31l18.35-18.34a8 8 0 0 0-11.32-11.32l-32 32a8 8 0 0 0 0 11.32l32 32a8 8 0 0 0 11.32-11.32Z"></path></svg>');function Br(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=zr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var Or=he('<svg><path fill="currentColor" d="M165.66 202.34a8 8 0 0 1-11.32 11.32l-80-80a8 8 0 0 1 0-11.32l80-80a8 8 0 0 1 11.32 11.32L91.31 128Z"></path></svg>');function Dr(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Or();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var Vr=he('<svg><path fill="currentColor" d="M240 192a8 8 0 0 1-8 8h-32v32a8 8 0 0 1-16 0v-32H64a8 8 0 0 1-8-8V72H24a8 8 0 0 1 0-16h32V24a8 8 0 0 1 16 0v160h160a8 8 0 0 1 8 8M96 72h88v88a8 8 0 0 0 16 0V64a8 8 0 0 0-8-8H96a8 8 0 0 0 0 16"></path></svg>');function jr(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Vr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var Hr=he('<svg><path fill="currentColor" d="M128 24a104 104 0 1 0 104 104A104.11 104.11 0 0 0 128 24m8 191.63V184a8 8 0 0 0-16 0v31.63A88.13 88.13 0 0 1 40.37 136H72a8 8 0 0 0 0-16H40.37A88.13 88.13 0 0 1 120 40.37V72a8 8 0 0 0 16 0V40.37A88.13 88.13 0 0 1 215.63 120H184a8 8 0 0 0 0 16h31.63A88.13 88.13 0 0 1 136 215.63"></path></svg>');function Pr(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Hr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var Rr=he('<svg><path fill="currentColor" d="M200 152a31.84 31.84 0 0 0-19.53 6.68l-23.11-18A31.65 31.65 0 0 0 160 128c0-.74 0-1.48-.08-2.21l13.23-4.41A32 32 0 1 0 168 104c0 .74 0 1.48.08 2.21l-13.23 4.41A32 32 0 0 0 128 96a32.6 32.6 0 0 0-5.27.44L115.89 81A32 32 0 1 0 96 88a32.6 32.6 0 0 0 5.27-.44l6.84 15.4a31.92 31.92 0 0 0-8.57 39.64l-25.71 22.84a32.06 32.06 0 1 0 10.63 12l25.71-22.84a31.91 31.91 0 0 0 37.36-1.24l23.11 18A31.65 31.65 0 0 0 168 184a32 32 0 1 0 32-32m0-64a16 16 0 1 1-16 16a16 16 0 0 1 16-16M80 56a16 16 0 1 1 16 16a16 16 0 0 1-16-16M56 208a16 16 0 1 1 16-16a16 16 0 0 1-16 16m56-80a16 16 0 1 1 16 16a16 16 0 0 1-16-16m88 72a16 16 0 1 1 16-16a16 16 0 0 1-16 16"></path></svg>');function Er(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Rr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var Lr=he('<svg><path fill="currentColor" d="M188 48a27.75 27.75 0 0 0-12 2.71V44a28 28 0 0 0-54.65-8.6A28 28 0 0 0 80 60v64l-3.82-6.13a28 28 0 0 0-48.6 27.82c16 33.77 28.93 57.72 43.72 72.69C86.24 233.54 103.2 240 128 240a88.1 88.1 0 0 0 88-88V76a28 28 0 0 0-28-28m12 104a72.08 72.08 0 0 1-72 72c-20.38 0-33.51-4.88-45.33-16.85C69.44 193.74 57.26 171 41.9 138.58a6 6 0 0 0-.3-.58a12 12 0 0 1 20.79-12a2 2 0 0 0 .14.23l18.67 30A8 8 0 0 0 96 152V60a12 12 0 0 1 24 0v60a8 8 0 0 0 16 0V44a12 12 0 0 1 24 0v76a8 8 0 0 0 16 0V76a12 12 0 0 1 24 0Z"></path></svg>');function Tr(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Lr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var Fr=he('<svg><path fill="currentColor" d="M128 24a104 104 0 1 0 104 104A104.11 104.11 0 0 0 128 24m0 192a88 88 0 1 1 88-88a88.1 88.1 0 0 1-88 88m32-72h-8V80a8 8 0 0 0-14.31-4.91l-56 72A8 8 0 0 0 88 160h48v16a8 8 0 0 0 16 0v-16h8a8 8 0 0 0 0-16m-24 0h-31.64L136 103.32Z"></path></svg>');function Nr(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Fr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var Zr=he('<svg><path fill="currentColor" d="M128 24a104 104 0 1 0 104 104A104.11 104.11 0 0 0 128 24m0 192a88 88 0 1 1 88-88a88.1 88.1 0 0 1-88 88m25.56-92.74L120 168h32a8 8 0 0 1 0 16h-48a8 8 0 0 1-6.4-12.8l43.17-57.56a16 16 0 1 0-27.86-15a8 8 0 0 1-15.09-5.34a32 32 0 1 1 55.74 29.93Z"></path></svg>');function Ur(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Zr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var Gr=he('<svg><path fill="currentColor" d="M225.86 102.82c-3.77-3.94-7.67-8-9.14-11.57c-1.36-3.27-1.44-8.69-1.52-13.94c-.15-9.76-.31-20.82-8-28.51s-18.75-7.85-28.51-8c-5.25-.08-10.67-.16-13.94-1.52c-3.57-1.47-7.63-5.37-11.57-9.14C146.27 23.51 138.44 16 128 16s-18.27 7.51-25.18 14.14c-3.94 3.77-8 7.67-11.57 9.14c-3.25 1.36-8.69 1.44-13.94 1.52c-9.76.15-20.82.31-28.51 8s-7.8 18.75-8 28.51c-.08 5.25-.16 10.67-1.52 13.94c-1.47 3.57-5.37 7.63-9.14 11.57C23.51 109.72 16 117.56 16 128s7.51 18.27 14.14 25.18c3.77 3.94 7.67 8 9.14 11.57c1.36 3.27 1.44 8.69 1.52 13.94c.15 9.76.31 20.82 8 28.51s18.75 7.85 28.51 8c5.25.08 10.67.16 13.94 1.52c3.56 1.47 7.63 5.37 11.57 9.14C109.73 232.49 117.56 240 128 240s18.27-7.51 25.18-14.14c3.94-3.77 8-7.67 11.57-9.14c3.27-1.36 8.69-1.44 13.94-1.52c9.76-.15 20.82-.31 28.51-8s7.85-18.75 8-28.51c.08-5.25.16-10.67 1.52-13.94c1.47-3.56 5.37-7.63 9.14-11.57c6.63-6.9 14.14-14.74 14.14-25.18s-7.51-18.27-14.14-25.18m-11.55 39.29c-4.79 5-9.75 10.17-12.38 16.52c-2.52 6.1-2.63 13.07-2.73 19.82c-.1 7-.21 14.33-3.32 17.43s-10.39 3.22-17.43 3.32c-6.75.1-13.72.21-19.82 2.73c-6.35 2.63-11.52 7.59-16.52 12.38S132 224 128 224s-9.14-4.92-14.11-9.69s-10.17-9.75-16.52-12.38c-6.1-2.52-13.07-2.63-19.82-2.73c-7-.1-14.33-.21-17.43-3.32s-3.22-10.39-3.32-17.43c-.1-6.75-.21-13.72-2.73-19.82c-2.63-6.35-7.59-11.52-12.38-16.52S32 132 32 128s4.92-9.14 9.69-14.11s9.75-10.17 12.38-16.52c2.52-6.1 2.63-13.07 2.73-19.82c.1-7 .21-14.33 3.32-17.43s10.39-3.22 17.43-3.32c6.75-.1 13.72-.21 19.82-2.73c6.35-2.63 11.52-7.59 16.52-12.38S124 32 128 32s9.14 4.92 14.11 9.69s10.17 9.75 16.52 12.38c6.1 2.52 13.07 2.63 19.82 2.73c7 .1 14.33.21 17.43 3.32s3.22 10.39 3.32 17.43c.1 6.75.21 13.72 2.73 19.82c2.63 6.35 7.59 11.52 12.38 16.52S224 124 224 128s-4.92 9.14-9.69 14.11"></path></svg>');function Wr(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Gr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var Jr=he('<svg><path fill="currentColor" d="M225.86 102.82c-3.77-3.94-7.67-8-9.14-11.57c-1.36-3.27-1.44-8.69-1.52-13.94c-.15-9.76-.31-20.82-8-28.51s-18.75-7.85-28.51-8c-5.25-.08-10.67-.16-13.94-1.52c-3.56-1.47-7.63-5.37-11.57-9.14C146.28 23.51 138.44 16 128 16s-18.27 7.51-25.18 14.14c-3.94 3.77-8 7.67-11.57 9.14c-3.25 1.36-8.69 1.44-13.94 1.52c-9.76.15-20.82.31-28.51 8s-7.8 18.75-8 28.51c-.08 5.25-.16 10.67-1.52 13.94c-1.47 3.56-5.37 7.63-9.14 11.57C23.51 109.72 16 117.56 16 128s7.51 18.27 14.14 25.18c3.77 3.94 7.67 8 9.14 11.57c1.36 3.27 1.44 8.69 1.52 13.94c.15 9.76.31 20.82 8 28.51s18.75 7.85 28.51 8c5.25.08 10.67.16 13.94 1.52c3.56 1.47 7.63 5.37 11.57 9.14c6.9 6.63 14.74 14.14 25.18 14.14s18.27-7.51 25.18-14.14c3.94-3.77 8-7.67 11.57-9.14c3.27-1.36 8.69-1.44 13.94-1.52c9.76-.15 20.82-.31 28.51-8s7.85-18.75 8-28.51c.08-5.25.16-10.67 1.52-13.94c1.47-3.56 5.37-7.63 9.14-11.57c6.63-6.9 14.14-14.74 14.14-25.18s-7.51-18.27-14.14-25.18m-11.55 39.29c-4.79 5-9.75 10.17-12.38 16.52c-2.52 6.1-2.63 13.07-2.73 19.82c-.1 7-.21 14.33-3.32 17.43s-10.39 3.22-17.43 3.32c-6.75.1-13.72.21-19.82 2.73c-6.35 2.63-11.52 7.59-16.52 12.38S132 224 128 224s-9.15-4.92-14.11-9.69s-10.17-9.75-16.52-12.38c-6.1-2.52-13.07-2.63-19.82-2.73c-7-.1-14.33-.21-17.43-3.32s-3.22-10.39-3.32-17.43c-.1-6.75-.21-13.72-2.73-19.82c-2.63-6.35-7.59-11.52-12.38-16.52S32 132 32 128s4.92-9.15 9.69-14.11s9.75-10.17 12.38-16.52c2.52-6.1 2.63-13.07 2.73-19.82c.1-7 .21-14.33 3.32-17.43s10.39-3.22 17.43-3.32c6.75-.1 13.72-.21 19.82-2.73c6.35-2.63 11.52-7.59 16.52-12.38S124 32 128 32s9.15 4.92 14.11 9.69s10.17 9.75 16.52 12.38c6.1 2.52 13.07 2.63 19.82 2.73c7 .1 14.33.21 17.43 3.32s3.22 10.39 3.32 17.43c.1 6.75.21 13.72 2.73 19.82c2.63 6.35 7.59 11.52 12.38 16.52S224 124 224 128s-4.92 9.15-9.69 14.11m-40.65-43.77a8 8 0 0 1 0 11.32l-56 56a8 8 0 0 1-11.32 0l-24-24a8 8 0 0 1 11.32-11.32L112 148.69l50.34-50.35a8 8 0 0 1 11.32 0"></path></svg>');function et(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Jr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var Kr=he('<svg><path fill="currentColor" d="M152 40a8 8 0 0 1-8 8h-32a8 8 0 0 1 0-16h32a8 8 0 0 1 8 8m-8 168h-32a8 8 0 0 0 0 16h32a8 8 0 0 0 0-16m64-160v24a8 8 0 0 0 16 0V48a16 16 0 0 0-16-16h-24a8 8 0 0 0 0 16Zm8 56a8 8 0 0 0-8 8v32a8 8 0 0 0 16 0v-32a8 8 0 0 0-8-8M40 152a8 8 0 0 0 8-8v-32a8 8 0 0 0-16 0v32a8 8 0 0 0 8 8m32 56H48v-24a8 8 0 0 0-16 0v24a16 16 0 0 0 16 16h24a8 8 0 0 0 0-16m0-176H48a16 16 0 0 0-16 16v24a8 8 0 0 0 16 0V48h24a8 8 0 0 0 0-16m168 176h-16v-16a8 8 0 0 0-16 0v16h-16a8 8 0 0 0 0 16h16v16a8 8 0 0 0 16 0v-16h16a8 8 0 0 0 0-16"></path></svg>');function Yr(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Kr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var Qr=he('<svg><path fill="currentColor" d="M104 40H56a16 16 0 0 0-16 16v48a16 16 0 0 0 16 16h48a16 16 0 0 0 16-16V56a16 16 0 0 0-16-16m0 64H56V56h48zm96-64h-48a16 16 0 0 0-16 16v48a16 16 0 0 0 16 16h48a16 16 0 0 0 16-16V56a16 16 0 0 0-16-16m0 64h-48V56h48zm-96 32H56a16 16 0 0 0-16 16v48a16 16 0 0 0 16 16h48a16 16 0 0 0 16-16v-48a16 16 0 0 0-16-16m0 64H56v-48h48zm96-64h-48a16 16 0 0 0-16 16v48a16 16 0 0 0 16 16h48a16 16 0 0 0 16-16v-48a16 16 0 0 0-16-16m0 64h-48v-48h48z"></path></svg>');function Xr(c,a){const i=ue(a,["$$slots","$$events","$$legacy"]);var o=Qr();me(o,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...i})),l(c,o)}var ei=(c,a,i)=>{_(a,e(i).name,!0)},ti=y("<button><!></button>"),ai=async(c,a,i)=>{e(a).name!=="Main"&&c.button!==1||(c.preventDefault(),e(i).panning=!0,e(i).panStart={x:c.clientX,y:c.clientY,zoomOrigin:Le(e(i).origin)})},ri=async({button:c},a,i)=>{e(a).name!=="Main"&&c!==1||(e(i).panning=!1)},ii=async({clientX:c,clientY:a},i)=>{e(i).panning&&(e(i).origin.x=e(i).panStart.zoomOrigin.x+(c-e(i).panStart.x),e(i).origin.y=e(i).panStart.zoomOrigin.y+(a-e(i).panStart.y))},oi=y(`<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <p class="loading svelte-k3qi6z">Chargement de l'image…</p>`,1),si=y('<p class="coucou svelte-k3qi6z" aria-hidden="true">coucou toi :) <br/> passes une bonne journée ! 💖💖</p>'),ni=y("<!> Autres photos <!>",1),li=y("<!> Supprimer",1),ci=y('<div class="status svelte-k3qi6z"><!></div>'),di=y('<h1 class="svelte-k3qi6z"> <!></h1>'),vi=y('<h1 class="svelte-k3qi6z"><code>Image introuvable</code></h1>'),hi=y("<!> Réinit.",1),ui=y("<!> Invalider",1),mi=y("<!> Valider",1),fi=y('<div class="confidence-icon svelte-k3qi6z"><!></div>'),gi=y('<span class="sep svelte-k3qi6z">&middot;</span> <!>',1),pi=y('<li><!> <div class="text svelte-k3qi6z"><p class="index"> </p> <p class="dimensions svelte-k3qi6z"><code> </code> <!></p></div> <div class="actions svelte-k3qi6z"><!> <!> <!></div></li>'),bi=y(`<li class="boxes-list-hint svelte-k3qi6z"><p class="svelte-k3qi6z"><!> <!></p> <p class="svelte-k3qi6z">Sélectionnez une boîte avec 1 à 9 pour la modifier avec des raccourcis
							clavier</p></li>`),_i=y('<code class="svelte-k3qi6z"> </code>'),xi=y('<div class="bar svelte-k3qi6z"><p class="svelte-k3qi6z"><!> Recadrages confirmés <!></p> <!></div>'),yi=y("<!> Continuer",1),wi=y('<div class="confirmed-overlay svelte-k3qi6z"><div class="icon svelte-k3qi6z"><!></div> <p>Confirmé</p></div> <div class="layout svelte-k3qi6z"><aside class="toolbar svelte-k3qi6z"></aside> <main class="crop-surface svelte-k3qi6z"><div class="behind-image svelte-k3qi6z"><!></div> <img data-testid="crop-subject-image" alt="" class="svelte-k3qi6z"/> <!></main> <aside class="info svelte-k3qi6z"><section class="top svelte-k3qi6z"><section class="preactions svelte-k3qi6z"><!> <!></section> <section class="filename"><!></section> <section class="actions svelte-k3qi6z"><!> <!></section></section> <section class="boxes svelte-k3qi6z"><ul class="svelte-k3qi6z"><!> <!></ul></section> <section class="progress svelte-k3qi6z"><div class="bar svelte-k3qi6z"><p class="svelte-k3qi6z"><!> Images avec recadrage <!></p> <!></div> <!></section> <nav class="svelte-k3qi6z"><div class="navigation svelte-k3qi6z"><!> <code> </code> <!></div> <div class="continue svelte-k3qi6z"><span class="auto svelte-k3qi6z"><!> Auto</span> <!></div></nav></aside></div>',1);function to(c,a){It(a,!0);const i=v(()=>Da.params.image||""),o=v(()=>_t(e(i),Qe.Image.state)),p=v(()=>e(o).at(0));Te(()=>nr({title:`Recadrer ${e(p)?.filename??"..."}`}));let M=U(!1),x=U("Glisser-recadrer");const O=[{name:"Glisser-recadrer",help:"Cliquer et glisser pour créer une boîte de recadrage",icon:Yr,shortcut:"r",transformable:!0,createMode:"clickanddrag",movable:!0,cursor:"crosshair"},{name:"2 points",help:"Cliquer sur les 2 coins pour créer une boîte de recadrage",icon:Ur,shortcut:"z",transformable:!1,createMode:"2point",movable:!1,cursor:"crosshair"},{name:"4 points",help:"Cliquer sur les 4 extrémités pour créer une boîte de recadrage",icon:Nr,shortcut:"Shift+z",transformable:!1,createMode:"4point",movable:!1,cursor:"crosshair"},{name:"Déplacer",help:"Cliquer et glisser pour déplacer la boîte de recadrage",icon:Br,shortcut:"v",transformable:!1,createMode:"off",movable:!0,cursor:"pointer"},{name:"Main",help:"Cliquer et glisser pour se déplacer dans l'image",icon:Tr,shortcut:"h",transformable:!1,createMode:"off",movable:!1,cursor:"grab"}],J=v(()=>O.filter(({createMode:t})=>t!=="off"));let D=v(()=>O.find(({name:t})=>t===e(x))||O[0]),I=U("");const H=v(()=>Object.fromEntries(e(o).map(({metadata:t,id:r})=>[r,Xa("boundingbox",t[k.cropMetadataId]?.value)]).filter(([,t])=>!!t))),G=v(()=>k.previewURLs.get(e(i))),P=v(()=>Ya(Qe.Image.state).toSorted(Ta)),K=v(()=>{const t=e(P).indexOf(e(i))-1;if(!(t<0))return e(P).at(t)}),ee=v(()=>{const t=e(P).indexOf(e(i))+1;if(!(t>=e(P).length))return e(P).at(t)}),ne=v(()=>{const t=e(P).slice(e(P).indexOf(e(i))+1).filter(r=>!le(r)).at(0);return t||e(P).find(r=>!le(r))}),L=v(()=>e(P).filter(fe).length),ae=v(()=>e(P).filter(le).length),$=v(()=>Object.fromEntries(e(o).map(t=>{if(!t.metadata[k.cropMetadataId])return[t.id,void 0];const{alternatives:r,value:n,confidence:u,manuallyModified:A}=t.metadata[k.cropMetadataId];if(r&&Object.entries(r).length>0){const[[z,B]]=Object.entries(r);return[t.id,{value:JSON.parse(z),confidence:B}]}return A?[t.id,void 0]:[t.id,{value:n,confidence:u}]})));function fe(t){return _t(t).every(r=>k.cropMetadataId in r.metadata)}function le(t){return t?_t(t).every(He):!1}function He(t){const r=k.currentProtocol?.crop?.confirmationMetadata;return r?r in t.metadata&&t.metadata[r].value:!1}async function Pe(t,r){const n=k.cropConfirmationMetadataId;n&&await Xe({db:Ae(),metadataId:n,subjectId:t,type:"boolean",manuallyModified:!0,value:r})}async function ze(t){if(!k.cropConfirmationMetadataId){Jt.error("Ce protocole ne supported pas la validation des recadrages (voir crop.confirmationMetadata dans la définition du protocole)");return}for(const r of e(o))await Pe(r.id,t)}async function Be(t){const r=e($)[t];if(!r){Jt.error(`L'image ${t} n'a pas de recadrage alternatif, impossible de revenir au recadrage d'origine`);return}await Xe({db:Ae(),subjectId:t,metadataId:k.cropMetadataId,type:"boundingbox",manuallyModified:!1,...r}),k.classificationMetadataId&&await xt({db:Ae(),metadataId:k.classificationMetadataId,subjectId:t})}const Oe=v(()=>Object.fromEntries(e(o).map(t=>{const r=e($)[t.id]?.value,n=t.metadata[k.cropMetadataId]?.value;return[t.id,r&&tr("boundingbox",n)&&!Ha(r,n)]}))),rt=v(()=>Object.values(e($)).every(t=>!t)||Object.values(e(Oe)).some(Boolean));async function Ne(){if(Object.values(e($)).every(t=>!t))for(const{id:t}of e(o))await s(t);else for(const{id:t}of e(o))await Be(t)}async function s(t){e(o).length===1?await xt({db:Ae(),metadataId:k.cropMetadataId,subjectId:t}):await Qe.Image.remove(t)}async function q(t,r,n=!0){if(!r)return t&&await Pe(t,!0),t;const u=n&&!!k.cropConfirmationMetadataId&&e(o).filter(He).length===e(o).length-1,A=Gt().cropAutoNext&&ja(r)&&(e(D).createMode!=="clickanddrag"||!fe(e(i))),z=t?e(o).find(se=>se.id===t):void 0,B=z?.metadata[k.classificationMetadataId];B&&!B.manuallyModified&&await xt({db:Ae(),metadataId:k.classificationMetadataId,subjectId:z.id});let R="";return t?await Xe({db:Ae(),metadataId:k.cropMetadataId,subjectId:t,type:"boundingbox",value:pt(r),confidence:1,alternatives:e($)[t]?[e($)[t]]:void 0,manuallyModified:!0}):e(o).length===1&&e(p)&&!e(p).metadata[k.cropMetadataId]?(R=e(p).id,await Xe({db:Ae(),metadataId:k.cropMetadataId,subjectId:R,type:"boundingbox",value:pt(r),confidence:1,manuallyModified:!0,alternatives:[]})):(R=Wa(e(i),Math.max(...e(o).map(({id:se})=>Ja(se).subindex))+1),await Qe.Image.set({id:R,filename:e(p)?.filename??"",addedAt:Ka(e(p)?.addedAt??new Date),contentType:e(p)?.contentType??"",dimensions:Le(e(p)?.dimensions)??{width:0,height:0},fileId:e(i),metadata:{[k.cropMetadataId]:{value:JSON.stringify(pt(r)),confidence:1,manuallyModified:!0,alternatives:{}},[k.cropConfirmationMetadataId]:{value:"true",confidence:1,manuallyModified:!0,alternatives:{}}}})),_(S,!1),await ze(!0),b.manual||(b.imageId=R||t),u&&(_(M,!0),await new Promise(se=>setTimeout(se,500)),_(M,!1)),A&&await ke(e(ne)?`#/crop/${e(ne)}`:"#/classify",{invalidateAll:!0}),R}async function Y(){const t=e(o).map(r=>[r,e(H)[r.id]]);for(const[r,n]of t)await q(r.id,n?gt(n):void 0);await ke(e(ne)?`#/crop/${e(ne)}`:"#/classify")}async function w(){const t=Le(e(ee));await Ga(e(i)),await ke(e(ee)?`#/crop/${t}`:"#/import")}function C(t){if(!e(p))return[0,0];const r=kt({x:e(p).dimensions.width,y:e(p).dimensions.height}),{w:n,h:u}=Mt(r(t),Math.round);return[n,u]}function f(){k.imagePreviouslyOpenedInCropper=e(i),ke("/crop")}Te(()=>{k.imageOpenedInCropper=e(i)});let b=ge({imageId:null,manual:!1});Ua("cropping",{ArrowLeft:{help:"Image précédente",when:()=>!!e(K),do:()=>ke(`#/crop/${e(K)}`)},"Shift+Space":{help:"Image précédente",when:()=>!!e(K),do:()=>ke(`#/crop/${e(K)}`)},ArrowRight:{help:"Image suivante",when:()=>!!e(ee),do:()=>ke(`#/crop/${e(ee)}`)},Space:{help:"Continuer",do:Y},"$mod+Delete":{help:"Supprimer l’image",do:w},Escape:{help:"Quitter le mode recadrage",do:f},a:{help:"Activer/désactiver la continuation automatique",do:async()=>er("cropAutoNext")},Delete:{help:"Supprimer la boîte sélectionnée",when:()=>!!b.imageId,async do(){b.imageId&&(await s(b.imageId),b.manual?b.imageId=null:b.imageId=e(o).toReversed().find(t=>t.id in e(H))?.id??null)}},f:{help:"Cacher les boîtes non sélectionnées",when:()=>!!b,do(){b&&(b.imageId===e(I)?_(I,""):b.imageId&&_(I,b.imageId,!0))}},u:{help:"Revenir au recadrage d'origine",when:()=>!!e(Oe)[e(i)],do:()=>{e(Oe)[e(i)]&&Be(e(i))}},"$mod+u":{help:"Revenir au recadrage d'origine pour toutes les boîtes",when:()=>Object.keys(e(H)).length>0,do:Ne},ArrowUp:{help:"Marquer le recadrage comme confirmé",when:()=>!le(e(i)),do:()=>ze(!0)},ArrowDown:{help:"Marquer le recadrage comme non confirmé",when:()=>le(e(i)),do:()=>ze(!1)},"+":{help:"Zoomer",do:()=>{e(h).scale=Se(1,e(h).scale+4*e(V),10)}},"-":{help:"Dézoomer",do:()=>{e(h).scale=Se(1,e(h).scale-4*e(V),10)}},Digit0:{help:"Réinitialiser le zoom",do:()=>{e(h).origin={x:0,y:0},e(h).scale=1}},...Zt(O.map(t=>[t.shortcut,{help:`Choisir l'outil ${t.name}`,do:()=>{_(x,t.name,!0)}}])),",":{help:"Sélectionner la boîte précédente",do:()=>{const t=Object.keys(e(H)),n=(t.indexOf(b.imageId??"")-1+t.length)%t.length;b.imageId=t[n]}},";":{help:"Sélectionner la boîte suivante",do:()=>{const t=Object.keys(e(H)),n=(t.indexOf(b.imageId??"")+1)%t.length;b.imageId=t[n]}},...Zt(Fa(1,10).map(t=>[`Digit${t}`,{help:`Sélectionner la boîte #${t}`,when:()=>Object.keys(e(H)).length>=t,do:()=>{const r=Object.keys(e(H))[t-1];b.imageId===r?(b.imageId=null,b.manual=!1):(b.imageId=r,b.manual=!0)}}]))}),Te(()=>{b.imageId&&document.querySelector(".boxes li.selected")?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})});let T=U(void 0),be=U(!0);ta(()=>e(i),(t,r)=>{r&&k.cropperZoomStates.set(r,Le(e(h))),_(h,Le(k.cropperZoomStates.get(t))??Yt,!0)});let h=U(ge({...Yt})),S=v(()=>e(o).every(({metadata:t})=>!t[k.cropMetadataId]?.manuallyModified));const V=v(()=>e(h).scale*.1);var F=wi(),W=j(F),N=g(W),re=g(N);et(re,{}),m(N),X(2),m(W);var Q=d(W,2),ie=g(Q);qe(ie,21,()=>O,t=>t.name,(t,r)=>{var n=ti();n.__click=[ei,x,r];let u;var A=g(n);Ft(A,()=>e(r).icon,(z,B)=>{B(z,{})}),m(n),Ke(n,(z,B)=>Ye?.(z,B),()=>({text:`${e(r).name}: ${e(r).help}`,keyboard:e(r).shortcut,placement:"right"})),te(z=>{tt(n,"aria-label",`Choisir l'outil ${e(r).name??""}`),u=je(n,1,"svelte-k3qi6z",null,u,z)},[()=>({active:e(r).name===e(x)})]),l(t,n)}),m(ie);var oe=d(ie,2);oe.__mousedown=[ai,D,h],oe.__mouseup=[ri,D,h],oe.__mousemove=[ii,h];var ce=g(oe),pe=g(ce);{var _e=t=>{var r=oi(),n=j(r);Ba(n,()=>({"--size":"2em"})),ar(n.lastChild,{}),m(n),X(2),l(t,r)},Ie=t=>{var r=si();l(t,r)};Z(pe,t=>{e(be)?t(_e):t(Ie,!1)})}m(ce);var xe=d(ce,2);let Ze;ea(xe,t=>_(T,t),()=>e(T));var aa=d(xe,2);{var ra=t=>{{let r=v(()=>Mt(e(I)?Na(e(H),e(I)):e(H),gt)),n=v(()=>e(h).panning?e(D).name==="Main"?"grabbing":"move":e(D).cursor);Cr(t,Sa(()=>e(D),{get imageElement(){return e(T)},get zoom(){return e(h)},get imageFileID(){return e(i)},get boundingBoxes(){return e(r)},get disabled(){return e(h).panning},get cursor(){return e(n)},onchange:(u,A)=>q(u,A),oncreate:u=>q(null,u)}))}};Z(aa,t=>{e(T)&&t(ra)})}m(oe);var Ct=d(oe,2),it=g(Ct),ot=g(it),At=g(ot);Lt(At,{inline:!0,onclick:f,children:(t,r)=>{var n=ni(),u=j(n);Xr(u,{});var A=d(u,2);za(A,{shortcut:"Escape"}),l(t,n)},$$slots:{default:!0}});var ia=d(At,2);Lt(ia,{dangerous:!0,onclick:w,help:{text:"Supprimer cette image et passer à la suivante",keyboard:"$mod+Delete"},children:(t,r)=>{var n=li(),u=j(n);Kt(u,{}),X(),l(t,n)},$$slots:{default:!0}}),m(ot);var st=d(ot,2),oa=g(st);{var sa=t=>{var r=di(),n=g(r),u=d(n);{var A=z=>{var B=ci(),R=g(B);et(R,{}),m(B),Ke(B,(se,de)=>Ye?.(se,de),()=>"Recadrage confirmé"),l(z,B)};Z(u,z=>{le(e(i))&&z(A)})}m(r),te(()=>Me(n,`${e(p).filename??""} `)),l(t,r)},na=t=>{var r=vi();l(t,r)};Z(oa,t=>{e(p)?t(sa):t(na,!1)})}m(st);var qt=d(st,2),St=g(qt);{let t=v(()=>!e(rt));bt(St,{keyboard:"$mod+U",help:"Revenir au recadrage d'origine pour toutes les boîtes",onclick:Ne,get disabled(){return e(t)},children:(r,n)=>{var u=hi(),A=j(u);Qt(A,{}),X(),l(r,u)},$$slots:{default:!0}})}var la=d(St,2);{var ca=t=>{{let r=v(()=>le(e(i))?"ArrowDown":"ArrowUp"),n=v(()=>le(e(i))?"Marquer le recadrage comme non confirmé":"Marquer le recadrage comme confirmé");bt(t,{get keyboard(){return e(r)},onclick:()=>ze(!le(e(i))),get help(){return e(n)},children:(u,A)=>{var z=$e(),B=j(z);{var R=de=>{var ye=ui(),we=j(ye);Wr(we,{}),X(),l(de,ye)},se=de=>{var ye=mi(),we=j(ye);et(we,{}),X(),l(de,ye)};Z(B,de=>{le(e(i))?de(R):de(se,!1)})}l(u,z)},$$slots:{default:!0}})}};Z(la,t=>{k.cropConfirmationMetadataId&&t(ca)})}m(qt),m(it);var nt=d(it,2),zt=g(nt),Bt=g(zt);qe(Bt,19,()=>e(o).filter(({id:t})=>t in e(H)),t=>t.id,(t,r,n)=>{const u=v(()=>e(H)[e(r).id]),A=v(()=>e($)[e(r).id]),z=v(()=>{const[E,ve]=C(e(u));return{w:E,h:ve}}),B=v(()=>e(I)===e(r).id);var R=pi();let se;var de=g(R);{var ye=E=>{{let ve=v(()=>gt(e(u))),Ce=v(()=>k.previewURLs.get(e(r).fileId));Ea(E,{get box(){return e(ve)},get src(){return e(Ce)},class:"thumb"})}};Z(de,E=>{e(r).fileId&&E(ye)})}var we=d(de,2),Ge=g(we),We=g(Ge);m(Ge);var Je=d(Ge,2),De=g(Je),ut=g(De);m(De),Ke(De,(E,ve)=>Ye?.(E,ve),()=>"Dimensions de l'image recadrée (en pixels)");var wa=d(De,2);{var ka=E=>{var ve=gi(),Ce=d(j(ve),2);Ra(Ce,{get value(){return e(A).confidence},children:(mt,ki)=>{var ft=fi(),$a=g(ft);Er($a,{}),m(ft),l(mt,ft)},$$slots:{default:!0}}),l(E,ve)};Z(wa,E=>{e(A)&&!e(r).metadata[k.cropMetadataId].manuallyModified&&E(ka)})}m(Je),m(we);var Ht=d(we,2),Pt=g(Ht);{var Ma=E=>{{let ve=v(()=>e(B)?"Réafficher les autres boîtes":"Masquer les autres boîtes");Re(E,{get help(){return e(ve)},keyboard:"F",onclick:()=>_(I,e(B)?"":e(r).id,!0),get crossout(){return e(B)},children:(Ce,mt)=>{Pr(Ce,{})},$$slots:{default:!0}})}};Z(Pt,E=>{Object.values(e(H)).length>1&&E(Ma)})}var Rt=d(Pt,2);{let E=v(()=>e(A)?`Revenir au recadrage d'origine 
									(${C(e(A).value).join(" × ")}, ${Nt(e(A).confidence)} de confiance)`:"Recadrage d'origine indisponible"),ve=v(()=>!e(Oe)[e(r).id]);Re(Rt,{get help(){return e(E)},keyboard:"u",get disabled(){return e(ve)},onclick:()=>Be(e(r).id),children:(Ce,mt)=>{Qt(Ce,{})},$$slots:{default:!0}})}var Ia=d(Rt,2);Re(Ia,{help:"Supprimer la boîte sélectionnée",keyboard:"Delete",onclick:async()=>s(e(r).id),children:(E,ve)=>{Kt(E,{})},$$slots:{default:!0}}),m(Ht),m(R),te(E=>{se=je(R,1,"svelte-k3qi6z",null,se,E),Me(We,`Boîte #${e(n)+1}`),Me(ut,`${e(z).w??""}×${e(z).h??""}`)},[()=>({unfocused:e(I)&&e(I)!==e(r).id,selected:b.imageId===e(r).id})]),l(t,R)});var da=d(Bt,2);{var va=t=>{var r=bi(),n=g(r),u=g(n);Oa(u,()=>"Pour créer une nouvelle boîte,<wbr /> utilisez les outils");var A=d(u,2);qr(A,{get items(){return e(J)},key:B=>B.name,final:"ou",children:(B,R)=>{let se=()=>R?.().icon,de=()=>R?.().help,ye=()=>R?.().shortcut;sr(B,{get text(){return de()},get keyboard(){return ye()},children:(we,Ge)=>{var We=$e(),Je=j(We);Ft(Je,se,(De,ut)=>{ut(De,{})}),l(we,We)},$$slots:{default:!0}})},$$slots:{default:!0}}),m(n),X(2),m(r),l(t,r)};Z(da,t=>{e(S)&&t(va)})}m(zt),m(nt);var lt=d(nt,2);{const t=(r,n=Ee)=>{var u=_i(),A=g(u,!0);m(u),te(z=>Me(A,z),[()=>Nt(n()/e(P).length)]),l(r,u)};var ct=g(lt),dt=g(ct),Ot=g(dt);jr(Ot,{});var ha=d(Ot,2);t(ha,()=>e(L)),m(dt);var ua=d(dt,2);{let r=v(()=>e(L)/e(P).length);Wt(ua,{alwaysActive:!0,get progress(){return e(r)}})}m(ct);var ma=d(ct,2);{var fa=r=>{var n=xi(),u=g(n),A=g(u);et(A,{});var z=d(A,2);t(z,()=>e(ae)),m(u);var B=d(u,2);{let R=v(()=>e(ae)/e(P).length);Wt(B,{alwaysActive:!0,get progress(){return e(R)}})}m(n),l(r,n)};Z(ma,r=>{k.cropConfirmationMetadataId&&r(fa)})}m(lt)}var Dt=d(lt,2),vt=g(Dt),Vt=g(vt);{let t=v(()=>!e(K));Re(Vt,{get disabled(){return e(t)},help:"Image précédente",keyboard:"ArrowLeft",onclick:()=>{ke(`#/crop/${e(K)}`)},children:(r,n)=>{Dr(r,{})},$$slots:{default:!0}})}var ht=d(Vt,2),ga=g(ht);m(ht);var pa=d(ht,2);{let t=v(()=>!e(ee));Re(pa,{get disabled(){return e(t)},help:"Image suivante",keyboard:"ArrowRight",onclick:()=>{ke(`#/crop/${e(ee)}`)},children:(r,n)=>{or(r,{})},$$slots:{default:!0}})}m(vt);var jt=d(vt,2),Ue=g(jt),ba=g(Ue),_a=()=>Gt().cropAutoNext,xa=t=>Qa("cropAutoNext",t);ir(ba,{get value(){return _a()},set value(t){xa(t)},label:"Auto"}),X(),m(Ue),Ke(Ue,(t,r)=>Ye?.(t,r),()=>({text:"Passer automatiquement à l'image suivante quand celle-ci est recadrée",keyboard:"A"}));var ya=d(Ue,2);bt(ya,{onclick:Y,keyboard:"Space",help:"Marquer le recadrage comme confirmé et passer à la prochaine image non confirmée",children:(t,r)=>{var n=yi(),u=j(n);Pa(u,{}),X(),l(t,n)},$$slots:{default:!0}}),m(jt),m(Dt),m(Ct),m(Q),te((t,r)=>{tt(W,"aria-hidden",!e(M)),tt(xe,"src",e(G)),Ze=Ve(xe,"",Ze,t),Me(ga,`${r??""}⁄${e(P).length??""}`)},[()=>({scale:e(h).scale,translate:`${e(h).origin.x??""}px ${e(h).origin.y??""}px`}),()=>e(P).indexOf(e(i))+1]),yt("wheel",oe,async t=>{t.preventDefault();let r=e(T).getBoundingClientRect(),n=(t.clientX-r.x)/e(h).scale,u=(t.clientY-r.y)/e(h).scale;e(h).scale=Se(1,e(h).scale-Fe(t.deltaY)*2*e(V),10),e(h).scale>1?(e(h).origin.x+=Fe(t.deltaY)*e(V)*(n*2-e(T).offsetWidth),e(h).origin.y+=Fe(t.deltaY)*e(V)*(u*2-e(T).offsetHeight)):e(h).origin={x:0,y:0}}),yt("load",xe,()=>{_(be,!1)}),qa(xe),l(c,F),$t()}Xt(["click","mousedown","mouseup","mousemove"]);export{to as component};
