import"../chunks/DsnmJJEf.js";import{h as H,i as c,A as N,B as V,aF as Q,g as i,D as q,aE as w,F as _,aA as p,K as d,aB as n,t as G,G as S,aC as I,aD as L}from"../chunks/DLg_PPZ_.js";import{r as z,p as X,i as K,s as ee}from"../chunks/D67Hg_eN.js";import{e as oe}from"../chunks/C4hQLFL9.js";import{a as E,s as te}from"../chunks/BNnFn6yw.js";import{t as re,f as ae}from"../chunks/CKZ3iiSi.js";import{r as j,B as T}from"../chunks/BPUwB5iN.js";import{B as se}from"../chunks/67TCgbdO.js";import{o as le,i as ie,t as W,d as ne}from"../chunks/BCT7fajR.js";import{M as ce}from"../chunks/CaI1kqC-.js";import{M as de,e as ve,B as ue,A as pe,p as me,j as fe,d as J}from"../chunks/BLmvXvUI.js";import{t as A}from"../chunks/BVoxKip6.js";import{D as R}from"../chunks/DBsR0Uxn.js";import{s as U}from"../chunks/9TbOa8jV.js";import{B as F}from"../chunks/DceiQKom.js";import{u as Y}from"../chunks/yjQBtq-m.js";import{T as he}from"../chunks/Di2wCwy7.js";var ge=H('<svg><path fill="currentColor" d="M240 136v64a16 16 0 0 1-16 16H32a16 16 0 0 1-16-16v-64a16 16 0 0 1 16-16h40a8 8 0 0 1 0 16H32v64h192v-64h-40a8 8 0 0 1 0-16h40a16 16 0 0 1 16 16m-117.66-2.34a8 8 0 0 0 11.32 0l48-48a8 8 0 0 0-11.32-11.32L136 108.69V24a8 8 0 0 0-16 0v84.69L85.66 74.34a8 8 0 0 0-11.32 11.32ZM200 168a12 12 0 1 0-12 12a12 12 0 0 0 12-12"></path></svg>');function _e(v,e){const s=z(e,["$$slots","$$events","$$legacy"]);var t=ge();E(t,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...s})),c(v,t)}var Pe=H('<svg><path fill="currentColor" d="M128 24a104 104 0 1 0 104 104A104.11 104.11 0 0 0 128 24m0 192a88 88 0 1 1 88-88a88.1 88.1 0 0 1-88 88m48-88a8 8 0 0 1-8 8h-32v32a8 8 0 0 1-16 0v-32H88a8 8 0 0 1 0-16h32V88a8 8 0 0 1 16 0v32h32a8 8 0 0 1 8 8"></path></svg>');function $e(v,e){const s=z(e,["$$slots","$$events","$$legacy"]);var t=Pe();E(t,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...s})),c(v,t)}function we(v,e){N(e,!0);let s=X(e,"open",15),t=q(()=>W.Protocol.getFromState(e.id));de(v,{title:"Êtes-vous sûr·e?",key:"modal_delete_protocol",cancel:"Annuler",confirm:"Oui, supprimer",onconfirm:async()=>{await le(["Protocol","Metadata","MetadataOption"],{},async a=>{if(!i(t))return;a.objectStore("Protocol").delete(i(t).id);const P=i(t).metadata.filter(m=>i(t)&&ie(i(t).id,m)),f=await a.objectStore("MetadataOption").getAll();for(const m of P)a.objectStore("Metadata").delete(m),f.filter(h=>h.id.startsWith(`${m}:`)).forEach(h=>a.objectStore("MetadataOption").delete(h.id))}),A.success("Protocole supprimé"),e.ondelete?.()},get open(){return s()},set open(a){s(a)},children:(a,P)=>{w();var f=Q("Il est impossible de revenir en arrière après avoir supprimé un protocole.");c(a,f)},$$slots:{default:!0}}),V()}var ke=H('<svg><path fill="currentColor" d="m229.66 109.66l-48 48a8 8 0 0 1-11.32-11.32L204.69 112H165a88 88 0 0 0-85.23 66a8 8 0 0 1-15.5-4A103.94 103.94 0 0 1 165 96h39.71l-34.37-34.34a8 8 0 0 1 11.32-11.32l48 48a8 8 0 0 1 0 11.32M192 208H40V88a8 8 0 0 0-16 0v128a8 8 0 0 0 8 8h160a8 8 0 0 0 0-16"></path></svg>');function Me(v,e){const s=z(e,["$$slots","$$events","$$legacy"]);var t=ke();E(t,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...s})),c(v,t)}var Se=_('<li class="svelte-1aw9mnt"><section class="text"><h3> </h3> <small><code> </code></small></section> <section class="actions svelte-1aw9mnt"><!> <!> <!></section></li>');function ye(v,e){N(e,!0);var s=Se(),t=p(s),a=p(t),P=p(a,!0);d(a);var f=n(a,2),m=p(f),h=p(m,!0);d(m),d(f),d(t);var k=n(t,2),y=p(k);{let o=q(()=>e.id===Y.currentProtocolId&&Y.processing.total>0);F(y,{dangerous:!0,help:"Supprimer",get disabled(){return i(o)},onclick:()=>{e.ondelete()},children:(l,r)=>{he(l,{})},$$slots:{default:!0}})}var B=n(y,2);F(B,{help:"Exporter",onclick:async()=>{await ve(j("/"),e.id).catch(o=>A.error(o))},children:(o,l)=>{Me(o,{})},$$slots:{default:!0}});var D=n(B,2);{var C=o=>{ue(o,{compact:!0,get version(){return e.version},get source(){return e.source},get id(){return e.id}})},u=o=>{F(o,{crossout:!0,onclick:()=>{},help:"Ce protocole ne supporte pas la vérification des mises à jour",children:(l,r)=>{pe(l,{})},$$slots:{default:!0}})};K(D,o=>{e.version&&e.source?o(C):o(u,!1)})}d(k),d(s),G(()=>{U(P,e.name),U(h,e.id)}),c(v,s),V()}var Be=_("<!> Format JSON",1),be=_("<!> Format YAML",1),xe=_('<section class="actions svelte-1fvkkcr"><!> <!></section>'),Ae=_(`<p>Pour l'instant, C.i.g.a.l.e ne permet pas de créer ou modifier des protocoles dans
		l'interface</p> <p>Cependant, les protocoles sont représentables par des fichiers de configuration JSON ou YAML</p> <p>Vous pouvez télécharger un modèle de protocole vide pour vous faciliter la tâche</p> <p>Sachant qu'un <a>JSON Schema</a> est déclaré dans ces fichiers,
		la plupart des éditeurs de code modernes vous proposeront de l'autocomplétion et de la documentation</p> <p>Vous pourrez ensuite importer votre protocole ici. Si vous voulez le modifier par la suite,
		il suffit de l'exporter, modifier le fichier, et réimporter</p>`,1),Ce=_("<!> Importer",1),je=_("<!> Créer",1),De=_('<!> <!> <div class="page svelte-1fvkkcr"><header class="svelte-1fvkkcr"><h1 class="svelte-1fvkkcr">Protocoles</h1> <section class="actions svelte-1fvkkcr"><!> <!></section></header> <ul class="protocols svelte-1fvkkcr"></ul></div>',1);function We(v,e){N(e,!0);let s=I(""),t=I(void 0),a=I(void 0);var P=De(),f=S(P);we(f,{get id(){return i(s)},get open(){return i(t)},set open(u){L(t,u,!0)}});var m=n(f,2);ce(m,{key:"modal_download_protocol_template",title:"Créer un protocole",get open(){return i(a)},set open(o){L(a,o,!0)},footer:(o,l)=>{let r=()=>l?.().close;var g=xe(),M=p(g);se(M,{onclick:async()=>{await J(j("/"),"json"),r()?.()},children:($,Z)=>{var x=Be(),O=S(x);R(O,{}),w(),c($,x)},$$slots:{default:!0}});var b=n(M,2);T(b,{onclick:async()=>{await J(j("/"),"yaml"),r()?.()},children:($,Z)=>{var x=be(),O=S(x);R(O,{}),w(),c($,x)},$$slots:{default:!0}}),d(g),c(o,g)},children:(o,l)=>{var r=Ae(),g=n(S(r),6),M=n(p(g));w(),d(g),w(2),G(b=>te(M,"href",b),[()=>fe(j("/"))]),c(o,r)},$$slots:{footer:!0,default:!0}});var h=n(m,2),k=p(h),y=n(p(k),2),B=p(y);T(B,{loading:!0,onclick:async(o,l)=>{await me({allowMultiple:!0,onInput:l.loadingStarted,importProtocol:e.data.swarpc.importProtocol}).catch(r=>A.error(r)).then(r=>{!r||typeof r=="string"||r.length===0||(r.length===1?A.success(`Protocole “${r[0].name}” importé`):A.success(ne(r.length,["Protocole importé","# protocoles importés"])))})},children:(o,l)=>{let r=()=>l?.().loading;var g=Ce(),M=S(g);{var b=$=>{_e($,{})};K(M,$=>{r()||$(b)})}w(),c(o,g)},$$slots:{default:!0}});var D=n(B,2);T(D,{onclick:()=>i(a)?.(),children:(u,o)=>{var l=je(),r=S(l);$e(r,{}),w(),c(u,l)},$$slots:{default:!0}}),d(y),d(k);var C=n(k,2);oe(C,21,()=>W.Protocol.state,u=>u.id,(u,o)=>{ye(u,ee(()=>i(o),{ondelete:()=>{L(s,i(o).id,!0),i(t)?.()}}))}),d(C),d(h),re(1,h,()=>ae,()=>({duration:100})),c(v,P),V()}export{We as component};
