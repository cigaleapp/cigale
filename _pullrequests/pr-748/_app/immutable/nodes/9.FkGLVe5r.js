import"../chunks/DsnmJJEf.js";import{A as C,g as r,D as o,B as D,F as k,t as T,i as y,aB as z,aA as q,I as B,K as w,J as Q,G as V,aE as W}from"../chunks/DLg_PPZ_.js";import{p as L,s as X,r as Z,i as A}from"../chunks/D67Hg_eN.js";import{b as R,s as $}from"../chunks/BNnFn6yw.js";import{t as ee,f as te}from"../chunks/CKZ3iiSi.js";import{A as ae}from"../chunks/BVsv4-Sq.js";import{C as G}from"../chunks/CxK3DY_r.js";import{u as s,i as re,g as ie}from"../chunks/yjQBtq-m.js";import{d as se,e as x}from"../chunks/9TbOa8jV.js";import{s as ne}from"../chunks/USdlu_3B.js";import{p as le}from"../chunks/hFci9Gn4.js";import{t as E}from"../chunks/BCT7fajR.js";import{d as M}from"../chunks/BbY4Fv7Y.js";import{i as O,A as P,b as j,d as oe}from"../chunks/hwqyxWC0.js";import{L as de}from"../chunks/Bx3yqWKm.js";import{u as ue}from"../chunks/Csf0LG85.js";function ge(g,e){C(e,!0);const m=L(e,"highlighted",3,!1),v=Z(e,["$$slots","$$events","$$legacy","image","highlighted"]),a=o(()=>s.queuedImages.has(e.image.id)?"queued":s.loadingImages.has(e.image.id)?"loading":s.erroredImages.has(e.image.id)?"errored":"ok"),i=o(()=>{if(r(a)==="errored")return s.erroredImages.get(e.image.id);if(re())return`${e.image.id} @ ${e.image.addedAt.toISOString()}`});{let f=o(()=>s.previewURLs.get(e.image.fileId)),n=o(()=>s.selection.includes(e.image.fileId));G(g,X({get id(){return e.image.fileId},get title(){return e.image.filename},get image(){return r(f)},get selected(){return r(n)},boxes:"show-all",get tooltip(){return r(i)},get status(){return r(a)},get highlighted(){return m()}},()=>v))}D()}var me=(g,e)=>{g.currentTarget.files&&e.onfiles?.({event:g,files:[...g.currentTarget.files]})},fe=k('<input type="file" multiple class="svelte-1n47qnw"/>'),ce=k('<section role="form"><!> <div class="dragging-overlay svelte-1n47qnw"><p>Déposer des images ici…</p></div> <!></section>');function ve(g,e){C(e,!0);let m=L(e,"dragging",15,!1);function v(t){if(m(!1),!t.dataTransfer)return;t.preventDefault();let l=[];if(t.dataTransfer.items?l=[...t.dataTransfer.items].map(d=>{if(d.kind==="file")return d.getAsFile()}).filter(d=>!!d):l=[...t.dataTransfer.files],e.filetypes&&e.filetypes.length>0&&l.some(d=>!e.filetypes.includes(d.type))){e.onunacceptable?.(l);return}e.onfiles?.({event:t,files:l})}var a=ce();let i;var f=q(a);ne(f,()=>e.children??B);var n=z(f,4);{var I=t=>{var l=fe();l.__input=[me,e],T(d=>$(l,"accept",d),[()=>e.filetypes?.join(",")]),y(t,l)};A(n,t=>{e.clickable&&t(I)})}w(a),T(t=>i=R(a,1,"dropzone svelte-1n47qnw",null,i,t),[()=>({dragging:m(),clickable:e.clickable})]),x("dragover",a,t=>{t.dataTransfer&&(t.preventDefault(),m(!0))}),x("drop",a,v),y(g,a),D()}se(["input"]);var pe=k('<div class="empty-state svelte-1urkjm2"><!> <p>Cliquer ou déposer des images, ou un export de résultats (.zip)</p></div>'),he=k("<section><!> <!></section>");function Oe(g,e){C(e,!0);const m=o(()=>[...ue(E.Image.state.map(({filename:a,id:i,addedAt:f,fileId:n})=>({id:n??i,addedAt:f,name:a,virtual:!1,data:E.Image.getFromState(i)})),a=>a.id),...s.processing.files.map(({name:a,id:i,addedAt:f})=>({id:i,addedAt:f,name:a,virtual:!0,data:null}))]),v=o(()=>r(m).length===0);{let a=o(()=>r(m).length===0);ve(g,{get filetypes(){return P},get clickable(){return r(a)},onfiles:({files:i})=>O(i),children:(i,f)=>{var n=he();let I;var t=q(n);ae(t,{get items(){return r(m)},get sort(){return ie().gallerySort},onemptyclick:async()=>{s.selection.length>0||O(await le({accept:P,multiple:!0}))},item:(_,p=B,F)=>{let u=()=>F?.().id,J=()=>F?.().name;var S=Q(),K=V(S);{var U=h=>{{let b=o(()=>({...p(),fileId:p().fileId}));ge(h,{get image(){return r(b)},ondelete:async()=>{j(u(),"Cancelled by user"),s.processing.removeFile(u()),await M(u())}})}},Y=h=>{const b=o(()=>s.erroredImages.get(u())),H=o(()=>s.queuedImages.has(u()));{let N=o(()=>r(b)?"errored":r(H)?"queued":"loading");G(h,{get id(){return u()},get title(){return J()},get status(){return r(N)},get tooltip(){return r(b)},image:void 0,ondelete:async()=>{j(u(),"Cancelled by user"),s.processing.removeFile(u()),await oe(u()),await M(u())}})}};A(K,h=>{p()&&p().fileId?h(U):h(Y,!1)})}y(_,S)},$$slots:{item:!0}});var l=z(t,2);{var d=c=>{var _=pe(),p=q(_);de(p,{variant:"empty"}),W(2),w(_),y(c,_)};A(l,c=>{r(v)&&c(d)})}w(n),T(c=>I=R(n,1,"observations svelte-1urkjm2",null,I,c),[()=>({empty:r(v)})]),ee(1,n,()=>te,()=>({duration:100})),y(i,n)},$$slots:{default:!0}})}D()}export{Oe as component};
