import"./DsnmJJEf.js";import{o as re}from"./D6ilWQdm.js";import{aC as ee,aM as ne,g,aD as te,A as le,a as H,F as j,i as R,B as ae,aA as k,aB as T,D as K,K as L,J as ce,G as he,t as F,I as de,aE as N,aV as ue,aF as me}from"./DLg_PPZ_.js";import{s as X}from"./9TbOa8jV.js";import{s as _e}from"./CJd3y8SF.js";import{i as Y}from"./D67Hg_eN.js";import{e as W}from"./C4hQLFL9.js";import{h as pe}from"./C9plLwmr.js";import{s as fe}from"./USdlu_3B.js";import{a as ve}from"./Cmdet9fQ.js";import{b as ge}from"./BEYaBP-8.js";import{u as b,i as ye}from"./yjQBtq-m.js";import{n as be,a as Se,d as Ee}from"./Csf0LG85.js";import{d as xe}from"./BCT7fajR.js";import{f as Ae}from"./BbY4Fv7Y.js";import{g as we}from"./hwqyxWC0.js";/*! @viselect/vanilla v3.9.0 MIT | https://github.com/Simonwep/selection/tree/master/packages/vanilla */class Te{constructor(){this._listeners=new Map,this.on=this.addEventListener,this.off=this.removeEventListener,this.emit=this.dispatchEvent}addEventListener(e,t){const s=this._listeners.get(e)??new Set;return this._listeners.set(e,s),s.add(t),this}removeEventListener(e,t){var s;return(s=this._listeners.get(e))==null||s.delete(t),this}dispatchEvent(e,...t){let s=!0;for(const i of this._listeners.get(e)??[])s=i(...t)!==!1&&s;return s}unbindAllListeners(){this._listeners.clear()}}const z=(l,e="px")=>typeof l=="number"?l+e:l,M=({style:l},e,t)=>{if(typeof e=="object")for(const[s,i]of Object.entries(e))i!==void 0&&(l[s]=z(i));else t!==void 0&&(l[e]=z(t))},J=(l=0,e=0,t=0,s=0)=>{const i={x:l,y:e,width:t,height:s,top:e,left:l,right:l+t,bottom:e+s};return{...i,toJSON:()=>JSON.stringify(i)}},Le=l=>{let e,t=-1,s=!1;return{next:(...i)=>{e=i,s||(s=!0,t=requestAnimationFrame(()=>{l(...e),s=!1}))},cancel:()=>{cancelAnimationFrame(t),s=!1}}},U=(l,e,t="touch")=>{switch(t){case"center":{const s=e.left+e.width/2,i=e.top+e.height/2;return s>=l.left&&s<=l.right&&i>=l.top&&i<=l.bottom}case"cover":return e.left>=l.left&&e.top>=l.top&&e.right<=l.right&&e.bottom<=l.bottom;case"touch":return l.right>=e.left&&l.left<=e.right&&l.bottom>=e.top&&l.top<=e.bottom}},Me=()=>matchMedia("(hover: none), (pointer: coarse)").matches,Ce=()=>"safari"in window,q=l=>Array.isArray(l)?l:[l],se=l=>(e,t,s,i={})=>{(e instanceof HTMLCollection||e instanceof NodeList)&&(e=Array.from(e)),t=q(t),e=q(e);for(const o of e)if(o)for(const n of t)o[l](n,s,{capture:!1,...i})},C=se("addEventListener"),S=se("removeEventListener"),P=l=>{var e;const{clientX:t,clientY:s,target:i}=((e=l.touches)==null?void 0:e[0])??l;return{x:t,y:s,target:i}},O=(l,e=document)=>q(l).map(t=>typeof t=="string"?Array.from(e.querySelectorAll(t)):t instanceof Element?t:null).flat().filter(Boolean),ke=(l,e)=>e.some(t=>typeof t=="number"?l.button===t:typeof t=="object"?t.button!==l.button?!1:t.modifiers.every(s=>{switch(s){case"alt":return l.altKey;case"ctrl":return l.ctrlKey||l.metaKey;case"shift":return l.shiftKey}}):!1),{abs:B,max:V,min:G,ceil:Q}=Math,Z=(l=[])=>({stored:l,selected:[],touched:[],changed:{added:[],removed:[]}}),ie=class extends Te{constructor(e){var t,s,i,o,n;super(),this._selection=Z(),this._targetBoundaryScrolled=!0,this._selectables=[],this._areaLocation={y1:0,x2:0,y2:0,x1:0},this._areaRect=J(),this._singleClick=!0,this._scrollAvailable=!0,this._scrollingActive=!1,this._scrollSpeed={x:0,y:0},this._scrollDelta={x:0,y:0},this._lastMousePosition={x:0,y:0},this.enable=this._toggleStartEvents,this.disable=this._toggleStartEvents.bind(this,!1),this._options={selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,startAreas:["html"],boundaries:["html"],container:"body",...e,behaviour:{overlap:"invert",intersect:"touch",triggers:[0],...e.behaviour,startThreshold:(t=e.behaviour)!=null&&t.startThreshold?typeof e.behaviour.startThreshold=="number"?e.behaviour.startThreshold:{x:10,y:10,...e.behaviour.startThreshold}:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,...(s=e.behaviour)==null?void 0:s.scrolling,startScrollMargins:{x:0,y:0,...(o=(i=e.behaviour)==null?void 0:i.scrolling)==null?void 0:o.startScrollMargins}}},features:{range:!0,touch:!0,deselectOnBlur:!1,...e.features,singleTap:{allow:!0,intersect:"native",...(n=e.features)==null?void 0:n.singleTap}}};for(const f of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))typeof this[f]=="function"&&(this[f]=this[f].bind(this));const{document:a,selectionAreaClass:c,selectionContainerClass:p}=this._options;this._area=a.createElement("div"),this._clippingElement=a.createElement("div"),this._clippingElement.appendChild(this._area),this._area.classList.add(c),p&&this._clippingElement.classList.add(p),M(this._area,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),M(this._clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this._frame=Le(f=>{this._recalculateSelectionAreaRect(),this._updateElementSelection(),this._emitEvent("move",f),this._redrawSelectionArea()}),this.enable()}_toggleStartEvents(e=!0){const{document:t,features:s}=this._options,i=e?C:S;i(t,"mousedown",this._onTapStart),s.touch&&i(t,"touchstart",this._onTapStart,{passive:!1})}_onTapStart(e,t=!1){const{x:s,y:i,target:o}=P(e),{document:n,startAreas:a,boundaries:c,features:p,behaviour:f}=this._options,r=o.getBoundingClientRect();if(e instanceof MouseEvent&&!ke(e,f.triggers))return;const m=O(a,n),_=O(c,n);this._targetElement=_.find(y=>U(y.getBoundingClientRect(),r));const u=e.composedPath(),d=m.find(y=>u.includes(y));if(this._targetBoundary=_.find(y=>u.includes(y)),!this._targetElement||!d||!this._targetBoundary||!t&&this._emitEvent("beforestart",e)===!1)return;this._areaLocation={x1:s,y1:i,x2:0,y2:0};const h=n.scrollingElement??n.body;this._scrollDelta={x:h.scrollLeft,y:h.scrollTop},this._singleClick=!0,this.clearSelection(!1,!0),C(n,["touchmove","mousemove"],this._delayedTapMove,{passive:!1}),C(n,["mouseup","touchcancel","touchend"],this._onTapStop),C(n,"scroll",this._onScroll),p.deselectOnBlur&&(this._targetBoundaryScrolled=!1,C(this._targetBoundary,"scroll",this._onStartAreaScroll))}_onSingleTap(e){const{singleTap:{intersect:t},range:s}=this._options.features,i=P(e);let o;if(t==="native")o=i.target;else if(t==="touch"){this.resolveSelectables();const{x:a,y:c}=i;o=this._selectables.find(p=>{const{right:f,left:r,top:m,bottom:_}=p.getBoundingClientRect();return a<f&&a>r&&c<_&&c>m})}if(!o)return;for(this.resolveSelectables();!this._selectables.includes(o);)if(o.parentElement)o=o.parentElement;else{this._targetBoundaryScrolled||this.clearSelection();return}const{stored:n}=this._selection;if(this._emitEvent("start",e),e.shiftKey&&s&&this._latestElement){const a=this._latestElement,[c,p]=a.compareDocumentPosition(o)&4?[o,a]:[a,o],f=[...this._selectables.filter(r=>r.compareDocumentPosition(c)&4&&r.compareDocumentPosition(p)&2),c,p];this.select(f),this._latestElement=a}else n.includes(o)&&(n.length===1||e.ctrlKey||n.every(a=>this._selection.stored.includes(a)))?this.deselect(o):(this.select(o),this._latestElement=o)}_delayedTapMove(e){const{container:t,document:s,behaviour:{startThreshold:i}}=this._options,{x1:o,y1:n}=this._areaLocation,{x:a,y:c}=P(e);if(typeof i=="number"&&B(a+c-(o+n))>=i||typeof i=="object"&&B(a-o)>=i.x||B(c-n)>=i.y){if(S(s,["mousemove","touchmove"],this._delayedTapMove,{passive:!1}),this._emitEvent("beforedrag",e)===!1){S(s,["mouseup","touchcancel","touchend"],this._onTapStop);return}C(s,["mousemove","touchmove"],this._onTapMove,{passive:!1}),M(this._area,"display","block"),O(t,s)[0].appendChild(this._clippingElement),this.resolveSelectables(),this._singleClick=!1,this._targetRect=this._targetElement.getBoundingClientRect(),this._scrollAvailable=this._targetElement.scrollHeight!==this._targetElement.clientHeight||this._targetElement.scrollWidth!==this._targetElement.clientWidth,this._scrollAvailable&&(C(this._targetElement,"wheel",this._wheelScroll,{passive:!1}),C(this._options.document,"keydown",this._keyboardScroll,{passive:!1}),this._selectables=this._selectables.filter(p=>this._targetElement.contains(p))),this._setupSelectionArea(),this._emitEvent("start",e),this._onTapMove(e)}this._handleMoveEvent(e)}_setupSelectionArea(){const{_clippingElement:e,_targetElement:t,_area:s}=this,i=this._targetRect=t.getBoundingClientRect();this._scrollAvailable?(M(e,{top:i.top,left:i.left,width:i.width,height:i.height}),M(s,{marginTop:-i.top,marginLeft:-i.left})):(M(e,{top:0,left:0,width:"100%",height:"100%"}),M(s,{marginTop:0,marginLeft:0}))}_onTapMove(e){const{_scrollSpeed:t,_areaLocation:s,_options:i,_frame:o}=this,{speedDivider:n}=i.behaviour.scrolling,a=this._targetElement,{x:c,y:p}=P(e);if(s.x2=c,s.y2=p,this._lastMousePosition.x=c,this._lastMousePosition.y=p,this._scrollAvailable&&!this._scrollingActive&&(t.y||t.x)){this._scrollingActive=!0;const f=()=>{if(!t.x&&!t.y){this._scrollingActive=!1;return}const{scrollTop:r,scrollLeft:m}=a;t.y&&(a.scrollTop+=Q(t.y/n),s.y1-=a.scrollTop-r),t.x&&(a.scrollLeft+=Q(t.x/n),s.x1-=a.scrollLeft-m),o.next(e),requestAnimationFrame(f)};requestAnimationFrame(f)}else o.next(e);this._handleMoveEvent(e)}_handleMoveEvent(e){const{features:t}=this._options;(t.touch&&Me()||this._scrollAvailable&&Ce())&&e.preventDefault()}_onScroll(){const{_scrollDelta:e,_options:{document:t}}=this,{scrollTop:s,scrollLeft:i}=t.scrollingElement??t.body;this._areaLocation.x1+=e.x-i,this._areaLocation.y1+=e.y-s,e.x=i,e.y=s,this._setupSelectionArea(),this._frame.next(null)}_onStartAreaScroll(){this._targetBoundaryScrolled=!0,S(this._targetElement,"scroll",this._onStartAreaScroll)}_wheelScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,s=e.deltaY?e.deltaY>0?1:-1:0,i=e.deltaX?e.deltaX>0?1:-1:0;this._scrollSpeed.y+=s*t,this._scrollSpeed.x+=i*t,this._onTapMove(e),e.preventDefault()}_keyboardScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,s=e.key==="ArrowLeft"?-1:e.key==="ArrowRight"?1:0,i=e.key==="ArrowUp"?-1:e.key==="ArrowDown"?1:0;this._scrollSpeed.x+=Math.sign(s)*t,this._scrollSpeed.y+=Math.sign(i)*t,e.preventDefault(),this._onTapMove({clientX:this._lastMousePosition.x,clientY:this._lastMousePosition.y,preventDefault:()=>{}})}_recalculateSelectionAreaRect(){const{_scrollSpeed:e,_areaLocation:t,_targetElement:s,_options:i}=this,{scrollTop:o,scrollHeight:n,clientHeight:a,scrollLeft:c,scrollWidth:p,clientWidth:f}=s,r=this._targetRect,{x1:m,y1:_}=t;let{x2:u,y2:d}=t;const{behaviour:{scrolling:{startScrollMargins:h}}}=i;u<r.left+h.x?(e.x=c?-B(r.left-u+h.x):0,u=u<r.left?r.left:u):u>r.right-h.x?(e.x=p-c-f?B(r.left+r.width-u-h.x):0,u=u>r.right?r.right:u):e.x=0,d<r.top+h.y?(e.y=o?-B(r.top-d+h.y):0,d=d<r.top?r.top:d):d>r.bottom-h.y?(e.y=n-o-a?B(r.top+r.height-d-h.y):0,d=d>r.bottom?r.bottom:d):e.y=0;const y=G(m,u),D=G(_,d),E=V(m,u),v=V(_,d);this._areaRect=J(y,D,E-y,v-D)}_redrawSelectionArea(){const{x:e,y:t,width:s,height:i}=this._areaRect,{style:o}=this._area;o.left=`${e}px`,o.top=`${t}px`,o.width=`${s}px`,o.height=`${i}px`}_onTapStop(e,t){var s;const{document:i,features:o}=this._options,{_singleClick:n}=this;S(this._targetElement,"scroll",this._onStartAreaScroll),S(i,["mousemove","touchmove"],this._delayedTapMove),S(i,["touchmove","mousemove"],this._onTapMove),S(i,["mouseup","touchcancel","touchend"],this._onTapStop),S(i,"scroll",this._onScroll),this._keepSelection(),e&&n&&o.singleTap.allow?this._onSingleTap(e):!n&&!t&&(this._updateElementSelection(),this._emitEvent("stop",e)),this._scrollSpeed.x=0,this._scrollSpeed.y=0,S(this._targetElement,"wheel",this._wheelScroll,{passive:!0}),S(this._options.document,"keydown",this._keyboardScroll,{passive:!0}),this._clippingElement.remove(),(s=this._frame)==null||s.cancel(),M(this._area,"display","none")}_updateElementSelection(){const{_selectables:e,_options:t,_selection:s,_areaRect:i}=this,{stored:o,selected:n,touched:a}=s,{intersect:c,overlap:p}=t.behaviour,f=p==="invert",r=[],m=[],_=[];for(let d=0;d<e.length;d++){const h=e[d];if(U(i,h.getBoundingClientRect(),c)){if(n.includes(h))o.includes(h)&&!a.includes(h)&&a.push(h);else if(f&&o.includes(h)){_.push(h);continue}else m.push(h);r.push(h)}}f&&m.push(...o.filter(d=>!n.includes(d)));const u=p==="keep";for(let d=0;d<n.length;d++){const h=n[d];!r.includes(h)&&!(u&&o.includes(h))&&_.push(h)}s.selected=r,s.changed={added:m,removed:_},this._latestElement=void 0}_emitEvent(e,t){return this.emit(e,{event:t,store:this._selection,selection:this})}_keepSelection(){const{_options:e,_selection:t}=this,{selected:s,changed:i,touched:o,stored:n}=t,a=s.filter(c=>!n.includes(c));switch(e.behaviour.overlap){case"drop":{t.stored=[...a,...n.filter(c=>!o.includes(c))];break}case"invert":{t.stored=[...a,...n.filter(c=>!i.removed.includes(c))];break}case"keep":{t.stored=[...n,...s.filter(c=>!n.includes(c))];break}}}trigger(e,t=!0){this._onTapStart(e,t)}resolveSelectables(){this._selectables=O(this._options.selectables,this._options.document)}clearSelection(e=!0,t=!1){const{selected:s,stored:i,changed:o}=this._selection;o.added=[],o.removed.push(...s,...e?i:[]),t||(this._emitEvent("move",null),this._emitEvent("stop",null)),this._selection=Z(e?[]:i)}getSelection(){return this._selection.stored}getSelectionArea(){return this._area}getSelectables(){return this._selectables}setAreaLocation(e){Object.assign(this._areaLocation,e),this._redrawSelectionArea()}getAreaLocation(){return this._areaLocation}cancel(e=!1){this._onTapStop(null,!e)}destroy(){this.cancel(),this.disable(),this._clippingElement.remove(),super.unbindAllListeners()}select(e,t=!1){const{changed:s,selected:i,stored:o}=this._selection,n=O(e,this._options.document).filter(a=>!i.includes(a)&&!o.includes(a));return o.push(...n),i.push(...n),s.added.push(...n),s.removed=[],this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)),n}deselect(e,t=!1){const{selected:s,stored:i,changed:o}=this._selection,n=O(e,this._options.document).filter(a=>s.includes(a)||i.includes(a));this._selection.stored=i.filter(a=>!n.includes(a)),this._selection.selected=s.filter(a=>!n.includes(a)),this._selection.changed.added=[],this._selection.changed.removed.push(...n.filter(a=>!o.removed.includes(a))),this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null))}};ie.version="3.9.0";let Be=ie;class De{imagesContainer;#t=ee(ne([]));get selection(){return g(this.#t)}set selection(e){te(this.#t,e,!0)}#e;shiftSelectionAnchor;setSelection(e){if(!this.#e)return;const t=e.map(i=>this.imagesContainer?.querySelector(`[data-selectable][data-id="${i}"]`)).filter(i=>i!=null);this.#e.clearSelection(!0,!0);const s=this.#e.select(t,!0);return this.selection=s.map(i=>i.dataset.id).filter(i=>i!==void 0),s}refreshSelectables(){this.#e&&this.#e.resolveSelectables()}destroy(){this.#e?.destroy()}constructor(e,t=[],{ondeadclick:s}={}){if(this.selection=t,this.imagesContainer=e,!this.imagesContainer)return;const i=this.imagesContainer.parentElement??this.imagesContainer;this.#e=new Be({selectables:"[data-selectable]",boundaries:i,startAreas:i,selectionAreaClass:"viselect-selection-area",behaviour:{overlap:"keep"},features:{deselectOnBlur:!0}}),this.#e.on("start",({event:o})=>{o&&!o.ctrlKey&&!o.metaKey&&!o.shiftKey&&(this.selection=[])}),this.#e.on("move",({store:{changed:o}})=>{const n=$(o.removed),a=$(o.added);this.selection=[...this.selection.filter(c=>!n.includes(c)),...a]}),this.#e.on("stop",({event:o,store:{changed:n}})=>{n.added.length>0||n.removed.length>0||s?.(o)})}}function $(l){return l.filter(e=>e instanceof HTMLElement).map(e=>e.dataset.id).filter(be)}function Re(l,e){let t=null;function s(o={}){i(),t=new MutationObserver(n=>{n.forEach(a=>o[`on${a.type}`]?.(a))}),t.observe(l,o)}function i(){t?.disconnect(),t=null}return s(e),{update:s,destroy:i}}var Oe=j('<header class="svelte-1rb1ldh"><h2> </h2> <p><!></p></header>'),Ie=j('<section class="group svelte-1rb1ldh"><!> <div class="items svelte-1rb1ldh"></div></section>'),Ke=j('<div class="debug svelte-1rb1ldh"><code>selection <!> <br/> queued <!> <br/> loading <!> <br/> errored <!> <br/> preview urls <!> <br/></code></div>'),Pe=j('<section class="images svelte-1rb1ldh" data-testid="observations-area"><!> <!></section>');function tt(l,e){le(e,!0);let t=ee(void 0),s;re(()=>{if(g(t))return s?.destroy(),s=new De(g(t),b.selection,{ondeadclick:e.onemptyclick}),s.setSelection(b.selection),b.setSelection=r=>{if(!s){console.error("dragselect not initialized");return}s.setSelection(r)},()=>{s?.destroy(),b.setSelection=void 0}}),H(()=>{b.selection=[...new Set(s?.selection??[])]}),Ae("observations",{"$mod+a":{help:"Tout sélectionner",when:({target:r})=>!(r instanceof HTMLInputElement),do:()=>{s?.setSelection(e.items.map(r=>r.id))}},"$mod+d":{help:"Tout désélectionner",when:({target:r})=>!(r instanceof HTMLInputElement),do:()=>{b.selection=[],s?.setSelection([])}}});function i({id:r,virtual:m=!1}){return m?`${r}_virtual`:r}H(()=>{const r=g(t)?.querySelector(`[data-id="${e.highlight}"]`);r&&(r.style.scrollMarginTop="10vh",r.scrollIntoView({behavior:"instant",block:"start",inline:"nearest"}))});const o=K(()=>!e.groups||!e.grouping?[["",n(e.items,e.sort)]]:[...Se(e.items,e.grouping).entries()].filter(([,r])=>r&&r.length>0).map(([r,m])=>[r,n(m??[],e.sort)]).toSorted(Ee(([r])=>e.groups?.indexOf(r)??0)));function n(r,m){return r.toSorted((_,u)=>{switch(m.direction==="desc"&&([_,u]=[u,_]),m.key){case"id":return _.id.localeCompare(u.id);case"filename":return _.name.localeCompare(u.name);case"date":return we(_.addedAt,u.addedAt)}})}var a=Pe(),c=k(a);W(c,17,()=>g(o),([r,m])=>r,(r,m)=>{var _=K(()=>ue(g(m),2));let u=()=>g(_)[0],d=()=>g(_)[1];var h=Ie(),y=k(h);{var D=v=>{var A=Oe(),w=k(A),x=k(w,!0);L(w);var I=T(w,2),oe=k(I);pe(oe,()=>xe(d().length,["<code>#</code> élément","<code>#</code> éléments"])),L(I),L(A),F(()=>X(x,u())),R(v,A)};Y(y,v=>{u()&&v(D)})}var E=T(y,2);W(E,23,d,v=>i(v),(v,A,w)=>{var x=ce(),I=he(x);fe(I,()=>e.item,()=>g(A).data,()=>g(A),()=>g(w)),R(v,x)}),L(E),L(h),R(r,h)});var p=T(c,2);{var f=r=>{var m=Ke();{const E=(v,A=de)=>{N();var w=me();F(x=>X(w,`{
				${x??""}
				}`),[()=>[..._e(A())].map(x=>(x.length>10?"…":"")+x.slice(-10)).join(" ")]),R(v,w)};var _=k(m),u=T(k(_));E(u,()=>b.selection);var d=T(u,4);E(d,()=>b.queuedImages);var h=T(d,4);E(h,()=>b.loadingImages);var y=T(h,4);{let v=K(()=>b.erroredImages.keys());E(y,()=>g(v))}var D=T(y,4);{let v=K(()=>b.previewURLs.keys());E(D,()=>g(v))}N(2),L(_),L(m)}R(r,m)};Y(p,r=>{ye()&&e.items.length>0&&r(f)})}L(a),ge(a,r=>te(t,r),()=>g(t)),ve(a,(r,m)=>Re?.(r,m),()=>({childList:!0,subtree:!0,onchildList(){g(t)&&(s?.refreshSelectables(),s?.setSelection(b.selection))}})),R(l,a),ae()}export{tt as A};
