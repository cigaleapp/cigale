const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BCT7fajR.js","./DLg_PPZ_.js","./Csf0LG85.js","./nRrrBBXZ.js"])))=>i.map(i=>d[i]);
import"./DsnmJJEf.js";import{h as ce,i as r,A as ue,J as w,G as f,B as _e,F as M,aA as F,aB as T,K as U,g as l,aD as Y,aC as pe,aF as S,D as Q,t as K,aE as ie,I as Ee}from"./DLg_PPZ_.js";import{s as G}from"./9TbOa8jV.js";import{a as xe}from"./C_q2VfFz.js";import{r as ee,i as y,p as z,s as Ae}from"./D67Hg_eN.js";import{s as ke,d as Le,k as Me,A as $e,M as Be}from"./CaI1kqC-.js";import{c as J}from"./Dm35MxJ2.js";import{a as le,b as De}from"./BNnFn6yw.js";import{p as Te}from"./BGdIILBs.js";import{B as he}from"./BPUwB5iN.js";import{_ as ve}from"./PPVm8Dsz.js";import{e as Ve,f as Re,b as Ce}from"./BCT7fajR.js";import{h as we}from"./Csf0LG85.js";import{p as Ie}from"./hFci9Gn4.js";import{t as fe}from"./BVoxKip6.js";import{A as Oe}from"./B5LfmK4E.js";import{L as qe}from"./jGhSvLm_.js";import{B as Fe}from"./DceiQKom.js";import{s as Ue}from"./USdlu_3B.js";import{B as Se}from"./67TCgbdO.js";function We(o){return`${window.location.origin}${o}/protocol.schema.json`}async function kr(o,e,n="json"){const{tables:a,...d}=await ve(()=>import("./BCT7fajR.js").then(h=>h.a4),__vite__mapDeps([0,1,2,3]),import.meta.url),s=await a.Protocol.raw.get(e);if(!s)throw new Error(`Protocole ${e} introuvable`);const m=await d.list("MetadataOption");ge(o,n,{...s,metadata:Object.fromEntries(await a.Metadata.list().then(h=>h.filter(g=>s?.metadata.includes(g.id)).map(({id:g,...b})=>[g,{...b,options:m.filter(t=>t.id.startsWith(Re(s.id,g)+":")).map(({id:t,...u})=>u)}])))})}async function Lr(o,e){ge(o,e,{id:"mon-protocole",name:"Mon protocole",learnMore:"https://github.com/moi/mon-protocole",authors:[{name:"Prénom Nom",email:"prenom.nom@example.com"}],description:"Description de mon protocole",metadata:{"une-metadonnee":{label:"Une métadonnée",description:"Description de la métadonnée",learnMore:"https://example.com",type:"float",required:!1,mergeMethod:"average"}}})}function ge(o,e,n){let a=ke(e,We(o),n,["id","name","source","authors","exports","metadata","inference"]);Le(a,`${n.id}.${e}`,`application/${e}`)}async function Mr({allowMultiple:o,onInput:e=()=>{},importProtocol:n}){const a=await Ie({multiple:o,accept:".json,.yaml,application/json"});e();const d=await Promise.all([...a].map(async s=>{console.time(`Reading file ${s.name}`);const m=new FileReader;return new Promise(h=>{m.onload=async()=>{if(!m.result)throw new Error("Fichier vide");if(m.result instanceof ArrayBuffer)throw new Error("Fichier binaire");console.timeEnd(`Reading file ${s.name}`);const g=await n({contents:m.result,isJSON:s.name.endsWith(".json")}).catch(t=>Promise.reject(new Error(Ve(t)))),{tables:b}=await ve(async()=>{const{tables:t}=await import("./BCT7fajR.js").then(u=>u.a4);return{tables:t}},__vite__mapDeps([0,1,2,3]),import.meta.url);await b.Protocol.refresh(),await b.Metadata.refresh(),h(g)},m.readAsText(s)})}));return o?d:d[0]}async function Ne({version:o,source:e,id:n}){if(!e)throw new Error("Le protocole n'a pas de source");if(!o)throw new Error("Le protocole n'a pas de version");if(!n)throw new Error("Le protocole n'a pas d'identifiant");const a=await fetch(we(typeof e=="string"?e:e.url),typeof e!="string"?e:{headers:{Accept:"application/json"}}).then(d=>d.json()).then(Ce({"version?":"number",id:"string"}).assert);if(!a.version)throw new Error("Le protocole n'a plus de version");if(a.id!==n)throw new Error("Le protocole a changé d'identifiant");return a.version>o?{upToDate:!1,newVersion:a.version}:{upToDate:!0,newVersion:a.version}}async function ze({version:o,source:e,id:n,swarpc:a}){if(!e)throw new Error("Le protocole n'a pas de source");if(!o)throw new Error("Le protocole n'a pas de version");if(!n)throw new Error("Le protocole n'a pas d'identifiant");if(typeof e!="string")throw new Error("Les requêtes HTTP ne sont pas encore supportées, utilisez une URL");const{tables:d}=await ve(async()=>{const{tables:b}=await import("./BCT7fajR.js").then(t=>t.a4);return{tables:b}},__vite__mapDeps([0,1,2,3]),import.meta.url),s=await fetch(we(e),{headers:{Accept:"application/json"}}).then(b=>b.text()),m=await a.importProtocol({contents:s});d.Protocol.refresh(),d.Metadata.refresh();const{version:h,...g}=m;if(h===void 0)throw new Error("Le protocole a été importé mais n'a plus de version");return{version:h,...g}}var Je=ce('<svg><path fill="currentColor" d="M128 24a104 104 0 1 0 104 104A104.11 104.11 0 0 0 128 24m0 192a88 88 0 1 1 88-88a88.1 88.1 0 0 1-88 88m37.66-101.66a8 8 0 0 1-11.32 11.32L136 107.31V168a8 8 0 0 1-16 0v-60.69l-18.34 18.35a8 8 0 0 1-11.32-11.32l32-32a8 8 0 0 1 11.32 0Z"></path></svg>');function Ke(o,e){const n=ee(e,["$$slots","$$events","$$legacy"]);var a=Je();le(a,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...n})),r(o,a)}var Ge=ce('<svg><path fill="currentColor" d="M173.66 98.34a8 8 0 0 1 0 11.32l-56 56a8 8 0 0 1-11.32 0l-24-24a8 8 0 0 1 11.32-11.32L112 148.69l50.34-50.35a8 8 0 0 1 11.32 0M232 128A104 104 0 1 1 128 24a104.11 104.11 0 0 1 104 104m-16 0a88 88 0 1 0-88 88a88.1 88.1 0 0 0 88-88"></path></svg>');function He(o,e){const n=ee(e,["$$slots","$$events","$$legacy"]);var a=Ge();le(a,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...n})),r(o,a)}var Ze=ce('<svg><path fill="currentColor" d="M128 24a104 104 0 1 0 104 104A104.11 104.11 0 0 0 128 24m0 192a88 88 0 1 1 88-88a88.1 88.1 0 0 1-88 88m-8-80V80a8 8 0 0 1 16 0v56a8 8 0 0 1-16 0m20 36a12 12 0 1 1-12-12a12 12 0 0 1 12 12"></path></svg>');function se(o,e){const n=ee(e,["$$slots","$$events","$$legacy"]);var a=Ze();le(a,()=>({class:"icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...n})),r(o,a)}var Qe=M("<span> </span>"),Xe=M('<span class="version-check up-to-date svelte-1h004jq"><!> <!></span> <!>',1),Ye=M(" <!> ",1),er=M("<span><!> <!></span>"),rr=M('<span class="version-check error svelte-1h004jq"><!> <!></span>'),ar=M("<!> <!>",1),or=M('<span class="version-check svelte-1h004jq"><!> <!></span>'),tr=M("<!> Non versionné",1),nr=M('<span class="version-check error svelte-1h004jq"><!></span>');function $r(o,e){ue(e,!0);const n=Q(()=>Te.data.swarpc);let a=pe(0),d=pe(!1);const s=Q(()=>e.compact?Fe:he);var m=w(),h=f(m);{var g=t=>{var u=w(),$=f(u);Me($,()=>l(a),I=>{var V=w(),A=f(V);xe(A,()=>Ne({id:e.id,version:e.version,source:e.source}),p=>{var k=w(),E=f(k);J(E,()=>l(s),(B,x)=>{x(B,{help:"Recherche de mise à jour…",disabled:!0,onclick:()=>{},children:(R,P)=>{var L=ar(),j=f(L);$e(j,{});var c=T(j,2);{var v=_=>{var D=S("Mettre à jour");r(_,D)};y(c,_=>{e.compact||_(v)})}r(R,L)},$$slots:{default:!0}})}),r(p,k)},(p,k)=>{var E=Q(()=>{var{upToDate:c,newVersion:v}=l(k);return{upToDate:c,newVersion:v}}),B=Q(()=>l(E).upToDate),x=Q(()=>l(E).newVersion),R=w(),P=f(R);{var L=c=>{var v=w(),_=f(v);J(_,()=>l(s),(D,H)=>{H(D,{get help(){return`Le protocole est à jour (v${l(x)??""}). Cliquer pour vérifier à nouveau`},onclick:()=>{Y(a,Date.now(),!0)},children:(O,Pe)=>{var q=Xe(),W=f(q),Z=F(W);He(Z,{});var re=T(Z,2);{var ae=i=>{var C=S("À jour");r(i,C)};y(re,i=>{e.compact||i(ae)})}U(W);var oe=T(W,2);{var te=i=>{var C=Qe(),ne=F(C);U(C),K(()=>G(ne,`v${e.version??""}`)),r(i,C)};y(oe,i=>{e.compact||i(te)})}r(O,q)},$$slots:{default:!0}})}),r(c,v)},j=c=>{var v=w(),_=f(v);J(_,()=>l(s),(D,H)=>{H(D,{onclick:async()=>{Y(d,!0),await ze({version:e.version,source:e.source,id:e.id,swarpc:l(n)}).then(({version:O})=>{fe.success(`Protocole mis à jour vers la v${O}`)}).catch(O=>{fe.error(`Impossible de mettre à jour le protocole: ${O}`)}).finally(()=>{Y(d,!1)})},get help(){return`Une mise à jour vers la v${l(x)??""} est disponible`},children:(O,Pe)=>{var q=er();let W;var Z=F(q);{var re=i=>{qe(i,{})},ae=i=>{Ke(i,{})};y(Z,i=>{l(d)?i(re):i(ae,!1)})}var oe=T(Z,2);{var te=i=>{var C=w(),ne=f(C);{var je=N=>{var X=S("Mise à jour…");r(N,X)},ye=N=>{var X=Ye(),de=f(X),me=T(de);Oe(me,{});var be=T(me);K(()=>{G(de,`v${e.version??""} `),G(be,` v${l(x)??""}`)}),r(N,X)};y(ne,N=>{l(d)?N(je):N(ye,!1)})}r(i,C)};y(oe,i=>{e.compact||i(te)})}U(q),K(i=>W=De(q,1,"version-check svelte-1h004jq",null,W,i),[()=>({"update-available":!l(d)})]),r(O,q)},$$slots:{default:!0}})}),r(c,v)};y(P,c=>{l(B)?c(L):c(j,!1)})}r(p,R)},(p,k)=>{var E=w(),B=f(E);J(B,()=>l(s),(x,R)=>{R(x,{onclick:()=>{Y(a,Date.now(),!0)},get help(){return`Impossible de mettre à jour le protocole: ${l(k)??""}`},children:(P,L)=>{var j=rr(),c=F(j);se(c,{});var v=T(c,2);{var _=D=>{var H=S("Rééssayer");r(D,H)};y(v,D=>{e.compact||D(_)})}U(j),r(P,j)},$$slots:{default:!0}})}),r(p,E)}),r(I,V)}),r(t,u)},b=t=>{var u=w(),$=f(u);{var I=A=>{var p=w(),k=f(p);J(k,()=>l(s),(E,B)=>{B(E,{onclick:()=>{},help:"Ce protocole ne supporte pas la vérification des mises à jour",children:(x,R)=>{var P=or(),L=F(P);se(L,{});var j=T(L,2);{var c=v=>{var _=S();K(()=>G(_,`v${e.version??""}`)),r(v,_)};y(j,v=>{e.compact||v(c)})}U(P),r(x,P)},$$slots:{default:!0}})}),r(A,p)},V=A=>{var p=w(),k=f(p);J(k,()=>l(s),(E,B)=>{B(E,{onclick:()=>{},help:"Ce protocole n'est pas versionné, pour le mettre à jour, supprimer le et importez la nouvelle version",children:(x,R)=>{var P=nr(),L=F(P);{var j=c=>{var v=tr(),_=f(v);se(_,{}),ie(),r(c,v)};y(L,c=>{e.compact||c(j)})}U(P),r(x,P)},$$slots:{default:!0}})}),r(A,p)};y($,A=>{e.version?A(I):A(V,!1)},!0)}r(t,u)};y(h,t=>{e.version&&e.source?t(g):t(b,!1)})}r(o,m),_e()}var sr=M('<div class="actions svelte-owp9dc"><!> <!></div>');function Br(o,e){ue(e,!0);let n=z(e,"oncancel",3,void 0),a=z(e,"children",3,void 0),d=z(e,"confirm",3,"OK"),s=z(e,"cancel",3,"Annuler"),m=z(e,"close",15,void 0),h=z(e,"open",15,void 0),g=ee(e,["$$slots","$$events","$$legacy","onconfirm","oncancel","children","confirm","cancel","close","open"]);Be(o,Ae(()=>g,{get close(){return m()},set close(t){m(t)},get open(){return h()},set open(t){h(t)},footer:t=>{var u=sr(),$=F(u);he($,{loading:!0,onclick:async()=>{await n()?.(),m()?.()},children:(V,A)=>{ie();var p=S();K(()=>G(p,s())),r(V,p)},$$slots:{default:!0}});var I=T($,2);Se(I,{loading:!0,onclick:async()=>{await e.onconfirm(),m()?.()},children:(V,A)=>{ie();var p=S();K(()=>G(p,d())),r(V,p)},$$slots:{default:!0}}),U(u),r(t,u)},children:(t,u)=>{var $=w(),I=f($);Ue(I,()=>a()??Ee),r(t,$)},$$slots:{footer:!0,default:!0}})),_e()}export{Ke as A,$r as B,Br as M,Lr as d,kr as e,We as j,Mr as p};
