import{e as Ve}from"../chunks/CTlA2v4V.js";import{t as A,a as We,d as we,v as Xe,r as ue,w as Je,n as Ke,e as Qe}from"../chunks/h9n_zjAt.js";import{m as Ye,e as Ze}from"../chunks/BgPK52sz.js";import{n as et,s as tt}from"../chunks/C0SiBqD8.js";import"../chunks/DsnmJJEf.js";import{f as ie,a as g,p as je,I as D,F as V,g as e,u as o,ai as p,b as He,ak as f,K as v,D as be,J as fe,H,al as K,aj as pe,M as at,aF as rt,am as ot,G as st}from"../chunks/Dt6m180S.js";import{s as Q,e as lt}from"../chunks/BqMK6M8M.js";import{s as nt}from"../chunks/BEu91mT_.js";import{r as de,i as z}from"../chunks/cmrSGx3m.js";import{e as it}from"../chunks/Bmx3KKup.js";import{c as dt}from"../chunks/BV68B1uN.js";import{e as vt}from"../chunks/gWcRFNzI.js";import{a as ee,t as te}from"../chunks/C3lM_sxf.js";import{a as ae,d as _e,c as le,C as ct,b as mt,s as Le}from"../chunks/CoW7fDOc.js";import{a as N,f as q,t as ne}from"../chunks/DM93I2Od.js";import{b as ut}from"../chunks/jhyMdidl.js";import{A as Ce}from"../chunks/DkZwE8qq.js";import{A as ft}from"../chunks/ChO_7ts8.js";import{C as pt}from"../chunks/Dwrc_ql2.js";import{D as Oe}from"../chunks/C0se_-sl.js";import{F as _t}from"../chunks/DeKZ_c75.js";import{I as ht}from"../chunks/C3qGf-D7.js";import{L as gt}from"../chunks/C5mmvBok.js";import{M as $t,S as wt}from"../chunks/CfbReYZC.js";import{i as bt}from"../chunks/CyxF7S3o.js";import{p as B}from"../chunks/BQgdUy12.js";import{B as xt}from"../chunks/DZd6ULkr.js";import{B as Y}from"../chunks/BAG1AaOD.js";import{B as he}from"../chunks/cTmsNnlM.js";import{I as yt}from"../chunks/B1xj52Zc.js";import{I as ge}from"../chunks/DRBqBfVL.js";import{S as It}from"../chunks/D55UtfKh.js";import{S as Pt}from"../chunks/DI3RhD0J.js";import{g as Z,r as Ae}from"../chunks/CoCzgeuV.js";import{s as kt}from"../chunks/DDk1L18j.js";import{u as ze}from"../chunks/fpNj8U5y.js";import{n as Mt}from"../chunks/BlnV6Gf8.js";import{u as Fe}from"../chunks/B5pl0uZM.js";import{R as $e}from"../chunks/CH5FdpMr.js";async function St({params:x,depends:d}){const _=await A.Protocol.get(x.id);console.info("Loaded protocol from load function",_);const r=We("js");_||Ve(404,r(444,[x.id])),d(we("Protocol",x.id)),_.metadata.map(L=>d(we("Metadata",L)));const{metadataOrder:n}=_;return{..._,metadataDefinitions:await Promise.all(_.metadata.toSorted(Ye({metadataOrder:n})).map(async L=>A.Metadata.get(L))).then(L=>L.filter(et))}}const Ra=Object.freeze(Object.defineProperty({__proto__:null,load:St},Symbol.toStringTag,{value:"Module"}));var Dt=ie('<svg><path fill="currentColor" d="m4.836 12l6.207 6.207l1.414-1.414L7.664 12l4.793-4.793l-1.414-1.414zm5.65 0l6.207 6.207l1.414-1.414L13.314 12l4.793-4.793l-1.414-1.414z"></path></svg>');function Bt(x,d){const _=de(d,["$$slots","$$events","$$legacy"]);var r=Dt();ae(r,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",..._})),g(x,r)}var Lt=ie('<svg><path fill="currentColor" d="M7.828 11H20v2H7.828l5.364 5.364l-1.414 1.414L4 12l7.778-7.778l1.414 1.414z"></path></svg>');function Re(x,d){const _=de(d,["$$slots","$$events","$$legacy"]);var r=Lt();ae(r,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",..._})),g(x,r)}var Ct=ie('<svg><path fill="currentColor" d="m19.164 12l-6.207-6.207l-1.414 1.414L16.336 12l-4.793 4.793l1.414 1.414zm-5.65 0L7.307 5.793L5.893 7.207L10.686 12l-4.793 4.793l1.414 1.414z"></path></svg>');function Ot(x,d){const _=de(d,["$$slots","$$events","$$legacy"]);var r=Ct();ae(r,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",..._})),g(x,r)}var At=ie('<svg><path fill="currentColor" d="m10.904 2.1l9.9 1.414l1.414 9.9l-9.192 9.192a1 1 0 0 1-1.415 0l-9.9-9.9a1 1 0 0 1 0-1.413zm.707 2.122L3.833 12l8.485 8.485l7.779-7.778l-1.061-7.425zm2.122 6.363a2 2 0 1 1 2.828-2.828a2 2 0 0 1-2.828 2.829"></path></svg>');function zt(x,d){const _=de(d,["$$slots","$$events","$$legacy"]);var r=At();ae(r,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",..._})),g(x,r)}var Ft=D("<span><!></span>"),Rt=D("<span><!></span>"),jt=D("<span><!></span>"),Ht=D("<!> <!>",1);function Nt(x,d){je(d,!0);const _=o(()=>d.metadata.label),r=o(()=>d.metadata.id),n=o(()=>d.metadata.infer);var L=Ht(),W=V(L);{var E=P=>{var c=Ft();_e(c,"",{},{color:"var(--fg-error)"});var F=f(c);It(F,{}),v(c),ee(c,(R,O)=>te?.(R,O),()=>"Métadonnée technique"),g(P,c)};z(W,P=>{e(_)||P(E)})}var re=p(W,2);{var X=P=>{var c=Rt();_e(c,"",{},{color:"var(--fg-primary)"});var F=f(c);Pt(F,{}),v(c),ee(c,(R,O)=>te?.(R,O),()=>"Inférence par réseau neuronal"),g(P,c)},J=P=>{var c=be(),F=V(c);{var R=O=>{var C=jt();_e(C,"",{},{color:"var(--fg-primary)"});var T=f(C);zt(T,{}),v(C),ee(C,(oe,se)=>te?.(oe,se),()=>"exif"in e(n)?`Inféré à partir du champ EXIF ${e(n).exif}`:`Inféré à partir des coordonnées GPS EXIF (latitude: ${e(n).latitude.exif}, longitude: ${e(n).longitude.exif})`),g(O,C)};z(F,O=>{e(n)&&("exif"in e(n)||"latitude"in e(n)&&"exif"in e(n).latitude)&&O(R)},!0)}g(P,c)};z(re,P=>{e(r)===d.protocol.crop?.metadata||e(n)&&"neural"in e(n)?P(X):P(J,!1)})}g(x,L),He()}var qt=D('<span class="badge svelte-1efdthw"> </span>'),Et=D('<div class="menu-icon svelte-1efdthw"><!></div> <!>',1),Tt=D('<header class="svelte-1efdthw"><div class="top-actions svelte-1efdthw"><!> <!></div> <h1 class="svelte-1efdthw"><!></h1> <code class="subtitle svelte-1efdthw"><!></code> <section class="actions svelte-1efdthw"><!> <!></section></header>'),Gt=D('<header class="svelte-1efdthw"><!></header>'),Ut=D('<div class="navlink svelte-1efdthw"><div class="menu-icon svelte-1efdthw"><!></div></div>'),Vt=D('<form class="navlink svelte-1efdthw"><div class="menu-icon standin svelte-1efdthw"></div> <!> <!></form>'),Wt=D('<a><div class="menu-icon svelte-1efdthw"> </div> <div class="datatype-icon svelte-1efdthw"><!></div></a>'),Xt=D('<div class="menu-icon standin svelte-1efdthw"></div> <a class="svelte-1efdthw"> <!></a> <div class="action svelte-1efdthw"><!></div>',1),Jt=D("<div><!></div>"),Kt=D('<div class="sidebar-and-main svelte-1efdthw"><aside><!> <!> <nav class="svelte-1efdthw"><!> <!> <!> <!> <!> <!> <nav class="metadata svelte-1efdthw"></nav></nav> <div class="collapse-toggle"><!></div></aside> <main><!></main></div>');function ja(x,d){je(d,!0);const _=(t,a=fe,s=fe,l=fe,i)=>{let h=at(()=>rt(i?.(),void 0));var y=be(),k=V(y);vt(k,()=>s()?"a":"span",!1,(G,U)=>{ee(G,($,I)=>te?.($,I),()=>e(c)?{text:a(),placement:"right"}:void 0),ae(G,$=>({href:s()?`#/protocols/${e(n)}/${s()}`:void 0,class:"navlink",[ct]:$}),[()=>({active:s()&&B.route.id?.includes(`/protocols/[id]/${s()}`)})],void 0,void 0,"svelte-1efdthw");var M=Et(),b=V(M),m=f(b);dt(m,l,($,I)=>{I($,{})}),v(b);var u=p(b),S=p(u);{var w=$=>{var I=qt(),j=f(I,!0);v(I),H(()=>Q(j,e(h))),g($,I)};z(S,$=>{e(h)!==void 0&&$(w)})}H(()=>Q(u,` ${a()??""} `)),g(U,M)}),g(t,y)},r=o(()=>mt("main"));kt({title:e(r)(214,[B.params.id])});let n=o(()=>d.data.id),L=o(()=>d.data.name),W=o(()=>d.data.version),E=o(()=>d.data.metadata),re=o(()=>d.data.metadataDefinitions),X=o(()=>d.data.metadataOrder),J=pe(void 0),P=pe(null),c=pe(!1);Mt("hidden");async function F(t){t.preventDefault();const a=t.currentTarget.elements.item(0);if(!a?.value)return;const s=a.value.trim();try{let l=Ke(e(n),tt(s).replaceAll("-","_"));e(E).includes(l)&&(l+=`_${e(E).filter(h=>h.startsWith(l)).length+1}`),await A.Metadata.set({id:l,label:s,description:"",type:"string",mergeMethod:"none",required:!1}),await A.Protocol.update(e(n),"metadata",[l,...e(E)]),e(X)&&await A.Protocol.update(e(n),"metadataOrder",[l,...e(X)]),await bt(we("Protocol",e(n)));const i=ue(l);a.value="",e(P)?.children.item(e(E).length-1)?.scrollIntoView({behavior:"smooth",block:"end"}),ne.success(e(r)(375,[i])),await Z("/(app)/protocols/[id]/metadata/[metadata]/infos",{id:e(n),metadata:i})}catch(l){ne.error(Qe(l,"Impossible de créer la métadonnée"))}}async function R(t){const a=structuredClone(e(X)),s=ue(t.id),l=Fe((i,h)=>{h==="undo"?(i.metadata.push(t.id),a&&(i.metadataOrder=a)):(i.metadata=i.metadata.filter(y=>y!==t.id),i.metadataOrder&&(i.metadataOrder=i.metadataOrder.filter(y=>y!==t.id)))});await l("remove"),ne.withUndo("success",`Métadonnée ${s} supprimée`,{undo:async()=>l("undo"),commit:async()=>A.Metadata.remove(t.id)})}async function O(t,a){if(!t){a(e(n));return}await A.Protocol.update(e(n),"id",t),await A.Protocol.remove(e(n)),K(n,t),B.route?.id&&await Z(B.route.id,{...B.params,id:t})}var C=Kt(),T=f(C);let oe;var se=f(T);{var Ne=t=>{var a=Tt(),s=f(a),l=f(s);{const m=u=>{Re(u,{})};he(l,{onclick:()=>Z("/protocols"),_w_snippet_0:m,children:(u,S)=>{{let w=o(()=>[m]),$=o(()=>e(r).c(215));$e(u,{get t(){return e(w)},get x(){return e($)}})}},$$slots:{_w_snippet_0:!0,default:!0}})}var i=p(l,2);{let m=o(()=>e(r)(216));xt(i,{get tooltip(){return e(m)},children:(u,S)=>{ot();var w=st();H($=>Q(w,$),[()=>e(r)(217)]),g(u,w)}})}v(s);var h=p(s,2),y=f(h);{let m=o(()=>e(r)(209)),u=o(()=>Fe((S,w)=>{S.name=w}));ge(y,{get label(){return e(m)},discreet:!0,get value(){return e(L)},get onblur(){return e(u)}})}v(h);var k=p(h,2),G=f(k);{let m=o(()=>e(r)(218));ge(G,{get label(){return e(m)},discreet:!0,get value(){return e(n)},onblur:O})}v(k);var U=p(k,2),M=f(U);{const m=u=>{wt(u,{})};he(M,{onclick:async()=>{await Ze(Xe(),Ae("/"),e(n)).catch(u=>ne.error(u))},_w_snippet_1:m,children:(u,S)=>{{let w=o(()=>[m]),$=o(()=>e(r).c(219));$e(u,{get t(){return e(w)},get x(){return e($)}})}},$$slots:{_w_snippet_1:!0,default:!0}})}var b=p(M,2);{const m=S=>{Oe(S,{})};let u=o(()=>e(n)===ze.currentProtocolId&&ze.processing.total>0);he(b,{dangerous:!0,get disabled(){return e(u)},onclick:()=>e(J)?.(),_w_snippet_2:m,children:(S,w)=>{{let $=o(()=>[m]),I=o(()=>e(r).c(15));$e(S,{get t(){return e($)},get x(){return e(I)}})}},$$slots:{_w_snippet_2:!0,default:!0}})}v(U),v(a),N(1,a,()=>q),g(t,a)},qe=t=>{var a=Gt(),s=f(a);{let l=o(()=>e(r)(220));Y(s,{get help(){return e(l)},tooltipParams:{placement:"right"},onclick:()=>Z("/protocols"),children:(i,h)=>{Re(i,{})},$$slots:{default:!0}})}v(a),N(1,a,()=>q),g(t,a)};z(se,t=>{e(c)?t(qe,!1):t(Ne)})}var xe=p(se,2);$t(xe,{get id(){return e(n)},ondelete:()=>Z("/protocols"),get open(){return e(J)},set open(t){K(J,t,!0)}});var ve=p(xe,2),ye=f(ve);_(ye,()=>"Informations",()=>"infos",()=>ht);var Ie=p(ye,2);_(Ie,()=>"Versionnage",()=>"versioning",()=>ft,()=>e(W)?`v${e(W)}`:void 0);var Pe=p(Ie,2);_(Pe,()=>"Exports",()=>"exports",()=>_t);var ke=p(Pe,2);_(ke,()=>"Recadrage",()=>"cropping",()=>pt);var Me=p(ke,2);_(Me,()=>"Métadonnées",()=>"",()=>gt,()=>e(re).length);var Se=p(Me,2);{var Ee=t=>{var a=Ut(),s=f(a),l=f(s);{let i=o(()=>e(r)(221));Y(l,{get help(){return e(i)},tooltipParams:{placement:"right"},onclick:()=>K(c,!1),children:(h,y)=>{Ce(h,{})},$$slots:{default:!0}})}v(s),v(a),N(1,a,()=>q),g(t,a)},Te=t=>{var a=Vt(),s=p(f(a),2);{let i=o(()=>e(r)(222));ge(s,{get label(){return e(i)},value:"",discreet:!0,placeholder:{idle:"Nouvelle métadonnée…",focused:"Nom de la métadonnée"},onblur:()=>{}})}var l=p(s,2);{let i=o(()=>e(r)(223));Y(l,{get help(){return e(i)},submits:!0,onclick:()=>{},children:(h,y)=>{Ce(h,{})},$$slots:{default:!0}})}v(a),lt("submit",a,F),N(1,a,()=>q),g(t,a)};z(Se,t=>{e(c)?t(Ee):t(Te,!1)})}var ce=p(Se,2);it(ce,21,()=>e(re),t=>t.id,(t,a)=>{const s=o(()=>ue(e(a).id)),l=o(()=>e(a).label||e(s)),i=o(()=>Ae(B.route.id?.includes("/protocols/[id]/metadata/[metadata]/")?B.route.id:"/(app)/protocols/[id]/metadata/[metadata]/infos",{...B.params,id:e(n),metadata:e(s)}));var h=Jt();let y;var k=f(h);{var G=M=>{var b=Wt();let m;var u=f(b),S=f(u,!0);v(u);var w=p(u,2),$=f(w);yt($,{tooltip:!1,get type(){return e(a).type}}),v(w),v(b),ee(b,(I,j)=>te?.(I,j),()=>({text:e(l),placement:"right"})),H((I,j)=>{m=le(b,1,"navlink svelte-1efdthw",null,m,I),Le(b,"href",e(i)),Q(S,j)},[()=>({active:B.url.hash.includes(`metadata/${e(s)}/`)}),()=>Je(e(l)).slice(0,2)]),N(1,b,()=>q),g(M,b)},U=M=>{var b=Xt(),m=p(V(b),2),u=f(m),S=p(u);Nt(S,{get metadata(){return e(a)},get protocol(){return d.data}}),v(m);var w=p(m,2),$=f(w);{let I=o(()=>e(r)(224));Y($,{dangerous:!0,get help(){return e(I)},onclick:async()=>R(e(a)),children:(j,Qt)=>{Oe(j,{})},$$slots:{default:!0}})}v(w),H(()=>{Le(m,"href",e(i)),Q(u,`${(e(a).label||e(s))??""} `)}),N(1,m,()=>q),g(M,b)};z(k,M=>{e(c)?M(G):M(U,!1)})}v(h),H(M=>y=le(h,1,"navlink svelte-1efdthw",null,y,M),[()=>({active:B.url.hash.includes(`metadata/${e(s)}/`)})]),g(t,h)}),v(ce),ut(ce,t=>K(P,t),()=>e(P)),v(ve);var De=p(ve,2),Ge=f(De);{let t=o(()=>e(c)?"Déplier":"Replier");Y(Ge,{get help(){return e(t)},onclick:()=>{K(c,!e(c))},children:(a,s)=>{var l=be(),i=V(l);{var h=k=>{Ot(k,{})},y=k=>{Bt(k,{})};z(i,k=>{e(c)?k(h):k(y,!1)})}g(a,l)},$$slots:{default:!0}})}v(De),v(T);var me=p(T,2);let Be;var Ue=f(me);nt(Ue,()=>d.children),v(me),v(C),H(t=>{oe=le(T,1,"svelte-1efdthw",null,oe,{collapsed:e(c)}),Be=le(me,1,"svelte-1efdthw",null,Be,t)},[()=>({padded:!B.route.id?.startsWith("/(app)/protocols/[id]/metadata/")})]),N(1,C,()=>q,()=>({duration:100})),g(x,C),He()}export{ja as component,Ra as universal};
