import"../chunks/DsnmJJEf.js";import{f as be,a as v,aj as N,g as e,al as w,an as fe,u as n,p as Vt,c as ot,I as C,bD as Ha,ak as g,ai as h,J as Ze,K as f,H as G,b as Dt,ao as Pa,am as ze,F as Y,D as $e,aG as Zt,G as Qe}from"../chunks/Dt6m180S.js";import{d as ca,e as qt,s as ue,r as ja}from"../chunks/BqMK6M8M.js";import{s as Je}from"../chunks/CFbM8ao4.js";import{r as xe,p as St,i as F,s as Ra}from"../chunks/cmrSGx3m.js";import{c as Ea}from"../chunks/BptB6vFW.js";import{e as Be,i as Xt}from"../chunks/Bmx3KKup.js";import{A as La,C as Ta,h as Fa}from"../chunks/NbfWC8Id.js";import{c as Qt}from"../chunks/BV68B1uN.js";import{a as Pe,t as je,K as Na}from"../chunks/C3lM_sxf.js";import{a as we,c as Te,s as Ee,d as Le,b as Ga}from"../chunks/CoW7fDOc.js";import{b as ua}from"../chunks/jhyMdidl.js";import{w as ha}from"../chunks/C02cds9o.js";import{A as Ua}from"../chunks/Cyg8Xawz.js";import{A as Wa}from"../chunks/SDlUiTWo.js";import{C as Ja}from"../chunks/Dwrc_ql2.js";import{D as ea}from"../chunks/C0se_-sl.js";import{F as Ka}from"../chunks/ByO0j4mQ.js";import{S as Ya}from"../chunks/DI3RhD0J.js";import{p as Za}from"../chunks/BQgdUy12.js";import{w as Xa,c as Bt,t as Ke,b as Qa,d as Re,e as er}from"../chunks/yErRaHIP.js";import{B as Ye}from"../chunks/BAG1AaOD.js";import{B as ta}from"../chunks/cTmsNnlM.js";import{B as $t}from"../chunks/BWvVnymT.js";import{C as tr}from"../chunks/i0qVP9iW.js";import{b as ar,v as Se,t as rt,a1 as rr,z as aa}from"../chunks/h9n_zjAt.js";import{b as Oe,t as Xe,m as Ot,v as ra,w as ir,x as nr}from"../chunks/C0SiBqD8.js";import{e as st,h as sr,j as or,k as Ct,i as lr,d as dr}from"../chunks/CXutPItK.js";import{i as ia,a as na,s as cr,t as ur}from"../chunks/JZH0u_ZA.js";import{u as ke,g as hr,e as vr}from"../chunks/62CSzXnv.js";import{L as fr}from"../chunks/CJbDBvUJ.js";import{a as gr,h as mr}from"../chunks/CpDocbkH.js";import{d as At,a as it}from"../chunks/BHxAX_Yx.js";import{g as ve}from"../chunks/CoCzgeuV.js";import{P as sa}from"../chunks/1LLQNKI6.js";import{s as pr}from"../chunks/BEu91mT_.js";import{s as _r}from"../chunks/DDk1L18j.js";import{u as _}from"../chunks/fpNj8U5y.js";import{S as br}from"../chunks/BOHcG-kb.js";import{t as oa}from"../chunks/DM93I2Od.js";import{T as xr}from"../chunks/BJm0yZll.js";import{n as wr}from"../chunks/BlnV6Gf8.js";import{R as _e}from"../chunks/CH5FdpMr.js";var yr=be('<svg><path fill="currentColor" d="M2.5 7a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m0 10a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m10 0a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m-3-10a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0m0 10a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0m10 0a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0M16 11V8h-3V6h3V3h2v3h3v2h-3v3z"></path></svg>');function kr(M,r){const s=xe(r,["$$slots","$$events","$$legacy"]);var l=yr();we(l,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),v(M,l)}var Ir=be('<svg><path fill="currentColor" d="m5.828 7l2.536 2.535L6.95 10.95L2 6l4.95-4.95l1.414 1.415L5.828 5H13a8 8 0 1 1 0 16H4v-2h9a6 6 0 0 0 0-12z"></path></svg>');function Mr(M,r){const s=xe(r,["$$slots","$$events","$$legacy"]);var l=Ir();we(l,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),v(M,l)}var zr=be('<svg><path fill="currentColor" d="M16 7h-5a6 6 0 1 0 0 12h9v2h-9a8 8 0 1 1 0-16h5V1l6 5l-6 5z"></path></svg>');function $r(M,r){const s=xe(r,["$$slots","$$events","$$legacy"]);var l=zr();we(l,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),v(M,l)}var Cr=be('<svg><path fill="currentColor" d="m11.602 13.76l1.412 1.412l8.466-8.466l1.414 1.415l-9.88 9.88l-6.364-6.365l1.414-1.414l2.125 2.125zm.002-2.828l4.952-4.953l1.41 1.41l-4.952 4.953zm-2.827 5.655L7.364 18L1 11.636l1.414-1.414l1.413 1.413l-.001.001z"></path></svg>');function nt(M,r){const s=xe(r,["$$slots","$$events","$$legacy"]);var l=Cr();we(l,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),v(M,l)}var Ar=be('<svg><path fill="currentColor" d="M11 5.07A7.005 7.005 0 0 0 5.07 11H7v2H5.07A7 7 0 0 0 11 18.93V17h2v1.93A7 7 0 0 0 18.93 13H17v-2h1.93A7 7 0 0 0 13 5.07V7h-2zM3.055 11A9.004 9.004 0 0 1 11 3.055V1h2v2.055A9.004 9.004 0 0 1 20.945 11H23v2h-2.055A9.004 9.004 0 0 1 13 20.945V23h-2v-2.055A9.004 9.004 0 0 1 3.055 13H1v-2zM14 12a2 2 0 1 1-4 0a2 2 0 0 1 4 0"></path></svg>');function qr(M,r){const s=xe(r,["$$slots","$$events","$$legacy"]);var l=Ar();we(l,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),v(M,l)}var Sr=be('<svg><path fill="currentColor" d="M13 19.938A8.004 8.004 0 0 0 19.938 13H17v-2h2.938A8.004 8.004 0 0 0 13 4.062V7h-2V4.062A8.004 8.004 0 0 0 4.062 11H7v2H4.062A8.004 8.004 0 0 0 11 19.938V17h2zM12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m0-8a2 2 0 1 1 0-4a2 2 0 0 1 0 4"></path></svg>');function Br(M,r){const s=xe(r,["$$slots","$$events","$$legacy"]);var l=Sr();we(l,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),v(M,l)}var Or=be('<svg><path fill="currentColor" d="M18 11V8l4 4l-4 4v-3h-5v5h3l-4 4l-4-4h3v-5H6v3l-4-4l4-4v3h5V6H8l4-4l4 4h-3v5z"></path></svg>');function Vr(M,r){const s=xe(r,["$$slots","$$events","$$legacy"]);var l=Or();we(l,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),v(M,l)}var Dr=be('<svg><path fill="currentColor" d="M12.5 2a.5.5 0 0 0-.5.5V12h-2V4.5a.5.5 0 0 0-1 0V14H7c-.38-1.62-1.358-2.56-2.405-2.678A89 89 0 0 0 6.166 15.1c.86 1.962 1.725 3.422 2.838 4.399C10.078 20.442 11.459 21 13.5 21a5.5 5.5 0 0 0 5.5-5.5V7a.5.5 0 0 0-1 0v5h-2V4a.5.5 0 0 0-1 0v8h-2V2.5a.5.5 0 0 0-.5-.5M21 15.5a7.5 7.5 0 0 1-7.5 7.5c-2.458 0-4.328-.692-5.816-1.998c-1.45-1.274-2.459-3.064-3.35-5.1c-.93-2.127-1.444-3.422-1.724-4.178c-.357-.964.136-2.312 1.476-2.406a4.02 4.02 0 0 1 2.914.94V4.5a2.5 2.5 0 0 1 3.04-2.442a2.5 2.5 0 0 1 4.79-.467A2.502 2.502 0 0 1 18 4v.55q.243-.05.5-.05A2.5 2.5 0 0 1 21 7z"></path></svg>');function Hr(M,r){const s=xe(r,["$$slots","$$events","$$legacy"]);var l=Dr();we(l,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),v(M,l)}var Pr=be('<svg><path fill="currentColor" d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2v2a8 8 0 1 0 5.135 1.865L15 8V2h6l-2.447 2.447A9.98 9.98 0 0 1 22 12"></path></svg>');function la(M,r){const s=xe(r,["$$slots","$$events","$$legacy"]);var l=Pr();we(l,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),v(M,l)}var jr=be('<svg><path fill="currentColor" d="M20 16h2v6h-6v-2H8v2H2v-6h2V8H2V2h6v2h8V2h6v6h-2zm-2 0V8h-2V6H8v2H6v8h2v2h8v-2zM4 4v2h2V4zm0 14v2h2v-2zM18 4v2h2V4zm0 14v2h2v-2z"></path></svg>');function Rr(M,r){const s=xe(r,["$$slots","$$events","$$legacy"]);var l=jr();we(l,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),v(M,l)}const da={origin:{x:0,y:0},scale:1,panning:!1,panStart:{x:0,y:0,zoomOrigin:{x:0,y:0}}};function Er({naturalWidth:M,naturalHeight:r,clientWidth:s,clientHeight:l,clientTop:O,clientLeft:u},D){const U=M/r,se=s/l;let oe=0,T=0;return U<se?(oe=l*U,T=l):(T=s/U,oe=s),D&&(oe*=D.scale,T*=D.scale),{width:oe,height:T,x:(D?.origin.x??0)+u+(s-oe)/2,y:(D?.origin.y??0)+O+(l-T)/2}}class Lr{limits={x:0,y:0,width:0,height:0};#e=N("clickanddrag");get createMode(){return e(this.#e)}set createMode(r){w(this.#e,r,!0)}setCreateMode(r){this.createMode=r}#t=N(fe({x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}}));get clickanddrag(){return e(this.#t)}set clickanddrag(r){w(this.#t,r,!0)}#a=N(fe([]));get points(){return e(this.#a)}set points(r){w(this.#a,r,!0)}#r=n(()=>this.createMode==="clickanddrag"?ar({x:"number > 0",y:"number > 0",width:"number > 0",height:"number > 0"}).allows(this.clickanddrag):this.createMode=="2point"?this.points.length>=2:this.createMode==="4point"?this.points.length>=4:!1);get ready(){return e(this.#r)}set ready(r){w(this.#r,r)}clamp(r){return{x:Oe(r.x,this.limits.x,this.limits.width),y:Oe(r.y,this.limits.y,this.limits.height),width:Oe(r.width,0,this.limits.width-r.x),height:Oe(r.height,0,this.limits.height-r.y)}}#i=n(()=>this.createMode==="clickanddrag"?this.clickanddrag.x:this.createMode==="off"?0:Math.min(...this.points.map(r=>r.x)));get x(){return e(this.#i)}set x(r){w(this.#i,r)}#n=n(()=>this.createMode==="clickanddrag"?this.clickanddrag.y:this.createMode==="off"?0:Math.min(...this.points.map(r=>r.y)));get y(){return e(this.#n)}set y(r){w(this.#n,r)}#s=n(()=>this.createMode==="clickanddrag"?this.clickanddrag.width:this.createMode==="off"?0:Math.max(...this.points.map(r=>r.x))-this.x);get width(){return e(this.#s)}set width(r){w(this.#s,r)}#o=n(()=>this.createMode==="clickanddrag"?this.clickanddrag.height:this.createMode==="off"?0:Math.max(...this.points.map(r=>r.y))-this.y);get height(){return e(this.#o)}set height(r){w(this.#o,r)}registerPoint(r,s){if(this.createMode!=="off"){if(this.createMode==="clickanddrag"){this.clickanddrag={...this.clickanddrag,x:r,y:s};return}this.points.push({x:r,y:s})}}registerMovement(r,s){if(this.createMode!=="clickanddrag")return;const{width:l,height:O}=this.clickanddrag;(l<=0||O<=0)&&(this.clickanddrag.dragDirection={x:Xe(r),y:Xe(s)});const{x:u,y:D}=this.clickanddrag.dragDirection;u>0&&D>0&&(this.clickanddrag.width+=r,this.clickanddrag.height+=s),u<0&&D<0&&(this.clickanddrag.x+=r,this.clickanddrag.y+=s,this.clickanddrag.width-=r,this.clickanddrag.height-=s),u<0&&D>0&&(this.clickanddrag.x+=r,this.clickanddrag.height+=s,this.clickanddrag.width-=r),u>0&&D<0&&(this.clickanddrag.y+=s,this.clickanddrag.width+=r,this.clickanddrag.height-=s)}rect(){return this.clamp({x:this.x,y:this.y,width:this.width,height:this.height})}reset(){this.clickanddrag={x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}},this.points=[]}constructor({limits:r}){this.limits=r,this.clickanddrag={x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}},this.points=[]}}var Tr=C("(<!>) × [<!>]",1),Fr=C(" <!><br/>",1),Nr=C("<!> <br/> &nbsp;&nbsp;&nbsp;dir <!>",1),Gr=C(" <!> <br/>",1),Ur=C("<br/> <!>",1),Wr=C('<code class="debug">bbs <br/> <!> <!></code>'),Jr=C('<div class="boundingbox-point new svelte-rvd0k3"></div>'),Kr=C('<div class="boundingbox new svelte-rvd0k3"></div>'),Yr=C("<div></div>"),Zr=C("<div></div>"),Xr=C("<div><!> <!> <!> <!> <!> <!> <!> <!></div>"),Qr=C("<div><!> <!> <!></div>");function ei(M,r){Vt(r,!0);let s=St(r,"disabled",3,!1),l=N(fe(r.boundingBoxes));ha(()=>r.boundingBoxes,o=>{w(l,o,!0)});let O=N(fe(r.imageElement.clientWidth)),u=N(fe(r.imageElement.clientHeight)),D=N(fe(r.imageElement.clientLeft)),U=N(fe(r.imageElement.clientTop)),se=N(fe(r.imageElement.naturalWidth)),oe=N(fe(r.imageElement.naturalHeight)),T=N(void 0);const ie=async()=>{r.imageElement&&((o=>{w(O,o.clientWidth,!0),w(u,o.clientHeight,!0),w(D,o.clientLeft,!0),w(U,o.clientTop,!0),w(se,o.naturalWidth,!0),w(oe,o.naturalHeight,!0)})(r.imageElement),await Pa())};ot(()=>{r.imageElement.addEventListener("load",ie);const o=new ResizeObserver(async(B,y)=>{if(!r.imageElement){y.disconnect();return}await ie()}),k=new MutationObserver(async(B,y)=>{if(!r.imageElement){y.disconnect();return}await ie()});return o.observe(r.imageElement),k.observe(r.imageElement,{attributes:!0,attributeFilter:["src"]}),()=>{o.disconnect(),k.disconnect()}});const z=n(()=>Er({clientHeight:e(u),clientWidth:e(O),naturalHeight:e(oe),naturalWidth:e(se),clientTop:e(U),clientLeft:e(D)},r.zoom)),Fe=n(()=>Bt({x:e(z).width,y:e(z).height})),A=n(()=>Bt({x:1/e(z).width,y:1/e(z).height})),Z=n(()=>Ot(e(l),e(Fe)));let X=N(!1),S=n(()=>new Lr({limits:{x:0,y:0,width:e(z).width,height:e(z).height}}));ot(()=>e(S).setCreateMode(r.createMode));let Q=N(""),H=fe({topleft:!1,topright:!1,bottomleft:!1,bottomright:!1,get left(){return this.topleft&&this.bottomleft},set left(o){this.topleft=o,this.bottomleft=o},get right(){return this.topright&&this.bottomright},set right(o){this.topright=o,this.bottomright=o},get top(){return this.topleft&&this.topright},set top(o){this.topleft=o,this.topright=o},get bottom(){return this.bottomleft&&this.bottomright},set bottom(o){this.bottomleft=o,this.bottomright=o},setAll(o){this.topleft=o,this.topright=o,this.bottomleft=o,this.bottomright=o},isAll(o){return this.topleft===o&&this.topright===o&&this.bottomleft===o&&this.bottomright===o}});var W=Qr();qt("mousemove",Ha,({target:o})=>{o instanceof Element&&e(X)&&r.createMode==="clickanddrag"&&o.closest(".change-area")!==e(T)&&(console.warn("Dragging has gone outside change area, bailing out. Target is",o),H.setAll(!1),w(X,!1),e(S).reset())});let Ne;W.__mouseup=async({button:o})=>{if(!s()&&o===0){if(H.setAll(!1),e(X)&&e(S).ready){const k=e(A)(e(S).rect()),B=await r.oncreate?.(k);B&&(e(l)[B]=k),e(S).reset(),w(X,!1)}else r.onchange?.(e(Q),e(l)[e(Q)]);w(Q,"")}},W.__mousedown=({clientX:o,clientY:k,currentTarget:B,button:y})=>{if(s()||y!==0||r.createMode==="off")return;const{left:I,top:m}=B.getBoundingClientRect(),[ee,b]=[o-I,k-m];(r.movable||r.transformable)&&Object.values(e(Z)).some(J=>Xa(J,{x:ee,y:b}))||(w(X,!0),e(S).registerPoint(ee,b))},W.__mousemove=({movementX:o,movementY:k,button:B})=>{if(s()||B!==0)return;const{x:y,y:I}=e(A)({x:o,y:k,w:0,h:0});if(e(X)&&r.createMode==="clickanddrag"){e(S).registerMovement(o,k);return}const m=e(l)[e(Q)];if(H.isAll(!0)){m.x+=y,m.y+=I;return}if(H.left){m.x+=y,m.width-=y;return}if(H.right){m.width+=y;return}if(H.top){m.y+=I,m.height-=I;return}if(H.bottom){m.height+=I;return}H.topleft&&(m.x+=y,m.y+=I,m.width-=y,m.height-=I),H.topright&&(m.y+=I,m.width+=y,m.height-=I),H.bottomleft&&(m.x+=y,m.width-=y,m.height+=I),H.bottomright&&(m.width+=y,m.height+=I)};let le;var Ge=g(W);{var et=o=>{var k=Wr();Le(k,"",{},{color:"red"});{const b=(P,c=Ze,L=Ze)=>{ze();var j=Qe();G((de,R)=>ue(j,`${de??""} ${R??""}`),[()=>Math.round(c()),()=>Math.round(L())]),v(P,j)},J=(P,c)=>{let L=()=>c?.().x,j=()=>c?.().y,de=()=>c?.().width,R=()=>c?.().height;ze();var te=Tr(),ne=h(Y(te));b(ne,L,j);var ge=h(ne,2);b(ge,de,R),ze(),v(P,te)};var B=h(g(k),3);Be(B,17,()=>Object.entries(e(Z)),([P,c])=>P,(P,c)=>{var L=n(()=>Zt(e(c),2));let j=()=>e(L)[0],de=()=>e(L)[1];ze();var R=Fr(),te=Y(R),ne=h(te);J(ne,de),ze(),G(()=>ue(te,`@${j()??""} `)),v(P,R)});var y=h(B),I=h(y);{var m=P=>{var c=Nr(),L=Y(c);J(L,()=>e(S).clickanddrag);var j=h(L,4);b(j,()=>e(S).clickanddrag.dragDirection.x,()=>e(S).clickanddrag.dragDirection.y),v(P,c)},ee=P=>{var c=$e(),L=Y(c);{var j=R=>{var te=Qe("off");v(R,te)},de=R=>{var te=Ur(),ne=h(Y(te),2);Be(ne,17,()=>e(S).points,Xt,(ge,Ie,he)=>{let K=()=>e(Ie).x,me=()=>e(Ie).y;ze();var pe=Gr(),tt=Y(pe);tt.nodeValue=`#${he} `;var dt=h(tt);b(dt,K,me),ze(2),v(ge,pe)}),v(R,te)};F(L,R=>{r.createMode==="off"?R(j):R(de,!1)},!0)}v(P,c)};F(I,P=>{r.createMode==="clickanddrag"?P(m):P(ee,!1)})}f(k),G(()=>ue(y,` create ${e(S).ready?"ready ":""} `))}v(o,k)};F(Ge,o=>{ia()&&o(et)})}var Ce=h(Ge,2);{var Ue=o=>{var k=$e(),B=Y(k);Be(B,17,()=>e(S).points,Xt,(y,I)=>{let m=()=>e(I).x,ee=()=>e(I).y;var b=$e(),J=Y(b);{var P=c=>{var L=Jr();let j;G(()=>j=Le(L,"",j,{left:`${m()??""}px`,top:`${ee()??""}px`})),v(c,L)};F(J,c=>{m()!==0&&ee()!==0&&c(P)})}v(y,b)}),v(o,k)},Ve=o=>{var k=$e(),B=Y(k);{var y=I=>{var m=Kr();let ee;G(()=>ee=Le(m,"",ee,{left:`${e(S).x??""}px`,top:`${e(S).y??""}px`,width:`${e(S).width??""}px`,height:`${e(S).height??""}px`})),v(I,m)};F(B,I=>{e(X)&&r.createMode==="clickanddrag"&&I(y)},!0)}v(o,k)};F(Ce,o=>{r.createMode==="2point"||r.createMode==="4point"?o(Ue):o(Ve,!1)})}var lt=h(Ce,2);Be(lt,17,()=>Object.entries(e(Z)).filter(([o])=>st(o)===r.imageFileID),([o,k])=>o,(o,k)=>{var B=n(()=>Zt(e(k),2));let y=()=>e(B)[0],I=()=>e(B)[1];var m=Xr();let ee;m.__mousedown=({button:ne})=>{ne===0&&(s()||(w(Q,y(),!0),r.movable&&H.setAll(!0)))};let b;{const ne=(Ie,he=Ze)=>{var K=Yr();let me;K.__mousedown=pe=>{pe.button===0&&(s()||r.transformable&&(w(Q,y(),!0),H[he()]=!0,pe.stopPropagation()))},G(()=>me=Te(K,1,`side ${he()??""}`,"svelte-rvd0k3",me,{draggable:r.transformable,dragging:H[he()]&&e(Q)===y()})),v(Ie,K)},ge=(Ie,he=Ze)=>{var K=Zr();let me;K.__mousedown=pe=>{pe.button===0&&(s()||r.transformable&&(w(Q,y(),!0),H[he()]=!0,pe.stopPropagation()))},G(()=>me=Te(K,1,`corner ${he()??""}`,"svelte-rvd0k3",me,{draggable:r.transformable,dragging:H[he()]&&e(Q)===y()})),v(Ie,K)};var J=g(m);ne(J,()=>"top");var P=h(J,2);ne(P,()=>"bottom");var c=h(P,2);ne(c,()=>"left");var L=h(c,2);ne(L,()=>"right");var j=h(L,2);ge(j,()=>"topleft");var de=h(j,2);ge(de,()=>"topright");var R=h(de,2);ge(R,()=>"bottomleft");var te=h(R,2);ge(te,()=>"bottomright"),f(m)}G(()=>{ee=Te(m,1,"boundingbox svelte-rvd0k3",null,ee,{movable:r.movable,precise:!r.movable&&!r.transformable}),Ee(m,"data-image",y()),b=Le(m,"",b,{left:`${I().x??""}px`,top:`${I().y??""}px`,width:`${I().width??""}px`,height:`${I().height??""}px`})}),v(o,m)}),f(W),ua(W,o=>w(T,o),()=>e(T)),G(o=>{Ne=Te(W,1,"change-area svelte-rvd0k3",null,Ne,o),le=Le(W,"",le,{left:`${e(z).x??""}px`,top:`${e(z).y??""}px`,width:`${e(z).width??""}px`,height:`${e(z).height??""}px`,cursor:r.cursor})},[()=>({debug:ia(),precise:!r.movable&&!r.transformable})]),v(M,W),Dt()}ca(["mouseup","mousedown","mousemove"]);var ti=C("<!><!>",1);function ai(M,r){Vt(r,!0);const s=St(r,"final",3,"et"),l=St(r,"key",3,(D,U)=>U);var O=$e(),u=Y(O);Be(u,19,()=>r.items,(D,U)=>l()(D,U),(D,U,se)=>{var oe=ti(),T=Y(oe);pr(T,()=>r.children,()=>e(U),()=>e(se));var ie=h(T);{var z=A=>{var Z=Qe(", ");v(A,Z)},Fe=A=>{var Z=$e(),X=Y(Z);{var S=Q=>{var H=Qe();G(()=>ue(H,` ${s()??""} `)),v(Q,H)};F(X,Q=>{e(se)===r.items.length-2&&Q(S)},!0)}v(A,Z)};F(ie,A=>{e(se)<r.items.length-2?A(z):A(Fe,!1)})}v(D,oe)}),v(M,O),Dt()}var ri=C('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <p class="loading svelte-k3qi6z"> </p>',1),ii=C("<br/>"),ni=C('<p class="coucou svelte-k3qi6z" aria-hidden="true"><!></p>'),si=C("<button><!></button>"),oi=C('<div class="status svelte-k3qi6z"><!></div>'),li=C('<h1 class="svelte-k3qi6z"> <!></h1>'),di=C('<h1 class="svelte-k3qi6z"><code>Image introuvable</code></h1>'),ci=C('<div class="confidence-icon svelte-k3qi6z"><!></div>'),ui=C('<span class="sep svelte-k3qi6z">&middot;</span> <!>',1),hi=C('<li><!> <div class="text svelte-k3qi6z"><p class="index"><!></p> <p class="dimensions svelte-k3qi6z"><code> </code> <!></p></div> <div class="actions svelte-k3qi6z"><!> <!> <!></div></li>'),vi=C('<li class="boxes-list-hint svelte-k3qi6z"><p class="svelte-k3qi6z"><!> <!></p> <p class="svelte-k3qi6z"> </p></li>'),fi=C('<code class="svelte-k3qi6z"> </code>'),gi=C('<div class="bar svelte-k3qi6z"><p class="svelte-k3qi6z"><!></p> <!></div>'),mi=C('<div class="confirmed-overlay svelte-k3qi6z"><div class="icon svelte-k3qi6z"><!></div> <p> </p></div> <div class="layout svelte-k3qi6z"><main class="crop-surface svelte-k3qi6z"><div class="behind-image svelte-k3qi6z"><!></div> <img data-testid="crop-subject-image" alt="" class="svelte-k3qi6z"/> <!></main> <aside class="toolbar svelte-k3qi6z"><!> <button class="svelte-k3qi6z"><!></button> <button class="svelte-k3qi6z"><!></button></aside> <aside class="info svelte-k3qi6z"><section class="top svelte-k3qi6z"><section class="preactions svelte-k3qi6z"><!> <!></section> <section class="filename"><!></section> <section class="actions svelte-k3qi6z"><!> <!></section></section> <section class="boxes svelte-k3qi6z"><ul class="svelte-k3qi6z"><!> <!></ul></section> <section class="progress svelte-k3qi6z"><div class="bar svelte-k3qi6z"><p class="svelte-k3qi6z"><!></p> <!></div> <!></section> <nav class="svelte-k3qi6z"><div class="navigation svelte-k3qi6z"><!> <code class="numbers svelte-k3qi6z"> <div class="separator svelte-k3qi6z">⁄</div> </code> <!></div> <div class="continue svelte-k3qi6z"><span class="auto svelte-k3qi6z"><!></span> <!></div></nav></aside></div>',1);function ln(M,r){Vt(r,!0),wr("hidden");const s=n(()=>Za.params.image||""),l=n(()=>Ct(e(s),rt.Image.state.filter(t=>t.sessionId===_.currentSessionId))),O=n(()=>e(l).at(0)),u=n(()=>Ga("main"));_r({title:e(u)(142,[e(O)?.filename??"..."])});let D=N(!1),U=N("Glisser-recadrer");const se=[{name:"Glisser-recadrer",help:"Cliquer et glisser pour créer une boîte de recadrage",icon:Rr,shortcut:"r",transformable:!0,createMode:"clickanddrag",movable:!0,cursor:"crosshair"},{name:"2 points",help:"Cliquer sur les 2 coins pour créer une boîte de recadrage",icon:qr,shortcut:"z",transformable:!1,createMode:"2point",movable:!1,cursor:"crosshair"},{name:"4 points",help:"Cliquer sur les 4 extrémités pour créer une boîte de recadrage",icon:kr,shortcut:"Shift+z",transformable:!1,createMode:"4point",movable:!1,cursor:"crosshair"},{name:"Déplacer",help:"Cliquer et glisser pour déplacer la boîte de recadrage",icon:Vr,shortcut:"v",transformable:!1,createMode:"off",movable:!0,cursor:"pointer"},{name:"Main",help:"Cliquer et glisser pour se déplacer dans l'image",icon:Hr,shortcut:"h",transformable:!1,createMode:"off",movable:!1,cursor:"grab"}],oe=n(()=>se.filter(({createMode:t})=>t!=="off"));let T=n(()=>se.find(({name:t})=>t===e(U))||se[0]),ie=N("");const z=n(()=>Object.fromEntries(e(l).map(({id:t,metadata:a})=>[t,a[_.cropMetadataId]?.value]).filter(([,t])=>t!==void 0).map(([t,a])=>[t,gr("boundingbox",a)]))),Fe=n(()=>_.getPreviewURL(e(s))),A=n(()=>lr(rt.Image.state).toSorted(rr)),Z=n(()=>{const t=e(A).indexOf(e(s))-1;if(!(t<0))return e(A).at(t)}),X=n(()=>{const t=e(A).indexOf(e(s))+1;if(!(t>=e(A).length))return e(A).at(t)}),S=n(()=>{const t=e(A).slice(e(A).indexOf(e(s))+1).filter(a=>!le(a)).at(0);return t||e(A).find(a=>!le(a))}),Q=n(()=>e(A).filter(Ne).length),H=n(()=>e(A).filter(le).length),W=n(()=>Object.fromEntries(e(l).map(t=>{if(!t.metadata[_.cropMetadataId])return[t.id,void 0];const{alternatives:a,value:i,confidence:d,manuallyModified:p}=t.metadata[_.cropMetadataId];if(a&&Object.entries(a).length>0){const[[x,$]]=Object.entries(a);return[t.id,{value:JSON.parse(x),confidence:$}]}return p?[t.id,void 0]:[t.id,{value:i,confidence:d}]})));function Ne(t){return Ct(t).every(a=>_.cropMetadataId in a.metadata)}function le(t){return t?Ct(t).every(Ge):!1}function Ge(t){const a=_.currentProtocol?.crop?.confirmationMetadata;return a?a in t.metadata&&t.metadata[a].value:!1}async function et(t,a){const i=_.cropConfirmationMetadataId;i&&await it({db:Se(),sessionId:_.currentSessionId,metadataId:i,subjectId:t,type:"boolean",manuallyModified:!0,value:a})}async function Ce(t){if(!_.cropConfirmationMetadataId){oa.error(e(u)(50));return}for(const a of e(l))await et(a.id,t)}async function Ue(t){const a=e(W)[t];if(!a){oa.error(e(u)(111,[t]));return}await it({db:Se(),sessionId:_.currentSession?.id,subjectId:t,metadataId:_.cropMetadataId,type:"boundingbox",manuallyModified:!1,...a}),_.classificationMetadataId&&await At({db:Se(),sessionId:_.currentSession?.id,metadataId:_.classificationMetadataId,subjectId:t})}const Ve=n(()=>Object.fromEntries(e(l).map(t=>{const a=e(W)[t.id]?.value,i=t.metadata[_.cropMetadataId]?.value;return[t.id,a&&mr("boundingbox",i)&&!er(a,i)]}))),lt=n(()=>Object.values(e(W)).every(t=>!t)||Object.values(e(Ve)).some(Boolean));async function o(){if(Object.values(e(W)).every(t=>!t))for(const{id:t}of e(l))await k(t);else for(const{id:t}of e(l))await Ue(t)}ke.on("crop/box/create",async({imageId:t})=>{st(t)===e(s)&&await k(t,{skipUndo:!0})}),ke.on("crop/box/edit",async({imageId:t,before:a})=>{st(t)===e(s)&&await B(t,Ke(a),!1,!1)}),ke.on("crop/box/delete",async({imageId:t,box:a})=>{st(t)===e(s)&&await B(null,Ke(a),!1,!1)});async function k(t,{skipUndo:a=!1}={}){a||ke.push("crop/box/delete",{imageId:t,box:e(z)[t]}),e(l).length===1?await At({db:Se(),sessionId:_.currentSession?.id,metadataId:_.cropMetadataId,subjectId:t}):await rt.Image.remove(t)}async function B(t,a,i=!0,d=!0){if(!a)return t&&await et(t,!0),t;const p=i&&!!_.cropConfirmationMetadataId&&e(l).filter(Ge).length===e(l).length-1,x=na().cropAutoNext&&Qa(a)&&(e(T).createMode!=="clickanddrag"||!Ne(e(s))),$=t?e(l).find(V=>V.id===t):void 0,ae=$?.metadata[_.classificationMetadataId];ae&&!ae.manuallyModified&&await At({db:Se(),sessionId:_.currentSession?.id,metadataId:_.classificationMetadataId,subjectId:$.id});let q="";return t?(d&&ke.push("crop/box/edit",{imageId:t,before:e(z)[t],after:Re(a)}),await it({db:Se(),sessionId:_.currentSession?.id,metadataId:_.cropMetadataId,subjectId:t,type:"boundingbox",value:Re(a),confidence:1,alternatives:e(W)[t]?[e(W)[t]]:[],manuallyModified:!0})):e(l).length===1&&e(O)&&!e(O).metadata[_.cropMetadataId]?(q=e(O).id,d&&ke.push("crop/box/create",{imageId:q,box:Re(a)}),await it({db:Se(),sessionId:_.currentSession?.id,metadataId:_.cropMetadataId,subjectId:q,type:"boundingbox",value:Re(a),confidence:1,manuallyModified:!0,alternatives:[]})):(q=sr(e(s),Math.max(...e(l).map(({id:V})=>or(V).subindex))+1),d&&ke.push("crop/box/create",{imageId:q,box:Re(a)}),await rt.Image.set({id:q,sessionId:_.currentSessionId,filename:e(O)?.filename??"",addedAt:hr(e(O)?.addedAt??new Date),contentType:e(O)?.contentType??"",dimensions:Je(e(O)?.dimensions)??{width:0,height:0},fileId:e(s),metadata:{[_.cropMetadataId]:{value:JSON.stringify(Re(a)),confidence:1,manuallyModified:!0,alternatives:{}},[_.cropConfirmationMetadataId]:{value:"true",confidence:1,manuallyModified:!0,alternatives:{}}}})),w(L,!1),await Ce(!0),b.manual||(b.imageId=q||t),p&&(w(D,!0),await new Promise(V=>setTimeout(V,500)),w(D,!1)),x&&(e(S)?await ve("/(app)/(sidepanel)/crop/[image]",{image:e(S)}):await ve("/(app)/(sidepanel)/classify")),q}async function y(){const t=e(l).map(a=>[a,e(z)[a.id]]);for(const[a,i]of t)await B(a.id,i?Ke(i):void 0);e(S)?await ve("/(app)/(sidepanel)/crop/[image]",{image:e(S)}):await ve("/(app)/(sidepanel)/classify")}async function I(){const t=Je(e(X));await dr(e(s)),t?await ve("/(app)/(sidepanel)/crop/[image]",{image:t}):await ve("/(app)/(sidepanel)/import")}function m(t){if(!e(O))return[0,0];const a=Bt({x:e(O).dimensions.width,y:e(O).dimensions.height}),{w:i,h:d}=Ot(a(t),Math.round);return[i,d]}function ee(){_.imagePreviouslyOpenedInCropper=e(s),ve("/crop")}ot(()=>{_.imageOpenedInCropper=e(s)});let b=fe({imageId:null,manual:!1});vr("cropping",{ArrowLeft:{help:e(u)(102),when:()=>!!e(Z),do:()=>ve("/(app)/(sidepanel)/crop/[image]",{image:e(Z)})},"Shift+Space":{help:e(u)(102),when:()=>!!e(Z),do:()=>ve("/(app)/(sidepanel)/crop/[image]",{image:e(Z)})},ArrowRight:{help:e(u)(103),when:()=>!!e(X),do:()=>ve("/(app)/(sidepanel)/crop/[image]",{image:e(X)})},Space:{help:e(u)(69),do:y},"$mod+Delete":{help:e(u)(157),do:I},Escape:{help:e(u)(137),do:ee},a:{help:e(u)(26),do:async()=>ur("cropAutoNext")},Delete:{help:e(u)(155),when:()=>!!b.imageId,async do(){b.imageId&&(await k(b.imageId),b.manual?b.imageId=null:b.imageId=e(l).toReversed().find(t=>t.id in e(z))?.id??null)}},f:{help:e(u)(46),when:()=>!!b,do(){b&&(b.imageId===e(ie)?w(ie,""):b.imageId&&w(ie,b.imageId,!0))}},u:{help:e(u)(146),when:()=>!!e(Ve)[e(s)],do:()=>{e(Ve)[e(s)]&&Ue(e(s))}},"$mod+u":{help:e(u)(147),when:()=>Object.keys(e(z)).length>0,do:o},ArrowUp:{help:e(u)(118),when:()=>!le(e(s)),do:()=>Ce(!0)},ArrowDown:{help:e(u)(120),when:()=>le(e(s)),do:()=>Ce(!1)},"+":{help:e(u)(175),do:()=>{e(c).scale=Oe(1,e(c).scale+4*e(j),10)}},"-":{help:e(u)(81),do:()=>{e(c).scale=Oe(1,e(c).scale-4*e(j),10)}},Digit0:{help:e(u)(149),do:()=>{e(c).origin={x:0,y:0},e(c).scale=1}},...ra(se.map(t=>[t.shortcut,{help:`Choisir l'outil ${t.name}`,do:()=>{w(U,t.name,!0)}}])),",":{help:e(u)(160),do:()=>{const t=Object.keys(e(z)),i=(t.indexOf(b.imageId??"")-1+t.length)%t.length;b.imageId=t[i]}},";":{help:e(u)(161),do:()=>{const t=Object.keys(e(z)),i=(t.indexOf(b.imageId??"")+1)%t.length;b.imageId=t[i]}},...ra(ir(1,10).map(t=>[`Digit${t}`,{help:`Sélectionner la boîte #${t}`,when:()=>Object.keys(e(z)).length>=t,do:()=>{const a=Object.keys(e(z))[t-1];b.imageId===a?(b.imageId=null,b.manual=!1):(b.imageId=a,b.manual=!0)}}]))}),ot(()=>{b.imageId&&document.querySelector(".boxes li.selected")?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})});let J=N(void 0),P=N(!0);ha(()=>e(s),(t,a)=>{a&&_.cropperZoomStates.set(a,Je(e(c))),w(c,Je(_.cropperZoomStates.get(t))??da,!0)});let c=N(fe({...da})),L=n(()=>e(l).every(({metadata:t})=>!t[_.cropMetadataId]?.manuallyModified));const j=n(()=>e(c).scale*.1);var de=mi(),R=Y(de),te=g(R),ne=g(te);nt(ne,{}),f(te);var ge=h(te,2),Ie=g(ge,!0);f(ge),f(R);var he=h(R,2),K=g(he);K.__mousedown=async t=>{e(T).name!=="Main"&&t.button!==1||(t.preventDefault(),e(c).panning=!0,e(c).panStart={x:t.clientX,y:t.clientY,zoomOrigin:Je(e(c).origin)})},K.__mouseup=async({button:t})=>{e(T).name!=="Main"&&t!==1||(e(c).panning=!1)},K.__mousemove=async({clientX:t,clientY:a})=>{e(c).panning&&(e(c).origin.x=e(c).panStart.zoomOrigin.x+(t-e(c).panStart.x),e(c).origin.y=e(c).panStart.zoomOrigin.y+(a-e(c).panStart.y))};var me=g(K),pe=g(me);{var tt=t=>{var a=ri(),i=Y(a);Ea(i,()=>({"--size":"2em"})),fr(i.lastChild,{}),f(i);var d=h(i,2),p=g(d,!0);f(d),G(x=>ue(p,x),[()=>e(u)(52)]),v(t,a)},dt=t=>{var a=ni();{const d=p=>{var x=ii();v(p,x)};var i=g(a);{let p=n(()=>[d]),x=n(()=>e(u).c(176));_e(i,{get t(){return e(p)},get x(){return e(x)}})}f(a)}v(t,a)};F(pe,t=>{e(P)?t(tt):t(dt,!1)})}f(me);var De=h(me,2);let Ht;ua(De,t=>w(J,t),()=>e(J));var va=h(De,2);{var fa=t=>{{let a=n(()=>Ot(e(ie)?nr(e(z),e(ie)):e(z),Ke)),i=n(()=>e(c).panning?e(T).name==="Main"?"grabbing":"move":e(T).cursor);ei(t,Ra(()=>e(T),{get imageElement(){return e(J)},get zoom(){return e(c)},get imageFileID(){return e(s)},get boundingBoxes(){return e(a)},get disabled(){return e(c).panning},get cursor(){return e(i)},onchange:(d,p)=>B(d,p),oncreate:d=>B(null,d)}))}};F(va,t=>{e(J)&&t(fa)})}f(K);var ct=h(K,2),Pt=g(ct);Be(Pt,17,()=>se,t=>t.name,(t,a)=>{var i=si();i.__click=()=>{w(U,e(a).name,!0)};let d;var p=g(i);Qt(p,()=>e(a).icon,(x,$)=>{$(x,{})}),f(i),Pe(i,(x,$)=>je?.(x,$),()=>({text:`${e(a).name}: ${e(a).help}`,keyboard:e(a).shortcut,placement:"right"})),G(x=>{Ee(i,"aria-label",x),d=Te(i,1,"svelte-k3qi6z",null,d,{active:e(a).name===e(U)})},[()=>e(u)(58,[e(a).name])]),v(t,i)});var He=h(Pt,2);He.__click=()=>ke.pop();var ga=g(He);Ua(ga,{}),f(He),Pe(He,(t,a)=>je?.(t,a),()=>({text:"Annuler",keyboard:"$mod+z",placement:"right"}));var We=h(He,2);We.__click=()=>ke.rewind();var ma=g(We);$r(ma,{}),f(We),Pe(We,(t,a)=>je?.(t,a),()=>({text:"Rétablir",keyboard:"$mod+Shift+z",placement:"right"})),f(ct);var jt=h(ct,2),ut=g(jt),ht=g(ut),Rt=g(ht);{const t=i=>{Ka(i,{})},a=i=>{Na(i,{shortcut:"Escape"})};ta(Rt,{inline:!0,onclick:ee,_w_snippet_1:t,_w_snippet_2:a,children:(i,d)=>{{let p=n(()=>[t,a]),x=n(()=>e(u).c(1));_e(i,{get t(){return e(p)},get x(){return e(x)}})}},$$slots:{_w_snippet_1:!0,_w_snippet_2:!0,default:!0}})}var pa=h(Rt,2);{const t=a=>{ea(a,{})};ta(pa,{dangerous:!0,onclick:I,help:{text:"Supprimer cette image et passer à la suivante",keyboard:"$mod+Delete"},_w_snippet_3:t,children:(a,i)=>{{let d=n(()=>[t]),p=n(()=>e(u).c(15));_e(a,{get t(){return e(d)},get x(){return e(p)}})}},$$slots:{_w_snippet_3:!0,default:!0}})}f(ht);var vt=h(ht,2),_a=g(vt);{var ba=t=>{var a=li(),i=g(a),d=h(i);{var p=x=>{var $=oi(),ae=g($);nt(ae,{}),f($),Pe($,(q,V)=>je?.(q,V),()=>"Recadrage confirmé"),v(x,$)};F(d,x=>{le(e(s))&&x(p)})}f(a),G(()=>ue(i,`${e(O).filename??""} `)),v(t,a)},xa=t=>{var a=di();v(t,a)};F(_a,t=>{e(O)?t(ba):t(xa,!1)})}f(vt);var Et=h(vt,2),Lt=g(Et);{const t=d=>{la(d,{})};let a=n(()=>e(u)(147)),i=n(()=>!e(lt));$t(Lt,{keyboard:"$mod+U",get help(){return e(a)},onclick:o,get disabled(){return e(i)},_w_snippet_4:t,children:(d,p)=>{{let x=n(()=>[t]),$=n(()=>e(u).c(11));_e(d,{get t(){return e(x)},get x(){return e($)}})}},$$slots:{_w_snippet_4:!0,default:!0}})}var wa=h(Lt,2);{var ya=t=>{{let a=n(()=>le(e(s))?"ArrowDown":"ArrowUp"),i=n(()=>le(e(s))?"Marquer le recadrage comme non confirmé":"Marquer le recadrage comme confirmé");$t(t,{get keyboard(){return e(a)},onclick:()=>Ce(!le(e(s))),get help(){return e(i)},children:(d,p)=>{var x=$e(),$=Y(x);{var ae=V=>{const Ae=ce=>{Mr(ce,{})};{let ce=n(()=>[Ae]),ye=n(()=>e(u).c(7));_e(V,{get t(){return e(ce)},get x(){return e(ye)}})}},q=V=>{const Ae=ce=>{nt(ce,{})};{let ce=n(()=>[Ae]),ye=n(()=>e(u).c(18));_e(V,{get t(){return e(ce)},get x(){return e(ye)}})}};F($,V=>{le(e(s))?V(ae):V(q,!1)})}v(d,x)},$$slots:{default:!0}})}};F(wa,t=>{_.cropConfirmationMetadataId&&t(ya)})}f(Et),f(ut);var ft=h(ut,2),Tt=g(ft),Ft=g(Tt);Be(Ft,19,()=>e(l).filter(({id:t})=>t in e(z)),t=>t.id,(t,a,i)=>{const d=n(()=>e(z)[e(a).id]),p=n(()=>e(W)[e(a).id]),x=n(()=>{const[E,re]=m(e(d));return{w:E,h:re}}),$=n(()=>e(ie)===e(a).id);var ae=hi();let q;var V=g(ae);{var Ae=E=>{{let re=n(()=>Ke(e(d))),Me=n(()=>_.getPreviewURL(e(a).fileId));tr(E,{get box(){return e(re)},get src(){return e(Me)},class:"thumb"})}};F(V,E=>{e(a).fileId&&E(Ae)})}var ce=h(V,2),ye=g(ce),xt=g(ye);{let E=n(()=>e(u).c(43)),re=n(()=>[e(i)+1]);_e(xt,{get x(){return e(E)},get a(){return e(re)}})}f(ye);var wt=h(ye,2),qe=g(wt),yt=g(qe);f(qe),Pe(qe,(E,re)=>je?.(E,re),()=>"Dimensions de l'image recadrée (en pixels)");var kt=h(qe,2);{var It=E=>{var re=ui(),Me=h(Y(re),2);Ta(Me,{get value(){return e(p).confidence},children:(Mt,pi)=>{var zt=ci(),Da=g(zt);Ya(Da,{}),f(zt),v(Mt,zt)},$$slots:{default:!0}}),v(E,re)};F(kt,E=>{e(p)&&!e(a).metadata[_.cropMetadataId].manuallyModified&&E(It)})}f(wt),f(ce);var Jt=h(ce,2),Kt=g(Jt);{var Oa=E=>{{let re=n(()=>e($)?"Réafficher les autres boîtes":"Masquer les autres boîtes");Ye(E,{get help(){return e(re)},keyboard:"F",onclick:()=>w(ie,e($)?"":e(a).id,!0),get crossout(){return e($)},children:(Me,Mt)=>{Br(Me,{})},$$slots:{default:!0}})}};F(Kt,E=>{Object.values(e(z)).length>1&&E(Oa)})}var Yt=h(Kt,2);{let E=n(()=>e(p)?`Revenir au recadrage d'origine 
									(${m(e(p).value).join(" × ")}, ${aa(e(p).confidence)} de confiance)`:"Recadrage d'origine indisponible"),re=n(()=>!e(Ve)[e(a).id]);Ye(Yt,{get help(){return e(E)},keyboard:"u",get disabled(){return e(re)},onclick:()=>Ue(e(a).id),children:(Me,Mt)=>{la(Me,{})},$$slots:{default:!0}})}var Va=h(Yt,2);{let E=n(()=>e(u)(155));Ye(Va,{get help(){return e(E)},keyboard:"Delete",onclick:async()=>k(e(a).id),children:(re,Me)=>{ea(re,{})},$$slots:{default:!0}})}f(Jt),f(ae),G(()=>{q=Te(ae,1,"svelte-k3qi6z",null,q,{unfocused:e(ie)&&e(ie)!==e(a).id,selected:b.imageId===e(a).id}),ue(yt,`${e(x).w??""}×${e(x).h??""}`)}),v(t,ae)});var ka=h(Ft,2);{var Ia=t=>{var a=vi(),i=g(a),d=g(i);Fa(d,()=>"Pour créer une nouvelle boîte,<wbr /> utilisez les outils");var p=h(d,2);ai(p,{get items(){return e(oe)},key:q=>q.name,final:"ou",children:(q,V)=>{let Ae=()=>V?.().icon,ce=()=>V?.().help,ye=()=>V?.().shortcut;xr(q,{get text(){return ce()},get keyboard(){return ye()},children:(xt,wt)=>{var qe=$e(),yt=Y(qe);Qt(yt,Ae,(kt,It)=>{It(kt,{})}),v(xt,qe)},$$slots:{default:!0}})},$$slots:{default:!0}}),f(i);var x=h(i,2),$=g(x,!0);f(x),f(a),G(ae=>ue($,ae),[()=>e(u)(202)]),v(t,a)};F(ka,t=>{e(L)&&t(Ia)})}f(Tt),f(ft);var gt=h(ft,2);{const t=(a,i=Ze)=>{var d=fi(),p=g(d,!0);f(d),G(x=>ue(p,x),[()=>aa(i()/e(A).length)]),v(a,d)};var mt=g(gt),pt=g(mt);{const a=d=>{Ja(d,{})},i=d=>{t(d,()=>e(Q))};var Ma=g(pt);{let d=n(()=>[a,i]),p=n(()=>e(u).c(4));_e(Ma,{get t(){return e(d)},get x(){return e(p)}})}f(pt)}var za=h(pt,2);{let a=n(()=>e(Q)/e(A).length);sa(za,{alwaysActive:!0,get progress(){return e(a)}})}f(mt);var $a=h(mt,2);{var Ca=a=>{var i=gi(),d=g(i);{const $=q=>{nt(q,{})},ae=q=>{t(q,()=>e(H))};var p=g(d);{let q=n(()=>[$,ae]),V=n(()=>e(u).c(9));_e(p,{get t(){return e(q)},get x(){return e(V)}})}f(d)}var x=h(d,2);{let $=n(()=>e(H)/e(A).length);sa(x,{alwaysActive:!0,get progress(){return e($)}})}f(i),v(a,i)};F($a,a=>{_.cropConfirmationMetadataId&&a(Ca)})}f(gt)}var Nt=h(gt,2),_t=g(Nt),Gt=g(_t);{let t=n(()=>!e(Z)),a=n(()=>e(u)(102));Ye(Gt,{get disabled(){return e(t)},get help(){return e(a)},keyboard:"ArrowLeft",onclick:()=>{e(Z)&&ve("/(app)/(sidepanel)/crop/[image]",{image:e(Z)})},children:(i,d)=>{La(i,{})},$$slots:{default:!0}})}var bt=h(Gt,2),Ut=g(bt),Aa=h(Ut,2);f(bt);var qa=h(bt,2);{let t=n(()=>!e(X)),a=n(()=>e(u)(103));Ye(qa,{get disabled(){return e(t)},get help(){return e(a)},keyboard:"ArrowRight",onclick:()=>{e(X)&&ve("/(app)/(sidepanel)/crop/[image]",{image:e(X)})},children:(i,d)=>{Wa(i,{})},$$slots:{default:!0}})}f(_t);var Wt=h(_t,2),at=g(Wt);{const t=a=>{var i=()=>na().cropAutoNext,d=p=>cr("cropAutoNext",p);{let p=n(()=>e(u)(39));br(a,{get value(){return i()},set value(x){d(x)},get label(){return e(p)}})}};var Sa=g(at);{let a=n(()=>[t]),i=n(()=>e(u).c(0));_e(Sa,{get t(){return e(a)},get x(){return e(i)}})}f(at),Pe(at,(a,i)=>je?.(a,i),()=>({text:"Passer automatiquement à l'image suivante quand celle-ci est recadrée",keyboard:"A"}))}var Ba=h(at,2);{let t=n(()=>e(u)(119));$t(Ba,{onclick:y,keyboard:"Space",get help(){return e(t)},children:(a,i)=>{ze();var d=Qe();G(p=>ue(d,p),[()=>e(u)(69)]),v(a,d)},$$slots:{default:!0}})}f(Wt),f(Nt),f(jt),f(he),G((t,a,i,d)=>{Ee(R,"aria-hidden",!e(D)),ue(Ie,t),Ee(De,"src",e(Fe)),Ht=Le(De,"",Ht,{scale:e(c).scale,translate:`${e(c).origin.x??""}px ${e(c).origin.y??""}px`}),Ee(He,"aria-label",a),Ee(We,"aria-label",i),ue(Ut,`${d??""} `),ue(Aa,` ${e(A).length??""}`)},[()=>e(u)(68),()=>e(u)(30),()=>e(u)(372),()=>e(A).indexOf(e(s))+1]),qt("wheel",K,async t=>{t.preventDefault();let a=e(J).getBoundingClientRect(),i=(t.clientX-a.x)/e(c).scale,d=(t.clientY-a.y)/e(c).scale;e(c).scale=Oe(1,e(c).scale-Xe(t.deltaY)*2*e(j),10),e(c).scale>1?(e(c).origin.x+=Xe(t.deltaY)*e(j)*(i*2-e(J).offsetWidth),e(c).origin.y+=Xe(t.deltaY)*e(j)*(d*2-e(J).offsetHeight)):e(c).origin={x:0,y:0}}),qt("load",De,()=>{w(P,!1)}),ja(De),v(M,de),Dt()}ca(["mousedown","mouseup","mousemove","click"]);export{ln as component};
