import"../chunks/DsnmJJEf.js";import{o as L}from"../chunks/D6d8D7oP.js";import{p as A,g as s,u as n,b as P,c as j,I as z,a as y,ak as b,ai as w,J as F,K as v,am as R,G as q,H as O}from"../chunks/Dt6m180S.js";import{s as M}from"../chunks/BqMK6M8M.js";import{p as D,s as V,r as G,i as H}from"../chunks/cmrSGx3m.js";import{c as J}from"../chunks/BptB6vFW.js";import{a as K,f as U}from"../chunks/DM93I2Od.js";import{w as E}from"../chunks/C02cds9o.js";import{A as N}from"../chunks/CcbyKDVt.js";import{B as Q}from"../chunks/BWvVnymT.js";import{t as W}from"../chunks/yErRaHIP.js";import{C as X}from"../chunks/BXclFgBD.js";import{i as Y}from"../chunks/JZH0u_ZA.js";import{u as a}from"../chunks/fpNj8U5y.js";import{n as C,g as Z,a as $}from"../chunks/C0SiBqD8.js";import{t as x}from"../chunks/h9n_zjAt.js";import{f as ee,d as te}from"../chunks/CXutPItK.js";import{L as ae}from"../chunks/DJljq93Y.js";import{a as re}from"../chunks/DwQPgNTU.js";import{d as se}from"../chunks/Z9u04OLA.js";import{g as S}from"../chunks/CoCzgeuV.js";import{d as k,b as ie}from"../chunks/62CSzXnv.js";import{s as oe}from"../chunks/DDk1L18j.js";import{b as ne}from"../chunks/CoW7fDOc.js";function me(h,e){A(e,!0);const d=D(e,"highlighted",3,!1),f=G(e,["$$slots","$$events","$$legacy","fileId","images","highlighted"]),m=n(()=>a.queuedImages.has(e.fileId)?"queued":a.loadingImages.has(e.fileId)?"loading":e.images.some(l=>a.erroredImages.has(l.id))?"errored":"ok"),p=n(()=>{if(s(m)==="errored")return e.images.map(({id:l})=>a.erroredImages.get(l)).filter(C).join("; ");if(Y())return`${e.fileId} @ ${e.images[0]?.addedAt.toISOString()} [${e.images[0]?.sessionId}]`});{let l=n(()=>a.getPreviewURL(e.fileId)),I=n(()=>a.selection.includes(e.fileId)),r=n(()=>e.images.map(t=>a.cropMetadataValueOf(t)?.value).filter(C).map(t=>W(t)));X(h,V({get id(){return e.fileId},get title(){return e.images[0].filename},get image(){return s(l)},get selected(){return s(I)},boxes:"show-all",get tooltip(){return s(p)},get status(){return s(m)},get highlighted(){return d()}},()=>f,{get boundingBoxes(){return s(r)}}))}P()}var le=z('<div class="empty svelte-zhpjun"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <p> </p> <!></div>'),de=z('<section class="observations svelte-zhpjun"><!> <!></section>');function je(h,e){A(e,!0);const d=n(()=>ne("main"));oe({title:s(d)(139)});const f=n(()=>[...Z(x.Image.state,r=>r.fileId??"").entries()].map(([r,t])=>({id:r,sessionId:t[0].sessionId,addedAt:new Date($(t.map(o=>o.addedAt.getTime()))),name:t[0].filename,virtual:!1,metadata:re(t.map(o=>o.metadata),{definitions:x.Metadata.state,options:{}}),data:t})));j(()=>{a.imageOpenedInCropper=""}),L(()=>{k(x.Image.state.map(({fileId:r})=>r).filter(C).filter(r=>!ee(a.currentProtocol,r)))}),E(()=>a.imagePreviouslyOpenedInCropper,()=>{a.setSelection?.([a.imagePreviouslyOpenedInCropper])});var m=de(),p=b(m);N(p,{get items(){return s(f)},zone:"crop",item:(t,o=F,g)=>{let i=()=>g?.().id;{let _=n(()=>i()===a.imagePreviouslyOpenedInCropper),u=n(()=>s(d)(29));me(t,{get fileId(){return i()},get images(){return o()},boxes:"show-all",get highlighted(){return s(_)},get loadingStatusText(){return s(u)},onretry:()=>{a.erroredImages.delete(i()),k([i()])},ondelete:async()=>{ie(i(),"Cancelled by user"),a.processing.removeFile(i()),await se(i()),await te(i())},onclick:async(T,c)=>{c({status:"loading",loadingStatusText:"Ouvertureâ€¦"}),await S("/(app)/(sidepanel)/crop/[image]",{image:i()})}})}},$$slots:{item:!0}});var l=w(p,2);{var I=r=>{var t=le(),o=b(t);J(o,()=>({"--size":"6em"})),ae(o.lastChild,{variant:"empty"}),v(o);var g=w(o,2),i=b(g,!0);v(g);var _=w(g,2);Q(_,{onclick:()=>S("/import"),children:(u,T)=>{R();var c=q();O(B=>M(c,B),[()=>s(d)(104)]),y(u,c)},$$slots:{default:!0}}),v(t),O(u=>M(i,u),[()=>s(d)(37)]),y(r,t)};H(l,r=>{s(f).length||r(I)})}v(m),K(1,m,()=>U,()=>({duration:100})),y(h,m),P()}export{je as component};
