import{e as wt}from"../chunks/CTlA2v4V.js";import{u as ct,C as pt,n as X,a as Ut,t as xt,l as Gt,h as Jt,A as Xt,s as Qt,e as Wt,d as Yt,r as It}from"../chunks/h9n_zjAt.js";import{e as Zt}from"../chunks/C0SiBqD8.js";import{m as te}from"../chunks/BHxAX_Yx.js";import"../chunks/DsnmJJEf.js";import{f as Ct,a as _,p as ee,I as $,F as lt,g as t,u as e,H as D,b as ae,ak as v,ai as m,aX as re,K as d,aH as se,D as ne,G as oe,J as qt}from"../chunks/Dt6m180S.js";import{s as P,e as le}from"../chunks/BqMK6M8M.js";import{r as Bt,i as it}from"../chunks/cmrSGx3m.js";import{e as Mt,i as ie}from"../chunks/Bmx3KKup.js";import{t as kt,a as de,f as ve}from"../chunks/DM93I2Od.js";import{a as Ft,g as dt,b as ce,e as pe,s as me}from"../chunks/CoW7fDOc.js";import{V as ue}from"../chunks/CQZlWxvG.js";import{A as _e}from"../chunks/KZAX_y5O.js";import{D as fe}from"../chunks/C0se_-sl.js";import{F as Pt,E as Ot}from"../chunks/B07Li1wJ.js";import{I as ge}from"../chunks/nVGfHLWF.js";import{I as $e}from"../chunks/B5GoCzNY.js";import{p as x}from"../chunks/BQgdUy12.js";import{B as vt}from"../chunks/BAG1AaOD.js";import{B as he}from"../chunks/BWvVnymT.js";import{F as S}from"../chunks/DwPLocwb.js";import{I as J}from"../chunks/DRBqBfVL.js";import{g as Rt}from"../chunks/CoCzgeuV.js";import{o as be}from"../chunks/CfAJlelU.js";import{i as ye}from"../chunks/CyxF7S3o.js";import{R as V}from"../chunks/CH5FdpMr.js";async function we({parent:I,params:l}){if(!l.id)throw wt(400,"Protocol ID is required");const{protocol:s,metadata:h}=await I(),b=await ct("MetadataOption",pt(X(l.id,l.metadata),l.option)),E=Ut("js");b||wt(404,E(450));const B=await Promise.all(Zt(b.cascade??{}).map(async([q,M])=>{const F=X(l.id,q),g=await xt.Metadata.get(F);if(!g)return{metadataId:F};let T;return g.type==="enum"&&(T=await ct("MetadataOption",pt(F,M))),{metadataId:F,metadata:g,option:T,value:M}})),K=await Promise.all(s.metadata.flatMap(async q=>{const M=await xt.Metadata.get(X(l.id,q));return M?M.type!=="enum"?[]:(await Gt("MetadataOption",te(l.id,q))).filter(g=>g.cascade?.[l.metadata]===b.key).map(g=>({value:g.key,metadataId:M.id,metadata:M,option:g})):[]})).then(q=>q.flat());return{protocol:s,metadata:h,option:b,cascades:B,reverseCascades:K}}const ca=Object.freeze(Object.defineProperty({__proto__:null,load:we},Symbol.toStringTag,{value:"Module"}));var xe=Ct('<svg><path fill="currentColor" d="M5 14V5h2v7h7.586V6.586L21 13l-6.414 6.414V14z"></path></svg>');function Ie(I,l){const s=Bt(l,["$$slots","$$events","$$legacy"]);var h=xe();Ft(h,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),_(I,h)}var qe=Ct('<svg><path fill="currentColor" d="M14 5H5v2h7v7.586H6.586L13 21l6.414-6.414H14z"></path></svg>');function Me(I,l){const s=Bt(l,["$$slots","$$events","$$legacy"]);var h=qe();Ft(h,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...s})),_(I,h)}function C(I){return dt("main"),async l=>{if(!x.params.metadata||!x.params.option||!x.params.id)return;const s=await ct("MetadataOption",pt(Jt(x.params.metadata,x.params.id),x.params.option));if(!s)return;const h=dt("main");try{await I(s,l)}catch(b){b instanceof Xt&&kt.error(h(376,[b.summary]))}await Qt("MetadataOption",s).catch(b=>{const E=dt("main");kt.error(E(225,[Wt(b)]))}),await ye(Yt("Metadata",X(x.params.id,x.params.metadata),"options"))}}var ke=$('<textarea rows="10"></textarea>'),Pe=$('<img class="svelte-128nasq"/>'),Oe=$('<li class="svelte-128nasq"><!> <!></li>'),Re=$('<p class="label-help svelte-128nasq"><!></p>'),Ce=$('<div class="row svelte-128nasq"><dt class="svelte-128nasq"> </dt> <!> <dd class="svelte-128nasq"> </dd> <!></div>'),Be=$('<p class="empty svelte-128nasq"> </p>'),Fe=$('<dl class="cascades svelte-128nasq"></dl>'),He=$('<p class="label-help svelte-128nasq"><!></p>'),Ae=$(" <!>",1),De=$('<li class="svelte-128nasq"><!></li>'),Le=$('<ul class="reverse-cascades svelte-128nasq"><!></ul>'),Ve=$('<div class="split svelte-128nasq"><div class="left svelte-128nasq"><!> <!> <!> <!></div> <div class="right svelte-128nasq"><!> <!></div></div> <h3 class="svelte-128nasq"> </h3> <p class="svelte-128nasq"> </p> <ul class="synonyms svelte-128nasq"><!> <li class="new svelte-128nasq"><!></li></ul> <h3 class="svelte-128nasq"> </h3> <p class="svelte-128nasq"> </p> <div class="split svelte-128nasq"><div class="left svelte-128nasq"><!></div> <div class="right svelte-128nasq"><!></div></div> <div class="danger"><!></div>',1);function pa(I,l){ee(l,!0);const s=e(()=>ce("main")),h=e(()=>l.data.cascades),b=e(()=>l.data.reverseCascades),E=e(()=>l.data.metadata),B=e(()=>l.data.option),K=e(()=>t(B).key),q=e(()=>t(B).label),M=e(()=>t(B).description),F=e(()=>t(B).learnMore),g=e(()=>t(B).image);var T=Ve(),N=lt(T),Q=v(N),mt=v(Q);{let i=e(()=>t(s)(321));S(mt,{get label(){return t(i)},children:(n,c)=>{{let a=e(()=>t(s)(322)),r=e(()=>C((o,p)=>{o.key=p}));J(n,{get value(){return t(K)},get label(){return t(a)},discreet:!0,get onblur(){return t(r)}})}}})}var ut=m(mt,2);{let i=e(()=>t(s)(323));S(ut,{get label(){return t(i)},children:(n,c)=>{{let a=e(()=>t(s)(324)),r=e(()=>C((o,p)=>{o.label=p}));J(n,{get value(){return t(q)},get label(){return t(a)},discreet:!0,get onblur(){return t(r)}})}}})}var _t=m(ut,2);{let i=e(()=>t(s)(273));S(_t,{get label(){return t(i)},children:(n,c)=>{var a=ke();re(a);var r=e(()=>C((o,{target:p})=>{p instanceof HTMLTextAreaElement&&(o.description=p.value)}));D(()=>pe(a,t(M))),le("blur",a,function(...o){t(r)?.apply(this,o)}),_(n,a)}})}var Ht=m(_t,2);{let i=e(()=>t(s)(84)),n=e(()=>t(F)??""),c=e(()=>C((a,r)=>{r?a.learnMore=r:delete a.learnMore}));Pt(Ht,{get label(){return t(i)},get value(){return t(n)},get onblur(){return t(c)}})}d(Q);var ft=m(Q,2),gt=v(ft);{let i=e(()=>t(s)(325)),n=e(()=>t(g)??""),c=e(()=>C((a,r)=>{r?a.image=r:delete a.image}));Pt(gt,{get Icon(){return ge},check:!0,get label(){return t(i)},get value(){return t(n)},get onblur(){return t(c)}})}var At=m(gt,2);{var Dt=i=>{var n=Pe();D(()=>me(n,"src",t(g))),_(i,n)};it(At,i=>{t(g)&&i(Dt)})}d(ft),d(N);var W=m(N,2),Lt=v(W,!0);d(W);var Y=m(W,2),Vt=v(Y,!0);d(Y);var Z=m(Y,2),$t=v(Z);Mt($t,17,()=>l.data.option.synonyms??[],ie,(i,n,c)=>{var a=Oe(),r=v(a);{let p=e(()=>t(s)(360)),f=e(()=>C((u,O)=>{O?u.synonyms[c]=O:u.synonyms.splice(c,1)}));J(r,{get value(){return t(n)},get label(){return t(p)},discreet:!0,get onblur(){return t(f)}})}var o=m(r,2);{let p=e(()=>t(s)(361)),f=e(()=>C(u=>{u.synonyms.splice(c,1)}));vt(o,{get help(){return t(p)},get onclick(){return t(f)},children:(u,O)=>{$e(u,{})},$$slots:{default:!0}})}d(a),_(i,a)});var ht=m($t,2),Et=v(ht);{let i=e(()=>t(s)(360)),n=e(()=>t(s)(362)),c=e(()=>C((a,r)=>{r&&(a.synonyms||(a.synonyms=[]),a.synonyms.push(r))}));J(Et,{get label(){return t(i)},get placeholder(){return t(n)},discreet:!0,get onblur(){return t(c)}})}d(ht),d(Z);var tt=m(Z,2),Tt=v(tt,!0);d(tt);var et=m(tt,2),jt=v(et,!0);d(et);var at=m(et,2),rt=v(at),zt=v(rt);S(zt,{get Icon(){return Me},composite:!0,label:n=>{const c=(a,r=qt)=>{var o=Re(),p=v(o);{let f=e(()=>[l.data.metadata.label,l.data.option.label]);V(p,{get x(){return r()},n:!0,get a(){return t(f)}})}d(o),_(a,o)};{let a=e(()=>[c]),r=e(()=>t(s).c(328));V(n,{get t(){return t(a)},get x(){return t(r)}})}},children:(n,c)=>{var a=Fe();Mt(a,21,()=>t(h),({metadataId:r,metadata:o,option:p,value:f})=>r,(r,o,p,f)=>{let u=()=>t(o).metadataId,O=()=>t(o).metadata,y=()=>t(o).option,st=()=>t(o).value;const L=e(()=>It(u()));var k=Ce(),w=v(k),H=v(w,!0);d(w);var U=m(w,2);_e(U,{});var j=m(U,2),R=v(j,!0);d(j);var A=m(j,2);{var G=z=>{{let nt=e(()=>t(s)(329,[y().label||y().key]));vt(z,{get help(){return t(nt)},onclick:()=>Rt("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:x.params.id??"",metadata:t(L),option:y().key}),children:(ot,Nt)=>{Ot(ot,{})},$$slots:{default:!0}})}};it(A,z=>{y()&&z(G)})}d(k),D(()=>{P(H,O()?.label||t(L)),P(R,y()?.label||y()?.key||st())}),_(r,k)},r=>{var o=Be(),p=v(o,!0);d(o),D(f=>P(p,f),[()=>t(s)(330)]),_(r,o)}),d(a),_(n,a)}}),d(rt);var bt=m(rt,2),St=v(bt);S(St,{get Icon(){return Ie},composite:!0,label:n=>{const c=(a,r=qt)=>{var o=He(),p=v(o);{let f=e(()=>[t(E).label,l.data.option.label]);V(p,{get x(){return r()},n:!0,get a(){return t(f)}})}d(o),_(a,o)};{let a=e(()=>[c]),r=e(()=>t(s).c(331));V(n,{get t(){return t(a)},get x(){return t(r)}})}},children:(n,c)=>{var a=Le(),r=v(a);ue(r,{get items(){return t(b)},children:se,$$slots:{default:(o,p)=>{const f=e(()=>p.item),u=e(()=>{const{metadataId:L,metadata:k,option:w,value:H}=t(f);return{metadataId:L,metadata:k,option:w,value:H}}),O=e(()=>It(t(u).metadataId));var y=De();{const L=k=>{var w=ne(),H=lt(w);{var U=R=>{var A=Ae(),G=lt(A),z=m(G);{let nt=e(()=>t(s)(329,[t(u).option.label||t(u).option.key]));vt(z,{get help(){return t(nt)},onclick:()=>Rt("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:x.params.id??"",metadata:t(O),option:t(u).option.key}),children:(ot,Nt)=>{Ot(ot,{})},$$slots:{default:!0}})}D(()=>P(G,`${(t(u).option.label||t(u).option.key)??""} `)),_(R,A)},j=R=>{var A=oe();D(()=>P(A,t(u).value)),_(R,A)};it(H,R=>{t(u).option?R(U):R(j,!1)})}_(k,w)};var st=v(y);{let k=e(()=>[L]),w=e(()=>t(s).c(332)),H=e(()=>[t(u).metadata?.label||t(O)]);V(st,{get t(){return t(k)},get x(){return t(w)},get a(){return t(H)}})}d(y)}_(o,y)}}}),d(a),_(n,a)}}),d(bt),d(at);var yt=m(at,2),Kt=v(yt);{const i=n=>{fe(n,{})};he(Kt,{danger:!0,onclick:async()=>{await be(t(K),t(q))},_w_snippet_3:i,children:(n,c)=>{{let a=e(()=>[i]),r=e(()=>t(s).c(333));V(n,{get t(){return t(a)},get x(){return t(r)}})}},$$slots:{_w_snippet_3:!0,default:!0}})}d(yt),D((i,n,c,a)=>{P(Lt,i),P(Vt,n),P(Tt,c),P(jt,a)},[()=>t(s)(358),()=>t(s)(359),()=>t(s)(326),()=>t(s)(327)]),de(1,N,()=>ve,()=>({duration:100})),_(I,T),ae()}export{pa as component,ca as universal};
