import{d as pt,t as x,y as W,p as dt}from"../chunks/h9n_zjAt.js";import{l as mt}from"../chunks/CXutPItK.js";import{u as F}from"../chunks/fpNj8U5y.js";import{c as ft,n as vt}from"../chunks/C0SiBqD8.js";import"../chunks/DsnmJJEf.js";import{f as ut,a as u,p as _t,g as t,u as l,I as w,H as h,b as gt,ai as g,ak as p,F as ht,G,K as r,am as wt}from"../chunks/Dt6m180S.js";import{s as S}from"../chunks/BqMK6M8M.js";import{r as bt,i as $t}from"../chunks/cmrSGx3m.js";import{c as yt}from"../chunks/BptB6vFW.js";import{e as K}from"../chunks/Bmx3KKup.js";import{a as St,t as xt,f as It}from"../chunks/DM93I2Od.js";import{a as Pt,b as Mt,s as kt}from"../chunks/CoW7fDOc.js";import{A as E}from"../chunks/DkZwE8qq.js";import{B as At}from"../chunks/cTmsNnlM.js";import{B as J}from"../chunks/BWvVnymT.js";import{C as N}from"../chunks/DzqEHu1p.js";import{D as zt}from"../chunks/ipq46OeX.js";import{p as Bt,a as Rt}from"../chunks/BgPK52sz.js";import{g as P}from"../chunks/CoCzgeuV.js";import{s as Q,i as Ct}from"../chunks/62CSzXnv.js";import{s as Dt}from"../chunks/DDk1L18j.js";import{R as H}from"../chunks/CH5FdpMr.js";async function Ht({depends:c}){return c(pt("Session","")),{sessions:await Ot()}}async function Ft(c){const i=await W("Image","sessionId",c),a=[...new Set(i.map(d=>d.fileId).filter(vt))].slice(0,4);return await Promise.all(a.map(async d=>{F.hasPreviewURL(d)||await mt(d,"global")})),a.map(d=>F.getPreviewURL(d))}async function Ot(){const c=await x.Session.list();c.sort(ft("openedAt")),c.reverse();for(const i of c)i.protocol=await x.Protocol.get(i.protocol),i.thumbs=await Ft(i.id),i.counts={images:await W("Image","sessionId",i.id).then(a=>a.length)};return c}const ue=Object.freeze(Object.defineProperty({__proto__:null,load:Ht},Symbol.toStringTag,{value:"Module"}));var Ut=ut('<svg><path fill="currentColor" d="M22 4a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1zM4 15h3.416a5.001 5.001 0 0 0 9.168 0H20v4H4zM4 5h16v8h-5a3 3 0 1 1-6 0H4zm12 4h-3V6h-2v3H8l4 4.5z"></path></svg>');function Tt(c,i){const a=bt(i,["$$slots","$$events","$$legacy"]);var d=Ut();Pt(d,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...a})),u(c,d)}var jt=w('<img class="svelte-1266fsb"/>'),Lt=w('<em class="unavailable"> </em>'),Vt=w('<div class="content svelte-1266fsb"><div class="gallery svelte-1266fsb"></div> <header class="svelte-1266fsb"><p class="protocol svelte-1266fsb"><!></p> <h2 class="svelte-1266fsb"> </h2> <p class="date svelte-1266fsb"><!></p></header> <footer class="svelte-1266fsb"><!></footer></div>'),qt=w('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Gt=w('<div class="content new svelte-1266fsb"><!></div>'),Kt=w('<main class="svelte-1266fsb"><header class="svelte-1266fsb"><h1> </h1> <section class="actions svelte-1266fsb"><!> <!></section></header> <section class="sessions svelte-1266fsb"></section></main>');function _e(c,i){_t(i,!0);const a=l(()=>Mt("main"));Dt({title:t(a)(382)});const d=l(()=>i.data.sessions),b=l(()=>x.Protocol.state[0]);async function O(){if(!t(b)){xt.error(t(a)(383));return}const o=Rt(t(b),x.Metadata.state),e=t(b).exports?.images.mtime,{id:_}=await x.Session.add({name:`Session du ${Intl.DateTimeFormat().format(new Date)}`,description:"",protocol:t(b).id,createdAt:new Date().toISOString(),openedAt:new Date().toISOString(),metadata:{},group:{global:{field:"none"},crop:{field:"metadataPresence",metadata:t(b).crop.metadata},classify:o?{field:"metadataConfidence",metadata:o}:{field:"none"}},sort:{global:e?{field:"metadataValue",direction:"asc",metadata:e}:{field:"name",direction:"asc"}}});await P("/(app)/sessions/[id]",{id:_})}var I=Kt(),M=p(I),k=p(M),X=p(k,!0);r(k);var U=g(k,2),T=p(U);{const o=e=>{Tt(e,{})};J(T,{onclick:async()=>{const e=await Bt({accept:"application/zip",multiple:!1});await Q(null),Ct(e),await P("/import")},_w_snippet_0:o,children:(e,_)=>{{let f=l(()=>[o]),m=l(()=>t(a).c(384));H(e,{get t(){return t(f)},get x(){return t(m)}})}},$$slots:{_w_snippet_0:!0,default:!0}})}var Y=g(T,2);{const o=e=>{E(e,{})};J(Y,{testid:"new-session",onclick:async()=>{await O()},_w_snippet_1:o,children:(e,_)=>{{let f=l(()=>[o]),m=l(()=>t(a).c(385));H(e,{get t(){return t(f)},get x(){return t(m)}})}},$$slots:{_w_snippet_1:!0,default:!0}})}r(U),r(M);var j=g(M,2);K(j,21,()=>t(d),({createdAt:o,id:e,name:_,protocol:f,counts:m,thumbs:$})=>e,(o,e)=>{let _=()=>t(e).createdAt,f=()=>t(e).id,m=()=>t(e).name,$=()=>t(e).protocol,Z=()=>t(e).counts,tt=()=>t(e).thumbs;var L=qt(),A=ht(L);{let et=l(()=>t(a)(386)),at=l(()=>t(a)(426));yt(A,()=>({"--card-border":F.currentSessionId===f()?"var(--bg-primary)":""})),N(A.lastChild,{get tooltip(){return t(et)},get loading(){return t(at)},onclick:async()=>{await Q(f()),await P("/import")},children:(st,Et)=>{var z=Vt(),B=p(z);K(B,20,tt,s=>s,(s,n)=>{var v=jt();h(()=>kt(v,"src",n)),u(s,v)}),r(B);var R=g(B,2),C=p(R),ot=p(C);{var rt=s=>{var n=G();h(()=>S(n,$().name)),u(s,n)},it=s=>{var n=Lt(),v=p(n,!0);r(n),h(y=>S(v,y),[()=>t(a)(387)]),u(s,n)};$t(ot,s=>{$()?s(rt):s(it,!1)})}r(C);var D=g(C,2),nt=p(D,!0);r(D);var V=g(D,2);{const s=n=>{zt(n,{show:"relative",get value(){return _()}})};var lt=p(V);{let n=l(()=>[s]),v=l(()=>t(a).c(389)),y=l(()=>[dt(Z().images,t(a).p(388),t(a)._.p)]);H(lt,{get t(){return t(n)},get x(){return t(v)},get a(){return t(y)}})}r(V)}r(R);var q=g(R,2),ct=p(q);At(ct,{fills:!0,onclick:async s=>{s.stopPropagation(),await P("/(app)/sessions/[id]",{id:f()})},children:(s,n)=>{wt();var v=G();h(y=>S(v,y),[()=>t(a)(390)]),u(s,v)},$$slots:{default:!0}}),r(q),r(z),h(()=>S(nt,m())),u(st,z)},$$slots:{default:!0}}),r(A)}u(o,L)},o=>{{let e=l(()=>t(a)(391));N(o,{testid:"new-session-card",get tooltip(){return t(e)},onclick:async()=>{await O()},children:(_,f)=>{var m=Gt(),$=p(m);E($,{}),r(m),u(_,m)},$$slots:{default:!0}})}}),r(j),r(I),h(o=>S(X,o),[()=>t(a)(382)]),St(1,I,()=>It,()=>({duration:100})),u(c,I),gt()}export{_e as component,ue as universal};
