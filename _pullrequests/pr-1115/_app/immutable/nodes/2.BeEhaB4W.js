import{l as re}from"../chunks/CoW7fDOc.js";import"../chunks/DsnmJJEf.js";import{l as ae}from"../chunks/CD3Mjm3u.js";import{e as oe}from"../chunks/CTlA2v4V.js";import{bF as se}from"../chunks/Dt6m180S.js";import{L as ie,a2 as ce,a3 as R,a4 as k,a5 as C,a6 as K,b as i,a7 as A,a8 as ue,a as T,a9 as de,aa as le,t as B,v as me,o as fe,N as he}from"../chunks/h9n_zjAt.js";import{c as ge}from"../chunks/BgPK52sz.js";import{g as X}from"../chunks/JZH0u_ZA.js";import{t as ee}from"../chunks/DM93I2Od.js";import{N as pe}from"../chunks/U1OIFfFg.js";import{_ as nn}from"../chunks/BlnV6Gf8.js";const be=se;function we(e){const t={},r=ie();for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]===void 0?delete t[n]:t[n]=e[n]);ce(t)}const ye={lessThanXSeconds:{one:"moins d’une seconde",other:"moins de {{count}} secondes"},xSeconds:{one:"1 seconde",other:"{{count}} secondes"},halfAMinute:"30 secondes",lessThanXMinutes:{one:"moins d’une minute",other:"moins de {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"environ 1 heure",other:"environ {{count}} heures"},xHours:{one:"1 heure",other:"{{count}} heures"},xDays:{one:"1 jour",other:"{{count}} jours"},aboutXWeeks:{one:"environ 1 semaine",other:"environ {{count}} semaines"},xWeeks:{one:"1 semaine",other:"{{count}} semaines"},aboutXMonths:{one:"environ 1 mois",other:"environ {{count}} mois"},xMonths:{one:"1 mois",other:"{{count}} mois"},aboutXYears:{one:"environ 1 an",other:"environ {{count}} ans"},xYears:{one:"1 an",other:"{{count}} ans"},overXYears:{one:"plus d’un an",other:"plus de {{count}} ans"},almostXYears:{one:"presqu’un an",other:"presque {{count}} ans"}},ve=(e,t,r)=>{let n;const a=ye[e];return typeof a=="string"?n=a:t===1?n=a.one:n=a.other.replace("{{count}}",String(t)),r?.addSuffix?r.comparison&&r.comparison>0?"dans "+n:"il y a "+n:n},Pe={full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},Me={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Se={full:"{{date}} 'à' {{time}}",long:"{{date}} 'à' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},We={date:R({formats:Pe,defaultWidth:"full"}),time:R({formats:Me,defaultWidth:"full"}),dateTime:R({formats:Se,defaultWidth:"full"})},ke={lastWeek:"eeee 'dernier à' p",yesterday:"'hier à' p",today:"'aujourd’hui à' p",tomorrow:"'demain à' p'",nextWeek:"eeee 'prochain à' p",other:"P"},Ce=(e,t,r,n)=>ke[e],$e={narrow:["av. J.-C","ap. J.-C"],abbreviated:["av. J.-C","ap. J.-C"],wide:["avant Jésus-Christ","après Jésus-Christ"]},je={narrow:["T1","T2","T3","T4"],abbreviated:["1er trim.","2ème trim.","3ème trim.","4ème trim."],wide:["1er trimestre","2ème trimestre","3ème trimestre","4ème trimestre"]},Ee={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],wide:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"]},Ne={narrow:["D","L","M","M","J","V","S"],short:["di","lu","ma","me","je","ve","sa"],abbreviated:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],wide:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},Ie={narrow:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"mat.",afternoon:"ap.m.",evening:"soir",night:"mat."},abbreviated:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"matin",afternoon:"après-midi",evening:"soir",night:"matin"},wide:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"du matin",afternoon:"de l’après-midi",evening:"du soir",night:"du matin"}},Re=(e,t)=>{const r=Number(e),n=t?.unit;if(r===0)return"0";const a=["year","week","hour","minute","second"];let c;return r===1?c=n&&a.includes(n)?"ère":"er":c="ème",r+c},Oe=["MMM","MMMM"],De={preprocessor:(e,t)=>e.getDate()===1||!t.some(n=>n.isToken&&Oe.includes(n.value))?t:t.map(n=>n.isToken&&n.value==="do"?{isToken:!0,value:"d"}:n),ordinalNumber:Re,era:k({values:$e,defaultWidth:"wide"}),quarter:k({values:je,defaultWidth:"wide",argumentCallback:e=>e-1}),month:k({values:Ee,defaultWidth:"wide"}),day:k({values:Ne,defaultWidth:"wide"}),dayPeriod:k({values:Ie,defaultWidth:"wide"})},Te=/^(\d+)(ième|ère|ème|er|e)?/i,xe=/\d+/i,Ae={narrow:/^(av\.J\.C|ap\.J\.C|ap\.J\.-C)/i,abbreviated:/^(av\.J\.-C|av\.J-C|apr\.J\.-C|apr\.J-C|ap\.J-C)/i,wide:/^(avant Jésus-Christ|après Jésus-Christ)/i},_e={any:[/^av/i,/^ap/i]},Le={narrow:/^T?[1234]/i,abbreviated:/^[1234](er|ème|e)? trim\.?/i,wide:/^[1234](er|ème|e)? trimestre/i},ze={any:[/1/i,/2/i,/3/i,/4/i]},qe={narrow:/^[jfmasond]/i,abbreviated:/^(janv|févr|mars|avr|mai|juin|juill|juil|août|sept|oct|nov|déc)\.?/i,wide:/^(janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)/i},Be={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^av/i,/^ma/i,/^juin/i,/^juil/i,/^ao/i,/^s/i,/^o/i,/^n/i,/^d/i]},He={narrow:/^[lmjvsd]/i,short:/^(di|lu|ma|me|je|ve|sa)/i,abbreviated:/^(dim|lun|mar|mer|jeu|ven|sam)\.?/i,wide:/^(dimanche|lundi|mardi|mercredi|jeudi|vendredi|samedi)/i},Je={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^di/i,/^lu/i,/^ma/i,/^me/i,/^je/i,/^ve/i,/^sa/i]},Ve={narrow:/^(a|p|minuit|midi|mat\.?|ap\.?m\.?|soir|nuit)/i,any:/^([ap]\.?\s?m\.?|du matin|de l'après[-\s]midi|du soir|de la nuit)/i},Fe={any:{am:/^a/i,pm:/^p/i,midnight:/^min/i,noon:/^mid/i,morning:/mat/i,afternoon:/ap/i,evening:/soir/i,night:/nuit/i}},Xe={ordinalNumber:K({matchPattern:Te,parsePattern:xe,valueCallback:e=>parseInt(e)}),era:C({matchPatterns:Ae,defaultMatchWidth:"wide",parsePatterns:_e,defaultParseWidth:"any"}),quarter:C({matchPatterns:Le,defaultMatchWidth:"wide",parsePatterns:ze,defaultParseWidth:"any",valueCallback:e=>e+1}),month:C({matchPatterns:qe,defaultMatchWidth:"wide",parsePatterns:Be,defaultParseWidth:"any"}),day:C({matchPatterns:He,defaultMatchWidth:"wide",parsePatterns:Je,defaultParseWidth:"any"}),dayPeriod:C({matchPatterns:Ve,defaultMatchWidth:"any",parsePatterns:Fe,defaultParseWidth:"any"})},Ue={code:"fr",formatDistance:ve,formatLong:We,formatRelative:Ce,localize:De,match:Xe,options:{weekStartsOn:1,firstWeekContainsDate:4}},Qe={lessThanXSeconds:{one:"1秒未満",other:"{{count}}秒未満",oneWithSuffix:"約1秒",otherWithSuffix:"約{{count}}秒"},xSeconds:{one:"1秒",other:"{{count}}秒"},halfAMinute:"30秒",lessThanXMinutes:{one:"1分未満",other:"{{count}}分未満",oneWithSuffix:"約1分",otherWithSuffix:"約{{count}}分"},xMinutes:{one:"1分",other:"{{count}}分"},aboutXHours:{one:"約1時間",other:"約{{count}}時間"},xHours:{one:"1時間",other:"{{count}}時間"},xDays:{one:"1日",other:"{{count}}日"},aboutXWeeks:{one:"約1週間",other:"約{{count}}週間"},xWeeks:{one:"1週間",other:"{{count}}週間"},aboutXMonths:{one:"約1か月",other:"約{{count}}か月"},xMonths:{one:"1か月",other:"{{count}}か月"},aboutXYears:{one:"約1年",other:"約{{count}}年"},xYears:{one:"1年",other:"{{count}}年"},overXYears:{one:"1年以上",other:"{{count}}年以上"},almostXYears:{one:"1年近く",other:"{{count}}年近く"}},Ye=(e,t,r)=>{r=r||{};let n;const a=Qe[e];return typeof a=="string"?n=a:t===1?r.addSuffix&&a.oneWithSuffix?n=a.oneWithSuffix:n=a.one:r.addSuffix&&a.otherWithSuffix?n=a.otherWithSuffix.replace("{{count}}",String(t)):n=a.other.replace("{{count}}",String(t)),r.addSuffix?r.comparison&&r.comparison>0?n+"後":n+"前":n},Ge={full:"y年M月d日EEEE",long:"y年M月d日",medium:"y/MM/dd",short:"y/MM/dd"},Ze={full:"H時mm分ss秒 zzzz",long:"H:mm:ss z",medium:"H:mm:ss",short:"H:mm"},Ke={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},et={date:R({formats:Ge,defaultWidth:"full"}),time:R({formats:Ze,defaultWidth:"full"}),dateTime:R({formats:Ke,defaultWidth:"full"})},tt={lastWeek:"先週のeeeeのp",yesterday:"昨日のp",today:"今日のp",tomorrow:"明日のp",nextWeek:"翌週のeeeeのp",other:"P"},nt=(e,t,r,n)=>tt[e],rt={narrow:["BC","AC"],abbreviated:["紀元前","西暦"],wide:["紀元前","西暦"]},at={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["第1四半期","第2四半期","第3四半期","第4四半期"]},ot={narrow:["1","2","3","4","5","6","7","8","9","10","11","12"],abbreviated:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],wide:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},st={narrow:["日","月","火","水","木","金","土"],short:["日","月","火","水","木","金","土"],abbreviated:["日","月","火","水","木","金","土"],wide:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"]},it={narrow:{am:"午前",pm:"午後",midnight:"深夜",noon:"正午",morning:"朝",afternoon:"午後",evening:"夜",night:"深夜"},abbreviated:{am:"午前",pm:"午後",midnight:"深夜",noon:"正午",morning:"朝",afternoon:"午後",evening:"夜",night:"深夜"},wide:{am:"午前",pm:"午後",midnight:"深夜",noon:"正午",morning:"朝",afternoon:"午後",evening:"夜",night:"深夜"}},ct={narrow:{am:"午前",pm:"午後",midnight:"深夜",noon:"正午",morning:"朝",afternoon:"午後",evening:"夜",night:"深夜"},abbreviated:{am:"午前",pm:"午後",midnight:"深夜",noon:"正午",morning:"朝",afternoon:"午後",evening:"夜",night:"深夜"},wide:{am:"午前",pm:"午後",midnight:"深夜",noon:"正午",morning:"朝",afternoon:"午後",evening:"夜",night:"深夜"}},ut=(e,t)=>{const r=Number(e);switch(String(t?.unit)){case"year":return`${r}年`;case"quarter":return`第${r}四半期`;case"month":return`${r}月`;case"week":return`第${r}週`;case"date":return`${r}日`;case"hour":return`${r}時`;case"minute":return`${r}分`;case"second":return`${r}秒`;default:return`${r}`}},dt={ordinalNumber:ut,era:k({values:rt,defaultWidth:"wide"}),quarter:k({values:at,defaultWidth:"wide",argumentCallback:e=>Number(e)-1}),month:k({values:ot,defaultWidth:"wide"}),day:k({values:st,defaultWidth:"wide"}),dayPeriod:k({values:it,defaultWidth:"wide",formattingValues:ct,defaultFormattingWidth:"wide"})},lt=/^第?\d+(年|四半期|月|週|日|時|分|秒)?/i,mt=/\d+/i,ft={narrow:/^(B\.?C\.?|A\.?D\.?)/i,abbreviated:/^(紀元[前後]|西暦)/i,wide:/^(紀元[前後]|西暦)/i},ht={narrow:[/^B/i,/^A/i],any:[/^(紀元前)/i,/^(西暦|紀元後)/i]},gt={narrow:/^[1234]/i,abbreviated:/^Q[1234]/i,wide:/^第[1234一二三四１２３４]四半期/i},pt={any:[/(1|一|１)/i,/(2|二|２)/i,/(3|三|３)/i,/(4|四|４)/i]},bt={narrow:/^([123456789]|1[012])/,abbreviated:/^([123456789]|1[012])月/i,wide:/^([123456789]|1[012])月/i},wt={any:[/^1\D/,/^2/,/^3/,/^4/,/^5/,/^6/,/^7/,/^8/,/^9/,/^10/,/^11/,/^12/]},yt={narrow:/^[日月火水木金土]/,short:/^[日月火水木金土]/,abbreviated:/^[日月火水木金土]/,wide:/^[日月火水木金土]曜日/},vt={any:[/^日/,/^月/,/^火/,/^水/,/^木/,/^金/,/^土/]},Pt={any:/^(AM|PM|午前|午後|正午|深夜|真夜中|夜|朝)/i},Mt={any:{am:/^(A|午前)/i,pm:/^(P|午後)/i,midnight:/^深夜|真夜中/i,noon:/^正午/i,morning:/^朝/i,afternoon:/^午後/i,evening:/^夜/i,night:/^深夜/i}},St={ordinalNumber:K({matchPattern:lt,parsePattern:mt,valueCallback:function(e){return parseInt(e,10)}}),era:C({matchPatterns:ft,defaultMatchWidth:"wide",parsePatterns:ht,defaultParseWidth:"any"}),quarter:C({matchPatterns:gt,defaultMatchWidth:"wide",parsePatterns:pt,defaultParseWidth:"any",valueCallback:e=>e+1}),month:C({matchPatterns:bt,defaultMatchWidth:"wide",parsePatterns:wt,defaultParseWidth:"any"}),day:C({matchPatterns:yt,defaultMatchWidth:"wide",parsePatterns:vt,defaultParseWidth:"any"}),dayPeriod:C({matchPatterns:Pt,defaultMatchWidth:"any",parsePatterns:Mt,defaultParseWidth:"any"})},Wt={code:"ja",formatDistance:Ye,formatLong:et,formatRelative:nt,localize:dt,match:St,options:{weekStartsOn:0,firstWeekContainsDate:1}};Map.groupBy??=function(t,r){const n=new Map;let a=0;for(const c of t){const l=r(c,a++),P=n.get(l);P?P.push(c):n.set(l,[c])}return n};const kt=Symbol("SWARPC procedures");class Ct extends Error{constructor(t){super(`Request was cancelled: ${t}`),this.name="RequestCancelledError"}}function _(e,t="debug",r,n){const a=U.slice(U.indexOf(t));if(n&&r){const c={rqid:n,nid:r};return{debug:a.includes("debug")?j("debug",e,c):()=>{},info:a.includes("info")?j("info",e,c):()=>{},warn:a.includes("warn")?j("warn",e,c):()=>{},error:a.includes("error")?j("error",e,c):()=>{}}}return{debug:a.includes("debug")?j("debug",e,r):()=>{},info:a.includes("info")?j("info",e,r):()=>{},warn:a.includes("warn")?j("warn",e,r):()=>{},error:a.includes("error")?j("error",e,r):()=>{}}}const U=["debug","info","warn","error"],$t=["debug","info","warn","error","log"];function j(e,t,r){if(r===void 0||typeof r=="string"){const n=r??null;return(a,...c)=>Q(e,t,{nid:n,rqid:a},...c)}return(...n)=>Q(e,t,r,...n)}const jt=$t.reduce((e,t)=>(e[t]=console[t],e),{});function Q(e,t,{rqid:r,nid:n},...a){const c=[`[SWARPC ${t}]`,r?`%c${r}%c`:"",n?`%c@ ${n}%c`:""].filter(Boolean).join(" "),l=[];return r&&l.push("color: cyan","color: inherit"),n&&l.push("color: hotpink","color: inherit"),jt[e](c,...l,...a)}function Y(e,t){if(!e)return;let r=Object.keys(e)[0];const n=Map.groupBy(t.values(),a=>a.nodeId);for(const a of Object.keys(e))n.has(a)||n.set(a,[]);for(const[a,c]of n.entries())a&&c.length<n.get(r).length&&(r=a);return console.debug("[SWARPC Load balancer] Choosing",r,"load map is",n),r}function Et(){return"N"+Math.random().toString(16).substring(2,5).toUpperCase()}const Nt="(SW)";function E(e){return e??Nt}function L(e,t){if(t&&Array.isArray(t))return t;let r=[void 0];return e&&(r=[...e]),typeof t=="number"&&(r=r.slice(0,t)),r}const It=[MessagePort,ReadableStream,WritableStream,TransformStream,ArrayBuffer];function H(e){return e==null?[]:typeof e=="object"?ArrayBuffer.isView(e)||e instanceof ArrayBuffer?[e]:It.some(t=>e instanceof t)?[e]:Array.isArray(e)?e.flatMap(H):Object.values(e).flatMap(H):[]}function G(e){return e.length===0?[]:e}function Rt(e){return e.filter(t=>t.status==="fulfilled")}function Ot(e){return e.filter(t=>t.status==="rejected")}const Z=["onceBy","destroy"],$=new Map,Dt=()=>{};let D=new Map;function Tt(e,{worker:t,nodes:r,loglevel:n="debug",restartListener:a=!1,hooks:c={},localStorage:l={},nodeIds:P=[]}={}){const S=_("client",n);a&&D.clear(),r??=navigator.hardwareConcurrency||1;let u;if(t){u={};for(const[o]of Array.from({length:r}).entries()){const f=P[o]??Et();typeof t=="string"?u[f]=new Worker(t,{name:f}):u[f]=new t({name:f})}S.info(null,`Started ${r} node${r>1?"s":""}`,Object.keys(u))}const h={[kt]:e,destroy(){for(const[o,f]of D.entries())S.debug(null,`Destroying listener for node ${o}`),f.disconnect(),D.delete(o);for(const[o,f]of Object.entries(u??{}))S.debug(null,`Terminating worker for node ${o}`),f instanceof SharedWorker?f.port.close():f.terminate()}};function O(o,f){const{nodeIds:w,functionName:v,concurrencyKey:s}=f;if(!w&&!v&&!s)throw new Error("At least one criteria must be provided to cancel requests");if(w?.length===0){console.warn("[SWARPC Client] cancelRequests called with empty nodeIds array, no requests will be cancelled");return}const d=s?v?`${v}:${s}`:s:void 0,m=(p,b)=>p?b(p):!0,g=[...$.entries()].filter(([p,b])=>m(w,M=>!b.nodeId||M.includes(b.nodeId))&&m(v,M=>b.functionName===M)&&m(d,M=>b.concurrencyKey===M));for(const[p,{functionName:b}]of g)J(p,o,b)}function J(o,f,w){const v=$.get(o);if(!v)return;const s=v.nodeId,d=_("client",n,E(s),o);d.debug(o,`Cancelling ${w} with`,f),v.reject(new Ct(f)),xt(d,s?u?.[s]:void 0,{by:"sw&rpc",requestId:o,functionName:w,abort:{reason:f}}),$.delete(o)}const V=new Map;for(const o of Object.keys(e)){if(typeof o!="string")throw new Error("[SWARPC Client] Invalid function name, don't use symbols");if(Z.includes(o))throw new Error(`[SWARPC Client] Invalid function name: "${o}" is a reserved word and can't be used as a procedure name. Reserved names: ${Z}`);const f=async(s,d,m,g,p)=>{const b={logger:S,node:s,nodeId:d,allNodeIDs:new Set(u?Object.keys(u):[]),hooks:c,localStorage:l};return te(b,{...g,by:"sw&rpc",requestId:m,functionName:o},p)},w=async({input:s,onProgress:d,requestId:m,nodeId:g,concurrencyKey:p})=>{const b=e[o].input["~standard"].validate(s);if(b instanceof Promise)throw new Error("Validations must not be async");if(b.issues)throw new Error(`Invalid input: ${b.issues}`);const M=m??z();g??=Y(u,$);const I=u&&g?u[g]:void 0,F=_("client",n,E(g),M);return new Promise((x,y)=>{$.set(M,{nodeId:g,functionName:o,concurrencyKey:p,resolve:x,onProgress:d??Dt,reject:y});const W=e[o].autotransfer==="always"?H(s):[];return F.debug(`Requesting ${o} with`,s),f(I,g,M,{input:s},{transfer:W}).then(()=>{}).catch(y)})},v=async({input:s,onProgresses:d,nodesCountOrIDs:m,concurrencyKey:g})=>{const p=L(u?Object.keys(u):void 0,m),b=new Map;function M(y){return d?W=>{b.set(E(y),W),d(b)}:W=>{}}const I=await Promise.allSettled(p.map(async y=>w({input:s,onProgress:M(y),nodeId:y,concurrencyKey:g}))).then(y=>y.map((W,ne)=>({...W,node:E(p[ne])}))),x={byNode:new Map(I.map(({node:y,...W})=>[y,W])),successes:G(Rt(I).map(y=>y.value)),failures:G(Ot(I)),get failureSummary(){return this.failures?.map(({node:y,reason:W})=>`Node ${y}: ${W}`).join(`;
`)},get ok(){return this.failures.length===0},get ko(){return this.successes.length===0},get status(){return this.ok?"fulfilled":this.ko?"rejected":"mixed"}};return Object.assign(I,x)};V.set(o,w),h[o]=(s,d)=>w({input:s,onProgress:d}),h[o].broadcast=(s,d,m)=>v({input:s,onProgresses:d,nodesCountOrIDs:m}),h[o].broadcast.orThrow=async(...s)=>q(await h[o].broadcast(...s)),h[o].broadcast.once=async(s,d,m)=>{const g=L(u?Object.keys(u):void 0,m);return O("Cancelled by .broadcast.once() call",{functionName:o,nodeIds:g.filter(p=>p!==void 0)}),v({input:s,onProgresses:d,nodesCountOrIDs:g})},h[o].broadcast.once.orThrow=async(...s)=>q(await h[o].broadcast.once(...s)),h[o].broadcast.onceBy=async(s,d,m,g)=>{const p=L(u?Object.keys(u):void 0,g);return O("Cancelled by .broadcast.once() call",{concurrencyKey:s,functionName:o,nodeIds:p.filter(b=>b!==void 0)}),v({input:d,onProgresses:m,nodesCountOrIDs:p,concurrencyKey:s})},h[o].broadcast.onceBy.orThrow=async(...s)=>q(await h[o].broadcast.onceBy(...s)),h[o].cancelable=(s,d)=>{const m=z(),g=Y(u,$);return{request:w({input:s,onProgress:d,requestId:m,nodeId:g}),cancel(p){J(m,p,o)}}},h[o].once=async(s,d)=>(O("Cancelled by .once() call",{functionName:o}),await w({input:s,onProgress:d})),h[o].onceBy=async(s,d,m)=>(O(`Cancelled by .onceBy("${s}") call`,{functionName:o,concurrencyKey:s}),await w({input:d,onProgress:m,concurrencyKey:s}))}return h.onceBy=o=>{const f={};for(const w of Object.keys(e))typeof w=="string"&&(f[w]=async(v,s)=>{O(`Cancelled by global onceBy("${o}") call`,{concurrencyKey:o});const d=z(),m=V.get(w);if(!m)throw new Error(`No procedure found for ${w}`);return await m({input:v,onProgress:s,requestId:d,concurrencyKey:o})});return f},h}async function te(e,t,r){await At(e);const{logger:n,node:a}=e;!a&&!navigator.serviceWorker.controller&&n.warn("","Service Worker is not controlling the page");const c=a instanceof SharedWorker?a.port:a===void 0?await navigator.serviceWorker.ready.then(l=>l.active):a;if(!c)throw new Error("[SWARPC Client] No active service worker found");c.postMessage(t,r)}function xt(e,t,r,n){!t&&!navigator.serviceWorker.controller&&e.warn("Service Worker is not controlling the page");const a=t instanceof SharedWorker?t.port:t===void 0?navigator.serviceWorker.controller:t;if(!a)throw new Error("[SWARPC Client] No active service worker found");a.postMessage(r,n)}async function At(e){if(D.has(E(e.nodeId)))return;const{logger:t,node:r}=e;if(!r){if(!(await navigator.serviceWorker.ready)?.active)throw new Error("[SWARPC Client] Service Worker is not active");navigator.serviceWorker.controller||t.warn("","Service Worker is not controlling the page")}const n=r??navigator.serviceWorker;t.debug(null,"Starting client listener",{w:n,...e});const a=c=>{const l=c.data||{};if(l?.by!=="sw&rpc")return;const P=l;if("isInitializeRequest"in P){t.warn(null,"Ignoring unexpected #initialize from server",P);return}const{requestId:S,...u}=P;if(!S)throw new Error("[SWARPC Client] Message received without requestId");const h=$.get(S);if(!h)throw new Error(`[SWARPC Client] ${S} has no active request handlers, cannot process ${JSON.stringify(u)}`);"error"in u?(e.hooks.error?.({procedure:u.functionName,error:new Error(u.error.message)}),h.reject(new Error(u.error.message)),$.delete(S)):"progress"in u?(e.hooks.progress?.({procedure:u.functionName,data:u.progress}),h.onProgress(u.progress)):"result"in u&&(e.hooks.success?.({procedure:u.functionName,data:u.result}),h.resolve(u.result),$.delete(S))};n instanceof SharedWorker?(n.port.addEventListener("message",a),n.port.start()):n.addEventListener("message",a),D.set(E(e.nodeId),{disconnect(){n instanceof SharedWorker?n.port.removeEventListener("message",a):n.removeEventListener("message",a)}}),await te(e,{by:"sw&rpc",functionName:"#initialize",isInitializeRequest:!0,localStorageData:e.localStorage,nodeId:E(e.nodeId),allNodeIDs:e.allNodeIDs})}function z(){return Math.random().toString(16).substring(2,8).toUpperCase()}function q(e){if(e.ok)return e.successes;throw new AggregateError(e.failures.map(t=>t.reason))}const _t={init:{input:i({databaseName:"string",databaseRevision:"number.integer >= 1"}),progress:i("undefined"),success:i("undefined")},loadModel:{input:i({model:"TypedArray.Uint8","classmapping?":"string | undefined",task:'"classification" | "detection"',"webgpu?":"boolean",inferenceSessionId:"string > 1"}),progress:i("undefined"),success:i("true")},inferenceSessionId:{input:i('"classification" | "detection"'),progress:i("undefined"),success:i("string | null")},inferBoundingBoxes:{input:i({fileId:"string",webgpu:"boolean = false",taskSettings:{input:A.ModelInput,output:{"name?":"string",shape:A.ModelDetectionOutputShape}}}),progress:i({}),success:i({boxes:i(["number","number","number","number"]).array(),scores:"number[]"})},classify:{input:i({imageId:"string","webgpu?":"boolean",metadataIds:{cropbox:"string",target:"string"},taskSettings:{input:A.ModelInput,"output?":{name:"string"}}}),progress:i({}),success:i({scores:"number[]"})},importProtocol:{input:i({contents:"string",isJSON:"boolean = false"}),progress:i({phase:i.enumerated("parsing","filtering-builtin-metadata","input-validation","write-protocol","write-metadata","write-metadata-options","output-validation"),"detail?":"string"}),success:i({id:"string",name:"string","version?":"number | undefined",iconsToPreload:"string[]"})},generateResultsZip:{input:i({sessionId:"string",include:i.enumerated("croppedonly","full","metadataonly"),cropPadding:/^\d+(px|%)$/,jsonSchemaURL:"string.url.parse"}),progress:i.or({progress:"number"},{warning:i.or(['"exif-write-error"',{filename:"string"}])}).pipe(e=>"progress"in e?{progress:e.progress,warning:void 0}:{progress:void 0,warning:e.warning}),success:i("ArrayBuffer")},previewResultsZip:{input:i({sessionId:"string",include:i.enumerated("croppedonly","full","metadataonly")}),progress:i("undefined"),success:i.scope({NodeProvenance:pe}).type({"[NodeProvenance]":"string[]"})},estimateResultsZipSize:{input:i({sessionId:"string",include:i.enumerated("croppedonly","full","metadataonly"),cropPadding:/^\d+(px|%)$/}),progress:i("undefined"),success:i({uncompressed:["number.integer >= 0","@","bytes"],compressed:["number.integer >= 0","@","bytes, estimated"]})},diffProtocolWithRemote:{input:i({protocolId:"string"}),progress:i("0 <= number <= 1"),success:i({dirty:"boolean",changes:i.or({path:"(number|string)[]",type:'"CREATE"',value:"unknown"},{path:"(number|string)[]",type:'"CHANGE"',oldValue:"unknown",value:"unknown"},{path:"(number|string)[]",type:'"REMOVE"',oldValue:"unknown"}).array()})}};function Lt(e){return new Worker(""+new URL("../workers/start-DFpSGuhm.js",import.meta.url).href,{type:"module",name:e?.name})}async function zt(){const e=await X("language",{fallback:ue()});document.documentElement.lang=e,N({fr:"Chargement des traductions…",en:"Loading translations…"}[e]),await re(e),we({locale:{fr:Ue,en:he,ja:Wt}[e]}),await qt();const t=await X("parallelism",{fallback:1}),r=T("js");N(r(451));const n=Tt(_t,{worker:Lt,nodes:t,hooks:{success({procedure:a,data:c}){a==="importProtocol"&&ae(c.iconsToPreload,(l,P)=>{console.info(`Preloaded ${l.length} icons, ${P.length} missing:`,P)})}}});try{const a=localStorage.getItem("currentSessionId");N(r(459)),await n.init.broadcast.orThrow({databaseName:le,databaseRevision:de}),await B.initialize(a),N(r(460)),await Bt(n),await B.initialize(a)}catch(a){console.error(a),oe(400,{message:a?.toString()??r(86)})}return ge(me(),n).then(a=>{a.length!==0&&ee.info(a.length===1?r(473,[a[0].name]):`${a.length} protocoles ont été mis à jour: ${a.map(c=>`"${c.name}"`).join(", ")}`)}),{swarpc:n,parallelism:t}}async function qt(){const e=T("js");N(e(440)),await fe(["Metadata","Protocol","Settings"],{},async t=>{await t.objectStore("Settings").put({id:"defaults",protocols:[],theme:"auto",gridSize:1,language:"fr",showInputHints:!0,showTechnicalMetadata:be,cropAutoNext:!1,gallerySort:{key:"date",direction:"asc"}})})}async function Bt(e){const t=T("js");if(N(t(438)),await B.Protocol.count()===0)try{const n=await fetch("https://raw.githubusercontent.com/cigaleapp/cigale/main/examples/arthropods.cigaleprotocol.json").then(a=>a.text());await e.importProtocol({contents:n,isJSON:!0},({phase:a,detail:c})=>{let l="";switch(a){case"parsing":l=t(461);break;case"filtering-builtin-metadata":l=t(462);break;case"input-validation":l=t(463);break;case"write-protocol":l=t(464);break;case"write-metadata":l=t(465,[c]);break;case"write-metadata-options":l=t(466,[c]);break;case"output-validation":l=t(467);break;default:break}N(`${t(438)}<br>${l}`)})}catch(n){console.error(n),ee.error(t(468))}}function N(e){const t=(n,a)=>{const c=document.getElementById(n);c&&(c.innerHTML=a)},r=T("js");t("loading-title",r(57)),t("loading-message",e)}const Kt=Object.freeze(Object.defineProperty({__proto__:null,load:zt},Symbol.toStringTag,{value:"Module"}));export{nn as component,Kt as universal};
