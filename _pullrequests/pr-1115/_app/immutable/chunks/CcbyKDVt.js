import"./DsnmJJEf.js";import{o as qe}from"./D6d8D7oP.js";import{aj as le,an as He,g as d,al as ce,p as je,c as me,u as M,I as N,a as B,b as ze,ai as L,ak as A,K as E,F as ge,H as j,D as Ve,J as Ye,am as ye,G as Je,aG as Xe}from"./Dt6m180S.js";import{s as Q}from"./BqMK6M8M.js";import{s as Ge}from"./CFbM8ao4.js";import{p as We,i as ne}from"./cmrSGx3m.js";import{e as fe}from"./Bmx3KKup.js";import{s as be}from"./BEu91mT_.js";import{a as Ue,f as Qe}from"./DM93I2Od.js";import{a as Se}from"./C3lM_sxf.js";import{b as Ze,c as we,s as et}from"./CoW7fDOc.js";import{b as tt}from"./jhyMdidl.js";import{D as st}from"./C0se_-sl.js";import{u as S}from"./fpNj8U5y.js";import{B as rt}from"./cTmsNnlM.js";import{m as xe,r as it,n as ot,l as nt,c as de,e as at}from"./C0SiBqD8.js";import{c as lt,b as pe,J as De,l as Be,t as Oe,r as ct,o as dt,p as ut}from"./h9n_zjAt.js";import{f as Re,m as $e}from"./BHxAX_Yx.js";import{s as Fe}from"./CpDocbkH.js";import{c as ht}from"./DxZSYbgf.js";import{a as mt,i as ft}from"./JZH0u_ZA.js";import{d as pt}from"./CXutPItK.js";import{e as _t,b as vt}from"./62CSzXnv.js";import{L as gt}from"./DJljq93Y.js";import{d as yt}from"./Z9u04OLA.js";import{R as bt}from"./CH5FdpMr.js";function St(o,e){return lt(o,e?.in).getFullYear()}function wt(o,e,t,i=void 0){if(t===null)return"";switch(e.type){case"boolean":switch(o){case"fr":return t?"Oui":"Non";default:return t?"Yes":"No"}case"date":return t instanceof Date?Re(t,"Ppp"):t.toString();case"enum":return i||t.toString();case"location":{const{latitude:s,longitude:r}=pe({latitude:"number",longitude:"number"}).assert(t);return`${s}, ${r}`}case"boundingbox":{const{x:s,y:r,w:a,h:n}=pe({x:"number",y:"number",h:"number",w:"number"}).assert(t),l=(p,_)=>`(${p.toFixed(2)}, ${_.toFixed(2)})`;switch(o){case"fr":return`Boîte de ${l(s,r)} à ${l(s+a,r+n)}`;default:return`Box from ${l(s,r)} to ${l(s+a,r+n)}`}}case"float":case"integer":return Intl.NumberFormat(o).format(pe("number").assert(t));default:return t.toString()}}function xt({language:o,type:e,options:t=[],tolerances:i={date:"day",float:1}}){const s=a=>it(a,i.float),r=a=>wt(o,{type:e},a,t.find(n=>n.key===a)?.label);return a=>Fe(e,a,{boolean:r,string:r,enum:r,integer:n=>r(s(n)),float:n=>r(s(n)),boundingbox:n=>r(xe(n,s)),location:n=>r(xe(n,s)),date:n=>{switch(i.date){case"year":return`Année ${St(n)}`;case"month":return Re(n,"MMMM yyyy");case"day":return new Intl.DateTimeFormat(o,{dateStyle:"long"}).format(n);case"hour":return new Intl.DateTimeFormat(o,{year:"numeric",month:"long",day:"numeric",hour:"numeric"}).format(n);case"minute":return new Intl.DateTimeFormat(o,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}).format(n);case"second":return new Intl.DateTimeFormat(o,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}).format(n);default:throw new Error(`Invalid date tolerance: ${i.date} (expected year, month, day, hour, minute or second)`)}}})}function Et({type:o,options:e=[]}){return(t,i)=>Fe(o,[t,i],{boolean:(s,r)=>Number(s)-Number(r),integer:(s,r)=>s-r,float:(s,r)=>s-r,date:(s,r)=>ht(new Date(s),new Date(r)),string:(s,r)=>s.localeCompare(r),location:(s,r)=>s.latitude-r.latitude||s.longitude-r.longitude,boundingbox:(s,r)=>s.x-r.x||s.y-r.y||s.w-r.w||s.h-r.h,enum:(s,r)=>{const a=e.find(l=>l.key===s),n=e.find(l=>l.key===r);return a?.index!==void 0&&n?.index!==void 0?a.index-n.index:a?-1:n?1:s.toString().localeCompare(r.toString())}})}function Tt({metadata:o,options:e=[]}){const t=Et({type:o.type,options:e});return(i,s)=>{const r=i.metadata[o.id]?.value??null,a=s.metadata[o.id]?.value??null;return r===null&&a===null?0:r===null?-1:a===null?1:t(r,a)}}class At{constructor(){this._listeners=new Map,this.on=this.addEventListener,this.off=this.removeEventListener,this.emit=this.dispatchEvent}addEventListener(e,t){const i=this._listeners.get(e)??new Set;return this._listeners.set(e,i),i.add(t),this}removeEventListener(e,t){var i;return(i=this._listeners.get(e))==null||i.delete(t),this}dispatchEvent(e,...t){let i=!0;for(const s of this._listeners.get(e)??[])i=s(...t)!==!1&&i;return i}unbindAllListeners(){this._listeners.clear()}}const Ee=(o,e="px")=>typeof o=="number"?o+e:o,K=({style:o},e,t)=>{if(typeof e=="object")for(const[i,s]of Object.entries(e))s!==void 0&&(o[i]=Ee(s));else t!==void 0&&(o[e]=Ee(t))},Te=(o=0,e=0,t=0,i=0)=>{const s={x:o,y:e,width:t,height:i,top:e,left:o,right:o+t,bottom:e+i};return{...s,toJSON:()=>JSON.stringify(s)}},Mt=o=>{let e,t=-1,i=!1;return{next:(...s)=>{e=s,i||(i=!0,t=requestAnimationFrame(()=>{o(...e),i=!1}))},cancel:()=>{cancelAnimationFrame(t),i=!1}}},Ae=(o,e,t="touch")=>{switch(t){case"center":{const i=e.left+e.width/2,s=e.top+e.height/2;return i>=o.left&&i<=o.right&&s>=o.top&&s<=o.bottom}case"cover":return e.left>=o.left&&e.top>=o.top&&e.right<=o.right&&e.bottom<=o.bottom;case"touch":return o.right>=e.left&&o.left<=e.right&&o.bottom>=e.top&&o.top<=e.bottom}},Lt=()=>matchMedia("(hover: none), (pointer: coarse)").matches,Ct=()=>"safari"in window,_e=o=>Array.isArray(o)?o:[o],Ke=o=>(e,t,i,s={})=>{(e instanceof HTMLCollection||e instanceof NodeList)&&(e=Array.from(e)),t=_e(t),e=_e(e);for(const r of e)if(r)for(const a of t)r[o](a,i,{capture:!1,...s})},P=Ke("addEventListener"),C=Ke("removeEventListener"),ae=o=>{var e;const{clientX:t,clientY:i,target:s}=((e=o.touches)==null?void 0:e[0])??o;return{x:t,y:i,target:s}},G=(o,e=document)=>_e(o).map(t=>typeof t=="string"?Array.from(e.querySelectorAll(t)):t instanceof Element?t:null).flat().filter(Boolean),kt=(o,e)=>e.some(t=>typeof t=="number"?o.button===t:typeof t=="object"?t.button!==o.button?!1:t.modifiers.every(i=>{switch(i){case"alt":return o.altKey;case"ctrl":return o.ctrlKey||o.metaKey;case"shift":return o.shiftKey}}):!1),{abs:z,max:Me,min:Le,ceil:Ce}=Math,ke=(o=[])=>({stored:o,selected:[],touched:[],changed:{added:[],removed:[]}}),Pe=class extends At{constructor(e){var t,i,s,r,a;super(),this._selection=ke(),this._targetBoundaryScrolled=!0,this._selectables=[],this._areaLocation={y1:0,x2:0,y2:0,x1:0},this._areaRect=Te(),this._singleClick=!0,this._scrollAvailable=!0,this._scrollingActive=!1,this._scrollSpeed={x:0,y:0},this._scrollDelta={x:0,y:0},this._lastMousePosition={x:0,y:0},this.enable=this._toggleStartEvents,this.disable=this._toggleStartEvents.bind(this,!1),this._options={selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,startAreas:["html"],boundaries:["html"],container:"body",...e,behaviour:{overlap:"invert",intersect:"touch",triggers:[0],...e.behaviour,startThreshold:(t=e.behaviour)!=null&&t.startThreshold?typeof e.behaviour.startThreshold=="number"?e.behaviour.startThreshold:{x:10,y:10,...e.behaviour.startThreshold}:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,...(i=e.behaviour)==null?void 0:i.scrolling,startScrollMargins:{x:0,y:0,...(r=(s=e.behaviour)==null?void 0:s.scrolling)==null?void 0:r.startScrollMargins}}},features:{range:!0,touch:!0,deselectOnBlur:!1,...e.features,singleTap:{allow:!0,intersect:"native",...(a=e.features)==null?void 0:a.singleTap}}};for(const _ of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))typeof this[_]=="function"&&(this[_]=this[_].bind(this));const{document:n,selectionAreaClass:l,selectionContainerClass:p}=this._options;this._area=n.createElement("div"),this._clippingElement=n.createElement("div"),this._clippingElement.appendChild(this._area),this._area.classList.add(l),p&&this._clippingElement.classList.add(p),K(this._area,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),K(this._clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this._frame=Mt(_=>{this._recalculateSelectionAreaRect(),this._updateElementSelection(),this._emitEvent("move",_),this._redrawSelectionArea()}),this.enable()}_toggleStartEvents(e=!0){const{document:t,features:i}=this._options,s=e?P:C;s(t,"mousedown",this._onTapStart),i.touch&&s(t,"touchstart",this._onTapStart,{passive:!1})}_onTapStart(e,t=!1){const{x:i,y:s,target:r}=ae(e),{document:a,startAreas:n,boundaries:l,features:p,behaviour:_}=this._options,u=r.getBoundingClientRect();if(e instanceof MouseEvent&&!kt(e,_.triggers))return;const w=G(n,a),x=G(l,a);this._targetElement=x.find(k=>Ae(k.getBoundingClientRect(),u));const v=e.composedPath(),m=w.find(k=>v.includes(k));if(this._targetBoundary=x.find(k=>v.includes(k)),!this._targetElement||!m||!this._targetBoundary||!t&&this._emitEvent("beforestart",e)===!1)return;this._areaLocation={x1:i,y1:s,x2:0,y2:0};const f=a.scrollingElement??a.body;this._scrollDelta={x:f.scrollLeft,y:f.scrollTop},this._singleClick=!0,this.clearSelection(!1,!0),P(a,["touchmove","mousemove"],this._delayedTapMove,{passive:!1}),P(a,["mouseup","touchcancel","touchend"],this._onTapStop),P(a,"scroll",this._onScroll),p.deselectOnBlur&&(this._targetBoundaryScrolled=!1,P(this._targetBoundary,"scroll",this._onStartAreaScroll))}_onSingleTap(e){const{singleTap:{intersect:t},range:i}=this._options.features,s=ae(e);let r;if(t==="native")r=s.target;else if(t==="touch"){this.resolveSelectables();const{x:n,y:l}=s;r=this._selectables.find(p=>{const{right:_,left:u,top:w,bottom:x}=p.getBoundingClientRect();return n<_&&n>u&&l<x&&l>w})}if(!r)return;for(this.resolveSelectables();!this._selectables.includes(r);)if(r.parentElement)r=r.parentElement;else{this._targetBoundaryScrolled||this.clearSelection();return}const{stored:a}=this._selection;if(this._emitEvent("start",e),e.shiftKey&&i&&this._latestElement){const n=this._latestElement,[l,p]=n.compareDocumentPosition(r)&4?[r,n]:[n,r],_=[...this._selectables.filter(u=>u.compareDocumentPosition(l)&4&&u.compareDocumentPosition(p)&2),l,p];this.select(_),this._latestElement=n}else a.includes(r)&&(a.length===1||e.ctrlKey||a.every(n=>this._selection.stored.includes(n)))?this.deselect(r):(this.select(r),this._latestElement=r)}_delayedTapMove(e){const{container:t,document:i,behaviour:{startThreshold:s}}=this._options,{x1:r,y1:a}=this._areaLocation,{x:n,y:l}=ae(e);if(typeof s=="number"&&z(n+l-(r+a))>=s||typeof s=="object"&&z(n-r)>=s.x||z(l-a)>=s.y){if(C(i,["mousemove","touchmove"],this._delayedTapMove,{passive:!1}),this._emitEvent("beforedrag",e)===!1){C(i,["mouseup","touchcancel","touchend"],this._onTapStop);return}P(i,["mousemove","touchmove"],this._onTapMove,{passive:!1}),K(this._area,"display","block"),G(t,i)[0].appendChild(this._clippingElement),this.resolveSelectables(),this._singleClick=!1,this._targetRect=this._targetElement.getBoundingClientRect(),this._scrollAvailable=this._targetElement.scrollHeight!==this._targetElement.clientHeight||this._targetElement.scrollWidth!==this._targetElement.clientWidth,this._scrollAvailable&&(P(this._targetElement,"wheel",this._wheelScroll,{passive:!1}),P(this._options.document,"keydown",this._keyboardScroll,{passive:!1}),this._selectables=this._selectables.filter(p=>this._targetElement.contains(p))),this._setupSelectionArea(),this._emitEvent("start",e),this._onTapMove(e)}this._handleMoveEvent(e)}_setupSelectionArea(){const{_clippingElement:e,_targetElement:t,_area:i}=this,s=this._targetRect=t.getBoundingClientRect();this._scrollAvailable?(K(e,{top:s.top,left:s.left,width:s.width,height:s.height}),K(i,{marginTop:-s.top,marginLeft:-s.left})):(K(e,{top:0,left:0,width:"100%",height:"100%"}),K(i,{marginTop:0,marginLeft:0}))}_onTapMove(e){const{_scrollSpeed:t,_areaLocation:i,_options:s,_frame:r}=this,{speedDivider:a}=s.behaviour.scrolling,n=this._targetElement,{x:l,y:p}=ae(e);if(i.x2=l,i.y2=p,this._lastMousePosition.x=l,this._lastMousePosition.y=p,this._scrollAvailable&&!this._scrollingActive&&(t.y||t.x)){this._scrollingActive=!0;const _=()=>{if(!t.x&&!t.y){this._scrollingActive=!1;return}const{scrollTop:u,scrollLeft:w}=n;t.y&&(n.scrollTop+=Ce(t.y/a),i.y1-=n.scrollTop-u),t.x&&(n.scrollLeft+=Ce(t.x/a),i.x1-=n.scrollLeft-w),r.next(e),requestAnimationFrame(_)};requestAnimationFrame(_)}else r.next(e);this._handleMoveEvent(e)}_handleMoveEvent(e){const{features:t}=this._options;(t.touch&&Lt()||this._scrollAvailable&&Ct())&&e.preventDefault()}_onScroll(){const{_scrollDelta:e,_options:{document:t}}=this,{scrollTop:i,scrollLeft:s}=t.scrollingElement??t.body;this._areaLocation.x1+=e.x-s,this._areaLocation.y1+=e.y-i,e.x=s,e.y=i,this._setupSelectionArea(),this._frame.next(null)}_onStartAreaScroll(){this._targetBoundaryScrolled=!0,C(this._targetElement,"scroll",this._onStartAreaScroll)}_wheelScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,i=e.deltaY?e.deltaY>0?1:-1:0,s=e.deltaX?e.deltaX>0?1:-1:0;this._scrollSpeed.y+=i*t,this._scrollSpeed.x+=s*t,this._onTapMove(e),e.preventDefault()}_keyboardScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,i=e.key==="ArrowLeft"?-1:e.key==="ArrowRight"?1:0,s=e.key==="ArrowUp"?-1:e.key==="ArrowDown"?1:0;this._scrollSpeed.x+=Math.sign(i)*t,this._scrollSpeed.y+=Math.sign(s)*t,e.preventDefault(),this._onTapMove({clientX:this._lastMousePosition.x,clientY:this._lastMousePosition.y,preventDefault:()=>{}})}_recalculateSelectionAreaRect(){const{_scrollSpeed:e,_areaLocation:t,_targetElement:i,_options:s}=this,{scrollTop:r,scrollHeight:a,clientHeight:n,scrollLeft:l,scrollWidth:p,clientWidth:_}=i,u=this._targetRect,{x1:w,y1:x}=t;let{x2:v,y2:m}=t;const{behaviour:{scrolling:{startScrollMargins:f}}}=s;v<u.left+f.x?(e.x=l?-z(u.left-v+f.x):0,v=v<u.left?u.left:v):v>u.right-f.x?(e.x=p-l-_?z(u.left+u.width-v-f.x):0,v=v>u.right?u.right:v):e.x=0,m<u.top+f.y?(e.y=r?-z(u.top-m+f.y):0,m=m<u.top?u.top:m):m>u.bottom-f.y?(e.y=a-r-n?z(u.top+u.height-m-f.y):0,m=m>u.bottom?u.bottom:m):e.y=0;const k=Le(w,v),Z=Le(x,m),ue=Me(w,v),c=Me(x,m);this._areaRect=Te(k,Z,ue-k,c-Z)}_redrawSelectionArea(){const{x:e,y:t,width:i,height:s}=this._areaRect,{style:r}=this._area;r.left=`${e}px`,r.top=`${t}px`,r.width=`${i}px`,r.height=`${s}px`}_onTapStop(e,t){var i;const{document:s,features:r}=this._options,{_singleClick:a}=this;C(this._targetElement,"scroll",this._onStartAreaScroll),C(s,["mousemove","touchmove"],this._delayedTapMove),C(s,["touchmove","mousemove"],this._onTapMove),C(s,["mouseup","touchcancel","touchend"],this._onTapStop),C(s,"scroll",this._onScroll),this._keepSelection(),e&&a&&r.singleTap.allow?this._onSingleTap(e):!a&&!t&&(this._updateElementSelection(),this._emitEvent("stop",e)),this._scrollSpeed.x=0,this._scrollSpeed.y=0,C(this._targetElement,"wheel",this._wheelScroll,{passive:!0}),C(this._options.document,"keydown",this._keyboardScroll,{passive:!0}),this._clippingElement.remove(),(i=this._frame)==null||i.cancel(),K(this._area,"display","none")}_updateElementSelection(){const{_selectables:e,_options:t,_selection:i,_areaRect:s}=this,{stored:r,selected:a,touched:n}=i,{intersect:l,overlap:p}=t.behaviour,_=p==="invert",u=[],w=[],x=[];for(let m=0;m<e.length;m++){const f=e[m];if(Ae(s,f.getBoundingClientRect(),l)){if(a.includes(f))r.includes(f)&&!n.includes(f)&&n.push(f);else if(_&&r.includes(f)){x.push(f);continue}else w.push(f);u.push(f)}}_&&w.push(...r.filter(m=>!a.includes(m)));const v=p==="keep";for(let m=0;m<a.length;m++){const f=a[m];!u.includes(f)&&!(v&&r.includes(f))&&x.push(f)}i.selected=u,i.changed={added:w,removed:x},this._latestElement=void 0}_emitEvent(e,t){return this.emit(e,{event:t,store:this._selection,selection:this})}_keepSelection(){const{_options:e,_selection:t}=this,{selected:i,changed:s,touched:r,stored:a}=t,n=i.filter(l=>!a.includes(l));switch(e.behaviour.overlap){case"drop":{t.stored=[...n,...a.filter(l=>!r.includes(l))];break}case"invert":{t.stored=[...n,...a.filter(l=>!s.removed.includes(l))];break}case"keep":{t.stored=[...a,...i.filter(l=>!a.includes(l))];break}}}trigger(e,t=!0){this._onTapStart(e,t)}resolveSelectables(){this._selectables=G(this._options.selectables,this._options.document)}clearSelection(e=!0,t=!1){const{selected:i,stored:s,changed:r}=this._selection;r.added=[],r.removed.push(...i,...e?s:[]),t||(this._emitEvent("move",null),this._emitEvent("stop",null)),this._selection=ke(e?[]:s)}getSelection(){return this._selection.stored}getSelectionArea(){return this._area}getSelectables(){return this._selectables}setAreaLocation(e){Object.assign(this._areaLocation,e),this._redrawSelectionArea()}getAreaLocation(){return this._areaLocation}cancel(e=!1){this._onTapStop(null,!e)}destroy(){this.cancel(),this.disable(),this._clippingElement.remove(),super.unbindAllListeners()}select(e,t=!1){const{changed:i,selected:s,stored:r}=this._selection,a=G(e,this._options.document).filter(n=>!s.includes(n)&&!r.includes(n));return r.push(...a),s.push(...a),i.added.push(...a),i.removed=[],this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)),a}deselect(e,t=!1){const{selected:i,stored:s,changed:r}=this._selection,a=G(e,this._options.document).filter(n=>i.includes(n)||s.includes(n));this._selection.stored=s.filter(n=>!a.includes(n)),this._selection.selected=i.filter(n=>!a.includes(n)),this._selection.changed.added=[],this._selection.changed.removed.push(...a.filter(n=>!r.removed.includes(n))),this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null))}};Pe.version="3.9.0";let It=Pe;class Dt{imagesContainer;#t=le(He([]));get selection(){return d(this.#t)}set selection(e){ce(this.#t,e,!0)}#e;shiftSelectionAnchor;setSelection(e){if(!this.#e)return;const t=e.map(s=>this.imagesContainer?.querySelector(`[data-selectable][data-id="${s}"]`)).filter(s=>s!=null);this.#e.clearSelection(!0,!0);const i=this.#e.select(t,!0);return this.selection=i.map(s=>s.dataset.id).filter(s=>s!==void 0),i}refreshSelectables(){this.#e&&this.#e.resolveSelectables()}destroy(){this.#e?.destroy()}constructor(e,t=[],{ondeadclick:i}={}){if(this.selection=t,this.imagesContainer=e,!this.imagesContainer)return;const s=this.imagesContainer.parentElement??this.imagesContainer;this.#e=new It({selectables:"[data-selectable]",boundaries:s,startAreas:s,selectionAreaClass:"viselect-selection-area",behaviour:{overlap:"keep"},features:{deselectOnBlur:!0}}),this.#e.on("start",({event:r})=>{r&&!r.ctrlKey&&!r.metaKey&&!r.shiftKey&&(this.selection=[])}),this.#e.on("move",({store:{changed:r}})=>{const a=Ie(r.removed),n=Ie(r.added);this.selection=[...this.selection.filter(l=>!a.includes(l)),...n]}),this.#e.on("stop",({event:r,store:{changed:a}})=>{a.added.length>0||a.removed.length>0||i?.(r)})}}function Ie(o){return o.filter(e=>e instanceof HTMLElement).map(e=>e.dataset.id).filter(ot)}async function Bt(o){const e=t=>nt(o.direction,t);switch(o.field){case"id":return e(de("id"));case"name":return e(de(t=>t.name));case"metadataConfidence":{if(!o.metadata)throw new Error("Tried to sort by metadata confidence without specifying metadata ID");return e(de(t=>t.metadata?.[o.metadata]?.confidence??0))}case"metadataValue":{if(!o.metadata)throw new Error("Tried to sort by metadata value without specifying metadata ID");const t=De(o.metadata);if(!t.namespace)throw new Error(`Tried to sort by metadata value with non-namespaced metadata ID ${JSON.stringify(o.metadata)}`);return e(Tt({metadata:await Oe.Metadata.getOrThrow(o.metadata),options:await Be("MetadataOption",$e(t.namespace,t.id))}))}}}async function Ot(o){if(o.field==="none")return null;if(!o.metadata)throw new Error(`tried to group by ${o.field} without specifying metadata ID`);const e=await Oe.Metadata.getOrThrow(o.metadata),t=e.label||ct(e.id);switch(o.field){case"metadataPresence":return i=>i.metadata[o.metadata]!==void 0?[0,`Avec ${t}`]:[1,`Sans ${t}`];case"metadataConfidence":return i=>{const s=i.metadata[o.metadata]?.confidence;return s>=.75?[0,`${t}: confiance à 75%-100%`]:s>=.5?[1,`${t}: confiance à 50%-75%`]:s>=.25?[2,`${t}: confiance à 25%-50%`]:s!==void 0?[3,`${t}: confiance à 0%-25%`]:[4,`Sans ${t}`]};case"metadataValue":{const i=De(o.metadata);if(!i.namespace)throw new Error(`Tried to group by metadata value with non-namespaced metadata ID ${JSON.stringify(o.metadata)}`);const s=await Be("MetadataOption",$e(i.namespace,i.id)),r=xt({type:e.type,language:mt().language,options:s});return a=>{const n=a.metadata[o.metadata]?.value;if(n===void 0)return[s.length,`Sans ${t}`];const l=r(n);return[s.find(p=>p.key===n)?.index??l,`${t} = ${l}`]}}}}function Rt(o,e){let t=null;function i(r={}){s(),t=new MutationObserver(a=>{a.forEach(n=>r[`on${n.type}`]?.(n))}),t.observe(o,r)}function s(){t?.disconnect(),t=null}return i(e),{update:i,destroy:s}}function $t(o,e){let t=null;function i(r={}){s(),t=new ResizeObserver((a,n)=>{r.onresize?.(a,n)}),t.observe(o)}function s(){t?.disconnect(),t=null}return i(e),{update:i,destroy:s}}var Ft=N('<header class="svelte-1rb1ldh"><h2 class="svelte-1rb1ldh"> </h2> <p class="svelte-1rb1ldh"> </p> <div class="actions svelte-1rb1ldh"><!></div></header>'),Kt=N("<div><!></div>"),Pt=N("<div><!></div> <!>",1),Nt=N('<section class="group svelte-1rb1ldh" role="region"><!> <div class="items svelte-1rb1ldh"></div></section>'),qt=N('<div class="groups"></div>'),Ht=N('<div class="loading svelte-1rb1ldh"><!> <p> </p></div>'),jt=N('<div class="debug svelte-1rb1ldh"><code> <br/> selection <!> <br/> queued <!> <br/> loading <!> <br/> errored <!> <br/> preview urls <!> <br/></code></div>'),zt=N('<section class="images svelte-1rb1ldh" data-testid="observations-area"><!> <!></section>');function gs(o,e){je(e,!0);let t=We(e,"unroll",19,()=>["",[]]);const i=M(()=>Xe(t(),2)),s=M(()=>d(i)[0]),r=M(()=>d(i)[1]);let a=le(void 0),n;qe(()=>{if(d(a))return n?.destroy(),n=new Dt(d(a),S.selection,{ondeadclick:e.onemptyclick}),n.setSelection(S.selection),S.setSelection=c=>{if(!n){console.error("dragselect not initialized");return}n.setSelection(c)},()=>{n?.destroy(),S.setSelection=void 0}}),me(()=>{S.selection=[...new Set(n?.selection??[])]});const l=M(()=>Ze("main"));_t("observations",{"$mod+a":{help:d(l)(169),when:({target:c})=>!(c instanceof HTMLInputElement),do:()=>{n?.setSelection(e.items.map(c=>c.id))}},"$mod+d":{help:d(l)(168),when:({target:c})=>!(c instanceof HTMLInputElement),do:()=>{S.selection=[],n?.setSelection([])}}});function p({id:c,virtual:h=!1}){return h?`${c}_virtual`:c}me(()=>{const c=d(a)?.querySelector(`[data-id="${e.highlight}"]`);c&&(c.style.scrollMarginTop="10vh",c.scrollIntoView({behavior:"instant",block:"start",inline:"nearest"}))});let _=le(void 0),u=le(void 0);me(()=>{if(!S.currentSession)return;const c=S.currentSession.group[e.zone]??S.currentSession.group.global,h=S.currentSession.sort[e.zone]??S.currentSession.sort.global;(async()=>(ce(u,await Bt(h),!0),ce(_,await Ot(c),!0)))()});const w=M(()=>{if(d(_)===void 0||d(u)===void 0)return;const c={};if(d(_))for(const h of e.items){const[g,y]=d(_)(h);c[y]??={items:[],sortKey:g},c[y].items.push(h)}else c[""]={items:e.items,sortKey:0};return at(c).map(([h,{items:g,sortKey:y}])=>({label:h,sortKey:y,items:g.sort(d(u))})).sort(de(({sortKey:h})=>h))});function x(){const h=[...[...d(a)?.querySelectorAll(".item-unroll-container.unrolled")??[]]].map(g=>g.getBoundingClientRect());d(a)?.querySelectorAll(".item-unroll-container.unrolled").forEach(g=>{if(!(g instanceof HTMLElement))return;const y=g.getBoundingClientRect(),I=h.filter(({y:b})=>b===y.y),O=h.filter(({x:b})=>b===y.x);g.dataset.roundCornerTop=O.every(({y:b})=>b>=y.y).toString(),g.dataset.roundCornerBottom=O.every(({y:b})=>b<=y.y).toString(),g.dataset.roundCornerLeft=I.every(({x:b})=>b>=y.x).toString(),g.dataset.roundCornerRight=I.every(({x:b})=>b<=y.x).toString()})}var v=zt(),m=A(v);{var f=c=>{var h=qt();fe(h,21,()=>d(w),({label:g,items:y,sortKey:I})=>I,(g,y,I,O)=>{let b=()=>d(y).label,V=()=>d(y).items;var Y=Nt(),R=A(Y);{var q=D=>{var T=Ft(),H=A(T),te=A(H,!0);E(H);var $=L(H,2),se=A($,!0);E($);var re=L($,2),he=A(re);{const J=F=>{st(F,{})};let W=M(()=>d(l)(354));rt(he,{dangerous:!0,get help(){return d(W)},onclick:async()=>{await dt(["Image","Observation","ImageFile","ImagePreviewFile"],{},async F=>{for(const{id:X}of V())vt(X,"Cancelled by user"),await yt(X,{notFoundOk:!0,recursive:!0}),await pt(X,F,!0)})},_w_snippet_0:J,children:(F,X)=>{{let U=M(()=>[J]),ie=M(()=>d(l).c(15));bt(F,{get t(){return d(U)},get x(){return d(ie)}})}},$$slots:{_w_snippet_0:!0,default:!0}})}E(re),E(T),j(J=>{Q(te,b()),Q(se,J)},[()=>ut(V().length,d(l).p(344),d(l)._.p)]),B(D,T)};ne(R,D=>{b()&&D(q)})}var ee=L(R,2);fe(ee,21,V,D=>p(D),(D,T)=>{const H=M(()=>d(s)===d(T).id);var te=Pt(),$=ge(te);let se;var re=A($);be(re,()=>e.item,()=>d(T).data,()=>d(T)),E($);var he=L($,2);{var J=W=>{var F=Ve(),X=ge(F);fe(X,17,()=>d(r),U=>p(U),(U,ie)=>{var oe=Kt();let ve;var Ne=A(oe);be(Ne,()=>e.item,()=>d(ie).data,()=>d(ie)),E(oe),j(()=>ve=we(oe,1,"item-unroll-container svelte-1rb1ldh",null,ve,{unrolled:d(H)})),B(U,oe)}),B(W,F)};ne(he,W=>{d(H)&&W(J)})}j(()=>se=we($,1,"item-unroll-container svelte-1rb1ldh",null,se,{unrolled:d(H)})),B(D,te)}),E(ee),E(Y),j(()=>et(Y,"aria-label",b())),B(g,Y)}),E(h),Ue(1,h,()=>Qe,()=>({duration:200})),B(c,h)},k=c=>{var h=Ht(),g=A(h);gt(g,{loading:!0});var y=L(g,2),I=A(y,!0);E(y),E(h),j(O=>Q(I,O),[()=>d(l)(436)]),B(c,h)};ne(m,c=>{d(w)?c(f):c(k,!1)})}var Z=L(m,2);{var ue=c=>{var h=jt();{const R=(q,ee=Ye)=>{ye();var D=Je();j(T=>Q(D,`{
				${T??""}
				}`),[()=>[...Ge(ee())].map(T=>(T.length>10?"…":"")+T.slice(-10)).join(" ")]),B(q,D)};var g=A(h),y=A(g),I=L(y,3);R(I,()=>S.selection);var O=L(I,4);R(O,()=>S.queuedImages);var b=L(O,4);R(b,()=>S.loadingImages);var V=L(b,4);{let q=M(()=>S.erroredImages.keys());R(V,()=>d(q))}var Y=L(V,4);{let q=M(()=>S.previewURLs.keys());R(Y,()=>d(q))}ye(2),E(g),E(h),j(()=>Q(y,`session ${S.currentSessionId??""} `))}B(c,h)};ne(Z,c=>{ft()&&e.items.length>0&&c(ue)})}E(v),tt(v,c=>ce(a,c),()=>d(a)),Se(v,(c,h)=>$t?.(c,h),()=>({onresize(){x()}})),Se(v,(c,h)=>Rt?.(c,h),()=>({childList:!0,subtree:!0,onchildList(){d(a)&&(n?.refreshSelectables(),n?.setSelection(S.selection),x())}})),B(o,v),ze()}export{gs as A};
