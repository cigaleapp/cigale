import"./DsnmJJEf.js";import{a as G,b as J,c as Q,s as X}from"./CoW7fDOc.js";import{f as Y,a as C,p as Z,I as T,ai as v,b as tt,al as L,g as t,aj as at,u as n,ak as c,K as p,aH as et,H as st}from"./Dt6m180S.js";import{e as ot,s as rt}from"./BqMK6M8M.js";import{s as it}from"./BEu91mT_.js";import{c as nt}from"./BptB6vFW.js";import{a as lt,t as U,f as dt}from"./DM93I2Od.js";import{e as pt}from"./CTlA2v4V.js";import{V as mt}from"./CQZlWxvG.js";import{A as ct}from"./DkZwE8qq.js";import{B as I,C as ut}from"./BAG1AaOD.js";import{D as vt}from"./C0se_-sl.js";import{r as ft}from"./cmrSGx3m.js";import{i as V}from"./CyxF7S3o.js";import{p as l}from"./BQgdUy12.js";import{d as q,m as ht,r as z,s as _t,e as gt}from"./h9n_zjAt.js";import{I as H}from"./DRBqBfVL.js";import{g as O,r as bt}from"./CoCzgeuV.js";import{s as jt}from"./C0SiBqD8.js";var wt=Y('<svg><path fill="currentColor" d="m18.031 16.617l4.283 4.282l-1.415 1.415l-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9s9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617m-2.006-.742A6.98 6.98 0 0 0 18 11c0-3.867-3.133-7-7-7s-7 3.133-7 7s3.133 7 7 7a6.98 6.98 0 0 0 4.875-1.975z"></path></svg>');function yt(d,s){const r=ft(s,["$$slots","$$events","$$legacy"]);var m=wt();G(m,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...r})),C(d,m)}async function $t(d,s){const r=l.data.options??[],m=structuredClone(r.find(f=>f.key===d));if(!m)throw pt(404,`Option avec clé ${d} introuvable`);l.data.options=r.filter(f=>f.key!==d);const u=l.route.id==="/(app)/protocols/[id]/metadata/[metadata]/options/[option]"&&l.params.option===d;u&&await O("/(app)/protocols/[id]/metadata/[metadata]/options",{id:l.params.id??"",metadata:l.params.metadata??""}),U.withUndo("info",`Option ${s||d} supprimée`,{async commit(){await ht("MetadataOption",m.id)},async undo(){await V(q("Metadata",l.data.metadata.id,"options")),u&&await O("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:l.params.id??"",metadata:l.params.metadata??"",option:d})}})}var kt=T('<div><a class="svelte-puhjjd"> </a> <div class="delete svelte-puhjjd"><!></div></div>'),It=T('<div class="aside-and-main svelte-puhjjd"><aside class="svelte-puhjjd"><search class="svelte-puhjjd"><!> <!> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper></search> <form class="new-option svelte-puhjjd"><!> <!></form> <nav class="svelte-puhjjd"><!></nav></aside> <div class="content svelte-puhjjd"><!></div></div>');function Wt(d,s){Z(s,!0);const r=n(()=>J("main"));let m=n(()=>l.data.options??[]),u=at("");const f=n(()=>t(m).filter(e=>[e.key,e.label].some(a=>!t(u)||a.toLowerCase().includes(t(u).toLowerCase()))));async function F(e){e.preventDefault();const a=e.currentTarget.elements.item(0);if(!a?.value)return;let i=jt(a.value).replaceAll("-","_");t(m).find(o=>o.key===i)&&(i+="_"+t(m).filter(o=>o.key.startsWith(i)).length);try{await _t("MetadataOption",{id:`${s.data.metadata.id}:${i}`,metadataId:s.data.metadata.id,key:i,label:a.value,description:""}),a.value="",await V(q("Metadata",s.data.metadata.id,"options")),await O("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:s.data.protocol.id,metadata:z(s.data.metadata.id),option:i})}catch(o){U.error(gt(o,"Impossible de créer l'option"))}}var _=It(),w=c(_),y=c(w),x=c(y);yt(x,{});var M=v(x,2);{let e=n(()=>t(r)(313)),a=n(()=>t(r)(314));H(M,{discreet:!0,get label(){return t(e)},get placeholder(){return t(a)},onblur:()=>{},get value(){return t(u)},set value(i){L(u,i,!0)}})}var $=v(M,2);{let e=n(()=>t(r)(315));nt($,()=>({"--font-size":"0.7em"})),I($.lastChild,{onclick:()=>L(u,""),get help(){return t(e)},children:(a,i)=>{ut(a,{})},$$slots:{default:!0}}),p($)}p(y);var g=v(y,2),A=c(g);{let e=n(()=>t(r)(316)),a=n(()=>t(r)(317));H(A,{discreet:!0,get label(){return t(e)},get placeholder(){return t(a)},value:"",onblur:()=>{}})}var K=v(A,2);{let e=n(()=>t(r)(318));I(K,{submits:!0,get help(){return t(e)},onclick:()=>{},children:(a,i)=>{ct(a,{})},$$slots:{default:!0}})}p(g);var D=v(g,2),N=c(D);mt(N,{get items(){return t(f)},children:et,$$slots:{default:(e,a)=>{const i=n(()=>a.item),o=n(()=>{const{key:h,label:k}=t(i);return{key:h,label:k}});var b=kt();let R;var j=c(b),W=c(j,!0);p(j);var B=v(j,2),E=c(B);{let h=n(()=>t(r)(319,[t(o).label||t(o).key]));I(E,{dangerous:!0,get help(){return t(h)},onclick:async()=>$t(t(o).key,t(o).label),children:(k,Ct)=>{vt(k,{})},$$slots:{default:!0}})}p(B),p(b),st(h=>{R=Q(b,1,"navlink svelte-puhjjd",null,R,{active:l.params.option===t(o).key}),X(j,"href",h),rt(W,t(o).label)},[()=>bt("/(app)/protocols/[id]/metadata/[metadata]/options/[option]",{id:s.data.protocol.id,metadata:z(s.data.metadata.id),option:t(o).key})]),C(e,b)}}}),p(D),p(w);var P=v(w,2),S=c(P);it(S,()=>s.children),p(P),p(_),ot("submit",g,F),lt(1,_,()=>dt,()=>({duration:100})),C(d,_),tt()}export{Wt as _,$t as o};
