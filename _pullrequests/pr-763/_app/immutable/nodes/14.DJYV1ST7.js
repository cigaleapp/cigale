import"../chunks/DsnmJJEf.js";import{p as x,g as r,u as l,b as M,c as C,aa as T,a as I,az as q,ay as p,n as B,r as _,e as Z,d as $}from"../chunks/Bn_ZbADV.js";import{d as ee,e as P,a as U}from"../chunks/C0Q0tU0C.js";import{p as Y,s as te,r as ae,i as D}from"../chunks/dHQvgpC_.js";import{b as G,_ as H,g as J,s as re}from"../chunks/ByTqR5TD.js";import{t as ie,f as se}from"../chunks/D4q3eRn6.js";import{A as ne}from"../chunks/iv_ZmymI.js";import{C as K}from"../chunks/DN3Kp7NE.js";import{i as le,a as oe}from"../chunks/KMAftsCj.js";import{u as d}from"../chunks/C6TF2dQr.js";import{s as de}from"../chunks/D9gih6mG.js";import{p as me}from"../chunks/hFci9Gn4.js";import{t as j}from"../chunks/GdErsj6s.js";import{d as z}from"../chunks/RrsJoApQ.js";import{i as E,A as L,b as R,d as ue}from"../chunks/CMRT31L6.js";import{L as ge}from"../chunks/i04FUm_M.js";import{u as fe}from"../chunks/DvdFYW7d.js";function ce(h,e){x(e,!0);const y=Y(e,"highlighted",3,!1),u=ae(e,["$$slots","$$events","$$legacy","image","highlighted"]),f=l(()=>d.queuedImages.has(e.image.id)?"queued":d.loadingImages.has(e.image.id)?"loading":d.erroredImages.has(e.image.id)?"errored":"ok"),i=l(()=>{if(r(f)==="errored")return d.erroredImages.get(e.image.id);if(le())return`${e.image.id} @ ${e.image.addedAt.toISOString()}`});{let n=l(()=>d.previewURLs.get(e.image.fileId)),g=l(()=>d.selection.includes(e.image.fileId));K(h,te({get id(){return e.image.fileId},get title(){return e.image.filename},get image(){return r(n)},get selected(){return r(g)},boxes:"show-all",get tooltip(){return r(i)},get status(){return r(f)},get highlighted(){return y()}},()=>u))}M()}var ve=C('<input type="file" multiple class="svelte-1n47qnw"/>'),pe=C('<section role="form"><!> <div class="dragging-overlay svelte-1n47qnw"><p> </p></div> <!></section>');function _e(h,e){x(e,!0);const y=l(()=>H(J("main")));let u=Y(e,"dragging",15,!1);function f(t){if(u(!1),!t.dataTransfer)return;t.preventDefault();let s=[];if(t.dataTransfer.items?s=[...t.dataTransfer.items].map(a=>{if(a.kind==="file")return a.getAsFile()}).filter(a=>!!a):s=[...t.dataTransfer.files],e.filetypes&&e.filetypes.length>0&&s.some(a=>!e.filetypes.includes(a.type))){e.onunacceptable?.(s);return}e.onfiles?.({event:t,files:s})}var i=pe();let n;var g=p(i);de(g,()=>e.children??B);var m=q(g,2),b=p(m),w=p(b,!0);_(b),_(m);var F=q(m,2);{var S=t=>{var s=ve();s.__input=a=>{a.currentTarget.files&&e.onfiles?.({event:a,files:[...a.currentTarget.files]})},T(a=>re(s,"accept",a),[()=>e.filetypes?.join(",")]),I(t,s)};D(F,t=>{e.clickable&&t(S)})}_(i),T(t=>{n=G(i,1,"dropzone svelte-1n47qnw",null,n,{dragging:u(),clickable:e.clickable}),U(w,t)},[()=>r(y).t(80)]),P("dragover",i,t=>{t.dataTransfer&&(t.preventDefault(),u(!0))}),P("drop",i,f),I(h,i),M()}ee(["input"]);var he=C('<div class="empty-state svelte-1urkjm2"><!> <p> </p></div>'),ye=C("<section><!> <!></section>");function Ee(h,e){x(e,!0);const y=l(()=>H(J("main"))),u=l(()=>[...fe(j.Image.state.map(({filename:i,id:n,addedAt:g,fileId:m})=>({id:m??n,addedAt:g,name:i,virtual:!1,data:j.Image.getFromState(n)})),i=>i.id),...d.processing.files.map(({name:i,id:n,addedAt:g})=>({id:n,addedAt:g,name:i,virtual:!0,data:null}))]),f=l(()=>r(u).length===0);{let i=l(()=>r(u).length===0);_e(h,{get filetypes(){return L},get clickable(){return r(i)},onfiles:({files:n})=>E(n),children:(n,g)=>{var m=ye();let b;var w=p(m);ne(w,{get items(){return r(u)},get sort(){return oe().gallerySort},onemptyclick:async()=>{d.selection.length>0||E(await me({accept:L,multiple:!0}))},item:(s,a=B,c)=>{let o=()=>c?.().id,A=()=>c?.().name;var O=Z(),N=$(O);{var Q=v=>{{let k=l(()=>({...a(),fileId:a().fileId}));ce(v,{get image(){return r(k)},ondelete:async()=>{R(o(),"Cancelled by user"),d.processing.removeFile(o()),await z(o())}})}},V=v=>{const k=l(()=>d.erroredImages.get(o())),W=l(()=>d.queuedImages.has(o()));{let X=l(()=>r(k)?"errored":r(W)?"queued":"loading");K(v,{get id(){return o()},get title(){return A()},get status(){return r(X)},get tooltip(){return r(k)},image:void 0,ondelete:async()=>{R(o(),"Cancelled by user"),d.processing.removeFile(o()),await ue(o()),await z(o())}})}};D(N,v=>{a()&&a().fileId?v(Q):v(V,!1)})}I(s,O)},$$slots:{item:!0}});var F=q(w,2);{var S=t=>{var s=he(),a=p(s);ge(a,{variant:"empty"});var c=q(a,2),o=p(c,!0);_(c),_(s),T(A=>U(o,A),[()=>r(y).t(67)]),I(t,s)};D(F,t=>{r(f)&&t(S)})}_(m),T(()=>b=G(m,1,"observations svelte-1urkjm2",null,b,{empty:r(f)})),ie(1,m,()=>se,()=>({duration:100})),I(n,m)},$$slots:{default:!0}})}M()}export{Ee as component};
