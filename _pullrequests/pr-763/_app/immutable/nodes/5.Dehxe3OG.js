import{_ as Fe,a as ae,c as ue,b as ne,C as Xe,g as Ge,s as Le}from"../chunks/ByTqR5TD.js";import{j as Je,t as O,d as we,k as Ke,r as fe,u as Qe,n as Ye,e as Ze}from"../chunks/GdErsj6s.js";import{e as et}from"../chunks/BfJSoyxd.js";import{b as tt}from"../chunks/DqO7cyx5.js";import{n as at,b as rt}from"../chunks/DvdFYW7d.js";import"../chunks/DsnmJJEf.js";import{f as ie,a as _,c as I,ay as v,r as c,p as Ne,d as W,g as e,u as s,az as p,b as Re,e as be,a4 as ot,n as pe,aa as R,i as Y,s as _e,ac as st,aD as nt,aA as lt,a9 as it}from"../chunks/Bn_ZbADV.js";import{a as Z,e as dt}from"../chunks/C0Q0tU0C.js";import{s as je}from"../chunks/D9gih6mG.js";import{r as de,i as z}from"../chunks/dHQvgpC_.js";import{e as ct}from"../chunks/WunZNVQx.js";import{c as vt}from"../chunks/C-HhNZ1M.js";import{e as mt}from"../chunks/UkrbtdNH.js";import{a as X,t as G}from"../chunks/DiOkT0aq.js";import{t as j,f as E}from"../chunks/D4q3eRn6.js";import{b as ut}from"../chunks/CoBO7ZM6.js";import{R as he}from"../chunks/DHI2XP9K.js";import{A as Ae}from"../chunks/DiOs4Ftk.js";import{A as ft,e as pt}from"../chunks/CqvX9GtU.js";import{C as _t}from"../chunks/CAxz9a1W.js";import{D as Be}from"../chunks/tQ5xpUhk.js";import{F as ht}from"../chunks/CM8VKlYv.js";import{I as gt}from"../chunks/DJxvkVZ4.js";import{L as $t}from"../chunks/Cqz3Olg7.js";import{M as wt,S as bt}from"../chunks/CpPPl076.js";import{i as xt}from"../chunks/BnUFKmkQ.js";import{g as ee,r as yt,a as Pt}from"../chunks/wr4YUA__.js";import{p as L}from"../chunks/CAILCW9-.js";import{B as te}from"../chunks/DDqzxxyE.js";import{B as ge}from"../chunks/BNxh-1nu.js";import{I as It}from"../chunks/BUH-c0xA.js";import{I as $e}from"../chunks/DhJZr4Fe.js";import{S as kt}from"../chunks/Ddsc_2Ut.js";import{S as Mt}from"../chunks/Dlp6D5Pv.js";import{s as St}from"../chunks/DpetXvIZ.js";import{u as Oe}from"../chunks/C6TF2dQr.js";import{t as le}from"../chunks/CM1wOxol.js";import{u as ze}from"../chunks/BwaoDaF9.js";async function Dt({params:w,depends:n}){const h=Fe(Je("js")),r=await O.Protocol.get(w.id);console.info("Loaded protocol from load function",r),r||et(404,h.t(365,[w.id])),n(we("Protocol",w.id)),r.metadata.map(C=>n(we("Metadata",C)));const{metadataOrder:o}=r;return{...r,metadataDefinitions:await Promise.all(r.metadata.toSorted(tt({metadataOrder:o})).map(async C=>O.Metadata.get(C))).then(C=>C.filter(at))}}const Ra=Object.freeze(Object.defineProperty({__proto__:null,load:Dt},Symbol.toStringTag,{value:"Module"}));var Ct=ie('<svg><path fill="currentColor" d="m4.836 12l6.207 6.207l1.414-1.414L7.664 12l4.793-4.793l-1.414-1.414zm5.65 0l6.207 6.207l1.414-1.414L13.314 12l4.793-4.793l-1.414-1.414z"></path></svg>');function Lt(w,n){const h=de(n,["$$slots","$$events","$$legacy"]);var r=Ct();ae(r,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...h})),_(w,r)}var At=ie('<svg><path fill="currentColor" d="M7.828 11H20v2H7.828l5.364 5.364l-1.414 1.414L4 12l7.778-7.778l1.414 1.414z"></path></svg>');function qe(w,n){const h=de(n,["$$slots","$$events","$$legacy"]);var r=At();ae(r,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...h})),_(w,r)}var Bt=ie('<svg><path fill="currentColor" d="m19.164 12l-6.207-6.207l-1.414 1.414L16.336 12l-4.793 4.793l1.414 1.414zm-5.65 0L7.307 5.793L5.893 7.207L10.686 12l-4.793 4.793l1.414 1.414z"></path></svg>');function Ot(w,n){const h=de(n,["$$slots","$$events","$$legacy"]);var r=Bt();ae(r,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...h})),_(w,r)}var zt=I('<div class="badge svelte-qm4qgq"><!></div>');function qt(w,n){var h=zt(),r=v(h);je(r,()=>n.children),c(h),X(h,(o,C)=>G?.(o,C),()=>n.tooltip),_(w,h)}var Ft=ie('<svg><path fill="currentColor" d="m10.904 2.1l9.9 1.414l1.414 9.9l-9.192 9.192a1 1 0 0 1-1.415 0l-9.9-9.9a1 1 0 0 1 0-1.413zm.707 2.122L3.833 12l8.485 8.485l7.779-7.778l-1.061-7.425zm2.122 6.363a2 2 0 1 1 2.828-2.828a2 2 0 0 1-2.828 2.829"></path></svg>');function Nt(w,n){const h=de(n,["$$slots","$$events","$$legacy"]);var r=Ft();ae(r,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...h})),_(w,r)}var Rt=I("<span><!></span>"),jt=I("<span><!></span>"),Et=I("<span><!></span>"),Ht=I("<!> <!>",1);function Tt(w,n){Ne(n,!0);const h=s(()=>n.metadata.label),r=s(()=>n.metadata.id),o=s(()=>n.metadata.infer);var C=Ht(),J=W(C);{var H=k=>{var m=Rt();ue(m,"",{},{color:"var(--fg-error)"});var q=v(m);kt(q,{}),c(m),X(m,(F,B)=>G?.(F,B),()=>"Métadonnée technique"),_(k,m)};z(J,k=>{e(h)||k(H)})}var re=p(J,2);{var K=k=>{var m=jt();ue(m,"",{},{color:"var(--fg-primary)"});var q=v(m);Mt(q,{}),c(m),X(m,(F,B)=>G?.(F,B),()=>"Inférence par réseau neuronal"),_(k,m)},Q=k=>{var m=be(),q=W(m);{var F=B=>{var A=Et();ue(A,"",{},{color:"var(--fg-primary)"});var T=v(A);Nt(T,{}),c(A),X(A,(oe,se)=>G?.(oe,se),()=>"exif"in e(o)?`Inféré à partir du champ EXIF ${e(o).exif}`:`Inféré à partir des coordonnées GPS EXIF (latitude: ${e(o).latitude.exif}, longitude: ${e(o).longitude.exif})`),_(B,A)};z(q,B=>{e(o)&&("exif"in e(o)||"latitude"in e(o)&&"exif"in e(o).latitude)&&B(F)},!0)}_(k,m)};z(re,k=>{e(r)===n.protocol.crop?.metadata||e(o)&&"neural"in e(o)?k(K):k(Q,!1)})}_(w,C),Re()}var Ut=I('<span class="badge svelte-1efdthw"> </span>'),Vt=I('<div class="menu-icon svelte-1efdthw"><!></div> <!>',1),Wt=I('<header class="svelte-1efdthw"><div class="top-actions svelte-1efdthw"><!> <!></div> <h1 class="svelte-1efdthw"><!></h1> <code class="subtitle svelte-1efdthw"><!></code> <section class="actions svelte-1efdthw"><!> <!></section></header>'),Xt=I('<header class="svelte-1efdthw"><!></header>'),Gt=I('<div class="navlink svelte-1efdthw"><div class="menu-icon svelte-1efdthw"><!></div></div>'),Jt=I('<form class="navlink svelte-1efdthw"><div class="menu-icon standin svelte-1efdthw"></div> <!> <!></form>'),Kt=I('<a><div class="menu-icon svelte-1efdthw"> </div> <div class="datatype-icon svelte-1efdthw"><!></div></a>'),Qt=I('<div class="menu-icon standin svelte-1efdthw"></div> <a class="svelte-1efdthw"> <!></a> <div class="action svelte-1efdthw"><!></div>',1),Yt=I("<div><!></div>"),Zt=I('<div class="sidebar-and-main svelte-1efdthw"><aside><!> <!> <nav class="svelte-1efdthw"><!> <!> <!> <!> <!> <!> <nav class="metadata svelte-1efdthw"></nav></nav> <div class="collapse-toggle"><!></div></aside> <main><!></main></div>');function ja(w,n){Ne(n,!0);const h=(t,a=pe,l=pe,i=pe,d)=>{let g=st(()=>nt(d?.(),void 0));var y=be(),M=W(y);mt(M,()=>l()?"a":"span",!1,(U,V)=>{X(U,($,P)=>G?.($,P),()=>e(m)?{text:a(),placement:"right"}:void 0),ae(U,$=>({href:l()?`#/protocols/${e(o)}/${l()}`:void 0,class:"navlink",[Xe]:$}),[()=>({active:l()&&L.route.id?.includes(`/protocols/[id]/${l()}`)})],void 0,"svelte-1efdthw");var S=Vt(),x=W(S),u=v(x);vt(u,i,($,P)=>{P($,{})}),c(x);var f=p(x),D=p(f);{var b=$=>{var P=Ut(),N=v(P,!0);c(P),R(()=>Z(N,e(g))),_($,P)};z(D,$=>{e(g)!==void 0&&$(b)})}R(()=>Z(f,` ${a()??""} `)),_(V,S)}),_(t,y)},r=s(()=>Fe(Ge("main")));St({title:e(r).t(240,[L.params.id])});let o=s(()=>n.data.id),C=s(()=>n.data.name),J=s(()=>n.data.version),H=s(()=>n.data.metadata),re=s(()=>n.data.metadataDefinitions),K=s(()=>n.data.metadataOrder),Q=_e(void 0),k=_e(null),m=_e(!1);ot("setNavbarAppearance")("hidden");async function q(t){t.preventDefault();const a=t.currentTarget.elements.item(0);if(!a?.value)return;const l=a.value.trim();try{let i=Ye(e(o),rt(l).replaceAll("-","_"));e(H).includes(i)&&(i+=`_${e(H).filter(g=>g.startsWith(i)).length+1}`),await O.Metadata.set({id:i,label:l,description:"",type:"string",mergeMethod:"none",required:!1}),await O.Protocol.update(e(o),"metadata",[i,...e(H)]),e(K)&&await O.Protocol.update(e(o),"metadataOrder",[i,...e(K)]),await xt(we("Protocol",e(o)));const d=fe(i);a.value="",e(k)?.children.item(e(H).length-1)?.scrollIntoView({behavior:"smooth",block:"end"}),le.success(`Métadonnée ${d} créée`),await ee("/(app)/protocols/[id]/metadata/[metadata]/infos",{id:e(o),metadata:d})}catch(i){le.error(Ze(i,"Impossible de créer la métadonnée"))}}async function F(t){const a=structuredClone(e(K)),l=fe(t.id),i=ze((d,g)=>{g==="undo"?(d.metadata.push(t.id),a&&(d.metadataOrder=a)):(d.metadata=d.metadata.filter(y=>y!==t.id),d.metadataOrder&&(d.metadataOrder=d.metadataOrder.filter(y=>y!==t.id)))});await i("remove"),le.withUndo("success",`Métadonnée ${l} supprimée`,{undo:async()=>i("undo"),commit:async()=>O.Metadata.remove(t.id)})}async function B(t,a){if(!t){a(e(o));return}await O.Protocol.update(e(o),"id",t),await O.Protocol.remove(e(o)),Y(o,t),L.route?.id&&await ee(L.route.id,{...L.params,id:t})}var A=Zt(),T=v(A);let oe;var se=v(T);{var Ee=t=>{var a=Wt(),l=v(a),i=v(l);{const u=f=>{qe(f,{})};ge(i,{onclick:()=>ee("/protocols"),_w_snippet_0:u,children:(f,D)=>{{let b=s(()=>[u]),$=s(()=>e(r).cx(241));he(f,{get t(){return e(b)},get x(){return e($)}})}},$$slots:{_w_snippet_0:!0,default:!0}})}var d=p(i,2);{let u=s(()=>e(r).t(242));qt(d,{get tooltip(){return e(u)},children:(f,D)=>{lt();var b=it();R($=>Z(b,$),[()=>e(r).t(243)]),_(f,b)}})}c(l);var g=p(l,2),y=v(g);{let u=s(()=>e(r).t(232)),f=s(()=>ze((D,b)=>{D.name=b}));$e(y,{get label(){return e(u)},discreet:!0,get value(){return e(C)},get onblur(){return e(f)}})}c(g);var M=p(g,2),U=v(M);{let u=s(()=>e(r).t(244));$e(U,{get label(){return e(u)},discreet:!0,get value(){return e(o)},onblur:B})}c(M);var V=p(M,2),S=v(V);{const u=f=>{bt(f,{})};ge(S,{onclick:async()=>{await pt(Ke(),yt("/"),e(o)).catch(f=>le.error(f))},_w_snippet_1:u,children:(f,D)=>{{let b=s(()=>[u]),$=s(()=>e(r).cx(245));he(f,{get t(){return e(b)},get x(){return e($)}})}},$$slots:{_w_snippet_1:!0,default:!0}})}var x=p(S,2);{const u=D=>{Be(D,{})};let f=s(()=>e(o)===Oe.currentProtocolId&&Oe.processing.total>0);ge(x,{dangerous:!0,get disabled(){return e(f)},onclick:()=>e(Q)?.(),_w_snippet_2:u,children:(D,b)=>{{let $=s(()=>[u]),P=s(()=>e(r).cx(15));he(D,{get t(){return e($)},get x(){return e(P)}})}},$$slots:{_w_snippet_2:!0,default:!0}})}c(V),c(a),j(1,a,()=>E),_(t,a)},He=t=>{var a=Xt(),l=v(a);{let i=s(()=>e(r).t(246));te(l,{get help(){return e(i)},tooltipParams:{placement:"right"},onclick:()=>ee("/protocols"),children:(d,g)=>{qe(d,{})},$$slots:{default:!0}})}c(a),j(1,a,()=>E),_(t,a)};z(se,t=>{e(m)?t(He,!1):t(Ee)})}var xe=p(se,2);wt(xe,{get id(){return e(o)},ondelete:()=>ee("/protocols"),get open(){return e(Q)},set open(t){Y(Q,t,!0)}});var ce=p(xe,2),ye=v(ce);h(ye,()=>"Informations",()=>"infos",()=>gt);var Pe=p(ye,2);h(Pe,()=>"Versionnage",()=>"versioning",()=>ft,()=>e(J)?`v${e(J)}`:void 0);var Ie=p(Pe,2);h(Ie,()=>"Exports",()=>"exports",()=>ht);var ke=p(Ie,2);h(ke,()=>"Recadrage",()=>"cropping",()=>_t);var Me=p(ke,2);h(Me,()=>"Métadonnées",()=>"",()=>$t,()=>e(re).length);var Se=p(Me,2);{var Te=t=>{var a=Gt(),l=v(a),i=v(l);{let d=s(()=>e(r).t(247));te(i,{get help(){return e(d)},tooltipParams:{placement:"right"},onclick:()=>Y(m,!1),children:(g,y)=>{Ae(g,{})},$$slots:{default:!0}})}c(l),c(a),j(1,a,()=>E),_(t,a)},Ue=t=>{var a=Jt(),l=p(v(a),2);{let d=s(()=>e(r).t(248));$e(l,{get label(){return e(d)},value:"",discreet:!0,placeholder:{idle:"Nouvelle métadonnée…",focused:"Nom de la métadonnée"},onblur:()=>{}})}var i=p(l,2);{let d=s(()=>e(r).t(249));te(i,{get help(){return e(d)},submits:!0,onclick:()=>{},children:(g,y)=>{Ae(g,{})},$$slots:{default:!0}})}c(a),dt("submit",a,q),j(1,a,()=>E),_(t,a)};z(Se,t=>{e(m)?t(Te):t(Ue,!1)})}var ve=p(Se,2);ct(ve,21,()=>e(re),t=>t.id,(t,a)=>{const l=s(()=>fe(e(a).id)),i=s(()=>e(a).label||e(l)),d=s(()=>Pt(L.route.id?.includes("/protocols/[id]/metadata/[metadata]/")?L.route.id:"/(app)/protocols/[id]/metadata/[metadata]/infos",{...L.params,id:e(o),metadata:e(l)}));var g=Yt();let y;var M=v(g);{var U=S=>{var x=Kt();let u;var f=v(x),D=v(f,!0);c(f);var b=p(f,2),$=v(b);It($,{tooltip:!1,get type(){return e(a).type}}),c(b),c(x),X(x,(P,N)=>G?.(P,N),()=>({text:e(i),placement:"right"})),R((P,N)=>{u=ne(x,1,"navlink svelte-1efdthw",null,u,P),Le(x,"href",e(d)),Z(D,N)},[()=>({active:L.url.hash.includes(`metadata/${e(l)}/`)}),()=>Qe(e(i)).slice(0,2)]),j(1,x,()=>E),_(S,x)},V=S=>{var x=Qt(),u=p(W(x),2),f=v(u),D=p(f);Tt(D,{get metadata(){return e(a)},get protocol(){return n.data}}),c(u);var b=p(u,2),$=v(b);{let P=s(()=>e(r).t(250));te($,{dangerous:!0,get help(){return e(P)},onclick:async()=>F(e(a)),children:(N,ea)=>{Be(N,{})},$$slots:{default:!0}})}c(b),R(()=>{Le(u,"href",e(d)),Z(f,`${(e(a).label||e(l))??""} `)}),j(1,u,()=>E),_(S,x)};z(M,S=>{e(m)?S(U):S(V,!1)})}c(g),R(S=>y=ne(g,1,"navlink svelte-1efdthw",null,y,S),[()=>({active:L.url.hash.includes(`metadata/${e(l)}/`)})]),_(t,g)}),c(ve),ut(ve,t=>Y(k,t),()=>e(k)),c(ce);var De=p(ce,2),Ve=v(De);{let t=s(()=>e(m)?"Déplier":"Replier");te(Ve,{get help(){return e(t)},onclick:()=>{Y(m,!e(m))},children:(a,l)=>{var i=be(),d=W(i);{var g=M=>{Ot(M,{})},y=M=>{Lt(M,{})};z(d,M=>{e(m)?M(g):M(y,!1)})}_(a,i)},$$slots:{default:!0}})}c(De),c(T);var me=p(T,2);let Ce;var We=v(me);je(We,()=>n.children),c(me),c(A),R(t=>{oe=ne(T,1,"svelte-1efdthw",null,oe,{collapsed:e(m)}),Ce=ne(me,1,"svelte-1efdthw",null,Ce,t)},[()=>({padded:!L.route.id?.startsWith("/(app)/protocols/[id]/metadata/")})]),j(1,A,()=>E,()=>({duration:100})),_(w,A),Re()}export{ja as component,Ra as universal};
