import"../chunks/DsnmJJEf.js";import{o as L}from"../chunks/CNplBLUs.js";import{p as M,g as s,u as n,b as z,k as j,c as P,a as y,ay as b,az as w,n as F,r as v,aA as q,a9 as D,aa as S}from"../chunks/Bn_ZbADV.js";import{a as C}from"../chunks/C0Q0tU0C.js";import{p as V,s as R,r as U,i as E}from"../chunks/dHQvgpC_.js";import{c as G}from"../chunks/Ceb8Mi8c.js";import{t as H,f as J}from"../chunks/D4q3eRn6.js";import{_ as K,g as N}from"../chunks/gEdK1vYj.js";import{w as Q}from"../chunks/CwN-qvm4.js";import{A as W}from"../chunks/CcFLdhxa.js";import{B as X}from"../chunks/qfe7ntnt.js";import{t as Y}from"../chunks/DmH6iQKy.js";import{C as Z}from"../chunks/gbEnKnnd.js";import{i as $,a as ee}from"../chunks/CgPNSYEV.js";import{u as t}from"../chunks/C-_QJLm4.js";import{n as x,g as te,a as ae}from"../chunks/DvdFYW7d.js";import{t as O}from"../chunks/BZvTGrCn.js";import{e as re,d as se}from"../chunks/CHjfjsK1.js";import{L as oe}from"../chunks/CvTMilvj.js";import{f as A,b as ie,d as ne}from"../chunks/CvtFKgdo.js";import{g as k}from"../chunks/froF7yrv.js";import{s as le}from"../chunks/BfBY_ALr.js";function me(h,e){M(e,!0);const d=V(e,"highlighted",3,!1),p=U(e,["$$slots","$$events","$$legacy","fileId","images","highlighted"]),l=n(()=>t.queuedImages.has(e.fileId)?"queued":t.loadingImages.has(e.fileId)?"loading":e.images.some(m=>t.erroredImages.has(m.id))?"errored":"ok"),f=n(()=>{if(s(l)==="errored")return e.images.map(({id:m})=>t.erroredImages.get(m)).filter(x).join("; ");if($())return`${e.fileId} @ ${e.images[0]?.addedAt.toISOString()}`});{let m=n(()=>t.previewURLs.get(e.fileId)),I=n(()=>t.selection.includes(e.fileId)),r=n(()=>e.images.map(a=>t.cropMetadataValueOf(a)?.value).filter(x).map(a=>Y(a)));Z(h,R({get id(){return e.fileId},get title(){return e.images[0].filename},get image(){return s(m)},get selected(){return s(I)},boxes:"show-all",get tooltip(){return s(f)},get status(){return s(l)},get highlighted(){return d()}},()=>p,{get boundingBoxes(){return s(r)}}))}z()}var de=P('<div class="empty svelte-zhpjun"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <p> </p> <!></div>'),ge=P('<section class="observations svelte-zhpjun"><!> <!></section>');function Le(h,e){M(e,!0);const d=n(()=>K(N("main")));le({title:s(d).t(154)});const p=n(()=>[...te(O.Image.state,r=>r.fileId??"").entries()].map(([r,a])=>({id:r,addedAt:new Date(ae(a.map(i=>i.addedAt.getTime()))),name:a[0].filename,virtual:!1,data:a})));j(()=>{t.imageOpenedInCropper=""}),L(()=>{A(O.Image.state.map(({fileId:r})=>r).filter(x).filter(r=>!re(t.currentProtocol,r)))}),Q(()=>t.imagePreviouslyOpenedInCropper,()=>{t.setSelection?.([t.imagePreviouslyOpenedInCropper])});var l=ge(),f=b(l);W(f,{get items(){return s(p)},get sort(){return ee().gallerySort},groups:["Avec détections","Sans détection"],grouping:({data:a})=>a.some(i=>t.cropMetadataValueOf(i))?"Avec détections":"Sans détection",item:(a,i=F,g)=>{let o=()=>g?.().id;{let _=n(()=>o()===t.imagePreviouslyOpenedInCropper),u=n(()=>s(d).t(30));me(a,{get fileId(){return o()},get images(){return i()},boxes:"show-all",get highlighted(){return s(_)},get loadingStatusText(){return s(u)},onretry:()=>{t.erroredImages.delete(o()),A([o()])},ondelete:async()=>{ie(o(),"Cancelled by user"),t.processing.removeFile(o()),await ne(o()),await se(o())},onclick:async(T,c)=>{c({status:"loading",loadingStatusText:"Ouverture…"}),await k("/(app)/(sidepanel)/crop/[image]",{image:o()})}})}},$$slots:{item:!0}});var m=w(f,2);{var I=r=>{var a=de(),i=b(a);G(i,()=>({"--size":"6em"})),oe(i.lastChild,{variant:"empty"}),v(i);var g=w(i,2),o=b(g,!0);v(g);var _=w(g,2);X(_,{onclick:()=>k("/import"),children:(u,T)=>{q();var c=D();S(B=>C(c,B),[()=>s(d).t(108)]),y(u,c)},$$slots:{default:!0}}),v(a),S(u=>C(o,u),[()=>s(d).t(38)]),y(r,a)};E(m,r=>{s(p).length||r(I)})}v(l),H(1,l,()=>J,()=>({duration:100})),y(h,l),z()}export{Le as component};
