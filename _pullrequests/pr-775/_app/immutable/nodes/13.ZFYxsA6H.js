import"../chunks/DsnmJJEf.js";import{f as me,a as u,s as N,g as e,i as b,h as ve,u as o,p as qt,k as Ne,c as z,by as Aa,ay as g,az as h,n as Fe,r as v,aa as U,b as Bt,a8 as qa,aA as Me,d as X,e as $e,aY as Wt,a9 as We,a4 as Ba}from"../chunks/Bn_ZbADV.js";import{d as na,e as $t,a as he,r as Oa}from"../chunks/C0Q0tU0C.js";import{s as Re}from"../chunks/hWH8XGqh.js";import{r as pe,p as zt,i as F,s as Sa}from"../chunks/dHQvgpC_.js";import{c as Va}from"../chunks/Ceb8Mi8c.js";import{e as Be,i as Yt}from"../chunks/WunZNVQx.js";import{F as Da,C as Ha,h as ja}from"../chunks/DhPWUMVW.js";import{c as Gt}from"../chunks/C-HhNZ1M.js";import{a as Je,t as Ke,K as Pa}from"../chunks/DnFSS6M7.js";import{a as _e,b as He,s as tt,c as De,_ as Ea,g as La}from"../chunks/gEdK1vYj.js";import{b as oa}from"../chunks/CoBO7ZM6.js";import{R as xe}from"../chunks/DHI2XP9K.js";import{w as sa}from"../chunks/CwN-qvm4.js";import{C as Ra}from"../chunks/HFiFmwQP.js";import{D as Zt}from"../chunks/k7L1q40X.js";import{S as Ta}from"../chunks/uwvacp_n.js";import{p as Fa}from"../chunks/Bls8_OGj.js";import{w as Na,c as Ct,t as wt,b as Ua,d as yt,e as Wa}from"../chunks/DmH6iQKy.js";import{B as Te}from"../chunks/gkDaaAm_.js";import{B as Jt}from"../chunks/2eCTIWiG.js";import{B as kt}from"../chunks/qfe7ntnt.js";import{C as Ya}from"../chunks/DFiedTE9.js";import{g as Ga,k as qe,t as Xe,Y as Za,q as Kt}from"../chunks/BZvTGrCn.js";import{c as Oe,j as Ue,m as At,l as Xt,r as Ja,p as Ka}from"../chunks/DvdFYW7d.js";import{c as Xa,f as Qa,d as er,g as It,h as tr,p as ar,j as rr,k as ir}from"../chunks/CHjfjsK1.js";import{i as Qt,a as ea,s as nr,t as or}from"../chunks/CgPNSYEV.js";import{L as sr}from"../chunks/CCpSuPOa.js";import{d as Mt,s as Qe,c as lr,h as cr}from"../chunks/BYsr5R_O.js";import{g as ye}from"../chunks/froF7yrv.js";import{P as ta}from"../chunks/Cavvmz3r.js";import{s as dr}from"../chunks/D9gih6mG.js";import{s as hr}from"../chunks/BfBY_ALr.js";import{u as y}from"../chunks/C-_QJLm4.js";import{S as ur}from"../chunks/DrYhbhJH.js";import{t as aa}from"../chunks/CAsIlwrN.js";import{T as vr}from"../chunks/BDn2Ojw_.js";var gr=me('<svg><path fill="currentColor" d="M2.5 7a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m0 10a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m10 0a4.5 4.5 0 1 0 9 0a4.5 4.5 0 0 0-9 0m-3-10a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0m0 10a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0m10 0a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0M16 11V8h-3V6h3V3h2v3h3v2h-3v3z"></path></svg>');function fr(w,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=gr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(w,s)}var mr=me('<svg><path fill="currentColor" d="m5.828 7l2.536 2.535L6.95 10.95L2 6l4.95-4.95l1.414 1.415L5.828 5H13a8 8 0 1 1 0 16H4v-2h9a6 6 0 0 0 0-12z"></path></svg>');function pr(w,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=mr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(w,s)}var _r=me('<svg><path fill="currentColor" d="m10.828 12l4.95 4.95l-1.414 1.415L8 12l6.364-6.364l1.414 1.414z"></path></svg>');function br(w,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=_r();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(w,s)}var xr=me('<svg><path fill="currentColor" d="m13.172 12l-4.95-4.95l1.414-1.413L16 12l-6.364 6.364l-1.414-1.415z"></path></svg>');function wr(w,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=xr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(w,s)}var yr=me('<svg><path fill="currentColor" d="m11.602 13.76l1.412 1.412l8.466-8.466l1.414 1.415l-9.88 9.88l-6.364-6.365l1.414-1.414l2.125 2.125zm.002-2.828l4.952-4.953l1.41 1.41l-4.952 4.953zm-2.827 5.655L7.364 18L1 11.636l1.414-1.414l1.413 1.413l-.001.001z"></path></svg>');function et(w,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=yr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(w,s)}var kr=me('<svg><path fill="currentColor" d="M11 5.07A7.005 7.005 0 0 0 5.07 11H7v2H5.07A7 7 0 0 0 11 18.93V17h2v1.93A7 7 0 0 0 18.93 13H17v-2h1.93A7 7 0 0 0 13 5.07V7h-2zM3.055 11A9.004 9.004 0 0 1 11 3.055V1h2v2.055A9.004 9.004 0 0 1 20.945 11H23v2h-2.055A9.004 9.004 0 0 1 13 20.945V23h-2v-2.055A9.004 9.004 0 0 1 3.055 13H1v-2zM14 12a2 2 0 1 1-4 0a2 2 0 0 1 4 0"></path></svg>');function Ir(w,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=kr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(w,s)}var Mr=me('<svg><path fill="currentColor" d="M13 19.938A8.004 8.004 0 0 0 19.938 13H17v-2h2.938A8.004 8.004 0 0 0 13 4.062V7h-2V4.062A8.004 8.004 0 0 0 4.062 11H7v2H4.062A8.004 8.004 0 0 0 11 19.938V17h2zM12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m0-8a2 2 0 1 1 0-4a2 2 0 0 1 0 4"></path></svg>');function $r(w,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=Mr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(w,s)}var zr=me('<svg><path fill="currentColor" d="M18 11V8l4 4l-4 4v-3h-5v5h3l-4 4l-4-4h3v-5H6v3l-4-4l4-4v3h5V6H8l4-4l4 4h-3v5z"></path></svg>');function Cr(w,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=zr();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(w,s)}var Ar=me('<svg><path fill="currentColor" d="M12.5 2a.5.5 0 0 0-.5.5V12h-2V4.5a.5.5 0 0 0-1 0V14H7c-.38-1.62-1.358-2.56-2.405-2.678A89 89 0 0 0 6.166 15.1c.86 1.962 1.725 3.422 2.838 4.399C10.078 20.442 11.459 21 13.5 21a5.5 5.5 0 0 0 5.5-5.5V7a.5.5 0 0 0-1 0v5h-2V4a.5.5 0 0 0-1 0v8h-2V2.5a.5.5 0 0 0-.5-.5M21 15.5a7.5 7.5 0 0 1-7.5 7.5c-2.458 0-4.328-.692-5.816-1.998c-1.45-1.274-2.459-3.064-3.35-5.1c-.93-2.127-1.444-3.422-1.724-4.178c-.357-.964.136-2.312 1.476-2.406a4.02 4.02 0 0 1 2.914.94V4.5a2.5 2.5 0 0 1 3.04-2.442a2.5 2.5 0 0 1 4.79-.467A2.502 2.502 0 0 1 18 4v.55q.243-.05.5-.05A2.5 2.5 0 0 1 21 7z"></path></svg>');function qr(w,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=Ar();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(w,s)}var Br=me('<svg><path fill="currentColor" d="M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2v2a8 8 0 1 0 5.135 1.865L15 8V2h6l-2.447 2.447A9.98 9.98 0 0 1 22 12"></path></svg>');function ra(w,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=Br();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(w,s)}var Or=me('<svg><path fill="currentColor" d="M20 16h2v6h-6v-2H8v2H2v-6h2V8H2V2h6v2h8V2h6v6h-2zm-2 0V8h-2V6H8v2H6v8h2v2h8v-2zM4 4v2h2V4zm0 14v2h2v-2zM18 4v2h2V4zm0 14v2h2v-2z"></path></svg>');function Sr(w,r){const i=pe(r,["$$slots","$$events","$$legacy"]);var s=Or();_e(s,()=>({class:"icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...i})),u(w,s)}const ia={origin:{x:0,y:0},scale:1,panning:!1,panStart:{x:0,y:0,zoomOrigin:{x:0,y:0}}};function Vr({naturalWidth:w,naturalHeight:r,clientWidth:i,clientHeight:s,clientTop:M,clientLeft:C},O){const W=w/r,oe=i/s;let se=0,T=0;return W<oe?(se=s*W,T=s):(T=i/W,se=i),O&&(se*=O.scale,T*=O.scale),{width:se,height:T,x:(O?.origin.x??0)+C+(i-se)/2,y:(O?.origin.y??0)+M+(s-T)/2}}class Dr{limits={x:0,y:0,width:0,height:0};#e=N("clickanddrag");get createMode(){return e(this.#e)}set createMode(r){b(this.#e,r,!0)}setCreateMode(r){this.createMode=r}#t=N(ve({x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}}));get clickanddrag(){return e(this.#t)}set clickanddrag(r){b(this.#t,r,!0)}#a=N(ve([]));get points(){return e(this.#a)}set points(r){b(this.#a,r,!0)}#r=o(()=>this.createMode==="clickanddrag"?Ga({x:"number > 0",y:"number > 0",width:"number > 0",height:"number > 0"}).allows(this.clickanddrag):this.createMode=="2point"?this.points.length>=2:this.createMode==="4point"?this.points.length>=4:!1);get ready(){return e(this.#r)}set ready(r){b(this.#r,r)}clamp(r){return{x:Oe(r.x,this.limits.x,this.limits.width),y:Oe(r.y,this.limits.y,this.limits.height),width:Oe(r.width,0,this.limits.width-r.x),height:Oe(r.height,0,this.limits.height-r.y)}}#i=o(()=>this.createMode==="clickanddrag"?this.clickanddrag.x:this.createMode==="off"?0:Math.min(...this.points.map(r=>r.x)));get x(){return e(this.#i)}set x(r){b(this.#i,r)}#n=o(()=>this.createMode==="clickanddrag"?this.clickanddrag.y:this.createMode==="off"?0:Math.min(...this.points.map(r=>r.y)));get y(){return e(this.#n)}set y(r){b(this.#n,r)}#o=o(()=>this.createMode==="clickanddrag"?this.clickanddrag.width:this.createMode==="off"?0:Math.max(...this.points.map(r=>r.x))-this.x);get width(){return e(this.#o)}set width(r){b(this.#o,r)}#s=o(()=>this.createMode==="clickanddrag"?this.clickanddrag.height:this.createMode==="off"?0:Math.max(...this.points.map(r=>r.y))-this.y);get height(){return e(this.#s)}set height(r){b(this.#s,r)}registerPoint(r,i){if(this.createMode!=="off"){if(this.createMode==="clickanddrag"){this.clickanddrag={...this.clickanddrag,x:r,y:i};return}this.points.push({x:r,y:i})}}registerMovement(r,i){if(this.createMode!=="clickanddrag")return;const{width:s,height:M}=this.clickanddrag;(s<=0||M<=0)&&(this.clickanddrag.dragDirection={x:Ue(r),y:Ue(i)});const{x:C,y:O}=this.clickanddrag.dragDirection;C>0&&O>0&&(this.clickanddrag.width+=r,this.clickanddrag.height+=i),C<0&&O<0&&(this.clickanddrag.x+=r,this.clickanddrag.y+=i,this.clickanddrag.width-=r,this.clickanddrag.height-=i),C<0&&O>0&&(this.clickanddrag.x+=r,this.clickanddrag.height+=i,this.clickanddrag.width-=r),C>0&&O<0&&(this.clickanddrag.y+=i,this.clickanddrag.width+=r,this.clickanddrag.height-=i)}rect(){return this.clamp({x:this.x,y:this.y,width:this.width,height:this.height})}reset(){this.clickanddrag={x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}},this.points=[]}constructor({limits:r}){this.limits=r,this.clickanddrag={x:0,y:0,width:0,height:0,dragDirection:{x:0,y:0}},this.points=[]}}var Hr=z("(<!>) × [<!>]",1),jr=z(" <!><br/>",1),Pr=z("<!> <br/> &nbsp;&nbsp;&nbsp;dir <!>",1),Er=z(" <!> <br/>",1),Lr=z("<br/> <!>",1),Rr=z('<code class="debug">bbs <br/> <!> <!></code>'),Tr=z('<div class="boundingbox-point new svelte-rvd0k3"></div>'),Fr=z('<div class="boundingbox new svelte-rvd0k3"></div>'),Nr=z("<div></div>"),Ur=z("<div></div>"),Wr=z("<div><!> <!> <!> <!> <!> <!> <!> <!></div>"),Yr=z("<div><!> <!> <!></div>");function Gr(w,r){qt(r,!0);let i=zt(r,"disabled",3,!1),s=N(ve(r.boundingBoxes));sa(()=>r.boundingBoxes,l=>{b(s,l,!0)});let M=N(ve(r.imageElement.clientWidth)),C=N(ve(r.imageElement.clientHeight)),O=N(ve(r.imageElement.clientLeft)),W=N(ve(r.imageElement.clientTop)),oe=N(ve(r.imageElement.naturalWidth)),se=N(ve(r.imageElement.naturalHeight)),T=N(void 0);const ie=async()=>{r.imageElement&&((l=>{b(M,l.clientWidth,!0),b(C,l.clientHeight,!0),b(O,l.clientLeft,!0),b(W,l.clientTop,!0),b(oe,l.naturalWidth,!0),b(se,l.naturalHeight,!0)})(r.imageElement),await qa())};Ne(()=>{r.imageElement.addEventListener("load",ie);const l=new ResizeObserver(async(V,x)=>{if(!r.imageElement){x.disconnect();return}await ie()}),I=new MutationObserver(async(V,x)=>{if(!r.imageElement){x.disconnect();return}await ie()});return l.observe(r.imageElement),I.observe(r.imageElement,{attributes:!0,attributeFilter:["src"]}),()=>{l.disconnect(),I.disconnect()}});const A=o(()=>Vr({clientHeight:e(C),clientWidth:e(M),naturalHeight:e(se),naturalWidth:e(oe),clientTop:e(W),clientLeft:e(O)},r.zoom)),je=o(()=>Ct({x:e(A).width,y:e(A).height})),q=o(()=>Ct({x:1/e(A).width,y:1/e(A).height})),Q=o(()=>At(e(s),e(je)));let Y=N(!1),B=o(()=>new Dr({limits:{x:0,y:0,width:e(A).width,height:e(A).height}}));Ne(()=>e(B).setCreateMode(r.createMode));let ee=N(""),S=ve({topleft:!1,topright:!1,bottomleft:!1,bottomright:!1,get left(){return this.topleft&&this.bottomleft},set left(l){this.topleft=l,this.bottomleft=l},get right(){return this.topright&&this.bottomright},set right(l){this.topright=l,this.bottomright=l},get top(){return this.topleft&&this.topright},set top(l){this.topleft=l,this.topright=l},get bottom(){return this.bottomleft&&this.bottomright},set bottom(l){this.bottomleft=l,this.bottomright=l},setAll(l){this.topleft=l,this.topright=l,this.bottomleft=l,this.bottomright=l},isAll(l){return this.topleft===l&&this.topright===l&&this.bottomleft===l&&this.bottomright===l}});var G=Yr();$t("mousemove",Aa,({target:l})=>{l instanceof Element&&e(Y)&&r.createMode==="clickanddrag"&&l.closest(".change-area")!==e(T)&&(console.warn("Dragging has gone outside change area, bailing out. Target is",l),S.setAll(!1),b(Y,!1),e(B).reset())});let Pe;G.__mouseup=async({button:l})=>{if(!i()&&l===0){if(S.setAll(!1),e(Y)&&e(B).ready){const I=e(q)(e(B).rect()),V=await r.oncreate?.(I);V&&(e(s)[V]=I),e(B).reset(),b(Y,!1)}else r.onchange?.(e(ee),e(s)[e(ee)]);b(ee,"")}},G.__mousedown=({clientX:l,clientY:I,currentTarget:V,button:x})=>{if(i()||x!==0||r.createMode==="off")return;const{left:k,top:f}=V.getBoundingClientRect(),[te,_]=[l-k,I-f];(r.movable||r.transformable)&&Object.values(e(Q)).some(Z=>Na(Z,{x:te,y:_}))||(b(Y,!0),e(B).registerPoint(te,_))},G.__mousemove=({movementX:l,movementY:I,button:V})=>{if(i()||V!==0)return;const{x,y:k}=e(q)({x:l,y:I,w:0,h:0});if(e(Y)&&r.createMode==="clickanddrag"){e(B).registerMovement(l,I);return}const f=e(s)[e(ee)];if(S.isAll(!0)){f.x+=x,f.y+=k;return}if(S.left){f.x+=x,f.width-=x;return}if(S.right){f.width+=x;return}if(S.top){f.y+=k,f.height-=k;return}if(S.bottom){f.height+=k;return}S.topleft&&(f.x+=x,f.y+=k,f.width-=x,f.height-=k),S.topright&&(f.y+=k,f.width+=x,f.height-=k),S.bottomleft&&(f.x+=x,f.width-=x,f.height+=k),S.bottomright&&(f.width+=x,f.height+=k)};let le;var Ee=g(G);{var Ye=l=>{var I=Rr();De(I,"",{},{color:"red"});{const _=(D,c=Fe,L=Fe)=>{Me();var H=We();U((ce,P)=>he(H,`${ce??""} ${P??""}`),[()=>Math.round(c()),()=>Math.round(L())]),u(D,H)},Z=(D,c)=>{let L=()=>c?.().x,H=()=>c?.().y,ce=()=>c?.().width,P=()=>c?.().height;Me();var ae=Hr(),ne=h(X(ae));_(ne,L,H);var ge=h(ne,2);_(ge,ce,P),Me(),u(D,ae)};var V=h(g(I),3);Be(V,17,()=>Object.entries(e(Q)),([D,c])=>D,(D,c)=>{var L=o(()=>Wt(e(c),2));let H=()=>e(L)[0],ce=()=>e(L)[1];Me();var P=jr(),ae=X(P),ne=h(ae);Z(ne,ce),Me(),U(()=>he(ae,`@${H()??""} `)),u(D,P)});var x=h(V),k=h(x);{var f=D=>{var c=Pr(),L=X(c);Z(L,()=>e(B).clickanddrag);var H=h(L,4);_(H,()=>e(B).clickanddrag.dragDirection.x,()=>e(B).clickanddrag.dragDirection.y),u(D,c)},te=D=>{var c=$e(),L=X(c);{var H=P=>{var ae=We("off");u(P,ae)},ce=P=>{var ae=Lr(),ne=h(X(ae),2);Be(ne,17,()=>e(B).points,Yt,(ge,ke,ue)=>{let J=()=>e(ke).x,fe=()=>e(ke).y;Me();var be=Er(),Ge=X(be);Ge.nodeValue=`#${ue} `;var rt=h(Ge);_(rt,J,fe),Me(2),u(ge,be)}),u(P,ae)};F(L,P=>{r.createMode==="off"?P(H):P(ce,!1)},!0)}u(D,c)};F(k,D=>{r.createMode==="clickanddrag"?D(f):D(te,!1)})}v(I),U(()=>he(x,` create ${e(B).ready?"ready ":""} `))}u(l,I)};F(Ee,l=>{Qt()&&l(Ye)})}var ze=h(Ee,2);{var Le=l=>{var I=$e(),V=X(I);Be(V,17,()=>e(B).points,Yt,(x,k)=>{let f=()=>e(k).x,te=()=>e(k).y;var _=$e(),Z=X(_);{var D=c=>{var L=Tr();let H;U(()=>H=De(L,"",H,{left:`${f()??""}px`,top:`${te()??""}px`})),u(c,L)};F(Z,c=>{f()!==0&&te()!==0&&c(D)})}u(x,_)}),u(l,I)},Se=l=>{var I=$e(),V=X(I);{var x=k=>{var f=Fr();let te;U(()=>te=De(f,"",te,{left:`${e(B).x??""}px`,top:`${e(B).y??""}px`,width:`${e(B).width??""}px`,height:`${e(B).height??""}px`})),u(k,f)};F(V,k=>{e(Y)&&r.createMode==="clickanddrag"&&k(x)},!0)}u(l,I)};F(ze,l=>{r.createMode==="2point"||r.createMode==="4point"?l(Le):l(Se,!1)})}var at=h(ze,2);Be(at,17,()=>Object.entries(e(Q)).filter(([l])=>Xa(l)===r.imageFileID),([l,I])=>l,(l,I)=>{var V=o(()=>Wt(e(I),2));let x=()=>e(V)[0],k=()=>e(V)[1];var f=Wr();let te;f.__mousedown=({button:ne})=>{ne===0&&(i()||(b(ee,x(),!0),r.movable&&S.setAll(!0)))};let _;{const ne=(ke,ue=Fe)=>{var J=Nr();let fe;J.__mousedown=be=>{be.button===0&&(i()||r.transformable&&(b(ee,x(),!0),S[ue()]=!0,be.stopPropagation()))},U(()=>fe=He(J,1,`side ${ue()??""}`,"svelte-rvd0k3",fe,{draggable:r.transformable,dragging:S[ue()]&&e(ee)===x()})),u(ke,J)},ge=(ke,ue=Fe)=>{var J=Ur();let fe;J.__mousedown=be=>{be.button===0&&(i()||r.transformable&&(b(ee,x(),!0),S[ue()]=!0,be.stopPropagation()))},U(()=>fe=He(J,1,`corner ${ue()??""}`,"svelte-rvd0k3",fe,{draggable:r.transformable,dragging:S[ue()]&&e(ee)===x()})),u(ke,J)};var Z=g(f);ne(Z,()=>"top");var D=h(Z,2);ne(D,()=>"bottom");var c=h(D,2);ne(c,()=>"left");var L=h(c,2);ne(L,()=>"right");var H=h(L,2);ge(H,()=>"topleft");var ce=h(H,2);ge(ce,()=>"topright");var P=h(ce,2);ge(P,()=>"bottomleft");var ae=h(P,2);ge(ae,()=>"bottomright"),v(f)}U(()=>{te=He(f,1,"boundingbox svelte-rvd0k3",null,te,{movable:r.movable,precise:!r.movable&&!r.transformable}),tt(f,"data-image",x()),_=De(f,"",_,{left:`${k().x??""}px`,top:`${k().y??""}px`,width:`${k().width??""}px`,height:`${k().height??""}px`})}),u(l,f)}),v(G),oa(G,l=>b(T,l),()=>e(T)),U(l=>{Pe=He(G,1,"change-area svelte-rvd0k3",null,Pe,l),le=De(G,"",le,{left:`${e(A).x??""}px`,top:`${e(A).y??""}px`,width:`${e(A).width??""}px`,height:`${e(A).height??""}px`,cursor:r.cursor})},[()=>({debug:Qt(),precise:!r.movable&&!r.transformable})]),u(w,G),Bt()}na(["mouseup","mousedown","mousemove"]);var Zr=z("<!><!>",1);function Jr(w,r){qt(r,!0);const i=zt(r,"final",3,"et"),s=zt(r,"key",3,(O,W)=>W);var M=$e(),C=X(M);Be(C,19,()=>r.items,(O,W)=>s()(O,W),(O,W,oe)=>{var se=Zr(),T=X(se);dr(T,()=>r.children,()=>e(W),()=>e(oe));var ie=h(T);{var A=q=>{var Q=We(", ");u(q,Q)},je=q=>{var Q=$e(),Y=X(Q);{var B=ee=>{var S=We();U(()=>he(S,` ${i()??""} `)),u(ee,S)};F(Y,ee=>{e(oe)===r.items.length-2&&ee(B)},!0)}u(q,Q)};F(ie,q=>{e(oe)<r.items.length-2?q(A):q(je,!1)})}u(O,se)}),u(w,M),Bt()}var Kr=z('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <p class="loading svelte-k3qi6z"> </p>',1),Xr=z("<br/>"),Qr=z('<p class="coucou svelte-k3qi6z" aria-hidden="true"><!></p>'),ei=z("<button><!></button>"),ti=z('<div class="status svelte-k3qi6z"><!></div>'),ai=z('<h1 class="svelte-k3qi6z"> <!></h1>'),ri=z('<h1 class="svelte-k3qi6z"><code>Image introuvable</code></h1>'),ii=z('<div class="confidence-icon svelte-k3qi6z"><!></div>'),ni=z('<span class="sep svelte-k3qi6z">&middot;</span> <!>',1),oi=z('<li><!> <div class="text svelte-k3qi6z"><p class="index"><!></p> <p class="dimensions svelte-k3qi6z"><code> </code> <!></p></div> <div class="actions svelte-k3qi6z"><!> <!> <!></div></li>'),si=z('<li class="boxes-list-hint svelte-k3qi6z"><p class="svelte-k3qi6z"><!> <!></p> <p class="svelte-k3qi6z"> </p></li>'),li=z('<code class="svelte-k3qi6z"> </code>'),ci=z('<div class="bar svelte-k3qi6z"><p class="svelte-k3qi6z"><!></p> <!></div>'),di=z('<div class="confirmed-overlay svelte-k3qi6z"><div class="icon svelte-k3qi6z"><!></div> <p> </p></div> <div class="layout svelte-k3qi6z"><main class="crop-surface svelte-k3qi6z"><div class="behind-image svelte-k3qi6z"><!></div> <img data-testid="crop-subject-image" alt="" class="svelte-k3qi6z"/> <!></main> <aside class="toolbar svelte-k3qi6z"></aside> <aside class="info svelte-k3qi6z"><section class="top svelte-k3qi6z"><section class="preactions svelte-k3qi6z"><!> <!></section> <section class="filename"><!></section> <section class="actions svelte-k3qi6z"><!> <!></section></section> <section class="boxes svelte-k3qi6z"><ul class="svelte-k3qi6z"><!> <!></ul></section> <section class="progress svelte-k3qi6z"><div class="bar svelte-k3qi6z"><p class="svelte-k3qi6z"><!></p> <!></div> <!></section> <nav class="svelte-k3qi6z"><div class="navigation svelte-k3qi6z"><!> <code class="numbers svelte-k3qi6z"> <div class="separator svelte-k3qi6z">⁄</div> </code> <!></div> <div class="continue svelte-k3qi6z"><span class="auto svelte-k3qi6z"><!></span> <!></div></nav></aside></div>',1);function Zi(w,r){qt(r,!0);const i=o(()=>Ea(La("main"))),s=o(()=>Fa.params.image||""),M=o(()=>It(e(s),Xe.Image.state)),C=o(()=>e(M).at(0));Ne(()=>hr({title:e(i).t(157,[e(C)?.filename??"..."])})),Ba("setNavbarAppearance")("floating");let O=N(!1),W=N("Glisser-recadrer");const oe=[{name:"Glisser-recadrer",help:"Cliquer et glisser pour créer une boîte de recadrage",icon:Sr,shortcut:"r",transformable:!0,createMode:"clickanddrag",movable:!0,cursor:"crosshair"},{name:"2 points",help:"Cliquer sur les 2 coins pour créer une boîte de recadrage",icon:Ir,shortcut:"z",transformable:!1,createMode:"2point",movable:!1,cursor:"crosshair"},{name:"4 points",help:"Cliquer sur les 4 extrémités pour créer une boîte de recadrage",icon:fr,shortcut:"Shift+z",transformable:!1,createMode:"4point",movable:!1,cursor:"crosshair"},{name:"Déplacer",help:"Cliquer et glisser pour déplacer la boîte de recadrage",icon:Cr,shortcut:"v",transformable:!1,createMode:"off",movable:!0,cursor:"pointer"},{name:"Main",help:"Cliquer et glisser pour se déplacer dans l'image",icon:qr,shortcut:"h",transformable:!1,createMode:"off",movable:!1,cursor:"grab"}],se=o(()=>oe.filter(({createMode:t})=>t!=="off"));let T=o(()=>oe.find(({name:t})=>t===e(W))||oe[0]),ie=N("");const A=o(()=>Object.fromEntries(e(M).map(({metadata:t,id:a})=>[a,lr("boundingbox",t[y.cropMetadataId]?.value)]).filter(([,t])=>!!t))),je=o(()=>y.previewURLs.get(e(s))),q=o(()=>ir(Xe.Image.state).toSorted(Za)),Q=o(()=>{const t=e(q).indexOf(e(s))-1;if(!(t<0))return e(q).at(t)}),Y=o(()=>{const t=e(q).indexOf(e(s))+1;if(!(t>=e(q).length))return e(q).at(t)}),B=o(()=>{const t=e(q).slice(e(q).indexOf(e(s))+1).filter(a=>!le(a)).at(0);return t||e(q).find(a=>!le(a))}),ee=o(()=>e(q).filter(Pe).length),S=o(()=>e(q).filter(le).length),G=o(()=>Object.fromEntries(e(M).map(t=>{if(!t.metadata[y.cropMetadataId])return[t.id,void 0];const{alternatives:a,value:n,confidence:d,manuallyModified:m}=t.metadata[y.cropMetadataId];if(a&&Object.entries(a).length>0){const[[p,$]]=Object.entries(a);return[t.id,{value:JSON.parse(p),confidence:$}]}return m?[t.id,void 0]:[t.id,{value:n,confidence:d}]})));function Pe(t){return It(t).every(a=>y.cropMetadataId in a.metadata)}function le(t){return t?It(t).every(Ee):!1}function Ee(t){const a=y.currentProtocol?.crop?.confirmationMetadata;return a?a in t.metadata&&t.metadata[a].value:!1}async function Ye(t,a){const n=y.cropConfirmationMetadataId;n&&await Qe({db:qe(),metadataId:n,subjectId:t,type:"boolean",manuallyModified:!0,value:a})}async function ze(t){if(!y.cropConfirmationMetadataId){aa.error(e(i).t(51));return}for(const a of e(M))await Ye(a.id,t)}async function Le(t){const a=e(G)[t];if(!a){aa.error(e(i).t(120,[t]));return}await Qe({db:qe(),subjectId:t,metadataId:y.cropMetadataId,type:"boundingbox",manuallyModified:!1,...a}),y.classificationMetadataId&&await Mt({db:qe(),metadataId:y.classificationMetadataId,subjectId:t})}const Se=o(()=>Object.fromEntries(e(M).map(t=>{const a=e(G)[t.id]?.value,n=t.metadata[y.cropMetadataId]?.value;return[t.id,a&&cr("boundingbox",n)&&!Wa(a,n)]}))),at=o(()=>Object.values(e(G)).every(t=>!t)||Object.values(e(Se)).some(Boolean));async function l(){if(Object.values(e(G)).every(t=>!t))for(const{id:t}of e(M))await I(t);else for(const{id:t}of e(M))await Le(t)}async function I(t){e(M).length===1?await Mt({db:qe(),metadataId:y.cropMetadataId,subjectId:t}):await Xe.Image.remove(t)}async function V(t,a,n=!0){if(!a)return t&&await Ye(t,!0),t;const d=n&&!!y.cropConfirmationMetadataId&&e(M).filter(Ee).length===e(M).length-1,m=ea().cropAutoNext&&Ua(a)&&(e(T).createMode!=="clickanddrag"||!Pe(e(s))),p=t?e(M).find(j=>j.id===t):void 0,$=p?.metadata[y.classificationMetadataId];$&&!$.manuallyModified&&await Mt({db:qe(),metadataId:y.classificationMetadataId,subjectId:p.id});let R="";return t?await Qe({db:qe(),metadataId:y.cropMetadataId,subjectId:t,type:"boundingbox",value:yt(a),confidence:1,alternatives:e(G)[t]?[e(G)[t]]:void 0,manuallyModified:!0}):e(M).length===1&&e(C)&&!e(C).metadata[y.cropMetadataId]?(R=e(C).id,await Qe({db:qe(),metadataId:y.cropMetadataId,subjectId:R,type:"boundingbox",value:yt(a),confidence:1,manuallyModified:!0,alternatives:[]})):(R=tr(e(s),Math.max(...e(M).map(({id:j})=>ar(j).subindex))+1),await Xe.Image.set({id:R,filename:e(C)?.filename??"",addedAt:rr(e(C)?.addedAt??new Date),contentType:e(C)?.contentType??"",dimensions:Re(e(C)?.dimensions)??{width:0,height:0},fileId:e(s),metadata:{[y.cropMetadataId]:{value:JSON.stringify(yt(a)),confidence:1,manuallyModified:!0,alternatives:{}},[y.cropConfirmationMetadataId]:{value:"true",confidence:1,manuallyModified:!0,alternatives:{}}}})),b(L,!1),await ze(!0),_.manual||(_.imageId=R||t),d&&(b(O,!0),await new Promise(j=>setTimeout(j,500)),b(O,!1)),m&&await ye(e(B)?`#/crop/${e(B)}`:"#/classify",{invalidateAll:!0}),R}async function x(){const t=e(M).map(a=>[a,e(A)[a.id]]);for(const[a,n]of t)await V(a.id,n?wt(n):void 0);await ye(e(B)?`#/crop/${e(B)}`:"#/classify")}async function k(){const t=Re(e(Y));await er(e(s)),await ye(e(Y)?`#/crop/${t}`:"#/import")}function f(t){if(!e(C))return[0,0];const a=Ct({x:e(C).dimensions.width,y:e(C).dimensions.height}),{w:n,h:d}=At(a(t),Math.round);return[n,d]}function te(){y.imagePreviouslyOpenedInCropper=e(s),ye("/crop")}Ne(()=>{y.imageOpenedInCropper=e(s)});let _=ve({imageId:null,manual:!1});Qa("cropping",{ArrowLeft:{help:e(i).t(106),when:()=>!!e(Q),do:()=>ye(`#/crop/${e(Q)}`)},"Shift+Space":{help:e(i).t(106),when:()=>!!e(Q),do:()=>ye(`#/crop/${e(Q)}`)},ArrowRight:{help:e(i).t(107),when:()=>!!e(Y),do:()=>ye(`#/crop/${e(Y)}`)},Space:{help:e(i).t(71),do:x},"$mod+Delete":{help:e(i).t(173),do:k},Escape:{help:e(i).t(152),do:te},a:{help:e(i).t(27),do:async()=>or("cropAutoNext")},Delete:{help:e(i).t(171),when:()=>!!_.imageId,async do(){_.imageId&&(await I(_.imageId),_.manual?_.imageId=null:_.imageId=e(M).toReversed().find(t=>t.id in e(A))?.id??null)}},f:{help:e(i).t(47),when:()=>!!_,do(){_&&(_.imageId===e(ie)?b(ie,""):_.imageId&&b(ie,_.imageId,!0))}},u:{help:e(i).t(161),when:()=>!!e(Se)[e(s)],do:()=>{e(Se)[e(s)]&&Le(e(s))}},"$mod+u":{help:e(i).t(162),when:()=>Object.keys(e(A)).length>0,do:l},ArrowUp:{help:e(i).t(128),when:()=>!le(e(s)),do:()=>ze(!0)},ArrowDown:{help:e(i).t(130),when:()=>le(e(s)),do:()=>ze(!1)},"+":{help:e(i).t(194),do:()=>{e(c).scale=Oe(1,e(c).scale+4*e(H),10)}},"-":{help:e(i).t(83),do:()=>{e(c).scale=Oe(1,e(c).scale-4*e(H),10)}},Digit0:{help:e(i).t(164),do:()=>{e(c).origin={x:0,y:0},e(c).scale=1}},...Xt(oe.map(t=>[t.shortcut,{help:`Choisir l'outil ${t.name}`,do:()=>{b(W,t.name,!0)}}])),",":{help:e(i).t(177),do:()=>{const t=Object.keys(e(A)),n=(t.indexOf(_.imageId??"")-1+t.length)%t.length;_.imageId=t[n]}},";":{help:e(i).t(178),do:()=>{const t=Object.keys(e(A)),n=(t.indexOf(_.imageId??"")+1)%t.length;_.imageId=t[n]}},...Xt(Ja(1,10).map(t=>[`Digit${t}`,{help:`Sélectionner la boîte #${t}`,when:()=>Object.keys(e(A)).length>=t,do:()=>{const a=Object.keys(e(A))[t-1];_.imageId===a?(_.imageId=null,_.manual=!1):(_.imageId=a,_.manual=!0)}}]))}),Ne(()=>{_.imageId&&document.querySelector(".boxes li.selected")?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})});let Z=N(void 0),D=N(!0);sa(()=>e(s),(t,a)=>{a&&y.cropperZoomStates.set(a,Re(e(c))),b(c,Re(y.cropperZoomStates.get(t))??ia,!0)});let c=N(ve({...ia})),L=o(()=>e(M).every(({metadata:t})=>!t[y.cropMetadataId]?.manuallyModified));const H=o(()=>e(c).scale*.1);var ce=di(),P=X(ce),ae=g(P),ne=g(ae);et(ne,{}),v(ae);var ge=h(ae,2),ke=g(ge,!0);v(ge),v(P);var ue=h(P,2),J=g(ue);J.__mousedown=async t=>{e(T).name!=="Main"&&t.button!==1||(t.preventDefault(),e(c).panning=!0,e(c).panStart={x:t.clientX,y:t.clientY,zoomOrigin:Re(e(c).origin)})},J.__mouseup=async({button:t})=>{e(T).name!=="Main"&&t!==1||(e(c).panning=!1)},J.__mousemove=async({clientX:t,clientY:a})=>{e(c).panning&&(e(c).origin.x=e(c).panStart.zoomOrigin.x+(t-e(c).panStart.x),e(c).origin.y=e(c).panStart.zoomOrigin.y+(a-e(c).panStart.y))};var fe=g(J),be=g(fe);{var Ge=t=>{var a=Kr(),n=X(a);Va(n,()=>({"--size":"2em"})),sr(n.lastChild,{}),v(n);var d=h(n,2),m=g(d,!0);v(d),U(p=>he(m,p),[()=>e(i).t(53)]),u(t,a)},rt=t=>{var a=Qr();{const d=m=>{var p=Xr();u(m,p)};var n=g(a);{let m=o(()=>[d]),p=o(()=>e(i).cx(195));xe(n,{get t(){return e(m)},get x(){return e(p)}})}v(a)}u(t,a)};F(be,t=>{e(D)?t(Ge):t(rt,!1)})}v(fe);var Ve=h(fe,2);let Ot;oa(Ve,t=>b(Z,t),()=>e(Z));var la=h(Ve,2);{var ca=t=>{{let a=o(()=>At(e(ie)?Ka(e(A),e(ie)):e(A),wt)),n=o(()=>e(c).panning?e(T).name==="Main"?"grabbing":"move":e(T).cursor);Gr(t,Sa(()=>e(T),{get imageElement(){return e(Z)},get zoom(){return e(c)},get imageFileID(){return e(s)},get boundingBoxes(){return e(a)},get disabled(){return e(c).panning},get cursor(){return e(n)},onchange:(d,m)=>V(d,m),oncreate:d=>V(null,d)}))}};F(la,t=>{e(Z)&&t(ca)})}v(J);var it=h(J,2);Be(it,21,()=>oe,t=>t.name,(t,a)=>{var n=ei();n.__click=()=>{b(W,e(a).name,!0)};let d;var m=g(n);Gt(m,()=>e(a).icon,(p,$)=>{$(p,{})}),v(n),Je(n,(p,$)=>Ke?.(p,$),()=>({text:`${e(a).name}: ${e(a).help}`,keyboard:e(a).shortcut,placement:"right"})),U(p=>{tt(n,"aria-label",p),d=He(n,1,"svelte-k3qi6z",null,d,{active:e(a).name===e(W)})},[()=>e(i).t(60,[e(a).name])]),u(t,n)}),v(it);var St=h(it,2),nt=g(St),ot=g(nt),Vt=g(ot);{const t=n=>{Da(n,{})},a=n=>{Pa(n,{shortcut:"Escape"})};Jt(Vt,{inline:!0,onclick:te,_w_snippet_1:t,_w_snippet_2:a,children:(n,d)=>{{let m=o(()=>[t,a]),p=o(()=>e(i).cx(1));xe(n,{get t(){return e(m)},get x(){return e(p)}})}},$$slots:{_w_snippet_1:!0,_w_snippet_2:!0,default:!0}})}var da=h(Vt,2);{const t=a=>{Zt(a,{})};Jt(da,{dangerous:!0,onclick:k,help:{text:"Supprimer cette image et passer à la suivante",keyboard:"$mod+Delete"},_w_snippet_3:t,children:(a,n)=>{{let d=o(()=>[t]),m=o(()=>e(i).cx(15));xe(a,{get t(){return e(d)},get x(){return e(m)}})}},$$slots:{_w_snippet_3:!0,default:!0}})}v(ot);var st=h(ot,2),ha=g(st);{var ua=t=>{var a=ai(),n=g(a),d=h(n);{var m=p=>{var $=ti(),R=g($);et(R,{}),v($),Je($,(j,K)=>Ke?.(j,K),()=>"Recadrage confirmé"),u(p,$)};F(d,p=>{le(e(s))&&p(m)})}v(a),U(()=>he(n,`${e(C).filename??""} `)),u(t,a)},va=t=>{var a=ri();u(t,a)};F(ha,t=>{e(C)?t(ua):t(va,!1)})}v(st);var Dt=h(st,2),Ht=g(Dt);{const t=d=>{ra(d,{})};let a=o(()=>e(i).t(162)),n=o(()=>!e(at));kt(Ht,{keyboard:"$mod+U",get help(){return e(a)},onclick:l,get disabled(){return e(n)},_w_snippet_4:t,children:(d,m)=>{{let p=o(()=>[t]),$=o(()=>e(i).cx(11));xe(d,{get t(){return e(p)},get x(){return e($)}})}},$$slots:{_w_snippet_4:!0,default:!0}})}var ga=h(Ht,2);{var fa=t=>{{let a=o(()=>le(e(s))?"ArrowDown":"ArrowUp"),n=o(()=>le(e(s))?"Marquer le recadrage comme non confirmé":"Marquer le recadrage comme confirmé");kt(t,{get keyboard(){return e(a)},onclick:()=>ze(!le(e(s))),get help(){return e(n)},children:(d,m)=>{var p=$e(),$=X(p);{var R=K=>{const Ce=de=>{pr(de,{})};{let de=o(()=>[Ce]),we=o(()=>e(i).cx(7));xe(K,{get t(){return e(de)},get x(){return e(we)}})}},j=K=>{const Ce=de=>{et(de,{})};{let de=o(()=>[Ce]),we=o(()=>e(i).cx(18));xe(K,{get t(){return e(de)},get x(){return e(we)}})}};F($,K=>{le(e(s))?K(R):K(j,!1)})}u(d,p)},$$slots:{default:!0}})}};F(ga,t=>{y.cropConfirmationMetadataId&&t(fa)})}v(Dt),v(nt);var lt=h(nt,2),jt=g(lt),Pt=g(jt);Be(Pt,19,()=>e(M).filter(({id:t})=>t in e(A)),t=>t.id,(t,a,n)=>{const d=o(()=>e(A)[e(a).id]),m=o(()=>e(G)[e(a).id]),p=o(()=>{const[E,re]=f(e(d));return{w:E,h:re}}),$=o(()=>e(ie)===e(a).id);var R=oi();let j;var K=g(R);{var Ce=E=>{{let re=o(()=>wt(e(d))),Ie=o(()=>y.previewURLs.get(e(a).fileId));Ya(E,{get box(){return e(re)},get src(){return e(Ie)},class:"thumb"})}};F(K,E=>{e(a).fileId&&E(Ce)})}var de=h(K,2),we=g(de),gt=g(we);{let E=o(()=>e(i).cx(44)),re=o(()=>[e(n)+1]);xe(gt,{get x(){return e(E)},get a(){return e(re)}})}v(we);var ft=h(we,2),Ae=g(ft),mt=g(Ae);v(Ae),Je(Ae,(E,re)=>Ke?.(E,re),()=>"Dimensions de l'image recadrée (en pixels)");var pt=h(Ae,2);{var _t=E=>{var re=ni(),Ie=h(X(re),2);Ha(Ie,{get value(){return e(m).confidence},children:(bt,hi)=>{var xt=ii(),Ca=g(xt);Ta(Ca,{}),v(xt),u(bt,xt)},$$slots:{default:!0}}),u(E,re)};F(pt,E=>{e(m)&&!e(a).metadata[y.cropMetadataId].manuallyModified&&E(_t)})}v(ft),v(de);var Ft=h(de,2),Nt=g(Ft);{var $a=E=>{{let re=o(()=>e($)?"Réafficher les autres boîtes":"Masquer les autres boîtes");Te(E,{get help(){return e(re)},keyboard:"F",onclick:()=>b(ie,e($)?"":e(a).id,!0),get crossout(){return e($)},children:(Ie,bt)=>{$r(Ie,{})},$$slots:{default:!0}})}};F(Nt,E=>{Object.values(e(A)).length>1&&E($a)})}var Ut=h(Nt,2);{let E=o(()=>e(m)?`Revenir au recadrage d'origine 
									(${f(e(m).value).join(" × ")}, ${Kt(e(m).confidence)} de confiance)`:"Recadrage d'origine indisponible"),re=o(()=>!e(Se)[e(a).id]);Te(Ut,{get help(){return e(E)},keyboard:"u",get disabled(){return e(re)},onclick:()=>Le(e(a).id),children:(Ie,bt)=>{ra(Ie,{})},$$slots:{default:!0}})}var za=h(Ut,2);{let E=o(()=>e(i).t(171));Te(za,{get help(){return e(E)},keyboard:"Delete",onclick:async()=>I(e(a).id),children:(re,Ie)=>{Zt(re,{})},$$slots:{default:!0}})}v(Ft),v(R),U(()=>{j=He(R,1,"svelte-k3qi6z",null,j,{unfocused:e(ie)&&e(ie)!==e(a).id,selected:_.imageId===e(a).id}),he(mt,`${e(p).w??""}×${e(p).h??""}`)}),u(t,R)});var ma=h(Pt,2);{var pa=t=>{var a=si(),n=g(a),d=g(n);ja(d,()=>"Pour créer une nouvelle boîte,<wbr /> utilisez les outils");var m=h(d,2);Jr(m,{get items(){return e(se)},key:j=>j.name,final:"ou",children:(j,K)=>{let Ce=()=>K?.().icon,de=()=>K?.().help,we=()=>K?.().shortcut;vr(j,{get text(){return de()},get keyboard(){return we()},children:(gt,ft)=>{var Ae=$e(),mt=X(Ae);Gt(mt,Ce,(pt,_t)=>{_t(pt,{})}),u(gt,Ae)},$$slots:{default:!0}})},$$slots:{default:!0}}),v(n);var p=h(n,2),$=g(p,!0);v(p),v(a),U(R=>he($,R),[()=>e(i).t(225)]),u(t,a)};F(ma,t=>{e(L)&&t(pa)})}v(jt),v(lt);var ct=h(lt,2);{const t=(a,n=Fe)=>{var d=li(),m=g(d,!0);v(d),U(p=>he(m,p),[()=>Kt(n()/e(q).length)]),u(a,d)};var dt=g(ct),ht=g(dt);{const a=d=>{Ra(d,{})},n=d=>{t(d,()=>e(ee))};var _a=g(ht);{let d=o(()=>[a,n]),m=o(()=>e(i).cx(4));xe(_a,{get t(){return e(d)},get x(){return e(m)}})}v(ht)}var ba=h(ht,2);{let a=o(()=>e(ee)/e(q).length);ta(ba,{alwaysActive:!0,get progress(){return e(a)}})}v(dt);var xa=h(dt,2);{var wa=a=>{var n=ci(),d=g(n);{const $=j=>{et(j,{})},R=j=>{t(j,()=>e(S))};var m=g(d);{let j=o(()=>[$,R]),K=o(()=>e(i).cx(9));xe(m,{get t(){return e(j)},get x(){return e(K)}})}v(d)}var p=h(d,2);{let $=o(()=>e(S)/e(q).length);ta(p,{alwaysActive:!0,get progress(){return e($)}})}v(n),u(a,n)};F(xa,a=>{y.cropConfirmationMetadataId&&a(wa)})}v(ct)}var Et=h(ct,2),ut=g(Et),Lt=g(ut);{let t=o(()=>!e(Q)),a=o(()=>e(i).t(106));Te(Lt,{get disabled(){return e(t)},get help(){return e(a)},keyboard:"ArrowLeft",onclick:()=>{e(Q)&&ye("/(app)/(sidepanel)/crop/[image]",{image:e(Q)})},children:(n,d)=>{br(n,{})},$$slots:{default:!0}})}var vt=h(Lt,2),Rt=g(vt),ya=h(Rt,2);v(vt);var ka=h(vt,2);{let t=o(()=>!e(Y)),a=o(()=>e(i).t(107));Te(ka,{get disabled(){return e(t)},get help(){return e(a)},keyboard:"ArrowRight",onclick:()=>{e(Y)&&ye("/(app)/(sidepanel)/crop/[image]",{image:e(Y)})},children:(n,d)=>{wr(n,{})},$$slots:{default:!0}})}v(ut);var Tt=h(ut,2),Ze=g(Tt);{const t=a=>{var n=()=>ea().cropAutoNext,d=m=>nr("cropAutoNext",m);{let m=o(()=>e(i).t(40));ur(a,{get value(){return n()},set value(p){d(p)},get label(){return e(m)}})}};var Ia=g(Ze);{let a=o(()=>[t]),n=o(()=>e(i).cx(0));xe(Ia,{get t(){return e(a)},get x(){return e(n)}})}v(Ze),Je(Ze,(a,n)=>Ke?.(a,n),()=>({text:"Passer automatiquement à l'image suivante quand celle-ci est recadrée",keyboard:"A"}))}var Ma=h(Ze,2);{let t=o(()=>e(i).t(129));kt(Ma,{onclick:x,keyboard:"Space",get help(){return e(t)},children:(a,n)=>{Me();var d=We();U(m=>he(d,m),[()=>e(i).t(71)]),u(a,d)},$$slots:{default:!0}})}v(Tt),v(Et),v(St),v(ue),U((t,a)=>{tt(P,"aria-hidden",!e(O)),he(ke,t),tt(Ve,"src",e(je)),Ot=De(Ve,"",Ot,{scale:e(c).scale,translate:`${e(c).origin.x??""}px ${e(c).origin.y??""}px`}),he(Rt,`${a??""} `),he(ya,` ${e(q).length??""}`)},[()=>e(i).t(70),()=>e(q).indexOf(e(s))+1]),$t("wheel",J,async t=>{t.preventDefault();let a=e(Z).getBoundingClientRect(),n=(t.clientX-a.x)/e(c).scale,d=(t.clientY-a.y)/e(c).scale;e(c).scale=Oe(1,e(c).scale-Ue(t.deltaY)*2*e(H),10),e(c).scale>1?(e(c).origin.x+=Ue(t.deltaY)*e(H)*(n*2-e(Z).offsetWidth),e(c).origin.y+=Ue(t.deltaY)*e(H)*(d*2-e(Z).offsetHeight)):e(c).origin={x:0,y:0}}),$t("load",Ve,()=>{b(D,!1)}),Oa(Ve),u(w,ce),Bt()}na(["mousedown","mouseup","mousemove","click"]);export{Zi as component};
