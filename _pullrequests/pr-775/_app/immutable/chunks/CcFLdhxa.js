import"./DsnmJJEf.js";import{o as le}from"./CNplBLUs.js";import{s as te,h as ae,g as v,i as se,p as ce,k as Y,u as K,c as q,a as D,b as he,ay as B,az as L,r as M,e as de,d as ue,aa as X,n as me,aA as z,aY as _e,a9 as pe}from"./Bn_ZbADV.js";import{a as H}from"./C0Q0tU0C.js";import{s as fe}from"./hWH8XGqh.js";import{i as F}from"./dHQvgpC_.js";import{e as W}from"./WunZNVQx.js";import{s as ve}from"./D9gih6mG.js";import{a as ge}from"./DnFSS6M7.js";import{b as ye}from"./CoBO7ZM6.js";import{_ as be,g as Se}from"./gEdK1vYj.js";import{u as b}from"./C-_QJLm4.js";import{n as Ee,g as xe,h as Ae}from"./DvdFYW7d.js";import{x as we}from"./BZvTGrCn.js";import{f as Te}from"./CHjfjsK1.js";import{i as Le}from"./CgPNSYEV.js";import{g as Me}from"./CvtFKgdo.js";/*! @viselect/vanilla v3.9.0 MIT | https://github.com/Simonwep/selection/tree/master/packages/vanilla */class ke{constructor(){this._listeners=new Map,this.on=this.addEventListener,this.off=this.removeEventListener,this.emit=this.dispatchEvent}addEventListener(e,t){const i=this._listeners.get(e)??new Set;return this._listeners.set(e,i),i.add(t),this}removeEventListener(e,t){var i;return(i=this._listeners.get(e))==null||i.delete(t),this}dispatchEvent(e,...t){let i=!0;for(const s of this._listeners.get(e)??[])i=s(...t)!==!1&&i;return i}unbindAllListeners(){this._listeners.clear()}}const J=(n,e="px")=>typeof n=="number"?n+e:n,k=({style:n},e,t)=>{if(typeof e=="object")for(const[i,s]of Object.entries(e))s!==void 0&&(n[i]=J(s));else t!==void 0&&(n[e]=J(t))},U=(n=0,e=0,t=0,i=0)=>{const s={x:n,y:e,width:t,height:i,top:e,left:n,right:n+t,bottom:e+i};return{...s,toJSON:()=>JSON.stringify(s)}},Ce=n=>{let e,t=-1,i=!1;return{next:(...s)=>{e=s,i||(i=!0,t=requestAnimationFrame(()=>{n(...e),i=!1}))},cancel:()=>{cancelAnimationFrame(t),i=!1}}},V=(n,e,t="touch")=>{switch(t){case"center":{const i=e.left+e.width/2,s=e.top+e.height/2;return i>=n.left&&i<=n.right&&s>=n.top&&s<=n.bottom}case"cover":return e.left>=n.left&&e.top>=n.top&&e.right<=n.right&&e.bottom<=n.bottom;case"touch":return n.right>=e.left&&n.left<=e.right&&n.bottom>=e.top&&n.top<=e.bottom}},Be=()=>matchMedia("(hover: none), (pointer: coarse)").matches,Re=()=>"safari"in window,N=n=>Array.isArray(n)?n:[n],ie=n=>(e,t,i,s={})=>{(e instanceof HTMLCollection||e instanceof NodeList)&&(e=Array.from(e)),t=N(t),e=N(e);for(const o of e)if(o)for(const r of t)o[n](r,i,{capture:!1,...s})},C=ie("addEventListener"),S=ie("removeEventListener"),j=n=>{var e;const{clientX:t,clientY:i,target:s}=((e=n.touches)==null?void 0:e[0])??n;return{x:t,y:i,target:s}},O=(n,e=document)=>N(n).map(t=>typeof t=="string"?Array.from(e.querySelectorAll(t)):t instanceof Element?t:null).flat().filter(Boolean),De=(n,e)=>e.some(t=>typeof t=="number"?n.button===t:typeof t=="object"?t.button!==n.button?!1:t.modifiers.every(i=>{switch(i){case"alt":return n.altKey;case"ctrl":return n.ctrlKey||n.metaKey;case"shift":return n.shiftKey}}):!1),{abs:R,max:G,min:Q,ceil:Z}=Math,$=(n=[])=>({stored:n,selected:[],touched:[],changed:{added:[],removed:[]}}),oe=class extends ke{constructor(e){var t,i,s,o,r;super(),this._selection=$(),this._targetBoundaryScrolled=!0,this._selectables=[],this._areaLocation={y1:0,x2:0,y2:0,x1:0},this._areaRect=U(),this._singleClick=!0,this._scrollAvailable=!0,this._scrollingActive=!1,this._scrollSpeed={x:0,y:0},this._scrollDelta={x:0,y:0},this._lastMousePosition={x:0,y:0},this.enable=this._toggleStartEvents,this.disable=this._toggleStartEvents.bind(this,!1),this._options={selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,startAreas:["html"],boundaries:["html"],container:"body",...e,behaviour:{overlap:"invert",intersect:"touch",triggers:[0],...e.behaviour,startThreshold:(t=e.behaviour)!=null&&t.startThreshold?typeof e.behaviour.startThreshold=="number"?e.behaviour.startThreshold:{x:10,y:10,...e.behaviour.startThreshold}:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,...(i=e.behaviour)==null?void 0:i.scrolling,startScrollMargins:{x:0,y:0,...(o=(s=e.behaviour)==null?void 0:s.scrolling)==null?void 0:o.startScrollMargins}}},features:{range:!0,touch:!0,deselectOnBlur:!1,...e.features,singleTap:{allow:!0,intersect:"native",...(r=e.features)==null?void 0:r.singleTap}}};for(const f of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))typeof this[f]=="function"&&(this[f]=this[f].bind(this));const{document:l,selectionAreaClass:c,selectionContainerClass:p}=this._options;this._area=l.createElement("div"),this._clippingElement=l.createElement("div"),this._clippingElement.appendChild(this._area),this._area.classList.add(c),p&&this._clippingElement.classList.add(p),k(this._area,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),k(this._clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this._frame=Ce(f=>{this._recalculateSelectionAreaRect(),this._updateElementSelection(),this._emitEvent("move",f),this._redrawSelectionArea()}),this.enable()}_toggleStartEvents(e=!0){const{document:t,features:i}=this._options,s=e?C:S;s(t,"mousedown",this._onTapStart),i.touch&&s(t,"touchstart",this._onTapStart,{passive:!1})}_onTapStart(e,t=!1){const{x:i,y:s,target:o}=j(e),{document:r,startAreas:l,boundaries:c,features:p,behaviour:f}=this._options,d=o.getBoundingClientRect();if(e instanceof MouseEvent&&!De(e,f.triggers))return;const a=O(l,r),_=O(c,r);this._targetElement=_.find(g=>V(g.getBoundingClientRect(),d));const m=e.composedPath(),h=a.find(g=>m.includes(g));if(this._targetBoundary=_.find(g=>m.includes(g)),!this._targetElement||!h||!this._targetBoundary||!t&&this._emitEvent("beforestart",e)===!1)return;this._areaLocation={x1:i,y1:s,x2:0,y2:0};const u=r.scrollingElement??r.body;this._scrollDelta={x:u.scrollLeft,y:u.scrollTop},this._singleClick=!0,this.clearSelection(!1,!0),C(r,["touchmove","mousemove"],this._delayedTapMove,{passive:!1}),C(r,["mouseup","touchcancel","touchend"],this._onTapStop),C(r,"scroll",this._onScroll),p.deselectOnBlur&&(this._targetBoundaryScrolled=!1,C(this._targetBoundary,"scroll",this._onStartAreaScroll))}_onSingleTap(e){const{singleTap:{intersect:t},range:i}=this._options.features,s=j(e);let o;if(t==="native")o=s.target;else if(t==="touch"){this.resolveSelectables();const{x:l,y:c}=s;o=this._selectables.find(p=>{const{right:f,left:d,top:a,bottom:_}=p.getBoundingClientRect();return l<f&&l>d&&c<_&&c>a})}if(!o)return;for(this.resolveSelectables();!this._selectables.includes(o);)if(o.parentElement)o=o.parentElement;else{this._targetBoundaryScrolled||this.clearSelection();return}const{stored:r}=this._selection;if(this._emitEvent("start",e),e.shiftKey&&i&&this._latestElement){const l=this._latestElement,[c,p]=l.compareDocumentPosition(o)&4?[o,l]:[l,o],f=[...this._selectables.filter(d=>d.compareDocumentPosition(c)&4&&d.compareDocumentPosition(p)&2),c,p];this.select(f),this._latestElement=l}else r.includes(o)&&(r.length===1||e.ctrlKey||r.every(l=>this._selection.stored.includes(l)))?this.deselect(o):(this.select(o),this._latestElement=o)}_delayedTapMove(e){const{container:t,document:i,behaviour:{startThreshold:s}}=this._options,{x1:o,y1:r}=this._areaLocation,{x:l,y:c}=j(e);if(typeof s=="number"&&R(l+c-(o+r))>=s||typeof s=="object"&&R(l-o)>=s.x||R(c-r)>=s.y){if(S(i,["mousemove","touchmove"],this._delayedTapMove,{passive:!1}),this._emitEvent("beforedrag",e)===!1){S(i,["mouseup","touchcancel","touchend"],this._onTapStop);return}C(i,["mousemove","touchmove"],this._onTapMove,{passive:!1}),k(this._area,"display","block"),O(t,i)[0].appendChild(this._clippingElement),this.resolveSelectables(),this._singleClick=!1,this._targetRect=this._targetElement.getBoundingClientRect(),this._scrollAvailable=this._targetElement.scrollHeight!==this._targetElement.clientHeight||this._targetElement.scrollWidth!==this._targetElement.clientWidth,this._scrollAvailable&&(C(this._targetElement,"wheel",this._wheelScroll,{passive:!1}),C(this._options.document,"keydown",this._keyboardScroll,{passive:!1}),this._selectables=this._selectables.filter(p=>this._targetElement.contains(p))),this._setupSelectionArea(),this._emitEvent("start",e),this._onTapMove(e)}this._handleMoveEvent(e)}_setupSelectionArea(){const{_clippingElement:e,_targetElement:t,_area:i}=this,s=this._targetRect=t.getBoundingClientRect();this._scrollAvailable?(k(e,{top:s.top,left:s.left,width:s.width,height:s.height}),k(i,{marginTop:-s.top,marginLeft:-s.left})):(k(e,{top:0,left:0,width:"100%",height:"100%"}),k(i,{marginTop:0,marginLeft:0}))}_onTapMove(e){const{_scrollSpeed:t,_areaLocation:i,_options:s,_frame:o}=this,{speedDivider:r}=s.behaviour.scrolling,l=this._targetElement,{x:c,y:p}=j(e);if(i.x2=c,i.y2=p,this._lastMousePosition.x=c,this._lastMousePosition.y=p,this._scrollAvailable&&!this._scrollingActive&&(t.y||t.x)){this._scrollingActive=!0;const f=()=>{if(!t.x&&!t.y){this._scrollingActive=!1;return}const{scrollTop:d,scrollLeft:a}=l;t.y&&(l.scrollTop+=Z(t.y/r),i.y1-=l.scrollTop-d),t.x&&(l.scrollLeft+=Z(t.x/r),i.x1-=l.scrollLeft-a),o.next(e),requestAnimationFrame(f)};requestAnimationFrame(f)}else o.next(e);this._handleMoveEvent(e)}_handleMoveEvent(e){const{features:t}=this._options;(t.touch&&Be()||this._scrollAvailable&&Re())&&e.preventDefault()}_onScroll(){const{_scrollDelta:e,_options:{document:t}}=this,{scrollTop:i,scrollLeft:s}=t.scrollingElement??t.body;this._areaLocation.x1+=e.x-s,this._areaLocation.y1+=e.y-i,e.x=s,e.y=i,this._setupSelectionArea(),this._frame.next(null)}_onStartAreaScroll(){this._targetBoundaryScrolled=!0,S(this._targetElement,"scroll",this._onStartAreaScroll)}_wheelScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,i=e.deltaY?e.deltaY>0?1:-1:0,s=e.deltaX?e.deltaX>0?1:-1:0;this._scrollSpeed.y+=i*t,this._scrollSpeed.x+=s*t,this._onTapMove(e),e.preventDefault()}_keyboardScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,i=e.key==="ArrowLeft"?-1:e.key==="ArrowRight"?1:0,s=e.key==="ArrowUp"?-1:e.key==="ArrowDown"?1:0;this._scrollSpeed.x+=Math.sign(i)*t,this._scrollSpeed.y+=Math.sign(s)*t,e.preventDefault(),this._onTapMove({clientX:this._lastMousePosition.x,clientY:this._lastMousePosition.y,preventDefault:()=>{}})}_recalculateSelectionAreaRect(){const{_scrollSpeed:e,_areaLocation:t,_targetElement:i,_options:s}=this,{scrollTop:o,scrollHeight:r,clientHeight:l,scrollLeft:c,scrollWidth:p,clientWidth:f}=i,d=this._targetRect,{x1:a,y1:_}=t;let{x2:m,y2:h}=t;const{behaviour:{scrolling:{startScrollMargins:u}}}=s;m<d.left+u.x?(e.x=c?-R(d.left-m+u.x):0,m=m<d.left?d.left:m):m>d.right-u.x?(e.x=p-c-f?R(d.left+d.width-m-u.x):0,m=m>d.right?d.right:m):e.x=0,h<d.top+u.y?(e.y=o?-R(d.top-h+u.y):0,h=h<d.top?d.top:h):h>d.bottom-u.y?(e.y=r-o-l?R(d.top+d.height-h-u.y):0,h=h>d.bottom?d.bottom:h):e.y=0;const g=Q(a,m),A=Q(_,h),I=G(a,m),E=G(_,h);this._areaRect=U(g,A,I-g,E-A)}_redrawSelectionArea(){const{x:e,y:t,width:i,height:s}=this._areaRect,{style:o}=this._area;o.left=`${e}px`,o.top=`${t}px`,o.width=`${i}px`,o.height=`${s}px`}_onTapStop(e,t){var i;const{document:s,features:o}=this._options,{_singleClick:r}=this;S(this._targetElement,"scroll",this._onStartAreaScroll),S(s,["mousemove","touchmove"],this._delayedTapMove),S(s,["touchmove","mousemove"],this._onTapMove),S(s,["mouseup","touchcancel","touchend"],this._onTapStop),S(s,"scroll",this._onScroll),this._keepSelection(),e&&r&&o.singleTap.allow?this._onSingleTap(e):!r&&!t&&(this._updateElementSelection(),this._emitEvent("stop",e)),this._scrollSpeed.x=0,this._scrollSpeed.y=0,S(this._targetElement,"wheel",this._wheelScroll,{passive:!0}),S(this._options.document,"keydown",this._keyboardScroll,{passive:!0}),this._clippingElement.remove(),(i=this._frame)==null||i.cancel(),k(this._area,"display","none")}_updateElementSelection(){const{_selectables:e,_options:t,_selection:i,_areaRect:s}=this,{stored:o,selected:r,touched:l}=i,{intersect:c,overlap:p}=t.behaviour,f=p==="invert",d=[],a=[],_=[];for(let h=0;h<e.length;h++){const u=e[h];if(V(s,u.getBoundingClientRect(),c)){if(r.includes(u))o.includes(u)&&!l.includes(u)&&l.push(u);else if(f&&o.includes(u)){_.push(u);continue}else a.push(u);d.push(u)}}f&&a.push(...o.filter(h=>!r.includes(h)));const m=p==="keep";for(let h=0;h<r.length;h++){const u=r[h];!d.includes(u)&&!(m&&o.includes(u))&&_.push(u)}i.selected=d,i.changed={added:a,removed:_},this._latestElement=void 0}_emitEvent(e,t){return this.emit(e,{event:t,store:this._selection,selection:this})}_keepSelection(){const{_options:e,_selection:t}=this,{selected:i,changed:s,touched:o,stored:r}=t,l=i.filter(c=>!r.includes(c));switch(e.behaviour.overlap){case"drop":{t.stored=[...l,...r.filter(c=>!o.includes(c))];break}case"invert":{t.stored=[...l,...r.filter(c=>!s.removed.includes(c))];break}case"keep":{t.stored=[...r,...i.filter(c=>!r.includes(c))];break}}}trigger(e,t=!0){this._onTapStart(e,t)}resolveSelectables(){this._selectables=O(this._options.selectables,this._options.document)}clearSelection(e=!0,t=!1){const{selected:i,stored:s,changed:o}=this._selection;o.added=[],o.removed.push(...i,...e?s:[]),t||(this._emitEvent("move",null),this._emitEvent("stop",null)),this._selection=$(e?[]:s)}getSelection(){return this._selection.stored}getSelectionArea(){return this._area}getSelectables(){return this._selectables}setAreaLocation(e){Object.assign(this._areaLocation,e),this._redrawSelectionArea()}getAreaLocation(){return this._areaLocation}cancel(e=!1){this._onTapStop(null,!e)}destroy(){this.cancel(),this.disable(),this._clippingElement.remove(),super.unbindAllListeners()}select(e,t=!1){const{changed:i,selected:s,stored:o}=this._selection,r=O(e,this._options.document).filter(l=>!s.includes(l)&&!o.includes(l));return o.push(...r),s.push(...r),i.added.push(...r),i.removed=[],this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)),r}deselect(e,t=!1){const{selected:i,stored:s,changed:o}=this._selection,r=O(e,this._options.document).filter(l=>i.includes(l)||s.includes(l));this._selection.stored=s.filter(l=>!r.includes(l)),this._selection.selected=i.filter(l=>!r.includes(l)),this._selection.changed.added=[],this._selection.changed.removed.push(...r.filter(l=>!o.removed.includes(l))),this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null))}};oe.version="3.9.0";let Oe=oe;class Ie{imagesContainer;#t=te(ae([]));get selection(){return v(this.#t)}set selection(e){se(this.#t,e,!0)}#e;shiftSelectionAnchor;setSelection(e){if(!this.#e)return;const t=e.map(s=>this.imagesContainer?.querySelector(`[data-selectable][data-id="${s}"]`)).filter(s=>s!=null);this.#e.clearSelection(!0,!0);const i=this.#e.select(t,!0);return this.selection=i.map(s=>s.dataset.id).filter(s=>s!==void 0),i}refreshSelectables(){this.#e&&this.#e.resolveSelectables()}destroy(){this.#e?.destroy()}constructor(e,t=[],{ondeadclick:i}={}){if(this.selection=t,this.imagesContainer=e,!this.imagesContainer)return;const s=this.imagesContainer.parentElement??this.imagesContainer;this.#e=new Oe({selectables:"[data-selectable]",boundaries:s,startAreas:s,selectionAreaClass:"viselect-selection-area",behaviour:{overlap:"keep"},features:{deselectOnBlur:!0}}),this.#e.on("start",({event:o})=>{o&&!o.ctrlKey&&!o.metaKey&&!o.shiftKey&&(this.selection=[])}),this.#e.on("move",({store:{changed:o}})=>{const r=ee(o.removed),l=ee(o.added);this.selection=[...this.selection.filter(c=>!r.includes(c)),...l]}),this.#e.on("stop",({event:o,store:{changed:r}})=>{r.added.length>0||r.removed.length>0||i?.(o)})}}function ee(n){return n.filter(e=>e instanceof HTMLElement).map(e=>e.dataset.id).filter(Ee)}function Ke(n,e){let t=null;function i(o={}){s(),t=new MutationObserver(r=>{r.forEach(l=>o[`on${l.type}`]?.(l))}),t.observe(n,o)}function s(){t?.disconnect(),t=null}return i(e),{update:i,destroy:s}}var Pe=q('<header class="svelte-1rb1ldh"><h2 class="svelte-1rb1ldh"> </h2> <p class="svelte-1rb1ldh"> </p></header>'),je=q('<section class="group svelte-1rb1ldh"><!> <div class="items svelte-1rb1ldh"></div></section>'),qe=q('<div class="debug svelte-1rb1ldh"><code>selection <!> <br/> queued <!> <br/> loading <!> <br/> errored <!> <br/> preview urls <!> <br/></code></div>'),He=q('<section class="images svelte-1rb1ldh" data-testid="observations-area"><!> <!></section>');function rt(n,e){ce(e,!0);const t=K(()=>be(Se("main")));let i=te(void 0),s;le(()=>{if(v(i))return s?.destroy(),s=new Ie(v(i),b.selection,{ondeadclick:e.onemptyclick}),s.setSelection(b.selection),b.setSelection=a=>{if(!s){console.error("dragselect not initialized");return}s.setSelection(a)},()=>{s?.destroy(),b.setSelection=void 0}}),Y(()=>{b.selection=[...new Set(s?.selection??[])]}),Te("observations",{"$mod+a":{help:v(t).t(186),when:({target:a})=>!(a instanceof HTMLInputElement),do:()=>{s?.setSelection(e.items.map(a=>a.id))}},"$mod+d":{help:v(t).t(185),when:({target:a})=>!(a instanceof HTMLInputElement),do:()=>{b.selection=[],s?.setSelection([])}}});function o({id:a,virtual:_=!1}){return _?`${a}_virtual`:a}Y(()=>{const a=v(i)?.querySelector(`[data-id="${e.highlight}"]`);a&&(a.style.scrollMarginTop="10vh",a.scrollIntoView({behavior:"instant",block:"start",inline:"nearest"}))});const r=K(()=>!e.groups||!e.grouping?[["",l(e.items,e.sort)]]:[...xe(e.items,e.grouping).entries()].filter(([,a])=>a&&a.length>0).map(([a,_])=>[a,l(_??[],e.sort)]).toSorted(Ae(([a])=>e.groups?.indexOf(a)??0)));function l(a,_){return a.toSorted((m,h)=>{switch(_.direction==="desc"&&([m,h]=[h,m]),_.key){case"id":return m.id.localeCompare(h.id);case"filename":return m.name.localeCompare(h.name);case"date":return Me(m.addedAt,h.addedAt)}})}var c=He(),p=B(c);W(p,17,()=>v(r),([a,_])=>a,(a,_)=>{var m=K(()=>_e(v(_),2));let h=()=>v(m)[0],u=()=>v(m)[1];var g=je(),A=B(g);{var I=y=>{var w=Pe(),T=B(w),x=B(T,!0);M(T);var P=L(T,2),re=B(P,!0);M(P),M(w),X(ne=>{H(x,h()),H(re,ne)},[()=>we(u().length,v(t).tp(383),v(t)._.p)]),D(y,w)};F(A,y=>{h()&&y(I)})}var E=L(A,2);W(E,23,u,y=>o(y),(y,w,T)=>{var x=de(),P=ue(x);ve(P,()=>e.item,()=>v(w).data,()=>v(w),()=>v(T)),D(y,x)}),M(E),M(g),D(a,g)});var f=L(p,2);{var d=a=>{var _=qe();{const E=(y,w=me)=>{z();var T=pe();X(x=>H(T,`{
				${x??""}
				}`),[()=>[...fe(w())].map(x=>(x.length>10?"…":"")+x.slice(-10)).join(" ")]),D(y,T)};var m=B(_),h=L(B(m));E(h,()=>b.selection);var u=L(h,4);E(u,()=>b.queuedImages);var g=L(u,4);E(g,()=>b.loadingImages);var A=L(g,4);{let y=K(()=>b.erroredImages.keys());E(A,()=>v(y))}var I=L(A,4);{let y=K(()=>b.previewURLs.keys());E(I,()=>v(y))}z(2),M(m),M(_)}D(a,_)};F(f,a=>{Le()&&e.items.length>0&&a(d)})}M(c),ye(c,a=>se(i,a),()=>v(i)),ge(c,(a,_)=>Ke?.(a,_),()=>({childList:!0,subtree:!0,onchildList(){v(i)&&(s?.refreshSelectables(),s?.setSelection(b.selection))}})),D(n,c),he()}export{rt as A};
